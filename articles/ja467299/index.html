<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📘 👉🏾 🧑🏾‍🤝‍🧑🏾 概念：STDユーティリティクラスの実装の簡略化 🎒 💪🏼 🏂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="C++20 — . , ( .. ), ( ) , ++20- , enable_if. , ~15 (Concepts Full + Concept Map -> Concepts Lite), , (Java/# generic bounds, Rust traits, ...).
 

 — ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>概念：STDユーティリティクラスの実装の簡略化</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/467299/"><p><img src="https://habrastorage.org/webt/et/c4/ir/etc4ir2odcs1wv10o5jcu0yneng.jpeg"></p><br>
<p>  C++20  —     .    ,    ( ..    ),    (      )    ,    ++20-      ,     enable_if.    ,     ~15  (Concepts Full + Concept Map -&gt; Concepts Lite),   ,           (Java/# generic bounds, Rust traits, ...).</p><br>
<p>  —         ReSharper C++   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">C++ Russia 2019</a>.     concept-related  C++20,         STL,  C++17  ++20-.   —   .</p><a name="habracut"></a><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/vYzjV0xSqJE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<p>  .      ,  ,   ,     .          C++  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>.</p><br>
<p>  2018 ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Meeting C++</a>,     ,      C++:</p><br>
<ul>
<li>,</li>
<li>,</li>
<li> ?</li>
</ul><br>
<p>      .   ,      C++  ?</p><br>
<p>  ,  —  .         .  ,              ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>,   ,  .</p><br>
<p>    ,      C++20?       2003 ,        .  ,   concept related-   C++20.</p><br>
<p>    «»    <code>concept</code>.     .    :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-keyword">concept</span> NoThrowDefaultConstructible = noexept(T{});<font></font>
<font></font>
<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> From, <span class="hljs-keyword">typename</span> To&gt;
<span class="hljs-keyword">concept</span> Assignable = <span class="hljs-built_in">std</span>::is_assignable_v&lt;From, To&gt;</code></pre><br>
<p>      «  »,   « »,          .     ,     :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">int</span> I&gt; <span class="hljs-keyword">concept</span> Even = I % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>;</code></pre><br>
<p>            .   ,   size  alignment    :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">size_t</span> MaxSize, <span class="hljs-keyword">size_t</span> MaxAlign&gt;
<span class="hljs-keyword">concept</span> Small = <span class="hljs-keyword">sizeof</span>(T) &lt;= MaxSize &amp;&amp; <span class="hljs-keyword">alignof</span>(T) &lt;= MaxAlign;</code></pre><br>
<p>,  ,        ,    —    <code>constexpr bool</code> .</p><br>
<pre><code class="cpp hljs"><span class="hljs-comment">//  `concept`    ?</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> concept constexpr bool</span></code></pre><br>
<h1 id="kak-ispolzuyutsya-koncepty">  </h1><br>
<p> ,  ,   .</p><br>
<p>-,  ,   <code>constexpr bool</code> ,    ,    compile-time   . ,  <code>static_assert</code>   <code>noexcept</code><br>
:</p><br>
<pre><code class="cpp hljs"><span class="hljs-comment">// bool expression evaluated in compile-time</span>
<span class="hljs-keyword">static_assert</span>(Assignable&lt;<span class="hljs-keyword">float</span>, <span class="hljs-keyword">int</span>&gt;);<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> <span class="hljs-title">noexcept</span><span class="hljs-params">(NothrowDefaultConstructible&lt;T&gt;)</span> </span>{<font></font>
  T t;<font></font>
  ...<font></font>
}</code></pre><br>
<p>-,       <code>typename</code>  <code>class</code>    .    <code>optional</code>,         <code>initialized</code> . ,  <code>optional</code>     .     <code>Trivial</code>      - , ,  <code>std::string</code>,     :</p><br>
<pre><code class="cpp hljs"><span class="hljs-comment">//  type-parameter-key (class, typename)</span>
<span class="hljs-keyword">template</span>&lt;Trivial T&gt;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">simple_optional</span> {</span><font></font>
  T value;<font></font>
  <span class="hljs-keyword">bool</span> initialized = <span class="hljs-literal">false</span>;<font></font>
  ...<font></font>
};</code></pre><br>
<p>   .  ,    <code>any</code>  small buffer .   <code>SB</code> (small buffer)   <code>Size</code>  <code>Alignment</code>,   union  <code>SB</code>    .  ,      ,        <code>SB</code>.  ,   ,  ,     <code>Small</code>.  <code>Small</code>  3  :   ,           :</p><br>
<pre><code class="cpp hljs"><span class="hljs-comment">//  </span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">any</span> {</span>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SB</span> {</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-keyword">size_t</span> Size = ...;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-keyword">size_t</span> Alignment = ...;<font></font>
<font></font>
    <span class="hljs-keyword">aligned_storage_t</span>&lt;Size, Alignment&gt; storage;<font></font>
  };<font></font>
  <span class="hljs-keyword">union</span> {<font></font>
    SB sb;<font></font>
    <span class="hljs-keyword">void</span>* handle;<font></font>
  };<font></font>
  <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;Small&lt;SB::Size, SB::Alignment&gt; T&gt;
  <span class="hljs-title">any</span><span class="hljs-params">(T <span class="hljs-keyword">const</span> &amp; t)</span> : <span class="hljs-title">sb</span><span class="hljs-params">(...)</span> ...
}</span>;</code></pre><br>
<p>    .     , ,  - ,  <code>auto</code>.     :</p><br>
<pre><code class="cpp hljs"><span class="hljs-comment">// Terse syntax (  auto)</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">any</span> {</span>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SB</span> {</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-keyword">size_t</span> Size = ...;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-keyword">size_t</span> Alignment = ...;<font></font>
<font></font>
    <span class="hljs-keyword">aligned_storage_t</span>&lt;Size, Alignment&gt; storage;<font></font>
  };<font></font>
  <span class="hljs-keyword">union</span> {<font></font>
    SB sb;<font></font>
    <span class="hljs-keyword">void</span>* handle;<font></font>
  };<font></font>
  any(Small&lt;SB::Size, SB::Alignment&gt; <span class="hljs-keyword">auto</span> <span class="hljs-keyword">const</span> &amp; t) : sb(...) ...<font></font>
};</code></pre><br>
<p>,   ,    <code>auto</code>,       .</p><br>
<p>  <code>get_handle</code>,      <code>handle</code>.<br>
 ,        <code>handle</code>,    —     <code>handle</code>.      <code>if constexpr</code>    ,         ,     . ,    <code>auto</code>,     ,    ,    :</p><br>
<pre><code class="cpp hljs"><span class="hljs-comment">//Terse syntax (  auto)</span>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">concept</span> LEPtr = Small&lt;T, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">void</span> *), <span class="hljs-keyword">alignof</span>(<span class="hljs-keyword">void</span> *)&gt;;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">auto</span> <span class="hljs-title">get_handle</span><span class="hljs-params">(T&amp; object)</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">if</span> <span class="hljs-title">constexpr</span> <span class="hljs-params">(LEPtr&lt;T&gt;)</span>
    <span class="hljs-keyword">return</span> object</span>;
  <span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> &amp;object;<font></font>
}</code></pre><br>
<p> C++20     ,     <code>auto</code>,   <code>auto</code>:</p><br>
<pre><code class="cpp hljs"><span class="hljs-comment">// Terse syntax (  auto)</span>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">concept</span> LEPtr = Small&lt;T, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">void</span> *), <span class="hljs-keyword">alignof</span>(<span class="hljs-keyword">void</span> *)&gt;;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
LEPtr <span class="hljs-keyword">auto</span> <span class="hljs-title">get_handle</span><span class="hljs-params">(T &amp;object)</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">if</span> <span class="hljs-title">constexpr</span> <span class="hljs-params">(LEPtr&lt;T&gt;)</span>
        <span class="hljs-keyword">return</span> object</span>;
    <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">return</span> &amp;object;<font></font>
}</code></pre><br>
<h1 id="requires-expression">Requires expression</h1><br>
<p>Requires expression —    expression',     <code>bool</code>    compile-time.         . Requires expression      .</p><br>
<p>  <code>Constructible</code>. ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>,   :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">typename</span>... Args&gt;
<span class="hljs-keyword">concept</span> Constructible = <span class="hljs-keyword">requires</span>(Args... args) { T{args...} };</code></pre><br>
<p>   <code>Comparable</code>. ,   <code>T</code>  <code>Comparable</code>,     <code>T</code>      «»     <code>bool</code>.       ,   expression   <code>bool</code>,   ,    <code>bool</code>:</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">concept</span> Comparable = <span class="hljs-keyword">requires</span>(T <span class="hljs-keyword">const</span> &amp; a, T <span class="hljs-keyword">const</span> &amp; b) {<font></font>
  {a &lt; b} -&gt; <span class="hljs-keyword">bool</span>;<font></font>
};</code></pre><br>
<p>,   ,  ,      .</p><br>
<p>     <code>Comparable</code>,     . , <code>RandomAccessIterator</code> —  <code>BidirectionalIterator</code>   - .  ,   <code>Sortable</code>. <code>Range</code>  <code>Sortable</code>,    <code>RandomAccess</code>    .       <code>sort</code>,     ,  <code>Sortable Range</code>:</p><br>
<pre><code class="cpp hljs"><span class="hljs-comment">// concepts,    ++20</span><font></font>
<font></font>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Iterator&gt;
<span class="hljs-keyword">concept</span> RandomAccessIterator = BidirectionalIterator&lt;Iterator&gt; &amp;&amp; ...;<font></font>
<font></font>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> R&gt;
<span class="hljs-keyword">concept</span> Sortable = RandomAccessIterator&lt;Iterator&lt;R&gt;&gt; &amp;&amp; Comparable&lt;ValueType&lt;R&gt;&gt;;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;Sortable Range&gt;
<span class="hljs-keyword">void</span> <span class="hljs-title">sort</span><span class="hljs-params">(Range &amp;)</span> </span>{...}</code></pre><br>
<p>,        -,    <code>Sortable</code>,     , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">SFINAE-friendly</a>    .   <code>std::list</code>'   ,    :</p><br>
<pre><code class="cpp hljs"><span class="hljs-comment">//concepts,    ++20, </span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">X</span> {</span>};
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; vi; sort(vi); <span class="hljs-comment">// OK</span>
  <span class="hljs-built_in">list</span> &lt;<span class="hljs-keyword">int</span>&gt; li; sort(li); <span class="hljs-comment">// Fail, list&lt;int&gt;::iterator is not random access</span>
  <span class="hljs-built_in">vector</span>&lt; X &gt; vx; sort(vx); <span class="hljs-comment">// Fail, X is not Comparable</span>
}</code></pre><br>
<p>        -  ?     .  ,     .         ,      C++17?</p><br>
<pre><code class="cpp hljs"><span class="hljs-comment">//concepts,     ++17</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> concept constexpr bool</span><font></font>
<font></font>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">concept</span> Comparable = is_convertible_v&lt;
  <span class="hljs-keyword">decltype</span>(declval&lt;T <span class="hljs-keyword">const</span> &amp;&gt;() &lt; declval&lt;T <span class="hljs-keyword">const</span> &amp;&gt;()), <span class="hljs-keyword">bool</span><font></font>
  &gt;;<font></font>
<font></font>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Iterator&gt;
<span class="hljs-keyword">concept</span> RandomAccessIterator = BidirectionalIterator&lt;Iterator&gt; &amp;&amp; ...;<font></font>
<font></font>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> R&gt;
<span class="hljs-keyword">concept</span> Sortable = RandomAccessIterator&lt;Iterator&lt;R&gt;&gt; &amp;&amp; Comparable&lt;ValueType&lt;R&gt;&gt;;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Range, <span class="hljs-keyword">typename</span> </span>= <span class="hljs-function"><span class="hljs-keyword">enable_if_t</span>&lt;Sortable&lt;Range&gt;&gt;&gt;
<span class="hljs-keyword">void</span> <span class="hljs-title">sort</span><span class="hljs-params">(Range &amp;)</span> </span>{ ... }</code></pre><br>
<p>  <code>concept</code>   ,  <code>Comparable</code>   .    ,    ,  requires expression     .     <code>Sortable</code>    <code>enable_if</code> ,   <code>sort</code>  <code>Sortable Range</code>.</p><br>
<p> ,          , ,   ,     . ,  Clang       ,     <code>enable_if</code>    <br>
 <code>false</code>,      ,    requirement   .</p><br>
<p>       .    :   ,         — requires clause.</p><br>
<h1 id="requires-clause">Requires clause</h1><br>
<p>Requires clause —   ,           .       <code>requires</code>,     .    ,   template specialization  overloading candidate,       SFINAE,   ,   :</p><br>
<pre><code class="cpp hljs"><span class="hljs-comment">// requires-clause</span><font></font>
<font></font>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> R&gt; <span class="hljs-keyword">concept</span> Sortable<font></font>
  = RandomAccessIterator&lt;Iterator&lt;R&gt;&gt; &amp;&amp; Comparable&lt;ValueType&lt;R&gt;&gt;;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;Sortable Range&gt;
<span class="hljs-keyword">void</span> <span class="hljs-title">sort</span><span class="hljs-params">(Range &amp;)</span> </span>{ ... }</code></pre><br>
<p>     ,    requires clause?       :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> R&gt; <span class="hljs-keyword">concept</span> Sortable<font></font>
  = RandomAccessIterator&lt;Iterator&lt;R&gt;&gt; &amp;&amp; Comparable&lt;ValueType&lt;R&gt;&gt;;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Range&gt; <span class="hljs-keyword">requires</span> Sortable&lt;Range&gt;
<span class="hljs-keyword">void</span> <span class="hljs-title">sort</span><span class="hljs-params">(Range &amp;)</span> </span>{ ... }</code></pre><br>
<p>,     ,    .        <code>Sortable</code>. C   ,  ,      <code>Sortable</code> :   <code>Sortable</code> ,      <code>sort</code>.     .    :</p><br>
<pre><code class="plaintext hljs">//template&lt;typename R&gt; concept Sortable<font></font>
//    = RandomAccessIterator&lt;Iterator&lt;R&gt;&gt; &amp;&amp; Comparable&lt;ValueType&lt;R&gt;&gt;;<font></font>
<font></font>
template&lt;typename Range&gt; requires<font></font>
  RandomAccessIterator&lt;Iterator&lt;Range&gt;&gt; &amp;&amp; Comparable&lt;ValueType&lt;Range&gt;&gt;;<font></font>
void sort(Range &amp;) { ... }</code></pre><br>
<h1 id="itogovyy-spisok-concept-related-fich">  concept-related </h1><br>
<p> concept-related   C++20  .              :</p><br>
<ul>
<li>  <code>concept</code>.   <code>concept</code>,  ,    ,  <code>constexpr bool</code>   .</li>
<li>    . ,  ,     .     C++   ,       .</li>
<li>Requires expression —    ,        .</li>
<li>Requires clause —     ,     SFINAE      C++.</li>
</ul><br>
<h1 id="podrobnee-o-requires-expression">  requires expression</h1><br>
<p>      requires clause,    requires expression.</p><br>
<p>-,        .         <code>__if_exists</code>-<code>__if_not_exists</code>.    compile-time              .    ,       ,   .   <code>f()</code>,           .       .       <code>z</code>,        .     :</p><br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Point2</span> {</span> <span class="hljs-keyword">float</span> x, y; };
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Point3</span> {</span> <span class="hljs-keyword">float</span> x, y, z; };<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Point&gt;
<span class="hljs-keyword">void</span> <span class="hljs-title">f</span><span class="hljs-params">(Point <span class="hljs-keyword">const</span> &amp; p)</span> </span>{
  <span class="hljs-keyword">float</span> h;<font></font>
  __if_exists(Point::z) {<font></font>
    h = p.z;<font></font>
  }<font></font>
  __if_not_exists(Point::z) {<font></font>
    h = sensor.get_height(p);<font></font>
  }<font></font>
}</code></pre><br>
<p> C++20        ,  .   ,   :</p><br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Point2</span> {</span> <span class="hljs-keyword">float</span> x, y; };
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Point3</span> {</span> <span class="hljs-keyword">float</span> x, y, z; };<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Point&gt;
<span class="hljs-keyword">void</span> <span class="hljs-title">f</span><span class="hljs-params">(Point <span class="hljs-keyword">const</span> &amp; p)</span> </span>{
  <span class="hljs-keyword">float</span> h;
  <span class="hljs-function"><span class="hljs-keyword">if</span> <span class="hljs-title">constexpr</span><span class="hljs-params">(<span class="hljs-keyword">requires</span> { Point::z; })</span>
    h </span>= p.z;
  <span class="hljs-keyword">else</span><font></font>
    h = sensor.get_height(p);<font></font>
}</code></pre><br>
<p>  —  ,       requires expression.<br>
  ,     ,      .    ,   , .</p><br>
<p>   <code>Sizable</code>,  ,       <code>size</code>,  <code>size_t</code>. , , ,  <code>vector&lt;int&gt;</code>  <code>Sizable</code>,   <code>static_assert</code> . , -    ?     ?</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Container&gt;
<span class="hljs-keyword">concept</span> Sizable = <span class="hljs-keyword">requires</span>(Container <span class="hljs-keyword">const</span> &amp; c) {<font></font>
  c.size() -&gt; <span class="hljs-keyword">size_t</span>;<font></font>
};<font></font>
<span class="hljs-keyword">static_assert</span>(Sizable&lt;<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&gt;); <span class="hljs-comment">// Fail</span></code></pre><br>
<p>   ,  .   <code>X</code>   <code>Sizable</code>.  ,     ?</p><br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">X</span> {</span>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Inner</span> {</span>
    <span class="hljs-keyword">int</span> <span class="hljs-keyword">size_t</span>;<font></font>
  };<font></font>
  <span class="hljs-function">Inner* <span class="hljs-title">size</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span></span>;<font></font>
};<font></font>
<span class="hljs-keyword">static_assert</span>(Sizable&lt;X&gt;); <span class="hljs-comment">// OK</span></code></pre><br>
<p>    .    ,    .    ,     ,  :</p><br>
<p><img src="https://habrastorage.org/webt/mu/ht/l2/muhtl2zbr7nbutf7an8or2qjhse.jpeg"></p><br>
<p>,   <code>size_t</code>,   ?  ,    ,    ,    . ,     requires expression —    ,     .   <code>X</code> — ,   ,  <code>vector&lt;int&gt;</code> — .   ,   ,      :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Container&gt;
<span class="hljs-keyword">concept</span> Sizable = <span class="hljs-keyword">requires</span>(Container <span class="hljs-keyword">const</span> &amp; c) {<font></font>
  {c.size()} -&gt; <span class="hljs-keyword">size_t</span>;<font></font>
};<font></font>
<span class="hljs-keyword">static_assert</span>(Sizable&lt;<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&gt;); <span class="hljs-comment">// OK</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">X</span> {</span>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Inner</span> {</span>
    <span class="hljs-keyword">int</span> <span class="hljs-keyword">size_t</span>;<font></font>
  };<font></font>
  <span class="hljs-function">Inner* <span class="hljs-title">size</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span></span>;<font></font>
};<font></font>
<span class="hljs-keyword">static_assert</span>(Sizable&lt;X&gt;); <span class="hljs-comment">// Fail</span></code></pre><br>
<p>    .  -,    .</p><br>
<h1 id="primery-ispolzovaniya-konceptov">  </h1><br>
<h2 id="realizaciya-klassa-pair">  pair</h2><br>
<p>    -  STL,     C++17,   .<br>
   ,   C++20    .</p><br>
<p>    <code>pair</code>.<br>
   ,     C++98.<br>
   -  ,  <br>
 ,       .<br>
,    ,      :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> F, <span class="hljs-keyword">typename</span> S&gt; <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pair</span> {</span><font></font>
  F f; S s;<font></font>
  ...<font></font>
};</code></pre><br>
<p>,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">cppreference</a>,  <code>pair</code>    8 .<br>
     , ,   STL,    15   <code>pair</code>.             .</p><br>
<p> ,  -  ?   ,   .  ,       <code>pair</code>   , , <code>int</code>,     <code>pair</code>    ,    .       ,   value-   <code>f</code> (first)  <code>s</code> (second).</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> F, <span class="hljs-keyword">typename</span> S&gt; <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pair</span> {</span><font></font>
  F f; S s;<font></font>
<font></font>
  pair()<font></font>
    : f()<font></font>
    , s()<font></font>
  {}<font></font>
};</code></pre><br>
<p> ,     <code>pair</code>  -,      , ,    <code></code>,      .   —      <code>pair</code>      ,       <code>f</code>  <code>s</code>,    :</p><br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">A</span> {</span>
  A(<span class="hljs-keyword">int</span>);<font></font>
};<font></font>
<font></font>
pair&lt;<span class="hljs-keyword">int</span>, A&gt; a2;     <span class="hljs-comment">// must fail</span>
pair&lt;<span class="hljs-keyword">int</span>, A&gt; a1; { <span class="hljs-number">1</span>, <span class="hljs-number">2</span> };    <span class="hljs-comment">// must be OK</span></code></pre><br>
<p>            SFINAE.<br>
 ,    , —   ,    ,   <code>f</code>  <code>s</code> — <code>is_default_constructable</code>:</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> F, <span class="hljs-keyword">typename</span> S&gt; <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pair</span> {</span><font></font>
  F f; S s;<font></font>
<font></font>
  <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> = <span class="hljs-keyword">enable_if_t</span>&lt;conjunction_v&lt;<font></font>
      is_default_constructible&lt;F&gt;, <span class="hljs-comment">// not dependent</span><font></font>
      is_default_constructible&lt;S&gt;<font></font>
    &gt;&gt;&gt;<font></font>
  pair() : f(), s() {}<font></font>
};</code></pre><br>
<p>   ,    <code>enable_if_t</code>      .        ,    .     <code>false</code>, ,    hard compiler error.</p><br>
<p>  ,           ,   <code>enable_if_t</code>      :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> F, <span class="hljs-keyword">typename</span> S&gt; <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pair</span> {</span><font></font>
  F f; S s;<font></font>
<font></font>
  <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T = F, <span class="hljs-keyword">typename</span> U = S,
    <span class="hljs-keyword">typename</span> = <span class="hljs-keyword">enable_if_t</span>&lt;conjunction_v&lt;<font></font>
      is_default_constructible&lt;T&gt;,<font></font>
      is_default_constructible&lt;U&gt;<font></font>
    &gt;&gt;&gt;<font></font>
  pair() : f(), s() {}<font></font>
};</code></pre><br>
<p>C  .   ,    <code>T</code>  <code>U</code>      .  C++    ,      ,      ,      .        .  ,           .     ,  ,     — .</p><br>
<p>    ,    ,   . ,     <code>B</code>  explicit   ,      <code>pair&lt;int, B&gt;</code>:</p><br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">B</span> {</span> <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">B</span><span class="hljs-params">()</span></span>; };<font></font>
<font></font>
pair&lt;<span class="hljs-keyword">int</span>, B&gt; p = {};</code></pre><br>
<p>   , ,  ,   .  ,     ,        .</p><br>
<p>:       explicit  ?  C++17     :    ,  .</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> F, <span class="hljs-keyword">typename</span> S&gt; <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pair</span> {</span><font></font>
  F f; S s;<font></font>
<font></font>
  <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T = F, <span class="hljs-keyword">typename</span> U = S,
    <span class="hljs-keyword">typename</span> = <span class="hljs-keyword">enable_if_t</span>&lt;conjunction_v&lt;<font></font>
      is_default_constructible&lt;T&gt;,<font></font>
      is_default_constructible&lt;U&gt;,<font></font>
      is_implicity_default_constructible&lt;T&gt;,<font></font>
      is_implicity_default_constructible&lt;U&gt;<font></font>
    &gt;&gt;&gt;<font></font>
  pair() : f(), s() {}<font></font>
<font></font>
  <span class="hljs-keyword">template</span>&lt;...&gt; <span class="hljs-keyword">explicit</span> pair() : f(), s() {}<font></font>
};</code></pre><br>
<p>      :</p><br>
<ul>
<li>      SFINAE  ,   — implicitly default constructible;</li>
<li>    .</li>
</ul><br>
<p> ,   type trait <code>is_implicitly_default_constructible</code>  C++17,    ,    SFINAE   :</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;typrname T&gt; true_type <span class="hljs-title">test</span><span class="hljs-params">(T, <span class="hljs-keyword">int</span>)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;typrname T&gt; false_type <span class="hljs-title">test</span><span class="hljs-params">(<span class="hljs-keyword">int</span>, ...)</span></span>;<font></font>
<font></font>
<span class="hljs-keyword">template</span>&lt;typrname T&gt;
<span class="hljs-keyword">using</span> is_implicity_default_constructible = <span class="hljs-keyword">decltype</span>(test&lt;T&gt;({}, <span class="hljs-number">0</span>));</code></pre><br>
<p>    -   <code>pair &lt;int, B&gt;</code>,    ,   :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;..., <span class="hljs-keyword">typename</span> = <span class="hljs-keyword">enable_if_t</span>&lt;conjuction_v&lt;<font></font>
    is_default_constructible&lt;T&gt;,<font></font>
    is_default_constructible&lt;U&gt;,<font></font>
    is_implicity_default_constructible&lt;T&gt;,<font></font>
    is_implicity_default_constructible&lt;U&gt;<font></font>
  &gt;&gt;&gt;<font></font>
...<font></font>
pair&lt;<span class="hljs-keyword">int</span>, B&gt; p = {};<font></font>
...<font></font>
candidate <span class="hljs-keyword">template</span> ignored: requirement <span class="hljs-string">'conjunction_v&lt;
  is_default_constructible&lt;int&gt;,
  is_default_constructible&lt;B&gt;,
  is_implicity_default_constructible&lt;int&gt;,
  is_implicity_default_constructible&lt;B&gt;
&gt;'</span> was <span class="hljs-keyword">not</span> satisfied [with T=<span class="hljs-keyword">int</span>, U=B]</code></pre><br>
<p>        .  ,      : «    <code>&lt;int, B&gt;</code>    ». GCC  Clang    : «     ,      », —     .</p><br>
<p>     ?    copy  move ,   .  copy  move  :    ,   .      ,   .</p><br>
<p>GCC : «Substitution failed,    <code>enable_if&lt;false&gt;</code>  <code>type</code> —  , ».</p><br>
<p>Clang    special case.       .      <code>enable_if</code>    <code>false</code>,  ,   requirement  .</p><br>
<p>       ,     <code>enable_if</code>.  ,    <code>false</code>,    , .</p><br>
<p>  ,    <code>enable_if</code>    :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;...,
    <span class="hljs-keyword">typename</span> = <span class="hljs-keyword">enable_if_t</span>&lt;is_default_constructible&lt;T&gt;::value&gt;&gt;,
    <span class="hljs-keyword">typename</span> = <span class="hljs-keyword">enable_if_t</span>&lt;is_default_constructible&lt;U&gt;::value&gt;&gt;,
    <span class="hljs-keyword">typename</span> = <span class="hljs-keyword">enable_if_t</span>&lt;is_implicity_default_constructible&lt;T&gt;::value&gt;&gt;,
    <span class="hljs-keyword">typename</span> = <span class="hljs-keyword">enable_if_t</span>&lt;is_implicity_default_constructible&lt;U&gt;::value&gt;&gt;<font></font>
  &gt;<font></font>
...</code></pre><br>
<p>         ,  -   ,   type trait <code>is_implicitly_default_constructable</code>  :</p><br>
<pre><code class="cpp hljs">pair&lt;<span class="hljs-keyword">int</span>, B&gt; p = {};<font></font>
<font></font>
<span class="hljs-comment">// candidate template ignored: requirement 'is_implicity_default_constructible&lt;B&gt;::value' was not satisfied</span>
with...</code></pre><br>
<p>    :   ,      ?<br>
   ,          ,       .  ,    ,  .</p><br>
<p>   C++20?    ,     requires clause. ,      <code>enable_if</code>,     requires clause:</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> F, <span class="hljs-keyword">typename</span> S&gt; <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pair</span> {</span><font></font>
    F f; S s;<font></font>
<font></font>
    pair() <span class="hljs-keyword">requires</span> DefaultConstructible&lt;F&gt;<font></font>
            &amp;&amp; DefaultConstructible&lt;S&gt;<font></font>
            &amp;&amp; ImplicitlyDefaultConstructible&lt;F&gt;<font></font>
            &amp;&amp; ImplicitlyDefaultConstructible&lt;S&gt;<font></font>
        : f(), s() {}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">pair</span><span class="hljs-params">()</span> ...      
}</span>;</code></pre><br>
<p> <code>ImplicitlyDefaultConstructible</code>       requires expression,        :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-keyword">concept</span> ImplicitlyDefaultConstructible =
    <span class="hljs-keyword">requires</span> { [] (T) {} ({}); };</code></pre><br>
<p>  <code>T</code>  <code>ImplicitlyDefaultConstructible</code>,  ,     <code>T</code>      .  ,   ,      SFINAE.</p><br>
<p>   C++20:   (conditional) <code>explicit</code> (    <code>noexcept</code>).     <code>explicit</code>  .          ,     <code>explicit</code>.</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> F, <span class="hljs-keyword">typename</span> S&gt; <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pair</span> {</span><font></font>
  F f; S s;<font></font>
<font></font>
  <span class="hljs-keyword">explicit</span>(!ImplicityDefaultConstructible&lt;F&gt; ||<font></font>
           !ImplicityDefaultConstructible&lt;S&gt;)<font></font>
  pair() <span class="hljs-keyword">requires</span> DefaultConstructible&lt;F&gt;<font></font>
               &amp;&amp; DefaultConstructible&lt;S&gt;<font></font>
    : f(), s() {}<font></font>
};</code></pre><br>
<p>     ,   .      ,    <code>DefaultConstructible</code>,   <code>explicit</code>,       <code>explicit</code>.</p><br>
<h2 id="realizaciya-klassa-optional-v-c17">  Optional  C++17</h2><br>
<p>      <code>Optional</code>.       ,     .</p><br>
<p>     .    ?   ,     C++    :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">enum</span> Option&lt;T&gt; {<font></font>
  None,<font></font>
  Some(t)<font></font>
}</code></pre><br>
<p> :</p><br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Optional</span>&lt;T&gt; {</span>
  <span class="hljs-keyword">final</span> T value;<font></font>
<font></font>
  Optional()  {<span class="hljs-keyword">this</span>.value = null; }<font></font>
  Optional(T value)  {<span class="hljs-keyword">this</span>.value = value; }<font></font>
}</code></pre><br>
<p>      C++:   <code>null</code>,    value-? </p><br>
<p>   C++ .    <code>initialized</code>  <code>storage</code>,      ,   .         <code>T</code>,     <code>optional</code>   <code>T</code>   ,  C++ memory model.</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">optional</span> {</span>
  <span class="hljs-keyword">bool</span> initialized;
  <span class="hljs-keyword">aligned_storage_t</span>&lt;<span class="hljs-keyword">sizeof</span>(T), <span class="hljs-keyword">alignof</span>(T)&gt; storage;<font></font>
<font></font>
    ...</code></pre><br>
<p>   ,   .  :    <code>optional</code>,   <code>optional</code>  .     :</p><br>
<pre><code class="cpp hljs">  ...
  <span class="hljs-function">T       &amp; <span class="hljs-title">get</span><span class="hljs-params">()</span>       &amp; </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">reinterpret_cast</span>&lt;T       &amp;&gt;(storage); }
  <span class="hljs-function">T <span class="hljs-keyword">const</span> &amp; <span class="hljs-title">get</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> &amp; </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">reinterpret_cast</span>&lt;T <span class="hljs-keyword">const</span> &amp;&gt;(storage); }
  <span class="hljs-function">T      &amp;&amp; <span class="hljs-title">get</span><span class="hljs-params">()</span>      &amp;&amp; </span>{ <span class="hljs-keyword">return</span> move(get()); }<font></font>
<font></font>
  optional() <span class="hljs-keyword">noexcept</span> : initialized(<span class="hljs-literal">false</span>) {}<font></font>
  optional(T <span class="hljs-keyword">const</span> &amp; value) <span class="hljs-keyword">noexcept</span>(NothrowCopyConstructible&lt;T&gt;)<font></font>
    : initialized(<span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">new</span> (&amp;storage) T(value);<font></font>
  }<font></font>
  ~optional() : <span class="hljs-keyword">noexcept</span>(NothrowDestructible&lt;T&gt;) { <span class="hljs-keyword">if</span> (initialized) get().~T(); }<font></font>
};<font></font>
</code></pre><br>
<p> <code>optional</code>'   .    <code>optional</code>,   <code>optional</code>  ,   ,   <code>optional</code>      .     ,        copy  move .</p><br>
<p>  .   :     assignment .   ,   .      .  copy constructor.   :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">optional</span> {</span>
  <span class="hljs-keyword">bool</span> initialized;
  <span class="hljs-keyword">aligned_storage_t</span>&lt;<span class="hljs-keyword">sizeof</span>(T), <span class="hljs-keyword">alignof</span>(T)&gt; storage;<font></font>
  ...<font></font>
<font></font>
  optional(optional <span class="hljs-keyword">const</span> &amp; other) <span class="hljs-keyword">noexcept</span>(NothrowCopyConstructible&lt;T&gt;)<font></font>
    : initialized(other.initialized) {<font></font>
    <span class="hljs-keyword">if</span> (initialized) <span class="hljs-keyword">new</span> (&amp;storage) T(other.get());<font></font>
  }<font></font>
<font></font>
  optional&amp; <span class="hljs-keyword">operator</span> =(optional &amp;&amp; other) <span class="hljs-keyword">noexcept</span>(...) {...}<font></font>
};</code></pre><br>
<p> move assignment.    ,    :</p><br>
<ul>
<li>  <code>optional</code>' ,    .</li>
<li>    ,   .</li>
<li>   ,   — ,   ,  .</li>
</ul><br>
<p>     <code>T</code>  : move constructor, move assignment  :</p><br>
<pre><code class="cpp hljs">optional&amp; <span class="hljs-keyword">operator</span> =(optional &amp;&amp; other) <span class="hljs-keyword">noexcept</span>(...) {
  <span class="hljs-keyword">if</span> (initialized) {
    <span class="hljs-keyword">if</span> (other.initialized) {<font></font>
      get() = move(other.get());<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      initialized = <span class="hljs-literal">false</span>; other.initilized = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">new</span>(&amp;other.storage) T(move(get()));<font></font>
      get().~T();<font></font>
    }<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (other.initialized) {<font></font>
    initialized = <span class="hljs-literal">true</span>; other.initialized = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">new</span>(&amp;storage) T(move(get()));<font></font>
    other.get().~T();<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<font></font>
}<font></font>
</code></pre><br>
<p>        <code>noexcept</code>:</p><br>
<pre><code class="cpp hljs">optional&amp; <span class="hljs-keyword">operator</span> =(optional &amp;&amp; other)
    <span class="hljs-keyword">noexcept</span>(NothrowAssignable&lt;T&gt; &amp;&amp;<font></font>
             NothrowMoveConstructible&lt;T&gt; &amp;&amp;<font></font>
             NothrowDestructible&lt;T&gt;) {<font></font>
  <span class="hljs-keyword">if</span> (initialized) {
    <span class="hljs-keyword">if</span> (other.initialized) {<font></font>
      get() = move(other.get());<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      initialized = <span class="hljs-literal">false</span>; other.initialized = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">new</span> (&amp;other.storage) T(move(get()));<font></font>
      get().~T();<font></font>
    }<font></font>
  }<font></font>
  ...<font></font>
}</code></pre><br>
<p> <code>optional</code>     :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">optional</span> {</span><font></font>
  ...<font></font>
  optional(optional <span class="hljs-keyword">const</span> &amp;)  <span class="hljs-keyword">noexcept</span>(NothrowCopyConstructible&lt;T&gt;);<font></font>
  optional(optional &amp;&amp;)       <span class="hljs-keyword">noexcept</span>(NothrowMoveConstructible&lt;T&gt;);<font></font>
  optional&amp; <span class="hljs-keyword">operator</span> =(optional <span class="hljs-keyword">const</span> &amp;)  <span class="hljs-keyword">noexcept</span>(...);<font></font>
  optional&amp; <span class="hljs-keyword">operator</span> =(optional &amp;&amp;)       <span class="hljs-keyword">noexcept</span>(...);<font></font>
};</code></pre><br>
<p>       ,        <code>pair</code>:<br>
     <code>Optional</code>  -,        (, deleted),   compilation error.</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">optional</span>&lt;unique_ptr&lt;int&gt;&gt;;</span> <span class="hljs-comment">// compilation error</span></code></pre><br>
<p>   ,  <code>optional</code>  <code>unique_ptr</code>    ,<br>
 copy constructor  copy assignment   deleted.           ,    ,     SFINAE.<br>
     copy  move   assignment ,       —     .   - ,     copy ,      .</p><br>
<p>  —  .        copy      : deleted operation , , operation:</p><br>
<ul>
<li><code>deleted_copy_construct</code>    <code>delete</code>,   — <code>default</code>;</li>
<li><code>copy_construct</code>   ,   <code>copy_construct</code>     .</li>
</ul><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span>&gt; <span class="hljs-title">struct</span> <span class="hljs-title">deleted_copy_construct</span> :</span> Base {<font></font>
  deleted_copy_construct(deleted_copy_construct <span class="hljs-keyword">const</span> &amp;)                = <span class="hljs-keyword">delete</span>;<font></font>
  deleted_copy_construct(deleted_copy_construct &amp;&amp;)                     = <span class="hljs-keyword">default</span>;<font></font>
  deleted_copy_construct&amp; <span class="hljs-keyword">operator</span> =(deleted_copy_construct <span class="hljs-keyword">const</span> &amp;)    = <span class="hljs-keyword">default</span>;<font></font>
  deleted_copy_construct&amp; <span class="hljs-keyword">operator</span> =(deleted_copy_construct &amp;&amp;)         = <span class="hljs-keyword">default</span>;<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span>&gt; <span class="hljs-title">struct</span> <span class="hljs-title">copy_construct</span> :</span> Base {<font></font>
  copy_construct(copy_construct <span class="hljs-keyword">const</span> &amp; other)
      <span class="hljs-keyword">noexcept</span>(<span class="hljs-keyword">noexcept</span>(Base::construct(other))) {<font></font>
    Base::construct(other);<font></font>
  }<font></font>
  copy_construct(copy_construct &amp;&amp;)                     = <span class="hljs-keyword">default</span>;<font></font>
  copy_construct&amp; <span class="hljs-keyword">operator</span> =(copy_construct <span class="hljs-keyword">const</span> &amp;)    = <span class="hljs-keyword">default</span>;<font></font>
  copy_construct&amp; <span class="hljs-keyword">operator</span> =(copy_construct &amp;&amp;)         = <span class="hljs-keyword">default</span>;<font></font>
};</code></pre><br>
<p>  <code>select_copy_construct</code>,     ,   <code>CopyConstrictuble</code>  ,    <code>copy_construct</code>,  <code>deleted_copy_construct</code>:</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span>&gt;
<span class="hljs-title">using</span> <span class="hljs-title">select_copy_construct</span> = <span class="hljs-title">conditional_t</span>&lt;CopyConstructible&lt;T&gt;
  copy_construct&lt;Base&gt;
  deleted_copy_construct&lt;Base&gt;
&gt;;</span></code></pre><br>
<p>,    <code>optional</code>,   <code>optional_base</code>, copy     <code>construct</code>   ,   <code>optional</code>  <br>
<code>select_copy_construct&lt;T, optional_base&lt;T&gt;&gt;</code>.       copy :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">optional_base</span> {</span><font></font>
  ...<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">construct</span><span class="hljs-params">(optional_base <span class="hljs-keyword">const</span> &amp; other)</span> <span class="hljs-title">noexcept</span><span class="hljs-params">(NothrowCopyConstructible&lt;T&gt;)</span> </span>{
    <span class="hljs-keyword">if</span> ((initialized = other.initialized)) <span class="hljs-keyword">new</span> (&amp;storage) t(other.get());<font></font>
  }<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">optional</span> :</span> select_copy_construct&lt;T, optional_base&lt;T&gt;&gt; {<font></font>
  ...<font></font>
};</code></pre><br>
<p>     . , ,    <code>copy_construct</code>    ,  <code>move_construct</code>       <code>copy_construct</code>, <code>copy_assign</code>, ,  <code>move_construct</code>,        , ,    :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span>&gt;
<span class="hljs-title">using</span> <span class="hljs-title">select_move_construct</span> = <span class="hljs-title">select_copy_construct</span>&lt;T,
  conditional_t&lt;MoveConstructible&lt;T&gt;,
    move_construct&lt;Base&gt;
  &gt;
&gt;;</span><font></font>
<font></font>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span>&gt;
<span class="hljs-title">using</span> <span class="hljs-title">select_copy_assign</span> = <span class="hljs-title">select_move_construct</span>&lt;T,
  conditional_t&lt;CopyAssignable&lt;T&gt; &amp;&amp; CopyConstructible&lt;T&gt;,
    copy_assign&lt;Base&gt;
    delete_copy_assign&lt;Base&gt;
  &gt;
&gt;;</span></code></pre><br>
<p>, <code>move_assign</code>  <code>copy_assign</code>, <code>optional_base</code>   ,    assignment   <code>construct</code>  <code>assign</code>,  <code>optional</code>   <code>select_move_assign&lt;T, optional_base&lt;T&gt;&gt;</code>.</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span>&gt;
<span class="hljs-title">using</span> <span class="hljs-title">select_move_assign</span> = <span class="hljs-title">select_copy_assign</span>&lt;T, ...&gt;;</span><font></font>
<font></font>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">optional_base</span> {</span><font></font>
  ...<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">construct</span><span class="hljs-params">(optional_base <span class="hljs-keyword">const</span>&amp;)</span>  <span class="hljs-title">noexcept</span><span class="hljs-params">(NothrowCopyConstructible&lt;T&gt;)</span></span>;
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">construct</span><span class="hljs-params">(optional_base &amp;&amp;)</span>      <span class="hljs-title">noexcept</span><span class="hljs-params">(NothrowMoveConstructible&lt;T&gt;)</span></span>;
  <span class="hljs-function">optional_base&amp; <span class="hljs-title">assign</span><span class="hljs-params">(optional_base &amp;&amp;)</span>       <span class="hljs-title">noexcept</span><span class="hljs-params">(...)</span></span>;
  <span class="hljs-function">optional_base&amp; <span class="hljs-title">assign</span><span class="hljs-params">(optional_base <span class="hljs-keyword">const</span> &amp;)</span>  <span class="hljs-title">noexcept</span><span class="hljs-params">(...)</span></span>;<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">optional</span> :</span> select_move_assign&lt;T, optional_base&lt;T&gt;&gt; {<font></font>
  ...<font></font>
};</code></pre><br>
<p>,      :<br>
<code>optional&lt;unique_ptr&gt;</code>   <code>deleted_copy_construct</code>,  <br>
<code>move_construct</code>   .  !</p><br>
<pre><code class="cpp hljs">optional&lt;<span class="hljs-built_in">unique_ptr</span>&lt;<span class="hljs-keyword">int</span>&gt;&gt;<font></font>
  : deleted_copy_construct&lt;...&gt;<font></font>
    : move_construct&lt;...&gt;<font></font>
      : deleted_copy_assign&lt;...&gt;<font></font>
        : move_assign&lt;...&gt;<font></font>
          : optional_base&lt;<span class="hljs-built_in">unique_ptr</span>&lt;<span class="hljs-keyword">int</span>&gt;&gt;</code></pre><br>
<p>      :  <code>optional</code>   <code>TriviallyCopyable</code>    <code>TriviallyCopyable</code>.</p><br>
<p>  <code>TriviallyCopyable</code>?  ,  <code>T</code>  <code>TriviallyCopyable</code>,   <br>
   <code>memcpy</code>.    ,          .</p><br>
<p> ,            , ,  .    <code>resize</code>  <code>vector</code> <code>TriviallyCopyable</code> ,              <code>memcpy</code>,       ,   .  ,  ,    .</p><br>
<p>     <code>TriviallyCopyable</code>, ,     <code>static_assert</code>',    copy-move     :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">optional</span> :</span> select_move_assign&lt;T, optional_base&lt;T&gt;&gt; {...};<font></font>
<font></font>
<span class="hljs-keyword">static_assert</span>(TriviallyCopyable&lt;optional&lt;<span class="hljs-keyword">int</span>&gt;&gt;);<font></font>
<font></font>
<span class="hljs-keyword">static_assert</span>(TriviallyCopyConstructible&lt;optional&lt;<span class="hljs-keyword">int</span>&gt;&gt;);
<span class="hljs-keyword">static_assert</span>(TriviallyMoveConstructible&lt;optional&lt;<span class="hljs-keyword">int</span>&gt;&gt;);
<span class="hljs-keyword">static_assert</span>(TriviallyCopyAssignable   &lt;optional&lt;<span class="hljs-keyword">int</span>&gt;&gt;);
<span class="hljs-keyword">static_assert</span>(TriviallyMoveAssignable   &lt;optional&lt;<span class="hljs-keyword">int</span>&gt;&gt;);
<span class="hljs-keyword">static_assert</span>(TriviallyDestructible     &lt;optional&lt;<span class="hljs-keyword">int</span>&gt;&gt;);</code></pre><br>
<p>     <code>static_assert</code>' .  ,   ,      .   <code>optional</code> —  <code>aligned_storage</code>,  ,  ,   ,  <code>TriviallyCopyable</code>.</p><br>
<p>   ,          .       ,     <code>TriviallyCopyable</code>.</p><br>
<p> ,      .     <code>select_copy_construct</code>:</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span>&gt;
<span class="hljs-title">using</span> <span class="hljs-title">select_copy_construct</span> = <span class="hljs-title">conditional_t</span>&lt;CopyConstructible&lt;T&gt;,
  copy_construct&lt;Base&gt;
  deleted_copy_construct&lt;Base&gt;
&gt;;</span></code></pre><br>
<p> <code>CopyContructible</code>    <code>copy_construct</code>,      <code>if</code>  compile-time:   <code>CopyContructible</code>  <code>TriviallyCopyContructible</code>,     <code>Base</code>.</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span>&gt;
<span class="hljs-title">using</span> <span class="hljs-title">select_copy_construct</span> = <span class="hljs-title">conditional_t</span>&lt;CopyConstructible&lt;T&gt;,
  conditional_t&lt;TriviallyCopyConstructible&lt;T&gt;,
    Base,
    copy_construct&lt;Base&gt;
  &gt;,
  deleted_copy_construct&lt;Base&gt;
&gt;;</span></code></pre><br>
<p>,     copy .        ,    <code>select_destruct</code>  .    <code>int</code>   ,  -     - ,    .</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span>&gt;
<span class="hljs-title">using</span> <span class="hljs-title">select_destruct</span> = <span class="hljs-title">conditional_t</span>&lt;TriviallyDenstructible&lt;T&gt;,
    Base,
    destruct&lt;Base&gt;
  &gt;
&gt;;</span></code></pre><br>
<p> ,     ,    .  , ,  :</p><br>
<pre><code class="cpp hljs">optional&lt;<span class="hljs-built_in">unique_ptr</span>&lt;<span class="hljs-keyword">int</span>&gt;&gt;<font></font>
  : deleted_copy_construct&lt;...&gt;<font></font>
    : move_construct&lt;...&gt;<font></font>
      : deleted_copy_assign&lt;...&gt;<font></font>
        : move_assign&lt;...&gt;<font></font>
          : destruct&lt;optional_base&lt;<span class="hljs-built_in">unique_ptr</span>&lt;<span class="hljs-keyword">int</span>&gt;&gt;&gt;<font></font>
            : optional_base&lt;<span class="hljs-built_in">unique_ptr</span>&lt;<span class="hljs-keyword">int</span>&gt;&gt;</code></pre><br>
<p> ,  C++17   <code>optional</code>      7;      :    <code>operation</code>, <code>deleted_operation</code>   <code>select_operation</code>;   <code>construct</code>  <code>assign</code>   .  ,    .</p><br>
<p>    -   .      .        :   deleted.</p><br>
<p> ,       <code>noexcept</code> .<br>
 ,   ,   ,    <code>trivial</code> , <code>noexcept</code>         .   ,   ,    <code>trivial</code>  <code>noexcept</code>,   <code>noexcept</code> ,    <code>deleted</code>.           .        ,     ,    .</p><br>
<p>         type trait,  ,        . , , copy :  <code>deleted</code>  ,  <code>nothrow</code>  ,    ?</p><br>
<p>  ,            - special member, ,    ,    ,     :</p><br>
<ul>
<li>  ,    <code>deleted</code>,   <code>= delete</code>      <code>deleted_copy_construct</code>;</li>
<li>     ,     <code>copy_construct</code>,   c  noexcept ;</li>
<li>,   ,     ,  .</li>
</ul><br>
<p>             .</p><br>
<h2 id="realizaciya-klassa-optional-v-c20">  optional  C++20</h2><br>
<p>  C++20   <code>optional</code>   copy ?<br>
  :</p><br>
<ul>
<li>  <code>T</code>  <code>CopyConstructible</code>,     <code>deleted</code>;</li>
<li>  <code>TriviallyCopyConstructible</code>,   ;</li>
<li>       <code>noexcept</code> .</li>
</ul><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">optional</span> {</span><font></font>
  ...<font></font>
  optional(optional <span class="hljs-keyword">const</span> &amp;) <span class="hljs-keyword">requires</span>(!CopyConstructible&lt;T&gt;) = <span class="hljs-keyword">delete</span>;          <span class="hljs-comment">// #1</span>
  optional(optional <span class="hljs-keyword">const</span> &amp;) <span class="hljs-keyword">requires</span>(TriviallyCopyConstructible&lt;T&gt;) = <span class="hljs-keyword">default</span>; <span class="hljs-comment">// #2</span>
  optional(optional <span class="hljs-keyword">const</span> &amp;) <span class="hljs-keyword">noexcept</span>(NothrowCopyConstructible&lt;T&gt;) {...}        <span class="hljs-comment">// #3</span><font></font>
  ...<font></font>
  ~optional() <span class="hljs-keyword">requires</span>(TriviallyDestructible&lt;T&gt;) = <span class="hljs-keyword">default</span>;<font></font>
  ~optional() <span class="hljs-keyword">noexcept</span>(NothroeDestructible&lt;T&gt;) {...}<font></font>
};</code></pre><br>
<p> ,   . -,     ,      <code>T</code>  requires clause      <code>false</code>.    <code>requires(false)</code>,   ,      overload resolution.     ,        <code>requires(true)</code>,             .<br>
        ,    .</p><br>
<p>  requires clause    <code>= delete</code>:</p><br>
<ul>
<li>  <code>= delete</code>   overload resolution,     ,     ,     deleted .</li>
<li>  <code>requires(false)</code>     overload resolution.</li>
</ul><br>
<p>  ,     copy ,  ,    requires clause.       .</p><br>
<p> ,      . !    C++    ,   ?  , , .        ,   ,    ,     .   ,   ,     ,      , ,   <code>optional</code> .</p><br>
<p>,       ,  GCC   internal compiler error,  Clang    .   ,   .     ,  .</p><br>
<p> ,   ,       <code>optional</code>  C++20.  ,   ,   C++17.</p><br>
<h1 id="alternativa-aligned_storage-i-aligned_union"> aligned_storage  aligned_union</h1><br>
<p>  :   <code>aligned_storage</code>         <code>reinterpret_cast</code>,  <code>reinterpret_cast</code>    constexpr . ,  compile-time  <code>optional</code>   ,         compile-time.    STL   <code>aligned_storage</code>   <code>optional</code>    <code>aligned_union</code>   <code>variant</code>. ,  ,     STL  Boost    <code>optional</code>  <code>variant</code> .     <code>variant</code>,    :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">bool</span> all_types_are_trivially_destructible, <span class="hljs-keyword">typename</span>...&gt;
<span class="hljs-class"><span class="hljs-keyword">class</span> _<span class="hljs-title">Variant_storage_</span>;</span><font></font>
<font></font>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span>... _Types&gt; <span class="hljs-keyword">using</span> _Variant_storage = _Variant_storage_&lt;<font></font>
  conjunction_v&lt;is_trivially_destructible&lt;_Types&gt;...&gt;,<font></font>
  _Types...<font></font>
&gt;;<font></font>
<font></font>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> _First, <span class="hljs-keyword">typename</span>... _Rest&gt;
<span class="hljs-class"><span class="hljs-keyword">class</span> _<span class="hljs-title">Variant_storage_</span>&lt;true, _First, _Rest...&gt; {</span>
  <span class="hljs-keyword">union</span> {
    <span class="hljs-keyword">remove_const_t</span>&lt;First&gt; _Head;<font></font>
    _Variant_storage&lt;_Rest...&gt; _Tail;<font></font>
  };<font></font>
};</code></pre><br>
<p>     <code>variant</code>.    <code>_Variant_storage_</code>,  , -, ,    <code>variant</code>,  -,    .  ,    <code>trivially_destructible</code>?     type alias,       .      <code>_Variant_storage_</code>  ,    <code>true</code>    <code>false</code>. ,   <code>true</code>,  .      <code>trivially_destructible</code>,     union     <code>Variant</code>'  .</p><br>
<p> ,  ,   ,  ,    .     type alias  <code>_Variant_storage</code>.      :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span>... _Types,
         <span class="hljs-keyword">bool</span> = conjunction_v&lt;is_trivially_destructible&lt;_Types&gt;...&gt;<font></font>
  &gt;<font></font>
class _Variant_storage_;</code></pre><br>
<p>       .        ,   variadic template    . ,        ,            ,          <code>_Types</code>.   C++17  ,   .</p><br>
<p> C++20        ,<br>
    ,      <br>
requires clause.        C++20    requires clause:</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span>... _Types&gt;
<span class="hljs-class"><span class="hljs-keyword">class</span> _<span class="hljs-title">Variant_storage_</span>;</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> _First, <span class="hljs-keyword">typename</span>... _Rest&gt;
  <span class="hljs-title">requires</span><span class="hljs-params">(TriviallyDestructible&lt;_First&gt; &amp;&amp; ... &amp;&amp; TriviallyDestuctible&lt;_Rest&gt;)</span>
class _Variant_storage_&lt;_First, _Rest...&gt; </span>{
  <span class="hljs-keyword">union</span> {
    <span class="hljs-keyword">remove_const_t</span>&lt;_First&gt; _Head;<font></font>
    _Variant_storage_&lt;_Rest...&gt; _Tail<font></font>
  };<font></font>
};</code></pre><br>
<p>   <code>_Variant_storage_</code> ,     <code>TriviallyDestructible</code>.  ,       requires clause   ,   ,       .</p><br>
<h1 id="ispolzovanie-requires-clause-dlya-template-type-alias"> requires clause  template type alias</h1><br>
<p>,     requires clause   template type alias.      C++20  -  <code>enable_if</code>,         :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">bool</span> condition, <span class="hljs-keyword">typename</span> T = <span class="hljs-keyword">void</span>&gt;
  <span class="hljs-keyword">requires</span> condition
<span class="hljs-keyword">using</span> <span class="hljs-keyword">enable_if_t</span> = T;</code></pre><br>
<h1 id="kod-kotoryy-ne-podderzhit-ni-odin-kompilyator">,      </h1><br>
<p> ,         .       :</p><br>
<pre><code class="cpp hljs"><span class="hljs-comment">// Equivalent, but functionally not equivalent</span>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-keyword">enable_if_t</span>&lt;<span class="hljs-params">(<span class="hljs-keyword">sizeof</span>(T) &lt; <span class="hljs-number">239</span>)</span>&gt; <span class="hljs-title">f</span><span class="hljs-params">()</span></span>;
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-keyword">enable_if_t</span>&lt;<span class="hljs-params">(<span class="hljs-keyword">sizeof</span>(T) &gt; <span class="hljs-number">239</span>)</span>&gt; <span class="hljs-title">f</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
<span class="hljs-comment">// Not equivalent</span>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-title">requires</span><span class="hljs-params">(<span class="hljs-keyword">sizeof</span>(T) &lt; <span class="hljs-number">239</span>)</span> <span class="hljs-keyword">void</span> <span class="hljs-title">f</span><span class="hljs-params">()</span></span>;
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-title">requires</span><span class="hljs-params">(<span class="hljs-keyword">sizeof</span>(T) &gt; <span class="hljs-number">239</span>)</span> <span class="hljs-keyword">void</span> <span class="hljs-title">f</span><span class="hljs-params">()</span></span>;</code></pre><br>
<p>      ,     <code>enable_if</code>      .    ?     <code>f()</code>:   <code>enable_if</code>,      ,  239, , ,  ,  239.       ,     :</p><br>
<ul>
<li>  ,      ,     template type alias',      «void f(); void f();</li>
<li>  ,    SFINAE, ,      ,     .</li>
</ul><br>
<p>,     <code>enable_if</code>,      ,          <code>size &lt; 239</code>,      <code>size &gt; 239</code>.      ,            .      ,      <code>f()</code>   .       requires clause.    —   ,      .</p><br>
<blockquote>       —  ,      .      C++ Russia 2019 Piter,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">«:   core language»</a>.     , , :   reachable entity      visible,     ADL,   entities  internal linkage    .   ,    C++ Russia       (JetBrains)   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">«  ++20 —   ?»</a></blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja467281/index.html">ロシアのデータ科学者の肖像。事実のみ</a></li>
<li><a href="../ja467283/index.html">SQLとNoSQLの違いを祖母に説明する方法</a></li>
<li><a href="../ja467289/index.html">モノリシックなUnixライクなOSの開発-GDT＆IDT（5）</a></li>
<li><a href="../ja467291/index.html">創造性のためのiOS：描画</a></li>
<li><a href="../ja467295/index.html">Androidで待望のビューバインディング</a></li>
<li><a href="../ja467301/index.html">HitmanでのAIの仕組み（2016）</a></li>
<li><a href="../ja467303/index.html">最年少のPSBプログラマーの物語：ハッカソンは銀行への扉になりました</a></li>
<li><a href="../ja467305/index.html">都市がスマートなとき：メガシティの体験</a></li>
<li><a href="../ja467313/index.html">PostgreSQLとMySQL間のクロスレプリケーション</a></li>
<li><a href="../ja467317/index.html">ソフトバンクが世界を飲み込んだ方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>