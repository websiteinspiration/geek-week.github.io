<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💤 💖 😄 Javaには不変のコレクションはありません-今もこれまでも 🚵 🦄 🌨️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="みなさん、こんにちは！
 
 今日、あなたの注意は、Javaの基本的な問題の1つである可変性についての思慮深く書かれた記事の翻訳に招待されています。素材はニコライパログのブログから引用されました。ニコラス自身の特徴は、ハブレに関するJUG.ru社のブログからの抜粋です。この一節全体を引用しましょう。...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Javaには不変のコレクションはありません-今もこれまでも</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/470149/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">みなさん、こんにちは！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今日、あなたの注意は、Javaの基本的な問題の1つである可変性についての思慮深く書かれた記事の翻訳に招待されています。素材はニコライパログのブログから引用されました。ニコラス自身の特徴</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ハブレに関するJUG.ru社</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">のブログからの抜粋</font></a><font style="vertical-align: inherit;">です。この一節全体を引用しましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7l/mh/iy/7lmhiypudt5z093eme-wrlhzygq.jpeg"><br>
<blockquote>  —  - ,      Java.       Oracle,       .    - ,  .      Java,     .            .      .     ,    - .       ,  .          ,       .  .  «The Java Module System»   Manning,       codefx.org,      .      ,  . ,   .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レポート</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
読んで投票します。</font><font style="vertical-align: inherit;">特に投稿が好きな方-元の投稿に対する読者のコメントを確認することもお勧めします。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ボラティリティは悪いですよね？</font><font style="vertical-align: inherit;">したがって、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不変性は良好</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">不変性が特に有益な主なデータ構造はコレクションです。Javaでは、これはリスト（</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、セット（</font></font><code>Set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、および辞書（</font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）です。</font><font style="vertical-align: inherit;">ただし、JDKには不変（または変更不可）のコレクションが付属していますが、型システムはこれについて何も認識していません。</font><font style="vertical-align: inherit;">JDKはなく</font></font><code>ImmutableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Guavaのこのタイプは私にはまったく役に立たないようです。</font><font style="vertical-align: inherit;">しかし、なぜ？</font></font><code>Immutable...</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この混合物に</font><font style="vertical-align: inherit;">加え</font><font style="vertical-align: inherit;">て、そうだと言って</font><font style="vertical-align: inherit;">みません</font><font style="vertical-align: inherit;">か？</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不変コレクションとは何ですか？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JDK用語では、「</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不変</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」および「</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変更</font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">不可</font></i><font style="vertical-align: inherit;">」</font><font style="vertical-align: inherit;">という単語の意味は</font><font style="vertical-align: inherit;">、過去数年で変化しています。当初、「変更不可」は、可変性（可変性）を許可しないインスタンスと呼ばれていました。彼は、メソッドの変更に応じてそれを破棄しました</font></font><code>UnsupportedOperationException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。ただし、別の方法で変更することができます。これは、変更可能なコレクションの単なるラッパーであったためと考えられます。これらの表現は、メソッドに反映され</font></font><code>Collections::unmodifiableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>unmodifiableSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">かつ</font></font><code>unmodifiableMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も、および</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それらのJavaDoc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初は、「</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不変</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」</font><font style="vertical-align: inherit;">という用語は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java 9コレクションのファクトリメソッド</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">によって返されるコレクションを指し</font><font style="vertical-align: inherit;">ます。コレクション自体はどのような方法でも変更できませんでした（はい、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リフレクション</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、それは考慮されていません）、したがって、彼らは自分の名前を正当化するようです。悲しいかな、このためしばしば混乱が生じます。不変コレクションのすべての要素を画面に表示するメソッドがあるとします。常に同じ結果が得られますか？はい？か否か？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すぐに「</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いいえ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」と</font><font style="vertical-align: inherit;">答え</font><i><font style="vertical-align: inherit;">なかった</font></i><font style="vertical-align: inherit;">場合は、ここでどのような混乱が発生する可能性があるのか​​がわかったことを意味します。 " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シークレットエージェントの不変のコレクション</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "-一見気の利いたように聞こえる " </font><i><font style="vertical-align: inherit;">シークレットエージェントの</font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不変の不変コレクション</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「しかし、これら2つのエンティティは同一ではない可能性があります。不変コレクションは、挿入/削除/クリーンオペレーションなどを使用して編集することはできませんが、シークレットエージェントが変更可能である場合（スパイ映画のキャラクターの特性が非常に悪いため、信じられないほど）、それはそれが意味することではありませんシークレットエージェントのコレクション全体は変更できません。したがって、現在、このようなコレクション</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に変更</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不可で</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不変</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">では</font><font style="vertical-align: inherit;">ない</font><font style="vertical-align: inherit;">名前を付ける方向に変化があり、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaDocの新版</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でその</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">仕様</font></a><font style="vertical-align: inherit;">が定められてい</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事で説明する不変のコレクションには、変更可能な要素が含まれている場合があります。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
個人的には、このような用語の改訂は好きではありません。</font><font style="vertical-align: inherit;">私の意見では、「不変のコレクション」という用語は、コレクション自体が変更されないことを意味するだけであり、コレクションに含まれる要素を特徴づけるべきではありません。</font><font style="vertical-align: inherit;">この場合、もう1つ良い点があります。Javaエコシステムの「不変性」という用語は、完全なナンセンスにはなりません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何らかの方法で、この記事では</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不変コレクション</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">について説明します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コレクションに含まれるインスタンスは、設計段階で決定されます </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらのコピー-均等量、削減も追加もしない </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらの要素の可変性に関しては、何も述べられていません。 </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、不変のコレクションを追加する練習をすることにします。正確には-不変のリスト。リストについて述べられることはすべて、他のタイプのコレクションにも等しく適用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不変コレクションの追加を始めましょう！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インターフェース</font></font><code>ImmutableList </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を作成して、それを</font><font style="vertical-align: inherit;">作成してみましょう</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。スーパータイプまたはサブタイプ？最初のオプションについて考えましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sc/uv/yl/scuvyloeubhj5-wq36b7nzuzdu8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
美しい、</font></font><code>ImmutableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変更方法がないので、それを使用することは常に安全ですよね？そう？！いいえ。</font></font><br>
<br>
<pre><code class="java hljs">List&lt;Agent&gt; agents = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
<span class="hljs-comment">// ,  `List`  `ImmutableList`</span><font></font>
ImmutableList&lt;Agent&gt; section4 = agents;<font></font>
<span class="hljs-comment">//   </span><font></font>
section4.forEach(System.out::println);<font></font>
 <font></font>
<span class="hljs-comment">//    `section4`</span>
agents.add(<span class="hljs-keyword">new</span> Agent(<span class="hljs-string">"Motoko"</span>);
<span class="hljs-comment">//  "Motoko" – ,      ?!</span>
section4.forEach(System.out::println);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例は、そのような完全に不変ではないリストをAPIに転送することが可能であることを示しています。その操作は、不変性に基づいて構築でき、したがって、このタイプの名前が示唆するすべての保証を無効にします。</font><font style="vertical-align: inherit;">災害につながる可能性のあるレシピを以下に示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OK、次に</font></font><code>ImmutableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">展開し</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">多分？</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fr/sq/_r/frsq_rgj7rt0mp3u0f--zn8jlrs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
APIが不変のリストを期待している場合、そのようなリストを受け取りますが、次の2つの欠点があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不変リストは引き続き変更メソッドを提供する必要があり（スーパータイプで定義されているため）、可能な唯一の実装は例外をスローします </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インスタンス</font></font><code>ImmutableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もインスタンスで</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あり、そのような変数を割り当てるとき、そのような引数の形式で渡すとき、またはこの型を返すとき、可変性が許可されていると想定するのは論理的です。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、それは</font></font><code>ImmutableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ローカルでしか</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">できない</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ことがわかります。これ</font><font style="vertical-align: inherit;">は、APIの境界を通過する</font><font style="vertical-align: inherit;">ため、超人的なレベルの予防策が必要になるか、実行時に爆発するためです。</font><font style="vertical-align: inherit;">これは</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エキスパンド</font><font style="vertical-align: inherit;">ほど悪いことではありません</font></font><code>ImmutableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が、そのようなソリューションは理想からほど遠いです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これはまさにそのタイプだと私が考えていたものです</font></font><code>ImmutableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グアバからは実質的に役に立たない。</font><font style="vertical-align: inherit;">これは優れたコードサンプルであり、ローカルの不変リストを操作するときに非常に信頼性があります（そのため、私は積極的に使用しています）が、それに頼ることで、壁が不変の型で構成されている、難攻不落の保証されたコンパイル済みの城塞を簡単に超えることができます-これだけ不変タイプは、それらの可能性を完全に明らかにできます。</font><font style="vertical-align: inherit;">これは何もないよりはましですが、JDKソリューションとしては非効率的です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
場合</font></font><code>ImmutableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、それは展開できない</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、と回避策がまだ動作しません、そして、どのようにそれが仕事に行われることになっていますか？</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不変性は機能です</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不変タイプを追加する最初の2つの試みで遭遇した問題は、不変性は単に何かが存在しないことであるという誤解</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でした</font></font><code>ImmutableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">それを取得し、そこから変更コードを削除し、取得し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">しかし、実際には、これらすべてがそのように機能するわけではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
から変更メソッドを単に削除すると</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、読み取り専用リストが取得されます。</font><font style="vertical-align: inherit;">または、上記で定式化された用語に準拠して、それを呼び出す</font></font><code>UnmodifiableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ことができます。変更することはできますが、変更しないだけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この画像に次の2つを追加できます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">適切なメソッドを追加することで変更可能にすることができます </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">適切な保証を追加することで不変にできます。</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不変性とは、変異性がないことではありませんが、変更がないことを保証します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、両方のケースで完全な機能について話していることを理解することが重要です。不変性は、変更がないことではなく、変更がないことを保証します。既存の機能は必ずしも有効に使用されるものであるとは限りません。また、コードで何か問題が発生しないことを保証することもできます。この場合、たとえば、スレッドセーフティについて考えます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
明らかに、可変性と不変性は互いに矛盾するため、上記の2つの継承階層を同時に使用することはできません。タイプは他のタイプから機能を継承するため、どのようにカットしても、一方のタイプが他方から継承すると、両方の機能が含まれます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
とても良い</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>ImmutableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">お互いに拡張することはできません。しかし、私たちはでの作業によってここに運ばれまし</font></font><code>UnmodifiableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">た。実際に、両方のタイプが同じAPI、つまり読み取り専用であることが判明しました。つまり、拡張する必要があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bd/dp/7b/bddp7bjb5e9m6sddvp4slse0yfi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
正確にこれらの名前を呼ぶことはしませんが、この種の階層は妥当です。たとえば、Scalaでは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それだけです</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。違いは、名前を付けた共有スーパータイプは</font></font><code>UnmodifiableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、変更されたコレクションを返し、元のコレクションには手を加えない変更メソッドを定義することです。したがって、不変のリストは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">永続的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">であることがわかり、変更可能なバリアントに2組の変更メソッドを提供します-変更されたコピーを受信するために継承され、変更が加えられます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Javaはどうですか？</font><font style="vertical-align: inherit;">新しいスーパータイプと兄弟をそれに追加することにより、そのような階層を近代化することは可能ですか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変更不可および変更不可のコレクションを改善することは可能ですか？</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、タイプを追加するには問題がない</font></font><code>UnmodifiableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>ImmutableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し、上記のように、継承階層を作成します。</font><font style="vertical-align: inherit;">問題は、短中期的には実質的に役に立たなくなることです。</font><font style="vertical-align: inherit;">説明させてください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クールな事は持っている</font></font><code>UnmodifiableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>ImmutableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の種類など-のAPIは明らかに、彼らが必要なものを表現し、彼らが提供できるようになります。その場合には。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">payAgents</span><span class="hljs-params">(UnmodifiableList&lt;Agent&gt; agents)</span> </span>{
    <span class="hljs-comment">//      , </span>
    <span class="hljs-comment">//        </span><font></font>
}<font></font>
 <font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendOnMission</span><span class="hljs-params">(ImmutableList&lt;Agent&gt; agents)</span> </span>{
    <span class="hljs-comment">//   ( ),</span>
    <span class="hljs-comment">//  ,    </span><font></font>
}<font></font>
 <font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">downtime</span><span class="hljs-params">(List&lt;Agent&gt; agents)</span> </span>{
    <span class="hljs-comment">//       ,</span>
    <span class="hljs-comment">//        ,     </span><font></font>
}<font></font>
 <font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> UnmodifiableList&lt;Agent&gt; <span class="hljs-title">teamRoster</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">//   ,     ,</span>
    <span class="hljs-comment">//      ,     - </span><font></font>
}<font></font>
 <font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> ImmutableList&lt;Agent&gt; <span class="hljs-title">teamOnMission</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">//    ,     </span><font></font>
}<font></font>
 <font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Agent&gt; <span class="hljs-title">team</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">//    ,    ,</span>
    <span class="hljs-comment">//       </span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、プロジェクトを最初から開始しない限り、そのような機能があり、次のようになります。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-comment">//   ,  `Iterable&lt;Agent&gt;`</span>
<span class="hljs-comment">//  ,   ,        </span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">payAgents</span><span class="hljs-params">(List&lt;Agent&gt; agents)</span> </span>{ }<font></font>
 <font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendOnMission</span><span class="hljs-params">(List&lt;Agent&gt; agents)</span> </span>{ }<font></font>
 <font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">downtime</span><span class="hljs-params">(List&lt;Agent&gt; agents)</span> </span>{ }<font></font>
 <font></font>
<span class="hljs-comment">//      , </span>
<span class="hljs-comment">//    ,  `List`    </span>
<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Agent&gt; <span class="hljs-title">teamRoster</span><span class="hljs-params">()</span> </span>{ }<font></font>
 <font></font>
<span class="hljs-comment">// ,     `Stream&lt;Agent&gt;`</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Agent&gt; <span class="hljs-title">teamOnMission</span><span class="hljs-params">()</span> </span>{ }<font></font>
 <font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Agent&gt; <span class="hljs-title">team</span><span class="hljs-params">()</span> </span>{ }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは良いことではありません。私たちが紹介したばかりの新しいコレクションを役立てるためには、それらを使用する必要があります。 （ふw）。何にリファクタリング、それゆえ、似ている上にアプリケーション・コードを示している</font></font><code>UnmodifiableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し、</font><font style="vertical-align: inherit;">ここで提案さ</font></font><code>ImmutableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">れ、リストの上に示されたように、それは、実装することができます。古いコードと更新されたコードの相互作用を整理する必要がある場合の混乱と相まって、これは大きな作業の塊になる可能性がありますが、少なくとも実現可能であるようです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フレームワーク、ライブラリ、JDK自体はどうですか？ここではすべてが暗いようです。パラメータまたは戻り型を変更しよう</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とする</font></font><code>ImmutableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ことになる</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソースコードとの非互換性</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">つまり </font><font style="vertical-align: inherit;">これらの型は互いに関連していないため、既存のソースコードは新しいバージョンでコンパイルされません。</font><font style="vertical-align: inherit;">同様に、戻り値の型を</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいスーパータイプに変更</font></font><code>UnmodifiableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すると、コンパイルエラーが発生します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しいタイプの導入により、変更を加え、エコシステム全体で再コンパイルする必要があります。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、パラメーターの型をから</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">拡張しても</font><i><font style="vertical-align: inherit;">、バイトコードレベルでの非互換性の</font></i></font><code>UnmodifiableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原因となるため、問題が発生し</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ソースコードがメソッドを呼び出すと、コンパイラはこの呼び出しを次の方法でターゲットメソッドを参照するバイトコードに変換します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インスタンスがターゲットとして宣言されているクラスの名前 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド名</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドパラメータタイプ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返却メソッドタイプ</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッドのパラメーターまたは戻り値の型を変更すると、メソッドを参照するときにバイトコードが無効な署名を示します。その結果、実行中にエラーが発生し</font></font><code>NoSuchMethodError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。行った変更がソースコードと互換性がある場合（たとえば、戻り値の型を狭める、またはパラメーターの型を拡張することについて話している場合）、再コンパイルで十分です。ただし、新しいコレクションの導入など、広範囲にわたる変更では、すべてがそれほど単純ではありません。そのような変更を統合するには、Javaエコシステム全体を再コンパイルする必要があります。これは失われたビジネスです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
互換性を損なうことなくそのような新しいコレクションを利用する唯一の考えられる方法は、既存のメソッドをそれぞれ新しい名前で複製し、APIを変更して、古いバージョンを望ましくないものとしてマークすることです。</font><font style="vertical-align: inherit;">そのようなタスクがどれほど記念碑的で事実上無限であるか想像できますか？</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反射</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、不変のコレクション型はすばらしいものですが、JDKでこのようなものを見ることはほとんどありません。有能な実装で</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あり</font></font><code>ImmutableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、相互に拡張することはできません（実際、どちらも同じリストタイプ</font></font><code>UnmodifiableList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を読み取り専用に</font><font style="vertical-align: inherit;">拡張し</font><font style="vertical-align: inherit;">ます）。これにより、既存のAPIのそのようなタイプの実装が妨げられます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タイプ間の特定の関係のコンテキストの外では、既存のメソッドシグネチャの変更はバイトコードと互換性がないため、常に問題が発生します。それらが導入された場合、少なくとも再コンパイルが必要であり、これはJavaエコシステム全体に影響を与える壊滅的な変更です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、このようなことは決して起こらないと信じています。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja470129/index.html">宣言的なメモリ管理</a></li>
<li><a href="../ja470133/index.html">Prometheusでの時間参照によって歪ま​​ないメトリックを収集する方法</a></li>
<li><a href="../ja470135/index.html">プログラミングなしのインタラクティブなWebアプリケーション？かんたん！腕の中のマヴォ</a></li>
<li><a href="../ja470139/index.html">2ライフハック：Microsoft SQL Serverのクラシック検索の代替手段</a></li>
<li><a href="../ja470145/index.html">「注意してください、FAS！」：軍事チケットが広告で危険なのはなぜですか、なぜ数学を理解することが重要であり、裸の真実が常に必要かどうか</a></li>
<li><a href="../ja470153/index.html">データモデルディクショナリ</a></li>
<li><a href="../ja470155/index.html">Особенности национального распознавания образов</a></li>
<li><a href="../ja470159/index.html">素数生成</a></li>
<li><a href="../ja470165/index.html">...で割る哲学または狂人の告白</a></li>
<li><a href="../ja470167/index.html">主流になる前に科学に興味を持っていた人のための会議</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>