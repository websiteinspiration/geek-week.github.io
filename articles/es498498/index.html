<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∂üèø üí£ ü¶Ö Investigaci√≥n: ¬øqu√© es m√°s alto que las prioridades de subprocesos en Windows? üç∫ üë∂üèª üõ°Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Esta investigaci√≥n, como muchas otras, comenz√≥ con el hecho de que estaba haciendo mi propio negocio, no tratando de buscar problemas por m√≠ mismo. Es...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Investigaci√≥n: ¬øqu√© es m√°s alto que las prioridades de subprocesos en Windows?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498498/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta investigaci√≥n, como muchas otras, comenz√≥ con el hecho de que estaba haciendo mi propio negocio, no tratando de buscar problemas por m√≠ mismo. Esta vez, todo lo que hice fue abrir la tapa de la computadora port√°til e intent√© iniciar sesi√≥n en el sistema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por las primeras veces, cuando esto result√≥ en un retraso de veinte segundos, ignor√© el problema, esperando que se resolviera por s√≠ solo. Las siguientes veces pens√© en la investigaci√≥n, pero los problemas de rendimiento que surgen incluso antes de iniciar sesi√≥n son m√°s dif√≠ciles de resolver, y fui flojo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando me di cuenta de que estaba evitando cerrar la computadora port√°til porque ten√≠a miedo de estos retrasos demasiado frecuentes, me di cuenta de que era hora de hacerlo en serio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afortunadamente, recientemente arregl√© la </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">traza del</font></a><font style="vertical-align: inherit;"> b√∫fer de anillo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIforETW</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">haci√©ndolo confiable, as√≠ que lo comenc√© y comenc√© a esperar el pr√≥ximo evento de retraso. No tuve que esperar mucho. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Me tom√≥ varias veces lograr que el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ETW</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> me </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">siguiera</font></a><font style="vertical-align: inherit;"> completamente bien </font><font style="vertical-align: inherit;">. Y dado que este territorio no me era familiar, me llev√≥ un tiempo descubrir qu√© estaba sucediendo. Todav√≠a no entend√≠a completamente el problema, pero el 90% entend√≠a las razones de su aparici√≥n. Logr√© aprender mucho, incluidos algunos detalles nuevos sobre el planificador de Windows, y tambi√©n encontr√© una soluci√≥n absolutamente efectiva. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El rastro ideal que finalmente grab√© al cargar en Microsoft Windows Performance Analyzer (WPA) se ve as√≠:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/349/031/72d/34903172d4e4c5f85b33a02255942315.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eventos est√°ndar, ventanas en foco y uso de CPU</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Esta tabla y dos gr√°ficos contienen una tonelada de informaci√≥n. La tabla superior ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eventos gen√©ricos</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) muestra las pulsaciones de teclas registradas para UIforETW. Trat√© de presionar una tecla (c√≥digo de clave virtual 162) una vez por segundo hasta que aparezca un campo de ingreso de contrase√±a. Dado que estas 17 pulsaciones de teclas est√°n seleccionadas, en el gr√°fico a continuaci√≥n se muestran con l√≠neas azules verticales para una visualizaci√≥n simplificada del tiempo de ejecuci√≥n de eventos cr√≠ticos. El eje x representa el tiempo en segundos.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las barras horizontales en el gr√°fico superior ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ventana en foco</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) muestran qu√© proceso tiene foco durante este tiempo. </font><font style="vertical-align: inherit;">Hay seis procesos diferentes en total. </font><font style="vertical-align: inherit;">El per√≠odo de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seguimiento</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es el corto tiempo durante el cual se cerr√≥ la computadora port√°til. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El gr√°fico inferior muestra </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el uso de la CPU</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">La informaci√≥n se obtiene de los datos de cambio de contexto, por lo tanto, debe ser completamente precisa y completa. </font><font style="vertical-align: inherit;">En este seguimiento, un valor del 100% indica el momento en que se utilizaron los ocho procesadores l√≥gicos de mi computadora port√°til de cuatro hilos y ocho n√∫cleos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de recibir los datos de seguimiento, tuve que averiguar qu√© hace mi computadora port√°til en secreto cuando se cierra la cubierta y hasta el momento en que vuelvo al sistema.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tormenta antes de la calma</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como podemos ver, la computadora port√°til al comienzo de la traza de la computadora port√°til es relativamente simple, como deber√≠a ser. Entonces cerr√© su tapa. Esto parece haber causado un aumento en la actividad de la CPU y un cambio en el enfoque de las ventanas. </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Window in Focus</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cambi√≥ de UIforETW a Idle, luego a csrss, de nuevo a Idle, a LogonUI y luego a Idle. ¬øQuien lo hubiera pensado?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante este intervalo, la computadora port√°til realiz√≥ aproximadamente 17 segundos de procesamiento de CPU de varios tipos. Parte de esto es el trabajo necesario para apagar. Parte: estos son programas (incluidas las herramientas internas de Google) que est√°n registrados en el Programador de tareas para la ejecuci√≥n de "Cuando un usuario bloquea una estaci√≥n de trabajo", tiene sentido. Incluso me di cuenta de que se est√° trabajando para crear elementos de la interfaz de usuario para iniciar sesi√≥n cuando el usuario contin√∫a trabajando; debe estar preparado con anticipaci√≥n, ¬øverdad?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
17 segundos de CPU: un tiempo bastante largo para que la computadora port√°til se vaya a dormir. </font><font style="vertical-align: inherit;">Incluso en mi computadora port√°til con cuatro n√∫cleos y ocho hilos, el proceso lleva m√°s de cuatro segundos. </font><font style="vertical-align: inherit;">En la computadora port√°til de mi casa, lleva m√°s de 13 segundos de tiempo de CPU para conciliar el sue√±o, y casi todos pasan al c√≥digo de Windows. </font><font style="vertical-align: inherit;">¬øEl </font><font style="vertical-align: inherit;">servicio de pol√≠ticas de diagn√≥stico </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">realmente</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> necesita ejecutar un par de SruDbTableSearches antes de que la computadora port√°til pueda descansar? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creo que este trabajo excesivo al ir a dormir </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tambi√©n</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es </font><em><font style="vertical-align: inherit;">un</font></em><font style="vertical-align: inherit;"> problema, pero este no es </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> problema que estoy buscando. </font><font style="vertical-align: inherit;">As√≠ que decid√≠ darle la espalda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y solo mucho m√°s tarde me di cuenta de que fue durante este tiempo cuando se arrojaron los granos de destrucci√≥n de mi insecto ...</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dormir</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de bloquear la computadora port√°til, no hay actividad de la CPU. </font><font style="vertical-align: inherit;">En esta prueba en particular, la computadora port√°til se bloque√≥ durante unos 16 segundos.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despertar convulsivo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La actividad de la CPU durante la transici√≥n al sue√±o es incomparable con cuando comenz√≥ a despertar. </font><font style="vertical-align: inherit;">Durante este tiempo, mi computadora port√°til sobrecargada tom√≥ aproximadamente 172 segundos de tiempo de CPU (!!!) durante 22.6 segundos. </font><font style="vertical-align: inherit;">Esto es un mont√≥n de trabajo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uno de los misterios de este proceso es la ca√≠da del uso de la CPU a casi cero aproximadamente un segundo despu√©s del estallido inicial de actividad. </font><font style="vertical-align: inherit;">Este breve per√≠odo de inactividad parece bastante anormal, dado el caos que lo rodea. </font><font style="vertical-align: inherit;">Pero creo que esta caracter√≠stica no est√° relacionada con el problema, por lo que no le prest√© atenci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otro misterio es por qu√© </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tantos</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los programas cobran vida despu√©s de esta breve pausa. Es curioso que el intruso m√°s serio responsable de 31.6 de 172 segundos de la CPU fue Windows Performance Analyzer (WPA), el mismo programa que utilizo para analizar los rastros. Las tres copias que dej√© ejecut√°ndose est√°n trabajando duro para representar mi interfaz de usuario, a pesar de que a√∫n no es visible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, se producen patrones oscuros cuando se intenta inicializar dispositivos port√°tiles. KeStallExecutionProcessor es un ciclo de espera, y fue extra√±o ver que esta es la funci√≥n m√°s ejecutable de todo el sistema. ¬øEs un segundo ciclo de espera impar la √∫nica forma de iniciar el equipo? </font><font style="vertical-align: inherit;">¬øEs </font><font style="vertical-align: inherit;">realmente necesario pasar 700 ms de tiempo de CPU inicializando el </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mouse y el teclado</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? ¬øDeber√≠an Microsoft e Intel ignorar la recomendaci√≥n de Microsoft sobre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un m√°ximo de 50 microsegundos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ?</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fa7/c4e/cf4/fa7c4ecf4fe56c7c9014ee252f4557b0.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conductores de un ciclo de espera. </font><font style="vertical-align: inherit;">i8042prt.sys est√° escrito por Microsoft. </font><font style="vertical-align: inherit;">Los siguientes dos son creados por Intel. </font></font></i> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En √∫ltima instancia, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muchos</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> programas se </font><font style="vertical-align: inherit;">ejecutan activamente durante este tiempo </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">La mayor√≠a de ellos parecen estar enfrentando el mismo problema que WPA: est√°n desesperados por dibujar p√≠xeles en una pantalla oculta, y esto alude a un error de Windows. </font><font style="vertical-align: inherit;">Pero incluso sin este error explorer.exe y otros programas buscan activamente </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">algo</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que hacer. </font><font style="vertical-align: inherit;">Pero al final, aunque este uso excesivo de la CPU es una </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parte</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> necesaria </font><em><font style="vertical-align: inherit;">del</font></em><font style="vertical-align: inherit;"> problema, no es </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> problema en </font><em><font style="vertical-align: inherit;">s√≠</font></em><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">As√≠ que de nuevo dej√© de prestarle atenci√≥n.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atenci√≥n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al analizar los rastros, es importante saber cu√°ndo ocurren acciones importantes. La evidencia principal fueron los eventos de entrada, porque dej√© de hacer clic en el control despu√©s de que apareci√≥ el formulario de entrada de contrase√±a. Aqu√≠ est√°n las √∫ltimas tres pulsaciones de teclas de la tecla de control en forma aproximada en el </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cuadro Ventana en foco</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/158/50d/6f9/15850d6f9eecb243c2984cd4988c6bb1.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que los eventos cr√≠ticos est√°n recibiendo el foco de LockApp.exe, despu√©s de lo cual el foco obtiene LogonUI.exe casi instant√°neamente. </font><font style="vertical-align: inherit;">Presumiblemente, ingres√© la contrase√±a en LogonUI.exe (es conveniente que la traza no intercepte los eventos del teclado), despu√©s de lo cual el foco cambi√≥ brevemente al explorador y luego a UIforETW, desde donde comenc√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n parece que LogonUI.exe no puede enfocarse antes de LockApp.exe: este patr√≥n se repite en todos los rastros que estudi√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, despu√©s de m√°s de mil palabras dedicadas a resolver este enigma, finalmente tenemos una pregunta clara que podemos investigar: ¬øpor qu√© LockApp.exe se enfoca despu√©s de salir del tiempo de inactividad, lleva veinte segundos?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tenemos una pregunta? </font><font style="vertical-align: inherit;">Genial, respondamos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilizando los datos de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uso de CPU (Preciso)</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> obtenidos del cambio de contenido, </font><font style="vertical-align: inherit;">r√°pidamente descubr√≠ que dentro de veinte segundos despu√©s de despertar, LockApp.exe recibi√≥ menos de un milisegundo de tiempo de CPU, y durante m√°s de 14 segundos (de 35.158 sa 49.827 s) no funcion√≥ generalmente:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f50/5dc/954/f505dc954915bdbf5a857eac5c4303f4.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LockApp no ‚Äã‚Äãfunciona en absoluto durante mucho tiempo</font></font></i><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La documentaci√≥n sobre el significado de las columnas en las tablas de Uso de CPU (Preciso) est√° </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si un proceso o subproceso no se ha estado ejecutando durante alg√∫n tiempo y desea averiguar por qu√©, generalmente se pueden encontrar pistas importantes en el primer cambio de contexto despu√©s de una larga pausa, es decir, cambiar a 49.827 segundos de rastreo. </font><font style="vertical-align: inherit;">Reorden√© las columnas para mostrar m√°s datos de este cambio de contexto:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7f4/23d/7ca/7f423d7cad82b87f4c5556551b0e8fec.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LockApp est√° preparado pero no ejecutado. Extra√±o ...</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Cuenta, igual a 1 significa que miramos los datos para un solo cambio de contexto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tiempo desde el √∫ltimo, igual a 38,2 millones de microsegundos, significa que este hilo no se ejecutar√° en 38,2 segundos. Esto en s√≠ mismo no es ni bueno ni malo. Los flujos inactivos ahorran energ√≠a, y al final la computadora port√°til estuvo en un sue√±o por alg√∫n tiempo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El tiempo de conexi√≥n simplemente nos dice cu√°ndo encaja exactamente el hilo en la CPU, cuando el contexto cambia a ese hilo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y ahora vamos a la columna Listo. Nos dice cu√°nto tiempo el hilo estuvo </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">listo</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para ejecutarse, pero no se ejecut√≥. En otras palabras, este hilo estaba </font><font style="vertical-align: inherit;">esperando </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">algo</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (bloqueo, manejo) y esto </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es algo</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fue liberado o iniciado, pero el hilo a√∫n </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no se ejecut√≥</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> durante 19.493 segundos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para comprender mejor la columna </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listo (nosotros)</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , puede echar un vistazo a la columna </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tiempo (s) listo (s)</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nos dice cu√°ndo est√° preparada la corriente. Vemos que durante 30.333 segundos de rastreo, este hilo se prepar√≥ para la ejecuci√≥n, pero no se ejecut√≥ hasta 49.827 segundos. Esto parece ser importante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta disposici√≥n de columnas nos muestra el mismo cambio de contexto:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/07f/b5c/c85/07fb5cc85d3dfc066a6c3cbd508ef7d7.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">New Thread Stack y Ready Thread Stack</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Entonces, este hilo (que el New Thread Stack esperaba que fuera NtWaitForWorkViaWorkerFactory) recibi√≥ la orden de despertarse (el proceso del sistema llam√≥ a KeSetEvent) poco despu√©s de que abr√≠ la tapa del port√°til, durante 30.333 segundos de rastreo. </font><font style="vertical-align: inherit;">Pero comenz√≥ no entonces (que ser√≠a "bueno"), sino despu√©s de 19.494 s, y esto es malo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo general, cuando llevo a cabo un an√°lisis de expectativas de este tipo, paso mucho tiempo averiguando por qu√© la transmisi√≥n est√° esperando y qu√© hizo que no estuviera lista. </font><font style="vertical-align: inherit;">Pero esta era la primera vez que hac√≠a un an√°lisis de expectativas, en el que no era importante, y la pregunta era por qu√© este hilo ya no se ejecuta.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Casos ...</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La mayor√≠a de las personas no pasan tanto tiempo estudiando los rastros de ETW, por lo que se necesita una explicaci√≥n aqu√≠. </font><font style="vertical-align: inherit;">Esto es </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muy</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> extra√±o </font><font style="vertical-align: inherit;">Si el hilo est√° listo, generalmente se inicia instant√°neamente o despu√©s de unos pocos milisegundos. </font><font style="vertical-align: inherit;">La disponibilidad de la secuencia, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como su nombre lo indica</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , significa que la secuencia est√° lista para ejecutarse y que casi nada puede interferir con ella. </font><font style="vertical-align: inherit;">Pero descubramos qu√© puede evitar la ejecuci√≥n de un hilo terminado.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarea prioritaria</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al principio suger√≠ que este es un caso simple de "hambre" de la CPU. Docenas de procesos requieren tiempo de CPU, y debido a esto, LockApp no ‚Äã‚Äãobtiene el correcto hasta que la carga disminuye. Sin embargo, esta teor√≠a </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no se</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> corresponde con los s√≠ntomas, ya que el proceso LockApp podr√≠a tomar unos 18 segundos </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">incluso</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sin obtener tiempo de CPU.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La teor√≠a del hambre de la CPU es buena porque es verificable. Pude aumentar la prioridad del proceso LockApp usando el Administrador de tareas (durante uno de los breves per√≠odos en que no fue suspendido por el sistema UWP), por lo tanto, en la traza final que utilic√© para esta publicaci√≥n, LockApp se ejecut√≥ con alta prioridad. Un subproceso normal de Windows se ejecuta con una prioridad de aproximadamente 8-10. La prioridad m√°s alta con la que se puede ejecutar un subproceso de Windows normal (no en tiempo real) es 15. Mis trazas de ETW mostraron que LockApp siempre funcion√≥ con prioridad 13 o superior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ hay una l√≠nea de tiempo de la CPU para 19.494 segundos cr√≠ticos, agrupados y coloreados por prioridad de hilo ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nuevo en Pri</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, la prioridad actual que se asign√≥ al subproceso). </font><font style="vertical-align: inherit;">Vemos que los subprocesos con prioridades 4, 8, 9 y 10 consumen la gran mayor√≠a del tiempo de CPU, especialmente al final:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/81b/7d5/431/81b7d5431d0a307a93d2250fec9f2b1c.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uso de CPU por prioridad</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Aqu√≠ hay otra imagen con hilos ocultos con prioridades 0-12. </font><font style="vertical-align: inherit;">Cada vez que el gr√°fico cae por debajo del 12.5% ‚Äã‚Äã(lo que significa un procesador l√≥gico del tiempo de CPU de mi laptop de ocho hilos), se </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> iniciar </font><font style="vertical-align: inherit;">LockApp </font><font style="vertical-align: inherit;">, y se vuelve absolutamente incre√≠ble que la prioridad evite que se ejecute tan a menudo cuando muchos hilos con menor o igual prioridad obtener un mont√≥n de tiempo</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ec/c2c/66b/2ecc2c66b4df4902a3c5be388596524f.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uso prioritario de la CPU, solo subprocesos de alta prioridad</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eliminar la inversi√≥n prioritaria</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se especula que los algoritmos de inversi√≥n de prioridad de Windows son tan propicios para otros subprocesos que LockApp.exe est√° bloqueado. </font><font style="vertical-align: inherit;">Pero dado que los gr√°ficos mostrados arriba demuestran que las prioridades verdaderas se usan en las decisiones de planificaci√≥n, esta suposici√≥n (siempre poco convincente) tendr√° que ser abandonada.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descarga del n√∫cleo de la pila</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando habl√© sobre este rompecabezas en Twitter, uno de los comentaristas sugiri√≥ que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la pila del n√∫cleo del hilo estaba descargada</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">No estaba familiarizado con esta situaci√≥n, pero despu√©s de las explicaciones de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">John Werth</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (√©l entiende en su campo) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apagu√© el intercambio de la pila del kernel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y reinici√© la computadora. </font><font style="vertical-align: inherit;">Nada ha cambiado. </font><font style="vertical-align: inherit;">De hecho, no pens√© que esto ayudar√≠a, dado que tengo 32 GB de memoria, y el problema ocurre repetidamente y con frecuencia; </font><font style="vertical-align: inherit;">pero era mejor estar seguro de esto.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proceso de pausa</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que LockApp es una aplicaci√≥n UWP moderna, est√° sujeta a restricciones similares a las de las aplicaciones para tel√©fonos inteligentes. Entre otras cosas, esto significa que se puede suspender cuando no est√° en primer plano y luego "descongelarse" cuando se devuelve al primer plano. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">James Forshaw</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> propuso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grabar ETW de Microsoft-Windows-Kernel-Process</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para obtener datos sobre esto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los eventos est√°n dise√±ados para causar la m√°xima confusi√≥n. El nombre de la tarea </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Process Freeze se</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usa tanto para "descongelar" como para "congelar", y la versi√≥n del evento </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">win: Stop</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> significa que el proceso est√° comenzando (se detuvo la congelaci√≥n) y la versi√≥n de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">win: Start</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">significa que el proceso se detiene (comienza a congelarse). Todo esto es extremadamente l√≥gico, pero muy confuso. Si los nombres de los eventos se dividieran en Congelar y Descongelar, entonces habr√≠a menos confusi√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No hay documentaci√≥n para estos eventos, pero gracias al an√°lisis, determin√© que estos eventos siempre son creados por el </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servicio de Infraestructura de Tareas de Fondo / Broker</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . El nombre y la ID del proceso correspondiente se indican en el campo FrozenProcessID.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e04/32f/424/e0432f42442fa30ad0f7e6ed77f8d1c2.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eventos de ProcessFreeze (tambi√©n utilizado para descongelar) Fue</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
interesante investigar este proveedor, tiene muchos eventos prometedores, pero al final result√≥ que LockApp no ‚Äã‚Äãse detuvo ni se descongel√≥ durante el rastreo. </font><font style="vertical-align: inherit;">Sin embargo, este proveedor parec√≠a bastante √∫til, por lo que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modifiqu√© UIforETW</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para que las versiones futuras siempre lo escribieran.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ya hemos descartado todo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ninguna de las teor√≠as descritas anteriormente me pareci√≥ muy probable, y ahora todos las hemos excluido. </font><font style="vertical-align: inherit;">Comenc√© a buscar ayuda y me pidi√≥ que me diera ideas de un amigo de Microsoft. </font><font style="vertical-align: inherit;">Y en ese momento descubr√≠ que la prioridad de flujo 0-31 tan conocida en Windows es en realidad solo cinco bits de baja prioridad de un </font><font style="vertical-align: inherit;">sistema de prioridad </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">completa</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uso de cargo oficial</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Result√≥ que mi ignorancia fue culpa m√≠a. </font><font style="vertical-align: inherit;">Si leyera atentamente las 108 p√°ginas de la secci√≥n </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hilos</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Internals, 7ma Edici√≥n, Parte 1</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , entender√≠a lo que estaba sucediendo. </font><font style="vertical-align: inherit;">Si desea avanzar, este tema se revela en las p√°ginas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">287 a 295</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este campo de s√∫per prioridad que no conoc√≠a se llama </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rango</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Aparece en WPA como una columna oculta predeterminada (para encontrarla, debe abrir el Editor de vistas) llamada </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewThreadRank</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cuando se planifican hilos, el Rango de hilos tiene prioridad sobre la prioridad. </font><font style="vertical-align: inherit;">Casi todas las transmisiones tienen Rango 0, y una transmisi√≥n con Rango 0 siempre tiene mayor prioridad que una transmisi√≥n con Rango 2. Al incluir una columna</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewThreadRank</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y mirando el lado izquierdo de la tabla, podemos ver inmediatamente el problema:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/374/745/f0e/374745f0eeaee797c6a8472f62d5b3f4.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El rango es m√°s importante que la prioridad</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Las transmisiones LockApp.exe tienen Rango 2, lo que significa que, a pesar de la prioridad 14, tienen la prioridad m√°s baja en el sistema.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una explicaci√≥n casi completa.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que result√≥ que los subprocesos de LockApp.exe tienen Rango 2, solo se pueden ejecutar cuando </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ninguno</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de los subprocesos con Rango 0 "desea" ejecutarse. </font><font style="vertical-align: inherit;">Dado que muchas aplicaciones (por razones desconocidas) representan activamente sus pantallas invisibles, luchan por cada migaja de tiempo de CPU, sin dejar nada para los rangos m√°s altos. </font><font style="vertical-align: inherit;">Una vez que LockApp.exe recibe una peque√±a fracci√≥n del tiempo de CPU, r√°pidamente se mueve al Rango 0 (y la carga de la CPU cae), despu√©s de lo cual el proceso de inicio de sesi√≥n se realiza de la manera habitual.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de conocer esta informaci√≥n, comenc√© a estudiar c√≥mo cambia el rango de LockApp con el tiempo. En los √∫ltimos segundos antes de irse a dormir, LockApp cambi√≥ repentinamente del rango 0 al 2. El rango est√° dise√±ado para evitar que la CPU tome demasiado tiempo, como cuando </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Photos est√° demasiado interesado en el procesamiento de fondo no solicitado</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y hace la transici√≥n del rango 2 al 19:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cbc/b93/e8b/cbcb93e8bc2145f78e5ea10edba3fa8e.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft.Photos baja en el rango</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
De la documentaci√≥n se puede entender que el objetivo principal del rango de flujo es compartir el tiempo de CPU entre sesiones en la m√°quina para que los procesos de un usuario no da√±en a otros. Ambas opciones para usar el rango dejan en claro que el rango del subproceso solo deber√≠a aumentar si usa mucho tiempo de CPU, y cuando la computadora port√°til se fue a dormir, LockApp.exe us√≥ solo 79.3 ms de tiempo de CPU, y el resto del sistema - 17 del tiempo de CPU . Sin embargo, el sistema operativo por alguna raz√≥n decidi√≥ degradar LockApp a 2 en el proceso de ir a dormir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El sistema operativo cambia el rango de la secuencia solo si pertenece al "grupo de planificaci√≥n" ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KSCHEDULING_GROUP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), y la mayor√≠a de los subprocesos en una instalaci√≥n t√≠pica de Windows no son miembros. </font><font style="vertical-align: inherit;">En consecuencia, la mayor√≠a de los subprocesos no est√°n sujetos a un cambio en el rango, por lo que pueden pasar el tiempo de CPU de la manera que deseen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rompecabezas restantes</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desafortunadamente, todav√≠a no est√° claro por qu√© LockApp.exe cae al rango 2 antes de activar el modo de suspensi√≥n. Supongo que LockApp est√° en el grupo de planificaci√≥n y probablemente uno de los algoritmos se comporta incorrectamente. Pero no pude encontrar una API para investigar esto, y el tiempo se estaba acabando. Si conoce alg√∫n detalle, escriba los comentarios al art√≠culo original. Me parece que el principio mismo de utilizar el rango como el componente m√°s importante en las decisiones de planificaci√≥n deber√≠a romperse inevitablemente si la mayor√≠a de los procesos del sistema no est√°n involucrados en √©l: los hilos en los grupos de planificaci√≥n siempre corren el riesgo de quedarse sin los recursos necesarios. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La planificaci√≥n din√°mica de asignaci√≥n de recursos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DFSS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) est√° condenada al fracaso si la mayor√≠a de los subprocesos no est√°n involucrados.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, no s√© por qu√© tantas aplicaciones permanecen activas despu√©s de ir a dormir. Esto generalmente se explica por el hecho de que "muchos temporizadores terminan cuando la computadora port√°til est√° en modo de suspensi√≥n durante varias horas", pero esta explicaci√≥n no es adecuada si la computadora port√°til estuvo en un sue√±o durante solo unos segundos, y el comportamiento de representaci√≥n de WPA indica que algo sucede en el sistema de ventanas algo mal. Agregue a eso aplicaciones de mal comportamiento y controladores de ciclo de espera, y la CPU apilar√° todo con el tiempo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El hecho de que las tormentas de la CPU se apaguen y LockApp se inicie al mismo tiempo conduce a una explicaci√≥n obvia: LockApp solo puede funcionar cuando la demanda de la CPU cae. </font><font style="vertical-align: inherit;">Pero hay una explicaci√≥n igualmente convincente: tan pronto como LockApp obtiene la capacidad de ejecutarse (o, posiblemente, LogonUI lo consigue), la demanda de CPU cae. </font><font style="vertical-align: inherit;">Ambas explicaciones funcionan, pero creo que la segunda es m√°s plausible, porque de lo contrario no podemos explicar por qu√© la interpretaci√≥n aparentemente interminable de WPA se detiene de repente.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soluci√≥n al problema</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tan pronto como me di cuenta de que LockApp.exe es una aplicaci√≥n separada que tiene problemas con el inicio, y que aumentar su prioridad no ayuda, lo desactiv√©. </font><font style="vertical-align: inherit;">El archivo DisableLockScreen.reg me ayud√≥ con esto:</font></font><br>
<br>
<blockquote>Windows Registry Editor Version 5.00<br>
[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\Personalization]<br>
‚ÄúNoLockScreen‚Äù=dword:00000001</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al apagar la pantalla de bloqueo, la computadora port√°til se despierta inmediatamente despu√©s de abrir la cubierta. </font><font style="vertical-align: inherit;">No not√© ni el frenado ni las tormentas de la CPU, y ahora se necesita un paso menos para ingresar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">primera publicaci√≥n de Twitter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que publiqu√© cuando encontr√© el problema por primera vez contiene una l√≠nea de tiempo para una investigaci√≥n que puede ser √∫til para alguien. </font><font style="vertical-align: inherit;">Adem√°s, muchas personas inteligentes de Twitter vinieron a la publicaci√≥n, gracias a ellos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando volv√≠ al art√≠culo, descubr√≠ que despu√©s de volver a encender la pantalla de bloqueo, el problema desapareci√≥. </font><font style="vertical-align: inherit;">Un simple reinicio no lo solucion√≥: en febrero reinici√© muchas veces, pero probablemente no sabremos por qu√© se perdi√≥.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Discusiones</font></font></h2><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r / programaci√≥n</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r / Windows10</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Noticias de hackers</font></font></a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es498486/index.html">C√≥mo ampliar la sem√°ntica en ingl√©s para la publicidad de b√∫squeda en un nicho estrecho</a></li>
<li><a href="../es498490/index.html">Un sistema de certificaci√≥n efectivo que le permitir√° convertirse en un mejor l√≠der.</a></li>
<li><a href="../es498492/index.html">Cari√±o, matamos a la burocracia: c√≥mo la digitalizaci√≥n est√° cambiando el di√°logo entre proveedores y X5</a></li>
<li><a href="../es498494/index.html">JEP 360: Tipos sellados (vista previa)</a></li>
<li><a href="../es498496/index.html">Anuncio del mitap en l√≠nea PiterJS # 46: rendimiento, componentes de interfaz de usuario complejos y CSS-in-TS</a></li>
<li><a href="../es498500/index.html">¬øQu√© ver en cuarentena? Una selecci√≥n de materiales de Technostream (parte 1)</a></li>
<li><a href="../es498504/index.html">Saludos de A√±o Nuevo y COVID-19: c√≥mo los hackers usan las noticias</a></li>
<li><a href="../es498510/index.html">X. Una descripci√≥n general de la versi√≥n en caja de la telefon√≠a y la conexi√≥n a un sitio remoto</a></li>
<li><a href="../es498512/index.html">Combatir los atascos de tr√°fico en una peque√±a ciudad por un peque√±o presupuesto: resultados de 6 meses del proyecto</a></li>
<li><a href="../es498516/index.html">Cartero - M√©tricas de AutoMetrica en AppMetrica</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>