<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÇüèΩ üêØ üåú Kekuatan PWA: Sistem pengawasan video dengan kode JS 300-neural network neural üèà „Ä∞Ô∏è üß°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! 
 
 Browser web perlahan tapi pasti mengimplementasikan sebagian besar fitur sistem operasi, dan semakin sedikit alasan untuk mengembangka...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Kekuatan PWA: Sistem pengawasan video dengan kode JS 300-neural network neural</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492006/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo, Habr! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Browser web perlahan tapi pasti </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mengimplementasikan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sebagian besar fitur sistem operasi, dan semakin sedikit alasan untuk mengembangkan aplikasi asli jika Anda dapat menulis versi web (PWA). Cross-platform, API yang kaya, kecepatan pengembangan tinggi pada TS / JS, dan bahkan kinerja mesin V8 - semua ini merupakan nilai tambah. Browser telah lama dapat bekerja dengan aliran video dan menjalankan jaringan saraf, yaitu, kita memiliki semua komponen untuk membuat sistem pengawasan video dengan pengenalan objek. Terinspirasi oleh </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artikel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ini </font><font style="vertical-align: inherit;">, saya memutuskan untuk membawa demo ke tingkat aplikasi praktis, yang ingin saya bagikan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aplikasi merekam video dari kamera, secara berkala mengirimkan bingkai untuk pengakuan dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COCO-SSD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dan jika seseorang terdeteksi, fragmen video dalam porsi 7 detik mulai dikirim ke email yang ditentukan melalui Gmail-API. Seperti dalam sistem dewasa, rekaman dilakukan, yaitu, kami menyimpan satu fragmen hingga saat deteksi, semua fragmen dengan deteksi, dan satu demi satu. Jika Internet tidak tersedia, atau terjadi kesalahan saat mengirim, video disimpan di folder Unduhan lokal. Menggunakan surel memungkinkan Anda melakukannya tanpa sisi server, langsung memberi tahu pemilik, dan jika penyerang menguasai perangkat dan meretas semua kata sandi, ia tidak akan dapat menghapus surel dari penerima. Dari minus - lalu lintas overrun karena Base64 (meskipun cukup untuk satu kamera), dan kebutuhan untuk mengumpulkan file video final dari banyak email. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demo kerja ada di sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masalah yang dihadapi adalah sebagai berikut:</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Jaringan saraf memuat prosesor, dan jika Anda menjalankannya di utas utama, kelambatan muncul di video. Oleh karena itu, pengakuan ditempatkan di utas terpisah (pekerja), meskipun tidak semuanya lancar di sini. Semuanya paralel sempurna pada Linux prasejarah dual-core, tetapi pada beberapa ponsel 4-core yang cukup baru - pada saat pengakuan (pada pekerja), utas utama juga mulai tertinggal, yang terlihat pada antarmuka pengguna. Untungnya, ini tidak mempengaruhi kualitas video, meskipun mengurangi frekuensi pengenalan (secara otomatis menyesuaikan dengan beban). Masalah ini mungkin terkait dengan bagaimana berbagai versi Android mendistribusikan utas demi inti, kehadiran SIMD, fungsi kartu video yang tersedia, dll. Saya tidak bisa mengetahuinya sendiri, saya tidak tahu bagian dalam TensorFlow, dan saya akan berterima kasih atas informasinya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) FireFox. </font><font style="vertical-align: inherit;">Aplikasi ini berfungsi dengan baik di bawah Chrome / Chromium / Edge, namun, pengakuan di FireFox terasa lebih lambat, di samping itu, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageCapture</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> belum diimplementasikan </font><font style="vertical-align: inherit;">(tentu saja, ini dapat dilewati dengan mengambil bingkai dari &lt;video&gt;, tapi bagaimanapun itu memalukan bagi rubah, karena itu standar untuk rubah, karena standar API). </font><font style="vertical-align: inherit;">Secara umum, tidak ada aksesibilitas lintas-browser yang lengkap. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, semuanya beres.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dapatkan kamera dan mikrofon</font></font></h4><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">this</span>.video = <span class="hljs-keyword">this</span>.querySelector(<span class="hljs-string">'video'</span>)
<span class="hljs-keyword">this</span>.canvas = <span class="hljs-keyword">this</span>.querySelectorAll(<span class="hljs-string">'canvas'</span>)[<span class="hljs-number">0</span>]<font></font>
<font></font>
<span class="hljs-keyword">this</span>.stream = <span class="hljs-keyword">await</span> navigator.mediaDevices.getUserMedia(<font></font>
   {<span class="hljs-attr">video</span>: {<span class="hljs-attr">facingMode</span>: {<span class="hljs-attr">ideal</span>: <span class="hljs-string">"environment"</span>}}, <span class="hljs-attr">audio</span>: <span class="hljs-literal">true</span>}<font></font>
)<font></font>
<span class="hljs-keyword">this</span>.video.srcObject = <span class="hljs-keyword">this</span>.stream
<span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
   <span class="hljs-keyword">this</span>.video.onloadedmetadata = <span class="hljs-function">(<span class="hljs-params">_</span>) =&gt;</span> resolve()<font></font>
})<font></font>
<span class="hljs-keyword">this</span>.W = <span class="hljs-keyword">this</span>.bbox.width = <span class="hljs-keyword">this</span>.canvas.width = <span class="hljs-keyword">this</span>.video.videoWidth
<span class="hljs-keyword">this</span>.H = <span class="hljs-keyword">this</span>.bbox.height = <span class="hljs-keyword">this</span>.canvas.height = <span class="hljs-keyword">this</span>.video.videoHeight
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini kita memilih kamera utama ponsel / tablet (atau yang pertama di komputer / laptop), menampilkan aliran dalam pemutar video standar, setelah itu kita menunggu metadata untuk memuat dan mengatur dimensi kanvas layanan. </font><font style="vertical-align: inherit;">Karena seluruh aplikasi ditulis dengan gaya async / menunggu, Anda harus mengonversi API panggil balik (dan jumlahnya cukup banyak) menjadi Janji untuk keseragaman.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pengambilan video</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada dua cara untuk merekam video. </font><font style="vertical-align: inherit;">Yang pertama adalah untuk langsung membaca frame dari aliran masuk, menampilkannya di kanvas, memodifikasinya (misalnya, menambahkan geo dan cap waktu), dan kemudian mengambil data dari kanvas - untuk perekam sebagai aliran keluar, dan untuk jaringan saraf sebagai gambar terpisah. </font><font style="vertical-align: inherit;">Dalam hal ini, Anda dapat melakukannya tanpa elemen &lt;video&gt;.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">this</span>.capture = <span class="hljs-keyword">new</span> ImageCapture(<span class="hljs-keyword">this</span>.stream.getVideoTracks()[<span class="hljs-number">0</span>])
<span class="hljs-keyword">this</span>.recorder = <span class="hljs-keyword">new</span> MediaRecorder(<span class="hljs-keyword">this</span>.canvas.captureStream(), {<span class="hljs-attr">mimeType</span> : <span class="hljs-string">"video/webm"</span>})<font></font>
<font></font>
grab_video()<font></font>
<font></font>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">grab_video</span>(<span class="hljs-params"></span>) </span>{
	<span class="hljs-keyword">this</span>.canvas.drawImage(<span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.capture.grabFrame(), <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
	<span class="hljs-keyword">const</span> img = <span class="hljs-keyword">this</span>.canvas.getImageData(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.W, <span class="hljs-keyword">this</span>.H)<font></font>
	... <span class="hljs-comment">//    -   img</span>
	... <span class="hljs-comment">//   -    </span>
        <span class="hljs-built_in">window</span>.requestAnimationFrame(<span class="hljs-keyword">this</span>.grab_video.bind(<span class="hljs-keyword">this</span>))<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cara kedua (bekerja di FF) adalah menggunakan pemutar video standar untuk menangkap. </font><font style="vertical-align: inherit;">Omong-omong, ini menghabiskan waktu prosesor lebih sedikit, tidak seperti tampilan frame-by-frame di kanvas, tetapi kami tidak dapat menambahkan tulisan.</font></font><br>
<br>
<pre><code class="javascript hljs">...<font></font>
async <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">grab_video</span>(<span class="hljs-params"></span>) </span>{
	<span class="hljs-keyword">this</span>.canvas.drawImage(<span class="hljs-keyword">this</span>.video, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<font></font>
	...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aplikasi menggunakan opsi pertama, sebagai akibatnya pemutar video dapat dimatikan selama proses pengenalan. </font><font style="vertical-align: inherit;">Untuk menghemat prosesor, perekaman dilakukan dari aliran masuk, dan menggambar bingkai di atas kanvas hanya digunakan untuk memperoleh array piksel untuk jaringan saraf, dengan frekuensi tergantung pada kecepatan pengenalan. </font><font style="vertical-align: inherit;">Kami menggambar bingkai di sekitar orang tersebut pada kanvas terpisah yang ditempatkan pada pemain.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pemuatan jaringan saraf dan deteksi manusia</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu semua tidak senonoh sederhana. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami mulai pekerja</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , setelah memuat model (agak lama), kami mengirim pesan kosong ke utas utama, di mana pada acara onmessage kami menunjukkan tombol mulai, setelah itu pekerja siap menerima gambar. </font><font style="vertical-align: inherit;">Kode pekerja penuh:</font></font><br>
<br>
<pre><code class="javascript hljs">(<span class="hljs-keyword">async</span> () =&gt; {<font></font>
  self.importScripts(<span class="hljs-string">'https://cdn.jsdelivr.net/npm/@tensorflow/tfjs/dist/tf.min.js'</span>)<font></font>
  self.importScripts(<span class="hljs-string">'https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd'</span>)<font></font>
<font></font>
  <span class="hljs-keyword">let</span> model = <span class="hljs-keyword">await</span> cocoSsd.load()<font></font>
  self.postMessage({})<font></font>
<font></font>
  self.onmessage = <span class="hljs-keyword">async</span> (ev) =&gt; {
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> model.detect(ev.data)
    <span class="hljs-keyword">const</span> person = result.find(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> v.class === <span class="hljs-string">'person'</span>)
    <span class="hljs-keyword">if</span> (person) <font></font>
      self.postMessage({<span class="hljs-attr">ok</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">bbox</span>: person.bbox})
    <span class="hljs-keyword">else</span>
      self.postMessage({<span class="hljs-attr">ok</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">bbox</span>: <span class="hljs-literal">null</span>})<font></font>
  }<font></font>
})()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di utas utama, kami </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memulai fungsi grab_video ()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hanya setelah menerima hasil sebelumnya dari pekerja, yaitu, frekuensi deteksi akan tergantung pada beban sistem.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rekaman video</font></font></h4><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">this</span>.recorder.rec = <span class="hljs-keyword">new</span> MediaRecorder(<span class="hljs-keyword">this</span>.stream, {<span class="hljs-attr">mimeType</span> : <span class="hljs-string">"video/webm"</span>})
<span class="hljs-keyword">this</span>.recorder.rec.ondataavailable = <span class="hljs-function">(<span class="hljs-params">ev</span>) =&gt;</span> {
   <span class="hljs-keyword">this</span>.chunk = ev.data
   <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.detected) {
      <span class="hljs-keyword">this</span>.send_chunk()<font></font>
   } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.recorder.num &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">this</span>.send_chunk()
      <span class="hljs-keyword">this</span>.recorder.num--<font></font>
   }<font></font>
}<font></font>
...<font></font>
this.recorder.rec.start()<font></font>
<span class="hljs-keyword">this</span>.recorder.num = <span class="hljs-number">0</span>
<span class="hljs-keyword">this</span>.recorder.interval = setInterval(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
   <span class="hljs-keyword">this</span>.recorder.rec.stop()
   <span class="hljs-keyword">this</span>.recorder.rec.start()<font></font>
}, CHUNK_DURATION)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada setiap pemberhentian perekam (kami menggunakan interval tetap), peristiwa yang tersedia tersedia dinaikkan, di mana fragmen yang direkam dalam format Blob ditransfer, disimpan di this.chunk dan dikirim secara tidak sinkron. Ya, this.send_chunk () mengembalikan janji, tetapi fungsinya membutuhkan waktu lama (penyandian di Base64, mengirim email atau menyimpan file secara lokal), dan kami tidak menunggu sampai dieksekusi dan tidak memproses hasilnya - karena itu tidak ada menunggu. Bahkan jika ternyata klip video baru muncul lebih sering daripada yang dapat dikirim, mesin JS mengatur garis janji secara transparan untuk pengembang, dan cepat atau lambat semua data akan dikirim / direkam. Satu-satunya hal yang perlu diperhatikan adalah di dalam fungsi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">send_chunk ()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sebelum yang pertama menunggu, Anda perlu mengkloning Blob dengan metode slice (), karena tautan this.chunk di-gosok setiap CHUNK_DURATION detik.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API Gmail</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Digunakan untuk mengirim surat. </font><font style="vertical-align: inherit;">API sudah cukup tua, sebagian karena janji, sebagian pada panggilan balik, dokumentasi dan contoh tidak banyak, jadi saya akan memberikan kode lengkap. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otorisasi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">kami mendapatkan kunci aplikasi dan klien di konsol pengembang Google. </font><font style="vertical-align: inherit;">Di jendela otorisasi pop-up, Google melaporkan bahwa aplikasi tersebut belum diverifikasi, dan Anda harus mengklik "pengaturan lanjutan" untuk masuk. </font><font style="vertical-align: inherit;">Memeriksa aplikasi di Google ternyata menjadi tugas yang tidak sepele, Anda perlu mengkonfirmasi kepemilikan domain (yang saya tidak punya), mengatur halaman utama dengan benar, jadi saya memutuskan untuk tidak repot-repot.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'https://apis.google.com/js/api.js'</span>)<font></font>
gapi.load(<span class="hljs-string">'client:auth2'</span>, <span class="hljs-keyword">async</span> () =&gt; {
   <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> gapi.client.init({
         <span class="hljs-attr">apiKey</span>: API_KEY,
         <span class="hljs-attr">clientId</span>: CLIENT_ID,
         <span class="hljs-attr">discoveryDocs</span>: [<span class="hljs-string">'https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest'</span>],
         <span class="hljs-attr">scope</span>: <span class="hljs-string">'https://www.googleapis.com/auth/gmail.send'</span><font></font>
      }) <font></font>
      <span class="hljs-keyword">if</span> (!gapi.auth2.getAuthInstance().isSignedIn.je) {
         <span class="hljs-keyword">await</span> gapi.auth2.getAuthInstance().signIn()<font></font>
      }<font></font>
      <span class="hljs-keyword">this</span>.msg.innerHTML = <span class="hljs-string">''</span>
      <span class="hljs-keyword">this</span>.querySelector(<span class="hljs-string">'nav'</span>).style.display = <span class="hljs-string">''</span>
   } <span class="hljs-keyword">catch</span>(e) {
      <span class="hljs-keyword">this</span>.msg.innerHTML = <span class="hljs-string">'Gmail authorization error: '</span> + <span class="hljs-built_in">JSON</span>.stringify(e, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>)<font></font>
   }<font></font>
})<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pengiriman email</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">String yang disandikan Base64 tidak dapat digabungkan, dan ini tidak nyaman. </font><font style="vertical-align: inherit;">Cara mengirim video dalam format biner, saya masih tidak mengerti. </font><font style="vertical-align: inherit;">Di baris terakhir, kami mengonversi panggilan balik ke janji. </font><font style="vertical-align: inherit;">Sayangnya ini harus dilakukan cukup sering.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> send_mail(subject, mime_type, body) {
   <span class="hljs-keyword">const</span> headers = {
      <span class="hljs-string">'From'</span>: <span class="hljs-string">''</span>,
      <span class="hljs-string">'To'</span>: <span class="hljs-keyword">this</span>.email,
      <span class="hljs-string">'Subject'</span>: <span class="hljs-string">'Balajahe CCTV: '</span> + subject,
      <span class="hljs-string">'Content-Type'</span>: mime_type,
      <span class="hljs-string">'Content-transfer-encoding'</span>: <span class="hljs-string">'base64'</span><font></font>
   }<font></font>
   <span class="hljs-keyword">let</span> head = <span class="hljs-string">''</span>
   <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [k, v] <span class="hljs-keyword">of</span> <span class="hljs-built_in">Object</span>.entries(headers)) head += k + <span class="hljs-string">': '</span> + v + <span class="hljs-string">'\r\n'</span>
   <span class="hljs-keyword">const</span> request = gapi.client.gmail.users.messages.send({
      <span class="hljs-string">'userId'</span>: <span class="hljs-string">'me'</span>,
      <span class="hljs-string">'resource'</span>: { <span class="hljs-string">'raw'</span>: btoa(head + <span class="hljs-string">'\r\n'</span> + body) }<font></font>
   })<font></font>
   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {<font></font>
      request.execute(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
         <span class="hljs-keyword">if</span> (!res.code) <font></font>
            resolve() <font></font>
         <span class="hljs-keyword">else</span> <font></font>
            reject(res)<font></font>
      })<font></font>
   })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menyimpan klip video ke disk. </font><font style="vertical-align: inherit;">Kami menggunakan hyperlink tersembunyi.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> a = <span class="hljs-keyword">this</span>.querySelector(<span class="hljs-string">'a'</span>)<font></font>
URL.revokeObjectURL(a.href)<font></font>
a.href = URL.createObjectURL(chunk)<font></font>
a.download = name<font></font>
a.click()</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manajemen negara dalam dunia komponen web</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Melanjutkan ide yang disajikan dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artikel ini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , saya membawanya ke </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">absurditas dari</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akhir logis (hanya untuk lulz) dan membalikkan kontrol negara terbalik. </font><font style="vertical-align: inherit;">Jika biasanya variabel JS dianggap sebagai keadaan, dan DOM hanya tampilan saat ini, maka dalam kasus saya sumber data adalah DOM itu sendiri (karena komponen web adalah node DOM yang berumur panjang), dan untuk menggunakan data di sisi JS, komponen web menyediakan getter / setter untuk setiap bidang formulir. </font><font style="vertical-align: inherit;">Jadi, misalnya, alih-alih kotak centang yang tidak nyaman dalam gaya, &lt;button&gt; sederhana digunakan, dan "nilai" tombol (true ditekan, false ditekan) adalah nilai atribut kelas, yang memungkinkan Anda untuk menatanya seperti ini:</font></font><br>
<br>
<pre><code class="css hljs"><span class="hljs-selector-tag">button</span><span class="hljs-selector-class">.true</span> {<span class="hljs-attribute">background-color</span>: red}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dan dapatkan nilai seperti ini:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">get</span> <span class="hljs-title">detecting</span>() { <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.querySelector(<span class="hljs-string">'#detecting'</span>).className === <span class="hljs-string">'true'</span> }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya tidak bisa menyarankan menggunakan ini dalam produksi, karena ini adalah cara yang baik untuk membuang produktivitas. </font><font style="vertical-align: inherit;">Meskipun ... DOM virtual juga tidak gratis, dan saya tidak melakukan benchmark.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mode offline</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terakhir, tambahkan sedikit PWA, yaitu, instal </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pekerja layanan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> yang akan melakukan cache semua permintaan jaringan dan memungkinkan aplikasi bekerja tanpa akses ke Internet. </font><font style="vertical-align: inherit;">Nuansa kecil - dalam artikel tentang pekerja layanan, mereka biasanya memberikan algoritma berikut:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam acara pemasangan - buat versi cache yang baru dan tambahkan semua sumber daya yang diperlukan ke cache.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam acara aktivasi - hapus semua versi cache kecuali yang sekarang.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam acara ambil - pertama-tama kami mencoba mengambil sumber dari cache, dan jika kami tidak menemukannya, kami mengirim permintaan jaringan, yang hasilnya ditambahkan ke cache.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam praktiknya, skema semacam itu tidak nyaman karena dua alasan. Pertama, dalam kode pekerja Anda perlu memiliki daftar terbaru dari semua sumber daya yang diperlukan, dan dalam proyek-proyek besar menggunakan perpustakaan pihak ketiga, cobalah untuk melacak semua impor yang dilampirkan (termasuk yang dinamis). Masalah kedua - ketika mengubah file apa pun, Anda perlu meningkatkan versi pekerja layanan, yang akan mengarah pada pemasangan pekerja baru dan pembatalan yang sebelumnya, dan ini akan terjadi HANYA ketika browser ditutup / dibuka. Refresh halaman sederhana tidak akan membantu - pekerja lama dengan cache lama akan bekerja. Dan di mana jaminan bahwa klien saya tidak akan menjaga tab browser selamanya? Oleh karena itu, pertama kita membuat permintaan jaringan, kita menambahkan hasilnya ke cache secara tidak sinkron (tanpa menunggu resolusi izin cache.put (ev.request, resp.clone ())), dan jika jaringan tidak tersedia, maka kita mendapatkannya dari cache. Lebih baik kehilangan seharikemudian terbang dalam 5 menit ¬©.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah yang belum terselesaikan</font></font></h4><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pada beberapa ponsel, jaringan saraf melambat, mungkin dalam kasus saya, COCO-SSD bukan pilihan terbaik, tapi saya bukan ahli ML, dan saya mengambil yang pertama yang didengar.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya tidak menemukan contoh cara mengirim video melalui GAPI bukan dalam format Base64, tetapi dalam biner asli. </font><font style="vertical-align: inherit;">Ini akan menghemat waktu prosesor dan lalu lintas jaringan.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya tidak mengerti keamanan. </font><font style="vertical-align: inherit;">Untuk keperluan debugging lokal, saya menambahkan domain localhost ke aplikasi Google, tetapi jika seseorang mulai menggunakan kunci aplikasi untuk mengirim spam - apakah Google akan memblokir kunci sendiri atau akun pengirim?</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya akan berterima kasih atas umpan baliknya. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sumber di github. </font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terimakasih atas perhatiannya.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id491994/index.html">Bermigrasi dari Cocoapods ke Manajer Paket Swift</a></li>
<li><a href="../id491996/index.html">Lebih lanjut tentang Coroutine di C ++</a></li>
<li><a href="../id492000/index.html">Produk pertama. Habis terbakar</a></li>
<li><a href="../id492002/index.html">Sayap Penyerap Cahaya: Rahasia untuk Kupu-kupu Super Hitam</a></li>
<li><a href="../id492004/index.html">Cara tumbuh dari seorang programmer ke seorang manajer ("Saya ingin menjadi nyonya laut")</a></li>
<li><a href="../id492008/index.html">Hasil penelitian motivasi TI: apakah pengembang senang dengan pekerjaan mereka?</a></li>
<li><a href="../id492010/index.html">Sisi gelap sistem desain dan apa yang harus dilakukan dengannya</a></li>
<li><a href="../id492012/index.html">Peralatan masak stabilisasi Gyenno mengkompensasi hingga 80% tremor</a></li>
<li><a href="../id492016/index.html">ABP dan segalanya, segalanya, segalanya: entri cadangan otomatis di pusat data</a></li>
<li><a href="../id492018/index.html">Melebihi kecepatan: risiko dan kerentanan di bidang sistem transportasi cerdas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>