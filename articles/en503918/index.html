<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∂ ‚òùüèª üçü Managing Packages with Go Modules: A Pragmatic Guide üß¶ ‚úèÔ∏è üë®üèΩ‚Äçüç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello everyone. In anticipation of the start of the Golang Developer course , we have prepared another interesting translation for you.
 
 
 Modules a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Managing Packages with Go Modules: A Pragmatic Guide</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/503918/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello everyone. </font><font style="vertical-align: inherit;">In anticipation of the start of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the Golang Developer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> course </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">, we have</font></a><font style="vertical-align: inherit;"> prepared another interesting translation for you.</font></font></b></i><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Modules are a way to deal with dependencies in Go. Initially presented as an experiment, the modules are supposed to be introduced onto the field as a new standard for managing packages from version 1.13. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I find this topic unusual enough for beginners coming from other languages, and so I decided to collect some thoughts and tips here to help others like me get an idea of ‚Äã‚Äãpackage management in Go. We will start with a general introduction, and then move on to the less obvious aspects, including using the vendor folder, using modules with Docker in development, tool dependencies, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you are already familiar with Go modules and know the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wiki</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, like the back of your hand, this article probably won‚Äôt be very helpful to you. </font><font style="vertical-align: inherit;">But for the rest, however, it can save several hours of trial and error. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So if you are on the way, jump in and enjoy the ride.</font></font><a name="habracut"></a><br>
<br>
<img src="https://habrastorage.org/webt/tr/d9/eq/trd9eqcuki5uwi4w5b2gexcp8q4.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quick start</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If version control is already integrated in your project, you can simply run</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> mod init</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Or specify the path to the module manually. </font><font style="vertical-align: inherit;">This is something like a name, URL, and import path for your package:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> mod init github.com/you/hello</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This will create a file </font></font><code>go.mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which also defines the project requirements and lochit depending on their correct version (as an analogy for you, it's like </font></font><code>package.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and </font></font><code>package-lock.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">combined into a single file):</font></font><br>
<br>
<pre><code class="go hljs">module github.com/you/hello
<span class="hljs-keyword">go</span> <span class="hljs-number">1.12</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Run </font></font><code>go get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to add a new dependency to your project: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note that although you cannot specify a range of versions with go get, what you define here is not a specific version, but a minimum version. </font><font style="vertical-align: inherit;">As we will see later, there is a way to gracefully update dependencies according to semver.</font></font></i><br>
<br>
<pre><code class="go hljs"># use Git tags
<span class="hljs-keyword">go</span> get github.com/<span class="hljs-keyword">go</span>-chi/chi@v4<span class="hljs-number">.0</span><span class="hljs-number">.1</span><font></font>
# or Git branch name<font></font>
<span class="hljs-keyword">go</span> get github.com/<span class="hljs-keyword">go</span>-chi/chi@master<font></font>
# or Git commit hash<font></font>
<span class="hljs-keyword">go</span> get github.com/<span class="hljs-keyword">go</span>-chi/chi@<span class="hljs-number">08</span>c92af</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now our file is </font></font><code>go.mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as follows:</font></font><br>
<br>
<pre><code class="go hljs">module github.com/you/hello
<span class="hljs-keyword">go</span> <span class="hljs-number">1.12</span>
require github.com/<span class="hljs-keyword">go</span>-chi/chi v4<span class="hljs-number">.0</span><span class="hljs-number">.2</span>+incompatible <span class="hljs-comment">// indirect</span></code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The suffix is </font></font><code>+incompatible</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">added to all packages that are not yet configured for Go modules or violate their version control rules. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since we have not imported this package anywhere in our project, it was marked as </font></font><code>// indirect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">We can tidy this up with the following command:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> mod tidy</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depending on the current state of your repository, it will either delete an unused module or delete a comment </font></font><code>// indirect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If any dependency by itself does not have </font></font><code>go.mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(for example, it is not yet configured for modules), then all its dependencies will be written to the parent file </font></font><code>go.mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(as an option, your file </font></font><code>go.mod)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">along with a comment </font></font><code>// indirect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to indicate that they are not from direct import In your</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
global plan, the goal </font></font><code>go mod tidy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is also to add any dependencies needed for other combinations of OS, architectures and build tags. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Be sure to run it before each release.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Also make sure that a file is created after adding the dependency</font></font><code>go.sum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">You might think that this is a lock file. </font><font style="vertical-align: inherit;">But in fact it </font></font><code>go.mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">already provides enough information for 100% reproducible builds. </font><font style="vertical-align: inherit;">The file </font></font><code>go.sum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is created for verification purposes: it contains the expected cryptographic checksums of the contents of individual versions of the module. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partly because it is </font></font><code>go.sum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">not a lock file, it saves the written checksums for the module version even after you stop using this module. </font><font style="vertical-align: inherit;">This allows you to check the checksums if you resume using it later, which provides additional security.</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/_5/j8/vi/_5j8vigrklvhkwaucssmy7zaf88.png"><br>
<blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mkcert just migrated to the modules (with vendor / for backward compatibility) and everything went smoothly </font></font></i> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/FiloSottile/mkcert/commit/26ac5f35395fb9cba3805faf1a5a04d260271291</font></font></a><br>
<br>
<pre><code class="go hljs">$ GO111MODULE=on go1<span class="hljs-number">.11</span>rc1 mod init<font></font>
$ GO111MODULE=on go1<span class="hljs-number">.11</span>rc1 mod vendor<font></font>
$ git add <span class="hljs-keyword">go</span>.mod <span class="hljs-keyword">go</span>.sum vendor<font></font>
$ git rm Gopkg.lock Gopkg.toml Makefile</code></pre><br>
<img src="https://habrastorage.org/webt/kt/ch/ro/ktchrocah4xszqqrfkqtug3qzty.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FAQ: Should I commit </font></font><code>go.sum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in git? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A: Definitely yes. </font><font style="vertical-align: inherit;">With it, the owners of your sources do not need to trust other GitHub repositories and owners of custom import paths. </font><font style="vertical-align: inherit;">Already on the way to us, something better, but for now this is the same model as the hashes in the lock files.</font></font></i></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><code>go build</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font><font style="vertical-align: inherit;">commands </font></font><code>go test</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will automatically load all missing dependencies, although you can do this explicitly with the help of </font></font><code>go mod download</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pre-populating local caches that may be useful for CI. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By default, all of our packages from all projects are loaded into the directory </font></font><code>$GOPATH/pkg/mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">We will discuss this in more detail later.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Upgrading Package Versions</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can use </font></font><code>go get -u</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">either </font></font><code>go get -u=patch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to update dependencies to the latest minor version or patch, respectively. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But you cannot upgrade to major versions like that. </font><font style="vertical-align: inherit;">The code included in Go modules must technically comply with the following rules:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Match semver (example tag VCS v1.2.3).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the module is version v2 or higher, the major version of the module should be included both </font></font><code>/vN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">at the end of the module path used in the file </font></font><code>go.mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and in the package import path:</font></font></li>
</ul><br>
<pre><code class="go hljs"><span class="hljs-keyword">import</span> <span class="hljs-string">"github.com/you/hello/v2"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apparently, this is done so that different versions of packages can be imported in one assembly (see </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diamond dependency problem</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In a nutshell, Go expects you to be very careful when introducing major versions.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Replacing imported modules</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can specify the necessary module for your own fork or even the local path to the file using the directive </font></font><code>replace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> mod edit -replace github.com/<span class="hljs-keyword">go</span>-chi/chi=./packages/chi</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Result:</font></font><br>
<br>
<pre><code class="go hljs">module github.com/you/hello
<span class="hljs-keyword">go</span> <span class="hljs-number">1.12</span>
require github.com/<span class="hljs-keyword">go</span>-chi/chi v4<span class="hljs-number">.0</span><span class="hljs-number">.2</span>+incompatible<font></font>
replace github.com/<span class="hljs-keyword">go</span>-chi/chi =&gt; ./packages/chi</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can delete the line manually or run:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> mod edit -dropreplace github.com/<span class="hljs-keyword">go</span>-chi/chi</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Project Dependency Management </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Historically, all Go code was stored in one giant mono-repository, because that's how Google organizes its code base, and this affects the language design. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Go modules are a departure from this approach. You no longer need to keep all your projects in </font></font><code>$GOPATH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, technically all of your downloaded dependencies are still placed in </font></font><code>$GOPATH/pkg/mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. If you use Docker containers for local development, this can be a problem, since dependencies are stored outside the project. By default, they are simply not visible in your IDE. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ye/2c/_o/ye2c_o9jcsodsrhdekb4djz7lve.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is usually not a problem for other languages, but this is what I first encountered when working with the Go codebase. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fortunately, there are several (undocumented) ways to solve this problem.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option 1. Install GOPATH inside your project directory.</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At first glance, this may seem counterintuitive, but </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if you run Go from a container</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , you can override GOPATH so that it points to the project directory so that packages are accessible from the host:</font></font><br>
<br>
<pre><code class="go hljs">version: <span class="hljs-string">'3.7'</span><font></font>
<font></font>
services:<font></font>
  app:<font></font>
    command: tail -f /dev/null<font></font>
    image: golang:<span class="hljs-number">1.12</span><span class="hljs-number">.6</span>-stretch<font></font>
    environment:<font></font>
      #        - /code/.<span class="hljs-keyword">go</span>/pkg/mod<font></font>
      - GOPATH=/code/.<span class="hljs-keyword">go</span><font></font>
    ports:<font></font>
      - <span class="hljs-number">8000</span>:<span class="hljs-number">8000</span><font></font>
    volumes:<font></font>
      - ./:/code:cached<font></font>
    working_dir: /code</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Popular IDEs should be able to install GOPATH at the project (workspace) level: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_t/jz/d_/_tjzd_trva2fekp6vmt5ewc_xke.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The only drawback of this approach is the lack of interaction with the Go runtime on the host computer. </font><font style="vertical-align: inherit;">You must execute all Go commands inside the container.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option 2: Vending Your Dependencies</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another way is to copy the dependencies of your project to a folder </font></font><code>vendor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> mod vendor</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It should be noted right away: we </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DO NOT allow</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Go to directly upload materials to the vendor folder: this is not possible with modules. </font><font style="vertical-align: inherit;">We simply copy already downloaded packages. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, if you unfasten your dependencies, as in the example above, then clear </font></font><code>$GOPATH/pkg/mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and then try to add several new dependencies to your project, you will see the following:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Go will rebuild the download cache for all software packages </font></font><code>$GOPATH/pkg/mod/cache</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All loaded modules will be copied to </font></font><code>$GOPATH/pkg/mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And finally, Go will copy these modules to a </font></font><code>vendor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">folder, deleting examples, tests, and some other files that you don‚Äôt directly depend on.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Moreover, there are a lot of things missing in this newly created vendor folder: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rj/w-/lt/rjw-ltm1y1s8jwia34bfars6ngw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A typical Docker Compose file looks like this (note the volume bindings):</font></font><br>
<br>
<pre><code class="go hljs">version: <span class="hljs-string">'3.7'</span><font></font>
<font></font>
services:<font></font>
  app:<font></font>
    command: tail -f /dev/null<font></font>
    image: golang:<span class="hljs-number">1.12</span><span class="hljs-number">.6</span>-stretch<font></font>
    ports:<font></font>
      - <span class="hljs-number">8000</span>:<span class="hljs-number">8000</span><font></font>
    volumes:<font></font>
     #    <span class="hljs-keyword">go</span>,           <font></font>
      - modules:/<span class="hljs-keyword">go</span>/pkg/mod/cache<font></font>
      - ./:/code:cached<font></font>
    working_dir: /code <font></font>
<font></font>
volumes:<font></font>
  modules:<font></font>
    driver: local</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Please note that I do NOT comic this vendor folder in the version control system or am not going to use it in production. </font><font style="vertical-align: inherit;">This is a strictly local development script, which can usually be found in some other languages. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, when I read </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comments from some Go maintainers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and some offers related to partial vending (?), I get the impression that this feature was originally intended not for this user case. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One of the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commentators</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on reddit helped me shed some light on this:</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usually people vendor their dependencies for reasons such as the desire to have tight assemblies without access to the network, as well as the availability of a copy of ready-made dependencies in the event of a github failure or the repository disappearing, and the possibility of an easier audit of changes in dependencies using standard VCS tools, etc. .</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Yeah, it does not look like anything from the fact that I might be interested. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
According to the Go command, you can easily enable vending by setting an environment variable </font></font><code>GOFLAGS=-mod=vendor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. I do not recommend doing this. Using flags will simply break </font></font><code>go get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">without providing any other benefits to your daily workflow: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/df/ul/uw/dfuluwbr13eacullfzphguhrbeo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In fact, the only place you need to enable vending is your IDE:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jv/x2/pz/jvx2pzgtrx5wcfmlum4s5hheorw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After some trial and error, I came up with the following procedure for adding vendor dependencies in this approach.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 1. Requirement</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can require a dependency with </font></font><code>go get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> get github.com/rs/zerolog@v1<span class="hljs-number">.14</span><span class="hljs-number">.3</span></code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 2. Import</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then import it somewhere in your code:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">import</span> (<font></font>
   _ <span class="hljs-string">"github.com/rs/zerolog"</span>
)</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 3. Vending</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finally, re-open your dependencies:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> mod vendor</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pending proposal</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to allow go mod vendor to accept certain module templates that may (or may not) resolve some of the problems associated with this workflow. </font></font><br>
<br>
<code>go mod vendor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">already automatically requires missed imports, so </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">step 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is optional in this workflow (if you do not want to specify version restrictions). However, without step 2, it will not pick up the downloaded package. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This approach works better with the host system, but it is rather confusing when it comes to editing your dependencies.</font></font><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Personally, I think redefining GOPATH is a cleaner approach as it does not sacrifice functionality </font></font><code>go get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nevertheless, I wanted to show both strategies, because the vendor folder may be more familiar to people coming from other languages, such as PHP, Ruby, Javascript, etc. As you can see from the fraud described in this article, this not a particularly good choice for Go.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tool dependencies</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We may need to install some Go-based tools that are not imported, but used as part of the project development environment. </font><font style="vertical-align: inherit;">A simple example of such a tool is </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CompileDaemon</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which can monitor your code for changes and restart your application. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The officially recommended</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> approach is to add a </font></font><code>tools.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">file (the name does not matter) with the following content:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// +build tools</span>
<span class="hljs-keyword">package</span> tools
<span class="hljs-keyword">import</span> (<font></font>
_ <span class="hljs-string">"github.com/githubnemo/CompileDaemon"</span>
)</code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The limitation </font></font><code>// +build tools</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prevents your regular assemblies from actually importing your tool.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The import expression allows go commands to accurately write version information of your tools to </font></font><code>go.mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">your module </font><font style="vertical-align: inherit;">file </font><font style="vertical-align: inherit;">.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So that is all. </font><font style="vertical-align: inherit;">I hope you won‚Äôt be as confused as I was when I first started using Go modules. </font><font style="vertical-align: inherit;">You can visit the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Go Modules wiki</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for more details.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get on the course.</font></font></a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en503904/index.html">The world and n worlds, or mathematics for the humanities</a></li>
<li><a href="../en503906/index.html">LabVIEW NXG - Simple Data Types and Type Coercion</a></li>
<li><a href="../en503908/index.html">Call shared libraries from Similink</a></li>
<li><a href="../en503910/index.html">Experiments on people who have gone to "udalenka"</a></li>
<li><a href="../en503916/index.html">Learning to trade on the exchange. Part one: setting up a test environment</a></li>
<li><a href="../en503920/index.html">How we test microphone systems on STM32: the experience of Yandex device developers</a></li>
<li><a href="../en503922/index.html">Why the EU eradicates cookie walls</a></li>
<li><a href="../en503924/index.html">Overview of the Intraoral 3D Scanner Medit i500</a></li>
<li><a href="../en503926/index.html">Who is who in the payment ecosystem 2020. Part 2</a></li>
<li><a href="../en503928/index.html">Aerosol VS irrigation: which is better, and is there a difference?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>