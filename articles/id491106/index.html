<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⌚️ 🧑🏾‍🤝‍🧑🏾 👍🏿 Mengapa Anda perlu replikasi semi-sinkron? 🔁 👩🏿 🍑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya. Dalam sentuhan Vladislav Rodin. Saat ini saya mengajar kursus arsitektur perangkat lunak dan arsitektur perangkat lunak beban tinggi di...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Mengapa Anda perlu replikasi semi-sinkron?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/491106/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo semuanya. </font><font style="vertical-align: inherit;">Dalam sentuhan Vladislav Rodin. </font><font style="vertical-align: inherit;">Saat ini saya mengajar kursus arsitektur perangkat lunak dan arsitektur perangkat lunak beban tinggi di portal OTUS. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sebagai antisipasi dimulainya aliran baru kursus </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Arsitek beban tinggi",</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> saya memutuskan untuk menulis materi kepenulisan kecil, yang ingin saya bagikan kepada Anda.</font></font></b></i><br>
<br>
<img src="https://habrastorage.org/webt/pi/ad/dp/piaddproyjjd7sel38p94k6p_qe.png"><br>
<hr><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pengantar</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena kenyataan bahwa hanya sekitar 400-700 operasi per detik dapat dilakukan pada HDD (yang tidak dapat dibandingkan dengan rps tipikal yang jatuh pada sistem yang sarat beban), basis data disk klasik adalah leher arsitektur yang sempit. </font><font style="vertical-align: inherit;">Oleh karena itu, perhatian khusus harus diberikan pada pola penskalaan repositori ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat ini ada 2 pola penskalaan dasar: replikasi dan sharding. </font><font style="vertical-align: inherit;">Sharding memungkinkan Anda untuk skala operasi penulisan, dan, sebagai akibatnya, mengurangi rps untuk merekam per satu server di cluster Anda. </font><font style="vertical-align: inherit;">Replikasi memungkinkan Anda melakukan hal yang sama, tetapi dengan operasi baca. </font><font style="vertical-align: inherit;">Artikel ini dikhususkan untuk pola ini.</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Replikasi</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda melihat replikasi pada tingkat yang sangat tinggi, ini adalah hal yang sederhana: Anda memiliki satu server, datanya ada di sana, dan kemudian server ini berhenti mengatasi beban membaca data ini. </font><font style="vertical-align: inherit;">Anda menambahkan beberapa server lagi, menyinkronkan data di semua server, dan pengguna dapat membaca dari server mana pun di kluster Anda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terlepas dari kesederhanaan yang tampak, ada beberapa opsi untuk mengklasifikasikan berbagai implementasi skema ini:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dengan peran dalam cluster (master-master atau master-slave)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dengan objek yang diteruskan (berbasis baris, berbasis pernyataan atau campuran)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menurut mekanisme sinkronisasi simpul</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hari ini kita akan membahas poin ke-3. </font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana transaksi dilakukan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Topik ini tidak berhubungan langsung dengan replikasi, artikel terpisah dapat ditulis tentangnya, namun, karena tanpa pemahaman lebih lanjut tentang mekanisme komitmen transaksi, bacaan lebih lanjut tidak berguna, izinkan saya mengingatkan Anda tentang hal-hal yang paling mendasar. </font><font style="vertical-align: inherit;">Transaksi dilakukan dalam 3 tahap:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menulis transaksi ke log basis data.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penerapan transaksi dalam mesin basis data.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kembalikan konfirmasi kepada klien tentang keberhasilan aplikasi transaksi.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam berbagai basis data, nuansa dapat muncul dalam algoritme ini: misalnya, dalam mesin InnoDB dari database MySQL terdapat 2 log: satu untuk replikasi (log biner) dan yang lainnya untuk mempertahankan ACID (undo / redo log), sedangkan di PostgreSQL ada satu log yang mengeksekusi kedua fungsi (tulis log depan = WAL). </font><font style="vertical-align: inherit;">Namun di atas justru konsep umum yang memungkinkan nuansa seperti itu diabaikan.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Replikasi sinkron (sinkron)</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari tambahkan logika untuk mereplikasi perubahan yang diterima ke algoritma komit transaksi:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menulis transaksi ke log basis data.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penerapan transaksi dalam mesin basis data.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengirim data ke semua replika.</font></font></b></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terima konfirmasi dari semua replika tentang transaksi pada mereka.</font></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kembalikan konfirmasi kepada klien tentang keberhasilan aplikasi transaksi.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan pendekatan ini, kami mendapatkan sejumlah kerugian: </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">klien sedang menunggu perubahan untuk diterapkan ke semua replika.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">karena jumlah node dalam gugus meningkat, kami mengurangi kemungkinan operasi penulisan akan berhasil.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika semuanya kurang lebih jelas dengan paragraf 1, maka alasan paragraf 2 harus diklarifikasi. </font><font style="vertical-align: inherit;">Jika selama replikasi sinkron kami tidak mendapatkan respons dari setidaknya satu simpul, kami memutar kembali transaksi. </font><font style="vertical-align: inherit;">Dengan demikian, meningkatkan jumlah node dalam cluster, Anda meningkatkan kemungkinan bahwa operasi penulisan akan gagal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bisakah kita menunggu konfirmasi hanya dari sebagian kecil node, misalnya, dari 51% (kuorum)? </font><font style="vertical-align: inherit;">Ya, kami bisa, tetapi dalam versi klasik, konfirmasi dari semua node diperlukan, karena ini adalah bagaimana kami dapat memastikan konsistensi data yang lengkap dalam klaster, yang merupakan keuntungan tidak diragukan dari jenis replikasi ini.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Replikasi async</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita modifikasi algoritma sebelumnya. </font><font style="vertical-align: inherit;">Kami akan mengirimkan data ke replika "beberapa saat kemudian", dan "beberapa waktu kemudian" perubahan akan diterapkan pada replika:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menulis transaksi ke log basis data.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penerapan transaksi dalam mesin basis data.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kembalikan konfirmasi kepada klien tentang keberhasilan aplikasi transaksi.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengirim data ke replika dan menerapkan perubahan padanya.</font></font></b></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendekatan ini mengarah pada fakta bahwa cluster cepat, karena kami tidak membuat klien menunggu data untuk mencapai replika dan bahkan dikomunikasikan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi kondisi menjatuhkan data ke replika "beberapa saat kemudian" dapat menyebabkan hilangnya transaksi, dan hilangnya transaksi yang dikonfirmasi kepada pengguna, karena jika data tidak memiliki waktu untuk mereplikasi, konfirmasi dikirim kepada klien tentang keberhasilan operasi, dan simpul tempat perubahan datang terbang. HDD, kami kehilangan transaksi, yang dapat menyebabkan konsekuensi yang sangat tidak menyenangkan.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Replikasi semisync</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akhirnya, kami mendapat replikasi semi-sinkron. </font><font style="vertical-align: inherit;">Jenis replikasi ini tidak terlalu dikenal dan tidak terlalu umum, tetapi sangat menarik, karena dapat menggabungkan keuntungan dari replikasi sinkron dan asinkron. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita coba menggabungkan 2 pendekatan sebelumnya. </font><font style="vertical-align: inherit;">Kami tidak akan lama menyimpan klien, tetapi kami mengharuskan data direplikasi:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menulis transaksi ke log basis data.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penerapan transaksi dalam mesin basis data.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengirim data ke replika.</font></font></b></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menerima konfirmasi dari replika tentang menerima perubahan (perubahan akan diterapkan “beberapa saat kemudian”).</font></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kembalikan konfirmasi kepada klien tentang keberhasilan aplikasi transaksi.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Harap perhatikan bahwa dengan algoritme ini, kerugian transaksi hanya terjadi jika terjadi penurunan simpul yang menerima perubahan dan simpul replika. </font><font style="vertical-align: inherit;">Probabilitas kerusakan seperti itu dianggap kecil, dan risiko ini diterima. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi dengan pendekatan ini, risiko pembacaan hantu dimungkinkan. </font><font style="vertical-align: inherit;">Bayangkan skenario berikut: pada langkah 4, kami tidak menerima konfirmasi dari replika apa pun. </font><font style="vertical-align: inherit;">Kami harus memutar kembali transaksi ini, dan tidak mengembalikan konfirmasi kepada klien. </font><font style="vertical-align: inherit;">Karena data diterapkan pada langkah 2, ada kesenjangan waktu antara akhir langkah 2 dan rollback transaksi, di mana transaksi paralel dapat melihat perubahan-perubahan yang seharusnya tidak ada dalam database.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Replikasi semisync kurang-kalah</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda berpikir sedikit, Anda hanya dapat mengubah langkah-langkah algoritma di tempat-tempat untuk memperbaiki masalah pembacaan hantu dalam skenario ini:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menulis transaksi ke log basis data.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengirim data replika.</font></font></b></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menerima konfirmasi dari replika tentang menerima perubahan (perubahan akan diterapkan “beberapa saat kemudian”).</font></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penerapan transaksi dalam mesin basis data.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kembalikan konfirmasi kepada klien tentang keberhasilan aplikasi transaksi.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kami melakukan perubahan hanya jika itu direplikasi. </font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti biasa, tidak ada solusi yang sempurna, ada satu set solusi, yang masing-masing memiliki kelebihan dan kekurangan sendiri dan cocok untuk memecahkan berbagai kelas masalah. </font><font style="vertical-align: inherit;">Ini juga berlaku untuk memilih mekanisme untuk menyinkronkan data dalam database yang direplikasi. </font><font style="vertical-align: inherit;">Seperangkat manfaat yang dimiliki replikasi semi-sinkron solid dan cukup menarik untuk dianggap layak mendapat perhatian, meskipun prevalensinya rendah. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Itu saja. </font><font style="vertical-align: inherit;">Sampai jumpa di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lapangan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> !</font></font></b></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id491092/index.html">Bagaimana Crash Bandicoot Meretas Playstation</a></li>
<li><a href="../id491094/index.html">Menginstal Firebird 3 pada Versi Linux Modern: CentOS8 dan Ubuntu 19</a></li>
<li><a href="../id491100/index.html">Di Wanhao 5S, mereka mencetak boneka dengan tinggi seseorang</a></li>
<li><a href="../id491102/index.html">Bagaimana mengembangkan layanan ketika ada pesaing tangguh di sekitar</a></li>
<li><a href="../id491104/index.html">Bagaimana saya menemukan kesalahan perangkat keras pada tablet Lenovo MiiX 2 10 saya</a></li>
<li><a href="../id491108/index.html">Mengatur penyebaran ke banyak lingkungan k8 menggunakan helmfile</a></li>
<li><a href="../id491110/index.html">Konversi rtf ke xml dalam C #</a></li>
<li><a href="../id491112/index.html">Jalan Menuju Kepolosan Jaringan - Cisco DNA</a></li>
<li><a href="../id491114/index.html">Relokasi cerdas atau cara memilih perusahaan untuk bekerja dan tidak menyesalinya</a></li>
<li><a href="../id491116/index.html">Standar Identifikasi Modern: OAuth 2.0, OpenID Connect, WebAuthn</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>