<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥥 🙆🏼 🤛🏿 Pourquoi n'écrivons-nous pas de code dans les contrôleurs? 👩🏻‍🌾 👔 🌶️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je pense que beaucoup d'entre vous ont entendu dire qu'il ne devrait pas y avoir de code dans les contrôleurs, et donc un contrôleur avec des méthodes...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Pourquoi n'écrivons-nous pas de code dans les contrôleurs?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/505708/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je pense que beaucoup d'entre vous ont entendu dire qu'il ne devrait pas y avoir de code dans les contrôleurs, et donc un contrôleur avec des méthodes sur une seule ligne est considéré comme la «meilleure pratique». Je doute à mon tour que les avantages de cela soient si grands. </font><font style="vertical-align: inherit;">Si vous aviez des pensées similaires, je demande sous kat.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/8de/142/358/8de1423581455ddfe4a47f5af5693d62.png" alt="image"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bonjour à tous! </font><font style="vertical-align: inherit;">Je veux dire tout de suite que mon opinion n'est pas vraie, et le but de ce post est d'exprimer mon opinion et d'entendre les commentaires des autres. </font><font style="vertical-align: inherit;">Tout ce qui précède s'applique à l'implémentation de l'API, si vous avez MVC avec des vues, alors ce cas ne fonctionnera pas, car dans ce cas, il est préférable d'écrire uniquement la logique avec View dans les contrôleurs</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'est-ce qui ne va pas?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je suis sûr que beaucoup d'entre vous travaillent avec une application CRUD typique avec une architecture à 3 couches (à propos, il n'y a plus de couches, mais plus à ce sujet la prochaine fois). </font><font style="vertical-align: inherit;">Et dans cette architecture, vous avez une couche de données (plus DA), une couche logique métier (plus BL) et une couche vue (plus VL). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BL peut se faire de différentes manières, j'ai rencontré 2 options:</font></font><br>
<br>
<ul>
<li>Class —         .    -  ,    , , .         IRepository    ,  API       ,             .</li>
<li>CQS —      DTO (Command\Query) ,       .                  .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces méthodes ont un certain nombre de règles qui leur sont propres et l'une d'elles est que les gestionnaires ne peuvent pas appeler d'autres gestionnaires, ils doivent être complètement indépendants, exactement la même situation dans l'implémentation via une classe ordinaire avec un tas de méthodes, les méthodes sont si attachées à la fonctionnalité qu'elles ne peuvent pas être réutilisé. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considérez quelques implémentations dans ce style, puis je transférerai le code aux contrôleurs et nous analyserons ce que nous avons perdu. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/94a/cec/90b/94acec90b37d7d50e3d2b8154ada6495.png" alt="image"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/94a/a11/236/94aa11236a0675ae51802682b917003b.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce formulaire, nous implémentons toutes les méthodes, puis nous les appelons simplement au niveau de l'API: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/57a/c90/589/57ac905897f3c4ddfe4807d5e0e2d3f0.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
j'espère que vous comprenez que le code avec Command -&gt; Handler sera similaire, juste plus divisé. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et ça me hante toujours, pourquoi est-ce que je fais ce travail supplémentaire?</font></font><br>
<br>
<ul>
<li>  ? — ,         .<br>
<br>
 -       2 ,     —   </li>
<li>      ? — ,     ?      ,         IUserService?</li>
<li>?     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">TestServer</a>    end2end .</li>
</ul><br>
<h2>     </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supprimons l'excédent. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/ff0/05d/bcd/ff005dbcd0122ff451e06541214630f3.png" alt="image"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/80b/44d/fb2/80b44dfb21071c0ebb8ef2e1e1199d42.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Miraculeusement, le code de service ne diffère pas du contrôleur, nous venons d'ajouter quelques attributs et sommes prêts à intercepter les requêtes http. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je pense qu'ASP NET nous a parfaitement abstenus de travailler avec HTTP, nous avons le meilleur endroit où nous opérons avec nos types. </font><font style="vertical-align: inherit;">Je répète, si vous avez des vues, alors dans les contrôleurs, il est préférable d'écrire du code uniquement pour View, et dans les services d'écrire des </font><font style="vertical-align: inherit;">méthodes </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">réutilisées</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour obtenir des données pour View. </font><font style="vertical-align: inherit;">Mais dans les réalités actuelles, nous avons de plus en plus souvent API + SPA.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Validation?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ASP NET Core Pipeline est très bien réglé et a beaucoup de solutions, jetez un oeil à FluentValidation, vous ajouterez la validation sans même changer le code dans les contrôleurs.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous voulez plus de séparation?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Séparez l'interface et si vous avez également besoin d'une implémentation. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/a19/389/bca/a19389bca07fbf6521fd5683a861bad5.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En prime, l'interface de service devient un contrat de niveau supérieur, et dans le cadre d'un processus, il s'agit simplement d'un appel direct du code du contrôleur, dans le cadre de la communication client-serveur, une simple implémentation de la même interface utilisant HttpClient est substituée.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connectez d'autres canaux</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
S'ils me disent que nous pouvons avoir un autre canal, par exemple via une file d'attente, je peux simplement obtenir une instance du contrôleur et l'utiliser dans un autre canal. </font><font style="vertical-align: inherit;">Ce contrôleur se résout facilement à partir de DI. </font><font style="vertical-align: inherit;">De plus, ASP NET est assez flexible et vous pouvez apprendre à certains canaux à le traiter vous-même, modifiant à nouveau le pipeline.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/95d/b6d/75e/95db6d75e8fe8cd3bc3fcd4101a821ad.png" alt="image"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fait amusant</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une tâche de test dans ce style sera rejetée et rejetée, mais vous avez beaucoup de raisons pour lesquelles vous l'avez fait, mais si vous allez à une interview et discutez pourquoi vous concevez le code, alors c'est probablement un bon endroit et vous avez le même spécialiste qui comprend cette programmation est </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">multiforme</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous ne pouvez réutiliser que des services par type de référentiel, de cache, d'api client, etc., mais réutiliser la logique de traitement d'une seule demande est un cas très rare, et très probablement mauvais. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette approche, comme d'autres, doit être appliquée aux bons endroits, elle fait gagner du temps et est très pratique pour les API (microservices) fermées à l'accès public. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je crois que les contrôleurs sont le très BL Service ou Command \ QueryHandler, et dans mes projets je pratique cette approche et je partage très bien les contrôleurs, je vous recommande d'essayer également. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous n'avons pas accru la responsabilité du cadre, il avait une tâche:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accepter les demandes</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mappez-les dans un modèle</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Appelez le code que nous avons spécifié selon certaines règles</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Donnez des réponses</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Elle est restée avec lui. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne vois vraiment pas de problèmes critiques pour lesquels cela ne devrait pas être fait, je vous invite donc à commenter. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si je ne lance pas grand-chose, le prochain article portera sur les interfaces de chaque classe de service du système, et est-ce nécessaire? </font><font style="vertical-align: inherit;">Vaut-il la peine d'écrire une solution afin de faciliter le </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">péter</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> humide.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr505698/index.html">7 sites pour la conception de sites Web. Que choisir?</a></li>
<li><a href="../fr505700/index.html">Je vais interviewer des programmeurs Java. Un ensemble de questions pour tous les niveaux</a></li>
<li><a href="../fr505702/index.html">Protection contre la copie maladroite (presque littéralement)</a></li>
<li><a href="../fr505704/index.html">Travailler sur une télécommande - un vieux oublié</a></li>
<li><a href="../fr505706/index.html">FOSS News n ° 19 - une revue des nouvelles gratuites et open source du 1er au 7 juin 2020</a></li>
<li><a href="../fr505710/index.html">WebSockets et Spring WebFlux</a></li>
<li><a href="../fr505720/index.html">Spring Boot + Apache Kafka et SSL dans le conteneur Docker</a></li>
<li><a href="../fr505724/index.html">Usage loyal russe: où est la frontière du droit d'auteur?</a></li>
<li><a href="../fr505736/index.html">Run, PHPUnit, run: comment j'ai optimisé le temps d'exécution des tests</a></li>
<li><a href="../fr505738/index.html">Un peu sur les périodogrammes des séries chronologiques</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>