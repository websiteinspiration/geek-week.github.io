<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🦋 👩🏾‍🌾 ➕ 自己暗号化外付けAigo HDDを逆にしてハッキングする。パート2：サイプレスPSoCでのダンプ 👩‍✈️ 👴🏼 🥝</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="これは、外部の自己暗号化ドライブのハッキングに関する記事の2番目で最後の部分です。同僚が最近Patriot（Aigo）SK8671ハードドライブを持ち込んだことを思い出させます。私はそれを元に戻すことに決めました、そして今私はそれから来たものを共有しています。さらに読む前に、記事の最初の部分を必ず読...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>自己暗号化外付けAigo HDDを逆にしてハッキングする。パート2：サイプレスPSoCでのダンプ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455529/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これは、外部の自己暗号化ドライブのハッキングに関する記事の2番目で最後の部分です。</font><font style="vertical-align: inherit;">同僚が最近Patriot（Aigo）SK8671ハードドライブを持ち込んだことを思い出させます。私はそれを元に戻すことに決めました、そして今私はそれから来たものを共有しています。</font><font style="vertical-align: inherit;">さらに読む前</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記事の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">最初の部分を</font></a><font style="vertical-align: inherit;">必ず読んで</font><font style="vertical-align: inherit;">ください。</font></font></p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.内部フラッシュドライブPSoC </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5 </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">からダンプを削除し始め</font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます。ISSPプロトコル-5.1 </font></a></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ISSPとは-5.2 </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ベクトルの神秘化-5.3 </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">PSoCとの通信-5.4 </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">チップ内レジスタの識別</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-5.5。</font><font style="vertical-align: inherit;">セキュリティビット</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.最初の（失敗した）攻撃：ROMX </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. 2番目の攻撃：コールドリセットによるトレース</font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">-7.1 </font></a></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">実装</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-7.2。</font><font style="vertical-align: inherit;">結果を読む</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-7.3。</font><font style="vertical-align: inherit;">フラッシュバイナリの再構築</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-7.4。</font><font style="vertical-align: inherit;">ピンコードストレージアドレスを見つけます-7.5 </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ブロックNo.126〜7.6のダンプを削除し</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">ピンコード回復</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.次は？</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.まとめ</font></font></a></p><br>
<p><img src="https://habrastorage.org/webt/wx/nm/gk/wxnmgkeurrmiurx87rujoynxrsq.jpeg"></p><a name="habracut"></a><br>
<a name="a4"></a><br>
<h1 id="4-nachinaem-snimat-damp-s-vnutrenney-fleshki-psoc"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.内部フラッシュドライブPSoCからダンプを削除し始めます</font></font></h1><br>
<p>,     (    [ ]()),     - PSoC.      -.   :</p><br>
<ul>
<li>   «»  ;</li>
<li>  ,    «»   ;</li>
<li>   .</li>
</ul><br>
<p>  ,      :</p><br>
<ul>
<li> -;</li>
<li>SRAM,          ,   .</li>
</ul><br>
<p> , ,   -      PSoC, –    ,    «   » –     ISSP-.        .</p><br>
<pre><code class="plaintext hljs">$ ./psoc.py <font></font>
syncing: KO OK<font></font>
[...]<font></font>
PIN: 1 2 3 4 5 6 7 8 9</code></pre><br>
<p>  :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Arduino-  HSSP</a>;</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  Python  ISSP-</a>.</li>
</ul><br>
<a name="a5"></a><br>
<h1 id="5-issp-protokol">5. ISSP-</h1><br>
<a name="a51"></a><br>
<h2 id="51-chto-takoe-issp">5.1.   ISSP</h2><br>
<p>«»      :  «vendor to vendor»,       (, ICSP  Microchip’ PIC).</p><br>
<p> Cypress     ,  ISSP (in-system serial programming protocol;    ),     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> US7185162</a>    .   OpenSource-,  HSSP (    ). ISSP   :</p><br>
<ul>
<li> PSoC;</li>
<li>        PSoC;      ;</li>
<li> ,      ,  «».</li>
</ul><br>
<p>   ISSP        :</p><br>
<ul>
<li>Initialize-1</li>
<li>Initialize-2</li>
<li>Initialize-3 ( 3V  5V)</li>
<li>ID-SETUP</li>
<li>READ-ID-WORD</li>
<li>SET-BLOCK-NUM: 10011111010dddddddd111,  dddddddd=block #</li>
<li>BULK ERASE</li>
<li>PROGRAM-BLOCK</li>
<li>VERIFY-SETUP</li>
<li>READ-BYTE: 10110aaaaaaZDDDDDDDDZ1,  DDDDDDDD = data out, aaaaaa =  (6 )</li>
<li>WRITE-BYTE: 10010aaaaaadddddddd111,  dddddddd = data in, aaaaaa =  (6 )</li>
<li>SECURE</li>
<li>CHECKSUM-SETUP</li>
<li>READ-CHECKSUM: 10111111001ZDDDDDDDDZ110111111000ZDDDDDDDDZ1,  DDDDDDDDDDDDDDDD = data out:   </li>
<li>ERASE BLOCK</li>
</ul><br>
<p>,   Initialize-2:</p><br>
<pre><code class="plaintext hljs">1101111011100000000111 1101111011000000000111<font></font>
1001111100000111010111 1001111100100000011111<font></font>
1101111010100000000111 1101111010000000011111<font></font>
1001111101110000000111 1101111100100110000111<font></font>
1101111101001000000111 1001111101000000001111<font></font>
1101111000000000110111 1101111100000000000111<font></font>
1101111111100010010111</code></pre><br>
<p>    : 22 .    HSSP      ISSP: «ISSP-       ,    ».</p><br>
<a name="a52"></a><br>
<h2 id="52-demistifikaciya-vektorov">5.2.  </h2><br>
<p>,   .   ,       raw- M8C-,    ,  ,     .</p><br>
<p>    ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a> ,  ,      ,    : «     ,       (  RAM,   RAM,  ,  ).   8- ,   8   (   )    -».</p><br>
<p>         «Supervisory ROM (SROM)» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>. SROM    ROM,  PSoC,     (  ,   Syscall), –   ,    :</p><br>
<ul>
<li>00h: SWBootReset</li>
<li>01h: ReadBlock</li>
<li>02h: WriteBlock</li>
<li>03h: EraseBlock</li>
<li>06h: TableRead</li>
<li>07h: CheckSum</li>
<li>08h: Calibrate0</li>
<li>09h: Calibrate1</li>
</ul><br>
<p>     SROM,     ,   , –   SROM-.        ISSP-:</p><br>
<ul>
<li>100 =&gt; “wrmem”</li>
<li>101 =&gt; “rdmem”</li>
<li>110 =&gt; “wrreg”</li>
<li>111 =&gt; “rdreg”</li>
</ul><br>
<p>    ,        PSoC.</p><br>
<a name="a53"></a><br>
<h2 id="53-obschenie-s-psoc">5.3.   PSoC</h2><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a> Cypress’ HSSP-  Arduino,   Arduino Uno    ISSP-  .</p><br>
<p> ,     ,      .      GitHub: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>   Python-    Arduino,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">cypress_psoc_tools</a>.</p><br>
<p>,  Arduino,     «»  «» .     ROM,   VERIFY.   ,     .  - ,        .</p><br>
<p>      ,     /.  ,      SROM,    ,   !</p><br>
<a name="a54"></a><br>
<h2 id="54-identifikaciya-vnutrichipovyh-registrov">5.4.   </h2><br>
<p>  «» ,  ,      (0xF8-0xFA),   M8C-,   ,   .      ,   «ADD», «MOV A, X», «PUSH»  «JMP».   (   ,    )   ,    ,     (A, X, SP  PC).</p><br>
<p> , «» ,   HSSP_disas.rb, –   (    ):</p><br>
<pre><code class="plaintext hljs">--== init2 ==--<font></font>
[DE E0 1C] wrreg CPU_F (f7), 0x00   #  <font></font>
[DE C0 1C] wrreg SP (f6), 0x00      #  SP<font></font>
[9F 07 5C] wrmem KEY1, 0x3A     #    SSC<font></font>
[9F 20 7C] wrmem KEY2, 0x03     # <font></font>
[DE A0 1C] wrreg PCh (f5), 0x00     #  PC (MSB) ...<font></font>
[DE 80 7C] wrreg PCl (f4), 0x03     # (LSB) ...  3 ??<font></font>
[9F 70 1C] wrmem POINTER, 0x80      # RAM-   <font></font>
[DF 26 1C] wrreg opc1 (f9), 0x30        #  1 =&gt; "HALT"<font></font>
[DF 48 1C] wrreg opc2 (fa), 0x40        #  2 =&gt; "NOP"<font></font>
[9F 40 3C] wrmem BLOCKID, 0x01  # BLOCK ID   SSC<font></font>
[DE 00 DC] wrreg A (f0), 0x06       #  "Syscall" : TableRead<font></font>
[DF 00 1C] wrreg opc0 (f8), 0x00        #   SSC, "Supervisory SROM Call"<font></font>
[DF E2 5C] wrreg CPU_SCR0 (ff), 0x12    #  :   </code></pre><br>
<a name="a55"></a><br>
<h2 id="55-zaschitnye-bity">5.5.  </h2><br>
<p>        PSoC,            .      ,  Cypress          ,   .    Google,   ,  HSSP-,  Cypress’,     ,     .  !     :</p><br>
<pre><code class="plaintext hljs">[DE E0 1C] wrreg CPU_F (f7), 0x00<font></font>
[DE C0 1C] wrreg SP (f6), 0x00<font></font>
[9F 07 5C] wrmem KEY1, 0x3A<font></font>
[9F 20 7C] wrmem KEY2, 0x03<font></font>
[9F A0 1C] wrmem 0xFD, 0x00 #  <font></font>
[9F E0 1C] wrmem 0xFF, 0x00 # <font></font>
[DE A0 1C] wrreg PCh (f5), 0x00<font></font>
[DE 80 7C] wrreg PCl (f4), 0x03<font></font>
[9F 70 1C] wrmem POINTER, 0x80<font></font>
[DF 26 1C] wrreg opc1 (f9), 0x30<font></font>
[DF 48 1C] wrreg opc2 (fa), 0x40<font></font>
[DE 02 1C] wrreg A (f0), 0x10   #  syscall !<font></font>
[DF 00 1C] wrreg opc0 (f8), 0x00<font></font>
[DF E2 5C] wrreg CPU_SCR0 (ff), 0x12</code></pre><br>
<p>   (. read_security_data  psoc.py),       SRAM  0x80,         .</p><br>
<p> :     «    ».          ,     (    ROM-).      –    . :-(</p><br>
<a name="a6"></a><br>
<h1 id="6-pervaya-neudavshayasya-ataka-romx">6.  () : ROMX</h1><br>
<p>      :        ,     ROMX,     -?        .    ReadBlock,    SROM (  ), ,     ISSP.   ROMX, ,     . ,  Python- (       Arduino-):</p><br>
<pre><code class="plaintext hljs">for i in range(0, 8192):<font></font>
    write_reg(0xF0, i&gt;&gt;8)       # A = 0<font></font>
    write_reg(0xF3, i&amp;0xFF)     # X = 0<font></font>
    exec_opcodes("\x28\x30\x40")    # ROMX, HALT, NOP<font></font>
    byte = read_reg(0xF0)       # ROMX reads ROM[A|X] into A<font></font>
    print "%02x" % ord(byte[0]) # print ROM byte</code></pre><br>
<p> ,    . :-(  ,         (0x28 0x30 0x40)!  ,         .      :    , ROM’     .</p><br>
<a name="a7"></a><br>
<h1 id="7-vtoraya-ataka-trassirovka-s-holodnoy-perezagruzkoy">7.  :    </h1><br>
<p>   ROMX  ,        –    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">«Shedding too much Light on a Microcontroller’s Firmware Protection»</a>.</p><br>
<a name="a71"></a><br>
<h2 id="71-realizaciya">7.1. </h2><br>
<p>   ISSP     CHECKSUM-SETUP:</p><br>
<pre><code class="plaintext hljs">[DE E0 1C] wrreg CPU_F (f7), 0x00<font></font>
[DE C0 1C] wrreg SP (f6), 0x00<font></font>
[9F 07 5C] wrmem KEY1, 0x3A<font></font>
[9F 20 7C] wrmem KEY2, 0x03<font></font>
[DE A0 1C] wrreg PCh (f5), 0x00<font></font>
[DE 80 7C] wrreg PCl (f4), 0x03<font></font>
[9F 70 1C] wrmem POINTER, 0x80<font></font>
[DF 26 1C] wrreg opc1 (f9), 0x30<font></font>
[DF 48 1C] wrreg opc2 (fa), 0x40<font></font>
[9F 40 1C] wrmem BLOCKID, 0x00<font></font>
[DE 00 FC] wrreg A (f0), 0x07<font></font>
[DF 00 1C] wrreg opc0 (f8), 0x00<font></font>
[DF E2 5C] wrreg CPU_SCR0 (ff), 0x12</code></pre><br>
<p>     SROM- 0x07,     ( ):</p><br>
<blockquote>    .   16-    ,   –   -,   .  BLOCKID     ,       .  «1»        ;   <em>«0»   ,        256  -. 16-     KEY1  KEY2.</em>   KEY1   8   ,   KEY2 –  8 .     -,        .  ,     ,   FLS_PR1 (    ,   -).</blockquote><p> ,     :      ;   CRC-.  , ,    M8C    ,  ,     ,         ,      : KEY1 (0xF8) / KEY2 (0xF9).</p><br>
<p>,      :</p><br>
<ol>
<li>  ISSP.</li>
<li>   ,    CHECKSUM-SETUP.</li>
<li>     T.</li>
<li> RAM,      C.</li>
<li>  3  4,     T.</li>
<li>   ,      C  .</li>
</ol><br>
<p>  :  Initialize-1,      ,  KEY1  KEY2:</p><br>
<pre><code class="plaintext hljs">1100101000000000000000  # ,  PSoC   <font></font>
nop<font></font>
nop<font></font>
nop<font></font>
nop<font></font>
nop<font></font>
[DE E0 1C] wrreg CPU_F (f7), 0x00<font></font>
[DE C0 1C] wrreg SP (f6), 0x00<font></font>
[9F 07 5C] wrmem KEY1, 0x3A #    <font></font>
[9F 20 7C] wrmem KEY2, 0x03 #  <font></font>
[DE A0 1C] wrreg PCh (f5), 0x00<font></font>
[DE 80 7C] wrreg PCl (f4), 0x03<font></font>
[9F 70 1C] wrmem POINTER, 0x80<font></font>
[DF 26 1C] wrreg opc1 (f9), 0x30<font></font>
[DF 48 1C] wrreg opc2 (fa), 0x40<font></font>
[DE 01 3C] wrreg A (f0), 0x09   # SROM- 9<font></font>
[DF 00 1C] wrreg opc0 (f8), 0x00    # SSC<font></font>
[DF E2 5C] wrreg CPU_SCR0 (ff), 0x12</code></pre><br>
<p>      ,  Calibrate1 (SROM- 9)…    ,     (   ),    ,    SRAM?  ,  ! Arduino-,   ,  :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">case</span> Cmnd_STK_START_CSUM:<font></font>
    checksum_delay = ((<span class="hljs-keyword">uint32_t</span>)getch())&lt;&lt;<span class="hljs-number">24</span>;<font></font>
    checksum_delay |= ((<span class="hljs-keyword">uint32_t</span>)getch())&lt;&lt;<span class="hljs-number">16</span>;<font></font>
    checksum_delay |= ((<span class="hljs-keyword">uint32_t</span>)getch())&lt;&lt;<span class="hljs-number">8</span>;<font></font>
    checksum_delay |= getch();<font></font>
    <span class="hljs-keyword">if</span>(checksum_delay &gt; <span class="hljs-number">10000</span>) {<font></font>
        ms_delay = checksum_delay/<span class="hljs-number">1000</span>;<font></font>
        checksum_delay = checksum_delay%<span class="hljs-number">1000</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> {<font></font>
        ms_delay = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
    send_checksum_v();<font></font>
    <span class="hljs-keyword">if</span>(checksum_delay)<font></font>
        delayMicroseconds(checksum_delay);<font></font>
    delay(ms_delay);<font></font>
    start_pmode();</code></pre><br>
<ol>
<li> checkum_delay.</li>
<li>    (send_checksum_v).</li>
<li>   ;    :<br>
<ul>
<li>   ,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">delayMicroseconds</a>        16383;</li>
<li>      ,   ,  delayMicroseconds,      0,   !</li>
</ul></li>
<li> PSoC    (   ,    ).</li>
</ol><br>
<p>   Python:</p><br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> delay <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>, <span class="hljs-number">150000</span>):  <span class="hljs-comment">#   </span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>):      <span class="hljs-comment">#     </span>
        <span class="hljs-keyword">try</span>:<font></font>
            reset_psoc(quiet=<span class="hljs-literal">True</span>)  <span class="hljs-comment">#      </span>
            send_vectors()      <span class="hljs-comment">#   </span>
            ser.write(<span class="hljs-string">"\x85"</span>+struct.pack(<span class="hljs-string">"&gt;I"</span>, delay)) <span class="hljs-comment">#    +   </span>
            res = ser.read(<span class="hljs-number">1</span>)       <span class="hljs-comment">#  arduino ACK</span>
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-keyword">print</span> e<font></font>
            ser.close()<font></font>
            os.system(<span class="hljs-string">"timeout -s KILL 1s picocom -b 115200 /dev/ttyACM0 2&gt;&amp;1 &gt; /dev/null"</span>)<font></font>
            ser = serial.Serial(<span class="hljs-string">'/dev/ttyACM0'</span>, <span class="hljs-number">115200</span>, timeout=<span class="hljs-number">0.5</span>) <span class="hljs-comment">#   </span>
            <span class="hljs-keyword">continue</span>
        <span class="hljs-keyword">print</span> <span class="hljs-string">"%05d %02X %02X %02X"</span> % (delay,      <span class="hljs-comment">#  RAM-</span>
                read_regb(<span class="hljs-number">0xf1</span>),<font></font>
                read_ramb(<span class="hljs-number">0xf8</span>),<font></font>
                read_ramb(<span class="hljs-number">0xf9</span>))</code></pre><br>
<p>  ,    :</p><br>
<ol>
<li> PSoC (    ).</li>
<li>   .</li>
<li> Arduino- Cmnd_STK_START_CSUM (0x85),        .</li>
<li>   (0xF8  0xF9)    0xF1.</li>
</ol><br>
<p>    10   1 . 0xF1  ,    ,      . ,  -  ,  - .     ,    Arduino,  picocom,  Arduino    (  , ).</p><br>
<a name="a72"></a><br>
<h2 id="72-schityvaem-rezultat">7.2.  </h2><br>
<p>  Python-   (  ):</p><br>
<pre><code class="plaintext hljs">DELAY F1 F8 F9  # F1 –   <font></font>
                  # F8    <font></font>
                  # F9    <font></font>
<font></font>
00000 03 E1 19<font></font>
[...]<font></font>
00016 F9 00 03<font></font>
00016 F9 00 00<font></font>
00016 F9 00 03<font></font>
00016 F9 00 03<font></font>
00016 F9 00 03<font></font>
00016 F9 00 00  #     0<font></font>
00017 FB 00 00<font></font>
[...]<font></font>
00023 F8 00 00<font></font>
00024 80 80 00  # 1- : 0x0080-0x0000 = 0x80 <font></font>
00024 80 80 00<font></font>
00024 80 80 00<font></font>
[...]<font></font>
00057 CC E7 00   # 2- : 0xE7-0x80: 0x67<font></font>
00057 CC E7 00<font></font>
00057 01 17 01  #   ,   <font></font>
00057 01 17 01<font></font>
00057 01 17 01<font></font>
00058 D0 17 01<font></font>
00058 D0 17 01<font></font>
00058 D0 17 01<font></font>
00058 D0 17 01<font></font>
00058 F8 E7 00  #  E7?<font></font>
00058 D0 17 01<font></font>
[...]<font></font>
00059 E7 E7 00<font></font>
00060 17 17 00  # <font></font>
[...]<font></font>
00062 00 17 00<font></font>
00062 00 17 00<font></font>
00063 01 17 01  # , !       <font></font>
00063 01 17 01<font></font>
[...]<font></font>
00075 CC 17 01  # , 0x117-0xE7: 0x30</code></pre><br>
<p>     :      ,      .      (8192 )  0,1478  (     ),    18,04   , –              .      - ,        .      ,   «   »    – ,   :</p><br>
<pre><code class="plaintext hljs">134023 D0 02 DD<font></font>
134023 CC D2 DC<font></font>
134023 CC D2 DC<font></font>
134023 CC D2 DC<font></font>
134023 FB D2 DC<font></font>
134023 3F D2 DC<font></font>
134023 CC D2 DC<font></font>
134024 02 02 DC<font></font>
134024 CC D2 DC<font></font>
134024 F9 02 DC<font></font>
134024 03 02 DD<font></font>
134024 21 02 DD<font></font>
134024 02 D2 DC<font></font>
134024 02 02 DC<font></font>
134024 02 02 DC<font></font>
134024 F8 D2 DC<font></font>
134024 F8 D2 DC<font></font>
134025 CC D2 DC<font></font>
134025 EF D2 DC<font></font>
134025 21 02 DD<font></font>
134025 F8 D2 DC<font></font>
134025 21 02 DD<font></font>
134025 CC D2 DC<font></font>
134025 04 D2 DC<font></font>
134025 FB D2 DC<font></font>
134025 CC D2 DC<font></font>
134025 FB 02 DD<font></font>
134026 03 02 DD<font></font>
134026 21 02 DD</code></pre><br>
<p> 10     .        8192  ,   48 .</p><br>
<a name="a73"></a><br>
<h2 id="73-rekonstrukciya-flesh-binarnika">7.3.  -</h2><br>
<p>      ,      ,      .       .    ,    ,   ,   m8cdis:</p><br>
<pre><code class="plaintext hljs">0000: 80 67   jmp  0068h     ; Reset vector<font></font>
[...]<font></font>
0068: 71 10   or  F,010h<font></font>
006a: 62 e3 87 mov  reg[VLT_CR],087h<font></font>
006d: 70 ef   and  F,0efh<font></font>
006f: 41 fe fb and  reg[CPU_SCR1],0fbh<font></font>
0072: 50 80   mov  A,080h<font></font>
0074: 4e    swap A,SP<font></font>
0075: 55 fa 01 mov  [0fah],001h<font></font>
0078: 4f    mov  X,SP<font></font>
0079: 5b    mov  A,X<font></font>
007a: 01 03   add  A,003h<font></font>
007c: 53 f9   mov  [0f9h],A<font></font>
007e: 55 f8 3a mov  [0f8h],03ah<font></font>
0081: 50 06   mov  A,006h<font></font>
0083: 00    ssc<font></font>
[...]<font></font>
0122: 18    pop  A<font></font>
0123: 71 10   or  F,010h<font></font>
0125: 43 e3 10 or  reg[VLT_CR],010h<font></font>
0128: 70 00   and  F,000h ; Paging mode changed from 3 to 0<font></font>
012a: ef 62   jacc 008dh<font></font>
012c: e0 00   jacc 012dh<font></font>
012e: 71 10   or  F,010h<font></font>
0130: 62 e0 02 mov  reg[OSC_CR0],002h<font></font>
0133: 70 ef   and  F,0efh<font></font>
0135: 62 e2 00 mov  reg[INT_VC],000h<font></font>
0138: 7c 19 30 lcall 1930h<font></font>
013b: 8f ff   jmp  013bh<font></font>
013d: 50 08   mov  A,008h<font></font>
013f: 7f    ret</code></pre><br>
<p>  !</p><br>
<a name="a74"></a><br>
<h2 id="74-nahodim-adres-hraneniya-pinkoda">7.4.    </h2><br>
<p>,           , –    ,     ,  :</p><br>
<ul>
<li>  ;</li>
<li> .</li>
</ul><br>
<p>,     ,         10 ,  .          .</p><br>
<p>    ,    .       ,     -    120000   140000  .  «»,    ,    – -   delayMicroseconds,    ,    0.</p><br>
<p>,   3 ,  ,  SROM’   CheckSum    ,      ! ..           « », –    64- .</p><br>
<p>     :</p><br>
<p><img src="https://habrastorage.org/webt/0n/ol/xc/0nolxcgp8espvfdubrhrmvmbgrg.png"></p><br>
<p>     «123456»  «1234567»  :</p><br>
<p><img src="https://habrastorage.org/webt/0r/zp/s2/0rzps2e2mwldmhtot1tswiv7mdq.png"></p><br>
<p> ,     ,     №126.</p><br>
<a name="a75"></a><br>
<h2 id="75-snimaem-damp-bloka-126">7.5.    №126</h2><br>
<p> №126   -   125x64x18 = 144000,     ,    ,     . ,       (-  «   »),        (  145527):</p><br>
<p><img src="https://habrastorage.org/webt/ji/31/ye/ji31yewphovunymnjxp0fcpwrdw.png"></p><br>
<p> ,      !      ASCII- ,    –  ,    .</p><br>
<p>,     ,  ,     .  :</p><br>
<p><img src="https://habrastorage.org/webt/dc/r5/tf/dcr5tf0yevdxcg5lyrbcr9srowu.png"></p><br>
<p>0xFF –  «15 »,       .</p><br>
<a name="a76"></a><br>
<h2 id="76-vosstanovlenie-pinkoda">7.6.  </h2><br>
<p>   ,      :</p><br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dump_pin</span>():</span>
  pin_map = {<span class="hljs-number">0x24</span>: <span class="hljs-string">"0"</span>, <span class="hljs-number">0x25</span>: <span class="hljs-string">"1"</span>, <span class="hljs-number">0x26</span>: <span class="hljs-string">"2"</span>, <span class="hljs-number">0x27</span>:<span class="hljs-string">"3"</span>, <span class="hljs-number">0x20</span>: <span class="hljs-string">"4"</span>, <span class="hljs-number">0x21</span>: <span class="hljs-string">"5"</span>,
        <span class="hljs-number">0x22</span>: <span class="hljs-string">"6"</span>, <span class="hljs-number">0x23</span>: <span class="hljs-string">"7"</span>, <span class="hljs-number">0x2c</span>: <span class="hljs-string">"8"</span>, <span class="hljs-number">0x2d</span>: <span class="hljs-string">"9"</span>}<font></font>
  last_csum = <span class="hljs-number">0</span><font></font>
  pin_bytes = []<font></font>
  <span class="hljs-keyword">for</span> delay <span class="hljs-keyword">in</span> range(<span class="hljs-number">145495</span>, <span class="hljs-number">145719</span>, <span class="hljs-number">16</span>):<font></font>
    csum = csum_at(delay, <span class="hljs-number">1</span>)<font></font>
    byte = (csum-last_csum)&amp;<span class="hljs-number">0xFF</span>
    <span class="hljs-keyword">print</span> <span class="hljs-string">"%05d %04x (%04x) =&gt; %02x"</span> % (delay, csum, last_csum, byte)<font></font>
    pin_bytes.append(byte)<font></font>
    last_csum = csum<font></font>
  <span class="hljs-keyword">print</span> <span class="hljs-string">"PIN: "</span>,
  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>, len(pin_bytes)):
    <span class="hljs-keyword">if</span> pin_bytes[i] <span class="hljs-keyword">in</span> pin_map:
      <span class="hljs-keyword">print</span> pin_map[pin_bytes[i]],
  <span class="hljs-keyword">print</span></code></pre><br>
<p>   :</p><br>
<pre><code class="plaintext hljs">$ ./psoc.py <font></font>
syncing: KO OK<font></font>
Resetting PSoC: KO Resetting PSoC: KO Resetting PSoC: OK<font></font>
145495 53e2 (0000) =&gt; e2<font></font>
145511 5407 (53e2) =&gt; 25<font></font>
145527 542d (5407) =&gt; 26<font></font>
145543 5454 (542d) =&gt; 27<font></font>
145559 5474 (5454) =&gt; 20<font></font>
145575 5495 (5474) =&gt; 21<font></font>
145591 54b7 (5495) =&gt; 22<font></font>
145607 54da (54b7) =&gt; 23<font></font>
145623 5506 (54da) =&gt; 2c<font></font>
145639 5506 (5506) =&gt; 00<font></font>
145655 5533 (5506) =&gt; 2d<font></font>
145671 554c (5533) =&gt; 19<font></font>
145687 554e (554c) =&gt; 02<font></font>
145703 554e (554e) =&gt; 00<font></font>
PIN: 1 2 3 4 5 6 7 8 9</code></pre><br>
<p>! !</p><br>
<p> ,   ,  ,       PSoC – ,   .</p><br>
<a name="a8"></a><br>
<h1 id="8-chto-dalshe">8.  ?</h1><br>
<p>,     PSoC,     Aigo:</p><br>
<ul>
<li>   SRAM,      ;</li>
<li>     ,   «   »,    .</li>
</ul><br>
<p>  ,       – -   .       :</p><br>
<ul>
<li>      ,      «   »;</li>
<li> FPGA-       (    Arduino);</li>
<li>   :    ,     RAM,   ,       RAM,  .   Arduino    - ,    Arduino  5 ,            3,3 .</li>
</ul><br>
<p>  ,      –   ,     .     ,         , –  ,          .</p><br>
<p> SROM,        ReadBlock,       ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>     –     ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">«REcon Brussels 2017»</a>.</p><br>
<p>   ,      –    :    SRAM,      .</p><br>
<a name="a9"></a><br>
<h1 id="9-zaklyuchenie">9. </h1><br>
<p>,      ,         ( «») …      (),         !</p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aigoに何をお勧めできますか？</font><font style="vertical-align: inherit;">暗号化されたHDDのいくつかのモデルを分析した後、2015年に</font><font style="vertical-align: inherit;">SyScan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">についてプレゼンテーション</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を行い、</font><font style="vertical-align: inherit;">いくつかの外付けHDDのセキュリティ問題を調査し、それらの何を改善できるかについての提案を行いました。</font><font style="vertical-align: inherit;">:-)</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私はこの研究に2つの週末と数夜を費やしました。</font><font style="vertical-align: inherit;">合計約40時間。</font><font style="vertical-align: inherit;">最初（ディスクを開いたとき）から最後（ピンコードダンプ）まで数えます。</font><font style="vertical-align: inherit;">この40時間には、この記事の執筆に費やした時間も含まれています。</font><font style="vertical-align: inherit;">とてもエキサイティングな旅行でした。</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja455517/index.html">銀行業界での彼の仕事についてのNetologyコース「Data Science」の卒業生</a></li>
<li><a href="../ja455519/index.html">新しい開発者のオンボーディングを実装した方法</a></li>
<li><a href="../ja455523/index.html">OpenStack LBaaS UIの実装</a></li>
<li><a href="../ja455525/index.html">ジンブラとメール爆弾防御</a></li>
<li><a href="../ja455527/index.html">これには何が書いてあるの？JavaScriptオブジェクトの舞台裏</a></li>
<li><a href="../ja455533/index.html">バブル物理学：泡破壊メカニズムの探索</a></li>
<li><a href="../ja455535/index.html">クラウドとコンテナでのSSL / TLS証明書の管理-人間の作業ではない</a></li>
<li><a href="../ja455537/index.html">広範な検索の最適化：100億状態のグラフを処理する方法</a></li>
<li><a href="../ja455539/index.html">モバイルサイキック：ウェアラブルデバイスがあなたを見ている様子に関する10の新しい事実</a></li>
<li><a href="../ja455543/index.html">Kubernetes Clusterは準備が簡単で便利ですか？アドオンオペレーターを発表する</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>