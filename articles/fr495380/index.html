<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🚒 🧤 ➖ Grand pare-feu égyptien 👨🏾‍🎨 🙏🏾 🏟️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Une pandémie fait rage dans le monde, les gens achètent du papier hygiénique et du sarrasin à l'échelle industrielle, et la plupart des sociétés infor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Grand pare-feu égyptien</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495380/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une pandémie fait rage dans le monde, les gens achètent du papier hygiénique et du sarrasin à l'échelle industrielle, et la plupart des sociétés informatiques transfèrent des employés vers un endroit éloigné. </font><font style="vertical-align: inherit;">Mon employeur aussi - un bureau paraétatique allemand.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fondamentalement, il n'y a pas eu de problème, mais l'un de nos employés il y a un mois, alors que tout ne semblait toujours pas si effrayant, je suis allé en vacances chez mes proches en Égypte et j'ai été bloqué en toute sécurité à cause de la fermeture de la frontière. Eh bien, elle est en bonne santé elle-même, un ordinateur portable de travail avec elle - elle est en quarantaine et travaille via un VPN. Une semaine fonctionne, deux ... La troisième semaine, le VPN a cessé de se connecter. Le support de la première ligne a vérifié la banalité, comme un redémarrage - cela n'a pas aidé. La deuxième ligne a commencé à diagnostiquer: la connexion passe en timeout perpétuel à l'étape TLS Handshake. Désactivé un pare-feu local - cela n'a pas aidé. Nous avons essayé une autre voiture - cela ne fonctionne pas. Un autre fournisseur ne fonctionne pas. À ce stade, l'équipe de support a abandonné et m'a poussé avec joie le problème selon le bon vieux principe du "responsable du réseau".</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous regardons dans les journaux du serveur: il ne voit aucune tentative pour l'atteindre après avoir répondu au paquet initial. Drôle et assez familier. J'ai appelé un employé, je voulais savoir comment ils traitaient les droits de l'homme en général et la liberté d'Internet en particulier. Il dit que les choses vont mal, Internet les bloque pour que les chameaux hoquetent et Roskomnadzor fume nerveusement sur la touche. Oui ... Une recherche rapide sur Google montre un tas de plaintes concernant des problèmes VPN similaires en Égypte depuis 2017. Pour compléter le tableau, je demande si l'employée est dans le pays depuis plus de 2 semaines ces dernières années - non, dit-elle, non. Le puzzle commence à prendre forme. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous collectons une copie du serveur VPN d'entreprise sur une IP blanche gratuite - il n'y a pas de connexion. Attendu. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous changeons le port - il n'y a pas de connexion. C'est plus triste.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous changeons le protocole - il n'y a pas de connexion. </font><font style="vertical-align: inherit;">Le puzzle s'est développé - devant nous se trouve DPI comme un grand pare-feu chinois. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'employé est triste, le patron demande plaintivement: "Vous êtes un hacker russe, faites quelque chose." </font><font style="vertical-align: inherit;">Eh bien ... Découvrez l'artillerie lourde de Darknet et faites pivoter l'obfsproxy. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour un serveur (CentOS 7), cela ressemble à ceci:</font></font><br>
<br>
<pre><code class="bash hljs">~ sudo pip install virtualenv<font></font>
~ <span class="hljs-built_in">cd</span> /etc/openvpn &amp;&amp; virtualenv venv &amp;&amp; <span class="hljs-built_in">source</span> venv/bin/activate<font></font>
~ sudo pip install obfsproxy<font></font>
~ sudo -u openvpn /etc/openvpn/venv/bin/python /etc/openvpn/venv/bin/obfsproxy obfs3 --dest=127.0.0.1:1194 server 1.2.3.4:49416</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour un client (MacOS) comme celui-ci:</font></font><br>
<br>
<pre><code class="bash hljs">~ brew install pip<font></font>
~ pip install pyopenssl obfsproxy<font></font>
~ obfsproxy obfs3 socks 127.0.0.1:8443</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la configuration OpenVPN sur le client, ajoutez:</font></font><br>
<br>
<pre><code class="bash hljs">socks-proxy-retry<font></font>
socks-proxy 127.0.0.1 8443</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Profit </font><font style="vertical-align: inherit;">OpenVPN dans le wrapper obfsproxy n'est pas détecté par les algorithmes de détection de signature locale, la session décolle, les pings vont, le trafic passe, l'employé est content. </font><font style="vertical-align: inherit;">Il ne reste plus qu'à ajouter la partie client obfsproxy au chargement automatique </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de cette manière</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> «évidente» (je déteste les coquelicots). </font><font style="vertical-align: inherit;">Je dis au revoir à notre prisonnier de soulagement et j'écris une lettre pour soutenir dans l'esprit de "ce problème est résolu comme ça, mais je ne peux pas garantir la stabilité, et vous ne pouvez utiliser cette solution de contournement que s'il n'y a pas d'autre issue." </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apparemment, en Égypte, il y a une place pour un DPI particulièrement rusé, qui pour la première fois ne bloque pas la communication avec les nouveaux abonnés et / ou le trafic vers les nouveaux hôtes, en les référant à la catégorie conditionnelle «touristes». </font><font style="vertical-align: inherit;">Et après l'expiration d'un certain délai, l'utilisateur est classé comme «le sien» et coupe joyeusement le trafic pour plaire aux rois locaux.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr495368/index.html">Nous nous auto-enregistrons pour les auto-chiens qui se promènent dans des conditions d'auto-isolement</a></li>
<li><a href="../fr495370/index.html">Le public est mauvais</a></li>
<li><a href="../fr495374/index.html">Plafonnier décoratif General Lumino 02</a></li>
<li><a href="../fr495376/index.html">Ennui de quarantaine. Comment dépenser le plus d'argent dans Azure en un clic</a></li>
<li><a href="../fr495378/index.html">Conférence DEFCON 27. Buttplug: True Penetration Testing. Partie 1</a></li>
<li><a href="../fr495384/index.html">Mon expérience de stage chez Microsoft Redmond et l'obtention d'une offre</a></li>
<li><a href="../fr495388/index.html">Émission de télévision des années 1970 qui est devenue un ancêtre de l'eSport</a></li>
<li><a href="../fr495390/index.html">STM32CubeMonitor mérite un essai</a></li>
<li><a href="../fr495392/index.html">Comment rechercher des bugs sur le front-end: 4 étapes principales</a></li>
<li><a href="../fr495396/index.html">Première impression de concepts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>