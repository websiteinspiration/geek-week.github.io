<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé± üïñ üöÜ Como capturar rapidamente o mundo ou gerenciar uma rede de computadores Windows usando o OPSI üë©üèΩ‚Äçü§ù‚Äçüë©üèª ü§µüèª üê©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Isen√ß√£o de responsabilidade: 
 O autor adora muletas curtas e retas e tamb√©m adora suavemente o software livre e gratuito pela flexibilidade e escalab...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Como capturar rapidamente o mundo ou gerenciar uma rede de computadores Windows usando o OPSI</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497826/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isen√ß√£o de responsabilidade: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O autor adora muletas curtas e retas e tamb√©m adora suavemente o software livre e gratuito pela flexibilidade e escalabilidade que ele oferece. </font><font style="vertical-align: inherit;">O objetivo deste artigo √© o desejo de promover, al√©m de falar sobre o sistema de gerenciamento de software OPSI (Open PC Server Integration), indescritivelmente desconhecido na Internet russa.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu estava sentado no escrit√≥rio e tomando caf√© quando Ilon Mask me ligou e, em russo puro, me disse que j√° bastava aguentar, √© hora de reunir as melhores mentes para combater um determinado v√≠rus e, por isso, agora, cinco minutos depois, estou em casa. o escrit√≥rio trar√° 100 computadores, dos quais eu preciso implantar urgentemente o Windows 10, e amanh√£ pela manh√£ cientistas de todo o mundo v√£o ao escrit√≥rio para come√ßar a trabalhar no antiv√≠rus. </font><font style="vertical-align: inherit;">Bem, n√£o √© isso que eu tenho esperado a vida toda? </font><font style="vertical-align: inherit;">Um desafio digno para uma boa ferramenta.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para implementar o plano, usarei o sistema OPSI - Open PC Server Integration. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O OPSI √© escrito em python na Alemanha e, aparentemente, muletas, gratuitamente e escalabilidade tamb√©m gostam muito dele. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recursos b√°sicos do sistema:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implanta√ß√£o autom√°tica de software </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Funciona assim: voc√™ analisa o instalador e cria o pacote opsi, que instala o programa da maneira correta. </font><font style="vertical-align: inherit;">Funciona melhor com pacotes msi, conhece mais alguns formatos com os quais tamb√©m lida. </font><font style="vertical-align: inherit;">Ele pode executar um arquivo bat ou um script do PowerShell, mas, em princ√≠pio, qualquer int√©rprete. </font><font style="vertical-align: inherit;">Existem sistemas de registro embutidos, em geral, enchimento total, provavelmente a melhor parte do sistema.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instala√ß√£o autom√°tica de sistemas operacionais </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu uso apenas a instala√ß√£o a partir de uma imagem, como a mais r√°pida, mas existem op√ß√µes com a instala√ß√£o offline do sistema a partir do zero.</font></font></li>
<li>   <br>
<br>
         ,          ,       ,      ,      windows.  ,   ,    windows,    ,          . </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V√°rias interfaces de gerenciamento convenientes com a possibilidade de integra√ß√£o flex√≠vel </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existe um programa com interface gr√°fica, existe uma interface http para a qual voc√™ pode enviar comandos, no console do servidor, voc√™ pode controlar o OPSI, incorporar comandos em seus scripts, acessar o back-end a partir de python, mas infelizmente , enquanto eu n√£o possuo essa m√°gica.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suporte para v√°rios servidores de dep√≥sito (servidores que cont√™m diretamente o software no qual a implanta√ß√£o est√° em andamento). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode adicionar muitos servidores a cada sub-rede ou grupo de computadores, cada um servindo sua pr√≥pria rede.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recursos do sistema implementados por m√≥dulos (existem m√≥dulos gratuitos e pagos):</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conector LDAP (pago) Um </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
conector que conecta um dom√≠nio e opsi em um √∫nico todo</font></font></li>
<li>  ()<br>
<br>
     : , ...</li>
<li>MySQL  () <br>
<br>
  OPSI  mysql   ,  300 </li>
<li>Nagios  ()<br>
<br>
 </li>
<li>   ()<br>
<br>
 , opsi      ,   ,      .</li>
<li>    ()<br>
<br>
    .</li>
<li>  ()<br>
<br>
  ,   ,      ,  . ,    ansible  puppet,    .    linux  windows      .</li>
<li>WAN  ()<br>
<br>
        ,   . </li>
<li>   ()<br>
<br>
 </li>
<li>OTRS::ITSM  ()<br>
<br>
  </li>
<li>   ()<br>
<br>
 ,      ,            ,   ¬´   ¬ª,  ,  . </li>
</ol><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ pode aprender mais em detalhes aqui.O</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
modelo de monetiza√ß√£o que eles possuem √© o seguinte: eles vendem m√≥dulos at√© coletar o valor para liber√°-los. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enquanto os computadores s√£o trazidos para o meu escrit√≥rio e montados, eu instalo o servidor AD no servidor Windows, elevo o dom√≠nio domain.local nele, al√©m de DNS e DHCP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode instalar o OPSI no grupo de trabalho e no dom√≠nio, instalaremos no dom√≠nio, mas sem vincular o AD (conector LDAP).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Iremos implantar o Windows 10 em uma rede de computadores de acordo com o seguinte esquema: prepararemos uma imagem do Windows 10 implant√°vel com todos os programas, inicializaremos atrav√©s da rede via opsi, usaremos o clonezilla para salv√°-lo automaticamente em um arquivo e configuraremos todos os computadores para instalar automaticamente via opsi, inicializar atrav√©s da rede e automaticamente espalharemos esse arquivo em todos os computadores no segmento de rede de transmiss√£o via tftp. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para fazer isso, na √°rea do servidor DHCP, defina o par√¢metro 66 no ip do nosso futuro servidor opsi 192.168.1.229 </font></font><br>
<br>
<img src="https://habrastorage.org/webt/at/sl/hj/atslhjfu6ebadvwdih0bcdzzg2q.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
e o par√¢metro 67 como linux / pxelinux.0 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No DNS, adicione opsiserver.domain.local sob o endere√ßo est√°tico 192.168.1.229</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, criaremos uma m√°quina virtual para o nosso servidor opsi em ferro, que suportar√° suas cargas e atender√° voc√™ em termos de velocidade. Ssd e v√°rias placas de rede s√£o bem-vindas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Opsi n√£o suporta todos os sistemas; a lista de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">compatibilidade pode ser encontrada aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instalamos imediatamente no local ingl√™s, aconselhamos voc√™ a n√£o usar o alfabeto cir√≠lico em qualquer lugar deste servidor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Minha distribui√ß√£o favorita do debian 10 eu instalo em uma configura√ß√£o m√≠nima com o nome opsiserver. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s a instala√ß√£o e reinicializa√ß√£o, apenas no caso, configuramos os c√≥digos de idioma:</font></font><br>
<br>
<pre><code class="bash hljs">dpkg-reconfigure locales</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu seleciono tudo onde h√° de_ en_ e ru_ system leave en_US.UTF8. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A instala√ß√£o adicional √© uma recontagem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deste tutorial</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adaptada √† tarefa </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mude o nome do servidor se for diferente do que precisamos:</font></font><br>
<br>
<pre><code class="bash hljs">hostname opsiserver.domain.local</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verifica√ß√£o:</font></font><br>
<br>
<pre><code class="bash hljs">hostname -f</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos trazer o / etc / hosts para o seguinte formul√°rio:</font></font><br>
<br>
<pre><code class="plaintext hljs">127.0.0.1 localhost<font></font>
127.1.1.1 localhost.localdomain<font></font>
192.168.1.229 opsiserver.domain.local opsiserver</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E esqueceremos sua exist√™ncia para sempre, uma vez que a opsi exige o conte√∫do desse arquivo e, quando √© alterada, √†s vezes come√ßa a se rebelar e polvilhar com erros. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instale os pacotes necess√°rios:</font></font><br>
<br>
<pre><code class="bash hljs">apt install wget host pigz mc -y</code></pre> <br>
<pre><code class="bash hljs">apt install samba samba-common smbclient cifs-utils -y </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instalamos o servidor mysql por padr√£o, o maria-db se levanta para mim, ele tamb√©m funciona.</font></font><br>
<br>
<pre><code class="bash hljs">apt install default-mysql-server -y</code></pre><br>
<pre><code class="bash hljs">sudo mysql_secure_installation</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Respondemos as perguntas afirmativamente, alterando a senha root e lembrando-a. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inclua reposit√≥rios OPSI no sistema:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">echo</span> <span class="hljs-string">"deb http://download.opensuse.org/repositories/home:/uibmz:/opsi:/4.1:/stable/Debian_10/ /"</span> &gt; /etc/apt/sources.list.d/opsi.list</code></pre><br>
<pre><code class="bash hljs">wget -nv https://download.opensuse.org/repositories/home:uibmz:opsi:4.1:stable/Debian_10/Release.key -O Release.key<font></font>
apt-key add - &lt; Release.key</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Atualizada:</font></font><br>
<br>
<pre><code class="bash hljs">apt update</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Removemos o tftpd, se houver, pois o OPSI entrar√° em conflito com ele:</font></font><br>
<br>
<pre><code class="bash hljs">apt remove tftpd</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Removemos o suporte tftp do inetd, porque se houver, o OPSI entrar√° em conflito com ele:</font></font><br>
<br>
<pre><code class="bash hljs">update-inetd --remove tftp<font></font>
apt install opsi-tftpd-hpa</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E instale diretamente o servidor opsi:</font></font><br>
<br>
<pre><code class="bash hljs">apt install opsi-server</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
no processo, eles solicitar√£o os dados necess√°rios para criar um certificado autoassinado, que por sua vez √© necess√°rio para a conex√£o criptografada dos clientes com o servidor. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instale o suporte do Windows:</font></font><br>
<br>
<pre><code class="bash hljs">apt install opsi-windows-support</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
configure o back-end do mysql:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-setup --configure-mysql</code></pre><br>
<img src="https://habrastorage.org/webt/b0/7g/zh/b07gzhpoteem9-pgzopqghvkmga.png" width="600" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Definimos o endere√ßo do servidor (host local), o usu√°rio do qual estamos atuando (root), a senha root no mysql (da qual nos lembramos anteriormente), o nome do banco de dados para opsi (opsi), o nome do usu√°rio que trabalhar√° nesse banco de dados (opsi), a senha desse usu√°rio (inventamos Novo). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, para o debian 10, voc√™ precisa adicionar / usr / sbin ao PATH:</font></font><br>
<br>
<pre><code class="bash hljs">PATH=<span class="hljs-variable">$PATH</span>:/usr/sbin</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
e a mesma linha deve ser adicionada ao .bashrc no seu diret√≥rio pessoal. </font><font style="vertical-align: inherit;">Se isso n√£o for feito, na pr√≥xima etapa voc√™ receber√° o erro "chpasswd n√£o encontrado". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inicializamos o sistema e definimos os direitos necess√°rios para os arquivos e diret√≥rios do sistema:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-setup --init-current-config<font></font>
opsi-set-rights</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reinicializa√ß√£o do servi√ßo:</font></font><br>
<br>
<pre><code class="bash hljs">systemctl restart opsiconfd.service<font></font>
systemctl restart opsipxeconfd.service</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Configure o samba:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-setup --auto-configure-samba</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os clientes OPSI se conectam ao servidor principal via https na porta 4447 e, se voc√™ precisar chamar algum tipo de instala√ß√£o, os clientes montam a bola de samba no servidor opsi e instalam o software a partir dele. </font><font style="vertical-align: inherit;">Para tornar isso poss√≠vel, permitimos que o OPSI reconfigure o samba. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rein√≠cio do Samba:</font></font><br>
<br>
<pre><code class="bash hljs">systemctl restart smbd.service<font></font>
systemctl restart nmbd.service</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Defina a senha do administrador para o usu√°rio do sistema pcpatch: </font></font><br>
<br>
<pre><code class="bash hljs">opsi-admin -d task setPcpatchPassword</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora crie um usu√°rio para administrar o sistema:</font></font><br>
<br>
<pre><code class="bash hljs">useradd -m -s /bin/bash adminuser</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Crie uma senha para ele:</font></font><br>
<br>
<pre><code class="bash hljs">passwd adminuser</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora a senha para o samba, eu crio a mesma que no sistema:</font></font><br>
<br>
<pre><code class="bash hljs">smbpasswd -a adminuser</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adicione ao grupo:</font></font><br>
<br>
<pre><code class="bash hljs">usermod -aG pcpatch adminuser</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se faremos algo com o OPSI sob a raiz, precisamos adicionar a raiz ao grupo:</font></font><br>
<br>
<pre><code class="bash hljs">usermod -aG pcpatch root</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais algumas muletas:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-setup --patch-sudoers-file</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora voc√™ pode baixar pacotes para o sistema e, enquanto est√£o carregando, beba caf√©.</font></font><br>
<br>
<pre><code class="bash hljs">opsi-package-updater -v install</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Posteriormente, os pacotes podem ser atualizados com o comando:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-package-updater -v update</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora v√° para </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://download.uib.de/opsi4.1/misc/helper/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , fa√ßa o download e instale a interface de gerenciamento configurada por opsi para </font></font><br>
<br>
<code>opsi-configed-setup.exe</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
entrar no servidor, digite o endere√ßo do servidor, nosso usu√°rio administrador e sua senha, </font></font><br>
<br>
<code>https://opsiserver.domain.local:4447/</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
e estamos no sistema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste ponto, o servidor est√° instalado! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a-/yg/ft/a-ygftvat-_6wioezy6v7rmuszq.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1 - todos os clientes conectados a este servidor, eles podem ser desmontados em grupos, inclusive os aninhados, aplicam a atribui√ß√£o a todo o grupo de uma s√≥ vez. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 - uma guia com clientes, esta √© uma lista dos computadores controlados pela opsi </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3 - clientes s√£o uma lista, aqui voc√™ pode selecion√°-los em qualquer ordem para aplicar o objetivo </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4 - "configura√ß√£o do produto" - v√≠tima de tradu√ß√£o. De fato, existem pacotes que podem ser instalados no Windows, na terminologia opsi - localboot products</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5 - Produtos Netboot - √© tudo o que √© baixado pela rede </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6 - opsi-mac-address - a papoila do computador √© o que √© determinado durante a inicializa√ß√£o da rede </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7 - opsiHostKey √© a "senha" do cliente no sistema opsi, se voc√™ a excluir de cliente opsi do computador e, em seguida, reinstale-o, n√£o funcionar√°, pois a senha permanecer√° antiga e n√£o ser√° adequada. Isso √© um bug e um recurso. E como voc√™ faria? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos preparar a imagem do Windows 10 que iremos derramar. O Clonezilla, que usaremos, n√£o √© t√£o bom quanto o acronis, mas ainda sabe como espalhar a imagem de um disco menor para o mesmo ou maior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Colocamos no sistema todos os programas de que precisamos, al√©m das Ferramentas de Administra√ß√£o de Servidor Remoto para Windows 10. Eu tenho o Windows 10 1903, instalei o 1803 e tudo o que precisa ser iniciado. Voc√™ pode baix√°-lo aqui:</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.microsoft.com/en-us/download/details.aspx?id=45520</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Precisamos dele para o utilit√°rio netdom, que permite que voc√™ insira automaticamente o computador no dom√≠nio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para fazer isso, </font><font style="vertical-align: inherit;">baixamos os </font><font style="vertical-align: inherit;">arquivos aqui </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/valmont2k/renamejoin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no diret√≥rio c: \ renamejoin. Criamos um administrador de dom√≠nio no controlador de dom√≠nio com a capacidade de inserir apenas computadores no dom√≠nio com o login do Joinadmin com a senha password1234QWE. Se um invasor intercepta essa senha, ele pode trazer apenas computadores para o nosso dom√≠nio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Execute a linha de createtesk.txt no console administrativo do Windows totalmente preparado, o que criar√° uma tarefa para iniciar na inicializa√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo o esquema funcionar√° da seguinte maneira:</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando dividir a imagem em todos os computadores, no primeiro boot, o Windows ir√° iniciar uma tarefa </font></font><code>C:\renamejoin\step1.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que muda o nome do computador para </font></font><code>win-%random%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, reinicie o computador, apagar </font></font><code>C:\renamejoin\step1.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e renomear </font></font><code>C:\renamejoin\step2.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font><code>C:\renamejoin\step1.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Na pr√≥xima inicializa√ß√£o, o Windows ser√° iniciado </font></font><code>C:\renamejoin\step1.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o que entrar√° neste computador no dom√≠nio, o reinicializar√° e o excluir√° </font></font><code>C:\renamejoin\step1.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Podemos remover a tarefa potencialmente perigosa dos computadores do dom√≠nio posteriormente. Atrav√©s da OPSI, √© claro! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ft/58/nn/ft58nnalinh1dzsqyx2clhilaym.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â hora de converter o Windows preparado em uma imagem.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Atrav√©s do √≠cone do computador com um sinal de adi√ß√£o, adicione nosso computador √† interface de gerenciamento opsi opsi-configure, defina seu endere√ßo de papoula. </font><font style="vertical-align: inherit;">Salve ÓÅë. </font><font style="vertical-align: inherit;">Passamos aos produtos Netboot, em frente ao clonezilla, colocamos "setup". </font><font style="vertical-align: inherit;">Na configura√ß√£o do cliente, expomos tudo como na captura de tela: o nome do arquivo e o comando pelo qual preenchemos o disco inteiro na imagem. </font><font style="vertical-align: inherit;">No BIOS do computador com Windows, configuramos o download da rede. </font><font style="vertical-align: inherit;">Reinicie o comp. </font><font style="vertical-align: inherit;">Se voc√™ fez tudo corretamente, ver√° como o Windows flui para a imagem sem a ajuda das m√£os. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wu/zi/e6/wuzie6bgshbkngnutgpsqw9lfz0.png" width="500" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enquanto isso, os computadores s√£o montados, mas precisam ser adicionados como clientes em opsi, juntamente com seus endere√ßos de papoula, acrescentando-os com canetas n√£o √© de todo um assunto de boatos, certo? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A solu√ß√£o √©:</font></font><br>
<br>
<pre><code class="bash hljs">apt install tcpdump</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Execute no opsiserver:</font></font><br>
<br>
<pre><code class="bash hljs">tcpdump -n udp -vvvvv -e port 69 &gt; /var/<span class="hljs-built_in">log</span>/tftp</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, definindo as configura√ß√µes do BIOS para todos os computadores inicializarem pela rede (e ao mesmo tempo acordarem dos dispositivos PCI-E, pela rede, voc√™ entender√° o motivo mais tarde), carregue-os. Se a janela azul do menu de inicializa√ß√£o opsi aparecer durante a inicializa√ß√£o, </font></font><br>
<br>
<img src="https://habrastorage.org/webt/po/7c/h7/po7ch7eco5daftbhmaqr3fspcjs.png" width="500" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
voc√™ estar√° fazendo tudo certo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao inicializar, os computadores acessam nosso servidor, o tcpdump grava seus endere√ßos de papoula em um arquivo </font></font><code>/var/log/tftp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e usando um script de repo </font></font><code>https://github.com/valmont2k/opsi-hosts-importer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para executar no opsiserver depois que todos os computadores s√£o marcados em opsi e deixam seus endere√ßos de papoula l√°. Este script usa a API opsi aqui </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://download.uib.de/opsi4.1/experimental/documentation/html/opsi-api-documentation/opsi_API.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e um pouco de m√°gica. Ap√≥s inici√°-lo, voc√™ ter√° clientes no opsiserver do formul√°rio win% random32% .domain.local</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O pr√≥ximo passo √© converter a imagem do Windows (que j√° deveria ter sido feita) em todos os computadores. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yn/6g/ik/yn6gikht6l5aizhym_t839uk7mo.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para fazer isso, selecione todos os computadores nos quais voc√™ precisa instalar o Windows e, ao lado do clonezilla, definimos os valores como na captura de tela. Voc√™ desliga os computadores, depois liga v√°rios deles e observa como o Windows rola automaticamente para eles, eles pr√≥prios s√£o renomeados e inseridos no dom√≠nio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ quiser automatizar isso tamb√©m, coloque etherwake e escreva um script que, com um atraso especificado, retire os endere√ßos mac do arquivo / tmp / newmacs e ative seus hosts para que eles revezem o Windows. Veja a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atualiza√ß√£o 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fiz um gesto de Ronaldo com um an√∫ncio de xampu e j√° estava fazendo as malas para tomar caf√© quando Ilon Mask ligou novamente no meu telefone e acrescentou:</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Sim, esqueci de dizer, √© necess√°rio que a </font></font><code>%program%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vers√£o mais recente esteja </font><font style="vertical-align: inherit;">em todos os computadores amanh√£ </font><font style="vertical-align: inherit;">, voc√™ consegue lidar com isso? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Claro, tudo ser√° amanh√£! </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o posso perturbar o √≠dolo dos tecnocratas, ent√£o voc√™ precisa colocar seu c√©rebro de volta em suas m√£os. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seria bom se, na inicializa√ß√£o, os computadores configurassem um cliente opsi chamado opsi-client-agent. Isso pode ser feito por meio de pol√≠ticas de grupo de dom√≠nio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para que isso ocorra sem inserir uma senha durante a instala√ß√£o, √© necess√°rio </font><font style="vertical-align: inherit;">
adicionar a senha do seu usu√°rio </font><font style="vertical-align: inherit;">no </font><font style="vertical-align: inherit;">arquivo </font></font><br>
<code>/var/lib/opsi/depot/opsi-client-agent/files/opsi/cfg/config.ini</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no opsiserver </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como o valor de service_hidden_password</font></font><code>adminuser</code><font style="vertical-align: inherit;"></font><code>base64</code><br>
<br>
<pre><code class="plaintext hljs">[installation]<font></font>
service_user=adminuser<font></font>
service_password=none<font></font>
service_hidden_password=base64HERE</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, adicione a pol√≠tica de grupo no dom√≠nio setupOPSI e use o script a partir daqui.Lembre- </font></font><code>https://github.com/valmont2k/opsi-install-opsi-client-agent-over-active-directory-domain-policy</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
se de inserir seus valores no script. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pi/bq/gr/pibqgrvntzwy6vlhvkwljjs4fki.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ fez tudo corretamente, na primeira reinicializa√ß√£o no dom√≠nio, os clientes instalar√£o </font></font><code>opsi-client-agent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, reiniciar√£o e aparecer√£o sob seus nomes </font></font><code>win-%random%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na interface de gerenciamento OPSI. </font><font style="vertical-align: inherit;">Clientes antigos com os mesmos endere√ßos de papoula podem ser exclu√≠dos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora voc√™ pode prosseguir para a instala√ß√£o </font></font><code>%program%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√≥s vamos aqui </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://forum.opsi.org/viewtopic.php?f=22&amp;t=7573</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e encontramos um link para o pacote </font></font><code>*.opsi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com o nome </font></font><code>packagebuilder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, algo como </font></font><code>"opsi PackageBuilder Windows (opsi Paket)"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fa√ßa o download do pacote para o diret√≥rio </font></font><code>/var/lib/opsi/workbench</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no opsiserver</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> /var/lib/opsi/workbench</code></pre><br>
<pre><code class="bash hljs">wget https://opsipackagebuilder.s3.amazonaws.com/opsiPackageBuilder/python/opsipackagebuilder_8.4.4-1.opsi </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
e instale-o:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-package-manager -d ALL -i opsipackagebuilder_8.4.4-1.opsi</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, na interface de gerenciamento opsi, clique no bot√£o de atualiza√ß√£o e veja se temos novos pacotes </font></font><code>opsipackagebuilder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>opsi-setup-detector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√≥s os colocamos atrav√©s da interface de controle em uma m√°quina de teste no Windows. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando o programa </font></font><code>opsipackagebuilder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>opsi-setup-detector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estabelecida, run </font></font><code>opsi-setup-detector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and play off-lo no programa de instala√ß√£o </font></font><code>windirstat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, descarregado a partir do pr√©-programa oficial website. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de instalar, voc√™ precisa definir as configura√ß√µes do programa. Montamos a bola na m√°quina de teste \\ opsiserver.domain.local \ opsi_workbench como unidade z: escrevemos nosso nome e email nos campos especificados: a </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a3/zx/gz/a3zxgzhluvq6-vb6utpdveqfoqi.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OPSI pode criar um pacote usando 32 e 64 instaladores ao mesmo tempo e defini-los com base na capacidade do sistema, temos 64 bits em todos os lugares, ent√£o clique em "Analisar arquivo √∫nico ...":</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n-/ev/s9/n-evs94sic7qrqsafbish6zhjno.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vimos que o detector n√£o entendeu o diret√≥rio de instala√ß√£o, podemos descobrir por n√≥s mesmos tentando instalar o programa atrav√©s do instalador. Mas ele detectou o tipo de instalador, a vers√£o do programa, o tamanho do aplicativo na forma montada e implantada, a chave de instala√ß√£o offline, a chave de remo√ß√£o offline e o nome do desinstalador. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vh/u7/ys/vhu7ysu1f6hjlkxbvuetosk2xcu.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entramos no diret√≥rio de instala√ß√£o e clicamos em Pr√≥ximo passo: </font></font><br>
<img src="https://habrastorage.org/webt/wl/lx/nf/wllxnfx3gtvrhtdspigvxznyply.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui voc√™ pode adicionar o nome do produto, seu ID, descri√ß√£o e definir a vers√£o do pacote, ou seja, colocar na tentativa que fazemos para montar o pacote (no nosso caso, a primeira tentativa): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ip/_g/fa/ip_gfarn7c49hwtnvhdy0cnxesm.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode adicionar depend√™ncias, significa que, para instalar o pacote atual, os pr√≥prios pacotes colocados para instala√ß√£o s√£o aqueles indicados nos requisitos para o nosso: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/be/mn/os/bemnosq2zhjnugxp5ywu8ahysqi.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Criar pacote OPSI: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vd/s8/-2/vds8-2ho3zriw5pt7l4dtjouhpq.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Criamos o pacote, agora precisamos ir para o opsiserver em</font></font><code>/var/lib/opsi/workbench/windirstat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Colete o pacote:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-makepackage</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instale-o:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-package-manager -d ALL -i windirstat-1.1.2-1.opsi</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se tudo correu bem, na interface de gerenciamento configurado pelo opsi, clique no bot√£o "atualizar" e verifique se temos um novo pacote </font></font><code>windirstat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que pode ser instalado em computadores selecionados em nossa rede. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bingo! </font><font style="vertical-align: inherit;">O primeiro pacote est√° montado! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para complicar nossa tarefa, usando o powershell, criaremos uma regra no firewall do Windows que dar√° acesso ao cliente nas portas 4441 e 4447 e carregaremos automaticamente esse aplicativo para o usu√°rio atrav√©s do ajuste do registro, como se fosse, por exemplo, um mensageiro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abra o construtor de pacotes opsi: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ry/35/br/ry35brmfbx9wcefpvejn45ofq1i.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Escolha abrir o pacote e abra nosso pacote com windirstat:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7q/fi/tb/7qfitbgjqlx1kceksjhko2qokc0.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O OPSI, por padr√£o, age da seguinte maneira: quando voc√™ remove um programa de uninstall.opsiscript, delsub.opsiscript √© chamado, o que remove o programa. Ao instalar um programa a partir de setup.opsiscript, delsub.opsiscript √© chamado, o que remove o programa e, em seguida, o setup.opsiscript o instala. Portanto, fazemos edi√ß√µes para criar algo em setup.opsiscript e edi√ß√µes para excluir algo em delsub.opsiscript. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toda a magia desses scripts est√° refletida na documenta√ß√£o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://download.uib.de/opsi4.1/documentation/html/en/opsi-winst-manual/opsi-winst-manual.html</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
setup.opsiscript pode ser aberta atrav√©s do √≠cone de l√°pis e delsub.opsiscript via √Årvore de scripts. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bk/_s/y_/bk_sy_fdgjsl6x4lbokjcrtjhc0.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° o menu completo do arquivo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o9/wc/lb/o9wclbi4d3hob_bx9mdrlibnxwi.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada tentativa de compilar um pacote deve ser aumentada em um.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/km/8n/ry/km8nrypi8ie323expcio-ms0kum.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√≥s adicionamos o programa para carregar automaticamente via opsi, para isso, insira as linhas em setup.opsiscript:</font></font><br>
<br>
<pre><code class="plaintext hljs">Registry_changes  /AllNTUserdats /64bit<font></font>
[Registry_changes]<font></font>
OpenKey [Software\Microsoft\Windows\CurrentVersion\Run]<font></font>
Set "WinDirStat" = "C:\Program Files (x86)\WinDirStat\windirstat.exe"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E no delsub.opsiscript, insira as linhas:</font></font><br>
<br>
<pre><code class="plaintext hljs">Registry_changes  /AllNTUserdats /64bit<font></font>
[Registry_changes]<font></font>
OpenKey [HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run]<font></font>
;Set "WinDirStat" = "C:\Program Files (x86)\WinDirStat\windirstat.exe"<font></font>
DeleteVar "WinDirStat"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adicionamos a regra ao firewall executando o script powershell, para isso, insira as linhas em setup.opsiscript:</font></font><br>
<br>
<pre><code class="plaintext hljs">DosInAnIcon_PowerShell_ExecutionPolicy<font></font>
ExecWith_PowerShell_NichtPDCAktionen powershell.exe winst /sysnative<font></font>
[DosInAnIcon_PowerShell_ExecutionPolicy]<font></font>
echo "powershell set-executionpolicy RemoteSigned ..."<font></font>
powershell.exe set-executionpolicy RemoteSigned<font></font>
exit %ERRORLEVEL%<font></font>
<font></font>
[ExecWith_PowerShell_NichtPDCAktionen]<font></font>
; hier Dein PS-Code<font></font>
<font></font>
New-NetFirewallRule -DisplayName 'OPSI-Inbound' -Profile @('Domain', 'Private', 'Public') -Direction Inbound -Action Allow -Protocol TCP -LocalPort @('4441', '4447')</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E no delsub.opsiscript, insira as linhas:</font></font><br>
<br>
<pre><code class="plaintext hljs">DosInAnIcon_PowerShell_ExecutionPolicy<font></font>
ExecWith_PowerShell_NichtPDCAktionen powershell.exe winst /sysnative<font></font>
[DosInAnIcon_PowerShell_ExecutionPolicy]<font></font>
echo "powershell set-executionpolicy RemoteSigned ..."<font></font>
powershell.exe set-executionpolicy RemoteSigned<font></font>
exit %ERRORLEVEL%<font></font>
<font></font>
[ExecWith_PowerShell_NichtPDCAktionen]<font></font>
; hier Dein PS-Code<font></font>
Remove-NetFirewallRule -DisplayName 'OPSI-Inbound'</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O c√≥digo completo pode ser visto aqui: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/valmont2k/WinDirStatOpsiPackageTest</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Eu j√° relaxei, vendo o opsi rolar a </font></font><code>%program%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vers√£o mais recente para toda a rede, enquanto Ilon novamente interrompeu meus pensamentos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Na pr√≥xima semana, outras 500 pessoas chegar√£o, escrit√≥rios j√° foram alugados, computadores est√£o sendo importados, existe um networker, voc√™ precisa implantar uma rede windows em seis filiais da cidade, voc√™ consegue lidar com isso? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Bem, √© claro, isso n√£o √© ci√™ncia do foguete - brinquei cansado em resposta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Clonamos nosso servidor opsiserver usando o hipervisor e o implantamos na ramifica√ß√£o. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assumimos que o escrit√≥rio central esteja conectado √†s filiais por meio de uma VPN com uma velocidade de pelo menos 10 Mbps.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos criar um servidor de dep√≥sito, ou seja, um servidor para armazenar pacotes na filial. </font><font style="vertical-align: inherit;">Os clientes na filial batem em https no servidor principal e, se voc√™ precisar instalar o software, eles montam o servidor de dep√≥sito em sua filial e s√£o instalados a partir dele, isso √© feito especialmente para salvar o canal da Internet entre o escrit√≥rio e a filial. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Configuramos no servidor de filial opsiserver-2 um endere√ßo est√°tico da rede local, alterando o arquivo de </font></font><code>/etc/network/interfaces</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acordo com a nova rede. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Altere o nome do host e os hosts:</font></font><br>
<br>
<pre><code class="bash hljs">sed -i <span class="hljs-string">'s/opsiserver/opsiserver-2/'</span> /etc/hostname<font></font>
sed -i <span class="hljs-string">'s/opsiserver/opsiserver-2/g'</span> /etc/hosts</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
em / etc / hosts, atualizamos os dados dirigindo para um novo endere√ßo IP </font></font><br>
<br>
<pre><code class="bash hljs">reboot</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Renomeie o servidor opsi usando opsi:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-admin --no-depot -d method host_renameOpsiDepotserver opsiserver.domain.local opsiserver-2.domain.local</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No servidor opsiserver-2.domain.local, n√≥s o conectamos ao opsiserver.domain.local como dep√≥sito:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-setup --register-depot</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Especifique o nome do servidor principal ao qual conectamos o novo dep√≥sito, administrador e senha: Voc√™ </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yx/02/y_/yx02y_bcvpikxgkubku2-fl8try.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
n√£o precisa alterar nada aqui </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">Voc√™ </font></font><br>
<br>
<img src="https://habrastorage.org/webt/n2/1j/_l/n21j_lmeiwlsn3ghmkcxr4yadgg.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pode verificar se tudo foi feito corretamente em opsi-configed: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6u/s9/nu/6us9nurw4d3rsetl0nemcy_x_re.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, √© necess√°rio configurar o sistema para que os clientes escolham o servidor do dep√≥sito. Selecionamos todos os clientes e os definimos como dep√≥sito din√¢mico. Por padr√£o, o cliente examina seu endere√ßo IP e seleciona o dep√≥sito de sua rede. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vp/4v/mg/vp4vmg0czhi2vmkwobeddecf1dc.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora configuramos que todos os futuros clientes escolhem imediatamente o dep√≥sito dinamicamente: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h7/-j/c4/h7-jc4kpf-5vyavsz_mckjp44-a.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√© isso, a configura√ß√£o do novo servidor de dep√≥sito est√° conclu√≠da, voc√™ pode instalar o opsi-client-agent para computadores na rede local com o mesmo script que instalamos anteriormente no escrit√≥rio principal, n√£o esquecendo de mudar o endere√ßo IP dentro do script.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em cada filial, configuramos um controlador de dom√≠nio (voc√™ pode apenas ler), fazemos nosso pr√≥prio endere√ßamento de rede, dividimos o site padr√£o dentro do dom√≠nio do Windows em sub-sites, cada um dos quais fazemos nossa sub-rede, nossa pol√≠tica de grupo com seu script de instala√ß√£o do agente opsi-client-agent. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o repetimos no novo ramo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu terminei meu caf√© e fui para casa, e o LED na placa de rede sinalizava que novos e novos sistemas estavam sendo lan√ßados ao barulho dos refrigeradores ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Atualiza√ß√£o 1: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como se viu, n√£o h√° necessidade de script, o opsi-configed permite que o mouse clique no despertar dos clientes atrav√©s do sheduler.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt497814/index.html">Cinco est√°gios de aceita√ß√£o do inevit√°vel, ou Como desenvolvemos um programa para cria√ß√£o de perfil automatizado</a></li>
<li><a href="../pt497816/index.html">A Russian Railways me envia os bilhetes de outra pessoa</a></li>
<li><a href="../pt497818/index.html">Acesso remoto a VMs com GPU usando Citrix</a></li>
<li><a href="../pt497820/index.html">Regulariza√ß√£o estat√≠stica de problemas inversos incorretos para eles. Turchin (parte 1)</a></li>
<li><a href="../pt497822/index.html">Homem garrafa</a></li>
<li><a href="../pt497828/index.html">2 em 1: criptografia com prote√ß√£o de seguran√ßa</a></li>
<li><a href="../pt497830/index.html">Grava√ß√µes OWASP Moscow 2020/1</a></li>
<li><a href="../pt497832/index.html">O que est√° escondido atr√°s do VestaCP</a></li>
<li><a href="../pt497834/index.html">Sistema avan√ßado de autoriza√ß√£o de recursos no Laravel. Parte 2. Gateways, Pol√≠ticas</a></li>
<li><a href="../pt497836/index.html">Compara√ß√£o da velocidade de linguagens de programa√ß√£o usando o exemplo de solu√ß√£o do problema de treinamento de uma rede neural</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>