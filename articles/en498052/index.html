<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöù üë®‚Äçüîß üñçÔ∏è Zabbix 5.0, or What's New With Template Server by IPMI ‚ùáÔ∏è üë©üèΩ‚Äçü§ù‚Äçüë®üèæ üëçüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="You need to put the equipment under monitoring, and in your favorite Zabbix system there is no ready-made template for this type of equipment. Familia...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Zabbix 5.0, or What's New With Template Server by IPMI</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jetinfosystems/blog/498052/"><img src="https://habrastorage.org/webt/qb/2s/vv/qb2svvvulvembgowfo16hune6kq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You need to put the equipment under monitoring, and in your favorite Zabbix system there is no ready-made template for this type of equipment. </font><font style="vertical-align: inherit;">Familiar situation? </font><font style="vertical-align: inherit;">Everyone gets out of it in his own way. </font><font style="vertical-align: inherit;">One administrator is looking for a solution on the Internet. </font><font style="vertical-align: inherit;">The second is developing its own. </font><font style="vertical-align: inherit;">And some will give up on this task. </font><font style="vertical-align: inherit;">Now the Zabbix team with each new release expands the set of predefined templates in the system. </font><font style="vertical-align: inherit;">For example, in the upcoming version 5.0, a new universal template for monitoring servers via IPMI will appear - Template Server by IPMI. </font><font style="vertical-align: inherit;">Colleagues asked for help in debugging his work on equipment of various manufacturers. </font><font style="vertical-align: inherit;">For us, this is still a unique opportunity to arrange a test drive for new functionality. </font><font style="vertical-align: inherit;">We share the results.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What does the new template look like? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to monitor your server using this template, you need to create a ‚Äúhost‚Äù in the system with configured monitoring via IPMI and attach a Template Server by IPMI template to it (Fig. 1). There will be no detailed description of this operation: detailed instructions are in the official Zabbix documentation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fig. 1. Template Server Template by IPMI</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eab/b66/5ae/eabb665aebebd1dcbb76251f4fd6bf30.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consider the principles of this template and its structure. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The basis of the template is the ipmitool utility. It allows you to get the necessary statistics from the equipment through IPMI. Using the functionality of this utility and obtaining all the necessary data is now available to the user via the web interface using the IPMI agent data element type and the special ipmi.get key. This was only possible thanks to the appearance of the ipmi.get key in the new version. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the Template Server by IPMI template, the Item Get IPMI sensors data element is responsible for organizing the collection of information using this new functionality (Fig. 2). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fig. 2. Item Get IPMI sensors item</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3d1/c93/42f/3d1c9342fdfcc52a10728b7f7217e737.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result of the operation of the Item Get IPMI sensors data element, information on the state of equipment in a structured JSON format appears in the Zabbix system (Fig. 3). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fig. </font><font style="vertical-align: inherit;">3. An example of the result of the operation item Get IPMI sensors</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3dd/7a2/614/3dd7a26140cff08a6c94c1e43439f47a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition to the Item Get IPMI sensors data element, the template also has two Discrete sensors discovery detection rules (Fig. 4) and Threshold sensors discovery (Fig. 5). </font><font style="vertical-align: inherit;">These discovery rules use the JSON resulting from the operation of the Item Get IPMI sensors data item to automatically create new data items and triggers. </font><font style="vertical-align: inherit;">This is clearly seen in the figures below in the Master item section. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fig. </font><font style="vertical-align: inherit;">4. Discrete sensors discovery rule</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a09/50e/c78/a0950ec78ae4ae2bb7bac56b5fcc7a6c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fig. </font><font style="vertical-align: inherit;">5. Threshold sensors discovery rule</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5d9/f2d/f0b/5d9f2df0b22d287f153c5ec934f538a1.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Why does the template use two detection rules, and not one? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Discrete sensors discovery enables the automatic creation of data elements that are of type string in their values. And the detection rule Threshold sensors discovery allows you to automatically create data elements that are of the type "number" in their values. Moreover, this rule can form up to 6 triggers for each data element (Fig. 6). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Values ‚Äã‚Äãfor trigger conditions are taken from JSON, i.e. from the device itself. Triggers are created for 6 thresholds: lower dangerous, lower critical, lower non-critical, upper non-critical, upper critical, upper dangerous. If a value for a threshold is missing in JSON, a trigger is not created.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In an educated trigger, the threshold can be redefined at the Zabbix level. </font><font style="vertical-align: inherit;">However, in our opinion, the most logical way to change a trigger is to convert it at the equipment level. </font><font style="vertical-align: inherit;">How to do this is usually indicated in the instructions for the device. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fig. </font><font style="vertical-align: inherit;">6. 6 prototype triggers for detection rules Threshold sensors discovery</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/772/26b/190/77226b1904a38f64c3721c6709df9463.png"></div><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We harness and go.</font></font></strong><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
To test the Template Server by IPMI template, we selected servers from three manufacturers: IBM, HP and Huawei. </font><font style="vertical-align: inherit;">A few minutes after the connection, the results shown in the table were obtained from them. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Table 1. Template Server by IPMI Test Results</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Equipment manufacturer</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Equipment model</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Number of automatically created data items</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Number of Triggers Automatically Created</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HP</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProLiant DL360 G5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">twenty</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Huawei</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1288H V5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">175</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">56</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ibm</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System x</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">139</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">27</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All equipment was successfully able to get up to monitoring using a new template and a new ipmi.key. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Most of the data we were able to get from Huawei equipment, and least of all - from HP. </font><font style="vertical-align: inherit;">The reason for this lies in the difference in the hardware of the devices and is not related to the quality of work of the new template. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the screenshots below you can see the data elements and triggers automatically created by the template. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fig. </font><font style="vertical-align: inherit;">7. Data Elements Automatically Created by the Template</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/caa/6d2/1b6/caa6d21b6c1a76171143301767da2610.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fig. </font><font style="vertical-align: inherit;">8. Triggers automatically created by the template.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f38/9fd/19b/f389fd19b353ee63f4bbee48995ad923.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* * * </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Template Server by IPMI proved to be the best. It turned out to be easy to use and, most importantly, ‚Äúuniversal.‚Äù </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Template Server by IPMI template will be included in the list of base templates of Zabbix version 5.0. For our part, we strongly support this approach of the manufacturer. Even if specialists are forced to create their own specialized templates, we recommend taking as a basis the approaches laid down by the manufacturer itself and observed in Template Server by IPMI. First, use automatic item detection using the master item. And secondly, apply automatic trigger detection using the master item in cases where this is possible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well and look forward to the release of Zabbix 5.0 soon!</font></font><br>
<br>
<i>:  ,    ¬´ ¬ª</i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en498036/index.html">Mark Andriessen: It's time to create for ourselves (It's Time to Build)</a></li>
<li><a href="../en498038/index.html">The digest of fresh materials from the world of the front-end for the last week No. 411 (April 13-19, 2020)</a></li>
<li><a href="../en498042/index.html">Parse, not validate</a></li>
<li><a href="../en498046/index.html">Researchers are developing an approach to reducing bias in computer vision datasets</a></li>
<li><a href="../en498050/index.html">Culture as the basis for scaling the x2 team every year. About hiring mistakes and culture fit</a></li>
<li><a href="../en498054/index.html">Defeat the Dragon News Feed: Making Sure You Live a Good Life</a></li>
<li><a href="../en498056/index.html">Digital events in Moscow from April 20 to 26</a></li>
<li><a href="../en498060/index.html">PostgreSQL Industrial Tuning Approach: Database Experiments. Nikolay Samokhvalov</a></li>
<li><a href="../en498062/index.html">IBM Weekly Seminars - April 2020</a></li>
<li><a href="../en498064/index.html">Classic Market Emulator</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>