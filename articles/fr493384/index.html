<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🅰️ ⚾️ 📚 Pas un jour sans sport: reprogrammer un moniteur de fréquence cardiaque chinois 🧗🏻 💉 👷🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=""Écoutez, quel genre de fréquence cardiaque devriez-vous avoir en faisant du jogging?" 
 - Eh bien, je ne sais pas - 150 hits 
 - Oui? Pourquoi ai-je ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Pas un jour sans sport: reprogrammer un moniteur de fréquence cardiaque chinois</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493384/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Écoutez, quel genre de fréquence cardiaque devriez-vous avoir en faisant du jogging?" </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Eh bien, je ne sais pas - 150 hits </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Oui? Pourquoi ai-je 840? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- 840 par minute?! </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Et quoi, il fallait considérer une minute ou quoi? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Qu'as-tu pensé?" </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Eh bien, j'ai juste compté jusqu'à ce que je me perde ... Alors, d'accord, je suis allé raconter." </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(film "Election Day") </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Presque exactement sur le moniteur de fréquence cardiaque chinois. Comme dit le proverbe, si vous voulez bien faire quelque chose, faites-le vous-même. Et si l'appareil ne fonctionne pas comme il est requis, alors peut-être qu'il sera possible de l'améliorer?</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/fe/pp/23/fepp230sxqy_lyvvcnoihcc1_ey.png"></div><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De nombreuses personnes intéressées par le sport surveillent leur fréquence cardiaque pendant l'exercice. </font><font style="vertical-align: inherit;">Pour cela, des moniteurs de fréquence cardiaque sont utilisés. </font><font style="vertical-align: inherit;">Ce n'est pas la tâche de cet article de considérer tous leurs types, mais l'un des plus fiables et éprouvés est le capteur cardiaque du torse qui reçoit des signaux électriques du cœur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le cadre de mon activité physique considérablement accrue, le </font><font style="vertical-align: inherit;">moniteur de </font></font><abbr title="Rythme cardiaque"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fréquence cardiaque</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kyto 2809 a </font><font style="vertical-align: inherit;">été acheté </font><font style="vertical-align: inherit;">. Le pouls est bon, mais il était nécessaire de mesurer avec précision les intervalles RR. </font><font style="vertical-align: inherit;">Le moniteur de fréquence cardiaque prend en charge deux protocoles: ANT + et BLE. </font><font style="vertical-align: inherit;">Selon les spécifications, les deux transmettent, en plus de la fréquence cardiaque directe, la durée des intervalles RR.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quels sont les intervalles RR</font></font></b><div class="spoiler_text">RR  –     R    .<br>
<br>
<img src="https://habrastorage.org/webt/yd/in/ea/ydineadtr4darurwgdkucttqlse.png"><br>
 RR   ,  .     .        ,   (.    «  RR »   « »).         .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour enregistrer les données des deux canaux, une application Android a été écrite pour répondre à vos besoins avec un journal de données dans des fichiers texte. </font><font style="vertical-align: inherit;">Un moniteur de fréquence cardiaque analogique a été envoyé en tant que norme plus ou moins adéquate, envoyant un signal à une fréquence de 5,3 kHz, connecté directement à un PC via un arduino. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La première comparaison a été légèrement attristée.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/kf/yp/xw/kfypxwjqzbjd1jif9yp-dh9kto0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le «dispositif» pour un battement cardiaque réel a montré 4-5 inexistant (sur le graphique bleu, vous pouvez voir une abondance de points). </font><font style="vertical-align: inherit;">L'impulsion, même en tenant compte de la moyenne possible, ne brille pas avec précision. </font><font style="vertical-align: inherit;">La mesure des intervalles RR de la parole ne va pas du tout. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La communication avec le fabricant n'a pas donné de résultats. </font><font style="vertical-align: inherit;">En plus de plusieurs vidéos, tente de me convaincre que tout va bien et des phrases: "Les données de fréquence cardiaque KYTO2809 sont exactes!", Je n'ai rien obtenu d'eux. </font><font style="vertical-align: inherit;">Puis son regard tomba sur la boîte avec des tournevis. </font><font style="vertical-align: inherit;">En ouvrant le boîtier, j'ai découvert la puce nRF51422.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/au/wi/0b/auwi0bchg8cuiqj74jaz-elv49g.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sachant qu'il existe un SDK pour ces MK, j'ai décidé d'essayer de le reflasher. </font><font style="vertical-align: inherit;">Le programme le plus simple est nécessaire là-bas: à partir de l'amplificateur des signaux électriques du cœur (une goutte noire sur la photo), le signal va à l'entrée MK, puis c'est une question de technique, nous captons les impulsions à travers les interruptions, mesurons le temps entre elles et affichons tout cela via BLE et ANT +. </font><font style="vertical-align: inherit;">Tout est simple, mais apparemment quelque chose s'est mal passé avec les programmeurs chinois. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces puces sont programmées via SWD. </font><font style="vertical-align: inherit;">Le firmware natif était protégé contre la lecture. </font><font style="vertical-align: inherit;">Par conséquent, sans hésitation, la commande </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«format c:»</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> «--eraseall» a été exécutée. </font><font style="vertical-align: inherit;">La carte affiche même les contacts correspondants. </font><font style="vertical-align: inherit;">Entrée de l'amplificateur de signaux électriques du cœur P0.07. </font><font style="vertical-align: inherit;">Le brochage du module BLE lui-même est (de haut en bas):</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GND</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vdd</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P0.30</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P0.00</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P0.01</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P0.02</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P0.03</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P0.04</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P0.05</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P0.06</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P0.07</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P0.08</font></font><br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le SDK contient de nombreux exemples suffisants pour écrire votre propre firmware. La puce est assez ancienne et le SDK pour elle est également obsolète, version 10. En les utilisant, les services BLE ont été augmentés sur le moniteur de fréquence cardiaque: informations sur l'appareil, service de batterie, fréquence cardiaque. Un profil HeartRate a été ajouté pour ANT +. Nous mesurons les intervalles RR avec une minuterie, envoyons des données aux profils BLE et ANT +. Pour économiser de la charge en l'absence de stimuli externes (dans les 5 secondes), le moniteur de fréquence cardiaque est mis en mode veille. Lorsqu'une impulsion apparaît (interruptions à l'entrée), le MK se réveille. Dans le firmware du fabricant, Kyto2809 a constamment transmis des paquets publicitaires via BLE, c'est-à-dire en utilisant uniquement le canal ANT +, BLE a continué à envoyer des paquets et à décharger la batterie. J'ai limité le temps de publicité à 5 minutes, ce qui devrait avoir un effet positif sur la rentabilité.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les tests ont montré que pour le paramètre de fréquence cardiaque calculée, il est préférable d'introduire un filtrage (éliminer les données délibérément inexactes, c'est-à-dire une impulsion inférieure à 30 et supérieure à 240) et une moyenne avec une moyenne mobile. La comparaison finale avec le moniteur de fréquence cardiaque analogique ci-dessous. Différences dans les mesures des intervalles RR de 0-2 ms, ce qui est tout à fait acceptable.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/aa/rw/qw/aarwqwkdl2sg16sbflzjv2itsw0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parmi les fonctions utiles, la possibilité de mettre à jour le firmware OTA (nom d'origine DFU OTA) a été ajoutée. </font><font style="vertical-align: inherit;">Maintenant, après avoir cousu le chargeur de démarrage OTA, vous pouvez facilement mettre à jour le firmware si vous voulez changer quelque chose dans le code. </font><font style="vertical-align: inherit;">Le firmware se fait à partir du smartphone via l'utilitaire propriétaire nRFConnect. </font><font style="vertical-align: inherit;">De plus, si je ne me trompe pas, vous pouvez prendre en charge OTA dans votre application Android, il existe des bibliothèques pour cela. </font><font style="vertical-align: inherit;">Malheureusement, pour remplir le chargeur de démarrage en mémoire, vous devez vous connecter via SWD, car </font><font style="vertical-align: inherit;">L'OTA n'a pas été initialement fourni par le fabricant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Commande du firmware:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cousons SoftDevice310</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , c'est BLE et ANT + une pile nordique;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous cousons Kyto_DFU_bootloader.hex (le boîtier peut être assemblé);</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">via nRFConnect remplir le package fini kyto_hr_dfu.zip</font></font><br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les deux derniers fichiers sont </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il existe également un firmware sans OTA (KytoHR.hex).</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr493374/index.html">Coronavirus - conseils pratiques et un peu de théorie</a></li>
<li><a href="../fr493376/index.html">The Big Initiative Theory - Expérience russe dans la transformation numérique des entreprises industrielles</a></li>
<li><a href="../fr493378/index.html">Steam vous a: comment la distribution numérique retire nos jeux</a></li>
<li><a href="../fr493380/index.html">Julia et l'informatique quantique</a></li>
<li><a href="../fr493382/index.html">Mises à jour du concepteur Windows Forms .NET Core</a></li>
<li><a href="../fr493386/index.html">Comment traite-t-on le coronavirus?</a></li>
<li><a href="../fr493390/index.html">Présentation de .NET 5 Preview 1</a></li>
<li><a href="../fr493392/index.html">L'apprentissage automatique à Kazan, ou comment les spécialistes de l'apprentissage automatique sont formés au Tatarstan</a></li>
<li><a href="../fr493394/index.html">Syndrome de Dieu: l'histoire de la propagation du principal spécialiste des maladies infectieuses du coronavirus du territoire de Stavropol (a) *</a></li>
<li><a href="../fr493396/index.html">Résumé sur les méthodes de prévision</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>