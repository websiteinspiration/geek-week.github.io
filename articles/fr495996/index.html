<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🉐 🙏 👩‍🔧 Raspberry Pi, Python et arrosage des plantes d'intérieur 🌪️ 🎹 🌀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je n'ai aucune relation avec les plantes d'intérieur. Le fait est que j'oublie de les arroser. Sachant cela, j'ai commencé à réfléchir sur le fait que...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Raspberry Pi, Python et arrosage des plantes d'intérieur</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/495996/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je n'ai aucune relation avec les plantes d'intérieur. </font><font style="vertical-align: inherit;">Le fait est que j'oublie de les arroser. </font><font style="vertical-align: inherit;">Sachant cela, j'ai commencé à réfléchir sur le fait que quelqu'un, à coup sûr, avait déjà trouvé un moyen d'automatiser l'irrigation. </font><font style="vertical-align: inherit;">Il s'est avéré qu'il existe de nombreuses façons. </font><font style="vertical-align: inherit;">À savoir, nous parlons de solutions basées sur Arduino ou Raspberry Pi. </font><font style="vertical-align: inherit;">Dans cet article, je veux parler de la façon dont j'ai créé un système basé sur Raspberry Pi et Python, conçu pour automatiser l'arrosage des plantes.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/yl/yf/f3/ylyff31evrdtianmwk_5stnbgf4.jpeg"></a><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Composants et ressources utiles</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je voudrais tout de suite noter que je ne suis pas du tout un expert en électronique. </font><font style="vertical-align: inherit;">S'ils me demandent de dessiner un schéma électrique ou de raconter en détail le fonctionnement d'un composant électronique, je ne peux rien dessiner ni dire. </font><font style="vertical-align: inherit;">En fait, j'ai fait ce projet avec seulement des connaissances de base en électricité et juste en expérimentant avec des composants. </font><font style="vertical-align: inherit;">Je vous demande d'être très prudent lorsque vous travaillez avec l'électricité. </font><font style="vertical-align: inherit;">Et, si vous ressentez un manque de connaissances dans ce domaine, je suggère au moins un peu de compréhension de cela. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici une liste des composants que j'ai utilisés dans mon projet.</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kit de démarrage Raspberry Pi 3</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pompe à eau, 12V</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alimentation, 12V</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Relais, 5V</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Câbles de connexion</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Câbles avec connecteurs crocodile</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tubes en silicone</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je participe au programme d'affiliation Amazon, les liens ci-dessus sont donc fournis. </font><font style="vertical-align: inherit;">Si vous passez par eux et achetez quelque chose, je gagnerai un peu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir obtenu tous les composants dont j'ai besoin, il est temps de faire des recherches. </font><font style="vertical-align: inherit;">Voici une liste de ressources qui m'ont aidé à connecter correctement les composants électroniques et à comprendre les principaux points concernant leur fonctionnement:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment fonctionne l'électricité</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment utiliser un relais</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alimentation du relais Raspberry Pi</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connexion d'une alimentation 12V à un relais</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un schéma des ports GPIO du Raspberry Pi.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e1e/0bf/981/e1e0bf981b31d01f59837b4885bc31ba.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diagramme du port GPIO du Raspberry Pi</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connectez un relais au Raspberry Pi</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai commencé par connecter un relais au Raspberry Pi. </font><font style="vertical-align: inherit;">Voici à quoi ça ressemble.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ec3/cf5/763/ec3cf5763b5451d4a4bf9b6da4fc4a95.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connexion du relais au Raspberry Pi Le</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
fil rouge (femelle-femelle) va de la broche de la carte relais JD_VCC à la broche 5V (broche n ° 2) du Raspberry Pi. </font><font style="vertical-align: inherit;">Un fil orange (femelle-femelle) mène de la broche de la carte relais VCC à la broche 3,3 V (broche n ° 1) du Raspberry Pi.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4a6/17c/868/4a617c868ef4a058c20f714a1c7b6fad.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Broches JD_VCC et VCC de la carte relais</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
À l'aide de ces fils, nous</font><i><font color="#999999"><font style="vertical-align: inherit;"> alimentons</font></font></i><font style="vertical-align: inherit;"> la carte relais. </font><font style="vertical-align: inherit;">Pour pouvoir contrôler des relais individuels, vous devez connecter la carte relais et le Raspberry Pi avec deux autres fils qui se connectent aux broches GND et IN1 de la carte relais.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/071/ec9/94e/071ec994e83748306c3a9d35e8dc0791.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Broches GND et IN1 de la carte relais Le</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
fil noir (femelle-femelle) est le câble de terre qui relie la broche GND de la carte relais et la broche de terre du Raspberry Pi (je l'ai connecté à la broche n ° 34). </font><font style="vertical-align: inherit;">Un fil blanc (femelle-femelle) mène de la broche IN1 de la carte relais à la broche n ° 12 du Raspberry Pi. </font><font style="vertical-align: inherit;">C'est ce fil blanc qui nous permet de contrôler par programmation le relais, en activant et désactivant les relais individuels situés sur la carte.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/226/d5c/d14/226d5cd14bb1dd4ad3f31ae02bace405.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fils noir et blanc connectés au Raspberry Pi</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Si vous décidez de reproduire mon projet, vous pouvez organiser le relais et le Raspberry Pi pour communiquer en utilisant les broches appropriées. </font><font style="vertical-align: inherit;">Mais gardez à l'esprit que si le schéma de connexion des composants de votre projet est différent du schéma de connexion des composants de mon projet, vous devrez apporter les modifications appropriées à mon code.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connexion de l'alimentation au relais</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir connecté la carte relais au Raspberry Pi, j'ai connecté l'alimentation à l'un des relais. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ne branchez pas l'alimentation sur une prise de courant avant d'avoir terminé toutes les opérations de collecte des composants du système. </font><font style="vertical-align: inherit;">Soyez conscient du risque de choc électrique.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4b3/95a/d58/4b395ad58f4d7384efeb067ede209486.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connexion de l'alimentation à l'un des relais L'</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
alimentation 12V utilisée par moi est livrée avec un adaptateur auquel il est pratique de connecter les fils de connexion. </font><font style="vertical-align: inherit;">J'ai connecté le fil rouge (mâle-mâle) au connecteur «+» de l'adaptateur et le câble marron (mâle-mâle) au connecteur «-» de l'adaptateur. </font><font style="vertical-align: inherit;">Ensuite, j'ai connecté le câble avec le connecteur «Crocodile» (femelle-mâle) au fil marron.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0fc/faf/f7f/0fcfaff7f05b281f5cc23e73bf66fcc6.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adaptateur fourni avec l'alimentation électrique</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
La carte relais comporte quatre relais séparés. </font><font style="vertical-align: inherit;">Chacun d'eux a trois broches auxquelles les câbles peuvent être connectés. </font><font style="vertical-align: inherit;">Au centre de chaque relais se trouve un connecteur auquel la sortie positive d'une source d'alimentation externe est connectée. </font><font style="vertical-align: inherit;">Sur la gauche se trouve le connecteur auquel l'entrée positive de l'appareil auquel l'alimentation doit être connectée est connectée.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c64/ecd/dca/c64ecddca0322384223dc85d0e397526.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connexion d'un relais séparé</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
J'ai connecté un câble rouge de l'alimentation (borne positive) au contact central du relais. </font><font style="vertical-align: inherit;">Ensuite, j'ai connecté le câble orange (mâle-mâle) au connecteur gauche du relais et connecté le câble avec le «crocodile» (femelle-mâle) à ce câble.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3f7/7ee/a36/3f77eea36c73477d3e50dbfcb4148c21.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Câbles rouges et orange</font></font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ff3/9e3/6b9/ff39e36b9e57544b8167c24d5d2d773f.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alimentation et adaptateur</font></font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/98d/38d/875/98d38d875d52addfa9d57b245b61ce2c.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Relais et Raspberry Pi</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connexion d'une pompe à eau à un relais</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il ne reste plus qu'à brancher les connecteurs «crocodiles» à la pompe à eau. </font><font style="vertical-align: inherit;">L'ordre de leur connexion détermine le sens du débit d'eau. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai donc eu besoin d'eau pour entrer dans le canal gauche de la pompe et sortir du canal droit. </font><font style="vertical-align: inherit;">Par conséquent, j'ai connecté le connecteur «crocodile» du fil noir à la borne de pompe, près de laquelle il y a un point rouge, et l'autre «crocodile» à l'autre borne de pompe. </font><font style="vertical-align: inherit;">Si je connectais les «crocodiles» dans un ordre différent - l'eau irait dans la direction opposée - du canal droit vers la gauche.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/059/a2f/bc0/059a2fbc0b0267b29ec9800fc13405f2.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connexion d'une pompe à eau à un relais</font></font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/84b/755/96b/84b75596b0b1ad9d0277e58e2ddd06fa.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Système d'irrigation complet: l'eau pénètre dans la pompe par le canal de gauche, quitte la droite et va à l'usine</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le code</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous sommes donc arrivés à ce que je suis vraiment bon. Nous sommes arrivés au code. Afin de faire fonctionner le logiciel avec les ports GPIO du Raspberry Pi, j'ai utilisé la bibliothèque </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gpiozero</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il est facile à utiliser, il cache de nombreux mécanismes de bas niveau au programmeur, que vous devez généralement comprendre pour quelqu'un qui veut travailler avec des broches GPIO. La bibliothèque est bien documentée. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant d'écrire du code, vous devez connecter un moniteur, une souris et un clavier à votre Raspberry Pi. Ou vous devez vous connecter au Raspberry Pi via </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSH</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir entré Raspberry Pi, accédez au dossier </font></font><code>Desktop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et créez-y un dossier </font></font><code>run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Créez un dossier dans ce dossier </font></font><code>classes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Et dans le dossier, </font></font><code>classes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">créez un fichier </font></font><code>Hardware.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Il doit avoir le code suivant:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> gpiozero <span class="hljs-keyword">import</span> OutputDevice<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Relay</span>(<span class="hljs-params">OutputDevice</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, pin, active_high</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(Relay, self).__init__(pin, active_high)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce fichier, je viens de déclarer une nouvelle classe </font></font><code>Relay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui est la descendante de la classe </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OutputDevice</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, dans le dossier, </font></font><code>classes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">j'ai créé un nouveau fichier </font></font><code>TimeKeeper.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> datetime<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TimeKeeper</span>:</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, current_time</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.current_time = current_time<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.time_last_watered = <span class="hljs-literal">None</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">set_current_time</span>(<span class="hljs-params">self, updated_time</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.current_time = updated_time<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">set_time_last_watered</span>(<span class="hljs-params">self, updated_time</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.time_last_watered = updated_time<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;@staticmethod<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_current_time</span>():</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;now = datetime.datetime.now()<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> now.strftime(<span class="hljs-string">"%I:%M:%S %p"</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le but de cette classe est de suivre l'heure actuelle et le moment où le dernier arrosage a été effectué. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, les fichiers </font></font><code>Hardware.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et se </font></font><code>TimeKeeper.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trouvent dans le dossier </font></font><code>classes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Maintenant, en dehors de ce dossier, je crée un fichier </font></font><code>water_plant.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> classes <span class="hljs-keyword">import</span> Hardware
<span class="hljs-keyword">from</span> classes <span class="hljs-keyword">import</span> TimeKeeper <span class="hljs-keyword">as</span> TK
<span class="hljs-keyword">import</span> schedule
<span class="hljs-keyword">import</span> smtplib
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> ssl<font></font>
<font></font>
<span class="hljs-comment"># WATERING_TIME must be in "00:00:00 PM" format</span>
WATERING_TIME = <span class="hljs-string">'11:59:50 AM'</span>
SECONDS_TO_WATER = <span class="hljs-number">10</span>
RELAY = Hardware.Relay(<span class="hljs-number">12</span>, <span class="hljs-literal">False</span>)<font></font>
EMAIL_MESSAGES = {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'last_watered'</span>: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'subject'</span>: <span class="hljs-string">'Raspberry Pi: Plant Watering Time'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'message'</span>: <span class="hljs-string">'Your plant was last watered at'</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'check_water_level'</span>: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'subject'</span>: <span class="hljs-string">'Raspberry Pi: Check Water Level'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'message'</span>: <span class="hljs-string">'Check your water level!'</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_email</span>(<span class="hljs-params">time_last_watered, subject, message</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;port = <span class="hljs-number">465</span>
&nbsp;&nbsp;&nbsp;&nbsp;smtp_server = <span class="hljs-string">"smtp.gmail.com"</span>
&nbsp;&nbsp;&nbsp;&nbsp;FROM = TO = <span class="hljs-string">"YOUR_EMAIL@gmail.com"</span>
&nbsp;&nbsp;&nbsp;&nbsp;password = <span class="hljs-string">"YOUR_PASSWORD"</span><font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;complete_message = <span class="hljs-string">''</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> time_last_watered == <span class="hljs-literal">False</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;complete_message = <span class="hljs-string">"Subject: {}\n\n{}"</span>.format(subject, message)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">else</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;complete_message = <span class="hljs-string">"Subject: {}\n\n{} {}"</span>.format(subject, message, time_last_watered)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;context = ssl.create_default_context()<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">with</span> smtplib.SMTP_SSL(smtp_server, port, context=context) <span class="hljs-keyword">as</span> server:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.login(FROM, password)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.sendmail(FROM, TO, complete_message)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_last_watered_email</span>(<span class="hljs-params">time_last_watered</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;message = EMAIL_MESSAGES[<span class="hljs-string">'last_watered'</span>][<span class="hljs-string">'message'</span>]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;subject = EMAIL_MESSAGES[<span class="hljs-string">'last_watered'</span>][<span class="hljs-string">'subject'</span>]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;send_email(time_last_watered, subject, message)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_check_water_level_email</span>():</span>
&nbsp;&nbsp;&nbsp;&nbsp;message = EMAIL_MESSAGES[<span class="hljs-string">'check_water_level'</span>][<span class="hljs-string">'message'</span>]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;subject = EMAIL_MESSAGES[<span class="hljs-string">'check_water_level'</span>][<span class="hljs-string">'subject'</span>]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;send_email(<span class="hljs-literal">False</span>, subject, message)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">water_plant</span>(<span class="hljs-params">relay, seconds</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;relay.on()<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;print(<span class="hljs-string">"Plant is being watered!"</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;time.sleep(seconds)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;print(<span class="hljs-string">"Watering is finished!"</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;relay.off()<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;time_keeper = TK.TimeKeeper(TK.TimeKeeper.get_current_time())<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>(time_keeper.current_time == WATERING_TIME):<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;water_plant(RELAY, SECONDS_TO_WATER)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time_keeper.set_time_last_watered(TK.TimeKeeper.get_current_time())<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(<span class="hljs-string">"\nPlant was last watered at {}"</span>.format(time_keeper.time_last_watered))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment"># send_last_watered_email(time_keeper.time_last_watered)</span><font></font>
<font></font>
<span class="hljs-comment"># schedule.every().friday.at("12:00").do(send_check_water_level_email)</span><font></font>
<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment"># schedule.run_pending()</span>
&nbsp;&nbsp;&nbsp;&nbsp;time.sleep(<span class="hljs-number">1</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;main()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, vous pouvez modifier les valeurs des variables </font></font><code>WATERING_TIME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>SECONDS_TO_WATER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">celles qui vous conviennent. La première variable détermine le temps d'arrosage des plantes. Le second définit la durée de l'arrosage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, j'ai créé ici un mécanisme d'envoi de notifications et de rappels par e-mail. Grâce à ce mécanisme, le propriétaire du système d'irrigation reçoit un e-mail chaque fois que le système est allumé et arrose les plantes. En outre, chaque vendredi, il reçoit une lettre lui rappelant qu'il doit vérifier l'approvisionnement en eau d'irrigation. Dans le code, l'appel des méthodes correspondantes est mis en commentaire, par conséquent, le programme peut fonctionner normalement sans paramètres relatifs à l'e-mail. Si vous souhaitez activer ces rappels, procédez comme suit:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous devez entrer dans la ligne </font></font><code>FROM = TO = «YOUR_EMAIL@gmail.com»</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>password = «YOUR_PASSWORD»</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">votre adresse e-mail et mot de passe Gmail.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Décommentez les lignes suivantes: </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;# send_last_watered_email (time_keeper.time_last_watered)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># schedule.every (). friday.at ("12:00"). do (send_check_water_level_email)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># schedule.run_pending ()</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous devez aller </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , connectez-vous à votre compte Gmail et activez le commutateur sur cette page. </font><font style="vertical-align: inherit;">Sinon, lorsque vous essayez d'envoyer un e-mail à l'aide de Gmail, vous recevrez un message d'erreur.&nbsp;</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, il est important de noter que mon système de rappel ne fonctionne qu'avec les comptes Gmail. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant que tout est prêt pour le travail, vous devez obtenir la structure suivante de fichiers et de dossiers:</font></font><br>
<br>
<pre><code class="bash hljs">run<font></font>
├── classes<font></font>
│ ├── Hardware.py<font></font>
│ └── TimeKeeper.py<font></font>
└── water_plant.py<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un dossier </font></font><code>run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut en fait être placé n'importe où. </font><font style="vertical-align: inherit;">J'ai décidé de le laisser dans le dossier </font></font><code>Desktop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'étais pas attiré par la perspective de me connecter au Raspberry Pi à chaque fois que je devais le démarrer </font></font><code>water_plant.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">J'aimerais que ce script s'exécute automatiquement lorsque le Raspberry Pi est allumé. </font><font style="vertical-align: inherit;">Cela, par exemple, permettrait d'éteindre facilement le système, de le déplacer vers un autre endroit, de l'allumer et de ne se soucier de rien. </font><font style="vertical-align: inherit;">Pour mettre en œuvre ce scénario attractif, nous avons besoin d'une équipe </font></font><code>crontab</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ouvrez la fenêtre du terminal sur le Raspberry Pi et entrez la commande suivante:</font></font><br>
<br>
<pre><code class="bash hljs">sudo crontab -e
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En réponse, le système doit produire quelque chose ressemblant à celui illustré dans la figure suivante.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ca0/3cd/f45/ca03cdf45a0400ea64b5e163357e9079.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuration des tâches cron</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ajoutez la ligne suivante à ce fichier:</font></font><br>
<br>
<pre><code class="bash hljs">@reboot python3 /home/pi/Desktop/run/water_plant.py
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, ce fichier doit être enregistré en utilisant la combinaison de touches </font></font><code>Ctrl+X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en entrant </font></font><code>Y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et en appuyant sur </font></font><code>Enter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la ligne ci-dessus, nous donnons au Raspberry Pi les instructions suivantes: "Chaque fois que vous redémarrez, exécutez le fichier </font></font><code>water_plant.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">situé dans le dossier </font></font><code>run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui se trouve dans le dossier </font></font><code>Desktop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">." </font><font style="vertical-align: inherit;">Si votre dossier </font></font><code>run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se trouve d'une manière différente, modifiez cette commande en conséquence.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sommaire</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consultez le code du projet </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Si vous le souhaitez, vous pouvez immédiatement cloner votre référentiel avec cette commande:</font></font><br>
<br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/AlanConstantino/rpi-plant-project.git
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout! </font><font style="vertical-align: inherit;">Vous savez maintenant comment créer un système d'irrigation automatisé pour les plantes d'intérieur basé sur le Raspberry Pi. </font><font style="vertical-align: inherit;">Elle sait arroser les plantes toutes les 24 heures et peut envoyer des notifications et des rappels par e-mail à son propriétaire. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chers lecteurs! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment feriez-vous pour développer un système d'arrosage automatisé à domicile?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/iq/fi/b4/iqfib45pgphfrxv--zfemt0qnmw.jpeg"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr495982/index.html">Nous étudions le moteur VoIP Mediastreamer2. Partie 4</a></li>
<li><a href="../fr495984/index.html">React, performance et -500 millisecondes au lancement - l'historique de nos optimisations en chiffres</a></li>
<li><a href="../fr495986/index.html">Analyse de documents internationaux sur la gestion des risques de sécurité de l'information. Partie 2</a></li>
<li><a href="../fr495990/index.html">Divulgation de numéro de téléphone et géolocalisation par vulnérabilité dans Telegram</a></li>
<li><a href="../fr495994/index.html">Début du trimestre académique ou comment je suis devenu coordinateur de l'enseignement à distance</a></li>
<li><a href="../fr495998/index.html">Création d'un thème sombre pour le débordement de pile</a></li>
<li><a href="../fr496004/index.html">Nouveaux modèles de recherche et d'analyse de données. WSDM 2020 à travers les yeux de l'équipe Yandex.Tolki</a></li>
<li><a href="../fr496006/index.html">Proxy inverse dépassé - technologie pour la protection à distance et l'optimisation du site sans modifier les enregistrements DNS A</a></li>
<li><a href="../fr496010/index.html">Qu'arrive-t-il aux transports pendant la crise (première semaine d'avril)</a></li>
<li><a href="../fr496014/index.html">Séminaires hebdomadaires IBM - avril 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>