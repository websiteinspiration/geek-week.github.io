<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª üè° üòä Telur Paskah di ionCube - upaya pengembang untuk menyapu sampah di bawah karpet? ü§üüèø üöΩ üßòüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pengembang web tahu bahwa skrip yang dibuat untuk tujuan komersial dapat berjalan-jalan di jaringan dengan hak cipta yang ditimpa; ada kemungkinan bah...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Telur Paskah di ionCube - upaya pengembang untuk menyapu sampah di bawah karpet?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/506890/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/kc/lp/mo/kclpmoxrvrfvypeaomwmvyezwhu.jpeg"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengembang web tahu bahwa skrip yang dibuat untuk tujuan komersial dapat berjalan-jalan di jaringan dengan hak cipta yang ditimpa; </font><font style="vertical-align: inherit;">ada kemungkinan bahwa skrip akan mulai dijual kembali atas nama orang lain. </font><font style="vertical-align: inherit;">Untuk menyembunyikan kode sumber skrip dan mencegah perubahannya, obfuscator, minifiers, dll. Digunakan. </font><font style="vertical-align: inherit;">Salah satu alat tertua dan paling terkenal untuk mengenkripsi skrip dalam PHP adalah ionCube. </font><font style="vertical-align: inherit;">Diperkenalkan pada tahun 2002, ia terus memantau pengembangan PHP dan menyatakan dukungan untuk versi terbaru platform. </font><font style="vertical-align: inherit;">Seperti yang akan saya tunjukkan dalam artikel ini, ionCube jauh dari baik dengan dukungan PHP 7 ...</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Model untuk menggunakan enkripsi PHP sedemikian rupa sehingga programmer menjual skrip yang dienkripsi, dan pembeli skrip harus menginstal modul ekstensi pada servernya yang akan memungkinkan skrip yang dienkripsi untuk dieksekusi. </font><font style="vertical-align: inherit;">Skrip yang dienkripsi oleh ionCube terlihat seperti ini:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span> <span class="hljs-comment">//0059b</span>
<span class="hljs-comment">// 10.2 72</span>
<span class="hljs-comment">// </span>
<span class="hljs-comment">// IONCUBE ONLINE ENCODER EVALUATION</span>
<span class="hljs-comment">// THIS FILE IS LICENSED TO BE USED FOR ENCODER TESTING</span>
<span class="hljs-comment">// PURPOSES ONLY AND SHOULD NOT BE DISTRIBUTED</span>
<span class="hljs-comment">// </span>
<span class="hljs-keyword">if</span>(!extension_loaded(<span class="hljs-string">'ionCube Loader'</span>)){$__oc=strtolower(substr(php_uname(),<span class="hljs-comment">//skipped</span><font></font>
<font></font>
<span class="hljs-meta">?&gt;</span><font></font>
HR+cPn5yR+EksbFLjyZwm7EQh7Q0Y6YO6pLddgsuLRlBWUC5JWhAm3KcPBcRdP9D0zkMmdPNk5VG<font></font>
rMP1GxIwsA5NinHkQjWqG2pHL5nIZUvatUW+XMas3Knjf4wz9+DJoq47N1qZLDXwVzpOOupqa+Y4<font></font>
k8PPXt8WNYXL4gbJnVu6NrqBqqwOrtlHUE9Sc30fMfAAEDTAVfa7ADHT2egTb5xxy9RGlDCjGlma<font></font>
RxoL1LvxvYcfe48f44x/H+GVTM7dPaYyy9DozcJjt3l8EDxcD73d67cWOtDgQGixQEmBlYJO7Cvh<font></font>
IAfeCBywIrDMgWfCC80uEIX+WtSmt/PuI7OXMgsNG3yVZu2HXJvXFRmXvc6748uxr+Zh0uZnAqeL<font></font>
pkJB5K9H5qbMr4YM/Aig+<span class="hljs-number">7</span>MhwVG3KJ0kQCEhKxJe7+<span class="hljs-number">7</span>Un/jSGcwQ8HKa/<span class="hljs-number">90</span>ePzH2EXazm3T87pf2<font></font>
hXL/exl4L7hutt/MfDGjculaEOCaoDLlUJjJqeXJL3kFDUsiPFfEL/BwAYUqe2pJAMjWXn7YIUt7<font></font>
Y1DdTUD4ob/<span class="hljs-number">5</span>fwE9wQwfG6PfDLPFkrGVKFpkBa95sRuA7qgtXATacXAVzsfYMxZgbwF3RcI5IxQo<font></font>
HTgnCg57vWmM/u6swJrgkz+<span class="hljs-number">747</span>DWZRS1TfJZnKbdbmWIHAW11HG2FloKdWWSIronfqnuXTI/j2/R
<span class="hljs-number">9</span>hX1Uim6mQowBwjS5zHZY8WFU9xE1KgETkCTsaDZODg9NYTICKs5aAdujzAtzxLWSicHZCfmpgzd<font></font>
FRhqYTYE1B9wktZsItkssDaq+xlyTZ+<span class="hljs-number">0</span>LGnXAC6eaH7npS7w3NRBRj9ySVTRYPXBraVuJViMIX+U
<span class="hljs-number">4</span>IzHJDFSNiT818GtS7erlLKcbGn4OZ40Ee3XEiicFzVrOfOvH0rJT3LZgVqY+KMtjqaQike2P4Dd<font></font>
A0SOuqOlFgQitYoo</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengguna </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">telah lama memperhatikan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bahwa ketika modul Loader ionCube dimuat, dua fungsi global dengan nama yang sangat aneh muncul di PHP: </font></font><code>_dyuweyrj4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;dan </font></font><code>_dyuweyrj4r</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Jika Anda memanggil salah satu dari fungsi-fungsi ini, maka PHP akan mencetak salah satu dari dua aforisme berbahasa Mandarin, dan menyelesaikan eksekusi: </font><font style="vertical-align: inherit;">
Dapat dilihat bahwa garis keluaran tidak bergantung pada fungsi yang dipanggil, dan dipilih secara acak. </font><font style="vertical-align: inherit;">
Muncul pertanyaan: mengapa fungsi-fungsi ini diperlukan, dan apa yang mereka lakukan?</font></font><br>
<br>
<code>C:\php&gt;<b>php -r "_dyuweyrj4(); echo 'Hmm..';"</b><br>
A rat who gnaws at a cat's tail invites destruction.<br>
<br>
C:\php&gt;<b>php -r "_dyuweyrj4(); echo 'Hmm..';"</b><br>
Do good, reap good; do evil, reap evil.<br>
<br>
C:\php&gt;<b>php -r "_dyuweyrj4r(); echo 'Hmm..';"</b><br>
Do good, reap good; do evil, reap evil.</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eksperimen sederhana</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, mari kita lihat parameter apa yang </font></font><code>_dyuweyrj4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diperlukan: </font><font style="vertical-align: inherit;">
Kelihatannya dibutuhkan dua angka, tetapi tidak peduli berapa nomor itu mencetak kata-kata mutiara yang sama.</font></font><br>
<br>
<code>C:\php&gt;<b>php -r "_dyuweyrj4(1,2,3);"</b><br>
PHP Warning: _dyuweyrj4() expects at most 2 parameters, 3 given in Standard input code on line 1<br>
<br>
C:\php&gt;<b>php -r "_dyuweyrj4('foo', 'bar');"</b><br>
PHP Warning: _dyuweyrj4() expects parameter 1 to be int, string given in Standard input code on line 1<br>
<br>
C:\php&gt;<b>php -r "_dyuweyrj4(1, 'bar');"</b><br>
PHP Warning: _dyuweyrj4() expects parameter 2 to be int, string given in Standard input code on line 1<br>
<br>
C:\php&gt;<b>php -r "_dyuweyrj4(1, 2);"</b><br>
A rat who gnaws at a cat's tail invites destruction.</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pencarian Penggunaan</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada beberapa forum Indonesia yang berlumpur, saya berhasil menemukan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contoh</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> yang dijejalkan pada tahun 2013 </font><font style="vertical-align: inherit;">&nbsp;- kemungkinan besar, diperoleh oleh beberapa bytecode PHP disassembler:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tconnect</span>(<span class="hljs-params"> </span>)
</span>{<font></font>
    $__tmp = _dyuweyrj4( <span class="hljs-number">21711392</span>, <span class="hljs-number">920173696</span> );
    <span class="hljs-keyword">return</span> $__tmp[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tvariable</span>(<span class="hljs-params"> </span>)
</span>{<font></font>
    $__tmp = _dyuweyrj4( <span class="hljs-number">21720496</span>, <span class="hljs-number">920165136</span> );
    <span class="hljs-keyword">return</span> $__tmp[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang menarik dalam pasangan angka (21711392, 920173696) dan (21720496, 920165136)? </font><font style="vertical-align: inherit;">Seorang peneliti yang penuh perhatian akan melihat bahwa XOR angka dalam setiap pasangan memberikan 932443808. Mari kita coba menelepon </font></font><code>_dyuweyrj4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dengan beberapa angka yang memberikan hasil XOR 932443808: </font><font style="vertical-align: inherit;">
Tidak ada yang dicetak!</font></font><br>
<br>
<code>C:\php&gt;<b>php -r "_dyuweyrj4(0, 932443808);"</b></code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<code>C:\php&gt;<b>php -r "_dyuweyrj4(932443808, 0);"</b></code><br>
<br>
<img src="https://habrastorage.org/webt/ap/ed/c8/apedc8vzemybnk6fcmzhfj3tiwu.png"><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menyelam ke debugger</font></font></font></h2><br>
<img src="https://habrastorage.org/webt/kz/cy/_i/kzcy_i1kqfmexamdktae0lwhuuu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kita melihat bahwa suatu usaha sedang dilakukan untuk membaca di alamat </font></font><code>[ecx+40h]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, apalagi, itu </font></font><code>ecx</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;sama </font></font><code>0x3793f6a0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;dengan jumlah yang kita berikan ke fungsi. Ini berarti bahwa fungsi berharap untuk menerima nilai alamat dalam memori proses PHP sebagai parameter, dan itu akan </font></font><code>[ecx+40h]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;menambahkan satu </font><font style="vertical-align: inherit;">ke kata di alamat </font><font style="vertical-align: inherit;">(perintah </font></font><code>inc dword ptr [eax]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;terlihat tepat di bawah titik cache). Mari kita coba memberikan alamat seperti itu: untuk ini, kami memperhatikan bahwa alamat di mana modul php.exe utama dimuat tidak berubah sampai Windows reboot. Dalam kasus saya itu </font></font><code>0x00980000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Membuka php.exe di IDA, kami melihat data apa yang tersedia untuk </font></font><br>
<br>
<img src="https://habrastorage.org/webt/04/v4/fo/04v4foanwlcng6m_k0xopymi4ja.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ditulis </font><font style="vertical-align: inherit;">ulang: </font><font style="vertical-align: inherit;">Sebagai percobaan, mari kita coba menulis ulang pointer pertama dalam struktur </font></font><code>cli_sapi_module</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ada tautan ke sana dari </font></font><code>main+22</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; saat mengunduh php.exe di alamat, </font></font><code>0x00980000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;tautan ini akan berlokasi di</font></font><code>0x00982d63</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Jadi, </font></font><code>_dyuweyrj4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;kita perlu memberikan nilai </font><font style="vertical-align: inherit;">ke fungsi </font><font style="vertical-align: inherit;">yang kurang oleh </font></font><code>0x40</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, yaitu. </font></font><code>0x00982d23</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">
Kecelakaan lagi; tetapi dalam fungsi lain di dalam ioncube_loader_win_7.3.dll. Lebih menarik lagi, alamat di mana null pointer dibaca - </font><font style="vertical-align: inherit;">&nbsp;- tidak ada hubungannya dengan nilai yang diteruskan ke fungsi. (Sungguh ironis bahwa memeriksa pointer nol - - </font><font style="vertical-align: inherit;">&nbsp;dilakukan segera </font><b><font style="vertical-align: inherit;">setelah</font></b><font style="vertical-align: inherit;"> &nbsp;mengakses pointer ini.) Setelah melihat memori di alamat </font><font style="vertical-align: inherit;">, kami menemukan struktur di sana </font><font style="vertical-align: inherit;">, mis. definisi fungsi. Lebih mudah untuk melihat ke dalamnya melalui Jendela Segera: </font><font style="vertical-align: inherit;">
Seperti yang Anda lihat, pointer nol yang menyebabkan crash adalah bidang </font><font style="vertical-align: inherit;">&nbsp;dalam definisi fungsi</font></font><br>
<br>
<code>C:\php&gt;<b>php -r "_dyuweyrj4(0x00982d23, 0x00982d23 ^ 0x3793f6a0);"</b></code><br>
<br>
<img src="https://habrastorage.org/webt/kq/vd/n7/kqvdn7plaxnkhddfyucx_ktd_jk.png"><br>
<br><font style="vertical-align: inherit;"></font><code>0x14c32820+0x78</code><font style="vertical-align: inherit;"></font><code>test ebx, ebx</code><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><code>0x14c32820</code><font style="vertical-align: inherit;"></font><code>_zend_op_array</code><font style="vertical-align: inherit;"></font><br>
<br>
<code><b>(_zend_op_array*)0x14c32820</b><br>
0x14c32820 {type=0x01 '\x1' arg_flags=0x14c32821 "" fn_flags=0x00000100 ...}<br>
&nbsp; &nbsp; type: 0x01 '\x1'<br>
&nbsp; &nbsp; arg_flags: 0x14c32821 ""<br>
&nbsp; &nbsp; fn_flags: 0x00000100<br>
&nbsp; &nbsp; function_name: 0x06f66850 {gc={refcount=0x00000001 u={type_info=0x000001c6 } } h=0xacaf1bdb len=0x0000000a ...}<br>
&nbsp; &nbsp; scope: 0x00000000 &lt;NULL&gt;<br>
&nbsp; &nbsp; prototype: 0x00000000 &lt;NULL&gt;<br>
&nbsp; &nbsp; num_args: 0x00000000<br>
&nbsp; &nbsp; required_num_args: 0x00000000<br>
&nbsp; &nbsp; arg_info: 0x00000000 &lt;NULL&gt;<br>
&nbsp; &nbsp; cache_size: 0x131183d0<br>
&nbsp; &nbsp; last_var: 0x06ee0e98<br>
&nbsp; &nbsp; T: 0x00000000<br>
&nbsp; &nbsp; last: 0x00000000<br>
&nbsp; &nbsp; opcodes: 0x00000000 &lt;NULL&gt;<br>
&nbsp; &nbsp; run_time_cache: 0x00000000 {???}<br>
&nbsp; &nbsp; static_variables: 0x00000000 &lt;NULL&gt;<br>
&nbsp; &nbsp; vars: 0x00000000 {???}<br>
&nbsp; &nbsp; refcount: 0x600df45e {???}<br>
&nbsp; &nbsp; last_live_range: 0x88008c00<br>
&nbsp; &nbsp; last_try_catch: 0x00000001<br>
&nbsp; &nbsp; live_range: 0x00000100 {var=??? start=??? end=??? }<br>
&nbsp; &nbsp; try_catch_array: 0x14c2d958 {try_op=0x00000001 catch_op=0x000001c6 finally_op=0xddab5409 ...}<br>
&nbsp; &nbsp; filename: 0x14c1a538 {gc={refcount=0x00000001 u={type_info=0x14c00668 } } h=0x00000000 len=0x00000001 ...}<br>
&nbsp; &nbsp; line_start: 0x00000000<br>
&nbsp; &nbsp; line_end: 0x00000002<br>
&nbsp; &nbsp; doc_comment: 0x00000002 {gc={refcount=??? u={type_info=??? } } h=??? len=??? ...}<br>
&nbsp; &nbsp; last_literal: 0x714beccc<br>
&nbsp; &nbsp; literals: 0x71180110 {php7.dll!zif_xmlwriter_write_pi(_zend_execute_data *, _zval_struct *)} {value={lval=0x3314ec83 ...} ...}<br>
&nbsp; &nbsp; reserved: 0x14c3288c {0x06ee0bc0, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000}<br>
<br>
<b>((_zend_op_array*)0x14c32820)-&gt;function_name</b><br>
0x06f66850 {gc={refcount=0x00000001 u={type_info=0x000001c6 } } h=0xacaf1bdb len=0x0000000a ...}<br>
&nbsp; &nbsp; gc: {refcount=0x00000001 u={type_info=0x000001c6 } }<br>
&nbsp; &nbsp; h: 0xacaf1bdb<br>
&nbsp; &nbsp; len: 0x0000000a<br>
&nbsp; &nbsp; val: 0x06f66860 "_dyuweyrj4"<br>
<br>
<b>&amp;((_zend_op_array*)0)-&gt;reserved[3]</b><br>
0x00000078 {???}</code><br>
<br><font style="vertical-align: inherit;"></font><code>_zend_op_array.reserved[3]</code><font style="vertical-align: inherit;"></font><code>_dyuweyrj4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Rupanya, bidang ini digunakan oleh ionCube Loader untuk beberapa keperluan internalnya. </font><font style="vertical-align: inherit;">Untuk memeriksa, mari kita jalankan file dari satu baris</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span> _dyuweyrj4(<span class="hljs-number">0x00982d23</span>, <span class="hljs-number">0x00982d23</span> ^ <span class="hljs-number">0x3793f6a0</span>);</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- melalui </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encoder PHP Online</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mereka </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">(Hasil enkripsi diberikan pada awal posting.) Sayangnya, ini tidak membantu: </font></font><code>_zend_op_array.reserved[3]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;tetap nol. </font><font style="vertical-align: inherit;">Tetapi kami memastikan bahwa fungsi eksekusi (tanpa nama) </font></font><code>_zend_op_array.reserved[3]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sekarang diisi:</font></font><br>
<br>
<code><b>executor_globals.current_execute_data-&gt;func-&gt;op_array</b><br>
{type=0x02 '\x2' arg_flags=0x14a72141 "" fn_flags=0x08000000 ...}<br>
&nbsp; &nbsp; type: 0x02 '\x2'<br>
&nbsp; &nbsp; arg_flags: 0x14a72141 ""<br>
&nbsp; &nbsp; fn_flags: 0x08000000<br>
&nbsp; &nbsp; function_name: 0x00000000 &lt;NULL&gt;<br>
&nbsp; &nbsp; scope: 0x00000000 &lt;NULL&gt;<br>
&nbsp; &nbsp; prototype: 0x00000000 &lt;NULL&gt;<br>
&nbsp; &nbsp; num_args: 0x00000000<br>
&nbsp; &nbsp; required_num_args: 0x00000000<br>
&nbsp; &nbsp; arg_info: 0x00000000 &lt;NULL&gt;<br>
&nbsp; &nbsp; cache_size: 0x00000004<br>
&nbsp; &nbsp; last_var: 0x00000000<br>
&nbsp; &nbsp; T: 0x00000001<br>
&nbsp; &nbsp; last: 0x00000005<br>
&nbsp; &nbsp; opcodes: 0x14a72280 {handler=0x999fc7ce op1={constant=0x00000000 var=0x00000000 num=0x00000000 ...} op2={constant=...} ...}<br>
&nbsp; &nbsp; run_time_cache: 0x14a74018 {0x14c27ba0}<br>
&nbsp; &nbsp; static_variables: 0x00000000 &lt;NULL&gt;<br>
&nbsp; &nbsp; vars: 0x00000000 {???}<br>
&nbsp; &nbsp; refcount: 0x14a74030 {0x00000002}<br>
&nbsp; &nbsp; last_live_range: 0x00000000<br>
&nbsp; &nbsp; last_try_catch: 0x00000000<br>
&nbsp; &nbsp; live_range: 0x00000000 &lt;NULL&gt;<br>
&nbsp; &nbsp; try_catch_array: 0x00000000 &lt;NULL&gt;<br>
&nbsp; &nbsp; filename: 0x14a66230 {gc={refcount=0x00000001 u={type_info=0x00000006 } } h=0x00000000 len=0x00000032 ...}<br>
&nbsp; &nbsp; line_start: 0x00200001<br>
&nbsp; &nbsp; line_end: 0x00000001<br>
&nbsp; &nbsp; doc_comment: 0x00000000 &lt;NULL&gt;<br>
&nbsp; &nbsp; last_literal: 0x00000005<br>
&nbsp; &nbsp; literals: 0x14a66280 {value={lval=0x0716a738 dval=5.875681226702e-316#DEN counted=0x0716a738 {gc={refcount=0x00000001 ...} } ...} ...}<br>
&nbsp; &nbsp; reserved: 0x14a721ac {0x00000000, 0x00000000, 0x00000000, 0x14a6b200, 0x00000000, 0x00000000}</code><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bug ditendang dengan bug</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang bisa kita lihat, itu </font></font><code>_zend_op_array.reserved[3]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;hanya diisi dengan fungsi-fungsi terenkripsi. (Ini bukan satu-satunya fitur pembeda mereka: pada cetakan di atas, Anda juga dapat melihat </font></font><code>line_start=0x00200001</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;alih-alih nomor baris yang masuk akal.) Di sisi lain, penunjuk </font></font><code>_zend_op_array</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang masuk ke fungsi macet diambil dari yang </font></font><code>execute_data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dilewati pada </font></font><code>_dyuweyrj4</code>&nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parameter pertama implisit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;- jadi ini </font></font><code>_zend_op_array</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;selalu sesuai dengan fungsi yang dipanggil yaitu, itu sendiri </font></font><code>_dyuweyrj4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Fungsi ini tidak dienkripsi, dan karenanya </font></font><code>_zend_op_array.reserved[3]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;selalu nol. Kami menyimpulkan dari ini: panggilan </font></font><code>_dyuweyrj4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;dengan parameter "benar" </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pasti menyebabkan crash</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;(dan dengan yang salah, seperti yang kita lihat - kepada pers aforisme Tiongkok). Hal yang hebat tentang ini adalah bahwa crash yang dihasilkan tidak disengaja, melainkan disebut menggunakan pointer nol sebelum memeriksanya. Bug seperti itu dalam kode akan menangkap alat analisis statis apa pun; tetapi ternyata, mereka tidak menggunakan yang seperti ini di ionCube. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang terjadi jika saya memperbaiki bug di ioncube_loader_win_7.3.dll dengan mengatur pemeriksaan pointer sebelum menggunakannya? Untuk ini, lebih mudah menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x64dbg</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/j1/mh/zd/j1mhzdzqh5k-lgme_k8awtppxw0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kita mulai </font></font><code>php -r "_dyuweyrj4(0x00982d23, 0x00982d23 ^ 0x3793f6a0);"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;dengan Loader ionCube yang ditambal, dan ... kita mendapatkan crash di tempat baru - lagi ketika menggunakan pointer nol dari </font></font><code>_zend_op_array.reserved[3]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ji/al/nx/jialnxbvufmj0dvqgc2s19thaxs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini berarti bahwa tidak ada arti dari pemeriksaan (salah) untuk pointer nol: pada fungsi selanjutnya disebut, pointer yang sama digunakan tanpa memeriksa. </font><font style="vertical-align: inherit;">Kami menyimpulkan bahwa kerentanan potensial yang akan memungkinkan kami untuk mengubah memori proses PHP di alamat yang sewenang-wenang dan dengan demikian melarikan diri dari kotak pasir - misalnya, fungsi panggilan yang dilarang oleh administrator server - ditutup di ionCube Loader oleh serangkaian bug yang mengarah ke cache php.exe yang tidak disengaja .</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apa yang dimaksud penulis?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya percaya bahwa awalnya itu </font></font><code>_dyuweyrj4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;muncul untuk mengikat beberapa array yang benar secara formal </font></font><code>zend_op</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menutup-nutupi </font><font style="vertical-align: inherit;">fungsi terenkripsi </font><font style="vertical-align: inherit;">- karena ionCube Loader jauh dari satu-satunya modul ekstensi yang akan merangkak ke dalam array ini. (Salah satu kasus umum ketika ekstensi masuk ke </font></font><code>zend_op</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fungsi s adalah untuk men-cache ini </font></font><code>zend_op</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">antara menjalankan skrip yang sama; yang lain adalah PHP disassembler, seperti output dari forum Indonesia.) Sebagai argumen, saya </font></font><code>_dyuweyrj4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;mendapat pointer ke yang </font></font><code>_zend_op_array</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;dienkripsi fungsi, dan melewati kontrol ke decryptor, dengan mana IonCube Loader menggantikan fungsi standar </font></font><code>zend_execute_ex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Satu-satunya skenario di mana ia </font></font><code>_dyuweyrj4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;bisa dipanggil adalah jika modul ekstensi asing menyimpan "</font></font><code>zend_op</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menutup-nutupi secara terpisah dari fungsi terenkripsi, dan kemudian mencoba </font></font><code>zend_op</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk mengeksekusi ini. Dalam hal ini, panggilan </font></font><code>_dyuweyrj4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;dengan pointer ke </font></font><code>_zend_op_array</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;fungsi terenkripsi akan berubah menjadi dekripsi dan peluncuran fungsi ini sendiri. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika beralih ke PHP 7 </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;ABI fungsi ekstensi </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">berubah</font></a><font style="vertical-align: inherit;"> : alih-alih empat parameter implisit </font></font><code>ht, return_value_ptr, this_ptr, return_value_used</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;, Struktur digunakan </font></font><code>_zend_execute_data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Di sini, pemrogram ionCube bingung karena mereka </font></font><code>_dyuweyrj4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;sekarang menerima dua petunjuk untuk </font></font><code>_zend_op_array</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: satu melalui lapangan </font></font><code>_zend_execute_data.func</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, yang kedua dengan parameter dilewati secara eksplisit. Yang pertama sesuai dengan yang </font></font><code>_dyuweyrj4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kedua, fungsi terenkripsi yang perlu dipanggil. Dan di sini kita melihat bug lain: menambah bidang </font></font><code>refcount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;fungsi terenkripsi, </font></font><code>_dyuweyrj4</code>&nbsp;<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">benar-benar lupa tentang itu</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dan selanjutnya bekerja hanya dengan miliknya sendiri </font></font><code>_zend_op_array</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Secara alami, upaya untuk memanggil fungsi ekstensi, seolah-olah itu adalah fungsi PHP terenkripsi, mengarah ke kerusakan - dan ada baiknya ia tidak </font></font><code>_dyuweyrj4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;menyebabkan </font><font style="vertical-align: inherit;">rekursi yang tak terbatas, karena ia </font><font style="vertical-align: inherit;">mencoba memanggil dirinya sendiri! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Timbul pertanyaan: bagaimana QA di ionCube melewatkan fungsi yang tidak pernah bisa berfungsi sebagaimana dimaksud? </font><font style="vertical-align: inherit;">Fakta bahwa itu tidak termasuk dalam rencana pengujian juga jelas karena dalam versi 64-bit dari Loader ionCeter parameter saya </font></font><code>_dyuweyrj4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;tetap 32-bit - ini berarti bahwa pointer ke </font></font><code>_zend_op_array</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;fungsi terenkripsi dipotong menjadi 32 bit bahkan sebelum kenaikan </font></font><code>refcount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dan crash itu, yang kami tangkap pertama, dijamin terjadi sama sekali dengan panggilan apa pun </font></font><code>_dyuweyrj4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/gu/ab/cg/guabcgmwuqoopx1ar80sjpz6keq.png"></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/de/0y/l-/de0yl-6ppopvisr_a80b4yuhjj8.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id506872/index.html">Book Spring Boot 2: Praktik Terbaik untuk Profesional</a></li>
<li><a href="../id506874/index.html">Dari kehidupan seorang programmer: Orang-orang bisnis</a></li>
<li><a href="../id506880/index.html">Joel Spolsky: bagaimana era Stack Overflow dimulai</a></li>
<li><a href="../id506886/index.html">Retas seumur hidup</a></li>
<li><a href="../id506888/index.html">Menyortir lembar contekan untuk Ilmu Data</a></li>
<li><a href="../id506896/index.html">Interpretasi paling realistis dari mekanika kuantum</a></li>
<li><a href="../id506902/index.html">Rumah pintar di kota pintar</a></li>
<li><a href="../id506906/index.html">Paradoks lubang hitam mengungkapkan hubungan mendasar antara energi dan ketertiban</a></li>
<li><a href="../id506908/index.html">Ilmu pengetahuan top. Semoga media sepuluh: keputus-asaan ikan akuarium, suara-suara gangguan mental dan banyak kali COVID</a></li>
<li><a href="../id506916/index.html">Apa itu Service Mesh?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>