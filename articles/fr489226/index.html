<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìÅ üíáüèº üôãüèæ M√©thodes d'optimisation des requ√™tes LINQ en C # .NET üëç üëø ‚è≠Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="introduction
 Dans cet article, nous avons discut√© de certaines techniques d'optimisation des requ√™tes LINQ . 
 Voici quelques autres approches d'opti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>M√©thodes d'optimisation des requ√™tes LINQ en C # .NET</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489226/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">introduction</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cet article,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous avons discut√© de certaines techniques d'optimisation des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requ√™tes LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici quelques autres approches d'optimisation de code li√©es aux </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requ√™tes LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est connu que </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Language-Integrated Query) est un langage simple et pratique pour interroger une source de donn√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ to SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est une technologie d'acc√®s aux donn√©es dans un SGBD. Il s'agit d'un outil puissant pour travailler avec des donn√©es, o√π les requ√™tes sont construites via un langage d√©claratif, qui sera ensuite converti en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requ√™tes SQL par la</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> plateforme et envoy√© au serveur de base de donn√©es d√©j√† pour ex√©cution. Dans notre cas, par SGBD, nous entendons </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS SQL Server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, les </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requ√™tes LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne </font><b><font style="vertical-align: inherit;">sont</font></b><font style="vertical-align: inherit;"> pas converties en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requ√™tes SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √©crites de mani√®re optimale </font><font style="vertical-align: inherit;">qu'un DBA exp√©riment√© pourrait √©crire avec toutes les nuances de l'optimisation </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des requ√™tes SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">connexions optimales ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JOIN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) et filtrage des r√©sultats ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de nombreuses nuances dans l'utilisation des compos√©s et des conditions de groupe</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de nombreuses variantes pour remplacer les conditions </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> par </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NOT IN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , &lt;&gt; par </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS</font></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mise en cache interm√©diaire des r√©sultats via des tables temporaires, CTE, variables de table</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en utilisant une clause ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OPTION</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) avec des instructions et des conseils de table </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WITH</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (...)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'utilisation de vues index√©es, comme moyen de se d√©barrasser des lectures redondantes des donn√©es dans les √©chantillons</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les principaux goulots d'√©tranglement des performances des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requ√™tes SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> r√©sultantes </font><font style="vertical-align: inherit;">lors de la compilation des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requ√™tes LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sont les suivants:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consolidation de l'ensemble du m√©canisme de s√©lection des donn√©es en une seule demande</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">duplication de blocs de code identiques, ce qui conduit finalement √† de multiples lectures suppl√©mentaires de donn√©es</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">groupes de conditions √† plusieurs composants (logiques "et" et "ou") - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ET</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OU</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , se combinant dans des conditions difficiles, conduit au fait que l'optimiseur, ayant des index non clusteris√©s appropri√©s, par les champs n√©cessaires, commence finalement √† balayer par l'index de cluster ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INDEX SCAN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) par groupe de conditions</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imbrication profonde des sous - </font><font style="vertical-align: inherit;">requ√™tes rend tr√®s probl√©matique pour analyser les </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instructions SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et d' </font><font style="vertical-align: inherit;">analyser les </font><font style="vertical-align: inherit;">plans de requ√™tes des d√©veloppeurs et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">administrateurs de </font><font style="vertical-align: inherit;">bases</font></font></b></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©thodes d'optimisation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Passons maintenant directement aux m√©thodes d'optimisation.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) Indexation suppl√©mentaire</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est pr√©f√©rable de consid√©rer les filtres sur les tables d'√©chantillonnage principales, car tr√®s souvent, la requ√™te enti√®re est construite autour d'une ou deux tables principales (applications-personnes-op√©rations) et avec un ensemble standard de conditions (IsClosed, Canceled, Enabled, Status). Il est important que les √©chantillons identifi√©s cr√©ent les index correspondants. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette solution est logique lorsque le choix dans ces champs limite consid√©rablement l'ensemble renvoy√© √† la requ√™te. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, nous avons 500 000 applications. Cependant, il n'y a que 2 000 entr√©es actives. Ensuite, un index correctement s√©lectionn√© nous sauvera d' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INDEX SCAN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur une grande table et nous permettra de s√©lectionner rapidement les donn√©es via un index non clusteris√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le manque d'index peut √©galement √™tre d√©tect√© via des invites pour l'analyse des plans de requ√™te ou la collecte de statistiques pour les vues syst√®me</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS SQL Server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys.dm_db_missing_index_groups</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys.dm_db_missing_index_group_stats</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys.dm_db_missing_index_details</font></font></a></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toutes les donn√©es de vue contiennent des informations sur les index manquants, √† l'exception des index spatiaux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, les index et la mise en cache sont souvent des m√©thodes pour g√©rer les effets des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requ√™tes LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mal √©crites </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme le montre la dure pratique de la vie pour l'entreprise, il est souvent important de mettre en ≈ìuvre les fonctionnalit√©s de l'entreprise √† une certaine date. Et par cons√©quent, les requ√™tes souvent lourdes sont mises en arri√®re-plan avec la mise en cache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela est en partie justifi√©, car l'utilisateur n'a pas toujours besoin des derni√®res donn√©es et un niveau acceptable de r√©ponse d'interface utilisateur se produit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette approche vous permet de r√©soudre les besoins de l'entreprise, mais r√©duit finalement l'efficacit√© du syst√®me d'information, retardant simplement la r√©solution des probl√®mes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient √©galement de se rappeler que dans le processus de recherche n√©cessaire pour ajouter de nouveaux index, les propositions d' </font><font style="vertical-align: inherit;">optimisation </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> peuvent √™tre incorrectes, y compris dans les conditions suivantes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si des index avec un ensemble similaire de champs existent d√©j√†</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si les champs de la table ne peuvent pas √™tre index√©s en raison de restrictions d'indexation (plus d'informations √† ce sujet sont d√©crites </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) Fusion des attributs en un nouvel attribut</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parfois, certains champs de la m√™me table par laquelle un groupe de conditions se produit peuvent √™tre remplac√©s par l'introduction d'un nouveau champ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela est particuli√®rement vrai pour les champs d'√©tat, qui, par type, sont g√©n√©ralement au niveau du bit ou de l'entier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemple: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IsClosed = 0 AND Canceled = 0 AND Enabled = 0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est remplac√© par </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Status = 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous saisissez ici l'attribut entier Status, qui est fourni en remplissant ces statuts dans le tableau. </font><font style="vertical-align: inherit;">L'√©tape suivante consiste √† indexer ce nouvel attribut. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'agit d'une solution fondamentale au probl√®me de performances, car nous demandons des donn√©es sans calculs inutiles.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3) Mat√©rialisation de la soumission</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malheureusement, les </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requ√™tes LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne peuvent pas utiliser directement des tables temporaires, des CTE et des variables de table. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, il existe un autre moyen d'optimiser ce cas: il s'agit des vues index√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un groupe de conditions (de l'exemple ci-dessus) </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IsClosed = 0 AND Canceled = 0 AND Enabled = 0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (ou un ensemble d'autres conditions similaires) devient une bonne option pour les utiliser dans une vue index√©e, en mettant en cache une petite tranche de donn√©es √† partir d'un grand ensemble. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais il existe un certain nombre de limitations lors de la mat√©rialisation d'une vue:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en utilisant des sous-requ√™tes, les clauses </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> doivent √™tre remplac√©es √† l'aide de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JOIN</font></font></b></li>
<li><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">Impossible d'</font></b><font style="vertical-align: inherit;"> utiliser les </font><b><font style="vertical-align: inherit;">clauses </font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNION</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNION ALL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXCEPTION</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INTERSECT</font></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous ne pouvez pas utiliser les conseils de table et les clauses </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OPTION</font></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aucune capacit√© √† travailler avec des cycles</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il est impossible d'afficher des donn√©es dans une vue √† partir de diff√©rentes tables</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est important de se rappeler que les avantages r√©els de l'utilisation d'une vue index√©e ne peuvent √™tre obtenus qu'en l'indexant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais lors de l'appel d'une vue, ces index ne peuvent pas √™tre utilis√©s et pour les utiliser explicitement, vous devez sp√©cifier </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WITH (NOEXPAND)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puisqu'il </font><font style="vertical-align: inherit;">est impossible de d√©finir des conseils de table </font><font style="vertical-align: inherit;">dans les </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requ√™tes LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , vous devez donc faire une autre repr√©sentation - un ¬´wrapper¬ª de la forme suivante:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> _ <span class="hljs-keyword">AS</span> <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> MAT_VIEW <span class="hljs-keyword">WITH</span> (NOEXPAND);
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4) Utilisation des fonctions de table</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Souvent dans les </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requ√™tes LINQ, de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> grands blocs de sous-requ√™te ou des blocs qui utilisent des repr√©sentations avec une structure complexe forment la requ√™te finale avec une structure d'ex√©cution tr√®s complexe et non optimale. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Principaux avantages de l'utilisation des fonctions de table dans les </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requ√™tes LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La possibilit√©, comme dans le cas des vues, d'utiliser et de sp√©cifier comme objet, mais vous pouvez passer un ensemble de param√®tres d'entr√©e: </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM FUNCTION (@ param1, @ param2 ...)</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
au final, vous pouvez obtenir un √©chantillonnage de donn√©es flexible</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque vous utilisez une fonction de table, il n'y a pas de restrictions aussi strictes que dans le cas des vues index√©es d√©crites ci-dessus:</font></font><br>
<br>
<ol>
<li> :<br>
 <b>LINQ</b>             .<br>
     .<br>
        ,          </li>
<li>  ,     , :<br>
<br>
<ul>
<li>    (   )</li>
<li>     </li>
<li> <b>UNION</b>  <b>EXISTS</b></li>
</ul></li>
</ol><br>
</li>
<li> <b>OPTION</b>  ,       <b>OPTION(MAXDOP N)</b>,    . :<br>
<br>
<ul>
<li>      <b>OPTION (RECOMPILE)</b></li>
<li>         ,    <b>OPTION (FORCE ORDER)</b></li>
</ul><br>
   <b>OPTION</b>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>.<br>
</li>
<li>      :<br>
        (     ),         .<br>
,  ,     <b>WHERE</b>    <b>(a, b, c)</b>.<br>
<br>
       <b>a = 0 and b = 0</b>.<br>
<br>
,    <b>c</b>  .<br>
<br>
  <b>a = 0 and b = 0</b>          ,    <b></b>      .<br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, la fonction de table peut √™tre une meilleure option. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, la fonction de table est plus pr√©visible et constante en temps d'ex√©cution.</font></font><br>
</li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemples</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prenons un exemple d'impl√©mentation utilisant l'exemple de la base de donn√©es Questions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe une requ√™te </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui combine plusieurs tables et utilise une seule vue (OperativeQuestions), qui v√©rifie par email l'affiliation (via </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) de ¬´Active Queries¬ª ([OperativeQuestions]):</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demande n ¬∞ 1</font></font></b><div class="spoiler_text"><pre><code class="sql hljs">(@p__linq__0 nvarchar(4000))<span class="hljs-keyword">SELECT</span>
<span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> [C1],<font></font>
[Extent1].[<span class="hljs-keyword">Id</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Id</span>],<font></font>
[Join2].[Object_Id] <span class="hljs-keyword">AS</span> [Object_Id],<font></font>
[Join2].[ObjectType_Id] <span class="hljs-keyword">AS</span> [ObjectType_Id],<font></font>
[Join2].[<span class="hljs-keyword">Name</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Name</span>],<font></font>
[Join2].[ExternalId] <span class="hljs-keyword">AS</span> [ExternalId]
<span class="hljs-keyword">FROM</span> [dbo].[Questions] <span class="hljs-keyword">AS</span> [Extent1]
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> (<span class="hljs-keyword">SELECT</span> [Extent2].[Object_Id] <span class="hljs-keyword">AS</span> [Object_Id],<font></font>
[Extent2].[Question_Id] <span class="hljs-keyword">AS</span> [Question_Id], [Extent3].[ExternalId] <span class="hljs-keyword">AS</span> [ExternalId],<font></font>
[Extent3].[ObjectType_Id] <span class="hljs-keyword">AS</span> [ObjectType_Id], [Extent4].[<span class="hljs-keyword">Name</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Name</span>]
<span class="hljs-keyword">FROM</span> [dbo].[ObjectQuestions] <span class="hljs-keyword">AS</span> [Extent2]
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> [dbo].[Objects] <span class="hljs-keyword">AS</span> [Extent3] <span class="hljs-keyword">ON</span> [Extent2].[Object_Id] = [Extent3].[<span class="hljs-keyword">Id</span>]
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> [dbo].[ObjectTypes] <span class="hljs-keyword">AS</span> [Extent4] 
<span class="hljs-keyword">ON</span> [Extent3].[ObjectType_Id] = [Extent4].[<span class="hljs-keyword">Id</span>] ) <span class="hljs-keyword">AS</span> [Join2] 
<span class="hljs-keyword">ON</span> [Extent1].[<span class="hljs-keyword">Id</span>] = [Join2].[Question_Id]
<span class="hljs-keyword">WHERE</span> ([Extent1].[AnswerId] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">AND</span> (<span class="hljs-number">0</span> = [Extent1].[<span class="hljs-keyword">Exp</span>]) <span class="hljs-keyword">AND</span> ( <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">SELECT</span>
<span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> [C1]
<span class="hljs-keyword">FROM</span> [dbo].[OperativeQuestions] <span class="hljs-keyword">AS</span> [Extent5]
<span class="hljs-keyword">WHERE</span> (([Extent5].[Email] = @p__linq__0) <span class="hljs-keyword">OR</span> (([Extent5].[Email] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>) 
<span class="hljs-keyword">AND</span> (@p__linq__0 <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>))) <span class="hljs-keyword">AND</span> ([Extent5].[<span class="hljs-keyword">Id</span>] = [Extent1].[<span class="hljs-keyword">Id</span>])<font></font>
));<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La vue a une structure assez compliqu√©e: elle a des jointures de sous-requ√™te et l'utilisation du tri </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DISTINCT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui dans le cas g√©n√©ral est une op√©ration plut√¥t gourmande en ressources. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une s√©lection d'environ dix mille enregistrements d'OperativeQuestions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le principal probl√®me de cette requ√™te est que pour les enregistrements d'une requ√™te externe, une sous-requ√™te interne est effectu√©e sur la vue [OperativeQuestions], ce qui devrait limiter l'√©chantillon de sortie (via </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) √† des centaines d'enregistrements </font><font style="vertical-align: inherit;">pour [Email] = @ p__linq__0 </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et il peut sembler que la sous-requ√™te devrait une fois calculer les enregistrements par [Email] = @ p__linq__0, puis ces quelques centaines d'enregistrements devraient √™tre connect√©s par des questions Id c, et la requ√™te sera rapide.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, toutes les tables sont connect√©es en s√©rie: les questions d'ID et l'ID des questions op√©rationnelles sont v√©rifi√©es pour la conformit√© et le courrier √©lectronique est filtr√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, la demande fonctionne avec les dizaines de milliers d'enregistrements d'OperativeQuestions et vous n'avez besoin que de donn√©es d'int√©r√™t par e-mail. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Texte de la vue OperativeQuestions:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demande n ¬∞ 2</font></font></b><div class="spoiler_text"><pre><code class="sql hljs"> 
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> [dbo].[OperativeQuestions]
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> Q.Id, USR.email <span class="hljs-keyword">AS</span> Email
<span class="hljs-keyword">FROM</span>            [dbo].Questions <span class="hljs-keyword">AS</span> Q <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span>
                         [dbo].ProcessUserAccesses <span class="hljs-keyword">AS</span> BPU <span class="hljs-keyword">ON</span> BPU.ProcessId = CQ.Process_Id 
<span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">APPLY</span>
                     (<span class="hljs-keyword">SELECT</span>   <span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> HasNoObjects
                      <span class="hljs-keyword">WHERE</span>   <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span>
                                    (<span class="hljs-keyword">SELECT</span>   <span class="hljs-number">1</span>
                                     <span class="hljs-keyword">FROM</span>     [dbo].ObjectUserAccesses <span class="hljs-keyword">AS</span> BOU
                                     <span class="hljs-keyword">WHERE</span>   BOU.ProcessUserAccessId = BPU.[<span class="hljs-keyword">Id</span>] <span class="hljs-keyword">AND</span> BOU.[<span class="hljs-keyword">To</span>] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>)<font></font>
) <span class="hljs-keyword">AS</span> BO <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span>
                         [dbo].Users <span class="hljs-keyword">AS</span> USR <span class="hljs-keyword">ON</span> USR.Id = BPU.UserId
<span class="hljs-keyword">WHERE</span>        CQ.[<span class="hljs-keyword">Exp</span>] = <span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> CQ.AnswerId <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">AND</span> BPU.[<span class="hljs-keyword">To</span>] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> 
<span class="hljs-keyword">AND</span> (BO.HasNoObjects = <span class="hljs-number">1</span> <span class="hljs-keyword">OR</span>
              <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">SELECT</span>   <span class="hljs-number">1</span>
                           <span class="hljs-keyword">FROM</span>   [dbo].ObjectUserAccesses <span class="hljs-keyword">AS</span> BOU <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span>
                                      [dbo].ObjectQuestions <span class="hljs-keyword">AS</span> QBO 
                                                  <span class="hljs-keyword">ON</span> QBO.[Object_Id] =BOU.ObjectId
                               <span class="hljs-keyword">WHERE</span>  BOU.ProcessUserAccessId = BPU.Id 
                               <span class="hljs-keyword">AND</span> BOU.[<span class="hljs-keyword">To</span>] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">AND</span> QBO.Question_Id = CQ.Id));
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Repr√©sentation cartographique originale dans DbContext (EF Core 2)</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">public class QuestionsDbContext : DbContext<font></font>
{<font></font>
    //...<font></font>
    public DbQuery&lt;OperativeQuestion&gt; OperativeQuestions { get; set; }<font></font>
    //...<font></font>
    protected override void OnModelCreating(ModelBuilder modelBuilder)<font></font>
    {<font></font>
        modelBuilder.Query&lt;OperativeQuestion&gt;().ToView("OperativeQuestions");<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Requ√™te LINQ d'origine</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">var businessObjectsData = await context<font></font>
    .OperativeQuestions<font></font>
    .Where(x =&gt; x.Email == Email)<font></font>
    .Include(x =&gt; x.Question)<font></font>
    .Select(x =&gt; x.Question)<font></font>
    .SelectMany(x =&gt; x.ObjectQuestions,<font></font>
                (x, bo) =&gt; new<font></font>
                {<font></font>
                    Id = x.Id,<font></font>
                    ObjectId = bo.Object.Id,<font></font>
                    ObjectTypeId = bo.Object.ObjectType.Id,<font></font>
                    ObjectTypeName = bo.Object.ObjectType.Name,<font></font>
                    ObjectExternalId = bo.Object.ExternalId<font></font>
                })<font></font>
    .ToListAsync();<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce cas particulier, une solution √† ce probl√®me est envisag√©e sans changements d'infrastructure, sans introduire un tableau s√©par√© avec des r√©sultats pr√™ts √† l'emploi (¬´Active Queries¬ª), pour lesquels un m√©canisme serait n√©cessaire pour remplir ses donn√©es et les tenir √† jour. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien qu'il s'agisse d'une bonne solution, il existe une autre option pour optimiser cette t√¢che. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'objectif principal est de mettre en cache les entr√©es par [Email] = @ p__linq__0 √† partir de la vue OperativeQuestions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous entrons la fonction de table [dbo]. [OperativeQuestionsUserMail] dans la base de donn√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En envoyant un e-mail comme param√®tre d'entr√©e, nous r√©cup√©rons la table des valeurs:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demande n ¬∞ 3</font></font></b><div class="spoiler_text"><pre><code class="sql hljs">
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> [dbo].[OperativeQuestionsUserMail]<font></font>
(<font></font>
    @Email  <span class="hljs-keyword">nvarchar</span>(<span class="hljs-number">4000</span>)<font></font>
)<font></font>
<span class="hljs-keyword">RETURNS</span>
@tbl <span class="hljs-keyword">TABLE</span><font></font>
(<font></font>
    [<span class="hljs-keyword">Id</span>]           uniqueidentifier,<font></font>
    [Email]      <span class="hljs-keyword">nvarchar</span>(<span class="hljs-number">4000</span>)<font></font>
)<font></font>
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">BEGIN</span>
        <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> @tbl ([<span class="hljs-keyword">Id</span>], [Email])
        <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Id</span>, @Email
        <span class="hljs-keyword">FROM</span> [OperativeQuestions]  <span class="hljs-keyword">AS</span> [x] <span class="hljs-keyword">WHERE</span> [x].[Email] = @Email;<font></font>
     <font></font>
    RETURN;<font></font>
<span class="hljs-keyword">END</span>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela renvoie une table de valeurs avec une structure de donn√©es pr√©d√©finie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour que les requ√™tes vers OperativeQuestionsUserMail soient optimales, pour avoir des plans de requ√™te optimaux, une structure stricte est requise, et non </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RETURNS TABLE AS RETURN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce cas, la demande 1 souhait√©e est convertie en demande 4:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demande n ¬∞ 4</font></font></b><div class="spoiler_text"><pre><code class="sql hljs">(@p__linq__0 nvarchar(4000))<span class="hljs-keyword">SELECT</span>
<span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> [C1],<font></font>
[Extent1].[<span class="hljs-keyword">Id</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Id</span>],<font></font>
[Join2].[Object_Id] <span class="hljs-keyword">AS</span> [Object_Id],<font></font>
[Join2].[ObjectType_Id] <span class="hljs-keyword">AS</span> [ObjectType_Id],<font></font>
[Join2].[<span class="hljs-keyword">Name</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Name</span>],<font></font>
[Join2].[ExternalId] <span class="hljs-keyword">AS</span> [ExternalId]
<span class="hljs-keyword">FROM</span> (
    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Id</span>, Email <span class="hljs-keyword">FROM</span> [dbo].[OperativeQuestionsUserMail] (@p__linq__0)<font></font>
) <span class="hljs-keyword">AS</span> [Extent0]
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> [dbo].[Questions] <span class="hljs-keyword">AS</span> [Extent1] <span class="hljs-keyword">ON</span>([Extent0].Id=[Extent1].Id)
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> (<span class="hljs-keyword">SELECT</span> [Extent2].[Object_Id] <span class="hljs-keyword">AS</span> [Object_Id], [Extent2].[Question_Id] <span class="hljs-keyword">AS</span> [Question_Id], [Extent3].[ExternalId] <span class="hljs-keyword">AS</span> [ExternalId], [Extent3].[ObjectType_Id] <span class="hljs-keyword">AS</span> [ObjectType_Id], [Extent4].[<span class="hljs-keyword">Name</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Name</span>]
<span class="hljs-keyword">FROM</span> [dbo].[ObjectQuestions] <span class="hljs-keyword">AS</span> [Extent2]
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> [dbo].[Objects] <span class="hljs-keyword">AS</span> [Extent3] <span class="hljs-keyword">ON</span> [Extent2].[Object_Id] = [Extent3].[<span class="hljs-keyword">Id</span>]
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> [dbo].[ObjectTypes] <span class="hljs-keyword">AS</span> [Extent4] 
<span class="hljs-keyword">ON</span> [Extent3].[ObjectType_Id] = [Extent4].[<span class="hljs-keyword">Id</span>] ) <span class="hljs-keyword">AS</span> [Join2] 
<span class="hljs-keyword">ON</span> [Extent1].[<span class="hljs-keyword">Id</span>] = [Join2].[Question_Id]
<span class="hljs-keyword">WHERE</span> ([Extent1].[AnswerId] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">AND</span> (<span class="hljs-number">0</span> = [Extent1].[<span class="hljs-keyword">Exp</span>]);
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mappage des vues et des fonctions dans DbContext (EF Core 2)</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">public class QuestionsDbContext : DbContext<font></font>
{<font></font>
    //...<font></font>
    public DbQuery&lt;OperativeQuestion&gt; OperativeQuestions { get; set; }<font></font>
    //...<font></font>
    protected override void OnModelCreating(ModelBuilder modelBuilder)<font></font>
    {<font></font>
        modelBuilder.Query&lt;OperativeQuestion&gt;().ToView("OperativeQuestions");<font></font>
    }<font></font>
}<font></font>
 <font></font>
public static class FromSqlQueries<font></font>
{<font></font>
    public static IQueryable&lt;OperativeQuestion&gt; GetByUserEmail(this DbQuery&lt;OperativeQuestion&gt; source, string Email)<font></font>
        =&gt; source.FromSql($"SELECT Id, Email FROM [dbo].[OperativeQuestionsUserMail] ({Email})");<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Requ√™te LINQ finale</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">var businessObjectsData = await context<font></font>
    .OperativeQuestions<font></font>
    .GetByUserEmail(Email)<font></font>
    .Include(x =&gt; x.Question)<font></font>
    .Select(x =&gt; x.Question)<font></font>
    .SelectMany(x =&gt; x.ObjectQuestions,<font></font>
                (x, bo) =&gt; new<font></font>
                {<font></font>
                    Id = x.Id,<font></font>
                    ObjectId = bo.Object.Id,<font></font>
                    ObjectTypeId = bo.Object.ObjectType.Id,<font></font>
                    ObjectTypeName = bo.Object.ObjectType.Name,<font></font>
                    ObjectExternalId = bo.Object.ExternalId<font></font>
                })<font></font>
    .ToListAsync();<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'ordre du temps d'ex√©cution est pass√© de 200 √† 800 ms √† 2 √† 20 ms, etc., c'est-√†-dire dix fois plus vite. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si nous prenons plus de moyenne, alors au lieu de 350 ms, nous avons obtenu 8 ms. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Des avantages √©vidents, nous obtenons √©galement:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©duction g√©n√©rale de la charge de lecture,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©duction significative de la probabilit√© de blocage</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©duction du temps de blocage moyen √† des valeurs acceptables</font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'optimisation et le r√©glage fin des appels √† la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base de donn√©es MS SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> via </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un probl√®me qui peut √™tre r√©solu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce travail, le soin et la coh√©rence sont tr√®s importants. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au d√©but du processus:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il est n√©cessaire de v√©rifier les donn√©es avec lesquelles la requ√™te fonctionne (valeurs, types de donn√©es s√©lectionn√©s)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexer correctement ces donn√©es</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v√©rifier l'exactitude des conditions de connexion entre les tables</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä la prochaine it√©ration, l'optimisation r√©v√®le:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la base de la demande et le filtre principal de la demande sont d√©termin√©s</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©p√©tition de blocs de requ√™te similaires et de conditions crois√©es</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans le SSMS ou une autre interface graphique pour </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL Server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requ√™te SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> elle-m√™me est optimis√©e </font><font style="vertical-align: inherit;">(allocation d'un magasin de donn√©es interm√©diaire, construction de la requ√™te r√©sultante √† l'aide de ce magasin (il peut y en avoir plusieurs))</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† la derni√®re √©tape, en prenant comme base la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requ√™te SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> r√©sultante </font><font style="vertical-align: inherit;">, la structure de </font><b><font style="vertical-align: inherit;">requ√™te LINQ</font></b><font style="vertical-align: inherit;"> est reconstruite</font></font><b><font style="vertical-align: inherit;"></font></b></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requ√™te LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> r√©sultante </font><font style="vertical-align: inherit;">devrait devenir de structure identique √† la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requ√™te SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> optimale identifi√©e √† </font><font style="vertical-align: inherit;">partir du paragraphe 3.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remerciements</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un grand merci √† mes coll√®gues </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jobgemws</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alex_ozr</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fortis</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour avoir aid√© avec cet article.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr489204/index.html">Un aper√ßu de la fiabilit√© des services Facebook</a></li>
<li><a href="../fr489210/index.html">Test de performance du code Linux avec des exemples</a></li>
<li><a href="../fr489212/index.html">1C-Bitrix emp√™che la d√©sinscription √† la newsletter par l'obligation de soumettre leurs donn√©es personnelles</a></li>
<li><a href="../fr489214/index.html">Approche moderne pour tester la localisation sur iOS</a></li>
<li><a href="../fr489218/index.html">C'est na√Øf. Super: code et architecture d'un jeu simple</a></li>
<li><a href="../fr489228/index.html">Bot de discours √† la banque - le pire UX de tous les temps</a></li>
<li><a href="../fr489230/index.html">Quelles sont les performances des applications Web?</a></li>
<li><a href="../fr489232/index.html">Retour vers le futur des t√©l√©phones mobiles II</a></li>
<li><a href="../fr489234/index.html">Comment r√©ussir un pentest (mauvais conseil)</a></li>
<li><a href="../fr489236/index.html">Printemps: recherche de contexte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>