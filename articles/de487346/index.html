<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöû üñï ‚ÜïÔ∏è F√§lle f√ºr die Verwendung von Tools zur Analyse von Netzwerkanomalien: Lecksuche ‚ú® üë®üèº‚Äçü§ù‚Äçüë®üèª üíÜüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bei einer der Veranstaltungen fand eine interessante Diskussion √ºber die N√ºtzlichkeit von L√∂sungen der Klasse NTA (Network Traffic Analysis) statt, di...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>F√§lle f√ºr die Verwendung von Tools zur Analyse von Netzwerkanomalien: Lecksuche</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/cisco/blog/487346/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bei einer der Veranstaltungen fand eine interessante Diskussion √ºber die N√ºtzlichkeit von L√∂sungen der Klasse NTA (Network Traffic Analysis) statt, die mithilfe der Netflow-Telemetrie-Netzwerkinfrastruktur (oder anderer Flow-Protokolle) eine Vielzahl von Angriffen erkennen k√∂nnen. Meine Gegner argumentierten, dass Sie bei der Analyse von Headern und verwandten Informationen (und NTA analysiert im Gegensatz zu den klassischen Angriffserkennungssystemen IDS nicht den Paketk√∂rper) nicht viel sehen k√∂nnen. In diesem Artikel werde ich versuchen, diese Meinung zu widerlegen und das Gespr√§ch inhaltlicher zu gestalten. Ich werde einige echte Beispiele geben, wenn die NTA wirklich dazu beitr√§gt, verschiedene Anomalien und Bedrohungen zu identifizieren, die am Umfang oder sogar hinter dem Umfang fehlen. Und ich werde mit der Bedrohung beginnen, die in der Bedrohungsbewertung des letzten Jahres an erster Stelle stand, und ich denke, dies wird auch in diesem Jahr so ‚Äã‚Äãbleiben.Es geht um Informationslecks und die F√§higkeit, diese √ºber Netzwerktelemetrie zu erkennen.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde die Situation nicht mit den krummen H√§nden von Admins betrachten, die das Internet verlassen haben und ungesch√ºtzt wie Elastic oder MongoDB aussehen. Lassen Sie uns √ºber die gezielten Aktionen von Angreifern sprechen, wie dies bei der gefeierten Geschichte der Equifax-Kreditb√ºros der Fall war. Ich m√∂chte Sie daran erinnern, dass in diesem Fall die Angreifer zuerst die nicht gepatchte Sicherheitsl√ºcke zum √∂ffentlichen Webportal und dann zu den internen Datenbankservern durchdrungen haben. Sie blieben mehrere Monate unbemerkt und konnten Daten von 146 Millionen Kunden des Kreditb√ºros stehlen. K√∂nnte ein solcher Vorfall mithilfe von DLP-L√∂sungen identifiziert werden? H√∂chstwahrscheinlich nicht, da klassische DLPs nicht auf die Aufgabe der √úberwachung des Datenverkehrs aus Datenbanken mithilfe bestimmter Protokolle zugeschnitten sind, selbst wenn dieser Datenverkehr verschl√ºsselt ist.Die L√∂sung der NTA-Klasse kann solche Lecks jedoch recht leicht erkennen, indem ein bestimmter Schwellenwert der aus der Datenbank heruntergeladenen Informationsmenge √ºberschritten wird. Als N√§chstes werde ich zeigen, wie dies alles mithilfe der Cisco Stealthwatch Enterprise-L√∂sung konfiguriert und erkannt wird.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das erste, was wir tun m√ºssen, ist zu verstehen, wo sich unsere Datenbankserver im Netzwerk befinden, ihre Adressen zu bestimmen und sie zu gruppieren. In Cisco Stealthwatch kann die Inventarisierungsaufgabe entweder manuell oder mithilfe eines speziellen Klassifikators ausgef√ºhrt werden, der den Datenverkehr analysiert und ihn gem√§√ü den verwendeten Protokollen und dem Verhalten des Knotens der einen oder anderen Kategorie zuordnen kann. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ri/n5/uy/rin5uykkickqn7znft9qa0ulllu.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem wir Informationen zu allen Datenbankservern haben, beginnen wir eine Untersuchung, um herauszufinden, ob gro√üe Datenmengen aus der gew√ºnschten Gruppe von Knoten verloren gehen. Wir sehen, dass in unserem Fall die Datenbanken am aktivsten mit DHCP-Servern und Dom√§nencontrollern kommunizieren.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lb/xq/1z/lbxq1znvwtgzs01n4quxfwtgjli.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Angreifer stellen h√§ufig die Kontrolle √ºber einen der Netzwerkknoten her und verwenden ihn als Br√ºckenkopf, um ihren Angriff zu entwickeln. Auf der Ebene des Netzwerkverkehrs sieht es nach einer Anomalie aus: Das Scannen des Netzwerks von diesem Knoten wird immer h√§ufiger, Daten werden von der Dateifreigabe erfasst oder die Interaktion mit Servern. Daher besteht unsere n√§chste Aufgabe darin, zu verstehen, mit wem genau unsere Datenbanken am h√§ufigsten kommunizieren. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wb/er/0b/wber0bo8wqxtkswej7n7vmoffc8.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Gruppe der DHCP-Server stellt sich heraus, dass dies ein Knoten mit der Adresse 10.201.0.15 ist, mit dem die Interaktion etwa 50% des gesamten Datenverkehrs von Datenbankservern ausmacht. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yz/yb/vb/yzybvbnmgicokharg8oxu57lxwm.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die n√§chste logische Frage, die wir uns im Rahmen der Untersuchung stellen, lautet: ‚ÄûUnd wie sieht dieser Knoten in 10.201.0.15 aus? Mit wem interagiert er? Wie oft? Welche Protokolle? "</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mt/-s/ac/mt-sacge5hjgo2jwerw7omqwmlk.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es stellt sich heraus, dass der f√ºr uns interessante Knoten mit verschiedenen Segmenten und Knoten unseres Netzwerks kommuniziert (was nicht √ºberraschend ist, da es sich um einen DHCP-Server handelt), aber die Frage verursacht zu viel Interaktion mit dem Terminalserver mit der Adresse 10.201.0.23. Ist das normal? Es gibt eindeutig eine Art Anomalie. Ein DHCP-Server kann nicht so aktiv mit einem Terminalserver kommunizieren - 5610 Streams und 23,5 GB Daten. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4i/mk/jm/4imkjmqkv1eumztrmdyb88etx3c.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und diese Interaktion wird √ºber NFS durchgef√ºhrt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vl/2a/wo/vl2awoxjk2kijyg494rvz8bqsr4.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir machen den n√§chsten Schritt und versuchen zu verstehen, mit wem unser Terminalserver interagiert. Es stellt sich heraus, dass er eine ziemlich aktive Kommunikation mit der Au√üenwelt hat - mit Knoten in den USA, Gro√übritannien, Kanada, D√§nemark, den Vereinigten Arabischen Emiraten, Katar, der Schweiz usw.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uw/yr/3s/uwyr3shmwntm1clarsxud2xfcgq.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Verdacht wurde durch die P2P-Interaktion mit Puerto Rico verursacht, auf die 90% des gesamten Verkehrs entfielen. Dar√ºber hinaus hat unser Terminalserver √ºber den 53. Port, der mit dem DNS-Protokoll verbunden ist, mehr als 17 GB Daten nach Puerto Rico √ºbertragen. K√∂nnen Sie sich vorstellen, dass ein solches Datenvolumen √ºber DNS √ºbertragen wird? Und ich erinnere Sie daran, dass laut Cisco-Untersuchungen 92% der Malware DNS verwendet, um ihre Aktivit√§ten zu verbergen (Herunterladen von Updates, Empfangen von Befehlen, Entladen von Daten). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f1/mm/5b/f1mm5b4rmsqx5butgpw-mlsmk0e.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wenn das ITU-DNS-Protokoll nicht nur ge√∂ffnet, sondern auch nicht √ºberpr√ºft wird, haben wir ein gro√ües Loch in unserem Umkreis. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yt/_4/dj/yt_4djyxlui4rzkyvsko1zsejlu.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sobald der Knoten 10.201.0.23 uns solche Verd√§chtigungen verursacht hat, wollen wir sehen, mit wem er noch spricht.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zh/ya/7r/zhya7r8umwppjkxvidzpmpca9zy.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unser ‚ÄûVerd√§chtiger‚Äú tauscht die H√§lfte des gesamten Datenverkehrs mit dem Knoten 10.201.3.18 aus, der sich in einer Gruppe von Arbeitsstationen von Mitarbeitern der Vertriebs- und Marketingabteilung befindet. Wie typisch ist es f√ºr unsere Organisation, dass der Terminalserver mit dem Computer des Verk√§ufers oder Vermarkters ‚Äûkommuniziert‚Äú?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pu/vq/nf/puvqnfekb1fdkqjenprrlsesxpi.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also haben wir eine Untersuchung durchgef√ºhrt und das folgende Bild herausgefunden. Daten vom Datenbankserver wurden auf einen DHCP-Server √ºbertragen und anschlie√üend √ºber NFS an einen Terminalserver in unserem Netzwerk und anschlie√üend mithilfe des DNS-Protokolls an externe Adressen in Puerto Rico √ºbertragen. Dies ist ein klarer Versto√ü gegen Sicherheitsrichtlinien. Gleichzeitig interagierte der Terminalserver auch mit einer der Workstations im Netzwerk. Was hat diesen Vorfall verursacht? Ein gestohlenes Konto? Infiziertes Ger√§t? Wir wissen nicht. Dies erfordert eine Fortsetzung der Untersuchung, die auf der NTA-Klassenl√∂sung basiert und die Analyse von Netzwerkverkehrsanomalien erm√∂glicht.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ge/wt/vo/gewtvo6-5k-41fdkkxaozhlep7q.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und jetzt interessiert uns, was wir mit den festgestellten Verst√∂√üen gegen die Sicherheitsrichtlinien tun werden. Sie k√∂nnen regelm√§√üige Analysen gem√§√ü dem obigen Schema durchf√ºhren oder die NTA-Richtlinie so konfigurieren, dass sie sofort signalisiert, wenn √§hnliche Verst√∂√üe festgestellt werden. Dies erfolgt entweder √ºber das entsprechende allgemeine Men√º oder f√ºr jede w√§hrend der Untersuchung erkannte Verbindung. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cc/rp/qa/ccrpqaqizyxou5zjqqfw36hsl4i.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So sieht die Interaktionserkennungsregel aus, deren Quelle der Datenbankserver ist und deren Ziel externe Knoten sowie interne Knoten mit Ausnahme von Webservern sind.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hu/xy/ah/huxyah2skmz8jpc7d3dhtxtl3xe.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn ein solches Ereignis erkannt wird, generiert das Netzwerkverkehrsanalysesystem sofort ein Korrespondenzalarmsignal und sendet es abh√§ngig von den Einstellungen √ºber die Kommunikationsmittel mit dem Administrator an SIEM oder blockiert die erkannte Verletzung sogar automatisch (Cisco Stealthwatch f√ºhrt dies durch Interaktion mit Cisco ISE durch) ) </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lj/ii/rn/ljiirng2huuf6qzjxg-kiagufcu.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Denken Sie daran, als ich den Fall mit Equifax erw√§hnte, erw√§hnte ich, dass die Angreifer einen verschl√ºsselten Kanal verwendeten, um Daten zu sichern. F√ºr DLP wird dieser Datenverkehr zu einer unl√∂sbaren Aufgabe, f√ºr L√∂sungen der NTA-Klasse jedoch nicht - sie verfolgen √ºbersch√ºssigen Datenverkehr oder nicht autorisierte Interaktionen zwischen Knoten, unabh√§ngig von der Verwendung der Verschl√ºsselung.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/u2/qg/qg/u2qgqgkkrsk_etuu7nav-k9hndg.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oben wurde nur ein Fall gezeigt (in den folgenden Materialien werden andere Beispiele f√ºr die Verwendung von NTA f√ºr Informationssicherheitszwecke betrachtet). Mit modernen L√∂sungen der Klasse "Netzwerkverkehrsanalyse" k√∂nnen Sie jedoch sehr flexible Regeln erstellen und nicht nur die grundlegenden Parameter des IP-Paket-Headers ber√ºcksichtigen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/15/ya/uk/15yaukzbimtm-o-yf41wnibz2ik.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sondern auch F√ºhren Sie eine eingehendere Analyse durch, bis Sie den Vorfall mit dem Benutzernamen aus Active Directory verkn√ºpfen, nach sch√§dlichen Dateien per Hash suchen (z. B. als Kompromissindikator von SOSOPKA, FinCERT, Cisco Threat Grid usw.) usw.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dc/oe/55/dcoe55wr_luv_kvpjjrqwapc5jc.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist einfach zu implementieren. So sieht beispielsweise die √ºbliche Regel aus, mit der alle Arten der Interaktion zwischen Datenbankservern und externen Knoten in den letzten 30 Tagen mithilfe eines beliebigen Protokolls erkannt werden. Wir sehen, dass unsere Datenbanken mit Knoten au√üerhalb des DBMS-Segments unter Verwendung der Protokolle DNS, SMB und Port 8088 ‚Äûkommuniziert‚Äú haben. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hn/70/nh/hn70nhlbp10lmjmgbkjj_8_bs8i.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zus√§tzlich zu der tabellarischen Form zur Darstellung der Ergebnisse von Untersuchungen oder Suchen k√∂nnen wir sie auch visualisieren. In unserem Szenario k√∂nnte ein Fragment des Netzwerkflussdiagramms folgenderma√üen aussehen: Auf </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zs/yv/jf/zsyvjfgvrptgxwgv0eefnyz5pju.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
derselben Karte k√∂nnen wir Richtlinien verwalten - Verbindungen blockieren oder den Prozess der Erstellung von √úberwachungsregeln f√ºr die f√ºr uns interessanten Fl√ºsse automatisieren.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ix/tj/rk/ixtjrkszqelbtsgpwdmdxdluubm.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist ein sehr interessantes und lebendiges Beispiel f√ºr die Verwendung von Netflow-√úberwachungstools (und anderen Ablaufprotokollen) f√ºr die Cybersicherheit. </font><font style="vertical-align: inherit;">In den folgenden Hinweisen m√∂chte ich zeigen, wie Sie mit NTA b√∂sartigen Code (z. B. Shamoon), b√∂sartige Server (z. B. die DNSpionage-Kampagne), RAS-Programme (RAT), Unternehmensumgehungen usw. umgehen k√∂nnen.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de487332/index.html">Testen Sie billige Ergolux LED-Lampen</a></li>
<li><a href="../de487334/index.html">Wie "remote" die Zusammenarbeit verbessert</a></li>
<li><a href="../de487336/index.html">Einheit - Aktivieren Sie Multidex oder zu viele Methoden</a></li>
<li><a href="../de487340/index.html">Da haben wir den n√§chsten Designer von Chat Bots gemacht. Teil 1</a></li>
<li><a href="../de487342/index.html">Lektion 2 - Tagungen und Veranstaltungen</a></li>
<li><a href="../de487348/index.html">Priority Task Ranking - IL TEMPO App</a></li>
<li><a href="../de487356/index.html">Wirst du dich √§ndern? Denk nochmal</a></li>
<li><a href="../de487358/index.html">BERT, ELMO und Co. in Bildern (wie das Transfer-Training zu NLP kam)</a></li>
<li><a href="../de487360/index.html">Die Anonymisierung von Daten garantiert nicht Ihre vollst√§ndige Anonymit√§t</a></li>
<li><a href="../de487362/index.html">Angular 9 ist jetzt verf√ºgbar - Ivy ist angekommen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>