<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐คฐ ๐๐ป ููููุฉ ุงุณุชุฎุฏุงู ุจุฑูููุซููุณ ูููุดู ุนู ุงูุญุงูุงุช ุงูุดุงุฐุฉ ูู GitLab ๐จ๐ป ๐ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุฅุญุฏู ุงูููุฒุงุช ุงูุฃุณุงุณูุฉ ููุบุฉ ุงูุงุณุชุนูุงู Prometheus ูู ุชุฌููุน ุงูุณูุงุณู ุงูุฒูููุฉ ูู ุงูููุช ุงููุนูู . ููููู ุฃูุถูุง ุงุณุชุฎุฏุงู ูุบุฉ ุงูุงุณุชุนูุงู Prometheus ูููุดู ุนู ุงูุญุงู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ููููุฉ ุงุณุชุฎุฏุงู ุจุฑูููุซููุณ ูููุดู ุนู ุงูุญุงูุงุช ุงูุดุงุฐุฉ ูู GitLab</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/499032/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a38/51d/6f9/a3851d6f99b3624787dfa4cfeb2112e5.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุญุฏู ุงูููุฒุงุช ุงูุฃุณุงุณูุฉ ููุบุฉ ุงูุงุณุชุนูุงู Prometheus ูู ุชุฌููุน </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุณูุงุณู ุงูุฒูููุฉ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">ุงูููุช</font></a><font style="vertical-align: inherit;"> ุงููุนูู </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ููููู ุฃูุถูุง ุงุณุชุฎุฏุงู ูุบุฉ ุงูุงุณุชุนูุงู Prometheus ูููุดู ุนู ุงูุญุงูุงุช ุงูุดุงุฐุฉ ูู ุจูุงูุงุช ุงูุณูุงุณู ุงูุฒูููุฉ.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุงู </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">ูุฑูู </font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mail.ru Cloud Solutions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจุชุฑุฌูุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุงู ููููุฏุณ ูุฑูู ุงูุจููุฉ ุงูุชุญุชูุฉ ูู GitLab</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ุญูุซ ุณุชุฌุฏ ุฃูุซูุฉ ุจุฑูุฌูุฉ ููููู ุชุฌุฑุจุชูุง ุนูู ุฃูุธูุชู.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ูู ุงููุดู ุนู ุงูุดุฐูุฐุ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุงู ุฃุฑุจุนุฉ ุฃุณุจุงุจ ุฑุฆูุณูุฉ ุชุญุฏุฏ ุฃูููุฉ ุงููุดู ุนู ุงูุดุฐูุฐ ูู GitLab:</font></font><br>
<br>
<ol>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุดุฎูุต ุงูุญูุงุฏุซ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : ูููููุง ุงูุชุดุงู ุงูุฎุฏูุงุช ุงูุชู ุชุฌุงูุฒุช ูุทุงููุง ุงูุทุจูุนู ุนู ุทุฑูู ุชูููู ููุช ุงูุชุดุงู ุงูุญูุงุฏุซ (MTTD) ุ ูุจุงูุชุงูู ุ ุชูุฏูู ุญู ุฃุณุฑุน ูููุดููุฉ.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุดู ุนู ุชุฏููุฑ ุงูุฃุฏุงุก</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ุชู ุฅุฏุฎุงู ุงูุญุฏุงุฑ ูู ุฎุฏูุฉ ูุชุณุจุจ ูู ูุตูููุง ุฅูู ุฎุฏูุฉ ุฃุฎุฑู ูุซูุฑูุง ุ ููููููุง ุงูุชุดุงู ูุฐู ุงููุดููุฉ ูุฅุตูุงุญูุง ุจุณุฑุนุฉ.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุดู ุนู ุงูุฅุณุงุกุฉ ูุงููุถุงุก ุนูููุง</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : ูููุฑ GitLab ุขููุงุช ุงูุชุณููู ูุงูุชูุงูู ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitLab CI / CD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) ูุงูุงุณุชุถุงูุฉ (ุตูุญุงุช GitLab) ูุนุฏุฏ ูุญุฏูุฏ ูู ุงููุณุชุฎุฏููู ุงูุฐูู ูููููู ุงุณุชุฎุฏุงู ูุฐู ุงูุขููุงุช.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฃูุงู</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : ูุนุฏ ุงููุดู ุนู ุงูุดุฐูุฐ ุฃูุฑูุง ููููุง ูููุดู ุนู ุงูุงุชุฌุงูุงุช ุบูุฑ ุงููุนุชุงุฏุฉ ูู ุณูุณูุฉ GitLab ุงูุฒูููุฉ.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุฐู ุงูุฃุณุจุงุจ ูุบูุฑูุง ุ ูุฑุฑ ูุคูู ุงูููุงูุฉ ูุนุฑูุฉ ููููุฉ ุชูููู ุชุนุฑูู ุงูุดุฐูุฐ ูู ุณูุณูุฉ GitLab ุงูุฒูููุฉ ุจุงุณุชุฎุฏุงู ุงุณุชุนูุงูุงุช ูููุงุนุฏ Prometheus.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ูู ูุณุชูู ุงูุชุฌููุน ุงูุตุญูุญุ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃููุงู ุ ูุฌุจ ุชุฌููุน ุงูุณูุงุณู ุงูุฒูููุฉ ุจุดูู ุตุญูุญ. </font><font style="vertical-align: inherit;">ูู ุงููุซุงู ุฃุฏูุงู ุ ุงุณุชุฎุฏููุง ุนุฏุงุฏ http_requests_total ุงูููุงุณู ูุงุณุชุฑุฏุงุฏ ุงูุจูุงูุงุช ุ ุนูู ุงูุฑุบู ูู ุฃู ุงูุนุฏูุฏ ูู ุงูููุงููุณ ุงูุฃุฎุฑู ุณุชูุนู ุฐูู ุฃูุถูุง.</font></font><br>
<br>
<pre><code class="plaintext hljs">http_requests_total{<font></font>
 job="apiserver",<font></font>
 method="GET",<font></font>
 controller="ProjectsController",<font></font>
 status_code="200",<font></font>
 environment="prod"<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุญุชูู ูููุงุณ ุงูุงุฎุชุจุงุฑ ูุฐุง ุนูู ุงูุนุฏูุฏ ูู ุงููุนููุงุช: ุงูุทุฑููุฉ ุ ูุญุฏุฉ ุงูุชุญูู ุ ุฑูุฒ ุงูุญุงูุฉ (ููุฏ_ุงูุญุงูุฉ) ุ ุงูุจูุฆุฉ ุ ุจุงูุฅุถุงูุฉ ุฅูู ุงููุนููุงุช ุงูุชู ุฃุถุงููุง Prometheus ููุณู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุงููุธููุฉ ูุงููุซุงู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุญุชุงุฌ ุงูุขู ุฅูู ุงุฎุชูุงุฑ ุงููุณุชูู ุงูุตุญูุญ ูุชุฌููุน ุงูุจูุงูุงุช. </font><font style="vertical-align: inherit;">ูุซูุฑ ุฌุฏูุง ุ ูููู ุฌุฏูุง - ูู ูุฐุง ููู ูููุดู ุนู ุงูุญุงูุงุช ุงูุดุงุฐุฉ. </font><font style="vertical-align: inherit;">ุฅุฐุง ูุงูุช ุงูุจูุงูุงุช ูุฌูุนุฉ ุฌุฏูุง ุ ูููุงู ูุดููุชุงู ูุญุชููุชุงู:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููููู ุชุฎุทู ุงูุดุฐูุฐ ูุฃู ุงูุชุฌููุน ูุฎูู ุงููุดุงูู ุงูุชู ุชุญุฏุซ ูู ูุฌููุนุงุช ูุฑุนูุฉ ูู ุจูุงูุงุชู.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุฐุง ูุฌุฏุช ุดุฐูุฐูุง ุ ููู ุงูุตุนุจ ุฑุจุทู ุจุฌุฒุก ูููุตู ูู ูุธุงูู ุฏูู ุจุฐู ุฌูุฏ ุฅุถุงูู.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฐุง ูู ูุชู ุชุฌููุน ุงูุจูุงูุงุช ุจุดูู ูุงูู ุ ููุฏ ูุคุฏู ุฐูู ุฅูู ุฒูุงุฏุฉ ุนุฏุฏ ุงูุฅูุฌุงุจูุงุช ุงูุฎุงุทุฆุฉ ุ ูุถูุงู ุนู ุงูุชูุณูุฑ ุบูุฑ ุงูุตุญูุญ ููุจูุงูุงุช ุงูุตุงูุญุฉ ุนูู ุฃููุง ุฎุงุทุฆุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจูุงุกู ุนูู ุฎุจุฑุชูุง ุ ูุฅู ุงููุณุชูู ุงูุฃูุซุฑ ุตุญุฉ ููุชุฌููุน ูู ูุณุชูู ุงูุฎุฏูุฉ ุ ุฃู ุฃููุง ูุถูู ุชุณููุฉ ุงูุนูู (ุงููุธููุฉ) ูุงูุจูุฆุฉ (ุงูุจูุฆุฉ) ุ ููุชุฌุงูู ุฌููุน ุงูุชุตูููุงุช ุงูุฃุฎุฑู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุชุฌููุน ุ ุงูุฐู ุณููุงูุดู ุทูุงู ุงูููุงูุฉ ุ ูุดูู: ุงููุธููุฉ - http_request ุ ุงูุชุฌููุน - ุฎูุณ ุฏูุงุฆู ุ ูุงูุชู ูุชู ุญุณุงุจูุง ุนูู ุฃุณุงุณ ุงูุนูู ูุงูุจูุฆุฉ ูู ุฎูุณ ุฏูุงุฆู.</font></font><br>
<br>
<pre><code class="plaintext hljs">- record: job:http_requests:rate5m<font></font>
expr: sum without(instance, method, controller, status_code)<font></font>
(rate(http_requests_total[5m]))<font></font>
# --&gt; job:http_requests:rate5m{job="apiserver", environment="prod"}&nbsp; 21321<font></font>
# --&gt; job:http_requests:rate5m{job="gitserver", environment="prod"}&nbsp; 2212<font></font>
# --&gt; job:http_requests:rate5m{job="webserver", environment="prod"}&nbsp; 53091</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุงููุซุงู ุฃุนูุงู ุ ูููู ููุงุญุธุฉ ุฃูู ูู ุณูุณูุฉ http_requests_total ุ ูุชู ุงุฎุชูุงุฑ ุงููุฌููุนุงุช ุงููุฑุนูุฉ ูู ุณูุงู ุงูุนูู ูุงูุจูุฆุฉ ุ ุซู ูุชู ุงููุธุฑ ูู ุนุฏุฏูุง ูู ุฎูุณ ุฏูุงุฆู.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุณุชุฎุฏุงู ููุงุท Z ูููุดู ุนู ุงูุดุฐูุฐ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ุชุทุจูู ุงููุจุงุฏุฆ ุงูุฃุณุงุณูุฉ ููุฅุญุตุงุกุงุช ูููุดู ุนู ุงูุดุฐูุฐ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฐุง ููุช ุชุนุฑู ุงููุชูุณุท </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงูุงูุญุฑุงู ุงููุนูุงุฑู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุณูุณูุฉ Prometheus ุ ูููููู ุงุณุชุฎุฏุงู ุฃู ุนููุฉ ูู ุงูุณูุณูุฉ ูุญุณุงุจ ุงูุฏุฑุฌุฉ z.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุฏุฑุฌุฉ Z ุนุจุงุฑุฉ ุนู ููุงุณ ุงูุงูุชุดุงุฑ ุงููุณุจู ูููููุฉ ุงูููุญูุธุฉ ุฃู ุงูููุงุณุฉ ุ ูุงูุชู ุชูุถุญ ุนุฏุฏ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุงูุญุฑุงูุงุช ุงููุนูุงุฑูุฉ ุงูุชู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุชุดุฑูุง ุจุงููุณุจุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุชูุณุท โโุงููููุฉ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃู ุฃู ุงูุฏุฑุฌุฉ z = 0 ุชุนูู ุฃู ุงููุชูุฌุฉ z ูุชุทุงุจูุฉ ูุน ูุชูุณุท โโุงููููุฉ ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ูุน ุงูุชูุฒูุน ุงูููุงุณู ุ ูุชุนูู ุงูุฏุฑุฌุฉ z = 1 ุฃู ุงูุงูุญุฑุงู ุงููุนูุงุฑู = 1.0 ูู ุงููุชูุณุท.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุชุฑุถ ุฃู ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ ููุง ุชูุฒูุน ุทุจูุนู ุ ููุง ูุนูู ุฃู 99.7 ูช ูู ุงูุนููุงุช ููุง ุฏุฑุฌุฉ z ูู 0 ุฅูู 3. ูููุง ูุงูุช ุงูุฏุฑุฌุฉ z ูู ุงูุตูุฑ ุ ูู ุงุญุชูุงู ูุฌูุฏูุง.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุทุจู ูุฐู ุงูุฎุงุตูุฉ ูููุดู ุนู ุงูุญุงูุงุช ุงูุดุงุฐุฉ ูู ุณูุณูุฉ ุจูุงูุงุช ุจุฑูููุซููุณ:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุญู ูุญุณุจ ุงููุชูุณุท โโูุงูุงูุญุฑุงู ุงููุนูุงุฑู ูููููุงุณ ุจุงุณุชุฎุฏุงู ุจูุงูุงุช ุฐุงุช ุญุฌู ุนููุฉ ูุจูุฑ. </font><font style="vertical-align: inherit;">ูู ูุฐุง ุงููุซุงู ุ ูุณุชุฎุฏู ุงูุจูุงูุงุช ุงูุฃุณุจูุนูุฉ. </font><font style="vertical-align: inherit;">ุฅุฐุง ุงูุชุฑุถูุง ุฃู ุงูุณุฌูุงุช ูุชู ุชูููููุง ูุฑุฉ ูุงุญุฏุฉ ูู ุงูุฏูููุฉ ุ ูุณูููู ูุฏููุง ูู ุงูุฃุณุจูุน ูุง ูุฒูุฏ ููููุงู ุนู 10000 ุนููุฉ.</font></font><br>
<br>
<pre><code class="plaintext hljs"># Long-term average value for the series<font></font>
- record: job:http_requests:rate5m:avg_over_time_1w<font></font>
expr: avg_over_time(job:http_requests:rate5m[1w])<font></font>
<font></font>
# Long-term standard deviation for the series<font></font>
- record: job:http_requests:rate5m:stddev_over_time_1w<font></font>
expr: stddev_over_time(job:http_requests:rate5m[1w])</code></pre><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููููุง ุญุณุงุจ ุงูุฏุฑุฌุฉ z ูุงุณุชุนูุงู Prometheus ุจูุฌุฑุฏ ุฃู ูุญุตู ุนูู ุงููุชูุณุท โโูุงูุงูุญุฑุงู ุงููุนูุงุฑู ููุชุฌููุน.</font></font><br>
<br>
<pre><code class="plaintext hljs"># Z-Score for aggregation<font></font>
(<font></font>
job:http_requests:rate5m -<font></font>
job:http_requests:rate5m:avg_over_time_1w<font></font>
) /&nbsp; job:http_requests:rate5m:stddev_over_time_1w</code></pre><br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจูุงุกู ุนูู ุงููุจุงุฏุฆ ุงูุฅุญุตุงุฆูุฉ ููุชูุฒูุนุงุช ุงูุนุงุฏูุฉ ุ ุงูุชุฑุถ ุฃู ุฃู ูููุฉ ุฎุงุฑุฌ ุงููุทุงู ูู +3 ุฅูู -3 ุณุชููู ุดุงุฐุฉ. </font><font style="vertical-align: inherit;">ููููุง ูุฐูู ุ ูููููุง ุฅูุดุงุก ุชุญุฐูุฑ ุญูู ูุซู ูุฐู ุงูุญุงูุงุช ุงูุดุงุฐุฉ. </font><font style="vertical-align: inherit;">ุนูู ุณุจูู ุงููุซุงู ุ ุณูู ูุชููู ุชูุจูููุง ุนูุฏูุง ูุชุฌุงูุฒ ุงูุชุฌููุน ูุฏููุง ูุฐุง ุงููุทุงู ูุฃูุซุฑ ูู ุฎูุณ ุฏูุงุฆู.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/82e/e84/e96/82ee84e96be5ca6895b5aa5d6f0441ad.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑุณู ุจูุงูู ูุนุฏุฏ ุงูุทูุจุงุช ูู ุงูุซุงููุฉ ูุฎุฏูุฉ ุตูุญุงุช GitLab ููุฏุฉ 48 ุณุงุนุฉ. </font><font style="vertical-align: inherit;">ุชู ุชูููุฒ ุงูุฏุฑุฌุฉ Z ูู ุงููุทุงู ูู +3 ุฅูู -3 ุจุงูููู ุงูุฃุฎุถุฑ.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ูุฏ ูุตุนุจ ุชูุณูุฑ ุงูุฏุฑุฌุฉ Z ุนูู ุงูุฑุณูู ุงูุจูุงููุฉ ุ ุญูุซ ูุง ุชุญุชูู ูุฐู ุงููููุฉ ุนูู ูุญุฏุฉ ููุงุณ. </font><font style="vertical-align: inherit;">ููู ุงูุดุฐูุฐ ูู ูุฐุง ุงูุฑุณู ุงูุจูุงูู ุณูู ุงูุชุญุฏูุฏ. </font><font style="vertical-align: inherit;">ูู ุดูุก ูุชุฌุงูุฒ ุงูููุทูุฉ ุงูุฎุถุฑุงุก ุ ูุงูุฐู ููุธูุฑ ููุฑูุง ููููู ุจููุงุท z ูู -3 ุฅูู +3 ุ ุณูููู ูููุฉ ุบูุฑ ุทุจูุนูุฉ.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฐุง ุชูุนู ุฅุฐุง ูุงู ุชูุฒูุน ุงูุจูุงูุงุช ุบูุฑ ุทุจูุนู</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุชุฑุถ ุฃู ุชูุฒูุน ุงูุจูุงูุงุช ุฃูุฑ ุทุจูุนู. </font><font style="vertical-align: inherit;">ุฎูุงู ุฐูู ุ ุณุชููู ุงููุชูุฌุฉ z ุงูุฎุงุตุฉ ุจูุง ุฎุงุทุฆุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุงู ุงููุซูุฑ ูู ุงูุญูู ุงูุฅุญุตุงุฆูุฉ ูุชุญุฏูุฏ ุงูุญุงูุฉ ุงูุทุจูุนูุฉ ูุชูุฒูุน ุงูุจูุงูุงุช ุ ูููู ุฃูุถู ุทุฑููุฉ ูู ุงูุชุญูู ูู ุฃู ุงููุชูุฌุฉ ุงูุถุฑูุจูุฉ ููุจูุงูุงุช ุชูุน ูู ุงููุทุงู ูู -4.0 ุฅูู +4.0. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงุณุชุนูุงูุงู ูู ุจุฑูููุซููุณ ูุธูุฑุงู ุงูุญุฏ ุงูุฃุฏูู ูุงูุฃูุตู ูู ุงูููุงุท z:</font></font><br>
<br>
<pre><code class="plaintext hljs">(<font></font>
max_over_time(job:http_requests:rate5m[1w]) - avg_over_time(job:http_requests:rate5m[1w])<font></font>
) / stddev_over_time(job:http_requests:rate5m[1w])<font></font>
# --&gt; {job="apiserver", environment="prod"}&nbsp; 4.01<font></font>
# --&gt; {job="gitserver", environment="prod"}&nbsp; 3.96<font></font>
# --&gt; {job="webserver", environment="prod"}&nbsp; 2.96<font></font>
<font></font>
(<font></font>
 min_over_time(job:http_requests:rate5m[&lt;1w]) - avg_over_time(job:http_requests:rate5m[1w])<font></font>
) / stddev_over_time(job:http_requests:rate5m[1w])<font></font>
# --&gt; {job="apiserver", environment="prod"}&nbsp; -3.8<font></font>
# --&gt; {job="gitserver", environment="prod"}&nbsp; -4.1<font></font>
# --&gt; {job="webserver", environment="prod"}&nbsp; -3.2</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฐุง ูุงูุช ูุชุงุฆุฌู ูู ุงููุทุงู ูู -20 ุฅูู +20 ุ ููุฐุง ูุนูู ุฃูู ุชู ุงุณุชุฎุฏุงู ุงููุซูุฑ ูู ุงูุจูุงูุงุช ูุชู ุชุดููู ุงููุชุงุฆุฌ. </font><font style="vertical-align: inherit;">ุชุฐูุฑ ุฃูุถูุง ุฃูู ูุฌุจ ุงูุนูู ูุน ุงูุตููู ุงููุฌูุนุฉ. </font><font style="vertical-align: inherit;">ุชุชุถูู ุงูููุงููุณ ุงูุชู ูุง ุชุญุชูู ุนูู ุชูุฒูุน ุนุงุฏู ูุนููุงุช ูุซู ูุนุฏู ุงูุฎุทุฃ ูุงูุชุฃุฎูุฑ ูุฃุทูุงู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ููุง ุฅูู ุฐูู. </font><font style="vertical-align: inherit;">ููู ุงูุนุฏูุฏ ูู ูุฐู ุงูููุงููุณ ุณุชุนูู ุจุดูู ุฃูุถู ูุน ุนุชุจุงุช ุงูุชูุจูู ุงูุซุงุจุชุฉ.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุดู ุงูุดุฐูุฐ ุงูููุณูู ุงูุงุญุตุงุฆู</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูู ุงูุฑุบู ูู ุฃู ุญุณุงุจ ุงูุฏุฑุฌุงุช z ูุนูู ุจุดูู ุฌูุฏ ูุน ุงูุชูุฒูุน ุงูุทุจูุนู ูุจูุงูุงุช ุงูุณูุงุณู ุงูุฒูููุฉ ุ ุฅูุง ุฃู ููุงู ุทุฑููุฉ ุซุงููุฉ ูููู ุฃู ุชุนุทู ูุชุงุฆุฌ ูุดู ุดุฐูุฐ ุฃูุซุฑ ุฏูุฉ. </font><font style="vertical-align: inherit;">ูุฐุง ูู ุงุณุชุฎุฏุงู ุงูููุณููุฉ ุงูุฅุญุตุงุฆูุฉ.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูููุณููุฉ ูู ุณูุฉ ูู ุณูุงุช ูููุงุณ ุงูุณูุงุณู ุงูุฒูููุฉ ุนูุฏูุง ูุฎุถุน ูุฐุง ุงููููุงุณ ูุชุบูุฑุงุช ููุชุธูุฉ ููุงุจูุฉ ููุชูุจุค ุชุชูุฑุฑ ูู ูู ุฏูุฑุฉ.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/096/646/cfc/096646cfc711897a4de6ce82d41d88d4.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฎุทุท ุงูุทูุจุงุช ูู ุงูุซุงููุฉ (RPS) ูู ุงูุงุซููู ุฅูู ุงูุฃุญุฏ ููุฏุฉ ุฃุฑุจุนุฉ ุฃุณุงุจูุน ูุชุชุงููุฉ</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ููุถุญ ุงูุฑุณู ุงูุจูุงูู ุฃุนูุงู RPS (ุนุฏุฏ ุงูุทูุจุงุช ูู ุงูุซุงููุฉ) ููุฏุฉ ุณุจุนุฉ ุฃูุงู - ูู ุงูุงุซููู ุฅูู ุงูุฃุญุฏ ุ ููุฏุฉ ุฃุฑุจุนุฉ ุฃุณุงุจูุน ูุชุชุงููุฉ. </font><font style="vertical-align: inherit;">ูุณูู ูุฐุง ุงููุทุงู ุงูุฐู ูุณุชูุฑ ูุณุจุนุฉ ุฃูุงู ุจู "ุงูุฅุฒุงุญุฉ" ุ ุฃู ุงูููุท ุงูุฐู ุณูุชู ุงุณุชุฎุฏุงูู ููููุงุณ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุฃุณุจูุน ุนูู ุงูุฑุณู ุงูุจูุงูู ูู ููู ูุฎุชูู. </font><font style="vertical-align: inherit;">ูุดุงุฑ ุฅูู ููุณููุฉ ุงูุจูุงูุงุช ูู ุฎูุงู ุชุณูุณู ุงูุงุชุฌุงูุงุช ุงูููุถุญุฉ ุนูู ุงูุฑุณู ุงูุจูุงูู - ูู ุตุจุงุญ ููู ุงูุงุซููู ููุงุญุธ ุฒูุงุฏุฉ ููุงุซูุฉ ูู RPS ุ ููู ุงููุณุงุก ููู ุงูุฌูุนุฉ ููุงุญุธ ุฏุงุฆููุง ุงูุฎูุงุถูุง ูู RPS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุงุณุชุฎุฏุงู ุงูููุณููุฉ ูู ุจูุงูุงุช ุงูุณูุงุณู ุงูุฒูููุฉ ูุฏููุง ุ ูููููุง ุงูุชูุจุค ุจุฏูุฉ ุฃูุจุฑ ุจุญุฏูุซ ุญุงูุงุช ุดุงุฐุฉ ูุงูุชุดุงููุง.&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููููุฉ ุงุณุชุฎุฏุงู ุงูููุณููุฉ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุณุชุฎุฏู ุจุฑูููุซููุณ ุงูุนุฏูุฏ ูู ุงูุขููุงุช ุงูุฅุญุตุงุฆูุฉ ุงููุฎุชููุฉ ูุญุณุงุจ ุงูููุณููุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃููุงู ุ ูู ุจุฅุฌุฑุงุก ุญุณุงุจ ุ ูุถูููุง ุงุชุฌุงู ููู ููุฃุณุจูุน ุฅูู ูุชุงุฆุฌ ุงูุฃุณุจูุน ุงูุณุงุจู. ูุชู ุญุณุงุจ ุงุชุฌุงู ุงูููู ููุง ููู: ุงุทุฑุญ ุงููุชูุณุท โโุงููุชุญุฑู ููุฃุณุจูุน ุงููุงุถู ูู ุงููุชูุณุท โโุงููุชุญุฑู ููุฃุณุจูุน ุงููุงุถู.</font></font><br>
<br>
<pre><code class="plaintext hljs">- record: job:http_requests:rate5m_prediction<font></font>
&nbsp; expr: &gt;<font></font>
&nbsp; &nbsp; job:http_requests:rate5m offset 1w&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Value from last period<font></font>
&nbsp; &nbsp; + job:http_requests:rate5m:avg_over_time_1w # One-week growth trend<font></font>
&nbsp; &nbsp; โ job:http_requests:rate5m:avg_over_time_1w offset 1w</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชุถุญ ุฃู ุงูุชูุฑุงุฑ ุงูุฃูู "ุถูู" ุฅูู ุญุฏ ูุง - ูุณุชุฎุฏู ูุงูุฐุฉ ุงูุฎูุณ ุฏูุงุฆู ูู ูุฐุง ุงูุฃุณุจูุน ูุงูุฃุณุจูุน ุงูุณุงุจู ููุญุตูู ุนูู ุชููุนุงุชูุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุงูุชูุฑุงุฑ ุงูุซุงูู ุ ูููู ุจุชูุณูุน ุชุบุทูุชูุง ูู ุฎูุงู ุฃุฎุฐ ูุชูุณุท โโูุชุฑุฉ ุงูุฃุฑุจุน ุณุงุนุงุช ููุฃุณุจูุน ุงูุณุงุจู ูููุงุฑูุชูุง ุจุงูุฃุณุจูุน ุงูุญุงูู.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุจุงูุชุงูู ุ ุฅุฐุง ุญุงูููุง ุงูุชูุจุค ุจูููุฉ ุงููููุงุณ ูู ุงูุณุงุนุฉ ุงูุซุงููุฉ ุตุจุงุญ ููู ุงูุงุซููู ุ ุจุฏูุงู ูู ููุณ ุงููุงูุฐุฉ ุงูุชู ุชุณุชุบุฑู ุฎูุณ ุฏูุงุฆู ูู ุงูุฃุณุจูุน ุงูุณุงุจู ุ ูุฅููุง ูุฃุฎุฐ ูุชูุณุท โโูููุฉ ุงููููุงุณ ูู ุงูุณุงุนุฉ ุงูุณุงุฏุณุฉ ุฅูู ุงูุนุงุดุฑุฉ ุตุจุงุญ ููู ุงูุงุซููู ุงูุณุงุจู.</font></font><br>
<br>
<pre><code class="plaintext hljs">- record: job:http_requests:rate5m_prediction<font></font>
&nbsp; expr: &gt;<font></font>
&nbsp; &nbsp; avg_over_time(job:http_requests:rate5m[4h] offset 166h) # Rounded value from last period<font></font>
&nbsp; &nbsp; + job:http_requests:rate5m:avg_over_time_1w&nbsp; &nbsp; # Add 1w growth trend<font></font>
&nbsp; &nbsp; - job:http_requests:rate5m:avg_over_time_1w offset 1w</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃุดุงุฑ ุงูุทูุจ ุฅูู 166 ุณุงุนุฉ ุ ุฃู ุณุงุนุชูู ุฃูู ูู ุฃุณุจูุน ูุงูู (7 * 24 = 168) ุ ูุฃููุง ูุฑูุฏ ุงุณุชุฎุฏุงู ูุชุฑุฉ ุฃุฑุจุน ุณุงุนุงุช ุจูุงุกู ุนูู ุงูููุช ุงูุญุงูู ุ ูุฐูู ูุญุชุงุฌ ุฅูู ุฃู ุชููู ุงูุฅุฒุงุญุฉ ุณุงุนุชูู ุฃูู ูู ุฃุณุจูุน ูุงูู.&nbsp;</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dbe/1a3/417/dbe1a3417069f11203878b0efb3a613c.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RPS ุงูุญูููู (ุงูุฃุตูุฑ) ูุงููุชููุน (ุงูุฃุฒุฑู) ูู ุฃุณุจูุนูู</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ุชูุถุญ ููุงุฑูุฉ RPS ุงููุนููุฉ ูุน ุชููุนุงุชูุง ุฃู ุญุณุงุจุงุชูุง ูุงูุช ุฏูููุฉ ุฅูู ุญุฏ ูุง. ููุน ุฐูู ุ ูุฅู ูุฐู ุงูุทุฑููุฉ ููุง ุนูุจ. </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูู ุณุจูู ุงููุซุงู ุ ูู 1 ูุงูู ุ ุชู ุงุณุชุฎุฏุงู GitLab ุจุดูู ุฃูู ูู ุงููุนุชุงุฏ ุฃูุงู ุงูุฃุฑุจุนุงุก ุ ุญูุซ ูุงู ูุฐุง ุงูููู ููู ุนุทูุฉ. ูุธุฑูุง ูุฃู ุงุชุฌุงู ุงูููู ุงูููุฏุฑ ูุนุชูุฏ ุนูู ููููุฉ ุงุณุชุฎุฏุงู ุงููุธุงู ูู ุงูุฃุณุจูุน ุงูุณุงุจู ุ ูุฅู ุชููุนุงุชูุง ููุฃุณุจูุน ุงูููุจู ุ ุฃู ููู ุงูุฃุฑุจุนุงุก ุ 8 ูุงูู ุ ุฃุนุทุช RPS ุฃูู ูู ุงููุงูุน. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ุชุตุญูุญ ูุฐุง ุงูุฎุทุฃ ูู ุฎูุงู ุนูู ุซูุงุซุฉ ุชูุจุคุงุช ูุซูุงุซุฉ ุฃุณุงุจูุน ูุชุชุงููุฉ ูุจู ุงูุฃุฑุจุนุงุก 1 ูุงูู ุ ุฃู ุงูุฃุฑุจุนุงุก ุงูุซูุงุซุฉ ุงูุณุงุจู. ูุธู ุงูุทูุจ ููุง ูู ุ ูููู ูุชู ุชุนุฏูู ุงูุฅุฒุงุญุฉ.</font></font><br>
<br>
<pre><code class="plaintext hljs">- record: job:http_requests:rate5m_prediction<font></font>
&nbsp; expr: &gt;<font></font>
 &nbsp; quantile(0.5,<font></font>
 &nbsp; &nbsp; label_replace(<font></font>
 &nbsp; &nbsp; &nbsp; avg_over_time(job:http_requests:rate5m[4h] offset 166h)<font></font>
 &nbsp; &nbsp; &nbsp; + job:http_requests:rate5m:avg_over_time_1w โ job:http_requests:rate5m:avg_over_time_1w offset 1w<font></font>
 &nbsp; &nbsp; &nbsp; , "offset", "1w", "", "")<font></font>
 &nbsp; &nbsp; or<font></font>
 &nbsp; &nbsp; label_replace(<font></font>
 &nbsp; &nbsp; &nbsp; avg_over_time(job:http_requests:rate5m[4h] offset 334h)<font></font>
 &nbsp; &nbsp; &nbsp; + job:http_requests:rate5m:avg_over_time_1w โ job:http_requests:rate5m:avg_over_time_1w offset 2w<font></font>
 &nbsp; &nbsp; &nbsp; , "offset", "2w", "", "")<font></font>
 &nbsp; &nbsp; or<font></font>
 &nbsp; &nbsp; label_replace(<font></font>
 &nbsp; &nbsp; &nbsp; avg_over_time(job:http_requests:rate5m[4h] offset 502h)<font></font>
 &nbsp; &nbsp; &nbsp; + job:http_requests:rate5m:avg_over_time_1w โ job:http_requests:rate5m:avg_over_time_1w offset 3w<font></font>
 &nbsp; &nbsp; &nbsp; , "offset", "3w", "", "")<font></font>
 &nbsp; )<font></font>
 &nbsp; without (offset)</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e4a/f28/40d/e4af2840d94eb531b2fc7ddf26f8abce.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุงู ุซูุงุซ ุชููุนุงุช ุนูู ุงูุฑุณู ุงูุจูุงูู ููุฏุฉ ุซูุงุซุฉ ุฃุณุงุจูุน ูุจู 8 ูุงูู ุ ููุงุฑูุฉ ูุน RPS ุงููุนูู ูููู ุงูุฃุฑุจุนุงุก 8 ูุงูู. ููููู ุฃู ุชุฑู ุฃู ุงูุชููุนูู ุฏูููุงู ููุบุงูุฉ ุ ููู ุชููุนุงุช ุงูุฃุณุจูุน ูู 1 ูุงูู ูุง ุชุฒุงู ุบูุฑ ุฏูููุฉ.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุญู ูุง ูุญุชุงุฌ ุฅูู ุซูุงุซ ุชูุจุคุงุช ุ ูุญุชุงุฌ ุฅูู ุชููุน ูุงุญุฏ. ูุชูุณุท โโุงููููุฉ ููุณ ุฎูุงุฑูุง ุ ูุฃูู ุณูุชู ุชุนุชููู ุจูุงุณุทุฉ ุจูุงูุงุช RPS ุงููุดููุฉ ุจุฏุกูุง ูู 1 ูุงูู. ุจุฏูุงู ูู ุฐูู ุ ุชุญุชุงุฌ ุฅูู ุญุณุงุจ ุงููุณูุท. ูุง ูุญุชูู Prometheus ุนูู ุงุณุชุนูุงู ูุชูุณุท โโุ ูููู ูููููุง ุงุณุชุฎุฏุงู ุงูุชุฌููุน ุงูููู ุจุฏูุงู ูู ุงููุณูุท. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงููุดููุฉ ุงููุญูุฏุฉ ูู ุฃููุง ูุญุงูู ุชุถููู ุซูุงุซ ุณูุงุณู ูู ุงูุชุฌููุน ุ ููุฐู ุงูุณูุณูุฉ ุงูุซูุงุซุฉ ูู ูู ุงููุงูุน ููุณ ุงูุณูุณูุฉ ูู ุซูุงุซุฉ ุฃุณุงุจูุน. ูุจุนุจุงุฑุฉ ุฃุฎุฑู ุ ูุฏููู ููุณ ุงูุชุณููุงุช ุ ูุฐูู ูู ุงูุตุนุจ ุชุฌููุนูุง ูุนูุง.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชุฌูุจ ุงูุงูุชุจุงุณ ุ ูููู ุจุฅูุดุงุก ุชุณููุฉ ุชุณูู ุงูุฅุฒุงุญุฉ ููุณุชุฎุฏู ูุธููุฉ ุงุณุชุจุฏุงู ุงูููุตู ูุฅุถุงูุฉ ุฅุฒุงุญุฉ ููู ูู ุงูุฃุณุงุจูุน ุงูุซูุงุซุฉ. </font><font style="vertical-align: inherit;">ุซู ูู ุงูุชุฌููุน ุงูููู ูุชุฌุงูู ูุฐู ุงูุชุตูููุงุช ุ ููุฐุง ูุนุทููุง ูู ุงููุชูุณุท โโุซูุงุซุฉ.</font></font><br>
<br>
<pre><code class="plaintext hljs">- record: job:http_requests:rate5m_prediction<font></font>
&nbsp; expr: &gt;<font></font>
 &nbsp; quantile(0.5,<font></font>
 &nbsp; &nbsp; label_replace(<font></font>
 &nbsp; &nbsp; &nbsp; avg_over_time(job:http_requests:rate5m[4h] offset 166h)<font></font>
 &nbsp; &nbsp; &nbsp; + job:http_requests:rate5m:avg_over_time_1w โ job:http_requests:rate5m:avg_over_time_1w offset 1w<font></font>
 &nbsp; &nbsp; &nbsp; , "offset", "1w", "", "")<font></font>
 &nbsp; &nbsp; or<font></font>
 &nbsp; &nbsp; label_replace(<font></font>
 &nbsp; &nbsp; &nbsp; avg_over_time(job:http_requests:rate5m[4h] offset 334h)<font></font>
 &nbsp; &nbsp; &nbsp; + job:http_requests:rate5m:avg_over_time_1w โ job:http_requests:rate5m:avg_over_time_1w offset 2w<font></font>
 &nbsp; &nbsp; &nbsp; , "offset", "2w", "", "")<font></font>
 &nbsp; &nbsp; or<font></font>
 &nbsp; &nbsp; label_replace(<font></font>
 &nbsp; &nbsp; &nbsp; avg_over_time(job:http_requests:rate5m[4h] offset 502h)<font></font>
 &nbsp; &nbsp; &nbsp; + job:http_requests:rate5m:avg_over_time_1w โ job:http_requests:rate5m:avg_over_time_1w offset 3w<font></font>
 &nbsp; &nbsp; &nbsp; , "offset", "3w", "", "")<font></font>
 &nbsp; )<font></font>
 &nbsp; without (offset)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ุฃุตุจุญุช ุชููุนุงุชูุง ูุน ูุชูุณุท โโุซูุงุซ ูุฌููุนุงุช ุฃูุซุฑ ุฏูุฉ.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/77e/a87/32c/77ea8732cbf6466a4766bc213166a3b3.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชูุณุท โโุงูุชููุนุงุช ููุงุจู RPS ุงููุนูู</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู ุชูุชุดู ุฃู ุชููุนุงุชูุง ุฏูููุฉ ุญููุง</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุชุญูู ูู ุฏูุฉ ุงูุชููุนุงุช ุ ูููููุง ุงูุนูุฏุฉ ุฅูู ุงูุฏุฑุฌุฉ z. </font><font style="vertical-align: inherit;">ูุชู ุงุณุชุฎุฏุงูู ูููุงุณ ุชูุงูุถ ุงูุนููุฉ ูุน ุชููุนุงุชูุง ูู ุงูุงูุญุฑุงูุงุช ุงููุนูุงุฑูุฉ. </font><font style="vertical-align: inherit;">ูููุง ุฒุงุฏ ุงูุงูุญุฑุงู ุงููุนูุงุฑู ุนู ุงูุชููุนุงุช ุ ุฒุงุฏุช ุงุญุชูุงููุฉ ุฃู ุชููู ูููุฉ ูุนููุฉ ุจุนูุฏุฉ.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/076/559/918/0765599182b7b441e31c32847c1de4fa.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุทุงู ุงูุงูุญุฑุงู ุงููุชููุน ูู ูู +1.5 ุฅูู -1.5.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ููููู ุชุบููุฑ ูุฎุทุท Grafana ูุงุณุชุฎุฏุงู ุชููุนุงุช ููุณููุฉ ุ ุจุฏูุงู ูู ุงููุชูุณุท โโุงููุชุญุฑู ุงูุฃุณุจูุนู. </font><font style="vertical-align: inherit;">ูุทุงู ุงูููู ุงูุทุจูุนูุฉ ููุชุฑุฉ ูุนููุฉ ูู ุงูููู ูุธูู ุจุงูููู ุงูุฃุฎุถุฑ. </font><font style="vertical-align: inherit;">ูู ูุง ูุชุฌุงูุฒ ุงูููุทูุฉ ุงูุฎุถุฑุงุก ูุนุชุจุฑ ุดูุฆูุง ุจุนูุฏูุง. </font><font style="vertical-align: inherit;">ูู ูุฐู ุงูุญุงูุฉ ุ ุญุฏุซ ุงูุฎุฑูุฌ ุจุนุฏ ุธูุฑ ููู ุงูุฃุญุฏ ุ ุนูุฏูุง ูุงุฌู ูุฒูุฏ ุงูุฎุฏูุฉ ุงูุณุญุงุจูุฉ ุจุนุถ ูุดููุงุช ุงูุดุจูุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุงูููุงุฑุณุฉ ุงูุณูููุฉ ุงุณุชุฎุฏุงู ยฑ 2 ุฏุฑุฌุฉ z ููุชูุจุคุงุช ุงูููุณููุฉ.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููููุฉ ุฅุนุฏุงุฏ ุงูุชูุจููุงุช ุจุงุณุชุฎุฏุงู ุจุฑูููุซููุณ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฐุง ููุช ุชุฑุบุจ ูู ุฅุนุฏุงุฏ ุชูุจูู ููุฃุญุฏุงุซ ุบูุฑ ุงูุทุจูุนูุฉ ุ ูููููู ุชุทุจูู ูุงุนุฏุฉ ุจุฑูููุซููุณ ุงูุจุณูุทุฉ ุฅูู ุญุฏ ูุง ุ ูุงูุชู ุชุชุญูู ููุง ุฅุฐุง ูุงูุช ุงูุฏุฑุฌุฉ z ููุคุดุฑ ูู ุงููุทุงู ุจูู +2 ู -2.</font></font><br>
<br>
<pre><code class="plaintext hljs">- alert: RequestRateOutsideNormalRange<font></font>
&nbsp; expr: &gt;<font></font>
 &nbsp; abs(<font></font>
 &nbsp; &nbsp; (<font></font>
 &nbsp; &nbsp; &nbsp; job:http_requests:rate5m - job:http_requests:rate5m_prediction<font></font>
 &nbsp; &nbsp; ) / job:http_requests:rate5m:stddev_over_time_1w<font></font>
 &nbsp; ) &gt; 2<font></font>
&nbsp; for: 10m<font></font>
&nbsp; labels:<font></font>
&nbsp; &nbsp; severity: warning<font></font>
&nbsp; annotations:<font></font>
&nbsp; &nbsp; summary: Requests for job {{ $labels.job }} are outside of expected operating parameters</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู GitLab ุ ูุณุชุฎุฏู ูุงุนุฏุฉ ุชูุฌูู ูุฎุตุตุฉ ุชุฑุณู ุชูุจูููุง ุนุจุฑ Slack ุนูุฏูุง ุชูุชุดู ุฃู ุญุงูุงุช ุดุงุฐุฉ ุ ูููููุง ูุง ุชุชุตู ุจูุฑูู ุงูุฏุนู ูุฏููุง.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููููุฉ ุงููุดู ุนู ุงูุดุฐูุฐ ูู GitLab ุจุงุณุชุฎุฏุงู ุจุฑูููุซููุณ</font></font></h2><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุงุณุชุฎุฏุงู ุจุฑูููุซููุณ ูููุดู ุนู ุจุนุถ ุงูุชุดููุงุช.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุฌููุน ุงูุตุญูุญ ูู ุงูููุชุงุญ ูุฅูุฌุงุฏ ุงูุดุฐูุฐ.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุชุณุฌูู Z ูุนุงููุง ุฅุฐุง ูุงูุช ุจูุงูุงุชู ุฐุงุช ุชูุฒูุน ุทุจูุนู.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูููุณููุฉ ุงูุฅุญุตุงุฆูุฉ ูู ุขููุฉ ูููุฉ ูููุดู ุนู ุงูุดุฐูุฐ.</font></font></li>
</ol><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุช ุงูุชุฑุฌูุฉ ุจุฏุนู ูู </font></font></i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mail.ru Cloud Cloud Solutions</font></font></i></a><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font></i><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ุชุฒุงู ูููุฏุฉ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุทุฑู ุงูุชุฎุฒูู ุงููุคูุช ุงูุจุณูุทุฉ ูู GitLab CI: ุฏููู ุตูุฑ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุฏูุงุช GitLab CE ุงูุฌุงูุฒุฉ ูุงููุฎุตุตุฉ ูู ุณูู MCS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .&nbsp;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุงุฉ Telegram ุญูู ุงูุชุญูู ุงูุฑููู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar499014/index.html">23 ุณุคุงููุง ุตุนุจูุง ูููุงุจูุงุช JavaScript</a></li>
<li><a href="../ar499016/index.html">ุงูุชูุงูู ูุน ESIA ูู .Net: ุฃุณูู ููุง ูุจุฏู</a></li>
<li><a href="../ar499018/index.html">6 ุชุทุจููุงุช ุฑูุงุถูุฉ ููุฒููุฉ</a></li>
<li><a href="../ar499020/index.html">ุฏุฑุงุณุฉ ุณููู ุบุงูุถ ูุงุญุฏ</a></li>
<li><a href="../ar499030/index.html">ูุฑุงูุจุฉ ุฃุฏุงุก MySQL ูู Grafana ุนูู isic ูู 20 ุฏูููุฉ</a></li>
<li><a href="../ar499034/index.html">ููููุฉ ุทุฑุญ ุฅุนุงุฏุฉ ููููุฉ ุฎุทูุฑุฉ ูุชุญููุฒ ููููู ูุณุชุฎุฏูุ</a></li>
<li><a href="../ar499036/index.html">ุนูู ุงููููุฑ: ูุฌููุนุฉ ูุฎุชุงุฑุฉ ูู ุงูููุงุฏ ุญูู ุงูุจุฑูุชููููุงุช ูุชูููููุฌูุง ุงููุนูููุงุช ูุงูุจููุฉ ุงูุชุญุชูุฉ ููุดุจูุฉ</a></li>
<li><a href="../ar499038/index.html">ุชุฌุฑุจุชู ุจุงุณุชุฎุฏุงู ุดุงุดุฉ ุนููุฏูุฉ</a></li>
<li><a href="../ar499040/index.html">ุงูุฑุฃ ูู ุนุทูุฉ ููุงูุฉ ุงูุฃุณุจูุน: ูุฌููุนุฉ ูุฎุชุงุฑุฉ ูู ุงูููุงุฏ ุญูู ุชุงุฑูุฎ DNS ูุชูุธูู ุชูููููุฌูุง ุงููุนูููุงุช ูุงูุฃุฌูุฒุฉ 1cloud.ru</a></li>
<li><a href="../ar499044/index.html">ุฃุฎุจุงุฑ ูู ุนุงูู OpenStreetMap ุฑูู 508 (04/07/2020/13/04/2020)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>