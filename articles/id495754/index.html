<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👂🏿 🐄 😭 Sim-sim membuka atau membalikkan rekayasa interkom pintar ☪️ 🤖 👨🏼‍🔬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Setelah membaca posting KrupnikAda ide untuk menangani mitmproxy dan melihat bagaimana backend dari aplikasi mobile yang digunakan sehari-hari diatur....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Sim-sim membuka atau membalikkan rekayasa interkom pintar</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495754/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setelah membaca </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">posting</font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Krupnik</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ada ide untuk menangani mitmproxy dan melihat bagaimana backend dari aplikasi mobile yang digunakan sehari-hari diatur. </font><font style="vertical-align: inherit;">Pilihan jatuh pada aplikasi interkom. </font><font style="vertical-align: inherit;">Setelah otorisasi, ini memungkinkan Anda untuk membuka pintu dan menjawab panggilan video. </font><font style="vertical-align: inherit;">Apa yang terjadi dengan ini dan lubang apa yang berhasil saya temukan akan saya ceritakan di bawah luka.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/cd/rc/hu/cdrchuiued3otgzhrka3gqtgdqa.jpeg"></div><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pengaturan proxy</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menganalisis lalu lintas, pendekatan yang disebut pria di tengah sering digunakan. Terdiri dari fakta bahwa ketika terhubung ke jaringan lokal, lalu lintas dari perangkat yang dianalisis pertama-tama pergi ke komputer yang didekripsi dan dianalisis, dan kemudian dienkripsi kembali dan dikirim ke server. Untuk mendekripsi lalu lintas, yang paling populer adalah program mitmproxy. Menginstal mitmproxy bukan masalah besar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk melihat lalu lintas dari perangkat seluler, Anda harus terhubung ke wifi rumah Anda dari ponsel dan komputer. </font><font style="vertical-align: inherit;">Instal mitmproxy di komputer dan jalankan. </font><font style="vertical-align: inherit;">Pada ponsel dalam pengaturan wifi, atur alamat lokal dan port komputer sebagai server proxy. </font><font style="vertical-align: inherit;">Selanjutnya, buka mitm.it dari ponsel dan instal sertifikat yang memungkinkan Anda mendekripsi permintaan https. </font><font style="vertical-align: inherit;">Setelah langkah-langkah ini, permintaan dari browser menjadi terlihat. </font><font style="vertical-align: inherit;">Hore! </font><font style="vertical-align: inherit;">Namun, langkah selanjutnya adalah kekecewaan:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/js/ot/7e/jsot7e1q5qkrqftcgvxvwy2h1mq.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pencarian </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">google</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menyebabkan masalah terbuka di </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">github</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ternyata, mulai dengan API Level 24, aplikasi tidak lagi mempercayai sertifikat pengguna. </font><font style="vertical-align: inherit;">Untungnya, Anda dapat menyiasatinya dengan membuka ritsleting apk dan menambahkan konfigurasi berikut ke AndroidManifest.xml:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">network-security-config</span>&gt;</span>  
     <span class="hljs-tag">&lt;<span class="hljs-name">debug-overrides</span>&gt;</span>  
          <span class="hljs-tag">&lt;<span class="hljs-name">trust-anchors</span>&gt;</span>  
               <span class="hljs-comment">&lt;!-- Trust preinstalled CAs --&gt;</span>  
               <span class="hljs-tag">&lt;<span class="hljs-name">certificates</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"system"</span> /&gt;</span>  
               <span class="hljs-comment">&lt;!-- Additionally trust user added CAs --&gt;</span>  
               <span class="hljs-tag">&lt;<span class="hljs-name">certificates</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"user"</span> /&gt;</span>  
          <span class="hljs-tag">&lt;/<span class="hljs-name">trust-anchors</span>&gt;</span>  
     <span class="hljs-tag">&lt;/<span class="hljs-name">debug-overrides</span>&gt;</span>  
<span class="hljs-tag">&lt;/<span class="hljs-name">network-security-config</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain itu, ada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">skrip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> siap pakai di github </font><font style="vertical-align: inherit;">yang melakukan ini secara otomatis. </font><font style="vertical-align: inherit;">Jadi, unduh apk, skrip tambalan, atur adb install command dan voila semuanya berfungsi.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analisis lalu lintas</font></font></h2> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami melihat bahwa permintaan dilakukan ke alamat formulir:</font></font><br>
<br>
<pre><code class="bash hljs">https://{intercom-company-url}/api/
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dua parameter dilewatkan di header: </font></font><br>
<pre><code class="python hljs"><span class="hljs-string">'api-version'</span>: <span class="hljs-string">'2'</span>,
<span class="hljs-string">'authorization'</span>:&nbsp; <span class="hljs-string">'Bearer&nbsp;your.jwt.token’
</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parameter pertama adalah versi api, dan yang kedua adalah token otorisasi. </font><font style="vertical-align: inherit;">Untuk otorisasi, token web json digunakan, yang terdiri dari tiga bagian: header, payload, dan tanda tangan. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dekode dengan perintah:</font></font><br>
<br>
<pre><code class="bash hljs">pyjwt decode --no-verify your.jwt.token
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lihat bahwa payload mengandung account_id dan exp. </font><font style="vertical-align: inherit;">Bidang exp sesuai dengan waktu token dibuat, yang memungkinkan Anda untuk menghasilkan token untuk perangkat yang berbeda dari satu akun. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yang paling menarik bagi kami adalah permintaan daftar interkom yang tersedia dan pintu pembuka. </font><font style="vertical-align: inherit;">Saat mengirim permintaan (saya menggunakan python dan perpustakaan permintaan) ke</font></font><br>
<br>
<pre><code class="bash hljs">https://{intercom-company-url}/api/customers/properties/{account_id}/intercoms 
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami mendapatkan json yang berisi daftar doorphones dengan bidang:</font></font><br>
<br>
<pre><code class="json hljs">[<font></font>
    {<font></font>
        'id': ID,<font></font>
        'mode': MODE, <font></font>
        'sip_account': {'ex_user': USER_ID, 'proxy': PROXY,  'password': PSWD}, <font></font>
        'video': [{'quality': 'low', 'source': 'rtsp:<span class="hljs-comment">//LINK }]</span><font></font>
    }<font></font>
]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di json id - doorphone identifier, mode - pintu mana yang dapat dibuka (nilai yang mungkin adalah one_door, left_door, right_door), akun sip dan tautan ke siaran video. Wow! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menggunakan protokol inisiasi sesi (sip), panggilan video dilakukan melalui interkom. Di bidang sip_account kami menerima id'shniki dan kata sandi untuk interkom yang aksesnya dimiliki akun kami. Memanggil mereka sama saja tidak berfungsi, karena mereka ada di jaringan internal. Tapi bidang videonya menarik. Ini berisi tautan eksternal untuk menyiarkan video dari kamera. Sudah cukup untuk membuka vlc, menyalin tautan dan Anda dapat melihat-lihat jam di kamera doorphone. Tidak baik membuang tautan seperti itu! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, kita akan mencari cara untuk membuka pintu. Ketika Anda mengklik tombol buka pintu, aplikasi mengirimkan permintaan get:</font></font><br>
<br>
<pre><code class="bash hljs">https://{intercom-company-url}/api/customers/intercoms/{intercom_id}/unlock?door=left_door&amp;id={intercom_id}
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ternyata ada atau tidaknya parameter id tidak mempengaruhi apa-apa, tetapi pintu memungkinkan dalam kasus doorphone dengan dua pintu untuk membuka tidak hanya Anda sendiri, tetapi juga pintu berikutnya pilihan Anda. </font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sim-sim terbuka!</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah menemukan api, saya memutuskan untuk melakukan sesuatu yang bermanfaat. </font><font style="vertical-align: inherit;">Hasilnya adalah aplikasi Android yang mengenali perintah suara, dan ketika itu mengenali perintah yang sudah ditentukan sebelumnya seperti “sim-sim open,” ia mengirimkan permintaan untuk membuka pintu yang sesuai.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">temuan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Interkom pintar itu baik, tetapi interkom yang aman dan pintar bahkan lebih baik.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id495732/index.html"># 03 - Dan seluruh byte tidak cukup ... | 2B atau tidak 2B</a></li>
<li><a href="../id495740/index.html">Seperti kami selama seminggu tanpa uang, koneksi dan perangkat lunak meluncurkan layanan pengiriman makanan dan hampir tidak gagal</a></li>
<li><a href="../id495746/index.html">Kami membentuk Lihat di SwiftUI, melanjutkan dari kondisi</a></li>
<li><a href="../id495748/index.html">Punto Switcher baru untuk linux: xswitcher</a></li>
<li><a href="../id495752/index.html">Kapan pandemi akan menurun? Mengevaluasi dengan Python dengan Pandas</a></li>
<li><a href="../id495756/index.html">Prinsip-prinsip kunci untuk menggunakan ECS dalam pengembangan game</a></li>
<li><a href="../id495758/index.html">Kebakaran dan Strategi</a></li>
<li><a href="../id495760/index.html">Lebih cerah daripada Bintang: rebranding dan pengisian ulang garis Ultrastar HGST</a></li>
<li><a href="../id495762/index.html">Prosto: hapus boilerplate saat bekerja dengan RecyclerView</a></li>
<li><a href="../id495764/index.html">CSI Linux: distribusi linux untuk investigasi cyber dan OSINT</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>