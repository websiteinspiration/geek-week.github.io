<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚋 🕹️ 🍈 Sous le capot du client bot Yandex.Music 🈺 🍬 👩🏼‍🤝‍👩🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="introduction
 Bonjour, Habr! Encore une fois, je suis avec le deuxième article concernant l'API Yandex.Music. L'affaire est prévue et mentionnée dans ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Sous le capot du client bot Yandex.Music</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487428/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">introduction</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bonjour, Habr! </font><font style="vertical-align: inherit;">Encore une fois, je suis avec le deuxième article concernant l'API Yandex.Music. </font><font style="vertical-align: inherit;">L'affaire est prévue et mentionnée dans le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">premier article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les mains tendues, c'est fait. </font><font style="vertical-align: inherit;">Aujourd'hui, je vais parler de moments intéressants, à mon avis, qui sont présents dans la base de code de mon bot Telegram, qui se positionne comme un client à part entière de la musique. </font><font style="vertical-align: inherit;">Nous toucherons également l'API de reconnaissance musicale Yandex. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant de passer à l'histoire point par point de la mise en œuvre d'une chose particulière, il serait utile d'avoir une idée du bot lui-même et de ses capacités fonctionnelles.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Démo vidéo client</font></font></b><div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/YOw9hs8tFg0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la partie principale, je parlerai des éléments suivants:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connectez-vous à votre compte via le site sur les </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pages GitHub</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (pourquoi et pourquoi).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le format des données, leur emballage et leur utilisation dans les données des boutons.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mettre à jour le routage, le versionnage des données, le lancement de contexte dans les gestionnaires.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prestations de service:</font></font><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Piste de rechargement de service dans Telegram.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le service des "abonnements" pour recevoir une piste avec l'envoi de l'état du téléchargement.</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'implémentation de mise en cache des requêtes la plus simple et la plus élégante.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reconnaissance d'une piste par message vocal et comment elle apparaît généralement dans le bot.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Petites notes.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous êtes intéressé par au moins un point - bienvenue au chat.</font></font><br>
<img src="https://habrastorage.org/webt/uv/4s/a3/uv4sa3pslohuzlmuzrjzteju2dk.png"><a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le bot fonctionne avec les utilisateurs qui se sont connectés à leur compte, mais non. </font><font style="vertical-align: inherit;">Tout tourne autour de quatre classes principales de service: album, artiste, playlist et piste. </font><font style="vertical-align: inherit;">Toutes les données d'entité sont prises en charge, il y a une pagination avec la sélection de page. </font><font style="vertical-align: inherit;">Pour interagir avec eux, un utilisateur autorisé peut utiliser son menu personnel, qui comprend: des listes de lecture intelligentes, la liste de lecture «J'aime» et leurs propres listes de lecture. </font><font style="vertical-align: inherit;">Pour les utilisateurs non autorisés, la recherche est disponible - en envoyant une requête de recherche sous forme de message normal. </font><font style="vertical-align: inherit;">Maintenant, il n'y a qu'une liste sèche de ce qu'il y a d'autre: recevoir des pistes et d'autres objets via un lien direct, recevoir des paroles, la possibilité d'aimer / détester la piste et l'artiste, de visualiser des pistes similaires, de reconnaître la piste par message vocal et plus encore.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partie principale</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Connectez-vous à votre compte</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Initialement, le bot n'était pas prévu de fonctionner sans autorisation.Par conséquent, même pendant la conception, il a été décidé de la manière dont l'autorisation devait se produire - via </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">son site Web</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Les principaux arguments étaient la sécurité et la transparence. En aucun cas, il ne voulait accepter les identifiants et les mots de passe des utilisateurs dans des messages clairs. Et l'autorisation de l'ordinateur de l'utilisateur est élémentaire. Par conséquent, un site a été écrit pour autorisation sur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">React</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il s'agit d'une forme d'autorisation avec redirection vers le bot. Un morceau avec autorisation et traitement de captcha a été extrait de la bibliothèque en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et réécrit en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScript</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour l'autorisation, le jeton OAuth reçu est utilisé, qui est retransféré au bot via </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une liaison profonde</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le lien final pour la redirection ressemble à ceci: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/music_yandex_bot?start={oauth_token}</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Je voulais le meilleur, mais les utilisateurs n'avaient pas confiance. Seul un utilisateur sur dix était autorisé (au moment où il était obligatoire). Par conséquent, avec les mises à jour suivantes, j'ai dû expliquer pourquoi vous devriez faire confiance. Tous les articles sur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTPS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , exclusivement sur les demandes du côté client et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le code open source</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ont été publiés sur le site pour autorisation et dupliqués dans un message de bienvenue dans le bot. Obtenu mieux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En outre, parmi les facteurs de faible autorisation, l'inaccessibilité des miroirs pour t.me en Russie s'est avérée être et prendre en charge uniquement les utilisateurs abonnés (plus à ce sujet dans les notes, paragraphe 7).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le premier élément a été résolu à l'aide de l' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URI</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tg: //</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), et à la rigueur, il existe déjà un lien vers le miroir (si la redirection automatique n'a pas fonctionné et le bouton n'a pas aidé), et le second est à nouveau dans l'élément 7.</font></font><br>
<img src="https://habrastorage.org/webt/ez/2_/0j/ez2_0japfosbu9k4bjelikl8x-i.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Format des données</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ce bot, j'ai décidé pour la première fois d'utiliser </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NoSQL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DB - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MongoDB</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Compris: quand </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">incorporer un</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> document, quand non. J'ai aimé travailler avec mongoengine. Mais je ne voulais vraiment pas stocker toutes les données des boutons à la maison, et le client n'a que l' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID d'</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> enregistrement dans la base de données. J'étais terrifié par la quantité de données, mais je voulais prendre un serveur Mongo gratuit avec une limite de 512 Mo pour le stockage de données. Trouver une belle réutilisation des enregistrements si les données correspondent dans plusieurs boutons et nettoyer les fichiers obsolètes est beaucoup plus difficile que de tout stocker dans les boutons eux-mêmes. Après avoir analysé la taille des données à stocker, j'ai conclu qu'elles s'adaptent facilement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au début, je viens d'utiliser </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais il l'a très vite refusé quand il s'est heurté à une limite. Dans Telegram, le contenu des données de bouton ne peut pas dépasser 64 octets en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UTF-8</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par conséquent, avec l'invite d'un ami, j'ai commencé à regarder </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pack à</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partir du module </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">struct</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ainsi les types de requêtes sont nés, le format primitif, le packaging et le déballage. Maintenant, il est utilisé partout dans le bot. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le format est très simple. Le premier octet est le type, le second est la version. Tout le reste est constitué de données pour un type particulier. Les types sont stockés comme Enum, ont un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui est le premier octet. En plus de l' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , chaque type a un format pour l'emballage et le déballage des données. Par exemple: tapez </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHOW_TRACK_MENU</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dont le format a la valeur "s?", où "s" est l'identifiant unique de la piste et "?" - La piste contient-elle du texte? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pistes utilisées type chaîne parce que: premièrement, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de la piste peut être une concaténation d' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et de l' </font><font style="vertical-align: inherit;">album </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de la piste à </font><font style="vertical-align: inherit;">travers le côlon, et, d' </font><font style="vertical-align: inherit;">autre part , </font><font style="vertical-align: inherit;">il peut être </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'UUID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pistes avec </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UUID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pistes auto-chargées, disponibles uniquement pour l'utilisateur qui les a téléchargées. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Étant donné que les données ne correspondent pas toujours au format, par exemple, le même </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> piste peut être représenté simplement par un numéro, avant de le compresser, il doit être converti en un type pour le format. Dans ce cas, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Par conséquent, dans la classe, il existe une méthode qui normalise les données transférées pour l'empaquetage, afin de ne pas le faire vous-même lors de la transmission au constructeur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les cordes sont autosuffisantes et peuvent indiquer leur longueur lors de l'emballage et en tenir compte lors du déballage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La prise en charge des anciennes versions n'était pas prévue, donc une exception est levée si les versions ne correspondent pas. </font><font style="vertical-align: inherit;">Lors du traitement des mises à jour, dont je parlerai dans le paragraphe suivant, la logique nécessaire est appelée. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme Telegram mange exclusivement </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UTF-8</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , les données compressées sont encodées en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base85</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Oui, je perds de la vitesse ici et j'enregistre la plus petite taille sans utiliser la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base64</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais étant donné les petites données, je pense utiliser la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base85</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> appropriée.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La source. </font><font style="vertical-align: inherit;">Fichier callback_data.py</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> struct
<span class="hljs-keyword">import</span> base64<font></font>
<font></font>
<span class="hljs-keyword">from</span> ext.query_types <span class="hljs-keyword">import</span> QueryType<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BadDataVersion</span>(<span class="hljs-params">Exception</span>):</span>
    <span class="hljs-keyword">pass</span><font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CallbackData</span>:</span>
    ACTUAL_VERSION = <span class="hljs-number">7</span>
    BASE_FORMAT = <span class="hljs-string">'&lt;BB'</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, type_: QueryType, data=None, version=None</span>):</span><font></font>
        self.type = type_<font></font>
        self.version = version <span class="hljs-keyword">or</span> CallbackData.ACTUAL_VERSION<font></font>
        self.data = data<font></font>
<font></font>
        <span class="hljs-keyword">if</span> self.data <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> isinstance(self.data, list):<font></font>
            self.data = [self.data]<font></font>
<font></font>
        <span class="hljs-keyword">if</span> self.data <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            self.data = self._normalize_data_to_format(self.data)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__repr__</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f'&lt;CallbackData&gt; Type: <span class="hljs-subst">{self.type}</span> Version: <span class="hljs-subst">{self.version}</span> Data: <span class="hljs-subst">{self.data}</span>'</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_normalize_data_to_format</span>(<span class="hljs-params">self, data, bytes_object=False</span>):</span><font></font>
        normalized_data = data.copy()<font></font>
        <span class="hljs-keyword">for</span> i, c <span class="hljs-keyword">in</span> enumerate(self.type.format):<font></font>
            cast = str<font></font>
            <span class="hljs-keyword">if</span> c.lower() <span class="hljs-keyword">in</span> <span class="hljs-string">'bhilqn'</span>:<font></font>
                cast = int<font></font>
            <span class="hljs-keyword">elif</span> c <span class="hljs-keyword">in</span> <span class="hljs-string">'efd'</span>:<font></font>
                cast = float<font></font>
            <span class="hljs-keyword">elif</span> c == <span class="hljs-string">'?'</span>:<font></font>
                cast = bool<font></font>
<font></font>
            casted = cast(data[i])<font></font>
            <span class="hljs-keyword">if</span> bytes_object <span class="hljs-keyword">and</span> cast == str:<font></font>
                casted = casted.encode(<span class="hljs-string">'utf-8'</span>)<font></font>
            normalized_data[i] = casted<font></font>
<font></font>
        <span class="hljs-keyword">return</span> normalized_data<font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode_type</span>(<span class="hljs-params">callback_data</span>):</span>
        decoded = base64.b85decode(callback_data.encode(<span class="hljs-string">'utf-8'</span>))<font></font>
        type_, version = struct.unpack(CallbackData.BASE_FORMAT, decoded[:<span class="hljs-number">2</span>])<font></font>
<font></font>
        <span class="hljs-keyword">if</span> CallbackData.ACTUAL_VERSION != version:
            <span class="hljs-keyword">raise</span> BadDataVersion()<font></font>
<font></font>
        <span class="hljs-keyword">return</span> QueryType(type_), version, decoded<font></font>
<font></font>
<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode</span>(<span class="hljs-params">cls, type_, version, decoded</span>):</span>
        start, data = <span class="hljs-number">2</span>, []<font></font>
<font></font>
        <span class="hljs-keyword">if</span> start &lt; len(decoded):<font></font>
            format_iter = iter(type_.format)<font></font>
<font></font>
            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
                <span class="hljs-keyword">if</span> start &gt;= len(decoded):
                    <span class="hljs-keyword">break</span><font></font>
<font></font>
                format_ = next(format_iter, type_.format[<span class="hljs-number">-1</span>])<font></font>
<font></font>
                decode_str = format_ <span class="hljs-keyword">in</span> <span class="hljs-string">'ps'</span>
                <span class="hljs-keyword">if</span> decode_str:
                    <span class="hljs-comment"># struct.calcsize('b') = 1</span>
                    length = list(struct.unpack(<span class="hljs-string">'b'</span>, decoded[start: start + <span class="hljs-number">1</span>]))[<span class="hljs-number">0</span>]<font></font>
                    start += <span class="hljs-number">1</span><font></font>
<font></font>
                    format_ = <span class="hljs-string">f'<span class="hljs-subst">{length}</span><span class="hljs-subst">{format_}</span>'</span><font></font>
<font></font>
                step = struct.calcsize(format_)<font></font>
<font></font>
                unpacked = list(struct.unpack(<span class="hljs-string">f'<span class="hljs-subst">{format_}</span>'</span>, decoded[start: start + step]))
                <span class="hljs-keyword">if</span> decode_str:<font></font>
                    unpacked[<span class="hljs-number">0</span>] = unpacked[<span class="hljs-number">0</span>].decode(<span class="hljs-string">'UTF-8'</span>)<font></font>
<font></font>
                data += unpacked<font></font>
                start += step<font></font>
<font></font>
        <span class="hljs-keyword">return</span> cls(type_, data <span class="hljs-keyword">if</span> data <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>, version)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode</span>(<span class="hljs-params">self</span>):</span><font></font>
        encode = struct.pack(self.BASE_FORMAT, self.type.value, self.version)<font></font>
<font></font>
        <span class="hljs-keyword">if</span> self.data <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            format_iter = iter(self.type.format)<font></font>
            normalized_data = self._normalize_data_to_format(self.data, bytes_object=<span class="hljs-literal">True</span>)<font></font>
<font></font>
            <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> normalized_data:<font></font>
                format_ = next(format_iter, self.type.format[<span class="hljs-number">-1</span>])<font></font>
<font></font>
                <span class="hljs-keyword">if</span> format_ <span class="hljs-keyword">in</span> <span class="hljs-string">'ps'</span>:
                    <span class="hljs-comment">#        .  'b'  </span>
                    <span class="hljs-comment"># -      ,    &gt; 36 </span>
                    encode += struct.pack(<span class="hljs-string">'b'</span>, len(data))<font></font>
                    encode += struct.pack(<span class="hljs-string">f'<span class="hljs-subst">{len(data)}</span><span class="hljs-subst">{format_}</span>'</span>, data)
                <span class="hljs-keyword">else</span>:<font></font>
                    encode += struct.pack(<span class="hljs-string">f'<span class="hljs-subst">{format_}</span>'</span>, data)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> base64.b85encode(encode).decode(<span class="hljs-string">'utf-8'</span>)<font></font>
<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Mises à jour et contexte du routage</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le projet utilise la bibliothèque </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python-telegram-bot</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour fonctionner avec l' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API Telegram Bot</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il possède déjà un système d'enregistrement des gestionnaires pour certains types de mises à jour qui sont arrivés, des filtres pour les expressions régulières, les commandes, etc. </font><font style="vertical-align: inherit;">Mais, étant donné mon propre format de données et mes types, j'ai dû hériter de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TelegramHandler</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et implémenter mon </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gestionnaire</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La mise à jour et le contexte sont transmis à chaque gestionnaire via des arguments. </font><font style="vertical-align: inherit;">Dans ce cas, j'ai mon propre contexte et c'est dans </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Handler'e</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il est en cours de formation, c'est-à-dire: recevoir et / ou ajouter un utilisateur à la base de données, vérifier la pertinence du token pour accéder à la musique, initialiser le client Yandex.Music, en fonction du statut d'autorisation et de la disponibilité d'un abonnement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus loin de mon </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Handler'a, il</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> existe des gestionnaires plus spécifiques, par exemple, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CallbackQueryHandler</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Avec lui, un gestionnaire est enregistré pour un certain type de mise à jour (mon type, avec un format de données). Pour vérifier si cette mise à jour convient au gestionnaire actuel, toutes les données ne sont pas décompressées, mais uniquement les deux premiers octets. À ce stade, la nécessité de lancer un rappel est vérifiée. Ce n'est que si le lancement du rappel est nécessaire - que les données sont complètement décompressées et transférées sous </font><i><font style="vertical-align: inherit;">forme</font></i><font style="vertical-align: inherit;"> de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kwargs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">au gestionnaire final. </font><font style="vertical-align: inherit;">Immédiatement, il y a un envoi de données analytiques à </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ChatBase</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'enregistrement se fait séquentiellement, et la priorité est plus élevée pour qui sera enregistré plus tôt (en fait, comme dans le </font><font style="vertical-align: inherit;">routage </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Django</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et dans d'autres projets). </font><font style="vertical-align: inherit;">Par conséquent, l'enregistrement d'un gestionnaire pour une version obsolète est le premier parmi les gestionnaires </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CallBackQuery</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La logique de traitement de la version obsolète est simple - informez l'utilisateur à ce sujet et envoyez des données mises à jour, si possible.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Services</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tous les services sont initialisés lorsque le bot est lancé dans une classe de contrôle, qui est ensuite universellement utilisée n'importe où dans le bot ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DJ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chaque service a son propre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ThreadPoolExecutor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec un certain nombre de travailleurs dans lesquels les tâches sont soumises.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recharger une piste dans Telegram</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour le moment, ce service n'a pas été réécrit dans </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">User Bot</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour contourner la limite de la taille du fichier téléchargé dans Telegram. Il s'est avéré que Yandex.Music contient des fichiers de plus de 50 Mo - des podcasts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le service vérifie la taille du fichier et, en cas d'excès, lance une alerte à l'utilisateur. Grâce au système de mise en cache décrit au paragraphe 5, cela vérifie la disponibilité et la réception des paroles. Les pistes sont également mises en cache. Le hachage du fichier est stocké dans la base de données. S'il y en a un, l'audio avec un cache connu est envoyé. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En l'absence de fichier dans la base de données, un lien direct est reçu de Yandex.Music. Bien que pour le moment, les utilisateurs n'ont pas la possibilité de modifier les paramètres de qualité, mais tous sont définis sur des valeurs standard. Le fichier est recherché par bitrate et codec à partir des paramètres utilisateur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le fichier et sa couverture sont téléchargés en tant que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tempfile.TemporaryFile ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , après quoi ils sont téléchargés sur Telegram. </font><font style="vertical-align: inherit;">Il est à noter que TG ne reconnaît pas toujours correctement la durée du morceau, mais je me tais généralement sur l'artiste et le titre. </font><font style="vertical-align: inherit;">Par conséquent, ces données sont extraites de Yandex, heureusement, il est possible de les transmettre au panier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsqu'un fichier audio est envoyé par ce service, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">finish_callback ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est appelé </font><font style="vertical-align: inherit;">, signalant le service par abonnement à la fin du téléchargement.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Service d'abonnement pour recevoir des pistes et envoyer l'état du téléchargement</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les pistes ne sont pas chargées instantanément. Il est possible que plusieurs utilisateurs aient demandé la même piste. Dans ce cas, l'utilisateur qui a demandé la piste en premier est l'initiateur et le propriétaire de la piste. Lors du rechargement de plus d'une seconde, l'état de téléchargement démarre: «L'utilisateur envoie un message vocal». Les autres utilisateurs qui ont demandé la même piste sont des abonnés réguliers. Ils, comme le propriétaire, reçoivent l'état de téléchargement une fois toutes les ~ 4 secondes afin que le message ne s'interrompt pas (l'état se bloque pendant 5 secondes). Dès que le téléchargement de la piste pour le propriétaire est terminé, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">done_callback ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est appelé à </font><font style="vertical-align: inherit;">partir du service ci-dessus. Après cela, tous les abonnés sont supprimés de la liste d'état et reçoivent la piste téléchargée.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la solution architecturale, le propriétaire de la piste est également abonné, mais avec une certaine marque, car les modalités d'envoi de la piste sont différentes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Mise en cache des requêtes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme nous nous souvenons de mon dernier article, les demandes à l'API Yandex.Music sont très lourdes. La liste des pistes peut être de 3 ou 5 Mo. De plus, il y a juste beaucoup de demandes. A chaque traitement de mise à jour, au moins 2 requêtes sont envoyées à Yandex: pour initialiser le client et pour une action spécifique. Dans certains endroits, pour collecter suffisamment d'informations (par exemple, pour une liste de lecture), vous devez faire une demande de liste de lecture, pour recevoir ses pistes, pour obtenir des informations de la page de destination (s'il s'agit d'une liste de lecture intelligente), et n'oubliez pas l'initialisation du client. En général, horreur tranquille en termes de nombre de demandes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je voulais quelque chose de très universel et de ne pas faire de stockage pour certains objets, les mêmes clients. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Étant donné que la bibliothèque vous permet de spécifier votre propre instance pour l'exécution des requêtes, en plus des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">demandes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, alors j'en ai profité. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le point est simple. La classe de cache elle-même est un singleton. Il n'a que deux paramètres: durée de vie du cache, taille. Lorsque la demande est exécutée, l'encapsuleur est appelé. Il est outrepassé. La vérification du cache se produit par le hachage d'arguments et de quarts gelés. Le cache a le temps d'ajouter. Lors de la vérification de la nécessité de mettre à jour les données, soit les données de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LimitedSizeDict sont obtenues,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> soit une demande réelle est effectuée et ajoutée au cache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Certaines demandes ne peuvent pas être mises en cache, par exemple, en définissant un J'aime / Je n'aime pas. Si l'utilisateur appuie sur la séquence suivante: j'aime, je n'aime pas, j'aime, alors finalement, il ne sera pas livré. Dans de tels cas, lors de l'envoi d'une demande, vous devez passer l'argument </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">use_cache</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec une valeur égale à </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">False</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En fait, c'est le seul endroit où le cache n'est pas utilisé. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Grâce à cela, je fais les demandes les plus audacieuses pour qu'elles soient mises en cache. </font><font style="vertical-align: inherit;">Je n'essaye pas de le diviser en petits et je n'ai besoin que de la page actuelle. </font><font style="vertical-align: inherit;">Je prends tout en même temps, et lorsque je passe d'une page à l'autre, j'ai une vitesse de commutation énorme (par rapport à l'ancienne approche). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quant à moi, la classe de demande en cache s'est avérée magnifiquement et a été simplement intégrée.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La source</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> copy
<span class="hljs-keyword">import</span> time<font></font>
<font></font>
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Union
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> OrderedDict<font></font>
<font></font>
<span class="hljs-keyword">import</span> requests<font></font>
<font></font>
<span class="hljs-keyword">from</span> yandex_music.utils.request <span class="hljs-keyword">import</span> Request <span class="hljs-keyword">as</span> YandexMusicRequest<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LimitedSizeDict</span>(<span class="hljs-params">OrderedDict</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span>
        self.size_limit = kwargs.pop(<span class="hljs-string">"size_limit"</span>, <span class="hljs-literal">None</span>)<font></font>
        OrderedDict.__init__(self, *args, **kwargs)<font></font>
        self._check_size_limit()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__setitem__</span>(<span class="hljs-params">self, key, value</span>):</span><font></font>
        OrderedDict.__setitem__(self, key, value)<font></font>
        self._check_size_limit()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_check_size_limit</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">if</span> self.size_limit <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">while</span> len(self) &gt; self.size_limit:<font></font>
                self.popitem(last=<span class="hljs-literal">False</span>)<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CachedItem</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, response: requests.Response</span>):</span><font></font>
        self.timestamp = time.time()<font></font>
        self.response = response<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cache</span>:</span>
    __singleton: <span class="hljs-string">'Cache'</span> = <span class="hljs-literal">None</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, lifetime: Union[str, int], size: Union[str, int]</span>):</span><font></font>
        Cache.__singleton = self<font></font>
<font></font>
        self.lifetime = int(lifetime) * <span class="hljs-number">60</span><font></font>
        self.size = int(size)<font></font>
<font></font>
        self.storage: LimitedSizeDict = LimitedSizeDict(size_limit=int(size))<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span><font></font>
        hash_ = Cache.get_hash(*args, **kwargs)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> self.storage[hash_].response<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, response: requests.Response, *args, **kwargs</span>):</span><font></font>
        hash_ = Cache.get_hash(*args, **kwargs)<font></font>
        self.storage.update({hash_: CachedItem(response)})<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">need_to_fetch</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span><font></font>
        hash_ = Cache.get_hash(*args, **kwargs)<font></font>
        cached_item = self.storage.get(hash_)<font></font>
<font></font>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> cached_item:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> time.time() - cached_item.timestamp &gt; self.lifetime:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><font></font>
<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><font></font>
<font></font>
<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_instance</span>(<span class="hljs-params">cls</span>) -&gt; 'Cache':</span>
        <span class="hljs-keyword">if</span> cls.__singleton <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> cls.__singleton
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">f'<span class="hljs-subst">{cls.__name__}</span> not initialized'</span>)<font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">freeze_dict</span>(<span class="hljs-params">d: dict</span>) -&gt; Union[frozenset, tuple, dict]:</span>
        <span class="hljs-keyword">if</span> isinstance(d, dict):
            <span class="hljs-keyword">return</span> frozenset((key, Cache.freeze_dict(value)) <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> d.items())
        <span class="hljs-keyword">elif</span> isinstance(d, list):
            <span class="hljs-keyword">return</span> tuple(Cache.freeze_dict(value) <span class="hljs-keyword">for</span> value <span class="hljs-keyword">in</span> d)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> d<font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_hash</span>(<span class="hljs-params">*args, **kwargs</span>):</span>
        <span class="hljs-keyword">return</span> hash((args, Cache.freeze_dict(kwargs)))<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Request</span>(<span class="hljs-params">YandexMusicRequest</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_request_wrapper</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span>
        use_cache = kwargs.get(<span class="hljs-string">'use_cache'</span>, <span class="hljs-literal">True</span>)<font></font>
<font></font>
        <span class="hljs-keyword">if</span> <span class="hljs-string">'use_cache'</span> <span class="hljs-keyword">in</span> kwargs:<font></font>
            kwargs.pop(<span class="hljs-string">'use_cache'</span>)<font></font>
<font></font>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> use_cache:<font></font>
            response = super()._request_wrapper(*args, **copy.deepcopy(kwargs))<font></font>
        <span class="hljs-keyword">elif</span> use_cache <span class="hljs-keyword">and</span> Cache.get_instance().need_to_fetch(*args, **kwargs):<font></font>
            response = super()._request_wrapper(*args, **copy.deepcopy(kwargs))<font></font>
            Cache.get_instance().update(response, *args, **kwargs)<font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            response = Cache.get_instance().get(*args, **kwargs)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> response<font></font>
<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Suivi de la reconnaissance par message vocal</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au début, il n'était pas question d'ajouter cela au bot, mais une situation intéressante s'est produite. Le bot a un chat (cela est indiqué dans la description du bot). Après un certain temps, j'ai remarqué que les gens y vont et envoient des messages vocaux avec de la musique. Au début, je pensais que c'était un nouveau type de spam tel que quelqu'un avait mis en bouteille et plaisantait. Mais, lorsque de telles personnes avaient déjà moins de 10 ans et que tout le monde faisait la même chose, mon ami (le même qui a suggéré la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">structure</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) a suggéré que les utilisateurs conduisent Yandex.Music dans la recherche, en attendant que le bot officiel reconnaisse la musique de Yandex, ils y voient une salle de chat et y envoient des messages vocaux avec sérieux! C'était juste une hypothèse brillante et vraie. Puis j'ai plaisanté en disant qu'il était temps de faire la reconnaissance et d'ajouter un bot au chat. Pour le plaisir ... Après un moment, cela a été fait!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant sur l' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Récemment, Yandex a de plus en plus utilisé des sockets Web. J'ai rencontré leur utilisation dans la gestion d'un i.module et d'un i.station. Le service de reconnaissance musicale y travaille également. J'ai lancé la solution de travail minimale dans mon bot, mais je n'ai pas ajouté l'implémentation à la bibliothèque. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est situé à l'adresse suivante: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wss: //voiceservices.yandex.net/uni.ws</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nous n'avons besoin que de deux messages - autorisation et demande de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reconnaissance</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yandex lui-même, dans son application officielle, envoie des fichiers courts en une seconde ou trois. En réponse, vous pouvez avoir besoin d'envoyer plus de données ou le résultat - trouvé ou non. Si le résultat est trouvé, l'ID de piste sera retourné. </font><i><font style="vertical-align: inherit;">Les</font></i><font style="vertical-align: inherit;"> fichiers </font><i><font style="vertical-align: inherit;">.gg</font></i><font style="vertical-align: inherit;"> sont </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
envoyés </font><font style="vertical-align: inherit;">avec</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ENCODER = SpeechKit Mobile SDK v3.28.0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Je n'ai pas vérifié comment cela fonctionne avec les autres encodeurs, je le change juste dans le fichier enregistré par Telegram. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors d'une marche arrière avec une prise Web, la magie se produisait parfois. </font><font style="vertical-align: inherit;">Parfois, je ne pouvais pas trouver la piste, mais quand j'ai changé la langue dans le message avec la demande de reconnaissance, je l'ai fait. </font><font style="vertical-align: inherit;">Ou au début, il a trouvé, puis il s'est arrêté, bien que le fichier soit le même. </font><font style="vertical-align: inherit;">Je pensais que la langue de la piste était définie par leur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SpeechKit</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur le client. </font><font style="vertical-align: inherit;">N'ayant pas une telle opportunité de le faire moi-même, je fais une recherche par force brute.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mon implémentation à genoux de la reconnaissance vocale par messages vocaux de Telegram</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> uuid<font></font>
<font></font>
<span class="hljs-keyword">import</span> lomond<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_auth_data</span>():</span>
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"event"</span>: {
            <span class="hljs-string">"header"</span>: {
                <span class="hljs-string">"messageId"</span>: str(uuid.uuid4()),
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"SynchronizeState"</span>,
                <span class="hljs-string">"namespace"</span>: <span class="hljs-string">"System"</span><font></font>
            },<font></font>
            <span class="hljs-string">"payload"</span>: {
                <span class="hljs-string">"accept_invalid_auth"</span>: <span class="hljs-literal">True</span>,
                <span class="hljs-string">"auth_token"</span>: <span class="hljs-string">"5983ba91-339e-443c-8452-390fe7d9d308"</span>,
                <span class="hljs-string">"uuid"</span>: str(uuid.uuid4()).replace(<span class="hljs-string">'-'</span>, <span class="hljs-string">''</span>),<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_asr_data</span>():</span>
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"event"</span>: {
            <span class="hljs-string">"header"</span>: {
                <span class="hljs-string">"messageId"</span>: str(uuid.uuid4()),
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"Recognize"</span>,
                <span class="hljs-string">"namespace"</span>: <span class="hljs-string">"ASR"</span>,
                <span class="hljs-string">"streamId"</span>: <span class="hljs-number">1</span><font></font>
            },<font></font>
            <span class="hljs-string">"payload"</span>: {
                <span class="hljs-string">"advancedASROptions"</span>: {
                    <span class="hljs-string">"manual_punctuation"</span>: <span class="hljs-literal">False</span>,
                    <span class="hljs-string">"partial_results"</span>: <span class="hljs-literal">False</span><font></font>
                },<font></font>
                <span class="hljs-string">"disableAntimatNormalizer"</span>: <span class="hljs-literal">False</span>,
                <span class="hljs-string">"format"</span>: <span class="hljs-string">"audio/opus"</span>,
                <span class="hljs-string">"music_request2"</span>: {
                    <span class="hljs-string">"headers"</span>: {
                        <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"audio/opus"</span><font></font>
                    }<font></font>
                },<font></font>
                <span class="hljs-string">"punctuation"</span>: <span class="hljs-literal">False</span>,
                <span class="hljs-string">"tags"</span>: <span class="hljs-string">"PASS_AUDIO;"</span>,
                <span class="hljs-string">"topic"</span>: <span class="hljs-string">"queries"</span><font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Recognition</span>:</span>
    URI = <span class="hljs-string">'wss://voiceservices.yandex.net/uni.ws'</span>
    LANGS = [<span class="hljs-string">''</span>, <span class="hljs-string">'ru-RU'</span>, <span class="hljs-string">'en-US'</span>]<font></font>
    POLL_DELAY = <span class="hljs-number">0.3</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, binary_data, status_msg</span>):</span><font></font>
        self.status_msg = status_msg<font></font>
        self.websocket = lomond.WebSocket(self.URI)<font></font>
        self.chunks = self.get_chunks_and_replace_encoder(binary_data)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_track_id</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">for</span> lang <span class="hljs-keyword">in</span> Recognition.LANGS:<font></font>
            asr_data = get_asr_data()<font></font>
            <span class="hljs-keyword">if</span> lang:<font></font>
                asr_data[<span class="hljs-string">'event'</span>][<span class="hljs-string">'payload'</span>].update({<span class="hljs-string">'lang'</span>: lang})<font></font>
                self.status_msg.edit_text(<span class="hljs-string">f'     <span class="hljs-subst">{lang}</span>...'</span>)
            <span class="hljs-keyword">else</span>:<font></font>
                self.status_msg.edit_text(<span class="hljs-string">f'      ...'</span>)<font></font>
<font></font>
            <span class="hljs-keyword">for</span> msg <span class="hljs-keyword">in</span> self.websocket.connect(poll=self.POLL_DELAY):
                <span class="hljs-keyword">if</span> msg.name == <span class="hljs-string">'ready'</span>:<font></font>
                    self.websocket.send_json(get_auth_data())<font></font>
                    self.websocket.send_json(asr_data)<font></font>
<font></font>
                    <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> self.chunks:<font></font>
                        self.websocket.send_binary(chunk)<font></font>
<font></font>
                <span class="hljs-keyword">if</span> msg.name == <span class="hljs-string">'text'</span>:<font></font>
                    response = msg.json.get(<span class="hljs-string">'directive'</span>)<font></font>
<font></font>
                    <span class="hljs-keyword">if</span> self.is_valid_response(response):<font></font>
                        self.websocket.close()<font></font>
<font></font>
                        <span class="hljs-keyword">return</span> self.parse_track_id(response)
                    <span class="hljs-keyword">elif</span> self.is_fatal_error(response):<font></font>
                        self.websocket.close()<font></font>
<font></font>
                        <span class="hljs-keyword">break</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_valid_response</span>(<span class="hljs-params">self, response</span>):</span>
        <span class="hljs-keyword">if</span> response.get(<span class="hljs-string">'header'</span>, {}).get(<span class="hljs-string">'name'</span>) == <span class="hljs-string">'MusicResult'</span> <span class="hljs-keyword">and</span> \<font></font>
                response.get(<span class="hljs-string">'payload'</span>, {}).get(<span class="hljs-string">'result'</span>) == <span class="hljs-string">'success'</span>:<font></font>
            self.status_msg.edit_text(<span class="hljs-string">f' ,  !'</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_fatal_error</span>(<span class="hljs-params">response</span>):</span>
        <span class="hljs-keyword">if</span> response.get(<span class="hljs-string">'header'</span>, {}).get(<span class="hljs-string">'name'</span>) == <span class="hljs-string">'MusicResult'</span> <span class="hljs-keyword">and</span> \<font></font>
                response.get(<span class="hljs-string">'payload'</span>, {}).get(<span class="hljs-string">'result'</span>) == <span class="hljs-string">'music'</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_track_id</span>(<span class="hljs-params">response</span>):</span>
        <span class="hljs-keyword">return</span> response[<span class="hljs-string">'payload'</span>][<span class="hljs-string">'data'</span>][<span class="hljs-string">'match'</span>][<span class="hljs-string">'id'</span>]<font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_chunks_and_replace_encoder</span>(<span class="hljs-params">binary_data</span>):</span><font></font>
        chunks = []<font></font>
<font></font>
        <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> binary_data.split(<span class="hljs-string">b'OggS'</span>)[<span class="hljs-number">1</span>:]:
            <span class="hljs-keyword">if</span> <span class="hljs-string">b'OpusTags'</span> <span class="hljs-keyword">in</span> chunk:<font></font>
                pos = chunk.index(<span class="hljs-string">b'OpusTags'</span>) + <span class="hljs-number">12</span><font></font>
                size = len(chunk)<font></font>
                chunk = chunk[:pos] + <span class="hljs-string">b'#\x00\x00\x00\x00ENCODER=SpeechKit Mobile SDK v3.28.0'</span>
                chunk += <span class="hljs-string">b"\x00"</span> * (size - len(chunk))<font></font>
<font></font>
            chunks.append(<span class="hljs-string">b'\x00\x00\x00\x01OggS'</span> + chunk)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> chunks<font></font>
<font></font>
</code></pre><br>
     ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"> </a>.<br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. Petites notes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Initialement, seuls les utilisateurs abonnés pouvaient utiliser le bot car le service peut être utilisé dans un nombre limité de pays (sans abonnement), et le serveur avec le bot est situé en Europe. Le problème est résolu en utilisant un proxy pour exécuter les demandes des utilisateurs sans abonnement. Le serveur proxy est situé à Moscou. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a un choix de pages, mais il est limité à 100 (plus aucun bouton ne peut être ajouté, restriction de télégramme). Certaines demandes de page courantes ont beaucoup plus de pages.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la recherche Yandex, le nombre d'éléments sur la page est codé en dur. Combien de pistes, combien de listes de lecture. Parfois, cela ne correspond même pas à la quantité de données affichées sur le devant. Il y a un changement de page, le nombre d'éléments est flottant. Par conséquent, dans le bot, il saute également, ce qui n'est pas très beau. Et pour combiner leur paginateur avec le sien - quelque chose comme ça. Dans d'autres endroits où il est possible de demander un certain nombre d'éléments par page, tout est parfait. Le message vocal après avoir implémenté la recherche dans le bot est </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/MarshalC/416</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors du transfert audio dans Telegram, l'auteur est perdu et affecté à celui qui a fait le transfert. Par conséquent, toutes les pistes sont envoyées avec la signature du nom d'utilisateur du bot. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Message vocal avec tout ce que j'ai rencontré après la mise en place de la radio dans la bibliothèque - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/MarshalC/422</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(à propos de la chaîne de pistes, en passant par l'envoi d'un tas de commentaires, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">batch_id</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malgré le fait qu'il s'agisse d'un autre article sur le bot Telegram, vous l'avez lu jusqu'ici, probablement parce que vous étiez intéressé par l'un des points de la coupe et c'est merveilleux, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">merci beaucoup</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malheureusement, je n'ai pas entièrement ouvert le code source du bot (car dans certains endroits j'ai besoin de refactoriser). </font><font style="vertical-align: inherit;">Beaucoup a été décrit dans cet article, mais certains aspects, par exemple, avec les claviers virtuels et leur génération ne sont pas affectés. </font><font style="vertical-align: inherit;">Pour l'essentiel, ce qui n'est pas dans l'article fonctionne simplement avec ma bibliothèque, rien d'intéressant.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les classes autour desquelles tout tourne, je les ai montrées sous la forme dans laquelle elles se trouvent maintenant. J'avoue qu'il y a des bugs, mais tout fonctionne depuis longtemps. À certains endroits, j'aime mon code, à certains endroits, je n'aime pas - et c'est normal. N'oubliez pas que travailler avec WS pour la reconnaissance est une solution sur le genou. Prêt à lire des critiques motivées dans les commentaires. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien que le bot ait été planifié même lorsque j'ai commencé à écrire la bibliothèque, j'ai renié cette idée, mais, apparemment, je suis revenu (c'était ennuyeux). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yandex.Music Bot - un projet qui prouve l'utilité d'utiliser la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bibliothèque pour travailler avec l'API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans les projets.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un grand merci à maman, Yana, Sana'a, Glory. </font><font style="vertical-align: inherit;">Quelqu'un pour les erreurs de relecture, certains pour les conseils, sans lesquels certains points de cet article pourraient ne pas avoir existé, et pour certains simplement pour évaluer l'article avant la publication. </font><font style="vertical-align: inherit;">Arthur pour picci pour l'article, Lyod pour le logo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Maintenant, j'ai un problème aigu avec la distribution après étude. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous êtes prêt à me téléphoner - dites-moi où envoyer le CV, interviewez-moi, s'il vous plaît. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tous mes contacts sont dans le profil. </font><font style="vertical-align: inherit;">Le temps presse, j'espère pour vous. </font><font style="vertical-align: inherit;">En vertu de la loi, je ne peux m'entraîner qu'en République du Bélarus. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PPS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C'était le deuxième article de trois, mais sans la moindre idée, j'aurai le temps de faire un autre projet sur ce sujet et si c'est nécessaire. </font><font style="vertical-align: inherit;">Je vais dévoiler publiquement son sujet - le client multiplateforme Yandex.Music.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr487418/index.html">Qu'est-ce que SAP?</a></li>
<li><a href="../fr487420/index.html">Sound War Z. Test des haut-parleurs et des écouteurs MusicDealer</a></li>
<li><a href="../fr487422/index.html">Responsabilités de l'administrateur Salesforce: que faire et quand</a></li>
<li><a href="../fr487424/index.html">Comment passer de 1 à 100 000 utilisateurs</a></li>
<li><a href="../fr487426/index.html">La flexibilité conditionne le succès.</a></li>
<li><a href="../fr487430/index.html">Quelles compétences sont nécessaires pour créer une application iOS? Rapport Yandex</a></li>
<li><a href="../fr487432/index.html">Sur les traces de DevConf et CfgMgmtCamp ou de ce que vous pouvez apprendre en allant au conférencier lors de 2 conférences internationales en 2 semaines</a></li>
<li><a href="../fr487438/index.html">Comment créer une entreprise informatique à partir de zéro - sans expérience dans ce domaine et sans compétences en programmation?</a></li>
<li><a href="../fr487444/index.html">«Tout en buvant du café, facturé et reçu une poussée pour le paiement» - des innovations qui vous permettent de faire des affaires 24/7</a></li>
<li><a href="../fr487446/index.html">Une entreprise peut-elle «posséder» la couleur?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>