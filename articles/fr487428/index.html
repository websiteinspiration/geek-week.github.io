<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöã üïπÔ∏è üçà Sous le capot du client bot Yandex.Music üà∫ üç¨ üë©üèº‚Äçü§ù‚Äçüë©üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="introduction
 Bonjour, Habr! Encore une fois, je suis avec le deuxi√®me article concernant l'API Yandex.Music. L'affaire est pr√©vue et mentionn√©e dans ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Sous le capot du client bot Yandex.Music</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487428/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">introduction</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bonjour, Habr! </font><font style="vertical-align: inherit;">Encore une fois, je suis avec le deuxi√®me article concernant l'API Yandex.Music. </font><font style="vertical-align: inherit;">L'affaire est pr√©vue et mentionn√©e dans le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">premier article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les mains tendues, c'est fait. </font><font style="vertical-align: inherit;">Aujourd'hui, je vais parler de moments int√©ressants, √† mon avis, qui sont pr√©sents dans la base de code de mon bot Telegram, qui se positionne comme un client √† part enti√®re de la musique. </font><font style="vertical-align: inherit;">Nous toucherons √©galement l'API de reconnaissance musicale Yandex. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant de passer √† l'histoire point par point de la mise en ≈ìuvre d'une chose particuli√®re, il serait utile d'avoir une id√©e du bot lui-m√™me et de ses capacit√©s fonctionnelles.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©mo vid√©o client</font></font></b><div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/YOw9hs8tFg0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la partie principale, je parlerai des √©l√©ments suivants:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connectez-vous √† votre compte via le site sur les </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pages GitHub</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (pourquoi et pourquoi).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le format des donn√©es, leur emballage et leur utilisation dans les donn√©es des boutons.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mettre √† jour le routage, le versionnage des donn√©es, le lancement de contexte dans les gestionnaires.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prestations de service:</font></font><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Piste de rechargement de service dans Telegram.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le service des "abonnements" pour recevoir une piste avec l'envoi de l'√©tat du t√©l√©chargement.</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'impl√©mentation de mise en cache des requ√™tes la plus simple et la plus √©l√©gante.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reconnaissance d'une piste par message vocal et comment elle appara√Æt g√©n√©ralement dans le bot.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Petites notes.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous √™tes int√©ress√© par au moins un point - bienvenue au chat.</font></font><br>
<img src="https://habrastorage.org/webt/uv/4s/a3/uv4sa3pslohuzlmuzrjzteju2dk.png"><a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le bot fonctionne avec les utilisateurs qui se sont connect√©s √† leur compte, mais non. </font><font style="vertical-align: inherit;">Tout tourne autour de quatre classes principales de service: album, artiste, playlist et piste. </font><font style="vertical-align: inherit;">Toutes les donn√©es d'entit√© sont prises en charge, il y a une pagination avec la s√©lection de page. </font><font style="vertical-align: inherit;">Pour interagir avec eux, un utilisateur autoris√© peut utiliser son menu personnel, qui comprend: des listes de lecture intelligentes, la liste de lecture ¬´J'aime¬ª et leurs propres listes de lecture. </font><font style="vertical-align: inherit;">Pour les utilisateurs non autoris√©s, la recherche est disponible - en envoyant une requ√™te de recherche sous forme de message normal. </font><font style="vertical-align: inherit;">Maintenant, il n'y a qu'une liste s√®che de ce qu'il y a d'autre: recevoir des pistes et d'autres objets via un lien direct, recevoir des paroles, la possibilit√© d'aimer / d√©tester la piste et l'artiste, de visualiser des pistes similaires, de reconna√Ætre la piste par message vocal et plus encore.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partie principale</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Connectez-vous √† votre compte</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Initialement, le bot n'√©tait pas pr√©vu de fonctionner sans autorisation.Par cons√©quent, m√™me pendant la conception, il a √©t√© d√©cid√© de la mani√®re dont l'autorisation devait se produire - via </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">son site Web</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Les principaux arguments √©taient la s√©curit√© et la transparence. En aucun cas, il ne voulait accepter les identifiants et les mots de passe des utilisateurs dans des messages clairs. Et l'autorisation de l'ordinateur de l'utilisateur est √©l√©mentaire. Par cons√©quent, un site a √©t√© √©crit pour autorisation sur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">React</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il s'agit d'une forme d'autorisation avec redirection vers le bot. Un morceau avec autorisation et traitement de captcha a √©t√© extrait de la biblioth√®que en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et r√©√©crit en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScript</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour l'autorisation, le jeton OAuth re√ßu est utilis√©, qui est retransf√©r√© au bot via </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une liaison profonde</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le lien final pour la redirection ressemble √† ceci: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/music_yandex_bot?start={oauth_token}</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Je voulais le meilleur, mais les utilisateurs n'avaient pas confiance. Seul un utilisateur sur dix √©tait autoris√© (au moment o√π il √©tait obligatoire). Par cons√©quent, avec les mises √† jour suivantes, j'ai d√ª expliquer pourquoi vous devriez faire confiance. Tous les articles sur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTPS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , exclusivement sur les demandes du c√¥t√© client et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le code open source</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ont √©t√© publi√©s sur le site pour autorisation et dupliqu√©s dans un message de bienvenue dans le bot. Obtenu mieux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En outre, parmi les facteurs de faible autorisation, l'inaccessibilit√© des miroirs pour t.me en Russie s'est av√©r√©e √™tre et prendre en charge uniquement les utilisateurs abonn√©s (plus √† ce sujet dans les notes, paragraphe 7).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le premier √©l√©ment a √©t√© r√©solu √† l'aide de l' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URI</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tg: //</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), et √† la rigueur, il existe d√©j√† un lien vers le miroir (si la redirection automatique n'a pas fonctionn√© et le bouton n'a pas aid√©), et le second est √† nouveau dans l'√©l√©ment 7.</font></font><br>
<img src="https://habrastorage.org/webt/ez/2_/0j/ez2_0japfosbu9k4bjelikl8x-i.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Format des donn√©es</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ce bot, j'ai d√©cid√© pour la premi√®re fois d'utiliser </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NoSQL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DB - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MongoDB</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Compris: quand </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">incorporer un</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> document, quand non. J'ai aim√© travailler avec mongoengine. Mais je ne voulais vraiment pas stocker toutes les donn√©es des boutons √† la maison, et le client n'a que l' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID d'</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> enregistrement dans la base de donn√©es. J'√©tais terrifi√© par la quantit√© de donn√©es, mais je voulais prendre un serveur Mongo gratuit avec une limite de 512 Mo pour le stockage de donn√©es. Trouver une belle r√©utilisation des enregistrements si les donn√©es correspondent dans plusieurs boutons et nettoyer les fichiers obsol√®tes est beaucoup plus difficile que de tout stocker dans les boutons eux-m√™mes. Apr√®s avoir analys√© la taille des donn√©es √† stocker, j'ai conclu qu'elles s'adaptent facilement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au d√©but, je viens d'utiliser </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais il l'a tr√®s vite refus√© quand il s'est heurt√© √† une limite. Dans Telegram, le contenu des donn√©es de bouton ne peut pas d√©passer 64 octets en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UTF-8</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, avec l'invite d'un ami, j'ai commenc√© √† regarder </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pack √†</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partir du module </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">struct</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ainsi les types de requ√™tes sont n√©s, le format primitif, le packaging et le d√©ballage. Maintenant, il est utilis√© partout dans le bot. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le format est tr√®s simple. Le premier octet est le type, le second est la version. Tout le reste est constitu√© de donn√©es pour un type particulier. Les types sont stock√©s comme Enum, ont un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui est le premier octet. En plus de l' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , chaque type a un format pour l'emballage et le d√©ballage des donn√©es. Par exemple: tapez </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHOW_TRACK_MENU</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dont le format a la valeur "s?", o√π "s" est l'identifiant unique de la piste et "?" - La piste contient-elle du texte? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pistes utilis√©es type cha√Æne parce que: premi√®rement, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de la piste peut √™tre une concat√©nation d' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et de l' </font><font style="vertical-align: inherit;">album </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de la piste √† </font><font style="vertical-align: inherit;">travers le c√¥lon, et, d' </font><font style="vertical-align: inherit;">autre part , </font><font style="vertical-align: inherit;">il peut √™tre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'UUID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pistes avec </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UUID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pistes auto-charg√©es, disponibles uniquement pour l'utilisateur qui les a t√©l√©charg√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtant donn√© que les donn√©es ne correspondent pas toujours au format, par exemple, le m√™me </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> piste peut √™tre repr√©sent√© simplement par un num√©ro, avant de le compresser, il doit √™tre converti en un type pour le format. Dans ce cas, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Par cons√©quent, dans la classe, il existe une m√©thode qui normalise les donn√©es transf√©r√©es pour l'empaquetage, afin de ne pas le faire vous-m√™me lors de la transmission au constructeur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les cordes sont autosuffisantes et peuvent indiquer leur longueur lors de l'emballage et en tenir compte lors du d√©ballage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La prise en charge des anciennes versions n'√©tait pas pr√©vue, donc une exception est lev√©e si les versions ne correspondent pas. </font><font style="vertical-align: inherit;">Lors du traitement des mises √† jour, dont je parlerai dans le paragraphe suivant, la logique n√©cessaire est appel√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme Telegram mange exclusivement </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UTF-8</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , les donn√©es compress√©es sont encod√©es en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base85</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Oui, je perds de la vitesse ici et j'enregistre la plus petite taille sans utiliser la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base64</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais √©tant donn√© les petites donn√©es, je pense utiliser la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base85</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> appropri√©e.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La source. </font><font style="vertical-align: inherit;">Fichier callback_data.py</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> struct
<span class="hljs-keyword">import</span> base64<font></font>
<font></font>
<span class="hljs-keyword">from</span> ext.query_types <span class="hljs-keyword">import</span> QueryType<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BadDataVersion</span>(<span class="hljs-params">Exception</span>):</span>
    <span class="hljs-keyword">pass</span><font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CallbackData</span>:</span>
    ACTUAL_VERSION = <span class="hljs-number">7</span>
    BASE_FORMAT = <span class="hljs-string">'&lt;BB'</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, type_: QueryType, data=None, version=None</span>):</span><font></font>
        self.type = type_<font></font>
        self.version = version <span class="hljs-keyword">or</span> CallbackData.ACTUAL_VERSION<font></font>
        self.data = data<font></font>
<font></font>
        <span class="hljs-keyword">if</span> self.data <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> isinstance(self.data, list):<font></font>
            self.data = [self.data]<font></font>
<font></font>
        <span class="hljs-keyword">if</span> self.data <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            self.data = self._normalize_data_to_format(self.data)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__repr__</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f'&lt;CallbackData&gt; Type: <span class="hljs-subst">{self.type}</span> Version: <span class="hljs-subst">{self.version}</span> Data: <span class="hljs-subst">{self.data}</span>'</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_normalize_data_to_format</span>(<span class="hljs-params">self, data, bytes_object=False</span>):</span><font></font>
        normalized_data = data.copy()<font></font>
        <span class="hljs-keyword">for</span> i, c <span class="hljs-keyword">in</span> enumerate(self.type.format):<font></font>
            cast = str<font></font>
            <span class="hljs-keyword">if</span> c.lower() <span class="hljs-keyword">in</span> <span class="hljs-string">'bhilqn'</span>:<font></font>
                cast = int<font></font>
            <span class="hljs-keyword">elif</span> c <span class="hljs-keyword">in</span> <span class="hljs-string">'efd'</span>:<font></font>
                cast = float<font></font>
            <span class="hljs-keyword">elif</span> c == <span class="hljs-string">'?'</span>:<font></font>
                cast = bool<font></font>
<font></font>
            casted = cast(data[i])<font></font>
            <span class="hljs-keyword">if</span> bytes_object <span class="hljs-keyword">and</span> cast == str:<font></font>
                casted = casted.encode(<span class="hljs-string">'utf-8'</span>)<font></font>
            normalized_data[i] = casted<font></font>
<font></font>
        <span class="hljs-keyword">return</span> normalized_data<font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode_type</span>(<span class="hljs-params">callback_data</span>):</span>
        decoded = base64.b85decode(callback_data.encode(<span class="hljs-string">'utf-8'</span>))<font></font>
        type_, version = struct.unpack(CallbackData.BASE_FORMAT, decoded[:<span class="hljs-number">2</span>])<font></font>
<font></font>
        <span class="hljs-keyword">if</span> CallbackData.ACTUAL_VERSION != version:
            <span class="hljs-keyword">raise</span> BadDataVersion()<font></font>
<font></font>
        <span class="hljs-keyword">return</span> QueryType(type_), version, decoded<font></font>
<font></font>
<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode</span>(<span class="hljs-params">cls, type_, version, decoded</span>):</span>
        start, data = <span class="hljs-number">2</span>, []<font></font>
<font></font>
        <span class="hljs-keyword">if</span> start &lt; len(decoded):<font></font>
            format_iter = iter(type_.format)<font></font>
<font></font>
            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
                <span class="hljs-keyword">if</span> start &gt;= len(decoded):
                    <span class="hljs-keyword">break</span><font></font>
<font></font>
                format_ = next(format_iter, type_.format[<span class="hljs-number">-1</span>])<font></font>
<font></font>
                decode_str = format_ <span class="hljs-keyword">in</span> <span class="hljs-string">'ps'</span>
                <span class="hljs-keyword">if</span> decode_str:
                    <span class="hljs-comment"># struct.calcsize('b') = 1</span>
                    length = list(struct.unpack(<span class="hljs-string">'b'</span>, decoded[start: start + <span class="hljs-number">1</span>]))[<span class="hljs-number">0</span>]<font></font>
                    start += <span class="hljs-number">1</span><font></font>
<font></font>
                    format_ = <span class="hljs-string">f'<span class="hljs-subst">{length}</span><span class="hljs-subst">{format_}</span>'</span><font></font>
<font></font>
                step = struct.calcsize(format_)<font></font>
<font></font>
                unpacked = list(struct.unpack(<span class="hljs-string">f'<span class="hljs-subst">{format_}</span>'</span>, decoded[start: start + step]))
                <span class="hljs-keyword">if</span> decode_str:<font></font>
                    unpacked[<span class="hljs-number">0</span>] = unpacked[<span class="hljs-number">0</span>].decode(<span class="hljs-string">'UTF-8'</span>)<font></font>
<font></font>
                data += unpacked<font></font>
                start += step<font></font>
<font></font>
        <span class="hljs-keyword">return</span> cls(type_, data <span class="hljs-keyword">if</span> data <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>, version)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode</span>(<span class="hljs-params">self</span>):</span><font></font>
        encode = struct.pack(self.BASE_FORMAT, self.type.value, self.version)<font></font>
<font></font>
        <span class="hljs-keyword">if</span> self.data <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            format_iter = iter(self.type.format)<font></font>
            normalized_data = self._normalize_data_to_format(self.data, bytes_object=<span class="hljs-literal">True</span>)<font></font>
<font></font>
            <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> normalized_data:<font></font>
                format_ = next(format_iter, self.type.format[<span class="hljs-number">-1</span>])<font></font>
<font></font>
                <span class="hljs-keyword">if</span> format_ <span class="hljs-keyword">in</span> <span class="hljs-string">'ps'</span>:
                    <span class="hljs-comment">#        .  'b'  </span>
                    <span class="hljs-comment"># -      ,    &gt; 36 </span>
                    encode += struct.pack(<span class="hljs-string">'b'</span>, len(data))<font></font>
                    encode += struct.pack(<span class="hljs-string">f'<span class="hljs-subst">{len(data)}</span><span class="hljs-subst">{format_}</span>'</span>, data)
                <span class="hljs-keyword">else</span>:<font></font>
                    encode += struct.pack(<span class="hljs-string">f'<span class="hljs-subst">{format_}</span>'</span>, data)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> base64.b85encode(encode).decode(<span class="hljs-string">'utf-8'</span>)<font></font>
<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Mises √† jour et contexte du routage</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le projet utilise la biblioth√®que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python-telegram-bot</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour fonctionner avec l' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API Telegram Bot</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il poss√®de d√©j√† un syst√®me d'enregistrement des gestionnaires pour certains types de mises √† jour qui sont arriv√©s, des filtres pour les expressions r√©guli√®res, les commandes, etc. </font><font style="vertical-align: inherit;">Mais, √©tant donn√© mon propre format de donn√©es et mes types, j'ai d√ª h√©riter de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TelegramHandler</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et impl√©menter mon </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gestionnaire</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La mise √† jour et le contexte sont transmis √† chaque gestionnaire via des arguments. </font><font style="vertical-align: inherit;">Dans ce cas, j'ai mon propre contexte et c'est dans </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Handler'e</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il est en cours de formation, c'est-√†-dire: recevoir et / ou ajouter un utilisateur √† la base de donn√©es, v√©rifier la pertinence du token pour acc√©der √† la musique, initialiser le client Yandex.Music, en fonction du statut d'autorisation et de la disponibilit√© d'un abonnement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus loin de mon </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Handler'a, il</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> existe des gestionnaires plus sp√©cifiques, par exemple, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CallbackQueryHandler</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Avec lui, un gestionnaire est enregistr√© pour un certain type de mise √† jour (mon type, avec un format de donn√©es). Pour v√©rifier si cette mise √† jour convient au gestionnaire actuel, toutes les donn√©es ne sont pas d√©compress√©es, mais uniquement les deux premiers octets. √Ä ce stade, la n√©cessit√© de lancer un rappel est v√©rifi√©e. Ce n'est que si le lancement du rappel est n√©cessaire - que les donn√©es sont compl√®tement d√©compress√©es et transf√©r√©es sous </font><i><font style="vertical-align: inherit;">forme</font></i><font style="vertical-align: inherit;"> de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kwargs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">au gestionnaire final. </font><font style="vertical-align: inherit;">Imm√©diatement, il y a un envoi de donn√©es analytiques √† </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ChatBase</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'enregistrement se fait s√©quentiellement, et la priorit√© est plus √©lev√©e pour qui sera enregistr√© plus t√¥t (en fait, comme dans le </font><font style="vertical-align: inherit;">routage </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Django</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et dans d'autres projets). </font><font style="vertical-align: inherit;">Par cons√©quent, l'enregistrement d'un gestionnaire pour une version obsol√®te est le premier parmi les gestionnaires </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CallBackQuery</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La logique de traitement de la version obsol√®te est simple - informez l'utilisateur √† ce sujet et envoyez des donn√©es mises √† jour, si possible.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Services</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tous les services sont initialis√©s lorsque le bot est lanc√© dans une classe de contr√¥le, qui est ensuite universellement utilis√©e n'importe o√π dans le bot ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DJ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chaque service a son propre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ThreadPoolExecutor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec un certain nombre de travailleurs dans lesquels les t√¢ches sont soumises.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recharger une piste dans Telegram</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour le moment, ce service n'a pas √©t√© r√©√©crit dans </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">User Bot</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour contourner la limite de la taille du fichier t√©l√©charg√© dans Telegram. Il s'est av√©r√© que Yandex.Music contient des fichiers de plus de 50 Mo - des podcasts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le service v√©rifie la taille du fichier et, en cas d'exc√®s, lance une alerte √† l'utilisateur. Gr√¢ce au syst√®me de mise en cache d√©crit au paragraphe 5, cela v√©rifie la disponibilit√© et la r√©ception des paroles. Les pistes sont √©galement mises en cache. Le hachage du fichier est stock√© dans la base de donn√©es. S'il y en a un, l'audio avec un cache connu est envoy√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En l'absence de fichier dans la base de donn√©es, un lien direct est re√ßu de Yandex.Music. Bien que pour le moment, les utilisateurs n'ont pas la possibilit√© de modifier les param√®tres de qualit√©, mais tous sont d√©finis sur des valeurs standard. Le fichier est recherch√© par bitrate et codec √† partir des param√®tres utilisateur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le fichier et sa couverture sont t√©l√©charg√©s en tant que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tempfile.TemporaryFile ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , apr√®s quoi ils sont t√©l√©charg√©s sur Telegram. </font><font style="vertical-align: inherit;">Il est √† noter que TG ne reconna√Æt pas toujours correctement la dur√©e du morceau, mais je me tais g√©n√©ralement sur l'artiste et le titre. </font><font style="vertical-align: inherit;">Par cons√©quent, ces donn√©es sont extraites de Yandex, heureusement, il est possible de les transmettre au panier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsqu'un fichier audio est envoy√© par ce service, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">finish_callback ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est appel√© </font><font style="vertical-align: inherit;">, signalant le service par abonnement √† la fin du t√©l√©chargement.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Service d'abonnement pour recevoir des pistes et envoyer l'√©tat du t√©l√©chargement</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les pistes ne sont pas charg√©es instantan√©ment. Il est possible que plusieurs utilisateurs aient demand√© la m√™me piste. Dans ce cas, l'utilisateur qui a demand√© la piste en premier est l'initiateur et le propri√©taire de la piste. Lors du rechargement de plus d'une seconde, l'√©tat de t√©l√©chargement d√©marre: ¬´L'utilisateur envoie un message vocal¬ª. Les autres utilisateurs qui ont demand√© la m√™me piste sont des abonn√©s r√©guliers. Ils, comme le propri√©taire, re√ßoivent l'√©tat de t√©l√©chargement une fois toutes les ~ 4 secondes afin que le message ne s'interrompt pas (l'√©tat se bloque pendant 5 secondes). D√®s que le t√©l√©chargement de la piste pour le propri√©taire est termin√©, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">done_callback ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est appel√© √† </font><font style="vertical-align: inherit;">partir du service ci-dessus. Apr√®s cela, tous les abonn√©s sont supprim√©s de la liste d'√©tat et re√ßoivent la piste t√©l√©charg√©e.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la solution architecturale, le propri√©taire de la piste est √©galement abonn√©, mais avec une certaine marque, car les modalit√©s d'envoi de la piste sont diff√©rentes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Mise en cache des requ√™tes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme nous nous souvenons de mon dernier article, les demandes √† l'API Yandex.Music sont tr√®s lourdes. La liste des pistes peut √™tre de 3 ou 5 Mo. De plus, il y a juste beaucoup de demandes. A chaque traitement de mise √† jour, au moins 2 requ√™tes sont envoy√©es √† Yandex: pour initialiser le client et pour une action sp√©cifique. Dans certains endroits, pour collecter suffisamment d'informations (par exemple, pour une liste de lecture), vous devez faire une demande de liste de lecture, pour recevoir ses pistes, pour obtenir des informations de la page de destination (s'il s'agit d'une liste de lecture intelligente), et n'oubliez pas l'initialisation du client. En g√©n√©ral, horreur tranquille en termes de nombre de demandes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je voulais quelque chose de tr√®s universel et de ne pas faire de stockage pour certains objets, les m√™mes clients. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtant donn√© que la biblioth√®que vous permet de sp√©cifier votre propre instance pour l'ex√©cution des requ√™tes, en plus des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">demandes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, alors j'en ai profit√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le point est simple. La classe de cache elle-m√™me est un singleton. Il n'a que deux param√®tres: dur√©e de vie du cache, taille. Lorsque la demande est ex√©cut√©e, l'encapsuleur est appel√©. Il est outrepass√©. La v√©rification du cache se produit par le hachage d'arguments et de quarts gel√©s. Le cache a le temps d'ajouter. Lors de la v√©rification de la n√©cessit√© de mettre √† jour les donn√©es, soit les donn√©es de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LimitedSizeDict sont obtenues,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> soit une demande r√©elle est effectu√©e et ajout√©e au cache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Certaines demandes ne peuvent pas √™tre mises en cache, par exemple, en d√©finissant un J'aime / Je n'aime pas. Si l'utilisateur appuie sur la s√©quence suivante: j'aime, je n'aime pas, j'aime, alors finalement, il ne sera pas livr√©. Dans de tels cas, lors de l'envoi d'une demande, vous devez passer l'argument </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">use_cache</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec une valeur √©gale √† </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">False</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En fait, c'est le seul endroit o√π le cache n'est pas utilis√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gr√¢ce √† cela, je fais les demandes les plus audacieuses pour qu'elles soient mises en cache. </font><font style="vertical-align: inherit;">Je n'essaye pas de le diviser en petits et je n'ai besoin que de la page actuelle. </font><font style="vertical-align: inherit;">Je prends tout en m√™me temps, et lorsque je passe d'une page √† l'autre, j'ai une vitesse de commutation √©norme (par rapport √† l'ancienne approche). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quant √† moi, la classe de demande en cache s'est av√©r√©e magnifiquement et a √©t√© simplement int√©gr√©e.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La source</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> copy
<span class="hljs-keyword">import</span> time<font></font>
<font></font>
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Union
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> OrderedDict<font></font>
<font></font>
<span class="hljs-keyword">import</span> requests<font></font>
<font></font>
<span class="hljs-keyword">from</span> yandex_music.utils.request <span class="hljs-keyword">import</span> Request <span class="hljs-keyword">as</span> YandexMusicRequest<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LimitedSizeDict</span>(<span class="hljs-params">OrderedDict</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span>
        self.size_limit = kwargs.pop(<span class="hljs-string">"size_limit"</span>, <span class="hljs-literal">None</span>)<font></font>
        OrderedDict.__init__(self, *args, **kwargs)<font></font>
        self._check_size_limit()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__setitem__</span>(<span class="hljs-params">self, key, value</span>):</span><font></font>
        OrderedDict.__setitem__(self, key, value)<font></font>
        self._check_size_limit()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_check_size_limit</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">if</span> self.size_limit <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">while</span> len(self) &gt; self.size_limit:<font></font>
                self.popitem(last=<span class="hljs-literal">False</span>)<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CachedItem</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, response: requests.Response</span>):</span><font></font>
        self.timestamp = time.time()<font></font>
        self.response = response<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cache</span>:</span>
    __singleton: <span class="hljs-string">'Cache'</span> = <span class="hljs-literal">None</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, lifetime: Union[str, int], size: Union[str, int]</span>):</span><font></font>
        Cache.__singleton = self<font></font>
<font></font>
        self.lifetime = int(lifetime) * <span class="hljs-number">60</span><font></font>
        self.size = int(size)<font></font>
<font></font>
        self.storage: LimitedSizeDict = LimitedSizeDict(size_limit=int(size))<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span><font></font>
        hash_ = Cache.get_hash(*args, **kwargs)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> self.storage[hash_].response<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, response: requests.Response, *args, **kwargs</span>):</span><font></font>
        hash_ = Cache.get_hash(*args, **kwargs)<font></font>
        self.storage.update({hash_: CachedItem(response)})<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">need_to_fetch</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span><font></font>
        hash_ = Cache.get_hash(*args, **kwargs)<font></font>
        cached_item = self.storage.get(hash_)<font></font>
<font></font>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> cached_item:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> time.time() - cached_item.timestamp &gt; self.lifetime:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><font></font>
<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><font></font>
<font></font>
<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_instance</span>(<span class="hljs-params">cls</span>) -&gt; 'Cache':</span>
        <span class="hljs-keyword">if</span> cls.__singleton <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> cls.__singleton
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">f'<span class="hljs-subst">{cls.__name__}</span> not initialized'</span>)<font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">freeze_dict</span>(<span class="hljs-params">d: dict</span>) -&gt; Union[frozenset, tuple, dict]:</span>
        <span class="hljs-keyword">if</span> isinstance(d, dict):
            <span class="hljs-keyword">return</span> frozenset((key, Cache.freeze_dict(value)) <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> d.items())
        <span class="hljs-keyword">elif</span> isinstance(d, list):
            <span class="hljs-keyword">return</span> tuple(Cache.freeze_dict(value) <span class="hljs-keyword">for</span> value <span class="hljs-keyword">in</span> d)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> d<font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_hash</span>(<span class="hljs-params">*args, **kwargs</span>):</span>
        <span class="hljs-keyword">return</span> hash((args, Cache.freeze_dict(kwargs)))<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Request</span>(<span class="hljs-params">YandexMusicRequest</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_request_wrapper</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span>
        use_cache = kwargs.get(<span class="hljs-string">'use_cache'</span>, <span class="hljs-literal">True</span>)<font></font>
<font></font>
        <span class="hljs-keyword">if</span> <span class="hljs-string">'use_cache'</span> <span class="hljs-keyword">in</span> kwargs:<font></font>
            kwargs.pop(<span class="hljs-string">'use_cache'</span>)<font></font>
<font></font>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> use_cache:<font></font>
            response = super()._request_wrapper(*args, **copy.deepcopy(kwargs))<font></font>
        <span class="hljs-keyword">elif</span> use_cache <span class="hljs-keyword">and</span> Cache.get_instance().need_to_fetch(*args, **kwargs):<font></font>
            response = super()._request_wrapper(*args, **copy.deepcopy(kwargs))<font></font>
            Cache.get_instance().update(response, *args, **kwargs)<font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            response = Cache.get_instance().get(*args, **kwargs)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> response<font></font>
<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Suivi de la reconnaissance par message vocal</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au d√©but, il n'√©tait pas question d'ajouter cela au bot, mais une situation int√©ressante s'est produite. Le bot a un chat (cela est indiqu√© dans la description du bot). Apr√®s un certain temps, j'ai remarqu√© que les gens y vont et envoient des messages vocaux avec de la musique. Au d√©but, je pensais que c'√©tait un nouveau type de spam tel que quelqu'un avait mis en bouteille et plaisantait. Mais, lorsque de telles personnes avaient d√©j√† moins de 10 ans et que tout le monde faisait la m√™me chose, mon ami (le m√™me qui a sugg√©r√© la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">structure</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) a sugg√©r√© que les utilisateurs conduisent Yandex.Music dans la recherche, en attendant que le bot officiel reconnaisse la musique de Yandex, ils y voient une salle de chat et y envoient des messages vocaux avec s√©rieux! C'√©tait juste une hypoth√®se brillante et vraie. Puis j'ai plaisant√© en disant qu'il √©tait temps de faire la reconnaissance et d'ajouter un bot au chat. Pour le plaisir ... Apr√®s un moment, cela a √©t√© fait!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant sur l' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . R√©cemment, Yandex a de plus en plus utilis√© des sockets Web. J'ai rencontr√© leur utilisation dans la gestion d'un i.module et d'un i.station. Le service de reconnaissance musicale y travaille √©galement. J'ai lanc√© la solution de travail minimale dans mon bot, mais je n'ai pas ajout√© l'impl√©mentation √† la biblioth√®que. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est situ√© √† l'adresse suivante: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wss: //voiceservices.yandex.net/uni.ws</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nous n'avons besoin que de deux messages - autorisation et demande de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reconnaissance</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yandex lui-m√™me, dans son application officielle, envoie des fichiers courts en une seconde ou trois. En r√©ponse, vous pouvez avoir besoin d'envoyer plus de donn√©es ou le r√©sultat - trouv√© ou non. Si le r√©sultat est trouv√©, l'ID de piste sera retourn√©. </font><i><font style="vertical-align: inherit;">Les</font></i><font style="vertical-align: inherit;"> fichiers </font><i><font style="vertical-align: inherit;">.gg</font></i><font style="vertical-align: inherit;"> sont </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
envoy√©s </font><font style="vertical-align: inherit;">avec</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ENCODER = SpeechKit Mobile SDK v3.28.0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Je n'ai pas v√©rifi√© comment cela fonctionne avec les autres encodeurs, je le change juste dans le fichier enregistr√© par Telegram. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors d'une marche arri√®re avec une prise Web, la magie se produisait parfois. </font><font style="vertical-align: inherit;">Parfois, je ne pouvais pas trouver la piste, mais quand j'ai chang√© la langue dans le message avec la demande de reconnaissance, je l'ai fait. </font><font style="vertical-align: inherit;">Ou au d√©but, il a trouv√©, puis il s'est arr√™t√©, bien que le fichier soit le m√™me. </font><font style="vertical-align: inherit;">Je pensais que la langue de la piste √©tait d√©finie par leur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SpeechKit</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur le client. </font><font style="vertical-align: inherit;">N'ayant pas une telle opportunit√© de le faire moi-m√™me, je fais une recherche par force brute.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mon impl√©mentation √† genoux de la reconnaissance vocale par messages vocaux de Telegram</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> uuid<font></font>
<font></font>
<span class="hljs-keyword">import</span> lomond<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_auth_data</span>():</span>
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"event"</span>: {
            <span class="hljs-string">"header"</span>: {
                <span class="hljs-string">"messageId"</span>: str(uuid.uuid4()),
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"SynchronizeState"</span>,
                <span class="hljs-string">"namespace"</span>: <span class="hljs-string">"System"</span><font></font>
            },<font></font>
            <span class="hljs-string">"payload"</span>: {
                <span class="hljs-string">"accept_invalid_auth"</span>: <span class="hljs-literal">True</span>,
                <span class="hljs-string">"auth_token"</span>: <span class="hljs-string">"5983ba91-339e-443c-8452-390fe7d9d308"</span>,
                <span class="hljs-string">"uuid"</span>: str(uuid.uuid4()).replace(<span class="hljs-string">'-'</span>, <span class="hljs-string">''</span>),<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_asr_data</span>():</span>
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"event"</span>: {
            <span class="hljs-string">"header"</span>: {
                <span class="hljs-string">"messageId"</span>: str(uuid.uuid4()),
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"Recognize"</span>,
                <span class="hljs-string">"namespace"</span>: <span class="hljs-string">"ASR"</span>,
                <span class="hljs-string">"streamId"</span>: <span class="hljs-number">1</span><font></font>
            },<font></font>
            <span class="hljs-string">"payload"</span>: {
                <span class="hljs-string">"advancedASROptions"</span>: {
                    <span class="hljs-string">"manual_punctuation"</span>: <span class="hljs-literal">False</span>,
                    <span class="hljs-string">"partial_results"</span>: <span class="hljs-literal">False</span><font></font>
                },<font></font>
                <span class="hljs-string">"disableAntimatNormalizer"</span>: <span class="hljs-literal">False</span>,
                <span class="hljs-string">"format"</span>: <span class="hljs-string">"audio/opus"</span>,
                <span class="hljs-string">"music_request2"</span>: {
                    <span class="hljs-string">"headers"</span>: {
                        <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"audio/opus"</span><font></font>
                    }<font></font>
                },<font></font>
                <span class="hljs-string">"punctuation"</span>: <span class="hljs-literal">False</span>,
                <span class="hljs-string">"tags"</span>: <span class="hljs-string">"PASS_AUDIO;"</span>,
                <span class="hljs-string">"topic"</span>: <span class="hljs-string">"queries"</span><font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Recognition</span>:</span>
    URI = <span class="hljs-string">'wss://voiceservices.yandex.net/uni.ws'</span>
    LANGS = [<span class="hljs-string">''</span>, <span class="hljs-string">'ru-RU'</span>, <span class="hljs-string">'en-US'</span>]<font></font>
    POLL_DELAY = <span class="hljs-number">0.3</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, binary_data, status_msg</span>):</span><font></font>
        self.status_msg = status_msg<font></font>
        self.websocket = lomond.WebSocket(self.URI)<font></font>
        self.chunks = self.get_chunks_and_replace_encoder(binary_data)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_track_id</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">for</span> lang <span class="hljs-keyword">in</span> Recognition.LANGS:<font></font>
            asr_data = get_asr_data()<font></font>
            <span class="hljs-keyword">if</span> lang:<font></font>
                asr_data[<span class="hljs-string">'event'</span>][<span class="hljs-string">'payload'</span>].update({<span class="hljs-string">'lang'</span>: lang})<font></font>
                self.status_msg.edit_text(<span class="hljs-string">f'     <span class="hljs-subst">{lang}</span>...'</span>)
            <span class="hljs-keyword">else</span>:<font></font>
                self.status_msg.edit_text(<span class="hljs-string">f'      ...'</span>)<font></font>
<font></font>
            <span class="hljs-keyword">for</span> msg <span class="hljs-keyword">in</span> self.websocket.connect(poll=self.POLL_DELAY):
                <span class="hljs-keyword">if</span> msg.name == <span class="hljs-string">'ready'</span>:<font></font>
                    self.websocket.send_json(get_auth_data())<font></font>
                    self.websocket.send_json(asr_data)<font></font>
<font></font>
                    <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> self.chunks:<font></font>
                        self.websocket.send_binary(chunk)<font></font>
<font></font>
                <span class="hljs-keyword">if</span> msg.name == <span class="hljs-string">'text'</span>:<font></font>
                    response = msg.json.get(<span class="hljs-string">'directive'</span>)<font></font>
<font></font>
                    <span class="hljs-keyword">if</span> self.is_valid_response(response):<font></font>
                        self.websocket.close()<font></font>
<font></font>
                        <span class="hljs-keyword">return</span> self.parse_track_id(response)
                    <span class="hljs-keyword">elif</span> self.is_fatal_error(response):<font></font>
                        self.websocket.close()<font></font>
<font></font>
                        <span class="hljs-keyword">break</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_valid_response</span>(<span class="hljs-params">self, response</span>):</span>
        <span class="hljs-keyword">if</span> response.get(<span class="hljs-string">'header'</span>, {}).get(<span class="hljs-string">'name'</span>) == <span class="hljs-string">'MusicResult'</span> <span class="hljs-keyword">and</span> \<font></font>
                response.get(<span class="hljs-string">'payload'</span>, {}).get(<span class="hljs-string">'result'</span>) == <span class="hljs-string">'success'</span>:<font></font>
            self.status_msg.edit_text(<span class="hljs-string">f' ,  !'</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_fatal_error</span>(<span class="hljs-params">response</span>):</span>
        <span class="hljs-keyword">if</span> response.get(<span class="hljs-string">'header'</span>, {}).get(<span class="hljs-string">'name'</span>) == <span class="hljs-string">'MusicResult'</span> <span class="hljs-keyword">and</span> \<font></font>
                response.get(<span class="hljs-string">'payload'</span>, {}).get(<span class="hljs-string">'result'</span>) == <span class="hljs-string">'music'</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_track_id</span>(<span class="hljs-params">response</span>):</span>
        <span class="hljs-keyword">return</span> response[<span class="hljs-string">'payload'</span>][<span class="hljs-string">'data'</span>][<span class="hljs-string">'match'</span>][<span class="hljs-string">'id'</span>]<font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_chunks_and_replace_encoder</span>(<span class="hljs-params">binary_data</span>):</span><font></font>
        chunks = []<font></font>
<font></font>
        <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> binary_data.split(<span class="hljs-string">b'OggS'</span>)[<span class="hljs-number">1</span>:]:
            <span class="hljs-keyword">if</span> <span class="hljs-string">b'OpusTags'</span> <span class="hljs-keyword">in</span> chunk:<font></font>
                pos = chunk.index(<span class="hljs-string">b'OpusTags'</span>) + <span class="hljs-number">12</span><font></font>
                size = len(chunk)<font></font>
                chunk = chunk[:pos] + <span class="hljs-string">b'#\x00\x00\x00\x00ENCODER=SpeechKit Mobile SDK v3.28.0'</span>
                chunk += <span class="hljs-string">b"\x00"</span> * (size - len(chunk))<font></font>
<font></font>
            chunks.append(<span class="hljs-string">b'\x00\x00\x00\x01OggS'</span> + chunk)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> chunks<font></font>
<font></font>
</code></pre><br>
     ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"> </a>.<br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. Petites notes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Initialement, seuls les utilisateurs abonn√©s pouvaient utiliser le bot car le service peut √™tre utilis√© dans un nombre limit√© de pays (sans abonnement), et le serveur avec le bot est situ√© en Europe. Le probl√®me est r√©solu en utilisant un proxy pour ex√©cuter les demandes des utilisateurs sans abonnement. Le serveur proxy est situ√© √† Moscou. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a un choix de pages, mais il est limit√© √† 100 (plus aucun bouton ne peut √™tre ajout√©, restriction de t√©l√©gramme). Certaines demandes de page courantes ont beaucoup plus de pages.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la recherche Yandex, le nombre d'√©l√©ments sur la page est cod√© en dur. Combien de pistes, combien de listes de lecture. Parfois, cela ne correspond m√™me pas √† la quantit√© de donn√©es affich√©es sur le devant. Il y a un changement de page, le nombre d'√©l√©ments est flottant. Par cons√©quent, dans le bot, il saute √©galement, ce qui n'est pas tr√®s beau. Et pour combiner leur paginateur avec le sien - quelque chose comme √ßa. Dans d'autres endroits o√π il est possible de demander un certain nombre d'√©l√©ments par page, tout est parfait. Le message vocal apr√®s avoir impl√©ment√© la recherche dans le bot est </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/MarshalC/416</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors du transfert audio dans Telegram, l'auteur est perdu et affect√© √† celui qui a fait le transfert. Par cons√©quent, toutes les pistes sont envoy√©es avec la signature du nom d'utilisateur du bot. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Message vocal avec tout ce que j'ai rencontr√© apr√®s la mise en place de la radio dans la biblioth√®que - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/MarshalC/422</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(√† propos de la cha√Æne de pistes, en passant par l'envoi d'un tas de commentaires, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">batch_id</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malgr√© le fait qu'il s'agisse d'un autre article sur le bot Telegram, vous l'avez lu jusqu'ici, probablement parce que vous √©tiez int√©ress√© par l'un des points de la coupe et c'est merveilleux, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">merci beaucoup</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malheureusement, je n'ai pas enti√®rement ouvert le code source du bot (car dans certains endroits j'ai besoin de refactoriser). </font><font style="vertical-align: inherit;">Beaucoup a √©t√© d√©crit dans cet article, mais certains aspects, par exemple, avec les claviers virtuels et leur g√©n√©ration ne sont pas affect√©s. </font><font style="vertical-align: inherit;">Pour l'essentiel, ce qui n'est pas dans l'article fonctionne simplement avec ma biblioth√®que, rien d'int√©ressant.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les classes autour desquelles tout tourne, je les ai montr√©es sous la forme dans laquelle elles se trouvent maintenant. J'avoue qu'il y a des bugs, mais tout fonctionne depuis longtemps. √Ä certains endroits, j'aime mon code, √† certains endroits, je n'aime pas - et c'est normal. N'oubliez pas que travailler avec WS pour la reconnaissance est une solution sur le genou. Pr√™t √† lire des critiques motiv√©es dans les commentaires. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien que le bot ait √©t√© planifi√© m√™me lorsque j'ai commenc√© √† √©crire la biblioth√®que, j'ai reni√© cette id√©e, mais, apparemment, je suis revenu (c'√©tait ennuyeux). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yandex.Music Bot - un projet qui prouve l'utilit√© d'utiliser la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biblioth√®que pour travailler avec l'API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans les projets.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un grand merci √† maman, Yana, Sana'a, Glory. </font><font style="vertical-align: inherit;">Quelqu'un pour les erreurs de relecture, certains pour les conseils, sans lesquels certains points de cet article pourraient ne pas avoir exist√©, et pour certains simplement pour √©valuer l'article avant la publication. </font><font style="vertical-align: inherit;">Arthur pour picci pour l'article, Lyod pour le logo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Maintenant, j'ai un probl√®me aigu avec la distribution apr√®s √©tude. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous √™tes pr√™t √† me t√©l√©phoner - dites-moi o√π envoyer le CV, interviewez-moi, s'il vous pla√Æt. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tous mes contacts sont dans le profil. </font><font style="vertical-align: inherit;">Le temps presse, j'esp√®re pour vous. </font><font style="vertical-align: inherit;">En vertu de la loi, je ne peux m'entra√Æner qu'en R√©publique du B√©larus. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PPS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C'√©tait le deuxi√®me article de trois, mais sans la moindre id√©e, j'aurai le temps de faire un autre projet sur ce sujet et si c'est n√©cessaire. </font><font style="vertical-align: inherit;">Je vais d√©voiler publiquement son sujet - le client multiplateforme Yandex.Music.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr487418/index.html">Qu'est-ce que SAP?</a></li>
<li><a href="../fr487420/index.html">Sound War Z. Test des haut-parleurs et des √©couteurs MusicDealer</a></li>
<li><a href="../fr487422/index.html">Responsabilit√©s de l'administrateur Salesforce: que faire et quand</a></li>
<li><a href="../fr487424/index.html">Comment passer de 1 √† 100 000 utilisateurs</a></li>
<li><a href="../fr487426/index.html">La flexibilit√© conditionne le succ√®s.</a></li>
<li><a href="../fr487430/index.html">Quelles comp√©tences sont n√©cessaires pour cr√©er une application iOS? Rapport Yandex</a></li>
<li><a href="../fr487432/index.html">Sur les traces de DevConf et CfgMgmtCamp ou de ce que vous pouvez apprendre en allant au conf√©rencier lors de 2 conf√©rences internationales en 2 semaines</a></li>
<li><a href="../fr487438/index.html">Comment cr√©er une entreprise informatique √† partir de z√©ro - sans exp√©rience dans ce domaine et sans comp√©tences en programmation?</a></li>
<li><a href="../fr487444/index.html">¬´Tout en buvant du caf√©, factur√© et re√ßu une pouss√©e pour le paiement¬ª - des innovations qui vous permettent de faire des affaires 24/7</a></li>
<li><a href="../fr487446/index.html">Une entreprise peut-elle ¬´poss√©der¬ª la couleur?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>