<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐠 🦗 🎉 Synet-CPUで事前トレーニング済みニューラルネットワークを実行するためのフレームワーク ⛴️ ⚙️ 🗾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="前書き
 こんにちは、Khabrovitesさん！Synesis
 
 での私の過去2年間の仕事は、CPUで事前トレーニング済みの畳み込みニューラルネットワークを実行するためのオープンライブラリであるSynetの作成と開発のプロセスと密接に関連しています。この作業の過程で、ニューラルネットワークでの...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Synet-CPUで事前トレーニング済みニューラルネットワークを実行するためのフレームワーク</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471074/"><img src="https://habrastorage.org/webt/gh/jk/rs/ghjkrs4akso0bxg4ijmhxcizzjq.jpeg" alt="私の自転車"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
こんにちは、Khabrovitesさん！</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Synesis</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
での私の過去2年間の仕事は</font><font style="vertical-align: inherit;">、CPUで事前トレーニング済みの畳み込みニューラルネットワークを実行するためのオープンライブラリである</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Synet</font></a><font style="vertical-align: inherit;">の作成と開発のプロセスと密接に関連して</font><font style="vertical-align: inherit;">います。この作業の過程で、ニューラルネットワークでの直接信号伝搬アルゴリズムの最適化に関連するいくつかの興味深い点に遭遇しました。これらのポイントの説明は、ハブラハブの読者にとって非常に興味深いと思います。一連の記事に捧げたいこと。サイクルの期間は、このトピックへの関心と、もちろん、怠惰を克服する私の能力によって異なります。</font><s><font style="vertical-align: inherit;">自転車</font></s><font style="vertical-align: inherit;">自体の説明からサイクルを開始したい</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><s><font style="vertical-align: inherit;"></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フレームワーク。</font><font style="vertical-align: inherit;">その根底にあるアルゴリズムの質問は、後続の記事で開示されます。</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">畳み込み層：行列乗算の最適化手法</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">畳み込み層：Shmuel Vinogradの方法による高速畳み込み</font></font></a></li>
</ol> <br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">質問に対する回答</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フレームワークの詳細な説明を始める前に、読者が抱く可能性のある多くの質問にすぐに答えてみます。</font><font style="vertical-align: inherit;">多くの人が最後まで読んでいないのにすぐに怒りのコメントを書き始めるので、経験上、これを事前に行うことをお勧めします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような場合に通常発生する最初の質問：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グラフィックアクセラレータとテンソル（マトリックス）アクセラレータが</font></font></i> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ある場合、</font><i><font style="vertical-align: inherit;">誰が従来のプロセッサでネットワークを実行しますか？</font></i></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の答えは「はい」です。CPUでニューラルネットワークのトレーニングを実行することは実際にお勧めできませんが、既製のニューラルネットワークを実行することは、特にネットワークが十分に小さい場合、かなりの需要です。</font><font style="vertical-align: inherit;">これの理由は異なる場合がありますが、主な理由は次のとおりです。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPUがより一般的です。</font><font style="vertical-align: inherit;">特にサーバーの場合、すべてのマシンにGPUがあるわけではありません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 小規模なニューラルネットワークでは、GPUを使用することによる利益は小さく、場合によっては完全になくなることもあります。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GPUを効果的に使用してニューラルネットワークを高速化するには、通常、非常に複雑なアプリケーション構造が必要です。 </font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の可能な質問は：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なぜ打ち上げに特化したソリューションを使用する場合があり</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tensorflow</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カフェ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">や</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MXNet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">？</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これに対する答えは次のとおりです。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> さまざまなフレームワークが常に良いとは限りません。そのため、プロジェクト内の異なるフレームワークでトレーニングされた複数のモデルがある場合、それらすべてを既製のソリューションに埋め込む必要があり、非常に不便です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラシックフレームワークは、GPUモデルをトレーニングするように設計されています。</font><font style="vertical-align: inherit;">ただし、CPUでトレーニング済みモデルを実行するには、その機能は冗長であり、最適ではありません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特殊なソリューションの必要性の確認</font><font style="vertical-align: inherit;">は、同じ機能を実行するIntelフレームワーク</font><font style="vertical-align: inherit;">である</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenVINO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の人気です</font><font style="vertical-align: inherit;">。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここですぐに自転車の発明について論理的な疑問が生じ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><i><font style="vertical-align: inherit;">認められた世界のリーダーからの完全に専門的な解決策があるのに、なぜあなたの技術を使うのですか？</font></i></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の答えは：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Synetの作業が始まった当初、OpenVINOはまだ初期の段階でした。</font><font style="vertical-align: inherit;">そして、実際には、その時点でOpenVINOが現在の状態にあった場合、高い確率で自分のプロジェクトに関与することはありません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">独自のフレームワークをニーズに適合させることができます。</font><font style="vertical-align: inherit;">したがって、私の場合、主な要件は最大のシングルスレッドパフォーマンスでした。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 突然必要になった場合は、新しい機能のサポートをできるだけ早く提供できます（たとえば、新しいレイヤーを追加してパフォーマンスエラーを排除します）。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ターンキーソリューションに簡単に組み込むことができます。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ARMなど、x86 / x86_64以外のプラットフォームでのライブラリの機能。 </font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
読者は他の質問や異論を抱く可能性がありますが、それでも私はそれらを予測することはできないため、記事へのコメントで回答します。</font><font style="vertical-align: inherit;">それまでは、Synetの直接的な説明から始めましょう。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Synetの短い説明</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Synetは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C ++で</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記述されて</font><font style="vertical-align: inherit;">おり、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヘッダーファイル</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のみが含まれてい</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。低レベルのプラットフォーム</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">固有の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最適化は</font><font style="vertical-align: inherit;">、CPUでの画像処理の高速化に特化した別のオープンソースプロジェクト</font><font style="vertical-align: inherit;">である</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Simd</font></a><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">実装され</font><font style="vertical-align: inherit;">ています。そして、これはSynetの唯一の外部依存関係です（このようなスキームは、サードパーティプロジェクトへのライブラリの統合を容易にするために選択されました）。ニューラルネットワークを実行するには、独自の内部形式のモデルが使用されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rp/bu/rn/rpburnoopqfamvrtyhhcmbp4nnm.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
事前トレーニング済みモデルの内部形式への変換は、2ステップのスキームに従って実行されます。1）最初に、モデルを推論エンジン形式に変換します（</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 OpenVINOにはこれに必要なすべての</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ツールがある</font></a><font style="vertical-align: inherit;">ため）</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">2）次に、この中間表現から、内部Synet形式に直接変換します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pk/21/td/pk21tdeoswgjtrpnmym-hqby7-k.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Synetモデルには2つのファイルが含まれています。1）* .XML-モデルの構造の説明を含むファイル。</font><font style="vertical-align: inherit;">2）* .BIN-トレーニングされた重みを持つファイル。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/w-/xa/nr/w-xanrgyr20xe7oxpbdtlavuhua.png" alt="画像"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Synetの例</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下はSynetを使用して顔を検出する例です。</font><font style="vertical-align: inherit;">元の推論エンジンモデルは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で使用され</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYNET_SIMD_LIBRARY_ENABLE</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"Synet/Network.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"Synet/Converters/InferenceEngine.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"Simd/SimdDrawing.hpp"</span></span><font></font>
<font></font>
<span class="hljs-keyword">typedef</span> Synet::Network&lt;<span class="hljs-keyword">float</span>&gt; Net;
<span class="hljs-keyword">typedef</span> Synet::View View;
<span class="hljs-keyword">typedef</span> Synet::Shape Shape;
<span class="hljs-keyword">typedef</span> Synet::Region&lt;<span class="hljs-keyword">float</span>&gt; Region;
<span class="hljs-keyword">typedef</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Region&gt; Regions;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span>
</span>{<font></font>
    Synet::ConvertInferenceEngineToSynet(<span class="hljs-string">"ie_fd.xml"</span>, <span class="hljs-string">"ie_fd.bin"</span>, 
		<span class="hljs-literal">true</span>, <span class="hljs-string">"synet.xml"</span>, <span class="hljs-string">"synet.bin"</span>);<font></font>
<font></font>
    Net net;<font></font>
    net.Load(<span class="hljs-string">"synet.xml"</span>, <span class="hljs-string">"synet.bin"</span>);<font></font>
<font></font>
    net.Reshape(<span class="hljs-number">256</span>, <span class="hljs-number">256</span>, <span class="hljs-number">1</span>);<font></font>
<font></font>
    Shape shape = net.NchwShape();<font></font>
<font></font>
    View original;<font></font>
    original.Load(<span class="hljs-string">"faces_0.ppm"</span>);<font></font>
<font></font>
    <span class="hljs-function">View <span class="hljs-title">resized</span><span class="hljs-params">(shape[<span class="hljs-number">3</span>], shape[<span class="hljs-number">2</span>], original.format)</span></span>;<font></font>
    Simd::Resize(original, resized, ::SimdResizeMethodArea);<font></font>
<font></font>
    net.SetInput(resized, <span class="hljs-number">0.0f</span>, <span class="hljs-number">255.0f</span>);<font></font>
<font></font>
    net.Forward();<font></font>
<font></font>
    Regions faces = net.GetRegions(original.width, original.height, <span class="hljs-number">0.5f</span>, <span class="hljs-number">0.5f</span>);
    <span class="hljs-keyword">uint32_t</span> white = <span class="hljs-number">0xFFFFFFFF</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; faces.size(); ++i)<font></font>
    {<font></font>
        <span class="hljs-keyword">const</span> Region &amp; face = faces[i];
        <span class="hljs-keyword">ptrdiff_t</span> l = <span class="hljs-keyword">ptrdiff_t</span>(face.x - face.w / <span class="hljs-number">2</span>);
        <span class="hljs-keyword">ptrdiff_t</span> t = <span class="hljs-keyword">ptrdiff_t</span>(face.y - face.h / <span class="hljs-number">2</span>);
        <span class="hljs-keyword">ptrdiff_t</span> r = <span class="hljs-keyword">ptrdiff_t</span>(face.x + face.w / <span class="hljs-number">2</span>);
        <span class="hljs-keyword">ptrdiff_t</span> b = <span class="hljs-keyword">ptrdiff_t</span>(face.y + face.h / <span class="hljs-number">2</span>);<font></font>
        Simd::DrawRectangle(original, l, t, r, b, white);<font></font>
    }<font></font>
    original.Save(<span class="hljs-string">"annotated_faces_0.ppm"</span>);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例の作業の結果として、注釈付きの顔のある画像が表示</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fm/vt/cd/fmvtcdwcodslghhenbzsd2pjbz8.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
されます。次に、例を段階的に分析してみましょう。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> まず、モデルが推論エンジン形式からSynetに変換されます。</font></font><br>
<br>
<pre><code class="cpp hljs">Synet::ConvertInferenceEngineToSynet(<span class="hljs-string">"ie_fd.xml"</span>, <span class="hljs-string">"ie_fd.bin"</span>,  <span class="hljs-literal">true</span>, <span class="hljs-string">"synet.xml"</span>, <span class="hljs-string">"synet.bin"</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際には、このステップは一度だけ実行され、その後、すでに変換されたモデルがあらゆる場所で使用されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 変換されたモデルをダウンロード：</font></font><br>
<br>
<pre><code class="cpp hljs">Net net;<font></font>
net.Load(<span class="hljs-string">"synet.xml"</span>, <span class="hljs-string">"synet.bin"</span>);
</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入力画像とバッチのサイズを変更するためのオプションの手順（当然、モデルは入力画像のサイズ変更をサポートする必要があります）：</font></font><br>
<br>
<pre><code class="cpp hljs">net.Reshape(<span class="hljs-number">256</span>, <span class="hljs-number">256</span>, <span class="hljs-number">1</span>);
</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">画像を読み込んでモデルの入力サイズに取り込む：</font></font><br>
<br>
<pre><code class="cpp hljs">View original;<font></font>
original.Load(<span class="hljs-string">"faces_0.ppm"</span>);
<span class="hljs-function">View <span class="hljs-title">resized</span><span class="hljs-params">(net.NchwShape()[<span class="hljs-number">3</span>], net.NchwShape()[<span class="hljs-number">2</span>], original.format)</span></span>;<font></font>
Simd::Resize(original, resized, ::SimdResizeMethodArea);<font></font>
</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モデルへの画像の読み込み：</font></font><br>
<br>
<pre><code class="cpp hljs">net.SetInput(resized, <span class="hljs-number">0.0f</span>, <span class="hljs-number">255.0f</span>);
</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワークでの直接信号伝搬の開始：</font></font><br>
<br>
<pre><code class="cpp hljs">net.Forward();
</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">顔が見つかった一連の領域を取得する：</font></font><br>
<br>
<pre><code class="cpp hljs">Regions faces = net.GetRegions(original.width, original.height, <span class="hljs-number">0.5f</span>, <span class="hljs-number">0.5f</span>);
</code></pre></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性能比較</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Synetを機械学習用の従来のフレームワークと比較することはおそらく完全に正しくありません。たとえば、推論エンジン</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はそれらをいくつかのテストで数回バイパスします</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、以下は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一連のオープンモデルの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サンプルで、推論エンジン（同様の機能の製品）とSynetのシングルスレッドパフォーマンスを比較する例です</font><font style="vertical-align: inherit;">。</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テスト</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">説明文</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i7-6700 3.4GHz 4c / 8t FMA / AVX-2</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i9-7900X 3.3GHz 10c / 20t AVX-512</font></font></th>
</tr>
<tr>
<td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">test_000</font></font></a> </td>
<td> Vehicle attributes recognition (2.4 MB)</td>
<td> 1.520 / <font color="red">1.597</font> ms (<font color="red">-5%</font>)</td>
<td> 0.772 / <font color="green">0.690</font> ms (<font color="green">+12%</font>) </td>
</tr>
<tr>
<td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">test_001</a> </td>
<td> Age gender recognition (8.2 MB)</td>
<td> 1.659 / <font color="green">1.418</font> ms (<font color="green">+17%</font>)</td>
<td> 0.988 / <font color="green">0.804</font> ms (<font color="green">+23%</font>)</td>
</tr>
<tr>
<td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">test_002</a> </td>
<td> Face detection (4.0 MB)</td>
<td> 34.26 / <font color="red">43.17</font> ms (<font color="red">-21%</font>)</td>
<td> 26.72 / <font color="green">24.57</font> ms (<font color="green">+9%</font>)</td>
</tr>
<tr>
<td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">test_003f</a> </td>
<td> Face detection (2.2 MB)</td>
<td> 12.63 / <font color="red">14.87</font> ms (<font color="red">-15%</font>)</td>
<td> 8.680 / <font color="red">9.326</font> ms (<font color="red">-7%</font>)</td>
</tr>
<tr>
<td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">test_004</a> </td>
<td> Licence plate recognition (4.6 MB)</td>
<td> 4.350 / <font color="red">4.871</font> ms (<font color="red">-11%</font>)</td>
<td> 2.838 / <font color="green">2.432</font> ms (<font color="green">+17%</font>)</td>
</tr>
<tr>
<td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">test_005</a> </td>
<td> Licence plate recognition (0.7 MB)</td>
<td> 0.339 / <font color="green">0.260</font> ms (<font color="green">+30%</font>)</td>
<td> 0.200 / <font color="green">0.142</font> ms (<font color="green">+41%</font>)</td>
</tr>
<tr>
<td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">test_006</a> </td>
<td> Face reidentification (4.2 MB)</td>
<td> 11.82 / <font color="green"> 9.052</font> ms (<font color="green">+31%</font>)</td>
<td> 8.200 / <font color="green">4.559</font> ms (<font color="green">+80%</font>)</td>
</tr>
<tr>
<td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">test_007</a> </td>
<td> Person reidentification (3.1 MB)</td>
<td> 3.567 / <font color="green"> 3.402</font> ms (<font color="green">+5%</font>)</td>
<td> 2.471 / <font color="green">1.679</font> ms (<font color="green">+47%</font>)</td>
</tr>
<tr>
<th>Average</th>
<th> </th>
<th>+2%</th>
<th>+25%</th>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
表からわかるように、AVX2（i7-6700）をサポートするマシンでのこれらのテストでは、Synetのパフォーマンスは一般に推論エンジンのパフォーマンスに対応しています（ただし、モデルごとに大幅に異なります）。</font><font style="vertical-align: inherit;">AVX-512（i9-7900X）をサポートするマシンでは、Synetのパフォーマンスは、推論エンジンのパフォーマンスよりも平均で25％高くなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての測定はSynetにあるテストアプリケーションによって実行されました。</font><font style="vertical-align: inherit;">したがって、必要に応じて、読者はテスト自体を再現できます。</font></font><br>
<br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> -b master --recurse-submodules -v https://github.com/ermig1979/Synet.git synet
<span class="hljs-built_in">cd</span> synet<font></font>
./build.sh inference_engine<font></font>
./test.sh<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">長所と短所</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はプロから始めます：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> プロジェクトはサイズが小さく、サードパーティプロジェクトに簡単に実装できます。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> シングルスレッドの高いパフォーマンスを示します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> モバイルプロセッサで動作します（ARM-NEONをサポート）。 </font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まあ、短所、それらなしで：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GPUおよびその他の特別なアクセラレータはサポートされていません。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> マルチコアCPUでの1つのタスクの不十分な並列化。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> INT8（重みの量子化）はサポートされていません。 </font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Synetは現在</font><font style="vertical-align: inherit;">、ビデオ分析用のクラウドベースのプラットフォーム</font><font style="vertical-align: inherit;">である</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kipod</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトの一部として使用されてい</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">多分彼は他のユーザーを持っていますが、それは確かではありません:)。</font><font style="vertical-align: inherit;">将来的には、プロジェクトが発展するにつれて、次のことを追加したいと思います。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 新しいモデル、レイヤー、アルゴリズムのサポート。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> INT8形式（量子化された重み）での整数計算のサポート。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GPUコンピューティングのサポート。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ONNX形式から変換します。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このリストは完全とはほど遠いので、コミュニティの意見を考慮に入れて補足したいと思います-したがって、私はあなたのフィードバックを待っています！</font><font style="vertical-align: inherit;">弊社だけでなく、幅広いユーザーに役立つツールにするため。</font><font style="vertical-align: inherit;">また、作成者は開発プロセスにおけるコミュニティの支援を拒否しません。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事で私が作成したSynetについて説明するとき、その内部実装の詳細については意図的に掘り下げませんでした-内部には多くのおいしいアルゴリズムがありますが、シリーズの次の記事でそれらの実装の詳細を開示したいと思います。</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">畳み込み層：行列乗算の最適化手法</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">畳み込み層：Shmuel Vinogradの方法による高速畳み込み</font></font></a></li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja471054/index.html">暗号通貨の量子脅威の現実性と「予言2027」の問題についてLongrid</a></li>
<li><a href="../ja471062/index.html">スマートホームを管理するようにアリスに教える方法。Yandexレポート</a></li>
<li><a href="../ja471066/index.html">zipアーカイブはどのように見え、それに対して何ができるか</a></li>
<li><a href="../ja471070/index.html">選択するサーバー言語...モバイル開発者向け</a></li>
<li><a href="../ja471072/index.html">テレグラムのグラム数は？</a></li>
<li><a href="../ja471076/index.html">マトリックスが防弾遺産を作成した方法</a></li>
<li><a href="../ja471078/index.html">Chromeは混合コンテンツを完全にブロックします</a></li>
<li><a href="../ja471080/index.html">アプリケーションのテストの品質に責任を持つのは誰ですか？本番環境でエラーが発生する10の理由</a></li>
<li><a href="../ja471084/index.html">タイルカードで使用できる手続き型パターン</a></li>
<li><a href="../ja471086/index.html">BlenderのPython音楽カバージェネレーター</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>