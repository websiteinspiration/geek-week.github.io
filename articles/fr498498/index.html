<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêâ ü§µüèª ‚õµÔ∏è Enqu√™te: qu'est-ce qui est sup√©rieur aux priorit√©s des threads dans Windows? ‚úñÔ∏è üë®‚Äçüë¶ üìê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cette enqu√™te, comme beaucoup d'autres, a commenc√© par le fait que je faisais ma propre entreprise, sans essayer de chercher des probl√®mes par moi-m√™m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Enqu√™te: qu'est-ce qui est sup√©rieur aux priorit√©s des threads dans Windows?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498498/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette enqu√™te, comme beaucoup d'autres, a commenc√© par le fait que je faisais ma propre entreprise, sans essayer de chercher des probl√®mes par moi-m√™me. Cette fois, tout ce que j'ai fait, c'est d'ouvrir le couvercle de l'ordinateur portable et j'ai essay√© de me connecter au syst√®me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour les premi√®res fois, lorsque cela a entra√Æn√© un retard de vingt secondes, j'ai ignor√© le probl√®me, en esp√©rant qu'il se r√©soudrait lui-m√™me. Les prochaines fois, j'ai pens√© √† l'enqu√™te, mais les probl√®mes de performances qui surviennent avant m√™me que vous vous connectiez soient plus difficiles √† r√©soudre, et j'√©tais paresseux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quand j'ai remarqu√© que j'√©vitais de fermer l'ordinateur portable parce que j'avais peur de ces retards trop fr√©quents, j'ai r√©alis√© qu'il √©tait temps de le faire s√©rieusement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heureusement, j'ai r√©cemment corrig√© la </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">trace du</font></a><font style="vertical-align: inherit;"> tampon en anneau </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIforETW</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ce qui le rend fiable, alors je l'ai commenc√© et j'ai commenc√© √† attendre le prochain √©v√©nement de retard. Je n'ai pas d√ª attendre longtemps. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il m'a fallu plusieurs fois pour obtenir la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trace ETW</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parfaitement bien avec moi </font><font style="vertical-align: inherit;">. Et comme ce territoire ne m'√©tait pas familier, il a fallu un certain temps pour comprendre ce qui se passait. Je n'ai toujours pas bien compris le probl√®me, mais 90% ont compris les raisons de son apparition. J'ai r√©ussi √† en apprendre beaucoup, y compris de nouveaux d√©tails sur le planificateur Windows, et j'ai √©galement trouv√© une solution absolument efficace. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La trace id√©ale que j'ai finalement enregistr√©e lors du chargement dans Microsoft Windows Performance Analyzer (WPA) ressemble √† ceci:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/349/031/72d/34903172d4e4c5f85b33a02255942315.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âv√©nements standard, fen√™tres en bref et utilisation du processeur.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ce tableau et deux graphiques contiennent une tonne d'informations. Le tableau sup√©rieur ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âv√©nements g√©n√©riques</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) affiche les s√©quences de touches enregistr√©es pour UIforETW. J'ai essay√© d'appuyer sur une touche (code de touche virtuelle 162) une fois par seconde jusqu'√† ce qu'un champ de saisie de mot de passe apparaisse. Puisque ces 17 frappes sont s√©lectionn√©es, dans le graphique ci-dessous, elles sont repr√©sent√©es par des lignes bleues verticales pour une visualisation simplifi√©e du temps d'ex√©cution des √©v√©nements critiques. L'axe des x repr√©sente le temps en secondes.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les barres horizontales dans le graphique sup√©rieur ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Window in Focus</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) indiquent quel processus a le focus pendant cette p√©riode. </font><font style="vertical-align: inherit;">Il y a six processus diff√©rents au total. </font><font style="vertical-align: inherit;">La p√©riode de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tra√ßage</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est la courte p√©riode pendant laquelle l'ordinateur portable a √©t√© ferm√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le graphique du bas montre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'utilisation du processeur</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Les informations sont obtenues √† partir des donn√©es de changement de contexte, elles doivent donc √™tre compl√®tement pr√©cises et compl√®tes. </font><font style="vertical-align: inherit;">Dans cette trace, une valeur de 100% indique le moment o√π les huit processeurs logiques de mon ordinateur portable √† quatre c≈ìurs √† huit fils ont √©t√© utilis√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir re√ßu les donn√©es de trace, j'ai d√ª comprendre ce que mon ordinateur portable fait secr√®tement lorsque le couvercle est ferm√© et jusqu'au moment o√π je reviens au syst√®me.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temp√™te avant l'accalmie</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme nous pouvons le voir, l'ordinateur portable au d√©but de la trace de l'ordinateur portable est relativement simple, comme il se doit. Puis j'ai ferm√© son couvercle. Cela semble avoir provoqu√© un pic d'activit√© du processeur et un changement dans le focus de Windows. </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Window in Focus est</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pass√© de UIforETW √† Idle, puis √† csrss, de nouveau √† Idle, √† LogonUI, puis de nouveau √† Idle. Qui aurait pens√©?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant cet intervalle, l'ordinateur portable a effectu√© environ 17 secondes de traitement CPU de diff√©rents types. Une partie de cela est le travail n√©cessaire pour fermer. Partie - ce sont des programmes (y compris les outils internes de Google) qui sont enregistr√©s dans le Planificateur de t√¢ches pour l'ex√©cution de ¬´Lorsqu'un utilisateur verrouille un poste de travail¬ª - cela a du sens. J'ai m√™me remarqu√© que le travail est en cours pour cr√©er des √©l√©ments d'interface utilisateur pour la connexion lorsque l'utilisateur continue de travailler - vous devez √™tre pr√©par√© √† l'avance, non?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
17 secondes de CPU - un temps assez long pour que l'ordinateur portable s'endorme. </font><font style="vertical-align: inherit;">M√™me sur mon ordinateur portable avec quatre c≈ìurs et huit threads, le processus prend plus de quatre secondes. </font><font style="vertical-align: inherit;">Sur mon ordinateur portable, il faut plus de 13 secondes de temps processeur pour s'endormir, et presque tous passent au code Windows. </font><font style="vertical-align: inherit;">Le </font><font style="vertical-align: inherit;">service de strat√©gie de diagnostic </font><font style="vertical-align: inherit;">doit-il </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vraiment</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ex√©cuter quelques SruDbTableSearches avant que l'ordinateur portable puisse se reposer? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je pense que ce travail excessif quand je vais dormir est </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aussi un</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> probl√®me, mais ce n'est pas </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> probl√®me que je recherche. </font><font style="vertical-align: inherit;">J'ai donc d√©cid√© de lui tourner le dos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et ce n'est que bien plus tard que j'ai r√©alis√© que c'est √† cette √©poque que les grains de destruction de mon insecte ont √©t√© jet√©s ...</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dormir</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir bloqu√© l'ordinateur portable, il n'y a plus d'activit√© CPU. </font><font style="vertical-align: inherit;">Dans ce test particulier, l'ordinateur portable a √©t√© verrouill√© pendant environ 16 secondes.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âveil convulsif</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'activit√© du processeur lors de la transition vers le sommeil est incomparable avec le moment o√π il a commenc√© √† se r√©veiller. </font><font style="vertical-align: inherit;">Pendant ce temps, mon ordinateur portable surcharg√© a pris environ 172 secondes de temps CPU (!!!) pendant 22,6 secondes. </font><font style="vertical-align: inherit;">C'est beaucoup de travail. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'un des myst√®res de ce processus est la baisse de l'utilisation du processeur √† pr√®s de z√©ro environ une seconde apr√®s le d√©but de l'activit√©. </font><font style="vertical-align: inherit;">Cette courte p√©riode d'indisponibilit√© semble plut√¥t anormale, compte tenu du chaos qui l'entoure. </font><font style="vertical-align: inherit;">Mais je pense que cette fonctionnalit√© n'est pas li√©e au probl√®me, donc je n'y ai pas fait attention. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un autre myst√®re est pourquoi </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tant de</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les programmes prennent vie apr√®s cette br√®ve pause. C'est dr√¥le que l'intrus le plus s√©rieux responsable de 31,6 des 172 secondes du CPU soit Windows Performance Analyzer (WPA) - le programme m√™me que j'utilise pour analyser les traces. Les trois copies que j'ai laiss√©es en cours d'ex√©cution travaillent dur pour rendre mon interface utilisateur, m√™me si elle n'est pas encore visible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En outre, des motifs sombres se produisent lors de la tentative d'initialisation des p√©riph√©riques portables. KeStallExecutionProcessor est une boucle d'attente, et il √©tait √©trange de voir que c'est la fonction la plus ex√©cutable de tout le syst√®me. Un deuxi√®me cycle d'attente est-il le seul moyen de d√©marrer l'√©quipement? </font><font style="vertical-align: inherit;">Est-il </font><font style="vertical-align: inherit;">vraiment n√©cessaire de passer 700 ms de temps CPU √† initialiser la </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">souris et le clavier</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? Microsoft et Intel devraient-ils ignorer la recommandation de Microsoft sur</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un maximum de 50 microsecondes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ?</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fa7/c4e/cf4/fa7c4ecf4fe56c7c9014ee252f4557b0.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pilotes d'un cycle d'attente. </font><font style="vertical-align: inherit;">i8042prt.sys est √©crit par Microsoft. </font><font style="vertical-align: inherit;">Les deux suivants sont cr√©√©s par Intel. </font></font></i> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fin de compte, de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nombreux</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> programmes </font><font style="vertical-align: inherit;">fonctionnent activement pendant cette p√©riode </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">La plupart d'entre eux semblent √™tre confront√©s au m√™me probl√®me que WPA - ils cherchent d√©sesp√©r√©ment √† dessiner des pixels sur un √©cran cach√©, et cela fait allusion √† un bogue Windows. </font><font style="vertical-align: inherit;">Mais m√™me sans ce bug explorer.exe et d'autres programmes cherchent activement </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quelque chose</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √† faire. </font><font style="vertical-align: inherit;">Mais au final, bien que cette utilisation excessive du CPU soit une </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">partie</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√©cessaire </font><em><font style="vertical-align: inherit;">du</font></em><font style="vertical-align: inherit;"> probl√®me, ce n'est pas </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> probl√®me </font><em><font style="vertical-align: inherit;">lui-m√™me</font></em><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Encore une fois, j'ai cess√© de lui pr√™ter attention.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Concentrer</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors de l'analyse des traces, il est important de savoir quand des actions importantes se produisent. La principale preuve √©tait les √©v√©nements de saisie, car j'ai cess√© de cliquer sur le contr√¥le apr√®s l'apparition du formulaire de saisie du mot de passe. Voici les trois derni√®res touches de la touche de contr√¥le dans une forme approximative sur le graphique </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fen√™tre en bref</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/158/50d/6f9/15850d6f9eecb243c2984cd4988c6bb1.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il semble que les √©v√©nements critiques obtiennent le focus de LockApp.exe, apr√®s quoi le focus obtient LogonUI.exe presque instantan√©ment. </font><font style="vertical-align: inherit;">Vraisemblablement, j'ai entr√© le mot de passe dans LogonUI.exe (il est pratique que la trace n'intercepte pas les √©v√©nements du clavier), apr√®s quoi le focus est bri√®vement pass√© √† l'explorateur, puis √† UIforETW, √† partir duquel j'ai commenc√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il semble √©galement que LogonUI.exe ne puisse pas se concentrer avant LockApp.exe - ce mod√®le se r√©p√®te dans toutes les traces que j'ai √©tudi√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, apr√®s plus de mille mots consacr√©s √† la r√©solution de cette √©nigme, nous avons enfin une question claire que nous pouvons √©tudier: pourquoi LockApp.exe se concentre-t-il apr√®s avoir quitt√© le temps d'arr√™t, cela prend vingt secondes?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons une question? </font><font style="vertical-align: inherit;">Super, r√©pondons-y</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En utilisant </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les donn√©es d'utilisation du processeur (pr√©cises)</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> obtenues √† partir de la commutation de contenu, </font><font style="vertical-align: inherit;">j'ai rapidement constat√© que dans les vingt secondes apr√®s le r√©veil, LockApp.exe avait re√ßu moins d'une milliseconde de temps processeur et pendant plus de 14 secondes (de 35,158 s √† 49,827 s) ne fonctionnait pas g√©n√©ralement:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f50/5dc/954/f505dc954915bdbf5a857eac5c4303f4.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LockApp ne fonctionne pas du tout pendant longtemps</font></font></i><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La documentation sur la signification des colonnes dans les tableaux d'utilisation du processeur (pr√©cis) est </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si un processus ou un thread n'a pas √©t√© ex√©cut√© depuis un certain temps et que vous souhaitez savoir pourquoi, des indices g√©n√©ralement importants peuvent √™tre trouv√©s dans le premier changement de contexte apr√®s une longue accalmie, √† savoir le passage √† 49,827 secondes de suivi. </font><font style="vertical-align: inherit;">J'ai r√©organis√© les colonnes pour afficher plus de donn√©es de ce changement de contexte:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7f4/23d/7ca/7f423d7cad82b87f4c5556551b0e8fec.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LockApp est pr√©par√© mais pas ex√©cut√©. Strange ...</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Count, √©gal √† 1 signifie que nous regardons les donn√©es pour un seul changement de contexte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Temps √©coul√© depuis dernier, √©gal √† 38,2 millions de microsecondes, signifie que ce thread ne s'ex√©cutera pas dans les 38,2 secondes. Cela en soi n'est ni bon ni mauvais. Les flux inactifs √©conomisent de l'√©nergie, et √† la fin l'ordinateur portable √©tait dans un r√™ve depuis un certain temps. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Switch-In Time nous dit simplement quand exactement le thread s'inscrit dans le CPU - quand le contexte bascule vers ce thread. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et maintenant, nous allons √† la colonne Pr√™t. Il nous indique combien de temps le thread √©tait </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√™t</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √† s'ex√©cuter, mais pas ex√©cut√©. En d'autres termes, ce thread </font><font style="vertical-align: inherit;">attendait </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quelque chose</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (verrou, poign√©e) et </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c'est quelque chose</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a √©t√© lib√©r√© ou lanc√©, mais le thread </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n'a</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> toujours </font><em><font style="vertical-align: inherit;">pas fonctionn√©</font></em><font style="vertical-align: inherit;"> pendant 19,493 secondes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour mieux comprendre la colonne </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ready (us)</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , vous pouvez consulter la colonne </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ready Time (s)</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il nous dit quand le stream est pr√©par√©. Nous voyons que pendant 30,333 secondes de tra√ßage, ce thread a √©t√© pr√©par√© pour l'ex√©cution, mais ne s'est pas ex√©cut√© avant 49,827 secondes. Cela semble important. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette disposition des colonnes nous montre par ailleurs le m√™me changement de contexte:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/07f/b5c/c85/07fb5cc85d3dfc066a6c3cbd508ef7d7.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nouvelle pile de threads et pile de threads pr√™ts</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Donc, ce thread (que la nouvelle pile de threads s'attendait √† ce que NtWaitForWorkViaWorkerFactory affiche) a re√ßu l'ordre de se r√©veiller (le processus syst√®me appelant KeSetEvent) peu de temps apr√®s avoir ouvert le couvercle du portable pour 30,333 secondes de tra√ßage. </font><font style="vertical-align: inherit;">Mais √ßa a commenc√© non pas alors (ce qui serait ¬´bien¬ª), mais apr√®s 19,494 s, et c'est mauvais. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En r√®gle g√©n√©rale, lors d'une telle analyse des attentes, je passe beaucoup de temps √† comprendre pourquoi le flux attend et ce qui l'a emp√™ch√© d'√™tre pr√™t. </font><font style="vertical-align: inherit;">Mais c'√©tait la premi√®re fois que je faisais une analyse des attentes, dans laquelle ce n'√©tait pas important, et la question √©tait de savoir pourquoi ce fil pr√™t √† l'emploi n'√©tait pas ex√©cut√©.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cas ...</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La plupart des gens ne passent pas autant de temps √† √©tudier les traces ETW, donc une explication est n√©cessaire ici. </font><font style="vertical-align: inherit;">C'est </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tr√®s</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √©trange. </font><font style="vertical-align: inherit;">Si le thread est pr√™t, il d√©marre g√©n√©ralement instantan√©ment, ou apr√®s quelques millisecondes. </font><font style="vertical-align: inherit;">La disponibilit√© du flux, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comme son nom l'indique</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , signifie que le flux est pr√™t √† √™tre ex√©cut√© et presque rien ne peut l'interf√©rer. </font><font style="vertical-align: inherit;">Mais essayons de comprendre ce qui peut emp√™cher l'ex√©cution d'un thread fini.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Priorit√© au fil</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au d√©but, j'ai sugg√©r√© qu'il s'agissait d'un cas simple de ¬´faim¬ª du processeur. Des dizaines de processus n√©cessitent du temps CPU, et pour cette raison, LockApp n'obtient pas le bon jusqu'√† ce que la charge diminue. Cependant, cette th√©orie </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> correspond </font><em><font style="vertical-align: inherit;">pas tout</font></em><font style="vertical-align: inherit;"> √† fait aux sympt√¥mes, car le processus LockApp peut prendre environ 18 secondes </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√™me</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sans obtenir le temps CPU.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La th√©orie de la faim du processeur est bonne car elle est v√©rifiable. J'ai pu augmenter la priorit√© du processus LockApp √† l'aide du Gestionnaire des t√¢ches (pendant l'une des br√®ves p√©riodes o√π il n'a pas √©t√© suspendu par le syst√®me UWP), par cons√©quent, dans la trace finale que j'ai utilis√©e pour ce poste, LockApp a √©t√© ex√©cut√© avec une priorit√© √©lev√©e. Un thread Windows standard s'ex√©cute avec une priorit√© d'environ 8 √† 10. La priorit√© la plus √©lev√©e avec laquelle un thread Windows normal (en temps non r√©el) peut s'ex√©cuter est 15. Mes traces ETW ont montr√© que LockApp fonctionnait toujours avec la priorit√© 13 ou sup√©rieure. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici une chronologie du processeur pour les 19,494 secondes critiques, regroup√©es et color√©es par priorit√© de thread ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">New In Pri</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, la priorit√© actuelle affect√©e au thread). </font><font style="vertical-align: inherit;">Nous voyons que les threads avec les priorit√©s 4, 8, 9 et 10 consomment la grande majorit√© du temps CPU, surtout √† la fin:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/81b/7d5/431/81b7d5431d0a307a93d2250fec9f2b1c.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisation du CPU par priorit√©</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Voici une autre image avec des threads cach√©s avec des priorit√©s 0-12. </font><font style="vertical-align: inherit;">Chaque fois que le graphique tombe en dessous de 12,5% (ce qui signifie un processeur logique du temps CPU de mon ordinateur portable √† huit threads), LockApp </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √™tre lanc√©, et il devient absolument incroyable que la priorit√© l'emp√™che d'√™tre ex√©cut√©e si souvent lorsque de nombreux threads avec une priorit√© inf√©rieure ou √©gale obtenir une tonne de temps.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ec/c2c/66b/2ecc2c66b4df4902a3c5be388596524f.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisation prioritaire du processeur, threads haute priorit√© uniquement</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âlimine l'inversion de priorit√©</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a des sp√©culations que les algorithmes d'inversion de priorit√© de Windows sont si propices aux autres threads que LockApp.exe est bloqu√©. </font><font style="vertical-align: inherit;">Mais comme les graphiques ci-dessus montrent que les v√©ritables priorit√©s sont utilis√©es dans les d√©cisions de planification, cette hypoth√®se (toujours peu convaincante) devra √™tre abandonn√©e.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©chargement du noyau de pile</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque j'ai parl√© de ce casse-t√™te sur Twitter, l'un des commentateurs a sugg√©r√© que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la pile du noyau de threads √©tait d√©charg√©e</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Je n'√©tais pas familier avec cette situation, mais apr√®s les explications de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">John Werth</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (il comprend dans son domaine), j'ai </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©sactiv√© l'√©change de la pile du noyau</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et red√©marr√© l'ordinateur. </font><font style="vertical-align: inherit;">Rien n'a chang√©. </font><font style="vertical-align: inherit;">En fait, je ne pensais pas que cela aiderait, √©tant donn√© que j'ai 32 Go de m√©moire, et le probl√®me se produit √† plusieurs reprises et souvent; </font><font style="vertical-align: inherit;">mais il valait mieux en √™tre s√ªr.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Processus de pause</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtant donn√© que LockApp est une application UWP moderne, elle est soumise √† des restrictions similaires √† celles des applications pour smartphones. Entre autres choses, cela signifie qu'il peut √™tre suspendu lorsqu'il n'est pas au premier plan, puis ¬´d√©geler¬ª lorsqu'il est remis au premier plan. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">James Forshaw a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> propos√© d' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enregistrer ETW Microsoft-Windows-Kernel-Process</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour obtenir des donn√©es √† ce sujet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les √©v√©nements sont con√ßus pour provoquer une confusion maximale. Le nom de la t√¢che </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Process Freeze est</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilis√© √† la fois pour ¬´d√©congeler¬ª et ¬´geler¬ª, et la version de l'√©v√©nement </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">win: Stop</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> signifie que le processus d√©marre (il a arr√™t√© de geler) et la version de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">win: Start</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">signifie que le processus s'arr√™te (commence √† geler). Tout cela est extr√™mement logique, mais tr√®s d√©routant. Si les noms des √©v√©nements √©taient divis√©s en Freeze et Thaw, il y aurait moins de confusion. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y a pas de documentation pour ces √©v√©nements, mais gr√¢ce √† l'analyse, j'ai d√©termin√© que ces √©v√©nements sont toujours cr√©√©s par le </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">service d'infrastructure de t√¢ches / courtier en arri√®re</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><em><font style="vertical-align: inherit;">plan</font></em><font style="vertical-align: inherit;"> . Le nom et l'ID de processus du processus correspondant sont indiqu√©s dans le champ FrozenProcessID.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e04/32f/424/e0432f42442fa30ad0f7e6ed77f8d1c2.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âv√©nements ProcessFreeze (√©galement utilis√©s pour le d√©givrage) Il</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
√©tait int√©ressant d'enqu√™ter sur ce fournisseur - il contient de nombreux √©v√©nements prometteurs - mais au final, il s'est av√©r√© que LockApp n'a pas interrompu ni d√©congel√© pendant le tra√ßage. </font><font style="vertical-align: inherit;">Cependant, ce fournisseur semblait assez utile, j'ai donc </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modifi√© UIforETW</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour que les futures versions l'√©crivent toujours.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons d√©j√† tout exclu</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aucune des th√©ories d√©crites ci-dessus ne me semblait tr√®s probable, et maintenant nous les avons toutes exclues. </font><font style="vertical-align: inherit;">J'ai commenc√© √† chercher de l'aide et m'a demand√© de me donner des id√©es d'un ami de Microsoft. </font><font style="vertical-align: inherit;">Et √† ce moment, j'ai d√©couvert que la priorit√© de flux 0-31 si bien connue dans Windows n'est en fait que cinq bits de faible priorit√© d'un </font><font style="vertical-align: inherit;">syst√®me √† priorit√© </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">compl√®te</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisation de la position officielle</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'est av√©r√© que mon ignorance √©tait de ma faute. </font><font style="vertical-align: inherit;">Si je lis attentivement les 108 pages de la section </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Threads</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Internals, 7th Edition, Part 1</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , je comprendrais ce qui se passait. </font><font style="vertical-align: inherit;">Si vous voulez aller de l'avant, ce sujet est r√©v√©l√© aux pages </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">287 √† 295</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce champ super prioritaire que je ne connaissais pas s'appelle </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rank</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il appara√Æt dans WPA comme une colonne cach√©e par d√©faut (pour le trouver, vous devez ouvrir l'√©diteur de vue) appel√© </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewThreadRank</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Lors de la planification des threads, Thread Rank a la priorit√© sur la priorit√©. </font><font style="vertical-align: inherit;">Presque tous les flux ont le rang 0, et un flux avec le rang 0 a toujours une priorit√© plus √©lev√©e qu'un flux avec le rang 2. En incluant une colonne</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewThreadRank</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et en regardant le c√¥t√© gauche du tableau, nous pouvons imm√©diatement voir le probl√®me:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/374/745/f0e/374745f0eeaee797c6a8472f62d5b3f4.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le rang est plus important que la priorit√©</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
. Les flux LockApp.exe ont le rang 2, ce qui signifie que, malgr√© la priorit√© 14, ils ont la priorit√© la plus basse du syst√®me.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une explication presque compl√®te</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puisqu'il s'est av√©r√© que les threads LockApp.exe ont le rang 2, ils ne peuvent √™tre ex√©cut√©s que si </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aucun</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> des threads avec le rang 0 "ne veut" s'ex√©cuter. </font><font style="vertical-align: inherit;">√âtant donn√© que de nombreuses applications (pour des raisons inconnues) rendent activement leurs √©crans invisibles, elles se battent pour chaque miette de temps CPU, ne laissant rien pour les rangs sup√©rieurs. </font><font style="vertical-align: inherit;">Une fois que LockApp.exe re√ßoit une infime fraction du temps CPU, il passe rapidement au rang 0 (et la charge CPU baisse), apr√®s quoi le processus de connexion est effectu√© de la mani√®re habituelle.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ayant appris ces informations, j'ai commenc√© √† √©tudier comment le classement de LockApp change au fil du temps. Au cours des derni√®res secondes, LockApp est soudainement pass√© du rang 0 √† 2 avant de s'endormir. Le rang est con√ßu pour emp√™cher le processeur de prendre trop de temps, comme lorsque </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Photos est trop int√©ress√© par le traitement d'arri√®re-plan ind√©sirable</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et effectue la transition. du rang 2 au 19:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cbc/b93/e8b/cbcb93e8bc2145f78e5ea10edba3fa8e.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft.Photos descend le classement</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
√Ä partir de la documentation, vous pouvez comprendre que l'objectif principal du classement de flux est le partage √©quitable du temps CPU entre les sessions sur la machine afin que les processus d'un utilisateur ne nuisent pas aux autres. Ces deux options d'utilisation de rank indiquent clairement que le rang du thread ne devrait augmenter que s'il utilise beaucoup de temps CPU, et lorsque l'ordinateur portable s'est mis en veille, LockApp.exe n'a utilis√© que 79,3 ms de temps CPU, et le reste du syst√®me - 17 √† partir du temps CPU . N√©anmoins, le syst√®me d'exploitation a d√©cid√© pour une raison quelconque de r√©trograder LockApp √† 2 dans le processus de mise en veille. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'OS ne modifie le rang du flux que s'il appartient au ¬´groupe de planification¬ª ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KSCHEDULING_GROUP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) et la plupart des unit√©s d'ex√©cution d'une installation Windows standard ne sont pas membres. </font><font style="vertical-align: inherit;">Par cons√©quent, la plupart des threads ne sont pas soumis √† un changement de classement, ils peuvent donc passer du temps CPU comme ils le souhaitent.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Puzzles restants</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malheureusement, on ne sait toujours pas pourquoi LockApp.exe passe au rang 2 avant d'activer le mode veille. Je suppose que LockApp est dans le groupe de planification et probablement l'un des algorithmes se comporte incorrectement. Mais je n'ai pas pu trouver d'API pour enqu√™ter sur cela, et le temps commen√ßait √† manquer. Si vous connaissez des d√©tails, √©crivez dans les commentaires de l'article d'origine. Le principe m√™me de l'utilisation du rang comme √©l√©ment le plus important dans les d√©cisions de planification devrait, me semble-t-il, in√©vitablement s'effondrer si la plupart des processus du syst√®me n'y sont pas impliqu√©s - les fils des groupes de planification courent toujours le risque d'√™tre laiss√©s sans les ressources n√©cessaires. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La planification d'allocation des ressources dynamiques</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DFSS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) est vou√©e √† l'√©chec si la plupart des unit√©s d'ex√©cution ne sont pas impliqu√©es.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, je ne sais pas pourquoi tant d'applications restent actives apr√®s s'√™tre endormi. Cela s'explique g√©n√©ralement par le fait que ¬´de nombreux minuteurs s'arr√™tent lorsque l'ordinateur portable est en mode veille pendant plusieurs heures¬ª, mais cette explication ne convient pas si l'ordinateur portable √©tait en r√™ve pendant quelques secondes seulement, et le comportement de rendu WPA indique que quelque chose se passe dans le syst√®me de fen√™tre Quelque chose ne va pas. Ajoutez √† cela les applications √† mauvais comportement et les pilotes de cycle d'attente, et tout est empil√© dans le temps par le CPU.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le fait que la d√©sactivation du processeur et LockApp d√©marrent en m√™me temps conduit √† une explication √©vidente: LockApp ne peut fonctionner que lorsque la demande du processeur diminue. </font><font style="vertical-align: inherit;">Mais il y a une explication tout aussi convaincante: d√®s que LockApp a la possibilit√© de s'ex√©cuter (ou, √©ventuellement, LogonUI l'obtient), la demande de CPU diminue. </font><font style="vertical-align: inherit;">Les deux explications fonctionnent, mais je pense que la seconde est plus plausible, car sinon nous ne pouvons pas expliquer pourquoi le rendu apparemment sans fin de WPA s'arr√™te soudainement.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solution au probl√®me</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√®s que j'ai r√©alis√© que LockApp.exe est une application distincte qui a des probl√®mes de lancement et que l'augmentation de sa priorit√© n'aide pas, je l'ai d√©sactiv√©e. </font><font style="vertical-align: inherit;">Le fichier DisableLockScreen.reg m'a aid√© avec ceci:</font></font><br>
<br>
<blockquote>Windows Registry Editor Version 5.00<br>
[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\Personalization]<br>
‚ÄúNoLockScreen‚Äù=dword:00000001</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En d√©sactivant l'√©cran de verrouillage, l'ordinateur portable se r√©veille imm√©diatement apr√®s avoir ouvert le couvercle. </font><font style="vertical-align: inherit;">Je n'ai remarqu√© ni freinage ni orages du CPU, et maintenant il faut une √©tape de moins pour entrer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">premier message Twitter que</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> j'ai publi√© lorsque j'ai rencontr√© le probl√®me pour la premi√®re fois contient un calendrier pour une enqu√™te qui peut √™tre utile √† quelqu'un. </font><font style="vertical-align: inherit;">De plus, beaucoup de gens intelligents de Twitter sont venus √† la poste, gr√¢ce √† eux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque je suis retourn√© √† l'article, j'ai d√©couvert qu'apr√®s avoir r√©activ√© l'√©cran de verrouillage, le probl√®me avait disparu. </font><font style="vertical-align: inherit;">Un simple red√©marrage n'a pas r√©solu le probl√®me - en f√©vrier, j'ai red√©marr√© plusieurs fois, mais nous ne saurons probablement pas pourquoi il a √©t√© perdu.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Discussions</font></font></h2><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r / programmation</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r / Windows10</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nouvelles des hackers</font></font></a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr498486/index.html">Comment d√©velopper la s√©mantique de langue anglaise pour la publicit√© de recherche dans une niche √©troite</a></li>
<li><a href="../fr498490/index.html">Un syst√®me de certification efficace qui vous permettra de devenir un meilleur leader</a></li>
<li><a href="../fr498492/index.html">Ch√©rie, nous tuons la bureaucratie: comment la num√©risation change le dialogue entre les fournisseurs et X5</a></li>
<li><a href="../fr498494/index.html">JEP 360: types scell√©s (pr√©version)</a></li>
<li><a href="../fr498496/index.html">Annonce du mitap en ligne PiterJS # 46: performances, composants d'interface utilisateur complexes et CSS-in-TS</a></li>
<li><a href="../fr498500/index.html">Que voir en quarantaine? Une s√©lection de mat√©riaux de Technostream (partie 1)</a></li>
<li><a href="../fr498504/index.html">Salutations du Nouvel An et COVID-19: comment les pirates informatiques utilisent les nouvelles</a></li>
<li><a href="../fr498510/index.html">X. Un aper√ßu de la version bo√Æte de la t√©l√©phonie et de la connexion √† un site distant</a></li>
<li><a href="../fr498512/index.html">Lutter contre les embouteillages dans une petite ville pour un petit budget: bilan des 6 mois du projet</a></li>
<li><a href="../fr498516/index.html">Postman - Mesures AutoMetrica dans AppMetrica</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>