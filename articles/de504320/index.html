<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÄÑÔ∏è üå™Ô∏è üö© Einzeiliger Code oder Nethermind-Validierung mit PVS-Studio C # f√ºr Linux üîó üëâüèΩ ü§≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dieser Artikel ist dem Start des PVS-Studio C # Beta-Tests f√ºr Linux sowie des Plug-Ins f√ºr Rider gewidmet. Aus diesem wunderbaren Grund haben wir mit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Einzeiliger Code oder Nethermind-Validierung mit PVS-Studio C # f√ºr Linux</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/504320/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b64/5fc/72d/b645fc72ddcded21612bdc5e9fac2c78.png" alt="Bild 1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Artikel ist dem Start des PVS-Studio C # Beta-Tests f√ºr Linux sowie des Plug-Ins f√ºr Rider gewidmet. </font><font style="vertical-align: inherit;">Aus diesem wunderbaren Grund haben wir mit diesen Tools den Quellcode des Nethermind-Produkts √ºberpr√ºft und in diesem Artikel werden wir interessante und manchmal lustige Fehler untersuchen.</font></font><br>
<a name="habracut"></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nethermind</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist ein schneller Client f√ºr .NET Core Ethereum f√ºr Linux, Windows und MacOs. </font><font style="vertical-align: inherit;">Es kann in Projekten verwendet werden, wenn private Netzwerke von Ethereum oder dApps eingerichtet werden. </font><font style="vertical-align: inherit;">Nethermind ist </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Open Source</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf GitHub. </font><font style="vertical-align: inherit;">Das Projekt wurde 2017 gegr√ºndet und entwickelt sich st√§ndig weiter.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einf√ºhrung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Magst du Handarbeit? Zum Beispiel das Auffinden von Fehlern im Programmcode. Stimmen Sie zu, es ist ziemlich m√ºhsam, die von Ihnen geschriebene Site oder das gesamte Projekt zu lesen und zu analysieren, um nach einem kniffligen Fehler zu suchen. Nun, wenn das Projekt klein ist, sagen wir 5.000 Zeilen, aber wenn seine Gr√∂√üe bereits hunderttausend oder eine Million Zeilen √ºberschritten hat? Dar√ºber hinaus wurde es von verschiedenen Programmierern geschrieben und manchmal nicht in einer sehr leicht verdaulichen Form. Was ist in diesem Fall zu tun? Ist es wirklich notwendig, irgendwo zu schlafen, irgendwo zu untersch√§tzen und 100% Ihrer Zeit zu verbringen, um all diese endlosen Linien zu erkennen, um zu verstehen, wo dieser b√∂se Fehler liegt? Ich bezweifle, dass Sie dies gerne tun w√ºrden. Was tun, vielleicht gibt es moderne Mittel, um dies irgendwie zu automatisieren?</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/34f/9eb/338/34f9eb3387d61eb4ebfa67f0dbccbef7.png" alt="Figur 3"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und dann kommt ein Werkzeug wie ein statischer Code-Analysator ins Spiel. </font><font style="vertical-align: inherit;">Der statische Analysator ist ein Werkzeug zum Erkennen von Fehlern im Quellcode von Programmen. </font><font style="vertical-align: inherit;">Der Vorteil dieses Tools gegen√ºber der manuellen √úberpr√ºfung ist folgender:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie verbringen fast keine Zeit damit, nach dem Ort des Fehlers zu suchen (zumindest ist es definitiv schneller als das Suchen nach dem fehlgeschlagenen Kopieren und Einf√ºgen mit Ihren Augen).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wird nicht m√ºde, im Gegensatz zu einer Person, die nach einiger Zeit der Suche Ruhe braucht;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kennt viele Fehlermuster, die einer Person m√∂glicherweise nicht einmal bewusst sind; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verwendet Technologien wie: Datenflussanalyse, symbolische Ausf√ºhrung, Mustervergleich und andere;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erm√∂glicht es Ihnen, regelm√§√üig und jederzeit zu analysieren;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usw.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Verwendung eines statischen Code-Analysators ersetzt oder bricht nat√ºrlich keine Code√ºberpr√ºfungen ab. </font><font style="vertical-align: inherit;">Code√ºberpr√ºfungen werden jedoch produktiver und n√ºtzlicher. </font><font style="vertical-align: inherit;">Sie k√∂nnen sich darauf konzentrieren, Fehler auf hoher Ebene zu finden, Wissen zu √ºbertragen, anstatt m√ºde zu sein, den Code auf der Suche nach Tippfehlern zu lesen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie mehr dar√ºber lesen m√∂chten, empfehle ich den </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">folgenden Artikel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sowie einen Artikel √ºber die </font><font style="vertical-align: inherit;">in PVS-Studio verwendeten </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Technologien</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio C # f√ºr Linux / macOS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Derzeit portieren wir unseren C # -Analysator auf .NET Core und entwickeln aktiv ein Plug-In f√ºr den IDE Rider. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie interessiert sind, k√∂nnen Sie sich f√ºr einen Betatest anmelden, indem Sie das Formular </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf dieser Seite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ausf√ºllen </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Installationsanweisungen werden an Ihre E-Mail gesendet (keine Sorge, es ist sehr einfach) sowie eine Lizenz zur Verwendung des Analyseger√§ts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So sieht Rider mit dem PVS-Studio-Plugin aus:</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/rp/p6/f_/rpp6f_9oohudg2ov2jt-hdu0yg0.png" alt="Bild 4"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein bisschen Emp√∂rung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich m√∂chte sagen, dass es an einigen Stellen sehr schwierig war, den Quellcode von Nethermind zu lesen, da darin Zeilen mit einer L√§nge von 300-500 Zeichen ganz normal sind. </font><font style="vertical-align: inherit;">Ja, es ist der gesamte Code ohne Formatierung in einer Zeile. </font><font style="vertical-align: inherit;">Und diese Zeilen enthalten zum Beispiel mehrere tern√§re Operatoren und logische Operatoren, und dort ist nichts. </font><font style="vertical-align: inherit;">Im Allgemeinen Genuss ab der letzten Saison des Thronspiels. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde ein wenig erkl√§ren, um den Umfang zu verstehen. </font><font style="vertical-align: inherit;">Ich habe einen UltraWide-Monitor mit einer L√§nge von ca. 82 Zentimetern. </font><font style="vertical-align: inherit;">Wenn Sie die IDE im Vollbildmodus √∂ffnen, passt sie auf ca. 340 Zeichen. </font><font style="vertical-align: inherit;">Das hei√üt, die Zeilen, √ºber die ich spreche, passen nicht einmal. </font><font style="vertical-align: inherit;">Wenn Sie sehen m√∂chten, wie es aussieht, habe ich Links zu Dateien auf GitHub hinterlassen: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel 1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogBlockAuthorNicely</span>(<span class="hljs-params">Block block, ISyncPeer syncPeer</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">string</span> authorString = (block.Author == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : <span class="hljs-string">"sealed by "</span> +<font></font>
(KnownAddresses.GoerliValidators.ContainsKey(block.Author) ?<font></font>
KnownAddresses.GoerliValidators[block.Author] : block.Author?.ToString())) ??<font></font>
(block.Beneficiary == <span class="hljs-literal">null</span> ? <span class="hljs-keyword">string</span>.Empty : <span class="hljs-string">"mined by "</span> +<font></font>
(KnownAddresses.KnownMiners.ContainsKey(block.Beneficiary) ?<font></font>
KnownAddresses.KnownMiners[block.Beneficiary] : block.Beneficiary?.ToString()));<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (_logger.IsInfo) _logger.Info(<span class="hljs-string">$"Discovered a new block
<span class="hljs-subst">{<span class="hljs-keyword">string</span>.Empty.PadLeft(<span class="hljs-number">9</span> - block.Number.ToString().Length, <span class="hljs-string">'
'</span>)}</span><span class="hljs-subst">{block.ToString(Block.Format.HashNumberAndTx)}</span> <span class="hljs-subst">{authorString}</span>, sent by
<span class="hljs-subst">{syncPeer:s}</span>"</span>);<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dateiverkn√ºpfungsbeispiel </font></font></a><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">BuildTransitions</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    releaseSpec.IsEip1283Enabled = (_chainSpec.Parameters.Eip1283Transition ??<font></font>
<span class="hljs-keyword">long</span>.MaxValue) &lt;= releaseStartBlock &amp;&amp;<font></font>
((_chainSpec.Parameters.Eip1283DisableTransition ?? <span class="hljs-keyword">long</span>.MaxValue) <font></font>
&gt; releaseStartBlock || (_chainSpec.Parameters.Eip1283ReenableTransition ??<font></font>
<span class="hljs-keyword">long</span>.MaxValue) &lt;= releaseStartBlock);           <font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link zur Datei</font></font></a><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> 
<span class="hljs-title">Will_not_reject_block_with_bad_total_diff_but_will_reset_diff_to_null</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    _syncServer = <span class="hljs-keyword">new</span> SyncServer(<span class="hljs-keyword">new</span> StateDb(), <span class="hljs-keyword">new</span> StateDb(), localBlockTree,<font></font>
NullReceiptStorage.Instance, <span class="hljs-keyword">new</span> BlockValidator(Always.Valid, <span class="hljs-keyword">new</span><font></font>
HeaderValidator(localBlockTree, Always.Valid, MainnetSpecProvider.Instance,<font></font>
LimboLogs.Instance), Always.Valid, MainnetSpecProvider.Instance, <font></font>
LimboLogs.Instance), Always.Valid, _peerPool, StaticSelector.Full, <font></font>
<span class="hljs-keyword">new</span> SyncConfig(), LimboLogs.Instance);<font></font>
    ...     <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link zur Datei</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Stellen Sie sich nun vor, dass in einem solchen Abschnitt ein Fehler auftritt. Ist es angenehm, danach zu suchen? </font><font style="vertical-align: inherit;">Ich bin mir sicher, dass dies nicht der Fall ist, und jeder versteht, dass es unm√∂glich ist, so zu schreiben. </font><font style="vertical-align: inherit;">√úbrigens gibt es in diesem Projekt einen √§hnlichen Ort mit einem Fehler.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Validierungsergebnisse</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bedingungen, die 0 nicht m√∂gen</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bedingung 1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> ReceiptsMessage <span class="hljs-title">Deserialize</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] bytes</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (bytes.Length == <span class="hljs-number">0</span> &amp;&amp; bytes[<span class="hljs-number">0</span>] == Rlp.OfEmptySequence[<span class="hljs-number">0</span>])
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ReceiptsMessage(<span class="hljs-literal">null</span>);<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warnung: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3106</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> M√∂glicherweise ist der Index nicht gebunden. </font><font style="vertical-align: inherit;">Der '0'-Index zeigt √ºber die gebundenen' Bytes 'hinaus. </font><font style="vertical-align: inherit;">Nethermind.Network ReceiptsMessageSerializer.cs 50 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um einen Fehler zu bemerken, betrachten Sie den Fall, in dem die Anzahl der Elemente im Array 0 betr√§gt. Dann ist die Bedingung </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bytes.Length == 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erf√ºllt </font><font style="vertical-align: inherit;">und beim Zugriff auf das Array-Element wird eine </font><i><font style="vertical-align: inherit;">indexOutOfRangeException vom Typ 0 </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ausgel√∂st</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie wollten diese Methode sofort beenden, wenn das Array leer ist oder das 0-Element einem bestimmten Wert entspricht, aber es scheint, dass sie versehentlich "||" verwechselt haben. </font><font style="vertical-align: inherit;">mit "&amp;&amp;". </font><font style="vertical-align: inherit;">Ich schlage vor, dieses Problem wie folgt zu beheben:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> ReceiptsMessage <span class="hljs-title">Deserialize</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] bytes</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (bytes.Length == <span class="hljs-number">0</span> || bytes[<span class="hljs-number">0</span>] == Rlp.OfEmptySequence[<span class="hljs-number">0</span>])
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ReceiptsMessage(<span class="hljs-literal">null</span>);<font></font>
    ...<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bedingung 2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DiscoverAll</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    Type? GetStepType(Type[] typesInGroup)<font></font>
    {<font></font>
        Type? GetStepTypeRecursive(Type? contextType)<font></font>
        {<font></font>
            ...<font></font>
        }<font></font>
        ...<font></font>
        <span class="hljs-keyword">return</span> typesInGroup.Length == <span class="hljs-number">0</span> ? typesInGroup[<span class="hljs-number">0</span>] :<font></font>
               GetStepTypeRecursive(_context.GetType());<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warnung: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3106</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> M√∂glicherweise ist der Index nicht gebunden. </font><font style="vertical-align: inherit;">Der '0'-Index zeigt √ºber die gebundene' typesInGroup'-Grenze hinaus. </font><font style="vertical-align: inherit;">Nethermind.Runner EthereumStepsManager.cs 70 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine √§hnliche Situation wie oben beschrieben tritt auf. </font><font style="vertical-align: inherit;">Wenn die Anzahl der Elemente in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typesInGroup</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gleich 0 ist, wird beim Zugriff auf das 0-Element eine Ausnahme vom Typ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexOutOfRangeException ausgel√∂st</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nur in diesem Fall verstehe ich nicht, was der Entwickler wollte. </font><font style="vertical-align: inherit;">Anstelle von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typesInGroup [0] m√ºssen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie </font><font style="vertical-align: inherit;">h√∂chstwahrscheinlich </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> schreiben </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fehler oder unvollendete Optimierung?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DeleteBlocks</span>(<span class="hljs-params">Keccak deletePointer</span>)</span><font></font>
{<font></font>
   ...<font></font>
   <span class="hljs-keyword">if</span> (currentLevel.BlockInfos.Length == <span class="hljs-number">1</span>)<font></font>
   {<font></font>
      shouldRemoveLevel = <span class="hljs-literal">true</span>;<font></font>
   }<font></font>
   <span class="hljs-keyword">else</span><font></font>
   {<font></font>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; currentLevel.BlockInfos.Length; i++)<font></font>
      {<font></font>
         <span class="hljs-keyword">if</span> (currentLevel.BlockInfos[<span class="hljs-number">0</span>].BlockHash == currentHash) <span class="hljs-comment">// &lt;=</span><font></font>
         {<font></font>
            currentLevel.BlockInfos = currentLevel.BlockInfos<font></font>
                                      .Where(bi =&gt; bi.BlockHash != currentHash)<font></font>
                                      .ToArray();<font></font>
            <span class="hljs-keyword">break</span>;<font></font>
         }<font></font>
      }<font></font>
   }<font></font>
   ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warnung: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3102</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Verd√§chtiger Zugriff auf das Element des Objekts 'currentLevel.BlockInfos' durch einen konstanten Index innerhalb einer Schleife. Nethermind.Blockchain BlockTree.cs 895 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf den </font><font style="vertical-align: inherit;">ersten Blick ist </font><font style="vertical-align: inherit;">der Fehler offensichtlich - die Schleife angestrebt wird </font><font style="vertical-align: inherit;">Iterieren √ºber die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentLevel.BlockInfos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Elemente </font><font style="vertical-align: inherit;">, aber beim Zugriff auf </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentLevel.BlockInfos [i], sie</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> schrieb </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentLevel.BlockInfos [0]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Wir setzen 0 auf </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und die Mission ist abgeschlossen. Aber beeil dich nicht, lass es uns herausfinden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, wir </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L√§nge</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Zugang der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BlockHash des</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nullelement. Wenn es gleich </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentHash ist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nehmen wir aus </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentLevel.BlockInfos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> alle Elemente, die nicht gleich sind</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentHash</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , schreibe darauf und verlasse die Schleife. </font><font style="vertical-align: inherit;">Es stellt sich heraus, dass der Zyklus √ºberfl√ºssig ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich denke, dass es fr√ºher einen Algorithmus gab, den sie mit </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">linq</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √§ndern / optimieren </font><i><font style="vertical-align: inherit;">wollten</font></i><font style="vertical-align: inherit;"> , aber etwas ist schief gelaufen. </font><font style="vertical-align: inherit;">In dem Fall, in dem die Bedingung falsch ist, erhalten wir bedeutungslose Iterationen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√úbrigens, wenn der Entwickler, der dies geschrieben hat, den </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inkrementellen Analysemodus verwenden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> w√ºrde, w√ºrde er sofort erkennen, dass etwas falsch gewesen w√§re und alles schnell behoben h√§tte. </font><font style="vertical-align: inherit;">Im Moment w√ºrde ich den Code folgenderma√üen umschreiben:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DeleteBlocks</span>(<span class="hljs-params">Keccak deletePointer</span>)</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (currentLevel.BlockInfos.Length == <span class="hljs-number">1</span>)<font></font>
    {<font></font>
        shouldRemoveLevel = <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        currentLevel.BlockInfos = currentLevel.BlockInfos<font></font>
                                  .Where(bi =&gt; bi.BlockHash != currentHash)<font></font>
                                  .ToArray();<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dereferenzierung der Nullreferenz</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dereferenzierung 1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Sign</span>(<span class="hljs-params">Transaction tx, <span class="hljs-keyword">int</span> chainId</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsDebug)<font></font>
        _logger?.Debug(<span class="hljs-string">$"Signing transaction: <span class="hljs-subst">{tx.Value}</span> to <span class="hljs-subst">{tx.To}</span>"</span>);<font></font>
    IBasicWallet.Sign(<span class="hljs-keyword">this</span>, tx, chainId);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warnung: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Das Objekt '_logger' wurde verwendet, bevor es gegen null verifiziert wurde. √úberpr√ºfen Sie die Zeilen: 118, 118. Nethermind.Wallet DevKeyStoreWallet.cs 118 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fehler in der falschen Reihenfolge. Zuerst gibt es einen Appell an </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_logger.IsDebug</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und erst danach ist </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_logger gepr√ºft</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> f√ºr </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dementsprechend wird in dem Fall , </font><font style="vertical-align: inherit;">wenn </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_logger</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , wir eine Ausnahme vom Typ erhalten </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nullreferenceexception</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dereferenzierung 2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">BuildNodeInfo</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    _nodeInfo = <span class="hljs-keyword">new</span> NodeInfo();<font></font>
    _nodeInfo.Name = ClientVersion.Description;<font></font>
    _nodeInfo.Enode = _enode.Info;                           <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">byte</span>[] publicKeyBytes = _enode?.PublicKey?.Bytes;        <span class="hljs-comment">// &lt;=</span>
    _nodeInfo.Id = (publicKeyBytes == <span class="hljs-literal">null</span> ? Keccak.Zero :<font></font>
                   Keccak.Compute(publicKeyBytes)).ToString(<span class="hljs-literal">false</span>);<font></font>
    _nodeInfo.Ip = _enode?.HostIp?.ToString();<font></font>
    _nodeInfo.ListenAddress = <span class="hljs-string">$"<span class="hljs-subst">{_enode.HostIp}</span>:<span class="hljs-subst">{_enode.Port}</span>"</span>;<font></font>
    _nodeInfo.Ports.Discovery = _networkConfig.DiscoveryPort;<font></font>
    _nodeInfo.Ports.Listener = _networkConfig.P2PPort;<font></font>
    UpdateEthProtocolInfo();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warnung: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Das Objekt '_enode' wurde verwendet, bevor es gegen null verifiziert wurde. </font><font style="vertical-align: inherit;">√úberpr√ºfen Sie die Zeilen: 55, 56. Nethermind.JsonRpc AdminModule.cs 55 Der </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fehler ist vollst√§ndig der gleiche wie oben beschrieben, nur dass diesmal der Schuldige </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_enode ist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich m√∂chte hinzuf√ºgen, dass Sie, wenn Sie vergessen haben, nach Null zu suchen, dies nur dann merken, wenn Ihr Programm abst√ºrzt. </font><font style="vertical-align: inherit;">Der Analysator wird Sie daran erinnern und alles wird gut.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unser Lieblings-Copy-Paste</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fall 1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Equals</span>(<span class="hljs-params"><span class="hljs-keyword">ref</span> UInt256 a, <span class="hljs-keyword">ref</span> UInt256 b</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">return</span> a.s0 == b.s0 &amp;&amp; a.s1 == b.s1 &amp;&amp; a.s2 == b.s2 &amp;&amp; a.s2 == b.s2;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warnung: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3001</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Links und rechts vom Operator '&amp;&amp;' befinden sich identische Unterausdr√ºcke 'a.s2 == b.s2'. </font><font style="vertical-align: inherit;">Nethermind.Dirichlet.Numerics UInt256.cs 1154 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier wird der gleiche Zustand zweimal √ºberpr√ºft:</font></font><br>
<br>
<pre><code class="cs hljs">a.s2 == b.s2</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da die Parameter </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ein Feld </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s3 haben</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><i><font style="vertical-align: inherit;">gehe</font></i><font style="vertical-align: inherit;"> ich davon aus, dass wir beim Kopieren einfach vergessen haben, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s3</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zu √§ndern </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es stellt sich heraus, dass die Parameter h√§ufiger gleich sind als vom Autor des Codes erwartet. Gleichzeitig denken einige Entwickler, dass sie dies nicht tun, und beginnen, an einem v√∂llig anderen Ort nach einem Fehler zu suchen, wobei sie viel Energie und Nerven aufwenden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fehler in Vergleichsfunktionen sind √ºbrigens in der Regel ein Klassiker. Anscheinend beziehen sich Programmierer, die solche Funktionen f√ºr einfach halten, sehr beil√§ufig und unaufmerksam auf ihr Schreiben. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beweis</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Wenn du das wei√üt, sei jetzt vorsichtig :)! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fall 2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;ApiResponse&gt; 
<span class="hljs-title">PublishBlockAsync</span>(<span class="hljs-params">SignedBeaconBlock signedBlock,
                  CancellationToken cancellationToken</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">bool</span> acceptedLocally = <span class="hljs-literal">false</span>;<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (acceptedLocally)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ApiResponse(StatusCode.Success);<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ApiResponse(StatusCode.Success);<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warnung: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3004</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Die Anweisung 'then' entspricht der Anweisung 'else'. Nethermind.BeaconNode BeaconNodeFacade.cs 177 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
f√ºr einen </font><font style="vertical-align: inherit;">beliebigen Wert der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acceptedLocally</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Variable, der </font><font style="vertical-align: inherit;">kehrt Verfahren das gleiche. Es ist schwer zu sagen, ob es ein Fehler ist oder nicht. Angenommen, ein Programmierer hat eine Zeile kopiert und vergessen, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StatusCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zu √§ndern. </font><i><font style="vertical-align: inherit;">Wenn Sie</font></i><font style="vertical-align: inherit;"> auf etwas anderes </font><i><font style="vertical-align: inherit;">zugreifen</font></i><font style="vertical-align: inherit;"> , ist dies ein echter Fehler. Dar√ºber hinaus verf√ºgt der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StatusCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √ºber einen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InternalError</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidRequest</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Aber das Code-Refactoring ist wahrscheinlich schuld und wir k√ºmmern uns sowieso nicht um den </font><i><font style="vertical-align: inherit;">akzeptierten</font></i><font style="vertical-align: inherit;"> lokalen Wert</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In diesem Fall wird der Zustand zum Ort, an dem Sie sitzen und √ºberlegen, ob es sich um einen Fehler handelt oder nicht. </font><font style="vertical-align: inherit;">In jedem Fall ist dieser Fall √§u√üerst unangenehm. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fall 3</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">TearDown</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> testResult <span class="hljs-keyword">in</span> _results)<font></font>
    {<font></font>
         <span class="hljs-keyword">string</span> message = <span class="hljs-string">$"<span class="hljs-subst">{testResult.Order}</span>. <span class="hljs-subst">{testResult.Name}</span> has "</span> 
               + <span class="hljs-string">$"<span class="hljs-subst">{(testResult.Passed ? <span class="hljs-string">"passed [+]"</span> : <span class="hljs-string">"failed [-]"</span>)}</span>"</span>;
         <span class="hljs-keyword">if</span> (testResult.Passed)<font></font>
         {<font></font>
               TestContext.WriteLine(message);<font></font>
         }<font></font>
         <span class="hljs-keyword">else</span><font></font>
         {<font></font>
               TestContext.WriteLine(message);<font></font>
         }<font></font>
     }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warnung: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3004</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Die Anweisung 'then' entspricht der Anweisung 'else'. </font><font style="vertical-align: inherit;">Nethermind.Overseer.Test TestBuilder.cs 46 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wieder k√ºmmern wir uns nicht um die √úberpr√ºfung, weil wir am Ende das Gleiche bekommen. </font><font style="vertical-align: inherit;">Und wieder sitzen wir und leiden und denken, aber was wollte der Entwickler hier schreiben? </font><font style="vertical-align: inherit;">Eine Zeitverschwendung, die durch statische Analyse und sofortige Korrektur eines solchen mehrdeutigen Codes h√§tte vermieden werden k√∂nnen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fall 4</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Setup</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_decoderBuffer.ReadableBytes &gt; <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"decoder buffer"</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (_decoderBuffer.ReadableBytes &gt; <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"decoder buffer"</span>);<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warnung: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3021</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Es gibt zwei if-Anweisungen mit identischen bedingten Ausdr√ºcken. Die erste 'if'-Anweisung enth√§lt die Methodenr√ºckgabe. Dies bedeutet , </font><font style="vertical-align: inherit;">dass die zweite ‚Äöif‚Äò Anweisung ist sinnlos Nethermind.Network.Benchmark InFlowBenchmarks.cs 55 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dr√ºcken Sie </font><font style="vertical-align: inherit;">einfach </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Strg + V</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wieder </font><font style="vertical-align: inherit;">. Wir entfernen den √ºbersch√ºssigen Scheck und alles ist in Ordnung. Ich bin sicher , </font><font style="vertical-align: inherit;">dass , </font><font style="vertical-align: inherit;">wenn eine andere Bedingung hier wichtig waren, dann alle in einem schreiben w√ºrde , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wenn</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> durch den logischen Operator I. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fall 5</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogBlockAuthorNicely</span>(<span class="hljs-params">Block block, ISyncPeer syncPeer</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
        {<font></font>
            ...<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warnung: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3030</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wiederkehrende Pr√ºfung. </font><font style="vertical-align: inherit;">Die Bedingung '_logger.IsInfo' wurde bereits in Zeile 242 √ºberpr√ºft. Nethermind.Synchronization SyncServer.cs 244 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf die gleiche Weise wie im vierten Fall wird eine zus√§tzliche Pr√ºfung durchgef√ºhrt. </font><font style="vertical-align: inherit;">Der Unterschied besteht jedoch darin, dass </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_logger</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nicht nur eine Eigenschaft hat, sondern beispielsweise auch ' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bool IsError {get; </font><font style="vertical-align: inherit;">}</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '. </font><font style="vertical-align: inherit;">Daher sollte der Code wahrscheinlich folgenderma√üen aussehen:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogBlockAuthorNicely</span>(<span class="hljs-params">Block block, ISyncPeer syncPeer</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (!_logger.IsError) <span class="hljs-comment">// &lt;=</span><font></font>
        {<font></font>
            ...<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, oder alle Fehler des Code-Refactorings und nur eine √úberpr√ºfung sind nicht mehr erforderlich. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fall 6</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (missingParamsCount != <span class="hljs-number">0</span>)<font></font>
{<font></font>
    <span class="hljs-keyword">bool</span> incorrectParametersCount = missingParamsCount != <span class="hljs-number">0</span>; <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">if</span> (missingParamsCount &gt; <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warnung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">V3022 Der</font></a><font style="vertical-align: inherit;"> Ausdruck 'missingParamsCount! = 0' ist immer wahr. </font><font style="vertical-align: inherit;">Nethermind.JsonRpc JsonRpcService.cs 127 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√úberpr√ºfen Sie die Bedingung (missingParamsCount! = 0). Wenn sie wahr ist, berechnen wir sie erneut und weisen das Ergebnis einer Variablen zu. </font><font style="vertical-align: inherit;">Stimmen Sie zu, dass dies eine ziemlich originelle Art ist, wahr zu schreiben.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verwirrende Pr√ºfung</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-keyword">long</span>&gt; 
<span class="hljs-title">DownloadHeaders</span>(<span class="hljs-params">PeerInfo bestPeer, 
                BlocksRequest blocksRequest, 
                CancellationToken cancellation</span>)</span><font></font>
{<font></font>
  ...<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; headers.Length; i++)<font></font>
  {<font></font>
    ...<font></font>
    BlockHeader currentHeader = headers[i];<font></font>
    ...<font></font>
    <span class="hljs-keyword">bool</span> isValid = i &gt; <span class="hljs-number">1</span> ? <font></font>
        _blockValidator.ValidateHeader(currentHeader, headers[i - <span class="hljs-number">1</span>], <span class="hljs-literal">false</span>):<font></font>
        _blockValidator.ValidateHeader(currentHeader, <span class="hljs-literal">false</span>);<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (HandleAddResult(bestPeer, <font></font>
                        currentHeader, <font></font>
                        i == <span class="hljs-number">0</span>,                              <span class="hljs-comment">// &lt;=</span><font></font>
                        _blockTree.Insert(currentHeader))) <font></font>
    {<font></font>
       headersSynced++;<font></font>
    }<font></font>
<font></font>
    ...<font></font>
  }<font></font>
  ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warnung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">V3022 Der</font></a><font style="vertical-align: inherit;"> Ausdruck 'i == 0' ist immer falsch. </font><font style="vertical-align: inherit;">Nethermind.Synchronization BlockDownloader.cs 192 Beginnen </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
wir in der </font><font style="vertical-align: inherit;">richtigen </font><font style="vertical-align: inherit;">Reihenfolge. </font><font style="vertical-align: inherit;">Bei der Initialisierung wird der Variablen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> der Wert 1 zugewiesen. Als n√§chstes wird die Variable nur inkrementiert, daher wird der Wert immer an die Funktion </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false √ºbergeben</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns nun </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HandleAddResult an</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">HandleAddResult</span>(<span class="hljs-params">PeerInfo peerInfo, 
                             BlockHeader block,
                             <span class="hljs-keyword">bool</span> isFirstInBatch, 
                             AddBlockResult addResult</span>)</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (isFirstInBatch)<font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier interessiert uns </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isFirstInBatch</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Nach dem Namen dieses Parameters zu urteilen, ist er daf√ºr verantwortlich, ob etwas das erste in der Partei ist. </font><font style="vertical-align: inherit;">Hm, zuerst. </font><font style="vertical-align: inherit;">Schauen wir noch einmal oben nach und sehen, dass es 2 Aufrufe mit </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i gibt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs">BlockHeader currentHeader = headers[i];<font></font>
_blockValidator.ValidateHeader(currentHeader, headers[i - <span class="hljs-number">1</span>], <span class="hljs-literal">false</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vergessen Sie nicht, dass in diesem Fall die Z√§hlung bei 1 liegt. Es stellt sich heraus, dass wir zwei Optionen haben: Entweder bedeutet "first" ein Element bei Index 1 oder unter dem Symbol 0. In jedem Fall ist </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gleichzeitig gleich 1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es stellt sich heraus, dass Der Funktionsaufruf sollte folgenderma√üen aussehen:</font></font><br>
<br>
<pre><code class="cs hljs">HandleAddResult(bestPeer, currentHeader, <font></font>
                i == <span class="hljs-number">1</span>, _blockTree.Insert(currentHeader))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oder so:</font></font><br>
<br>
<pre><code class="cs hljs">HandleAddResult(bestPeer, currentHeader, <font></font>
                i - <span class="hljs-number">1</span> == <span class="hljs-number">0</span>, _blockTree.Insert(currentHeader))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wieder, wenn ein Entwickler st√§ndig einen statischen Analysator verwendet, w√ºrde er diesen Code schreiben und eine Warnung sehen, ihn schnell beheben und das Leben genie√üen. </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine Priorit√§t ??</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Situation 1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> MemorySize<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">int</span> unaligned = (Keccak == <span class="hljs-literal">null</span> ? MemorySizes.RefSize : <font></font>
        MemorySizes.RefSize + Keccak.MemorySize) <font></font>
        + (MemorySizes.RefSize + FullRlp?.Length <font></font>
                                 ?? MemorySizes.ArrayOverhead)   <span class="hljs-comment">// &lt;=</span><font></font>
        + (MemorySizes.RefSize + _rlpStream?.MemorySize <font></font>
                                 ?? MemorySizes.RefSize)         <span class="hljs-comment">// &lt;=</span><font></font>
        + MemorySizes.RefSize + (MemorySizes.ArrayOverhead + _data?.Length <font></font>
        * MemorySizes.RefSize ?? MemorySizes.ArrayOverhead) <font></font>
        + MemorySizes.SmallObjectOverhead + (Key?.MemorySize ?? <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> MemorySizes.Align(unaligned);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio-Warnungen: </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123 Vielleicht das '??' </font><font style="vertical-align: inherit;">Der Bediener arbeitet anders als erwartet. </font><font style="vertical-align: inherit;">Ihre Priorit√§t ist niedriger als die Priorit√§t anderer Betreiber im linken Teil. </font><font style="vertical-align: inherit;">Nethermind.Trie TrieNode.cs 43</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123 Vielleicht das '??' </font><font style="vertical-align: inherit;">Der Bediener arbeitet anders als erwartet. </font><font style="vertical-align: inherit;">Ihre Priorit√§t ist niedriger als die Priorit√§t anderer Betreiber im linken Teil. </font><font style="vertical-align: inherit;">Nethermind.Trie TrieNode.cs 44</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Analysator empfiehlt Ihnen, zu √ºberpr√ºfen, wie wir die Operatoren "??" verwenden, und um das Problem zu verstehen, schlage ich vor, die folgende Situation zu ber√ºcksichtigen. </font><font style="vertical-align: inherit;">Wir sehen uns diese Zeile hier an:</font></font><br>
<br>
<pre><code class="cs hljs">(MemorySizes.RefSize + FullRlp?.Length ?? MemorySizes.ArrayOverhead)</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.RefSize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.ArrayOverhead</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sind Konstanten:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MemorySizes</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> RefSize = <span class="hljs-number">8</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> ArrayOverhead = <span class="hljs-number">20</span>;<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus Gr√ºnden der √úbersichtlichkeit schlage ich daher vor, die Zeichenfolge neu zu schreiben und ihre Werte zu ersetzen:</font></font><br>
<br>
<pre><code class="cs hljs">(<span class="hljs-number">8</span> + FullRlp?.Length ?? <span class="hljs-number">20</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Angenommen, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FullRlp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dann ist </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(8 + null)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> null </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Als n√§chstes erhalten wir den Ausdruck ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null ?? 20</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), der </font><i><font style="vertical-align: inherit;">20 </font></i><i><font style="vertical-align: inherit;">zur√ºckgibt</font></i><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es stellt sich heraus, dass </font><font style="vertical-align: inherit;">der Wert von </font><i><font style="vertical-align: inherit;">MemorySizes.ArrayOverhead</font></i><font style="vertical-align: inherit;"> immer zur√ºckgegeben wird, </font><font style="vertical-align: inherit;">unabh√§ngig davon, was in </font><i><font style="vertical-align: inherit;">MemorySizes.RefSize</font></i><font style="vertical-align: inherit;"> gespeichert ist </font><font style="vertical-align: inherit;">, vorausgesetzt, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FullRlp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null </font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">.</font></i><font style="vertical-align: inherit;"> Das Fragment in der Zeile darunter ist √§hnlich. </font><font style="vertical-align: inherit;">
Aber die Frage ist, wollte der Entwickler dieses Verhalten? Schauen wir uns die folgende Zeile an:</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs">MemorySizes.RefSize + (MemorySizes.ArrayOverhead <font></font>
    + _data?.Length * MemorySizes.RefSize ?? MemorySizes.ArrayOverhead) </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier wird, wie in den oben betrachteten Abschnitten, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.RefSize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zum Ausdruck hinzugef√ºgt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beachten Sie </font><font style="vertical-align: inherit;">jedoch </font><font style="vertical-align: inherit;">, dass nach dem ersten "+" - Operator eine Klammer steht. </font><font style="vertical-align: inherit;">Es stellt sich heraus, dass </font><font style="vertical-align: inherit;">wir </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.RefSize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> einen Ausdruck </font><i><font style="vertical-align: inherit;">hinzuf√ºgen sollten</font></i><font style="vertical-align: inherit;"> , und wenn es </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null ist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , werden wir einen weiteren hinzuf√ºgen. </font><font style="vertical-align: inherit;">Der Code sollte also so aussehen:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> MemorySize<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">int</span> unaligned = (Keccak == <span class="hljs-literal">null</span> ? MemorySizes.RefSize : <font></font>
       MemorySizes.RefSize + Keccak.MemorySize) <font></font>
       + (MemorySizes.RefSize + (FullRlp?.Length <font></font>
                                 ?? MemorySizes.ArrayOverhead))    <span class="hljs-comment">// &lt;=</span><font></font>
       + (MemorySizes.RefSize + (_rlpStream?.MemorySize <font></font>
                                 ?? MemorySizes.RefSize))          <span class="hljs-comment">// &lt;=</span><font></font>
       + MemorySizes.RefSize + (MemorySizes.ArrayOverhead + _data?.Length <font></font>
       * MemorySizes.RefSize ?? MemorySizes.ArrayOverhead) <font></font>
       + MemorySizes.SmallObjectOverhead + (Key?.MemorySize ?? <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> MemorySizes.Align(unaligned);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auch dies ist nur eine Annahme. Wenn der Entwickler jedoch ein anderes Verhalten w√ºnscht, sollten Sie dies explizit angeben:</font></font><br>
<br>
<pre><code class="cs hljs">((MemorySizes.RefSize + FullRlp?.Length) ?? MemorySizes.ArrayOverhead)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und dann m√ºsste derjenige, der diesen Code liest, nicht lange dar√ºber nachdenken, was hier passiert und was der Programmierer wollte. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Situation 2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task&lt;JsonRpcResponse&gt; 
<span class="hljs-title">ExecuteAsync</span>(<span class="hljs-params">JsonRpcRequest request, 
             <span class="hljs-keyword">string</span> methodName,
             (MethodInfo Info, <span class="hljs-keyword">bool</span> ReadOnly</span>) method)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> expectedParameters = method.Info.GetParameters();
    <span class="hljs-keyword">var</span> providedParameters = request.Params;<font></font>
    ...<font></font>
    <span class="hljs-keyword">int</span> missingParamsCount = expectedParameters.Length <font></font>
            - (providedParameters?.Length ?? <span class="hljs-number">0</span>) <font></font>
            + providedParameters?.Count(<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace) ?? <span class="hljs-number">0</span>; <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">if</span> (missingParamsCount != <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warnung: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vielleicht das '??' </font><font style="vertical-align: inherit;">Der Bediener arbeitet anders als erwartet. </font><font style="vertical-align: inherit;">Ihre Priorit√§t ist niedriger als die Priorit√§t anderer Betreiber im linken Teil. </font><font style="vertical-align: inherit;">Nethermind.JsonRpc JsonRpcService.cs 123 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wieder ist die Priorit√§t der Operation "??", daher betrachten wir wie beim letzten Mal die Situation. </font><font style="vertical-align: inherit;">Wir sehen uns diese Zeile hier an:</font></font><br>
<br>
<pre><code class="cs hljs">expectedParameters.Length <font></font>
            - (providedParameters?.Length ?? <span class="hljs-number">0</span>) <font></font>
            + providedParameters?.Count(<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace) ?? <span class="hljs-number">0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Angenommen, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bereitgestellte</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parameter </font><font style="vertical-align: inherit;">sind </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ersetzen Sie aus Gr√ºnden der √úbersichtlichkeit sofort alles, was mit </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bereitgestellten </font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parametern zusammenh√§ngt,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> durch </font><i><font style="vertical-align: inherit;">null</font></i><font style="vertical-align: inherit;"> und </font><font style="vertical-align: inherit;">ersetzen Sie einen zuf√§lligen Wert </font><font style="vertical-align: inherit;">anstelle von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erwarteten</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parametern. </font><i><font style="vertical-align: inherit;">L√§nge</font></i><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-number">100</span> - (<span class="hljs-literal">null</span> ?? <span class="hljs-number">0</span>) + <span class="hljs-literal">null</span> ?? <span class="hljs-number">0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt f√§llt sofort auf, dass es zwei √§hnliche Pr√ºfungen gibt, nur in einem Fall gibt es Klammern und in dem anderen. Lassen Sie uns dieses Beispiel ausf√ºhren. Zuerst erhalten wir, dass ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null ?? 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 0 zur√ºckgibt, dann 0 von 100 subtrahiert und 100 erh√§lt:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-number">100</span> + <span class="hljs-literal">null</span> ?? <span class="hljs-number">0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anstatt zuerst " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null ?? 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font><font style="vertical-align: inherit;">auszuf√ºhren </font><font style="vertical-align: inherit;">und schlie√ülich ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100 + 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) zu erhalten, werden wir v√∂llig anders. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuerst wird es ausgef√ºhrt ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100 + null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) und wir erhalten </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dann pr√ºft es ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null ?? 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), was dazu f√ºhrt, dass der Wert der Variablen "yingParamsCount "0 ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da die n√§chste Bedingung darin besteht, dass" </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">missingParamsCount "gleich</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Null ist, k√∂nnen wir davon ausgehen, dass der Entwickler dieses Verhalten gesucht hat. Und ich werde sagen, warum nicht Klammern setzen und meine Gedanken explizit ausdr√ºcken? Im Allgemeinen ist es m√∂glich, dass diese √úberpr√ºfung auf ein Missverst√§ndnis zur√ºckzuf√ºhren ist, warum manchmal 0 zur√ºckgegeben wird, und dies ist nichts weiter als eine Kr√ºcke.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wieder verschwenden wir Zeit, obwohl wir dies m√∂glicherweise nicht getan haben. Verwenden Sie beim Schreiben von Code den </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inkrementellen Analysemodus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abschlie√üend hoffe ich, dass ich Ihnen vermitteln konnte, dass der statische Analysator Ihr Freund ist und kein b√∂ser Aufseher, der nur darauf wartet, dass Sie einen Fehler machen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es sollte auch beachtet werden, dass Sie bei einmaliger oder seltener Verwendung des Analyseger√§ts nat√ºrlich Fehler finden und einige davon sogar schnell behoben werden k√∂nnen, aber es gibt auch Fehler, bei denen Sie sich den Kopf zerschlagen m√ºssen. </font><font style="vertical-align: inherit;">Daher m√ºssen Sie st√§ndig einen statischen Analysator verwenden. </font><font style="vertical-align: inherit;">Dann werden Sie viele weitere Fehler finden und diese korrigieren, sobald der Programmcode geschrieben ist und Sie genau verstehen, was Sie versuchen zu tun.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die einfache Wahrheit ist, dass jeder Fehler macht und das ist normal. </font><font style="vertical-align: inherit;">Wir alle lernen aus Fehlern, aber nur aus denen, die es bemerken und verstehen konnten. </font><font style="vertical-align: inherit;">Verwenden Sie daher moderne Tools, um nach genau diesen Fehlern zu suchen, z. B. PVS-Studio. </font><font style="vertical-align: inherit;">Vielen Dank f√ºr Ihre Aufmerksamkeit.</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a></p><div style="text-align:center;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/eb2/f9c/3bb/eb2f9c3bb5f32f39239298d36431961c.png"></a></div><p></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie diesen Artikel einem englischsprachigen Publikum zug√§nglich machen m√∂chten, verwenden Sie bitte den Link zur √úbersetzung: Nikolay Mironov. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einzeiliger Code oder √úberpr√ºfung von Nethermind mit PVS-Studio C # f√ºr Linux</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de504296/index.html">Zuf√§llige Verzweigungen in Python generieren</a></li>
<li><a href="../de504306/index.html">Wie wird russische Hardware f√ºr die Speicherung von Aerodisk Vostok auf Elbrus hergestellt?</a></li>
<li><a href="../de504310/index.html">Dichotomie von Daten: √úberdenken der Beziehung zu Daten und Diensten</a></li>
<li><a href="../de504312/index.html">Einheitliches Register der russischen Programme und der GPL. Meine f√ºnf Cent</a></li>
<li><a href="../de504314/index.html">Implementierung von Docker Pull- und Docker Push-Befehlen ohne Docker-Client √ºber HTTP-Anforderungen</a></li>
<li><a href="../de504326/index.html">Evgeny Dikiy: ‚ÄûVor Ort war die Antarktis am wenigsten verschmutzt, aber die globale Verschmutzung ist hier sehr auff√§llig.‚Äú</a></li>
<li><a href="../de504328/index.html">Elektronischer Wahlunterricht in der Moskauer Stadtduma 2019</a></li>
<li><a href="../de504334/index.html">–ù–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–æ –≤—ã –∑–Ω–∞–µ—Ç–µ JavaScript?</a></li>
<li><a href="../de504344/index.html">Authentifizierung - CUSTOM SETUP / AWS Amplify + React Native</a></li>
<li><a href="../de504348/index.html">Monorad: Was passiert w√§hrend des Trainings und wie kann dieser Prozess beschleunigt werden?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>