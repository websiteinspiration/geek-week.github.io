<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏴󠁧󠁢󠁷󠁬󠁳󠁿 👨🏿‍🤝‍👨🏻 🧙🏼 Service Locator - Dispelling Myths 👨🏾‍🎓 👨🏾‍🚀 👐🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It is amazing how a practice demonstrating good performance and usability for one platform is demonized in a camp of adherents of another platform. Th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Service Locator - Dispelling Myths</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498194/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/q0/yb/tf/q0ybtf5xhq0ygzxuevhduuup9k0.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is amazing how a practice demonstrating good performance and usability for one platform is demonized in a camp of adherents of another platform. </font><font style="vertical-align: inherit;">This fate is fully felt by the pattern of Service Locator, which is very popular in .Net and has a bad reputation in iOS.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In some articles, ServiceLocator is neglected, calling it a "bicycle." </font><font style="vertical-align: inherit;">Others argue that it is antipattern. </font><font style="vertical-align: inherit;">There are those who are trying to maintain neutrality by describing both the positive and negative sides of the locator. </font><font style="vertical-align: inherit;">To a large extent, Habrahabr himself contributes to these persecutions, which contains several similar articles with cross-references. </font><font style="vertical-align: inherit;">Each new developer who encounters the implementation of Latitude is almost immediately infected with neglect - well, many developers cannot criticize the same thing without objective reasons.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">articles</font></font></b>
                        <div class="spoiler_text"><ul>
<li>2010: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">https://blog.ploeh.dk/2010/02/03/ServiceLocatorisanAnti-Pattern</a>/</li>
<li>2015 :<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> https://habr.com/ru/company/rambler-co/blog/258325/</a></li>
<li>2015: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">https://habr.com/ru/post/270005/</a></li>
<li>2016: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">https://habr.com/ru/company/jugru/blog/300886/</a></li>
<li>2017: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">https://habr.com/ru/company/badoo/blog/344506/</a></li>
<li>2018: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">https://habr.com/ru/company/redmadrobot/blog/352088</a></li>
</ul><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Is it really? In the words of one famous character, “Don't you like cats? Yes, you just don’t have them! ” In fact, have you tried to eat unsalted meat? And raw raw? You don’t have to make an effort to figure out what to eat pork is bad, especially on Friday night. So with the Service Locator pattern - the greater the prevalence of raw information - the greater the prejudice against it.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/c-/gf/0d/c-gf0dpfbeujk8--liho9lp_wwm.jpeg" align="left" width="300"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One of the greatest minds of antiquity Titus Lucretius Car was convinced that the sun revolves around the earth despite the fact that in the remaining parts of his book "On the nature of things", relating to the 1st century BC. many accurate scientific predictions have been made - from the force of gravity to nuclear physics. Without questioning the power of authority, we show that some prejudices are easily leveled by using a lever of the right length. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, recall what a service locator is and what it can be used for.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A service is an autonomous object that encapsulates business logic within itself and can have links to other objects. In fact, an instance of any class can act as a service. Very often, instead of the concept of service, the concept of a manager is used. However, a common situation is when a static class acts as a manager, which manipulates the repository data. The essence of the service is that it is an instance of the class, with all the ensuing consequences. This means that it cannot exist in a vacuum - it must have a carrier to which it is attached for the lifetime of the application. Such a carrier is a service locator.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The user (application or developer) requests a service of the specified type from the service locator, and receives an instance ready for use. Very similar to an abstract factory, right? The difference is that each time you request an instance of the specified type from the service locator, you will receive the same instance again and again, which stores the data that has already been used. It would seem that the service behaves like a typical singleton, but this is not so. You can create as many instances of the service as you like and use them independently at your discretion. At the same time, each of them will encapsulate the data that you post there throughout your life.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/e0/yp/wf/e0ypwfrqeyyykocycqh6lz8gtjy.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Why might this be necessary? The most obvious and beloved example is the user profile. If you do not use any storage in the form of UserSettings or CoreData, then for the lifetime of the application you will have to hold the link to the instance of the UserProfile class somewhere in order to use it on various screens of the application. Moreover, if such an instance is not a singleton, it will have to be transferred from one form to another. The difficulty will inevitably arise when in some development cycle of the application you have to create a temporary user, or an independent other user. Sington immediately becomes a bottleneck. And independent instances begin to overload the application logic, the complexity of which increases exponentially as more and more controllers interested in the instance are added.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/hk/pm/yf/hkpmyf9gnih2yltehozvkdqdbew.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The service locator elegantly solves this problem: if you have an abstract UserProfile class, and the specific classes DefaultUserPrifile and TemporatyUserProfile inherited from it (with an absolutely empty implementation, that is, virtually identical), then accessing the service locator will return two identical independent objects to you.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another application of the locator is the transfer of data instances through a chain of controllers: on the first controller, you create (receive) an object and modify it, and on the last - use the data that you entered on the first object. If the number of controllers is quite large and they are located on the stack, then using a delegate for these purposes will be quite difficult. Similarly, often there is a need in the root of the stack to display information that changed on its top immediately after minimizing the stack (we remember that the stack likes to delete all instances created in its copy). However, if at the top of the stack you get a service and modify it, and after that initiate folding of the stack, then when the root controller becomes available to the user, the modified data will be saved and will be available for display.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Generally speaking, if you use the "Coordinator" pattern, as it is described in most tutorials (for example, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), you need to either place its instance of the class in AppDelegate or pass a link to the coordinator to all ViewControllers that will use it. Necessary? And why, actually?</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/e0/yp/wf/e0ypwfrqeyyykocycqh6lz8gtjy.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Personally, I prefer AppDelegate to shine clean. </font><font style="vertical-align: inherit;">And to inherit from ICoordinatable and set the coordinator field - not only spends time (which, as we know, is equivalent to money), but also deprives the possibility of human declarative programming through storyboards. </font><font style="vertical-align: inherit;">No, this is not our method. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creating a coordinator as a service gracefully makes the disadvantages of the advantages:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You do not need to care about maintaining the integrity of the coordinator;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the coordinator becomes available throughout the application, even in those controllers that are not inherited from ICoordinatable;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">you initiate a coordinator only when you need it.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can use the coordinator together with the storyboard in any order (convenient for you).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using a coordinator with a storyboard allows you to create non-obvious, but effective navigation mechanisms.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But the coordinator is half the “Navigator” pattern (the mechanism for moving around the application through a calculated path using a router). </font><font style="vertical-align: inherit;">With its implementation, complexity increases by an order of magnitude. </font><font style="vertical-align: inherit;">Features of the navigator in conjunction with the service locator - this is a separate wide topic. </font><font style="vertical-align: inherit;">Let's get back to our locator. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The objective reasons that lead to the reason why the service Locator is bad include the complexity of its maintenance for a particular service and the inability to control the state of the locator's memory. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The traditional mechanism for creating a service is this code:</font></font><br>
<br>
<pre><code class="swift hljs">...
 <span class="hljs-type">ServiceLocator</span>.shared.addService(<span class="hljs-type">CurrentUserProvider</span>() <span class="hljs-keyword">as</span> <span class="hljs-type">CurrentUserProviding</span>)<font></font>
...<font></font>
<span class="hljs-keyword">let</span> userProvider: <span class="hljs-type">UserProviding?</span> =  <span class="hljs-type">ServiceLocator</span>.shared.getService()
<span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> provider =  userProvider <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
<span class="hljs-keyword">self</span>.user = provider.currentUser()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
or like this:</font></font><br>
<br>
<pre><code class="swift hljs">&nbsp;<span class="hljs-keyword">if</span> let_:<span class="hljs-type">ProfileService</span> = <span class="hljs-type">ServiceLocator</span>.service() {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-type">ServiceLocator</span>.addService(<span class="hljs-type">ProfileService</span>())<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; }<font></font>
&nbsp;<span class="hljs-keyword">let</span> service:<span class="hljs-type">ProfileService</span> = <span class="hljs-type">ServiceLocator</span>.service()!<font></font>
&nbsp; service.update(name: <span class="hljs-string">"MyName"</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Is he terrible? </font><font style="vertical-align: inherit;">First you need to register the service, and then extract it in order to use it. </font><font style="vertical-align: inherit;">In the first case, it is guaranteed that it will exist when it is requested. </font><font style="vertical-align: inherit;">But the second does not create the service before it is needed. </font><font style="vertical-align: inherit;">If you need to pull the service in many places, then the alternative of choice can drive you crazy. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But it’s easy to turn all this into such code:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-type">ProfileService</span>.service.update(name: <span class="hljs-string">"MyName"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here the service instance is guaranteed to exist, because if it is absent, it is created by the service itself. </font><font style="vertical-align: inherit;">Nothing extra. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The second claim to the locator is apparently due to the fact that developers who make pattern tracing with C # forget about the work of the garbage collector, and do not bother to provide the ability to clean the locator from an unnecessary instance, although this is not at all difficult:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-type">ProfileService</span>.service.remove()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you do not do this, then when you turn to ProfileService.service (), we will get an instance of the service with which we already worked previously in an arbitrary place in the application. But if you do remove (), then when accessing the service, you will get a clean copy. In some cases, instead of remove (), you can make clear () by clearing the predefined part of the data and continuing to work with the same instance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The test application demonstrates the coordinated work of two services: user profile and coordinator. The coordinator is not the purpose of the article, but only a convenient example.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/d3/n5/pi/d3n5pivlyhibh_g6b9yoqrmpvpu.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The video shows that the value entered in the field is transmitted to each subsequent screen of the application. </font><font style="vertical-align: inherit;">And on the final screen, the coordinator is called in order to launch the application from the first screen. </font><font style="vertical-align: inherit;">Note that the traditional folding of the navigation stack does not occur here - it is ejected entirely from the memory, a new stack starts in its place. </font><font style="vertical-align: inherit;">If you comment out the line for deleting the profile service, the username will be transferred to the first screen, as if we had minimized the navigation stack.</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-type">ProfileService</span>.service.remove()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The entire application consists of two view controllers, with a minimum of preparatory operations.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/no/k_/sd/nok_sdvjddqny_nnk-v5te7tkhm.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
StartViewController:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">import</span> UIKit<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StartViewController</span>: <span class="hljs-title">UIViewController</span> </span>{<font></font>
<font></font>
&nbsp; &nbsp; <span class="hljs-meta">@IBOutlet</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> nameField: <span class="hljs-type">UITextField!</span><font></font>
<font></font>
&nbsp; &nbsp; <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">viewDidLoad</span><span class="hljs-params">()</span></span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">super</span>.viewDidLoad()
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">self</span>.nameField.text = <span class="hljs-type">ProfileService</span>.service.info.name<font></font>
&nbsp; &nbsp; }<font></font>
<font></font>
&nbsp; &nbsp; <span class="hljs-meta">@IBAction</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">startAction</span><span class="hljs-params">(<span class="hljs-number">_</span> sender: UIButton)</span></span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-type">ProfileService</span>.service.update(name: <span class="hljs-keyword">self</span>.nameField.text ?? <span class="hljs-string">""</span>)
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-type">CoordinatorService</span>.service.coordinator.startPageController()<font></font>
&nbsp; &nbsp; }<font></font>
<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PageViewController:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">import</span> UIKit<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PageViewController</span>: <span class="hljs-title">UIViewController</span> </span>{<font></font>
<font></font>
&nbsp; &nbsp; <span class="hljs-meta">@IBOutlet</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> nameLabel: <span class="hljs-type">UILabel!</span><font></font>
<font></font>
&nbsp; &nbsp; <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">viewDidLoad</span><span class="hljs-params">()</span></span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">super</span>.viewDidLoad()
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">self</span>.nameLabel.text = <span class="hljs-type">ProfileService</span>.service.info.name<font></font>
&nbsp; &nbsp; }<font></font>
<font></font>
<font></font>
&nbsp; &nbsp; <span class="hljs-meta">@IBAction</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">finishAction</span><span class="hljs-params">(<span class="hljs-number">_</span> sender: UIButton)</span></span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-type">ProfileService</span>.service.remove()
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-type">CoordinatorService</span>.service.coordinator.start()<font></font>
&nbsp; &nbsp; }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the first controller, a profile instance is created in the viewDidLoad () method, and the user name information is loaded into the input field. And after clicking on the SignIn button, the service data is updated again. After which there is a forced transition to the first page of the wizard. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inside the wizard, data is displayed on the screen. But the event is tied to a button only on the last screen of the storyboard. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It would seem that it can be complicated? But over the past 5 years, I have constantly come across developers who do not understand how it all works. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, all the main work takes place in the locator and the service itself. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Locator:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">import</span> Foundation<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">IService</span> </span>{
&nbsp; &nbsp; <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> service: <span class="hljs-type">Self</span> {<span class="hljs-keyword">get</span>}<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span></span>
&nbsp; &nbsp; <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">remove</span><span class="hljs-params">()</span></span><font></font>
}<font></font>
<span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">IServiceLocator</span> </span>{
&nbsp; &nbsp; <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">service</span>&lt;T&gt;<span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">T?</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ServiceLocator</span>: <span class="hljs-title">IServiceLocator</span> </span>{<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> instance = <span class="hljs-type">ServiceLocator</span>()
&nbsp; &nbsp; <span class="hljs-keyword">private</span> <span class="hljs-built_in">lazy</span> <span class="hljs-keyword">var</span> services: [<span class="hljs-type">String</span>: <span class="hljs-type">Any</span>] = [:]<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-comment">// MARK: - Public methods</span>
&nbsp; &nbsp; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">func</span> <span class="hljs-title">service</span>&lt;<span class="hljs-title">T</span>&gt;() -&gt; <span class="hljs-title">T</span>? </span>{
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">return</span> instance.service()<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">func</span> <span class="hljs-title">addService</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-title">_</span> <span class="hljs-title">service</span>: <span class="hljs-title">T</span>) </span>{
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">return</span> instance.addService(service)<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">func</span> <span class="hljs-title">clear</span>() </span>{<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; instance.services.removeAll()<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">func</span> <span class="hljs-title">removeService</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-title">_</span> <span class="hljs-title">service</span>: <span class="hljs-title">T</span>) </span>{<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; instance.removeService(service)<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">service</span>&lt;T&gt;<span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">T?</span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">let</span> key = typeName(<span class="hljs-type">T</span>.<span class="hljs-keyword">self</span>)
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">return</span> services[key] <span class="hljs-keyword">as</span>? <span class="hljs-type">T</span><font></font>
&nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-comment">// MARK: - Private methods</span>
&nbsp; &nbsp; <span class="hljs-keyword">private</span> fun caddService&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-number">_</span> service: <span class="hljs-type">T</span>) {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">let</span> key = typeName(<span class="hljs-type">T</span>.<span class="hljs-keyword">self</span>)<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; services[key] = service<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">removeService</span>&lt;T&gt;<span class="hljs-params">(<span class="hljs-number">_</span> service: T)</span></span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">let</span> key = typeName(<span class="hljs-type">T</span>.<span class="hljs-keyword">self</span>)<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; services.removeValue(forKey: key)<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">typeName</span><span class="hljs-params">(<span class="hljs-number">_</span> some: <span class="hljs-keyword">Any</span>)</span></span> -&gt; <span class="hljs-type">String</span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">return</span> (some isAny.<span class="hljs-type">Type</span>) ? <span class="hljs-string">"\(some)"</span> : <span class="hljs-string">"\(type(of: some))"</span><font></font>
&nbsp; &nbsp; }<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you take a closer look, you will notice that you can potentially clean up the entire locator data area with one action: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ServiceLocator.clear () A </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
service profile is not much more complicated:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">import</span> UIKit<font></font>
<font></font>
<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProfileService</span>: <span class="hljs-title">IService</span> </span>{<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-keyword">private</span> (<span class="hljs-keyword">set</span>) <span class="hljs-keyword">var</span> info = <span class="hljs-type">ProfileInfo</span>()<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">var</span> <span class="hljs-title">service</span>: <span class="hljs-title">ProfileService</span> </span>{
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> service: <span class="hljs-type">ProfileService</span> = <span class="hljs-type">ServiceLocator</span>.service() {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">return</span> service<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">let</span> service = <span class="hljs-type">ProfileService</span>()
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-type">ServiceLocator</span>.addService(service)
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">return</span> service<font></font>
&nbsp; &nbsp; }<font></font>
<font></font>
&nbsp; &nbsp; <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span></span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">self</span>.info = <span class="hljs-type">ProfileInfo</span>()<font></font>
&nbsp; &nbsp; }<font></font>
<font></font>
&nbsp; &nbsp; <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">remove</span><span class="hljs-params">()</span></span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-type">ServiceLocator</span>.removeService(<span class="hljs-keyword">self</span>)<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">update</span><span class="hljs-params">(name: String)</span></span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">self</span>.info.name = name<font></font>
&nbsp; &nbsp; }<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ProfileInfo</span> </span>{<font></font>
&nbsp; &nbsp; varname = <span class="hljs-string">""</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It can be further simplified by moving the data area inside the service itself. </font><font style="vertical-align: inherit;">But in this form, it becomes clear the area of ​​responsibility of the data model and service. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is possible that for the work of your services you will need to carry out some preparatory operations, as is the case with the creation of a coordinator service.</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">import</span> UIKit<font></font>
<font></font>
<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CoordinatorService</span>: <span class="hljs-title">IService</span> </span>{<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-keyword">private</span> (<span class="hljs-keyword">set</span>)<span class="hljs-keyword">var</span> coordinator: <span class="hljs-type">MainCoordinator!</span><font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-keyword">var</span> navController: <span class="hljs-type">UINavigationController</span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.coordinator.navigationController<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">var</span> <span class="hljs-title">service</span>: <span class="hljs-title">CoordinatorService</span> </span>{
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> service: <span class="hljs-type">CoordinatorService</span> = <span class="hljs-type">ServiceLocator</span>.service() {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">return</span> service<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">let</span> service = <span class="hljs-type">CoordinatorService</span>()<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; service.load()<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-type">ServiceLocator</span>.addService(service)
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">return</span> service<font></font>
&nbsp; &nbsp; }<font></font>
<font></font>
&nbsp; &nbsp; <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span></span> {<font></font>
&nbsp; &nbsp; }<font></font>
<font></font>
&nbsp; &nbsp; <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">remove</span><span class="hljs-params">()</span></span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-type">ServiceLocator</span>.removeService(<span class="hljs-keyword">self</span>)<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-comment">// MARK - Private</span>
&nbsp; &nbsp; <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">load</span><span class="hljs-params">()</span></span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">let</span> nc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = <span class="hljs-type">UINavigationController</span>()<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; nc.navigationBar.isHidden = <span class="hljs-literal">true</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">self</span>.coordinator&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = <span class="hljs-type">MainCoordinator</span>(navigationController:nc)<font></font>
&nbsp; &nbsp; }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here you can see that at the moment the service is placed in the locator, the navigation stack is created and passed to the coordinator class instance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you are using iOS 13 (apparently above), then be sure to modify the SceneDelegate class. </font><font style="vertical-align: inherit;">It is necessary to ensure the execution of this code:</font></font><br>
<br>
<pre><code class="swift hljs">&nbsp;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">scene</span><span class="hljs-params">(<span class="hljs-number">_</span> scene: UIScene, willConnectTo session: UISceneSession, options connectionOptions: UIScene.ConnectionOptions)</span></span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> scene = (scene <span class="hljs-keyword">as</span>? <span class="hljs-type">UIWindowScene</span>) <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">let</span> window = <span class="hljs-type">UIWindow</span>(windowScene: scene)<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; window.rootViewController = <span class="hljs-type">CoordinatorService</span>.service.navController
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">self</span>.window = window
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-type">CoordinatorService</span>.service.coordinator.start()<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; window.makeKeyAndVisible()<font></font>
&nbsp; &nbsp; }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, we extract the default navigation stack and associate it with the main application window, and then open the application start window with the StartViewController controller. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The source code for the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">test case is available on GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en498178/index.html">We work from home: photo spread</a></li>
<li><a href="../en498180/index.html">Rechecking Newton Game Dynamics with PVS-Studio static analyzer</a></li>
<li><a href="../en498186/index.html">Services based on neural networks for designers</a></li>
<li><a href="../en498188/index.html">Probability Theories: Preparing for an Interview and Solving “Paradoxes”</a></li>
<li><a href="../en498192/index.html">Steroid Cosmetic Bag: XD Design Urban Bumbag Review</a></li>
<li><a href="../en498196/index.html">FunCorp is looking for QA engineers: go through an interview and receive an offer on the same day</a></li>
<li><a href="../en498200/index.html">Data Platform for regulatory reporting</a></li>
<li><a href="../en498202/index.html">Landing Digest. Information Security Specialist</a></li>
<li><a href="../en498206/index.html">Create a graphql backend on Golang</a></li>
<li><a href="../en498208/index.html">Security Week 17: Implications of Linux Server Attack</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>