<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêî ü§¨ üßñ Pourquoi les serveurs Web asynchrones sont-ils apparus? üå®Ô∏è üîâ üôä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous. En contact avec Vladislav Rodin. Actuellement, je dirige le cours d'architecte √† charge √©lev√©e d'OTUS et j'enseigne √©galement des cour...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Pourquoi les serveurs Web asynchrones sont-ils apparus?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/496956/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonjour √† tous. </font><font style="vertical-align: inherit;">En contact avec Vladislav Rodin. </font><font style="vertical-align: inherit;">Actuellement, je dirige le cours d'architecte √† charge √©lev√©e d'OTUS et j'enseigne √©galement des cours sur l'architecture logicielle. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En plus d'enseigner, comme vous pouvez le voir, j'ai √©crit pour un blog des droits d'auteur OTUS Habr√© et l'article d'aujourd'hui je veux co√Øncider avec le d√©but du cours </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬´Administrateur Linux¬ª</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui est maintenant ouvert √† l'ensemble.</font></font></b></i><br>
<br>
<img src="https://habrastorage.org/webt/mq/fl/9f/mqfl9f73j0kklcb2wikqonkd4rk.png"><br>
<hr><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">introduction</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pourquoi l'application Web ralentit-elle et ne retient-elle pas la charge? </font><font style="vertical-align: inherit;">Les d√©veloppeurs, qui ont √©t√© les premiers √† rencontrer cette question et √† mener des recherches sur certains syst√®mes, sont arriv√©s √† la conclusion d√©cevante qu'optimiser une logique m√©tier ne serait pas suffisant √† lui seul. </font><font style="vertical-align: inherit;">La r√©ponse √† cette question se situe √† un niveau inf√©rieur - au niveau du syst√®me d'exploitation. </font><font style="vertical-align: inherit;">Pour que votre application puisse supporter la charge, il est n√©cessaire de revoir son concept architectural de mani√®re √† fonctionner efficacement √† ce niveau. </font><font style="vertical-align: inherit;">Cela a conduit √† l'√©mergence de serveurs Web asynchrones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malheureusement, je n'ai pas pu trouver un seul mat√©riau qui me permette de restaurer toutes les relations causales dans l'√©volution des serveurs Web √† la fois. </font><font style="vertical-align: inherit;">C'est ainsi que l'id√©e d'√©crire cet article est venue, qui, je l'esp√®re, deviendra un tel mat√©riau.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fonctionnalit√©s du syst√®me d'exploitation Linux</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant de parler des mod√®les de serveurs web, je me permets de rappeler quelques fonctionnalit√©s des processus et des threads sous Linux. </font><font style="vertical-align: inherit;">Nous en aurons besoin pour analyser les avantages et les inconv√©nients des mod√®les ci-dessus.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Changement de contexte</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tr√®s probablement, tout utilisateur qui sait qu'un seul programme peut √™tre ex√©cut√© sur un c≈ìur de processeur √† la fois demandera: "Pourquoi peut-on lancer 20 programmes sur mon processeur √† 4 c≈ìurs √† la fois?". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, cela est d√ª au fait que le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">multit√¢che pr√©emptif</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a lieu </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Le syst√®me d'exploitation alloue un certain quantum de temps (~ 50 Œºs) et met le programme √† ex√©cuter sur le noyau pendant ce temps. </font><font style="vertical-align: inherit;">Une fois le temps √©coul√©, le </font><b><font style="vertical-align: inherit;">changement de contexte</font></b><font style="vertical-align: inherit;"> est </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interrompu</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commut√©</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Autrement dit, le syst√®me d'exploitation met simplement le prochain programme √† ex√©cuter. </font><font style="vertical-align: inherit;">√âtant donn√© que la commutation se produit fr√©quemment, nous avons l'impression que tous les programmes fonctionnent simultan√©ment. </font><font style="vertical-align: inherit;">Faites attention √† la fr√©quence de commutation √©lev√©e, cela sera important pour la pr√©sentation suivante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le changement de contexte a √©t√© mentionn√© ci-dessus. </font><font style="vertical-align: inherit;">Que comprend-il? </font><font style="vertical-align: inherit;">Lors de la commutation du contexte, il est n√©cessaire de sauvegarder les registres du processeur, d'effacer son pipeline d'instructions, de sauvegarder les r√©gions m√©moire allou√©es au processus. </font><font style="vertical-align: inherit;">En g√©n√©ral, l'op√©ration est assez co√ªteuse. </font><font style="vertical-align: inherit;">Cela prend ~ 0,5 Œºs, tandis que l'ex√©cution d'une simple ligne de code est ~ 1 ns. </font><font style="vertical-align: inherit;">De plus, avec une augmentation du nombre de processus par c≈ìur de processeur, la surcharge pour le changement de contexte augmentera.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mod√®les de serveur Web</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Actuellement, les mod√®les de serveur Web suivants existent:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ouvrier</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√©fork</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asynchrone</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">combin√©</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Discutons chacun d'eux s√©par√©ment.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travailleur et pr√©fork</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Historiquement, avec ces mod√®les, tout a commenc√©. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'essence est tr√®s simple</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : un client vient √† nous, nous s√©lectionnons pour lui un gestionnaire distinct, qui traite le client entrant du d√©but √† la fin. Un gestionnaire peut √™tre un processus (pr√©fork) ou un thread (travailleur). Un exemple d'un tel serveur Web est le c√©l√®bre Apache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ferai une r√©servation tout de suite: cr√©er un nouveau gestionnaire pour chaque client co√ªte cher. Premi√®rement, avec un nombre constant de c≈ìurs, une augmentation du nombre de processeurs entra√Æne une augmentation de la latence (due aux changements de contexte). Deuxi√®mement, la quantit√© de m√©moire requise augmente lin√©airement avec l'augmentation du nombre de clients, car m√™me si vous utilisez des threads de partage de m√©moire, chaque thread a sa propre pile. Ainsi, le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nombre de clients trait√©s simultan√©ment est limit√©.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la taille du pool, qui, √† son tour, d√©pend du nombre de c≈ìurs de processeur. </font><font style="vertical-align: inherit;">Le probl√®me est r√©solu en utilisant des m√©thodes de mise √† l'√©chelle verticale. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un autre inconv√©nient fondamental de ces serveurs est l'utilisation non optimale des ressources. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les processus (ou threads) sont inactifs la plupart du temps</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Imaginez la situation suivante: pendant le traitement du client, il est n√©cessaire de prendre des donn√©es du disque dur, de faire une demande dans la base de donn√©es ou d'√©crire quelque chose sur le r√©seau. </font><font style="vertical-align: inherit;">√âtant donn√© que la lecture √† partir d'un disque dur sous Linux est une </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">op√©ration de blocage</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , le processus (ou thread) se </font><b><font style="vertical-align: inherit;">bloque en</font></b><font style="vertical-align: inherit;"> attendant une r√©ponse, mais il participe toujours √† l'allocation du temps processeur.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Worker vs prefork</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Worker et prefork ont ‚Äã‚Äãquelques diff√©rences fondamentales. </font><font style="vertical-align: inherit;">Les flux sont un peu plus √©conomiques en m√©moire car ils les partagent. </font><font style="vertical-align: inherit;">Pour la m√™me raison, un changement de contexte entre eux est plus facile qu'entre processus. </font><font style="vertical-align: inherit;">Cependant, dans le cas d'un travailleur, le code devient multi-thread, car les threads doivent √™tre synchronis√©s. </font><font style="vertical-align: inherit;">En cons√©quence, nous obtenons tous les ¬´charmes¬ª du code multi-thread: il devient plus difficile de l'√©crire, le lire, le tester et le d√©boguer.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mod√®le asynchrone</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, le travailleur et la pr√©fork ne permettent pas de traiter un grand nombre de clients en m√™me temps en raison de la taille limit√©e du pool et n'utilisent pas de mani√®re optimale les ressources en raison de la commutation de contexte et du blocage des appels syst√®me. Comme vous pouvez le voir, le probl√®me est le multithreading et un planificateur de syst√®me d'exploitation lourd. Cela conduit √† l'id√©e suivante: traitons les clients dans un seul thread, mais la chargeons √† 100%. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces serveurs sont bas√©s sur une boucle d'√©v√©nement et un mod√®le de r√©acteur ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">machine d'√©v√©nement</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Le code client, initiant une op√©ration d'E / S, enregistre un </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rappel</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans une file d'attente prioritaire (la priorit√© est le temps de pr√©paration). La boucle d'√©v√©nements interroge les descripteurs en attente d'E / S, puis met √† jour la priorit√© (si disponible). De plus, la boucle d'√©v√©nements extrait les √©v√©nements de la file d'attente prioritaire, ce qui oblige les rappels √† revenir √† la boucle d'√©v√©nements √† la fin. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce mod√®le vous permet de g√©rer un grand nombre de clients, en √©vitant la surcharge pour changer de contexte</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ce mod√®le n'est pas parfait et pr√©sente plusieurs inconv√©nients. Premi√®rement, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pas plus d'un c≈ìur de processeur n'est consomm√©</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , car il n'y a qu'un seul processus. Ceci est trait√© en utilisant un mod√®le combin√©, qui sera discut√© ci-dessous. Deuxi√®mement, les </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clients sont connect√©s par ce processus.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Le code doit √™tre √©crit avec soin. </font><font style="vertical-align: inherit;">Les fuites de m√©moire, les erreurs conduisent au fait que tous les clients tombent en m√™me temps. </font><font style="vertical-align: inherit;">De plus, ce processus ne doit √™tre bloqu√© par rien, le rappel ne doit pas consister √† r√©soudre certaines t√¢ches difficiles, car tous les clients seront bloqu√©s. </font><font style="vertical-align: inherit;">Troisi√®mement, le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code asynchrone est beaucoup plus compliqu√©</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il est n√©cessaire d'enregistrer un rappel suppl√©mentaire que les donn√©es ne viendront pas, pour r√©soudre le probl√®me de branchement correct, etc.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mod√®le combin√©</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce mod√®le est utilis√© dans de vrais serveurs. </font><font style="vertical-align: inherit;">Ce mod√®le poss√®de un pool de processus, chacun ayant un pool de threads, chacun utilisant √† son tour un mod√®le de traitement bas√© sur une entr√©e-sortie asynchrone. </font><font style="vertical-align: inherit;">Nginx pr√©sente un mod√®le combin√©.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, en nous tournant vers les bases du syst√®me d'exploitation, nous avons examin√© les diff√©rences conceptuelles entre les mod√®les de serveur Web utilis√©s dans Apache et Nginx. </font><font style="vertical-align: inherit;">Chacun d'eux a ses propres avantages et inconv√©nients, de sorte que leur combinaison est souvent utilis√©e dans la production. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'id√©e du traitement asynchrone a encore √©volu√©: au niveau des plates-formes linguistiques, les concepts de fils / fibres / goroutines verts sont apparus, qui vous permettent de "cacher sous le capot" l'asynchronie des entr√©es et des sorties, laissant le d√©veloppeur satisfait d'un beau code synchrone. </font><font style="vertical-align: inherit;">Cependant, ce concept m√©rite un article s√©par√©.</font></font><br>
<br>
<hr><br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> En savoir plus sur le cours.</font></font></a></b><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr496944/index.html">√âv√©nements num√©riques √† Saint-P√©tersbourg du 13 au 19 avril</a></li>
<li><a href="../fr496946/index.html">Encore une fois sur les cl√©s mat√©rielles GPG pour un sou</a></li>
<li><a href="../fr496950/index.html">Le design est le design, pas la beaut√© des images.</a></li>
<li><a href="../fr496952/index.html">Qualcomm QCC3020 - l'essor des √©couteurs TWS chinois</a></li>
<li><a href="../fr496954/index.html">D√©veloppement chez Wargaming - r√©union avec Maxim Baryshnikov, chef de plate-forme (partie I)</a></li>
<li><a href="../fr496958/index.html">CSS int√©ressant trouve dans la nouvelle conception de Facebook</a></li>
<li><a href="../fr496960/index.html">Acc√©l√©rer les graphiques en utilisant OffscreenCanvas</a></li>
<li><a href="../fr496962/index.html">Comment ranger un serveur surcharg√©?</a></li>
<li><a href="../fr496964/index.html">S√©minaires hebdomadaires IBM - avril 2020</a></li>
<li><a href="../fr496966/index.html">Couleurs CSS LCH</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>