<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí£ üë≤üèø ‚úùÔ∏è Faire un clavier MIDI √† partir d'un vieux synth√©tiseur pour enfants üëµüèΩ üñêüèª üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Un jour, en rentrant chez moi, pr√®s de la chute √† ordures √† l'entr√©e, j'ai vu un vieux synth√©tiseur de jouets pour enfants. Pass√©, car il √©tait ¬´coupa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Faire un clavier MIDI √† partir d'un vieux synth√©tiseur pour enfants</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500450/"><img src="https://habrastorage.org/webt/-g/1_/nu/-g1_nu7zf-kudqjkv5ygvqjysao.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un jour, en rentrant chez moi, pr√®s de la chute √† ordures √† l'entr√©e, j'ai vu un vieux synth√©tiseur de jouets pour enfants. Pass√©, car il √©tait ¬´coupable¬ª de le retirer de la poubelle, mais dans mon c≈ìur, je voulais le sortir de l√†. D√©j√† tard dans la nuit, vers 14 heures, j'ai d√©cid√© de voir si elle √©tait toujours l√†. Et oui, elle √©tait toujours l√†! En apparence, elle √©tait compl√®tement enti√®re et propre, donc il n'y avait pas de d√©licatesse pour ne pas la prendre. Alors oui, je l'ai prise. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je veux depuis longtemps un piano pour moi, je ne suis pas un musicien professionnel, mais juste pour me faire plaisir - pourquoi pas? Acheter quelque chose "pour se faire dorloter" J'ai √©t√© "√©trangl√© par un crapaud", et ici - un jouet gratuit. Quand je l'ai pris dans la poubelle, je ne pensais m√™me pas √† l'utiliser comme un jouet pour enfant, j'ai tout de suite pens√©: "Ohhhh ..., une bonne base pour essayer de faire un clavier MIDI."</font></font><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme j'ai d√©j√† une certaine exp√©rience de la communication avec les claviers professionnels et les claviers MIDI, j'ai imm√©diatement compris tous les inconv√©nients de mon id√©e. Autrement dit, un jouet restera en fait un jouet. Sur cette base, il sera impossible de r√©aliser la puissance des frappes. Les cl√©s en plastique ¬´l√©g√®res¬ª elles-m√™mes, qui sont √©galement incompl√®tes, ne permettront pas d'y r√©aliser quelque chose de digne. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, le synth√©tiseur jouet a √©t√© d√©mont√© "√† la vis", tout le plastique a √©t√© bien lav√© au savon. Les tableaux et les groupes de contacts des cl√©s sont √©galement nettoy√©s.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s le d√©montage, on a compris pourquoi les gens l'avaient jet√©. Un jouet (je ne sais pas pourquoi: de temps en temps, de la qualit√© chinoise des composants ou d'un fonctionnement difficile) d'une part: les haut-parleurs int√©gr√©s se sont d√©sagr√©g√©s, et d'autre part: un connecteur cass√© d'eux coinc√© dans la prise casque, donc il n'y avait pratiquement aucun moyen de le retirer . Probablement, apr√®s que le jouet a cess√© de jouer avec les haut-parleurs int√©gr√©s, ils l'ont utilis√© avec des √©couteurs, puis apr√®s avoir cass√© le connecteur, ils l'ont simplement jet√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä l'int√©rieur, le synth√©tiseur jouet se composait de trois cartes qui √©taient interconnect√©es par une boucle de c√¢ble. La carte centrale, qui √©tait responsable de la g√©n√©ration du son et d'autres choses, a √©t√© imm√©diatement dessoud√©e des deux autres cartes et mise de c√¥t√©. Sur les deux autres planches, il y avait des contacts pour les boutons sur le panneau avant du jouet et les touches du piano elles-m√™mes. Je leur ai soud√© les connecteurs PBS, d'autant plus que le pas des trous sur les cartes n'√©tait que de 2,54 mm. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bp/mh/qc/bpmhqcxmblsmtoqy7zu7wfbqwm4.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/nj/dr/us/njdrusxpjqa57hm8ezczbzidcu0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s cela, j'ai pass√© quelques heures √† dessiner des sch√©mas de ces tableaux avec des cl√©s. Il s'est av√©r√© que le sch√©ma est un simple clavier matriciel. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yt/uh/m6/ytuhm6oamte_d4mo60zuvzucqfm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'image en cercles jaunes, les chiffres sont les num√©ros des contacts ¬´horizontaux¬ª et les chiffres sur les touches sont les num√©ros des contacts ¬´verticaux¬ª du connecteur PBS-13 sur la carte du clavier.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/m6/qc/lk/m6qclkogjo6vprfkk4ywi2qtqzq.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/n0/lz/tf/n0lztfhulhpdeytl2ltfl0zxqna.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/bw/w2/pa/bww2pa-cgsmxubbn2ixa2sr373w.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s cela, tout cela a √©t√© jet√© dans un coin et √©pousset√© pendant un an. Et puis la p√©riode d'isolement a commenc√© ... C'est devenu ennuyeux et je voulais faire quelque chose de mes propres mains, d'autant plus qu'il n'y a nulle part o√π aller, et c'est impossible ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au final, j'ai d√©cid√© d'essayer de finir ce jouet au moins un peu. La carte Arduino a √©t√© prise comme base pour le contr√¥leur, et comme le nombre de porte-cl√©s est sup√©rieur au nombre de broches Arduino UNO, j'ai d√©cid√© d'utiliser les registres √† d√©calage 74HC595 et 74HC165. En cons√©quence, nous avons obtenu un tel r√©gime.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_j/y9/m9/_jy9m906okczf38_zjmeyvy9qbc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le circuit √©tait √† l'origine assembl√© sur une planche √† pain sans soudure. Pour tester l'op√©rabilit√© du circuit (qu'il n'y a aucune erreur dans les connexions n'importe o√π), un programme de test a √©t√© d√©velopp√© qui a montr√© que tout semblait fonctionner. L'algorithme du programme de test √©tait simple: l'une des sorties de la puce de sortie de d√©calage est activ√©e et les valeurs sont lues dans un cycle √† partir de la puce d'entr√©e de d√©calage, tout en appuyant sur les touches. √Ä premi√®re vue, rien n'annon√ßait le probl√®me ... et tout semblait bien fonctionner ... </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bx/uh/an/bxuhanfuxtixrojargnmaeqv5oe.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les jours suivants, j'ai lentement travaill√© sur les "devoirs", √† savoir, soudant soigneusement tous les composants de la planche sur une planche √† pain. J'ai tout r√©cup√©r√© de ce qui √©tait chez moi. Il a pris l'Arduino NANO comme carte de contr√¥le.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2o/h9/f-/2oh9f-a8fplwk8bqnt5dultsxee.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un tel "sandwich" des planches est d√ª au fait que les deux planches du jouet (l'une avec des boutons et l'autre avec le clavier) sont situ√©es √† des niveaux diff√©rents, et avant de les souder, je pensais: "Est-il possible de les connecter ensemble en utilisant les composants que j'ai chez moi pour √™tre plus ou moins beaux? ¬ª Et il s'est av√©r√© que cette conception de deux cartes interconnect√©es par des connecteurs. De mon point de vue, pour l'option maison, lorsque nous nous asseyons dans l'isolement, cela s'est plut√¥t bien pass√©. Tout ce que j'avais √† faire √©tait de couper la planche √† pain et de modifier l√©g√®rement le corps du jouet afin que vous puissiez connecter le c√¢ble USB √† la carte Arduino.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bb/xz/md/bbxzmdv5zabj-jq6hlyg7jhjpxy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La r√©alisation que l'appareil ne fonctionne pas exactement comme je le souhaitais est venue lorsque j'ai finalis√© le programme de test. L'algorithme √©tait simple: allumez chaque sortie de la puce 74HC595, en tenant compte de l'√©tat des entr√©es de la puce 74HC165, et √©crivez le r√©sultat dans des variables distinctes. Au total, 5 sorties du 74HC595 sont connect√©es au clavier, donc au final j'ai obtenu 40 bits (5 * 8) de donn√©es apr√®s ce sondage. Une cha√Æne de 40 bits a √©t√© √©mise vers la console, et des touches ont √©t√© enfonc√©es pour voir comment l'appareil g√®re les frappes simultan√©es de plusieurs touches.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d0/ra/o7/d0rao77gsxvrvtbeumy1ufguxsw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est l√† que le probl√®me est apparu: si vous appuyez sur une touche, tout allait bien, mais lorsque vous essayez d'appuyer sur plus de 2 touches en m√™me temps, une situation survient lorsqu'il est impossible de pr√©dire ce qui sera lu. Le r√©sultat pourrait √™tre correct avec une combinaison et avec une autre, il pourrait √™tre compl√®tement impr√©visible. Le probl√®me √©tait que la caract√©ristique de ce r√©gime n'√©tait pas prise en compte. Lorsque plusieurs touches sont enfonc√©es en m√™me temps, non seulement plusieurs verticales du balayage du clavier sont ferm√©es (cela est autoris√©), mais plusieurs lignes horizontales peuvent √™tre ferm√©es via les touches (ce qui n'est en aucun cas autoris√©). Vous pouvez en savoir plus sur ce probl√®me et comment le r√©soudre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici.</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
J'ai choisi la ¬´solution cardinale¬ª du probl√®me, √† savoir: j'ai d√©cid√© que pour chaque touche du clavier il y aurait une diode.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ma t√™te, j'ai d√©j√† mentalement commenc√© √† penser comment je devrais couper les pistes sur la carte et mettre la diode dans le bo√Ætier SMD dans l'espace. Je suis mont√© dans mes salles de stockage et j'ai vu que je n'avais tout simplement pas autant de diodes dans le bo√Ætier SMD (n'oubliez pas que nous nous asseyons tous sur l'auto-isolation et qu'il n'est pas tr√®s possible d'aller au magasin pour les composants radio - car ce ne sont certainement pas des biens essentiels). Un peu contrari√©, j'ai d√©cid√© de regarder de plus pr√®s la carte: il peut √™tre possible de mettre des diodes de sortie sur certaines pistes (j'en avais aussi certaines). Et puis j'ai vu que chaque touche a un cavalier (la carte est unilat√©rale) et le circuit est fait de sorte qu'au lieu de ce cavalier, vous pouvez mettre une diode. Imm√©diatement, j'ai pens√© - vous n'avez m√™me pas besoin de couper quoi que ce soit, il vous suffit de mettre des diodes de sortie au lieu de cavaliers partout.Je n'avais pas non plus autant de diodes de sortie. Une pens√©e m'a travers√© la t√™te: "peut-√™tre des LED?" Le circuit fonctionne √† + 5V et si vous mettez des LED rouges qui ont une chute de tension minimale (parmi les LED), alors √† la fin il devrait y avoir un niveau logique pour la d√©termination correcte: la touche est enfonc√©e ou non.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ff/1c/37/ff1c37wrrsclbwl0d7edw1x-ork.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet esprit, je suis remont√© dans mes stocks et j'ai attrap√© les LED rouges de partout o√π c'√©tait possible. Il y en avait exactement autant que les touches du clavier! C'est un signe, je pensais, et j'ai soud√© plusieurs LED au lieu de cavaliers pour les tests. Les r√©sultats des tests ont montr√© que la solution fonctionne. Apr√®s cela, j'ai soud√© les LED restantes au lieu des cavaliers. Le programme de test a montr√© que vous pouvez appuyer sur au moins toutes les touches en m√™me temps et qu'elles sont toutes lues correctement. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/g8/i0/-b/g8i0-b1rwc2ykc3oq1hcecu-ohs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai d√©cid√© de ne pas mettre de diodes sur les boutons suppl√©mentaires qui se trouvent sur le jouet, car il est peu probable qu'ils soient press√©s par plusieurs pi√®ces √† la fois. De plus, dans le programme, je n'ai pas encore de traitement pour cliquer sur ces boutons. Eh bien, je n'ai pas encore d√©cid√© comment les utiliser.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le moment est venu de comprendre comment faire appara√Ætre cet appareil sur votre ordinateur comme un clavier MIDI et dans quel format vous devez envoyer des donn√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les informations trouv√©es sur Internet me disent qu'il est possible de cr√©er un clavier MIDI √† partir d'Arduino tr√®s facilement et simplement en y versant un firmware, ce qui fera que l'ordinateur ne le verra pas comme un port COM, mais comme un clavier MIDI. Au d√©part, j'ai √©t√© </font><font style="vertical-align: inherit;">guid√© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">par cette d√©cision</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pas particuli√®rement sur la fa√ßon dont elle est mise en ≈ìuvre.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, quand je suis arriv√© √† lui et l'ai lu attentivement, j'ai r√©alis√© que ma carte Arduino NANO ne serait pas adapt√©e √† cette solution, car elle avait un port COM bas√© sur la puce CH340. </font><font style="vertical-align: inherit;">Pour utiliser le firmware du lien ci-dessus, seules les cartes qui ont d√©j√† un port USB sur le contr√¥leur (par exemple: AtMega32u4) conviennent ou la communication via le port COM ne se fait pas sur des puces de conversion de type FT232RL ou similaires, mais sur des microcontr√¥leurs AtMega. </font><font style="vertical-align: inherit;">Par cons√©quent, le firmware de la carte doit envoyer les donn√©es au format MIDI au port COM, et sur l'ordinateur, vous devrez installer et configurer un logiciel qui interceptera ces donn√©es et les transmettra au port MIDI virtuel. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'algorithme de lecture des cl√©s et de g√©n√©ration des commandes MIDI √©tait le suivant:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jj/-2/d6/jj-2d67yncypthxguaeyvotcvue.jpeg"><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le programme du contr√¥leur Arduino NANO ressemble maintenant √† ceci.</font></font></b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">//    +5V<font></font>
//   ST_CP  74HC595<font></font>
#define latchPin      11<font></font>
//   SH_CP  74HC595<font></font>
#define clockPin      13<font></font>
//   DS  74HC595<font></font>
#define dataPin       12<font></font>
<font></font>
//     +5V<font></font>
#define latchPin_IN   9<font></font>
#define clockPin_IN   10<font></font>
#define dataPin_IN    8<font></font>
<font></font>
// ,       1-16    <font></font>
#define BUT_OUT0      7<font></font>
#define BUT_OUT1      6<font></font>
#define BUT_OUT2      5<font></font>
#define BUT_OUT3      4<font></font>
<font></font>
byte but_out[4] = {BUT_OUT0, BUT_OUT1, BUT_OUT2, BUT_OUT3};<font></font>
//       <font></font>
byte kbd_in[5] = {0, 0, 0, 0, 0};<font></font>
byte kbd_in_new[5] = {0, 0, 0, 0, 0};<font></font>
<font></font>
//       <font></font>
byte btn_in[4] = {0, 0, 0, 0};<font></font>
byte btn_in_new[4] = {0, 0, 0, 0};<font></font>
<font></font>
//  3  -   (1 - , 0 - )<font></font>
byte kbd_out = 0b11100000;<font></font>
<font></font>
//  <font></font>
void init_electronics() {<font></font>
  //  ,   +5V<font></font>
  //  OUTPUT<font></font>
  pinMode(latchPin, OUTPUT);<font></font>
  pinMode(clockPin, OUTPUT);<font></font>
  pinMode(dataPin, OUTPUT);<font></font>
<font></font>
  //  ,   +5V<font></font>
  pinMode(latchPin_IN, OUTPUT);<font></font>
  pinMode(clockPin_IN, OUTPUT);<font></font>
  pinMode(dataPin_IN, INPUT);<font></font>
<font></font>
  //          <font></font>
  for (byte i = 0; i &lt; 4; i++) pinMode(but_out[i], OUTPUT);<font></font>
}<font></font>
<font></font>
//      74HC595<font></font>
void write_5V(byte a) {<font></font>
    digitalWrite(latchPin, LOW);<font></font>
    //    dataPin<font></font>
    shiftOut(dataPin, clockPin, MSBFIRST, a); <font></font>
     //"" ,      <font></font>
    digitalWrite(latchPin, HIGH); <font></font>
}<font></font>
<font></font>
void read_5V(byte *btn, byte *kbd) {<font></font>
  digitalWrite(clockPin_IN, HIGH);<font></font>
  digitalWrite(latchPin_IN, LOW);<font></font>
  digitalWrite(latchPin_IN, HIGH);<font></font>
  <font></font>
  //    -    <font></font>
  *btn = shiftIn(dataPin_IN, clockPin_IN, LSBFIRST);<font></font>
  <font></font>
  //    -    <font></font>
  *kbd = shiftIn(dataPin_IN, clockPin_IN, LSBFIRST);<font></font>
}<font></font>
<font></font>
void setup() {<font></font>
  init_electronics();<font></font>
  write_5V(kbd_out);<font></font>
  Serial.begin(115200);<font></font>
}<font></font>
<font></font>
//       ,   <font></font>
void read_kbd_and_btn_state(byte *btn, byte *kbd) {<font></font>
 byte tmp;<font></font>
  for (byte i = 0; i &lt; 5; i++) {<font></font>
    write_5V(kbd_out | (1 &lt;&lt; i));<font></font>
    read_5V(&amp;tmp, &amp;kbd[i]);<font></font>
  }<font></font>
}<font></font>
<font></font>
void noteOn(int cmd, int pitch, int velocity) {<font></font>
  Serial.write(cmd);<font></font>
  Serial.write(pitch);<font></font>
  Serial.write(velocity);<font></font>
}<font></font>
<font></font>
//     num  ,   <font></font>
// 0 -  0,  0<font></font>
// 1 -  0,  1<font></font>
// 2 -  1,  1<font></font>
// 3 -  1,  0<font></font>
byte compare_bit(byte old_state, byte new_state, byte num) {<font></font>
  byte tmp_old, tmp_new;<font></font>
  tmp_old = (old_state &gt;&gt; num) &amp; 1;<font></font>
  tmp_new = (new_state &gt;&gt; num) &amp; 1;<font></font>
  if ((tmp_old == 0) &amp;&amp; (tmp_new == 0)) return 0;<font></font>
  if ((tmp_old == 0) &amp;&amp; (tmp_new == 1)) return 1;<font></font>
  if ((tmp_old == 1) &amp;&amp; (tmp_new == 1)) return 2; <font></font>
  if ((tmp_old == 1) &amp;&amp; (tmp_new == 0)) return 3;  <font></font>
}<font></font>
<font></font>
void loop() {<font></font>
  read_kbd_and_btn_state(btn_in_new, kbd_in_new);<font></font>
  for (byte i = 0; i &lt; 5; i++) {<font></font>
    for (byte j = 0; j &lt; 8; j++) {<font></font>
      switch (compare_bit(kbd_in[i], kbd_in_new[i], 7 - j)) {<font></font>
        //  <font></font>
        case 1: noteOn(0x90, 0x1D + (8 * i + j), 0x7F);<font></font>
                break;<font></font>
        //  <font></font>
        case 2: //noteOn(0x00, 0x1D + (8 * i + j), 0x7F);<font></font>
                break;<font></font>
        //  <font></font>
        case 3: noteOn(0x90, 0x1D + (8 * i + j), 0x00);<font></font>
                break;<font></font>
      }<font></font>
    }<font></font>
    kbd_in[i] = kbd_in_new[i];<font></font>
  }<font></font>
} <font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela n'a aucun sens de peindre en d√©tail comment travailler avec des donn√©es MIDI, car elles peuvent √™tre lues </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici.</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Je m'attarderai plus en d√©tail sur le logiciel pour l'ordinateur et les probl√®mes que j'ai rencontr√©s. Des probl√®mes sont survenus, simplement en raison du manque de documentation normale pour ce logiciel. Donc, pour que l'ordinateur puisse recevoir avec succ√®s les donn√©es MIDI d'un appareil comme le mien, vous aurez besoin de deux programmes: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loopMIDI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serial-Midi Converter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pour Serial-MIDI Converter, vous devez √©galement installer Java, s'il n'est pas install√© sur l'ordinateur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous d√©marrons le programme loopMIDI et cr√©ons deux ports virtuels. Je les ai appel√©s Arduino IN et Arduino OUT. Ce programme sera un p√©riph√©rique MIDI virtuel.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/he/e8/do/hee8doojjloz3jiocd58qpugocg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, ex√©cutez Serial-MIDI Converter et au d√©marrage, nous passons par le processus de configuration. Malheureusement, vous devez le faire chaque fois que vous le d√©marrez, mais ce n'est pas tr√®s effrayant, cela se fait litt√©ralement en quatre frappes sur le clavier. Le num√©ro de port COM peut √™tre diff√©rent; il appara√Æt sur l'ordinateur lorsque la carte Arduino NANO est connect√©e. La vitesse du port est d√©finie dans le firmware Arduino NANO. Les fl√®ches rouges indiquent mes param√®tres, o√π tout a fonctionn√© pour moi. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zu/qj/l0/zuqjl0ruk96yomobfupdvbstgps.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, le processus de configuration est termin√© et vous pouvez d√©j√† utiliser un logiciel qui jouera des sons en acceptant les touches de l'appareil. Dans les param√®tres du logiciel, vous devez s√©lectionner "Arduino_OUT" comme entr√©e. Dans l'image ci-dessous, un exemple de configuration de Kontakt Player. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qs/eu/uu/qseuuugs_lbaywuoplve0qgc2wg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela fonctionne finalement comme ceci:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/cOnQOAYKlg0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et apr√®s? </font><font style="vertical-align: inherit;">Et puis tout s'est pass√© exactement comme je m'y attendais - le jouet reste un jouet avec exactement toutes les lacunes que j'ai mentionn√©es au tout d√©but. </font><font style="vertical-align: inherit;">Probablement, l'enfant jouera celui-ci dans un bourdonnement, mais pour un adulte, apr√®s les instruments √† clavier normaux ... Il est plus facile d'acheter n'importe quel clavier MIDI utilis√© √† moindre co√ªt et ce sera beaucoup mieux que ce jouet. </font><font style="vertical-align: inherit;">J'ai d√©cid√© de laisser ce jouet tel quel, mais y apporter quelques modifications:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laissez le bo√Ætier d'origine.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mettez des haut-parleurs qui fonctionnent et faites un amplificateur pour eux.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Faites-le fonctionner en mode ¬´jouet pour enfants¬ª sans vous connecter √† un ordinateur, c'est-√†-dire pour qu'il puisse jouer des sons lui-m√™me.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permet de connecter FootSwitch (la m√™me p√©dale sur le piano ci-dessous) afin que vous puissiez maintenir le son apr√®s avoir rel√¢ch√© les touches, comme sur un instrument normal.</font></font></li>
<li>    ,       .</li>
<li>    ,      -,      .</li>
</ol><br>
<img src="https://habrastorage.org/webt/qa/79/bk/qa79bkjnapd9sf84teo-y_nxn0g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne peux pas faire la mise en ≈ìuvre de la plupart des points, alors que nous sommes tous ensemble ¬´√† la maison¬ª, car je n'ai tout simplement pas tous les composants requis pour cela √† la maison. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour impl√©menter le paragraphe 3 sur Internet, une solution a √©t√© trouv√©e appel√©e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SamplerBox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . L'essence du projet est que vous pouvez connecter n'importe quel clavier MIDI √† la carte Raspberry Pi, qui traite les commandes MIDI du clavier et joue des sons ou change d'instruments, etc. Il ne reste plus qu'√† mettre la carte Raspberry Pi √† l'int√©rieur du corps du jouet, sans possibilit√© de remplacer la carte SD (sans d√©monter le bo√Ætier), configurer les boutons sur le corps du jouet pour qu'ils changent d'outils et ce sera suffisant pour laisser ce projet sous cette forme. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais tout cela se produira apr√®s la fin de la p√©riode d'auto-isolement.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'esp√®re que quelqu'un trouvera mon exp√©rience utile.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr500436/index.html">Arriv√©e de r√©seaux de neurones binaires bas√©s sur des neurones al√©atoires et des fonctions logiques</a></li>
<li><a href="../fr500438/index.html">SFTP et FTPS</a></li>
<li><a href="../fr500444/index.html">9 comp√©tences en programmation Python qui distinguent un d√©butant d'un exp√©riment√©</a></li>
<li><a href="../fr500446/index.html">Quelques mots sur R2DBC et PostgreSQL</a></li>
<li><a href="../fr500448/index.html">Prometheus: surveillance HTTP via l'exportateur Blackbox</a></li>
<li><a href="../fr500452/index.html">Raisonnement √©lev√© sur l'apprentissage profond</a></li>
<li><a href="../fr500454/index.html">"Quelles marinas?" ou nous contr√¥lons le contr√¥leur via Bluetooth en utilisant une application mobile sur Xamarin (Android)</a></li>
<li><a href="../fr500456/index.html">BpfTrace - enfin, un remplacement complet de Dtrace sur Linux</a></li>
<li><a href="../fr500458/index.html">Caract√©ristiques techniques de la parole en ligne: Pack de d√©marrage</a></li>
<li><a href="../fr500462/index.html">D√©tection des changements de sc√®ne et enregistrement des clips vid√©o h264 sur Raspberry Pi sans d√©codage</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>