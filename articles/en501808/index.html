<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòî ü§úüèΩ üëô The list of changes in D 2.092. Borrowing Borrowing ü§∏üèΩ üí† üî´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From the translator. I usually don‚Äôt translate such articles, because I don‚Äôt see anything interesting in them. Here, two small, but most important in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>The list of changes in D 2.092. Borrowing Borrowing</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501808/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From the translator. </font><font style="vertical-align: inherit;">I usually don‚Äôt translate such articles, because I don‚Äôt see anything interesting in them. </font><font style="vertical-align: inherit;">Here, two small, but most important innovations - support for direct linking of C ++ libraries and the ‚Äúborrowed‚Äù system of ownership and borrowing from Rust (the second is the DFA swallow, the first came out in GCC10 just a couple of days ago, and Nim also thinks about it like that) with a description. </font><font style="vertical-align: inherit;">Actually, I did not translate any tedious lists, and the links lead to the original. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Previous version of the list 2.0.91.1 (eng) </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Where to download</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
2.092.0 came out with 15 important changes and 44 bug fixes and improvements. </font><font style="vertical-align: inherit;">Many thanks to the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">47 contributors</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> who made this release possible.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compiler changes</font></font></h4><a name="habracut"></a><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The </font><b><font style="vertical-align: inherit;">-revert = </font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-transition = checkimports</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> command line </font><b><font style="vertical-align: inherit;">switches</font></b><font style="vertical-align: inherit;"> removed</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Added support for coding (mangling) of C ++ GNU ABI names</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Constructors and destructors for modules that are not </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extern (D)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are marked obsolete</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DIP25 Violations Marked By Default Obsolete</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prototype Ownership and Borrowing System for Pointers</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Added </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-preview = in option that</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> turns the storage class </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> into </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scope const</font></font></b></li>
<li><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Printf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scanf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parameters </font><font style="vertical-align: inherit;">are now checked for compliance with format specifiers</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The environment variable </font><b><font style="vertical-align: inherit;">SOURCE_DATE_EPOCH is</font></b><font style="vertical-align: inherit;"> now supported.</font></font><b><font style="vertical-align: inherit;"></font></b></li>
</ol><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Runtime changes</font></font></h4><br>
<ol>
<li> <b>TypeInfo_Class/TypeInfo_Interface.isBaseOf</b>  C#/Java <b>isAssignableFrom</b></li>
<li> <b>core.memory.pageSize</b>  <b>minimumPageSize</b></li>
</ol><br>
<h4> </h4><br>
<ol>
<li> <b>Date.isoWeekYear</b>  <b>Date.fromISOWeek</b>  <b>std.datetime.date</b></li>
<li> <b>std.xml</b>  </li>
<li>   <b>std.digest.digest</b> </li>
</ol><br>
<h4>   Dub</h4><br>
<ol>
<li>   </li>
<li>Dub lint    <b>--report-file</b></li>
</ol><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A complete list of corrections and improvements (Eng.)</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Note.I have paws, therefore, it‚Äôs not possible to set up correct intra-page links from the table of contents to disclose the topics in the original, sorry = (</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compiler changes</font></font></h4><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The command line switches </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-revert = import</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-transition = checkimports have</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> been deleted. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
These keys did not do anything, and for some time they were marked obsolete. </font><font style="vertical-align: inherit;">The compiler will no longer recognize them.</font></font></li>
<li>   ()  C++ GNU ABI<br>
<br>
 GNU ABI   C++11  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"> GCC 5.1</a>.     D  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">  C++</a>, DMD    UDA ( ) <b>gnuAbiTag</b>,   <b>core.attribute</b>      <b>object</b> (         ). ABI    ,     ,       ++ .  ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">std::string</a>     C++11   (DMD  <b>-extern-std={c++11,c++14,c++17}</b>).<br>
<br>
  : <br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">extern</span>(C++):<font></font>
@gnuAbiTag(<span class="hljs-string">"tagOnStruct"</span>)
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MyStruct</span> {</span>}<font></font>
@gnuAbiTag(<span class="hljs-string">"Multiple"</span>, <span class="hljs-string">"Tags"</span>, <span class="hljs-string">"On"</span>, <span class="hljs-string">"Function"</span>)
<span class="hljs-function">MyStruct <span class="hljs-title">func</span><span class="hljs-params">()</span></span>;</code></pre><br>
      gnuAbiTag.     (  ). UDA        <b>-extern-std=c++11</b>.   (<b>-extern-std=c++98</b>) UDA . UDA    extern(C++)        .</li>
<li>    ,   <b>extern(D)</b>  .<br>
<br>
    (    )     ,   <b>extern(D)</b>,     .       ,    ,     /     , ,        <b> </b>   479,     <b> </b>    479,      .<br>
<br>
 ,      ,          .</li>
<li> DIP25    .<br>
<br>
DIP25    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">2.067.0</a>,    ,       -preview=dip25.          , , DIP1000.<br>
<br>
   , ,         <b>-preview=dip25</b>,          <b>-preview=dip25</b>.     (    ).<br>
<br>
DIP25   ,  <b>@ safe</b>       .     ,   <b>ref </b>  ,   <b>return </b>    ,   .<br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Foo</span>
{</span>
    <span class="hljs-keyword">int</span> x;
    <span class="hljs-comment">// returning `this.x` escapes a reference to parameter `this`, perhaps annotate with `return`</span>
    <span class="hljs-function">ref <span class="hljs-keyword">int</span> <span class="hljs-title">method</span><span class="hljs-params">()</span> <span class="hljs-comment">/* return */</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.x; }<font></font>
}<font></font>
<span class="hljs-comment">// returning `v` escapes a reference to parameter `v`, perhaps annotate with `return`</span>
<span class="hljs-function">ref <span class="hljs-keyword">int</span> <span class="hljs-title">identity</span><span class="hljs-params">(<span class="hljs-comment">/* return */</span> ref <span class="hljs-keyword">int</span> v)</span> </span>{ <span class="hljs-keyword">return</span> v; }</code></pre><br>
    <b>return </b> .   DIP25   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"></a>.</li>
<li>  <b>-preview=in</b>    <b>in</b>  <b>scope const</b>.<br>
<br>
      <b>const scope</b>,   <b>in </b>        .   , <b>in </b>       (.  inout )  .<br>
<br>
  <b>-preview=in</b>,    :<br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">fun</span><span class="hljs-params">(in <span class="hljs-keyword">int</span> x)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">fun</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> x)</span></span>;</code></pre><br>
  <b>-preview=in</b>,    :<br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">fun</span><span class="hljs-params">(in <span class="hljs-keyword">int</span> x)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">fun</span><span class="hljs-params">(scope <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> x)</span></span>;</code></pre></li>
<li> <b>printf</b>  <b>scanf</b>      <br>
<br>
  C99 7.19.6.1  printf  7.19.6.2  scanf.<br>
<br>
 printf   ,     . ,         .<br>
<br>
 scanf     .<br>
<br>
  :<br>
<br>
<ol>
<li> ,      </li>
<li> ,    </li>
<li>  </li>
<li> </li>
<li>   </li>
<li> ‚Äî  ,    s</li>
<li> </li>
<li>     C99</li>
</ol><br>
 -,   .<br>
<br>
        .<br>
<br>
 ,     printf/scanf,    :<br>
<br>
<pre><code class="cpp hljs"><span class="hljs-built_in">printf</span>(<span class="hljs-string">"%k\n"</span>, value);  <span class="hljs-comment">// error: non-Standard format k</span>
<span class="hljs-keyword">const</span> format = <span class="hljs-string">"%k\n"</span>;
<span class="hljs-built_in">printf</span>(format.ptr, value);  <span class="hljs-comment">// no error</span></code></pre><br>
   ‚Äî    . ,<br>
<br>
<pre><code class="cpp hljs"><span class="hljs-built_in">string</span> s;
<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%.*s\n"</span>, s.length, s.ptr);
<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, s.<span class="hljs-keyword">sizeof</span>);<font></font>
ulong u;<font></font>
<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%lld%*c\n"</span>, &amp;u);</code></pre><br>
  :<br>
<br>
<pre><code class="cpp hljs"><span class="hljs-built_in">string</span> s;
<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%.*s\n"</span>, cast(<span class="hljs-keyword">int</span>) s.length, s.ptr);
<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%zd\n"</span>, s.<span class="hljs-keyword">sizeof</span>);<font></font>
ulong u;<font></font>
<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%llu%*c\n"</span>, &amp;u);</code></pre><br>
  printf  scanf       <b>pragma(printf)</b>    printf  <b>pragma(scanf)</b>    scanf.<br>
<br>
 ,     :<br>
<br>
<ol>
<li> <b>extern (C )</b>  <b>extern (C++)</b></li>
<li>     <b>const(char)*</b></li>
<li>    ‚Ä¶  -v ,     <b>va_list </b> (    ¬´v¬ª  <b>printf  scanf</b>)</li>
</ol>         .<br>
<br>
   ¬´v¬ª-   .<br>
</li>
<li>    <b>SOURCE_DATE_EPOCH</b><br>
<br>
 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"> </a>    SOURCE_DATE_EPOCH.    UNIX (  1970-01-01 00:00:00),   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"></a>.  DMD       __DATE__, __TIME__  __TIMESTAMP__ .</li>
</ol><br>
<br>
<h3>      </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The ownership / borrowing system (also known as OB) for pointers ensures that dereferenced pointers point to a valid memory object.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scope of the prototype OB system</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is a prototype of the OB system, adapted for D. Initially, it is intended only for pointers, and not for dynamic arrays, class references, references or pointer fields in aggregates. </font><font style="vertical-align: inherit;">Adding support of this kind will complicate the implementation, but does not change its essence, therefore, it is postponed for later. </font><font style="vertical-align: inherit;">RAII objects can safely manage their own memory, so they are not covered by OB. </font><font style="vertical-align: inherit;">Regardless of the method, whether the pointer allocates memory using GC or some other allocator, this is not important for OB, they do not differ and are processed identically. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The OB system is active only in functions annotated with the </font><b><font style="vertical-align: inherit;">@ live</font></b><font style="vertical-align: inherit;"> attribute</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">It is applied after semantic processing solely as a check for violation of the rules of organic substances. </font><font style="vertical-align: inherit;">New syntax is not added. </font><font style="vertical-align: inherit;">No changes are made to the generated code. </font><font style="vertical-align: inherit;">If </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ live</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> functions call functions other than </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ live</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , it is expected that these called functions will be an </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ live-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> compatible interface, although it is not tested. </font><font style="vertical-align: inherit;">If non- </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ live</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> functions call </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ live</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> functions </font><font style="vertical-align: inherit;">, the arguments passed are expected to follow </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ live</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conventions </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The OB system detects errors:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dereferencing pointers that are in an invalid state</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">more than one active pointer to a mutated memory object.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It will not detect attempts to dereference a null pointer or, potentially, a null pointer. </font><font style="vertical-align: inherit;">This does not work, since there is currently no method for annotating a type as a non-nullable pointer.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The basic principle of OB</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OB design follows from the following principle: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For each memory object, there can be exactly one mutating pointer to it, or several non-mutating (read-only) pointers.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Design</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A single mutating pointer is called the "owner" of the memory object. He transitively owns a memory object and all the objects in memory accessible from it (i.e. the graph of objects). Since it is the only pointer to this memory object, it can safely manage the memory (change its shape, allocate, free and resize) without knocking the soil out under the feet of any other pointers (mutating or not) that may be on it (graph memory) indicate. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If there are several pointers to a graph of memory objects that are read-only, then they can safely read from it without worrying about sudden changes in the graph of objects in memory.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The rest of the technology‚Äôs details relate to how pointers become read-only and invalid, and how the Core Principle of OB is constantly maintained. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tracked pointers</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Only those pointers that are declared in the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ live</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">as </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , function parameters, or local variables are </font><font style="vertical-align: inherit;">tracked </font><font style="vertical-align: inherit;">. Variables from other functions are not tracked, even </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ live</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , since the analysis of interactions with other functions completely depends only on the signature of this function, and not on its internals. Parameters that are </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are not tracked. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pointer states</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Each pointer is in one of the following states: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Undefined</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The pointer is in an invalid state. Dereferencing such a pointer is a mistake. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Owner The</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
owner is the only pointer to a graph of objects in memory. Usually a pointer - Owner does not have a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scope</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> attribute </font><font style="vertical-align: inherit;">. If the pointer with the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scope</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> attribute is </font><font style="vertical-align: inherit;">initialized with an expression that is not derived from the tracked pointer, then it becomes the Owner. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the Owner pointer is assigned to another pointer - the Owner, then the first goes into the Undefined state. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Borrowed</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A borrowed pointer is a pointer that temporarily becomes the only pointer to a graph of memory objects. He passes into this state through assignment from the pointer - the Owner, while the Owner passes into the state of the Borrower until the use of the borrowed pointer is completed. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A borrowed pointer must have a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scope</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> attribute </font><font style="vertical-align: inherit;">and be a pointer to a mutable object. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Read-</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Only The </font><i><font style="vertical-align: inherit;">Read-</font></i><font style="vertical-align: inherit;"> Only Index is assigned by the Owner. As long as the Read-Only pointer is alive, only Read-Only pointers can still be assigned from this Owner. The read-only pointer must have a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scope</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> attribute </font><font style="vertical-align: inherit;">, and it must also not be a pointer to a mutable object. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lifetimes</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The lifetime of the "Borrowed" or "Read-only" indicator starts from the moment it is first dereferenced (and not from the moment it is initialized or assigned a value) and ends when the value is dereferenced last. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is also known as </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Non-Lexical Lifetimes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">State transitions for pointers</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
A pointer changes its state when one of these operations is performed:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memory is allocated for it (for example, a local variable on the stack), which places the pointer in an undefined state</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">initialization (considered as assignment)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assignment - the source and target pointers change state depending on what states they are in, as well as on their types and storage classes</font></font></li>
<li>   <b>out</b> (    ),   ,   .</li>
<li>  <b>ref </b> ,          ,        .</li>
<li> </li>
<li>    ,      .</li>
<li>       - ()</li>
<li>  ,     ,   .</li>
<li>      ,     ,    </li>
<li>        ,     ,    </li>
<li>         ,       </li>
</ul><br>
<h4></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a prototype, there are many aspects that have not yet been considered, and will not be until the prototype shows that this is a workable solution. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mistakes</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Expect many mistakes. Please report them to bugzilla and tag with the keyword ‚Äúob‚Äù. There is no need to report other restrictions that are already listed here. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">References to classes and associative arrays are not tracked.</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
It is assumed that they are controlled by the GC. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Borrowing and reading from non-Owners</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Owners are monitored for leaks, but not other indicators. Borrowers are considered Owners if they are not initialized with a pointer.</font></font><br>
<br>
<pre><code class="cpp hljs">@<span class="hljs-function">live <span class="hljs-keyword">void</span> <span class="hljs-title">uhoh</span><span class="hljs-params">()</span>
</span>{<font></font>
    scope p = <span class="hljs-built_in">malloc</span>();  <span class="hljs-comment">// p is considered an Owner</span>
    scope <span class="hljs-keyword">const</span> pc = <span class="hljs-built_in">malloc</span>(); <span class="hljs-comment">// pc is not considered an Owner</span>
} <span class="hljs-comment">// dangling pointer pc is not detected on exit</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It would seem that it makes no sense to mark pointers such as </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scope</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , perhaps this can be fixed by treating this as an error. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pointers are read / written by nested functions.</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Not tracked.</font></font><br>
<br>
<pre><code class="cpp hljs">@<span class="hljs-function">live <span class="hljs-keyword">void</span> <span class="hljs-title">ohno</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">auto</span> p = <span class="hljs-built_in">malloc</span>();<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sneaky</span><span class="hljs-params">()</span> </span>{ <span class="hljs-built_in">free</span>(p); }<font></font>
<font></font>
    sneaky();<font></font>
    <span class="hljs-built_in">free</span>(p);  <span class="hljs-comment">// double free not detected</span>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exceptions</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Analysis assumes that exceptions are not thrown.</font></font><br>
<br>
<pre><code class="cpp hljs">@<span class="hljs-function">live <span class="hljs-keyword">void</span> <span class="hljs-title">leaky</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">auto</span> p = <span class="hljs-built_in">malloc</span>();<font></font>
    pitcher();  <span class="hljs-comment">// throws exception, p leaks</span>
    <span class="hljs-built_in">free</span>(p);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One solution is to use </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scope (exit)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs">@<span class="hljs-function">live <span class="hljs-keyword">void</span> <span class="hljs-title">waterTight</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">auto</span> p = <span class="hljs-built_in">malloc</span>();<font></font>
    scope(<span class="hljs-built_in">exit</span>) <span class="hljs-built_in">free</span>(p);<font></font>
    pitcher();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
either use RAII objects or only call nothrow functions. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy parameters</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Not taken into account. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quadratic complexity The</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
analysis demonstrates quadratic complexity, try to keep </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ live</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> functions </font><font style="vertical-align: inherit;">small. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mixing different memory groups</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Combining different memory pools:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span>* <span class="hljs-title">xmalloc</span><span class="hljs-params">(<span class="hljs-keyword">size_t</span>)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">xfree</span><span class="hljs-params">(<span class="hljs-keyword">void</span>*)</span></span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span>* <span class="hljs-title">ymalloc</span><span class="hljs-params">(<span class="hljs-keyword">size_t</span>)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">yfree</span><span class="hljs-params">(<span class="hljs-keyword">void</span>*)</span></span>;<font></font>
<font></font>
<span class="hljs-keyword">auto</span> p = xmalloc(<span class="hljs-number">20</span>);<font></font>
yfree(p);  <span class="hljs-comment">// should call xfree() instead</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
not detected. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This can be circumvented by using pools specific to a particular type:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">U* <span class="hljs-title">umalloc</span><span class="hljs-params">()</span></span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ufree</span><span class="hljs-params">(U*)</span></span>;<font></font>
<font></font>
<span class="hljs-function">V* <span class="hljs-title">vmalloc</span><span class="hljs-params">()</span></span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">vfree</span><span class="hljs-params">(V*)</span></span>;<font></font>
<font></font>
<span class="hljs-keyword">auto</span> p = umalloc();<font></font>
vfree(p);  <span class="hljs-comment">// type mismatch</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
and possibly disallow implicit conversions to </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void *</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ live</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> functions </font><font style="vertical-align: inherit;">. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arguments of a variadic function</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Arguments to a variadic function (for example, printf) are considered consumed. </font><font style="vertical-align: inherit;">While this is safe, it does not seem to be very practical and will likely require a review.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Runtime changes</font></font></h4><br>
<ol>
<li> <b>TypeInfo_Class/TypeInfo_Interface.isBaseOf</b>  C#/Java <b>isAssignableFrom</b>.<br>
<br>
<b>TypeInfo_Class.isBaseOf</b>  true,        ,  ,   ,  .   <b>isBaseOf</b>,   <b>isAssignableFrom</b>,     ,   opAssign               D ‚Äî . <b>TypeInfo_Interface.isBaseOf</b>    ,      <b>TypeInfo_Class</b>,  <b>TypeInfo_Interface</b>.</li>
<li> <b>core.memory.pageSize</b>  <b>minimumPageSize</b>.<br>
<br>
<b>pageSize </b>     .<br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">import</span> core.memory : pageSize;<font></font>
ubyte[] buffer = <span class="hljs-keyword">new</span> ubyte[pageSize];</code></pre><br>
<b>minimumPageSize </b>      .<br>
<br>
   ,   .     ,     .      <b>pageSize</b>,     .<br>
<br>
  ,        , ,    : <b>ubyte[minimumPageSize]</b>.<br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">import</span> core.memory : minimumPageSize;<font></font>
ubyte[minimumPageSize] buffer;</code></pre><br>
</li>
</ol><br>
<h4> </h4><br>
<ol>
<li> <b>Date.isoWeekYear</b>  <b>Date.fromISOWeek</b>  <b>std.datetime.date</b><br>
<br>
      ISO 8601   ,    Date and DateTime.<br>
<br>
    ISO   ,     . <b>Date.fromISOWeek(2020, 11, DayOfWeek.mon)</b>   <b>Date(2020, 3, 9).</b><br>
<br>
          ISO   ,    () <b>.isoWeekYear</b>     <b>Date </b>   ISO.      ,    <b>.isoWeekAndYear</b>     ,      .</li>
<li> <b>std.xml</b>  .<br>
<br>
 <b>std.xml</b>  .  ,      ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">UndeaD</a>.   xml     dub- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">dxml</a>.</li>
<li>   <b>std.digest.digest</b> .<br>
<br>
    2.076.1     .    <b>std.digest</b>   .<br>
<br>
     <b>std.digest.digest</b>       2.101.</li>
</ol><br>
<h4>   Dub</h4><br>
<ol>
<li>   .<br>
<br>
      Posix   ,  <b>.dub</b>.   dub    (, <b>.swap.file.d</b>),    .      ,  dub  .        ,             dub.<br>
<br>
 ,            .</li>
<li>Dub lint    <b>--report-file</b>.<br>
<br>
Dub lint      --report-file: <b>dub lint --report-file report.json</b></li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en501796/index.html">7 dangerous mistakes that are easy to make in C # /. NET</a></li>
<li><a href="../en501798/index.html">C++/Qt: –ø–æ—Ä–∞ –≤–∞–ª–∏—Ç—å?.</a></li>
<li><a href="../en501800/index.html">Small osinta session on modernization and production of radio communication systems for the Armed Forces of the Russian Federation</a></li>
<li><a href="../en501804/index.html">Dart. Everything you need to know about constants</a></li>
<li><a href="../en501806/index.html">ACS: problems, solutions and security risk management</a></li>
<li><a href="../en501810/index.html">Cool 3D shooters on an ancient laptop: a test of the cloud gaming platform GFN.RU</a></li>
<li><a href="../en501812/index.html">Python Telegram Pagination Bot</a></li>
<li><a href="../en501814/index.html">COVID changes: stories of StartupDrive members that have changed and become stronger during a pandemic</a></li>
<li><a href="../en501820/index.html">Integration of Netflow and SIEM Monitoring Solutions</a></li>
<li><a href="../en501822/index.html">Third Generation Engineer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>