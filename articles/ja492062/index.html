<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤¶ ğŸ© ğŸ§˜ğŸ¿ Golangãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ-ãƒ‘ãƒ¼ãƒˆ1ï¼ˆHTTPã‚µãƒ¼ãƒãƒ¼ï¼‰ ğŸ« ğŸ‘¨ğŸ½â€ğŸ¤â€ğŸ‘¨ğŸ» ğŸ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä»¥ä¸‹ã®Golangã‚µãƒ¼ãƒãƒ¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã€ãƒãƒ¼ãƒ å†…ã§çŸ¥è­˜ã‚’ä¼é”ã™ã‚‹ãŸã‚ã«æº–å‚™ã•ã‚ŒãŸã‚‚ã®ã§ã™ã€‚ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ä¸»ãªç›®çš„ã¯ã€ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã«åŠ ãˆã¦ã€Goã§å°ã•ãªã‚µãƒ¼ãƒãƒ¼ã‚¿ã‚¹ã‚¯ã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‚’ä½œæˆã™ã‚‹æ™‚é–“ã‚’çŸ­ç¸®ã™ã‚‹ã“ã¨ã§ã™ã€‚
 

ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«å«ã¾ã‚Œã‚‹ã‚‚ã®ï¼š
 

- github.com/urfave/c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Golangãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ-ãƒ‘ãƒ¼ãƒˆ1ï¼ˆHTTPã‚µãƒ¼ãƒãƒ¼ï¼‰</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492062/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä¸‹ã®Golangã‚µãƒ¼ãƒãƒ¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã€ãƒãƒ¼ãƒ å†…ã§çŸ¥è­˜ã‚’ä¼é”ã™ã‚‹ãŸã‚ã«æº–å‚™ã•ã‚ŒãŸã‚‚ã®ã§ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ä¸»ãªç›®çš„ã¯ã€ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã«åŠ ãˆã¦ã€Goã§å°ã•ãªã‚µãƒ¼ãƒãƒ¼ã‚¿ã‚¹ã‚¯ã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‚’ä½œæˆã™ã‚‹æ™‚é–“ã‚’çŸ­ç¸®ã™ã‚‹ã“ã¨ã§ã™ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«å«ã¾ã‚Œã‚‹ã‚‚ã®ï¼š</font></font></p><br>
<ul>
<li><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">github.com/urfave/cli</font></a><font style="vertical-align: inherit;">ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’ä»‹ã—ã¦ã‚µãƒ¼ãƒãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’æ¸¡ã™</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a></li>
<li><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">github.com/sasbury/mini</font></a><font style="vertical-align: inherit;">æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ˆã‚‹ã‚µãƒ¼ãƒãƒ¼è¨­å®šã®æ§‹æˆ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TLS HTTPã‚µãƒ¼ãƒãƒ¼è¨­å®šã®æ§‹æˆ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTPã¨prof-handlers </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">github.com/gorilla/muxã‚’</font></a><font style="vertical-align: inherit;">ç™»éŒ²ã™ã‚‹ãƒ«ãƒ¼ã‚¿ãƒ¼ã®æ§‹æˆ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a></li>
<li><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">github.com/hashicorp/logutils</font></a><font style="vertical-align: inherit;">ã‚µãƒ¼ãƒãƒ¼ã‚’åœæ­¢ã›ãšã«ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã‚’è¨­å®šã™ã‚‹</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚µãƒ¼ãƒãƒ¼ã‚’åœæ­¢ã›ãšã«HTTPãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒ­ã‚®ãƒ³ã‚°ã‚’æ§‹æˆã™ã‚‹</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚µãƒ¼ãƒãƒ¼ã‚’åœæ­¢ã›ãšã«HTTPå¿œç­”ã®ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’è¨­å®šã™ã‚‹</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTPåŸºæœ¬èªè¨¼</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS ADèªè¨¼</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gopkg.in/korylprince/go-ad-auth.v2</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON Webãƒˆãƒ¼ã‚¯ãƒ³</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/dgrijalva/jwt-go</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¨ãƒ©ãƒ¼ãƒãƒ£ãƒãƒ«ã¸ã®å¾©å¸°ã‚’æœŸå¾…ã—ã¦ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½¿ç”¨ã—ã¦ã‚µãƒ¼ãƒãƒ¼ã¨é–¢é€£ã‚µãƒ¼ãƒ“ã‚¹ã‚’é©åˆ‡ã«åœæ­¢ã™ã‚‹</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼å‡¦ç†ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/pkg/errors</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚«ã‚¹ã‚¿ãƒ ãƒ­ã‚°è¨­å®š</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ãƒ“ãƒ«ãƒ‰æ—¥ä»˜ã€ãŠã‚ˆã³ã‚³ãƒŸãƒƒãƒˆã§ãƒ“ãƒ«ãƒ‰</font></font></li>
</ul><br>
<p><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://github.com/romapres2010/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒªãƒã‚¸ãƒˆãƒª</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¸</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://github.com/romapres2010/" rel="nofollow"><font style="vertical-align: inherit;">ã®</font></a><font style="vertical-align: inherit;">ãƒªãƒ³ã‚¯</font><font style="vertical-align: inherit;">ã€‚</font></font></p><br>
<p>   HTTP  (. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  HTTP   Golang</a>): </p><br>
<ul>
<li>POST /echo â€”  request HTTP  body  response</li>
<li>POST /signin â€”    JSON Web Token  Cookie</li>
<li>POST /refresh â€”    JSON Web Token  Cookie</li>
<li>POST /httplog â€”   HTTP </li>
<li>POST /httperrlog â€”     HTTP response</li>
<li>POST /loglevel â€”    DEBUG, INFO, ERROR<a name="habracut"></a></li>
</ul><br>
<h2 id="soderzhanie-stati"> </h2><br>
<ol>
<li></li>
<li>  <br>
2.2.  <br>
2.3.   </li>
<li>,    <br>
3.1.  daemon  <br>
3.2.  daemon  <br>
3.3.  daemon  </li>
<li> <br>
4.1.   <br>
4.2.   <br>
4.3.  <br>
4.4.     </li>
<li><br>
5.1.  <br>
5.2.  <br>
5.3.  <br>
5.4.   HTTP  </li>
<li> </li>
<li>   <br>
7.1.  go mod<br>
7.2.   </li>
</ol><br>
<h2 id="1-predystoriya">1. </h2><br>
<p>   1:ERP,    â€”  1   IBM MQ.<br>
      IBM MQ :</p><br>
<ul>
<li>    IBM MQ (, ,  )</li>
<li>     IBM MQ    </li>
<li>      IBM MQ (SYNCPOINT)</li>
</ul><br>
<p>      XML :</p><br>
<ul>
<li> ()    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">RFC 3076</a></li>
<li>         HMAC  - -34.11.94</li>
<li>       HMAC</li>
</ul><br>
<p>   1C  IBM MQ  .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">REST API  IBM MQ</a>    .</p><br>
<p> 1C  IBM MQ     Go     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">IBM MQ</a>.    ,    ,       ""   C .         2     [].</p><br>
<p>    backend ,    .</p><br>
<p>  1  IBM MQ     . </p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/98f/2f9/94a/98f2f994abac724cbf0131598e220a3f.jpg" alt="REST_IBMMQ"></p><br>
<h2 id="2-peredacha-parametrov-serveru">2.   </h2><br>
<h3 id="21-komandnaya-stroka">2.1.  </h3><br>
<p> ,    ,      .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">github.com/urfave/cli</a>.   :</p><br>
<pre><code class="plaintext hljs">   --httpconfig value, --httpcfg value    HTTP Config file name<font></font>
   --listenstring value, -l value         Listen string in format &lt;host&gt;:&lt;port&gt;<font></font>
   --httpuser value, --httpu value        User name for access to HTTP server<font></font>
   --httppassword value, --httppwd value  User password for access to HTTP server<font></font>
   --jwtkey value, --jwtk value           JSON web token secret key<font></font>
   --debug value, -d value                Debug mode: DEBUG, INFO, ERROR<font></font>
   --logfile value, --log value           Log file name</code></pre><br>
<h3 id="22-konfiguracionnyy-fayl">2.2.  </h3><br>
<p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">github.com/sasbury/mini</a>.   ,   :</p><br>
<pre><code class="plaintext hljs">[HTTP_SERVER]<font></font>
ReadTimeout = 6000          // HTTP read timeout duration in sec - default 60 sec<font></font>
WriteTimeout = 6000         // HTTP write timeout duration in sec - default 60 sec<font></font>
IdleTimeout = 6000          // HTTP idle timeout duration in sec - default 60 sec<font></font>
MaxHeaderBytes = 262144     // HTTP max header bytes - default 1 MB<font></font>
MaxBodyBytes = 1048576      // HTTP max body bytes - default 0 - unlimited<font></font>
UseProfile = false          // use Go profiling<font></font>
ShutdownTimeout = 30        // service shutdown timeout in sec - default 30 sec<font></font>
<font></font>
[TLS]<font></font>
UseTLS = false                  // use SSL<font></font>
UseHSTS = false                 // use HTTP Strict Transport Security<font></font>
TLSertFile = certs/server.pem  // TLS Certificate file name<font></font>
TLSKeyFile = certs/server.key   // TLS Private key file name<font></font>
TLSMinVersion = VersionTLS10    // TLS min version VersionTLS13, VersionTLS12, VersionTLS11, VersionTLS10, VersionSSL30<font></font>
TLSMaxVersion = VersionTLS12    // TLS max version VersionTLS13, VersionTLS12, VersionTLS11, VersionTLS10, VersionSSL30<font></font>
<font></font>
[JWT]<font></font>
UseJWT = false                  // use JSON web token (JWT)<font></font>
JWTExpiresAt = 20000            // JWT expiry time in seconds - 0 without restriction<font></font>
<font></font>
[AUTHENTIFICATION]<font></font>
AuthType = INTERNAL             // Autehtification type NONE | INTERNAL | MSAD<font></font>
MSADServer = company.com        // MS Active Directory server<font></font>
MSADPort = 389                  // MS Active Directory Port<font></font>
MSADBaseDN = OU=, DC=, DC=      // MS Active Directory BaseDN<font></font>
MSADSecurity = SecurityNone     // MS Active Directory Security: SecurityNone, SecurityTLS, SecurityStartTLS<font></font>
<font></font>
[LOG]<font></font>
HTTPLog = false                         // Log HTTP traffic<font></font>
HTTPLogType = INREQ                     // HTTP trafic log mode INREQ | OUTREQ | INRESP | OUTRESP | BODY<font></font>
HTTPLogFileName = ./httplog/http%s.log  // HTTP log file<font></font>
HTTPErrLog = HEADER | BODY              // Log error into HTTP response header and body</code></pre><br>
<h2 id="3-sozdanie-zapusk-i-ostanovka-servera">3. ,    </h2><br>
<p>     UML      .</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/8f8/411/4d4/8f84114d4c15736824585f789d6c8af3.png" alt="http_server_run_stop"></p><br>
<p>  ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://github.com/romapres2010/" rel="nofollow">daemon</a>.    : </p><br>
<ul>
<li>  </li>
<li>  </li>
<li>  context.Context</li>
<li>       </li>
<li>  </li>
<li>  </li>
<li>   /   </li>
<li>  </li>
</ul><br>
<h3 id="31-sozdanie-daemon-i-servisov">3.1.  daemon  </h3><br>
<p>  ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://github.com/romapres2010/" rel="nofollow">daemon</a>.<br>
      ,  daemon  .<br>
      ,   daemon      :</p><br>
<pre><code class="go hljs">httpserverErrCh: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> error, <span class="hljs-number">1</span>), <span class="hljs-comment">//   HTTP </span></code></pre><br>
<p>  ,   :</p><br>
<ul>
<li> daemon â€”        </li>
<li>  â€”       daemon    </li>
<li>    </li>
</ul><br>
<p>    :</p><br>
<ul>
<li>    IBM MQ: <br>
<ul>
<li>  </li>
<li>  </li>
<li>     IBM MQ,       ,     </li>
<li>     IBM MQ</li>
</ul></li>
<li>    PostgreSQL:<br>
<ul>
<li>  </li>
<li>  </li>
<li>  </li>
<li>,  , SQL </li>
</ul></li>
<li>   JSON  BoltDB:<br>
<ul>
<li>  </li>
<li>  </li>
<li>  BoltDB  </li>
<li>        (     PostgreSQL).         ,      (     BoltDB  150    2   64   ,  BoltDB   NVMe      0.03 ms).</li>
</ul></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://github.com/romapres2010/httpserver/blob/master/httpserver/" rel="nofollow">HTTP </a>:<br>
<ul>
<li>  </li>
<li>  </li>
<li>   http.server</li>
<li> TCP </li>
<li>  TLS</li>
<li>  </li>
<li> HTTP </li>
<li> pprof </li>
</ul></li>
</ul><br>
<h3 id="32-zapusk-daemon-i-servisov">3.2.  daemon  </h3><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://github.com/romapres2010/" rel="nofollow">daemon</a>     .<br>
       ,    â€” , ,     ,   .<br>
    ,        . ,  HTTP </p><br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> { httpserverErrCh &lt;- d.httpserver.Run() }()</code></pre><br>
<p>  , daemon                  .<br>
 daemon   , ,  -      .      ,    (   )    .<br>
,    IBM MQ  ,  daemon       IBM MQ   .</p><br>
<pre><code class="go hljs">syscalCh := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> os.Signal, <span class="hljs-number">1</span>) <span class="hljs-comment">//   </span><font></font>
signal.Notify(syscalCh, syscall.SIGINT, syscall.SIGTERM)<font></font>
<font></font>
<span class="hljs-comment">//       </span>
<span class="hljs-keyword">select</span> {
<span class="hljs-keyword">case</span> s := &lt;-syscalCh: <span class="hljs-comment">//  </span>
    mylog.PrintfInfoMsg(<span class="hljs-string">"Exiting, got signal"</span>, s)<font></font>
    d.Shutdown() <span class="hljs-comment">//  daemon</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
<span class="hljs-keyword">case</span> err := &lt;-d.httpserverErrCh: <span class="hljs-comment">//   HTTP    </span>
    mylog.PrintfErrorInfo(err) <span class="hljs-comment">//  </span>
    d.Shutdown() <span class="hljs-comment">//  daemon</span>
    <span class="hljs-keyword">return</span> err<font></font>
}</code></pre><br>
<p>  ,   ,       ( ).   ,        daemon.</p><br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Server)</span> <span class="hljs-title">Run</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> {
    <span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">var</span> myerr error<font></font>
        r := <span class="hljs-built_in">recover</span>()
        <span class="hljs-keyword">if</span> r != <span class="hljs-literal">nil</span> {<font></font>
            msg := <span class="hljs-string">"Recover from panic"</span>
            <span class="hljs-keyword">switch</span> t := r.(<span class="hljs-keyword">type</span>) {
            <span class="hljs-keyword">case</span> <span class="hljs-keyword">string</span>:<font></font>
                myerr = myerror.New(<span class="hljs-string">"8888"</span>, msg, t)
            <span class="hljs-keyword">case</span> error:<font></font>
                myerr = myerror.WithCause(<span class="hljs-string">"8888"</span>, msg, t)
            <span class="hljs-keyword">default</span>:<font></font>
                myerr = myerror.New(<span class="hljs-string">"8888"</span>, msg)<font></font>
            }<font></font>
            mylog.PrintfErrorInfo(myerr) <span class="hljs-comment">//  </span>
            s.errCh &lt;- myerr             <span class="hljs-comment">//       daemon</span><font></font>
        }<font></font>
    }()<font></font>
<font></font>
    <span class="hljs-comment">//  </span>
}</code></pre><br>
<h3 id="33-ostanovka-daemon-i-servisov">3.3.  daemon  </h3><br>
<p> daemon          .</p><br>
<p> ,   ,    :</p><br>
<ul>
<li>     ( ShutdownTimeout   )</li>
<li>  </li>
<li>            .    IBM MQ :<br>
<ul>
<li>   </li>
<li>  </li>
<li>    </li>
<li>  </li>
<li>     IBM MQ</li>
</ul></li>
<li>        stopCh</li>
</ul><br>
<p>      ,   :</p><br>
<ul>
<li>      .   ,        </li>
<li> ,   ,     ,   ,    </li>
</ul><br>
<pre><code class="go hljs"><span class="hljs-keyword">for</span> {
    <span class="hljs-keyword">select</span> {
    <span class="hljs-keyword">case</span> &lt;-ctx.Done(): <span class="hljs-comment">//    </span><font></font>
<font></font>
        <span class="hljs-comment">//  </span><font></font>
<font></font>
        s.stopCh &lt;- <span class="hljs-keyword">struct</span>{}{} <span class="hljs-comment">//     </span>
        <span class="hljs-keyword">return</span>
    <span class="hljs-keyword">default</span>:
        <span class="hljs-comment">//   </span><font></font>
    }<font></font>
}</code></pre><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://github.com/romapres2010/httpserver/blob/master/httpserver/" rel="nofollow">HTTP </a>    :</p><br>
<pre><code class="go hljs"><span class="hljs-comment">//        ShutdownTimeout</span>
cancelCtx, cancel := context.WithTimeout(s.ctx, time.Duration(s.cfg.ShutdownTimeout*<span class="hljs-keyword">int</span>(time.Second)))
<span class="hljs-keyword">defer</span> cancel()<font></font>
<font></font>
<span class="hljs-comment">//       ShutdownTimeout</span>
<span class="hljs-keyword">if</span> err := s.httpServer.Shutdown(cancelCtx); err != <span class="hljs-literal">nil</span> {
    <span class="hljs-keyword">return</span> err<font></font>
}<font></font>
<font></font>
s.httpService.Shutdown() <span class="hljs-comment">//   </span><font></font>
<font></font>
<span class="hljs-comment">//     HTTP </span>
s.stopCh &lt;- <span class="hljs-keyword">struct</span>{}{}</code></pre><br>
<h2 id="4-obrabotka-oshibok">4.  </h2><br>
<h3 id="41-kastomnaya-struktura-oshibki">4.1.   </h3><br>
<p>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">github.com/pkg/errors</a>.<br>
  ,        ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://github.com/romapres2010/" rel="nofollow"> </a>.</p><br>
<p>   :</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> Error <span class="hljs-keyword">struct</span> {<font></font>
    ID       <span class="hljs-keyword">uint64</span> <span class="hljs-comment">//   </span>
    Code     <span class="hljs-keyword">string</span> <span class="hljs-comment">//  </span>
    Msg      <span class="hljs-keyword">string</span> <span class="hljs-comment">//  </span>
    Caller   <span class="hljs-keyword">string</span> <span class="hljs-comment">// ,        </span>
    Args     <span class="hljs-keyword">string</span> <span class="hljs-comment">//  </span>
    CauseErr error  <span class="hljs-comment">//  - </span>
    CauseMsg <span class="hljs-keyword">string</span> <span class="hljs-comment">//   - </span>
    Trace    <span class="hljs-keyword">string</span> <span class="hljs-comment">//      </span>
}</code></pre><br>
<p>     ,      . ,   1  IBM MQ,   4   . ,    "8"   HTTP,  "7" â€”  IBM MQ.</p><br>
<p>Caller â€” ,        .  ,      .  :</p><br>
<pre><code class="plaintext hljs">httpserver.go:[209] - (*Server).Run()</code></pre><br>
<p>Caller  </p><br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">caller</span><span class="hljs-params">(depth <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">string</span></span> {<font></font>
    pc := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">uintptr</span>, <span class="hljs-number">15</span>)<font></font>
    n := runtime.Callers(depth+<span class="hljs-number">1</span>, pc)<font></font>
    frame, _ := runtime.CallersFrames(pc[:n]).Next()<font></font>
    idxFile := strings.LastIndexByte(frame.File, <span class="hljs-string">'/'</span>)<font></font>
    idx := strings.LastIndexByte(frame.Function, <span class="hljs-string">'/'</span>)<font></font>
    idxName := strings.IndexByte(frame.Function[idx+<span class="hljs-number">1</span>:], <span class="hljs-string">'.'</span>) + idx + <span class="hljs-number">1</span><font></font>
<font></font>
    <span class="hljs-keyword">return</span> frame.File[idxFile+<span class="hljs-number">1</span>:] + <span class="hljs-string">":["</span> + strconv.Itoa(frame.Line) + <span class="hljs-string">"] - "</span> + frame.Function[idxName+<span class="hljs-number">1</span>:] + <span class="hljs-string">"()"</span>
}</code></pre><br>
<p>Args â€”   ,        .    .</p><br>
<p>CauseErr  CauseMsg â€”    . ,       .</p><br>
<p>Trace â€”   .       .          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">github.com/pkg/errors</a>      '%+v'.      .</p><br>
<pre><code class="go hljs">fmt.Sprintf(<span class="hljs-string">"'%+v'"</span>, pkgerr.New(<span class="hljs-string">""</span>))</code></pre><br>
<h3 id="42-formatirovanie-pechati-oshibki">4.2.   </h3><br>
<p>   Error,     .</p><br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e *Error)</span> <span class="hljs-title">Error</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> {<font></font>
    mes := fmt.Sprintf(<span class="hljs-string">"ID=[%v], code=[%s], mes=[%s]"</span>, e.ID, e.Code, e.Msg)
    <span class="hljs-keyword">if</span> e.Args != <span class="hljs-string">""</span> {<font></font>
        mes = fmt.Sprintf(<span class="hljs-string">"%s, args=[%s]"</span>, mes, e.Args)<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> e.CauseMsg != <span class="hljs-string">""</span> {<font></font>
        mes = fmt.Sprintf(<span class="hljs-string">"%s, causemes=[%s]"</span>, mes, e.CauseMsg)<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> mes<font></font>
}</code></pre><br>
<p>    </p><br>
<pre><code class="plaintext hljs">ID=[1], code=[8004], mes=[Error message], args=['arg1', 'arg2', 'arg3']</code></pre><br>
<p>     </p><br>
<pre><code class="go hljs"><span class="hljs-comment">// %s    print the error code, message, arguments, and cause message.</span>
<span class="hljs-comment">// %v    in addition to %s, print caller</span>
<span class="hljs-comment">// %+v   extended format. Each Frame of the error's StackTrace will be printed in detail.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e *Error)</span> <span class="hljs-title">Format</span><span class="hljs-params">(s fmt.State, verb <span class="hljs-keyword">rune</span>)</span></span> {
    <span class="hljs-keyword">switch</span> verb {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'v'</span>:<font></font>
        fmt.Fprint(s, e.Error())<font></font>
        fmt.Fprintf(s, <span class="hljs-string">", caller=[%s]"</span>, e.Caller)
        <span class="hljs-keyword">if</span> s.Flag(<span class="hljs-string">'+'</span>) {<font></font>
            fmt.Fprintf(s, <span class="hljs-string">", trace=%s"</span>, e.Trace)
            <span class="hljs-keyword">return</span><font></font>
        }<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-string">'s'</span>:<font></font>
        fmt.Fprint(s, e.Error())<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-string">'q'</span>:<font></font>
        fmt.Fprint(s, e.Error())<font></font>
    }<font></font>
}</code></pre><br>
<p>    '%+v'</p><br>
<pre><code class="plaintext hljs">ID=[1], code=[8004], mes=[Error message], args=['arg1', 'arg2', 'arg3'], caller=[handler_echo.go:[31] - (*Service).EchoHandler.func1()], trace='<font></font>
github.com/romapres2010/httpserver/error.New<font></font>
        D:/golang/src/github.com/romapres2010/httpserver/error/error.go:72<font></font>
github.com/romapres2010/httpserver/httpserver/httpservice.(*Service).EchoHandler.func1<font></font>
        D:/golang/src/github.com/romapres2010/httpserver/httpserver/httpservice/handler_echo.go:31<font></font>
        ...</code></pre><br>
<p>        .           .<br>
     â€”       Format.</p><br>
<h3 id="43-registraciya-oshibok">4.3.  </h3><br>
<p>     :</p><br>
<ul>
<li>  </li>
</ul><br>
<pre><code class="go hljs">New(code <span class="hljs-keyword">string</span>, msg <span class="hljs-keyword">string</span>, args ...<span class="hljs-keyword">interface</span>{}) error</code></pre><br>
<ul>
<li>  </li>
</ul><br>
<pre><code class="go hljs">WithCause(code <span class="hljs-keyword">string</span>, msg <span class="hljs-keyword">string</span>, causeErr error, args ...<span class="hljs-keyword">interface</span>{}) error</code></pre><br>
<p>       ,      args ...interface{}.</p><br>
<p>             .     , :</p><br>
<pre><code class="go hljs">myerr = myerror.WithCause(<span class="hljs-string">"8001"</span>, <span class="hljs-string">"Failed to read HTTP body: reqID"</span>, err, reqID)</code></pre><br>
<h3 id="44-logirovanie-i-obrabotka-oshibok">4.4.    </h3><br>
<p>  :</p><br>
<ul>
<li>  ,     INFO  trace.   , ,  ,    ,        </li>
<li>           WithCause()   </li>
<li>         INFO.    .</li>
<li>       ,          ERROR   ,  trace.</li>
</ul><br>
<p>      HTTP :</p><br>
<pre><code class="go hljs">requestBuf, err := ioutil.ReadAll(r.Body)
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
    myerr = myerror.WithCause(<span class="hljs-string">"8001"</span>, <span class="hljs-string">"Failed to read HTTP body: reqID"</span>, err, reqID)<font></font>
    mylog.PrintfErrorInfo(myerr) <span class="hljs-comment">//    </span>
    s.processError(myerr, w, http.StatusInternalServerError, reqID) <span class="hljs-comment">//     HTTP response</span>
    <span class="hljs-keyword">return</span> myerr<font></font>
}</code></pre><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://github.com/romapres2010/httpserver/blob/aaf4321c80c598ef6545d528fa9eb188cf6a99d5/httpserver/httpservice/" rel="nofollow">processError</a>       HTTP  /  .<br>
        â€”  HTTPErrLog,    POST  /httperrlog.</p><br>
<pre><code class="plaintext hljs">POST /httperrlog HTTP/1.1<font></font>
HTTP-Err-Log: HEADER | BODY</code></pre><br>
<p>     HTTP header       </p><br>
<pre><code class="go hljs"><span class="hljs-comment">// carriage return (CR, ASCII 0xd), line feed (LF, ASCII 0xa), and the zero character (NUL, ASCII 0x0)</span>
headerReplacer := strings.NewReplacer(<span class="hljs-string">"\x0a"</span>, <span class="hljs-string">" "</span>, <span class="hljs-string">"\x0d"</span>, <span class="hljs-string">" "</span>, <span class="hljs-string">"\x00"</span>, <span class="hljs-string">" "</span>)<font></font>
<font></font>
w.Header().Set(<span class="hljs-string">"Err-Trace"</span>, headerReplacer.Replace(myerr.Trace))</code></pre><br>
<h2 id="5-logirovanie">5. </h2><br>
<p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">github.com/hashicorp/logutils</a>.<br>
     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">RFC 5424 â€” The Syslog Protocol</a>,    :</p><br>
<ul>
<li>debug â€”    </li>
<li>info â€”  , , / </li>
<li>error â€”  ,  </li>
</ul><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://github.com/romapres2010/" rel="nofollow"> </a>    â€”  100 </p><br>
<p>     Dave Cheney <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Letâ€™s talk about logging</a>.<br>
       â€”      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">A simple logging interface for Go</a>.</p><br>
<h3 id="51-kuda-logiruem">5.1.  </h3><br>
<p>      "log".         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">github.com/hashicorp/logutils</a>.</p><br>
<pre><code class="go hljs"><span class="hljs-comment">// logFilter represent a custom logger seting</span>
<span class="hljs-keyword">var</span> logFilter = &amp;logutils.LevelFilter{<font></font>
    Levels:   []logutils.LogLevel{<span class="hljs-string">"DEBUG"</span>, <span class="hljs-string">"INFO"</span>, <span class="hljs-string">"ERROR"</span>},<font></font>
    MinLevel: logutils.LogLevel(<span class="hljs-string">"INFO"</span>), <span class="hljs-comment">// initial setting</span>
    Writer:   os.Stderr,                 <span class="hljs-comment">// initial setting</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// InitLogger init custom logger</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InitLogger</span><span class="hljs-params">(wrt io.Writer)</span></span> {<font></font>
    logFilter.Writer = wrt   <span class="hljs-comment">// custom logger</span>
    log.SetOutput(logFilter) <span class="hljs-comment">// set std logger to our custom</span>
}</code></pre><br>
<p> ,     ,     main      MultiWriter</p><br>
<pre><code class="go hljs"><span class="hljs-comment">//     </span>
<span class="hljs-keyword">if</span> logFileFlag != <span class="hljs-string">""</span> {
    <span class="hljs-comment">//        </span>
    logFileFlag = strings.Replace(logFileFlag, <span class="hljs-string">"%s"</span>, time.Now().Format(<span class="hljs-string">"2006_01_02_150405"</span>), <span class="hljs-number">1</span>)<font></font>
<font></font>
    <span class="hljs-comment">//        APPEND</span>
    logFile, err := os.OpenFile(logFileFlag, os.O_RDWR|os.O_CREATE|os.O_APPEND, <span class="hljs-number">0666</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
        myerr := myerror.WithCause(<span class="hljs-string">"6020"</span>, <span class="hljs-string">"Error open log file: Filename"</span>, err, logFileFlag)<font></font>
        mylog.PrintfErrorMsg(fmt.Sprintf(<span class="hljs-string">"%+v"</span>, myerr))
        <span class="hljs-keyword">return</span> myerr<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> logFile != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">defer</span> logFile.Close()<font></font>
    }<font></font>
<font></font>
    wrt := io.MultiWriter(os.Stderr, logFile) <span class="hljs-comment">//    os.Stderr  </span><font></font>
<font></font>
    mylog.InitLogger(wrt) <span class="hljs-comment">//     </span>
} <span class="hljs-keyword">else</span> {<font></font>
    mylog.InitLogger(os.Stderr)<font></font>
}</code></pre><br>
<h3 id="52-format-logirovaniya">5.2.  </h3><br>
<p>   INFO  DEBUG       .  </p><br>
<pre><code class="plaintext hljs">2020/03/10 17:56:39 [INFO] - httpserver.go:[61] - New() - Creating new HTTP server<font></font>
2020/03/10 17:56:39 [INFO] - httpserver.go:[141] - New() - Created new TCP listener: network = 'tcp', address ['127.0.0.1:3000']<font></font>
2020/03/10 17:56:39 [INFO] - httpserver.go:[155] - New() - Handler is registered: Path, Method ['/echo', 'POST']<font></font>
2020/03/10 17:56:39 [INFO] - httpserver.go:[155] - New() - Handler is registered: Path, Method ['/signin', 'POST']<font></font>
2020/03/10 17:56:39 [INFO] - httpserver.go:[155] - New() - Handler is registered: Path, Method ['/refresh', 'POST']<font></font>
2020/03/10 17:56:39 [INFO] - httpserver.go:[179] - New() - HTTP server is created<font></font>
2020/03/10 17:56:39 [INFO] - daemon.go:[121] - New() - New daemon is created<font></font>
2020/03/10 17:56:39 [INFO] - daemon.go:[128] - (*Daemon).Run() - Starting daemon<font></font>
2020/03/10 17:56:39 [INFO] - daemon.go:[133] - (*Daemon).Run() - Daemon is running. For exit &lt;CTRL-c&gt;<font></font>
2020/03/10 17:56:39 [INFO] - httpserver.go:[209] - (*Server).Run() - Starting HTTP server<font></font>
2020/03/10 17:57:22 [INFO] - daemon.go:[142] - (*Daemon).Run() - Exiting, got signal ['interrupt']<font></font>
2020/03/10 17:57:22 [INFO] - daemon.go:[155] - (*Daemon).Shutdown() - Shutting down daemon<font></font>
2020/03/10 17:57:22 [INFO] - httpserver.go:[215] - (*Server).Shutdown() - Waiting for shutdown HTTP Server: sec ['30']<font></font>
2020/03/10 17:57:22 [INFO] - httpserver.go:[231] - (*Server).Shutdown() - HTTP Server shutdown successfuly<font></font>
2020/03/10 17:57:22 [INFO] - daemon.go:[167] - (*Daemon).Shutdown() - Daemon is shutdown<font></font>
2020/03/10 17:57:22 [INFO] - main.go:[163] - main.func1() - Server is shutdown</code></pre><br>
<p>  ERROR         .</p><br>
<h3 id="53-kak-logiruem">5.3.  </h3><br>
<p>      :</p><br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PrintfInfoMsg</span><span class="hljs-params">(mes <span class="hljs-keyword">string</span>, args ...<span class="hljs-keyword">interface</span>{})</span></span> {<font></font>
    printfMsg(<span class="hljs-string">"[INFO]"</span>, <span class="hljs-number">0</span>, mes, args...)<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PrintfDebugMsg</span><span class="hljs-params">(mes <span class="hljs-keyword">string</span>, args ...<span class="hljs-keyword">interface</span>{})</span></span> {<font></font>
    printfMsg(<span class="hljs-string">"[DEBUG]"</span>, <span class="hljs-number">0</span>, mes, args...)<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PrintfErrorMsg</span><span class="hljs-params">(mes <span class="hljs-keyword">string</span>, args ...<span class="hljs-keyword">interface</span>{})</span></span> {<font></font>
    printfMsg(<span class="hljs-string">"[ERROR]"</span>, <span class="hljs-number">0</span>, mes, args...)<font></font>
}</code></pre><br>
<p>   ,        .<br>
   â€”     DEBUG     .</p><br>
<p>     INFO  DEBUG,        . </p><br>
<pre><code class="go hljs">mylog.PrintfInfoMsg(fmt.Sprintf(<span class="hljs-string">"Create new TCP listener network='tcp', address='%s'"</span>, serverCfg.ListenSpec))</code></pre><br>
<p> </p><br>
<pre><code class="go hljs">mylog.PrintfInfoMsg(<span class="hljs-string">"Created new TCP listener: network = 'tcp', address"</span>, cfg.ListenSpec)</code></pre><br>
<p> ,     ,      DEBUG   INFO   1%.<br>
      â€”      INFO  DEBUG     POST  /loglevel.</p><br>
<pre><code class="plaintext hljs">POST /loglevel HTTP/1.1<font></font>
Log-Level-Filter: DEBUG | ERROR | INFO</code></pre><br>
<h3 id="54-dopolnitelnoe-logirovanie-http-trafika">5.4.   HTTP </h3><br>
<p>   ,     HTTP    .<br>
  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://github.com/romapres2010/httpserver/blob/aaf4321c80c598ef6545d528fa9eb188cf6a99d5/httpserver/httplog/" rel="nofollow">httplog</a>     HTTP header  body:</p><br>
<ul>
<li> </li>
<li> </li>
<li> </li>
<li> </li>
</ul><br>
<p>           â€”  HttpLog  HTTPLogType,    POST  /httplog.</p><br>
<pre><code class="plaintext hljs">POST /httplog HTTP/1.1<font></font>
Http-Log: TRUE<font></font>
Http-Log-Type: INREQ | OUTREQ | INRESP | OUTRESP | BODY</code></pre><br>
<h2 id="6-autentifikaciya">6. </h2><br>
<p>      : HTTP Basic Authentication  MS AD Authentication.<br>
 MS AD Authentication   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">gopkg.in/korylprince/go-ad-auth.v2</a>.<br>
   ,           MS AD.</p><br>
<pre><code class="plaintext hljs">[AUTHENTIFICATION]<font></font>
AuthType = INTERNAL | MSAD | NONE<font></font>
MSADServer = company.com<font></font>
MSADPort = 389<font></font>
MSADBaseDN = OU=company, DC=dc, DC=corp<font></font>
MSADSecurity = SecurityNone</code></pre><br>
<p>     HTTP Basic Authentication       .</p><br>
<p> JSON Web Token (JWT)      .      JWTExpiresAt (JWTExpiresAt=0 â€”    ).     JWT       .</p><br>
<pre><code class="plaintext hljs">[JWT]<font></font>
UseJWT = true<font></font>
JWTExpiresAt = 20000</code></pre><br>
<p>   JWT   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">github.com/dgrijalva/jwt-go</a>.<br>
  JWT: , ,  cookie      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://github.com/romapres2010/" rel="nofollow">jwt</a></p><br>
<p>  JWT :</p><br>
<ul>
<li> JWT ,       HTTP Basic Authentication  MS AD Authentication</li>
<li> JWT ,     (StatusUnauthorized),          JWT</li>
<li>   JWT   POST  /signin<br>
<ul>
<li>    JSON Web Token Claim ( Claim   ),    </li>
<li> Claims  JSON Web Token,   HS256    </li>
<li> Token   http Cookie "token".  Cookie   Token  </li>
</ul></li>
<li>  ,  http Cookie  JWT  .    ,  StatusUnauthorized</li>
<li> JWT   POST  /refresh</li>
<li>logout  </li>
</ul><br>
<h2 id="7-organizaciya-koda-i-sborka">7.    </h2><br>
<h3 id="71-ispolzovanie-go-mod">7.1.  go mod</h3><br>
<p>     <strong>golang/dep/cmd/dep</strong>  <strong>go mod</strong>,         vendor   .    ""      .    .</p><br>
<pre><code class="plaintext hljs">go get -u ./../...<font></font>
go mod vendor</code></pre><br>
<p>   go mod   ,              .          commit, :</p><br>
<pre><code class="plaintext hljs">go get github.com/ibm-messaging/mq-golang/ibmmq@19b946c</code></pre><br>
<p> ,       vendor,   </p><br>
<pre><code class="plaintext hljs">go build -v -mod vendor</code></pre><br>
<h3 id="72-sborka-koda">7.2.  </h3><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://raw.githubusercontent.com/romapres2010/httpserver/master/cmd/" rel="nofollow">make</a>     ( -   ): </p><br>
<ul>
<li>rebuild â€”   </li>
<li>build â€”   </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">check-github.com/golangci/golangci-lintã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¾ã™</font></font></li>
</ul><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ã¯ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ãƒ“ãƒ«ãƒ‰æ—¥ä»˜ã€ã‚³ãƒŸãƒƒãƒˆãŒå®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«ã«åŸ‹ã‚è¾¼ã¾ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®æƒ…å ±ã¯ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã«è¡¨ç¤ºã•ã‚Œã¾ã™-ã‚¨ãƒ©ãƒ¼ã®è§£æã«éå¸¸ã«å½¹ç«‹ã¡ã¾ã™ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®ã‚ˆã†ãªå®Ÿè£…ã‚’å®Ÿè£…ã™ã‚‹ã«ã¯ã€ãƒ¡ã‚¤ãƒ³ã«å¤‰æ•°ã‚’è¿½åŠ ã—ã¾ã™</font></font></p><br>
<pre><code class="go hljs"><span class="hljs-keyword">var</span> (<font></font>
    version   = <span class="hljs-string">"0.0.2"</span> <span class="hljs-comment">//  ,  </span>
    commit    = <span class="hljs-string">"unset"</span> <span class="hljs-comment">//  commit</span>
    buildTime = <span class="hljs-string">"unset"</span> <span class="hljs-comment">//    </span>
)</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">makefileã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã¨ãã€ã‚³ãƒŸãƒƒãƒˆã‚’gitã«è¦æ±‚ã—ã¾ã™</font></font></p><br>
<pre><code class="plaintext hljs">COMMIT?=$(shell git rev-parse --short HEAD)<font></font>
BUILD_TIME?=$(shell date -u '+%Y-%m-%d_%H:%M:%S')</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çµ„ã¿ç«‹ã¦ã‚‹ã¨ãã€ã“ã‚Œã‚‰ã®å€¤ã‚’ä»¥å‰ã«å®£è¨€ã•ã‚ŒãŸå¤‰æ•°ã«ãƒã‚¤ãƒ³ãƒ‰ã—ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-ldflags "-X"</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã€åŒæ™‚ã«åé›†ã™ã‚‹OSã¨ãƒã‚¤ãƒŠãƒªã®ä¿å­˜å ´æ‰€ã‚’æŒ‡å®šã—ã¾ã™</font></font></p><br>
<pre><code class="plaintext hljs">GOOS=${GOOS} go build -v -a -mod vendor \<font></font>
-ldflags "-X main.commit=${COMMIT} -X main.buildTime=${BUILD_TIME}" \<font></font>
-o bin/${GOOS}/${APP} </code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.mainã§ã€æœ€çµ‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ›¸ãè¾¼ã¿ã€æ—¥ä»˜æƒ…å ±ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦å¤‰æ•°ã«ãƒ“ãƒ«ãƒ‰ã—ã¾ã™</font></font></p><br>
<pre><code class="go hljs">app.Version = fmt.Sprintf(<span class="hljs-string">"%s, commit '%s', build time '%s'"</span>, version, commit, buildTime)</code></pre></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja492048/index.html">å¢ƒç•Œã®ä¿è­·ã®æ¦‚è¦ï¼šç„¡æ–™ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ä½¿ç”¨ã—ãŸIDãŠã‚ˆã³ã‚¢ã‚¯ã‚»ã‚¹ç®¡ç†ã®å±•é–‹</a></li>
<li><a href="../ja492054/index.html">ã‚·ãƒ¥ãƒ¬ãƒ¼ãƒ‡ã‚£ãƒ³ã‚¬ãƒ¼ã‚ªãƒ¼ãƒˆãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</a></li>
<li><a href="../ja492056/index.html">ã‚¤ã‚ªã‚¿è»¢é€ã®4ã¤ã®ä¾‹</a></li>
<li><a href="../ja492058/index.html">ROS2 vs ROS1ã€‚Ubuntu 18.04ã¸ã®ROS2ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</a></li>
<li><a href="../ja492060/index.html">ã®è§£ãæ–¹ï¼Ÿã€ŒECONNREFUSED-ã‚µãƒ¼ãƒãƒ¼ã«ã‚ˆã£ã¦æ¥ç¶šãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€</a></li>
<li><a href="../ja492066/index.html">ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°ãŒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ç›¸äº’ä½œç”¨ã®ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã‚ã‚‹ç†ç”±</a></li>
<li><a href="../ja492068/index.html">S7ã‚°ãƒ«ãƒ¼ãƒ—ã€MIPTã«ã€Œèˆªç©ºã«ãŠã‘ã‚‹æƒ…å ±æŠ€è¡“ã€éƒ¨é–€ã‚’é–‹è¨­</a></li>
<li><a href="../ja492074/index.html">æ—©ãè¡Œã‹ãªãã‚ƒ é«˜é€ŸIMAPãƒ¡ãƒ¼ãƒ«åŒæœŸ</a></li>
<li><a href="../ja492076/index.html">Javaã®å…­è§’å½¢ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ä¾‹</a></li>
<li><a href="../ja492078/index.html">ã‚³ãƒ­ãƒŠã‚¦ã‚¤ãƒ«ã‚¹COVID-19ã®æœ€ã‚‚é‡è¦ã§æœ‰ç”¨ãªè³‡æ–™</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>