<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>♈️ 🥝 🤞🏿 TypeScript中的类型化OData查询 🐗 🐢 🛬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="传统上，对数据的OData查询表示为简单字符串，无需在编译过程中进行类型检查或不提供IntelliSense支持，此外，开发人员还必须学习查询语言的语法。本文介绍了TsToOdata库，该库将查询转换为方便的语言构造，并类似地应用于类和方法。您可以使用TypeScript关键字和熟悉的运算符来创建类...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>TypeScript中的类型化OData查询</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489122/"><p><img src="https://habrastorage.org/webt/_r/xa/z6/_rxaz6gbce_xm4yazomsaczakpw.png"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传统上，对数据的OData查询表示为简单字符串，无需在编译过程中进行类型检查或不提供IntelliSense支持，此外，开发人员还必须学习查询语言的语法。</font><font style="vertical-align: inherit;">本文介绍了TsToOdata库，该库将查询转换为方便的语言构造，并类似地应用于类和方法。</font><font style="vertical-align: inherit;">您可以使用TypeScript关键字和熟悉的运算符来创建类型化查询。</font></font></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TsToOdata是TypeScript的库。</font><font style="vertical-align: inherit;">它与C＃的LINQ相似，但与后者不同，它仅用于OData查询。</font><font style="vertical-align: inherit;">对于创建查询的开发人员而言，TsToOdata最明显的部分是查询表达式。</font><font style="vertical-align: inherit;">查询表达式使用声明性语法，因此开发人员可以编写需要完成的操作，而无需指定如何执行。</font><font style="vertical-align: inherit;">使用查询语法，您可以使用最少的程序代码来过滤，组织和分组数据源中的数据。</font></font></p><br>
<h4 id="ustanovka-tstoodata"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装TsToOdata</font></font></h4><br>
<pre><code class="plaintext hljs">npm install ts2odata</code></pre><br>
<h4 id="sozdanie-modeli-dannyh"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建数据模型</font></font></h4><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们需要获取OData模式到TypeScript类的映射。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
第一步是首先从EDMX Json获取模式。</font><font style="vertical-align: inherit;">您可以</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为此</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">OdataToEntity</font></a><font style="vertical-align: inherit;">库</font><font style="vertical-align: inherit;">。</font></font></p><br>
<pre><code class="cs hljs">IEdmModel edmModel;
<span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> reader = XmlReader.Create(<span class="hljs-string">"edmx_schema.xml"</span>))<font></font>
    edmModel = CsdlReader.Parse(reader);<font></font>
<font></font>
<span class="hljs-keyword">var</span> generator = <span class="hljs-keyword">new</span> OeJsonSchemaGenerator(edmModel);
<span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> utf8Json = <span class="hljs-keyword">new</span> MemoryStream())<font></font>
{<font></font>
    generator.Generate(utf8Json);<font></font>
    utf8Json.Position = <span class="hljs-number">0</span>;<font></font>
    File.WriteAllBytes(<span class="hljs-string">"json_schema.json"</span>, utf8Json.ToArray());<font></font>
}</code></pre><br>
<p>   Json         TypeScript.      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">quicktype</a>.<br>
     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"> </a>       .</p><br>
<h4 id="sozdanie-konteksta-dostupa-k-dannym">    </h4><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { EntitySet, OdataContext } <span class="hljs-keyword">from</span> <span class="hljs-string">'ts2odata'</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> oe <span class="hljs-keyword">from</span> <span class="hljs-string">'./order'</span>;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderContext</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">OdataContext</span>&lt;<span class="hljs-title">OrderContext</span>&gt; </span>{<font></font>
    Categories = EntitySet.default&lt;oe.Category&gt;();<font></font>
    Customers = EntitySet.default&lt;oe.Customer&gt;();<font></font>
    OrderItems = EntitySet.default&lt;oe.OrderItem&gt;();<font></font>
    OrderItemsView = EntitySet.default&lt;oe.OrderItemsView&gt;();<font></font>
    Orders = EntitySet.default&lt;oe.Order&gt;();<font></font>
}</code></pre><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> context: OrderContext = OdataContext.create(OrderContext, <span class="hljs-string">'http://localhost:5000/api'</span>);</code></pre><br>
<h4 id="primery-zaprosov"> </h4><br>
<p>    </p><br>
<pre><code class="javascript hljs">context.Orders;
<span class="hljs-comment">//http://localhost:5000/api/Orders</span></code></pre><br>
<p>  </p><br>
<pre><code class="javascript hljs">context.Orders.select(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> { <span class="hljs-keyword">return</span> { <span class="hljs-attr">p</span>: o.Name } });
<span class="hljs-comment">//http://localhost:5000/api/Orders?$select=Name</span></code></pre><br>
<p>  </p><br>
<pre><code class="javascript hljs">context.Orders.orderby(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> i.Id);
<span class="hljs-comment">//http://localhost:5000/api/Orders?$orderby=Id</span></code></pre><br>
<p>  </p><br>
<pre><code class="javascript hljs">context.Orders.orderbyDescending(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> i.Id);
<span class="hljs-comment">//http://localhost:5000/api/Orders?$orderby=Id desc</span></code></pre><br>
<p></p><br>
<pre><code class="javascript hljs">context.Orders.filter(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.Date.getFullYear() == <span class="hljs-number">2016</span>);
<span class="hljs-comment">//http://localhost:5000/api/Orders?$filter=year(Date) eq 2016</span></code></pre><br>
<p>  </p><br>
<pre><code class="javascript hljs">context.Orders.expand(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.Items);
<span class="hljs-comment">//http://localhost:5000/api/Orders?$expand=Items</span></code></pre><br>
<p>      </p><br>
<pre><code class="javascript hljs">context.Customers.expand(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.Orders).thenExpand(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.Items);
<span class="hljs-comment">//http://localhost:5000/api/Customers?$expand=Orders($expand=Items)</span></code></pre><br>
<p>  </p><br>
<pre><code class="javascript hljs">context.Orders.orderby(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> i.Id).skip(<span class="hljs-number">2</span>);
<span class="hljs-comment">//http://localhost:5000/api/Orders?$orderby=Id&amp;$skip=2</span></code></pre><br>
<p>  </p><br>
<pre><code class="javascript hljs">context.Orders.orderby(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> i.Id).top(<span class="hljs-number">3</span>);
<span class="hljs-comment">//http://localhost:5000/api/Orders?$orderby=Id&amp;$top=3</span></code></pre><br>
<p></p><br>
<pre><code class="javascript hljs">context.OrderItems.groupby(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> { <span class="hljs-keyword">return</span> { <span class="hljs-attr">Product</span>: i.Product } });
<span class="hljs-comment">//localhost:5000/api/OrderItems?$apply=groupby((Product))</span></code></pre><br>
<p></p><br>
<pre><code class="javascript hljs">context.OrderItems.groupby(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> { <span class="hljs-keyword">return</span> { <span class="hljs-attr">OrderId</span>: i.OrderId, <span class="hljs-attr">Status</span>: i.Order.Status } })<font></font>
    .select(<span class="hljs-function"><span class="hljs-params">g</span> =&gt;</span> {
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">orderId</span>: g.key.OrderId,
            <span class="hljs-attr">avg</span>: g.average(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> i.Price),
            <span class="hljs-attr">dcnt</span>: g.countdistinct(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> i.Product),
            <span class="hljs-attr">max</span>: g.max(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> i.Price),
            <span class="hljs-attr">max_status</span>: g.max(<span class="hljs-function"><span class="hljs-params">_</span> =&gt;</span> g.key.Status),
            <span class="hljs-attr">min</span>: g.min(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> i.Price),
            <span class="hljs-attr">sum</span>: g.sum(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> i.Price),
            <span class="hljs-attr">cnt</span>: g.count()<font></font>
        }});<font></font>
<span class="hljs-comment">//http://localhost:5000/api/OrderItems?$apply=groupby((OrderId,Order/Status),aggregate(Price with average as avg,Product with countdistinct as dcnt,Price with max as max,Order/Status with max as max_status,Price with min as min,Price with sum as sum,$count as cnt))</span></code></pre><br>
<p>  </p><br>
<pre><code class="javascript hljs">context.Customers.key({ <span class="hljs-attr">Country</span>: <span class="hljs-string">'RU'</span>, <span class="hljs-attr">Id</span>: <span class="hljs-number">1</span> });
<span class="hljs-comment">//http://localhost:5000/api/Customers(Country='RU',Id=1)</span></code></pre><br>
<p>     </p><br>
<pre><code class="javascript hljs">context.OrderItems.key(<span class="hljs-number">1</span>, i =&gt; i.Order.Customer);
<span class="hljs-comment">//http://localhost:5000/api/OrderItems(1)/Order/Customer</span></code></pre><br>
<p> </p><br>
<pre><code class="javascript hljs">context.OrderItems<font></font>
    .select(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> {
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">product</span>: i.Product,
            <span class="hljs-attr">Total</span>: i.Count * i.Price,
            <span class="hljs-attr">SumId</span>: i.Id + i.OrderId<font></font>
        }<font></font>
    });<font></font>
<span class="hljs-comment">//http://localhost:5000/api/OrderItems?$select=Product&amp;$compute=Count mul Price as Total,Id add OrderId as SumId</span></code></pre><br>
<p> </p><br>
<pre><code class="javascript hljs">context.Orders.filter(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.Items.every(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> i.Price &gt;= <span class="hljs-number">2.1</span>));
<span class="hljs-comment">//http://localhost:5000/api/Orders?$filter=Items/all(d:d/Price ge 2.1)</span></code></pre><br>
<pre><code class="javascript hljs">context.Orders.filter(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.Items.some(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> i.Count &gt; <span class="hljs-number">2</span>));
<span class="hljs-comment">//http://localhost:5000/api/Orders?$filter=Items/any(d:d/Count gt 2)</span></code></pre><br>
<p>IN </p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> items = [<span class="hljs-number">1.1</span>, <span class="hljs-number">1.2</span>, <span class="hljs-number">1.3</span>];<font></font>
context.OrderItems.filter(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> items.includes(i.Price), { <span class="hljs-attr">items</span>: items });
<span class="hljs-comment">//http://localhost:5000/api/OrderItems?$filter=Price in (1.1,1.2,1.3)</span></code></pre><br>
<p> </p><br>
<pre><code class="javascript hljs">context.Orders.count();
<span class="hljs-comment">//http://localhost:5000/api/Orders/$count</span></code></pre><br>
<p>   <br>
 <em>asEntitySet</em>          </p><br>
<pre><code class="javascript hljs">context.Orders(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.AltCustomer).thenSelect(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> {{
    <span class="hljs-attr">p1</span>: o.Address,<font></font>
    : o.Country,<font></font>
    : o.Id,<font></font>
    : o.Name,<font></font>
    : o.Sex<font></font>
}}).asEntitySet().orderby(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.Id)
<span class="hljs-comment">//http://localhost:5000/api/Orders?$expand=AltCustomer($select=Address,Country,Id,Name,Sex)&amp;$orderby=Id</span></code></pre><br>
<p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">GitHub</a>.</p><br>
<p> ,   <em>select</em>, <em>expand</em>, <em>groupby</em>   —      — ,       ,      <em>then</em>: <em>thenFilter</em>, <em>thenExpand</em>, <em>thenOrderby</em>, <em>thenOrderbyDescending</em>, <em>thenSkip</em>, <em>thenTop</em>.  <em>select</em>  <em>thenSelect</em>   , ,      ,    <em>asEntitySet</em>.</p><br>
<h4 id="parametrizaciya-zaprosov"> </h4><br>
<p>  — <em>filter/thenFilter</em>,  — <em>select/thenSelect</em>,  — <em>groupby</em>  ,            .</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> count: number | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;<font></font>
context.OrderItems.filter(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> i.Count == count, { <span class="hljs-attr">count</span>: count }); <span class="hljs-comment">//http://localhost:5000/api/OrderItems?$filter=Count eq null</span></code></pre><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> s = {
    <span class="hljs-attr">altCustomerId</span>: <span class="hljs-number">3</span>,
    <span class="hljs-attr">customerId</span>: <span class="hljs-number">4</span>,
    <span class="hljs-attr">dateYear</span>: <span class="hljs-number">2016</span>,
    <span class="hljs-attr">dateMonth</span>: <span class="hljs-number">11</span>,
    <span class="hljs-attr">dateDay</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">date</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'unknown'</span>,
    <span class="hljs-attr">status</span>: <span class="hljs-string">"OdataToEntity.Test.Model.OrderStatus'Unknown'"</span>,
    <span class="hljs-attr">count1</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">count2</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">price1</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">price2</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">product1</span>: <span class="hljs-string">'unknown'</span>,
    <span class="hljs-attr">product2</span>: <span class="hljs-string">'null'</span>,
    <span class="hljs-attr">orderId</span>: <span class="hljs-number">-1</span>,
    <span class="hljs-attr">id</span>: <span class="hljs-number">1</span><font></font>
};<font></font>
context.Orders.filter(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.AltCustomerId == s.altCustomerId &amp;&amp;<font></font>
    o.CustomerId == s.customerId &amp;&amp;<font></font>
    (o.Date.getFullYear() == s.dateYear &amp;&amp;<font></font>
        o.Date.getMonth() &gt; s.dateMonth &amp;&amp;<font></font>
        o.Date.getDay() &lt; s.dateDay ||<font></font>
        o.Date == s.date) &amp;&amp;<font></font>
    o.Name.includes(s.name) &amp;&amp;<font></font>
    o.Status == s.status, s)<font></font>
    .expand(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.Items)<font></font>
        .thenFilter(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> (i.Count == s.count1 ||<font></font>
                i.Count == s.count2) &amp;&amp;<font></font>
            (i.Price == s.price1 ||<font></font>
                i.Price == s.price2) &amp;&amp;<font></font>
            (i.Product.includes(s.product1) ||<font></font>
                i.Product.includes(s.product2)) &amp;&amp;<font></font>
            i.OrderId &gt; s.orderId &amp;&amp;<font></font>
            i.Id != s.id, s);<font></font>
<span class="hljs-comment">/*http://localhost:5000/api/Orders?$filter=AltCustomerId eq 3 and
    CustomerId eq 4 and
    (year(Date) eq 2016 and
        month(Date) gt 11 and
        day(Date) lt 20 or
        Date eq null) and
    contains(Name,'unknown') and
    Status eq OdataToEntity.Test.Model.OrderStatus'Unknown'&amp;
    $expand=Items(
        $filter=(Count eq 0 or
            Count eq null) and
        (Price eq 0 or
            Price eq null) and
        (contains(Product,'unknown') or
            contains(Product,'null')) and
        OrderId gt -1 and
        Id ne 1)*/</span></code></pre><br>
<h4 id="otobrazhenie-funkciy"> </h4><br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th>JavaScript</th>
<th>OData</th>
</tr>
</thead>
<tbody>
<tr>
<td>Math.ceil</td>
<td>ceiling</td>
</tr>
<tr>
<td>concat</td>
<td>concat</td>
</tr>
<tr>
<td>includes</td>
<td>contains</td>
</tr>
<tr>
<td>getDay</td>
<td>day</td>
</tr>
<tr>
<td>endsWith</td>
<td>endswith</td>
</tr>
<tr>
<td>Math.floor</td>
<td>floor</td>
</tr>
<tr>
<td>getHours</td>
<td>hour</td>
</tr>
<tr>
<td>indexOf</td>
<td>indexof</td>
</tr>
<tr>
<td>stringLength</td>
<td>length</td>
</tr>
<tr>
<td>getMinutes</td>
<td>minute</td>
</tr>
<tr>
<td>getMonth</td>
<td>month</td>
</tr>
<tr>
<td>Math.round</td>
<td>round</td>
</tr>
<tr>
<td>getSeconds</td>
<td>second</td>
</tr>
<tr>
<td>startsWith</td>
<td>startswith</td>
</tr>
<tr>
<td>substring</td>
<td>substring</td>
</tr>
<tr>
<td>toLowerCase</td>
<td>tolower</td>
</tr>
<tr>
<td>toUpperCase</td>
<td>toupper</td>
</tr>
<tr>
<td>trim</td>
<td>trim</td>
</tr>
<tr>
<td>getFullYear</td>
<td>year</td>
</tr>
</tbody>
</table></div><br>
<p>     <em>OdataFunctions.stringLength</em></p><br>
<pre><code class="javascript hljs">context.Customers.filter(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> OdataFunctions.stringLength(c.Name) == <span class="hljs-number">5</span>); <span class="hljs-comment">//http://localhost:5000/api/Customers?$filter=length(Name) eq 5</span></code></pre><br>
<p>     <em>OdataFunctions.arrayLength</em></p><br>
<pre><code class="javascript hljs">context.Orders.filter(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> OdataFunctions.arrayLength(o.Items) &gt; <span class="hljs-number">2</span>); <span class="hljs-comment">//http://localhost:5000/api/Customers?$filter=Items/$count gt 2</span></code></pre><br>
<h4 id="poluchenie-rezultatov"> </h4><br>
<p>     select, filter      <em>getQueryUrl</em>  <em>toArrayAsync</em>.<br>
<em>getQueryUrl</em>  URL .     TypeScript:</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> url: URL = context.Customers<font></font>
    .expand(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.AltOrders).thenExpand(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.Items).thenOrderby(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> i.Price)<font></font>
    .expand(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.AltOrders).thenExpand(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.ShippingAddresses).thenOrderby(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.Id)<font></font>
    .expand(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.Orders).thenExpand(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.Items).thenOrderby(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> i.Price)<font></font>
    .expand(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.Orders).thenExpand(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.ShippingAddresses).thenOrderby(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.Id)<font></font>
    .orderby(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.Country).orderby(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.Id).getQueryUrl();</code></pre><br>
<p> OData :</p><br>
<pre><code class="plaintext hljs">http://localhost:5000/api/Customers?$expand=<font></font>
AltOrders($expand=Items($orderby=Price),ShippingAddresses($orderby=Id)),<font></font>
Orders($expand=Items($orderby=Price),ShippingAddresses($orderby=Id))<font></font>
&amp;$orderby=Country,Id</code></pre><br>
<p><em>toArrayAsync</em>      Json.     TypeScript:</p><br>
<pre><code class="javascript hljs">context.Customers<font></font>
    .expand(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.Orders).thenSelect(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> { <span class="hljs-keyword">return</span> { <span class="hljs-attr">Date</span>: o.Date } }).orderby(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.Date)<font></font>
    .asEntitySet().select(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> { <span class="hljs-keyword">return</span> { <span class="hljs-attr">Name</span>: c.Name } }).orderby(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.Name).toArrayAsync();</code></pre><br>
<p> Json:</p><br>
<pre><code class="json hljs">[{
        <span class="hljs-attr">"Name"</span>: <span class="hljs-string">"Ivan"</span>,
        <span class="hljs-attr">"Orders"</span>: [{
                <span class="hljs-attr">"Date"</span>: <span class="hljs-string">"2016-07-04T19:10:10.8237573+03:00"</span><font></font>
            }, {<font></font>
                <span class="hljs-attr">"Date"</span>: <span class="hljs-string">"2020-02-20T20:20:20.000002+03:00"</span><font></font>
            }<font></font>
        ]<font></font>
    }, {<font></font>
        <span class="hljs-attr">"Name"</span>: <span class="hljs-string">"Natasha"</span>,
        <span class="hljs-attr">"Orders"</span>: [{
                <span class="hljs-attr">"Date"</span>: <span class="hljs-string">"2016-07-04T19:10:11+03:00"</span><font></font>
            }<font></font>
        ]<font></font>
    }, {<font></font>
        <span class="hljs-attr">"Name"</span>: <span class="hljs-string">"Sasha"</span>,
        <span class="hljs-attr">"Orders"</span>: []<font></font>
    }, {<font></font>
        <span class="hljs-attr">"Name"</span>: <span class="hljs-string">"Unknown"</span>,
        <span class="hljs-attr">"Orders"</span>: [{
                <span class="hljs-attr">"Date"</span>: <span class="hljs-literal">null</span><font></font>
            }<font></font>
        ]<font></font>
    }<font></font>
]</code></pre><br>
<p>     ,   ,   <em>toArrayAsync</em>    <em>OdataParser</em>:</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { OdataParser } <span class="hljs-keyword">from</span> <span class="hljs-string">'ts2odata'</span>;
<span class="hljs-keyword">import</span> schema <span class="hljs-keyword">from</span> <span class="hljs-string">'./schema.json'</span>;<font></font>
<font></font>
<span class="hljs-keyword">let</span> odataParser = <span class="hljs-keyword">new</span> OdataParser(schema);<font></font>
context.Orders.toArrayAsync(odataParser);</code></pre><br>
<h4 id="tipy-perechisleniy-enum">  (enum)</h4><br>
<p>  OData        (Namespace),            :</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> context: OrderContext = OdataContext.create(OrderContext, <span class="hljs-string">'http://localhost:5000/api'</span>, <span class="hljs-string">'OdataToEntity.Test.Model'</span>);</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在某些情况下，可能必须创建</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OdataParser</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象以正确转换枚举</font><font style="vertical-align: inherit;">。</font></font></p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { OdataParser } <span class="hljs-keyword">from</span> <span class="hljs-string">'ts2odata'</span>;
<span class="hljs-keyword">import</span> schema <span class="hljs-keyword">from</span> <span class="hljs-string">'./schema.json'</span>;<font></font>
<font></font>
<span class="hljs-keyword">let</span> odataParser = <span class="hljs-keyword">new</span> OdataParser(schema);
<span class="hljs-keyword">let</span> context: OrderContext = OdataContext.create(OrderContext, <span class="hljs-string">'http://localhost:5000/api'</span>, <span class="hljs-string">'OdataToEntity.Test.Model'</span>, odataParser);</code></pre><br>
<h4 id="ishodnyy-kod"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资源</font></font></h4><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">源代码在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub上</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在源文件夹中-程序包的节点代码，在测试文件夹中-测试。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">希望我的TsToOdata项目对您有用，并使您免于编写单调代码的例程。</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN489100/index.html">SARS-CoV-2冠状病毒数据分析（2019-nCov）</a></li>
<li><a href="../zh-CN489102/index.html">假的屏幕寿命。“是的，我个人认识麦当娜”</a></li>
<li><a href="../zh-CN489106/index.html">我如何退出新闻业并成为一名程序员</a></li>
<li><a href="../zh-CN489108/index.html">将您的字段添加到Pytest报告中</a></li>
<li><a href="../zh-CN489118/index.html">《巫师3》渲染的逆向工程：各种天空效果</a></li>
<li><a href="../zh-CN489128/index.html">国际化：如何将产品推向国际市场（而不是发疯）</a></li>
<li><a href="../zh-CN489132/index.html">《 2020年欧洲综合系统》亮点</a></li>
<li><a href="../zh-CN489134/index.html">俄罗斯食品公司设计团队研究</a></li>
<li><a href="../zh-CN489136/index.html">赢得二十条Haskell台词：编写Wc</a></li>
<li><a href="../zh-CN489142/index.html">学校从A到Z的生物信息学讲座</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>