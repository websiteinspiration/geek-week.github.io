<!doctype html>
<html class="no-js" lang="hi">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯОб ЁЯжН ЁЯСйЁЯП╜тАНтЪЦя╕П The Witcher 3 рдХреЗ рдкреНрд░рддрд┐рдкрд╛рджрди рдХреА рд░рд┐рд╡рд░реНрд╕ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ: рд╡рд┐рднрд┐рдиреНрди рдЖрдХрд╛рд╢ рдкреНрд░рднрд╛рд╡ тЩ╛ ЁЯзЫ ЁЯСКЁЯП╜</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="[рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЗ рдкрд┐рдЫрд▓реЗ рд╣рд┐рд╕реНрд╕реЗ: рдкрд╣рд▓рд╛ рдФрд░ рджреВрд╕рд░рд╛ рдФрд░ рддреАрд╕рд░рд╛ ред]
 
 рднрд╛рдЧ 1. рд╕рд┐рд░рд╕ рдмрд╛рджрд▓
 рдЬрдм рдЦреЗрд▓ рдЦреБрд▓реЗ рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рджреБрдирд┐рдпрд╛ рдХреА рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>The Witcher 3 рдХреЗ рдкреНрд░рддрд┐рдкрд╛рджрди рдХреА рд░рд┐рд╡рд░реНрд╕ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ: рд╡рд┐рднрд┐рдиреНрди рдЖрдХрд╛рд╢ рдкреНрд░рднрд╛рд╡</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489118/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8f2/033/d27/8f2033d27bc9d8a498716c85be1be1c0.png" alt="рдЫрд╡рд┐"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЗ рдкрд┐рдЫрд▓реЗ рд╣рд┐рд╕реНрд╕реЗ: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╣рд▓рд╛</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреВрд╕рд░рд╛</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреАрд╕рд░рд╛</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред]</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рднрд╛рдЧ 1. рд╕рд┐рд░рд╕ рдмрд╛рджрд▓</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЬрдм рдЦреЗрд▓ рдЦреБрд▓реЗ рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рджреБрдирд┐рдпрд╛ рдХреА рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХрд╛рд░рдХреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдЖрдХрд╛рд╢ рд╣реИред рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реЛрдЪреЛ - рдЬреНрдпрд╛рджрд╛рддрд░ рд╕рдордп рдЖрдХрд╛рд╢ рд╕рдЪрдореБрдЪ рдкреВрд░реА рд╕реНрдХреНрд░реАрди рдХрд╛ рд▓рдЧрднрдЧ 40-50% рд▓реЗрддрд╛ рд╣реИред рдЖрдХрд╛рд╢ рдПрдХ рд╕реБрдВрджрд░ рдврд╛рд▓ рд╕реЗ рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╣реИред рдЗрд╕рдореЗрдВ рддрд╛рд░реЗ, рд╕реВрд░реНрдп, рдЪрдВрджреНрд░рдорд╛ рдФрд░ рдЕрдВрдд рдореЗрдВ рдмрд╛рджрд▓ рд╣реИрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╡рд░реНрддрдорд╛рди рд░реБрдЭрд╛рди рд░реЗрдорд░реНрд╕рд┐рдВрдЧ ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рд▓реЗрдЦ рдХреЛ рджреЗрдЦреЗрдВ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><font style="vertical-align: inherit;">рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдмрд╛рджрд▓реЛрдВ рдХреЗ рд╡реЙрд▓реНрдпреВрдореЗрдЯреНрд░рд┐рдХ рд░реЗрдВрдбрд░рд┐рдВрдЧ рдореЗрдВ рд╕рдореНтАНрдорд┐рд▓рд┐рдд рд╣реИрдВ </font><font style="vertical-align: inherit;">, рд▓реЗрдХрд┐рди рдж рд╡рд┐рдЪрд░ 3 рдХреЗ рдмрд╛рджрд▓ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдмрдирд╛рд╡рдЯ-рдЖрдзрд╛рд░рд┐рдд рд╣реИрдВред рдореИрдВрдиреЗ рдкрд╣рд▓реЗ рд╣реА рдЙрдирдХреА рдЬрд╛рдВрдЪ рдХреА, рд▓реЗрдХрд┐рди рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рдХрд┐ рдЙрдирдХреЗ рд╕рд╛рде рд╕рдм рдХреБрдЫ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИ, рдЬреИрд╕рд╛ рдХрд┐ рдореБрдЭреЗ рдореВрд▓ рд░реВрдк рд╕реЗ рдЙрдореНрдореАрдж рдереАред рдпрджрд┐ рдЖрдкрдиреЗ рдореЗрд░реЗ рд▓реЗрдЦреЛрдВ рдХреА рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд┐рдпрд╛ рд╣реИ, рддреЛ рдЖрдк рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рд░рдХреНрдд рдФрд░ рд╢рд░рд╛рдм рдбреАрдПрд▓рд╕реА рдФрд░ рд╢реЗрд╖ рдЦреЗрд▓ рдореЗрдВ рдЕрдВрддрд░ рд╣реИред рдФрд░, рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдЕрдиреБрдорд╛рди рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдбреАрдПрд▓рд╕реА рдореЗрдВ рдмрд╛рджрд▓реЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдореЗрдВ рдХреБрдЫ рдмрджрд▓рд╛рд╡ рд╣реИрдВред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ Witcher 3 рдореЗрдВ рдмрд╛рджрд▓реЛрдВ рдХреА рдХрдИ рдкрд░рддреЗрдВ рд╣реИрдВред рдореМрд╕рдо рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдпрд╣ рдХреЗрд╡рд▓ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд┐рд░рд╕ рдХреЗ рдмрд╛рджрд▓</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрдЪреНрдЪ рдХреНрдпреВрдореНрдпрд▓рд╕ рдмрд╛рджрд▓</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , рд╕рдВрднрд╡рддрдГ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрддрд░рд┐рдд рдмрд╛рджрд▓реЛрдВ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЗ рдкрд░рд┐рд╡рд╛рд░ рд╕реЗ рдХреБрдЫ </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;">рдмрд╛рджрд▓</font></a><font style="vertical-align: inherit;"> (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рддреВрдлрд╛рди рдХреЗ рджреМрд░рд╛рди) рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рдЕрдВрдд рдореЗрдВ, рдХреЛрдИ рдмрд╛рджрд▓ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреБрдЫ рдкрд░рддреЗрдВ рдЙрдиреНрд╣реЗрдВ рд░реЗрдВрдбрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдмрдирд╛рд╡рдЯ рдФрд░ рд╢реЗрдб рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рднрд┐рдиреНрди рд╣реЛрддреА рд╣реИрдВред рдЬрд╛рд╣рд┐рд░ рд╣реИ, рдпрд╣ рдкрд┐рдХреНрд╕реЗрд▓ shader рдХреЗ рд▓рд┐рдП рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдХреА рдЬрдЯрд┐рд▓рддрд╛ рдФрд░ рд▓рдВрдмрд╛рдИ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рд╕рднреА рд╡рд┐рд╡рд┐рдзрддрд╛ рдХреЗ рдмрд╛рд╡рдЬреВрдж, рдХреБрдЫ рд╕рд╛рдорд╛рдиреНрдп рдкреИрдЯрд░реНрди рд╣реИрдВ, рдЬрд┐рдиреНрд╣реЗрдВ рдХреНрд░реЙрдХрд░ 3 рдореЗрдВ рдмрд╛рджрд▓реЛрдВ рдХреЛ рдкреНрд░рд╕реНрддреБрдд рдХрд░рддреЗ рд╕рдордп рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╡реЗ рд╕рднреА рдПрдХ рд╕рдХреНрд░рд┐рдп рдкрд╛рд╕ рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдпрд╣ рд╕рд╣реА рд╡рд┐рдХрд▓реНрдк рд╣реИред рдЙрдирдореЗрдВ рд╕реЗ рд╕рднреА рдорд┐рд╢реНрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ (рдиреАрдЪреЗ рджреЗрдЦреЗрдВ)ред рдЗрд╕рд╕реЗ рдпрд╣ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдирд╛ рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдПрдХ рдЕрд▓рдЧ рдкрд░рдд рдЖрдХрд╛рд╢ рдХреЛ рдХреИрд╕реЗ рдХрд╡рд░ рдХрд░рддреА рд╣реИ - рдпрд╣ рдкрд┐рдХреНрд╕реЗрд▓ shader рд╕реЗ рдЕрд▓реНрдлрд╛ рдорд╛рди рд╕реЗ рдкреНрд░рднрд╛рд╡рд┐рдд рд╣реЛрддрд╛ рд╣реИред</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/263/aec/b8a/263aecb8afa21e2b79b0333bcde55011.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдзрд┐рдХ рджрд┐рд▓рдЪрд╕реНрдк рд░реВрдк рд╕реЗ, рдХреБрдЫ рдкрд░рддреЗрдВ рдПрдХ рд╣реА рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде рджреЛ рдмрд╛рд░ рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рддреА рд╣реИрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреЛрдб рдХреЛ рджреЗрдЦрдиреЗ рдХреЗ рдмрд╛рдж, рдореИрдВрдиреЗ (1) рд╕рдмрд╕реЗ рдкреВрд░реНрдг рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдЗрд╕рдХреЗ рдкреВрд░реНрдг рд░рд┐рд╡рд░реНрд╕ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ рдХрд╛ рдкреНрд░рджрд░реНрд╢рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдмрд╕реЗ рдЫреЛрдЯрд╛ рд╢реЗрдбрд░ рдЪреБрдирд╛, (2) рдЗрд╕рдХреЗ рд╕рднреА рдкрд╣рд▓реБрдУрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореИрдВрдиреЗ рдЪреБрдбрд╝реИрд▓ 3: рд░рдХреНрдд рдФрд░ рд╢рд░рд╛рдм рд╕реЗ рд╕рд┐рд░рд╕ рдмрд╛рджрд▓реЛрдВ рдкрд░ рдХрд░реАрдм рд╕реЗ рдирдЬрд╝рд░ рдбрд╛рд▓реАред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣рд╛рдБ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдлреНрд░реЗрдо рд╣реИ:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f81/eb8/a49/f81eb8a49dc315ef04d72b582fba869b.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реЗрдВрдбрд░ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/885/b27/206/885b2720624e7a455987bb6239d0e371.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╣рд▓реЗ рд░реЗрдВрдбрд░ рдкрд╛рд╕ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8f2/033/d27/8f2033d27bc9d8a498716c85be1be1c0.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреВрд╕рд░реЗ рд░реЗрдВрдбрд░рд┐рдВрдЧ рдкрд╛рд╕ рдХреЗ рдмрд╛рдж</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
рдЗрд╕ рд╡рд┐рд╢реЗрд╖ рдлреНрд░реЗрдо рдореЗрдВ, рд░реЗрдВрдбрд░ рдХрд░рддреЗ рд╕рдордп рд╕рд┐рд░рд╕ рдХреНрд▓рд╛рдЙрдб рдкрд╣рд▓реА рдкрд░рдд рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╣ рджреЛ рдмрд╛рд░ рдЧрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЗрд╕рдХреА рдЪрдордХ рдмрдврд╝ рдЬрд╛рддреА рд╣реИред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд┐рдпреЛрдореЗрдЯреНрд░рд┐рдХ рдФрд░ рд╡рд░реНрдЯреЗрдХреНрд╕ рд╢реЗрдбрд░</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд┐рдХреНрд╕реЗрд▓ shader рд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдЬреНрдпрд╛рдорд┐рддреАрдп рдФрд░ рд╢реАрд░реНрд╖ shaders рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рдмрд╛рдд рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдмрд╛рджрд▓реЛрдВ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд╛рд▓реА рдПрдХ рдирд┐рдпрдорд┐рдд рдЖрдХрд╛рд╢ рдЧреБрдВрдмрдж рдХреА рддрд░рд╣ рд╣реИ:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b4c/774/8de/b4c7748de95ad07f2dddfc090e62e0d2.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рднреА рдХреЛрдиреЗ рдЕрдВрддрд░рд╛рд▓ рдореЗрдВ рд╣реИрдВ [0-1], рдЗрд╕рд▓рд┐рдП рдмрд┐рдВрджреБ (0,0,0) рдкрд░ рдореЗрд╖ рдХреЛ рдХреЗрдВрджреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕реНрдХреЗрд▓рд┐рдВрдЧ рдФрд░ рд╡рд┐рдЪрд▓рди рдХрд╛ рдЙрдкрдпреЛрдЧ рд╡рд░реНрд▓реНрдб рд╡реНрдпреВрдкреНрд░реЛрдЬ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХреЗ рдкрд┐рдЫрд▓реЗ рд╣рд┐рд╕реНрд╕реЛрдВ рд╕реЗ рдЗрд╕ рдкреИрдЯрд░реНрди рдХреЛ рдЬрд╛рдирддреЗ рд╣реИрдВ)ред </font><font style="vertical-align: inherit;">рдмрд╛рджрд▓реЛрдВ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рджреГрд╢реНрдпрддрд╛ рдХреЗ рдкрд┐рд░рд╛рдорд┐рдб рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрдЧрд╣ рдХреЛ рдХрд╡рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореЗрд╖ XY рд╡рд┐рдорд╛рди (Z рдЕрдХреНрд╖ рдмрд┐рдВрджреБ рдХреЛ рдКрдкрд░) рдХреЗ рд╕рд╛рде рдордЬрдмреВрддреА рд╕реЗ рдлреИрд▓рд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдкрд░рд┐рдгрд╛рдо рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИ:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/341/0ca/95e/3410ca95ea9f0b3ef1fafe62cb5dba13.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдореЗрд╖ рдореЗрдВ рд╕рд╛рдорд╛рдиреНрдп рдФрд░ рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ рд╡реИрдХреНрдЯрд░ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╡рд░реНрдЯреЗрдХреНрд╕ рд╢реЗрдбрд░ рднреА рд╡реЗрдХреНрдЯрд░ рдЙрддреНрдкрд╛рдж рджреНрд╡рд╛рд░рд╛ рджреНрд╡рд┐-рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ рд╡реЗрдХреНрдЯрд░ рдХреА рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИ - рддреАрдиреЛрдВ рдХреЛ рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рд░реВрдк рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдХреЛрд╣рд░реЗ (рдЗрд╕рдХреА рд░рдВрдЧ рдФрд░ рдЪрдордХ) рдХреА рдПрдХ рд╢реАрд░реНрд╖ рдЧрдгрдирд╛ рднреА рд╣реИред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд┐рдХреНрд╕реЗрд▓ shader</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд┐рдХреНрд╕реЗрд▓ shader рдЕрд╕реЗрдВрдмрд▓реА рдХреЛрдб рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ:</font></font><br>
<br>
<pre><code class="cpp hljs"> ps_5_0  <font></font>
    dcl_globalFlags refactoringAllowed  <font></font>
    dcl_constantbuffer cb0[<span class="hljs-number">10</span>], immediateIndexed  <font></font>
    dcl_constantbuffer cb1[<span class="hljs-number">9</span>], immediateIndexed  <font></font>
    dcl_constantbuffer cb12[<span class="hljs-number">238</span>], immediateIndexed  <font></font>
    dcl_constantbuffer cb4[<span class="hljs-number">13</span>], immediateIndexed  <font></font>
    dcl_sampler s0, <span class="hljs-function">mode_default  
    <span class="hljs-title">dcl_resource_texture2d</span> <span class="hljs-params">(<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>)</span> t0  
    <span class="hljs-title">dcl_resource_texture2d</span> <span class="hljs-params">(<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>)</span> t1  
    dcl_input_ps linear v0.xyzw  
    dcl_input_ps linear v1.xyzw  
    dcl_input_ps linear v2.w  
    dcl_input_ps linear v3.xyzw  
    dcl_input_ps linear v4.xyz  
    dcl_input_ps linear v5.xyz  
    dcl_output o0.xyzw  
    dcl_temps 4  
   0: mul r0.xyz, cb0[9].xyzx, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">-1.000000</span>, <span class="hljs-number">0.000000</span>)</span>  
   1: dp3 r0.w, r0.xyzx, r0.xyzx  
   2: rsq r0.w, r0.w  
   3: mul r0.xyz, r0.wwww, r0.xyzx  
   4: mul r1.xy, cb0[0].xxxx, cb4[5].xyxx  
   5: mad r1.xy, v1.xyxx, cb4[4].xyxx, r1.xyxx  
   6: <span class="hljs-title">sample_indexable</span><span class="hljs-params">(texture2d)</span><span class="hljs-params">(<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>)</span> r1.xyzw, r1.xyxx, t0.xyzw, s0  
   7: add r1.xyz, r1.xyzx, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">-0.500000</span>, <span class="hljs-number">-0.500000</span>, <span class="hljs-number">-0.500000</span>, <span class="hljs-number">0.000000</span>)</span>  
   8: add r1.xyz, r1.xyzx, r1.xyzx  
   9: dp3 r0.w, r1.xyzx, r1.xyzx  
  10: rsq r0.w, r0.w  
  11: mul r1.xyz, r0.wwww, r1.xyzx  
  12: mul r2.xyz, r1.yyyy, v3.xyzx  
  13: mad r2.xyz, v5.xyzx, r1.xxxx, r2.xyzx  
  14: mov r3.xy, v1.zwzz  
  15: mov r3.z, v3.w  
  16: mad r1.xyz, r3.xyzx, r1.zzzz, r2.xyzx  
  17: dp3_sat r0.x, r0.xyzx, r1.xyzx  
  18: add r0.y, -cb4[2].x, cb4[3].x  
  19: mad r0.x, r0.x, r0.y, cb4[2].x  
  20: dp2 r0.y, -cb0[9].xyxx, -cb0[9].xyxx  
  21: rsq r0.y, r0.y  
  22: mul r0.yz, r0.yyyy, -cb0[9].xxyx  
  23: add r1.xyz, -v4.xyzx, cb1[8].xyzx  
  24: dp3 r0.w, r1.xyzx, r1.xyzx  
  25: rsq r1.z, r0.w  
  26: <span class="hljs-built_in">sqrt</span> r0.w, r0.w  
  27: add r0.w, r0.w, -cb4[7].x  
  28: mul r1.xy, r1.zzzz, r1.xyxx  
  29: dp2_sat r0.y, r0.yzyy, r1.xyxx  
  30: add r0.y, r0.y, r0.y  
  31: min r0.y, r0.y, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">1.000000</span>)</span>  
  32: add r0.z, -cb4[0].x, cb4[1].x  
  33: mad r0.z, r0.y, r0.z, cb4[0].x  
  34: mul r0.x, r0.x, r0.z  
  35: <span class="hljs-built_in">log</span> r0.x, r0.x  
  36: mul r0.x, r0.x, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">2.200000</span>)</span>  
  37: <span class="hljs-built_in">exp</span> r0.x, r0.x  
  38: add r1.xyz, cb12[236].xyzx, -cb12[237].xyzx  
  39: mad r1.xyz, r0.yyyy, r1.xyzx, cb12[237].xyzx  
  40: mul r2.xyz, r0.xxxx, r1.xyzx  
  41: mad r0.xyz, -r1.xyzx, r0.xxxx, v0.xyzx  
  42: mad r0.xyz, v0.wwww, r0.xyzx, r2.xyzx  
  43: add r1.x, -cb4[7].x, cb4[8].x  
  44: div_sat r0.w, r0.w, r1.x  
  45: mul r1.x, r1.w, cb4[9].x  
  46: mad r1.y, -cb4[9].x, r1.w, r1.w  
  47: mad r0.w, r0.w, r1.y, r1.x  
  48: mul r1.xy, cb0[0].xxxx, cb4[11].xyxx  
  49: mad r1.xy, v1.xyxx, cb4[10].xyxx, r1.xyxx  
  50: <span class="hljs-title">sample_indexable</span><span class="hljs-params">(texture2d)</span><span class="hljs-params">(<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>)</span> r1.x, r1.xyxx, t1.xyzw, s0  
  51: mad r1.x, r1.x, cb4[12].x, -cb4[12].x  
  52: mad_sat r1.x, cb4[12].x, v2.w, r1.x  
  53: mul r0.w, r0.w, r1.x  
  54: mul_sat r0.w, r0.w, cb4[6].x  
  55: mul o0.xyz, r0.wwww, r0.xyzx  
  56: mov o0.w, r0.w  
  57: ret </span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рджреЛ рдирд┐рд░реНрдмрд╛рдз рдмрдирд╛рд╡рдЯ рдЗрдирдкреБрдЯ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЙрдирдореЗрдВ рд╕реЗ рдПрдХ рдореЗрдВ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдорд╛рдирдЪрд┐рддреНрд░ ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xyz</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЪреИрдирд▓ </font><font style="vertical-align: inherit;">) рдФрд░ рдПрдХ рдХреНрд▓рд╛рдЙрдб рдЖрдХрд╛рд░ (рдЪреИрдирд▓ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) рд╣реИред </font><font style="vertical-align: inherit;">рджреВрд╕рд░рд╛ рдЖрдХрд╛рд░ рдХреЛ рд╡рд┐рдХреГрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╢реЛрд░ рд╣реИред</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1f3/c27/a5e/1f3c27a5eea1412d5fa1fa632861a342.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдорд╛рдиреНрдп рдирдХреНрд╢рд╛, рд╕реАрдбреА рдкреНрд░реЙрдЬреЗрдХреНрдЯ рд░реЗрдб рдкреНрд░реЙрдкрд░реНрдЯреА</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/37b/a53/d41/37ba53d412d20f476ddf71e81892b62a.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрд▓рд╛рдЙрдб рд╢реЗрдк, рдкреНрд░реЙрдкрд░реНрдЯреА рд╕реАрдбреА рдкреНрд░реЙрдЬреЗрдХреНрдЯ рд░реЗрдб</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/05e/1bb/edd/05e1bbedded7c16acefc1f67d5b3fd49.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реЛрд░ рдмрдирд╛рд╡рдЯ, рд╕реАрдбреА рдкреНрд░реЙрдЬреЗрдХреНрдЯ рд░реЗрдб</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
рдХреА </font><i><font style="vertical-align: inherit;">рд╕рдВрдкрддреНрддрд┐</font></i><font style="vertical-align: inherit;"> рдХреНрд▓рд╛рдЙрдб рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рд╕рд╛рде рд╕реНрдерд┐рд░рд╛рдВрдХ рдХрд╛ рдореБрдЦреНрдп рдмрдлрд░ cb4 рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рдлреНрд░реЗрдо рдХреЗ рд▓рд┐рдП, рдЗрд╕рдХреЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрд░реНрде рд╣реИрдВ:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/942/229/4de/9422294de7d9ead5e2bec154eb897c7a.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЕрдиреНрдп cbuffers рд╕реЗ рдЕрдиреНрдп рдореВрд▓реНрдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЪрд┐рдВрддрд╛ рди рдХрд░реЗрдВ, рд╣рдо рдЙрди рдкрд░ рднреА рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВрдЧреЗред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Z- рджрд┐рд╢рд╛ рдЙрд▓рдЯреА рдзреВрдк</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд╣рд▓реА рдЪреАрдЬ рдЬреЛ рдХрд┐ рдЫрд╛рдпрд╛ рдореЗрдВ рд╣реЛрддреА рд╣реИ, рд╡рд╣ Z рдЕрдХреНрд╖ рдХреЗ рд╕рд╛рде рдЙрд▓реНрдЯреЗ рд╕реВрд░реНрдп рдХреЗ рдкреНрд░рдХрд╛рд╢ рдХреА рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рджрд┐рд╢рд╛ рдХреА рдЧрдгрдирд╛ рд╣реИ:</font></font><br>
<br>
<pre><code class="cpp hljs">   <span class="hljs-number">0</span>: mul r0.xyz, cb0[<span class="hljs-number">9</span>].xyzx, l(<span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">-1.000000</span>, <span class="hljs-number">0.000000</span>)  
   <span class="hljs-number">1</span>: dp3 r0.w, r0.xyzx, r0.xyzx  
   <span class="hljs-number">2</span>: rsq r0.w, r0.w  
   <span class="hljs-number">3</span>: mul r0.xyz, r0.wwww, r0.xyzx  <font></font>
<font></font>
   float3 invertedSunlightDir = normalize(lightDir * float3(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">-1</span>) );</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЬреИрд╕рд╛ рдХрд┐ рдкрд╣рд▓реЗ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, Z рдЕрдХреНрд╖ рдКрдкрд░ рдХреА рдУрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдд рд╣реИ, рдФрд░ cb0 [9] рд╕реВрд░реНрдп рдХреЗ рдкреНрд░рдХрд╛рд╢ рдХреА рджрд┐рд╢рд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рд╡реЗрдХреНрдЯрд░ </font><font style="vertical-align: inherit;">рд╕реВрд░реНрдп </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд▓рдХреНрд╖рд┐рдд </font><font style="vertical-align: inherit;">рд╣реИ - рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ! </font><font style="vertical-align: inherit;">рдЖрдк рдЗрд╕реЗ рдПрдХ рд╕рд░рд▓ рдХрдореНрдкреНрдпреВрдЯреЗрд╢рдирд▓ рд╢реЗрдбрд░ рд▓рд┐рдЦрдХрд░ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдПрдХ рд╕рд░рд▓ рдПрдирдбреАрдУрдЯреАрдПрд▓ рдЪрд▓рд╛рддрд╛ рд╣реИ, рдФрд░ рдЗрд╕реЗ рдЖрд╕реНрдердЧрд┐рдд рд╢реЗрдк рдкрд╛рд╕ рдореЗрдВ рд╕рдореНрдорд┐рд▓рд┐рдд рдХрд░рддрд╛ рд╣реИред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрд▓рд╛рдЙрдб рдЯреЗрдХреНрд╕рдЪрд░ рд╕реИрдВрдкрд▓рд┐рдВрдЧ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдЧрд▓рд╛ рдХрджрдо рдЯреЗрдХреНрд╕рдХреЛрд░реНрдбреНрд╕ рдХреЛ рдХреНрд▓рд╛рдЙрдб рдмрдирд╛рд╡рдЯ рдХрд╛ рдирдореВрдирд╛ рджреЗрдиреЗ, рд╕рд╛рдорд╛рдиреНрдп рд╡реЗрдХреНрдЯрд░ рдХреЛ рдЕрдирдкреИрдХ рдХрд░рдиреЗ рдФрд░ рдЗрд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИред</font></font><br>
<br>
<pre><code class="cpp hljs">   <span class="hljs-number">4</span>: mul r1.xy, cb0[<span class="hljs-number">0</span>].xxxx, cb4[<span class="hljs-number">5</span>].xyxx   
   <span class="hljs-number">5</span>: mad r1.xy, v1.xyxx, cb4[<span class="hljs-number">4</span>].xyxx, r1.xyxx   
   <span class="hljs-number">6</span>: sample_indexable(texture2d)(<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>) r1.xyzw, r1.xyxx, t0.xyzw, s0   
   <span class="hljs-number">7</span>: add r1.xyz, r1.xyzx, l(<span class="hljs-number">-0.500000</span>, <span class="hljs-number">-0.500000</span>, <span class="hljs-number">-0.500000</span>, <span class="hljs-number">0.000000</span>)   
   <span class="hljs-number">8</span>: add r1.xyz, r1.xyzx, r1.xyzx   
   <span class="hljs-number">9</span>: dp3 r0.w, r1.xyzx, r1.xyzx   
  <span class="hljs-number">10</span>: rsq r0.w, r0.w   <font></font>
   <font></font>
   <font></font>
   <span class="hljs-comment">// Calc sampling coords  </span><font></font>
   float2 cloudTextureUV = Texcoords * textureScale + elapsedTime * speedFactors;  <font></font>
   <font></font>
   <span class="hljs-comment">// Sample texture and get data from it  </span><font></font>
   float4 cloudTextureValue = texture0.Sample( sampler0, cloudTextureUV ).rgba;  <font></font>
   float3 normalMap = cloudTextureValue.xyz;  <font></font>
   <span class="hljs-keyword">float</span> cloudShape = cloudTextureValue.a;  <font></font>
   <font></font>
   <span class="hljs-comment">// Unpack normal and normalize it  </span>
   float3 unpackedNormal = (normalMap - <span class="hljs-number">0.5</span>) * <span class="hljs-number">2.0</span>;  <font></font>
   unpackedNormal = normalize(unpackedNormal);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕рд╕реЗ рдзреАрд░реЗ-рдзреАрд░реЗ рдирд┐рдкрдЯрддреЗ рд╣реИрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдмрд╛рджрд▓реЛрдВ рдХреА рдЧрддрд┐ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ </font><font style="vertical-align: inherit;">рдЧрддрд┐ (рдЧреБрдгрд╛рдВрдХ) рдореЗрдВ </font><font style="vertical-align: inherit;">( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cb [0] .x</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) рдЧреБрдгрд╛ </font><font style="vertical-align: inherit;">рд╕рдордп рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ </font><font style="vertical-align: inherit;">, рдЬреЛ рдЖрдХрд╛рд╢ рдореЗрдВ рдмрд╛рджрд▓реЛрдВ рдХреЗ рдЪрд▓рдиреЗ рдХреА рдЧрддрд┐ ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cb4 [5] .xy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><font style="vertical-align: inherit;">рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЬреИрд╕рд╛ рдХрд┐ рдореИрдВрдиреЗ рдкрд╣рд▓реЗ рдХрд╣рд╛, UVs рдЖрдХрд╛рд╢ рдЧреБрдВрдмрдж рдХреА рдЬреНрдпрд╛рдорд┐рддрд┐ рдХреЗ рд╕рд╛рде рдЦрд┐рдВрдЪреЗ рд╣реБрдП рд╣реИрдВ, рдФрд░ рд╣рдореЗрдВ рдмрдирд╛рд╡рдЯ рд╕реНрдХреЗрд▓рд┐рдВрдЧ рдХрд╛рд░рдХреЛрдВ рдХреА рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬреЛ рдмрд╛рджрд▓реЛрдВ рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддреЗ рд╣реИрдВ ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cb4 [4] .xy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдВрддрд┐рдо рд╕реВрддреНрд░ рд╣реИ:</font></font><br>
<br>
<pre><code class="cpp hljs">samplingUV = Input.TextureUV * textureScale + time * speedMultiplier;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рднреА 4 рдЪреИрдирд▓реЛрдВ рдХрд╛ рдирдореВрдирд╛ рд▓реЗрдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдирдХреНрд╢рд╛ (рдЖрд░рдЬреАрдмреА рдЪреИрдирд▓) рдФрд░ рдПрдХ рдХреНрд▓рд╛рдЙрдб рдЖрдХрд╛рд░ (рдЪреИрдирд▓) рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдВрддрд░рд╛рд▓ рд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рдорд╛рдирдЪрд┐рддреНрд░ рдХреЛ рдЕрдирдкреИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [0; </font><font style="vertical-align: inherit;">1] рдЕрдВрддрд░рд╛рд▓ рдореЗрдВ [-1; </font><font style="vertical-align: inherit;">1] рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реВрддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ:</font></font><br>
<br>
<pre><code class="cpp hljs">unpackedNormal = (packedNormal - <span class="hljs-number">0.5</span>) * <span class="hljs-number">2.0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:</font></font><br>
<br>
<pre><code class="cpp hljs">unpackedNormal = packedNormal * <span class="hljs-number">2.0</span> - <span class="hljs-number">1.0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдВрдд рдореЗрдВ, рд╣рдо рдЕрдирдкреИрдХреНрдб рд╕рд╛рдорд╛рдиреНрдп рд╡реЗрдХреНрдЯрд░ рдХреЛ рд╕рд╛рдорд╛рдиреНрдп рдХрд░рддреЗ рд╣реИрдВред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдУрд╡рд░рд▓реЗ рдорд╛рдирджрдВрдб</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рд╛рдорд╛рдиреНрдп рд╡реИрдХреНрдЯрд░, рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ рдФрд░ рджреНрд╡рд┐-рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ рд╡реИрдХреНрдЯрд░ рд╡реИрдХреНрдЯрд░ рд╢реАрд░реНрд╖ рдЫрд╛рдпрд╛рдХрд╛рд░ рд╕реЗ, рдФрд░ рд╕рд╛рдорд╛рдиреНрдп рд╡реЗрдХреНрдЯрд░ рд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рд╡реЗрдХреНрдЯрд░, рд╣рдо рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдорд╛рдирджрдВрдбреЛрдВ рдХреЛ рдореИрдк рдХрд░рддреЗ рд╣реИрдВред</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-number">11</span>: mul r1.xyz, r0.wwww, r1.xyzx  
  <span class="hljs-number">12</span>: mul r2.xyz, r1.yyyy, v3.xyzx  
  <span class="hljs-number">13</span>: mad r2.xyz, v5.xyzx, r1.xxxx, r2.xyzx  
  <span class="hljs-number">14</span>: mov r3.xy, v1.zwzz  
  <span class="hljs-number">15</span>: mov r3.z, v3.w  
  <span class="hljs-number">16</span>: mad r1.xyz, r3.xyzx, r1.zzzz, r2.xyzx  <font></font>
    <font></font>
   <span class="hljs-comment">// Perform bump mapping  </span><font></font>
   float3 SkyTangent = Input.Tangent;  <font></font>
   float3 SkyNormal = (float3( Input.Texcoords.zw, Input.param3.w ));  <font></font>
   float3 SkyBitangent = Input.param3.xyz;  <font></font>
        <font></font>
   float3x3 TBN = float3x3(SkyTangent, SkyBitangent, SkyNormal);  <font></font>
   float3 finalNormal = (float3)mul( unpackedNormal, (TBN) );</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрдордХ (1)</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдЧрд▓реЗ рдЪрд░рдг рдореЗрдВ, рдПрдирдбреАрдУрдЯреАрдПрд▓ рдЧрдгрдирд╛ рд▓рд╛рдЧреВ рдХреА рдЬрд╛рддреА рд╣реИ рдФрд░ рдпрд╣ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкрд┐рдХреНрд╕реЗрд▓ рдХреА рд░реЛрд╢рдиреА рдХреА рдорд╛рддреНрд░рд╛ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ:</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-number">17</span>: dp3_sat r0.x, r0.xyzx, r1.xyzx  
  <span class="hljs-number">18</span>: add r0.y, -cb4[<span class="hljs-number">2</span>].x, cb4[<span class="hljs-number">3</span>].x  
  <span class="hljs-number">19</span>: mad r0.x, r0.x, r0.y, cb4[<span class="hljs-number">2</span>].x  </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣рд╛рдБ рдкреНрд░рд╢реНрди рдореЗрдВ рдлреНрд░реЗрдо рдкрд░ NdotL рдХрд╛ рджреГрд╢реНрдп рд╣реИ:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/283/f29/1a1/283f291a18105785a51af59dbbe8905a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рдЕрджрд┐рд╢ рдЙрддреНрдкрд╛рдж (рд╕рдВрддреГрдкреНрддрд┐ рдХреЗ рд╕рд╛рде) рдХрд╛ рдЙрдкрдпреЛрдЧ рдорд┐рдиреАрдЖрдпрдиреНрд╕рд┐рдЯреА рдФрд░ рдореИрдХреНрд╕рд┐рдирд┐рдЯреА рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж, рд╕реВрд░рдЬ рдХреА рд░реЛрд╢рдиреА рд╕реЗ рд░реЛрд╢рдиреА рд╡рд╛рд▓реЗ рдмрд╛рджрд▓реЛрдВ рдХреЗ рдХреБрдЫ рд╣рд┐рд╕реНрд╕реЗ рдЙрдЬреНрдЬреНрд╡рд▓ рд╣реЛрдВрдЧреЗред</font></font><br>
<br>
<pre><code class="cpp hljs">   <span class="hljs-comment">// Calculate cosine between normal and up-inv lightdir  </span>
   <span class="hljs-keyword">float</span> NdotL = saturate( dot(invertedSunlightDir, finalNormal) );  <font></font>
   <font></font>
   <span class="hljs-comment">// Param 1, line 19, r0.x  </span>
   <span class="hljs-keyword">float</span> intensity1 = lerp( param1Min, param1Max, NdotL );</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрдордХ (2)</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдмрд╛рджрд▓реЛрдВ рдХреА рдЪрдордХ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдПрдХ рдФрд░ рдХрд╛рд░рдХ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдХрд╛рд╢ рдХреЗ рдЙрд╕ рд╣рд┐рд╕реНрд╕реЗ рдореЗрдВ рд╕реНрдерд┐рдд рдмрд╛рджрд▓ рдЬрд╣рд╛рдВ рд╕реВрд░рдЬ рд╣реИ, рдЕрдзрд┐рдХ рдкреНрд░рдХрд╛рд╢ рдбрд╛рд▓рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдПрдХреНрд╕рд╡рд╛рдИ рдкреНрд▓реЗрди рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЧреНрд░реЗрдбрд┐рдПрдВрдЯ рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рдврд╛рд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдиреНрдпреВрдирддрдо / рдЕрдзрд┐рдХрддрдо рдореВрд▓реНрдпреЛрдВ рдХреЗ рдмреАрдЪ рд░реИрдЦрд┐рдХ рдкреНрд░рдХреНрд╖реЗрдк рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдХрд┐ рднрд╛рдЧ (1) рдореЗрдВ рд╣реЛрддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣реА рд╣реИ, рд╕реИрджреНрдзрд╛рдВрддрд┐рдХ рд░реВрдк рд╕реЗ, рд╣рдо рд╕реВрд░реНрдп рдХреЗ рд╡рд┐рдкрд░реАрдд рджрд┐рд╢рд╛ рдореЗрдВ рд╕реНрдерд┐рдд рдмрд╛рджрд▓реЛрдВ рдХреЛ рдХрд╛рд▓рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЗрд╕ рд╡рд┐рд╢реЗрд╖ рдлреНрд░реЗрдо рдореЗрдВ рдРрд╕рд╛ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">param2Min</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">param2Max</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cb4 [0] </font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.x</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font><i><font style="vertical-align: inherit;">c44 [1] .x</font></i><font style="vertical-align: inherit;"> ) 1.0f рдкрд░ рд╕реЗрдЯ рд╣реИрдВред</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-number">20</span>: dp2 r0.y, -cb0[<span class="hljs-number">9</span>].xyxx, -cb0[<span class="hljs-number">9</span>].xyxx  
  <span class="hljs-number">21</span>: rsq r0.y, r0.y  
  <span class="hljs-number">22</span>: mul r0.yz, r0.yyyy, -cb0[<span class="hljs-number">9</span>].xxyx  
  <span class="hljs-number">23</span>: add r1.xyz, -v4.xyzx, cb1[<span class="hljs-number">8</span>].xyzx  
  <span class="hljs-number">24</span>: dp3 r0.w, r1.xyzx, r1.xyzx  
  <span class="hljs-number">25</span>: rsq r1.z, r0.w  
  <span class="hljs-number">26</span>: <span class="hljs-built_in">sqrt</span> r0.w, r0.w  
  <span class="hljs-number">27</span>: add r0.w, r0.w, -cb4[<span class="hljs-number">7</span>].x  
  <span class="hljs-number">28</span>: mul r1.xy, r1.zzzz, r1.xyxx  
  <span class="hljs-number">29</span>: dp2_sat r0.y, r0.yzyy, r1.xyxx  
  <span class="hljs-number">30</span>: add r0.y, r0.y, r0.y  
  <span class="hljs-number">31</span>: min r0.y, r0.y, l(<span class="hljs-number">1.000000</span>)  
  <span class="hljs-number">32</span>: add r0.z, -cb4[<span class="hljs-number">0</span>].x, cb4[<span class="hljs-number">1</span>].x  
  <span class="hljs-number">33</span>: mad r0.z, r0.y, r0.z, cb4[<span class="hljs-number">0</span>].x  
  <span class="hljs-number">34</span>: mul r0.x, r0.x, r0.z  
  <span class="hljs-number">35</span>: <span class="hljs-built_in">log</span> r0.x, r0.x  
  <span class="hljs-number">36</span>: mul r0.x, r0.x, l(<span class="hljs-number">2.200000</span>)  
  <span class="hljs-number">37</span>: <span class="hljs-built_in">exp</span> r0.x, r0.x   <font></font>
   <font></font>
   <font></font>
   <span class="hljs-comment">// Calculate normalized -lightDir.xy (20-22)  </span><font></font>
   float2 lightDirXY = normalize( -lightDir.xy );  <font></font>
   <font></font>
   <span class="hljs-comment">// Calculate world to camera  </span><font></font>
   float3 vWorldToCamera = ( CameraPos - WorldPos );  <font></font>
   <span class="hljs-keyword">float</span> worldToCamera_distance = length(vWorldToCamera);  <font></font>
        <font></font>
   <span class="hljs-comment">// normalize vector  </span><font></font>
   vWorldToCamera = normalize( vWorldToCamera );  <font></font>
        <font></font>
   <font></font>
   <span class="hljs-keyword">float</span> LdotV = saturate( dot(lightDirXY, vWorldToCamera.xy) );  
   <span class="hljs-keyword">float</span> highlightedSkySection = saturate( <span class="hljs-number">2</span>*LdotV );  
   <span class="hljs-keyword">float</span> intensity2 = lerp( param2Min, param2Max, highlightedSkySection );  <font></font>
   <font></font>
   <span class="hljs-keyword">float</span> finalIntensity = <span class="hljs-built_in">pow</span>( intensity2 *intensity1, <span class="hljs-number">2.2</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдмрд╣реБрдд рдЕрдВрдд рдореЗрдВ, рд╣рдо рджреЛрдиреЛрдВ рдЪрдордХ рдмрдврд╝рд╛рддреЗ рд╣реИрдВ рдФрд░ рдкрд░рд┐рдгрд╛рдо рдХреЛ 2.2 рдХреА рд╢рдХреНрддрд┐ рддрдХ рдмрдврд╝рд╛рддреЗ рд╣реИрдВред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд╛рджрд▓ рдХрд╛ рд░рдВрдЧ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдмрд╛рджрд▓реЛрдВ рдХреЗ рд░рдВрдЧ рдХреА рдЧрдгрдирд╛ рдмрдлрд░ рд╕реНрдерд┐рд░рд╛рдВрдХ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рд╣реЛрдиреЗ рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рд╣реЛрддреА рд╣реИ рджреЛ рдорд╛рди рд╕реВрд░реНрдп рдХреЗ рдЖрдЧреЗ рдмрд╛рджрд▓реЛрдВ рдХреЗ рд░рдВрдЧ рдФрд░ рдЖрдХрд╛рд╢ рдХреЗ рд╡рд┐рдкрд░реАрдд рджрд┐рд╢рд╛ рдореЗрдВ рдмрд╛рджрд▓реЛрдВ рдХрд╛ рд╕рдВрдХреЗрддред </font><font style="vertical-align: inherit;">рдЙрдирдХреЗ рдмреАрдЪ, рд░реЗрдЦреАрдп рдкреНрд░рдХреНрд╖реЗрдк </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рдЗрд▓рд╛рдЗрдЯреЗрдбрд╕реНрдХрд╛рдпреЗрди рдХреЗ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЖрдзрд╛рд░ рдкрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рддрдм рдкрд░рд┐рдгрд╛рдо рдЕрдВрддрд┐рдо рдЧреБрдгрди рджреНрд╡рд╛рд░рд╛ рдЧреБрдгрд╛ рдХрд┐рдпрд╛ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд╛рддрд╛ рд╣реИ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдФрд░ рдЕрдВрдд рдореЗрдВ, рдкрд░рд┐рдгрд╛рдо рдХреЛрд╣рд░реЗ рдХреЗ рд╕рд╛рде рдорд┐рд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдкреНрд░рджрд░реНрд╢рди рдХрд╛рд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП, рдпрд╣ рд╡рд░реНрдЯрд┐рдХрд▓ рд╢реЗрдбрд░ рджреНрд╡рд╛рд░рд╛ рдЧрдгрдирд╛ рдХреА рдЧрдИ рдереА)ред</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-number">38</span>: add r1.xyz, cb12[<span class="hljs-number">236</span>].xyzx, -cb12[<span class="hljs-number">237</span>].xyzx  
  <span class="hljs-number">39</span>: mad r1.xyz, r0.yyyy, r1.xyzx, cb12[<span class="hljs-number">237</span>].xyzx  
  <span class="hljs-number">40</span>: mul r2.xyz, r0.xxxx, r1.xyzx  
  <span class="hljs-number">41</span>: mad r0.xyz, -r1.xyzx, r0.xxxx, v0.xyzx  
  <span class="hljs-number">42</span>: mad r0.xyz, v0.wwww, r0.xyzx, r2.xyzx  <font></font>
   <font></font>
  float3 cloudsColor = lerp( cloudsColorBack, cloudsColorFront, highlightedSunSection );  <font></font>
  cloudsColor *= finalIntensity;  <font></font>
  cloudsColor = lerp( cloudsColor, FogColor, FogAmount );</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрд╖рд┐рддрд┐рдЬ рдкрд░ рд╕рд┐рд░рд╕ рдХреЗ рдмрд╛рджрд▓ рдЕрдзрд┐рдХ рджрд┐рдЦрд╛рдИ рджреЗрддреЗ рд╣реИрдВ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рдлреНрд░реЗрдо рдкрд░ рдмрд╣реБрдд рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдпрд╣ рдкрд░рдд рдЧреЗрд░рд╛рд▓реНрдЯ рдХреЗ рд╕рд┐рд░ рдХреЗ рдКрдкрд░ рдХреНрд╖рд┐рддрд┐рдЬ рдХреЗ рдкрд╛рд╕ рдЕрдзрд┐рдХ рджрд┐рдЦрд╛рдИ рджреЗрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣рд╛рдБ рдпрд╣ рдХреИрд╕реЗ рдХрд░рдирд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рджреВрд╕рд░реА рдЪрдордХ рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╕рдордп, рд╣рдордиреЗ рд╡реЗрдХреНрдЯрд░ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд░реНрд▓реНрдбрдЯреЙрдореНрдХреЗрд░рд╛</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреА рд▓рдВрдмрд╛рдИ рдХреА рдЧрдгрдирд╛ рдХреА </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-number">23</span>: add r1.xyz, -v4.xyzx, cb1[<span class="hljs-number">8</span>].xyzx  
  <span class="hljs-number">24</span>: dp3 r0.w, r1.xyzx, r1.xyzx  
  <span class="hljs-number">25</span>: rsq r1.z, r0.w  
  <span class="hljs-number">26</span>: <span class="hljs-built_in">sqrt</span> r0.w, r0.w</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдЗрдП рдХреЛрдб рдореЗрдВ рдЗрд╕ рд▓рдВрдмрд╛рдИ рдХреА рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдШрдЯрдирд╛рдУрдВ рдХреЛ рдЦреЛрдЬреЗрдВ:</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-number">26</span>: <span class="hljs-built_in">sqrt</span> r0.w, r0.w  
  <span class="hljs-number">27</span>: add r0.w, r0.w, -cb4[<span class="hljs-number">7</span>].x  <font></font>
  ...  <font></font>
  <span class="hljs-number">43</span>: add r1.x, -cb4[<span class="hljs-number">7</span>].x, cb4[<span class="hljs-number">8</span>].x  
  <span class="hljs-number">44</span>: div_sat r0.w, r0.w, r1.x</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╡рд╛рд╣, рдпрд╣ рд╣рдорд╛рд░реЗ рд╕рд╛рде рдХреНрдпрд╛ рд╣реИ? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cb [7] .x рдФрд░ cb [8] .x рдХрд╛ рдорд╛рди 2000.0 рдФрд░ 7000.0 рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ рдХрд┐ рдпрд╣ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓рд┐рдирд╕реНрдЯреЗрдк</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╣реИ </font><font style="vertical-align: inherit;">ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЙрд╕реЗ рддреАрди рдкреИрд░рд╛рдореАрдЯрд░ рдорд┐рд▓рддреЗ рд╣реИрдВ: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдиреНрдпреВрдирддрдо / рдЕрдзрд┐рдХрддрдо</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - рдЕрдВрддрд░рд╛рд▓ рдФрд░ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡реА</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - рдорд╛рдиред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ: рдпрджрд┐ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдВрддрд░рд╛рд▓ [ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд┐рдирдЯ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдзрд┐рдХрддрдо</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ] рдореЗрдВ рд╣реИ, рддреЛ рдлрд╝рдВрдХреНрд╢рди рдЕрдВрддрд░рд╛рд▓ [0.0 - 1.0] рдореЗрдВ рд░реИрдЦрд┐рдХ рдкреНрд░рдХреНрд╖реЗрдк рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рджреВрд╕рд░реА рдУрд░, рдпрджрд┐ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реАрдорд╛ рд╕реЗ рдмрд╛рд╣рд░ рд╣реИ, рддреЛ linstep 0.0 рдпрд╛ 1.0 рджреЗрддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ рд╕рд░рд▓ рдЙрджрд╛рд╣рд░рдг:</font></font><br>
<br>
<pre><code class="cpp hljs">linstep( <span class="hljs-number">1000.0</span>, <span class="hljs-number">2000.0</span>, <span class="hljs-number">999.0</span>) = <span class="hljs-number">0.0</span>
linstep( <span class="hljs-number">1000.0</span>, <span class="hljs-number">2000.0</span>, <span class="hljs-number">1500.0</span>) = <span class="hljs-number">0.5</span>
linstep( <span class="hljs-number">1000.0</span>, <span class="hljs-number">2000.0</span>, <span class="hljs-number">2000.0</span>) = <span class="hljs-number">1.0</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣реА рд╣реИ, рдпрд╣ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдЪрдПрд▓рдПрд╕рдПрд▓</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реЗ рд╕реНрдореВрдерд╕реНрдЯреЗрдк рдХреЗ </font><font style="vertical-align: inherit;">рд╕рдорд╛рди рд╣реИ </font><font style="vertical-align: inherit;">, рд╕рд┐рд╡рд╛рдп рдЗрд╕рдХреЗ рдХрд┐ рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рд░реНрдорд┐рдЯрд┐рдпрди рдкреНрд░рдХреНрд╖реЗрдк рдХреЗ рдмрдЬрд╛рдп, рд░реИрдЦрд┐рдХ рдкреНрд░рджрд░реНрд╢рди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд▓рд┐рдирд╕реНрдЯреЗрдк HLSL рдореЗрдВ рдПрдХ рд╡рд┐рд╢реЗрд╖рддрд╛ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдЖрдкрдХреЗ рдЯреВрд▓рдХрд┐рдЯ рдореЗрдВ рд╣реЛрдиреЗ рдХреЗ рд▓рд╛рдпрдХ рд╣реИред</font></font><br>
<br>
<pre><code class="cpp hljs"> <span class="hljs-comment">// linstep:  </span>
 <span class="hljs-comment">//  </span>
 <span class="hljs-comment">// Returns a linear interpolation between 0 and 1 if t is in the range [min, max]   </span>
 <span class="hljs-comment">// if "v" is &lt;= min, the output is 0  </span>
 <span class="hljs-comment">// if "v" i &gt;= max, the output is 1  </span><font></font>
   <font></font>
 <span class="hljs-function"><span class="hljs-keyword">float</span> <span class="hljs-title">linstep</span><span class="hljs-params">( <span class="hljs-keyword">float</span> min, <span class="hljs-keyword">float</span> max, <span class="hljs-keyword">float</span> v )</span>  
 </span>{  
   <span class="hljs-keyword">return</span> saturate( (v - min) / (max - min) );  <font></font>
 } </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдЗрдП рд╡рд╛рдкрд╕ рдЪреБрдбрд╝реИрд▓ 3 рдкрд░ рдЬрд╛рдПрдВ: рдЗрд╕ рд╕рдВрдХреЗрддрдХ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдпрд╣ рд░рд┐рдкреЛрд░реНрдЯ рдХрд░рддреЗ рд╣реБрдП рдХрд┐ рдЖрдХрд╛рд╢ рдХрд╛ рдПрдХ рд╡рд┐рд╢реЗрд╖ рднрд╛рдЧ рдЧреЗрд░рд╛рд▓реНрдЯ рд╕реЗ рдХрд┐рддрдирд╛ рджреВрд░ рд╣реИ, рд╣рдо рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдмрд╛рджрд▓реЛрдВ рдХреА рдЪрдордХ рдХреЛ рдХрдордЬреЛрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддреЗ рд╣реИрдВ:</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-number">45</span>: mul r1.x, r1.w, cb4[<span class="hljs-number">9</span>].x  
  <span class="hljs-number">46</span>: mad r1.y, -cb4[<span class="hljs-number">9</span>].x, r1.w, r1.w  
  <span class="hljs-number">47</span>: mad r0.w, r0.w, r1.y, r1.x  <font></font>
   <font></font>
   <span class="hljs-keyword">float</span> distanceAttenuation = linstep( fadeDistanceStart, fadeDistanceEnd, worldToCamera_distance );  <font></font>
    <font></font>
   <span class="hljs-keyword">float</span> fadedCloudShape = closeCloudsHidingFactor * cloudShape;  <font></font>
   cloudShape = lerp( fadedCloudShape, cloudShape, distanceAttenuation );</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CloudShape</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд╣рд▓реА рдмрдирд╛рд╡рдЯ рд╕реЗ рдПрдХ .a рдЪреИрдирд▓ рд╣реИ, рдФрд░ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CloseCloudsHidingFactor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдПрдХ рдирд┐рд░рдВрддрд░ рдмрдлрд░ рдорд╛рди рд╣реИ рдЬреЛ рдЧреЗрд░рд╛рд▓реНрдЯ рдХреЗ рд╕рд┐рд░ рдХреЗ рдКрдкрд░ рдмрд╛рджрд▓реЛрдВ рдХреА рджреГрд╢реНрдпрддрд╛ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдореЗрд░реЗ рджреНрд╡рд╛рд░рд╛ рдкрд░реАрдХреНрд╖рдг рдХрд┐рдП рдЧрдП рд╕рднреА рдлрд╝реНрд░реЗрдореЛрдВ рдореЗрдВ, рдпрд╣ 0.0 рдХреЗ рдмрд░рд╛рдмрд░ рдерд╛, рдЬреЛ рдмрд╛рджрд▓реЛрдВ рдХреА рдЕрдиреБрдкрд╕реНрдерд┐рддрд┐ рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИред </font><font style="vertical-align: inherit;">рдЬреИрд╕реЗ-рдЬреИрд╕реЗ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдбрд┐рд╕реНрдЯреЗрдВрд╢рд┐рдПрд╢рди</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.0 рддрдХ рдкрд╣реБрдВрдЪрддрд╛ рд╣реИ (рдХреИрдорд░реЗ рд╕реЗ рдЖрдХрд╛рд╢ рдХреЗ рдЧреБрдВрдмрдж рдХреА рджреВрд░реА рдмрдврд╝рддреА рд╣реИ), рдмрд╛рджрд▓ рдЕрдзрд┐рдХ рджрд┐рдЦрд╛рдИ рджреЗрдиреЗ рд▓рдЧрддреЗ рд╣реИрдВред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реЛрд░ рдмрдирд╛рд╡рдЯ рдирдореВрдирд╛</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдмрд╛рджрд▓реЛрдВ рдХреА рдмрдирд╛рд╡рдЯ рдХреЗ рд▓рд┐рдП рд╕рдорд╛рди рд╢реЛрд░ рдмрдирд╛рд╡рдЯ рдХреЗ рдирдореВрдиреЗ рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреА рдЧрдгрдирд╛, рд╕рд┐рд╡рд╛рдп рдЗрд╕рдХреЗ рдХрд┐ рдЖрдк рдмрдирд╛рд╡рдЯ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реЗрдЯрд╕реЗрд▓</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдкреАрдбрдореВрд▓рд┐рдкрд┐рдпрд░ рдХреЗ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдПрдХ рдЕрд▓рдЧ рд╕реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдмреЗрд╢рдХ, рдЗрди рд╕рднреА рдмрдирд╛рд╡рдЯреЛрдВ рдХреЗ рдирдореВрдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдХреНрд╖рдо </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реИрдкрд┐рдВрдЧ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЛрдбрд┐рдВрдЧ рдореЛрдб рдХреЗ рд╕рд╛рде рдПрдХ рдирдореВрдирд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-number">48</span>: mul r1.xy, cb0[<span class="hljs-number">0</span>].xxxx, cb4[<span class="hljs-number">11</span>].xyxx  
  <span class="hljs-number">49</span>: mad r1.xy, v1.xyxx, cb4[<span class="hljs-number">10</span>].xyxx, r1.xyxx  
  <span class="hljs-number">50</span>: sample_indexable(texture2d)(<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>) r1.x, r1.xyxx, t1.xyzw, s0  <font></font>
   <font></font>
   <span class="hljs-comment">// Calc sampling coords for noise  </span><font></font>
   float2 noiseTextureUV = Texcoords * textureScaleNoise + elapsedTime * speedFactorsNoise;  <font></font>
   <font></font>
   <span class="hljs-comment">// Sample texture and get data from it  </span>
   <span class="hljs-keyword">float</span> noiseTextureValue = texture1.Sample( sampler0, noiseTextureUV ).x;</code></pre> <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рд╕рдм рдПрдХ рд╕рд╛рде рдбрд╛рд▓реЗрдВ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╢реЛрд░ рдореВрд▓реНрдп рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдореЗрдВ рдЗрд╕реЗ рдХреНрд▓рд╛рдЙрдбрд╢реЗрдк рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореБрдЭреЗ рдЗрди рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рд╕рдордЭрдиреЗ рдореЗрдВ рдХреБрдЫ рд╕рдорд╕реНрдпрд╛рдПрдБ рдереАрдВ, рдЬрд╣рд╛рдБ param2.w рд╣реИ (рдЬреЛ рдХрд┐ рд╣рдореЗрд╢рд╛ 1.0 рд╣реИ) рдФрд░ рдиреЙрдЗрдЬрд╝рдореБрд▓реНрдЯ (рдЬрд┐рд╕рдХрд╛ рдорд╛рди 5.0 рд╣реИ, рд╕реНрдерд┐рд░ рдмрдлрд░ рд╕реЗ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ)ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЬреИрд╕рд╛ рдХрд┐ рдпрд╣ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдпрд╣рд╛рдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">generalCloudsVisibility</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд╛ рдЕрдВрддрд┐рдо рдореВрд▓реНрдп рд╣реИ </font><font style="vertical-align: inherit;">, рдЬреЛ рдмрд╛рджрд▓реЛрдВ рдХреА рджреГрд╢реНрдпрддрд╛ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╢реЛрд░ рдХреЗ рдЕрдВрддрд┐рдо рдореВрд▓реНрдп рдкрд░ рднреА рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВред </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд╛рджрд▓реЛрдВ рдХреЗ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЖрдЙрдЯрдкреБрдЯ рд░рдВрдЧ </font><font style="vertical-align: inherit;">рдХреЛ рдЕрдВрддрд┐рдо рд╢реЛрд░ рд╕реЗ рдЧреБрдгрд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдЕрд▓реНрдлрд╛ рдЪреИрдирд▓ рдХреЗ рд▓рд┐рдП рднреА рдЖрдЙрдЯрдкреБрдЯ рд╣реИред</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-number">51</span>: mad r1.x, r1.x, cb4[<span class="hljs-number">12</span>].x, -cb4[<span class="hljs-number">12</span>].x
  <span class="hljs-number">52</span>: mad_sat r1.x, cb4[<span class="hljs-number">12</span>].x, v2.w, r1.x
  <span class="hljs-number">53</span>: mul r0.w, r0.w, r1.x
  <span class="hljs-number">54</span>: mul_sat r0.w, r0.w, cb4[<span class="hljs-number">6</span>].x
  <span class="hljs-number">55</span>: mul o0.xyz, r0.wwww, r0.xyzx
  <span class="hljs-number">56</span>: mov o0.w, r0.w
  <span class="hljs-number">57</span>: ret   <font></font>
<font></font>
   <span class="hljs-comment">// Sample noise texture and get data from it  </span>
   <span class="hljs-keyword">float</span> noiseTextureValue = texture1.Sample( sampler0, noiseTextureUV ).x;  <font></font>
   noiseTextureValue = noiseTextureValue * noiseMult - noiseMult;  <font></font>
     <font></font>
   <span class="hljs-keyword">float</span> noiseValue = saturate( noiseMult * Input.param2.w + noiseTextureValue);  <font></font>
   noiseValue *= cloudShape;  <font></font>
     <font></font>
   <span class="hljs-keyword">float</span> finalNoise = saturate( noiseValue * generalCloudsVisibility);  <font></font>
   <font></font>
   <span class="hljs-keyword">return</span> float4( cloudsColor*finalNoise, finalNoise ); </code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдкреВрд░реНрдг</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рддреИрдпрд╛рд░ рдкрд░рд┐рдгрд╛рдо рдмрд╣реБрдд рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд▓рдЧрддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдк рддреБрд▓рдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдкрд╣рд▓реА рддрд╕реНрд╡реАрд░ рдореЗрд░реА рд╢реЗрдбрд░ рдХреА рд╣реИ, рджреВрд╕рд░реА рдЧреЗрдо рд╢реИрдбрд░ рдХреА рд╣реИ:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4cc/331/897/4cc3318976e9c1c54178683a2fee44c0.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрджрд┐ рдЖрдк рдЬрд┐рдЬреНрдЮрд╛рд╕реБ рд╣реИрдВ, рддреЛ рдпрд╣рд╛рдВ shader рдЙрдкрд▓рдмреНрдз </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рднрд╛рдЧ 2. рдХреЛрд╣рд░рд╛</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреЛрд╣рд░реЗ рдХреЛ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ рд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╡рд╣ рд╕рдордп рдЬрдм рд╣рдо рдПрдХ рд╕рд╛рдзрд╛рд░рдг </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреВрд░реА рдкрд░ рдирд┐рд░реНрднрд░ рдХреЛрд╣рд░реЗ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">рдФрд░ рдЗрд╕рдХреЗ рд╕рд╛рде рд╣рдореЗрд╢рд╛ рдХреЗ рд▓рд┐рдП рджреВрд░ рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВ (рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛)ред рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХрд░рдиреЗ рдпреЛрдЧреНрдп рд░рдВрдЧреЛрдВ рдХреА рджреБрдирд┐рдпрд╛ рдореЗрдВ рд░рд╣рдиреЗ рдиреЗ рдирдП рдкрд╛рдЧрд▓ рдХреЗ рд▓рд┐рдП рджрд░рд╡рд╛рдЬрд╛ рдЦреЛрд▓ рджрд┐рдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдзрд┐рдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд╛рдд, рд╢рд╛рд░реАрд░рд┐рдХ рд░реВрдк рд╕реЗ рд╕рдЯреАрдХ рдФрд░ рдиреЗрддреНрд░рд╣реАрди рдпрдерд╛рд░реНрдерд╡рд╛рджреА рд╕рдорд╛рдзрд╛рдиред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреЛрд╣рд░реЗ рдХреЗ рдкреНрд░рддрд┐рдкрд╛рджрди рдореЗрдВ рд╡рд░реНрддрдорд╛рди рд░реБрдЭрд╛рди рдХрдореНрдкреНрдпреВрдЯреЗрд╢рдирд▓ </font><font style="vertical-align: inherit;">рд╢реЗрдбреНрд╕ </font><font style="vertical-align: inherit;">(рд╡рд┐рд╡рд░рдг рдХреЗ рд▓рд┐рдП, </font><font style="vertical-align: inherit;">рдмрд╛рд░реНрдЯ рд╡реНрд░реЛрдирд╕реНрдХреА рджреНрд╡рд╛рд░рд╛ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреНрд░рд╕реНрддреБрддрд┐ рдХреЛ </font><font style="vertical-align: inherit;">рджреЗрдЦреЗрдВ </font><font style="vertical-align: inherit;">) рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рддрдереНрдп рдХреЗ рдмрд╛рд╡рдЬреВрдж рдХрд┐ рдпрд╣ рдкреНрд░рд╕реНрддреБрддрд┐ 2014 рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рд╣реБрдИ рдереА, рдФрд░ рдж рд╡рд┐рдЪрд░ 3 2015/2016 рдореЗрдВ рд░рд┐рд▓реАрдЬрд╝ рд╣реБрдИ рдереА, рдЧреЗрд░рд╛рд▓реНрдЯ рдХреЗ рдХрд╛рд░рдирд╛рдореЛрдВ рдХреЗ рдЕрдВрддрд┐рдо рднрд╛рдЧ рдореЗрдВ рдХреЛрд╣рд░рд╛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕реНрдХреНрд░реАрди рдкрд░ рдирд┐рд░реНрднрд░ рд╣реИ рдФрд░ рдЗрд╕реЗ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреЛрд╕реНрдЯ-рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдХреЗ рд░реВрдк рдореЗрдВ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рд╣рдо рдЕрдЧрд▓реЗ рд░рд┐рд╡рд░реНрд╕ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ рд╕рддреНрд░ рдХреЛ рд╢реБрд░реВ рдХрд░реЗрдВ, рдореБрдЭреЗ рдХрд╣рдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдкрд┐рдЫрд▓реЗ рдПрдХ рд╕рд╛рд▓ рдореЗрдВ рдореИрдВрдиреЗ рдХрдо рд╕реЗ рдХрдо рдкрд╛рдВрдЪ рдмрд╛рд░ рдбрд╛рдпрди 3 рдХреЗ рдХреЛрд╣рд░реЗ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХреА рдФрд░ рд╣рд░ рдмрд╛рд░ рдЕрд╕рдлрд▓ рд░рд╣рд╛ред рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб, рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдЬрд▓реНрдж рд╣реА рджреЗрдЦреЗрдВрдЧреЗ, рдХрд╛рдлреА рдЬрдЯрд┐рд▓ рд╣реИ, рдФрд░ рдЗрд╕рд╕реЗ рдПрдЪрдПрд▓рдПрд╕рдПрд▓ рдкрд░ рдПрдХ рдкрдардиреАрдп рдХреЛрд╣рд░реЗ рдЫрд╛рдпрд╛рджрд╛рд░ рдмрдирд╛рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд▓рдЧрднрдЧ рдЕрд╕рдВрднрд╡ рд╣реЛ рдЬрд╛рддреА рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рд╛рд▓рд╛рдБрдХрд┐, рдореИрдВрдиреЗ рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдПрдХ рдлреЙрдЧ рд╢реЗрдбрд░ рдвреВрдВрдврдиреЗ рдореЗрдВ рдХрд╛рдордпрд╛рдмреА рд╣рд╛рд╕рд┐рд▓ рдХреА, рдЬрд┐рд╕рдиреЗ рдЪрд░ рдирд╛рдореЛрдВ рдФрд░ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рд╕рд╛рдорд╛рдиреНрдп рдХреНрд░рдо рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рддреБрд░рдВрдд рдж рд╡рд┐рдЪрд░ 3 рдХреЛрд╣рд░реЗ рдХреА рд╕рдорд╛рдирддрд╛ рдХреЗ рдХрд╛рд░рдг рдореЗрд░рд╛ рдзреНрдпрд╛рди рдЖрдХрд░реНрд╖рд┐рдд рдХрд┐рдпрд╛ред рдпрд╣ рд╢реЗрдбрд░ рдЦреЗрд▓ рдореЗрдВ рдмрд┐рд▓реНрдХреБрд▓ рд╡реИрд╕рд╛ рдирд╣реАрдВ рдерд╛, рдЗрд╕рд▓рд┐рдП рдореБрдЭреЗ рдЗрд╕реЗ рдереЛрдбрд╝рд╛ рдкреАрдЫреЗ рдХрд░рдирд╛ рдкрдбрд╝рд╛ред рдореИрдВ рдпрд╣ рдХрд╣рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдВ рдХрд┐ рдПрдЪрдПрд▓рдПрд╕рдПрд▓ рдХреЛрдб рдХрд╛ рдореБрдЦреНрдп рднрд╛рдЧ рдЬреЛ рдЖрдк рдпрд╣рд╛рдВ рджреЗрдЦ рд░рд╣реЗ рд╣реИрдВ, рджреЛ рдЕрдкрд╡рд╛рджреЛрдВ рдХреЗ рд╕рд╛рде, рдореЗрд░реЗ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдорд┐рдд / рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрд╣ рдпрд╛рдж рд░рдЦрдирд╛ред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣рд╛рдБ рдкрд┐рдХреНрд╕реЗрд▓ рдХреЛрд╣рд░реЗ shader рдХреЗ рд▓рд┐рдП рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рд╣реИ - рдпрд╣ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ рдпрд╣ рдкреВрд░реЗ рдЦреЗрд▓ (2015 рдХреЗ рдореБрдЦреНрдп рднрд╛рдЧ рдФрд░ рджреЛрдиреЛрдВ рдбреАрдПрд▓рд╕реА) рдХреЗ рд▓рд┐рдП рд╕рдорд╛рди рд╣реИ:</font></font><br>
<br>
<pre><code class="cpp hljs"> ps_5_0  <font></font>
    dcl_globalFlags refactoringAllowed  <font></font>
    dcl_constantbuffer cb3[<span class="hljs-number">2</span>], immediateIndexed  <font></font>
    dcl_constantbuffer cb12[<span class="hljs-number">214</span>], <span class="hljs-function">immediateIndexed  
    <span class="hljs-title">dcl_resource_texture2d</span> <span class="hljs-params">(<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>)</span> t0  
    <span class="hljs-title">dcl_resource_texture2d</span> <span class="hljs-params">(<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>)</span> t1  
    <span class="hljs-title">dcl_resource_texture2d</span> <span class="hljs-params">(<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>)</span> t2  
    dcl_input_ps_siv v0.xy, position  
    dcl_output o0.xyzw  
    dcl_temps 7  
   0: ftou r0.xy, v0.xyxx  
   1: mov r0.zw, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)</span>  
   2: <span class="hljs-title">ld_indexable</span><span class="hljs-params">(texture2d)</span><span class="hljs-params">(<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>)</span> r1.x, r0.xyww, t0.xyzw  
   3: mad r1.y, r1.x, cb12[22].x, cb12[22].y  
   4: lt r1.y, r1.y, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">1.000000</span>)</span>  
   5: if_nz r1.y  
   6:  utof r1.yz, r0.xxyx  
   7:  mul r2.xyzw, r1.zzzz, cb12[211].xyzw  
   8:  mad r2.xyzw, cb12[210].xyzw, r1.yyyy, r2.xyzw  
   9:  mad r1.xyzw, cb12[212].xyzw, r1.xxxx, r2.xyzw  
  10:  add r1.xyzw, r1.xyzw, cb12[213].xyzw  
  11:  div r1.xyz, r1.xyzx, r1.wwww  
  12:  <span class="hljs-title">ld_indexable</span><span class="hljs-params">(texture2d)</span><span class="hljs-params">(<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>)</span> r2.xyz, r0.xyww, t1.xyzw  
  13:  <span class="hljs-title">ld_indexable</span><span class="hljs-params">(texture2d)</span><span class="hljs-params">(<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>)</span> r0.x, r0.xyzw, t2.xyzw  
  14:  max r0.x, r0.x, cb3[1].x  
  15:  add r0.yzw, r1.xxyz, -cb12[0].xxyz  
  16:  dp3 r1.x, r0.yzwy, r0.yzwy  
  17:  <span class="hljs-built_in">sqrt</span> r1.x, r1.x  
  18:  add r1.y, r1.x, -cb3[0].x  
  19:  add r1.zw, -cb3[0].xxxz, cb3[0].yyyw  
  20:  div_sat r1.y, r1.y, r1.z  
  21:  mad r1.y, r1.y, r1.w, cb3[0].z  
  22:  add r0.x, r0.x, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">-1.000000</span>)</span>  
  23:  mad r0.x, r1.y, r0.x, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">1.000000</span>)</span>  
  24:  div r0.yzw, r0.yyzw, r1.xxxx  
  25:  mad r1.y, r0.w, cb12[22].z, cb12[0].z  
  26:  add r1.x, r1.x, -cb12[22].z  
  27:  max r1.x, r1.x, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span>  
  28:  min r1.x, r1.x, cb12[42].z  
  29:  mul r1.z, r0.w, r1.x  
  30:  mul r1.w, r1.x, cb12[43].x  
  31:  mul r1.zw, r1.zzzw, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">0.000000</span>, <span class="hljs-number">0.000000</span>, <span class="hljs-number">0.062500</span>, <span class="hljs-number">0.062500</span>)</span>  
  32:  dp3 r0.y, cb12[38].xyzx, r0.yzwy  
  33:  add r0.z, r0.y, cb12[42].x  
  34:  add r0.w, cb12[42].x, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">1.000000</span>)</span>  
  35:  div_sat r0.z, r0.z, r0.w  
  36:  add r0.w, -cb12[43].z, cb12[43].y  
  37:  mad r0.z, r0.z, r0.w, cb12[43].z  
  38:  mul r0.w, <span class="hljs-title">abs</span><span class="hljs-params">(r0.y)</span>, <span class="hljs-title">abs</span><span class="hljs-params">(r0.y)</span>  
  39:  mad_sat r2.w, r1.x, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">0.002000</span>)</span>, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">-0.300000</span>)</span>  
  40:  mul r0.w, r0.w, r2.w  
  41:  lt r0.y, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span>, r0.y  
  42:  movc r3.xyz, r0.yyyy, cb12[39].xyzx, cb12[41].xyzx  
  43:  add r3.xyz, r3.xyzx, -cb12[40].xyzx  
  44:  mad r3.xyz, r0.wwww, r3.xyzx, cb12[40].xyzx  
  45:  movc r4.xyz, r0.yyyy, cb12[45].xyzx, cb12[47].xyzx  
  46:  add r4.xyz, r4.xyzx, -cb12[46].xyzx  
  47:  mad r4.xyz, r0.wwww, r4.xyzx, cb12[46].xyzx  
  48:  ge r0.y, r1.x, cb12[48].y  
  49:  if_nz r0.y  
  50:   add r0.y, r1.y, cb12[42].y  
  51:   mul r0.w, r0.z, r0.y  
  52:   mul r1.y, r0.z, r1.z  
  53:   mad r5.xyzw, r1.yyyy, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">16.000000</span>, <span class="hljs-number">15.000000</span>, <span class="hljs-number">14.000000</span>, <span class="hljs-number">13.000000</span>)</span>, r0.wwww  
  54:   max r5.xyzw, r5.xyzw, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)</span>  
  55:   add r5.xyzw, r5.xyzw, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>)</span>  
  56:   div_sat r5.xyzw, r1.wwww, r5.xyzw  
  57:   add r5.xyzw, -r5.xyzw, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>)</span>  
  58:   mul r1.z, r5.y, r5.x  
  59:   mul r1.z, r5.z, r1.z  
  60:   mul r1.z, r5.w, r1.z  
  61:   mad r5.xyzw, r1.yyyy, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">12.000000</span>, <span class="hljs-number">11.000000</span>, <span class="hljs-number">10.000000</span>, <span class="hljs-number">9.000000</span>)</span>, r0.wwww  
  62:   max r5.xyzw, r5.xyzw, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)</span>  
  63:   add r5.xyzw, r5.xyzw, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>)</span>  
  64:   div_sat r5.xyzw, r1.wwww, r5.xyzw  
  65:   add r5.xyzw, -r5.xyzw, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>)</span>  
  66:   mul r1.z, r1.z, r5.x  
  67:   mul r1.z, r5.y, r1.z  
  68:   mul r1.z, r5.z, r1.z  
  69:   mul r1.z, r5.w, r1.z  
  70:   mad r5.xyzw, r1.yyyy, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">8.000000</span>, <span class="hljs-number">7.000000</span>, <span class="hljs-number">6.000000</span>, <span class="hljs-number">5.000000</span>)</span>, r0.wwww  
  71:   max r5.xyzw, r5.xyzw, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)</span>  
  72:   add r5.xyzw, r5.xyzw, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>)</span>  
  73:   div_sat r5.xyzw, r1.wwww, r5.xyzw  
  74:   add r5.xyzw, -r5.xyzw, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>)</span>  
  75:   mul r1.z, r1.z, r5.x  
  76:   mul r1.z, r5.y, r1.z  
  77:   mul r1.z, r5.z, r1.z  
  78:   mul r1.z, r5.w, r1.z  
  79:   mad r5.xy, r1.yyyy, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">4.000000</span>, <span class="hljs-number">3.000000</span>, <span class="hljs-number">0.000000</span>, <span class="hljs-number">0.000000</span>)</span>, r0.wwww  
  80:   max r5.xy, r5.xyxx, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)</span>  
  81:   add r5.xy, r5.xyxx, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">0.000000</span>, <span class="hljs-number">0.000000</span>)</span>  
  82:   div_sat r5.xy, r1.wwww, r5.xyxx  
  83:   add r5.xy, -r5.xyxx, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">0.000000</span>, <span class="hljs-number">0.000000</span>)</span>  
  84:   mul r1.z, r1.z, r5.x  
  85:   mul r1.z, r5.y, r1.z  
  86:   mad r0.w, r1.y, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">2.000000</span>)</span>, r0.w  
  87:   max r0.w, r0.w, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span>  
  88:   add r0.w, r0.w, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">1.000000</span>)</span>  
  89:   div_sat r0.w, r1.w, r0.w  
  90:   add r0.w, -r0.w, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">1.000000</span>)</span>  
  91:   mul r0.w, r0.w, r1.z  
  92:   mad r0.y, r0.y, r0.z, r1.y  
  93:   max r0.y, r0.y, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span>  
  94:   add r0.y, r0.y, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">1.000000</span>)</span>  
  95:   div_sat r0.y, r1.w, r0.y  
  96:   add r0.y, -r0.y, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">1.000000</span>)</span>  
  97:   mad r0.y, -r0.w, r0.y, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">1.000000</span>)</span>  
  98:   add r0.z, r1.x, -cb12[48].y  
  99:   mul_sat r0.z, r0.z, cb12[48].z  
  100:  <span class="hljs-keyword">else</span>  
  101:   mov r0.yz, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">0.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">0.000000</span>, <span class="hljs-number">0.000000</span>)</span>  
  102:  endif  
  103:  <span class="hljs-built_in">log</span> r0.y, r0.y  
  104:  mul r0.w, r0.y, cb12[42].w  
  105:  <span class="hljs-built_in">exp</span> r0.w, r0.w  
  106:  mul r0.y, r0.y, cb12[48].x  
  107:  <span class="hljs-built_in">exp</span> r0.y, r0.y  
  108:  mul r0.yw, r0.yyyw, r0.zzzz  
  109:  mad_sat r1.xy, r0.wwww, cb12[189].xzxx, cb12[189].ywyy  
  110:  add r5.xyz, -r3.xyzx, cb12[188].xyzx  
  111:  mad r5.xyz, r1.xxxx, r5.xyzx, r3.xyzx  
  112:  add r0.z, cb12[188].w, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">-1.000000</span>)</span>  
  113:  mad r0.z, r1.y, r0.z, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">1.000000</span>)</span>  
  114:  mul_sat r5.w, r0.z, r0.w  
  115:  lt r0.z, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span>, cb12[192].x  
  116:  if_nz r0.z  
  117:   mad_sat r1.xy, r0.wwww, cb12[191].xzxx, cb12[191].ywyy  
  118:   add r6.xyz, -r3.xyzx, cb12[190].xyzx  
  119:   mad r3.xyz, r1.xxxx, r6.xyzx, r3.xyzx  
  120:   add r0.z, cb12[190].w, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">-1.000000</span>)</span>  
  121:   mad r0.z, r1.y, r0.z, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">1.000000</span>)</span>  
  122:   mul_sat r3.w, r0.z, r0.w  
  123:   add r1.xyzw, -r5.xyzw, r3.xyzw  
  124:   mad r5.xyzw, cb12[192].xxxx, r1.xyzw, r5.xyzw  
  125:  endif  
  126:  mul r0.z, r0.x, r5.w  
  127:  mul r0.x, r0.x, r0.y  
  128:  dp3 r0.y, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">0.333000</span>, <span class="hljs-number">0.555000</span>, <span class="hljs-number">0.222000</span>, <span class="hljs-number">0.000000</span>)</span>, r2.xyzx  
  129:  mad r1.xyz, r0.yyyy, r4.xyzx, -r2.xyzx  
  130:  mad r0.xyw, r0.xxxx, r1.xyxz, r2.xyxz  
  131:  add r1.xyz, -r0.xywx, r5.xyzx  
  132:  mad r0.xyz, r0.zzzz, r1.xyzx, r0.xywx  
  133: <span class="hljs-keyword">else</span>  
  134:  mov r0.xyz, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)</span>  
  135: endif  
  136: mov o0.xyz, r0.xyzx  
  137: mov o0.w, <span class="hljs-title">l</span><span class="hljs-params">(<span class="hljs-number">1.000000</span>)</span>  
  138: ret </span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдИрдорд╛рдирджрд╛рд░реА рд╕реЗ, рд╢реЗрдбрд░ рдХрд╛рдлреА рд▓рдВрдмрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╢рд╛рдпрдж рдПрдХ рдкреНрд░рднрд╛рд╡реА рд░рд┐рд╡рд░реНрд╕ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рд▓рдВрдмрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣рд╛рдБ рдХреЛрд╣рд░реЗ рдХреЗ рд╕рд╛рде рд╕реВрд░реНрдпрд╛рд╕реНрдд рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/375/d59/f51/375d59f5199e791efd99c218a0ea6f53.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдЗрдП рдЗрдирдкреБрдЯ рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВ: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЬреИрд╕рд╛ рдХрд┐ рдмрдирд╛рд╡рдЯ рдХреЗ рд▓рд┐рдП, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдЧрд╣рд░рд╛рдИ рдмрдлрд░, рдПрдореНрдмрд┐рдПрдВрдЯ рд╕рдорд╛рд╡реЗрд╢, рдФрд░ рдПрдХ рдПрдЪрдбреАрдЖрд░ рд░рдВрдЧ рдмрдлрд░ рд╣реИред</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ea/24d/ff0/9ea24dff07dad409a78834272d553b29.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рднреАрддрд░ рдХреА рдЧрд╣рд░рд╛рдИ рдмрдлрд░</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3e7/c8f/e3e/3e7c8fe3ee0dc58e3007f9a1bad7f877.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрд╡рдХ рдкрд░рд┐рд╡реЗрд╢ рд░реЛрдбрд╝рд╛</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/748/51f/f3c/74851ff3ce8d38b77d9319329a334d4f.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдиреЗ рд╡рд╛рд▓реЗ рдПрдЪрдбреАрдЖрд░ рд░рдВрдЧ рдмрдлрд░</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
... рдФрд░ рдЗрд╕ рджреГрд╢реНрдп рдореЗрдВ рдХреЛрд╣рд░реЗ рдХреА рдЫрд╛рдпрд╛ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ee/2f8/5ad/1ee2f85adc2cc870769985308b6dcc48.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрд╣рд░реЗ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдПрдЪрдбреАрдЖрд░ рдмрдирд╛рд╡рдЯред</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
рджреБрдирд┐рдпрд╛ рдореЗрдВ рд╕реНрдерд┐рддрд┐ рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЧрд╣рд░рд╛рдИ рдмрдлрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ Witcher 3 рд╢реЗрдбреНрд╕ рдХреЗ рд▓рд┐рдП рдорд╛рдирдХ рдкреИрдЯрд░реНрди рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд░рд┐рд╡реЗрд╢ рд░реЛрдбрд╝рд╛ рдбреЗрдЯрд╛ (рдпрджрд┐ рд╕рдХреНрд╖рдо рд╣реИ) рд╣рдореЗрдВ рдХреЛрд╣рд░реЗ рдХреЛ рдЕрд╕реНрдкрд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдПрдХ рдмрд╣реБрдд рд╣реА рдЪрддреБрд░ рд╡рд┐рдЪрд╛рд░, рд╢рд╛рдпрдж рдПрдХ рд╕реНрдкрд╖реНрдЯ рд╣реИ, рд▓реЗрдХрд┐рди рдореИрдВрдиреЗ рдХрднреА рдЗрд╕ рддрд░рд╣ рд╕реЗ рдирд╣реАрдВ рд╕реЛрдЪрд╛ рдерд╛ред рдореИрдВ рдЗрд╕ рдкрд╣рд▓реВ рдкрд░ рдмрд╛рдж рдореЗрдВ рд▓реМрдЯреВрдВрдЧрд╛ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрджрд┐ рдкрд┐рдХреНрд╕реЗрд▓ рдкрд┐рдХреНрд╕реЗрд▓ рдЖрдХрд╛рд╢ рдореЗрдВ рд╣реИ, рддреЛ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдХреЗ рдПрдХ рд╢реЗрдбрд░ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИред рдпрджрд┐ рдкрд┐рдХреНрд╕реЗрд▓ рдЖрдХрд╛рд╢ рдореЗрдВ рд╣реЛрддрд╛ рд╣реИ (рдЧрд╣рд░рд╛рдИ == 1.0), рддреЛ рд╢реЗрдб рдХрд╛рд▓рд╛ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред рдпрджрд┐ рдкрд┐рдХреНрд╕реЗрд▓ рджреГрд╢реНрдп рдореЗрдВ рд╣реИ (рдЧрд╣рд░рд╛рдИ &lt;1.0), рддреЛ рд╣рдо рдЧрд╣рд░рд╛рдИ рдмрдлрд░ (рд▓рд╛рдЗрдиреЛрдВ 7-11) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рджреБрдирд┐рдпрд╛ рдореЗрдВ рд╕реНрдерд┐рддрд┐ рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рддреЗ рд╣реИрдВ рдФрд░ рдХреЛрд╣рд░реЗ рдХреА рдЧрдгрдирд╛ рдХрд░рдирд╛ рдЬрд╛рд░реА рд░рдЦрддреЗ рд╣реИрдВред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╡рд┐рд▓рдВрдмрд┐рдд рдЫрд╛рдпрд╛рдВрдХрди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдХреБрдЫ рд╣реА рд╕рдордп рдмрд╛рдж рдХреЛрд╣рд░реЗ рдХрд╛ рдорд╛рд░реНрдЧ рдЖрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдлрд╝реЙрд░рд╡рд░реНрдб рд░рди рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдХреБрдЫ рддрддреНрд╡ рдЕрднреА рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕ рд╡рд┐рд╢реЗрд╖ рджреГрд╢реНрдп рдореЗрдВ, рдЖрд╕реНрдердЧрд┐рдд рдкреНрд░рдХрд╛рд╢ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдФрд░ рдЙрд╕рдХреЗ рдмрд╛рдж рд╣рдордиреЗ рдЧреЗрд░рд╛рд▓реНрдЯ рдХреЗ рдмрд╛рд▓реЛрдВ / рдЪреЗрд╣рд░реЗ / рдЖрдВрдЦреЛрдВ рдХреЛ рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдпрд╛ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд╣рд▓реА рдмрд╛рдд рдЖрдкрдХреЛ "рдж рд╡рд┐рдЪрд░ 3" рдореЗрдВ рдХреЛрд╣рд░реЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛: рдЗрд╕рдореЗрдВ рджреЛ рднрд╛рдЧ рд╣реЛрддреЗ рд╣реИрдВ - "рдХреЛрд╣рд░реЗ рдХрд╛ рд░рдВрдЧ" рдФрд░ "рд╡рд╛рддрд╛рд╡рд░рдг рдХрд╛ рд░рдВрдЧ"ред</font></font><br>
<br>
<pre><code class="cpp hljs"> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">FogResult</span>  
 {</span>  
    float4 paramsFog;     <span class="hljs-comment">// RGB: color, A: influence  </span>
    float4 paramsAerial;  <span class="hljs-comment">// RGB: color, A: influence  </span>
 };</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкреНрд░рддреНрдпреЗрдХ рднрд╛рдЧ рдХреЗ рд▓рд┐рдП рддреАрди рд░рдВрдЧ рд╣реИрдВ: рд╕рд╛рдордиреЗ, рдордзреНрдп рдФрд░ рдкреАрдЫреЗред </font><font style="vertical-align: inherit;">рдЕрд░реНрдерд╛рддреН, рдирд┐рд░рдВрддрд░ рдмрдлрд░ рдореЗрдВ "FogColorFront", "FogColorMiddle", "AerialColorBack", рдЖрджрд┐ рдЬреИрд╕реЗ рдбреЗрдЯрд╛ рд╣реИрдВ ... рдЖрдЗрдП рдЖрдиреЗ рд╡рд╛рд▓реЗ рдбреЗрдЯрд╛ рдХреЛ рджреЗрдЦреЗрдВ:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0b2/cd0/55d/0b2cd055d9f6876c57527b9934b3b6ad.png"></div><br>
<pre><code class="cpp hljs">   <span class="hljs-comment">// *** Inputs *** //  </span><font></font>
   float3 FogSunDir = cb12_v38.xyz;  <font></font>
   float3 FogColorFront = cb12_v39.xyz;  <font></font>
   float3 FogColorMiddle = cb12_v40.xyz;  <font></font>
   float3 FogColorBack = cb12_v41.xyz;  <font></font>
     <font></font>
   float4 FogBaseParams = cb12_v42;  <font></font>
   float4 FogDensityParamsScene = cb12_v43;  <font></font>
   float4 FogDensityParamsSky = cb12_v44;  <font></font>
     <font></font>
   float3 AerialColorFront = cb12_v45.xyz;  <font></font>
   float3 AerialColorMiddle = cb12_v46.xyz;  <font></font>
   float3 AerialColorBack = cb12_v47.xyz;  <font></font>
   float4 AerialParams = cb12_v48;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдВрддрд┐рдо рд░рдВрдЧреЛрдВ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рд╣рдореЗрдВ рд╡реИрдХреНрдЯрд░ рдФрд░ рд╕реНрдХреЗрд▓рд░ рдЙрддреНрдкрд╛рджреЛрдВ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">Shader рдХреА рджреБрдирд┐рдпрд╛ рдореЗрдВ рдкрд┐рдХреНрд╕реЗрд▓ рд╕реНрдерд┐рддрд┐, рдХреИрдорд░рд╛ рд╕реНрдерд┐рддрд┐ (cb12 [0] .xyz) рдФрд░ рдХреЛрд╣рд░реЗ / рдкреНрд░рдХрд╛рд╢ рджрд┐рд╢рд╛ (cb12 [38] .xyz) рддрдХ рдкрд╣реБрдВрдЪ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рд╣рдореЗрдВ рдХреЛрд╣рд░реЗ рдХреЗ рд░реВрдк рдФрд░ рджрд┐рд╢рд╛ рдХреЗ рд╡реЗрдХреНрдЯрд░ рдХреЗ рд╕реНрдХреЗрд▓рд░ рдЙрддреНрдкрд╛рдж рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред</font></font><br>
<br>
<pre><code class="cpp hljs">   float3 frag_vec = fragPosWorldSpace.xyz - customCameraPos.xyz;  
   <span class="hljs-keyword">float</span> frag_dist = length(frag_vec);  <font></font>
     <font></font>
   float3 frag_dir = frag_vec / frag_dist;  <font></font>
   <font></font>
   <span class="hljs-keyword">float</span> dot_fragDirSunDir = dot(GlobalLightDirection.xyz, frag_dir);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдорд┐рдХреНрд╕рд┐рдВрдЧ рдЧреНрд░реЗрдбрд┐рдПрдВрдЯ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдкреВрд░реНрдг рд╕реНрдХреЗрд▓рд░ рдЙрддреНрдкрд╛рдж рдХреЗ рд╡рд░реНрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдФрд░ рдлрд┐рд░ рдкрд░рд┐рдгрд╛рдо рдХреЛ рдХреБрдЫ рдкреИрд░рд╛рдореАрдЯрд░ рд╕реЗ рдЧреБрдгрд╛ рдХрд░реЗрдВ рдЬреЛ рджреВрд░реА рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ:</font></font><br>
<br>
<pre><code class="cpp hljs">   float3 curr_col_fog;  <font></font>
   float3 curr_col_aerial;  <font></font>
   {  <font></font>
     <span class="hljs-keyword">float</span> _dot = dot_fragDirSunDir;  <font></font>
   <font></font>
     <span class="hljs-keyword">float</span> _dd = _dot;  <font></font>
     {  <font></font>
       <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> _distOffset = <span class="hljs-number">-150</span>;  
       <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> _distRange = <span class="hljs-number">500</span>;  
       <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> _mul = <span class="hljs-number">1.0</span> / _distRange;  
       <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> _bias = _distOffset * _mul;  <font></font>
   <font></font>
       _dd = <span class="hljs-built_in">abs</span>(_dd);  <font></font>
       _dd *= _dd;  <font></font>
       _dd *= saturate( frag_dist * _mul + _bias );  <font></font>
     }  <font></font>
   <font></font>
     curr_col_fog = lerp( FogColorMiddle.xyz, (_dot&gt;<span class="hljs-number">0.0f</span> ? FogColorFront.xyz : FogColorBack.xyz), _dd );  <font></font>
     curr_col_aerial = lerp( AerialColorMiddle.xyz, (_dot&gt;<span class="hljs-number">0.0f</span> ? AerialColorFront.xyz : AerialColorBack.xyz), _dd );  <font></font>
   }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рдХреЛрдб рдмреНрд▓реЙрдХ рд╣рдореЗрдВ рдпрд╣ рд╕реНрдкрд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдпреЗ 0.002 рдФрд░ -0.300 рдХрд╣рд╛рдВ рд╕реЗ рдЖрдП рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЬреИрд╕рд╛ рдХрд┐ рд╣рдо рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рджреГрд╢реНрдп рдФрд░ рдкреНрд░рдХрд╛рд╢ рд╡реНрдпрд╡рд╕реНрдерд╛ рдХреЗ рдмреАрдЪ рд╕реНрдХреЗрд▓рд░ рдЙрддреНрдкрд╛рдж "рдлреНрд░рдВрдЯ" рдФрд░ "рдмреИрдХ" рд░рдВрдЧреЛрдВ рдХреЗ рдмреАрдЪ рдЪреБрдирд╛рд╡ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИред </font><font style="vertical-align: inherit;">рдЪрддреБрд░! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣рд╛рдБ рдкрд░рд┐рдгрд╛рдореА рдЕрдВрддрд┐рдо рдврд╛рд▓ (_dd) рдХрд╛ рдПрдХ рджреГрд╢реНрдп рд╣реИред</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d43/f03/ca0/d43f03ca005d504abd5cd236007f34f4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╡рд╛рдпреБрдордВрдбрд▓ / рдХреЛрд╣рд░реЗ рдХреЗ рдкреНрд░рднрд╛рд╡ рдХреА рдЧрдгрдирд╛ рдХрд░рдирд╛ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИред рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЖрд░рдЬреАрдмреА рд░рдВрдЧреЛрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╡рд┐рдХрд▓реНрдк рд╣реИрдВред рд╡реЗ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рджреГрд╢реНрдп рдШрдирддреНрд╡ред рд╣рдо рдХреЛрд╣рд░реЗ рдХреЗ рдЖрдХрд╛рд░ рдФрд░ рд╕реНрдХреЗрд▓ рдлреИрдХреНрдЯрд░ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд░реЗрдорд░реНрд╕рд┐рдВрдЧ (16 рдЪрд░рдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдпрд╣реА рдХрд╛рд░рдг рд╣реИ рдХрд┐ рдЪрдХреНрд░ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ): </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ рд╡реЗрдХреНрдЯрд░ [рдХреИрдорд░рд╛ ---&gt; рджреБрдирд┐рдпрд╛] рд╣реЛрдиреЗ рдкрд░, рд╣рдо рдЗрд╕рдХреЗ рд╕рднреА рдШрдЯрдХреЛрдВ рдХреЛ 16 рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ - рдпрд╣ рдПрдХ рдкреНрд░рд╛рд░реВрдкрдг рдЪрд░рдг рд╣реЛрдЧрд╛ред рдЬреИрд╕рд╛ рдХрд┐ рд╣рдо рдиреАрдЪреЗ рджреЗрдЦрддреЗ рд╣реИрдВ, рдЧрдгрдирд╛ рдореЗрдВ рдХреЗрд╡рд▓ .z (рдКрдВрдЪрд╛рдИ) рдШрдЯрдХ ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cur_pos_z_step</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><font style="vertical-align: inherit;">рд╢рд╛рдорд┐рд▓ рд╣реИ </font><font style="vertical-align: inherit;">ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреЛрд╣рд░реЗ raymarching рджреНрд╡рд╛рд░рд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдЕрдзрд┐рдХ рдкрдврд╝реЗрдВ, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдБ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред</font></font><br>
<br>
<pre><code class="cpp hljs">   <span class="hljs-keyword">float</span> fog_amount = <span class="hljs-number">1</span>;  
   <span class="hljs-keyword">float</span> fog_amount_scale = <span class="hljs-number">0</span>;  <font></font>
   [branch]  <font></font>
   <span class="hljs-keyword">if</span> ( frag_dist &gt;= AerialParams.y )  <font></font>
   {  <font></font>
     <span class="hljs-keyword">float</span> curr_pos_z_base = (customCameraPos.z + FogBaseParams.y) * density_factor;  
     <span class="hljs-keyword">float</span> curr_pos_z_step = frag_step.z * density_factor;  <font></font>
   <font></font>
     [unroll]  <font></font>
     <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i=<span class="hljs-number">16</span>; i&gt;<span class="hljs-number">0</span>; --i )  <font></font>
     {  <font></font>
       fog_amount *= <span class="hljs-number">1</span> - saturate( density_sample_scale / (<span class="hljs-number">1</span> + max( <span class="hljs-number">0.0</span>, curr_pos_z_base + (i) * curr_pos_z_step ) ) );  <font></font>
     }  <font></font>
   <font></font>
     fog_amount = <span class="hljs-number">1</span> - fog_amount;  <font></font>
     fog_amount_scale = saturate( (frag_dist - AerialParams.y) * AerialParams.z );  <font></font>
   }  <font></font>
   <font></font>
   FogResult ret;  <font></font>
   <font></font>
   ret.paramsFog = float4 ( curr_col_fog, fog_amount_scale * <span class="hljs-built_in">pow</span>( <span class="hljs-built_in">abs</span>(fog_amount), final_exp_fog ) );  <font></font>
   ret.paramsAerial = float4 ( curr_col_aerial, fog_amount_scale * <span class="hljs-built_in">pow</span>( <span class="hljs-built_in">abs</span>(fog_amount), final_exp_aerial ) );</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреЛрд╣рд░реЗ рдХреА рдорд╛рддреНрд░рд╛ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдКрдВрдЪрд╛рдИ (рдШрдЯрдХреЛрдВ .z) рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреА рд╣реИ, рдЕрдВрдд рдореЗрдВ рдХреЛрд╣рд░реЗ рдХреА рдорд╛рддреНрд░рд╛ рдХреЛрд╣рд░реЗ / рд╡рд╛рдпреБрдордВрдбрд▓ рдХреА рдбрд┐рдЧреНрд░реА рддрдХ рдмрдврд╝рд╛ рджреА рдЬрд╛рддреА рд╣реИред </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">final_exp_fog</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">final_exp_aerial</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛ рдирд┐рд░рдВрддрд░ рдмрдлрд░ рд╕реЗ рд▓рд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ; </font><font style="vertical-align: inherit;">рд╡реЗ рдЖрдкрдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВ рдХрд┐ рдХреЛрд╣рд░реЗ рдФрд░ рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рд░рдВрдЧ рджреБрдирд┐рдпрд╛ рдХреЛ рдмрдврд╝рддреА рдКрдВрдЪрд╛рдИ рдХреЗ рд╕рд╛рде рдХреИрд╕реЗ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддреЗ рд╣реИрдВред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрд╣рд░рд╛ рдЫрд╛ рдЧрдпрд╛</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореБрдЭреЗ рдЬреЛ рдЫрд╛рдпрд╛рджрд╛рд░ рдорд┐рд▓рд╛, рдЙрд╕рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╡рд┐рдзрд╛рдирд╕рднрд╛ рдХреЛрдб рдирд╣реАрдВ рдерд╛:</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-number">109</span>:  mad_sat r1.xy, r0.wwww, cb12[<span class="hljs-number">189</span>].xzxx, cb12[<span class="hljs-number">189</span>].ywyy  
  <span class="hljs-number">110</span>:  add r5.xyz, -r3.xyzx, cb12[<span class="hljs-number">188</span>].xyzx  
  <span class="hljs-number">111</span>:  mad r5.xyz, r1.xxxx, r5.xyzx, r3.xyzx  
  <span class="hljs-number">112</span>:  add r0.z, l(<span class="hljs-number">-1.000000</span>), cb12[<span class="hljs-number">188</span>].w  
  <span class="hljs-number">113</span>:  mad r0.z, r1.y, r0.z, l(<span class="hljs-number">1.000000</span>)  
  <span class="hljs-number">114</span>:  mul_sat r5.w, r0.w, r0.z  
  <span class="hljs-number">115</span>:  lt r0.z, l(<span class="hljs-number">0.000000</span>), cb12[<span class="hljs-number">192</span>].x  
  <span class="hljs-number">116</span>:  if_nz r0.z  
  <span class="hljs-number">117</span>:   mad_sat r1.xy, r0.wwww, cb12[<span class="hljs-number">191</span>].xzxx, cb12[<span class="hljs-number">191</span>].ywyy  
  <span class="hljs-number">118</span>:   add r6.xyz, -r3.xyzx, cb12[<span class="hljs-number">190</span>].xyzx  
  <span class="hljs-number">119</span>:   mad r3.xyz, r1.xxxx, r6.xyzx, r3.xyzx  
  <span class="hljs-number">120</span>:   add r0.z, l(<span class="hljs-number">-1.000000</span>), cb12[<span class="hljs-number">190</span>].w  
  <span class="hljs-number">121</span>:   mad r0.z, r1.y, r0.z, l(<span class="hljs-number">1.000000</span>)  
  <span class="hljs-number">122</span>:   mul_sat r3.w, r0.w, r0.z  
  <span class="hljs-number">123</span>:   add r1.xyzw, -r5.xyzw, r3.xyzw  
  <span class="hljs-number">124</span>:   mad r5.xyzw, cb12[<span class="hljs-number">192</span>].xxxx, r1.xyzw, r5.xyzw  
  <span class="hljs-number">125</span>:  endif</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЬрд┐рд╕реЗ рдореИрдВ рд╕рдордЭрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдерд╛, рдЙрд╕реЗ рджреЗрдЦрддреЗ рд╣реБрдП, рдпрд╣ рд░рдВрдЧ рдФрд░ рдХреЛрд╣рд░реЗ рдХреЗ рдкреНрд░рднрд╛рд╡ рдХреЛ </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдлрд┐рд░ рд╕реЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдЬреИрд╕рд╛ рд╣реИ </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">рдЕрдзрд┐рдХрд╛рдВрд╢ рд╕рдордп, рдХреЗрд╡рд▓ рдПрдХ рдкреБрдирд░реНрдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (cb12_v192.x 0.0), рд▓реЗрдХрд┐рди рдЗрд╕ рд╡рд┐рд╢реЗрд╖ рдорд╛рдорд▓реЗ рдореЗрдВ рдЗрд╕рдХрд╛ рдорд╛рди ~ 0.22 рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рджреВрд╕рд░рд╛ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░рддреЗ рд╣реИрдВред</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cc7/2bd/1b8/cc72bd1b8cff0742cf4aad51a7e6ab3f.png"></div><br>
<pre><code class="cpp hljs"> <span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> OVERRIDE_FOG  </span><font></font>
     <font></font>
   <span class="hljs-comment">// Override  </span>
   <span class="hljs-keyword">float</span> fog_influence = ret.paramsFog.w; <span class="hljs-comment">// r0.w  </span><font></font>
   <font></font>
   <span class="hljs-keyword">float</span> override1ColorScale = cb12_v189.x;  
   <span class="hljs-keyword">float</span> override1ColorBias = cb12_v189.y;  <font></font>
   float3 override1Color = cb12_v188.rgb;  <font></font>
     <font></font>
   <span class="hljs-keyword">float</span> override1InfluenceScale = cb12_v189.z;  
   <span class="hljs-keyword">float</span> override1InfluenceBias = cb12_v189.w;  
   <span class="hljs-keyword">float</span> override1Influence = cb12_v188.w;  <font></font>
     <font></font>
   <span class="hljs-keyword">float</span> override1ColorAmount = saturate(fog_influence * override1ColorScale + override1ColorBias);  
   <span class="hljs-keyword">float</span> override1InfluenceAmount = saturate(fog_influence * override1InfluenceScale + override1InfluenceBias);    <font></font>
     <font></font>
<font></font>
   float4 paramsFogOverride;  <font></font>
   paramsFogOverride.rgb = lerp(curr_col_fog, override1Color, override1ColorAmount ); <span class="hljs-comment">// ***r5.xyz   </span><font></font>
     <font></font>
   <span class="hljs-keyword">float</span> param1 = lerp(<span class="hljs-number">1.0</span>, override1Influence, override1InfluenceAmount); <span class="hljs-comment">// r0.x  </span>
   paramsFogOverride.w = saturate(param1 * fog_influence ); <span class="hljs-comment">// ** r5.w  </span><font></font>
   <font></font>
     <font></font>
   <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> extraFogOverride = cb12_v192.x;  <font></font>
     <font></font>
   [branch]   <font></font>
   <span class="hljs-keyword">if</span> (extraFogOverride &gt; <span class="hljs-number">0.0</span>)  <font></font>
   {  <font></font>
     <span class="hljs-keyword">float</span> override2ColorScale = cb12_v191.x;  
     <span class="hljs-keyword">float</span> override2ColorBias = cb12_v191.y;  <font></font>
     float3 override2Color = cb12_v190.rgb;  <font></font>
     <font></font>
     <span class="hljs-keyword">float</span> override2InfluenceScale = cb12_v191.z;  
     <span class="hljs-keyword">float</span> override2InfluenceBias = cb12_v191.w;  
     <span class="hljs-keyword">float</span> override2Influence = cb12_v190.w;  <font></font>
       <font></font>
     <span class="hljs-keyword">float</span> override2ColorAmount = saturate(fog_influence * override2ColorScale + override2ColorBias);  
     <span class="hljs-keyword">float</span> override2InfluenceAmount = saturate(fog_influence * override2InfluenceScale + override2InfluenceBias);  <font></font>
      <font></font>
<font></font>
     float4 paramsFogOverride2;  <font></font>
     paramsFogOverride2.rgb = lerp(curr_col_fog, override2Color, override2ColorAmount); <span class="hljs-comment">// r3.xyz   </span><font></font>
           <font></font>
     <span class="hljs-keyword">float</span> ov_param1 = lerp(<span class="hljs-number">1.0</span>, override2Influence, override2InfluenceAmount); <span class="hljs-comment">// r0.z  </span>
     paramsFogOverride2.w = saturate(ov_param1 * fog_influence); <span class="hljs-comment">// r3.w  </span><font></font>
   <font></font>
     paramsFogOverride = lerp(paramsFogOverride, paramsFogOverride2, extraFogOverride);  <font></font>
   <font></font>
   }  <font></font>
   ret.paramsFog = paramsFogOverride;  <font></font>
     <font></font>
 <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣рд╛рдБ рдПрдХ рд░реЗрдбрд┐рдлрд┐рдирд┐рд╢рди (рджреВрд╕рд░реА рдЫрд╡рд┐) рдФрд░ рдбрдмрд▓ рд░рд┐рдбрд┐рдлрд╛рдЗрдирдореЗрдВрдЯ (рддреАрд╕рд░реА рдЫрд╡рд┐, рдЕрдВрддрд┐рдо рдкрд░рд┐рдгрд╛рдо) рдХреЗ рд╕рд╛рде рдХреЛрд╣рд░реЗ (рдкрд╣рд▓реА рдЫрд╡рд┐) рдХреЛ рдлрд┐рд░ рд╕реЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдП рдмрд┐рдирд╛ рд╣рдорд╛рд░реА рддреИрдпрд╛рд░ рдХреАрдордд рд╣реИ:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b9/011/3c8/3b90113c8ad27f287cdb29a25a37470d.jpg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/03a/791/d39/03a791d39e2082b80e86ea8daa488a64.jpg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/375/d59/f51/375d59f5199e791efd99c218a0ea6f53.jpg"></div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░рд┐рд╡реЗрд╢ рд░реЛрдбрд╝рд╛ рдХрд╛ рд╡рд┐рдирд┐рдпрдорди</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореБрдЭреЗ рдЬреЛ рдЫрд╛рдпрд╛рджрд╛рд░ рдорд┐рд▓рд╛, рдЙрд╕рдореЗрдВ рдкрд░рд┐рд╡реЗрд╢рдЧрдд рд░реЛрдбрд╝рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдлрд┐рд░ рд╕реЗ AO рдХреА рдмрдирд╛рд╡рдЯ рдФрд░ рдЙрд╕ рдХреЛрдб рдХреЛ рджреЗрдЦреЗрдВ рдЬреЛ рд╣рдореЗрдВ рд░реБрдЪрддрд╛ рд╣реИ:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3e7/c8f/e3e/3e7c8fe3ee0dc58e3007f9a1bad7f877.jpg"></div><br>
<pre><code class="cpp hljs">  <span class="hljs-number">13</span>:  ld_indexable(texture2d)(<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>,<span class="hljs-keyword">float</span>) r0.x, r0.xyzw, t2.xyzw  
  <span class="hljs-number">14</span>:  max r0.x, r0.x, cb3[<span class="hljs-number">1</span>].x  
  <span class="hljs-number">15</span>:  add r0.yzw, r1.xxyz, -cb12[<span class="hljs-number">0</span>].xxyz  
  <span class="hljs-number">16</span>:  dp3 r1.x, r0.yzwy, r0.yzwy  
  <span class="hljs-number">17</span>:  <span class="hljs-built_in">sqrt</span> r1.x, r1.x  
  <span class="hljs-number">18</span>:  add r1.y, r1.x, -cb3[<span class="hljs-number">0</span>].x  
  <span class="hljs-number">19</span>:  add r1.zw, -cb3[<span class="hljs-number">0</span>].xxxz, cb3[<span class="hljs-number">0</span>].yyyw  
  <span class="hljs-number">20</span>:  div_sat r1.y, r1.y, r1.z  
  <span class="hljs-number">21</span>:  mad r1.y, r1.y, r1.w, cb3[<span class="hljs-number">0</span>].z  
  <span class="hljs-number">22</span>:  add r0.x, r0.x, l(<span class="hljs-number">-1.000000</span>)  
  <span class="hljs-number">23</span>:  mad r0.x, r1.y, r0.x, l(<span class="hljs-number">1.000000</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╢рд╛рдпрдж рдпрд╣ рджреГрд╢реНрдп рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рдЙрджрд╛рд╣рд░рдг рдирд╣реАрдВ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рдПрдХ рджреВрд░ рдХреЗ рджреНрд╡реАрдк рдкрд░ рд╡рд┐рд╡рд░рдг рдирд╣реАрдВ рджреЗрдЦрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдЗрдП рдирд┐рд░рдВрддрд░ рдмрдлрд░ рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВ, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдкрд░рд┐рд╡реЗрд╢ рд░реЛрдбрд╝рд╛ рдореВрд▓реНрдп рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/343/c52/af4/343c52af44338628770912801bc3b32c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо рдмрдирд╛рд╡рдЯ рд╕реЗ рдПрдУ рдХреЛ рд▓реЛрдб рдХрд░рдХреЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ, рдлрд┐рд░ рдЕрдзрд┐рдХрддрдо рдирд┐рд░реНрджреЗрд╢ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╣реИрдВред рдЗрд╕ рджреГрд╢реНрдп рдореЗрдВ, cb3_v1.x рдмрд╣реБрдд рдЕрдзрд┐рдХ (0.96888) рд╣реИ, рдЬреЛ AO рдХреЛ рдмрд╣реБрдд рдХрдордЬреЛрд░ рдмрдирд╛рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреЛрдб рдХрд╛ рдЕрдЧрд▓рд╛ рднрд╛рдЧ рджреБрдирд┐рдпрд╛ рдореЗрдВ рдХреИрдорд░реЗ рдФрд░ рдкрд┐рдХреНрд╕реЗрд▓ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЗ рдмреАрдЪ рдХреА рджреВрд░реА рдХреА рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореЗрд░рд╛ рдорд╛рдирдирд╛ тАЛтАЛрд╣реИ рдХрд┐ рдХреЛрдб рдХрднреА-рдХрднреА рдЦреБрдж рдХреЗ рд▓рд┐рдП рдмреЛрд▓рддрд╛ рд╣реИ, рддреЛ рдЖрдЗрдП рдПрдЪрдПрд▓рдПрд╕рдПрд▓ рдХреЛ рджреЗрдЦреЗрдВ, рдЬреЛ рдЗрд╕ рд╕реЗрдЯрдЕрдк рдХреЗ рдереЛрдХ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ:</font></font><br>
<br>
<pre><code class="cpp hljs"> <span class="hljs-function"><span class="hljs-keyword">float</span> <span class="hljs-title">AdjustAmbientOcclusion</span><span class="hljs-params">(in <span class="hljs-keyword">float</span> inputAO, in <span class="hljs-keyword">float</span> worldToCameraDistance)</span>  
 </span>{  
   <span class="hljs-comment">// *** Inputs *** //  </span>
   <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> aoDistanceStart = cb3_v0.x;  
   <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> aoDistanceEnd = cb3_v0.y;  
   <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> aoStrengthStart = cb3_v0.z;  
   <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> aoStrengthEnd = cb3_v0.w;  <font></font>
      <font></font>
   <span class="hljs-comment">// * Adjust AO  </span>
   <span class="hljs-keyword">float</span> aoDistanceIntensity = linstep( aoDistanceStart, aoDistanceEnd, worldToCameraDistance );  
   <span class="hljs-keyword">float</span> aoStrength = lerp(aoStrengthStart, aoStrengthEnd, aoDistanceIntensity);   
   <span class="hljs-keyword">float</span> adjustedAO = lerp(<span class="hljs-number">1.0</span>, inputAO, aoStrength);  <font></font>
     <font></font>
   <span class="hljs-keyword">return</span> adjustedAO;   <font></font>
 }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреИрдорд░реЗ рдФрд░ рджреБрдирд┐рдпрд╛ рдХреЗ рдмреАрдЪ рдХреА рдЧрдгрдирд╛ рджреВрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рд▓рд┐рдирд╕реНрдЯреЗрдк рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЬрд╛рдирддреЗ рд╣реИрдВ, рдпрд╣ рд╕рд┐рд░рд╕ рдХреНрд▓рд╛рдЙрдб рд╢реЗрдбрд░ рдореЗрдВ рджрд┐рдЦрд╛рдИ рджрд┐рдпрд╛ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдирд┐рд░рдВрддрд░ рдмрдлрд░ рдореЗрдВ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдУ рд╕реНрдЯрд╛рд░реНрдЯ / рдПрдВрдб рдбрд┐рд╕реНрдЯреЗрдВрд╕ рд╡реИрд▓реНрдпреВ рд╣реИред </font><font style="vertical-align: inherit;">рд▓рд┐рдирд╕реНрдЯреЗрдк рдХрд╛ рдЖрдЙрдЯрдкреБрдЯ рдПрдУ рдХреА рддрд╛рдХрдд (рдФрд░ рд╕рд╛рде рд╣реА рд╕реАрдмреАрдПрдлрд╝рд░ рд╕реЗ) рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдФрд░ рддрд╛рдХрдд рдПрдУ рдХреЗ рдЖрдЙрдЯрдкреБрдЯ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдЙрджрд╛рд╣рд░рдг: рдкрд┐рдХреНрд╕реЗрд▓ рджреВрд░ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рджреВрд░реА 500 рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд▓рд┐рдирд╕реНрдЯреЗрдк 1.0 рд░рд┐рдЯрд░реНрди; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
anoStrength рдмрд░рд╛рдмрд░ aoStrengthEnd рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИ; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рдПрдУ рд░рд┐рдЯрд░реНрди рдореЗрдВ рдкрд░рд┐рдгрд╛рдо рджреЗрддрд╛ рд╣реИ, рдЬреЛ рдЗрдирдкреБрдЯ рдореВрд▓реНрдп рдХрд╛ рд▓рдЧрднрдЧ 77% (рдЕрдВрддрд┐рдо рдмрд▓) рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдЖрдиреЗ рд╡рд╛рд▓реА AO рдХреЛ рдкрд╣рд▓реЗ рдЕрдзрд┐рдХрддрдо рдСрдкрд░реЗрд╢рди рдХреЗ рдЕрдзреАрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рд╕рдм рдПрдХ рд╕рд╛рде рдбрд╛рд▓реЗрдВ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреЛрд╣рд░реЗ рдХреЗ рд░рдВрдЧ рдФрд░ рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рд░рдВрдЧ рдХреЗ рд▓рд┐рдП рд░рдВрдЧ рдФрд░ рдкреНрд░рднрд╛рд╡ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдк рдЕрдВрдд рдореЗрдВ рдЙрдиреНрд╣реЗрдВ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рдПрдУ рдХреЗ рд╕рд╛рде рдкреНрд░рднрд╛рд╡ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ:</font></font><br>
<br>
<pre><code class="cpp hljs">   ...<font></font>
   FogResult fog = CalculateFog( worldPos, CameraPosition, fogStart, ao, <span class="hljs-literal">false</span> );  <font></font>
      <font></font>
   <span class="hljs-comment">// Apply AO to influence  </span><font></font>
   fog.paramsFog.w *= ao;  <font></font>
   fog.paramsAerial.w *= ao; <font></font>
      <font></font>
   <span class="hljs-comment">// Mix fog with scene color  </span>
   outColor = ApplyFog(fog, colorHDR);</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рднреА рдЬрд╛рджреВ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ApplyFog</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ </font><b><font style="vertical-align: inherit;">рд╣реЛрддрд╛</font></b><font style="vertical-align: inherit;"> рд╣реИ </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cpp hljs"> <span class="hljs-function">float3 <span class="hljs-title">ApplyFog</span><span class="hljs-params">(FogResult fog, float3 color)</span>  
 </span>{  
   <span class="hljs-keyword">const</span> float3 LuminanceFactors = float3(<span class="hljs-number">0.333f</span>, <span class="hljs-number">0.555f</span>, <span class="hljs-number">0.222f</span>);  <font></font>
   <font></font>
   float3 aerialColor = dot(LuminanceFactors, color) * fog.paramsAerial.xyz;  <font></font>
   color = lerp(color, aerialColor, fog.paramsAerial.w);  <font></font>
   color = lerp(color, fog.paramsFog.xyz, fog.paramsFog.w);  <font></font>
    <font></font>
   <span class="hljs-keyword">return</span> color.xyz;  <font></font>
 }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рдкрд┐рдХреНрд╕реЗрд▓ рдХреА рдЪрдордХ рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВ:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6bd/b00/570/6bdb005708a11953aeb8ce711a942f0d.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдлрд┐рд░ рд╣рдо рдЗрд╕реЗ рд╡рд╛рдпреБрдордВрдбрд▓ рдХреЗ рд░рдВрдЧ рд╕реЗ рдЧреБрдгрд╛ рдХрд░рддреЗ рд╣реИрдВ:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e7d/f89/f04/e7df89f04524c4e547a91a645317a387.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдлрд┐рд░ рд╣рдо рдПрдЪрдбреАрдЖрд░ рд░рдВрдЧ рдХреЛ рд╡рд╛рдпреБрдордВрдбрд▓ рдХреЗ рд░рдВрдЧ рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cae/40a/912/cae40a9124b33e97aa38ac5b72b9a5ae.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдВрддрд┐рдо рдЪрд░рдг рдХреЛрд╣рд░реЗ рдХреЗ рд░рдВрдЧ рдХреЗ рд╕рд╛рде рдордзреНрдпрд╡рд░реНрддреА рдкрд░рд┐рдгрд╛рдо рдХреЛ рд╕рдВрдпреЛрдЬрд┐рдд рдХрд░рдирд╛ рд╣реИ:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ee/2f8/5ad/1ee2f85adc2cc870769985308b6dcc48.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдмрд╕ рдЗрддрдирд╛ рд╣реА!</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреБрдЫ рдбрд┐рдмрдЧрд┐рдВрдЧ рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ</font></font></h4><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/012/b08/e69/012b08e69615702c9267f24f167dfa98.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рдпреБрдордВрдбрд▓реАрдп рдкреНрд░рднрд╛рд╡</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b1b/c3a/f2c/b1bc3af2c5d59db606570a54e861659b.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рдпреБрдордВрдбрд▓ рдХрд╛ рд░рдВрдЧ</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d10/b17/0ab/d10b170ab255b3ff9b4d6fad60e1c1e3.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрд╣рд░реЗ рдХрд╛ рдЕрд╕рд░</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d76/9ae/dde/d769aedde1917ab6024e524d9c99625d.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрд╣рд░реЗ рдХрд╛ рд░рдВрдЧ</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7ad/b15/0dd/7adb150dddf4df73c8dc75e51aa9e138.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрд╣рд░реЗ рдХреЗ рдмрд┐рдирд╛ рджреГрд╢реНрдп рд╕рдорд╛рдкреНрдд</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f53/fdc/507/f53fdc5076e000acb24a775ba7558e8a.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрд╣рд░реЗ рдХреЗ рд╕рд╛рде рддреИрдпрд╛рд░ рджреГрд╢реНрдп</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad1/223/e4a/ad1223e4aabc3dc3f07a77125b54211f.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдорд╛рдкреНрдд рджреГрд╢реНрдп рд╕рд┐рд░реНрдл рдореБрдЦреНрдп рдХреЛрд╣рд░рд╛ рд╣реИ</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/375/d59/f51/375d59f5199e791efd99c218a0ea6f53.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреБрд▓рдирд╛ рдХреА рдЖрд╕рд╛рдиреА рдХреЗ рд▓рд┐рдП рд╕рднреА рдХреЛрд╣рд░реЗ рдХреЗ рд╕рд╛рде рдлрд┐рд░ рд╕реЗ рддреИрдпрд╛рд░ рджреГрд╢реНрдп</font></font></i><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдкреВрд░реНрдг</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдЖрдк рдЙрдкрд░реЛрдХреНрдд рдмрд╣реБрдд рдХреБрдЫ рд╕рдордЭ рд╕рдХрддреЗ рд╣реИрдВ, рдпрджрд┐ рдЖрдк рд╢реИрдбрд░ рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ рд╣реИ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореИрдВ рдЦреБрд╢реА рдХреЗ рд╕рд╛рде рдХрд╣ рд╕рдХрддрд╛ рд╣реВрдВ рдХрд┐ рдпрд╣ рд╢реЗрдбрд░ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд┐рд▓реНрдХреБрд▓</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореВрд▓ рдХреЗ рд╕рдорд╛рди рд╣реИ - рдпрд╣ рдореБрдЭреЗ рдмрд╣реБрдд рдЦреБрд╢ рдХрд░рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдЕрдВрддрд┐рдо рдкрд░рд┐рдгрд╛рдо рд╢реИрдбрд░ рдХреЛ рджрд┐рдП рдЧрдП рдорд╛рдиреЛрдВ рдкрд░ рдЕрддреНрдпрдзрд┐рдХ рдирд┐рд░реНрднрд░ рд╣реЛрддрд╛ рд╣реИред рдпрд╣ рдПрдХ "рдЬрд╛рджреБрдИ" рд╕рдорд╛рдзрд╛рди рдирд╣реАрдВ рд╣реИ рдЬреЛ рдЖрдЙрдЯрдкреБрдЯ рдХреЗ рд▓рд┐рдП рд╕рд╣реА рд░рдВрдЧ рджреЗрддрд╛ рд╣реИ, рдЕрдВрддрд┐рдо рдкрд░рд┐рдгрд╛рдо рдХреЛ рд╕рднреНрдп рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐рдпреЛрдВ рдФрд░ рдХрд▓рд╛рдХрд╛рд░реЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдПрдХ рд▓рдВрдмреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдЗрд╕реЗ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдкрд░рд┐рдгрд╛рдо рдЗрд╕ рддрд░рд╣ рдХреЗ рд╕реВрд░реНрдпрд╛рд╕реНрдд рдХреЗ рджреГрд╢реНрдп рдХреА рддрд░рд╣ рдмрд╣реБрдд рд╣реА рдЖрд╢реНрд╡рд╕реНрдд рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рд╣реЛрдЧрд╛ред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдбрд╛рдпрди 3 рд╕реНрдХрд╛рдИ рд╢реЗрдбрд░ рднреА рдХреНрд╖рд┐рддрд┐рдЬ рдХреЗ рдкрд╛рд╕ рд░рдВрдЧреЛрдВ рдХреЗ рдПрдХ рдЪрд┐рдХрдиреА рд╕рдВрдХреНрд░рдордг рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрд╣рд░реЗ рдХреА рдЧрдгрдирд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐, рдШрдирддреНрд╡ рдЧреБрдгрд╛рдВрдХ рдХрд╛ рдПрдХ рдЕрд▓рдЧ рд╕реЗрдЯ рдЖрдХрд╛рд╢ рдЫрд╛рдпрд╛рджрд╛рд░ рдХреЛ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореБрдЭреЗ рдЖрдкрдХреЛ рдпрд╛рдж рджрд┐рд▓рд╛рдирд╛ рд╣реИ - рдЗрд╕ shader рдореЗрдВ рд╕реЗ рдЕрдзрд┐рдХрд╛рдВрд╢ рдореЗрд░реЗ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдорд┐рдд / рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред </font><font style="vertical-align: inherit;">рд╕рднреА рдкрд╛рд╡рддреА рд╕реАрдбреА PROJEKT RED рдХреЛ рднреЗрдЬреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЙрдирдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ, рд╡реЗ рдПрдХ рдЙрддреНрдХреГрд╖реНрдЯ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВред</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рднрд╛рдЧ 3. рд╢реВрдЯрд┐рдВрдЧ рд╕рд┐рддрд╛рд░реЗ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"рдж рд╡рд┐рдЪрд░ 3" рдореЗрдВ рдПрдХ рдЫреЛрдЯрд╛ рд▓реЗрдХрд┐рди рдЬрд┐рдЬреНрдЮрд╛рд╕реБ рд╡рд┐рд╡рд░рдг рд╣реИ - рд╢реВрдЯрд┐рдВрдЧ рд╕рд┐рддрд╛рд░реЗред </font><font style="vertical-align: inherit;">рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ, рд╡реЗ рд░рдХреНрдд рдФрд░ рд╢рд░рд╛рдм рдбреАрдПрд▓рд╕реА рдореЗрдВ рдирд╣реАрдВ рд▓рдЧрддреЗ рд╣реИрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╡реАрдбрд┐рдпреЛ рдореЗрдВ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд╡реЗ рдХреИрд╕реЗ рджрд┐рдЦрддреЗ рд╣реИрдВ:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/IWtutrr6ilE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рд╣рдо рдЗрд╕ рдкреНрд░рднрд╛рд╡ рдХреЛ рдкрд╛рдиреЗ рдореЗрдВ рдХреИрд╕реЗ рдХрд╛рдордпрд╛рдм рд░рд╣реЗред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдПрдХ рд╢реВрдЯрд┐рдВрдЧ рд╕реНрдЯрд╛рд░ рдХрд╛ рд╢рд░реАрд░ рдкреВрдВрдЫ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдмрд╣реБрдд рдЙрдЬреНрдЬрд╡рд▓ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕рдВрдкрддреНрддрд┐ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣рдо рдмрд╛рдж рдореЗрдВ рдХрд░реЗрдВрдЧреЗред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдорд╛рд░рд╛ рдПрдЬреЗрдВрдбрд╛ рдХрд╛рдлреА рдкрд░рд┐рдЪрд┐рдд рд╣реИ: рдкрд╣рд▓реЗ рдореИрдВ рд╕рд╛рдорд╛рдиреНрдп рдЧреБрдгреЛрдВ рдХрд╛ рд╡рд░реНрдгрди рдХрд░реВрдВрдЧрд╛, рдлрд┐рд░ рдореИрдВ рдЬреНрдпрд╛рдорд┐рддрд┐ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╡рд┐рд╖рдпреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░реВрдВрдЧрд╛, рдФрд░ рдЕрдВрдд рдореЗрдВ рд╣рдо рдкрд┐рдХреНрд╕реЗрд▓ shader рдХреА рдУрд░ рдмрдврд╝реЗрдВрдЧреЗ, рдЬрд╣рд╛рдВ рд╕рдмрд╕реЗ рджрд┐рд▓рдЪрд╕реНрдк рдЪреАрдЬреЗрдВ рд╣реЛ рд░рд╣реА рд╣реИрдВред</font></font><br>
<cut></cut><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. рд╕рд╛рдорд╛рдиреНрдп рдЕрд╡рд▓реЛрдХрди</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рд╡рд░реНрдгрди рдХрд░реЗрдВ рдХрд┐ рдХреНрдпрд╛ рд╣реЛ рд░рд╣рд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдХрд╛рд╢, рдЖрдХрд╛рд╢ рдФрд░ рдЪрдВрджреНрд░рдорд╛ рдХреЗ рдЧреБрдВрдмрдж рдХреЗ рддреБрд░рдВрдд рдмрд╛рдж рд╢реВрдЯрд┐рдВрдЧ рд╕рд┐рддрд╛рд░реЛрдВ рдХреЛ рдПрдХ рд╕рдХреНрд░рд┐рдп рдорд╛рд░реНрдЧ рдореЗрдВ рдЦреАрдВрдЪрд╛ рдЬрд╛рддрд╛ рд╣реИ:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c5/a71/7db/1c5a717dbd047aeaa183ce2a25e394d9.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DrawIndexed (720) - рдЖрдХрд╛рд╢ рдХреЗ рдЧреБрдВрдмрдж, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DrawIndexed (2160) - рдЖрдХрд╛рд╢ / рдЪрдВрджреНрд░рдорд╛ рдХреЗ рд▓рд┐рдП рдХреНрд╖реЗрддреНрд░, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DrawIndexed (36) - рдЕрдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рд╣реИ, рд╕реВрд░рдЬ рдХреА рд░реЛрдбрд╝рд╛ рдХреА рдПрдХ рд╕рдорд╛рдирд╛рдВрддрд░ рдЦрд╛рдд рдХреА рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ (?) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DrawIndexed (12) - рд╢реВрдЯрд┐рдВрдЧ рд╕реНрдЯрд╛рд░ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DrawIndexedInstanced (1116, 1) - рд╕рд┐рд░рд╕ рдмрд╛рджрд▓ </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреА рддрд░рд╣ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд┐рд░рд╕ рдмрд╛рджрд▓</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , рдкреНрд░рддреНрдпреЗрдХ рд╢реВрдЯрд┐рдВрдЧ рд╕реНрдЯрд╛рд░ рд▓рдЧрд╛рддрд╛рд░ рджреЛ рдмрд╛рд░ рд▓реА рдЧрдИ рд╣реИред</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/baa/27d/e4c/baa27de4ced017770e9c89a01e136abd.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╣рд▓реЗ рдбреНрд░реЙ рдХреЙрд▓ рд╕реЗ рдкрд╣рд▓реЗ</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cc8/78b/cef/cc878bcef6dcc4b58e85f3a62f90be31.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╣рд▓реЗ рдбреНрд░реЙ рдХреЙрд▓ рдХрд╛ рдкрд░рд┐рдгрд╛рдо</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ee/33f/f6c/0ee33ff6cef3d11ca7cd460f21dc2b3f.jpg"></div><br>
<i><font style="vertical-align: inherit;"></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рдЧреЗрдо рдХреЗ рдкреНрд░реАрдореЗрдкреНрдЯрд┐рд╡ рдкрд╛рд╕ рдХреЗ рдХрдИ рддрддреНрд╡реЛрдВ рдХреЗ рдЕрд▓рд╛рд╡рд╛, </font><i><font style="vertical-align: inherit;">рджреВрд╕рд░реЗ рдбреНрд░реЙ рдХреЙрд▓ рдХрд╛ рдкрд░рд┐рдгрд╛рдо</font></i><font style="vertical-align: inherit;"> рдирд┐рдореНрди рдорд┐рдХреНрд╕рд┐рдВрдЧ рд╕реНрдЯреЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/263/aec/b8a/263aecb8afa21e2b79b0333bcde55011.jpg"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. рдЬреНрдпрд╛рдорд┐рддрд┐</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЬреНрдпрд╛рдорд┐рддрд┐ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, рдкрд╣рд▓реА рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рд╢реВрдЯрд┐рдВрдЧ рд╕реНрдЯрд╛рд░ рдХреЛ рдЯреЗрдХреНрд╕рдХреЛрд░реНрдбрд░реНрд╕ рдХреЗ рд╕рд╛рде рдПрдХ рдкрддрд▓реА рдЪрддреБрд░реНрднреБрдЬ рджреНрд╡рд╛рд░рд╛ рджрд░реНрд╢рд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ: 4 рдХреЛрдиреЗ, 6 рд╕реВрдЪрдХред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕рдмрд╕реЗ рд╕рд░рд▓ рдХреНрд╡рд╛рдб рд╕рдВрднрд╡ рд╣реИред</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/82c/fbf/96b/82cfbf96bbc652ea5ac32a5e568434a3.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рд╢реВрдЯрд┐рдВрдЧ рд╕реНрдЯрд╛рд░ рдХрд╛ рдЕрдиреБрдорд╛рдирд┐рдд рдХреНрд╡рд╛рдбред </font></font></i><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/83c/59e/3f7/83c59e3f7e685d6e7f2080e88ff5be25.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд░реАрдм рднреА </font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">рдПрдХ рд╢реВрдЯрд┐рдВрдЧ рд╕реНрдЯрд╛рд░ </font></i><i><font style="vertical-align: inherit;">рдХрд╛ рдЕрдиреБрдорд╛рдирд┐рдд рдХреНрд╡рд╛рдб рд╣реИред </font></i><i><font style="vertical-align: inherit;">рдЖрдк рджреЛ рддреНрд░рд┐рдХреЛрдгреЛрдВ рдХреЛ рджрд░реНрд╢рд╛рдиреЗ рд╡рд╛рд▓реА рд░реЗрдЦрд╛ рдХреЗ рд╡рд╛рдпрд░рдлреНрд░реЗрдо рдкреНрд░рджрд░реНрд╢рди рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред </font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд┐рдирдЯ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд░реБрдХреЛ, рд▓реЗрдХрд┐рди рд╡рд╣рд╛рдБ рд╣реИ </font><i><font style="vertical-align: inherit;">DrawIndexed (12)</font></i><font style="vertical-align: inherit;"> ! </font><font style="vertical-align: inherit;">рдХреНрдпрд╛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ рд╣рдо рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рджреЛ рд╢реВрдЯрд┐рдВрдЧ рд╕рд┐рддрд╛рд░реЛрдВ рдХреЛ рдЖрдХрд░реНрд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВ? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рд╛рдБред</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d55/b39/bb2/d55b39bb2d2ea5908f4576d6396455fa.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рдлреНрд░реЗрдо рдореЗрдВ, рд╢реВрдЯрд┐рдВрдЧ рд╕рд┐рддрд╛рд░реЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рджреГрд╢реНрдпрддрд╛ рдХреЗ рдкрд┐рд░рд╛рдорд┐рдб рдХреЗ рдмрд╛рд╣рд░ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХреЛрдбрд░ рдХреЗ рдХреЛрдб рдХреЗ рд▓рд┐рдП рд╢реАрд░реНрд╖ shader:</font></font><br>
<br>
<pre><code class="cpp hljs"> vs_5_0  <font></font>
    dcl_globalFlags refactoringAllowed  <font></font>
    dcl_constantbuffer cb1[<span class="hljs-number">9</span>], immediateIndexed  <font></font>
    dcl_constantbuffer cb2[<span class="hljs-number">3</span>], immediateIndexed  <font></font>
    dcl_constantbuffer cb12[<span class="hljs-number">193</span>], immediateIndexed  <font></font>
    dcl_input v0.xyz  <font></font>
    dcl_input v1.xyzw  <font></font>
    dcl_input v2.xy  <font></font>
    dcl_input v3.xy  <font></font>
    dcl_input v4.xy  <font></font>
    dcl_input v5.xyz  <font></font>
    dcl_input v6.x  <font></font>
    dcl_input v7.x  <font></font>
    dcl_output o0.xyzw  <font></font>
    dcl_output o1.xyzw  <font></font>
    dcl_output o2.xy  <font></font>
    dcl_output o3.xyzw  <font></font>
    dcl_output_siv o4.xyzw, position  <font></font>
    dcl_temps <span class="hljs-number">5</span>  
   <span class="hljs-number">0</span>: mov r0.xyz, v0.xyzx  
   <span class="hljs-number">1</span>: mov r0.w, l(<span class="hljs-number">1.000000</span>)  
   <span class="hljs-number">2</span>: dp4 r1.x, r0.xyzw, cb2[<span class="hljs-number">0</span>].xyzw  
   <span class="hljs-number">3</span>: dp4 r1.y, r0.xyzw, cb2[<span class="hljs-number">1</span>].xyzw  
   <span class="hljs-number">4</span>: dp4 r1.z, r0.xyzw, cb2[<span class="hljs-number">2</span>].xyzw  
   <span class="hljs-number">5</span>: add r0.x, v2.x, v2.y  
   <span class="hljs-number">6</span>: add r0.y, -v2.y, v2.x  
   <span class="hljs-number">7</span>: add r2.xyz, -r1.zxyz, cb1[<span class="hljs-number">8</span>].zxyz  
   <span class="hljs-number">8</span>: dp3 r0.z, r2.xyzx, r2.xyzx  
   <span class="hljs-number">9</span>: rsq r0.z, r0.z  
  <span class="hljs-number">10</span>: mul r2.xyz, r0.zzzz, r2.xyzx  
  <span class="hljs-number">11</span>: dp3 r0.z, v5.xyzx, v5.xyzx  
  <span class="hljs-number">12</span>: rsq r0.z, r0.z  
  <span class="hljs-number">13</span>: mul r3.xyz, r0.zzzz, v5.xyzx  
  <span class="hljs-number">14</span>: mul r4.xyz, r2.xyzx, r3.yzxy  
  <span class="hljs-number">15</span>: mad r2.xyz, r2.zxyz, r3.zxyz, -r4.xyzx  
  <span class="hljs-number">16</span>: dp3 r0.z, r2.xyzx, r2.xyzx  
  <span class="hljs-number">17</span>: rsq r0.z, r0.z  
  <span class="hljs-number">18</span>: mul r2.xyz, r0.zzzz, r2.xyzx  
  <span class="hljs-number">19</span>: mad r0.z, v7.x, v6.x, l(<span class="hljs-number">1.000000</span>)  
  <span class="hljs-number">20</span>: mul r3.xyz, r0.zzzz, r3.xyzx  
  <span class="hljs-number">21</span>: mul r3.xyz, r3.xyzx, v3.xxxx  
  <span class="hljs-number">22</span>: mul r2.xyz, r2.xyzx, v3.yyyy  
  <span class="hljs-number">23</span>: mad r0.xzw, r3.xxyz, r0.xxxx, r1.xxyz  
  <span class="hljs-number">24</span>: mad r0.xyz, r2.xyzx, r0.yyyy, r0.xzwx  
  <span class="hljs-number">25</span>: mov r0.w, l(<span class="hljs-number">1.000000</span>)  
  <span class="hljs-number">26</span>: dp4 o4.x, r0.xyzw, cb1[<span class="hljs-number">0</span>].xyzw  
  <span class="hljs-number">27</span>: dp4 o4.y, r0.xyzw, cb1[<span class="hljs-number">1</span>].xyzw  
  <span class="hljs-number">28</span>: dp4 o4.z, r0.xyzw, cb1[<span class="hljs-number">2</span>].xyzw  
  <span class="hljs-number">29</span>: dp4 o4.w, r0.xyzw, cb1[<span class="hljs-number">3</span>].xyzw  
  <span class="hljs-number">30</span>: add r0.xyz, r0.xyzx, -cb12[<span class="hljs-number">0</span>].xyzx  
  <span class="hljs-number">31</span>: dp3 r0.w, r0.xyzx, r0.xyzx  
  <span class="hljs-number">32</span>: <span class="hljs-built_in">sqrt</span> r0.w, r0.w  
  <span class="hljs-number">33</span>: div r0.xyz, r0.xyzx, r0.wwww  
  <span class="hljs-number">34</span>: add r0.w, r0.w, -cb12[<span class="hljs-number">22</span>].z  
  <span class="hljs-number">35</span>: max r0.w, r0.w, l(<span class="hljs-number">0</span>)  
  <span class="hljs-number">36</span>: min r0.w, r0.w, cb12[<span class="hljs-number">42</span>].z  
  <span class="hljs-number">37</span>: dp3 r0.x, cb12[<span class="hljs-number">38</span>].xyzx, r0.xyzx  
  <span class="hljs-number">38</span>: mul r0.y, <span class="hljs-built_in">abs</span>(r0.x), <span class="hljs-built_in">abs</span>(r0.x)  
  <span class="hljs-number">39</span>: mad_sat r1.x, r0.w, l(<span class="hljs-number">0.002000</span>), l(<span class="hljs-number">-0.300000</span>)  
  <span class="hljs-number">40</span>: mul r0.y, r0.y, r1.x  
  <span class="hljs-number">41</span>: lt r1.x, l(<span class="hljs-number">0</span>), r0.x  
  <span class="hljs-number">42</span>: movc r1.yzw, r1.xxxx, cb12[<span class="hljs-number">39</span>].xxyz, cb12[<span class="hljs-number">41</span>].xxyz  
  <span class="hljs-number">43</span>: add r1.yzw, r1.yyzw, -cb12[<span class="hljs-number">40</span>].xxyz  
  <span class="hljs-number">44</span>: mad r1.yzw, r0.yyyy, r1.yyzw, cb12[<span class="hljs-number">40</span>].xxyz  
  <span class="hljs-number">45</span>: movc r2.xyz, r1.xxxx, cb12[<span class="hljs-number">45</span>].xyzx, cb12[<span class="hljs-number">47</span>].xyzx  
  <span class="hljs-number">46</span>: add r2.xyz, r2.xyzx, -cb12[<span class="hljs-number">46</span>].xyzx  
  <span class="hljs-number">47</span>: mad o0.xyz, r0.yyyy, r2.xyzx, cb12[<span class="hljs-number">46</span>].xyzx  
  <span class="hljs-number">48</span>: ge r0.y, r0.w, cb12[<span class="hljs-number">48</span>].y  
  <span class="hljs-number">49</span>: if_nz r0.y  
  <span class="hljs-number">50</span>:  mad r0.y, r0.z, cb12[<span class="hljs-number">22</span>].z, cb12[<span class="hljs-number">0</span>].z  
  <span class="hljs-number">51</span>:  mul r0.z, r0.w, r0.z  
  <span class="hljs-number">52</span>:  mul r0.z, r0.z, l(<span class="hljs-number">0.062500</span>)  
  <span class="hljs-number">53</span>:  mul r1.x, r0.w, cb12[<span class="hljs-number">43</span>].x  
  <span class="hljs-number">54</span>:  mul r1.x, r1.x, l(<span class="hljs-number">0.062500</span>)  
  <span class="hljs-number">55</span>:  add r0.x, r0.x, cb12[<span class="hljs-number">42</span>].x  
  <span class="hljs-number">56</span>:  add r2.x, cb12[<span class="hljs-number">42</span>].x, l(<span class="hljs-number">1.000000</span>)  
  <span class="hljs-number">57</span>:  div_sat r0.x, r0.x, r2.x  
  <span class="hljs-number">58</span>:  add r2.x, -cb12[<span class="hljs-number">43</span>].z, cb12[<span class="hljs-number">43</span>].y  
  <span class="hljs-number">59</span>:  mad r0.x, r0.x, r2.x, cb12[<span class="hljs-number">43</span>].z  
  <span class="hljs-number">60</span>:  add r0.y, r0.y, cb12[<span class="hljs-number">42</span>].y  
  <span class="hljs-number">61</span>:  mul r2.x, r0.x, r0.y  
  <span class="hljs-number">62</span>:  mul r0.z, r0.x, r0.z  
  <span class="hljs-number">63</span>:  mad r3.xyzw, r0.zzzz, l(<span class="hljs-number">16.000000</span>, <span class="hljs-number">15.000000</span>, <span class="hljs-number">14.000000</span>, <span class="hljs-number">13.000000</span>), r2.xxxx  
  <span class="hljs-number">64</span>:  max r3.xyzw, r3.xyzw, l(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)  
  <span class="hljs-number">65</span>:  add r3.xyzw, r3.xyzw, l(<span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>)  
  <span class="hljs-number">66</span>:  div_sat r3.xyzw, r1.xxxx, r3.xyzw  
  <span class="hljs-number">67</span>:  add r3.xyzw, -r3.xyzw, l(<span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>)  
  <span class="hljs-number">68</span>:  mul r2.y, r3.y, r3.x  
  <span class="hljs-number">69</span>:  mul r2.y, r3.z, r2.y  
  <span class="hljs-number">70</span>:  mul r2.y, r3.w, r2.y  
  <span class="hljs-number">71</span>:  mad r3.xyzw, r0.zzzz, l(<span class="hljs-number">12.000000</span>, <span class="hljs-number">11.000000</span>, <span class="hljs-number">10.000000</span>, <span class="hljs-number">9.000000</span>), r2.xxxx  
  <span class="hljs-number">72</span>:  max r3.xyzw, r3.xyzw, l(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)  
  <span class="hljs-number">73</span>:  add r3.xyzw, r3.xyzw, l(<span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>)  
  <span class="hljs-number">74</span>:  div_sat r3.xyzw, r1.xxxx, r3.xyzw  
  <span class="hljs-number">75</span>:  add r3.xyzw, -r3.xyzw, l(<span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>)  
  <span class="hljs-number">76</span>:  mul r2.y, r2.y, r3.x  
  <span class="hljs-number">77</span>:  mul r2.y, r3.y, r2.y  
  <span class="hljs-number">78</span>:  mul r2.y, r3.z, r2.y  
  <span class="hljs-number">79</span>:  mul r2.y, r3.w, r2.y  
  <span class="hljs-number">80</span>:  mad r3.xyzw, r0.zzzz, l(<span class="hljs-number">8.000000</span>, <span class="hljs-number">7.000000</span>, <span class="hljs-number">6.000000</span>, <span class="hljs-number">5.000000</span>), r2.xxxx  
  <span class="hljs-number">81</span>:  max r3.xyzw, r3.xyzw, l(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)  
  <span class="hljs-number">82</span>:  add r3.xyzw, r3.xyzw, l(<span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>)  
  <span class="hljs-number">83</span>:  div_sat r3.xyzw, r1.xxxx, r3.xyzw  
  <span class="hljs-number">84</span>:  add r3.xyzw, -r3.xyzw, l(<span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>)  
  <span class="hljs-number">85</span>:  mul r2.y, r2.y, r3.x  
  <span class="hljs-number">86</span>:  mul r2.y, r3.y, r2.y  
  <span class="hljs-number">87</span>:  mul r2.y, r3.z, r2.y  
  <span class="hljs-number">88</span>:  mul r2.y, r3.w, r2.y  
  <span class="hljs-number">89</span>:  mad r2.zw, r0.zzzz, l(<span class="hljs-number">0.000000</span>, <span class="hljs-number">0.000000</span>, <span class="hljs-number">4.000000</span>, <span class="hljs-number">3.000000</span>), r2.xxxx  
  <span class="hljs-number">90</span>:  max r2.zw, r2.zzzw, l(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)  
  <span class="hljs-number">91</span>:  add r2.zw, r2.zzzw, l(<span class="hljs-number">0.000000</span>, <span class="hljs-number">0.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>)  
  <span class="hljs-number">92</span>:  div_sat r2.zw, r1.xxxx, r2.zzzw  
  <span class="hljs-number">93</span>:  add r2.zw, -r2.zzzw, l(<span class="hljs-number">0.000000</span>, <span class="hljs-number">0.000000</span>, <span class="hljs-number">1.000000</span>, <span class="hljs-number">1.000000</span>)  
  <span class="hljs-number">94</span>:  mul r2.y, r2.z, r2.y  
  <span class="hljs-number">95</span>:  mul r2.y, r2.w, r2.y  
  <span class="hljs-number">96</span>:  mad r2.x, r0.z, l(<span class="hljs-number">2.000000</span>), r2.x  
  <span class="hljs-number">97</span>:  max r2.x, r2.x, l(<span class="hljs-number">0</span>)  
  <span class="hljs-number">98</span>:  add r2.x, r2.x, l(<span class="hljs-number">1.000000</span>)  
  <span class="hljs-number">99</span>:  div_sat r2.x, r1.x, r2.x  
  <span class="hljs-number">100</span>:  add r2.x, -r2.x, l(<span class="hljs-number">1.000000</span>)  
  <span class="hljs-number">101</span>:  mul r2.x, r2.x, r2.y  
  <span class="hljs-number">102</span>:  mad r0.x, r0.y, r0.x, r0.z  
  <span class="hljs-number">103</span>:  max r0.x, r0.x, l(<span class="hljs-number">0</span>)  
  <span class="hljs-number">104</span>:  add r0.x, r0.x, l(<span class="hljs-number">1.000000</span>)  
  <span class="hljs-number">105</span>:  div_sat r0.x, r1.x, r0.x  
  <span class="hljs-number">106</span>:  add r0.x, -r0.x, l(<span class="hljs-number">1.000000</span>)  
  <span class="hljs-number">107</span>:  mad r0.x, -r2.x, r0.x, l(<span class="hljs-number">1.000000</span>)  
  <span class="hljs-number">108</span>:  add r0.y, r0.w, -cb12[<span class="hljs-number">48</span>].y  
  <span class="hljs-number">109</span>:  mul_sat r0.y, r0.y, cb12[<span class="hljs-number">48</span>].z  
  <span class="hljs-number">110</span>: <span class="hljs-keyword">else</span>  
  <span class="hljs-number">111</span>:  mov r0.xy, l(<span class="hljs-number">1.000000</span>, <span class="hljs-number">0.000000</span>, <span class="hljs-number">0.000000</span>, <span class="hljs-number">0.000000</span>)  
  <span class="hljs-number">112</span>: endif  
  <span class="hljs-number">113</span>: <span class="hljs-built_in">log</span> r0.x, r0.x  
  <span class="hljs-number">114</span>: mul r0.z, r0.x, cb12[<span class="hljs-number">42</span>].w  
  <span class="hljs-number">115</span>: <span class="hljs-built_in">exp</span> r0.z, r0.z  
  <span class="hljs-number">116</span>: mul r0.z, r0.z, r0.y  
  <span class="hljs-number">117</span>: mul r0.x, r0.x, cb12[<span class="hljs-number">48</span>].x  
  <span class="hljs-number">118</span>: <span class="hljs-built_in">exp</span> r0.x, r0.x  
  <span class="hljs-number">119</span>: mul o0.w, r0.x, r0.y  
  <span class="hljs-number">120</span>: mad_sat r0.xy, r0.zzzz, cb12[<span class="hljs-number">189</span>].xzxx, cb12[<span class="hljs-number">189</span>].ywyy  
  <span class="hljs-number">121</span>: add r2.xyz, -r1.yzwy, cb12[<span class="hljs-number">188</span>].xyzx  
  <span class="hljs-number">122</span>: mad r2.xyz, r0.xxxx, r2.xyzx, r1.yzwy  
  <span class="hljs-number">123</span>: add r0.x, cb12[<span class="hljs-number">188</span>].w, l(<span class="hljs-number">-1.000000</span>)  
  <span class="hljs-number">124</span>: mad r0.x, r0.y, r0.x, l(<span class="hljs-number">1.000000</span>)  
  <span class="hljs-number">125</span>: mul_sat r2.w, r0.x, r0.z  
  <span class="hljs-number">126</span>: lt r0.x, l(<span class="hljs-number">0</span>), cb12[<span class="hljs-number">192</span>].x  
  <span class="hljs-number">127</span>: if_nz r0.x  
  <span class="hljs-number">128</span>:  mad_sat r0.xy, r0.zzzz, cb12[<span class="hljs-number">191</span>].xzxx, cb12[<span class="hljs-number">191</span>].ywyy  
  <span class="hljs-number">129</span>:  add r3.xyz, -r1.yzwy, cb12[<span class="hljs-number">190</span>].xyzx  
  <span class="hljs-number">130</span>:  mad r1.xyz, r0.xxxx, r3.xyzx, r1.yzwy  
  <span class="hljs-number">131</span>:  add r0.x, cb12[<span class="hljs-number">190</span>].w, l(<span class="hljs-number">-1.000000</span>)  
  <span class="hljs-number">132</span>:  mad r0.x, r0.y, r0.x, l(<span class="hljs-number">1.000000</span>)  
  <span class="hljs-number">133</span>:  mul_sat r1.w, r0.x, r0.z  
  <span class="hljs-number">134</span>:  add r0.xyzw, -r2.xyzw, r1.xyzw  
  <span class="hljs-number">135</span>:  mad o1.xyzw, cb12[<span class="hljs-number">192</span>].xxxx, r0.xyzw, r2.xyzw  
  <span class="hljs-number">136</span>: <span class="hljs-keyword">else</span>  
  <span class="hljs-number">137</span>:  mov o1.xyzw, r2.xyzw  
  <span class="hljs-number">138</span>: endif  
  <span class="hljs-number">139</span>: mov o3.xyzw, v1.xyzw  
  <span class="hljs-number">140</span>: mov o2.xy, v4.yxyy  
  <span class="hljs-number">141</span>: ret</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣рд╛рдВ, рдХреЛрд╣рд░реЗ рдХреА рдЧрдгрдирд╛ рддреБрд░рдВрдд рдзреНрдпрд╛рди рдЖрдХрд░реНрд╖рд┐рдд рдХрд░ рд╕рдХрддреА рд╣реИ (рд▓рд╛рдЗрдиреЗрдВ 30-138)ред рдХреЛрд╣рд░реЗ рдХреЗ рд╢реАрд░реНрд╖ рдХреА рдЧрдгрдирд╛ рдкреНрд░рджрд░реНрд╢рди рдХрд╛рд░рдгреЛрдВ рд╕реЗ рд╕рдордЭ рдореЗрдВ рдЖрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдореЗрдВ рдХреЛрд╣рд░реЗ рдХреА рдЗрддрдиреА рд╕рдЯреАрдХрддрд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ - рдЙрд▓реНрдХрд╛рдкрд┐рдВрдб рдЖрдорддреМрд░ рдкрд░ рдЧреЗрд░рд╛рд▓реНрдЯ рдХреЗ рд╕рд┐рд░ рдкрд░ рдЙрдбрд╝рддреЗ рд╣реИрдВ рдФрд░ рдХреНрд╖рд┐рддрд┐рдЬ рддрдХ рдирд╣реАрдВ рдкрд╣реБрдВрдЪрддреЗ рд╣реИрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╡рд╛рдпреБрдордВрдбрд▓реАрдп рдорд╛рдкрджрдВрдбреЛрдВ (рдЖрд░рдЬреАрдмреА = рд░рдВрдЧ, рдПрдХ = рдкреНрд░рднрд╛рд╡) рдХреЛ o0.xyzw рдореЗрдВ рдФрд░ рдХреЛрд╣рд░реЗ рдХреЗ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ o1.xyzw рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
o2.xy (рд▓рд╛рдЗрди 140) рд╕рд┐рд░реНрдл рдЯреЗрдХреНрд╕рдХреЛрд░реНрдбреНрд╕ рд╣реИред </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
o3.xyzw (рд▓рд╛рдЗрди 139) рдЕрдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдм рдЖрдЗрдП рджреБрдирд┐рдпрд╛ рдореЗрдВ рдХрд┐рд╕реА рдкрдж рдХреА рдЧрдгрдирд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рд╢рдмреНрдж рдХрд╣реЗрдВред рд╡рд░реНрдЯреЗрдХреНрд╕ рд╢реЗрдбреНрд╕ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд┐рд▓рдмреЛрд░реНрдбрд┐рдВрдЧ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд░рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдмрд┐рд▓рдмреЛрд░реНрдб рдХреЗ рд▓рд┐рдП рдЖрдиреЗ рд╡рд╛рд▓реЗ рдбреЗрдЯрд╛ рд╡рд░реНрдЯреЗрдХреНрд╕ рдмрдлрд░ рд╕реЗ рдЖрддреЗ рд╣реИрдВ - рдЪрд▓реЛ рдЙрди рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд╣рд▓рд╛ рдбреЗрдЯрд╛ рд╕реНрдерд┐рддрд┐ рд╣реИ:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/99a/470/7d5/99a4707d5f914222e7d55e2435f5692f.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЬреИрд╕рд╛ рдХрд┐ рдКрдкрд░ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдпрд╣рд╛рдВ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ 2 рдХреНрд╡рд╛рдб-рдП: 8 рдХреЛрдиреЗ, 12 рд╕реВрдЪрдХ рд╣реИрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд▓реЗрдХрд┐рди рд╣рд░ рдХреНрд╡рд╛рдб рдХреЗ рд▓рд┐рдП рдкреЛрдЬрд┐рд╢рди рд╕рдорд╛рди рдХреНрдпреЛрдВ рд╣реИ? </font><font style="vertical-align: inherit;">рдХрд╛рдлреА рд╕рд░рд▓ - рдпрд╣ рдХреНрд╡рд╛рдб рдХреЗ рдХреЗрдВрджреНрд░ рдХреА рд╕реНрдерд┐рддрд┐ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдкреНрд░рддреНрдпреЗрдХ рд╢реАрд░реНрд╖ рдХреЗрдВрджреНрд░ рд╕реЗ рдХреЗрдВрджреНрд░ рдХреЗ рдХрд┐рдирд╛рд░реЗ рддрдХ рдПрдХ рдСрдлрд╕реЗрдЯ рд╣реИ:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cde/fdf/7e0/cdefdf7e0e5cfe91c4b9d20257b529b4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╣рд░ рд╢реВрдЯрд┐рдВрдЧ рд╕реНрдЯрд╛рд░ рдХреЗ рдкрд╛рд╕ рд╡рд┐рд╢реНрд╡ рдЕрдВрддрд░рд┐рдХреНрд╖ рдореЗрдВ (400, 3) рдЗрдХрд╛рдЗрдпреЛрдВ рдХрд╛ рдЖрдХрд╛рд░ рд╣реИред </font><font style="vertical-align: inherit;">(XY рдкреНрд▓реЗрди рдореЗрдВ, Witcher 3 рдореЗрдВ, Z рдЕрдХреНрд╖ рдХреЛ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдВрддрд┐рдо рддрддреНрд╡ рдЬреЛ рдкреНрд░рддреНрдпреЗрдХ рд╢реАрд░реНрд╖ рдкрд░ рд╣реИ, рд╡рд┐рд╢реНрд╡ рдЕрдВрддрд░рд┐рдХреНрд╖ рдореЗрдВ рдПрдХ рдпреВрдирд┐рдЯ рджрд┐рд╢рд╛ рд╡реЗрдХреНрдЯрд░ рд╣реИ рдЬреЛ рдПрдХ рд╢реВрдЯрд┐рдВрдЧ рд╕реНрдЯрд╛рд░ рдХреА рдЧрддрд┐ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/416/06d/71a/41606d71a99d2f751f8b1d5a609b6c96.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЪреВрдВрдХрд┐ рдбреЗрдЯрд╛ рд╕реАрдкреАрдпреВ рд╕реЗ рдЖрддрд╛ рд╣реИ, рдпрд╣ рд╕рдордЭрдирд╛ рдореБрд╢реНрдХрд┐рд▓ рд╣реИ рдХрд┐ рдЗрд╕рдХреА рдЧрдгрдирд╛ рдХреИрд╕реЗ рдХреА рдЬрд╛рддреА рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдм рд╣рдо рдмрд┐рд▓рдмреЛрд░реНрдбрд┐рдВрдЧ рдХреЛрдб рдкрд░ рдЪрд▓рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рд╡рд┐рдЪрд╛рд░ рдХрд╛рдлреА рд╕рд░рд▓ рд╣реИ - рдкрд╣рд▓реЗ рдЖрдкрдХреЛ рдХреНрд╡рд╛рдб рдХреЗ рдХреЗрдВрджреНрд░ рд╕реЗ рдХреИрдорд░реЗ рддрдХ рдПрдХ рдпреВрдирд┐рдЯ рд╡реЗрдХреНрдЯрд░ рдорд┐рд▓рддрд╛ рд╣реИ:</font></font><br>
<br>
<pre><code class="cpp hljs">   <span class="hljs-number">7</span>: add r2.xyz, -r1.zxyz, cb1[<span class="hljs-number">8</span>].zxyz  
   <span class="hljs-number">8</span>: dp3 r0.z, r2.xyzx, r2.xyzx  
   <span class="hljs-number">9</span>: rsq r0.z, r0.z  
  <span class="hljs-number">10</span>: mul r2.xyz, r0.zzzz, r2.xyzx</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рддрдм рд╣рдореЗрдВ рдПрдХ рдПрдХрд▓ рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ рд╡реЗрдХреНрдЯрд░ рдорд┐рд▓рддрд╛ рд╣реИ рдЬреЛ рд╢реВрдЯрд┐рдВрдЧ рд╕реНрдЯрд╛рд░ рдХреА рдЧрддрд┐ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рджреЗрдЦрддреЗ рд╣реБрдП рдХрд┐ рдпрд╣ рд╡реЗрдХреНрдЯрд░ рд╕реАрдкреАрдпреВ рдХреА рддрд░рдл рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рд╣реИ, рдпрд╣ рд╕рд╛рдорд╛рдиреНрдпреАрдХрд░рдг рдирд┐рд░рд░реНрдердХ рд╣реИред</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-number">11</span>: dp3 r0.z, v5.xyzx, v5.xyzx  
  <span class="hljs-number">12</span>: rsq r0.z, r0.z  
  <span class="hljs-number">13</span>: mul r3.xyz, r0.zzzz, v5.xyzx</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрджрд┐ рджреЛ рд╡реИрдХреНрдЯрд░ рд╣реИрдВ, рддреЛ рдЖрдиреЗ рд╡рд╛рд▓реЗ рд╡реИрдХреНрдЯрд░реЛрдВ рдХреЗ рд▓рд┐рдП рджреНрд╡рд┐-рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ рд╡реЗрдХреНрдЯрд░ рд▓рдВрдм рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡реЗрдХреНрдЯрд░ рдЙрддреНрдкрд╛рдж рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-number">14</span>: mul r4.xyz, r2.xyzx, r3.yzxy  
  <span class="hljs-number">15</span>: mad r2.xyz, r2.zxyz, r3.zxyz, -r4.xyzx  
  <span class="hljs-number">16</span>: dp3 r0.z, r2.xyzx, r2.xyzx  
  <span class="hljs-number">17</span>: rsq r0.z, r0.z  
  <span class="hljs-number">18</span>: mul r2.xyz, r0.zzzz, r2.xyzx</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рд╡реИрдХреНрдЯрд░ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (r3.xyz) рдФрд░ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд┐рдЯреЗрдВрдЧреЗрдВрдЯ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (r2.xyz) рд╣реИрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдЗрдП </font><font style="vertical-align: inherit;">рдЖрдиреЗ рд╡рд╛рд▓реЗ рддрддреНрд╡ </font><i><font style="vertical-align: inherit;">TEXCOORD1 рдХреЗ</font></i><font style="vertical-align: inherit;"> рдЕрдиреБрд░реВрдк </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Xsize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ysize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреЗрд╢ рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">, рдЗрд╕рд▓рд┐рдП рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП (-200, 1.50)ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╡рд┐рд╢реНрд╡ рдЕрдВрддрд░рд┐рдХреНрд╖ рдореЗрдВ рд╕реНрдерд┐рддрд┐ рдХреА рдЕрдВрддрд┐рдо рдЧрдгрдирд╛ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рдХреА рдЬрд╛рддреА рд╣реИ:</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-number">19</span>: mad r0.z, v7.x, v6.x, l(<span class="hljs-number">1.000000</span>)  
  <span class="hljs-number">20</span>: mul r3.xyz, r0.zzzz, r3.xyzx  
  <span class="hljs-number">21</span>: mul r3.xyz, r3.xyzx, v3.xxxx  
  <span class="hljs-number">22</span>: mul r2.xyz, r2.xyzx, v3.yyyy  
  <span class="hljs-number">23</span>: mad r0.xzw, r3.xxyz, r0.xxxx, r1.xxyz  
  <span class="hljs-number">24</span>: mad r0.xyz, r2.xyzx, r0.yyyy, r0.xzwx  
  <span class="hljs-number">25</span>: mov r0.w, l(<span class="hljs-number">1.000000</span>) </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рджреЗрдЦрддреЗ рд╣реБрдП рдХрд┐ r0.x, r0.y рдФрд░ r0.z 1.0 рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИрдВ, рдЕрдВрддрд┐рдо рдЧрдгрдирд╛ рд╕рд░рд▓ рд╣реИ: </font></font><br>
<br>
<code>worldSpacePosition = quadCenter + tangent * Xsize + bitangent * Ysize</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдВрддрд┐рдо рднрд╛рдЧ SV_Position рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рджреГрд╢реНрдп-рдкреНрд░рдХреНрд╖реЗрдкрдг рдореИрдЯреНрд░рд┐рдХреНрд╕ рджреНрд╡рд╛рд░рд╛ рд╡рд┐рд╢реНрд╡ рдЕрдВрддрд░рд┐рдХреНрд╖ рдореЗрдВ рдПрдХ рд╕реНрдерд┐рддрд┐ рдХрд╛ рдПрдХ рд╕рд░рд▓ рдЧреБрдгрди рд╣реИ:</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-number">26</span>: dp4 o4.x, r0.xyzw, cb1[<span class="hljs-number">0</span>].xyzw  
  <span class="hljs-number">27</span>: dp4 o4.y, r0.xyzw, cb1[<span class="hljs-number">1</span>].xyzw  
  <span class="hljs-number">28</span>: dp4 o4.z, r0.xyzw, cb1[<span class="hljs-number">2</span>].xyzw  
  <span class="hljs-number">29</span>: dp4 o4.w, r0.xyzw, cb1[<span class="hljs-number">3</span>].xyzw  </code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. рдкрд┐рдХреНрд╕реЗрд▓ рд╢реЗрдбрд░</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЬреИрд╕рд╛ рдХрд┐ рд╕рд╛рдорд╛рдиреНрдп рдЕрд╡рд▓реЛрдХрди рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рдХрд╣рд╛ рдЧрдпрд╛ рд╣реИ, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рдореНрдорд┐рд╢реНрд░рдг рдЕрд╡рд╕реНрдерд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: </font><font style="vertical-align: inherit;">
рдЬрд╣рд╛рдБ </font><i><font style="vertical-align: inherit;">SrcColor</font></i><font style="vertical-align: inherit;"> рдФрд░ </font><i><font style="vertical-align: inherit;">SrcAlpha </font></i><i><font style="vertical-align: inherit;">рдХреНрд░рдорд╢рдГ</font></i><font style="vertical-align: inherit;"> рдкрд┐рдХреНрд╕реЗрд▓ shader рд╕реЗ .rgb рдФрд░ .a рдШрдЯрдХ рд╣реЛрддреЗ </font><i><font style="vertical-align: inherit;">рд╣реИрдВ</font></i><font style="vertical-align: inherit;"> , рдФрд░ </font><i><font style="vertical-align: inherit;">DestColor .rgb</font></i><font style="vertical-align: inherit;"> рд░рдВрдЧ рд╡рд░реНрддрдорд╛рди рдореЗрдВ рд░реЗрдВрдбрд░рд░реНрдЯ рдореЗрдВ рд╣реИред </font><font style="vertical-align: inherit;">
рдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдореБрдЦреНрдп рд╕рдВрдХреЗрддрдХ </font><i><font style="vertical-align: inherit;">SrcAlpha рд╣реИ</font></i><font style="vertical-align: inherit;"> ред рдХрдИ рдкреНрд░реЛрдПрдХреНрдЯрд┐рд╡ рдЧреЗрдо рд╢реЗрдбрд░реНрд╕ рдЗрд╕реЗ рдЕрдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд░рд┐рдХрд▓рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЕрдВрдд рдореЗрдВ рдЗрд╕реЗ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ: </font><font style="vertical-align: inherit;">
рдЧрд┐рд░рдиреЗ рд╡рд╛рд▓реЗ рд╕реНрдЯрд╛рд░ рд╢реЗрдбрд░ рдХреЛрдИ рдЕрдкрд╡рд╛рдж рдирд╣реАрдВ рдереЗред рдЗрд╕ рдкреИрдЯрд░реНрди рдХреЗ рдмрд╛рдж, рд╣рдо рддреАрди рдорд╛рдорд▓реЛрдВ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ </font><i><font style="vertical-align: inherit;">рдЕрдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛</font></i><font style="vertical-align: inherit;"> 1.0, 0.1 рдФрд░ 0.0 рд╣реИред</font></font><br>
<br>
<code>FinalColor = SrcColor * One + DestColor * (1.0 - SrcAlpha) =<br>
FinalColor = SrcColor + DestColor * (1.0 - SrcAlpha)</code><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<code>return float4( color * opacity, opacity )</code><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<code>a) opacity = 1.0<br>
<br>
FinalColor = color * opacity + DestColor * (1.0 - opacity) =<br>
FinalColor = color = SrcColor</code><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/934/711/31c/93471131c99ec7b2249cff6edb698859.jpg"></div><br>
<code>b) opacity = 0.1<br>
<br>
FinalColor = color * opacity + DestColor * (1.0 - opacity) =<br>
FinalColor = 0.1 * color + 0.9 * DestColor</code><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/269/b24/d90/269b24d90592abb5065fba0f2a0aaf9f.jpg"></div><br>
<code>c) opacity = 0.0<br>
<br>
FinalColor = color * opacity + DestColor * (1.0 - opacity) =<br>
FinalColor = DestColor</code><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/191/75e/b6e/19175eb6e6757c04a0a063e75bad96f2.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рд╢реЗрдбрд░ рдХрд╛ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рд╡рд┐рдЪрд╛рд░ рдУрдкреЗрд╕рд┐рдЯреА рдлрдВрдХреНрд╢рди </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛ (x)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд╛ рдореЙрдбрд▓ рдФрд░ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИ </font><font style="vertical-align: inherit;">, рдЬреЛ рдПрдХ рд╢реВрдЯрд┐рдВрдЧ рд╕реНрдЯрд╛рд░ рдХреЗ рд╕рд╛рде рдкрд┐рдХреНрд╕реЗрд▓ рдХреА рдЕрдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред рдореБрдЦреНрдп рдЖрд╡рд╢реНрдпрдХрддрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдЕрдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛ рд╕реНрдЯрд╛рд░ (рдЗрд╕рдХреЗ "рд╢рд░реАрд░") рдХреЗ рдЕрдВрдд рдореЗрдВ рдЕрдзрд┐рдХрддрдо рдореВрд▓реНрдпреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдЬрд╛рдП рдФрд░ 0.0 рд╕реЗ рд╕реБрдЪрд╛рд░реВ рд░реВрдк рд╕реЗ рдлреАрдХрд╛ рд╣реЛ рдЬрд╛рдП (рдЗрд╕рдХреА "рдкреВрдВрдЫ")ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЬрдм рд╣рдо рдкрд┐рдХреНрд╕реЗрд▓ shader рдХреЗ рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛ рд╕рдордЭрдиреЗ рд▓рдЧрддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ:</font></font><br>
<br>
<pre><code class="cpp hljs"> ps_5_0  <font></font>
    dcl_globalFlags refactoringAllowed  <font></font>
    dcl_constantbuffer cb0[<span class="hljs-number">10</span>], immediateIndexed  <font></font>
    dcl_constantbuffer cb2[<span class="hljs-number">3</span>], immediateIndexed  <font></font>
    dcl_constantbuffer cb4[<span class="hljs-number">2</span>], immediateIndexed  <font></font>
    dcl_input_ps linear v0.xyzw  <font></font>
    dcl_input_ps linear v1.xyzw  <font></font>
    dcl_input_ps linear v2.y  <font></font>
    dcl_input_ps linear v3.w  <font></font>
    dcl_output o0.xyzw  <font></font>
    dcl_temps <span class="hljs-number">4</span>  
   <span class="hljs-number">0</span>: mov_sat r0.x, v2.y  
   <span class="hljs-number">1</span>: ge r0.y, r0.x, l(<span class="hljs-number">0.052579</span>)  
   <span class="hljs-number">2</span>: ge r0.z, l(<span class="hljs-number">0.965679</span>), r0.x  
   <span class="hljs-number">3</span>: <span class="hljs-keyword">and</span> r0.y, r0.z, r0.y  
   <span class="hljs-number">4</span>: if_nz r0.y  
   <span class="hljs-number">5</span>:  ge r0.y, l(<span class="hljs-number">0.878136</span>), r0.x  
   <span class="hljs-number">6</span>:  add r0.z, r0.x, l(<span class="hljs-number">-0.052579</span>)  
   <span class="hljs-number">7</span>:  mul r1.w, r0.z, l(<span class="hljs-number">1.211303</span>)  
   <span class="hljs-number">8</span>:  mov_sat r0.z, r1.w  
   <span class="hljs-number">9</span>:  mad r0.w, r0.z, l(<span class="hljs-number">-2.000000</span>), l(<span class="hljs-number">3.000000</span>)  
  <span class="hljs-number">10</span>:  mul r0.z, r0.z, r0.z  
  <span class="hljs-number">11</span>:  mul r0.z, r0.z, r0.w  
  <span class="hljs-number">12</span>:  mul r2.x, r0.z, l(<span class="hljs-number">0.084642</span>)  
  <span class="hljs-number">13</span>:  mov r1.yz, l(<span class="hljs-number">0.000000</span>, <span class="hljs-number">0.000000</span>, <span class="hljs-number">0.084642</span>, <span class="hljs-number">0.000000</span>)  
  <span class="hljs-number">14</span>:  movc r2.yzw, r0.yyyy, r1.yyzw, l(<span class="hljs-number">0.000000</span>, <span class="hljs-number">0.000000</span>, <span class="hljs-number">0.000000</span>, <span class="hljs-number">0.500000</span>)  
  <span class="hljs-number">15</span>:  <span class="hljs-keyword">not</span> r0.z, r0.y  
  <span class="hljs-number">16</span>:  if_z r0.y  
  <span class="hljs-number">17</span>:   ge r0.y, l(<span class="hljs-number">0.924339</span>), r0.x  
  <span class="hljs-number">18</span>:   add r0.w, r0.x, l(<span class="hljs-number">-0.878136</span>)  
  <span class="hljs-number">19</span>:   mul r1.w, r0.w, l(<span class="hljs-number">21.643608</span>)  
  <span class="hljs-number">20</span>:   mov_sat r0.w, r1.w  
  <span class="hljs-number">21</span>:   mad r3.x, r0.w, l(<span class="hljs-number">-2.000000</span>), l(<span class="hljs-number">3.000000</span>)  
  <span class="hljs-number">22</span>:   mul r0.w, r0.w, r0.w  
  <span class="hljs-number">23</span>:   mul r0.w, r0.w, r3.x  
  <span class="hljs-number">24</span>:   mad r1.x, r0.w, l(<span class="hljs-number">0.889658</span>), l(<span class="hljs-number">0.084642</span>)  
  <span class="hljs-number">25</span>:   mov r1.yz, l(<span class="hljs-number">0.000000</span>, <span class="hljs-number">0.084642</span>, <span class="hljs-number">0.974300</span>, <span class="hljs-number">0.000000</span>)  
  <span class="hljs-number">26</span>:   movc r2.xyzw, r0.yyyy, r1.xyzw, r2.xyzw  
  <span class="hljs-number">27</span>:  <span class="hljs-keyword">else</span>  
  <span class="hljs-number">28</span>:   mov r2.y, l(<span class="hljs-number">0</span>)  
  <span class="hljs-number">29</span>:   mov r0.y, l(<span class="hljs-number">-1</span>)  
  <span class="hljs-number">30</span>:  endif  
  <span class="hljs-number">31</span>:  <span class="hljs-keyword">not</span> r0.w, r0.y  
  <span class="hljs-number">32</span>:  <span class="hljs-keyword">and</span> r0.z, r0.w, r0.z  
  <span class="hljs-number">33</span>:  if_nz r0.z  
  <span class="hljs-number">34</span>:   ge r0.y, r0.x, l(<span class="hljs-number">0.924339</span>)  
  <span class="hljs-number">35</span>:   add r0.x, r0.x, l(<span class="hljs-number">-0.924339</span>)  
  <span class="hljs-number">36</span>:   mul r1.w, r0.x, l(<span class="hljs-number">24.189651</span>)  
  <span class="hljs-number">37</span>:   mov_sat r0.x, r1.w  
  <span class="hljs-number">38</span>:   mad r0.z, r0.x, l(<span class="hljs-number">-2.000000</span>), l(<span class="hljs-number">3.000000</span>)  
  <span class="hljs-number">39</span>:   mul r0.x, r0.x, r0.x  
  <span class="hljs-number">40</span>:   mul r0.x, r0.x, r0.z  
  <span class="hljs-number">41</span>:   mad r1.x, r0.x, l(<span class="hljs-number">-0.974300</span>), l(<span class="hljs-number">0.974300</span>)  
  <span class="hljs-number">42</span>:   mov r1.yz, l(<span class="hljs-number">0.000000</span>, <span class="hljs-number">0.974300</span>, <span class="hljs-number">0.000000</span>, <span class="hljs-number">0.000000</span>)  
  <span class="hljs-number">43</span>:   movc r2.xyzw, r0.yyyy, r1.xyzw, r2.xyzw  
  <span class="hljs-number">44</span>:  endif  
  <span class="hljs-number">45</span>: <span class="hljs-keyword">else</span>  
  <span class="hljs-number">46</span>:  mov r2.yzw, l(<span class="hljs-number">0.000000</span>, <span class="hljs-number">0.000000</span>, <span class="hljs-number">0.000000</span>, <span class="hljs-number">0.500000</span>)  
  <span class="hljs-number">47</span>:  mov r0.y, l(<span class="hljs-number">0</span>)  
  <span class="hljs-number">48</span>: endif  
  <span class="hljs-number">49</span>: mov_sat r2.w, r2.w  
  <span class="hljs-number">50</span>: mad r0.x, r2.w, l(<span class="hljs-number">-2.000000</span>), l(<span class="hljs-number">3.000000</span>)  
  <span class="hljs-number">51</span>: mul r0.z, r2.w, r2.w  
  <span class="hljs-number">52</span>: mul r0.x, r0.z, r0.x  
  <span class="hljs-number">53</span>: add r0.z, -r2.y, r2.z  
  <span class="hljs-number">54</span>: mad r0.x, r0.x, r0.z, r2.y  
  <span class="hljs-number">55</span>: movc r0.x, r0.y, r2.x, r0.x  
  <span class="hljs-number">56</span>: mad r0.y, cb4[<span class="hljs-number">1</span>].x, -cb0[<span class="hljs-number">9</span>].w, l(<span class="hljs-number">1.000000</span>)  
  <span class="hljs-number">57</span>: mul_sat r0.y, r0.y, v3.w  
  <span class="hljs-number">58</span>: mul r0.x, r0.y, r0.x  
  <span class="hljs-number">59</span>: mul r0.yzw, cb2[<span class="hljs-number">2</span>].xxyz, cb4[<span class="hljs-number">0</span>].xxxx  
  <span class="hljs-number">60</span>: mul r0.x, r0.x, cb2[<span class="hljs-number">2</span>].w  
  <span class="hljs-number">61</span>: dp3 r1.x, l(<span class="hljs-number">0.333000</span>, <span class="hljs-number">0.555000</span>, <span class="hljs-number">0.222000</span>, <span class="hljs-number">0.000000</span>), r0.yzwy  
  <span class="hljs-number">62</span>: mad r1.xyz, r1.xxxx, v0.xyzx, -r0.yzwy  
  <span class="hljs-number">63</span>: mad r0.yzw, v0.wwww, r1.xxyz, r0.yyzw  
  <span class="hljs-number">64</span>: add r1.xyz, -r0.yzwy, v1.xyzx  
  <span class="hljs-number">65</span>: mad r0.yzw, v1.wwww, r1.xxyz, r0.yyzw  
  <span class="hljs-number">66</span>: mul o0.xyz, r0.xxxx, r0.yzwy  
  <span class="hljs-number">67</span>: mov o0.w, r0.x  
  <span class="hljs-number">68</span>: ret</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рд╢реЗрдбрд░ рдереЛрдбрд╝рд╛ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдореЗрд░реЗ рд▓рд┐рдП рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рдХрдард┐рди рдерд╛ рдХрд┐ рдЗрд╕рдореЗрдВ рдХреНрдпрд╛ рд╣реЛ рд░рд╣рд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, 1.211303, 21.643608 рдФрд░ 24.189651 рдЬреИрд╕реЗ рд╕рднреА рдореВрд▓реНрдп рдХрд╣рд╛рдВ рд╕реЗ рдЖрдП? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрджрд┐ рд╣рдо рдЕрд╕реНрдкрд╖реНрдЯрддрд╛ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рдПрдХ рдЗрдирдкреБрдЯ рдореВрд▓реНрдп рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдХрд╛рдлреА рд╕рд░рд▓ рд╣реИ - [0,1] (рд▓рд╛рдЗрди 0) рд╕реЗ рд░реЗрдВрдЬ рдореЗрдВ рдЯреЗрдХреНрд╕рдХреЛрд░реНрдб рдпрд╣рд╛рдВ рдЙрдкрдпреЛрдЧреА рд╣реЛрдЧрд╛, рддрд╛рдХрд┐ рд╣рдо рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдЙрд▓реНрдХрд╛рдкрд┐рдВрдб рдХреА рдкреВрд░реА рд▓рдВрдмрд╛рдИ рдкрд░ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХреЗрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдЪрд╛рд░ рдЦрдВрдб / рдЕрдВрддрд░рд╛рд▓ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЪрд╛рд░ рдирд┐рдпрдВрддреНрд░рдг рдмрд┐рдВрджреБрдУрдВ рджреНрд╡рд╛рд░рд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:</font></font><br>
<br>
<pre><code class="cpp hljs">   <span class="hljs-comment">// current status: no idea how these are generated  </span>
   <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> controlPoint0 = <span class="hljs-number">0.052579</span>;  
   <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> controlPoint1 = <span class="hljs-number">0.878136</span>;  
   <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> controlPoint2 = <span class="hljs-number">0.924339</span>;  
   <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> controlPoint3 = <span class="hljs-number">0.965679</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореБрдЭреЗ рдирд╣реАрдВ рдкрддрд╛ рдХрд┐ рдЙрдиреНрд╣реЗрдВ рдХреИрд╕реЗ рдЪреБрдирд╛ рдЧрдпрд╛ / рдЧрдгрдирд╛ рдХреА рдЧрдИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЬреИрд╕рд╛ рдХрд┐ рд╣рдо рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рд╕реЗ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдкрд╣рд▓реА рд╢рд░реНрдд рд╕рд┐рд░реНрдл рдЬрд╛рдБрдЪ рдХрд░ рд░рд╣реА рд╣реИ рдХрд┐ рдЗрдирдкреБрдЯ рдореВрд▓реНрдп рд╕реАрдорд╛ рдореЗрдВ рд╣реИ [controlPoint0 - controlPointVOD]ред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдирд╣реАрдВ, рддреЛ рдЕрдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛ рд╕рд┐рд░реНрдл 0.0 рд╣реИред</font></font><br>
<br>
<pre><code class="cpp hljs">   <span class="hljs-comment">// Input for the opacity function</span>
   <span class="hljs-keyword">float</span> y = saturate(Input.Texcoords.y);  <span class="hljs-comment">// r0.x</span><font></font>
     <font></font>
   <span class="hljs-comment">// Value of opacity function.  </span>
   <span class="hljs-comment">// 0 - no change  </span>
   <span class="hljs-comment">// 1 - full color  </span>
   <span class="hljs-keyword">float</span> opacity = <span class="hljs-number">0.0</span>;  <font></font>
     <font></font>
   [branch]   <font></font>
   <span class="hljs-keyword">if</span> (y &gt;= controlPoint0 &amp;&amp; y &lt;= controlPoint3)  <font></font>
   {  <font></font>
      ...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдХрд╛ рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрд╡рд╢реНрдпрдХ рд╣реИ</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдпрджрд┐ рд╣рдо рдпрд╣ рд╕рдордЭрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЕрдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛ рдХрд╛рд░реНрдп рдХреИрд╕реЗ рд╣реЛрддрд╛ рд╣реИ:</font></font><br>
<br>
<pre><code class="cpp hljs">   <span class="hljs-number">6</span>: add r0.z, r0.x, l(<span class="hljs-number">-0.052579</span>)   
   <span class="hljs-number">7</span>: mul r1.w, r0.z, l(<span class="hljs-number">1.211303</span>)   
   <span class="hljs-number">8</span>: mov_sat r0.z, r1.w   
   <span class="hljs-number">9</span>: mad r0.w, r0.z, l(<span class="hljs-number">-2.000000</span>), l(<span class="hljs-number">3.000000</span>)   
  <span class="hljs-number">10</span>: mul r0.z, r0.z, r0.z   
  <span class="hljs-number">11</span>: mul r0.z, r0.z, r0.w   
  <span class="hljs-number">12</span>: mul r2.x, r0.z, l(<span class="hljs-number">0.084642</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд▓рд╛рдЗрди 9 рдореЗрдВ рдЧреБрдгрд╛рдВрдХ '-2.0' рдФрд░ '3.0' рд╣реИ, рдЬреЛ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдореВрдерд╕реНрдЯреЗрдк</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдЙрдкрдпреЛрдЧ рдкрд░ рд╕рдВрдХреЗрдд </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;">рджреЗрддрд╛</font></a><font style="vertical-align: inherit;"> рд╣реИ </font><font style="vertical-align: inherit;">ред рд╣рд╛рдВ, рдпрд╣ рдПрдХ рдЕрдЪреНрдЫрд╛ рдЕрдиреБрдорд╛рди рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкреНрд░реЛрдЯреЛрдЯрд╛рдЗрдк рдХреЗ рд╕рд╛рде HLSL smoothstep рдлрдВрдХреНрд╢рди: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ret smoothstep (рдиреНрдпреВрдирддрдо, рдЕрдзрд┐рдХрддрдо, x)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдореЗрд╢рд╛ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x рдХреЛ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">min-max</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ] </font><i><font style="vertical-align: inherit;">рддрдХ</font></i><font style="vertical-align: inherit;"> рд╕реАрдорд┐рдд рдХрд░рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред рджреЗрдЦрдиреЗ рдХрд╛ рдПрдХ рдХреЛрдбрд╛рдВрддрд░рдХ рдмрд┐рдВрджреБ рд╕реЗ, рдЗрд╕ рдШрдЯрд╛рддрд╛ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧрдпрд╛ рдорд┐рдирдЯ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЗрдирдкреБрдЯ рдореВрд▓реНрдп (рдХрд┐ рд▓рд╛рдЗрди 9 рдкрд░ r0.z рд╕реЗ рд╣реИ,) рд╕реЗ рд╣реИ, рд▓реЗрдХрд┐рди рдЙрд╕ рдХреЛрдб рдореЗрдВ рдРрд╕рд╛ рдХреБрдЫ рднреА рдирд╣реАрдВ рд╣реИред рдХреЗ рд▓рд┐рдП </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдзрд┐рдХрддрдо,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЗрд╕ рдЗрдирдкреБрдЯ рдореВрд▓реНрдп рдХрд╛ рдПрдХ рдЧреБрдгрди рдХрд╛ рддрд╛рддреНрдкрд░реНрдп рд╣реИ, рд▓реЗрдХрд┐рди рдХреЛрдб рдореЗрдВ 'mul_sat' рдЬреИрд╕реА рдХреЛрдИ рдмрд╛рдд рдирд╣реАрдВ рд╣реИред рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, 'mov_sat' рд╣реИред рдпрд╣ рд╣рдореЗрдВ рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд┐рдирдЯ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдзрд┐рдХрддрдо</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> smoothstep рдХреЗ рдХрд╛рд░реНрдпреЛрдВ 0 рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдФрд░ 1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдм рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХреНрд╕</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрддрд░рд╛рд▓ рдореЗрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП [0, 1]ред рдЬреИрд╕рд╛ рдХрд┐ рдКрдкрд░ рдХрд╣рд╛ рдЧрдпрд╛ рд╣реИ, рдЕрдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛ рдХрд╛рд░реНрдп рдореЗрдВ рддреАрди рдЦрдВрдб рд╣реИрдВред рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рд╕рдВрдХреЗрдд рджреЗрддрд╛ рд╣реИ рдХрд┐ рдХреЛрдб рдЙрд╕ рдЬрдЧрд╣ рдХреА рддрд▓рд╛рд╢ рдХрд░ рд░рд╣рд╛ рд╣реИ рдЬрд╣рд╛рдВ рд╣рдо рдЕрдВрддрд░рд╛рд▓ [рд╕реЗрдЧрдореЗрдВрдЯрд╕реНрдЯрд╛рд░реНрдЯ-рд╕реЗрдЧрдореЗрдВрдЯ] рдореЗрдВ рд╣реИрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЬрд╡рд╛рдм рд▓рд┐рдирд╕реНрдЯреЗрдк рдлрд╝рдВрдХреНрд╢рди рд╣реИ!</font></font><br>
<br>
<pre><code class="cpp hljs"> <span class="hljs-function"><span class="hljs-keyword">float</span> <span class="hljs-title">linstep</span><span class="hljs-params">(<span class="hljs-keyword">float</span> min, <span class="hljs-keyword">float</span> max, <span class="hljs-keyword">float</span> v)</span>  
 </span>{  
   <span class="hljs-keyword">return</span> ( (v-min) / (max-min) );  <font></font>
 }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЪрд▓реЛ рдкрд╣рд▓рд╛ рдЦрдВрдб рд▓реЗрддреЗ рд╣реИрдВ: [реж.режрелреирел 0. реп - реж.13136резрейрем]ред </font><font style="vertical-align: inherit;">рдШрдЯрд╛рд╡ рд▓рд╛рдЗрди 6 рдкрд░ рд╣реИред рдпрджрд┐ рд╣рдо рд╡рд┐рднрд╛рдЬрди рдХреЛ рдЧреБрдгрди рджреНрд╡рд╛рд░рд╛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВ -&gt; 1.0 / (0.878136 - 0.052579) = 1.0 / 0.825557 = ~ 1.211303ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕реНрдореВрдерд╕реНрдЯреЗрдк рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╕реАрдорд╛ [0, 1] рдореЗрдВ рд╣реИред </font><font style="vertical-align: inherit;">рд▓рд╛рдЗрди 12 рдкрд░ рдЧреБрдгрд╛ рд╕реЗрдЧрдореЗрдВрдЯ рдХрд╛ рд╡рдЬрди рд╣реИред </font><font style="vertical-align: inherit;">рдкреНрд░рддреНрдпреЗрдХ рдЦрдВрдб рдХрд╛ рдЕрдкрдирд╛ рд╡рдЬрди рд╣реЛрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЖрдк рдЗрд╕ рд╡рд┐рд╢реЗрд╖ рдЦрдВрдб рдХреА рдЕрдзрд┐рдХрддрдо рдЕрд╕реНрдкрд╖реНрдЯрддрд╛ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдкрд╣рд▓реЗ рдЦрдВрдб [0.052579 - 0.878136] рдХреЗ рд▓рд┐рдП, рдЕрдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛ [0 - 0.084642] рд╢реНрд░реЗрдгреА рдореЗрдВ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдЪрдПрд▓рдПрд╕рдПрд▓ рдлрд╝рдВрдХреНрд╢рди рдЬреЛ рдПрдХ рдордирдорд╛рдиреЗ рд╕реЗрдЧрдореЗрдВрдЯ рдХреЗ рд▓рд┐рдП рдЕрд╕реНрдкрд╖реНрдЯрддрд╛ рдХреА рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд▓рд┐рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:</font></font><br>
<br>
<pre><code class="cpp hljs"> <span class="hljs-function"><span class="hljs-keyword">float</span> <span class="hljs-title">getOpacityFunctionValue</span><span class="hljs-params">(<span class="hljs-keyword">float</span> x, <span class="hljs-keyword">float</span> cpLeft, <span class="hljs-keyword">float</span> cpRight, <span class="hljs-keyword">float</span> weight)</span>  
 </span>{  
   <span class="hljs-keyword">float</span> val = smoothstep( <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, linstep(cpLeft, cpRight, x) );  
   <span class="hljs-keyword">return</span> val * weight;  <font></font>
 }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рддреЛ, рдкреВрд░реЗ рдмрд┐рдВрджреБ рдмрд╕ рдЗрд╕реА рдЦрдВрдб рдХреЗ рд▓рд┐рдП рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╡рдЬрди рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВ:</font></font><br>
<br>
<pre><code class="cpp hljs">   <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> weight0 = <span class="hljs-number">0.084642</span>;  
   <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> weight1 = <span class="hljs-number">0.889658</span>;  
   <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> weight2 = <span class="hljs-number">0.974300</span>; <span class="hljs-comment">// note: weight0+weight1 = weight2</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдХреЗ рдЕрдиреБрд╕рд╛рд░, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд╕реНрдкрд╖реНрдЯрддрд╛ (x)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдлрд╝рдВрдХреНрд╢рди рдХреА </font><font style="vertical-align: inherit;">рдЧрдгрдирд╛ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рдХреА рдЬрд╛рддреА рд╣реИ:</font></font><br>
<br>
<pre><code class="cpp hljs">   <span class="hljs-keyword">float</span> opacity = <span class="hljs-number">0.0</span>;<font></font>
<font></font>
   [branch]   <font></font>
   <span class="hljs-keyword">if</span> (y &gt;= controlPoint0 &amp;&amp; y &lt;= controlPoint3)  <font></font>
   {  <font></font>
     <span class="hljs-comment">// Range of v: [0, weight0]  </span>
     <span class="hljs-keyword">float</span> v = getOpacityFunctionValue(y, controlPoint0, controlPoint1, weight0);  <font></font>
     opacity = v;  <font></font>
     <font></font>
     [branch]  <font></font>
     <span class="hljs-keyword">if</span> ( y &gt;= controlPoint1 )  <font></font>
     {  <font></font>
       <span class="hljs-comment">// Range of v: [0, weight1]  </span>
       <span class="hljs-keyword">float</span> v = getOpacityFunctionValue(y, controlPoint1, controlPoint2, weight1);  <font></font>
       opacity = weight0 + v;  <font></font>
   <font></font>
       [branch]  <font></font>
       <span class="hljs-keyword">if</span> (y &gt;= controlPoint2)  <font></font>
       {  <font></font>
         <span class="hljs-comment">// Range of v: [0, weight2]  </span>
         <span class="hljs-keyword">float</span> v = getOpacityFunctionValue(y, controlPoint2, controlPoint3, weight2);<font></font>
         opacity = weight2 - v;          <font></font>
       }  <font></font>
     }  <font></font>
   }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣рд╛рдБ рдЕрд╕реНрдкрд╖реНрдЯрддрд╛ рд╕рдорд╛рд░реЛрд╣ рдХрд╛ рдПрдХ рдЧреНрд░рд╛рдл рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдк рдЖрд╕рд╛рдиреА рд╕реЗ рдЕрд╕реНрдкрд╖реНрдЯрддрд╛ рдореЗрдВ рддреЗрдЬ рд╡реГрджреНрдзрд┐ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рдПрдХ рд╢реВрдЯрд┐рдВрдЧ рд╕реНрдЯрд╛рд░ рдХреЗ рд╢рд░реАрд░ рдХреА рд╢реБрд░реБрдЖрдд рдХрд╛ рд╕рдВрдХреЗрдд рджреЗрддрд╛ рд╣реИ:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5da/326/1f0/5da3261f0f88fa41ac963ca84fc79f99.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧреНрд░рд╛рдл рдЕрдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛ рдХрд╛рд░реНрдпред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд▓рд╛рд▓ рдЪреИрдирд▓ - рдЕрдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛ рдорд╛рдиред </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рд░рд╛ рдЪреИрдирд▓ - рдирд┐рдпрдВрддреНрд░рдг рдмрд┐рдВрджреБред </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдиреАрд▓рд╛ рдЪреИрдирд▓ - рд╡рдЬрд╝рдиред</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
рдЕрдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдмрд╛рдХреА рд╕рдм рд╕рд┐рд░реНрдл рдкрд░рд┐рд╖реНрдХрд░рдг рд╕реНрдкрд░реНрд╢ рд╣реИред </font><font style="vertical-align: inherit;">рдлрд┐рд░ рдЕрддрд┐рд░рд┐рдХреНрдд рдЧреБрдгрди рд╣реЛрддреЗ рд╣реИрдВ: рд╕рд┐рддрд╛рд░реЛрдВ рдХреА рдЕрд╕реНрдкрд╖реНрдЯрддрд╛, рд╢реВрдЯрд┐рдВрдЧ рд╕реНрдЯрд╛рд░ рдХрд╛ рд░рдВрдЧ рдФрд░ рдХреЛрд╣рд░реЗ рдХрд╛ рдкреНрд░рднрд╛рд╡ред </font><font style="vertical-align: inherit;">TW3 рд╢реЗрдбреНрд╕ рдореЗрдВ рд╣рдореЗрд╢рд╛ рдХреА рддрд░рд╣, рдЖрдк рдпрд╣рд╛рдБ 1.0 рд╕реЗ рдирд┐рд░рд░реНрдердХ рдЧреБрдгрди рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:</font></font><br>
<br>
<pre><code class="cpp hljs">   <span class="hljs-comment">// cb4_v1.x = 1.0  </span>
   <span class="hljs-keyword">float</span> starsOpacity = <span class="hljs-number">1.0</span> - cb0_v9.w * cb4_v1.x;    <font></font>
   opacity *= starsOpacity;  <font></font>
<font></font>
   <span class="hljs-comment">// Calculate color of a shooting star  </span>
   <span class="hljs-comment">// cb4_v0.x = 10.0</span>
   <span class="hljs-comment">// cb2_v2.rgb = (1.0, 1.0, 1.0)</span><font></font>
   float3 color = cb2_v2.rgb * cb4_v0.x;<font></font>
     <font></font>
   <span class="hljs-comment">// cb2_v2.w = 1  </span><font></font>
   opacity *= cb2_v2.w;<font></font>
     <font></font>
   FogResult fr = { Input.FogParams, Input.AerialParams };  <font></font>
   color = ApplyFog(fr, color);<font></font>
     <font></font>
   <span class="hljs-keyword">return</span> float4( color*opacity, opacity);  <font></font>
 }</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. рд╕рд╛рд░рд╛рдВрд╢</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореБрдЦреНрдп рдХрдард┐рдирд╛рдИ рдЕрд╕реНрдкрд╖реНрдЯрддрд╛ рд╕рдорд╛рд░реЛрд╣ рдХреЗ рд╕рд╛рде рднрд╛рдЧ рдореЗрдВ рд╣реИред рдЗрд╕реЗ рдбрд┐рдХреЛрдб рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдмрд╛рдХреА рд╕рдм рдХреБрдЫ рд╕рдордЭрдиреЗ рдореЗрдВ рдХрд╛рдлреА рд╕рд░рд▓ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореИрдВрдиреЗ рдКрдкрд░ рдХрд╣рд╛ рд╣реИ рдХрд┐ рдкрд┐рдХреНрд╕реЗрд▓ shader рдереЛрдбрд╝рд╛ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИред рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╣рдо рдХреЗрд╡рд▓ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд╕реНрдкрд╖реНрдЯрддрд╛ (x)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдореВрд▓реНрдп рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкрд░рд╡рд╛рд╣ рдХрд░рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">, рдЬреЛ r2.x (рд▓рд╛рдЗрди 49 рдкрд░ рд╢реБрд░реВ) рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдореЗрдВ рдЕрд╕реНрдкрд╖реНрдЯрддрд╛ рд╕рдорд╛рд░реЛрд╣ рддреАрди рдЕрддрд┐рд░рд┐рдХреНрдд рдЪрд░ рдмрдирд╛рддрд╛ рд╣реИ: minRange (r2.y), maxRange (r2.z) рдФрд░ рдореВрд▓реНрдп (r2.w)ред рд╡реЗ рд╕рднреА рдкреИрд░рд╛рдореАрдЯрд░ рд╣реИрдВ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛ рдХреА рдЧрдгрдирд╛ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрдм </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛ (x) рдХрд╛</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: </font></font><br>
<br>
<code>lerp( minRange, maxRange, smoothstep(0, 1, value) );</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдЕрдВрддрд┐рдо рдЕрдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛ рдорд╛рди рдХреЛ рд▓рд╛рдЗрди 55 рдкрд░ рд╕рд╢рд░реНрдд рд╢рд╛рдЦрд╛ рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ - рдпрджрд┐ рдЗрдирдкреБрдЯ рдорд╛рди </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x рд╣реИ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реАрдорд╛ рдореЗрдВ рд╣реИ [controlPoint0 - controlPoint3], рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЕрд╕реНрдкрд╖реНрдЯрддрд╛ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП r2.x рдХрд╛ рдЪрдпрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдиреНрдпрдерд╛, рдЬрдм </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдВрддрд░рд╛рд▓ рдХреЗ рдмрд╛рд╣рд░ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдЕрдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛ рдХреА рдЧрдгрдирд╛ r0.x рд╕реЗ рдХреА рдЬрд╛рддреА рд╣реИ, рдЕрд░реНрдерд╛рдд рдЙрдкрд░реЛрдХреНрдд рд╕рдореАрдХрд░рдг рдХреЗ рдЕрдиреБрд╕рд╛рд░ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореИрдВрдиреЗ рдЕрдВрддрд░рд╛рд▓ рдХреЗ рдмрд╛рд╣рд░ рдХреБрдЫ рдкрд┐рдХреНрд╕рд▓ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ [controlPoint0 - controlPoint3], рдФрд░ рдЕрдВрддрд┐рдо рдЕрд╕реНрдкрд╖реНрдЯрддрд╛ рд╣рдореЗрд╢рд╛ рд╢реВрдиреНрдп рд╣реЛ рдЧрдИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдЬ рдХреЗ рд▓рд┐рдП рдЗрддрдирд╛ рд╣реАред </font><font style="vertical-align: inherit;">рдФрд░, рд╣рдореЗрд╢рд╛ рдХреА рддрд░рд╣, рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рджред</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi489092/index.html">рдореИрдВрдиреЗ 12 рдорд╣реАрдиреЛрдВ рдореЗрдВ рд╕реНрд╡рддрдВрддреНрд░ рд░реВрдк рд╕реЗ рдПрдХ рдирдИ рднрд╛рд╖рд╛ рдХреИрд╕реЗ рд╕реАрдЦреА: рдПрдХ рдХреБрд▓ рдЧрд╛рдЗрдб</a></li>
<li><a href="../hi489100/index.html">SARS-CoV-2 рдХреЛрд░реЛрдирд╛рд╡рд╛рдпрд░рд╕ рдбреЗрдЯрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг (2019-nCov)</a></li>
<li><a href="../hi489102/index.html">рдирдХрд▓реА рдкрдЯрдХрдерд╛ред "рд╣рд╛рдВ, рдореИрдВ рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ рдореИрдбреЛрдирд╛ рдХреЛ рдЬрд╛рдирддрд╛ рд╣реВрдВ"</a></li>
<li><a href="../hi489106/index.html">рдХреИрд╕реЗ рдореИрдВрдиреЗ рдкрддреНрд░рдХрд╛рд░рд┐рддрд╛ рдЫреЛрдбрд╝ рджреА рдФрд░ рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рдмрди рдЧрдпрд╛</a></li>
<li><a href="../hi489108/index.html">рдПрдХ рдкрд╛рдЗрд╕реНрдЯреЗрд╕реНрдЯ рд░рд┐рдкреЛрд░реНрдЯ рдореЗрдВ рдЕрдкрдиреА рдлреАрд▓реНрдбреНрд╕ рдЬреЛрдбрд╝рдирд╛</a></li>
<li><a href="../hi489122/index.html">рдЯрд╛рдЗрдкрд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдЯрд╛рдЗрдк рдХрд┐рдП рдЧрдП OData рдХреНрд╡реЗрд░реАрдЬрд╝</a></li>
<li><a href="../hi489128/index.html">рдЕрдВрддрд░реНрд░рд╛рд╖реНрдЯреНрд░реАрдпрдХрд░рдг: рдЙрддреНрдкрд╛рдж рдХреЛ рдЕрдВрддрд░реНрд░рд╛рд╖реНрдЯреНрд░реАрдп рдмрд╛рдЬрд╛рд░ рдореЗрдВ рдХреИрд╕реЗ рд▓рд╛рдпрд╛ рдЬрд╛рдП (рдФрд░ рдкрд╛рдЧрд▓ рди рд╣реЛ)</a></li>
<li><a href="../hi489132/index.html">рдЗрдВрдЯреАрдЧреНрд░реЗрдЯреЗрдб рд╕рд┐рд╕реНрдЯрдо рдпреВрд░реЛрдк 2020 рдХреЗ рд╕рд╛рде рд╣рд╛рдЗрд▓рд╛рдЗрдЯреНрд╕</a></li>
<li><a href="../hi489134/index.html">рд░реВрд╕реА рдЦрд╛рджреНрдп рдХрдВрдкрдирд┐рдпреЛрдВ рдореЗрдВ рдбрд┐рдЬрд╛рдЗрди рдЯреАрдореЛрдВ рдХрд╛ рдЕрдиреБрд╕рдВрдзрд╛рди</a></li>
<li><a href="../hi489136/index.html">рдЯреНрд╡реЗрдВрдЯреА рд╣рд╛рд╕реНрдХреЗрд▓ рд▓рд╛рдЗрдиреНрд╕ рд╕реЗ рдЬреАрддрдирд╛: рдЖрдкрдХрд╛ Wc рд▓рд┐рдЦрдирд╛</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>