<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêÖ üë®üèø‚Äçü§ù‚Äçüë®üèΩ üë≤üèæ Just say no to end-2-end tests üíÖüèø üìû üë®üèΩ‚Äçüî¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="You probably had this when you and your friends really wanted to watch a movie, and then regretted that you spent time on it. Or maybe you remember th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Just say no to end-2-end tests</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lanit/blog/502560/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You probably had this when you and your friends really wanted to watch a movie, and then regretted that you spent time on it. </font><font style="vertical-align: inherit;">Or maybe you remember the moment when your team thought that it had found a ‚Äúkiller feature‚Äù and found its ‚Äúpitfalls‚Äù only after the release of the product. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Good ideas often fail in practice, and in the testing world, a testing strategy based on end-to-end test automation is a good example of this. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Testers can invest their time writing many types of automated tests, including unit tests, integration tests, and end-2-end tests, but this strategy is mainly aimed at end-2-end tests that test the product or service as a whole. </font><font style="vertical-align: inherit;">Typically, these tests mimic real user scenarios.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gs/2w/_z/gs2w_zh-jl0ki-mla34_nut9dqk.jpeg"></div><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Source</font></font></a></i><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">End-2-end tests in theory</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Although relying primarily on end-2-end tests is a bad idea, in theory you can come up with several arguments in favor of this statement.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, the number one </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on the Google list of ten things</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> that, as we know, is true: "The interests of users above all." </font><font style="vertical-align: inherit;">Thus, using end-2-end tests that focus on real user scenarios seems like a great idea. </font><font style="vertical-align: inherit;">In addition, this strategy is generally attractive to many participants in the process.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Developers like this strategy, because you can transfer most of the testing, if not all, to others.</font></font></li>
<li>  ,  ,  ,   ,    ,     ,      .</li>
<li>   ,                 &nbsp;  ,     ;                  .</li>
</ul><br>
<h2>End-2-end   </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, if this testing strategy looks so good in theory, then what‚Äôs wrong with it in practice? </font><font style="vertical-align: inherit;">To demonstrate this, I will give a fictitious scenario below, but which is based on real situations that are familiar to me and other testers.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suppose a team creates a service for editing documents online (for example, Google Docs). </font><font style="vertical-align: inherit;">Let's assume that the team already has some fantastic infrastructure for testing. </font><font style="vertical-align: inherit;">Every night:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Builds the latest version of the service,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">then this version is deployed in the team testing environment,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">then in this test environment all end-to-end tests are run,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The team receives an e-mail report summarizing the test results.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The deadline is approaching fast. </font><font style="vertical-align: inherit;">To maintain a high level of product quality, let's say we decide that at least 90% of successful end-2-end tests are required so that we consider that the version is ready. </font><font style="vertical-align: inherit;">Let's say the deadline comes in one day.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/va/gp/wg/vagpwgs-6_wapdngvpzwlp8iooq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despite numerous problems, the tests eventually revealed real errors. </font></font><br>
<br>
<b><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What went well</font></font></u></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Errors affecting the user were identified and corrected before they reached him. </font></font><br>
<br>
<b><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Something went wrong</font></font></u></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The team completed its programming phase a week later (and worked a lot overtime).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finding the root cause of the failed end-2-end test is time consuming and can take a lot of time.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Failures of the parallel team and malfunctions in the equipment moved the test results by several days.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Many minor errors were hidden behind large errors.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">End-2-end test results have been unreliable at times.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The developers had to wait until the next day to find out if the fix worked or not.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, now that we know what went wrong in the end-2-end strategy, we need to change our testing approach to avoid many of the above problems. </font><font style="vertical-align: inherit;">But what is the right approach?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The true value of tests</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a rule, the work of the tester ends when the test fails. The error is logged, and then the developer's task is to fix the error. However, to determine where the end-2-end strategy does not work, we need to go beyond this thinking and approach the problem using our basic principles. If we ‚Äúfocus on the user (and everything else follows),‚Äù we must ask ourselves: does the failed test benefit the user?&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here is the answer: "A failed test does not directly benefit the user."</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Although this statement, at first glance, seems shocking, it is true. If the product works, it works, regardless of whether the test says that it works or not. If a product is broken, it is broken, regardless of whether the test says that it is broken or not. So, if failed tests do not benefit the user, then what benefits him? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bug fixes directly benefit the user.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The user will be happy only when this unpredictable behavior (error) disappears. </font><font style="vertical-align: inherit;">Obviously, in order to correct a mistake, you must know that it exists. </font><font style="vertical-align: inherit;">To find out that an error exists, ideally you should have a test that detects it (because if the test does not detect the error, then the user will find it). </font><font style="vertical-align: inherit;">But throughout this process, from the failure of the test to the correction of the error, the added value appears at the very last step.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/en/4i/4y/en4i4yg7lsynu0xfm4_ccrs1pwm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, to evaluate any testing strategy, you cannot just evaluate how it finds errors. </font><font style="vertical-align: inherit;">You should also evaluate how this allows developers to correct (and even prevent) them.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Building the right feedback</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tests create a feedback loop that informs the developer about whether the product is working or not. </font><font style="vertical-align: inherit;">An ideal feedback loop has several properties.</font></font><br>
<br>
<ul>
<li>   .         ,  ,    .     (  ),        .          .    ,        .</li>
<li>   .          ,   ,  ,     .       ,       ,        .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It should allow you to quickly find errors. </font><font style="vertical-align: inherit;">To fix the error, developers need to find the specific lines of code that cause the error. </font><font style="vertical-align: inherit;">When a product contains millions of lines of code, and the error can be anywhere, it's like trying to find a needle in a haystack.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Think Small, Not Big</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So how do we create this perfect feedback loop? </font><font style="vertical-align: inherit;">Thinking of the small, not the larger. </font></font><br>
<br>
<i><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unit testing</font></font></strong></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Unit tests take a small piece of the product and test it in isolation from everything else. </font><font style="vertical-align: inherit;">They almost create the same perfect feedback loop:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unit tests are quick. </font><font style="vertical-align: inherit;">We need to write a small block of code and we can already test it. </font><font style="vertical-align: inherit;">Unit tests are usually quite small. </font><font style="vertical-align: inherit;">In fact, one tenth of a second is too long for unit tests.</font></font></li>
<li>  .      ,  ,   .  ,     ‚Äî  , ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="></a>  ‚Äî    .</li>
<li>     .       ,     ,  ,  ,         .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Writing effective unit tests requires skills in areas such as dependency management, writing stubs / mocks, and tight testing. I will not describe these skills here, but to begin with, the typical example offered to the new Googler (or as they are called in Google, the Noogler) is how Google </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">creates</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tests the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> stopwatch. </font></font><br>
<br>
<i><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unit tests against end-2-end tests</font></font></strong></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
For end-2-end tests, you need to wait: first to create the entire product, then to deploy it, and finally to complete all end-2-end tests. When the tests still work, most likely they will periodically fail. And even if the test detects an error, it can be anywhere in the product.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Although end-to-end tests are better at modeling real user scenarios, this advantage is quickly outweighed by all the shortcomings of the end-to-end feedback loop:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/q1/px/ex/q1pxexctftgcpo6oqftyavp3cn8.jpeg"></div><br>
<i><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Integration Tests</font></font></strong></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Unit tests have one major drawback: even if the modules work well separately, you don‚Äôt know if they work well together. </font><font style="vertical-align: inherit;">But even then, you don‚Äôt have to run end-2-end tests. </font><font style="vertical-align: inherit;">You can use the integration test for this. </font><font style="vertical-align: inherit;">The integration test takes a small group of modules, often two, and tests their behavior as a whole. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the two blocks do not integrate properly, why write an end-to-end test when you can write a much smaller, more focused integration test that detects the same error? </font><font style="vertical-align: inherit;">Of course, you must understand the whole context when testing, but in order to test the work of two modules together you just need to expand the perspective a little bit.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Test pyramid</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Even with both unit and integration tests, you will likely need a small number of end-2-end tests to test the system as a whole. To find the right balance between all three types of tests, it is best to use a visual testing pyramid. Here's a simplified version </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">of the test pyramid</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> from the opening speech of the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2014 Google Test Automation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conference </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/542/f80/6c6/542f806c69fc676845d6b71f36084375.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The bulk of your tests are unit tests at the bottom of the pyramid. </font><font style="vertical-align: inherit;">As you move up the pyramid, your tests become more comprehensive, but at the same time, the number of tests (the width of your pyramid) decreases. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In a good way, Google offers a 70/20/10 separation: 70% unit tests, 20% integration tests and 10% end-2-end tests. </font><font style="vertical-align: inherit;">The exact ratio will be different for each team, but in general it should retain the shape of the pyramid. </font><font style="vertical-align: inherit;">Try to avoid the following ‚Äúforms‚Äù:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inverted pyramid / ice cream cone. </font><font style="vertical-align: inherit;">The team relies mainly on end-to-end tests, using several integration tests and very few unit tests.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hourglass. </font><font style="vertical-align: inherit;">The team begins with a large number of unit tests, and then uses end-to-end tests where integration tests should be used. </font><font style="vertical-align: inherit;">The hourglass has many unit tests at the bottom and many end-to-end tests at the top, but few integration tests in the middle.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Just as an ordinary pyramid tends to be the most stable structure in real life, a testing pyramid also tends to be the most stable testing strategy.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jobs</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you love and know how to write unit tests, then you are welcome! </font><font style="vertical-align: inherit;">The company LANIT has opened a vacancy </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for the Java developer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the DevOps team, where you will find like-minded people.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en502520/index.html">Video reports of mitap reports on product analytics</a></li>
<li><a href="../en502522/index.html">We open the galvanic isolation chip with a tiny transformer inside</a></li>
<li><a href="../en502554/index.html">Middle information technology as a way out of crisis</a></li>
<li><a href="../en502556/index.html">Microsoft Build 2020 conference - completely online today (look directly at Habr√©)</a></li>
<li><a href="../en502558/index.html">How I Collected Wheel Physics at Unigine</a></li>
<li><a href="../en502562/index.html">Unusual industrial router applications</a></li>
<li><a href="../es486176/index.html">Memo de correspondencia de correo electr√≥nico corporativo</a></li>
<li><a href="../es486178/index.html">FOSS News No. 1 - revisi√≥n de noticias gratuitas y de c√≥digo abierto del 27 de enero al 2 de febrero de 2020</a></li>
<li><a href="../es486180/index.html">Consejos y fuentes para crear aplicaciones sin servidor</a></li>
<li><a href="../es486184/index.html">C√≥mo usar la b√∫squeda de manera efectiva</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>