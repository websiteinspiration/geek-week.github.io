<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥊 👐🏿 👧🏼 これが標準です：法線マップとは何で、どのように機能しますか 🕵🏽 🔥 😫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="数年間、私は法線マップとそれらを扱うときに通常発生する問題を理解しようとしました。
 
 私が見つけた説明のほとんどは、理解するには技術的すぎる、不完全である、または複雑すぎるため、収集した情報を説明しようとすることにしました。これらの説明は不完全であるか、完全に正確ではない可能性があることを理解し...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>これが標準です：法線マップとは何で、どのように機能しますか</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481480/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数年間、私は法線マップとそれらを扱うときに通常発生する問題を理解しようとしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私が見つけた説明のほとんどは、理解するには技術的すぎる、不完全である、または複雑すぎるため、収集した情報を説明しようとすることにしました。</font><font style="vertical-align: inherit;">これらの説明は不完全であるか、完全に正確ではない可能性があることを理解していますが、とにかく試してみます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の人造の3Dモデルは次のようなものでした。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dee/aa7/cfb/deeaa7cfbf5b448d8db6a06b719c1ece.jpg" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これはすばらしいことですが、そのようなモデルには明らかな制限があります。多角形に見えすぎます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も明白な解決策：ポリゴンを追加して、ポリゴンが単一の滑らかなサーフェスとして表示される程度まで、サーフェスをより均一で滑らかにします。しかし、球などのサーフェスを滑らかにするには、非常に多くのポリゴンが必要であることがわかります（特に今日）。</font></font><br>
<a name="habracut"></a><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/60a/78a/f86/60a78af862d484ce11d083a1f201adb7.jpg" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別のソリューションが必要だったため、法線が発明されました。 （そのようにはなりませんでしたが、説明と理解の方が簡単です。）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多角形の中心からその表面に垂直な線をトレースしてみましょう。この行に非常に珍しい名前を付けます：通常。法線の目的は、サーフェスがポイントする場所を制御することです。これにより、光がこのサーフェスで反​​射したときに、法線を使用して結果の反射を計算できます。光がポリゴンに当たったら、光線の角度をポリゴンの法線と比較します。ビームは法線方向に対して同じ角度で反射されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/842/b24/bb5/842b24bb518ce0e63a7694cbd0d752e2.jpg" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
言い換えると、光の反射はポリゴンの法線に対して対称になります。これが、現実世界のほとんどの反射が機能する方法です。デフォルトでは、ポリゴンの法線はデフォルトでポリゴンの表面に垂直であるため、光線はすべてのポリゴンからその表面に完全に垂直に反射されます（実際にそうであるように）。法線にギャップがある場合、光は一方向または他の方向に反射されるため、それらを別々のサーフェスとして表示します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ff7/138/c84/ff7138c843c2d67bfcfc8c061cb1953a.jpg" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つの面が接続されている場合は、コンピューターにポリゴンの法線間の遷移を滑らかにするように依頼して、法線がポリゴンの最も近い法線に従って徐々に整列するようにすることができます。したがって、光が1つのポリゴンの中心に正確に当たると、法線の方向に従って直接反射されます。しかし、ポリゴン間では、この法線方向が滑らかになり、光の反射が変化します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/607/b7e/dc4/607b7edc436e1e47b80ccb2599fdbe22.jpg" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トランジションは1つのポリゴンとして認識されます。これは、光が一方のポリゴンともう一方のポリゴンの間でスムーズに反射され、それらの間にギャップがないためです。実際、多くのポリゴンがあるかのように、光はこれらのポリゴンからスムーズに跳ね返ります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、スムージンググループ（3ds Max、Blender）を設定するか、エッジをハードまたはスムース（Modo、Maya）として指定することによって制御します。面の間のどのトランジションをスムーズに、どのトランジションをハードにするかをプログラムに指示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下は、288ポリゴンの1つの球とハードでスムーズなトランジションの比較です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c20/5b2/5ef/c205b25ef1eb8886ee3e2fc7773f0125.jpg" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
場合によっては、平行六面体のようなものを指定して、そのすべての頂点が法線を平均化するようにすることができます。 3Dエディターは、単一の滑らかな表面のように見えるように、表面を滑らかにするよう努めます。 3Dエディターの場合、これは非常に論理的ですが、明らかにいくつかの個別の表面（ボックスの各面）が必要なオブジェクトがあるため、奇妙に見えますが、プログラムはそれらを1つの滑らかな表面として表示しようとします。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ec/d6c/1cc/9ecd6c1cc60c2d431065cb9aa6741979.jpg" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、3Dエディターには通常、スムージング角度のパラメーターがあります。2つの接続されたポリゴンがスムージング角度を超える角度にある場合、それらの遷移はスムーズになり、スムージング角度より小さい角度で接続されたポリゴンは硬くなります。このため、現実の世界では、サーフェス間の急な角度は異なるサーフェスとして表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、法線を使用してモデルの面間の遷移を制御しましたが、さらに先に進むことができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オブジェクトからの光の反射方法を変更しているため、非常に単純なオブジェクトで光を複雑に反射させることもできます。これは法線マップと呼ばれます。テクスチャを使用して、3Dオブジェクトから反射される光の方向を変更し、実際よりも硬く見えるようにします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現実の世界の例は、以前にポテトチップスを購入するときに（少なくともここではスペインで）プレゼントとして与えられたホログラムです。それらは完全に平らですが、3Dオブジェクトのように光を反射するため、実際よりも難しくなります。 3Dグラフィックスの世界では、これはさらにうまく機能しますが、それでも制限があります（表面が平坦なままであるため）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ポリゴン法線を使用してある種のブラックマジックを実装しますが、実際には、ポリゴン法線を使用してモデルサーフェスのスムージングを制御しません。頂点法線を使用して、法線のスムージングを制御します。本質的には、考え方は同じですが、もう少し複雑です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各頂点は、1つ以上の法線に関連付けることができます。法線が1つある場合は、それを頂点の平均法線と呼び、複数の場合は、頂点の分割法線と呼ぶことができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エッジで接続された2つのポリゴンを見てみましょう。 2つの面の間の遷移がスムーズである場合（Maya / Modoでスムーズとして指定した場合、または両方がMax / Blenderで同じスムージンググループを持っている場合）、各頂点には1つの法線、つまりポリゴンの平均法線があります（これが頂点の平均法線と呼ばれる理由です） ）重要な注意：最近まで、各3Dエディターは、頂点の平均法線を計算する独自の方法を使用していました。つまり、あるプログラムで計算された法線マップは、別のプログラムでは完全に異なって見える可能性がありました。これについては、チュートリアルの後半で詳しく説明します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e6b/d8d/4bd/e6bd8d4bd97239a2766676bba73a5185.jpg" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
遷移が難しい場合（ハードエッジまたは異なるスムージンググループ）、各頂点にはいくつかの法線があります。法線に従って位置合わせされた接続された各頂点に1つです。この場合、2つの異なるサーフェスのように見える法線間にギャップが形成されます。これは、分割頂点法線と呼ばれるものです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/05b/9c9/fe5/05b9c9fe5bf8f37e8212f2b25438c9c9.jpg" alt="画像"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6fc/7ed/f7e/6fc7edf7ebada96250b95870ffc4d26c.jpg" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご想像のとおり、法線マップを制御する場合、頂点法線制御は非常に重要です。幸いにも、法線を直接変更したり、それらを見たりする必要はありませんが、それがどのように機能するかを理解すると、この作業を行っている理由を理解し、発生する可能性のある問題をよりよく理解するのに役立ちます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
法線マップをベイク処理するときは、基本的に、プログラムにローポリモデルの法線が従う方向を変更して、ハイポリモデルの法線に対応させるようにします。したがって、ローポリモデルはハイポリと同じように光を反射します。このすべての情報は、「法線マップ」と呼ばれるテクスチャに保存されます。例を見てみましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのような低ポリゴンモデル（低ポリゴン）があるとします。</font><font style="vertical-align: inherit;">ベーキングプログラムが法線マップを作成するために使用するUV設定のある4頂点のフラットサーフェス。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/262/888/39d/26288839d4eb72924d12407d19352c76.jpg" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、彼女はこのハイポリモデルから法線に関する情報を取得する必要があります。その法線はより複雑です。 </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e4e/bbb/b94/e4ebbbb943f8a3ad71016ee396bc55bb.jpg" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
法線、つまりUV、マテリアル、トポロジー、変換などに関する情報のみを転送することに注意してください。</font><font style="vertical-align: inherit;">関係ありません。</font><font style="vertical-align: inherit;">実証済みのルール：highpolyモデルが適切に見える場合、その法線も良好であり、ベーキングに適しているはずです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ベイクプログラムは、ローポリモデルを取り、ローポリ法線の方向に沿って光線を放出します（ローポリ法線を制御する必要があるのはこのためです）。</font><font style="vertical-align: inherit;">これらの光線は、遠いエッジから通常の情報を取得しないように長さが制限されています（通常、この距離はベイク距離またはケージ距離と呼ばれます）。</font><font style="vertical-align: inherit;">これらの光線がハイポリと衝突すると、ベイクプログラムはこれらの光線を反射してハイポリ法線の方向に追従する方法を計算し、この情報を法線マップに保存します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/72c/487/534/72c48753443123074b3b0170ee04e7e8.jpg" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例のベイク結果は次のとおりです。 </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/256/508/4f3/2565084f33aaafaedfb752e7b5c01b89.jpg" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エンジンがローポリ法線を変更するために使用するテクスチャーがあるので、ハイポリバージョンと同じように、このローポリモデルから光が反射します。</font><font style="vertical-align: inherit;">これはローポリモデルのシルエットに影響を与えないテクスチャのみであることを忘れないでください（ライトがこのモデルに当たらない場合、モデルからのライトの反射方法を変更することはできません）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
法線マップの外観によってハイポリの外観を「数える」ことができることは明らかですが、色ではなく法線に関する情報を格納するため、法線マップは通常のテクスチャではないことは明らかです。</font><font style="vertical-align: inherit;">これは、法線マップを通常のテクスチャと見なすことができないことも意味します。</font><font style="vertical-align: inherit;">さらに、後で説明するように、これらには特別な圧縮およびガンマ補正パラメーターがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
法線マップは、1つの画像に格納された、灰色の濃淡の3つのテクスチャのセットとして認識できます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c4e/f22/2ce/c4ef222ce73d3cd29b0b055cec587c6b.jpg" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の画像は、このモデルが右側に入射する光をどのように反射するかをエンジンに伝えています。法線マップテクスチャの赤いチャネルに格納されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目の画像は、モデルが下から入射する光をどのように反射するかをエンジンに伝えます*;法線マップテクスチャの緑のチャネルに保存されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*一部のプログラムでは、光は下からではなく上から落ちます。つまり、「左側」と「右側」の法線マップがある場合があります。後で見るように、これはいくつかの問題を引き起こす場合があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3番目の画像は、モデルが正面からの入射光をどのように反射するかをエンジンに伝えます。法線マップテクスチャの青チャンネルに保存されます。ほとんどのオブジェクトは正面から照明されると白く見えるため、通常のマップは通常青みがかって表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3つの画像すべてを1つに結合すると、法線マップが作成されます。この説明は完全に正しいわけではありませんが、法線マップ内に格納されている情報を理解し、それが何をするのかをよりよく理解できるようになることを願っています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要約すると、</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
法線は、表面からの光の反射方法を決定するために使用されるベクトルです。これらを使用して、フェース間のトランジションを制御できます（接続された頂点の法線を平均してスムーズなトランジションを作成するか、それらを分離してリジッドトランジションを作成します）。また、ローポリモデルがより複雑なモデルと同じように光を反射するように方向を変更することもできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この情報は3つの別々の画像チャネルに保存され、3Dエディターはそれを読み取ってモデルの表面がどの方向に向くべきかを理解します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シリーズの次の記事では、これらのパーツをハイポリモデルからローポリにベイクする方法について説明します。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja481470/index.html">一年中スマートガーランド</a></li>
<li><a href="../ja481472/index.html">DNSの履歴：ドメイン名が支払われる時期</a></li>
<li><a href="../ja481474/index.html">私たちは別のテストから来ました-MSTestでデータベースをテストしています</a></li>
<li><a href="../ja481476/index.html">会議で話し始めたが止まらない</a></li>
<li><a href="../ja481478/index.html">STM32 + CMSIS + STM32CubeIDE</a></li>
<li><a href="../ja481482/index.html">PHP SDKを使用したFacebookページへのクロスポスト</a></li>
<li><a href="../ja481484/index.html">AIが複雑な動作を学習して問題を回避しようとする</a></li>
<li><a href="../ja481486/index.html">「Stayin 'alive、stayin' alive」：新しいプロトコルにより、Wi-Fiの使用可能範囲が60メートル広がります</a></li>
<li><a href="../ja481488/index.html">モスクワ地方当局が大気汚染を測定する方法</a></li>
<li><a href="../ja481490/index.html">ビタミンD.短い遠足</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>