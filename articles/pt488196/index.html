<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüëß‚Äçüëß üßîüèæ üèÇüèª Inser√ß√µes do Android: lidando com medos e se preparando para o Android Q üì¶ üë¥üèΩ üîØ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O Android Q √© a d√©cima vers√£o do Android com API n√≠vel 29. Uma das principais id√©ias da nova vers√£o √© o conceito de ponta a ponta, quando os aplicativ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Inser√ß√µes do Android: lidando com medos e se preparando para o Android Q</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/488196/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Android Q √© a d√©cima vers√£o do Android com API n√≠vel 29. </font><font style="vertical-align: inherit;">Uma das principais id√©ias da nova vers√£o √© o conceito de ponta a ponta, quando os aplicativos ocupam a tela inteira, de baixo para cima. </font><font style="vertical-align: inherit;">Isso significa que a barra de status e a barra de navega√ß√£o devem ser transparentes. </font><font style="vertical-align: inherit;">Mas, se forem transparentes, n√£o haver√° interface do usu√°rio do sistema - ela se sobrep√µe aos componentes interativos do aplicativo. </font><font style="vertical-align: inherit;">Este problema √© resolvido com inser√ß√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os desenvolvedores de dispositivos m√≥veis evitam inser√ß√µes, pois causam medo neles. </font><font style="vertical-align: inherit;">Mas no Android Q, n√£o ser√° poss√≠vel contornar as inser√ß√µes - voc√™ precisar√° estud√°-las e aplic√°-las. </font><font style="vertical-align: inherit;">De fato, n√£o h√° nada complicado nas inser√ß√µes: elas mostram quais elementos da tela se cruzam com a interface do sistema e sugerem como mover o elemento para que n√£o entre em conflito com a interface do usu√°rio do sistema. </font><strong><font style="vertical-align: inherit;">Konstantin Tskhovrebov</font></strong><font style="vertical-align: inherit;"> falar√° sobre como as inser√ß√µes funcionam e como s√£o √∫teis</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/6Djql74drwk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konstantin Tskhovrebov</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terrakok</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) trabalha em </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redmadrobot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Est√° envolvido no Android h√° 10 anos e acumulou muita experi√™ncia em v√°rios projetos nos quais n√£o havia lugar para inser√ß√µes, eles sempre conseguiam se locomover de alguma forma. </font><font style="vertical-align: inherit;">Konstantin vai contar sobre uma longa hist√≥ria de evitar o problema das inser√ß√µes, sobre estudar e combater o Android. </font><font style="vertical-align: inherit;">Ele considerar√° tarefas t√≠picas de sua experi√™ncia nas quais as inser√ß√µes poderiam ser aplicadas e mostrar√° como parar de ter medo do teclado, reconhecer seu tamanho e responder √† apar√™ncia. </font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota. </font><font style="vertical-align: inherit;">O artigo foi escrito com base em um relat√≥rio de Konstantin no </font></font></em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saint AppsConf 2019</font></font></em></a><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">O relat√≥rio usou materiais de v√°rios artigos sobre inser√ß√µes. </font><font style="vertical-align: inherit;">Link para esses materiais no final.</font></font></em><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarefas t√≠picas</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Barra de status de cores. </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em muitos projetos, o designer desenha uma barra de status colorida. </font><font style="vertical-align: inherit;">Tornou-se moda quando o Android 5 veio junto com o novo Material Design. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9l/ii/76/9lii76jdfrbb5i0vq8-ecv2ikby.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como pintar a barra de status? </font><font style="vertical-align: inherit;">Elementar - adicione </font></font><code>colorPrimaryDark</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e a cor √© substitu√≠da.</font></font><br>
<br>
<pre><code class="kotlin hljs"> &lt;style name=<span class="hljs-string">"AppTheme"</span> parent=<span class="hljs-string">"Theme.AppCompat.Light.NoActionBar"</span>&gt;<font></font>
    ...<font></font>
    &lt;item name=<span class="hljs-string">"colorPrimaryDark"</span>&gt;<span class="hljs-meta">@color</span>/colorAccent&lt;/item&gt;<font></font>
    ...<font></font>
&lt;/style&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para Android acima da quinta vers√£o (API de 21 e superior), voc√™ pode definir par√¢metros especiais no t√≥pico:</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;style name=<span class="hljs-string">"AppTheme"</span> parent=<span class="hljs-string">"Theme.AppCompat.Light.NoActionBar"</span>&gt;<font></font>
    ...<font></font>
    &lt;item name=<span class="hljs-string">"android:statusBarColor"</span>&gt;<span class="hljs-meta">@color</span>/colorAccent&lt;/item&gt;<font></font>
    ...<font></font>
&lt;/style&gt;</code></pre><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Barra de status multicolorida</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">√Äs vezes, designers em telas diferentes desenham a barra de status em cores diferentes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uo/ev/nl/uoevnldknz2rtfq5lcqpn1mpj4g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo bem, a maneira mais f√°cil de trabalhar √© com </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diferentes t√≥picos em diferentes atividades</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A maneira mais interessante √© mudar as cores </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diretamente no tempo de execu√ß√£o</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreateView</span><span class="hljs-params">(...)</span></span>: View {<font></font>
    requireActivity().window.statusBarColor = requireContext().getColor(R.color.colorPrimary)<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O par√¢metro √© alterado atrav√©s de um sinalizador especial. </font><font style="vertical-align: inherit;">Mas o principal √© n√£o esquecer de mudar a cor novamente quando o usu√°rio sair da tela novamente. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Barra de status transparente. </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso √© mais dif√≠cil. </font><font style="vertical-align: inherit;">Na maioria das vezes, a transpar√™ncia est√° associada aos mapas, porque √© nos mapas que a transpar√™ncia √© melhor visualizada. </font><font style="vertical-align: inherit;">Nesse caso, como antes, definimos um par√¢metro especial:</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;style name=<span class="hljs-string">"AppTheme"</span> parent=<span class="hljs-string">"Theme.AppCompat.Light.NoActionBar"</span>&gt;    <font></font>
    ...<font></font>
    &lt;item name=<span class="hljs-string">"android:windowTranslucentStatus"</span>&gt;<span class="hljs-literal">true</span>&lt;/item&gt;<font></font>
    ...<font></font>
&lt;/style&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, √© claro, existe um truque bem conhecido - recuar mais alto, caso contr√°rio, a Barra de Status ser√° sobreposta ao √≠cone e ser√° feia.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/49/8f/c8/498fc8wuip6i-o4eutfnviumuio.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas em outras telas tudo quebra. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/if/-0/0q/if-00qq6b7zidoz-_nfyehlev7s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resolver o problema? O primeiro m√©todo que vem √† mente s√£o atividades diferentes: temos t√≥picos diferentes, par√¢metros diferentes, eles funcionam de maneira diferente. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalhe com o teclado.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Evitamos inser√ß√µes n√£o apenas com a barra de status, mas tamb√©m ao trabalhar com o teclado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/s-/jk/mz/s-jkmzxzi-5xqr1ei0ku6pfubpy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ningu√©m gosta da op√ß√£o √† esquerda, mas para transform√°-la em uma op√ß√£o √† direita, existe uma solu√ß√£o simples.</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;activity<font></font>
    ...<font></font>
    android:windowSoftInputMode=<span class="hljs-string">"adjustResize"</span>&gt;<font></font>
    ...<font></font>
&lt;/activity&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A atividade agora pode ser redimensionada quando o teclado aparecer. Funciona de forma simples e severa. Mas n√£o se esque√ßa de outro truque - envolva tudo </font></font><code>ScrollView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. De repente, o teclado ocupar√° a tela inteira e haver√° uma pequena faixa no topo? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° momentos mais dif√≠ceis quando queremos alterar o layout quando o teclado aparece. Por exemplo, organize os bot√µes ou oculte o logotipo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/q3/ia/zl/q3iazltlnajt-cpvdzc0u2i8zcs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Treinamos tantas muletas com um teclado e uma barra de status transparente, agora √© dif√≠cil nos impedir. V√° para StackOverflow e copie o c√≥digo bonito.</font></font><br>
<br>
<pre><code class="kotlin hljs">boolean isOpened = <span class="hljs-literal">false</span>;<font></font>
<font></font>
<span class="hljs-keyword">public</span> void setListenerToRootView() {
    <span class="hljs-keyword">final</span> View activityRootView = getWindow().getDecorView().findViewById(android.R.id.content);<font></font>
    activityRootView.getViewTreeObserver().addOnGlobalLayoutListener(new OnGlobalLayoutListener() {<font></font>
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> void onGlobalLayout() {<font></font>
    <font></font>
            int heightDiff = activityRootView.getRootView().getHeight() - activityRootView.getHeight();      <font></font>
            <span class="hljs-keyword">if</span> (heightDiff &gt; <span class="hljs-number">100</span>) { <span class="hljs-comment">// 99% of the time the height diff will be due to a keyboard.       </span>
                Toast.makeText(getApplicationContext(), <span class="hljs-string">"Gotcha!!! softKeyboardup"</span>, <span class="hljs-number">0</span>).show();<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (isOpened == <span class="hljs-literal">false</span>) {
                   <span class="hljs-comment">//Do two things, make the view top visible and the editText smaller</span><font></font>
                }<font></font>
                isOpened = <span class="hljs-literal">true</span>;<font></font>
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isOpened == <span class="hljs-literal">true</span>) {<font></font>
                Toast.makeText(getApplicationContext(), <span class="hljs-string">"softkeyborad Down!!!"</span>, <span class="hljs-number">0</span>).show();<font></font>
                isOpened = <span class="hljs-literal">false</span>;<font></font>
            }    <font></font>
        }<font></font>
    });<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ele at√© calculou a probabilidade de um teclado aparecer. </font><font style="vertical-align: inherit;">O c√≥digo funciona, em um dos projetos que at√© o usamos, mas por um longo tempo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muitas muletas nos exemplos est√£o associadas ao uso de diferentes atividades. </font><font style="vertical-align: inherit;">Mas s√£o ruins n√£o apenas porque s√£o muletas, mas tamb√©m por outras raz√µes: o problema do ‚Äúarranque a frio‚Äù, assincronia. </font><font style="vertical-align: inherit;">Descrevi os problemas com mais detalhes no artigo " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Licen√ßa para dirigir um carro, ou por que os aplicativos devem ser de atividade √∫nica</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font><font style="vertical-align: inherit;">Al√©m disso, a documenta√ß√£o do Google indica que a abordagem recomendada √© um aplicativo de atividade √∫nica.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que fizemos antes do Android 10</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√≥s (da Redmadrobot) estamos desenvolvendo aplicativos de alta qualidade, mas h√° muito que evitamos inser√ß√µes. Como conseguimos evit√°-los sem muletas grandes e em uma atividade? </font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota. Capturas de tela e c√≥digo retirados do meu projeto de estima√ß√£o, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitFox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Imagine a tela do aplicativo. Quando desenvolvemos nossos aplicativos, nunca pensamos que poderia haver uma barra de navega√ß√£o transparente abaixo. Existe uma barra preta abaixo? Ent√£o, o que os usu√°rios est√£o acostumados? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ce/ab/6v/ceab6v6m5dqnbl9zpotdi1vqmre.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No topo, inicialmente definimos o par√¢metro de que a barra de status √© preta com transpar√™ncia. Como fica em termos de layout e c√≥digo?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0g/tu/of/0gtuoffisoeudtgxlnmqd-jicnk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na figura, abstra√ß√£o: o bloco vermelho √© a atividade do aplicativo, o azul √© um fragmento com um bot de navega√ß√£o (com guias) e dentro dele s√£o trocados fragmentos verdes com conte√∫do. Pode ser visto que a barra de ferramentas n√£o est√° na barra de status. Como conseguimos isso? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Android tem uma bandeira complicada </font></font><code>fitSystemWindow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Se voc√™ configur√°-lo como verdadeiro, o cont√™iner adicionar√° preenchimento a si mesmo, para que nada dentro dele caia na barra de status. Acredito que esta bandeira √© a muleta oficial do Google para quem tem medo de inserir. Usar tudo funcionar√° relativamente bem sem inser√ß√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O sinalizador </font></font><code>FitSystemWindow=‚Äùtrue‚Äù</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adiciona preenchimento ao cont√™iner que voc√™ especificou. Mas a hierarquia √© importante: se um dos pais definir esse sinalizador como "verdadeiro", sua distribui√ß√£o n√£o ser√° levada em considera√ß√£o, porque o cont√™iner j√° aplicou o recuo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A bandeira funciona, mas outro problema aparece. </font><font style="vertical-align: inherit;">Imagine uma tela com duas guias. </font><font style="vertical-align: inherit;">Ao alternar, uma transa√ß√£o √© iniciada, o que causa um </font></font><code>replace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fragmento um no outro e tudo quebra. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lv/02/_u/lv02_ui9sepxlvi7djz_xpem2sy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo fragmento tamb√©m possui um sinalizador definido </font></font><code>FitSystemWindow=‚Äùtrue‚Äù</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, e isso n√£o deve acontecer. </font><font style="vertical-align: inherit;">Mas o que aconteceu, por que? </font><font style="vertical-align: inherit;">A resposta √© que isso √© uma muleta e, √†s vezes, n√£o funciona. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas encontramos uma solu√ß√£o no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stack Overflow</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : use root para n√£o fragmentos </font></font><code>FrameLayout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas </font></font><code>CoordinatorLayout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Foi criado para outros fins, mas funciona aqui.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por que isso funciona?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos ver na fonte o que est√° acontecendo </font></font><code>CoordinatorLayout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> void onAttachedToWindow() {   
    <span class="hljs-keyword">super</span>.onAttachedToWindow();<font></font>
    ...    <font></font>
    <span class="hljs-keyword">if</span> (mLastInsets == <span class="hljs-literal">null</span> &amp;&amp; ViewCompat.getFitsSystemWindows(<span class="hljs-keyword">this</span>)) {         
        <span class="hljs-comment">// We're set to fitSystemWindows but we haven't had any insets yet...</span>
        <span class="hljs-comment">// We should request a new dispatch of window insets</span>
        ViewCompat.requestApplyInsets(<span class="hljs-keyword">this</span>);<font></font>
    }     <font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos um belo coment√°rio de que inser√ß√µes s√£o necess√°rias aqui, mas n√£o s√£o. </font><font style="vertical-align: inherit;">Precisamos pedir novamente quando solicitamos uma janela. </font><font style="vertical-align: inherit;">Descobrimos que as inser√ß√µes funcionam de alguma forma por dentro, mas n√£o queremos trabalhar com elas e sair </font></font><code>Coordinator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na primavera de 2019, desenvolvemos o aplicativo, momento em que o Google I / O acabou de passar. </font><font style="vertical-align: inherit;">Ainda n√£o descobrimos tudo, ent√£o continuamos com o preconceito. </font><font style="vertical-align: inherit;">Mas percebemos que alternar as guias na parte inferior √© de alguma forma lenta, porque temos um layout complexo, carregado com a interface do usu√°rio. </font><font style="vertical-align: inherit;">Encontramos uma maneira simples de resolver isso - mude </font></font><code>replace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para </font></font><code>show/hide</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para que cada vez que voc√™ n√£o recrie o layout.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hx/7l/vz/hx7lvzsl8-kfv3qqac2pbvllt8q.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mudamos e, novamente, nada funciona - tudo quebrou! </font><font style="vertical-align: inherit;">Aparentemente, n√£o √© poss√≠vel espalhar muletas, √© preciso entender por que elas funcionaram. </font><font style="vertical-align: inherit;">Estudamos o c√≥digo e verifica-se que qualquer ViewGroup tamb√©m pode trabalhar com inser√ß√µes.</font></font><br>
<br>
<pre><code class="kotlin hljs">
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> WindowInsets dispatchApplyWindowInsets(WindowInsets insets) {    <font></font>
    insets = <span class="hljs-keyword">super</span>.dispatchApplyWindowInsets(insets);     
    <span class="hljs-keyword">if</span> (!insets.isConsumed()) {         
        <span class="hljs-keyword">final</span> int count = getChildCount();        
        <span class="hljs-keyword">for</span> (int i = <span class="hljs-number">0</span>; i &lt; count; i++) {<font></font>
            insets = getChildAt(i).dispatchApplyWindowInsets(insets);             <font></font>
            <span class="hljs-keyword">if</span> (insets.isConsumed()) {          
                <span class="hljs-keyword">break</span>;<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> insets;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existe uma l√≥gica interna: se pelo menos algu√©m j√° processou inser√ß√µes, todas as Views subseq√ºentes dentro do ViewGroup n√£o as receber√£o. </font><font style="vertical-align: inherit;">O que isso significa para n√≥s? </font><font style="vertical-align: inherit;">Deixe-me mostrar um exemplo do nosso FrameLayout, que alterna as guias. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h1/fo/nn/h1fonnc4qrqpmj_x-fc8m47ptci.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dentro, h√° o primeiro fragmento que tem o sinalizador definido </font></font><code>fitSystemWindow=‚Äùtrue‚Äù</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Isso significa que o primeiro fragmento processa inser√ß√µes. </font><font style="vertical-align: inherit;">Depois disso, chamamos o </font></font><code>HIDE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">primeiro fragmento e o </font></font><code>SHOW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">segundo. </font><font style="vertical-align: inherit;">Mas o primeiro permanece no layout - sua visualiza√ß√£o √© deixada, apenas oculta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O cont√™iner passa por sua Visualiza√ß√£o: pega o primeiro fragmento, fornece inser√ß√µes e a partir dele </font></font><code>fitSystemWindow=‚Äùtrue‚Äù</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ele os pegou e processou. </font><font style="vertical-align: inherit;">Perfeitamente, o FrameLayout parecia que as inser√ß√µes foram processadas e n√£o a deram para o segundo fragmento. </font><font style="vertical-align: inherit;">Tudo funciona como deveria. </font><font style="vertical-align: inherit;">Mas isso n√£o nos conv√©m, o que devemos fazer?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√≥s escrevemos nosso pr√≥prio ViewGroup</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√≥s viemos de Java, e l√° OOP em toda a sua gl√≥ria, ent√£o decidimos herdar. </font><font style="vertical-align: inherit;">N√≥s escrevemos nosso pr√≥prio ViewGroup, a partir do qual redefinimos o m√©todo </font></font><code>dispatchApplyWindowInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Funciona da maneira que precisamos: sempre devolve √†s crian√ßas as inser√ß√µes que vieram, independentemente de process√°-las ou n√£o.</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WindowInsetFrameLayout</span> <span class="hljs-meta">@JvmOverloads</span> <span class="hljs-keyword">constructor</span></span>(<font></font>
    context: Context,      <font></font>
    attrs: AttributeSet? = <span class="hljs-literal">null</span>,     <font></font>
    defStyleRes: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span><font></font>
) : FrameLayout(context, attrs, defStyleRes) {<font></font>
<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dispatchApplyWindowInsets</span><span class="hljs-params">(insets: <span class="hljs-type">WindowInsets</span>)</span></span>: WindowInsets { 
        <span class="hljs-keyword">for</span> (child <span class="hljs-keyword">in</span> (<span class="hljs-number">0</span> until childCount)) {<font></font>
            getChildAt(child).dispatchApplyWindowInsets(insets)<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> insets.consumeSystemWindowInsets()<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O ViewGroup personalizado funciona, o projeto tamb√©m √© tudo o que precisamos. </font><font style="vertical-align: inherit;">Mas ele ainda n√£o chega a uma solu√ß√£o geral. </font><font style="vertical-align: inherit;">Quando descobrimos o que eles nos disseram no Google IO, percebemos que n√£o poder√≠amos mais agir assim.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android 10</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Android 10 nos mostrou dois conceitos importantes da interface do usu√°rio que s√£o estritamente recomendados: borda a borda e navega√ß√£o gestual. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Borda a borda.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Esse </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conceito</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sugere que o conte√∫do do aplicativo deve ocupar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">todo o espa√ßo poss√≠vel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na tela. Para n√≥s, como desenvolvedores, isso significa que os aplicativos devem ser colocados </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nos pain√©is do sistema Barra de status e Barra de navega√ß√£o.</font></font></strong><br>
<br>
<img src="https://habrastorage.org/webt/cr/gl/nh/crglnh9iw__fu4lct0gavaibqey.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Anteriormente, poder√≠amos ignorar isso ou ser colocados apenas sob a barra de status. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quanto √†s listas, elas devem rolar n√£o apenas para o √∫ltimo elemento, mas tamb√©m </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para n√£o permanecer embaixo da Barra de Navega√ß√£o.</font></font></strong><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/tl/pl/it/tlplit1o65rn55edkixuuojxtha.png" width="350"></div><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Navega√ß√£o Gestual. </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este segundo conceito importante √© a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">navega√ß√£o por gestos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Permite controlar o aplicativo com os dedos a partir da borda da tela. </font><font style="vertical-align: inherit;">O modo de gesto n√£o √© padr√£o, tudo parece diferente, mas agora voc√™ n√£o pode alternar entre duas barras de navega√ß√£o diferentes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse momento, percebemos que nem tudo √© t√£o simples. </font><font style="vertical-align: inherit;">N√£o ser√° poss√≠vel evitar ainda mais as inser√ß√µes se quisermos desenvolver aplicativos de qualidade. </font><font style="vertical-align: inherit;">√â hora de estudar a documenta√ß√£o e entender o que s√£o inser√ß√µes.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Insets </font><font style="vertical-align: inherit;">O que voc√™ precisa saber sobre eles?</font></font></h2><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Insets foram criados para assustar os desenvolvedores.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eles est√£o fazendo isso perfeitamente desde o momento em que apareceu no Android 5. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Claro, nem tudo √© t√£o assustador. O conceito de inser√ß√µes √© simples - </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eles relatam uma sobreposi√ß√£o da interface do usu√°rio do sistema na tela do aplicativo.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pode ser uma barra de navega√ß√£o, barra de status ou um teclado. O teclado tamb√©m √© uma interface do usu√°rio regular do sistema, sobreposta √† parte superior do aplicativo. N√£o √© necess√°rio tentar process√°-lo com muletas, apenas inser√ß√µes. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O objetivo das inser√ß√µes √© resolver conflitos</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Por exemplo, se houver outro elemento acima do nosso bot√£o, podemos mov√™-lo para que o usu√°rio possa continuar usando o aplicativo. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para manipular a inser√ß√£o,</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> use </font></font><code>Windowlnsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para o Android 10 e </font></font><code>WindowInsetsCompat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para outras vers√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem </font><strong><font style="vertical-align: inherit;">5 tipos diferentes de inser√ß√µes</font></strong><font style="vertical-align: inherit;"> no Android 10</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e um "b√¥nus", que √© chamado n√£o inserido, mas de outra forma. </font><font style="vertical-align: inherit;">Lidamos com todos os tipos, porque a maioria sabe apenas uma coisa - Inser√ß√µes na janela do sistema.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inser√ß√µes da janela do sistema</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Introduzido no Android 5.0 (API 21). </font><font style="vertical-align: inherit;">Obteve-se pelo m√©todo </font></font><code>getSystemWindowInsets()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse √© o principal tipo de inser√ß√£o com o qual voc√™ precisa aprender a trabalhar, porque o restante funciona da mesma maneira. </font><font style="vertical-align: inherit;">Eles s√£o necess√°rios para processar a barra de status, primeiro e depois a barra de navega√ß√£o e o teclado. </font><font style="vertical-align: inherit;">Por exemplo, eles resolvem um problema quando a barra de navega√ß√£o est√° acima do aplicativo. </font><font style="vertical-align: inherit;">Como na imagem: o bot√£o permaneceu sob a barra de navega√ß√£o, o usu√°rio n√£o pode clicar nele e est√° muito infeliz.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nx/yj/tt/nxyjttdppbkrnrnqkspovzp4hko.png" width="350"></div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inser√ß√µes de elementos ajust√°veis</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apareceu apenas no Android 10. Obtido pelo m√©todo </font></font><code>getTappableElementInsets()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essas inser√ß√µes s√£o √∫teis </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apenas para lidar com v√°rios modos da barra de navega√ß√£o</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Como o pr√≥prio </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chris Bane</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diz </font><font style="vertical-align: inherit;">, voc√™ pode esquecer esse tipo de inser√ß√£o e contornar apenas as inser√ß√µes da janela do sistema. Mas se voc√™ deseja que o aplicativo seja 100% legal, n√£o 99,9% legal, voc√™ deve us√°-lo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Olha a foto. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rl/yd/fk/rlydfkwy39pfrc7jfhizhqdkg0q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No topo, a cor vermelha indica Inser√ß√µes da janela do sistema, que ser√£o exibidas em diferentes modos da barra de navega√ß√£o. Pode-se observar que, √† direita e √† esquerda, s√£o iguais √† barra de navega√ß√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lembre-se de como a navega√ß√£o por gestos funciona: no modo certo, nunca clicamos em um novo painel, mas sempre arrastamos os dedos de baixo para cima. </font><font style="vertical-align: inherit;">Isso significa que os bot√µes n√£o podem ser removidos. </font><font style="vertical-align: inherit;">Podemos continuar pressionando o bot√£o FAB (bot√£o de a√ß√£o flutuante), ningu√©m ir√° interferir. </font><font style="vertical-align: inherit;">Portanto, ele </font></font><code>TappableElementInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ficar√° vazio porque o FAB n√£o √© necess√°rio para se mover. </font><font style="vertical-align: inherit;">Mas se subirmos um pouco mais, tudo bem. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A diferen√ßa aparece apenas na navega√ß√£o por gestos e na barra de navega√ß√£o transparente</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (adapta√ß√£o de cores). </font><font style="vertical-align: inherit;">Esta n√£o √© uma situa√ß√£o muito agrad√°vel. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zv/ei/qz/zveiqz33n9dc290ib9yhrrjl09u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo vai funcionar, mas parece desagrad√°vel. </font><font style="vertical-align: inherit;">O usu√°rio pode ficar confuso com a proximidade dos elementos. </font><font style="vertical-align: inherit;">Pode-se explicar que um √© para gestos e o outro √© para pressionar, mas ainda n√£o √© bonito. </font><font style="vertical-align: inherit;">Portanto, levante o FAB mais alto ou deixe-o √† direita.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inser√ß√µes de gesto do sistema</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apareceu apenas no Android 10. Obtido pelo m√©todo </font></font><code>getSystemGestureInsets()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essas inser√ß√µes est√£o relacionadas √† navega√ß√£o por gestos. Inicialmente, assumiu-se que a interface do usu√°rio do sistema √© desenhada no topo do aplicativo, mas as Inser√ß√µes de gestos do sistema dizem que n√£o √© a interface do usu√°rio que √© desenhada, mas o pr√≥prio sistema lida com os gestos. Eles descrevem onde o sistema manipular√° os gestos por padr√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As √°reas dessas inser√ß√µes s√£o aproximadamente as marcadas em amarelo no diagrama. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vv/8d/jl/vv8djlgxe4cnjchozbllrysagd0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas quero avisar voc√™ - eles nem sempre ser√£o assim. Nunca saberemos quais novas telas a Samsung e outros fabricantes criar√£o. J√° existem dispositivos nos quais a tela est√° em todos os lados. Talvez as inser√ß√µes n√£o estejam onde esperamos. Portanto, voc√™ precisa trabalhar com eles como em alguma abstra√ß√£o: existem inser√ß√µes no System Gesture Insets nas quais o pr√≥prio sistema processa gestos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essas inser√ß√µes podem ser substitu√≠das. </font><font style="vertical-align: inherit;">Por exemplo, voc√™ est√° desenvolvendo um editor de fotos. </font><font style="vertical-align: inherit;">Em alguns lugares, voc√™ mesmo deseja lidar com gestos, mesmo que eles estejam pr√≥ximos √† borda da tela. </font><font style="vertical-align: inherit;">Indique ao sistema que voc√™ processar√° o ponto na tela no canto da foto. </font><font style="vertical-align: inherit;">Isso pode ser redefinido dizendo ao sistema: "Eu sempre processarei o quadrado em torno do ponto."</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inser√ß√µes obrigat√≥rias de gestos no sistema</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apareceu apenas no Android 10. Este √© um subtipo de Inser√ß√µes de gestos do sistema, mas elas n√£o podem ser substitu√≠das pelo aplicativo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usamos o m√©todo </font></font><code>getMandatorySystemGestureInsets()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para determinar a √°rea em que eles n√£o funcionar√£o. </font><font style="vertical-align: inherit;">Isso foi feito intencionalmente, para que fosse imposs√≠vel desenvolver um aplicativo ‚Äúsem esperan√ßa‚Äù: redefina o gesto de navega√ß√£o de baixo para cima, o que permite sair do aplicativo na tela principal. </font><font style="vertical-align: inherit;">Aqui, o </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sistema sempre processa os pr√≥prios gestos</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/89/gl/df/89gldfknoq8z9dje_naytwp0pti.png" width="450"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o necessariamente estar√° na parte inferior do dispositivo e n√£o necessariamente desse tamanho. </font><font style="vertical-align: inherit;">Trabalhe com isso como uma abstra√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esses eram tipos relativamente novos de inser√ß√µes. </font><font style="vertical-align: inherit;">Mas existem aqueles que apareceram antes do Android 5 e foram chamados de forma diferente.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inser√ß√µes est√°veis</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Introduzido com o Android 5.0 (API 21). Obteve-se pelo m√©todo </font></font><code>getStableInsets()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mesmo desenvolvedores experientes nem sempre podem dizer por que s√£o necess√°rios. Vou lhe contar um segredo: essas inser√ß√µes s√£o √∫teis apenas para aplicativos em tela cheia: reprodutores de v√≠deo, jogos. Por exemplo, no modo de reprodu√ß√£o, qualquer interface do usu√°rio do sistema est√° oculta, incluindo a Barra de Status, que se move para al√©m da borda da tela. Mas vale a pena tocar na tela quando a barra de status aparecer na parte superior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ colocar qualquer bot√£o VOLTAR na parte superior da tela e ele processar as Inser√ß√µes da janela do sistema corretamente, a cada guia uma UI aparecer√° na tela de cima e o bot√£o pular√°. Se voc√™ n√£o tocar na tela por um tempo, a barra de status desaparecer√°, o bot√£o saltar√° porque os bot√µes da janela do sistema desapareceram.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para esses casos, os insertos est√°veis ‚Äã‚Äãest√£o certos. </font><font style="vertical-align: inherit;">Eles dizem que agora nenhum elemento √© desenhado no seu aplicativo, mas pode faz√™-lo. </font><font style="vertical-align: inherit;">Com essas inser√ß√µes, voc√™ pode conhecer antecipadamente o valor da barra de status nesse modo, por exemplo, e posicionar o bot√£o onde desejar. </font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota. </font><font style="vertical-align: inherit;">O m√©todo </font></font></em><code><em>getStableInsets()</em></code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apareceu apenas com a API 21. Anteriormente, havia v√°rios m√©todos para cada lado da tela.&nbsp;</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinamos 5 tipos de inser√ß√µes, mas h√° mais uma que n√£o se aplica diretamente √†s inser√ß√µes. </font><font style="vertical-align: inherit;">Ajuda a lidar com franja e recortes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Franjas e decotes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As telas n√£o s√£o mais quadradas. </font><font style="vertical-align: inherit;">Eles s√£o oblongos, com um ou mais recortes para a c√¢mera e franja por todos os lados. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ls/kv/sc/lskvscp_j-hy2gesyynicb346cq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At√© 28 APIs, n√£o conseguimos process√°-las. </font><font style="vertical-align: inherit;">Eu tive que adivinhar atrav√©s do interior o que estava acontecendo l√°. </font><font style="vertical-align: inherit;">Mas com a API 28 e al√©m (do Android anterior), a classe apareceu oficialmente </font></font><code>DisplayCutout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Est√° nas mesmas inser√ß√µes das quais voc√™ pode obter todos os outros tipos. </font><font style="vertical-align: inherit;">A classe permite que voc√™ descubra a localiza√ß√£o e o tamanho dos artefatos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m das informa√ß√µes de localiza√ß√£o, um conjunto de sinalizadores y √© fornecido para o desenvolvedor </font></font><code>WindowManager.LayoutParams</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Eles permitem incluir comportamentos diferentes em torno dos recortes. </font><font style="vertical-align: inherit;">Seu conte√∫do pode ser exibido ao redor deles ou n√£o: nos modos paisagem e retrato de maneiras diferentes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bandeiras</font></font><code>window.attributes.layoutInDisplayCutoutMode =</code><br>
<br>
<ul>
<li><code>LAYOUT_IN_DISPLAY_CUTOUT_MODE_DEFAULT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">No retrato - existe e na paisagem - uma barra preta por padr√£o.</font></font></li>
<li><code>LAYOUT_IN_DISPLAY_CUTOUT_MODE_NEVER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nem um pouco - uma faixa preta.</font></font></li>
<li><code>LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - sempre √©.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A tela pode ser controlada, mas trabalhamos com eles da mesma maneira que com outros Insets.</font></font><br>
<br>
<pre><code class="kotlin hljs">insets.displayCutout<font></font>
    .boundingRects<font></font>
    .forEach { rect -&gt; ... }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A chamada de retorno com inser√ß√µes com uma matriz chega at√© n√≥s </font></font><code>displayCutout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ent√£o podemos execut√°-lo, processar todos os recortes e franjas que est√£o no aplicativo. </font><font style="vertical-align: inherit;">Voc√™ pode aprender mais sobre como trabalhar com eles </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no artigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entendido com 6 tipos de inser√ß√µes. </font><font style="vertical-align: inherit;">Agora vamos falar sobre como isso funciona.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como funciona</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As inser√ß√µes s√£o necess√°rias, antes de tudo, quando algo √© desenhado no topo do aplicativo, por exemplo, a Barra de Navega√ß√£o. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ft/ct/_w/ftct_wh_dc64t9rw6ir_7zpqg8m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sem inser√ß√µes, o aplicativo n√£o ter√° uma barra de navega√ß√£o e uma barra de status transparentes. </font><font style="vertical-align: inherit;">N√£o se surpreenda que voc√™ n√£o vem </font></font><code>SystemWindowInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, isso acontece.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spread insets</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toda a hierarquia da interface do usu√°rio se parece com uma √°rvore com uma visualiza√ß√£o nas extremidades. </font><font style="vertical-align: inherit;">Os n√≥s geralmente s√£o um grupo de exibi√ß√£o. </font><font style="vertical-align: inherit;">Eles tamb√©m herdam do View, de modo que os insets chegam a eles de uma maneira especial </font></font><code>dispatchApplyWindowInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">A partir da visualiza√ß√£o raiz, o sistema envia inser√ß√µes por toda a √°rvore. </font><font style="vertical-align: inherit;">Vamos ver como o View funciona neste caso.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/jy/rw/hk/jyrwhkavrimytpqs4je0ltfn7-w.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O sistema chama o m√©todo </font></font><code>dispatchApplyWindowInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pelo qual as inser√ß√µes entram. </font><font style="vertical-align: inherit;">Voltar a este modo de exibi√ß√£o deve retornar algo </font><font style="vertical-align: inherit;">O que fazer para lidar com esse comportamento? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para simplificar, consideramos apenas o WindowInsets.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manipula√ß√£o de inser√ß√µes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de tudo, a redefini√ß√£o do m√©todo </font></font><code>dispatchApplyWindowInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e implementa√ß√£o dentro de sua pr√≥pria l√≥gica </font><font style="vertical-align: inherit;">parece l√≥gica </font><font style="vertical-align: inherit;">: inser√ß√µes vieram, implementamos tudo dentro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ abrir a classe View e observar o Javadoc escrito sobre esse m√©todo, poder√° ver: ‚ÄúN√£o substitua esse m√©todo!‚Äù</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lidamos com Insets por meio de delega√ß√£o ou heran√ßa.</font></font></blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Use delega√ß√£o</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">O Google ofereceu a oportunidade de expor seu pr√≥prio delegado, respons√°vel por lidar com inser√ß√µes. </font><font style="vertical-align: inherit;">Voc√™ pode instal√°-lo atrav√©s do m√©todo </font></font><code>setOnApplyWindowInsetsListener(listener)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Definimos um retorno de chamada que lida com essas inser√ß√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se, por algum motivo, isso n√£o nos conv√©m, voc√™ pode </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">herdar do View e substituir outro m√©todo</font></font></strong> <code>onApplyWindowInsets(WindowInsets insets)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">N√≥s substitu√≠mos nossas pr√≥prias inser√ß√µes nele. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Google n√£o escolheu entre delega√ß√£o e heran√ßa, mas permitiu fazer tudo juntos. </font><font style="vertical-align: inherit;">Isso √© √≥timo porque n√£o precisamos redefinir toda a barra de ferramentas ou o ListView para lidar com inser√ß√µes. </font><font style="vertical-align: inherit;">Podemos pegar qualquer Visualiza√ß√£o pronta, mesmo uma biblioteca, e definir o delegado l√°, que manipular√° inser√ß√µes sem redefini√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que devemos retornar?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por que devolver alguma coisa?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para fazer isso, voc√™ precisa entender como a distribui√ß√£o de inser√ß√µes, ou seja, ViewGroup, funciona. </font><font style="vertical-align: inherit;">O que ela est√° fazendo dentro de si mesma. </font><font style="vertical-align: inherit;">Vamos dar uma olhada no comportamento padr√£o usando o exemplo que mostrei anteriormente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As inser√ß√µes do sistema vieram na parte superior e inferior, por exemplo, 100 pixels cada. </font><font style="vertical-align: inherit;">O ViewGroup os envia para a primeira visualiza√ß√£o que possui. </font><font style="vertical-align: inherit;">Este modo de exibi√ß√£o os manipulou de algum modo e retorna inser√ß√µes: no topo ele diminui para 0, mas no fundo ele sai. </font><font style="vertical-align: inherit;">No topo, ela acrescentou preenchimento ou margem, mas no fundo ela n√£o tocou e relatou isso. </font><font style="vertical-align: inherit;">Em seguida, o ViewGroup passa inser√ß√µes para a segunda View. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tj/-a/rw/tj-arwxjkus-n6xnvl099lqbqqg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pr√≥xima exibi√ß√£o processa e renderiza inser√ß√µes. </font><font style="vertical-align: inherit;">Agora o ViewGroup v√™ que as inser√ß√µes s√£o processadas acima e abaixo - n√£o resta mais nada, todos os par√¢metros s√£o zero. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A terceira vis√£o nem sabe que havia algumas inser√ß√µes e algo estava acontecendo</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">O ViewGroup retornar√° inser√ß√µes de volta para quem as exp√¥s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando come√ßamos a lidar com esse t√≥pico, escrevemos a id√©ia para n√≥s mesmos - sempre retornamos os mesmos detalhes que vieram. </font><font style="vertical-align: inherit;">Quer√≠amos evitar essa situa√ß√£o quando algum View nem reconhecia que havia inser√ß√µes. </font><font style="vertical-align: inherit;">A ideia parecia l√≥gica. </font><font style="vertical-align: inherit;">Mas acabou que n√£o. </font><font style="vertical-align: inherit;">O Google n√£o adicionou em v√£o nenhum comportamento √†s inser√ß√µes, como no exemplo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso √© necess√°rio para que as inser√ß√µes sempre atinjam toda a hierarquia da Visualiza√ß√£o e voc√™ sempre possa trabalhar com elas. </font><font style="vertical-align: inherit;">Nesse caso, n√£o haver√° situa√ß√£o quando trocarmos dois fragmentos, um foi processado e o segundo ainda n√£o recebido. </font><font style="vertical-align: inherit;">Na se√ß√£o pr√°tica, retornaremos a esse ponto.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pr√°tica</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Teoria √© feita. </font><font style="vertical-align: inherit;">Vamos ver como fica o c√≥digo, porque, em teoria, tudo √© sempre tranquilo. </font><font style="vertical-align: inherit;">Vamos usar o AndroidX. </font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota. </font><font style="vertical-align: inherit;">No </font></font></em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitFox,</font></font></em></a><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tudo j√° est√° implementado no c√≥digo, suporte completo para todos os presentes do novo Android. </font><font style="vertical-align: inherit;">Para n√£o verificar as vers√µes do Android e n√£o procurar o tipo de Insets necess√°rio, sempre use a </font></font></em><code><em>view.setOnApplyWindowInsetsListener { v, insets -&gt; ... }</em></code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vers√£o do AndroidX </font></font></em><code><em>ViewCompat.setOnApplyWindowInsetsListener(view) { v, insets -&gt; ... }</em></code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° uma tela com uma barra de navega√ß√£o escura. </font><font style="vertical-align: inherit;">N√£o sobrep√µe nenhum elemento na parte superior. </font><font style="vertical-align: inherit;">Tudo √© do jeito que estamos acostumados.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/3r/wq/sp/3rwqspgcdlgie2m00lmedkwzgi8.png" width="350"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas acontece que agora precisamos torn√°-lo transparente. </font><font style="vertical-align: inherit;">Qu√£o?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ativar transpar√™ncia</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mais simples √© indicar no assunto que a barra de status e a barra de navega√ß√£o s√£o transparentes.</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;style name=<span class="hljs-string">"AppTheme"</span> parent=<span class="hljs-string">"Theme.MaterialComponents.Light"</span>&gt;<font></font>
    &lt;item name=<span class="hljs-string">"android:windowTranslucentStatus"</span>&gt;<span class="hljs-literal">true</span>&lt;/item&gt;<font></font>
    &lt;item name=<span class="hljs-string">"android:windowTranslucentNavigation"</span>&gt;<span class="hljs-literal">true</span>&lt;/item&gt;<font></font>
&lt;/style&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse momento, tudo come√ßa a se sobrepor, tanto de cima como de baixo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Curiosamente, existem dois sinalizadores e sempre h√° tr√™s op√ß√µes: se voc√™ especificar transpar√™ncia para a barra de navega√ß√£o, a barra de status ficar√° transparente por si s√≥ - uma limita√ß√£o. </font><font style="vertical-align: inherit;">Voc√™ n√£o pode escrever a primeira linha, mas eu sempre adoro a clareza, por isso escrevo duas linhas para que os seguidores possam entender o que est√° acontecendo e n√£o cavar por dentro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ escolher esse m√©todo, a barra de navega√ß√£o e a barra de status ficar√£o pretas com transpar√™ncia. </font><font style="vertical-align: inherit;">Se o aplicativo for branco, voc√™ poder√° adicionar cores apenas a partir do c√≥digo. </font><font style="vertical-align: inherit;">Como fazer isso?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ative a transpar√™ncia com cores</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â bom termos um aplicativo de atividade √∫nica, por isso colocamos dois sinalizadores em uma atividade.</font></font><br>
<br>
<pre><code class="kotlin hljs">rootView.systemUiVisibility = View.SYSTEM_UI_FLAG_LAYOUT_STABLE or  <font></font>
    View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION<font></font>
<font></font>
&lt;style name=<span class="hljs-string">"AppTheme"</span> parent=<span class="hljs-string">"Theme.MaterialComponents.Light"</span>&gt;<font></font>
    &lt;!-- Set the navigation bar to <span class="hljs-number">50</span>% translucent white --&gt;<font></font>
    &lt;item name=<span class="hljs-string">"android:navigationBarColor"</span>&gt;#<span class="hljs-number">80F</span>FFFFF&lt;/item&gt; <font></font>
&lt;/style&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem muitos sinalizadores l√°, mas s√£o esses dois que ajudar√£o a tornar a transpar√™ncia na barra de navega√ß√£o e na barra de status. </font><font style="vertical-align: inherit;">A cor pode ser especificada atrav√©s do tema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse √© o comportamento estranho do Android: algo atrav√©s do tema e algo atrav√©s das bandeiras. </font><font style="vertical-align: inherit;">Mas podemos especificar par√¢metros no c√≥digo e no assunto. </font><font style="vertical-align: inherit;">Esse Android n√£o √© t√£o ruim assim, apenas nas vers√µes mais antigas do Android o sinalizador especificado no t√≥pico ser√° ignorado. </font></font><code>navigationBarColor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ele destacar√° que no Android 5 isso n√£o √© verdade, mas tudo vai se unir. </font><font style="vertical-align: inherit;">No GitFox, foi a partir do c√≥digo que defini a cor da barra de navega√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fizemos fraudes - indicamos que a barra de navega√ß√£o √© branca com transpar√™ncia. </font><font style="vertical-align: inherit;">Agora, o aplicativo fica assim.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/eo/vs/mz/eovsmz1tczlc9vl_kg2yihxs0u0.png" width="350"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que poderia ser mais f√°cil do que lidar com inser√ß√µes?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De fato, elementar.</font></font><br>
<br>
<pre><code class="kotlin hljs">ViewCompat<font></font>
    .setOnApplyWindowInsetsListener(bottomNav) { view, insets -&gt;  <font></font>
        view.updatePadding(bottom = insets.systemWindowInsetBottom) <font></font>
        insets<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pegamos o m√©todo </font></font><code>setOnApplyWindowInsetsListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e o passamos para ele </font></font><code>bottomNav</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dizemos que, quando as inser√ß√µes chegarem, instale o preenchimento inferior que entrou </font></font><code>systemWindowInsetBottom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Queremos isso por baixo, mas todos os nossos elementos clic√°veis ‚Äã‚Äãest√£o no topo. </font><font style="vertical-align: inherit;">Retornamos totalmente inser√ß√µes para que todas as outras visualiza√ß√µes em nossa hierarquia tamb√©m as recebam. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo parece √≥timo.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zl/8e/ku/zl8ekuc_pvpc2wrmeop-khxmomg.png" width="350"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas h√° um por√©m. </font><font style="vertical-align: inherit;">Se no layout indicamos algum tipo de preenchimento na barra de navega√ß√£o abaixo, ent√£o aqui foi exclu√≠do - definir </font></font><code>updatePadding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inser√ß√µes iguais. </font><font style="vertical-align: inherit;">Nosso layout n√£o parece como gostar√≠amos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para salvar os valores do layout, voc√™ deve primeiro salvar o que est√° no preenchimento inferior. </font><font style="vertical-align: inherit;">Mais tarde, quando inser√ß√µes chegarem, adicione e defina os valores resultantes.</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">val</span> bottomNavBottomPadding = bottomNav.paddingBottom<font></font>
ViewCompat<font></font>
    .setOnApplyWindowInsetsListener(bottomNav) { view, insets -&gt;                 <font></font>
        view.updatePadding(<font></font>
        bottom = bottomNavBottomPadding + insets.systemWindowInsetBottom<font></font>
    )<font></font>
    Insets<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â inconveniente escrever desta maneira: em todo o c√≥digo em que voc√™ usa inser√ß√µes, √© necess√°rio salvar o valor do layout e adicion√°-lo √† interface do usu√°rio. </font><font style="vertical-align: inherit;">Mas existe o Kotlin, e isso √© maravilhoso - voc√™ pode escrever sua pr√≥pria extens√£o, o que far√° tudo isso por n√≥s.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicione Kotlin!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lembramos </font></font><code>initialPadding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e entregamos ao manipulador quando novas inser√ß√µes v√™m (junto com elas). </font><font style="vertical-align: inherit;">Isso os ajudar√° de alguma forma a se juntar ou a construir algum tipo de l√≥gica de cima.</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword">fun</span> View.<span class="hljs-title">doOnApplyWindowInsets</span><span class="hljs-params">(block: (<span class="hljs-type">View</span>, <span class="hljs-type">WindowInsetsCompat</span>, <span class="hljs-type">Rect</span>) -&gt; <span class="hljs-type">WindowInsetsCompat</span>)</span></span> {    <font></font>
<font></font>
    <span class="hljs-keyword">val</span> initialPadding = recordInitialPaddingForView(<span class="hljs-keyword">this</span>)<font></font>
<font></font>
    ViewCompat.setOnApplyWindowInsetsListener(<span class="hljs-keyword">this</span>) { v, insets -&gt;        <font></font>
        block(v, insets, initialPadding)<font></font>
    }<font></font>
    <font></font>
    requestApplyInsetsWhenAttached()<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">recordInitialPaddingForView</span><span class="hljs-params">(view: <span class="hljs-type">View</span>)</span></span> =<font></font>
   Rect(view.paddingLeft, view.paddingTop, view.paddingRight, view.paddingBottom)<font></font>
<font></font>
  .<font></font>
<font></font>
bottomNav.doOnApplyWindowInsets { view, insets, padding -&gt;   <font></font>
    view.updatePadding(<font></font>
        bottom = padding.bottom + insets.systemWindowInsetBottom<font></font>
    ) <font></font>
    insets<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Temos que redefinir a lambda. </font><font style="vertical-align: inherit;">Possui n√£o apenas inser√ß√µes, mas tamb√©m almofadas. </font><font style="vertical-align: inherit;">Podemos adicion√°-los n√£o apenas de baixo, mas tamb√©m de cima, se for uma barra de ferramentas que processa a barra de status.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algo esquecido!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° uma chamada para um m√©todo incompreens√≠vel.</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword">fun</span> View.<span class="hljs-title">doOnApplyWindowInsets</span><span class="hljs-params">(block: (<span class="hljs-type">View</span>, <span class="hljs-type">WindowInsetsCompat</span>, <span class="hljs-type">Rect</span>) -&gt; <span class="hljs-type">WindowInsetsCompat</span>)</span></span> {<font></font>
<font></font>
    <span class="hljs-keyword">val</span> initialPadding = recordInitialPaddingForView(<span class="hljs-keyword">this</span>)<font></font>
     <font></font>
    ViewCompat.setOnApplyWindowInsetsListener(<span class="hljs-keyword">this</span>) { v, insets -&gt;        <font></font>
        block(v, insets, initialPadding)<font></font>
    }<font></font>
      <font></font>
    requestApplyInsetsWhenAttached() <font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">recordInitialPaddingForView</span><span class="hljs-params">(view: <span class="hljs-type">View</span>)</span></span> =<font></font>
      Rect(view.paddingLeft, view.paddingTop, view.paddingRight, view.paddingBottom)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso se deve ao fato de que voc√™ n√£o pode apenas esperar que o sistema lhe envie inser√ß√µes. </font><font style="vertical-align: inherit;">Se criarmos uma View a partir do c√≥digo ou instalarmos um </font></font><code>InsetsListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pouco mais tarde, o pr√≥prio sistema poder√° n√£o passar o √∫ltimo valor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Devemos verificar se, quando a tela est√° na tela, informamos ao sistema: "Chegaram as inser√ß√µes, queremos process√°-las". </font><font style="vertical-align: inherit;">Definimos o ouvinte e devemos fazer uma solicita√ß√£o </font></font><code>requestsApplyInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">".</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword">fun</span> View.<span class="hljs-title">requestApplyInsetsWhenAttached</span><span class="hljs-params">()</span></span> {    
    <span class="hljs-keyword">if</span> (isAttachedToWindow) {        <font></font>
        requestApplyInsets()<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        addOnAttachStateChangeListener(<span class="hljs-keyword">object</span> : View.OnAttachStateChangeListener {            
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onViewAttachedToWindow</span><span class="hljs-params">(v: <span class="hljs-type">View</span>)</span></span> {<font></font>
                v.removeOnAttachStateChangeListener(<span class="hljs-keyword">this</span>)<font></font>
                v.requestApplyInsets()           <font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onViewDetachedFromWindow</span><span class="hljs-params">(v: <span class="hljs-type">View</span>)</span></span> = <span class="hljs-built_in">Unit</span><font></font>
        })<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se criamos um c√≥digo de exibi√ß√£o e ainda n√£o o anexamos ao nosso layout, devemos assinar o hor√°rio em que o fazemos. </font><font style="vertical-align: inherit;">Somente ent√£o solicitamos inser√ß√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas, novamente, h√° Kotlin: eles escreveram uma extens√£o simples e n√£o precisamos mais pensar nisso.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Refinando o RecyclerView</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos falar sobre a finaliza√ß√£o do RecyclerView. O √∫ltimo elemento cai sob a barra de navega√ß√£o e permanece abaixo - feio. Tamb√©m √© inconveniente clicar nele. Se este n√£o √© um painel novo, mas o antigo, um grande, geralmente o elemento inteiro pode desaparecer sob ele. O que fazer? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jc/qa/f7/jcqaf7okahkrhrrnols54exqhdu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A primeira id√©ia √© adicionar um elemento abaixo e definir a altura para ajustar as inser√ß√µes. Mas se tivermos um aplicativo com centenas de listas, de alguma forma teremos que assinar cada lista para inserir, adicionar um novo elemento l√° e definir a altura. Al√©m disso, o RecyclerView √© ass√≠ncrono, n√£o se sabe quando funcionar√°. Existem muitos problemas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas h√° outro truque oficial. Surpreendentemente, ele funciona com efici√™ncia.</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;androidx.recyclerview.widget.RecyclerView <font></font>
        android:id=<span class="hljs-string">"@+id/recyclerView"</span>        
    android:layout_width=<span class="hljs-string">"match_parent"</span>    
    android:layout_height=<span class="hljs-string">"match_parent"</span>             
    android:clipToPadding=<span class="hljs-string">"false"</span> /&gt;<font></font>
<font></font>
recyclerView.doOnApplyWindowInsets { view, insets, padding -&gt;    <font></font>
    view.updatePadding(<font></font>
        bottom = padding.bottom + insets.systemWindowInsetBottom<font></font>
    )<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existe uma bandeira no layout </font></font><code>clipToPadding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Por padr√£o, √© sempre verdade. Isso sugere que voc√™ n√£o precisa desenhar elementos que apare√ßam onde o preenchimento est√° exposto. Mas se definido </font></font><code>clipToPadding="false"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, voc√™ pode desenhar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, se voc√™ definir o preenchimento na parte inferior, no RecyclerView funcionar√° assim: o preenchimento ser√° definido na parte inferior e o elemento ser√° desenhado em cima dele at√© rolar. Quando chegar ao fim, o RecyclerView rolar√° os elementos para a posi√ß√£o que precisamos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao definir um desses sinalizadores, podemos trabalhar com o RecyclerView como em um modo de exibi√ß√£o normal. N√£o pense que existem elementos que rolam - basta definir o preenchimento abaixo, como, por exemplo, na barra de navega√ß√£o inferior.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora sempre retornamos inser√ß√µes como se n√£o fossem processadas. </font><font style="vertical-align: inherit;">As inser√ß√µes inteiras chegaram at√© n√≥s, fizemos algo com elas, ajustamos os forros e devolvemos todas as inser√ß√µes inteiras novamente. </font><font style="vertical-align: inherit;">Isso √© necess√°rio para que qualquer ViewGroup sempre passe essas inser√ß√µes para todas as View. </font><font style="vertical-align: inherit;">Funciona.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bug do aplicativo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em muitos aplicativos no Google Play que j√° processaram inser√ß√µes, notei um pequeno bug. Agora vou falar sobre ele. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° uma tela com navega√ß√£o no por√£o. √Ä direita est√° a mesma tela que mostra a hierarquia. O fragmento verde exibe o conte√∫do na tela, dentro dele tem um RecyclerView. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hl/e6/jo/hle6jod0ws19fydq734lqnuaixu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quem lidou com as inser√ß√µes aqui? Barra de ferramentas: ele aplicou o preenchimento na parte superior para que seu conte√∫do se mova sob a barra de status. Consequentemente, a barra de navega√ß√£o inferior aplicava inser√ß√µes de baixo e subia acima da barra de navega√ß√£o. Mas o RecyclerView n√£o manipula inser√ß√µes de forma alguma, n√£o se enquadra nelas, n√£o precisa processar inser√ß√µes - tudo √© feito corretamente.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/r3/xc/qi/r3xcqipovgqu-zbbxruxsy-wqvk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas aqui acontece que queremos usar o fragmento verde RecyclerView em outro local onde a barra de navega√ß√£o inferior n√£o est√° mais l√°. Neste ponto, o RecyclerView j√° est√° come√ßando a lidar com inser√ß√µes a partir de baixo. Precisamos aplicar preenchimento a ele para rolar adequadamente sob a barra de navega√ß√£o. Portanto, no RecyclerView, tamb√©m adicionamos processamento de inser√ß√µes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ve/ws/m-/vewsm-_o80cw7mbn9tyk0bu_mfs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voltamos √† nossa tela, onde todos processam inser√ß√µes. Lembre-se, ningu√©m relata que ele os processou? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/um/vd/x8/umvdx8faxxk48r-inx-cxhkjqdm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos esta situa√ß√£o: O RecyclerView processou inser√ß√µes a partir de baixo, embora n√£o atinja a barra de navega√ß√£o - um espa√ßo apareceu na parte inferior. Notei isso em aplicativos, e bastante grande e popular.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/i9/3_/ar/i93_arxauyvbitayfpyonkxnudy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se for esse o caso, lembramos que retornamos todas as inser√ß√µes para processar. Ent√£o (acontece!) √â necess√°rio relatar que as inser√ß√µes s√£o processadas: A Barra de Navega√ß√£o deve relatar que as inser√ß√µes foram processadas. Eles n√£o devem acessar o RecyclerView. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jf/r2/vi/jfr2vi8jpsas_ptxjjqh_qhg1vk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para fazer isso, instale a barra de navega√ß√£o inferior </font></font><code>InsetsListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Subtraia dentro </font></font><code>bottom + insets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que eles n√£o s√£o processados, retorne 0.</font></font><br>
<br>
<pre><code class="kotlin hljs">doOnApplyWindowInsets { view, insets, initialPadding -&gt;    <font></font>
    view.updatePadding(<font></font>
        bottom = initialPadding.bottom + insets.systemWindowInsetBottom<font></font>
    )<font></font>
    insets.replaceSystemWindowInsets(<font></font>
        Rect(<font></font>
            insets.systemWindowInsetLeft,            <font></font>
            insets.systemWindowInsetTop,            <font></font>
            insets.systemWindowInsetRight,<font></font>
            <span class="hljs-number">0</span><font></font>
        )<font></font>
    )<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Retornamos novas inser√ß√µes, nas quais todos os par√¢metros antigos s√£o iguais, mas </font></font><code>bottom + insets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iguais a 0. Parece que est√° tudo bem. </font><font style="vertical-align: inherit;">Come√ßamos repetidamente sem sentido - o RecyclerView ainda lida com inser√ß√µes por algum motivo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lp/yw/ut/lpywut3fvlk5w-nwbd3-wnrceaw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o entendi imediatamente que o problema √© que o cont√™iner para esses tr√™s modos de exibi√ß√£o √© LinearLayout. </font><font style="vertical-align: inherit;">Dentro deles, h√° uma barra de ferramentas, um trecho com um RecyclerView e na parte inferior da barra de navega√ß√£o inferior. </font><font style="vertical-align: inherit;">O LinearLayout coloca seus filhos em ordem e aplica inser√ß√µes neles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acontece que a barra de navega√ß√£o inferior ser√° a √∫ltima. </font><font style="vertical-align: inherit;">Ele disse a algu√©m que processou todas as inser√ß√µes, mas era tarde demais. </font><font style="vertical-align: inherit;">Todas as inser√ß√µes foram processadas de cima para baixo, o RecyclerView j√° as recebeu e isso n√£o nos salva. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uj/mm/jd/ujmmjdgumv0bl6e0ewydx7ueq5g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que fazer? </font><font style="vertical-align: inherit;">O LinearLayout n√£o funciona da maneira que eu quero, ele os transfere de cima para baixo e preciso obter o primeiro.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redefinir tudo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O desenvolvedor Java jogou em mim - </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tudo</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> precisa ser </font><strong><font style="vertical-align: inherit;">redefinido</font></strong><font style="vertical-align: inherit;"> ! </font><font style="vertical-align: inherit;">Bem, agora </font></font><code>dispatchApplyWindowInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">redefina, defina </font></font><code>yLinearLayout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que sempre passar√° de baixo para cima. </font><font style="vertical-align: inherit;">Ele primeiro envia inser√ß√µes da barra de navega√ß√£o inferior e depois para todos os outros.</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> WindowInsets dispatchApplyWindowInsets(WindowInsets insets) {     <font></font>
    insets = <span class="hljs-keyword">super</span>.dispatchApplyWindowInsets(insets);     
    <span class="hljs-keyword">if</span> (!insets.isConsumed()) {        
        <span class="hljs-keyword">final</span> int count = getChildCount();
        <span class="hljs-keyword">for</span> (int i = <span class="hljs-number">0</span>; i &lt; count; i++) {<font></font>
            insets = getChildAt(i).dispatchApplyWindowInsets(insets);<font></font>
            <span class="hljs-keyword">if</span> (insets.isConsumed()) {
                <span class="hljs-keyword">break</span>;<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> insets;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas parei a tempo, lembrando do coment√°rio de que n√£o havia necessidade de redefinir esse m√©todo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, um pouco maior √© a salva√ß√£o: o ViewGroup verifica se h√° um delegado que processa as inser√ß√µes, depois chama o super m√©todo no View e ativa seu pr√≥prio processamento. </font><font style="vertical-align: inherit;">Nesse c√≥digo, obtemos inser√ß√µes e, se ainda n√£o foram processadas, iniciamos a l√≥gica padr√£o para nossos filhos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu escrevi uma extens√£o simples. </font><font style="vertical-align: inherit;">Permite, aplicando </font></font><code>InsetsListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a uma Visualiza√ß√£o, dizer a quem essas inser√ß√µes passam.</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword">fun</span> View.<span class="hljs-title">addSystemBottomPadding</span><span class="hljs-params">(    
    targetView: <span class="hljs-type">View</span> = this
)</span></span> {<font></font>
    doOnApplyWindowInsets { _, insets, initialPadding -&gt;           <font></font>
        targetView.updatePadding(<font></font>
            bottom = initialPadding.bottom + insets.systemWindowInsetBottom<font></font>
        )<font></font>
        insets.replaceSystemWindowInsets(<font></font>
            Rect(<font></font>
                insets.systemWindowInsetLeft,<font></font>
                insets.systemWindowInsetTop,     <font></font>
                insets.systemWindowInsetRight,<font></font>
                <span class="hljs-number">0</span><font></font>
            )<font></font>
        )<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, </font></font><code>targetView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">por padr√£o </font><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">√© igual √† mesma visualiza√ß√£o na qual aplicamos </font></font><code>addSystemBottomPadding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">N√≥s podemos redefinir isso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No meu LinearLayout, pendurei um manipulador, passando como </font></font><code>targetView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- esta √© minha barra de navega√ß√£o inferior.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeiro ele dar√° inser√ß√µes na barra de navega√ß√£o inferior.&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso processar√° inser√ß√µes, retornar√° zero ao fundo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, por padr√£o, eles v√£o de cima para baixo: Barra de ferramentas, fragmenta com o RecyclerView.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ent√£o, talvez, ele volte a enviar inser√ß√µes na barra de navega√ß√£o inferior. </font><font style="vertical-align: inherit;">Mas isso n√£o √© mais importante, tudo funcionar√° t√£o bem.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consegui exatamente o que queria: todas as inser√ß√µes s√£o processadas na ordem em que s√£o necess√°rias.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/s3/b0/nc/s3b0nc07bayude3nvrvevkxnwyc.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Importante</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algumas coisas importantes a ter em mente. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O teclado √© a interface do usu√°rio do sistema na parte superior do seu aplicativo.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> N√£o h√° necessidade de trat√°-la de uma maneira especial. Se voc√™ olhar para o teclado do Google, n√£o √© apenas um Layout com bot√µes nos quais voc√™ pode clicar. Existem centenas de modos para este teclado: pesquisando gifs e memes, entrada de voz, redimensionando de 10 pixels de altura para tamanhos de tela. N√£o pense no teclado, mas assine inser√ß√µes. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A gaveta de navega√ß√£o ainda n√£o suporta a navega√ß√£o por gestos</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">No Google IO, eles prometeram que tudo daria certo. </font><font style="vertical-align: inherit;">Mas no Android 10, o Navigation Drawer ainda n√£o suporta isso. </font><font style="vertical-align: inherit;">Se voc√™ atualizar para o Android 10 e ativar a navega√ß√£o com gestos, o Navigation Drawer cair√°. </font><font style="vertical-align: inherit;">Agora voc√™ precisa clicar no menu do hamb√∫rguer para que ele apare√ßa, ou uma combina√ß√£o de circunst√¢ncias aleat√≥rias permite estic√°-lo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na vers√£o pr√©-alfa do Android, o Navigation Drawer funciona, mas n√£o me atrevi a atualizar - isso √© pr√©-alfa. </font><font style="vertical-align: inherit;">Portanto, mesmo se voc√™ instalar a vers√£o mais recente do GitFox a partir do reposit√≥rio, existe uma Gaveta de Navega√ß√£o, mas ela n√£o pode ser extra√≠da. </font><font style="vertical-align: inherit;">Assim que o suporte oficial for lan√ßado, eu atualizarei e tudo funcionar√° bem.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lista de verifica√ß√£o de prepara√ß√£o do Android 10</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Defina a transpar√™ncia da barra de navega√ß√£o e da barra de status desde o in√≠cio do projeto</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . O Google recomenda enfaticamente a manuten√ß√£o de uma barra de navega√ß√£o transparente. Para n√≥s, essa √© uma parte pr√°tica importante. Se o projeto funcionar, mas voc√™ n√£o o ativou, escolha a hora de oferecer suporte ao Android 10. Ligue-o primeiro no assunto, como transl√∫cido, e corrija o layout onde ele quebrou. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicione extens√µes ao Kotlin</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - √© mais f√°cil com elas. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicione a toda a barra de ferramentas em cima do preenchimento.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> As barras de ferramentas est√£o sempre no topo, e √© isso que voc√™ precisa fazer. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para todos os RecyclerViews, adicione preenchimento na parte inferior</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e a capacidade de rolar </font></font><code>clipToPadding="false"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pense em todos os bot√µes nas bordas da tela </font></font></strong><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(FAB)</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Os FABs provavelmente n√£o estar√£o onde voc√™ espera.</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o substitua ou fa√ßa suas pr√≥prias implementa√ß√µes para todos os LinearLayout</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e outros casos semelhantes. Fa√ßa o truque, como no GitFox, ou use minha extens√£o pronta para ajudar. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verifique os gestos nas bordas da tela para ver a exibi√ß√£o personalizada</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . A Gaveta de Navega√ß√£o n√£o suporta isso. Mas n√£o √© t√£o dif√≠cil apoi√°-lo com as m√£os, redefinir inser√ß√µes para gestos na tela com a Gaveta de Navega√ß√£o. Talvez voc√™ tenha editores de imagens em que os gestos funcionam. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A rolagem no ViewPager n√£o funciona a partir da borda, mas apenas do centro para a direita e esquerda</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . O Google diz que isso √© normal. Se voc√™ puxar o ViewPager pela borda, ele ser√° percebido como pressionando o bot√£o "Voltar". </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em um novo projeto, inclua imediatamente toda a transpar√™ncia</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Voc√™ pode dizer aos designers que n√£o possui uma barra de navega√ß√£o e uma barra de status. </font><font style="vertical-align: inherit;">O quadrado inteiro √© o conte√∫do do seu aplicativo. </font><font style="vertical-align: inherit;">E os desenvolvedores j√° descobrir√£o onde e o que criar. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Links √öteis:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@rmr_spb em um telegrama - registros de mitaps internos do Redmadrobot SPb.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todo o c√≥digo-fonte deste artigo e ainda mais no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitFox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">H√° um ramo separado do Android 10, onde voc√™ pode ver por confirmar como cheguei a tudo isso e como apoiei o novo Android.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Biblioteca Insetter de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Chris Bane. </font><font style="vertical-align: inherit;">Ele cont√©m 5-6 extens√µes que mostrei. </font><font style="vertical-align: inherit;">Para usar no seu projeto, entre em contato com a biblioteca, provavelmente ela ser√° movida para o Android Jetpack. </font><font style="vertical-align: inherit;">Eu os desenvolvi no meu projeto e, ao que me parece, eles melhoraram.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artigo de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Chris Bane.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>   FunCorn,    ,      .</li>
<li> ¬´<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Why would I want to fitsSystemWindows?</a>¬ª  .</li>
</ul><br>
<blockquote>    AppConf,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">youtube-</a>      .            ,     - .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">AppsConf</a>     ,            .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>, stay tuned!</blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt488160/index.html">Windows Server 2019 vs. Instant√¢neos VMware com desativa√ß√£o: uma solu√ß√£o elegante para o problema</a></li>
<li><a href="../pt488162/index.html">Quanto maior a classifica√ß√£o, mais dinheiro e vice-versa</a></li>
<li><a href="../pt488164/index.html">Batalha da SEC contra o Telegram</a></li>
<li><a href="../pt488190/index.html">Mais uma vez sobre esgotamento emocional</a></li>
<li><a href="../pt488194/index.html">Por que estamos escrevendo programas de t√£o baixa qualidade?</a></li>
<li><a href="../pt488198/index.html">Do que os Timlids t√™m medo e por que deveriam parar de fazer isso</a></li>
<li><a href="../pt488200/index.html">O debate sobre a primeira linguagem de programa√ß√£o: a decis√£o final</a></li>
<li><a href="../pt488202/index.html">Agora, o PVS-Studio est√° no Chocolatey: verificando o Chocolatey no Azure DevOps</a></li>
<li><a href="../pt488208/index.html">Anivers√°rio DUMP2020 - 4 dias que voc√™ n√£o esquecer√°</a></li>
<li><a href="../pt488210/index.html">Reconhecendo objetos no Android usando o TensorFlow: da prepara√ß√£o de dados ao lan√ßamento no dispositivo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>