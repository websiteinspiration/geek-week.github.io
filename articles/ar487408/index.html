<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ•§ ğŸ…ğŸ¿ ğŸ¥– Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ù†ÙŠØ© ØªØ­ØªÙŠØ© Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªØªØ­Ù…Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡. Ø§Ù„Ø¬Ø²Ø¡ 3. ØªÙ†Ø¸ÙŠÙ… Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¹Ù„Ù‰ Ø£Ø¬Ù‡Ø²Ø© ØªÙˆØ¬ÙŠÙ‡ VyOS ğŸ‘©ğŸ¼â€ğŸ¨ ğŸ¤±ğŸ½ ğŸ‘</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù…Ù† Ø§Ù„Ù…Ù‚Ø§Ù„Ø© Ù‡Ùˆ Ø¥Ø¸Ù‡Ø§Ø± ØªØ«Ø¨ÙŠØª ÙˆØªÙƒÙˆÙŠÙ† Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© VyOS Ø¹Ù„Ù‰ Ù…Ø¬Ù…ÙˆØ¹Ø© oVirt ØŒ Ù„ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ L3 Ø¨ÙŠÙ† Ø§Ù„Ø´Ø¨ÙƒØ§Øª Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© ÙˆØ§Ù„...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ù†ÙŠØ© ØªØ­ØªÙŠØ© Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªØªØ­Ù…Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡. Ø§Ù„Ø¬Ø²Ø¡ 3. ØªÙ†Ø¸ÙŠÙ… Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¹Ù„Ù‰ Ø£Ø¬Ù‡Ø²Ø© ØªÙˆØ¬ÙŠÙ‡ VyOS</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lenvendo/blog/487408/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù…Ù† Ø§Ù„Ù…Ù‚Ø§Ù„Ø© Ù‡Ùˆ Ø¥Ø¸Ù‡Ø§Ø± ØªØ«Ø¨ÙŠØª ÙˆØªÙƒÙˆÙŠÙ† Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© VyOS Ø¹Ù„Ù‰ Ù…Ø¬Ù…ÙˆØ¹Ø© oVirt ØŒ Ù„ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ L3 Ø¨ÙŠÙ† Ø§Ù„Ø´Ø¨ÙƒØ§Øª Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© ÙˆØ§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ÙƒÙ…Ø§ Ø³ØªÙ†Ø§Ù‚Ø´ Ø§Ù„Ù…Ù‚Ø§Ù„Ø© Ø§Ù„Ù…Ø´ÙƒÙ„Ø§Øª Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ù…ÙŠØ²Ø§Øª Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ø«Ù†ÙŠÙ† Ù…Ù† Ù…ÙˆÙØ±ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø© ØŒ ÙˆØ²ÙŠØ§Ø¯Ø© Ø§Ù„ØªØ³Ø§Ù…Ø­ Ù…Ø¹ Ø§Ù„Ø®Ø·Ø£ ÙÙŠ ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.</font></font></p><a name="habracut"></a><br>
<h2 id="vvodnaya-chast"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©</font></font></h2><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ù…Ù‚Ø§Ù„ØªÙŠÙ† Ø³Ø§Ø¨Ù‚ØªÙŠÙ†:</font></font></p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ù†ÙŠØ© ØªØ­ØªÙŠØ© Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªØªØ­Ù…Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡. </font><font style="vertical-align: inherit;">Ø§Ù„Ø¬Ø²Ø¡ 1 - Ø§Ù„ØªØ­Ø¶ÙŠØ± Ù„Ù†Ø´Ø± Ù…Ø¬Ù…ÙˆØ¹Ø© oVirt 4.3</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ù†ÙŠØ© ØªØ­ØªÙŠØ© Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªØªØ­Ù…Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡. </font><font style="vertical-align: inherit;">Ø§Ù„Ø¬Ø²Ø¡ 2. ØªØ«Ø¨ÙŠØª ÙˆØªÙƒÙˆÙŠÙ† Ù…Ø¬Ù…ÙˆØ¹Ø© oVirt 4.3</font></font></a></li>
</ul><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ÙˆØ¨Ø­Ù„ÙˆÙ„ Ù‡Ø°Ø§ Ø§Ù„ÙˆÙ‚Øª ØŒ Ø£Ù†Ø´Ø£Ù†Ø§ ÙƒØªÙ„Ø© oVirt Ø¢Ù…Ù†Ø© Ù…Ù† Ø§Ù„ÙØ´Ù„ ØŒ Ù…Ø¹ Ù†Ø¸Ø§Ù… ØªØ®Ø²ÙŠÙ† Ù…ØªØµÙ„ Ø¨Ù‡Ø§ Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø£Ù‚Ø±Ø§Øµ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ø¬Ù‡Ø§Ø² VM. </font><font style="vertical-align: inherit;">ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª ØŒ ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø´Ø¨ÙƒØ© ÙˆØ§Ù„Ù…Ø¶ÙŠÙÙŠÙ† Ø¥Ù„Ù‰ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù† Ù…Ø­ÙˆÙ„ÙŠ Cisco C2960RX Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù†ÙŠ ØŒ ÙŠØªÙ… ØªÙƒÙˆÙŠÙ† Ø§Ù„Ù…Ù†Ø§ÙØ° Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø© ÙÙŠ Ø£ÙˆØ¶Ø§Ø¹ Ø¬Ø°Ø¹ Ø£Ùˆ Ø«Ø§Ø¨Øª ØŒ ÙˆØ§Ù„ØªÙŠ ØªØ±ØªØ¨Ø· Ø¨Ù‡Ø§ Ù…Ø¹Ø±ÙØ§Øª VLAN.</font></font></p><br>
<p>     ,        L2          VLAN'. </p><br>
<p><strong>VLAN</strong> â€“  Â«Â»  ,              ( ).          VLAN,    ,  -   ,   ,      ,    ,  . </p><br>
<p>       (VLAN')  ,   ,        OSI,  - â€“ <strong></strong>.  ,   ,        ,       .</p><br>
<p>   â€“     ,     ,       ,     ,   .       ,    ,       . </p><br>
<p>     â€“           , ..      -     ,          ,  IP ,     .</p><br>
<p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">VyOS</a>  1.2.2,       (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">  </a>),          ,     ,          KVM. </p><br>
<p>VyOS          â€“     , VPN  IPSec , WAN load balancing, VRRP, QoS,  .. </p><br>
<p>  VyOS   Debian,  CLI ( ),     Juniper,      ,     ,   . </p><br>
<p>  GUI ( )   VyOS      ,        Linux/Cisco/Juniper ,    ,    Â« Â»   Debian,         ,         CLI  VyOS.<br>
 ,   GUI   ,   Web GUI   Vyatta,   export,   import   VyOS â€”         ,  ,     ,   -    .</p><br>
<p> ,      ,       â€“ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">VyOS User Guide</a>,       .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Habr</a>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">  VyOS</a>,          :)</p><br>
<p> VyOS    :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a> â€“   LTS (long-term support) ;</li>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">rolling releases</a>,   (  production ,              );</li>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a> LTS  VyOS  . </li>
</ul><br>
<p>    ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">rolling release</a> VyOS 1.2.2,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> LTS </a> VyOS 1.1.8.</p><br>
<p>   (  VyOS),     :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">WAN load balancing</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">NAT</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">High availability (VRRP)</a></li>
</ul><br>
<p>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">BGP</a>     ,         ,          ,     .</p><br>
<p>,   ,     .    ,    :</p><br>
<ul>
<li>  .</li>
<li> .</li>
<li>   VyOS.</li>
<li>   .</li>
<li> vrrp   .</li>
<li>      .</li>
</ul><br>
<h3 id="opisanie-testovogo-stenda">  </h3><br>
<p>      IP   ,    IP ,           ,        .          ,       .</p><br>
<p>         ,  :</p><br>
<ul>
<li>   â€“ <strong>VyOS1</strong>  <strong>VyOS2</strong>.</li>
<li>     CentOS 7   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Quagga</a> â€“ <strong>Provider-1</strong>, <strong>Provider-2</strong>  <strong>Provider-3</strong>,     .</li>
<li>     CentOS 7,        .</li>
</ul><br>
<p>     ,     <strong>oVirt</strong>.   ,     Â«Â»   oVirt,       â€“      KVM, VMware, Hyper-V,     .</p><br>
<p>     L3   :</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><img src="https://habrastorage.org/webt/se/4s/y-/se4sy-sikppg2gvv9yyzkqmqwwo.jpeg"></a></p><br>
<p>     :</p><br>
<ul>
<li> Â«Â»    <strong>172.16</strong>.x.x,         ,           </li>
<li>       <strong>172.20</strong>.x.x</li>
</ul><br>
<p>       ,    VLAN:</p><br>
<ul>
<li><strong>VLAN17</strong> â€“  172.20.1.0/24,       (IPMI, management)</li>
<li><strong>VLAN30</strong> â€“  172.16.1.0/24, Â«Â» ,   <strong>VyOS1</strong>, <strong>VyOS2</strong>  <strong>Provider-1</strong></li>
<li><strong>VLAN31</strong> â€“  172.16.2.0/24, Â«Â» ,   <strong>VyOS1</strong>, <strong>VyOS2</strong>  <strong>Provider-2</strong></li>
<li><strong>VLAN32</strong> â€“  172.20.32.0/23,       â€“ PROD</li>
<li><strong>VLAN36</strong> â€“  172.16.10.8/30, Â«Â» P2P ,    <strong>Provider-1</strong>  <strong>Provider-3</strong></li>
<li><strong>VLAN37</strong> â€“  172.16.10.12/30, Â«Â» P2P ,    <strong>Provider-2</strong>  <strong>Provider-3</strong></li>
<li><strong>VLAN38</strong> â€“  172.16.3.0/24, Â«Â»    ,  </li>
<li><strong>VLAN40</strong> â€“  172.20.40.0/23,       â€“ TEST</li>
</ul><br>
<p>    ,     BGP   <strong>Provider-1</strong>, <strong>Provider-2</strong>  <strong>Provider-3</strong>,     Â«Â»  172.16.1.0/24, 172.16.2.0/24  172.16.3.0/24</p><br>
<p>,     :</p><br>
<ul>
<li>      ,        ;</li>
<li>        ,      NAT;</li>
<li>      VyOS,          ,      .</li>
</ul><br>
<h3 id="podgotovitelnye-raboty"> .</h3><br>
<p>  ,   9    <strong>oVirt</strong>:</p><br>
<ul>
<li>VyOS â€“ 2 .,  â€“  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">rolling release</a></li>
<li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Quagga</a> â€“ 3 .,  â€“ CentOS 7 x86/64 1810 Minimal (  )</li>
<li>  â€“ 4 .,  â€“ CentOS 7 x86/64 1810 Minimal (  )</li>
</ul><br>
<div class="spoiler"><b class="spoiler_title">  IP      ,    oVirt.</b><div class="spoiler_text"><ol>
<li><strong>test-17</strong> â€“ 1 Gb RAM, 1 CPU, 10 Gb HDD<br>
<ul>
<li>VLAN17, IP â€“ 172.20.1.239/24, Gateway â€“ 172.20.1.1</li>
</ul></li>
<li><strong>test-IM32</strong> â€“ 1 Gb RAM, 1 CPU, 10 Gb HDD<br>
<ul>
<li>VLAN32, IP â€“ 172.20.32.239/23, Gateway â€“ 172.20.32.1</li>
</ul></li>
<li><strong>test-IM40</strong> â€“ 1 Gb RAM, 1 CPU, 10 Gb HDD<br>
<ul>
<li>VLAN40, IP â€“ 172.20.40.239/23, Gateway â€“ 172.20.40.1</li>
</ul></li>
<li><strong>test-public</strong> â€“ 1 Gb RAM, 1 CPU, 10 Gb HDD,<br>
<ul>
<li>VLAN38, IP â€“ 172.16.3.2/24, Gateway â€“ 172.16.3.1</li>
</ul></li>
<li><strong>PROVIDER-1</strong> â€“ 1 Gb RAM, 1 CPU, 10 Gb HDD<br>
<ul>
<li>VLAN30, IP â€“ 172.16.1.1/24</li>
<li>VLAN36, IP â€“ 172.16.10.9/30</li>
</ul></li>
<li><strong>PROVIDER-2</strong> â€“ 1 Gb RAM, 1 CPU, 10 Gb HDD<br>
<ul>
<li>VLAN31, IP â€“ 172.16.2.1/24</li>
<li>VLAN37, IP â€“ 172.16.10.13/30</li>
</ul></li>
<li><strong>PROVIDER-3</strong> â€“ 1 Gb RAM, 1 CPU, 10 Gb HDD<br>
<ul>
<li>VLAN36, IP â€“ 172.16.10.10/30</li>
<li>VLAN37, IP â€“ 172.16.10.14/30</li>
<li>VLAN38, IP â€“ 172.16.3.1/24</li>
</ul></li>
<li><strong>VyOS1</strong> â€“ 1 Gb RAM, 1 CPU, 10 Gb HDD<br>
<ul>
<li>eth0: VLAN17, IP â€“ 172.20.1.253/24</li>
<li>eth1: VLAN30, IP â€“ 172.16.1.2/24</li>
<li>eth2: VLAN31, IP â€“ 172.16.2.3/24</li>
<li>eth3: VLAN32, IP â€“ 172.20.33.253/23</li>
<li>eth4: VLAN40, IP â€“ 172.20.40.253/23</li>
</ul></li>
<li><strong>VyOS2</strong> â€“ 1 Gb RAM, 1 CPU, 10 Gb HDD<br>
<ul>
<li>eth0: VLAN17, IP â€“ 172.20.1.254/24</li>
<li>eth1: VLAN30, IP â€“ 172.16.1.3/24</li>
<li>eth2: VLAN31, IP â€“ 172.16.2.2/24</li>
<li>eth3: VLAN32, IP â€“ 172.20.33.254/23</li>
<li>eth4: VLAN40, IP â€“ 172.20.40.254/23</li>
</ul></li>
</ol></div></div><br>
<p>   VLAN              <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a>  .</p><br>
<p>  ,    :<br>
<strong>1)</strong>          oVirt,       .</p><br>
<p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a>,     .       ,         :</p><br>
<div class="spoiler"><b class="spoiler_title">   oVirt</b><div class="spoiler_text"><p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><img src="https://habrastorage.org/webt/tc/fo/v7/tcfov7i3hrim00muo3etmb04dno.png"></a></p></div></div><br>
<div class="spoiler"><b class="spoiler_title">  ,    oVirt</b><div class="spoiler_text"><p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><img src="https://habrastorage.org/webt/fp/oh/vn/fpohvnbait7-fmswegfhj_aulce.png"></a></p></div></div><br>
<p><strong>2)</strong>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Quagga</a>,      . </p><br>
<p>      ,    ,   IP            .</p><br>
<p>            <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a>,        .</p><br>
<p>       ,   .</p><br>
<h3 id="nachalnaya-nastroyka-marshrutizatorov-vyos">   VyOS.</h3><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a>   VyOS, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">FAQ</a>.</p><br>
<p>   VyOs       oVirt:</p><br>
<ul>
<li> ISO    rolling release  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a></li>
<li>    oVirt</li>
<li>        </li>
<li>     ISO   VyOS</li>
<li>     .</li>
</ul><br>
<div class="spoiler"><b class="spoiler_title">     VyOS:</b><div class="spoiler_text"><p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><img src="https://habrastorage.org/webt/9t/_p/vn/9t_pvnz8srh5i6gbj84v-yyluyc.png"></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><img src="https://habrastorage.org/webt/xb/uy/wl/xbuywlw3ih0qpx38-68bafezwfu.png"></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><img src="https://habrastorage.org/webt/yw/zg/s1/ywzgs1vslq783oqresvte5igenc.png"><br>
</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><img src="https://habrastorage.org/webt/2s/ek/2k/2sek2k56mfeho-4jastnb6tzvpc.png"></a></p></div></div><br>
<p>      ISO,           :</p><br>
<pre><code class="plaintext hljs">vyos@vyos:~$ install image </code></pre><br>
<p>   ,  CD  ,   :</p><br>
<pre><code class="plaintext hljs">vyos@vyos:~$ reboot</code></pre><br>
<p><em>          VyOS: <strong>vyos / vyos</strong><br>
</em><br>
   ,     (   oVirt),   ,    ,       .</p><br>
<div class="spoiler"><b class="spoiler_title">       </b><div class="spoiler_text"><pre><code class="plaintext hljs">vyos@VyOS1:~$ sh system image<font></font>
The system currently has the following image(s) installed:<font></font>
   1: 1.2-rolling-201909060337 (default boot) (running image)<font></font>
<font></font>
vyos@VyOS1:~$ show version<font></font>
Version:          VyOS 1.2-rolling-201909060337<font></font>
Built by:         autobuild@vyos.net<font></font>
Built on:         Fri 06 Sep 2019 03:37 UTC<font></font>
Build UUID:       8b5401ba-b2eb-45d9-b267-1e3c5cfba6d7<font></font>
Build Commit ID:  ad4c3805b7b9af<font></font>
<font></font>
Architecture:     x86_64<font></font>
Boot via:         installed image<font></font>
System type:      KVM guest<font></font>
<font></font>
Hardware vendor:  oVirt<font></font>
Hardware model:   oVirt Node<font></font>
Hardware S/N:     4c4c4544-004a-5010-804e-cac04f4e5232<font></font>
Hardware UUID:    0f6dcc5e-b60b-4a47-81cc-6885339aa695<font></font>
<font></font>
Copyright:        VyOS maintainers and contributors</code></pre></div></div><br>
<p>      (   Â«<strong><em>configure terminal</em></strong>Â»   Cisco),  :</p><br>
<pre><code class="plaintext hljs">vyos@VyOS1:~$ configure<font></font>
[edit]<font></font>
vyos@VyOS1#</code></pre><br>
<p>      ,      .</p><br>
<p>       :</p><br>
<pre><code class="plaintext hljs">show interfaces ethernet<font></font>
show interfaces ethernet detail<font></font>
show interfaces ethernet eth0</code></pre><br>
<div class="spoiler"><b class="spoiler_title">    VyOS1</b><div class="spoiler_text"><p>   <strong>VLAN17</strong>:</p><br>
<pre><code class="plaintext hljs">set interfaces ethernet eth0 address '172.20.1.253/24'<font></font>
set interfaces ethernet eth0 description 'VLAN17'</code></pre><br>
<p>  IP   : </p><br>
<pre><code class="plaintext hljs">delete interfaces ethernet eth0 address 172.20.1.253/24</code></pre><br>
<p>   <strong>VLAN30</strong>:</p><br>
<pre><code class="plaintext hljs">set interfaces ethernet eth1 address '172.16.1.2/24'<font></font>
set interfaces ethernet eth1 description 'VLAN30'</code></pre><br>
<p>   <strong>VLAN31</strong>:</p><br>
<pre><code class="plaintext hljs">set interfaces ethernet eth2 address '172.16.2.3/24'<font></font>
set interfaces ethernet eth2 description 'VLAN31'</code></pre><br>
<p>   <strong>VLAN32</strong>:</p><br>
<pre><code class="plaintext hljs">set interfaces ethernet eth3 address '172.20.33.253/23'<font></font>
set interfaces ethernet eth3 description 'VLAN32'</code></pre><br>
<p>   <strong>VLAN40</strong>:</p><br>
<pre><code class="plaintext hljs">set interfaces ethernet eth4 address '172.20.40.253/23'<font></font>
set interfaces ethernet eth4 description 'VLAN40'</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">    VyOS2</b><div class="spoiler_text"><p>   <strong>VLAN17</strong>:</p><br>
<pre><code class="plaintext hljs">set interfaces ethernet eth0 address '172.20.1.254/24'<font></font>
set interfaces ethernet eth0 description 'VLAN17'</code></pre><br>
<p>   <strong>VLAN30</strong>:</p><br>
<pre><code class="plaintext hljs">set interfaces ethernet eth1 address '172.16.1.3/24'<font></font>
set interfaces ethernet eth1 description 'VLAN30'</code></pre><br>
<p>   <strong>VLAN31</strong>:</p><br>
<pre><code class="plaintext hljs">set interfaces ethernet eth2 address '172.16.2.2/24'<font></font>
set interfaces ethernet eth2 description 'VLAN31'</code></pre><br>
<p>   <strong>VLAN32</strong>:</p><br>
<pre><code class="plaintext hljs">set interfaces ethernet eth3 address '172.20.33.254/23'<font></font>
set interfaces ethernet eth3 description 'VLAN32'</code></pre><br>
<p>   <strong>VLAN40</strong>:</p><br>
<pre><code class="plaintext hljs">set interfaces ethernet eth4 address '172.20.40.254/23'<font></font>
set interfaces ethernet eth4 description 'VLAN40'</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">    </b><div class="spoiler_text"><p> SSH    </p><br>
<pre><code class="plaintext hljs">set service ssh port 22</code></pre><br>
<p> DNS forwarder      </p><br>
<pre><code class="plaintext hljs">set system name-server 1.1.1.1<font></font>
set system name-server 8.8.8.8</code></pre><br>
<p>      </p><br>
<pre><code class="plaintext hljs">set system host-name VyOS1<font></font>
set system syslog global facility all level 'notice'</code></pre><br>
<p>  SSH     </p><br>
<pre><code class="plaintext hljs">set system login user vyos authentication public-keys 'vyos' key "very_very_very_long_key"<font></font>
set system login user vyos authentication public-keys 'vyos' type ssh-rsa</code></pre><br>
<p> ntp     </p><br>
<pre><code class="plaintext hljs">set system ntp server 0.pool.ntp.org<font></font>
set system ntp server 1.pool.ntp.org<font></font>
set system ntp server 2.pool.ntp.org<font></font>
set system time-zone Europe/Moscow<font></font>
date</code></pre><br>
<p>    SSH (    DNS )</p><br>
<pre><code class="plaintext hljs">edit service ssh disable-host-validation</code></pre></div></div><br>
<p>    ,  </p><br>
<pre><code class="plaintext hljs">commit <font></font>
save</code></pre><br>
<p>     ,  </p><br>
<pre><code class="plaintext hljs">discard</code></pre><br>
<p>  ,        VyOS  SSH,      SSH .</p><br>
<p>   ,    ,        VyOS, , :</p><br>
<ul>
<li> SNMP    ,  ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Zabbix</a>;</li>
<li>      tftp     ,   commit'       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Zabbix</a>;</li>
<li>     VyOS  tftp   ;</li>
<li> .. </li>
</ul><br>
<p>        ,             <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Zabbix</a>,            .</p><br>
<h3 id="nastroyka-pravil-na-fayervole">   .</h3><br>
<p>   â€“ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Firewall</a>.<br>
VyOS      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">netfilter</a>. </p><br>
<p>    VyOS    : </p><br>
<ul>
<li>,    (<strong>Per-Interface</strong>) </li>
<li>  (<strong>Zone Policy</strong>). </li>
</ul><br>
<p>    ,   .</p><br>
<p>       â€“    ,   1  9999.   ,     .    ,   ;  ,      .</p><br>
<p>   :</p><br>
<ul>
<li>Accept â€“ ,    </li>
<li>Drop â€“ ,    </li>
<li>Reject â€“ ,      Â«ICMP Port UnreachableÂ».</li>
</ul><br>
<p>     ,    ,   :</p><br>
<ul>
<li><strong> </strong> ( <strong>in</strong>)<br>
    FORWARD (netfilter),   ,        VyOS.         .</li>
<li><strong> </strong> ( <strong>out</strong>)<br>
    FORWARD (netfilter),   ,   .     ,   VyOS,      .         .</li>
<li><strong> </strong> ( <strong>local</strong>)<br>
  INPUT (netfilter), .. ,      VyOS, ,  22        .</li>
</ul><br>
<p>  :</p><br>
<pre><code class="plaintext hljs">set firewall name OUTSIDE-IN default-action 'drop'<font></font>
set firewall name OUTSIDE-IN rule 10 action 'allow'<font></font>
set firewall name OUTSIDE-IN rule 10 state established 'enable'<font></font>
set firewall name OUTSIDE-IN rule 10 state related 'enable'</code></pre><br>
<p> 1 â€“      Â«OUTSIDE-INÂ»     .<br>
 2 â€“    (#10),   ,  .<br>
 3 â€“ ,   ,      .<br>
 4 â€“ ,   ,      .</p><br>
<p>     ,    :</p><br>
<pre><code class="plaintext hljs">set firewall name OUTSIDE-LOCAL default-action 'drop'</code></pre><br>
<p>       .</p><br>
<p>      ,   :</p><br>
<pre><code class="plaintext hljs">set interfaces ethernet eth0 firewall in name 'OUTSIDE-IN'<font></font>
set interfaces ethernet eth1 firewall local name 'OUTSIDE-LOCAL'</code></pre><br>
<p> 1 â€“    Â«OUTSIDE-INÂ»   eth0,      .<br>
 2 â€“    Â«OUTSIDE-LOCALÂ»   eth1,  ,    .</p><br>
<p><strong>   </strong></p><br>
<p>      ( ,    ).</p><br>
<p> ,   :</p><br>
<ul>
<li> ,     (established, related),   </li>
<li> ICMP echo-request (ping)</li>
<li>  DHCP</li>
<li>  DNS</li>
<li>   SSH  4    IP          (management)</li>
<li>  SNMP      (management)</li>
</ul><br>
<div class="spoiler"><b class="spoiler_title">  </b><div class="spoiler_text"><ul>
<li>     <br>
<pre><code class="plaintext hljs">set firewall group network-group NET-VLAN17 network '172.20.1.0/24'<font></font>
set firewall group network-group NET-VLAN30 network '172.16.1.0/24'<font></font>
set firewall group network-group NET-VLAN31 network '172.16.2.0/24'<font></font>
set firewall group network-group NET-VLAN32 network '172.20.32.0/23'<font></font>
set firewall group network-group NET-VLAN38 network '172.16.3.0/24'<font></font>
set firewall group network-group NET-VLAN40 network '172.20.40.0/23'<font></font>
set firewall group network-group NET-MANAGEMENT network '172.20.32.0/23'<font></font>
set firewall group network-group NET-MANAGEMENT network '172.20.1.0/24'</code></pre></li>
<li>      ,  ,   .<br>
<pre><code class="plaintext hljs">set firewall name LOCAL-VLAN30 default-action 'drop'<font></font>
set firewall name LOCAL-VLAN30 rule 1010 action 'accept'<font></font>
set firewall name LOCAL-VLAN30 rule 1010 state established 'enable'<font></font>
set firewall name LOCAL-VLAN30 rule 1010 state related 'enable'<font></font>
set firewall name LOCAL-VLAN30 rule 1011 action 'drop'<font></font>
set firewall name LOCAL-VLAN30 rule 1011 state invalid 'enable'<font></font>
set firewall name LOCAL-VLAN30 rule 1020 action 'accept'<font></font>
set firewall name LOCAL-VLAN30 rule 1020 icmp type-name 'echo-request'<font></font>
set firewall name LOCAL-VLAN30 rule 1020 protocol 'icmp'<font></font>
set firewall name LOCAL-VLAN30 rule 1020 state new 'enable'<font></font>
set firewall name LOCAL-VLAN30 rule 1030 action 'drop'<font></font>
set firewall name LOCAL-VLAN30 rule 1030 destination port '22'<font></font>
set firewall name LOCAL-VLAN30 rule 1030 protocol 'tcp'<font></font>
set firewall name LOCAL-VLAN30 rule 1030 recent count '4'<font></font>
set firewall name LOCAL-VLAN30 rule 1030 recent time '60'<font></font>
set firewall name LOCAL-VLAN30 rule 1030 source group network-group 'NET-MANAGEMENT'<font></font>
set firewall name LOCAL-VLAN30 rule 1030 state new 'enable'<font></font>
set firewall name LOCAL-VLAN30 rule 1040 action 'accept'<font></font>
set firewall name LOCAL-VLAN30 rule 1040 destination port '22'<font></font>
set firewall name LOCAL-VLAN30 rule 1040 protocol 'tcp'<font></font>
set firewall name LOCAL-VLAN30 rule 1040 source group network-group 'NET-MANAGEMENT'<font></font>
set firewall name LOCAL-VLAN30 rule 1040 state new 'enable'</code></pre><br>
<pre><code class="plaintext hljs">set firewall name LOCAL-VLAN31 default-action 'drop'<font></font>
set firewall name LOCAL-VLAN31 rule 1010 action 'accept'<font></font>
set firewall name LOCAL-VLAN31 rule 1010 state established 'enable'<font></font>
set firewall name LOCAL-VLAN31 rule 1010 state related 'enable'<font></font>
set firewall name LOCAL-VLAN31 rule 1011 action 'drop'<font></font>
set firewall name LOCAL-VLAN31 rule 1011 state invalid 'enable'<font></font>
set firewall name LOCAL-VLAN31 rule 1020 action 'accept'<font></font>
set firewall name LOCAL-VLAN31 rule 1020 icmp type-name 'echo-request'<font></font>
set firewall name LOCAL-VLAN31 rule 1020 protocol 'icmp'<font></font>
set firewall name LOCAL-VLAN31 rule 1020 state new 'enable'<font></font>
set firewall name LOCAL-VLAN31 rule 1030 action 'drop'<font></font>
set firewall name LOCAL-VLAN31 rule 1030 destination port '22'<font></font>
set firewall name LOCAL-VLAN31 rule 1030 protocol 'tcp'<font></font>
set firewall name LOCAL-VLAN31 rule 1030 recent count '4'<font></font>
set firewall name LOCAL-VLAN31 rule 1030 recent time '60'<font></font>
set firewall name LOCAL-VLAN31 rule 1030 source group network-group 'NET-MANAGEMENT'<font></font>
set firewall name LOCAL-VLAN31 rule 1030 state new 'enable'<font></font>
set firewall name LOCAL-VLAN31 rule 1040 action 'accept'<font></font>
set firewall name LOCAL-VLAN31 rule 1040 destination port '22'<font></font>
set firewall name LOCAL-VLAN31 rule 1040 protocol 'tcp'<font></font>
set firewall name LOCAL-VLAN31 rule 1040 source group network-group 'NET-MANAGEMENT'<font></font>
set firewall name LOCAL-VLAN31 rule 1040 state new 'enable'</code></pre><br>
<pre><code class="plaintext hljs">set firewall name LOCAL-VLAN17 default-action 'drop'<font></font>
set firewall name LOCAL-VLAN17 rule 1001 action 'accept'<font></font>
set firewall name LOCAL-VLAN17 rule 1001 source group network-group 'NET-MANAGEMENT'<font></font>
set firewall name LOCAL-VLAN17 rule 1010 action 'accept'<font></font>
set firewall name LOCAL-VLAN17 rule 1010 state established 'enable'<font></font>
set firewall name LOCAL-VLAN17 rule 1010 state related 'enable'<font></font>
set firewall name LOCAL-VLAN17 rule 1011 action 'drop'<font></font>
set firewall name LOCAL-VLAN17 rule 1011 state invalid 'enable'<font></font>
set firewall name LOCAL-VLAN17 rule 1020 action 'accept'<font></font>
set firewall name LOCAL-VLAN17 rule 1020 icmp type-name 'echo-request'<font></font>
set firewall name LOCAL-VLAN17 rule 1020 protocol 'icmp'<font></font>
set firewall name LOCAL-VLAN17 rule 1020 state new 'enable'<font></font>
set firewall name LOCAL-VLAN17 rule 1040 action 'accept'<font></font>
set firewall name LOCAL-VLAN17 rule 1040 destination port '53'<font></font>
set firewall name LOCAL-VLAN17 rule 1040 protocol 'tcp_udp'<font></font>
set firewall name LOCAL-VLAN17 rule 1040 state new 'enable'<font></font>
set firewall name LOCAL-VLAN17 rule 1100 action 'drop'<font></font>
set firewall name LOCAL-VLAN17 rule 1100 destination port '22'<font></font>
set firewall name LOCAL-VLAN17 rule 1100 protocol 'tcp'<font></font>
set firewall name LOCAL-VLAN17 rule 1100 recent count '4'<font></font>
set firewall name LOCAL-VLAN17 rule 1100 recent time '60'<font></font>
set firewall name LOCAL-VLAN17 rule 1100 source group network-group 'NET-MANAGEMENT'<font></font>
set firewall name LOCAL-VLAN17 rule 1100 state new 'enable'<font></font>
set firewall name LOCAL-VLAN17 rule 1101 action 'accept'<font></font>
set firewall name LOCAL-VLAN17 rule 1101 destination port '22'<font></font>
set firewall name LOCAL-VLAN17 rule 1101 protocol 'tcp'<font></font>
set firewall name LOCAL-VLAN17 rule 1101 source group network-group 'NET-MANAGEMENT'<font></font>
set firewall name LOCAL-VLAN17 rule 1101 state new 'enable'<font></font>
set firewall name LOCAL-VLAN17 rule 1110 action 'accept'<font></font>
set firewall name LOCAL-VLAN17 rule 1110 destination port '161'<font></font>
set firewall name LOCAL-VLAN17 rule 1110 protocol 'udp'<font></font>
set firewall name LOCAL-VLAN17 rule 1110 source group network-group 'NET-MANAGEMENT'<font></font>
set firewall name LOCAL-VLAN17 rule 1110 state new 'enable'</code></pre><br>
<pre><code class="plaintext hljs">set firewall name LOCAL-VLAN32 default-action 'drop'<font></font>
set firewall name LOCAL-VLAN32 rule 1010 action 'accept'<font></font>
set firewall name LOCAL-VLAN32 rule 1010 state established 'enable'<font></font>
set firewall name LOCAL-VLAN32 rule 1010 state related 'enable'<font></font>
set firewall name LOCAL-VLAN32 rule 1011 action 'drop'<font></font>
set firewall name LOCAL-VLAN32 rule 1011 state invalid 'enable'<font></font>
set firewall name LOCAL-VLAN32 rule 1020 action 'accept'<font></font>
set firewall name LOCAL-VLAN32 rule 1020 icmp type-name 'echo-request'<font></font>
set firewall name LOCAL-VLAN32 rule 1020 protocol 'icmp'<font></font>
set firewall name LOCAL-VLAN32 rule 1020 state new 'enable'<font></font>
set firewall name LOCAL-VLAN32 rule 1030 action 'accept'<font></font>
set firewall name LOCAL-VLAN32 rule 1030 destination port '67'<font></font>
set firewall name LOCAL-VLAN32 rule 1030 protocol 'udp'<font></font>
set firewall name LOCAL-VLAN32 rule 1030 state new 'enable'<font></font>
set firewall name LOCAL-VLAN32 rule 1040 action 'accept'<font></font>
set firewall name LOCAL-VLAN32 rule 1040 destination port '53'<font></font>
set firewall name LOCAL-VLAN32 rule 1040 protocol 'tcp_udp'<font></font>
set firewall name LOCAL-VLAN32 rule 1040 state new 'enable'<font></font>
set firewall name LOCAL-VLAN32 rule 1100 action 'drop'<font></font>
set firewall name LOCAL-VLAN32 rule 1100 destination port '22'<font></font>
set firewall name LOCAL-VLAN32 rule 1100 protocol 'tcp'<font></font>
set firewall name LOCAL-VLAN32 rule 1100 recent count '4'<font></font>
set firewall name LOCAL-VLAN32 rule 1100 recent time '60'<font></font>
set firewall name LOCAL-VLAN32 rule 1100 source group network-group 'NET-MANAGEMENT'<font></font>
set firewall name LOCAL-VLAN32 rule 1100 state new 'enable'<font></font>
set firewall name LOCAL-VLAN32 rule 1101 action 'accept'<font></font>
set firewall name LOCAL-VLAN32 rule 1101 destination port '22'<font></font>
set firewall name LOCAL-VLAN32 rule 1101 protocol 'tcp'<font></font>
set firewall name LOCAL-VLAN32 rule 1101 source group network-group 'NET-MANAGEMENT'<font></font>
set firewall name LOCAL-VLAN32 rule 1101 state new 'enable'<font></font>
set firewall name LOCAL-VLAN32 rule 1110 action 'accept'<font></font>
set firewall name LOCAL-VLAN32 rule 1110 destination port '161'<font></font>
set firewall name LOCAL-VLAN32 rule 1110 protocol 'udp'<font></font>
set firewall name LOCAL-VLAN32 rule 1110 source group network-group 'NET-MANAGEMENT'<font></font>
set firewall name LOCAL-VLAN32 rule 1110 state new 'enable'</code></pre><br>
<pre><code class="plaintext hljs">set firewall name LOCAL-VLAN40 default-action 'drop'<font></font>
set firewall name LOCAL-VLAN40 rule 1001 action 'accept'<font></font>
set firewall name LOCAL-VLAN40 rule 1001 source group network-group 'NET-MANAGEMENT'<font></font>
set firewall name LOCAL-VLAN40 rule 1010 action 'accept'<font></font>
set firewall name LOCAL-VLAN40 rule 1010 state established 'enable'<font></font>
set firewall name LOCAL-VLAN40 rule 1010 state related 'enable'<font></font>
set firewall name LOCAL-VLAN40 rule 1011 action 'drop'<font></font>
set firewall name LOCAL-VLAN40 rule 1011 state invalid 'enable'<font></font>
set firewall name LOCAL-VLAN40 rule 1020 action 'accept'<font></font>
set firewall name LOCAL-VLAN40 rule 1020 icmp type-name 'echo-request'<font></font>
set firewall name LOCAL-VLAN40 rule 1020 protocol 'icmp'<font></font>
set firewall name LOCAL-VLAN40 rule 1020 state new 'enable'</code></pre></li>
<li>      <strong>VyOS1</strong>  <strong>VyOS2</strong><br>
<pre><code class="plaintext hljs">set interfaces ethernet eth0 firewall local name 'LOCAL-VLAN17'<font></font>
set interfaces ethernet eth1 firewall local name 'LOCAL-VLAN30'<font></font>
set interfaces ethernet eth2 firewall local name 'LOCAL-VLAN31'<font></font>
set interfaces ethernet eth3 firewall local name 'LOCAL-VLAN32'<font></font>
set interfaces ethernet eth4 firewall local name 'LOCAL-VLAN40'</code></pre></li>
</ul></div></div><br>
<p><strong>      </strong></p><br>
<p>       <strong>VLAN32</strong>  <strong>VLAN17</strong> â€“ ,    ,       ,  ,        (,     ).</p><br>
<p>        ,    <strong>VLAN30</strong>, <strong>VLAN31</strong>  <strong>VLAN40</strong>   ,       .<br>
,    ,       !</p><br>
<p><u> </u><br>
    ,    ,     .     (asymmetric routing),     -,   SPI (stateful packet inspection).</p><br>
<div class="spoiler"><b class="spoiler_title">    </b><div class="spoiler_text"><ul>
<li>       VLAN32  VLAN17   <br>
<pre><code class="plaintext hljs">set firewall name VLAN32-IN default-action 'drop'<font></font>
set firewall name VLAN32-IN rule 1010 action 'accept'<font></font>
set firewall name VLAN32-IN rule 1010 state established 'enable'<font></font>
set firewall name VLAN32-IN rule 1010 state related 'enable'<font></font>
set firewall name VLAN32-IN rule 1011 action 'drop'<font></font>
set firewall name VLAN32-IN rule 1011 state invalid 'enable'<font></font>
set firewall name VLAN32-IN rule 9000 action 'accept'<font></font>
set firewall name VLAN32-IN rule 9000 source group network-group 'NET-VLAN32'<font></font>
set firewall name VLAN32-IN rule 9000 state new 'enable'</code></pre><br>
<pre><code class="plaintext hljs">set firewall name VLAN17-IN default-action 'drop'<font></font>
set firewall name VLAN17-IN rule 1010 action 'accept'<font></font>
set firewall name VLAN17-IN rule 1010 state established 'enable'<font></font>
set firewall name VLAN17-IN rule 1010 state related 'enable'<font></font>
set firewall name VLAN17-IN rule 1011 action 'drop'<font></font>
set firewall name VLAN17-IN rule 1011 state invalid 'enable'<font></font>
set firewall name VLAN17-IN rule 9000 action 'accept'<font></font>
set firewall name VLAN17-IN rule 9000 source group network-group 'NET-VLAN17'<font></font>
set firewall name VLAN17-IN rule 9000 state new 'enable'</code></pre></li>
<li>    ,    <br>
<pre><code class="plaintext hljs">set interfaces ethernet eth0 firewall in name 'VLAN17-IN'<font></font>
set interfaces ethernet eth2 firewall in name 'VLAN32-IN'</code></pre></li>
<li>       ,   VLAN32  VLAN17, ..        .<br>
<pre><code class="plaintext hljs">set firewall name VLAN32-OUT default-action 'drop'<font></font>
set firewall name VLAN32-OUT rule 1010 action 'accept'<font></font>
set firewall name VLAN32-OUT rule 1010 state established 'enable'<font></font>
set firewall name VLAN32-OUT rule 1010 state related 'enable'<font></font>
set firewall name VLAN32-OUT rule 1011 action 'drop'<font></font>
set firewall name VLAN32-OUT rule 1011 state invalid 'enable'<font></font>
set firewall name VLAN32-OUT rule 1020 action 'accept'<font></font>
set firewall name VLAN32-OUT rule 1020 icmp type-name 'echo-request'<font></font>
set firewall name VLAN32-OUT rule 1020 protocol 'icmp'<font></font>
set firewall name VLAN32-OUT rule 1020 state new 'enable'<font></font>
set firewall name VLAN32-OUT rule 1100 action 'accept'<font></font>
set firewall name VLAN32-OUT rule 1100 source group network-group 'NET-VLAN40'<font></font>
set firewall name VLAN32-OUT rule 1100 state new 'enable'<font></font>
set firewall name VLAN32-OUT rule 1110 action 'accept'<font></font>
set firewall name VLAN32-OUT rule 1110 source group network-group 'NET-VLAN17'<font></font>
set firewall name VLAN32-OUT rule 1110 state new 'enable'<font></font>
set firewall name VLAN32-OUT rule 1120 action 'accept'<font></font>
set firewall name VLAN32-OUT rule 1120 source group network-group 'NET-VLAN30'<font></font>
set firewall name VLAN32-OUT rule 1120 state new 'enable'<font></font>
set firewall name VLAN32-OUT rule 1130 action 'accept'<font></font>
set firewall name VLAN32-OUT rule 1130 source group network-group 'NET-VLAN31'<font></font>
set firewall name VLAN32-OUT rule 1130 state new 'enable'<font></font>
set firewall name VLAN32-OUT rule 1140 action 'accept'<font></font>
set firewall name VLAN32-OUT rule 1140 source group network-group 'NET-VLAN38'<font></font>
set firewall name VLAN32-OUT rule 1140 state new 'enable'</code></pre><br>
<pre><code class="plaintext hljs">set firewall name VLAN17-OUT default-action 'drop'<font></font>
set firewall name VLAN17-OUT rule 1010 action 'accept'<font></font>
set firewall name VLAN17-OUT rule 1010 state established 'enable'<font></font>
set firewall name VLAN17-OUT rule 1010 state related 'enable'<font></font>
set firewall name VLAN17-OUT rule 1011 action 'drop'<font></font>
set firewall name VLAN17-OUT rule 1011 state invalid 'enable'<font></font>
set firewall name VLAN17-OUT rule 1020 action 'accept'<font></font>
set firewall name VLAN17-OUT rule 1020 icmp type-name 'echo-request'<font></font>
set firewall name VLAN17-OUT rule 1020 protocol 'icmp'<font></font>
set firewall name VLAN17-OUT rule 1020 state new 'enable'<font></font>
set firewall name VLAN17-OUT rule 1100 action 'accept'<font></font>
set firewall name VLAN17-OUT rule 1100 source group network-group 'NET-VLAN32'<font></font>
set firewall name VLAN17-OUT rule 1100 state new 'enable'</code></pre></li>
<li>    ,    <br>
<pre><code class="plaintext hljs">set interfaces ethernet eth0 firewall out name 'VLAN17-OUT'<font></font>
set interfaces ethernet eth3 firewall out name 'VLAN32-OUT'</code></pre></li>
</ul></div></div><br>
<p> ,    ,     ,   <strong><em>commit</em></strong>  <strong><em>save</em></strong>.</p><br>
<div class="spoiler"><b class="spoiler_title">    VyOS</b><div class="spoiler_text"><ul>
<li>   snmp     <br>
<pre><code class="plaintext hljs">set firewall config-trap 'enable'</code></pre></li>
<li> ,          (    <em>default drop</em>) <br>
<pre><code class="plaintext hljs">set firewall name VLAN17-IN 'enable-default-log'<font></font>
set firewall name VLAN17-OUT 'enable-default-log'<font></font>
set firewall name VLAN32-IN 'enable-default-log'<font></font>
set firewall name VLAN32-OUT 'enable-default-log'</code></pre></li>
<li>,   ,     :<br>
<pre><code class="plaintext hljs">set firewall name VLAN17-LOCAL 'enable-default-log'<font></font>
commit<font></font>
exit<font></font>
show log firewall name VLAN17-LOCAL<font></font>
configure<font></font>
delete firewall name VLAN17-LOCAL 'enable-default-log'<font></font>
commit</code></pre></li>
<li>   ,    <br>
<pre><code class="plaintext hljs">set firewall all-ping 'enable'<font></font>
set firewall broadcast-ping 'disable'<font></font>
set firewall config-trap 'disable'<font></font>
set firewall log-martians 'enable'<font></font>
set firewall receive-redirects 'disable'<font></font>
set firewall source-validation 'disable'<font></font>
set firewall syn-cookies 'enable'<font></font>
set firewall send-redirects 'enable'<font></font>
set firewall ipv6-receive-redirects 'disable'<font></font>
set firewall ipv6-src-route 'disable'<font></font>
set firewall ip-src-route 'disable'</code></pre></li>
</ul></div></div><br>
<h3 id="nastroyka-vrrp-dlya-otkazoustoychivoy-marshrutizacii"> vrrp   </h3><br>
<p>   â€“ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">High availability (VRRP)</a>. </p><br>
<p>     VyOS,               .<br>
     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">vrrp</a>,    ,       IP  â€” HAIP (Highly Available IP),       .      ,           -  ,      .     ,  HAIP     () ,      .</p><br>
<p>  -  HAIP,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">keepalived</a>,     ,         ,       VyOS     Linux,    HAIP  keepalived (    ).      - ,         .</p><br>
<p>       vrrp,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">  IBM</a>,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Vyatta 5600</a>  Brocade,   ,    VyOS    Vyatta (  2012    Brocade).</p><br>
<div class="spoiler"><b class="spoiler_title"> HAIP,         :</b><div class="spoiler_text"><p><strong>VLAN17</strong>, HA VIP â€“ 172.20.1.1/24</p><br>
<pre><code class="plaintext hljs">  â€“ 172.20.1.253/24<font></font>
  â€“ 172.20.1.254/24</code></pre><br>
<p><strong>VLAN32</strong>, HA VIP â€“ 172.20.32.1/23</p><br>
<pre><code class="plaintext hljs">  â€“ 172.20.33.253/23<font></font>
  â€“ 172.20.33.254/23</code></pre><br>
<p><strong>VLAN40</strong>, HA VIP â€“ 172.20.40.1/23</p><br>
<pre><code class="plaintext hljs">  â€“ 172.20.40.253/23<font></font>
  â€“ 172.20.40.254/23</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">      VyOS1  VyOS2</b><div class="spoiler_text"><pre><code class="plaintext hljs">set firewall name LOCAL-VLAN32 rule 1120 action 'accept'<font></font>
set firewall name LOCAL-VLAN32 rule 1120 protocol 'vrrp'<font></font>
<font></font>
set firewall name LOCAL-VLAN17 rule 1120 action 'accept'<font></font>
set firewall name LOCAL-VLAN17 rule 1120 protocol 'vrrp'<font></font>
<font></font>
set firewall name LOCAL-VLAN40 rule 1030 action 'accept'<font></font>
set firewall name LOCAL-VLAN40 rule 1030 protocol 'vrrp'</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"> vrrp   VyOS1</b><div class="spoiler_text"><pre><code class="plaintext hljs">set high-availability vrrp group haip-1 vrid 17<font></font>
set high-availability vrrp group haip-1 interface eth0<font></font>
set high-availability vrrp group haip-1 virtual-address 172.20.1.1/24<font></font>
set high-availability vrrp group haip-1 priority '200'<font></font>
set high-availability vrrp group haip-1 authentication type 'plaintext-password'<font></font>
set high-availability vrrp group haip-1 authentication password 'b65495f9'<font></font>
set high-availability vrrp group haip-1 preempt 2<font></font>
set high-availability vrrp group haip-1 advertise-interval '1'<font></font>
<font></font>
set high-availability vrrp group haip-2 vrid 32<font></font>
set high-availability vrrp group haip-2 interface eth3<font></font>
set high-availability vrrp group haip-2 virtual-address 172.20.32.1/23<font></font>
set high-availability vrrp group haip-2 priority '200'<font></font>
set high-availability vrrp group haip-2 authentication type 'plaintext-password'<font></font>
set high-availability vrrp group haip-2 authentication password 'b65495f9'<font></font>
set high-availability vrrp group haip-2 preempt 2<font></font>
set high-availability vrrp group haip-2 advertise-interval '1'<font></font>
<font></font>
set high-availability vrrp group haip-3 vrid 40<font></font>
set high-availability vrrp group haip-3 interface eth4<font></font>
set high-availability vrrp group haip-3 virtual-address 172.20.40.1/23<font></font>
set high-availability vrrp group haip-3 priority '200'<font></font>
set high-availability vrrp group haip-3 authentication type 'plaintext-password'<font></font>
set high-availability vrrp group haip-3 authentication password 'b65495f9'<font></font>
set high-availability vrrp group haip-3 preempt 2<font></font>
set high-availability vrrp group haip-3 advertise-interval '1'<font></font>
commit</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"> vrrp   VyOS2</b><div class="spoiler_text"><pre><code class="plaintext hljs">set high-availability vrrp group haip-1 vrid 17<font></font>
set high-availability vrrp group haip-1 interface eth0<font></font>
set high-availability vrrp group haip-1 virtual-address 172.20.1.1/24<font></font>
set high-availability vrrp group haip-1 priority '199'<font></font>
set high-availability vrrp group haip-1 authentication type 'plaintext-password'<font></font>
set high-availability vrrp group haip-1 authentication password 'b65495f9'<font></font>
set high-availability vrrp group haip-1 preempt 2<font></font>
set high-availability vrrp group haip-1 advertise-interval '1'<font></font>
<font></font>
set high-availability vrrp group haip-2 vrid 32<font></font>
set high-availability vrrp group haip-2 interface eth3<font></font>
set high-availability vrrp group haip-2 virtual-address 172.20.32.1/23<font></font>
set high-availability vrrp group haip-2 priority '199'<font></font>
set high-availability vrrp group haip-2 authentication type 'plaintext-password'<font></font>
set high-availability vrrp group haip-2 authentication password 'b65495f9'<font></font>
set high-availability vrrp group haip-2 preempt 2<font></font>
set high-availability vrrp group haip-2 advertise-interval '1'<font></font>
<font></font>
set high-availability vrrp group haip-3 vrid 40<font></font>
set high-availability vrrp group haip-3 interface eth4<font></font>
set high-availability vrrp group haip-3 virtual-address 172.20.40.1/23<font></font>
set high-availability vrrp group haip-3 priority '199'<font></font>
set high-availability vrrp group haip-3 authentication type 'plaintext-password'<font></font>
set high-availability vrrp group haip-3 authentication password 'b65495f9'<font></font>
set high-availability vrrp group haip-3 preempt 2<font></font>
set high-availability vrrp group haip-3 advertise-interval '1'<font></font>
commit</code></pre></div></div><br>
<p>      vrrp:</p><br>
<pre><code class="plaintext hljs">run show vrrp statistics<font></font>
run show vrrp detail<font></font>
run show log all</code></pre><br>
<div class="spoiler"><b class="spoiler_title">  vrrp:</b><div class="spoiler_text"><pre><code class="plaintext hljs">vyos@VyOS1# run show vrrp<font></font>
Name    Interface      VRID  State    Last Transition<font></font>
------  -----------  ------  -------  -----------------<font></font>
haip-1  eth0            17   MASTER   13m48s<font></font>
haip-2  eth3            32   MASTER   13m48s<font></font>
haip-3  eth4            40   MASTER   13m48s<font></font>
<font></font>
vyos@VyOS2# run show vrrp<font></font>
Name    Interface      VRID  State    Last Transition<font></font>
------  -----------  ------  -------  -----------------<font></font>
haip-1  eth0            17    BACKUP   11m26s<font></font>
haip-2  eth3            32    BACKUP   11m27s<font></font>
haip-3  eth4            40    BACKUP   5m17s</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">  vrrp</b><div class="spoiler_text"><ul>
<li>  <strong>VyOS1</strong><br>
<pre><code class="plaintext hljs">set high-availability vrrp group haip-1 disable<font></font>
set high-availability vrrp group haip-2 disable<font></font>
set high-availability vrrp group haip-3 disable<font></font>
commit<font></font>
run show vrrp</code></pre></li>
<li>    <strong>test-17</strong>, <strong>test-IM3</strong>  <strong>test-IM40</strong>   ,        HAIP:<br>
<pre><code class="plaintext hljs">ping 172.20.32.239<font></font>
ping 172.20.1.239<font></font>
ping 172.20.40.239</code></pre></li>
<li>  ,   <strong>VyOS1</strong>  vrrp :<br>
<pre><code class="plaintext hljs">delete high-availability vrrp group haip-1 disable<font></font>
delete high-availability vrrp group haip-2 disable<font></font>
delete high-availability vrrp group haip-3 disable<font></font>
commit<font></font>
run show vrrp</code></pre></li>
</ul></div></div><br>
<h3 id="nastroyka-vyhoda-v-internet-cherez-dvuh-provayderov">      .</h3><br>
<p>  â€“ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">WAN load balancing</a>.</p><br>
<p>        ( ),        , ,             .<br>
     -  ,        ,     ,         ,     .                ,       .</p><br>
<p>    ,          ( ),     : VLAN17, VLAN32  VLAN40.</p><br>
<p>   IP   Â«Â» () ,        ,            BGPv4   <strong>bgpd</strong>,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Quagga</a>.</p><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Quagga</a>   ,      CLI,   <strong><em>vtysh</em></strong>.  CLI  ,         Cisco,      .</p><br>
<p>,     Â«Â» ()    VyOS   BGP  ,      ,      . ,   VyOS  BGP   ,       ,          ,    CentOS  Quagga.</p><br>
<div class="spoiler"><b class="spoiler_title"> Quagga   BGP  Â«Â» () </b><div class="spoiler_text"><ul>
<li>  Quagga:<br>
<pre><code class="plaintext hljs">yum install -y quagga<font></font>
systemctl enable zebra &amp;&amp; systemctl start zebra &amp;&amp; systemctl status zebra<font></font>
cp /usr/share/doc/quagga-0.99.22.4/bgpd.conf.sample /etc/quagga/bgpd.conf<font></font>
systemctl start bgpd &amp;&amp; systemctl enable bgpd &amp;&amp; systemctl status bgpd<font></font>
chmod -R 777 /etc/quagga/<font></font>
vtysh<font></font>
show running-config<font></font>
config t</code></pre></li>
<li> BGP   <strong>Provider-1</strong><br>
<pre><code class="plaintext hljs">Provider-1# sh running-config<font></font>
Building configuration...<font></font>
Current configuration:<font></font>
!<font></font>
hostname Provider-1<font></font>
log file /var/log/quagga/quagga.log<font></font>
hostname bgpd<font></font>
log stdout<font></font>
!<font></font>
password zebra<font></font>
!<font></font>
interface eth0<font></font>
ipv6 nd suppress-ra<font></font>
!<font></font>
interface eth1<font></font>
ipv6 nd suppress-ra<font></font>
!<font></font>
interface lo<font></font>
!<font></font>
router bgp 65860<font></font>
bgp router-id 172.16.10.9<font></font>
network 172.16.1.0/24<font></font>
neighbor 172.16.10.10 remote-as 65880<font></font>
neighbor 172.16.10.10 description "Provider-3"<font></font>
neighbor 172.16.10.10 timers 30 90<font></font>
neighbor 172.16.10.10 soft-reconfiguration inbound<font></font>
!<font></font>
ip forwarding<font></font>
!<font></font>
line vty<font></font>
!<font></font>
end</code></pre></li>
<li> BGP   <strong>Provider-2</strong><br>
<pre><code class="plaintext hljs">Provider-2# sh running-config<font></font>
Building configuration...<font></font>
Current configuration:<font></font>
!<font></font>
hostname Provider-2<font></font>
log file /var/log/quagga/quagga.log<font></font>
hostname bgpd<font></font>
log stdout<font></font>
!<font></font>
password zebra<font></font>
!<font></font>
interface eth0<font></font>
ipv6 nd suppress-ra<font></font>
!<font></font>
interface eth1<font></font>
ipv6 nd suppress-ra<font></font>
!<font></font>
interface lo<font></font>
!<font></font>
router bgp 65870<font></font>
bgp router-id 172.16.10.13<font></font>
network 172.16.2.0/24<font></font>
neighbor 172.16.10.14 remote-as 65880<font></font>
neighbor 172.16.10.14 description "Provider-3"<font></font>
neighbor 172.16.10.14 timers 30 90<font></font>
neighbor 172.16.10.14 soft-reconfiguration inbound<font></font>
!<font></font>
ip forwarding<font></font>
!<font></font>
line vty<font></font>
!<font></font>
end</code></pre></li>
<li> BGP   <strong>Provider-3</strong><br>
<pre><code class="plaintext hljs">Provider-3# sh running-config<font></font>
Building configuration...<font></font>
Current configuration:<font></font>
!<font></font>
hostname Provider-3<font></font>
log file /var/log/quagga/quagga.log<font></font>
hostname bgpd<font></font>
log stdout<font></font>
!<font></font>
password zebra<font></font>
!<font></font>
interface eth0<font></font>
ipv6 nd suppress-ra<font></font>
!<font></font>
interface eth1<font></font>
ipv6 nd suppress-ra<font></font>
!<font></font>
interface eth2<font></font>
ipv6 nd suppress-ra<font></font>
!<font></font>
interface lo<font></font>
!<font></font>
router bgp 65880<font></font>
bgp router-id 172.16.3.1<font></font>
network 172.16.3.0/24<font></font>
neighbor 172.16.10.9 remote-as 65860<font></font>
neighbor 172.16.10.9 description "Provider-1"<font></font>
neighbor 172.16.10.9 timers 30 90<font></font>
neighbor 172.16.10.9 soft-reconfiguration inbound<font></font>
neighbor 172.16.10.13 remote-as 65870<font></font>
neighbor 172.16.10.13 description "Provider-2"<font></font>
neighbor 172.16.10.13 timers 30 90<font></font>
neighbor 172.16.10.13 soft-reconfiguration inbound<font></font>
!<font></font>
ip forwarding<font></font>
!<font></font>
line vty<font></font>
!<font></font>
end</code></pre></li>
</ul></div></div><br>
<p>  BGP,      iptables  Â«Â» ,   .<br>
    ,     <strong>Provider-3</strong>   :</p><br>
<pre><code class="plaintext hljs">[root@Provider-3 ~]# ip route<font></font>
169.254.0.0/16 dev eth0 scope link metric 1002<font></font>
169.254.0.0/16 dev eth1 scope link metric 1003<font></font>
169.254.0.0/16 dev eth2 scope link metric 1004<font></font>
172.16.1.0/24 via 172.16.10.9 dev eth0 proto zebra<font></font>
172.16.2.0/24 via 172.16.10.13 dev eth1 proto zebra<font></font>
172.16.3.0/24 dev eth2 proto kernel scope link src 172.16.3.1<font></font>
172.16.10.8/30 dev eth0 proto kernel scope link src 172.16.10.10<font></font>
172.16.10.12/30 dev eth1 proto kernel scope link src 172.16.10.14</code></pre><br>
<p>          BGP   172.16.1.0/24  172.16.2.0/24,         .</p><br>
<p>,   <strong>Provider-1</strong>  <strong>Provider-2</strong>,    172.16.3.0/24      .</p><br>
<div class="spoiler"><b class="spoiler_title">  VyOS1  VyOS2   ,      VLAN17, 32, 40</b><div class="spoiler_text"><ul>
<li>       <strong>Provider-1</strong>  <strong>Provider-2</strong>:<br>
<pre><code class="plaintext hljs">set protocols static route 0.0.0.0/0 next-hop 172.16.1.1<font></font>
set protocols static route 0.0.0.0/0 next-hop 172.16.2.1<font></font>
set load-balancing wan interface-health eth1 failure-count 3<font></font>
set load-balancing wan interface-health eth1 nexthop 172.16.1.1<font></font>
set load-balancing wan interface-health eth1 test 10 type ping<font></font>
set load-balancing wan interface-health eth1 test 10 target 172.16.3.1<font></font>
set load-balancing wan interface-health eth2 failure-count 3<font></font>
set load-balancing wan interface-health eth2 nexthop 172.16.2.1<font></font>
set load-balancing wan interface-health eth2 test 10 type ping<font></font>
set load-balancing wan interface-health eth2 test 10 target 172.16.3.1</code></pre></li>
<li>       : <br>
<pre><code class="plaintext hljs">set load-balancing wan rule 10 inbound-interface eth+<font></font>
set load-balancing wan rule 10 destination address 172.20.40.0/23<font></font>
set load-balancing wan rule 10 exclude<font></font>
set load-balancing wan rule 20 inbound-interface eth+<font></font>
set load-balancing wan rule 20 destination address 172.20.32.0/23<font></font>
set load-balancing wan rule 20 exclude<font></font>
set load-balancing wan rule 30 inbound-interface eth+<font></font>
set load-balancing wan rule 30 destination address 172.20.1.0/24<font></font>
set load-balancing wan rule 30 exclude</code></pre></li>
<li>         ,    :<br>
<pre><code class="plaintext hljs">set load-balancing wan rule 1000 inbound-interface eth0<font></font>
set load-balancing wan rule 1000 interface eth1<font></font>
set load-balancing wan rule 1000 interface eth2<font></font>
set load-balancing wan rule 1010 inbound-interface eth3<font></font>
set load-balancing wan rule 1010 interface eth1<font></font>
set load-balancing wan rule 1010 interface eth2<font></font>
set load-balancing wan rule 1020 inbound-interface eth3<font></font>
set load-balancing wan rule 1020 interface eth1<font></font>
set load-balancing wan rule 1020 interface eth2<font></font>
commit</code></pre></li>
</ul></div></div><br>
<p><u></u>:<br>
<strong>eth+</strong>    ( ),      .</p><br>
<p>   :</p><br>
<pre><code class="plaintext hljs">show wan-load-balance<font></font>
show wan-load-balance connection</code></pre><br>
<p> :</p><br>
<pre><code class="plaintext hljs">restart wan-load-balance</code></pre><br>
<p><strong>       ,   </strong></p><br>
<ul>
<li>   </li>
<li>  <strong>VLAN30</strong>   <strong>Provider-1</strong></li>
<li>  <strong>bgpd</strong>   <strong>Provider-1</strong></li>
<li>  <strong>VLAN31</strong>   <strong>Provider-2</strong></li>
<li>  <strong>bgpd</strong>   <strong>Provider-2</strong></li>
<li>  <strong>VyOS1</strong></li>
<li>  <strong>VyOS1</strong></li>
<li>  <strong>VyOS2</strong></li>
<li>  <strong>VyOS2</strong></li>
</ul><br>
<p>    ,  ,  :</p><br>
<ul>
<li> <strong>ping</strong>  <strong>traceroute</strong>     , </li>
<li> <strong>ping</strong>  <strong>traceroute</strong>     , </li>
<li>        <strong>ssh</strong> , ,  <strong>http</strong>.</li>
</ul><br>
<p>        â€“       ,         .      ,       â€“        .</p><br>
<p>      NAT,   ,        ,        (      ).</p><br>
<p>     ,  -  ,    ,      ,     , , c  /27.<br>
  ,                ,          ,      PBR (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">policy-based routing</a>)  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">multipath routing</a>. ,       (   ,    :)).</p><br>
<h3 id="zaklyuchenie"></h3><br>
<p>         VyOS,             â€“  ,   ,      ,    .</p><br>
<p>  ,      -    ,      -    IP      /24,      BGP    . </p><br>
<p>             ,          ,                  .        ,       ,       ,     .</p><br>
<p>   ,            ,    ,       ,   :</p><br>
<ul>
<li>        ;</li>
<li>  oVirt;</li>
<li>      .</li>
</ul><br>
<p>      ,         -,     -  .        ,         . </p><br>
<p>,              â€¦        ,          .   ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Veeam</a> â€“     oVirt/RHEV     KVM,   ,        (<strong>Veritas NetBackup</strong>, <strong>Acronis Cyber Backup</strong>, <strong>TrilioVault</strong>, <strong>Bacula Enterprise Edition</strong>, <strong>SEP</strong>, etc.),  Â«Â» - ,  Â«Â» -   OpenSource ,    .</p><br>
<p>        ,       ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Zabbix</a> â€“     ,         .</p><br>
<p>, ,      â€“ ,             <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Cisco 3850</a>,            â€“     .            ,       .</p></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar487408/">https://habr.com/ru/post/ar487408/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar487394/index.html">ØªØ±Ø¬Ù…Ø© ÙƒØªØ§Ø¨ Ø£Ù†Ø¯Ø±Ùˆ Ø£ÙˆÙ† ØŒ Ø´ØºÙ Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø¢Ù„ÙŠ ØŒ Ø§Ù„ÙØµÙˆÙ„ 34 Ùˆ 35</a></li>
<li><a href="../ar487400/index.html">Ù…Ø§Ø¬Ø³ØªÙŠØ± SCADA 4D. Ù‡Ù„ Ù‡Ù†Ø§Ùƒ Ø­ÙŠØ§Ø© Ø¹Ù„Ù‰ ARMØŸ</a></li>
<li><a href="../ar487402/index.html">Ù…Ù†Ø¸Ù… ØªØ¯ÙÙ‚ Ø§Ù„ØºØ§Ø² Ø£Ø±Ø®Øµ 5 Ù…Ø±Ø§Øª Ù…Ù† Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©</a></li>
<li><a href="../ar487404/index.html">GoLang Ùˆ OpenCV (OpenVino && Cuda)</a></li>
<li><a href="../ar487406/index.html">Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ø¹ÙƒØ³ÙŠØ© Ù„Ø¬Ù‡Ø§Ø² ØªÙˆØ¬ÙŠÙ‡ Ù…Ù†Ø²Ù„ÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… binwalk. Ù‡Ù„ ØªØ«Ù‚ ÙÙŠ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¬Ù‡Ø§Ø² Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø®Ø§Øµ Ø¨ÙƒØŸ</a></li>
<li><a href="../ar487412/index.html">ØµØ¯ÙŠÙ‚ ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª</a></li>
<li><a href="../ar487414/index.html">Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ÙƒØ£Ø¯Ø§Ø© Ø±Ø§Ø¦Ø¹Ø© Ù„ØªØ¹Ù„Ù… Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</a></li>
<li><a href="../ar487416/index.html">Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø¬Ø­ÙŠÙ… Ø§Ù„ØªØ¨Ø¹ÙŠØ© ÙÙŠ QlikView</a></li>
<li><a href="../ar487418/index.html">Ù…Ø§ Ù‡Ùˆ SAPØŸ</a></li>
<li><a href="../ar487420/index.html">Sound War Z. Ø§Ø®ØªØ¨Ø§Ø± Ù…ÙƒØ¨Ø±Ø§Øª Ø§Ù„ØµÙˆØª ÙˆØ³Ù…Ø§Ø¹Ø§Øª MusicDealer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>