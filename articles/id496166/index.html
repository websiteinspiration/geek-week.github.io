<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👄 🦊 🐉 Doctrine ResultSetMapping dengan Contoh 🤺 🕊️ 🙀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Doctrine ORM menyediakan alat yang nyaman bagi pengembang untuk mengambil data. Ini adalah DQL yang kuat untuk bekerja dengan cara berorientasi objek,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Doctrine ResultSetMapping dengan Contoh</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496166/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Doctrine ORM menyediakan alat yang nyaman bagi pengembang untuk mengambil data. </font><font style="vertical-align: inherit;">Ini adalah </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DQL yang</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kuat </font><font style="vertical-align: inherit;">untuk bekerja dengan cara berorientasi objek, dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Query Builder yang nyaman</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sederhana dan intuitif untuk digunakan. </font><font style="vertical-align: inherit;">Mereka mencakup sebagian besar kebutuhan, tetapi kadang-kadang menjadi perlu untuk menggunakan query SQL yang dioptimalkan atau khusus untuk DBMS tertentu. </font><font style="vertical-align: inherit;">Untuk bekerja dengan hasil kueri dalam kode, pemahaman tentang bagaimana pemetaan dalam pekerjaan Ajaran adalah penting.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6v/jr/gx/6vjrgxkxjkih5otk5mussb5_cma.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Doctrine ORM didasarkan pada pola </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data Mapper</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang mengisolasi representasi relasional dari representasi objek dan mengubah data di antara mereka. </font><font style="vertical-align: inherit;">Salah satu komponen utama dari proses ini adalah objek </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ResultSetMapping</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang menjelaskan cara mengubah hasil kueri dari model relasional ke objek satu. </font><font style="vertical-align: inherit;">Doctrine selalu menggunakan ResultSetMapping untuk menyajikan hasil kueri, tetapi biasanya objek ini dibuat berdasarkan anotasi atau yaml, konfigurasi xml, tetap disembunyikan dari mata pengembang, oleh karena itu tidak semua orang tahu tentang kemampuannya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk contoh bekerja dengan ResultSetMapping, saya akan menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">database sampel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MySQL dan </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">karyawan</font></a><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Struktur DB</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/oc/qf/zy/ocqfzydztc0ia9euzhyalw8cksa.png"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita gambarkan entitas Departemen, Karyawan, Gaji, yang dengannya kami akan terus bekerja lebih jauh. </font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deparment</font></font></b><div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>;<font></font>
<font></font>
<span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">ORM</span>\<span class="hljs-title">Mapping</span> <span class="hljs-title">as</span> <span class="hljs-title">ORM</span>;<font></font>
<font></font>
<span class="hljs-comment">/**
 * Departments
 *
 * <span class="hljs-doctag">@ORM</span>\Table(name="departments", uniqueConstraints={<span class="hljs-doctag">@ORM</span>\UniqueConstraint(name="dept_name", columns={"dept_name"})})
 * <span class="hljs-doctag">@ORM</span>\Entity
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Department</span>
</span>{
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@var</span> string
     *
     * <span class="hljs-doctag">@ORM</span>\Column(name="dept_no", type="string", length=4, nullable=false, options={"fixed"=true})
     * <span class="hljs-doctag">@ORM</span>\Id
     * <span class="hljs-doctag">@ORM</span>\GeneratedValue(strategy="IDENTITY")
     */</span>
    <span class="hljs-keyword">private</span> $deptNo;<font></font>
<font></font>
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@var</span> string
     *
     * <span class="hljs-doctag">@ORM</span>\Column(name="dept_name", type="string", length=40, nullable=false)
     */</span>
    <span class="hljs-keyword">private</span> $deptName;<font></font>
<font></font>
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@var</span> \Doctrine\Common\Collections\Collection
     *
     * <span class="hljs-doctag">@ORM</span>\ManyToMany(targetEntity="Employee", mappedBy="deptNo")
     */</span>
    <span class="hljs-keyword">private</span> $empNo;<font></font>
<font></font>
    <span class="hljs-comment">/**
     * Constructor
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;empNo = <span class="hljs-keyword">new</span> \Doctrine\Common\Collections\ArrayCollection();<font></font>
    }<font></font>
}<font></font>
<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Karyawan</font></font></b><div class="spoiler_text"><br>
&lt;?php<br>
<br>
namespace App\Entity;<br>
<br>
use Doctrine\ORM\Mapping as ORM;<br>
<br>
/**<br>
 * Employees<br>
 *<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\Table(name=«employees»)<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\Entity<br>
 */<br>
class Employee<br>
{<br>
 /**<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">var</a> int<br>
 *<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\Column(name=«emp_no», type=«integer», nullable=false)<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\Id<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\GeneratedValue(strategy=«IDENTITY»)<br>
 */<br>
 private $empNo;<br>
<br>
/**<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">var</a> \DateTime<br>
 *<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\Column(name=«birth_date», type=«date», nullable=false)<br>
 */<br>
 private $birthDate;<br>
<br>
/**<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">var</a> string<br>
 *<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\Column(name=«first_name», type=«string», length=14, nullable=false)<br>
 */<br>
 private $firstName;<br>
<br>
/**<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">var</a> string<br>
 *<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\Column(name=«last_name», type=«string», length=16, nullable=false)<br>
 */<br>
 private $lastName;<br>
<br>
/**<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">var</a> string<br>
 *<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\Column(name=«gender», type=«string», length=0, nullable=false)<br>
 */<br>
 private $gender;<br>
<br>
/**<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">var</a> \DateTime<br>
 *<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\Column(name=«hire_date», type=«date», nullable=false)<br>
 */<br>
 private $hireDate;<br>
<br>
/**<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">var</a> \Doctrine\Common\Collections\Collection<br>
 *<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\ManyToMany(targetEntity=«Department», inversedBy=«empNo»)<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\JoinTable(name=«dept_manager»,<br>
 * joinColumns={<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\JoinColumn(name=«emp_no», referencedColumnName=«emp_no»)<br>
 * },<br>
 * inverseJoinColumns={<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\JoinColumn(name=«dept_no», referencedColumnName=«dept_no»)<br>
 * }<br>
 * )<br>
 */<br>
 private $deptNo;<br>
<br>
/**<br>
 * Constructor<br>
 */<br>
 public function __construct()<br>
 {<br>
 $this-&gt;deptNo = new \Doctrine\Common\Collections\ArrayCollection();<br>
 }<br>
<br>
}<br>
<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gaji</font></font></b><div class="spoiler_text">&lt;?php<br>
<br>
namespace App\Entity;<br>
<br>
use Doctrine\ORM\Mapping as ORM;<br>
<br>
/**<br>
 * Salaries<br>
 *<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\Table(name=«salaries», indexes={@ORM\Index(name=«IDX_E6EEB84BA2F57F47», columns={«emp_no»})})<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\Entity<br>
 */<br>
class Salary<br>
{<br>
 /**<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">var</a> \DateTime<br>
 *<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\Column(name=«from_date», type=«date», nullable=false)<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\Id<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\GeneratedValue(strategy=«NONE»)<br>
 */<br>
 private $fromDate;<br>
<br>
/**<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">var</a> int<br>
 *<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\Column(name=«salary», type=«integer», nullable=false)<br>
 */<br>
 private $salary;<br>
<br>
/**<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">var</a> \DateTime<br>
 *<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\Column(name=«to_date», type=«date», nullable=false)<br>
 */<br>
 private $toDate;<br>
<br>
/**<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">var</a> Employee<br>
 *<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\Id<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\OneToOne(targetEntity=«Employee»)<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\JoinColumns({<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ORM</a>\JoinColumn(name=«emp_no», referencedColumnName=«emp_no»)<br>
 * })<br>
 */<br>
 private $empNo;<br>
<br>
/**<br>
 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">var</a> Employee<br>
 *<br>
 */<br>
 private $employee;<br>
<br>
}<br>
<br>
</div></div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hasil entitas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita mulai dengan yang sederhana, pilih semua departemen dari pangkalan dan proyeksikan ke Departemen:</font></font><br>
<br>
<pre><code class="php hljs">        $rsm = <span class="hljs-keyword">new</span> Query\ResultSetMapping();<font></font>
        $rsm-&gt;addEntityResult(Department::class, <span class="hljs-string">'d'</span>);<font></font>
        $rsm-&gt;addFieldResult(<span class="hljs-string">'d'</span>, <span class="hljs-string">'dept_no'</span>, <span class="hljs-string">'deptNo'</span>);<font></font>
        $rsm-&gt;addFieldResult(<span class="hljs-string">'d'</span>, <span class="hljs-string">'dept_name'</span>, <span class="hljs-string">'deptName'</span>);<font></font>
<font></font>
        $sql = <span class="hljs-string">'SELECT * FROM departments'</span>;<font></font>
<font></font>
        $query = <span class="hljs-keyword">$this</span>-&gt;entityManager-&gt;createNativeQuery($sql, $rsm);<font></font>
<font></font>
        $result = $query-&gt;getResult();<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">addEntityResult</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menunjukkan kelas mana sampel kami akan diproyeksikan, dan metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">addFieldResult</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menunjukkan pemetaan antara kolom sampel dan bidang objek. </font><font style="vertical-align: inherit;">Kueri SQL yang diteruskan ke metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">createNativeQuery</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan ditransfer ke database dalam formulir ini dan Doctrine tidak akan memodifikasinya dengan cara apa pun. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perlu diingat bahwa Entitas tentu memiliki pengidentifikasi unik, yang harus dimasukkan dalam fieldResult.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hasil Entitas yang Bergabung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami memilih departemen di mana ada karyawan yang dipekerjakan setelah awal tahun 2000, bersama dengan karyawan ini.</font></font><br>
<br>
<pre><code class="php hljs">        $rsm = <span class="hljs-keyword">new</span> Query\ResultSetMapping();<font></font>
        $rsm-&gt;addEntityResult(Department::class, <span class="hljs-string">'d'</span>);<font></font>
        $rsm-&gt;addFieldResult(<span class="hljs-string">'d'</span>, <span class="hljs-string">'dept_no'</span>, <span class="hljs-string">'deptNo'</span>);<font></font>
        $rsm-&gt;addFieldResult(<span class="hljs-string">'d'</span>, <span class="hljs-string">'dept_name'</span>, <span class="hljs-string">'deptName'</span>);<font></font>
<font></font>
        $rsm-&gt;addJoinedEntityResult(Employee::class, <span class="hljs-string">'e'</span>, <span class="hljs-string">'d'</span>, <span class="hljs-string">'empNo'</span>);<font></font>
        $rsm-&gt;addFieldResult(<span class="hljs-string">'e'</span>, <span class="hljs-string">'first_name'</span>, <span class="hljs-string">'firstName'</span>);<font></font>
        $rsm-&gt;addFieldResult(<span class="hljs-string">'e'</span>, <span class="hljs-string">'last_name'</span>, <span class="hljs-string">'lastName'</span>);<font></font>
        $rsm-&gt;addFieldResult(<span class="hljs-string">'e'</span>, <span class="hljs-string">'birth_date'</span>, <span class="hljs-string">'birthDate'</span>);<font></font>
        $rsm-&gt;addFieldResult(<span class="hljs-string">'e'</span>, <span class="hljs-string">'gender'</span>, <span class="hljs-string">'gender'</span>);<font></font>
        $rsm-&gt;addFieldResult(<span class="hljs-string">'e'</span>, <span class="hljs-string">'hire_date'</span>, <span class="hljs-string">'hireDate'</span>);<font></font>
<font></font>
        $sql = <span class="hljs-string">"
        SELECT *
            FROM departments d
            JOIN dept_emp ON d.dept_no = dept_emp.dept_no
            JOIN employees e on dept_emp.emp_no = e.emp_no
        WHERE e.hire_date &gt; DATE ('1999-12-31')
       "</span>;<font></font>
<font></font>
        $query = <span class="hljs-keyword">$this</span>-&gt;entityManager-&gt;createNativeQuery($sql, $rsm);<font></font>
<font></font>
        $result = $query-&gt;getResult();<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ResultSetMappingBuilder</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang Anda lihat, bekerja langsung dengan objek ResultSetMapping agak rumit dan membuatnya sangat rinci untuk menggambarkan perbandingan pemilihan dan objek. Selain itu, Doctrine menyediakan alat yang lebih nyaman - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ResultSetMappingBuilder</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang merupakan pembungkus RSM dan menambahkan metode yang lebih nyaman untuk bekerja dengan pemetaan. Misalnya, metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">generateSelectClause</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang memungkinkan Anda membuat parameter untuk bagian SELECT dari kueri dengan deskripsi bidang yang diperlukan untuk pemilihan. Permintaan sebelumnya dapat ditulis ulang dalam bentuk yang lebih sederhana.</font></font><br>
<br>
<pre><code class="php hljs">        $sql = <span class="hljs-string">"
        SELECT {$rsm-&gt;generateSelectClause()}
            FROM departments d
            JOIN dept_emp ON d.dept_no = dept_emp.dept_no
            JOIN employees e on dept_emp.emp_no = e.emp_no
        WHERE e.hire_date &gt; DATE ('1999-12-31')
       "</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perlu dicatat bahwa jika Anda tidak menentukan semua bidang objek yang dibuat, Doktrin akan mengembalikan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">objek parsial</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang penggunaannya dapat dibenarkan dalam beberapa kasus, tetapi </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perilakunya berbahaya dan tidak direkomendasikan</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Sebagai gantinya, ResultSetMappingBuilder memungkinkan Anda untuk tidak menentukan setiap bidang dari kelas akhir, tetapi menggunakan entitas yang dijelaskan melalui anotasi (konfigurasi yaml, xml). </font><font style="vertical-align: inherit;">Kami menulis ulang RSM kami dari permintaan sebelumnya, dengan mempertimbangkan metode ini:</font></font><br>
<br>
<pre><code class="php hljs">        $rsm = <span class="hljs-keyword">new</span> Query\ResultSetMappingBuilder(<span class="hljs-keyword">$this</span>-&gt;entityManager);<font></font>
        $rsm-&gt;addRootEntityFromClassMetadata(Department::class, <span class="hljs-string">'d'</span>);<font></font>
        $rsm-&gt;addJoinedEntityFromClassMetadata(Employee::class, <span class="hljs-string">'e'</span>, <span class="hljs-string">'d'</span>, <span class="hljs-string">'empNo'</span>);
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hasil skalar</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penggunaan entitas yang dideskripsikan secara luas tidak dibenarkan, hal itu dapat menyebabkan masalah kinerja, karena Doktrin perlu membuat banyak objek yang tidak akan digunakan sepenuhnya di masa depan. </font><font style="vertical-align: inherit;">Untuk kasus-kasus seperti itu, alat pemetaan hasil skalar, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">addScalarResult, disediakan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pilih gaji rata-rata untuk setiap departemen:</font></font><br>
<br>
<pre><code class="php hljs">        $rsm = <span class="hljs-keyword">new</span> ResultSetMappingBuilder(<span class="hljs-keyword">$this</span>-&gt;entityManager);<font></font>
<font></font>
        $rsm-&gt;addScalarResult(<span class="hljs-string">'dept_name'</span>, <span class="hljs-string">'department'</span>, <span class="hljs-string">'string'</span>);<font></font>
        $rsm-&gt;addScalarResult(<span class="hljs-string">'avg_salary'</span>, <span class="hljs-string">'salary'</span>, <span class="hljs-string">'integer'</span>);<font></font>
<font></font>
        $sql = <span class="hljs-string">"
            SELECT d.dept_name, AVG(s.salary) AS avg_salary
            FROM departments d
            JOIN dept_emp de on d.dept_no = de.dept_no
            JOIN employees e on de.emp_no = e.emp_no
            JOIN salaries s on e.emp_no = s.emp_no
            GROUP BY d.dept_name
        "</span>;<font></font>
<font></font>
        $query = <span class="hljs-keyword">$this</span>-&gt;entityManager-&gt;createNativeQuery($sql, $rsm);<font></font>
<font></font>
        $result = $query-&gt;getResult();<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Argumen pertama ke metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">addScalarResult</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah nama kolom di set hasil, dan yang kedua adalah kunci untuk array hasil yang akan dikembalikan oleh Doktrin. </font><font style="vertical-align: inherit;">Parameter ketiga adalah jenis nilai hasil. </font><font style="vertical-align: inherit;">Nilai kembali akan selalu berupa array array.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pemetaan DTO</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi bekerja dengan array, terutama ketika mereka memiliki struktur yang kompleks, sangat tidak nyaman. </font><font style="vertical-align: inherit;">Anda perlu mengingat nama-nama kunci, jenis bidang. </font><font style="vertical-align: inherit;">Doctrine DQL memiliki kemampuan untuk menggunakan DTO sederhana dalam hasil pemilihan, misalnya:</font></font><br>
<br>
<pre><code class="php hljs">    SELECT <span class="hljs-keyword">NEW</span> DepartmentSalary(d.dept_no, avg_salary) <span class="hljs-keyword">FROM</span> …</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagaimana dengan Native Query dan RSM? </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Doctrine tidak menyediakan kapabilitas terdokumentasi untuk membuat DTO baru</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tetapi dengan menggunakan properti </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">newObjectMappings,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kita dapat menentukan objek yang ingin kita petakan hasil seleksi. </font><font style="vertical-align: inherit;">Tidak seperti Entity, objek ini tidak akan dikontrol oleh UnitOfWork, dan tidak diharuskan berada dalam ruang nama yang ditentukan dalam konfigurasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lengkapi RSM dari contoh sebelumnya:</font></font><br>
<br>
<pre><code class="php hljs">        $rsm-&gt;newObjectMappings[<span class="hljs-string">'dept_name'</span>] = [
            <span class="hljs-string">'className'</span> =&gt; DepartmentSalary::class,
            <span class="hljs-string">'argIndex'</span> =&gt; <span class="hljs-number">0</span>,
            <span class="hljs-string">'objIndex'</span> =&gt; <span class="hljs-number">0</span>,<font></font>
        ];<font></font>
<font></font>
        $rsm-&gt;newObjectMappings[<span class="hljs-string">'avg_salary'</span>] = [
            <span class="hljs-string">'className'</span> =&gt; DepartmentSalary::class,
            <span class="hljs-string">'argIndex'</span> =&gt; <span class="hljs-number">1</span>,
            <span class="hljs-string">'objIndex'</span> =&gt; <span class="hljs-number">0</span>,<font></font>
        ];<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kunci dalam array bidang newObjectMappings menunjuk ke kolom yang dihasilkan, tetapi nilainya array lain yang menggambarkan objek yang sedang dibuat. </font><font style="vertical-align: inherit;">Kunci </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">className</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mendefinisikan nama kelas dari objek baru, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">argIndex</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - urutan argumen dalam konstruktor objek, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">objIndex</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - urutan objek, jika kita ingin mendapatkan beberapa objek dari setiap baris pilihan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hasil meta</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasil meta digunakan untuk mendapatkan meta-data kolom, seperti kunci asing atau kolom diskriminator. </font><font style="vertical-align: inherit;">Sayangnya, saya tidak dapat memberikan contoh berdasarkan pada database karyawan, jadi saya harus membatasi diri pada deskripsi dan contoh dari </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dokumentasi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="php hljs">        $rsm = <span class="hljs-keyword">new</span> ResultSetMapping;<font></font>
        $rsm-&gt;addEntityResult(<span class="hljs-string">'User'</span>, <span class="hljs-string">'u'</span>);<font></font>
        $rsm-&gt;addFieldResult(<span class="hljs-string">'u'</span>, <span class="hljs-string">'id'</span>, <span class="hljs-string">'id'</span>);<font></font>
        $rsm-&gt;addFieldResult(<span class="hljs-string">'u'</span>, <span class="hljs-string">'name'</span>, <span class="hljs-string">'name'</span>);<font></font>
        $rsm-&gt;addMetaResult(<span class="hljs-string">'u'</span>, <span class="hljs-string">'address_id'</span>, <span class="hljs-string">'address_id'</span>);<font></font>
<font></font>
        $query = <span class="hljs-keyword">$this</span>-&gt;_em-&gt;createNativeQuery(<span class="hljs-string">'SELECT id, name, address_id FROM users WHERE name = ?'</span>, $rsm);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kasus ini, dengan metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">addMetaResult,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kami memberi tahu Doctine bahwa tabel pengguna memiliki kunci asing pada alamat, tetapi alih-alih memuat asosiasi ke dalam memori (eager load), kami membuat objek-proxy yang menyimpan pengenal entitas, dan ketika diakses, itu memuat dia dari database. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Database relasional klasik tidak menawarkan mekanisme pewarisan tabel, sementara pewarisan tersebar luas dalam model objek. </font><font style="vertical-align: inherit;">Hasil seleksi kami dapat diproyeksikan ke hierarki kelas, menurut beberapa atribut, yang merupakan nilai dari kolom &lt;discriminator_column&gt; dalam pilihan yang dihasilkan. </font><font style="vertical-align: inherit;">Dalam hal ini, kita dapat memberi tahu RSM kolom mana yang harus menentukan kelas </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instantiated</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan menggunakan metode </font><i><font style="vertical-align: inherit;">setDiscriminatorColumn</font></i><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Doktrin sangat kaya akan berbagai fitur, termasuk yang tidak semua pengembang ketahui. </font><font style="vertical-align: inherit;">Dalam posting ini, saya mencoba untuk memperkenalkan pemahaman tentang pengoperasian salah satu komponen utama ORM - ResultSetMapping dalam kombinasi dengan Native Query. </font><font style="vertical-align: inherit;">Menggunakan kueri yang benar-benar kompleks dan spesifik platform, sambil mempertahankan ketersediaan dan kelengkapan contoh, akan menjadi tugas yang sulit, karena penekanannya adalah pada memahami pekerjaan ResultSetMapping. </font><font style="vertical-align: inherit;">Setelah itu, Anda bisa menggunakannya dalam permintaan yang sangat kompleks untuk basis data Anda.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id496154/index.html">Otomasi Layanan Pelanggan: Solusi ujung ke ujung dari DeepPavlov</a></li>
<li><a href="../id496156/index.html">Bagaimana Sistem Analisis Lalu Lintas Mendeteksi Taktik Peretas oleh MITER ATT & CK, Bagian 3</a></li>
<li><a href="../id496160/index.html">Kami mempelajari mesin VoIP Mediastreamer2. Bagian 5</a></li>
<li><a href="../id496162/index.html">Terraform, repositori mono dan kepatuhan sebagai kode</a></li>
<li><a href="../id496164/index.html">Selama krisis saya kehilangan pekerjaan dan sekarang saya takut menulis kode pintar agar tidak menakut-nakuti lowongan terbaru</a></li>
<li><a href="../id496170/index.html">Kita ditakdirkan # 1 // Udalenka dalam krisis dan kematian orisinalitas</a></li>
<li><a href="../id496174/index.html">Meningkatnya permintaan akan analitik, tim produk, Amazon, Israel, Singapura, pekerjaan jarak jauh, dll. - banyak dibahas.</a></li>
<li><a href="../id496176/index.html">Konferensi virtual besar: Pengalaman dunia nyata dalam melindungi data dari perusahaan digital modern</a></li>
<li><a href="../id496178/index.html">Cepat 5.2. Ikhtisar semua perubahan</a></li>
<li><a href="../id496180/index.html">Jaga bayangan dari masa muda</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>