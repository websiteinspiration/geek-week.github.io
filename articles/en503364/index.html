<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôçüèø üíà üìí HandsAppMVP: iOS architecture for studio development outsourcing üÜö üöï üë®üèª‚Äçüåæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good code starts with architecture, and iOS apps are no exception. There are many standard patterns, but the purpose of this article is not to talk ab...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>HandsAppMVP: iOS architecture for studio development outsourcing</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/503364/"><img src="https://habrastorage.org/webt/01/ch/_7/01ch_7_gicde7x_bhhlzcbhxzzq.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Good code starts with architecture, and iOS apps are no exception. </font><font style="vertical-align: inherit;">There are many standard patterns, but the purpose of this article is not to talk about them, but about the experience of adapting one of them and developing your own. </font><font style="vertical-align: inherit;">We called this adaptation HandsAppMVP.</font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/iy/lv/a8/iylva8cqu4kcrnft2g2ygjvwngy.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In iOS development, the architecture primarily determines the organization of classes and dependencies for one specific ViewController. </font><font style="vertical-align: inherit;">However, the central component can be not only he, but simply UIView. </font><font style="vertical-align: inherit;">The choice depends on the specific task.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Architecture comparison</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are several standard architectural templates for iOS: MVC, MVP, MVVM, VIPER (links to the description of each can be found at the end of the article). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Choosing an architecture for development, we identified the main parameters that it should correspond to: development speed, flexibility, and a low entry threshold. Next, we took up the comparison of three well-known architectures with these parameters in mind (the MVC iOS community template has long been buried due to gross non-compliance with single responsibility). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For an outsourcing team, development speed is especially important. VIPER is the most complex and ‚Äúslow‚Äù architecture; development is faster using pure MVP or MVVM, as they have fewer components.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Flexibility means the painless addition or removal of functionality in the application. This parameter strongly correlates with the development speed at all stages of the application life, except for the initial one. Flexibility is also closely related to the simplicity of testing - automatic tests give the developer confidence that he will not break anything, and help to avoid bugs. Classical MVP is poorly covered by tests, especially if you do not use the class interfaces discussed below. MVVM from the point of view of testing also has poor performance, because testing reactive code takes much longer. VIPER is great for writing tests because it respects the principle of sole responsibility as much as possible and classes depend on abstractions.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And the last parameter that we considered is the entry threshold. </font><font style="vertical-align: inherit;">It shows how quickly new developers (first of all, the jones) penetrate into architecture. </font><font style="vertical-align: inherit;">Here MVVM using third-party reactive libraries (RxSwift, PromiseKit, etc.) takes an honorable last place for obvious reasons. </font><font style="vertical-align: inherit;">VIPER is also a rather complex architecture due to the large number of components. </font><font style="vertical-align: inherit;">MVP has the lowest entry threshold. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After weighing the pros and cons, we came to the conclusion that we need something as simple as MVP, and as flexible as VIPER. </font><font style="vertical-align: inherit;">So the idea was born to create their own architecture based on them - HandsAppMVP.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Expand MVP</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main components of our architecture are Model, View, Presenter. </font><font style="vertical-align: inherit;">They perform the same functions as in the classical MVP according to the well-known scheme: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/af/pv/w0/afpvw04g8ed4z5ekrdfz6srthdi.png" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[Scheme of the classical MVP]</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Here and below, each interaction component (blue square) in the diagrams is a class whose lifetime coincides with the lifetime of the View. </font><font style="vertical-align: inherit;">A solid arrow indicates ownership of another object, a strong link, and a dotted arrow indicates a weak link. </font><font style="vertical-align: inherit;">With weak references, we prevent circular dependencies and memory leaks.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interfaces</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, we added the ViewInput and ViewOutput interfaces to this classic schema. </font><font style="vertical-align: inherit;">We took into account the fifth principle of SOLID - the principle of dependency inversion. </font><font style="vertical-align: inherit;">It is more likely not an addition, but a refinement for MVP. </font><font style="vertical-align: inherit;">Dependence on abstractions helps to get rid of the strict connectedness of components and allows you to write tests normally. </font><font style="vertical-align: inherit;">The scheme taking into account the interfaces looks like this: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nj/1k/kk/nj1kkk-j6gxd9ezng-ypprtow3a.png" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[Adding ViewInput and ViewOutput interfaces] A</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
small rectangle is an interface. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An attentive developer will ask, where are the interfaces for Model? </font><font style="vertical-align: inherit;">Now we turn to them.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Work with data</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The data model in mobile architectures is a collective concept. A standard example: an application knocks on the network to interact with the server, then saves data in CoreData for offline work, writes some simple information to UserDefaults and stores the JWT in Keychain. All this data that is being interacted with makes up the Model. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The class that is responsible for interacting with the data container of a particular type, we call the data service. For each container (remote database, local database, UserDefaults, etc.), a service class is added to HandsAppMVP that interacts with the presenter. Now you can also add input / output interfaces for each data service: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ff/i3/xr/ffi3xrythzbe8w3pwlakmmkpkpk.png" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[Adding services for working with data]</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Not every service class needs to be connected to the presenter using an interface, as, for example, when using Moya. </font><font style="vertical-align: inherit;">Moya is an open-source network library. </font><font style="vertical-align: inherit;">Moya provides a ready-made service class (MoyaProvider), and when writing tests, we do not have to create a mock object that replaces ApiProvider. </font><font style="vertical-align: inherit;">Moya provides a special test mode, when turned on, MoyaProvider does not knock on the network, but returns test data (more details can be found here). </font><font style="vertical-align: inherit;">In this case, the presenter does not refer to the MoyaProvider abstraction, but to the implementation. </font><font style="vertical-align: inherit;">And we get feedback from this service using closures. </font><font style="vertical-align: inherit;">An example implementation can be found in the demo project. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This example is more an exception than a rule, and shows that adherence to SOLID is not always the best solution.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Navigation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We consider navigation in the application as a separate responsibility. </font><font style="vertical-align: inherit;">For her, HandsAppMVP uses a special class - Router. </font><font style="vertical-align: inherit;">The router contains a weak link to the View, with which it can show a new screen or close the current one. </font><font style="vertical-align: inherit;">Router also interacts with the presenter using the RouterInput interface: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/l7/yp/_k/l7yp_kce5hkr1rel_cdcogrt5mw.png" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[Adding a component for navigation (Router)]</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Component assembly</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The last addition to the classic MVP that we use is Assembly, a collector class. </font><font style="vertical-align: inherit;">It is used to initialize the View and other components of HandsAppMVP, as well as to implement dependencies. </font><font style="vertical-align: inherit;">Assembly contains the only public method - `assemble () -&gt; UIViewController`, the result of which is the desired UIViewController (or UIView) with the necessary dependency graph. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will not show Assembly on the architecture diagram, since it is not connected with MVP components and its life cycle ends immediately after they are created.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code Generation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To save time, we automated the process of creating HandsAppMVP classes using Generamba. </font><font style="vertical-align: inherit;">The templates used for Generamba can be found in our repository. </font><font style="vertical-align: inherit;">An example config for Generamba is in the demo project. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result of generating a specific screen, we get a set of classes that corresponds to the HandsAppMVP scheme, a set of unit tests for creating and implementing components, and also a template class for presenter tests.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What happened</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you compare Head-to-Head HandsAppMVP and VIPER, you will notice that they are very similar and the first differs only in the absence of the Interactor component. But, getting rid of the layer between the services and the present (the interactor), as well as simplifying the interaction with the network using Moya, we received a noticeable increase in the development speed. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We advise you to pay enough attention to architecture at the design stage in order to avoid global errors, disputes with customers and torment of developers in the future, and instead lead the development process competently and predictably.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Remember that any architecture may not be suitable specifically for your project, so do not rush to blindly cling to ready-made templates and successful stories of their application. </font><font style="vertical-align: inherit;">Do not be afraid to develop and apply your solutions - they can become more valuable and flexible for you than ready-made ones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In conclusion, we will recommend some good articles on the architecture of iOS applications that helped us understand the intricacies and make a choice:</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Architectural patterns in iOS</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iOS Swift: MVP Architecture</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analysis of VIPER architecture on the example of a small iOS application on Swift 4</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implement MVVM on iOS with RxSwift</font></font></a></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SurfStudio </font><font style="vertical-align: inherit;">
's </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">open-source documentation was</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> also very helpful and inspired </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finally, we are putting a link on the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DEMO project</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , written in HandsAppMVP, which we have repeatedly mentioned in the article.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en503330/index.html">How to Learn from a Data Scientist: The Most Wanted Technical Skills</a></li>
<li><a href="../en503338/index.html">My works for Outline 2020</a></li>
<li><a href="../en503342/index.html">The simplest model of macroeconomics and trends in market information support</a></li>
<li><a href="../en503346/index.html">Conference website supported by the Ministry of Serbia</a></li>
<li><a href="../en503358/index.html">3D ML. Part 1: 3D Data Presentation Forms</a></li>
<li><a href="../en503366/index.html">Why is a dash becoming a question? Or problems with coding data in SQL</a></li>
<li><a href="../en503368/index.html">Gigantomania: why do modern games weigh so much?</a></li>
<li><a href="../en503372/index.html">Ethereum 2.0 may be delayed again due to errors, problems and competitors</a></li>
<li><a href="../en503380/index.html">Asynchronous Jobs in Django with Celery</a></li>
<li><a href="../en503382/index.html">Rake walking in a clean field or how to collect MAC addresses of nearby Wi-Fi devices</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>