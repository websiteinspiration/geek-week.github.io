<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧘 🧛🏿 🌾 Eisen oder Optimierung? Badoo, Avito und Mamba - über die PHP-Leistung 😼 🐅 👐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Das PHP-Leistungsproblem für Badoo ist eines der wichtigsten. Die Qualität des PHP-Backends hängt direkt von der Menge der Ressourcen ab, die wir für ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Eisen oder Optimierung? Badoo, Avito und Mamba - über die PHP-Leistung</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/487234/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das PHP-Leistungsproblem für Badoo ist eines der wichtigsten. Die Qualität des PHP-Backends hängt direkt von der Menge der Ressourcen ab, die wir für Entwicklung und Betrieb ausgeben, von der Geschwindigkeit des Dienstes und von dem Eindruck, den es auf die Benutzer macht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus diesem Grund haben wir beim Thema des dritten Treffens der Community von PHP-Entwicklern in unserem Büro Backend-Performance gemacht und Kollegen von Avito und Mamba zur Diskussion eingeladen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t-/p7/se/t-p7sef1pbww8vboigkup6ditzu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lesen Sie unter dem Zwischensequenzprotokoll der Diskussion, in der ich das Glück hatte, Moderator zu sein: Wie die Infrastruktur der drei Unternehmen aufgebaut ist, wie wir die Produktivität messen und auf welche Metriken wir uns konzentrieren, welche Tools wir verwenden, wie wir zwischen Hardware und Optimierung wählen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und am 15. Februar kommen Sie zum </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nächsten Badoo PHP Meetup</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Besprechen Sie Legacy.</font></font><br>
<a name="habracut"></a><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/kWBm0C9A8oo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe> <br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben nur den Teil der Diskussion entschlüsselt, der uns am interessantesten erschien. </font><font style="vertical-align: inherit;">Die Vollversion ist als Video verfügbar. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Experten:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Leiter der Entwicklungsabteilung bei Core Services Avito</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pmurzakov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, PHP Timlid in Badoo </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mipxtx</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, IT-Direktor von Mamba</font></font></li>
</ul><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erzählen Sie eine Geschichte über Optimierung aus Ihrer Praxis: Großer Erfolg oder großer Misserfolg ist etwas, das interessant zu teilen ist. </font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe ein Gleichnis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ungefähr alle sechs Monate schauen wir uns die Metriken an und suchen, was langsamer wird, nicht gut funktioniert und was optimiert werden muss. </font><font style="vertical-align: inherit;">Einmal bemerkten wir unseren Symfony-Abhängigkeitscontainer, der auf 52.000 Zeilen angewachsen war. </font><font style="vertical-align: inherit;">Wir entschieden, dass er, der Schurke, für alles verantwortlich war: 20 ms Overhead für jede Anfrage. </font><font style="vertical-align: inherit;">Wir haben es gesägt. </font><font style="vertical-align: inherit;">Wir haben es reduziert. </font><font style="vertical-align: inherit;">Wir haben irgendwie versucht, es zu trennen, aber nichts hat geholfen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und dann stellte sich heraus, dass wir Anti-Spam haben, das in 20 Datenbanken gehen muss, um alle erforderlichen Anforderungen zu erfüllen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Lösungen, die zuerst kommen, sind nicht immer die richtigen. </font><font style="vertical-align: inherit;">Sehen Sie sich die Spuren, Protokolle und Benchmarks Ihrer Anforderungen besser an und brechen Sie nicht direkt ab. </font><font style="vertical-align: inherit;">Hier ist eine Geschichte.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben ein ziemlich großes Ökosystem in PHP, daher führen wir regelmäßig Optimierungen durch. </font><font style="vertical-align: inherit;">Wir wachsen, wir erreichen ein gewisses Niveau in der CPU, wir verstehen, dass wir entweder Hardware kaufen oder optimieren müssen. </font><font style="vertical-align: inherit;">Wägen Sie die Argumente für und gegen jede Option ab und entscheiden Sie. </font><font style="vertical-align: inherit;">Meistens - zugunsten der Optimierung, weil Eisen viel braucht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An einem dieser Punkte haben wir eine ganze Gruppe identifiziert, die verschiedene nicht optimale Dinge in PHP-Skripten gesucht und optimiert hat. </font><font style="vertical-align: inherit;">Dies geschah buchstäblich „Tropfen für Tropfen“: Hier fanden sie einen Prozentsatz, dort fanden sie einen Prozentsatz - mehrere Personen fanden innerhalb eines Monats einen Prozentsatz. </font><font style="vertical-align: inherit;">Irgendwann war unser Sishnik in der Nähe</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einstein_man</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Er beschloss zu sehen, was er tun konnte: Er ging abends, startete Perf, fand ein paar Probleme mit PHP-Erweiterungen - und beschleunigte alles an ein paar Abenden um 13%!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe zwei Geschichten. Einer über die Datei, der andere über den Superentwickler. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Über den Fehler. Wir haben viele Microservices, einschließlich PHP. Jeder arbeitet bei Kubernetes. Ich habe an einem dieser Microservices gearbeitet. Es gab eine erhebliche CPU-Auslastung: Sie verbrachten eine Woche damit, Probleme zu optimieren und zu finden. Es stellte sich heraus, dass einer der Entwickler Xdebug zu den Basis-Images hinzufügte, um Code-Coverage-Tests in seinem (anderen) Service zu berechnen. Danach arbeiteten alle Microservices in der Produktion ein Viertel lang mit Xdebug! Nach einem Viertel entdeckten wir diese grundlegenden Bilder - und fingen an, unerwartete Geschenke zu fangen: Ich rollte meinen Dienst neu und es begann schneller zu funktionieren. Bei jeder Bereitstellung wird unser Service-Image neu erstellt und jetzt ohne Xdebug.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erfolgsgeschichte. Wir haben viele Microservices, und sie wurden immer mehr. In dieser Situation wird die Anzahl der RPC-Aufrufe zum Problem. Auf einer Ankündigungskarte - und dies ist eine der häufigsten Seiten in Avito - sind beispielsweise etwa 30 Microservices am Rendern einer Seite beteiligt. Darüber hinaus wurde dies alles nicht sehr explizit durchgeführt: Es scheint, als würden Sie eine Art Abstraktion aufrufen, und darunter werden fünf RPC-Aufrufe an andere Dienste nacheinander ausgeführt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Laufe der Jahre wurde die Ankündigungskarte stark verschlechtert. </font><font style="vertical-align: inherit;">Ein starker Entwickler kämpfte um ein Viertel, optimierte und brachte alle RPC-Aufrufe heraus. </font><font style="vertical-align: inherit;">Als er dazu in der Lage war, parallelisierte er sie über Guzzle Multi Request - und statt 30 aufeinanderfolgender synchroner Anfragen erhielt er dieselben 30 Anfragen, aber parallele, was die Arbeit erheblich beschleunigte. </font><font style="vertical-align: inherit;">Nach diesem Refactoring entspricht die Antwortzeit der Karte der maximalen Antwortzeit eines der Dienste. </font><font style="vertical-align: inherit;">Aber er brauchte ein ganzes Viertel, um den Anzeigecode der Ankündigungskarte zu optimieren / umzuschreiben.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sagen Sie uns, wie groß Ihr PHP-Cluster ist, wie er konfiguriert ist - zumindest PHP-FPM oder vielleicht irgendwo, wo Apache in Schwierigkeiten geraten ist?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben ungefähr 15.000 RPS. </font><font style="vertical-align: inherit;">Ein Cluster von 80 FPM-Servern, die vor einigen Jahren gekauft wurden. </font><font style="vertical-align: inherit;">In jedem Cluster wird FPM (maximal 50 Kinder) in die Statik gestartet. </font><font style="vertical-align: inherit;">Es lud ungefähr zehn in der Spitze zur Hauptsendezeit. </font><font style="vertical-align: inherit;">Die durchschnittliche Reaktionszeit beträgt 100 ms und wir versuchen sie zu halten (wenn sie 100 ms überschreitet, beginnen wir mit der Suche nach Bremsstücken). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben ein eigenes Leistungsüberwachungssystem. </font><font style="vertical-align: inherit;">Wir haben viele Zähler im Code verteilt, ungefähr 120 pro Anfrage. </font><font style="vertical-align: inherit;">Wir überwachen viele Ereignisse, die innerhalb des Codes in PHP auftreten.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei uns ist alles Standard: Nginx, PHP-FPM. Ungefähr 600 Server mit FPM. Wenn Sie überhaupt über PHP sprechen möchten, dann gibt es wahrscheinlich etwa 300 weitere Server für verschiedene Zwecke, wie z. B. Skript, Backoffice und andere. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Von den Konfigurationsfunktionen gibt es zwei. Erstens haben wir einen BMA-Proxy - dies ist ein Proxy für Mobilgeräte. Das heißt, bevor eine Anforderung in nginx eintrifft, gelangt sie zu einem speziellen Proxy, der eine dauerhafte Verbindung hält, und sendet Anforderungen an nginx. Die zweite Funktion - manchmal müssen Sie den CLI-Opcache deaktivieren (wir haben ihn auf Skriptmaschinen aktiviert). Einmal haben wir es nicht ausgeschaltet und dabei 30% der CPU verloren. Nachdem sie ihren Fehler erkannt hatten, waren sie überrascht, wie viel Sie mit einer Einstellung sparen können. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben PHP-Patches, aber sie hängen fast nicht mit der Leistung zusammen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt einen Punkt mit der wettbewerbsfähigen APCu-Sperre - wenn Sie viel auf denselben Schlüssel schreiben müssen. </font><font style="vertical-align: inherit;">Die interne Architektur von APCu ist so aufgebaut, dass es eine globale Tastensperre gibt und während der intensiven Aufzeichnung die Bremsen beginnen. </font><font style="vertical-align: inherit;">Daher haben wir dort eine benutzerdefinierte Erweiterung, die dieses Problem löst. </font><font style="vertical-align: inherit;">Dies bezieht sich nur teilweise auf die Leistung, da es die Antwortzeit beeinflusst, nicht jedoch den CPU-Verbrauch.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben ungefähr 2 Millionen Anfragen pro Minute (~ 33 kRPS). </font><font style="vertical-align: inherit;">Eine in PHP geschriebene monolithische Anwendung wurde über 11 Jahre lang geschrieben. </font><font style="vertical-align: inherit;">Es befindet sich in einer Phase schnellen Wachstums. </font><font style="vertical-align: inherit;">Als das Unternehmen anfing, befanden sich 65 LXCs auf 65 physischen Servern. </font><font style="vertical-align: inherit;">Auf jedem Container mit der Anwendung werden PHP-FPM, Nginx und Hilfssoftware für Metriken und Protokollierung ausgeführt. </font><font style="vertical-align: inherit;">Nichts Besonderes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Laufe der Jahre haben wir noch nie Eisen für einen Monolithen hinzugefügt. </font><font style="vertical-align: inherit;">Wir erhöhen die Besucherzahlen, die Anzahl der Anzeigen und die Anzahl der Nutzertransaktionen und optimieren ständig, verbessern den Code und optimieren die Software. </font><font style="vertical-align: inherit;">Der CPU- und Speicherverbrauch ist in den letzten Jahren gesunken: 65 Container für einen Monolithen reichen uns jetzt.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie messen Sie die Leistung? </font><font style="vertical-align: inherit;">Mit welchem ​​Tool messen Sie die Antwortzeit des Kunden?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben ein Protokollsammelsystem. </font><font style="vertical-align: inherit;">Es werden zwei Indikatoren protokolliert - die Zeit vom Start des FPM bis zum Herunterfahren und bis zum Ende des Skripts. </font><font style="vertical-align: inherit;">Die zweite Metrik wird benötigt, um zu sehen, was nach dem Herunterfahren passiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir messen JS. </font><font style="vertical-align: inherit;">Dies ist in der Tat eine mittelmäßige Metrik, Netzwerkkanäle werden sehr oft verletzt. </font><font style="vertical-align: inherit;">Infolgedessen beginnt das Laden irgendwo im russischen Outback zu stumpfen. </font><font style="vertical-align: inherit;">Deshalb sehen wir so aus: "Oh, gesprungen - es bedeutet, dass irgendwo etwas abgefallen ist." </font><font style="vertical-align: inherit;">Außerdem verzerrt Werbung von Drittanbietern die Metrik erheblich. </font><font style="vertical-align: inherit;">Und vor allem kommen Spammer, und dies ist im Allgemeinen eine Art Zufälligkeit.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Übrigens haben wir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pinba</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> von Badoo </font><font style="vertical-align: inherit;">sehr aktiv eingesetzt </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ich mag sie jetzt. </font><font style="vertical-align: inherit;">Die meisten Metriken wurden von ihm gesammelt, dann aber auf das StatsD-Protokoll umgestellt. </font><font style="vertical-align: inherit;">Jetzt nehmen wir Messungen von verschiedenen Punkten aus vor: von vorne, von den Servern vor der Anwendung, von Nginx und von der PHP-Anwendung selbst. </font><font style="vertical-align: inherit;">Wir haben ein engagiertes Leistungsteam. </font><font style="vertical-align: inherit;">Sie begann mit der Leistung der Front, wechselte dann aber zum Backing. </font><font style="vertical-align: inherit;">Von vorne erfasst es nicht nur JS, CSS und andere Statiken, sondern gleichzeitig auch die Serverantwortzeit. </font><font style="vertical-align: inherit;">Zunächst konzentrieren wir uns auf die Reaktionszeit der Anwendung.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles ist ähnlich wie die Jungs uns erzählt haben. </font><font style="vertical-align: inherit;">Mit dem klassischen Pinba für PHP messen wir die Laufzeit eines PHP-Skripts in Bezug auf PHP. </font><font style="vertical-align: inherit;">Wir haben aber zum Beispiel auch Pinba für Nginx, das die Reaktionszeit aus Sicht von Nginx misst. </font><font style="vertical-align: inherit;">Wir sammeln auch Metriken auf dem Client. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was schauen wir uns an? </font><font style="vertical-align: inherit;">Einerseits die Reaktionszeit. </font><font style="vertical-align: inherit;">Es hat nichts mit Ressourcenplanung zu tun. </font><font style="vertical-align: inherit;">Wenn es schlecht ist, muss es verbessert werden, weil es in der Tat die Qualität des Service ist. </font><font style="vertical-align: inherit;">Eine andere Sache ist, dass Sie das Eisen irgendwie planen müssen. </font><font style="vertical-align: inherit;">Unsere ITOps und Überwachungsteams überwachen die gesamte Hardware. </font><font style="vertical-align: inherit;">Es gibt einige Balken im Netzwerk auf der Festplatte. </font><font style="vertical-align: inherit;">Es gibt einige Werte, nach denen die Warnung auftritt - und wir tun etwas. </font><font style="vertical-align: inherit;">Wie die Praxis gezeigt hat, optimieren wir normalerweise für die CPU: Wir stoßen darauf.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei uns misst sich die PHP-Anwendung selbst und wirft in register_shutdown_function () Metriken aus. </font><font style="vertical-align: inherit;">Jeder LXC verfügt über einen StatsD-Server, der diese Metriken sammelt und über die Kollektoren an den Graphite-Cluster (einschließlich ClickHouse) sendet, wo die Daten gespeichert werden. </font><font style="vertical-align: inherit;">Dies ist eine Selbstdiagnose. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf jedem Behälter befindet sich auch Nginx, d. H. Nginx + PHP-FPM. </font><font style="vertical-align: inherit;">Mit nginx erfassen wir externe Metriken, die sich auf die Laufzeit einer PHP-Anwendung beziehen. </font><font style="vertical-align: inherit;">Sie sind auch mit separaten Servern (wir nennen sie avi-http) nginx konfrontiert, die ein grundlegendes Routing durchführen, das auch übergeordnete Metriken wie die Antwortzeit, die Anzahl von 500 Antwortcodes und andere erfasst.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Welche Tools haben Sie für einen Performance-Track? </font><font style="vertical-align: inherit;">Was benutzt du am häufigsten?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben unser eigenes Tool geschrieben. Als Pinba gerade herauskam - 2012, vor sehr langer Zeit - war es ein Modul für MySQL, das so etwas über UDP erhalten hat. Es war schwierig, die Grafiken herauszunehmen, da sie nicht sehr leistungsoptimiert waren. Und wir haben uns nichts Besseres ausgedacht, als unser eigenes Ding namens Better Than Pinba zu schreiben. Es ist nur ein Zählerserver, der sie von einem PHP-Client akzeptiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben viele Timer im Code verstreut: Jedes Mal, wenn wir etwas messen möchten, setzen wir den Start und Stopp des Timers im Code. Das Modul selbst berechnet die Zählerlaufzeit, fasst die akkumulierten Zähler zu einem Paket zusammen und sendet sie an den Dämon. Die Schnittstelle selbst extrahiert alles, was Sie benötigen, und erstellt verbundene Diagramme auf dem gewünschten Zähler.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eines der Probleme von Pinba war das Fehlen einer eigenen Schnittstelle - es war notwendig, Daten an RRD zu übertragen (dann gab es eine solche Dunkelheit). </font><font style="vertical-align: inherit;">Deshalb haben wir unsere eigene Oberfläche geschrieben. </font><font style="vertical-align: inherit;">Jedes Mal, wenn wir sehen, was gesprungen ist, können wir das Skript installieren. </font><font style="vertical-align: inherit;">Im Skript werden alle aggregierten Zähler an uns gesendet, die an uns gesendet werden. </font><font style="vertical-align: inherit;">Wir können sehen, wo welcher Zähler gewachsen ist, oder die Antwortzeit am Zähler hat sich erhöht oder die Anzahl der Zähler hat sich erhöht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es kann gesehen werden, wenn die Leistung sinkt. </font><font style="vertical-align: inherit;">Wir fangen an, auf diese Weise zu graben. </font><font style="vertical-align: inherit;">Vor PHP 7 haben wir XHProf verwendet, dann hat es aufgehört, mit uns zu bauen. </font><font style="vertical-align: inherit;">Deshalb haben wir auf Xdebug umgestellt. </font><font style="vertical-align: inherit;">Xdebug stupsen wir nur, wenn das Problem sichtbar ist.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist eine verbreitete Überzeugung, dass XHProf nicht in PHP 7 erstellt wird. </font><font style="vertical-align: inherit;">Dies ist wahr, aber nur teilweise. </font><font style="vertical-align: inherit;">Wenn Sie XHProf aus dem Assistenten nehmen, wird dies wirklich nicht der Fall sein. </font><font style="vertical-align: inherit;">Aber wenn Sie auf GitHub zu einem Zweig namens Experimental (oder so ähnlich) wechseln, funktioniert alles gut für PHP 7, produktionsbereit. </font><font style="vertical-align: inherit;">Überprüft.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba</font></font></h3> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nein, ich habe gewechselt. </font><font style="vertical-align: inherit;">Bei mir hat es nicht funktioniert.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich möchte über Pinba hinzufügen. </font><font style="vertical-align: inherit;">Sie sind bis zu einem gewissen Grad Propheten geworden. </font><font style="vertical-align: inherit;">Auch wir haben irgendwann an Produktivität verloren. </font><font style="vertical-align: inherit;">Wir haben </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pinba2 gemacht</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , was sehr schnell ist. </font><font style="vertical-align: inherit;">Es kann als Ersatz für Pinba verwendet werden.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei uns ist alles bescheiden. </font><font style="vertical-align: inherit;">Wir haben nur die Richtung der Leistung in die Arbeit einbezogen: Wir sammeln Metriken wie die Antwortzeit. </font><font style="vertical-align: inherit;">Wir verwenden StatsD. </font><font style="vertical-align: inherit;">Wir verwenden noch keine regelmäßigen Profiler, aber ich weiß mit Sicherheit, dass einige Teams sie in ihren in PHP geschriebenen Microservices verwenden. </font><font style="vertical-align: inherit;">Meiner Meinung nach gibt sogar jemand New Relic weiter. </font><font style="vertical-align: inherit;">Aber im Kontext der monolithischen Hauptanwendung nähern wir uns bisher nur diesem.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Eisengeschichte wird in Grafana, Zabbix, überwacht. </font><font style="vertical-align: inherit;">Was den PHP-Teil betrifft, haben wir Pinba, wir haben eine Reihe von Timern; </font><font style="vertical-align: inherit;">Wir bauen praktische Grafiken darauf. </font><font style="vertical-align: inherit;">Wir verwenden XHProf, in der Produktion fahren wir es für einen Teil der Anfragen. </font><font style="vertical-align: inherit;">Wir haben immer frische XHProf-Profile zur Verfügung. </font><font style="vertical-align: inherit;">Wir haben liveprof: Dies ist unser Tool, das Sie lesen können, auch </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in meinem Artikel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Es passiert alles automatisch, man muss nur zuschauen. </font><font style="vertical-align: inherit;">Wir benutzen phpspy. </font><font style="vertical-align: inherit;">Bei uns fängt es nicht immer an: Wenn jemand etwas sehen will, steigt er ins Auto, nimmt sein Profil ab. </font><font style="vertical-align: inherit;">Grundsätzlich wie bei Perf.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
XHProf hat die gleiche Geschichte. </font><font style="vertical-align: inherit;">Wir haben es vor langer Zeit einmal benutzt: Es war eine persönliche Initiative einiger Entwickler und hat sich tatsächlich nicht durchgesetzt. </font><font style="vertical-align: inherit;">Er hörte auf zu sammeln. </font><font style="vertical-align: inherit;">Wir sammeln eine Reihe von Metriken aus Anrufen von Routern, Controllern und verschiedenen Modellen. </font><font style="vertical-align: inherit;">Etwa 60–70% des internen Netzwerks des Rechenzentrums sind mit UDP-Paketen mit Metriken belegt. </font><font style="vertical-align: inherit;">Im Moment reicht uns das. </font><font style="vertical-align: inherit;">Jetzt werden wir nach neuen Orten für die Optimierung suchen.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seit wir den Punkt des Eisens erreicht haben: Ist jemand in Ihrem Unternehmen systematisch mit der Kapazitätsplanung beschäftigt? </font><font style="vertical-align: inherit;">Wie ist dieser Prozess aufgebaut?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine monolithische Anwendung läuft mindestens fünf Jahre lang mit mindestens 65 LXC. </font><font style="vertical-align: inherit;">Wir optimieren den Code, verbessern ihn: Er verfügt über genügend Ressourcen. </font><font style="vertical-align: inherit;">Unsere Hauptkapazitätsplanung geht an Kubernetes, wo ungefähr 400 mehr oder weniger lebende Microservices in PHP / Go geschrieben sind. </font><font style="vertical-align: inherit;">Wir schneiden langsam Stücke aus dem Monolithen, aber er wächst immer noch. </font><font style="vertical-align: inherit;">Wir können ihn nicht aufhalten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Allgemeinen ist PHP eine coole Sprache. </font><font style="vertical-align: inherit;">Es implementiert schnell Geschäftslogik.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst stellen ITOps und Überwachungsteams sicher, dass genügend Ressourcen vorhanden sind. </font><font style="vertical-align: inherit;">Wenn wir uns dem Schwellenwert nähern, bemerken dies die Kollegen. </font><font style="vertical-align: inherit;">Sie sind wahrscheinlich hauptsächlich für die globale Kapazitätsplanung verantwortlich. </font><font style="vertical-align: inherit;">Der PHP-Teil hat die Haupt-CPU-Ressource, daher folgen wir ihm selbst. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir setzen uns selbst Maßstäbe: Wir sollten nicht mehr als 60% des Clusters "essen". </font><font style="vertical-align: inherit;">60% und nicht 95%, weil wir Hypertreading haben, das zusätzlich mehr aus dem Prozessor herausdrückt, als Sie ohne es herausdrücken können. </font><font style="vertical-align: inherit;">Dafür zahlen wir dafür, dass wir nach 50% unseres CPU-Verbrauchs auf unvorhersehbare Weise wachsen können, weil hyperlesende Kernel nicht ganz ehrlich sind.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir führen eine Bereitstellung durch und stellen fest, dass bei uns etwas fehlgeschlagen ist - eine solche Kapazitätsplanung. </font><font style="vertical-align: inherit;">Mit dem Auge! </font><font style="vertical-align: inherit;">Wir haben einen gewissen Produktivitätsspielraum, der uns dies ermöglicht. </font><font style="vertical-align: inherit;">Wir versuchen dabei zu bleiben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Darüber hinaus führen wir eine Post-Factum-Optimierung durch. </font><font style="vertical-align: inherit;">Wenn wir sehen, dass etwas abgefallen ist, rollen wir zurück, wenn alles völlig schlecht ist. </font><font style="vertical-align: inherit;">Das passiert aber praktisch nicht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oder wir sehen nur, dass "hier nicht optimal ist, jetzt werden wir schnell alles reparieren und alles wird so funktionieren, wie es sollte." </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir kümmern uns nicht besonders darum: Es ist sehr schwierig und der Auspuff wird nicht sehr groß sein.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie sprechen von Microservices. </font><font style="vertical-align: inherit;">Wie interagieren sie? </font><font style="vertical-align: inherit;">Ist es REST oder verwenden Sie binäre Protokolle?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kafka wird verwendet, um Ereignisse zwischen Diensten zu senden. JSON-RPC wird verwendet, um die Interaktion zwischen Diensten sicherzustellen, jedoch nicht vollständig, sondern die vereinfachte Version, die wir nicht loswerden können. </font><font style="vertical-align: inherit;">Es gibt schnellere Implementierungen: das gleiche Protokoll, gRPC. </font><font style="vertical-align: inherit;">Dies ist in unseren Plänen, aber sicherlich keine Priorität. </font><font style="vertical-align: inherit;">Bei über 400 Microservices ist es schwierig, alle auf das neue Protokoll zu portieren. </font><font style="vertical-align: inherit;">Es gibt unzählige andere Orte, die optimiert werden müssen. </font><font style="vertical-align: inherit;">Wir sind jetzt definitiv nicht in der Lage.</font></font><br>
 <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir als solche haben keine Microservices. </font><font style="vertical-align: inherit;">Es gibt Dienste, es gibt auch Kafka, ein eigenes Protokoll über Google Protobuf. </font><font style="vertical-align: inherit;">Wahrscheinlich würden wir gRPC verwenden, weil es cool ist, alle Sprachen unterstützt und sehr einfach verschiedene Teile binden kann. </font><font style="vertical-align: inherit;">Aber als wir es brauchten, war gRPC noch nicht da. </font><font style="vertical-align: inherit;">Aber es gab einen Protobuf, und wir haben ihn genommen. </font><font style="vertical-align: inherit;">Darüber hinaus wurden verschiedene Dinge hinzugefügt, so dass es sich nicht nur um eine Serialisierung, sondern um ein vollständiges Protokoll handelte.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba</font></font></h3> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben auch keine Microservices. </font><font style="vertical-align: inherit;">Es gibt Dienste, die hauptsächlich in C geschrieben sind. Wir verwenden JSON-RPC, weil es praktisch ist. </font><font style="vertical-align: inherit;">Sie haben gerade den Socket geöffnet, als Sie Ihren Code debuggen, und schnell geschrieben, was Sie wollten. </font><font style="vertical-align: inherit;">Etwas ist zu dir zurückgekehrt. </font><font style="vertical-align: inherit;">Protobuf ist schwieriger, da Sie einige zusätzliche Tools verwenden müssen. </font><font style="vertical-align: inherit;">Es gibt einen kleinen Overhead, aber wir glauben, dass Sie für die Bequemlichkeit bezahlen müssen, und dies ist kein großer Preis.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie haben riesige Datenbanken. </font><font style="vertical-align: inherit;">Wie machen Sie es, wenn Sie die Schaltung in einem von ihnen ändern müssen? </font><font style="vertical-align: inherit;">Irgendeine Art von Migrationen? </font><font style="vertical-align: inherit;">Wie wirkt sich dies auf die Leistung aus, wenn diese Migrationen mehrere Tage dauern?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben große Tische, monolithisch. </font><font style="vertical-align: inherit;">Es gibt eine Scherbe. </font><font style="vertical-align: inherit;">Die Scherbe ändert sich ziemlich schnell, weil es viele parallele Änderungen gleichzeitig gibt. </font><font style="vertical-align: inherit;">Ein großer Tisch mit Profilen änderte sich etwa drei Stunden. </font><font style="vertical-align: inherit;">Wir verwenden Perkonovskie-Tools, die nicht gelesen und geschrieben werden können. </font><font style="vertical-align: inherit;">Darüber hinaus stellen wir Änderungen bereit, sodass der Code beide Status unterstützt. </font><font style="vertical-align: inherit;">Nach der Änderung stellen wir auch bereit: Die Bereitstellung ist schneller als das Anwenden von Schemata.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben den größten Speicher (wir nennen es "Spots") - dies ist eine riesige Sharded-Datenbank. </font><font style="vertical-align: inherit;">Wenn wir die "Benutzer" -Tabelle nehmen, dann hat sie viele Scherben. </font><font style="vertical-align: inherit;">Ich werde Ihnen nicht genau sagen, wie viele Tabellen sich auf einem Server befinden werden. Die Idee ist, dass es viele kleine Tabellen gibt. </font><font style="vertical-align: inherit;">Wenn wir die Schaltung ändern, nehmen wir tatsächlich nur eine Änderung vor. </font><font style="vertical-align: inherit;">Auf jedem kleinen Tisch geht es schnell. </font><font style="vertical-align: inherit;">Es gibt andere Repositories - es gibt bereits andere Ansätze. </font><font style="vertical-align: inherit;">Wenn es eine riesige Basis gibt, gibt es perkonische Werkzeuge. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Allgemeinen verwenden wir je nach Bedarf unterschiedliche Dinge. </font><font style="vertical-align: inherit;">Die häufigste Änderung ist eine Änderung dieser riesigen Basis aus Splittern, in der wir bereits einen Prozess aufgebaut haben. </font><font style="vertical-align: inherit;">Es funktioniert alles sehr einfach.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieselbe monolithische Anwendung, die den größten Teil des Datenverkehrs bedient, wird fünf- bis sechsmal täglich bereitgestellt. </font><font style="vertical-align: inherit;">Fast alle zwei Stunden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Bezug auf die Arbeit mit der Datenbank ist dies ein separates Problem. </font><font style="vertical-align: inherit;">Es gibt Migrationen, sie rollen automatisch. </font><font style="vertical-align: inherit;">Dies ist eine DBA-Überprüfung. </font><font style="vertical-align: inherit;">Es besteht die Möglichkeit, die Migration zu überspringen und manuell zu rollen. </font><font style="vertical-align: inherit;">Die Migration wird beim Testen von Code automatisch in die Bereitstellung übernommen. </font><font style="vertical-align: inherit;">Wenn es in der Produktion jedoch eine zweifelhafte Migration gibt, die eine Reihe von Ressourcen beansprucht, startet der DBA sie manuell.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Code sollte so sein, dass er mit den alten und neuen Datenbankstrukturen funktioniert. </font><font style="vertical-align: inherit;">Wir führen häufig mehrere Reisen durch, um Funktionen bereitzustellen. </font><font style="vertical-align: inherit;">Für zwei oder drei Roll-Outs ist es möglich, den gewünschten Zustand zu erhalten. </font><font style="vertical-align: inherit;">Ebenso gibt es riesige Datenbanken, Sharded-Datenbanken. </font><font style="vertical-align: inherit;">Wenn wir für alle Microservices zählen, gibt es definitiv 100-150 Bereitstellungen pro Tag.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich würde gerne wissen, wie hoch die Standard-Backend-Antwortzeit für Sie ist, der Sie folgen. </font><font style="vertical-align: inherit;">Wann verstehen Sie, was Sie zur weiteren Optimierung benötigen, oder wann ist die Zeit bis zum Abschluss? </font><font style="vertical-align: inherit;">Gibt es einen „Krankenhausdurchschnitt“?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nein. </font><font style="vertical-align: inherit;">Hängt vom Endpunkt ab. </font><font style="vertical-align: inherit;">Wir betrachten alles separat. </font><font style="vertical-align: inherit;">Ich versuche zu verstehen, wie kritisch das ist. </font><font style="vertical-align: inherit;">Einige Endpunkte werden im Allgemeinen im Hintergrund angefordert. </font><font style="vertical-align: inherit;">Dies hat keinerlei Auswirkungen auf den Benutzer, selbst wenn die Antwortzeit 20 s beträgt. </font><font style="vertical-align: inherit;">Dies wird im Hintergrund passieren, es gibt keinen Unterschied. </font><font style="vertical-align: inherit;">Die Hauptsache ist, dass einige wichtige Dinge schnell erledigt werden. </font><font style="vertical-align: inherit;">Vielleicht sind 200 ms noch in Ordnung, aber ein kleiner Anstieg ist schon wichtig.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir wechseln vom HTML-Rendering zu API-Anfragen. </font><font style="vertical-align: inherit;">Tatsächlich reagiert die API hier viel schneller als die große, schwere HTML-Antwort. </font><font style="vertical-align: inherit;">Daher ist es schwierig, beispielsweise einen Wert von 100 ms zu unterscheiden. </font><font style="vertical-align: inherit;">Wir haben uns auf 200 ms konzentriert. </font><font style="vertical-align: inherit;">Dann passierte PHP 7 - und wir begannen uns auf 100 ms zu konzentrieren. </font><font style="vertical-align: inherit;">Dies ist der "Durchschnitt für das Krankenhaus". </font><font style="vertical-align: inherit;">Dies ist eine sehr vage Metrik, die darauf hindeutet, dass es Zeit ist, zumindest dort nachzuschauen. </font><font style="vertical-align: inherit;">Deshalb konzentrieren wir uns eher auf die Bereitstellung und überspringen die Reaktionszeit danach.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben eine Skizze eines der Leistungsteams gemacht. Die Kollegen haben gemessen, wie viel mehr ein Unternehmen verdient, indem es das Laden von Seiten in verschiedenen Szenarien beschleunigt. Wir haben berechnet, wie viel mehr Käufer, Transaktionen, Anrufe, Übergänge usw. stattfinden. Nach diesen Daten kann verstanden werden, dass die Beschleunigung irgendwann keinen Sinn mehr ergibt. Wenn beispielsweise die Antwortzeit einer der Seiten von 90 ms auf 70 ms beschleunigt wurde, ergab dies + 2% der Käufer. Und wenn Sie von 70 ms auf 60 ms beschleunigen, gibt es bereits plus 0,1% der Käufer, was im Allgemeinen im Fehler enthalten ist. Genau wie bei den Jungs hängt alles stark von der Seite ab, mit der wir arbeiten. Im Allgemeinen Avito 75. Perzentil - etwa 75 ms. Meiner Meinung nach ist das langsam. Wir suchen jetzt nach Orten zur Optimierung. Vor dem Übergang zu Microservices ging für uns alles viel schneller und wir versuchen, die Leistung zu optimieren.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5j/tw/ig/5jtwigxel1bcp3pbmmvhdxdslhu.jpeg"><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und die ewige Frage: Eisen oder Optimierung? </font><font style="vertical-align: inherit;">Wie kann man verstehen, ob es sich lohnt, Hardware zu kaufen, oder ob es besser ist, in die Optimierung zu investieren? </font><font style="vertical-align: inherit;">Wo ist die Grenze?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meine Meinung: Ein echter Programmierer ist die Optimierung. </font><font style="vertical-align: inherit;">Es scheint mir, dass es in großen Unternehmen wie Badoo, Mine, Yandex viele Entwickler auf verschiedenen Ebenen gibt. </font><font style="vertical-align: inherit;">Es gibt sowohl Nachwuchsentwickler / Praktikanten als auch führende Entwickler. </font><font style="vertical-align: inherit;">Es scheint mir, dass die Anzahl der Stellen für die Optimierung / Überarbeitung dort immer hinzugefügt wird. </font><font style="vertical-align: inherit;">Eisen ist der letzte Schritt. </font><font style="vertical-align: inherit;">Für einen Monolithen auf 65 LXC haben wir lange Zeit kein Eisen hinzugefügt. </font><font style="vertical-align: inherit;">CPU-Auslastung - 20%. </font><font style="vertical-align: inherit;">Wir denken bereits darüber nach, sie in den Kubernetes-Cluster zu übertragen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich mag die Position von Semyon sehr. Aber ich habe einen völlig entgegengesetzten Standpunkt. Zuerst würde ich mir das Eisen ansehen. Kann man Eisen fallen lassen und ist es billiger? Wenn ja, ist es einfacher, das Problem mit Eisen zu lösen. Der Entwickler kann etwas anderes tun, das zu diesem Zeitpunkt nützlich ist. Entwicklerzeit kostet Geld. Eisen kostet auch Geld, also müssen Sie vergleichen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Welche davon wichtiger ist, ist unklar. Wenn beide gleich viel kosten, gewinnt die Hardware, da der Entwickler zu diesem Zeitpunkt etwas tun kann. Insbesondere in Bezug auf das PHP-Backend können wir dies nicht tun. Optimierung kostet uns viel billiger als der Kauf von Eisen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Über zu stoppen. </font><font style="vertical-align: inherit;">In Bezug auf die Planung haben wir eine Art Bar. </font><font style="vertical-align: inherit;">Wenn wir den CPU-Verbrauch darunter senken, hören wir auf. </font><font style="vertical-align: inherit;">Zum anderen gibt es auch die Servicequalität. </font><font style="vertical-align: inherit;">Wenn wir feststellen, dass die Reaktionszeit nicht zu uns passt, müssen wir optimieren.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mir scheint, dass alles von der Größe des Teams und des Projekts abhängt. </font><font style="vertical-align: inherit;">Je kleiner das Projekt ist, desto einfacher ist es, Hardware zu kaufen, da das Gehalt des Entwicklers konstant ist und der Code, der funktioniert, die Benutzer, die damit arbeiten, sehr unterschiedlich sind. </font><font style="vertical-align: inherit;">Wenn es nur wenige Benutzer gibt, ist es einfacher, Hardware zu kaufen und den Entwickler mit der Entwicklung des Projekts zu beauftragen. </font><font style="vertical-align: inherit;">Wenn es viele Benutzer gibt, kann ein Entwickler den größten Teil der Serverkosten kompensieren.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles hängt wirklich von der Größe ab. </font><font style="vertical-align: inherit;">Wenn Sie über tausend Server verfügen und die Optimierung dazu führt, dass Sie keine weiteren tausend Server benötigen, ist eine Optimierung eindeutig besser. </font><font style="vertical-align: inherit;">Wenn Sie einen Server haben, können Sie sicher zwei oder drei weitere Server kaufen und bei der Optimierung punkten. </font><font style="vertical-align: inherit;">Wenn der Befehl klein ist, starten Sie den Kauf der Server. </font><font style="vertical-align: inherit;">Wenn das Team groß ist und Sie zwei oder drei Rechenzentren haben, ist der Kauf von sechs Rechenzentren bereits nicht so billig und nicht so schnell.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Da wir ein PHP-Mitap haben, sollte dieser Satz klingen: Warum brauchen wir PHP, da wir ständig solche Probleme haben? </font><font style="vertical-align: inherit;">Lassen Sie uns Go, C, C #, Rust, Node.js umschreiben! </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Halten Sie den Ansatz des Umschreibens im Allgemeinen für gerechtfertigt? </font><font style="vertical-align: inherit;">Gibt es Probleme, für deren Lösung es sich lohnt, dies zu tun und zu investieren?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Allgemeinen ist PHP eine sehr gute Sprache. Es ermöglicht Ihnen wirklich, geschäftliche Probleme zu lösen. Er ist schnell genug. Alle Leistungsprobleme sind Probleme mit Fehlern, Fehlern und altem Code (eine Art unterbewerteter Code, suboptimale Dinge, die auf die gleiche Weise in einer anderen Sprache aufgenommen worden wären). Wenn Sie sie roh nach Golang, Java, Python portieren, erhalten Sie die gleiche Leistung. Das ganze Problem ist, dass es viel Vermächtnis gibt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Einführung einer neuen Sprache ist meiner Meinung nach sinnvoll, um den Stapel und die Beschäftigungsmöglichkeiten zu erweitern. Jetzt ist es schwierig genug, gute PHP-Entwickler zu finden. Wenn wir Golang in den Techradar einführen, können wir Gophers einstellen. Es gibt nur wenige PHP-Shniks und wenige Gophers auf dem Markt, und zusammen gibt es bereits viele davon. Zum Beispiel hatten wir ein Experiment. Wir haben C # -Entwickler mitgenommen, die bereit sind, neue Sprachen zu lernen - wir haben einfach den Einstellungsstapel erweitert. Wenn wir den Leuten sagen, dass wir ihnen das Schreiben in PHP beibringen, sagen sie, dass es besser ist, dies nicht zu tun. Und wenn wir ihnen anbieten, das Schreiben in PHP zu lernen, gehen Sie und versprechen Sie trotzdem die Möglichkeit, in Python zu schreiben, dann sind die Leute eher bereit zu antworten. Für mich ist dies eine Erweiterung der Beschäftigungsmöglichkeiten. In anderen Sprachen fehlen einige Dinge in PHP wirklich. Im Allgemeinen reicht PHP jedoch hervorragend aus, um geschäftliche Probleme zu lösen und große Projekte zu implementieren.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich stimme Semyon wahrscheinlich vollkommen zu. </font><font style="vertical-align: inherit;">Das Umschreiben macht einfach keinen Sinn. </font><font style="vertical-align: inherit;">PHP ist eine ziemlich produktive Sprache. </font><font style="vertical-align: inherit;">Wenn Sie es mit anderen nicht kompilierten Skriptsprachen vergleichen, ist es wahrscheinlich fast die schnellste. </font><font style="vertical-align: inherit;">In einige Sprachen wie Go und andere umschreiben? </font><font style="vertical-align: inherit;">Dies sind andere Sprachen, sie haben andere Probleme. </font><font style="vertical-align: inherit;">Es ist noch schwieriger, darüber zu schreiben: nicht so schnell und es gibt viele Nuancen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trotzdem gibt es Dinge, die in PHP entweder schwierig oder unpraktisch zu schreiben sind. </font><font style="vertical-align: inherit;">Einige Dinge mit mehreren Prozessen und mehreren Threads lassen sich besser in einer anderen Sprache schreiben. </font><font style="vertical-align: inherit;">Ein Beispiel für eine Aufgabe, bei der die Nichtverwendung von PHP gerechtfertigt ist, ist im Prinzip jeder Speicher. </font><font style="vertical-align: inherit;">Wenn dies ein Dienst ist, der viel im Speicher speichert, ist PHP wahrscheinlich nicht die beste Sprache, da es aufgrund der dynamischen Typisierung einen sehr großen Speicheraufwand hat. </font><font style="vertical-align: inherit;">Es stellt sich heraus, dass Sie ein 4-Byte-Int speichern und 50 Bytes verbraucht werden. </font><font style="vertical-align: inherit;">Natürlich übertreibe ich, aber dieser Aufwand ist immer noch sehr groß. </font><font style="vertical-align: inherit;">Wenn Sie über eine Art Speicher verfügen, ist es besser, ihn in einer anderen kompilierten Sprache mit statischer Typisierung zu schreiben. </font><font style="vertical-align: inherit;">Genau wie einige Dinge, die eine Multithread-Ausführung erfordern.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Warum wird PHP nicht als sehr schnell angesehen? Weil es dynamisch ist. Die Go-Übersetzung ist eine Lösung für das Problem der Übersetzung von Code von dynamischer Typisierung in statische. Dadurch geht alles schneller. Speziell für Go gibt es in meinem Plan Aufgaben eines bestimmten Datenstroms. Wenn beispielsweise ein Datenstrom in bequemere Formate konvertiert werden muss, ist dies eine ideale Sache. Von einem Daemon ausgelöst, empfängt er einen Datenstrom an der Eingabe, gibt einen anderen aus. Wenig Erinnerung frisst. PHP verbraucht in diesem Fall viel Speicher: Sie müssen sorgfältig sicherstellen, dass es gereinigt wird.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Transfer to Go ist eine Übertragung auf Microservices, da Sie nicht den gesamten Code ausschneiden. </font><font style="vertical-align: inherit;">Sie werden es nicht vollständig nehmen und neu schreiben. </font><font style="vertical-align: inherit;">Die Übersetzung in Microservices ist eine tiefere Aufgabe als die Übersetzung von einer Sprache in eine andere. </font><font style="vertical-align: inherit;">Es ist notwendig, es zuerst zu lösen und dann darüber nachzudenken, welche Sprache geschrieben werden soll. </font><font style="vertical-align: inherit;">Der schwierigste Teil ist das Erlernen von Microservices.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist nicht erforderlich, Go in Microservices zu verwenden. Viele Dienste sind in PHP geschrieben und haben eine akzeptable Antwortzeit. Das Team, das sie unterstützt, hat selbst entschieden, dass sie sehr schnell Geschäftslogik schreiben und Funktionen einführen müssen. Sie machen tatsächlich manchmal schneller als Gophers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir neigen dazu, Gophers einzustellen und in Go zu übersetzen. Aber wir haben immer noch den größten Teil des Codes in PHP geschrieben, und so wird es noch mindestens ein paar Jahre dauern. Es gibt kein richtiges Rennen, wir haben nicht entschieden, dass Go besser oder schlechter ist. Täglich werden sechs Releases in den Monolithen eingeführt. Unser Chat "Avito Deploy" enthält eine Liste der Aufgaben, die bereitgestellt werden. In jeder Version werden mindestens 20 Aufgaben pro Tag ausgeführt: mindestens fünf oder sechs Versionen pro Tag, ungefähr 80 Aufgaben, die Benutzer für diese Aufgaben ausgeführt haben. All dies geschieht in PHP.</font></font><br>
<br>
<blockquote>      ?       -,    ?</blockquote><br>
<h3> , </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das ist sehr schwer. Es gibt einen psychologischen Moment: Ich habe eine neue Funktion gestartet - Sie sind fertig. Startete eine gigantische neue Funktion - du bist super jung! Wenn ein Manager oder Entwickler angibt, dass er eine Funktion entfernt (außer Betrieb genommen) hat, erhält er keine solche Anerkennung. Seine Arbeit ist nicht sichtbar. Zum Beispiel kann ein Team einen Bonus für die erfolgreiche Implementierung neuer Funktionen erhalten, aber ich habe keine Auszeichnungen für tote oder experimentelle Funktionen gesehen. Und das Ergebnis kann wirklich kolossal sein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine Reihe von Legacy-Funktionen, die noch niemand verwendet, verlangsamt die Entwicklung. Es gibt Hunderte von Fällen, in denen eine neue Person zu einem Unternehmen kommt und einen toten Code überarbeitet, der niemals aufgerufen wird, weil sie nicht weiß, dass es sich um einen toten Code handelt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir versuchen irgendwie mit Managern zu verhandeln, herauszufinden, was für ein Feature es war, mit Analysten überlegen wir, wie viel Geld es bringt, wer es braucht, und erst danach versuchen wir es zu reduzieren. </font><font style="vertical-align: inherit;">Dies ist ein komplizierter Prozess.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir schneiden toten Code ab, wenn wir dazu kommen. </font><font style="vertical-align: inherit;">Und es ist bei weitem nicht immer möglich, es schnell zu schneiden. </font><font style="vertical-align: inherit;">Zuerst schreiben Sie einen Code, dann einen anderen, über einen dritten, und dann stellt sich heraus, dass diese Funktion nicht benötigt wird. </font><font style="vertical-align: inherit;">Sie zieht eine wilde Anzahl von Abhängigkeiten, die ebenfalls behoben werden müssen. </font><font style="vertical-align: inherit;">Dies ist nicht immer möglich, und Manager müssen dies melden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Manager legt die Aufgabe fest, Sie bewerten sie. </font><font style="vertical-align: inherit;">Sie sagen: "Weißt du, Mann, ich mache das sechs Monate lang. </font><font style="vertical-align: inherit;">Bist du bereit, ein halbes Jahr zu tolerieren? “ </font><font style="vertical-align: inherit;">Er sagt: "Nein, lass uns überlegen, was geschnitten werden muss, was übrig bleiben kann. </font><font style="vertical-align: inherit;">Was ist grundsätzlich notwendig und was ist nötig, um herumzuspielen. “ </font><font style="vertical-align: inherit;">So läuft das.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn ein Entwickler ein Feature erhält, bewertet er, wie schwierig es in Bezug auf die Entwicklung ist, wie schwierig es in Bezug auf die Leistung ist. Wenn er das eine oder andere sieht, klärt er mit dem Produktmanager, ob dies wirklich notwendig ist, ob wir irgendwo etwas entfernen können. Manchmal kommt es vor, dass Änderungen nicht kritisch sind und Manager schnell Zugeständnisse machen, wenn sie feststellen, dass diese Sache kompliziert ist oder Ressourcen verbraucht. Es passiert einfach: Sie sagen "Entfernen wir es" - und das war's. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es kommt vor, dass ein Feature verlassen wird, und danach stellen wir fest, dass es nicht so gut funktioniert, wie wir es möchten. Und dann können Sie wieder mit dem Manager sprechen. Oft endet alles erfolgreich.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt keinen integrierten Prozess zum Entfernen von Funktionen. Dies geschieht sporadisch. Wir sehen, dass es eine Funktion gibt, wir kommen und bieten an, sie auszuschalten. Wir schalten es aus, beobachten, was es gibt, und schneiden es aus. Eine andere Sache ist toter Code. Wir haben eine spezielle Erweiterung, sogar eine ganze Infrastruktur, für die Erkennung von totem Code. Wir sehen diesen toten Code. Wir versuchen es langsam abzuschneiden. Eine andere Frage ist, ob es wirklich tot ist und die Anfrage es nie eingibt, dann hat es keinerlei Auswirkungen auf die Leistung. Dies wirkt sich auf die Unterstützbarkeit aus. Die Leute lesen es ständig, obwohl sie es vielleicht nicht lesen. Es gibt keinen besonderen Zusammenhang mit der Leistung.</font></font><br>
<br>
<blockquote><i>15      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Badoo PHP Meetup</a>. ,      : SuperJob, ManyChat, , Badoo  FunCorp    . <br>
<br>
,   ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">YouTube-</a>. ,       - .<br>
<br>
   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a>,     .</i><br>
</blockquote></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de487234/">https://habr.com/ru/post/de487234/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de487224/index.html">Wie lange kann eine langfristige Konstruktion, die dazu bestimmt ist, ein Meisterwerk zu werden?</a></li>
<li><a href="../de487226/index.html">Machen Sie Ihr Abzeichen: Shitty Add-On macht OFFZONE nichts aus</a></li>
<li><a href="../de487228/index.html">Frontend mitap Facebook und AvitoTech</a></li>
<li><a href="../de487230/index.html">USA Life Notes</a></li>
<li><a href="../de487232/index.html">Immunabdruck im Kindesalter: der Ursprung des Virenschutzes</a></li>
<li><a href="../de487238/index.html">Entwerfen von Stromnetzschutzgeräten</a></li>
<li><a href="../de487242/index.html">Februar IT Events Digest</a></li>
<li><a href="../de487246/index.html">Die Tensor-Zertifizierungsstelle kann die privaten Schlüssel des Kunden gefährden</a></li>
<li><a href="../de487248/index.html">Ein bisschen mehr über unsachgemäße Tests</a></li>
<li><a href="../de487250/index.html">Verzögerte Alpha-Mischung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>