<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🚀 ⬛️ 🍲 Kenali peningkatan privilege di ABBYY FineReader 🚢 🥚 🚈</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Siklus bagaimana saya menemukan kerentanan eskalasi hak istimewa dalam aplikasi Windows terus berlanjut. Dalam seri sebelumnya: Steam ( CVE-2019-14743...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Kenali peningkatan privilege di ABBYY FineReader</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pm/blog/488826/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Siklus bagaimana saya menemukan kerentanan eskalasi hak istimewa dalam aplikasi Windows terus berlanjut. </font><font style="vertical-align: inherit;">Dalam seri sebelumnya: Steam ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CVE-2019-14743</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CVE-2019-15316</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CVE-2019-17180</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) dan Origin ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CVE-2019-19247, CVE-2019-19248</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Tetapi hari ini kita tidak akan berbicara tentang peluncur game, tetapi tentang paket perangkat lunak aplikasi ABBYY FinerReader. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/n6/4z/ac/n64zach5hyh0x3hdcoskm6ojz7m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ringkasan - Saya akan memberi tahu Anda bagaimana, berkat komponen yang memeriksa lisensi, dalam 10 menit Anda dapat meningkatkan hak Anda dari level pengguna ke NT AUTHORITY \ SYSTEM. </font><font style="vertical-align: inherit;">Kerentanan diberikan pengenal CVE-2019-20383, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tautan ke situs web ABBYY</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<a name="habracut"></a><br>
<h2><font color="orange"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Badan intelijen</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya mengunduh versi percobaan FineReader dari situs web ABBYY dan segera memeriksanya untuk melihat apakah masuk akal untuk memilih produk untuk meningkatkan hak istimewa. Ya, produk termasuk layanan yang, dilihat dari nama "ABBYY network license server", dikaitkan dengan lisensi dan diluncurkan secara default dari pengguna NT AUTHORITY \ SYSTEM. Saya mulai, ProcMon mulai memperhatikan perilaku layanan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perhatian saya tertuju pada file yang terletak di sepanjang jalur "C: \ ProgramData \ ABBYY \ FineReader \ 15 \ Licenses \ Licensing.cnt". Layanan membaca sesuatu darinya, menulis sesuatu untuknya, secara umum, file tersebut tampak seperti kandidat yang menarik untuk eksperimen. Pertimbangkan folder "C: \ ProgramData \ ABBYY \ FineReader \ 15 \ Lisensi". ACL All-Full Access yang diwarisi dari folder induk ("C: \ ProgramData \ ABBYY \ FineReader \ 15") berlaku untuk folder ini, yang berarti bahwa Anda dapat menghapus semua kontennya, termasuk file "Licensing.cnt". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Layanan, setelah menemukan tidak adanya file, mencoba membuatnya, dan dengan cara yang agak aneh. Dia membuat file dari bentuk "tmpXXXX-YYYYYYYYY.tmp", menulis beberapa data ke dalamnya, dan kemudian menamainya "Licensing.cnt". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut adalah log ProcMon di mana operasi ini dilakukan dua kali.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8h/hk/ro/8hhkroiszje9qtzyovchs1zldjk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, itu terjadi pada 20:36, dan kemudian pada 20:46. Di antara cap waktu ini, file itu dihapus lagi untuk dibuat lagi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kotak 1 menunjukkan situasi ketika layanan mendeteksi tidak adanya file. Rectangle 2 - buat file sementara. Rectangle 3 - ganti nama file sementara. Rectangle 4 - ulangi operasi setelah 10 menit.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertimbangkan format nama "tmpXXXX_YYYYYYYYY.tmp". Sebagai bagian dari satu proses yang berjalan, XXXX akan selalu konstan, terlebih lagi, pada kenyataannya, ini adalah pengidentifikasi dari utas yang melakukan pekerjaan ini. YYYYYYYYY tidak tetap konstan, tetapi jika kita melihat dua awal yang bertetangga (nilai: 430210515 dan 430810515), maka nampaknya ini hanya tanda waktu - perbedaan antara angka 600000 - secara mengejutkan bertepatan dengan perbedaan 10 menit. Beberapa tes lagi mengkonfirmasi asumsi kami.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk meringkas bagian ini. </font><font style="vertical-align: inherit;">Setiap pengguna dapat menghapus file "C: \ ProgramData \ ABBYY \ FineReader \ 15 \ Licensing \ Licensing.cnt", maka ia dapat sangat sering meminta isi folder "C: \ ProgramData \ ABBYY \ FineReader \ 15 \ Lisensi" di di beberapa titik, temukan di sana file yang disebut "tmpXXXX_YYYYYYYYY.tmp". </font><font style="vertical-align: inherit;">Sekarang pengguna akan siap, setelah menghapus file, dia akan tahu persis pada saat apa dan dengan nama apa file tersebut akan dibuat lain kali.</font></font><br>
<br>
<h2><font color="orange"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sekarang kita akan bermain dengan symlink</font></font></font></h2><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cara membuat symlink tanpa hak administrator</font></font></b><div class="spoiler_text">  ,           .     . , ,     «C:\abc\1»   «C:\def\2».<br>
<br>
  NTFS reparse point (  NTFS mount point)   «C:\abc»  «\RPC Control\". «\RPC Control\» –        ,   , ,  .    ,   , ,  ,     .       NTFS reparse point ,  ,             .   - ,  -            .<br>
<br>
          .    "\RPC Control\1" &lt;-&gt; «C:\def\2».  ,     «C:\abc\1»,       «C:\def\2».<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada awalnya, proses membuat file lisensi terlihat seperti ini: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ln/zh/8w/lnzh8ws9y5e0ewunx4u_pnnhkh8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika kita mengetahui saat yang tepat dari operasi seperti berikutnya, kita dapat membuat symlink berikut (kita akan melewatkan nama folder sumber "C: \ ProgramData \ ABBYY \ FineReader \ 15 \ Lisensi \"): </font><font style="vertical-align: inherit;">
Di mana YYYYYYYYA, YYYYYYYB, YYYYYYYYYC, ... YYYYYYYYYYZ - ini adalah cap waktu yang berbeda dalam YYYYYYYYYYY + 10 menit (jika stempel waktu sedikit terlambat). </font><font style="vertical-align: inherit;">
Selanjutnya, buat tautan: </font><font style="vertical-align: inherit;">
Perhatikan bahwa tidak satu pun dari file-file ini benar-benar ada. Ini diperlukan agar ketika merujuk, misalnya, ke tmpXXXX_YYYYYYYYB.tmp, terjadi dua pengalihan dan, sebagai hasilnya, layanan bekerja dengan file "C: \ test \ l2 \ nope". </font><font style="vertical-align: inherit;">
Segera setelah kami menemukan pembuatan file "C: \ test \ l2 \ nope", kita harus segera membuat dua symlink baru:</font></font><br>
<br>
<code>tmpXXXX_YYYYYYYYA.tmp &lt;-&gt; C:\test\l1\proxy<br>
tmpXXXX_YYYYYYYYB.tmp &lt;-&gt; C:\test\l1\proxy<br>
tmpXXXX_YYYYYYYYC.tmp &lt;-&gt; C:\test\l1\proxy<br>
…<br>
tmpXXXX_YYYYYYYYZ.tmp &lt;-&gt; C:\test\l1\proxy</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<code>C:\test\l1\proxy &lt;-&gt; C:\test\l2\nope</code><br>
<br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br>
<br>
<code>C:\test\l1\proxy &lt;-&gt; C:\test\l2\payload<br>
Licensing.cnt &lt;-&gt; C:\target\path</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Layanan akan terus menulis konten file ke "C: \ test \ l2 \ nope", tetapi akan mengganti nama setelah melewati symlink baru. Jadi, alih-alih mengganti nama, misalnya, “tmpXXXX_YYYYYYYYY.Cmp” menjadi “Licensing.cnt”, “C: \ test \ l2 \ payload” sebenarnya akan diubah namanya (dipindahkan) menjadi “C: \ target \ path”. Bahkan, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kita dapat menempatkan file dengan konten apa pun di jalur apa pun atas nama pengguna NT AUTHORITY \ SYSTEM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara skematis, akan terlihat seperti ini: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/m2/bq/cb/m2bqcbiptwhuauds0bpsn4giyjo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Warna menunjukkan apa yang sebenarnya akan dilakukan karena pengaruh symlink. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meningkatkan hak menggunakan primitif yang dihasilkan sudah mudah - Anda dapat melampirkan dll Anda ke proses sistem dan hal-hal serupa lainnya. Pada tahap ini, saya menghubungi perwakilan ABBYY dan memberikan informasi tentang kerentanan kepada mereka.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat ini, menurut ABBYY, kerentanan ditutup.</font></font><br>
<br>
<h2><font color="orange"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linimasa</font></font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11/25/2019</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - deteksi kerentanan </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11/26/2019</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - meminta kontak keamanan dari produsen </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11/26/2019</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - mengirim laporan kerentanan ke produsen </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12/09/2019</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - kerentanan dikonfirmasi oleh produsen </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10/01/2020</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - kerentanan diperbaiki </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pada 01/22/2020</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - kerentanan ditetapkan pada CVE-2019-20383 </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">02/19/2019 .2020</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - publikasi artikel ini </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada banyak proyek sekarang dan kami memperluas tim "Prospective Monitoring". </font><font style="vertical-align: inherit;">Kami mencari para ahli dalam studi kode sumber, serta para ahli dalam analisis aplikasi mobile. </font><font style="vertical-align: inherit;">Ingin bergabung dengan tim saya - menulis kepada saya, Anastasia (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ana2121</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) atau melalui surat info@amonitoring.ru </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artikel ini dalam bahasa Inggris.</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id488814/index.html">Tempa Kerajaan dari AS3 ke Haxe. Post mortem</a></li>
<li><a href="../id488816/index.html">Bagaimana kami kehilangan Mir: kebakaran di stasiun ruang angkasa, tabrakan dengan truk Progress, depressurization</a></li>
<li><a href="../id488818/index.html">Terobosan #DeepPavlov pada tahun 2019: ulasan dan hasil tahun ini</a></li>
<li><a href="../id488820/index.html">Bagaimana tidak terbakar di tempat kerja dan apa yang harus dilakukan jika Anda masih kelelahan</a></li>
<li><a href="../id488824/index.html">Pertemuan Komunitas Desain DJPL di Raiffeisenbank: Siaran</a></li>
<li><a href="../id488828/index.html">Spam, spam, spam ...</a></li>
<li><a href="../id488830/index.html">Internet di Turkmenistan: harga, ketersediaan, dan pembatasan</a></li>
<li><a href="../id488832/index.html">Anehnya, tahun lalu, HDD perusahaan lebih populer daripada SSD dan penjualan mereka meningkat</a></li>
<li><a href="../id488834/index.html">Bagaimana kesalahan dari 2009 menyebabkan konflik antara Docker untuk Windows dan Razer Synapse</a></li>
<li><a href="../id488836/index.html">Beberapa aspek bekerja dengan Kamus saat mengembangkan aplikasi yang dimuat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>