<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>☎️ 🐖 👨🏼 Google Cloud Spanner：善、悪、悪 🛃 🗄️ 💿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは、ハブロフスク。伝統的に、私たちは新しいコースの立ち上げを見越して興味深い資料を共有し続けています。本日は、特にお客様のために、AWS for Developersコースの開始と同時に、Google Cloud Spannerに関する記事を公開しました。
 
 
 
 もともとはLight...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Google Cloud Spanner：善、悪、悪</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/489012/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは、ハブロフスク。</font><font style="vertical-align: inherit;">伝統的に、私たちは新しいコースの立ち上げを見越して興味深い資料を共有し続けています。</font><font style="vertical-align: inherit;">本日は、特にお客様のために</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、AWS for Developers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コースの開始と同時に、Google Cloud Spannerに関する記事を公開しました</font><font style="vertical-align: inherit;">。</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/aj/iu/8h/ajiu8hhn-nlooidazuy-xsxjb6a.png"><br>
<br>
<hr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もともと</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はLightspeed HQブログに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">投稿さ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">れてい</font></a><font style="vertical-align: inherit;">ます。</font></font></i><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
世界中の小売業者、レストラン経営者、オンライン小売業者に多くのクラウドベースのPOSソリューションを提供する会社として、Lightspeedは、トランザクション、分析、および検索のさまざまなケースにいくつかの異なるタイプのデータベースプラットフォームを使用しています。</font><font style="vertical-align: inherit;">これらのデータベースプラットフォームにはそれぞれ長所と短所があります。その結果、GoogleがCloud Spannerを市場に導入したとき、事実上無制限の水平スケーラビリティや99.999％のサービスレベル契約（SLA）など、リレーショナルデータベースの世界で前例のない有望な機能が-私たちはそれを手に入れる機会を逃すことはできませんでした！</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloud Spannerの使用経験と、使用した評価基準の包括的な概要を説明するために、以下のトピックを取り上げます。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">評価基準</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一言で言えば、Cloud Spanner</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちの評価</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちの調査結果</font></font></li>
</ol><br>
<img src="https://habrastorage.org/webt/2m/br/l7/2mbrl7cdprixgrcxqn4dp25yvju.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.評価基準</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloud Spannerの機能、市場における他のソリューションとの類似点および相違点を詳しく説明する前に、まず、Cloud Spannerをインフラストラクチャのどこにデプロイするかを検討するときに考慮した主なユーザーケースについて説明します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（一般的な）従来のSQLデータベースソリューションの代替として</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OLAPサポートのあるOLTPソリューション</font></font></li>
</ul><br>
<blockquote><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">比較を簡単かつ簡単にするために、この記事ではCloud SpannerをMySQL GCP Cloud SQLおよびAmazon AWS RDSソリューションファミリーと比較します。</font></font></i></blockquote><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">従来のSQLデータベースソリューションの代替としてCloud Spannerを使用する</font></font></h4><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">従来の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベース</font><font style="vertical-align: inherit;">
環境</font><font style="vertical-align: inherit;">では、データベースクエリへの応答時間が事前定義されたアプリケーションのしきい値に近づく、または超える場合（主にユーザーやクエリの数の増加が原因）、いくつかの方法で応答時間を許容レベルに短縮できます。ただし、これらのソリューションのほとんどには手動による介入が含まれます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、最初に実行する必要がある手順は、パフォーマンスに関連するさまざまなデータベースパラメータを確認し、アプリケーションの使用パターンに最も一致するように構成することです。これで十分でない場合は、データベースを垂直または水平にスケーリングすることを選択できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションのスケールアップには、通常、より多くのプロセッサ/コア、より多くのRAM、より高速なストレージなどを追加することにより、サーバーインスタンスの更新が伴います。ハードウェアリソースを追加すると、主にトランザクションで測定されるデータベースのパフォーマンスが向上します。次に、OLTPシステムのトランザクション遅延。 MySQLなどのリレーショナルデータベースシステム（マルチスレッドアプローチを使用）は、垂直方向に拡張できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプローチにはいくつかの欠点がありますが、最も明白なのは、市場での最大サーバーサイズです。最大のサーバーインスタンスの制限に達すると、1つの方法しかありません：水平スケーリングです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
水平スケーリングは、より多くのサーバーをクラスターに追加して、サーバーの数を追加することでパフォーマンスを理想的に線形に向上させるアプローチです。ほとんどの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">従来の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベースシステムは、水平方向に適切に拡張されないか、まったく拡張されません。たとえば、MySQLはスレーブリーダーを追加することで読み取り操作を水平方向にスケーリングできますが、書き込み操作は水平方向にスケーリングできません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一方、Cloud Spannerはその性質上、最小限の干渉で簡単に水平方向にスケーリングできます。</font><i><font style="vertical-align: inherit;">サービスとしての</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
フル機能の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBMS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">異なる角度から評価する必要があります。</font><font style="vertical-align: inherit;">基本として、GoogleはGCP Cloud SQLを、AmazonはAWS RDSのクラウドで最も人気のあるDBMSを採用しました。</font><font style="vertical-align: inherit;">評価では、次のカテゴリに焦点を当てました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機能マッピング：SQLエクステント、DDL、DML; </font><font style="vertical-align: inherit;">接続ライブラリ/コネクタ、トランザクションサポートなど。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開発サポート：開発とテストの容易さ。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理サポート：インスタンスの管理-たとえば、インスタンスのスケールアップ/ダウンおよびアップグレード。</font><font style="vertical-align: inherit;">SLA、バックアップと復元。</font><font style="vertical-align: inherit;">セキュリティ/アクセス制御。</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OLAPサポートのあるCloud SpannerをOLTPとして使用する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloud Spannerは分析処理用であるとGoogleは明示的に主張していませんが、OLAPワークロード用に設計されたApache Impala＆KuduやYugaByteなどの他のメカニズムといくつかの属性を共有しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloud Spannerに、（多かれ少なかれ）使用可能なOLAP機能のセットを備えた、一貫して水平方向にスケーラブルなHTAP（ハイブリッドトランザクション/分析処理）エンジンが含まれる可能性はほんのわずかでしたが、注目に値すると思います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを念頭に置いて、次のカテゴリを検討しました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データの読み込み、インデックス、パーティショニングのサポート</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クエリのパフォーマンスとDML</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.一言で言えばCloud Spanner</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Google Spannerは、Googleが独自のサービスのいくつかに使用するクラスターリレーショナルデータベース管理システム（RDBMS）です。</font><font style="vertical-align: inherit;">Googleは、2017年の初めにそれをGoogle Cloud Platformユーザーに公開しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloud Spannerの属性の一部を以下に示します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高度に一貫性のあるスケーラブルなRDBMSクラスター：ハードウェアの時刻同期を使用して、データの一貫性を確保します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クロステーブルトランザクションのサポート：トランザクションは複数のテーブルにまたがることができます-（Apache HBaseやApache Kuduとは異なり）必ずしも1つのテーブルに限定されません。</font></font></li>
<li>    :        (),       .      ,           .       ,             <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>.</li>
<li> :        .          .     ,        , ,       -.</li>
<li>: Cloud Spanner   .         .         .         .     , ,    ,   .         ,    .</li>
</ul><br>
<i>«Cloud Spanner       .  , Cloud Spanner     ,    - ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>».</i><br>
<br>
<ul>
<li>    (SLA):      SLA  99,99%;    99,999% SLA.          ,   - ,  ,    Google     ,     . ( , 99,999%  26,3     .)</li>
<li>: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">https://cloud.google.com/spanner/</a></li>
</ul><br>
<blockquote><i><b>:</b>  Apache Tephra      Apache HBase (    Apache Phoenix   -).</i></blockquote><br>
<h2>3.  </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、Cloud Spannerの利点についてのGoogleの声明をすべて読んでいます-事実上無制限の水平スケーリングと、高い一貫性と非常に高いSLAを維持します。</font><font style="vertical-align: inherit;">いずれにしても、これらの要件を達成することは非常に困難ですが、私たちの目標はそれらを否定することではありませんでした。</font><font style="vertical-align: inherit;">代わりに、ほとんどのデータベースユーザーが気にする他のことに焦点を当てましょう：パリティと使いやすさ。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloud SpannerをSharded MySQLの代替として評価しました</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラウド市場で最も人気のある2つのOLTP DBMSであるGoogle Cloud SQLとAmazon AWS RDSには、非常に大きな機能セットがあります。</font><font style="vertical-align: inherit;">ただし、これらのデータベースを単一ノードのサイズを超えてスケ​​ーリングするには、アプリケーションのパーティション化を実行する必要があります。</font><font style="vertical-align: inherit;">このアプローチにより、アプリケーションと管理の両方がさらに複雑になります。</font><font style="vertical-align: inherit;">複数のセグメントを1つのインスタンスに結合するシナリオにSpannerがどのように適合するか、およびどの機能（存在する場合）を犠牲にする必要があるかを調べました。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL、DML、DDL、およびコネクタとライブラリのサポート？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、任意のデータベースで開始するときは、データモデルを作成する必要があります。</font><font style="vertical-align: inherit;">JDBC Spannerをお気に入りのSQLツールに接続できると思われる場合は、それを使用してデータをクエリできますが、それを使用してテーブルを作成したり変更（DDL）したり、挿入/更新/削除操作（ DML）。</font><font style="vertical-align: inherit;">Googleの公式JDBCもサポートしていません。</font></font><br>
<blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「ドライバーは現在、DMLまたはDDLをサポートしていません。」</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Spannerのドキュメント</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GCP Consoleを使用すると、状況は改善されません。送信できるのはSELECTクエリのみです。幸い、トランザクション</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/olavloite/spanner-jdbc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">など、コミュニティからのDMLおよびDDLサポートを備えたJDBCドライバーがあります</font><font style="vertical-align: inherit;">。このドライバーは非常に便利ですが、Google独自のJDBCドライバーがないことは驚くべきことです。幸い、Googleはクライアントライブラリ（gRPCに基づく）に対してかなり幅広いサポートを提供しています：C＃、Go、Java、node.js、PHP、Python、Ruby。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloud SpannerユーザーAPIのほぼ必須の使用（JDBCにはDDLとDMLがないため）は、接続プールやデータベースバインディングフレームワーク（Spring MVCなど）などのコードの関連領域にいくつかの制限をもたらします。原則として、JDBCを使用する場合、テストして適切に機能するお気に入りの接続プール（たとえば、HikariCP、DBCP、C3POなど）を自由に選択できます。カスタムSpanner APIの場合、私たちが自分で作成したフレームワーク/バインディングプール/セッションに依存する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
主キー（PC）の設計により、PC経由でデータにアクセスするときにCloud Spannerを非常に高速にすることができますが、クエリの問題も発生します。</font></font><br>
<br>
<ul>
<li>      ;               . (       / .)</li>
<li>  UPDATE  DELETE     WHERE, ,      DELETE all —    , : UPDATE xxx WHERE id IN (SELECT id FROM table1)</li>
<li>    - ,      .   ,        .</li>
</ul><br>
<h4> ?</h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Google Cloud Spannerには、セカンダリインデックスのサポートが組み込まれています。これは非常に優れた機能であり、他のテクノロジーには常に存在するとは限りません。現在、Apache Kuduはセカンダリインデックスをまったくサポートしていません。ApacheHBaseはインデックスを直接サポートしていませんが、Apache Phoenixを介して追加できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
KuduとHBaseのインデックスは、主キーの構成が異なる別のテーブルとしてモデル化できますが、親テーブルと関連するインデックステーブルで実行される操作のアトミック性はアプリケーションレベルで実行する必要があり、正しい実装では簡単ではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloud Spannerのレビューで述べたように、そのインデックスはMySQLのインデックスと異なる場合があります。</font><font style="vertical-align: inherit;">したがって、クエリとプロファイリングを作成するときは、必要な場所で適切なインデックスが使用されるように特に注意する必要があります。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表現？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データベースで非常に人気があり便利なオブジェクトはビューです。</font><font style="vertical-align: inherit;">これらは、多数のユーザーケースに役立ちます。</font><font style="vertical-align: inherit;">私の2つのお気に入りは、論理的抽象化のレベルとセキュリティのレベルです。</font><font style="vertical-align: inherit;">残念ながら、Cloud Spannerは送信をサポートしていません。</font><font style="vertical-align: inherit;">ただし、これによって部分的に制限されるのは、アクセス許可の場合、表現が許容できるソリューションである列レベルでの細分性がないためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloud Spannerのドキュメントには、割り当てと制限の詳細が記載されたセクションがあります（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">spanner / quotas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）特に、一部のアプリケーションで問題になる可能性があるものがあります。そのまま使用できるCloud Spannerには、インスタンスごとに最大100データベースの制限があります。</font><font style="vertical-align: inherit;">明らかに、これは100以上のデータベースに拡張するように設計されたデータベースにとって深刻な障害になる可能性があります。</font><font style="vertical-align: inherit;">幸い、Googleの技術担当者と話し合ったところ、Googleのサポートを通じて、この制限をほとんどすべての値に増やすことができることがわかりました。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開発サポート？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloud Spannerは、APIと連携するプログラミング言語をかなり適切にサポートしています。</font><font style="vertical-align: inherit;">公式にサポートされているライブラリは、C＃、Go、Java、node.js、PHP、Python、Rubyの領域にあります。</font><font style="vertical-align: inherit;">ドキュメントは非常に詳細ですが、他の高度なテクノロジーと同様に、コミュニティは最も一般的なデータベーステクノロジーと比較して非常に小さいため、あまり一般的でないユースケースや問題の解決に費やす時間が増加する可能性があります。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">では、地域の開発支援についてはどうでしょうか？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ローカル環境でCloud Spannerインスタンスを作成する方法が見つかりませんでした。</font><font style="vertical-align: inherit;">入手したものに最も近いのは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CockroachDB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dockerイメージです</font><font style="vertical-align: inherit;">。これは原則として同じですが、実際には非常に異なります。</font><font style="vertical-align: inherit;">たとえば、CockroachDBはPostgreSQL JDBCを使用する場合があります。</font><font style="vertical-align: inherit;">開発環境は作業環境にできる限り近い必要があるため、完全なSpannerインスタンスに依存する必要があるため、Cloud Spannerは理想的ではありません。</font><font style="vertical-align: inherit;">コストを節約するために、1つのリージョンのインスタンスを選択できます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理サポート？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloud Spannerインスタンスの作成は簡単です。</font><font style="vertical-align: inherit;">1つのリージョンに対してマルチリージョンまたはインスタンスのどちらを作成するかを選択し、リージョンとノード数を指定するだけです。</font><font style="vertical-align: inherit;">1分も経たないうちに、インスタンスが稼働し始めます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いくつかの基本的な指標は、GoogleコンソールのSpannerページで直接利用できます。</font><font style="vertical-align: inherit;">Stackdriverを介してより詳細なビューを利用できます。ここでは、しきい値の指標とアラートポリシーも設定できます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リソースへのアクセス？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQLは、広範囲にわたる非常に詳細なユーザー権限/ロール設定を提供します。</font><font style="vertical-align: inherit;">特定のテーブルへのアクセス、またはその列のサブセットのみを簡単に構成できます。</font><font style="vertical-align: inherit;">Cloud SpannerはGoogle Identity＆Access Management（IAM）を使用しており、非常に高いレベルでのみポリシーと権限を設定できます。</font><font style="vertical-align: inherit;">最も詳細なオプションは、データベースレベルの解決策であり、ほとんどの実稼働ケースには適合しません。</font><font style="vertical-align: inherit;">この制限により、コード、インフラストラクチャ、またはその両方にセキュリティ対策を追加して、Spannerリソースの不正使用を防止する必要があります。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バックアップ？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
簡単に言うと、Cloud Spannerにバックアップはありません。</font><font style="vertical-align: inherit;">Google SLAの高い要件は、ハードウェアまたはデータベースの障害、人的エラー、アプリケーションの欠陥などが原因でデータが失われないことを保証できますが、高可用性は合理的なバックアップ戦略に取って代わるものではありません。</font><font style="vertical-align: inherit;">現在、データをバックアップする唯一の方法は、データベースから別のストレージ環境にプログラムでデータをストリーミングすることです。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クエリのパフォーマンス？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yahoo!を使用してデータをダウンロードし、クエリをテストしました。クラウドサービスベンチマーク。次の表は、読み取り率が95％、書き込み率が5％のYCSB Bワークロードを示しています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vx/po/h4/vxpoh4penig4qvaa5sj1gvflfvm.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*負荷テストはn1-standard-32計算エンジン（CE）（32 vCPU、120 GBのメモリ）で実行され、テストインスタンスがテストのボトルネックになることはありませんでした。</font></font></i><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">** YCSBの1つのインスタンスのスレッドの最大数は400です。合計で2400のスレッドを取得するには、YCSBテストの6つの並列インスタンスを実行する必要がありました。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テスト結果、特にプロセッサの負荷とTPSの組み合わせを見ると、Cloud Spannerが非常に適切にスケーリングしていることがわかります。</font><font style="vertical-align: inherit;">多数のスレッドによって作成された大きな負荷は、Cloud Spannerクラスタ内の多数のノードによって補われます。</font><font style="vertical-align: inherit;">特に2400スレッドで作業している場合、遅延はかなり大きく見えますが、より正確な数値を取得するには、計算エンジンの6つの小さなインスタンスで再テストする必要がある場合があります。</font><font style="vertical-align: inherit;">各インスタンスは、6つの並列テストを持つ1つの大きなCEインスタンスではなく、1つのYCSBテストを実行します。</font><font style="vertical-align: inherit;">したがって、Cloud Spannerリクエストの遅延と、Cloud Spannerとテストが実行されているCEインスタンスとの間のネットワーク接続によって追加された遅延を簡単に区別できます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloud SpannerはOLAPをどのように処理しますか？</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パーティショニング？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データをパーティションと呼ばれる物理的または論理的に独立したセグメントに分割することは、ほとんどのOLAPメカニズムに固有の非常に人気のある概念です。パーティションは、クエリのパフォーマンスとデータベースのサポートを大幅に向上させることができます。パーティションをさらに深くすることは別の記事で出てくるので、パーティション化スキームとサブパーティション化の重要性について触れましょう。データをパーティションに分割し、さらにサブパーティションに分割する機能は、分析クエリのパフォーマンスにとって重要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloud Spannerはパーティション自体をサポートしていません。データをいわゆる</font><i><font style="vertical-align: inherit;">分割に</font></i><font style="vertical-align: inherit;">内部的に分割します</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">■主キー範囲に基づく。</font><font style="vertical-align: inherit;">Cloud Spannerクラスタの負荷を分散するために、分離が自動的に実行されます。</font><font style="vertical-align: inherit;">Cloud Spannerの非常に便利な機能は、親テーブル（別のテーブルと交互にならないテーブル）の基本負荷を分割することです。</font><font style="vertical-align: inherit;">Spannerは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スプリット</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に他の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スプリット</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><font style="vertical-align: inherit;">データよりも頻繁に読み取られるデータが</font><font style="vertical-align: inherit;">含まれているかどうかを自動的に判断し、</font><font style="vertical-align: inherit;">さらに分離することを決定できます。</font><font style="vertical-align: inherit;">したがって、より多くのノードが要求に関与する可能性があり、スループットも効果的に増加します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データのロード？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バルクデータのCloud Spannerメソッドは、通常のダウンロードと同じです。</font><font style="vertical-align: inherit;">最大のパフォーマンスを達成するには、次のような推奨事項に従う必要があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データを主キーでソートします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それらを10 * </font><font style="vertical-align: inherit;">個々のセクション</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のノード数で割り</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データを並行してロードする一連の作業タスクを作成します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このデータのダウンロードでは、すべてのCloud Spannerノードが使用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A YCSBワークロードを使用して、1,000万行のデータセットを生成しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4n/-o/nj/4n-onjrzn_2nco-hz8o3vnr42d4.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*負荷テストはn1-standard-32コンピューティングエンジン（32 vCPU、120 GBのメモリ）で実行され、テストインスタンスがテストのボトルネックになることはありませんでした。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
** 1ノード構成は、運用負荷にはお勧めできません。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前述のとおり、Cloud Spannerは負荷に応じて自動的にsplit-sを処理するため、テストを数回連続して繰り返すと結果が向上します。</font><font style="vertical-align: inherit;">ここに示す結果は、私たちが受け取った最高の結果です。</font><font style="vertical-align: inherit;">上記の数値を見ると、Cloud Spannerがクラスター内のノード数の増加に伴って（適切に）スケーリングされていることがわかります。</font><font style="vertical-align: inherit;">上記のセクションで説明したように、際立った数値は、混合ワークロードの結果（読み取りで95％、書き込みで5％）とは対照的に、非常に低い平均遅延です。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スケーリング？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloud Spannerノードの数の増減は、ワンクリックのタスクです。データをすばやくロードしたい場合は、インスタンスを最大にブーストすることを検討して（この場合は、US-EASTリージョンの25ノードでした）、データベース内のすべてのデータの後、通常のロードに適したノードの数を減らします。ノードあたり2 TBの制限に留意してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データベースがはるかに小さい場合でも、この制限を思い出しました。負荷テストを数回実行した後、データベースのサイズは約155 GBでした。1ノードのインスタンスに削減すると、次のエラーが発生しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bx/_b/ge/bx_bgefdcl_ouf3ldvrdoxglyks.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スケールを25から2インスタンスに削減できましたが、2つのノードでスタックしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloud Spannerクラスタのノード数の増減は、REST APIを使用して自動化できます。</font><font style="vertical-align: inherit;">これは、忙しい時間帯に増加するシステムの負荷を軽減するのに特に役立ちます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OLAPクエリのパフォーマンス？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初は、この部分のSpannerの評価にかなりの時間を割く予定でした。</font><font style="vertical-align: inherit;">いくつかのSELECT COUNTを行った後、テストは短時間で済み、SpannerはOLAPエンジンではないことにすぐに気付きました。</font><font style="vertical-align: inherit;">クラスター内のノード数に関係なく、1千万行のテーブルの行数を簡単に選択するには、55〜60秒かかりました。</font><font style="vertical-align: inherit;">さらに、中間結果を格納するためにより多くのメモリを必要とする要求は、OOMエラーで失敗しました。</font></font><br>
<br>
<code>SELECT COUNT(DISTINCT(field0)) FROM usertable; — (10M distinct values)-&gt; SpoolingHashAggregateIterator ran out of memory during new row.</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TPC-Hリクエストのいくつかの番号は、Todd Lipconの記事</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nosql-kudu-spanner-slides.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、スライド42および43にあります。これらの番号は、残念ながら私たち自身の結果と一致しています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/di/c2/sh/dic2sh_wvmvfus16nhrbftomm1g.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.調査結果</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloud Spanner機能の現在の状態を考えると、それが既存のOLTPソリューションの単純な代替品であるとは想像できません。 Cloud Spannerの欠点を考慮したソリューションの構築には、かなりの時間を費やす必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloud Spannerの評価を開始したとき、その管理機能は他のGoogle SQLソリューションと同じか、少なくともそれほど遠くないと期待していました。しかし、バックアップの完全な欠如と、リソースへのアクセスの制御が非常に制限されていることに驚きました。ビューの欠如、ローカル開発環境の欠如、サポートされていないシーケンス、DMLおよびDDLサポートのないJDBCなどは言うまでもありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
では、トランザクションデータベースをスケーリングする必要がある人はどこに行くのでしょうか。市場には、すべてのユースケースに適した単一のソリューションはないようです。多くのクローズドオープンソリューションとオープンソースソリューションがあり（その一部はこの記事で説明されています）、それぞれに独自の長所と短所がありますが、99.999％のSLAと高度な整合性を備えたSaaSを提供するものはありません。高いSLAが主な目標であり、複数のクラウド環境用に独自のソリューションを作成する傾向がない場合は、Cloud Spannerが探しているソリューションである可能性があります。ただし、そのすべての制限に注意する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
公平に言えば、Cloud Spannerは2017年の春にのみ一般にリリースされなかったので、現在の欠点のいくつかが最終的にはなくなる可能性があることを期待することは合理的であり（そうなると思います）、それが発生すると、ゲームを変えることができます。結局のところ、Cloud SpannerはGoogleの単なるサードパーティプロジェクトではありません。 Googleは他のGoogle製品の基礎としてそれを使用します。また、Googleが最近Google Cloud StorageのMegastoreをCloud Spannerに置き換えたとき、Google Cloud Storageはオブジェクトリストに対してグローバルに厳密に一貫することができました（これは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazonの</font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S3に</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はまだ適用されません</font><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ですから、まだ希望はあります...</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それで全部です。</font><font style="vertical-align: inherit;">記事の著者と同様に、私たちは引き続き希望していますが、これについてどう思いますか？</font><font style="vertical-align: inherit;">コメントを</font><b><font style="vertical-align: inherit;">書き込んでください。OTUS </font></b><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">AWS for Developers</font></a></b><b><font style="vertical-align: inherit;">コース</font></b><b><font style="vertical-align: inherit;">について詳しく説明するフレームワークの中で</font></b><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">、</font></a></b></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">誰もが</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">無料のウェビナーに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">招待されています</font><font style="vertical-align: inherit;">。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></b></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja489000/index.html">クールなミタップを組み立てる方法：3つの「シリアルミタッパー」からの16のヒント。Leader-ITイベント＃1</a></li>
<li><a href="../ja489002/index.html">分散型ホイールセットレジストリ：Hyperledger Fabricの使用経験</a></li>
<li><a href="../ja489004/index.html">ディスクダイヤラ付き携帯電話</a></li>
<li><a href="../ja489008/index.html">Hobotフレームワークを使用した複雑なチャットボットでのルーティング</a></li>
<li><a href="../ja489010/index.html">オンライン学習に関するデータのロシアで最大のレイヤーを、言語学、パーソナライゼーション、peddesign、MLのプロジェクトと共有します</a></li>
<li><a href="../ja489014/index.html">本「完璧なアルゴリズム。貪欲なアルゴリズムと動的プログラミング»</a></li>
<li><a href="../ja489016/index.html">ドイツのGref：「私たちはAGIについての議論を組織しようとしましたが、一人の自尊心のある科学者がそれに来たのではありません。」</a></li>
<li><a href="../ja489020/index.html">悪意のある人の研究</a></li>
<li><a href="../ja489022/index.html">MonbMQパート2でのRabbitMQの使用</a></li>
<li><a href="../ja489024/index.html">初心者の目から見たWebix JavaScriptライブラリ。パート5.ユーザー側でデータを操作する</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>