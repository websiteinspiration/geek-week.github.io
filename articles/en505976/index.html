<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶ñ üßú üï≥Ô∏è Microservice Application Monitoring: A SRE Look üèúÔ∏è üòí üßóüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Modern infrastructure - many small applications launched in the context of a single application manager that manages their number, updating and resour...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Microservice Application Monitoring: A SRE Look</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/505976/"><img src="https://habrastorage.org/webt/dt/7s/-r/dt7s-rugbftxc_xkvin7i3zwvpa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Modern infrastructure - many small applications launched in the context of a single application manager that manages their number, updating and resource requests. It is not such because administrators decided it was so convenient to manage it. Such an infrastructure reflects current thinking in software development. In order to understand why we are talking about microservice architecture as an ideology, you need to go back 30 years.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the late 80s / early 90s, object-oriented programming was the answer to the growing volume of software - after all, it was then that personal computers began to be used everywhere. If earlier the software was a small ‚Äúutility‚Äù, then somewhere around this time the development of large-scale software turned into a big business. Development teams of thousands of people, creating great functionality, have ceased to be something supernatural. Business needed to understand how it is possible to divide the work of teams of programmers so that everything is not mixed up - and object-oriented programming was the answer to this question. The app release cycle was still slow.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You planned to release your product (let it be Microsoft Office 95) in a few years. After the development was completed, you tested it in detail (after all, you cannot easily fix errors after the application is delivered to the end user). Then you sent the ‚Äúbinaries‚Äù to the factory where the circulation of CDs (or floppy disks) was made, all this was packed in cardboard boxes and delivered around the world to stores where the user bought them and then installed the application on their computer ... - this is the main thing difference with what is happening now.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since 2010, microservice architecture has been the answer to the need for large applications and companies to update as quickly as possible. We no longer need to install the application on users' computers. We, in fact, ‚Äúinstall‚Äù the application in our infrastructure and can quickly update it. Thus, we can (and the business wants) to conduct updates as quickly as possible in order to experiment and test hypotheses. Business needs to create new functionality in order to attract new users and keep current ones. Businesses need to experiment and watch, as a result of which the user can pay more money. Finally, it is important for business to keep up with competitors. The business wants to update codebases at least dozens of times a day. In theory, this can be done on one large application;but if you break it into many small pieces, the manageability of updates will increase. That is, the transition to microservice architecture was almost never based on the desire of the business to increase the stability of the application and infrastructure: microservices are part of agile, and the business was guided by the ability to increase the ‚Äúflexibility‚Äù of the application.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What does flexibility mean? This is speed, this is the ease of change, this is an opportunity to quickly change your mind. Thus, the priority is not the solidity of the solution, but the maximum delivery speed of this solution, the ability to quickly test the concept. It is assumed, however, that after the solution is tested, resources will be allocated to make it thorough - which in practice (especially in small teams, in developing businesses, where the whole focus is on product development) does not happen. A technical debt is created, the danger of which is especially growing in the context of the belief that ‚Äúkubernetis will raise everything itself." </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But this is not so: I recently stumbled upon an excellent quote that speaks both of the pros and the horrors of Kubernetes for exploitation.</font></font><br>
<br>
<blockquote><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">¬´Kubernetes is so awesome that one of our JVM containers has been periodically running out of memory for more than a year, and we just recently realized about it¬ª.</a></blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's think about this phrase. During the year, the application from time to time fell out of memory - and the operating team did not pay attention to it. Does this mean that the application most of the time continued to work stably and perform its task? At first glance, the function is really good: instead of the admin receiving a message about a service crash and going to raise it, Kubernetes itself found that the application crashed and restarted it itself. During the year, this happened regularly, and no messages were sent to the administration service. I saw a project where, however, a similar situation occurred strictly in one case - when generating a monthly report. The functionality of the report was developed and pumped out to help business,but after a short time, users began to receive HTTP 502 on their requests - the application crashed, the request was interrupted, and Kubernetes reloaded the application. And although the application itself worked fine while doing this, the report generation process was never performed. Employees of the company who needed it preferred to do the old-fashioned reporting and did not report a mistake (it is needed only once a month - you can do it the old way, why bother people), and the maintenance service did not give priority to a task that arises from strength once a month. However, in the end, this leads to the fact that all the resources that were spent to create this functionality (business analysis, planning, development) were wasted. This was also learned a year later.And although the application itself worked fine while doing this, the report generation process was never performed. Employees of the company who needed it preferred to do the old-fashioned reporting and did not report a mistake (it is needed only once a month - you can do it the old way, why bother people), and the maintenance service did not give priority to a task that arises from strength once a month. However, in the end, this leads to the fact that all the resources that were spent to create this functionality (business analysis, planning, development) were wasted. This was also learned a year later.And although the application itself worked fine while doing this, the report generation process was never performed. Employees of the company who needed it preferred to do the old-fashioned reporting and did not report a mistake (it is needed only once a month - you can do it the old way, why bother people), and the maintenance service did not give priority to a task that arises from strength once a month. However, in the end, this leads to the fact that all the resources that were spent to create this functionality (business analysis, planning, development) were wasted. This was also learned a year later.and the operation service did not give priority to the task, which arises on the strength of once a month. However, in the end, this leads to the fact that all the resources that were spent to create this functionality (business analysis, planning, development) were wasted. This was also learned a year later.and the operation service did not give priority to the task, which arises on the strength of once a month. However, in the end, this leads to the fact that all the resources that were spent to create this functionality (business analysis, planning, development) were wasted. This was also learned a year later.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In our work, we chose a number of practices in which we try to close the risks of supporting microservice applications based on already full cones. </font><font style="vertical-align: inherit;">In this article I will try to talk about the 10 most important of them.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Service reboots are not monitored, or they are not given due importance</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example:</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
An example is described above. </font><font style="vertical-align: inherit;">Problem: at least the reboot itself is the user who did not get the result, at the most - the same function may not be systematically performed. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What to do? </font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Basic level of monitoring: monitor the fact of reboots of your services. </font><font style="vertical-align: inherit;">Perhaps you should not give priority to a service that is rebooted every three months, but if a service starts to reboot every five minutes, this is undoubtedly a priority. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Advanced level of monitoring: pay attention to all the services that have ever rebooted, and organize the task setting process to analyze such reboots.</font></font><br>
<br>
<br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Service errors (such as Fatal Error or Exceptions) are not monitored</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example: An</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
application may not crash, but it will expose the trace to the user (or other application via the API). </font><font style="vertical-align: inherit;">Thus, even if we monitored application reloads, we may not detect cases when the query completed incorrectly. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What to do? </font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Application logs should be aggregated in any system and analyzed. </font><font style="vertical-align: inherit;">Errors must be systematically analyzed with ‚Äúeyes,‚Äù and critical errors must be alerted and escalated immediately.</font></font><br>
<br>
<br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Endpoint with a health-check service is missing or does not make meaningful work</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example:</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Creating endpoints issuing service metrics (preferably in the OpenMetrics format) so that they can be read (for example, by Prometheus), thank God, has become practically a standard. However, in conditions when the business is pushing towards the development of functionality, developers often do not want to spend extra time thinking through metrics. As a result, health-check services are quite common, the whole point of which is to display the ‚Äúok‚Äù message. If the application is able to display something on the screen, it is considered that this is already ok. However, it is not. Such a check, if the application cannot reach the database server, will still say ‚Äúok‚Äù and will give incorrect information, making it difficult to detect the problem. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What to do:</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Firstly, the fact of endpoint with healthcheck should become the standard for any of your services, if not already. </font><font style="vertical-align: inherit;">Secondly, such a healthcheck should examine the health / accessibility of critical systems for the functioning of the service (accesses to queues, databases, accessibility of services, and so on).</font></font><br>
<br>
<br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API response time and interaction with other services are not monitored</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example:</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
In the conditions when most parts of the application have become interacting with each other clients and servers, it is critically important for the API to understand how long a particular service gives an answer. If for some reason it has increased, the total application response time may turn into a waterfall of delays. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What to do:</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Use tracing. Jaeger has become almost the standard. There is an awesome working group working on the OpenTracing format, similar to OpenMetrics. Here in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this report</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> you can find an API for your programming language that can provide opentracing metrics for application time and interaction with services so that you upload it to Prometheus.</font></font><br>
<br>
<br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A service is still an application, and an application is still a memory and processor (and sometimes a disk)</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An example and what to do:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> here, I think everything is clear. </font><font style="vertical-align: inherit;">Quite often, monitoring the performance of individual services is overlooked: how much they consume the processor, how much RAM, if measurable, how they consume the ‚Äúdisk‚Äù. </font><font style="vertical-align: inherit;">In general, all standard metrics for monitoring the ‚Äúserver‚Äù. </font><font style="vertical-align: inherit;">Often we see how the entire node is monitored without monitoring individual services - and in vain.</font></font><br>
<br>
<br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The emergence of new services should be monitored</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example:</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
This is a rather funny moment. </font><font style="vertical-align: inherit;">In conditions when there are many development teams, there are even more services, and SRE is shifted towards the responsibility of the development team, the cluster operation team should generally monitor (and receive notifications) the appearance of new services. </font><font style="vertical-align: inherit;">Let you have a standard on how a new service should be monitored, what metrics it should export to the outside, how its performance should be monitored - when a new service appears, you should still make sure that these standards are respected. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What to do:</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Put an alert on the appearance of new services in the infrastructure.</font></font><br>
<br>
<br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monitoring delivery time and other CI / CD metrics</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example:</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Another problem that has appeared relatively recently. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Performance is not only the performance of the application as such, but also the speed of its calculation. </font><font style="vertical-align: inherit;">Complex CI / CD processes + complication of the application assembly process + assembly of the delivery container = and here the simple calculation process is not so simple anymore ;-) We </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wrote an article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> about this </font><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At some point, you may find that the calculation of the service began to take up instead of one minute - twenty ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What to do:</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Monitor the delivery time of the application, from assembly to the appearance of it in production. </font><font style="vertical-align: inherit;">If time has increased - study what happened.</font></font><br>
<br>
<br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APM and application profiling</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An example and what to do:</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
At the moment when you find out that a problem has occurred with the service ‚Äî it has started to respond for a long time or has become unavailable, or any other problems have occurred ‚Äî you will least want to delve into the interior of the service or try to restart it in order to localize the error. </font><font style="vertical-align: inherit;">In our practice, it is very often possible to track the problem when you have detailed monitoring at the Application Performance Monitoring level: most often the problem does not occur simultaneously, but ‚Äúaccumulates‚Äù in time - and with APM data you can understand when it happened. </font><font style="vertical-align: inherit;">Also learn how to use the profilers available at the system level. </font><font style="vertical-align: inherit;">With the development of eBPF, a huge number of possibilities have appeared for this.</font></font><br>
<br>
<br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WAF Event Monitoring, Shodan Monitoring, and Image and Package Security Monitoring</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example:</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Monitoring is not just about performance issues. There are a number of simple steps that you can take to improve the security of your service: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - monitor the results of your application‚Äôs assembly when executing commands such as npm audit or similar ones ‚Äî you can receive alerts that are in the current version of the libraries you use and update them to the protected version. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Connect the Shodan service API, which scans open databases and ports on the Internet. Check your IP through the API in order to be sure that you do not have open ports, and the databases have not leaked to open access.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - if you use WAF - put alerts on WAF events to understand when an attacker will purposefully come to you and look at the attack vectors that he uses.</font></font><br>
<br>
<br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonus track: SRE, application response time - no longer server response time!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We are used to measuring system performance by server response time, but a modern web application is 80% of its logic transferred to the front-end. </font><font style="vertical-align: inherit;">If you have not measured the response time of the application as the time it took to display a page with front-end metrics for page loading, start now. </font><font style="vertical-align: inherit;">It doesn‚Äôt matter to the user at all, for 200 or 400 milliseconds he gave the server an answer, if the front on Angular-e or React-e further draws it in 10 seconds. </font><font style="vertical-align: inherit;">In general, I generally believe that optimizing performance will largely go to the front or appear as a new discipline. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And I‚Äôm a little more regular than the blog here, I keep </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my telegram channel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , subscribe :-)</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en505954/index.html">Alpine.js - events and global data warehouse</a></li>
<li><a href="../en505956/index.html">20 platforms for making money on testing</a></li>
<li><a href="../en505958/index.html">What they talked about at the final demo day of StartupDrive</a></li>
<li><a href="../en505966/index.html">Thyroid functions: cognitive health and metabolism, iodine</a></li>
<li><a href="../en505972/index.html">Shining 3D Einscan SE compact 3D scanner review</a></li>
<li><a href="../en505978/index.html">The Tale of How I Configured Azure AD B2C on React and React Native Part 5 (Tutorial)</a></li>
<li><a href="../en505980/index.html">Vivaldi 3.1 for Android - Big in Small</a></li>
<li><a href="../en505982/index.html">Webinar "Winnum Machine Tools: Monitoring and Diagnostics of Production Equipment in Real Time"</a></li>
<li><a href="../en505986/index.html">8 features of Google Translate that you are most likely not using</a></li>
<li><a href="../en505990/index.html">React Native: Push Notifications with AWS Amplify</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>