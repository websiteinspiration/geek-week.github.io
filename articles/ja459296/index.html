<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐹 👩🏻‍🎓 📧 JavaScript価格2019 💽 👨🏿‍⚕️ 🏈</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="過去数年にわたって、「JavaScript価格」と呼ばれるものは、解析速度の向上とスクリプトのブラウザーコンパイルにより、大きなプラスの変化が見られました。現在、2019年、JavaScriptによって作成されたシステムの負荷の主なコンポーネントは、スクリプトのロード時間とその実行時間です。 ブラウ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>JavaScript価格2019</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/459296/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">過去数年にわたって、「</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScript価格</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」</font><font style="vertical-align: inherit;">と呼ばれるものは</font><font style="vertical-align: inherit;">、解析速度の向上とスクリプトのブラウザーコンパイルにより、大きなプラスの変化が見られました。</font><font style="vertical-align: inherit;">現在、2019年、JavaScriptによって作成されたシステムの負荷の主なコンポーネントは、スクリプトのロード時間とその実行時間です。</font><font style="vertical-align: inherit;">
ブラウザがJavaScriptコードの実行でビジー状態の場合、ユーザーによるサイトとの対話が一時的に中断される可能性があります。</font><font style="vertical-align: inherit;">その結果、スクリプトの読み込みと実行に関連するボトルネックの最適化は、サイトのパフォーマンスに大きなプラスの影響を与えると言えます。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/7x/g6/g_/7xg6g_poas_6_4qwu5u4clgjxrs.jpeg"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウェブサイト最適化のための一般的な実用的なガイドライン</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記はWeb開発者にとって何を意味しますか？</font><font style="vertical-align: inherit;">ここでのポイントは、解析（解析、解析）とスクリプトのコンパイルのためのリソースのコストが以前ほど深刻ではないということです。</font><font style="vertical-align: inherit;">したがって、JavaScriptバンドルを分析して最適化する場合、開発者は次の3つの推奨事項を検討する必要があります。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトのダウンロードに必要な時間を短縮するようにしてください。</font></font><br>
 <br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSバンドルを小さく保つようにしてください。</font><font style="vertical-align: inherit;">これは、モバイルデバイス向けに設計されたサイトでは特に重要です。</font><font style="vertical-align: inherit;">小さなバンドルを使用すると、コードのロード時間が改善され、メモリ使用量が減少し、CPU負荷が減少します。</font></font></li>
<li>,             .      50-100  —       .  HTTP/2-            .     ,         .</li>
<li>      — ,        .           .  ,     .</li>
</ul></li>
<li>  ,    .<br>
 <br>
<ul>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>,           ,   ,      ,       .     ,   ,    ,     « JavaScript».</li>
</ul></li>
<li>      .<br>
 <br>
<ul>
<li>    :     1  —       .        ,  1  —   ,    Chrome   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>   .  ,  ,            .</li>
</ul></li>
</ol><br>
<h2><font color="#3AC1EF">       ?</font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現代の状況でスクリプトの読み込みと実行時間を最適化することがなぜ重要なのですか？スクリプトの読み込み時間は、サイトが低速のネットワーク経由でアクセスされる状況で非常に重要です。 4Gネットワ​​ーク（さらには5G）がますます広がっているという事実にもかかわらず、</font><font style="vertical-align: inherit;">モバイルインターネット接続を使用する多くの場合の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NetworkInformation.effectiveType</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティ</font><font style="vertical-align: inherit;">は、3Gネットワ​​ークのレベルまたはそれより低いレベルのインジケーターを示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JSコードの実行に必要な時間は、遅いプロセッサを搭載したモバイルデバイスにとって重要です。モバイルデバイスは異なるCPUとGPUを使用するため、デバイスが過熱すると、それらを保護するためにコンポーネントのパフォーマンスが低下するため、高価で安価な携帯電話とタブレットのパフォーマンスの間に深刻なギャップがあることがわかります。一部のデバイスでこのようなコードを実行する機能は、このデバイスのプロセッサ機能によって制限されるため、これはJavaScriptコードのパフォーマンスに大きく影響します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、Chromeなどのブラウザーでページをロードして準備するのに費やした合計時間を分析すると、この時間の約30％がJSコードの実行に費やされる可能性があります。</font><font style="vertical-align: inherit;">以下は、高性能デスクトップコンピューターでの非常に典型的なWebページ（reddit.com）の読み込みの分析です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/31d/8f6/af0/31d8f6af06d7158ecc9bd17710d216bb.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ページをロードするとき、時間の約10〜30％がV8コードの実行に費やされます。</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
モバイルデバイスの場合、平均的な電話（Moto G4）では、デバイスよりもreddit.com JSコードの実行に3〜4倍の時間がかかります高レベル（Pixel 3）。</font><font style="vertical-align: inherit;">弱いデバイス（Alcatel 1Xの価格は100ドル未満）では、同じ問題を解決するには、Pixel 3のようなものよりも少なくとも6倍の時間がかかります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/71a/4f0/3a9/71a4f03a9f7d673740c6917f30cee360.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">異なるクラスのモバイルデバイスでJSコードを処理するために必要な時間</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
reddit.comのモバイルバージョンとデスクトップバージョンは異なることに注意してください。したがって、モバイルデバイスの結果、たとえばMacBook Proの結果を比較することはできません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JavaScriptコードの実行時間を最適化しようとするとき-</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">長いタスクに</font></a><font style="vertical-align: inherit;">注意してください</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">長時間にわたってUIストリームをキャプチャできます。</font><font style="vertical-align: inherit;">これらのタスクは、ページの外観が完全に機能するように見えても、他の非常に重要なタスクの実行を妨げる可能性があります。</font><font style="vertical-align: inherit;">長期的なタスクは、より小さなタスクに分割する必要があります。</font><font style="vertical-align: inherit;">コードをパーツに分割し、これらのパーツの読み込み順序を制御することで、ページをよりインタラクティブな状態にすることができます。</font><font style="vertical-align: inherit;">これにより、ユーザーがページを操作する際の不便さが軽減されると期待されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/002/eef/32b/002eef32b869be9ae677bc41b41c86c2.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実行時間の長いタスクはメインスレッドをキャプチャします。</font><font style="vertical-align: inherit;">彼らはバラバラにすべきです</font></font></font></i><br>
 <br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V8の拡張機能は、スクリプトの解析とコンパイルをどのように高速化しますか？</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chrome 60の時代から、V8でのソースJSコードの解析速度が2倍になりました。同時に、解析とコンパイルが「JavaScriptの価格」に与える影響が少なくなりました。これは、これらのタスクの並列化につながる他のChrome最適化作業のおかげです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V8では、メインスレッドで生成されたコードの解析とコンパイルに関する作業量が平均40％削減されます。たとえば、Facebookの場合、この指標の改善は46％、Pinterestの場合、62％でした。最高の結果、81％はYouTubeで得られました。このような結果は、解析とコンパイルが別のストリームに移動されるために可能です。これは、メインストリーム外の同じタスクのストリーミングソリューションに関する既存の改善に追加されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4a7/41e/24c/4a741e24c05a9149d98ee568be74b564.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さまざまなバージョンのChromeでのJS解析時間。さまざまなバージョンのChromeで</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
行われたV8最適化が、コードの処理に必要なプロセッサ時間にどのように影響するかを視覚化することもできます。</font><font style="vertical-align: inherit;">Chrome 61がFacebook JSコードを解析する必要があったと同時に、Chrome 75はFacebook JSコードを解析できるようになり、さらにTwitterコードを6回解析できるようになりました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c6b/000/0e0/c6b0000e0b2bb98087ff12f8a9eb0d97.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chrome 61がFacebook JSコードを処理する必要があった時代に、Chrome 75はFacebookコードと6倍の量のTwitterコードの両方を処理できます。</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
そのような改善がどのように達成されたかについて話しましょう。</font><font style="vertical-align: inherit;">簡単に言うと、スクリプトリソースは、ワークフローのストリーミングモードで解析およびコンパイルできます。</font><font style="vertical-align: inherit;">これは、次のことを意味します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V8は、メインスレッドをブロックすることなく、JSコードを解析およびコンパイルできます。</font></font></li>
<li>      ,   HTML-   <code>&lt;script&gt;</code>. HTML-   ,   .       .</li>
<li>   ,     , V8   ,    .   V8            ,      .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これについてもう少し詳しく説明すると、ここでのポイントは次のとおりです。古いバージョンのChromeでは、スクリプトを解析する前にスクリプトを完全にロードする必要がありました。このアプローチは単純で理解可能ですが、使用すると、プロセッサリソースが不合理に使用されます。バージョン41と68の間のChromeは、スクリプトがロードを開始した直後に非同期モードで解析を開始し、このタスクを別のスレッドで実行します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/574/43a/4fd/57443a4fd274a348de26652d006941c3.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトは断片的にブラウザに送信されます。 V8は、少なくとも30 KBのコードがあると、データのストリーミングを開始します。</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Chrome 71では、タスクベースのシステムに移行しました。ここで、スケジューラーは複数の非同期/保留中のスクリプト処理セッションを同時に開始できます。この変更により、メインスレッドの解析によって生じる負荷が約20％減少しました。これにより、実際のサイトで取得されたTTI / FIDスコアが約2％向上しました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a3f/161/863/a3f16186348f3773a04f7caccc185592.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chrome 71はタスクベースのコード処理システムを使用しています。このアプローチにより、スケジューラは複数の非同期/保留中のスクリプトを同時に</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
処理できます。Chrome72では、スクリプトを解析するための主な方法としてストリーム処理を作成しました。これで、通常の同期スクリプトでさえこの方法で処理されます（ただし、これは組み込みスクリプトには適用されません）。さらに、メインスレッドで解析済みコードが必要な場合は、タスクベースの解析操作のキャンセルを中止しました。これは、すでに行われた作業の一部を再実行する必要があるために行われます。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以前のバージョンのChrome</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ストリーミング解析とコードのストリームコンパイルのサポートがありました。次に、ネットワークからダウンロードされたスクリプトは、最初にメインストリームに入る必要があり、その後、ストリーミングスクリプト処理システムにリダイレクトされました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これにより、ストリームパーサーは、ネットワークから既にダウンロードされているが、メインストリームによってまだストリーム処理にリダイレクトされていないデータを待機することがよくありました。これは、メインスレッドが他のいくつかのタスク（HTMLの解析、ページレイアウトの作成、JSコードの実行など）でビジーになる可能性があるために発生しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在、ページをプリロードするときにコードの解析を開始する方法を実験しています。</font><font style="vertical-align: inherit;">以前は、メインスレッドのリソースを使用してタスクをストリーミングパーサーに転送する必要があるため、このようなメカニズムの実装は妨げられていました。</font><font style="vertical-align: inherit;">「瞬時に」実行されるJSコードの解析の詳細については、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちらをご覧ください</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改善は、開発者のツールで見られるものにどのような影響を与えましたか？</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記に加えて、開発者ツールには1つの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">があったことに注意して</font><font style="vertical-align: inherit;">ください。これは、パースのタスクに関する情報がメインスレッドを完全にブロックしているかのように表示されるということにあります。ただし、パーサーは、新しいデータが必要な場合にのみ、メインスレッドをブロックする操作を実行しました。ストリーミングデータ処理に単一のストリームを使用するスキームから、ストリーミング処理タスクが適用されるスキームに移行したため、これは非常に明白になりました。 Chrome 69で表示できるのは次のとおりです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/87c/b4c/ab0/87cb4cab05a3c00e7b21dfc25524a9c8.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題は開発者ツールにあり、スクリプトの解析に関する情報がメインスレッドを完全にブロックしたかのように表示され</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
たため、「スクリプトの解析」タスクに1.08秒かかることがわかります。しかし実際には、JavaScriptの解析はそれほど遅くありません。この時間のほとんどは、メインスレッドからのデータを待機する以外は何も実行されません。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chrome 76では、完全に異なる画像をすでに見ることができます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ef8/874/e37/ef8874e37664a31f03c822c71feb0fa8.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chrome 76では、解析手順は多くの小さなタスクに分割さ</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
れています。一般に、ページで何が起こっているかの全体像を確認するには、開発者のツールの[パフォーマンス]タブが最適です。</font><font style="vertical-align: inherit;">解析時間やコンパイル時間など、V8の機能を反映したより詳細な情報を取得するには、RCS（ランタイムコール統計）サポート付きのChromeトレースを使用できます。</font><font style="vertical-align: inherit;">受信したRCSデータで、Parse-BackgroundインジケーターとCompile-Backgroundインジケーターを見つけることができます。</font><font style="vertical-align: inherit;">メインスレッド外でJSコードを解析およびコンパイルするのにかかった時間を報告できます。</font><font style="vertical-align: inherit;">解析およびコンパイルのメトリックは、メインスレッドの対応するアクションに費やされた時間を示します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3a4/200/d26/3a4200d269fe47bedac1d84c27722a2b.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Googleトレースを使用したRCSデータの分析</font></font></font></i><br>
 <br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変更は実際のサイトでの作業にどのように影響しましたか？</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ストリーミングスクリプトの処理が実際のサイトの閲覧にどのように影響したかを示すいくつかの例を見てみましょう。</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Reddit</font></font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d77/4ba/270/d774ba2709a772bbcfb26294b67ab385.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MacBook Proでreddit.comを表示します。メインストリームとワークストリームで費やされたJSコードの解析とコンパイル</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
にかかる時間reddit.com Webサイトには、サイズが100 KBを超えるJSバンドルがいくつかあります。それらは外部関数にラップさ</font><font style="vertical-align: inherit;">れているため、メインスレッド</font><font style="vertical-align: inherit;">で大量の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「遅延」コンパイル</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が実行さ</font><font style="vertical-align: inherit;">れます。上の図で重要なのは、メインスレッドでスクリプトを処理するために必要な時間です。これは、メインスレッドに大きな負荷がかかると、ページがインタラクティブモードに切り替わるのにかかる時間が長くなる可能性があるためです。 reddit.comサイトコードを処理するとき、ほとんどの時間はメインスレッドで費やされ、作業/バックグラウンドスレッドのリソースは最小限に使用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いくつかの大きなバンドルをパーツ（それぞれ約50 Kb）に分割し、コードを関数にラップせずにこのサイトを最適化できます。</font><font style="vertical-align: inherit;">これにより、スクリプトの並列処理が最大化されます。</font><font style="vertical-align: inherit;">その結果、バンドルはストリーミングモードで同時に解析およびコンパイルできます。</font><font style="vertical-align: inherit;">これにより、作業用にページを準備するときのメインスレッドの負荷が軽減されます。</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Facebook</font></font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc2/d83/a53/bc2d83a53f5b73658168e3dba70c9a85.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MacBook Proでfacebook.comを表示します。メインストリーム</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
と</font><i><font color="#999999"><font style="vertical-align: inherit;">ワークストリームで費やされたJSコードの解析とコンパイルにかかる時間</font></font></i><font style="vertical-align: inherit;">約6 MBの圧縮JSコードを使用するfacebook.comのようなサイトも検討できます。このコードは、約292のリクエストを使用してダウンロードされます。それらのいくつかは非同期であり、いくつかはデータのプリロードを目的とし、いくつかは低い優先度を持っています。ほとんどのFacebookスクリプトはサイズが小さく、焦点が絞られています。これは、バックグラウンド/ワークフローによる並列データ処理に良い影響を与える可能性があります。実際のところ、スクリプトのストリーミング処理により、多くの小さなスクリプトを同時に解析およびコンパイルできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたのサイトはおそらくFacebookサイトとは異なることに注意してください。 （FacebookサイトやGmailインターフェースなどの）長時間開いたままのアプリケーションがない可能性があり、それらのアプリケーションを使用する場合、デスクトップブラウザーでこのような大量のスクリプトをダウンロードすることは正当化される可能性があります。ただし、これにもかかわらず、どのプロジェクトにも公平な一般的な推奨事項を提示できます。これは、アプリケーションコードを適度なサイズのバンドルに分割する必要があり、これらのバンドルを必要な場合にのみダウンロードする必要があるという事実にあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JSコードの解析とコンパイルに関する作業のほとんどは、バックグラウンドスレッドでストリーミングツールを使用して実行できますが、一部の操作ではメインスレッドが必要です。</font><font style="vertical-align: inherit;">メインスレッドが何かでビジー状態の場合、ページはユーザーの操作に応答できません。</font><font style="vertical-align: inherit;">したがって、JSコードのロードと実行によるUXサイトへの影響に注意することをお勧めします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのJavaScriptエンジンとブラウザがスクリプトをストリーミングしてロードを最適化するわけではないことに注意してください。</font><font style="vertical-align: inherit;">ただし、これにもかかわらず、上記で概説した一般的な最適化の原則により、既存のブラウザで表示されたサイトを操作するユーザーエクスペリエンスが向上することを願っています。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON解析価格</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JSONコードの解析は、JavaScriptコードの解析よりもはるかに効率的です。</font><font style="vertical-align: inherit;">実際のところ、JSON文法はJavaScript文法よりもはるかに単純です。</font><font style="vertical-align: inherit;">この知識は、JSONコードに似た構造の大きな構成オブジェクト（Reduxリポジトリなど）を使用するWebアプリケーションの作業の準備速度を向上させるために適用できます。</font><font style="vertical-align: inherit;">その結果、データをコードに埋め込まれたオブジェクトリテラルとして提示する代わりに、JSONオブジェクトの文字列として表現し、プログラムの実行中にこれらのオブジェクトを解析できることがわかりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JSオブジェクトを使用する最初のアプローチは次のようになります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> data = { <span class="hljs-attr">foo</span>: <span class="hljs-number">42</span>, <span class="hljs-attr">bar</span>: <span class="hljs-number">1337</span> }; <span class="hljs-comment">// </span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JSON文字列を使用する2番目のアプローチでは、次のような構造を使用します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> data = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-string">'{"foo":42,"bar":1337}'</span>); <span class="hljs-comment">// </span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JSON文字列処理を1回だけ実行する必要があるため、使用されるアプローチは、</font></font><code>JSON.parse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScriptオブジェクトリテラルを使用するよりもはるかに高速です。特に-「コールド」ページの読み込み時。 JSON文字列を使用して、10 KBで始まるオブジェクトを表すことをお勧めします。ただし、パフォーマンスに関するヒントと同様に、このヒントは不注意に従うべきではありません。この手法を適用して本番環境でデータを表示する前に、測定を行い、プロジェクトへの実際の影響を評価する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
大量のデータのストレージとしてオブジェクトリテラルを使用すると、別の脅威が発生します。ポイントは、そのようなリテラルが2回処理されるリスクがあることです。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初の処理パスは、リテラルの予備解析で実行されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2番目のアプローチは、リテラルの「遅延」解析中に実行されます。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
処理オブジェクトリテラルの最初のパスを取り除くことはできません。</font><font style="vertical-align: inherit;">ただし、幸いにも、オブジェクトリテラルをトップレベルまたは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PIFE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内に配置することで、2番目のパスを回避できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイトへの繰り返しのアクセスでコードを解析およびコンパイルするのはどうですか？</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードとバイトコードをキャッシュするV8の機能のおかげで、ユーザーが複数回アクセスするような場合に、サイトのパフォーマンスを最適化することが可能です。サーバーからスクリプトが初めて要求されると、Chromeはそれをダウンロードし、V8を渡してコンパイルします。さらに、ブラウザはこのスクリプトのファイルをディスクキャッシュに保存します。同じJSファイルをダウンロードする2番目のリクエストが実行されると、Chromeはそれをブラウザーのキャッシュから取得し、コンパイルのために再びV8を渡します。ただし、今回は、コンパイルされたコードがシリアル化され、キャッシュされたスクリプトファイルにメタデータとして添付されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b78/216/702/b7821670255f45c9ec4a08217b495153.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V8でのコードキャッシングシステムの操作</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
スクリプトが3回目にリクエストされると、Chromeはファイルとそのメタデータの両方をキャッシュから</font><i><font color="#999999"><font style="vertical-align: inherit;">取得し</font></font></i><font style="vertical-align: inherit;">、V8の両方を転送します。</font><font style="vertical-align: inherit;">V8はメタデータをデシリアライズし、その結果、コンパイル手順をスキップする場合があります。</font><font style="vertical-align: inherit;">サイトへのアクセスが72時間以内に実行されると、コードキャッシュがトリガーされます。</font><font style="vertical-align: inherit;">Chromeは、Service Workerを使用してスクリプトをキャッシュする場合、貪欲なコードキャッシュの戦略も使用します。</font><font style="vertical-align: inherit;">コードキャッシングの詳細については、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちらをご覧ください</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概要</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2019年のWebページパフォーマンスの主なボトルネックは、スクリプトの読み込みと実行です。状況を改善するには、小さなサイズの同期（組み込み）スクリプトを使用するように努力します。これは、ロード直後に表示されるページのその部分とのユーザーインタラクションを整理するために必要です。ページの他の部分のサービスに使用するスクリプトは、遅延モードでロードすることをお勧めします。大きな束を小さな断片に分割します。これにより、コードが必要なときにだけ、必要なときにだけロードされるアプリケーションで、コードを操作するための戦略の実装が容易になります。これにより、並列コード処理を目的としたV8の機能が最大化されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モバイルプロジェクトを開発している場合は、できるだけ少ないJSコードを使用するように努力する必要があります。</font><font style="vertical-align: inherit;">この推奨事項は、モバイルデバイスは通常、かなり遅いネットワークで動作するという事実に基づいています。</font><font style="vertical-align: inherit;">さらに、そのようなデバイスは、利用可能なRAMと利用可能なプロセッサリソースの点で制限される場合があります。</font><font style="vertical-align: inherit;">ネットワークからダウンロードしたスクリプトを準備するのに必要な時間とキャッシュを使用する時間のバランスを見つけるようにしてください。</font><font style="vertical-align: inherit;">これにより、メインスレッド外で実行されるコードの解析とコンパイルの量が最大になります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">読者の皆様！</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最新のブラウザーによるJSコード処理の特殊性を考慮して、Webプロジェクトを最適化していますか？</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/rw/6v/yn/rw6vyn2bxx4usoqc39holmj2z8m.jpeg"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja459276/index.html">エピックフェイルレジスタンス2、またはFireFoxプラグインでプライバシーに関与すべきでない理由</a></li>
<li><a href="../ja459286/index.html">セミメタルテルル化タングステン-ナノテクノロジーの日のスイスナイフ</a></li>
<li><a href="../ja459288/index.html">ECSライブラリのネイティブ実装</a></li>
<li><a href="../ja459292/index.html">モバイルアプリケーションテストの自動化：ツールの比較</a></li>
<li><a href="../ja459294/index.html">さらに重要なことは、プログラミング言語を知っているか、ビジネス上の問題を解決できるかです。</a></li>
<li><a href="../ja459298/index.html">Angular：2019年のステータス</a></li>
<li><a href="../ja459300/index.html">Quasar 1.0：Vue開発者にとってだけでなく、Vue開発者にとっても新しい便利なツール</a></li>
<li><a href="../ja459302/index.html">Angularで失敗したHTTPリクエストを再試行する</a></li>
<li><a href="../ja459304/index.html">角ピットフォールバイパスと時間節約</a></li>
<li><a href="../ja459306/index.html">サーバーレス環境でのサーバーレンダリング</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>