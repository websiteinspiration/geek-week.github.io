<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò£ üí§ ü•ö 7 erros perigosos que s√£o f√°ceis de cometer em C # / .NET üëÇüèΩ ‚õé üôÖüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Uma tradu√ß√£o do artigo foi preparada antes do in√≠cio do curso "C # ASP.NET Core Developer" .
 
 
 
 C # √© uma √≥tima linguagem , e o .NET Framework tam...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>7 erros perigosos que s√£o f√°ceis de cometer em C # / .NET</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/501796/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma tradu√ß√£o do artigo foi preparada antes do in√≠cio do curso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"C # ASP.NET Core Developer"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></b></i><br>
<br>
<img src="https://habrastorage.org/webt/k8/vz/cz/k8vzcz5umofkpvfxz9zuj1pqibu.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C # √© uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√≥tima linguagem</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , e o .NET Framework tamb√©m √© muito bom. </font><font style="vertical-align: inherit;">A digita√ß√£o forte em C # ajuda a reduzir o n√∫mero de erros que voc√™ pode provocar, em compara√ß√£o com outros idiomas. </font><font style="vertical-align: inherit;">Al√©m disso, seu design intuitivo geral tamb√©m ajuda muito, comparado a algo como JavaScript (onde </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true √© falso</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">No entanto, cada idioma tem seu pr√≥prio rake que √© f√°cil de seguir, juntamente com id√©ias erradas sobre o comportamento esperado do idioma e da infraestrutura. </font><font style="vertical-align: inherit;">Vou tentar descrever alguns desses erros em detalhes.</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. N√£o entendo a execu√ß√£o atrasada (pregui√ßosa)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acredito que desenvolvedores experientes conhecem esse mecanismo .NET, mas pode surpreender colegas com menos conhecimento. Em poucas palavras, os m√©todos / operadores que retornam </font></font><code><code>IEnumerable&lt;</code>T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e usam </font></font><code>yield</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para retornar cada resultado n√£o s√£o executados na linha de c√≥digo que realmente os chama - eles s√£o executados quando a cole√ß√£o resultante √© acessada de alguma maneira *. Observe que a maioria das express√µes LINQ acaba retornando seus resultados com </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rendimento</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como exemplo, considere o teste de unidade flagrante abaixo.</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">TestMethod</span>]<font></font>
[<span class="hljs-meta">ExpectedException(typeof(ArgumentNullException))</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Ensure_Null_Exception_Is_Thrown</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
   <span class="hljs-keyword">var</span> result = RepeatString5Times(<span class="hljs-literal">null</span>);<font></font>
}<font></font>
[<span class="hljs-meta">TestMethod</span>]<font></font>
[<span class="hljs-meta">ExpectedException(typeof(InvalidOperationException))</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Ensure_Invalid_Operation_Exception_Is_Thrown</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
   <span class="hljs-keyword">var</span> result = RepeatString5Times(<span class="hljs-string">"test"</span>);
   <span class="hljs-keyword">var</span> firstItem = result.First();<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> IEnumerable&lt;<span class="hljs-keyword">string</span>&gt; <span class="hljs-title">RepeatString5Times</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> toRepeat</span>)</span><font></font>
{<font></font>
   <span class="hljs-keyword">if</span> (toRepeat == <span class="hljs-literal">null</span>)
       <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(toRepeat));
   <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++)<font></font>
   {   <font></font>
       <span class="hljs-keyword">if</span> (i == <span class="hljs-number">3</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(<span class="hljs-string">"3 is a horrible number"</span>);
       <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-string">$"<span class="hljs-subst">{toRepeat}</span> - <span class="hljs-subst">{i}</span>"</span>;<font></font>
   }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ambos os testes falhar√£o. O primeiro teste falhar√°, porque o resultado n√£o √© usado em nenhum lugar, portanto o corpo do m√©todo nunca ser√° executado. O segundo teste falhar√° por outro motivo um pouco mais trivial. Agora, obtemos o primeiro resultado de chamar nosso m√©todo para garantir que o m√©todo realmente seja executado. No entanto, o mecanismo de execu√ß√£o atrasada sair√° do m√©todo assim que puder - nesse caso, usamos apenas o primeiro elemento; portanto, assim que passamos a primeira itera√ß√£o, o m√©todo interrompe sua execu√ß√£o (portanto, i == 3 nunca ser√° verdadeiro). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A execu√ß√£o atrasada √© realmente um mecanismo interessante, especialmente porque facilita o encadeamento de consultas LINQ, recuperando dados apenas quando sua consulta est√° pronta para uso.</font></font><br>
<br>
<h3>2. ,   Dictionary      ,     </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso √© especialmente desagrad√°vel e tenho certeza de que em algum lugar tenho c√≥digo que se baseia nessa suposi√ß√£o. Quando voc√™ adiciona itens √† lista </font></font><code><code>List&lt;T&gt;</code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, eles s√£o armazenados na mesma ordem em que voc√™ os adiciona - logicamente. √Äs vezes, voc√™ precisa ter outro objeto associado a um item na lista, e a solu√ß√£o √≥bvia √© usar um dicion√°rio </font></font><code><code>Dictionary&lt;</code>TKey,TValue&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que permita especificar um valor relacionado para a chave. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, voc√™ pode percorrer o dicion√°rio usando o foreach e, na maioria dos casos, ele se comportar√° conforme o esperado - voc√™ acessar√° os elementos na mesma ordem em que foram adicionados ao dicion√°rio. No entanto, esse comportamento </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© indefinido</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ou seja, √© uma feliz coincid√™ncia, n√£o algo em que voc√™ pode confiar e sempre esperar. Isso √© explicado em</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Documenta√ß√£o da Microsoft</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas acho que poucas pessoas estudaram esta p√°gina com cuidado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ilustrar isso, no exemplo abaixo, a sa√≠da ser√° a seguinte: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terceiro </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
segundo</font></font></i><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> dict = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-keyword">string</span>, <span class="hljs-keyword">object</span>&gt;();       <font></font>
dict.Add(<span class="hljs-string">"first"</span>, <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>());<font></font>
dict.Add(<span class="hljs-string">"second"</span>, <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>());<font></font>
dict.Remove(<span class="hljs-string">"first"</span>);<font></font>
dict.Add(<span class="hljs-string">"third"</span>, <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>());
<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> entry <span class="hljs-keyword">in</span> dict)<font></font>
{<font></font>
    Console.WriteLine(entry.Key);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o acredite em mim? </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verifique aqui online voc√™ mesmo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. N√£o leve em considera√ß√£o a seguran√ßa do fluxo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O multithreading √© √≥timo; se implementado corretamente, voc√™ pode melhorar significativamente o desempenho do seu aplicativo. No entanto, assim que voc√™ inserir multithreading, voc√™ deve ter muito, muito cuidado com os objetos que modificar√°, porque poder√° come√ßar a encontrar erros aparentemente aleat√≥rios se n√£o for cuidadoso o suficiente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Simplificando, muitas classes base na biblioteca .NET n√£o s√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seguras para threads.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Isso significa que a Microsoft n√£o garante que voc√™ possa usar essa classe em paralelo usando v√°rios threads. </font><font style="vertical-align: inherit;">Isso n√£o seria um grande problema se voc√™ pudesse encontrar imediatamente problemas associados a isso, mas a natureza do multithreading implica que quaisquer problemas que surjam s√£o muito inst√°veis ‚Äã‚Äãe imprevis√≠veis - provavelmente, n√£o h√° duas execu√ß√µes produzindo o mesmo resultado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, considere este bloco de c√≥digo que usa simples, mas n√£o √© seguro para threads </font></font><code><code>List&lt;T&gt;</code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> items = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">int</span>&gt;();
<span class="hljs-keyword">var</span> tasks = <span class="hljs-keyword">new</span> List&lt;Task&gt;();
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++)<font></font>
{<font></font>
   tasks.Add(Task.Run(() =&gt; {<font></font>
       <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">10000</span>; k++)<font></font>
       {<font></font>
           items.Add(i);<font></font>
       }<font></font>
   }));<font></font>
}<font></font>
Task.WaitAll(tasks.ToArray());<font></font>
Console.WriteLine(items.Count);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, adicionamos n√∫meros de 0 a 4 √† lista 10.000 vezes cada, o que significa que a lista deve conter </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50.000</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> elementos. </font><font style="vertical-align: inherit;">Eu devo? </font><font style="vertical-align: inherit;">Bem, h√° uma pequena chance de que, no final, seja - mas abaixo est√£o os resultados de 5 dos meus diferentes lan√ßamentos:</font></font><br>
<br>
<pre><code class="plaintext hljs">28191<font></font>
23536<font></font>
44346<font></font>
40007<font></font>
40476</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verificar on-line aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De fato, isso ocorre porque o m√©todo Add n√£o √© at√¥mico, o que implica que o encadeamento pode interromper o m√©todo, o que pode redimensionar a matriz enquanto outro encadeamento est√° em processo de adi√ß√£o ou adicionar um elemento com o mesmo √≠ndice como o outro segmento. A exce√ß√£o IndexOutOfRange veio a mim algumas vezes, provavelmente porque o tamanho da matriz mudou durante a adi√ß√£o a ela. Ent√£o, o que fazemos aqui? Podemos usar a palavra-chave lock para garantir que apenas um encadeamento possa adicionar um item (Adicionar) √† lista de uma vez, mas isso pode afetar significativamente o desempenho. A Microsoft, sendo pessoas legais, fornece √≥timas cole√ß√µes que</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eles s√£o seguros para threads</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e altamente otimizados em termos de desempenho. </font><font style="vertical-align: inherit;">J√° publiquei </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um artigo descrevendo como voc√™ pode us√°-los</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Abuse de carregamento lento (adiado) no LINQ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O carregamento lento √© um √≥timo recurso para o LINQ to SQL e o LINQ to Entities (Entity Framework), que permite carregar linhas de tabela relacionadas conforme necess√°rio. Em um dos meus outros projetos, tenho uma </font><font style="vertical-align: inherit;">tabela </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"M√≥dulos"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e uma tabela </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Resultados"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com um relacionamento um para muitos (um m√≥dulo pode ter muitos resultados). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qh/ds/ww/qhdsww2vr9-_oslbtzgqx8rle50.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando quero obter um m√≥dulo espec√≠fico, certamente n√£o quero que o Entity Framework retorne todos os resultados que a tabela M√≥dulos possui! Portanto, ele √© inteligente o suficiente para executar uma consulta para obter resultados somente quando eu precisar. Assim, o c√≥digo abaixo executar√° 2 consultas - uma para obter o m√≥dulo e a outra para obter os resultados (para cada m√≥dulo),</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> db = <span class="hljs-keyword">new</span> DBEntities())<font></font>
{<font></font>
   <span class="hljs-keyword">var</span> modules = db.Modules;
   <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> module <span class="hljs-keyword">in</span> modules)<font></font>
   {<font></font>
       <span class="hljs-keyword">var</span> moduleType = module.Results;
      <span class="hljs-comment">//   </span><font></font>
   }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, e se eu tiver centenas de m√≥dulos? </font><font style="vertical-align: inherit;">Isso significa que uma consulta SQL separada para recebimento de registros de resultados ser√° executada </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para cada m√≥dulo! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obviamente, isso sobrecarregar√° o servidor e diminuir√° significativamente seu aplicativo. </font><font style="vertical-align: inherit;">No Entity Framework, a resposta √© muito simples - voc√™ pode especificar que inclua um conjunto espec√≠fico de resultados em sua consulta. </font><font style="vertical-align: inherit;">Veja o c√≥digo modificado abaixo, onde apenas uma consulta SQL ser√° executada, que incluir√° cada m√≥dulo e cada resultado desse m√≥dulo (combinados em uma consulta, que o Entity Framework exibe de maneira inteligente em seu modelo),</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> db = <span class="hljs-keyword">new</span> DBEntities())<font></font>
{<font></font>
   <span class="hljs-keyword">var</span> modules = db.Modules.Include(b =&gt; b.Results);
   <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> module <span class="hljs-keyword">in</span> modules)<font></font>
   {<font></font>
       <span class="hljs-keyword">var</span> moduleType = module.Results;
      <span class="hljs-comment">//   </span><font></font>
   }<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. N√£o entenda como o LINQ to SQL / Entity Frameworks traduz consultas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desde que abordamos o t√≥pico LINQ, acho que vale a pena mencionar a diferen√ßa com que seu c√≥digo ser√° executado se estiver dentro de uma consulta LINQ. Explicando em alto n√≠vel, todo o seu c√≥digo dentro de uma consulta LINQ √© traduzido para SQL usando </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">express√µes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - isso parece √≥bvio, mas √© muito, muito f√°cil esquecer o contexto em que voc√™ est√° e, finalmente, introduzir problemas em sua base de c√≥digo. Abaixo, compilei uma lista para descrever alguns obst√°culos t√≠picos que voc√™ pode encontrar. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A maioria das chamadas de m√©todo n√£o funcionar√°.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ent√£o, imagine que voc√™ tenha a consulta abaixo para separar o nome de todos os m√≥dulos com dois pontos e capturar a segunda parte.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> modules = <span class="hljs-keyword">from</span> m <span class="hljs-keyword">in</span> db.Modules
              <span class="hljs-keyword">select</span> m.Name.Split(<span class="hljs-string">':'</span>)[<span class="hljs-number">1</span>];</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ receber√° uma exce√ß√£o na maioria dos provedores LINQ - n√£o h√° convers√£o SQL para o m√©todo Split, alguns m√©todos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">podem ser</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> suportados, por exemplo, adicionar dias a uma data, mas tudo depende do seu provedor. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqueles que trabalham podem produzir resultados inesperados ...</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Pegue a express√£o LINQ abaixo (n√£o tenho id√©ia do por que voc√™ faria isso na pr√°tica, mas imagine que essa seja uma solicita√ß√£o razo√°vel).</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">int</span> modules = db.Modules.Sum(a =&gt; a.ID);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ tiver alguma linha na tabela de m√≥dulos, ela fornecer√° a soma dos identificadores. </font><font style="vertical-align: inherit;">Parece certo! </font><font style="vertical-align: inherit;">Mas e se voc√™ execut√°-lo usando o LINQ to Objects? </font><font style="vertical-align: inherit;">Podemos fazer isso convertendo a cole√ß√£o de m√≥dulos em uma lista antes de executar nosso m√©todo Sum.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">int</span> modules = db.Modules.ToList().Sum(a =&gt; a.ID);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Choque, horror - far√° exatamente o mesmo! No entanto, e se voc√™ n√£o tivesse linhas na tabela de m√≥dulos? O LINQ to Objects retorna 0 e a vers√£o do Entity Framework / LINQ to SQL lan√ßa uma </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidOperationException</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que diz que n√£o pode converter "int?" em "int" ... tal. Isso ocorre porque quando voc√™ executa SUM no SQL para um conjunto vazio, NULL √© retornado em vez de 0 - portanto, tenta retornar um int nulo. Aqui est√£o algumas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dicas para corrigir isso se voc√™ encontrar esse problema</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saiba quando voc√™ s√≥ precisa usar o bom e velho SQL.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ estiver executando uma solicita√ß√£o extremamente complexa, sua solicita√ß√£o traduzida pode acabar parecendo algo cuspido, comido v√°rias vezes. </font><font style="vertical-align: inherit;">Infelizmente, n√£o tenho exemplos para demonstrar, mas, a julgar pela opini√£o predominante, gosto muito de usar visualiza√ß√µes aninhadas, o que torna a manuten√ß√£o de c√≥digo um pesadelo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, se voc√™ encontrar algum gargalo de desempenho, ser√° dif√≠cil corrigi-lo porque voc√™ n√£o tem controle direto sobre o SQL gerado. </font><font style="vertical-align: inherit;">Fa√ßa isso no SQL ou deleg√°-lo ao administrador do banco de dados, se voc√™ ou sua empresa tiver um!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Arredondamento errado</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, sobre algo um pouco mais simples do que os par√°grafos anteriores, mas sempre me esqueci e acabei com erros desagrad√°veis ‚Äã‚Äã(e, se estiver relacionado √†s finan√ßas, um diretor zangado de barbatanas / genes). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O .NET Framework inclui um excelente m√©todo est√°tico na classe </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Math</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> chamada </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Round</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que pega um valor num√©rico e o arredonda para a casa decimal especificada. Funciona perfeitamente na maioria das vezes, mas o que fazer quando voc√™ tenta arredondar 2,25 para a primeira casa decimal? Suponho que voc√™ provavelmente espere arredondar para 2,3 - √© com isso que estamos acostumados, certo? Bem, na pr√°tica, acontece que o .NET usa </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arredondamentos banc√°rios</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que arredonda o exemplo dado para 2.2! </font><font style="vertical-align: inherit;">Isso se deve ao fato de os banqueiros serem arredondados para o n√∫mero par mais pr√≥ximo se o n√∫mero estiver no "ponto m√©dio". </font><font style="vertical-align: inherit;">Felizmente, isso pode ser facilmente substitu√≠do no m√©todo Math.Round.</font></font><br>
 <br>
<pre><code class="cs hljs">Math.Round(<span class="hljs-number">2.25</span>,<span class="hljs-number">1</span>, MidpointRounding.AwayFromZero)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. Classe horr√≠vel 'DBNull' </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso pode causar lembran√ßas desagrad√°veis ‚Äã‚Äãpara alguns - o ORM esconde essa sujeira de n√≥s, mas se voc√™ mergulhar no mundo do ADO.NET (SqlDataReader e similares), voc√™ encontrar√° o DBNull.Value. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o tenho 100% de certeza da raz√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pela qual</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os valores NULL do banco de dados s√£o processados ‚Äã‚Äãda seguinte maneira (comente abaixo se voc√™ souber!), Mas a Microsoft decidiu apresent√°-los com um tipo especial DBNull (com um campo est√°tico Value). </font><font style="vertical-align: inherit;">Eu posso dar uma das vantagens disso - voc√™ n√£o receber√° NullReferenceException desagrad√°vel ao acessar um campo de banco de dados que √© NULL. </font><font style="vertical-align: inherit;">No entanto, voc√™ n√£o deve apenas dar suporte √† maneira secund√°ria de verificar valores NULL (o que √© f√°cil de esquecer, o que pode levar a erros graves), mas voc√™ perde qualquer um dos √≥timos recursos do C # que o ajudam a trabalhar com nulos. </font><font style="vertical-align: inherit;">O que poderia ser t√£o simples quanto</font></font><br>
 <br>
<pre><code class="cs hljs">reader.GetString(<span class="hljs-number">0</span>) ?? <span class="hljs-string">"NULL"</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
o que eventualmente se torna ...</font></font><br>
 <br>
<pre><code class="cs hljs">reader.GetString(<span class="hljs-number">0</span>) != DBNull.Value ? reader.GetString(<span class="hljs-number">0</span>) : <span class="hljs-string">"NULL"</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ugh.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estes s√£o apenas alguns dos "truques" n√£o triviais que encontrei no .NET - se voc√™ souber mais, gostaria de ouvir voc√™ abaixo.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ASP.NET Core:  </a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt501784/index.html">Se meu carro atrapalhar</a></li>
<li><a href="../pt501786/index.html">Nova aplica√ß√£o "√Ågua-viva". Por que vibrar?</a></li>
<li><a href="../pt501788/index.html">Criando objetos param√©tricos no nanoCAD Design BIM</a></li>
<li><a href="../pt501790/index.html">Anima√ß√µes n√£o triviais no SwiftUI</a></li>
<li><a href="../pt501792/index.html">Como o pai do FinFET ajudou a salvar a lei de Moore</a></li>
<li><a href="../pt501798/index.html">C++/Qt: –ø–æ—Ä–∞ –≤–∞–ª–∏—Ç—å?.</a></li>
<li><a href="../pt501800/index.html">Pequena sess√£o osinta sobre moderniza√ß√£o e produ√ß√£o de sistemas de radiocomunica√ß√£o para as For√ßas Armadas da Federa√ß√£o Russa</a></li>
<li><a href="../pt501804/index.html">Dardo. Tudo o que voc√™ precisa saber sobre constantes</a></li>
<li><a href="../pt501806/index.html">ACS: problemas, solu√ß√µes e gerenciamento de riscos de seguran√ßa</a></li>
<li><a href="../pt501808/index.html">A lista de altera√ß√µes no D 2.092. Empr√©stimos Empr√©stimos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>