<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ• ğŸ‘ŒğŸ¾ ğŸ’• æ‰‘ã€‚BlOCï¼Œæä¾›ç¨‹åºï¼Œå¼‚æ­¥-æ¶å­æ¶æ„ ğŸ“— ğŸ§›ğŸ¿ ğŸ’•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä»‹ç»
 å½“æ‚¨å°è¯•ç¼–å†™åº”ç”¨ç¨‹åºæ—¶ï¼Œé‡åˆ°çš„ç¬¬ä¸€ä»¶äº‹æ˜¯å¦‚ä½•ç»„ç»‡åº”ç”¨ç¨‹åºçš„ä½“ç³»ç»“æ„ã€‚å½“æ¶‰åŠFlutteræ—¶ï¼Œå¤´è„‘å¯ä»¥å®Œå…¨ç»•è¿‡Googleæä¾›çš„åŠŸèƒ½-é¦™è‰ï¼ŒèŒƒå›´æ¨¡å‹ï¼ŒBLoCï¼ŒMVPï¼ŒMVCï¼ŒMVVMï¼ŒMVIç­‰ã€‚å‡è®¾æ‚¨å†³å®šé‡‡ç”¨æœ€æ—¶å°šçš„æ–¹å¼ï¼ˆè°·æ­Œåœ¨2018å¹´å»ºè®®çš„æ–¹å¼ï¼‰ä½¿ç”¨BLOCã€‚å®ƒæ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ä½¿ç”¨å®ƒï¼Ÿè¿˜æ˜¯R...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>æ‰‘ã€‚BlOCï¼Œæä¾›ç¨‹åºï¼Œå¼‚æ­¥-æ¶å­æ¶æ„</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489512/"><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»‹ç»</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å½“æ‚¨å°è¯•ç¼–å†™åº”ç”¨ç¨‹åºæ—¶ï¼Œé‡åˆ°çš„ç¬¬ä¸€ä»¶äº‹æ˜¯å¦‚ä½•ç»„ç»‡åº”ç”¨ç¨‹åºçš„ä½“ç³»ç»“æ„ã€‚</font><font style="vertical-align: inherit;">å½“æ¶‰åŠFlutteræ—¶ï¼Œå¤´è„‘å¯ä»¥å®Œå…¨ç»•è¿‡Googleæä¾›çš„åŠŸèƒ½-é¦™è‰ï¼ŒèŒƒå›´æ¨¡å‹ï¼ŒBLoCï¼ŒMVPï¼ŒMVCï¼ŒMVVMï¼ŒMVIç­‰ã€‚</font><font style="vertical-align: inherit;">å‡è®¾æ‚¨å†³å®šé‡‡ç”¨æœ€æ—¶å°šçš„æ–¹å¼ï¼ˆè°·æ­Œåœ¨2018å¹´å»ºè®®çš„æ–¹å¼ï¼‰ä½¿ç”¨BLOCã€‚</font><font style="vertical-align: inherit;">å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ</font><font style="vertical-align: inherit;">å¦‚ä½•ä½¿ç”¨å®ƒï¼Ÿ</font><font style="vertical-align: inherit;">è¿˜æ˜¯Reduxæˆ–RxDartï¼Ÿ</font><font style="vertical-align: inherit;">-è™½ç„¶åœä¸‹æ¥æ˜¯å…³äºâ€œå…¶ä»–â€çš„äº‹æƒ…â€¦â€¦ä½†æ˜¯ï¼Œæ¥ä¸‹æ¥è¯¥æ€ä¹ˆåŠï¼Ÿ</font><font style="vertical-align: inherit;">è¦è¿æ¥å“ªäº›åº“ï¼Ÿ</font><font style="vertical-align: inherit;">Blocï¼ŒFlutter_blocï¼Œbloc_patternç­‰ï¼Ÿ</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æ­¤ä¼—å¤šçš„ä½“ç³»ç»“æ„é€‰é¡¹å’Œç”¨äºå®ç°å®ƒä»¬çš„å·¥å…·å®é™…ä¸Šä¼šé•¿æ—¶é—´å»¶è¿Ÿé€‰æ‹©é˜¶æ®µã€‚</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»™è°çš„æ–‡ç« </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹äºé‚£äº›åˆšåˆšå¼€å§‹å­¦ä¹ Flutterå¹¶ä¸”ä¸çŸ¥é“ä»å“ªé‡Œå¼€å§‹çš„äººæ¥è¯´ï¼Œæœ¬æ–‡å°†æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</font><font style="vertical-align: inherit;">æˆ‘å°†å±•ç¤ºåœ¨Flutterä¸Šå®ç°åº”ç”¨ç¨‹åºçš„é€‰é¡¹ä¹‹ä¸€ã€‚</font><font style="vertical-align: inherit;">è¿™å°†ä½¿æ‚¨â€œæ„Ÿè§‰â€ Flutterï¼Œç„¶åè‡ªå·±å†³å®šç¼–å†™åº”ç”¨ç¨‹åºçš„æ–¹å¼å’Œä½¿ç”¨æ–¹å¼ã€‚</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¨¡å¼å’Œå·¥å…·ã€‚</font><font style="vertical-align: inherit;">ç®€çŸ­è€Œç®€å•</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ã€‚å€¼å¾—æ³¨æ„çš„ç¬¬ä¸€ä»¶äº‹æ˜¯ï¼Œå­˜åœ¨ä¸€ä¸ªåº”ç”¨ç¨‹åºæ¶æ„ï¼ˆæ¨¡å¼ï¼Œæ¨¡æ¿ï¼ŒæŸäº›æ„é€ æ¦‚å¿µï¼‰-å®Œå…¨ç›¸åŒï¼šBLoCï¼ŒMVPï¼ŒMVCï¼ŒMVVMï¼ŒMVIç­‰ã€‚è¿™äº›æ¶æ„ä¸­çš„è®¸å¤šä¸ä»…åœ¨Flutterä¸­ä½¿ç”¨ï¼Œè€Œä¸”åœ¨å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­ä½¿ç”¨ã€‚é—®é¢˜-æœ‰ä»€ä¹ˆé€‰æ‹©ï¼Ÿæˆ‘è®¤ä¸ºï¼Œæ‚¨éœ€è¦é€‰æ‹©è‡ªå·±ç†Ÿæ‚‰çš„çŸ¥è¯†ï¼Œä½†å‰ææ˜¯è¿™éœ€è¦ååº”æ€§å¹¶å°†ä¸šåŠ¡é€»è¾‘ä¸ç•Œé¢ä¸¥æ ¼åˆ†å¼€ï¼ˆæ˜¯çš„ï¼Œæ˜¯çš„-â€œå¦‚æœæ±½è½¦æ˜¯é»‘è‰²ï¼Œåˆ™å¯ä»¥æ˜¯ä»»ä½•é¢œè‰²â€ï¼‰ã€‚è‡³äºç•Œé¢å’Œä¸šåŠ¡é€»è¾‘çš„åˆ†ç¦»ï¼Œæˆ‘è®¤ä¸ºæ²¡æœ‰å¿…è¦è¿›è¡Œè§£é‡Šï¼Œä½†æ˜¯å¯¹äºååº”æ€§-è¯•è¯•ï¼Œå¦‚æœæ‚¨è¿˜æ²¡æœ‰å°è¯•è¿‡-æœ€åï¼Œå®ƒçœŸçš„éå¸¸æ–¹ä¾¿ä¸”â€œæ¼‚äº®â€ã€‚å¦‚æœæ‚¨è‡ªå·±ä¸èƒ½é€‰æ‹©å®ƒï¼Œé‚£ä¹ˆè®©æˆ‘ä»¬å…è®¸ä¸æ˜¯Googleæœ€é«˜æ‰çš„å®¶ä¼™-BLOCä¸ºæˆ‘ä»¬å®Œæˆå®ƒã€‚æˆ‘ä»¬æ‰¾å‡ºäº†æ¶æ„ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œå·¥å…·-æœ‰ç°æˆçš„åº“-Blocï¼ŒFlutter_blocï¼Œbloc_pattern-å“ªä¸ªæ›´å¥½ï¼Ÿæˆ‘ä¸çŸ¥é“-æ¯ä¸ªäººéƒ½å¾ˆå¥½ã€‚æ‚¨å¯ä»¥é€‰æ‹©å’Œæ¯”è¾ƒå¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œä½†æ˜¯å°±åƒåœ¨å†›é˜Ÿä¸­ä¸€æ ·ï¼Œè¿™é‡Œåˆæ˜¯ä¸€æ¬¡-æœ€å¥½ç°åœ¨å°±åšå‡ºé”™è¯¯çš„å†³å®šï¼Œè€Œä¸è¦åšå‡ºä»»ä½•å†³å®šã€‚ç°åœ¨ï¼Œæˆ‘å»ºè®®å›åˆ°modä¹‹åå¹¶ä½¿ç”¨Providerï¼ˆåœ¨2019å¹´ï¼ŒåŒæ ·çš„äººå»ºè®®ä½¿ç”¨Providerï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‰€æœ‰è¿™äº›å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ ¹æ®éœ€è¦åˆ›å»ºå…¨å±€å—å’Œå±€éƒ¨å—ã€‚</font><font style="vertical-align: inherit;">å…³äºBLoCçš„ä½“ç³»ç»“æ„ï¼ˆå³æ¨¡å¼ï¼Œè€Œä¸æ˜¯åº“ï¼‰å·²ç»å†™äº†å¾ˆå¤šæ–‡ç« ï¼Œæˆ‘è®¤ä¸ºæ‚¨ä¸åº”è¯¥å†è¯¦ç»†ä»‹ç»å®ƒã€‚</font><font style="vertical-align: inherit;">æˆ‘åªæ³¨æ„åˆ°æœ¬æ–‡çš„ä¸€ç‚¹ï¼Œä¸æ˜¯ä½¿ç”¨ç»å…¸çš„BLoCï¼Œè€Œæ˜¯ç¨ä½œä¿®æ”¹-åœ¨BLoCä¸­ï¼ŒåŠ¨ä½œï¼ˆäº‹ä»¶ï¼‰ä¸ä¼šé€šè¿‡æ¥æ”¶å™¨è¿›è¡Œä¼ è¾“ï¼Œä½†æ˜¯ä¼šè°ƒç”¨BLoCå‡½æ•°ã€‚</font><font style="vertical-align: inherit;">ç®€è€Œè¨€ä¹‹ï¼Œæ­¤åˆ»æˆ‘çœ‹ä¸åˆ°ä½¿ç”¨æ°´æ§½çš„å¥½å¤„-æ—¢ç„¶å®ƒä»¬ä¸å­˜åœ¨ï¼Œé‚£ä¸ºä»€ä¹ˆä½¿æ‚¨çš„ç”Ÿæ´»å˜å¾—å¤æ‚ï¼Ÿ</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dartä¸­çš„å¼‚æ­¥å’Œå¹¶è¡Œè®¡ç®—</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å› ä¸ºæˆ‘ä»¬åœ¨è°ˆè®ºååº”æ€§ï¼Œæ‰€ä»¥åœ¨Dartä¸­è¿˜éœ€è¦å¯¹å¼‚æ­¥çš„æ¦‚å¿µè¿›è¡Œä¸€äº›æ¾„æ¸…ã€‚å¾ˆå¤šæ—¶å€™ï¼Œåœ¨æ¥è§¦Dartçš„æœ€åˆé˜¶æ®µï¼Œå¼‚æ­¥å‡½æ•°ï¼ˆasyncï¼‰çš„å«ä¹‰æ— æ³•æ­£ç¡®ç†è§£ã€‚æ‚¨åº”è¯¥å§‹ç»ˆè®°ä½ï¼Œâ€œé»˜è®¤æƒ…å†µä¸‹â€è¯¥ç¨‹åºåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è¿è¡Œï¼Œå¹¶ä¸”å¼‚æ­¥ä»…å…è®¸æ‚¨æ›´æ”¹å‘½ä»¤çš„é¡ºåºï¼Œè€Œä¸æ˜¯å¹¶è¡Œæ‰§è¡Œå®ƒä»¬ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä»…é€šè¿‡å°†å…¶æ ‡è®°ä¸ºå¼‚æ­¥æ¥ç®€å•åœ°è¿è¡Œå¸¦æœ‰å¤§é‡è®¡ç®—çš„å‡½æ•°ï¼Œé‚£ä¹ˆè¯¥æ¥å£å°†è¢«é˜»å¡ã€‚å¼‚æ­¥ä¸ä¼šå¯åŠ¨æ–°çº¿ç¨‹ã€‚å¼‚æ­¥å’Œç­‰å¾…çš„å·¥ä½œæ–¹å¼åœ¨Internetä¸Šæœ‰å¾ˆå¤šä¿¡æ¯ï¼Œå› æ­¤æˆ‘ä¹Ÿä¸å†èµ˜è¿°ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœéœ€è¦è¿›è¡Œä¸€äº›å¤§çš„è®¡ç®—å¹¶ä¸”åŒæ—¶åˆä¸é˜»å¡æ¥å£ï¼Œåˆ™éœ€è¦ä½¿ç”¨è®¡ç®—åŠŸèƒ½ï¼ˆå¯¹äºç‰¹æ®Šçš„ç¡¬æ ¸ï¼Œå¯ä»¥ä½¿ç”¨éš”ç¦»ï¼‰ã€‚</font><font style="vertical-align: inherit;">è¿™å®é™…ä¸Šå°†å¯åŠ¨ä¸€ä¸ªå•ç‹¬çš„æ‰§è¡Œçº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹è¿˜å°†å…·æœ‰å…¶è‡ªå·±çš„å•ç‹¬çš„å†…å­˜åŒºåŸŸï¼ˆè¿™å¾ˆä»¤äººéš¾è¿‡ï¼‰ã€‚</font><font style="vertical-align: inherit;">æ‚¨åªèƒ½é€šè¿‡åŒ…å«ç®€å•æ•°æ®ç±»å‹åŠå…¶åˆ—è¡¨çš„æ¶ˆæ¯ä¸æ­¤ç±»æµè¿›è¡Œé€šä¿¡ã€‚</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å¼€å§‹ç»ƒä¹ </font></font></h1><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é—®é¢˜çš„ææ³•</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬å°è¯•ç¼–å†™æœ€ç®€å•çš„åº”ç”¨ç¨‹åº-è®©å®ƒæˆä¸ºæŸç§ç”µè¯ç›®å½•ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä½¿ç”¨Firebaseä½œä¸ºå­˜å‚¨-è¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿåˆ›å»ºâ€œäº‘â€åº”ç”¨ç¨‹åºã€‚</font><font style="vertical-align: inherit;">æˆ‘å°†è·³è¿‡å¦‚ä½•å°†Firebaseè¿æ¥åˆ°é¡¹ç›®çš„æ“ä½œï¼ˆæœ‰å…³è¯¥ä¸»é¢˜çš„æ–‡ç« å·²å†™äº†å¤šç¯‡ï¼Œæˆ‘çœ‹ä¸åˆ°é‡å¤çš„æ„æ€ã€‚æ³¨æ„ï¼šè¯¥é¡¹ç›®ä¸­ä½¿ç”¨Cloud Firestoreã€‚ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xy/yj/js/xyyjjsknqbe1owqlc1vnbnec-pu.gif"><br>
<br>
<h1> <br>
</h1><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åº”ç”¨è¯´æ˜</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°†åœ¨å¤–éƒ¨åŒ…å«ï¼š</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firebaseæˆæƒçª—å£ï¼ˆæ­¤çª—å£çš„é€»è¾‘å°†åŒ…å«åœ¨MainBlocä¸­ï¼‰ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¿¡æ¯çª—å£-å°†æ˜¾ç¤ºæœ‰å…³æˆæƒç¨‹åºçš„ç”¨æˆ·çš„ä¿¡æ¯ï¼ˆè¯¥çª—å£çš„é€»è¾‘ä¹Ÿå°†åŒ…å«åœ¨MainBlocä¸­ï¼‰ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”µè¯åˆ—è¡¨å½¢å¼çš„ç›®å½•çª—å£ï¼ˆæ­¤çª—å£çš„é€»è¾‘å°†åŒ…å«åœ¨å•ç‹¬çš„PhonebookBlocä¸­ï¼‰ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯ä»¥åˆ‡æ¢å±å¹•çš„åº”ç”¨ç¨‹åºèœå•ã€‚</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å†…éƒ¨åº”ç”¨ç¨‹åºçš„æ„é€ å¦‚ä¸‹ï¼šæ¯ä¸ªå±å¹•å°†åŒ…å«ä¸€ä¸ªå¸¦æœ‰å±å¹•å°éƒ¨ä»¶çš„æ–‡ä»¶ï¼Œä¸€ä¸ªblocæ–‡ä»¶ï¼ˆå…·æœ‰ç›¸åº”çš„blocç±»ï¼‰ï¼Œä¸€ä¸ªåŠ¨ä½œæ–‡ä»¶ï¼ˆåŒ…å«æè¿°å½±å“blocçŠ¶æ€çš„äº‹ä»¶çš„ç®€å•ç±»ï¼‰ï¼Œä¸€ä¸ªçŠ¶æ€æ–‡ä»¶ï¼ˆåŒ…å«åæ˜ blocçŠ¶æ€çš„ç®€å•ç±»ï¼‰ ï¼‰ï¼ŒåŒ…å«å­˜å‚¨åº“ç±»ï¼ˆè´Ÿè´£æ¥æ”¶æ•°æ®ï¼‰å’Œæ•°æ®ç±»ï¼ˆå­˜å‚¨é›†å›¢ä¸šåŠ¡é€»è¾‘æ•°æ®ï¼‰çš„data_modelæ–‡ä»¶ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥åº”ç”¨ç¨‹åºå°†å…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼šæ‰“å¼€å±å¹•æ—¶ï¼Œå°†ä½¿ç”¨åˆå§‹çŠ¶æ€å€¼åˆå§‹åŒ–ç›¸åº”çš„å—ï¼Œå¹¶åœ¨å¿…è¦æ—¶åœ¨å—æ„é€ å™¨ä¸­è°ƒç”¨ä¸€äº›åˆå§‹åŠ¨ä½œã€‚</font><font style="vertical-align: inherit;">å±å¹•æ ¹æ®çŠ¶æ€æ„å»º/é‡å»ºï¼Œè¿”å›çŠ¶æ€ã€‚</font><font style="vertical-align: inherit;">ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºä¸­æ‰§è¡Œä¸€äº›å…·æœ‰ç›¸åº”åŠ¨ä½œçš„åŠ¨ä½œã€‚</font><font style="vertical-align: inherit;">åŠ¨ä½œè¢«ä¼ é€’ç»™blocç±»ï¼Œåœ¨mapEventToStateå‡½æ•°ä¸­å¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”blocå°†æ–°çŠ¶æ€è¿”å›åˆ°å±å¹•ï¼Œå¹¶ä»¥æ­¤ä¸ºåŸºç¡€é‡å»ºå±å¹•ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¡£æ¡ˆç»“æ„</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç©ºçš„Flutteré¡¹ç›®ï¼Œå¹¶åˆ›å»ºè¿™ç§é¡¹ç›®ç»“æ„ï¼ˆæˆ‘æ³¨æ„åˆ°åœ¨æ¼”ç¤ºé¡¹ç›®ä¸­ï¼ŒæŸäº›æ–‡ä»¶æœ€ç»ˆå°†ä¿æŒä¸ºç©ºï¼‰ï¼š</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h8/r5/5j/h8r55j-7shyieywjwqkpkj-lwxi.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆæƒçª—å£ã€‚</font><font style="vertical-align: inherit;">ä¸»å—</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæ‚¨éœ€è¦åœ¨Firebaseä¸­å®æ–½æˆæƒã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬ä»åˆ›å»ºäº‹ä»¶ç±»ï¼ˆé€šè¿‡blocä¸­çš„äº‹ä»¶ä¼ è¾“æ•°æ®å¾ˆæ–¹ä¾¿ï¼‰å’ŒMain blocçš„çŠ¶æ€å¼€å§‹ï¼š</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ–‡ä»¶MainBloc \ action</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainBlocAction</span></span>{<font></font>
  String get password =&gt; <span class="hljs-keyword">null</span>;<font></font>
  String get email =&gt; <span class="hljs-keyword">null</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ–‡ä»¶MainBloc \å›½å®¶</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainBlocState</span></span>{<font></font>
  bool busy;<font></font>
  MainBlocState({<span class="hljs-keyword">this</span>.busy = <span class="hljs-keyword">false</span>});<font></font>
  copy(bool busy) {<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
çŠ¶æ€ç±»ä¸­çš„busyæ ‡å¿—ç”¨äºåœ¨ç•Œé¢ä¸­æ˜¾ç¤ºprogress_hudï¼Œå¹¶åœ¨æ»šåŠ¨åˆ—è¡¨æ—¶æ’é™¤ä»æ•°æ®åº“è¯»å–çš„ä¸å¿…è¦æ•°æ®ã€‚</font><font style="vertical-align: inherit;">åœ¨è¯¥å—ä¸­çš„æ‰€æœ‰æ“ä½œå¼€å§‹ä¹‹å‰ï¼Œå°†è®¾ç½®äº†å¿™æ ‡å¿—çš„æ—§ç±»å‹çš„æ–°çŠ¶æ€å‘å¸ƒåˆ°è¾“å‡ºæµ-è¿™æ ·ï¼Œæ¥å£å°†æ”¶åˆ°æ“ä½œå·²å¼€å§‹çš„é€šçŸ¥ã€‚</font><font style="vertical-align: inherit;">åœ¨æ“ä½œç»“æŸæ—¶ï¼Œå°†æ¸…é™¤å¿™ç¢Œæ ‡å¿—åå°†æ–°çŠ¶æ€å‘é€åˆ°æµã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MainBlocStateç±»çš„ç»§æ‰¿äººæè¿°äº†ä¸»åº”ç”¨ç¨‹åºBlocçš„çŠ¶æ€ã€‚</font><font style="vertical-align: inherit;">MainBlocActionçš„ç»§æ‰¿äººæè¿°äº†å…¶ä¸­å‘ç”Ÿçš„äº‹ä»¶ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MainBlocç±»åŒ…å«4ä¸ªä¸»è¦å…ƒç´ -å°†äº‹ä»¶â€œè½¬æ¢â€ä¸ºçŠ¶æ€ï¼ˆFuture mapEventToStateï¼‰çš„åŠŸèƒ½ï¼ŒBlocçŠ¶æ€ä¸º_blocStateï¼ŒblocçŠ¶æ€å­˜å‚¨åº“ä¸ºrepoï¼Œâ€œè¾“å‡ºâ€çŠ¶æ€æµï¼ˆæ¥å£å…ƒç´ è·Ÿè¸ªï¼‰ä¸ºblocStreamã€‚åŸºæœ¬ä¸Šï¼Œè¿™äº›éƒ½æ˜¯æä¾›bloc-aåŠŸèƒ½çš„å…ƒç´ ã€‚æœ‰æ—¶å»ºè®®åœ¨ä¸€ä¸ªå—ä¸­ä½¿ç”¨2ä¸ªè¾“å‡ºæµ-è¿™æ ·çš„ä¾‹å­å°†æ›´å°‘ã€‚æˆ‘ä¸ä¼šåœ¨è¿™é‡Œåˆ—å‡ºå®ƒ-æ‚¨å¯ä»¥é€šè¿‡ä¸‹è½½é¡¹ç›®æ¥æŸ¥çœ‹å®ƒã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
blocå­˜å‚¨åº“ç±»åŒ…å«ç”¨äºå¤„ç†Firebaseçš„é€»è¾‘å’Œä¸€ä¸ªå¯¹è±¡ï¼ˆæ•°æ®ï¼‰ï¼Œè¯¥å¯¹è±¡å­˜å‚¨è¯¥blocå®ç°çš„ä¸šåŠ¡é€»è¾‘æ‰€éœ€çš„æ•°æ®ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ–‡ä»¶MainBloc \ data_model</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainRepo</span></span>{<font></font>
<font></font>
  <span class="hljs-keyword">final</span> MainData data = MainData();<font></font>
<font></font>
  FirebaseAuth get firebaseInst =&gt; MainData.firebaseInst;<font></font>
<font></font>
  FirebaseUser _currentUser;<font></font>
<font></font>
  <span class="hljs-function">Future&lt;bool&gt; <span class="hljs-title">createUserWithEmailAndPassword</span><span class="hljs-params">(
      String email, String password)</span> async </span>{
    <span class="hljs-keyword">var</span> dataUser;
      <span class="hljs-keyword">try</span> {<font></font>
        dataUser =<font></font>
            (await firebaseInst.createUserWithEmailAndPassword(<font></font>
                email: email, password: password))<font></font>
                .user;<font></font>
      } <span class="hljs-keyword">catch</span> (e) {<font></font>
        print(Error.safeToString(e));<font></font>
        print(e.code);<font></font>
        print(e.message);<font></font>
      }<font></font>
      <span class="hljs-keyword">if</span> (dataUser == <span class="hljs-keyword">null</span>){<font></font>
        data.setState(IsNotLogged());<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<font></font>
      }<font></font>
<font></font>
      _currentUser = dataUser;<font></font>
      data.setState(IsLogged(),<font></font>
          uid: _currentUser.uid,<font></font>
          email: _currentUser.email);<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<font></font>
  }<font></font>
<font></font>
  ...}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainData</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> firebaseInst = FirebaseAuth.instance;
  <span class="hljs-keyword">static</span> MainBlocState _authState = IsNotLogged();
  <span class="hljs-keyword">static</span> MainBlocState get authState =&gt; _authState;
  <span class="hljs-keyword">static</span> String _uid;
  <span class="hljs-keyword">static</span> String get uid =&gt; _uid;
  <span class="hljs-keyword">static</span> String _email;
  <span class="hljs-keyword">static</span> String get email =&gt; _email;<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setState</span><span class="hljs-params">(MainBlocState newState,
      {String uid = <span class="hljs-string">''</span>, String email = <span class="hljs-string">''</span>})</span> </span>{<font></font>
    _authState = newState;<font></font>
    _uid = uid;<font></font>
    _email = email;<font></font>
  }<font></font>
}<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MainDataç±»è¿˜å­˜å‚¨çŠ¶æ€ï¼Œä½†å°†æˆæƒçŠ¶æ€å­˜å‚¨åœ¨Firebaseä¸­ï¼Œè€Œä¸å­˜å‚¨BlocçŠ¶æ€ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬ä¸ºä¸»è¦é›†å›¢ç¼–å†™äº†é€»è¾‘ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹å®ç°æˆæƒ/æ³¨å†Œå±å¹•äº†ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MainBlocåœ¨ä¸»æ–‡ä»¶ä¸­åˆå§‹åŒ–ï¼š</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸»æ–‡ä»¶</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-comment">// This widget is the root of your application.</span>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function">Widget <span class="hljs-title">build</span><span class="hljs-params">(BuildContext context)</span> </span>{
    <span class="hljs-keyword">return</span> Provider(<font></font>
        create: (context) =&gt; MainBloc(),<font></font>
        dispose: (context, value) =&gt; value.dispose(),<font></font>
        child: MaterialApp(<font></font>
          routes: menuRoutes,<font></font>
        ));<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨è¯¥è®¨è®ºä¸€ä¸‹StreamBuilderï¼ŒProviderï¼ŒStreamProviderï¼ŒConsumerå’ŒSelectorã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…³äºä¾›åº”å•†çš„é€€å´</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æä¾›ç¨‹åº</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -ä»…å°†å­˜å‚¨çš„å€¼æ²¿æ ‘ä¼ é€ã€‚è€Œä¸”æ‚¨åªèƒ½åœ¨å­©å­å»ºç«‹åè®¿é—®å®ƒï¼Œå³æ‚¨éœ€è¦æ„å»ºä¸€ä¸ªå­çª—å£å°éƒ¨ä»¶ã€‚ä¸è´Ÿè´£æ›´æ–°å°éƒ¨ä»¶ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StreamBuilder-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›‘è§†æµçš„å°éƒ¨ä»¶ï¼Œå½“å®ƒä»æµä¸­</font><b><font style="vertical-align: inherit;">æ¥æ”¶åˆ°</font></b><font style="vertical-align: inherit;">æ–°å¯¹è±¡æ—¶å°†å¯¹å…¶è¿›è¡Œå®Œå…¨é‡å»ºã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StreamProvider-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€ä¸ªç›‘è§†æµçš„å°éƒ¨ä»¶ï¼Œå¹¶åœ¨æ¥æ”¶åˆ°æ–°å¯¹è±¡æ—¶å‘å‡ºä¿¡å·ï¼ŒæŒ‡ç¤ºåº”é‡å»ºå­å°éƒ¨ä»¶ï¼ˆé‚£äº›é€šè¿‡buildæ–¹æ³•å£°æ˜ä¸ºå•ç‹¬ç±»çš„å°éƒ¨ä»¶ï¼‰ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¶ˆè´¹è€…</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€‰æ‹©è€…</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯â€œè¯­æ³•ç³–â€ï¼Œå³è¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªâ€œåŒ…è£…â€ï¼Œå…¶ä¸­åŒ…å«æ„å»ºå¹¶å°†å…¶éšè—åœ¨å…¶ä¸‹ã€‚åœ¨Selector-eä¸­ï¼Œæ‚¨å¯ä»¥è¿›è¡Œå…¶ä»–æ›´æ–°è¿‡æ»¤ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å› æ­¤ï¼Œå½“æ‚¨éœ€è¦åœ¨æ¯æ¬¡äº‹ä»¶ä¸­é‡å»ºå¤§éƒ¨åˆ†å±å¹•æ—¶ï¼Œå¯ä»¥å°†æ­¤é€‰é¡¹ä¸Providerå’ŒStreamBuilderä¸€èµ·ä½¿ç”¨ã€‚</font><font style="vertical-align: inherit;">å½“éœ€è¦é‡å»ºé è¿‘å¶å­çš„çª—å£å°éƒ¨ä»¶æ ‘çš„éƒ¨åˆ†æ—¶ï¼Œå»ºè®®å°†StreamProviderä¸Consumerå’ŒSelectorç»“åˆä½¿ç”¨ï¼Œä»¥æ’é™¤æ ‘çš„ä¸å¿…è¦é‡å»ºã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆæƒä¹¦ </font><font style="vertical-align: inherit;">å»¶ç»­æ€§</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿›å…¥åº”ç”¨ç¨‹åºæ—¶ï¼Œç”¨æˆ·å¿…é¡»è¿›å…¥æˆæƒ/æ³¨å†Œçª—å£ï¼Œå¹¶ä¸”æ­¤æ—¶åº”ç”¨ç¨‹åºèœå•å°šä¸å¯ç”¨ã€‚ç¬¬äºŒç‚¹-éƒ¨åˆ†åˆ·æ–°æ­¤å±å¹•æ²¡æœ‰å¤šå¤§æ„ä¹‰ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨StreamBuilderæ¥æ„å»ºç•Œé¢ã€‚è¯¥é¡¹ç›®çš„ç¬¬ä¸‰ç‚¹æ˜¯ä½¿ç”¨å¯¼èˆªå™¨åœ¨å±å¹•ä¹‹é—´å¯¼èˆªã€‚æ”¶åˆ°æˆåŠŸæˆæƒäº‹ä»¶åï¼Œæœ‰å¿…è¦è°ƒç”¨è½¬æ¢åˆ°ä¿¡æ¯å±å¹•ã€‚ä½†æ˜¯ï¼Œä»…åœ¨å†…éƒ¨æ„å»ºStreamBuilderä¸­ï¼Œè¿™å°†æ— æ³•å·¥ä½œ-å°†ä¼šå‡ºç°é”™è¯¯ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥ä½¿ç”¨è¾…åŠ©åŒ…è£…ç±»StreamBuilderWithListenerï¼ˆå°¤é‡‘Brusov - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stackoverflow.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæ­¤å±å¹•çš„åˆ—è¡¨ä¸ºauth_screenæœ¬èº«ï¼ˆæˆ‘å°†åœ¨æ­¤å¤„è¿›è¡Œéƒ¨åˆ†ä»‹ç»ï¼‰ï¼š</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ–‡ä»¶auth_screen</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">Widget <span class="hljs-title">build</span><span class="hljs-params">(BuildContext context)</span> </span>{
  <span class="hljs-keyword">var</span> bloc = Provider.of&lt;MainBloc&gt;(context, listen: <span class="hljs-keyword">false</span>);
  <span class="hljs-keyword">return</span> StreamBuilderWithListener&lt;MainBlocState&gt;(<font></font>
      stream: bloc.blocStream.stream,<font></font>
      listener: (value) {<font></font>
        <span class="hljs-comment">//not allowed call navigator push in build</span>
        <span class="hljs-keyword">if</span> (value is IsLogged) {<font></font>
          Navigator.of(context).pushReplacementNamed(InfoScreen.nameMenuItem);<font></font>
        }<font></font>
      },<font></font>
      initialData: bloc.state,<font></font>
      builder: (context, snappShot) {<font></font>
        <span class="hljs-keyword">if</span> (snappShot.data is IsLoggedOnStart) {
          <span class="hljs-keyword">return</span> LoggedWidget();<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (snappShot.data is IsLogged) {
          <span class="hljs-comment">//not allowed call navigator push in build</span>
          <span class="hljs-keyword">return</span> ModalProgressHUD(<font></font>
              inAsyncCall: <span class="hljs-keyword">true</span>,<font></font>
          child: Text(<span class="hljs-string">''</span>),);<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (snappShot.data is IsNotLogged) {
          <span class="hljs-keyword">return</span> SignInAndSignUpWidget();<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> Scaffold(body: Text(<span class="hljs-string">"                Unknown event"</span>));<font></font>
      });<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªStreamBuilderWithListeneræ¥ä¾¦å¬æ¥è‡ªblocçš„æµã€‚</font><font style="vertical-align: inherit;">ç„¶åæ ¹æ®å½“å‰çŠ¶æ€ï¼Œè°ƒç”¨LoggedWidgetå°éƒ¨ä»¶ï¼ˆå¦‚æœç”¨æˆ·å·²ç»ç™»å½•ï¼‰æˆ–SignInAndSignUpWidgetï¼ˆå¦‚æœç”¨æˆ·å°šæœªç™»å½•ï¼‰ã€‚</font><font style="vertical-align: inherit;">å¦‚æœblocè¿”å›IsLoggedçŠ¶æ€ï¼Œåˆ™åœ¨æ„å»ºå™¨ä¸­ä¸ä¼šå‘ç”Ÿä½¿ç”¨Navigatoråˆ‡æ¢åˆ°æ–°å±å¹•çš„æƒ…å†µï¼ˆè¿™ä¼šå¯¼è‡´é”™è¯¯ï¼‰ï¼Œä½†åœ¨ä¾¦å¬å™¨ä¸­ä¸ä¼šå‘ç”Ÿã€‚</font><font style="vertical-align: inherit;">åœ¨åŸºç¡€å°éƒ¨ä»¶ä¸­ï¼ŒåŸºäºæ­¤å¤„è¿”å›çš„æ•°æ®æ„å»ºæ¥å£ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™é‡Œï¼Œå®é™…ä¸Šä½¿ç”¨äº†Provider + StreamBuilderæ†ç»‘åŒ…ï¼Œå› ä¸º </font><font style="vertical-align: inherit;">å½“å—çš„çŠ¶æ€æ›´æ”¹æ—¶ï¼Œå®é™…ä¸Šæ•´ä¸ªæ¥å£éƒ½ä¼šæ›´æ”¹ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¦å°†æ•°æ®ä¼ è¾“åˆ°å—ï¼Œè¯·ä½¿ç”¨TextEditingControllerå’Œactionå‚æ•°ï¼š</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
auth_screenæ–‡ä»¶</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_SignUpWidgetWidgetState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span> </span>{<font></font>
  String _email, _password;<font></font>
<font></font>
  <span class="hljs-keyword">final</span> TextEditingController _emailController = TextEditingController();
  <span class="hljs-keyword">final</span> TextEditingController _passwordController = TextEditingController();<font></font>
<font></font>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">initState</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">super</span>.initState();<font></font>
    _emailController.addListener(_onEmailChanged);<font></font>
    _passwordController.addListener(_onPasswordChanged);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function">Widget <span class="hljs-title">build</span><span class="hljs-params">(BuildContext context)</span> </span>{
    <span class="hljs-keyword">return</span> Column(<font></font>
      children: &lt;Widget&gt;[<font></font>
        TextFormField(<font></font>
          controller: _emailController,<font></font>
          decoration: InputDecoration(<font></font>
              labelText: <span class="hljs-string">'email'</span>),<font></font>
        ),<font></font>
        TextFormField(<font></font>
          controller: _passwordController,<font></font>
          obscureText: <span class="hljs-keyword">true</span>,<font></font>
          decoration: InputDecoration(<font></font>
              labelText: <span class="hljs-string">'password'</span>),<font></font>
        ),<font></font>
        RaisedButton(<font></font>
            child: Text(<span class="hljs-string">'sign up'</span>),<font></font>
            onPressed: () {<font></font>
              Provider.of&lt;MainBloc&gt;(context, listen: <span class="hljs-keyword">false</span>).mapEventToState(<font></font>
                  Registration(_email, _password));<font></font>
            })<font></font>
      ],<font></font>
    );<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dispose</span><span class="hljs-params">()</span> </span>{<font></font>
    _emailController.dispose();<font></font>
    _passwordController.dispose();<font></font>
    <span class="hljs-keyword">super</span>.dispose();<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">_onEmailChanged</span><span class="hljs-params">()</span> </span>{<font></font>
    _email = _emailController.text;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">_onPasswordChanged</span><span class="hljs-params">()</span> </span>{<font></font>
    _password = _passwordController.text;<font></font>
  }<font></font>
}<font></font>
 <font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”µè¯ç°¿å±å¹•çª—å£</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œè®©æˆ‘ä»¬è°ˆè°ˆPhoneBookScreençª—å£ã€‚è¿™æ˜¯æœ€æœ‰è¶£çš„çª—å£-è¿™é‡Œçš„ç•Œé¢æ˜¯åŸºäºæ¥è‡ªblocçš„2ä¸ªæµæ„å»ºçš„ï¼Œå¹¶ä¸”è¿˜æœ‰ä¸€ä¸ªå¸¦æœ‰æ»šåŠ¨å’Œåˆ†é¡µï¼ˆpaginationï¼‰çš„åˆ—è¡¨ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PhonebookScreen \å±å¹•æ–‡ä»¶</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PhonebookTopPart</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{<font></font>
<font></font>
  <span class="hljs-function">StatefulWidget <span class="hljs-title">caseWidget</span><span class="hljs-params">(PhonebookState state)</span> </span>{
    <span class="hljs-keyword">if</span> (state is PhonebookListOpened) {
      <span class="hljs-keyword">return</span> PhonebookList();
    <span class="hljs-comment">//} else if (data is PhonebookCardToViewOpened) {</span>
    }<span class="hljs-keyword">else</span> ModalProgressHUD(<font></font>
      inAsyncCall: <span class="hljs-keyword">true</span>,<font></font>
      child: Text(<span class="hljs-string">''</span>),);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function">Widget <span class="hljs-title">build</span><span class="hljs-params">(BuildContext context)</span> </span>{
    <span class="hljs-keyword">var</span> bloc = Provider.of&lt;PhonebookBloc&gt;(context, listen: <span class="hljs-keyword">false</span>);
    <span class="hljs-keyword">return</span> StreamProvider&lt;PhonebookState&gt;(<font></font>
        create: (context) =&gt; bloc.blocStream.stream,<font></font>
        initialData: bloc.state,<font></font>
        child: Selector&lt;PhonebookState,PhonebookState&gt;(<font></font>
            selector: (_,state)=&gt;state,<font></font>
            shouldRebuild: (previous, next){<span class="hljs-keyword">return</span> (previous.runtimeType!=next.runtimeType);},<font></font>
            builder: (_, state, __) { <span class="hljs-keyword">return</span> ModalProgressHUD(<font></font>
                inAsyncCall: state.busy,<font></font>
                child: Scaffold(<font></font>
                  appBar: AppBar(<font></font>
                    title: Text(<span class="hljs-string">"Phones list"</span>),<font></font>
                  ),<font></font>
                  drawer: MenuWidget(),<font></font>
                  body: caseWidget(state),<font></font>
                ));}<font></font>
        ));<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
éœ€è¦ç¬¬ä¸€ä¸ªStreamProvideråœ¨ç›®å½•çš„ä¸åŒå±å¹•ä¹‹é—´åˆ‡æ¢-åˆ—è¡¨ï¼Œè”ç³»äººå¡ç‰‡ï¼Œç”¨äºç¼–è¾‘çš„è”ç³»äººå¡ç‰‡ç­‰ã€‚åœ¨caseWidgetå‡½æ•°ä¸­é€‰æ‹©äº†ç”¨äºå±å¹•çš„çª—å£å°éƒ¨ä»¶ï¼ˆä½†åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œä»…å®ç°äº†åˆ—è¡¨çš„è§†å›¾-æ‚¨å¯ä»¥å°è¯•å®ç°è”ç³»äººå¡çš„è§†å›¾-è¿™éå¸¸ç®€å•ï¼Œå¹¶ä¸”ä»ä¸€ä¸ªå¥½çš„å¼€å§‹å°±å¯ä»¥ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æ­¤å±å¹•ä¸Šï¼Œå·²ç»ä½¿ç”¨äº†ä¸€å †StreamProvider + Selector / Consumerï¼Œå› ä¸ºåˆ—è¡¨æœ‰ä¸€ä¸ªæ»šåŠ¨æ¡ï¼Œå»ºè®®ä¸è¦ç”¨å®ƒæ¥é‡å»ºæ•´ä¸ªå±å¹•ï¼ˆå³ï¼Œé‡å»ºå°éƒ¨ä»¶æ¥è‡ªç›¸åº”çš„é€‰æ‹©å™¨/ä½¿ç”¨è€…ï¼Œå¹¶ä¸”ä½äºæ ‘çš„ä¸‹éƒ¨ï¼‰ã€‚</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯åˆ—è¡¨æœ¬èº«çš„å®ç°ï¼š</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PhonebookScreen \ screenæ–‡ä»¶</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_PhonebookListState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">PhonebookList</span>&gt; </span>{<font></font>
  ScrollController _scrollController = ScrollController();<font></font>
<font></font>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">initState</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">super</span>.initState();<font></font>
    _scrollController.addListener(_scrollListener);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function">Widget <span class="hljs-title">build</span><span class="hljs-params">(BuildContext context)</span> </span>{
    <span class="hljs-keyword">var</span> bloc = Provider.of&lt;PhonebookBloc&gt;(context, listen: <span class="hljs-keyword">false</span>);
    <span class="hljs-keyword">var</span> list = bloc.repo.data.list;
    <span class="hljs-keyword">return</span> Container(<font></font>
        child: StreamProvider&lt;PhonebookState&gt;(<font></font>
            create: (context) =&gt; bloc.scrollStream.stream,<font></font>
            initialData: bloc.scrollState,<font></font>
            child: Consumer&lt;PhonebookState&gt;(<font></font>
              builder: (_, state, __) {<font></font>
                <span class="hljs-keyword">return</span> ListView.builder(<font></font>
                    controller: _scrollController,<font></font>
                    itemCount: list.length,<font></font>
                    itemBuilder: (BuildContext context, <span class="hljs-keyword">int</span> index) {
                      <span class="hljs-keyword">return</span> ListTile(<font></font>
                        title: Text(list[index].data[<span class="hljs-string">'name'</span>]),<font></font>
                        subtitle: Text(list[index].data[<span class="hljs-string">'phone'</span>]),<font></font>
                      );<font></font>
                    });<font></font>
              },<font></font>
            )));<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">_scrollListener</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">double</span> delta = MediaQuery<font></font>
        .of(context)<font></font>
        .size<font></font>
        .height * <span class="hljs-number">3</span>;
    <span class="hljs-keyword">double</span> maxScroll = _scrollController.position.maxScrollExtent;
    <span class="hljs-keyword">double</span> currentScroll = _scrollController.position.pixels;
    <span class="hljs-keyword">if</span> (maxScroll - currentScroll &lt;= delta) {<font></font>
      Provider.of&lt;PhonebookBloc&gt;(context, listen: <span class="hljs-keyword">false</span>)<font></font>
          .mapEventToState(ScrollPhonebook());<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dispose</span><span class="hljs-params">()</span> </span>{<font></font>
    _scrollController.removeListener(_scrollListener);<font></font>
    <span class="hljs-keyword">super</span>.dispose();<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ°ç¬¬äºŒä¸ªStreamProviderï¼Œå®ƒç›‘è§†è´Ÿè´£æ»šåŠ¨çš„ç¬¬äºŒä¸ªblocæµã€‚åˆ†é¡µæ˜¯é€šè¿‡_scrollListenerï¼ˆæ§åˆ¶å™¨ï¼š_scrollControllerï¼‰è¿›è¡Œæ ‡å‡†ç»„ç»‡çš„ã€‚å°½ç®¡è¯¥çª—å£å¾ˆæœ‰è¶£ï¼Œä½†æ˜¯ç”±äºç»™å‡ºäº†ç¬¬ä¸€ä¸ªçª—å£çš„è¯¦ç»†è¯´æ˜ï¼Œå› æ­¤è¿™é‡Œæ— è¯å¯è¯´äº†ã€‚å› æ­¤ï¼Œå°±æ˜¯ä»Šå¤©ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ¬æ–‡çš„ç›®çš„ä¸æ˜¯å±•ç¤ºå®Œç¾çš„ä»£ç ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°è®¸å¤šä¼˜åŒ–ç‚¹-æ­£ç¡®åœ°â€œæ‹†åˆ†â€ä¸ºæ–‡ä»¶ï¼Œä½¿ç”¨å®ä¾‹ï¼Œmixinç­‰ã€‚</font><font style="vertical-align: inherit;">å¦å¤–ï¼Œä¸‹ä¸€æ­¥æ˜¯â€œä¹æ±‚â€ä»€ä¹ˆ-æ‚¨å¯ä»¥åˆ¶ä½œè”ç³»å¡ã€‚</font><font style="vertical-align: inherit;">ä¸»è¦ä»»åŠ¡æ˜¯æ„é€ çŸ¥è¯†ï¼Œä¸ºæ„å»ºåº”ç”¨ç¨‹åºè®¾ç½®ä¸€å®šçš„å‘é‡ï¼Œå¯¹åœ¨Flutterä¸Šè®¾è®¡åº”ç”¨ç¨‹åºçš„æŸäº›æ—¶åˆ»è¿›è¡Œè¯´æ˜ï¼Œè¿™äº›è®¤è¯†åœ¨ç›¸è¯†çš„æœ€åˆé˜¶æ®µå¹¶ä¸ååˆ†æ˜æ˜¾ã€‚</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®ä¸‹è½½è¯¥é¡¹ç›®</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆæ³¨å†Œæ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¯†ç è‡³å°‘ä¸º6ä¸ªå­—ç¬¦çš„ä»»ä½•é‚®ä»¶ã€‚é‡æ–°æˆæƒæ—¶ï¼Œå¯†ç å¿…é¡»ä¸æ³¨å†Œæ—¶ä½¿ç”¨çš„å¯†ç ç›¸åŒï¼‰ã€‚</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN489496/index.html">å¯»æ‰¾å‘˜å·¥å’Œå¯»æ‰¾å·¥ä½œï¼šæˆ‘ä»å†…éƒ¨åˆ°å¤–éƒ¨çš„è§‚ç‚¹</a></li>
<li><a href="../zh-CN489500/index.html">åœ¨æ•…äº‹ç‚¹è¯„ä¼°ä»»åŠ¡</a></li>
<li><a href="../zh-CN489502/index.html">Selenium + AutoITã€‚Windowsæµ‹è¯•è‡ªåŠ¨åŒ–Windows</a></li>
<li><a href="../zh-CN489504/index.html">å¦‚ä½•åœ¨UE4ä¸­å¼€å§‹åˆ›å»ºåœ°å›¾</a></li>
<li><a href="../zh-CN489510/index.html">è¯•å›¾è§£å†³å‡æœŸ2å·ç¥¨ä¹‹å‰çš„é€‰æ‹©é—®é¢˜</a></li>
<li><a href="../zh-CN489514/index.html">å…è´¹ä¸‹è½½å’Œå­˜å‚¨ä»»æ„å¤§å°çš„æ–‡ä»¶åˆ°Googleäº‘ç«¯ç¡¬ç›˜ã€‚é”™è¯¯æˆ–åŠŸèƒ½ï¼Ÿ</a></li>
<li><a href="../zh-CN489516/index.html">æœ‹å‹ååº”æœ¬æœºå’ŒFastlane</a></li>
<li><a href="../zh-CN489518/index.html">ä¼šå‘˜äº¤æµä½æˆæœ¬äº¤æµå‡ºç°åœ¨ç¾å›½</a></li>
<li><a href="../zh-CN489526/index.html">é›¶å’Œæ¸¸æˆå’ŒKarush-Kun-Takkeræ¡ä»¶</a></li>
<li><a href="../zh-CN489528/index.html">æ‚¨åœ¨å¼€å‘è¿‡ç¨‹ä¸­æ²¡æœ‰è§‚çœ‹å¹¿å‘Šï¼Ÿç´Šä¹±</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>