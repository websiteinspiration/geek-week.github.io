<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🈳 🛴 🤴 Scaling Pengujian Android di Odnoklassniki 😹 🧙🏾 👨🏿‍💻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo! Nama saya Roman Ivanitsky, saya bekerja di tim otomatisasi pengujian Odnoklassniki. OK adalah layanan besar dengan lebih dari 70 juta pengguna. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Scaling Pengujian Android di Odnoklassniki</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/odnoklassniki/blog/497726/"><img src="https://habrastorage.org/webt/dp/ei/lm/dpeilmobnwcglrby0p_rtptmgv8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Halo! Nama saya Roman Ivanitsky, saya bekerja di tim otomatisasi pengujian Odnoklassniki. OK adalah layanan besar dengan lebih dari 70 juta pengguna. Jika kita berbicara tentang perangkat seluler, mayoritas menggunakan OK.RU di ponsel pintar yang menjalankan Android. Untuk alasan ini, kami sangat serius dalam menguji aplikasi Android kami. Pada artikel ini saya akan menceritakan tentang perkembangan pengujian otomatis di perusahaan kami.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2012, Odnoklassniki, perusahaan ini mengalami peningkatan aktif dalam jumlah pengguna dan peningkatan jumlah fitur pengguna. </font><font style="vertical-align: inherit;">Untuk memenuhi tujuan bisnis, perlu untuk mempersingkat siklus rilis, tetapi ini terhambat oleh kenyataan bahwa semua fungsi diuji secara manual. </font><font style="vertical-align: inherit;">Solusi untuk masalah ini datang dengan sendirinya - kita perlu autotest. </font><font style="vertical-align: inherit;">Jadi, pada tahun 2012 di Odnoklassniki, tim otomasi uji muncul, dan langkah pertama adalah mulai menulis tes.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sedikit sejarah</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autotest pertama di Odnoklassniki ditulis dalam Selenium, untuk peluncuran mereka mereka mengangkat Jenkins, Selenium Grid dengan Selenium Hub dan satu set Selenium Node. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solusi cepat, mulai cepat, laba cepat - sempurna. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seiring waktu, jumlah tes meningkat, dan layanan tambahan muncul - misalnya, layanan peluncuran, layanan laporan, layanan data uji. Pada akhir 2014, kami memiliki seribu tes yang berlangsung sekitar lima belas hingga dua puluh menit. Ini tidak cocok untuk kami, karena jelas bahwa jumlah tes akan meningkat, dan dengan itu waktu yang dibutuhkan untuk menjalankannya akan meningkat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada saat itu, infrastruktur pengujian otomatis terlihat seperti ini:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2q/ou/7s/2qou7sruwzlvihxfhhq2fdcd9qm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, dengan jumlah Selenium Node lebih besar dari atau sama dengan 200, Hub tidak dapat mengatasi beban. </font><font style="vertical-align: inherit;">Sekarang masalah ini telah dipelajari, dan itulah sebabnya alat seperti Zalenium atau Selenoid favorit semua orang muncul. </font><font style="vertical-align: inherit;">Tetapi pada 2014 tidak ada solusi standar, jadi kami memutuskan untuk membuat sendiri. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menetapkan persyaratan minimum yang harus dipenuhi oleh layanan:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skalabilitas. </font><font style="vertical-align: inherit;">Kami tidak ingin bergantung pada keterbatasan Selenium Hub.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stabilitas. </font><font style="vertical-align: inherit;">Pada tahun 2014, Selenium Hub tidak terkenal dengan operasi yang stabil.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toleransi kesalahan. </font><font style="vertical-align: inherit;">Kami membutuhkan kemampuan untuk melanjutkan proses pengujian jika terjadi kegagalan pusat data atau server mana pun.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan demikian, solusi kami untuk penskalaan Selenium Grid muncul, yang terdiri dari koordinator dan Node-manajer, di luar sangat mirip dengan Selenium Grid standar, tetapi dengan fitur-fiturnya sendiri. </font><font style="vertical-align: inherit;">Fitur-fitur ini akan dibahas lebih lanjut.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Koordinator</font></font></h3><br>
<img src="https://habrastorage.org/webt/s0/gu/ib/s0guibehaq2q0zpa5vi40jc9un4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bahkan, ini adalah broker sumber daya (sumber daya dipahami sebagai browser). Ini memiliki API eksternal di mana tes mengirim permintaan untuk sumber daya. Pertanyaan-pertanyaan ini disimpan ke database sebagai tugas untuk dijalankan. Koordinator tahu segalanya tentang konfigurasi cluster kami - yang ada di manajer Node, jenis sumber daya apa yang dapat disediakan oleh manajer Node ini, jumlah total sumber daya, berapa banyak sumber daya yang saat ini terlibat dalam tugas-tugas tersebut. Pada saat yang sama, ia memantau sumber daya - aktivitas, stabilitas, dan dalam hal ini memberi tahu mereka yang bertanggung jawab. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fitur koordinator adalah bahwa ia mengintegrasikan semua manajer Node ke dalam pertanian yang disebut. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti inilah bentuk pertanian itu. Lebih dari setengah sumber daya digunakan, dan semua node online:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ti/ar/ib/tiariberzr9rt2lpau2vfohpcoa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda juga dapat menampilkan node offline atau memasukkannya ke dalam rotasi dengan persentase tertentu, ini diperlukan jika menjadi perlu untuk mengurangi beban pada node tertentu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap tambak dapat digabungkan dengan yang lain dalam unit logis, yang kami sebut layanan. Pada saat yang sama, satu tambak dapat dimasukkan dalam beberapa layanan berbeda. Pertama, memungkinkan untuk menetapkan batas dan memprioritaskan sumber daya yang digunakan oleh setiap layanan tertentu. Kedua, ini memungkinkan Anda untuk mengelola konfigurasi dengan mudah - kami memiliki kemampuan untuk menambahkan jumlah manajer Node dalam layanan dengan cepat, atau sebaliknya untuk menghapusnya dari tambak agar dapat berinteraksi dengan manajer Node ini, misalnya, mengkonfigurasi atau memperbarui, dll. .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wv/rj/fc/wvrjfcs7gh4e3fsf6kjloe1uh_k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
API koordinator sangat sederhana: dimungkinkan untuk meminta layanan untuk jumlah sumber daya saat ini yang digunakan, dapatkan batasnya dan mulai atau hentikan beberapa sumber daya.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manajer Node</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah layanan yang dapat melakukan dua hal dengan baik - menerima tugas dari koordinator dan meluncurkan beberapa sumber daya sesuai permintaan. </font><font style="vertical-align: inherit;">Secara default, ini dirancang agar setiap peluncuran sumber daya diisolasi, yaitu, tidak ada peluncuran sebelumnya yang dapat mempengaruhi peluncuran pengujian berikutnya. </font><font style="vertical-align: inherit;">Sebagai tanggapan, koordinator menggunakan sekelompok host dan satu set port yang ditinggikan. </font><font style="vertical-align: inherit;">Misalnya, host tempat server Selenium diluncurkan, dan porta. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/p8/xa/43/p8xa43yokgfpxyumwpmagx4ilpa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada host, sepertinya ini: layanan manajer Node sedang berjalan, dan mengelola seluruh siklus hidup sumber daya. </font><font style="vertical-align: inherit;">Dia mengambil browser, menyelesaikannya, memastikan bahwa mereka tidak lupa untuk menutup. </font><font style="vertical-align: inherit;">Untuk menjamin isolasi satu sama lain, semua ini terjadi atas nama pengguna layanan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interaksi</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tes berinteraksi dengan infrastruktur yang dijelaskan di atas sebagai berikut: ini membahas koordinator dengan permintaan untuk sumber daya yang diperlukan, koordinator menyimpan tugas ini sebagai membutuhkan eksekusi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Manajer Node, pada gilirannya, beralih ke koordinator tugas. Setelah menerima tugas itu, ia memulai sumber dayanya. Setelah itu, ia mengirimkan hasil peluncuran ke koordinator, gagal memulai juga dilaporkan ke koordinator. Tes menerima hasil permintaan sumber daya dan, jika berhasil, mulai bekerja dengan sumber daya secara langsung. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fe/np/sf/fenpsf31k75tnpnxgwtw5mjymro.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Keuntungan dari pendekatan ini adalah untuk mengurangi beban pada koordinator dengan mendapatkan kemampuan untuk bekerja dengan sumber daya secara langsung. Kontra - kebutuhan untuk mengimplementasikan logika interaksi dengan koordinator dalam kerangka kerja pengujian, tetapi bagi kami ini dapat diterima.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hari ini kita dapat menjalankan lebih dari 800 browser secara paralel di tiga pusat data. </font><font style="vertical-align: inherit;">Untuk koordinator, ini bukan batasnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toleransi kesalahan dijamin dengan peluncuran beberapa contoh koordinator di belakang firewall DNS di pusat data yang berbeda. </font><font style="vertical-align: inherit;">Ini menjamin akses ke instance yang berfungsi jika terjadi masalah dengan pusat data atau server. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai hasilnya, kami mendapat solusi yang memenuhi semua persyaratan yang ditetapkan sebelumnya. </font><font style="vertical-align: inherit;">Ini telah beroperasi terus sejak 2015 dan telah membuktikan efektivitasnya.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika datang ke pengujian di Android, biasanya ada dua pendekatan utama. Yang pertama adalah menggunakan WebDriver - ini adalah cara kerja Selendroid dan Appium. Yang kedua - dalam bekerja dengan alat asli, dengan demikian mengimplementasikan Robotium, UI Automator atau Espresso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kesamaan mendasar antara pendekatan ini adalah untuk mendapatkan perangkat dan mendapatkan browser. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada lebih banyak perbedaan, yang utama adalah kebutuhan untuk menginstal APK yang diuji, dengan mana kita akan mengambil artefak dalam bentuk log, screenshot, dll. dan juga, fakta bahwa pengujian dilakukan pada perangkat itu sendiri, dan bukan pada CI.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada 2015, Odnoklassniki mulai menutupi aplikasi Android mereka dengan autotest. Kami memilih satu mesin Linux, menghubungkan satu perangkat nyata melalui USB dan mulai menulis tes pada Robotium. Solusi sederhana ini memungkinkan Anda mendapatkan hasil dengan cepat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Waktu berlalu, jumlah tes dan jumlah perangkat bertambah. Untuk menyelesaikan tugas manajemen, Device Manager telah dibuat - perintah wrapper over </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Android Debug Bridge), yang memungkinkan antarmuka http api untuk menjalankannya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah bagaimana API pertama untuk Device Manager terlihat - dengan bantuannya Anda bisa mendapatkan daftar perangkat, menginstal / mencopot APK, menjalankan tes dan mendapatkan hasil.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ra/j5/pc/raj5pcnmij6_km7w1zla73xzix4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, kami memperhatikan bahwa hasil pengujian menurun saat startup di server ADB yang terhubung dengan lebih dari satu perangkat. Solusi yang membantu kami meningkatkan stabilitas ditemukan dalam mengisolasi setiap server ADB menggunakan Docker. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peternakan sudah siap - Anda dapat menghubungkan ponsel. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rb/lh/gr/rblhgrqkdhtp6xgue6ysjzkjcx0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Banyak yang akrab dengan gambar ini. Saya mendengar bahwa jika Anda terlibat dalam pertanian Android, Anda seolah-olah di neraka setiap hari.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yb/lo/sh/ybloshbgsavgewkhufosue3gqzi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Emulator Android datang membantu kami. Penggunaannya disebabkan oleh dua faktor: pertama, pada saat itu sudah mencapai tingkat stabilitas yang diperlukan, dan kedua, kami tidak memiliki fitur yang akan bergantung secara khusus pada setrika dalam pengujian kami. Selain itu, emulator ini diproyeksikan dengan baik ke infrastruktur yang ada pada saat itu. Langkah selanjutnya adalah mengajar manajer Node untuk meluncurkan sumber daya jenis baru. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang diperlukan untuk menjalankan emulator Android? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, Anda memerlukan Android SDK dengan satu set utilitas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maka Anda perlu membuat AVD - Perangkat Virtual Android - ini adalah bagaimana emulator Android Anda akan diatur - arsitektur apa yang akan dimilikinya, berapa inti yang akan digunakan, apakah layanan Google akan tersedia, dll.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gt/az/6e/gtaz6ejxanl2ppil-8niyzhkvjc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah itu, Anda perlu memilih nama AVD yang dibuat, mengatur parameter, misalnya, mentransfer port tempat ADB akan diluncurkan, dan mulai. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, ada kekhasan dalam skema semacam itu - sistem ini memungkinkan Anda untuk hanya menjalankan satu emulator instance pada satu AVD tertentu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solusi untuk masalah ini adalah membuat AVD dasar, yang disimpan dalam memori, ini memungkinkan untuk menyalinnya di tempat lain. </font><font style="vertical-align: inherit;">Selama peluncuran emulator Android, basis AVD disalin ke direktori sementara yang dipetakan ke dalam memori, setelah itu dimulai. </font><font style="vertical-align: inherit;">Skema semacam itu bekerja dengan cepat, tetapi rumit. </font><font style="vertical-align: inherit;">Sampai saat ini, masalah ini telah dipecahkan oleh opsi hanya baca, yang memungkinkan Anda untuk menjalankan emulator Android dalam jumlah tak terbatas dari satu AVD</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performa</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berdasarkan hasil bekerja dengan AVD, kami mengembangkan beberapa rekomendasi internal:</font></font><br>
<br>
<ol>
<li>  86  ,  ARM  .     dev/kvm  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Linux  HAXM-  Mac  Windows</a></li>
<li>GPU-  .     ,    .  ,          ,   ,    Android-  </li>
<li> .       </li>
<li>   ,         localhost,        </li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adapun gambar Docker untuk pengujian di Android, saya ingin menyoroti Agoda dan Selenoid, mereka menggunakan kemampuan emulator Android secara maksimal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perbedaan di antara mereka adalah bahwa dalam Selenoid default memiliki </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Appium</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Agoda dan menggunakan emulator "bersih". Selain itu, Selenoid memiliki lebih banyak dukungan komunitas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada akhir 2018, CloudNode-Manager telah dibuat, ia menghubungi koordinator, menerima tugas dan diluncurkan menggunakan perintah di cloud. Alih-alih mesin besi, layanan ini menggunakan sumber daya </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one-cloud</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - cloud pribadi Odnoklassniki sendiri.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami berhasil mencapai penskalaan dengan mengajarkan DeviceManager cara bekerja dengan Koordinator. Untuk melakukan ini, saya harus mengubah API Pengelola perangkat untuk menambahkan kemampuan untuk meminta jenis perangkat (virtual / nyata). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inilah yang terjadi jika Anda mencoba menjalankan Instalasi ADB pada 250 emulator dari satu mesin. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lk/ab/td/lkabtdmlsx7-1x6ne200l5jgi10.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para petugas segera bereaksi terhadap hal ini dan memulai sebuah insiden - mesin memuat antarmuka jaringan gigabit dengan lalu lintas keluar. Kompleksitas ini diatasi dengan meningkatkan throughput di server. Saya tidak bisa mengatakan bahwa masalah ini memberi kami banyak masalah, tetapi Anda tidak boleh melupakannya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tampaknya kesuksesan adalah Devicemanager, koordinator, scaling. Kita dapat menjalankan tes di seluruh peternakan. Pada prinsipnya, kami dapat menjalankannya pada setiap permintaan tarik, dan pengembang akan segera menerima umpan balik.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uk/zl/l_/ukzll_cniqi00nxoiy67osju6do.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi tidak semuanya begitu cerah. Anda mungkin telah memperhatikan bahwa sejauh ini tidak ada yang dikatakan tentang kualitas tes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sr/he/4k/srhe4kzvbock0mcztvh88d2s_98.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti inilah peluncuran kami. Dan hal yang paling menarik adalah bahwa antara peluncuran tes yang sama sekali berbeda bisa jatuh. Ini adalah air terjun yang tidak stabil. Dan saya, pengembang, atau penguji tidak mempercayai hasil ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagaimana kami menangani masalah ini? Mereka hanya menyalin semuanya dari Robotium ke Espresso, dan itu menjadi baik ... Sebenarnya, tidak. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengatasi masalah ini, kami tidak hanya menulis ulang semua yang ada di Espresso, tetapi juga mulai menggunakan API untuk semua jenis tindakan seperti mengunggah foto, membuat posting, menambah teman, dll., Membuat login cepat, menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diplink</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> yang memungkinkan Anda untuk langsung pergi ke layar yang diinginkan , dan, tentu saja, kami menganalisis semua kasus uji.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang tes berjalan terlihat seperti ini: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/m2/zg/lo/m2zglocfnlq8e31pgwew1czj-ic.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda mungkin memperhatikan bahwa tes merah tetap ada, tetapi penting untuk diingat bahwa ini adalah tes end-to-end yang berjalan pada produksi. Kami memiliki batasan jumlah tes yang dapat jatuh di cabang utama aplikasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kami memiliki tes dan penskalaan yang stabil. Namun, infrastruktur uji masih sangat terkait dengan tes. Pada saat yang sama, karena harapan dari tes end-to-end, CI sibuk, dan majelis lain dapat mengantri, menunggu agen bebas. Selain itu, tidak ada skema yang jelas untuk bekerja dengan start paralel.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alasan yang disebutkan di atas menjadi pendorong untuk pengembangan QueueRunner - layanan yang memungkinkan Anda untuk menjalankan tes secara serempak tanpa memblokir CI. </font><font style="vertical-align: inherit;">Untuk bekerja, ia membutuhkan tes dan uji APK, serta serangkaian tes. </font><font style="vertical-align: inherit;">Setelah menerima data yang diperlukan, ia akan dapat mengatur proses berlari dalam antrian, mengalokasikan dan membebaskan sumber daya yang diperlukan. </font><font style="vertical-align: inherit;">QueueRunner mengunduh hasil lari ke Jira dan Stash, dan juga mengirimkannya melalui surat dan di messenger. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
QueueRunner memiliki aliran uji - ia memonitor siklus hidup tes. </font><font style="vertical-align: inherit;">Aliran default yang kami gunakan sekarang terdiri dari lima langkah:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perangkat penerima. </font><font style="vertical-align: inherit;">Pada titik ini, Devicemanager meminta melalui koordinator perangkat nyata atau virtual.</font></font></li>
<li> .        APK  ,    –  ,           .</li>
<li>,      </li>
<li> </li>
<li>    </li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasilnya, lima langkah sederhana adalah seluruh siklus hidup pengujian dalam layanan kami. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ke/pd/yg/kepdyglhyclwq8ogfg4thqparxy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa manfaat yang diberikan QueueRunner kepada kami? Pertama, ia menggunakan semua sumber daya yang mungkin secara maksimal - dapat ditingkatkan ke seluruh tambak dan dengan cepat mendapatkan hasil. Kedua, dengan bonus, kami mendapat kesempatan untuk mengontrol urutan tes. Sebagai contoh, kita dapat menjalankan tes terpanjang atau paling bermasalah di awal dan dengan demikian mengurangi waktu yang dibutuhkan untuk menunggu mereka berjalan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
QueueRunner juga memungkinkan Anda membuat retret cerdas. Kami menyimpan semua data dalam basis data, sehingga kapan saja kami dapat melihat riwayat pengujian. Sebagai contoh, adalah mungkin untuk melihat rasio kelulusan ujian yang berhasil dan yang tidak berhasil serta memutuskan apakah, pada prinsipnya, layak untuk memulai kembali pengujian.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
QueueRunner dan Devicemanager telah memberi kita kemampuan untuk beradaptasi dengan jumlah sumber daya. Sekarang kita dapat meningkatkan skala ke seluruh lahan, berkat penggunaan emulator, yaitu, jumlah perangkat virtual yang hampir tak terbatas memberi kita kesempatan untuk menjalankan lebih banyak pengujian, tetapi jika karena alasan tertentu sumber daya tidak tersedia, layanan akan menunggu mereka kembali dan tidak akan ada kehilangan peluncuran. Kami hanya menggunakan sumber daya yang tersedia untuk kami, oleh karena itu, setelah beberapa waktu hasilnya masih akan diperoleh dan pada saat yang sama CI tidak akan diblokir. Dan yang paling penting, infrastruktur pengujian dan pengujian sekarang terpisah. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang, untuk menjalankan tes di Android, Anda hanya perlu memberi kami APK uji dan daftar tes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami telah menempuh perjalanan jauh dari pertanian Selenium di mesin virtual ke peluncuran tes Android di cloud. </font><font style="vertical-align: inherit;">Namun, jalur ini belum selesai.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proses pengembangan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita lihat bagaimana infrastruktur pengujian terkait dengan proses pengembangan dan bagaimana penguji dan pengembang melihatnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tim Android kami menggunakan GitFlow standar: </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/rf/p9/ot/rfp9ot5imowggxpkdgyekbym2ao.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap fitur memiliki cabang sendiri. Pengembangan utama terjadi di cabang berkembang. Pengembang yang memutuskan untuk membuat fitur super baru memulai pengembangannya di cabangnya sendiri, sementara pengembang lain dapat bekerja di cabang lain secara paralel. Ketika seorang pengembang percaya bahwa kode yang idealnya indah, terbaik di dunia sudah siap dan perlu diluncurkan ke pengguna secepat mungkin, ia membuat permintaan menarik untuk dikembangkan, dan uji unit dan uji komponen secara otomatis dibangun dan diluncurkan. Secara bersamaan, APK dirakit, dikirim ke QueueRunner, dan tes end-to-end dijalankan. Setelah itu, hasil menjalankan tes datang ke pengembang.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, ada kemungkinan besar bahwa setelah pembuatan cabang fitur dalam pengembangan, ada banyak komitmen. </font><font style="vertical-align: inherit;">Ini berarti bahwa pengembangan mungkin tidak seperti dulu. </font><font style="vertical-align: inherit;">Oleh karena itu, pra-penggabungan terjadi terlebih dahulu - kami menggabungkan berkembang menjadi cabang fitur saat ini, dan pada kondisi prematur inilah kami membangun, pengujian unit, pengujian komponen, ujung-ke-ujung, dan berdasarkan hasil ini kami membuat laporan. </font><font style="vertical-align: inherit;">Dengan demikian, kami memahami bagaimana fungsionalnya fitur dalam versi pengembangan saat ini dan, jika semuanya baik-baik saja, maka fitur tersebut dikirimkan ke pengguna.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/og/qs/2m/ogqs2mqcef0dwn-lyaxugjzhrca.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pelaporan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah bagaimana pelaporan Stash terlihat: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/61/7b/qi/617bqiddnqointrhxigp3g2o904.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bot kami pertama kali menulis bahwa tes telah dimulai, dan ketika mereka lulus, itu memperbarui pesan dan menambahkan berapa banyak yang telah lulus, berapa banyak yang telah jatuh, berapa banyak kesalahan yang diketahui, dan berapa banyak tes bersisik. Dia menulis hal yang sama di Jira, dan menambahkan tautan ke perbandingan peluncuran. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beginilah perbandingan kedua peluncuran itu: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/li/kf/62/likf62ljuom4erhqvkxvoq4o-li.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini proses saat ini di cabang fitur dibandingkan dengan langkah terakhir dalam pengembangan. Ini berisi informasi tentang jumlah tes yang sedang dijalankan, masalah yang cocok, tes yang jatuh, dan tes Flaky yang tidak stabil yang berada dalam satu kondisi dan beralih ke yang lain. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika setidaknya satu tes unit atau lebih dari beberapa ambang batas uji end-to-end jatuh, maka gabungan akan diblokir.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk memahami apakah tes jatuh secara stabil, kami membandingkan hash jejak jejak jatuh, sebelum mereka dibersihkan dari digit sebelumnya, hanya nomor baris yang tersisa. </font><font style="vertical-align: inherit;">Jika hash cocok, maka ini adalah jatuh yang sama, jika mereka berbeda, maka kemungkinan besar jatuh akan berbeda.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ringkasan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai hasilnya, kami menerapkan solusi yang stabil dan toleran terhadap kesalahan yang sesuai dengan infrastruktur kami. </font><font style="vertical-align: inherit;">Kemudian infrastruktur yang dihasilkan diadaptasi untuk pengujian Android. </font><font style="vertical-align: inherit;">Kami dibantu dalam hal ini oleh Manajer perangkat, yang membantu kami bekerja secara bersamaan dengan perangkat nyata, dan dengan perangkat virtual, serta QueueRunner, yang membantu kami memisahkan infrastruktur dan pengujian, dan tidak memblokir CI selama pengujian berlangsung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu tampak seperti waktu uji coba selama satu minggu pada 2016 - dari lima puluh menit atau lebih. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/j9/0-/bk/j90-bkvotdp0g3zmlpphaskbmnu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Begini tampilannya: </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/gi/0h/zy/gi0hzyeoygzkwphzp74vpph21q8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagan ini menunjukkan proses yang berlangsung lebih dari 2 jam dari rata-rata hari kerja. </font><font style="vertical-align: inherit;">Waktu berjalan dikurangi hingga maksimum 15 menit, jumlah lari meningkat tajam.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id497700/index.html">Mitaps online mingguan untuk dukungan dan DevOps, keamanan, dan robot mulai 17 April</a></li>
<li><a href="../id497702/index.html">Lima tren dalam penyimpanan data yang harus Anda perhatikan di tahun 2020</a></li>
<li><a href="../id497708/index.html">Kami mengundang Anda ke serangkaian webinar Fujitsu pada bulan April dan Mei</a></li>
<li><a href="../id497714/index.html">Bagaimana melindungi proses dan ekstensi kernel pada macOS</a></li>
<li><a href="../id497724/index.html">Mempersiapkan server untuk menerbitkan aplikasi web dengan Python</a></li>
<li><a href="../id497728/index.html">Bahaya “membakar” keripik</a></li>
<li><a href="../id497730/index.html">BDD Nyaman: SpecFlow + TFS</a></li>
<li><a href="../id497736/index.html">Ulasan 10 mesin pembakaran internal baru</a></li>
<li><a href="../id497738/index.html">Uji diri Anda di Swift: puzzle untuk pecinta puzzle</a></li>
<li><a href="../id497740/index.html">Para pembuat mobil mengakui bahwa ini adalah waktu yang sangat lama sebelum kendaraan tanpa awak sepenuhnya</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>