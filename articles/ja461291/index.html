<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✌🏿 🏎️ 🤰🏼 Golang：特定のパフォーマンスの問題 🍿 🌠 👤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Go言語の人気が高まっています。たとえばGolangConfなどの会議がますます増えており、その言語は最も高額な10のテクノロジーの1つに含まれていることを確信しています。したがって、パフォーマンスなどの特定の問題について話すことはすでに理にかなっています。すべてのコンパイル済み言語に共通の問題に加...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Golang：特定のパフォーマンスの問題</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/461291/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Go言語の人気が高まっています。たとえば</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GolangConf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などの会議がますます増えており</font><font style="vertical-align: inherit;">、その言語</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最も高額な</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">10の</font></a><font style="vertical-align: inherit;">テクノロジーの1つに含まれ</font><font style="vertical-align: inherit;">ていることを確信してい</font><font style="vertical-align: inherit;">ます。したがって、パフォーマンスなどの特定の問題について話すことはすでに理にかなっています。すべてのコンパイル済み言語に共通の問題に加えて、Goには独自の問題があります。これらは、オプティマイザ、スタック、型システム、およびマルチタスクモデルに関連付けられています。それらを解決する方法と回避策は、非常に具体的である場合があります。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ダニエルポドルスキーは</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、囲碁の伝道者ですが、彼の中で多くの奇妙なことに出会います。奇妙なすべての、そして最も重要なことには、興味深いすべての収集および</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テスト</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、そしてそれについてHighLoad ++で話します。</font><font style="vertical-align: inherit;">レポートのトランスクリプトには、数値、グラフ、コード例、プロファイラーの結果、さまざまな言語での同じアルゴリズムのパフォーマンスの比較など、「最適化」という言葉が嫌いです。</font><font style="vertical-align: inherit;">筆記録には、そのような単純な言語でどこから来たのか、そして新聞で読むことができるすべてのものには何の啓示もありません。</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/8UESXMJwTpc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<a name="habracut"></a><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スピーカーについて。</font></font></strong> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daniil Podolsky</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：26年の経験、20年の運用経験、グループのリーダーを含む、Goでの5年のプログラミング。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kirill</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Danshin：Gramework、Maintainer、Fast HTTP、Black Go-mageの作成者。</font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">報告書はダニエルポドルスキーとキリルダンシンが共同で作成しましたが、ダニエルが報告書を作成し、シリルは精神的に助けました。</font></font></em><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">言語構成</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パフォーマンスのベンチマークがあります</font></font><code>direct</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、変数をインクリメントし、もはや何もしない関数です。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">//  </span>
<span class="hljs-keyword">var</span> testInt64 <span class="hljs-keyword">int64</span> <font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkDirect</span><span class="hljs-params">(b *testing.B)</span></span> {
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; b.N; i++ {<font></font>
        incDirect()<font></font>
    }<font></font>
} <font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">incDirect</span><span class="hljs-params">()</span></span> {<font></font>
    testInt64++ <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この関数の結果は、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1操作あたり1.46 ns</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">これは最小のオプションです。</font><font style="vertical-align: inherit;">1操作あたり1.5 nsより高速で、おそらく機能しません。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちが彼を愛する方法を延期する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くの</font></font><code>defer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">人々は</font><font style="vertical-align: inherit;">言語設計</font><font style="vertical-align: inherit;">を知っており、それを使いたいと思っています。</font><font style="vertical-align: inherit;">多くの場合、このように使用します。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkDefer</span><span class="hljs-params">(b *testing.B)</span></span> { 
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; b.N; i++ {<font></font>
        incDefer() <font></font>
    }<font></font>
} <font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">incDefer</span><span class="hljs-params">()</span></span> {  
    <span class="hljs-keyword">defer</span> incDirect() <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、そのように使用することはできません！</font><font style="vertical-align: inherit;">各遅延は、操作ごとに40 nsを消費します。</font></font><br>
<br>
<pre><code class="plaintext hljs">//  <font></font>
BenchmarkDirect-4 2000000000  1.46 /<font></font>
<font></font>
// defer<font></font>
BenchmarkDefer-4 30000000 40.70  /</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多分これはインラインによるものだと思いましたか？</font><font style="vertical-align: inherit;">多分インラインはとても速いですか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
直接インライン化。遅延関数はインライン化できません。</font><font style="vertical-align: inherit;">したがって、インラインなしで別のテスト関数をコンパイルしました。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkDirectNoInline</span><span class="hljs-params">(b *testing.B)</span></span> {
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; b.N; i++ {<font></font>
        incDirectNoInline()<font></font>
    }<font></font>
}<font></font>
<span class="hljs-comment">//go:noinline</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">incDirectNoInline</span><span class="hljs-params">()</span></span> {<font></font>
    testInt64++ <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何も変わっていないので、遅延は同じ40 nsかかりました。</font><font style="vertical-align: inherit;">大切なことは延期してください。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数の所要時間が100 ns未満の場合は、延期せずに実行できます。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、関数がマイクロ秒以上かかる場合、それはすべて同じです-遅延を使用できます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参照によるパラメーターの受け渡し</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
人気の神話を考えてみましょう。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkDirectByPointer</span><span class="hljs-params">(b *testing.B)</span></span> {
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; b.N; i++ {<font></font>
        incDirectByPointer(&amp;testInt64)<font></font>
    }<font></font>
} <font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">incDirectByPointer</span><span class="hljs-params">(n *<span class="hljs-keyword">int64</span>)</span></span> { <font></font>
    *n++<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何も変わっていない-それに値するものは何もない。</font></font><br>
<br>
<pre><code class="plaintext hljs">//    <font></font>
BenchmarkDirectByPointer-4 2000000000 1.47 / <font></font>
BenchmarkDeferByPointer-4 30000000 43.90 /</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
据え置きあたり3 nsを除いて、これは変動のために償却されます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匿名関数</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
初心者は、「匿名関数は高価ですか？」と尋ねることがあります。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkDirectAnonymous</span><span class="hljs-params">(b *testing.B)</span></span> {
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; b.N; i++ {
        <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {<font></font>
            testInt64++<font></font>
        }()<font></font>
    }<font></font>
}</code></pre><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匿名関数は高価ではなく、40.4 nsかかります。</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インターフェース</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インターフェースとそれを実装する構造があります。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> testTypeInterface <span class="hljs-keyword">interface</span> {<font></font>
    Inc()<font></font>
}<font></font>
<span class="hljs-keyword">type</span> testTypeStruct <span class="hljs-keyword">struct</span> {  <font></font>
    n <span class="hljs-keyword">int64</span> <font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *testTypeStruct)</span> <span class="hljs-title">Inc</span><span class="hljs-params">()</span></span> {  <font></font>
    s.n++<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
incrementメソッドを使用するには、3つのオプションがあります。</font><font style="vertical-align: inherit;">Structから直接：</font></font><code>var testStruct = testTypeStruct{}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それぞれの具体的なインタフェースから：</font></font><code>var testInterface testTypeInterface = &amp;testStruct</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実行時の変換インターフェースを持ちます：</font></font><code>var testInterfaceEmpty interface{} = &amp;testStruct</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下は、ランタイムインターフェイスの変換であり、直接使用します。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkInterface</span><span class="hljs-params">(b *testing.B)</span></span> { 
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; b.N; i++ { <font></font>
        testInterface.Inc()<font></font>
    }<font></font>
} <font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkInterfaceRuntime</span><span class="hljs-params">(b *testing.B)</span></span> { 
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; b.N; i++ {<font></font>
        testInterfaceEmpty.(testTypeInterface).Inc()<font></font>
    } <font></font>
}</code></pre><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そのため、インターフェースの費用はかかりません。</font></font></blockquote><br>
<pre><code class="plaintext hljs">// <font></font>
BenchmarkStruct-4 2000000000 1.44 /<font></font>
BenchmarkInterface-4 2000000000 1.88 /<font></font>
BenchmarkInterfaceRuntime-4 200000000 9.23 /</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ランタイムインターフェイスの変換は価値がありますが、費用はかかりません。特に拒否する必要はありません。</font><font style="vertical-align: inherit;">ただし、可能な限りそれなしで実行してください。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">神話：</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">逆参照-ポインターの逆参照-無料。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匿名機能は無料です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インターフェイスは無料です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ランタイムインターフェイス変換-無料ではありません。</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スイッチ、マップ、スライス</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Goを初めて使う人は、スイッチをマップに置き換えるとどうなるかを尋ねます。</font><font style="vertical-align: inherit;">速くなりますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スイッチにはさまざまなサイズがあります。</font><font style="vertical-align: inherit;">私は3つのサイズでテストしました。10ケースは小、100ケースは中、1000ケースは大です。</font><font style="vertical-align: inherit;">1000ケースのスイッチは、実際の製品コードにあります。</font><font style="vertical-align: inherit;">もちろん、誰も彼の手でそれらを書きません。</font><font style="vertical-align: inherit;">これは自動生成されたコードで、通常はタイプスイッチです。</font><font style="vertical-align: inherit;">intとstringの2つのタイプでテストされています。</font><font style="vertical-align: inherit;">それはもっとはっきりするだろうと思われた。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小さなスイッチ。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最速のオプションは実際のスイッチです。</font><font style="vertical-align: inherit;">その直後にスライスが続き、対応する整数インデックスには関数への参照が含まれます。</font><font style="vertical-align: inherit;">マップはintでもstringでもリーダーではありません。</font></font><br>
<div class="scrollable-table"><table>
<tbody>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkSwitchIntSmall-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">500000000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.26 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkMapIntSmall-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,000,000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.70 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkSliceIntSmall-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">500000000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.85 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkSwitchStringSmall-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,000,000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.70 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkMapStringSmall-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,000,000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.60 ns /オペレーション</font></font></td>
</tr>
</tbody>
</table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
文字列の切り替えは、intの場合よりもかなり遅くなります。</font><font style="vertical-align: inherit;">文字列ではなくintに切り替えることができる場合は、切り替えます。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真ん中のスイッチ。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スイッチ自体は依然としてintを支配しますが、sliceが少し追い越しています。</font><font style="vertical-align: inherit;">地図はまだ悪いです。</font><font style="vertical-align: inherit;">しかし、文字列キーでは、マップはスイッチよりも高速です-予想どおり。</font></font><br>
<div class="scrollable-table"><table>
<tbody>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkSwitchIntMedium-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">300000000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.55 ns /演算</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkMapIntMedium-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,000,000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.10 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkSliceIntMedium-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">300000000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.76 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkSwitchStringMedium-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50,000,000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">28.50 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkMapStringMedium-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,000,000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.30 ns / op</font></font></td>
</tr>
</tbody>
</table></div><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大きなスイッチ。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1000件のケースは、「switch by string」というノミネーションでmapの無条件の勝利を示しています。</font><font style="vertical-align: inherit;">理論的にはスライスが勝ちますが、実際にはここで同じスイッチを使用することをお勧めします。</font><font style="vertical-align: inherit;">マップが特別なハッシュ関数を持つ整数キーを持っていることを考慮しても、マップはまだ遅いです。</font><font style="vertical-align: inherit;">通常、この関数は何もしません。</font><font style="vertical-align: inherit;">int自体がintのハッシュとして機能します。</font></font><br>
<div class="scrollable-table"><table>
<tbody>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkSwitchIntLarge-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,000,000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.6 ns /オペレーション</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkMapIntLarge-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50,000,000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">34.3 ns /演算</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkSliceIntLarge-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,000,000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.8 ns /オペレーション</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkSwitchStringLarge-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20,000,000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100.0 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkMapStringLarge-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30000000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">37.4 ns / op</font></font></td>
</tr>
</tbody>
</table></div><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">調査結果。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マップは、整数条件ではなく、大量の場合にのみ優れています。</font><font style="vertical-align: inherit;">int以外のすべての条件で、stringと同じように動作すると確信しています。</font><font style="vertical-align: inherit;">条件が整数の場合、スライスは常にステアリングします。</font><font style="vertical-align: inherit;">プログラムを2 ns高速化したい場合に使用します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ルーチン間の相互作用</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トピックは複雑です。私は多くのテストを実施しており、最もわかりやすいテストを紹介します。</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機関間の相互作用の</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次の</font><strong><font style="vertical-align: inherit;">手段</font></strong><font style="vertical-align: inherit;">を知っています</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原子 </font><font style="vertical-align: inherit;">これらは適用範囲が限られている手段です。ポインタを置き換えるか、intを使用できます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MutexはJava以降広く使用されています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チャンネルはGOに固有です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バッファチャネル-バッファチャネル。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、1つのリソースで競合する非常に多くのゴルーチンでテストしました。</font><font style="vertical-align: inherit;">しかし、私は指標として3つ選択しました。少し-100、中-1000、たくさん-10000 </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。負荷プロファイルは異なり</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">すべてのゴルチンが1つの変数に書き込みたい場合がありますが、これはまれです。</font><font style="vertical-align: inherit;">通常、結局のところ、一部は書き込み、一部は読み取りです。</font><font style="vertical-align: inherit;">ほとんどの読者の90％が読み取り、90％が書き込みです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、チャネルを提供するゴルーチンが変数の読み取りと変数への書き込みの両方を提供できるようにするために使用されるコードです。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {   
    <span class="hljs-keyword">for</span> {   
        <span class="hljs-keyword">select</span> {
        <span class="hljs-keyword">case</span> n, ok := &lt;-cw:     
            <span class="hljs-keyword">if</span> !ok {      <font></font>
                wgc.Done() <font></font>
                <span class="hljs-keyword">return</span> <font></font>
            } <font></font>
            testInt64 += n    <font></font>
       <span class="hljs-keyword">case</span> cr &lt;- testInt64: <font></font>
       } <font></font>
   }<font></font>
}()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メッセージの作成に使用したチャネルを介してメッセージが到着した場合は、それを実行します。</font><font style="vertical-align: inherit;">チャネルが閉じている場合は、goroutinを終了します。</font><font style="vertical-align: inherit;">いつでも、他のゴルーチンが読み取りに使用するチャネルに書き込む準備ができています。</font></font><br>
<div class="scrollable-table"><table>
<tbody>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benchmarkmutex-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,000,000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.30 ns /動作</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benchmarkatomic-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">200000000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.72 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkChan-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5,000,000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">239.00 ns /オペレーション</font></font></td>
</tr>
</tbody>
</table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ゴルーチン1個分のデータです。</font><font style="vertical-align: inherit;">チャネルテストは、2つのゴルーチンで実行されます。1つはチャネルを処理し、もう1つはこのチャネルに書き込みます。</font><font style="vertical-align: inherit;">そして、これらのオプションは1つでテストされました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数への直接書き込み。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mutexはログを取り、変数に書き込み、ログを解放します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atomicは、Atomicを介して変数に書き込みます。</font><font style="vertical-align: inherit;">これは無料ではありませんが、1つのガルティンでMutexよりも大幅に安価です。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
少数のgorutinで同じ</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atomicを</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべて同期する効果的で高速な方法</font><font style="vertical-align: inherit;">は、驚くことではありません。</font><font style="vertical-align: inherit;">Directはここにはありません。同期は必要ですが、提供していません。</font><font style="vertical-align: inherit;">しかし、Atomicにはもちろん欠陥があります。</font></font><br>
<div class="scrollable-table"><table>
<tbody>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkMutexFew-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">55894 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkAtomicFew-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14585 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkChanFew-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">323859 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkChanBufferedFew-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">341321 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkChanBufferedFullFew-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">70052 ns /オペレーション</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkMutexMostlyReadFew-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">56402 ns /演算</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkAtomicMostlyReadFew-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,000,000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2094 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkChanMostlyReadFew-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">442689 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkChanBufferedMostlyReadFew-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">449,666 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkChanBufferedFullMostlyReadFew-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">442,708 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkMutexMostlyWriteFew-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">79708 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkAtomicMostlyWriteFew-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13358 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkChanMostlyWriteFew-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">449,556 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkChanBufferedMostlyWriteFew-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">445,423 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkChanBufferedFullMostlyWriteFew-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">414626 ns / op</font></font></td>
</tr>
</tbody>
</table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次はミューテックスです。</font><font style="vertical-align: inherit;">ChannelはMutexと同じくらい速いと思っていましたが、違います。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Channelは、Mutexよりも1桁高価です。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、ChannelとBuffered Channelはほぼ同じ価格で提供されます。</font><font style="vertical-align: inherit;">そして、バッファがオーバーフローしないチャンネルがあります。</font><font style="vertical-align: inherit;">これは、バッファがオーバーフローするものより1桁安価です。</font><font style="vertical-align: inherit;">Channelのバッファーがいっぱいでない場合にのみ、Mutexとほぼ同じオーダーのコストがかかります。</font><font style="vertical-align: inherit;">これは私がテストから期待したものです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コストの分布を示すこの図は、MostlyReadとMostlyWriteの両方の負荷プロファイルで繰り返されます。</font><font style="vertical-align: inherit;">さらに、MostlyReadチャネル全体は、不完全なチャネルと同じコストがかかります。</font><font style="vertical-align: inherit;">そして、MostlyWriteのバッファリングされたチャネルは、バッファがいっぱいではなく、他のチャネルと同じコストです。</font><font style="vertical-align: inherit;">なぜそうなのかは言えませんが、この質問についてはまだ勉強していません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータを渡す</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータをより速く渡す方法-参照または値によって？</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">確認しよう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は次のようにチェックしました-1から10までのネストされた型を作成しました。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> TP001 <span class="hljs-keyword">struct</span> { <font></font>
    I001 <span class="hljs-keyword">int64</span> <font></font>
} <font></font>
<span class="hljs-keyword">type</span> TV002 <span class="hljs-keyword">struct</span> {  <font></font>
    I001 <span class="hljs-keyword">int64</span> <font></font>
    S001 TV001 <font></font>
    I002 <span class="hljs-keyword">int64</span> <font></font>
    S002 TV001 <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
10番目のネストされた型には10個のint64フィールドがあり、前のネストのネストされた型も10です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ネスト型を作成する関数を作成しました。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewTP001</span><span class="hljs-params">()</span> *<span class="hljs-title">TP001</span></span> { 
    <span class="hljs-keyword">return</span> &amp;TP001{   <font></font>
        I001: rand.Int63(), <font></font>
    } <font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewTV002</span><span class="hljs-params">()</span> <span class="hljs-title">TV002</span></span> {  
    <span class="hljs-keyword">return</span> TV002{  <font></font>
        I001: rand.Int63(), <font></font>
        S001: NewTV001(), <font></font>
        I002: rand.Int63(), <font></font>
        S002: NewTV001(), <font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストのために、私はオプションの3種類の使用：3を入れ子にして、メディアを2をネストで小さなを、5を入れ子にして大規模な私は夜に10を入れ子にして非常に大規模なテストを入れていたが、画像が5の場合とまったく同じ存在である</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機能で、値による送信は二倍以上であります参照渡しよりも高速です</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、値を渡してもエスケープ分析がロードされないためです。</font><font style="vertical-align: inherit;">したがって、割り当てる変数はスタック上にあります。</font><font style="vertical-align: inherit;">ガベージコレクターの場合、ランタイムの方が大幅に安価です。</font><font style="vertical-align: inherit;">接続する時間がないかもしれませんが。</font><font style="vertical-align: inherit;">これらのテストは数秒間続きました-ガベージコレクターはおそらくまだ眠っていました。</font></font><br>
<div class="scrollable-table"><table>
<tbody>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkCreateSmallByValue-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">200,000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8942 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkCreateSmallByPointer-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15985 ns /動作</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkCreateMediuMByValue-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2000年</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">862317 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkCreateMediuMByPointer-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2000年</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1228130 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkCreateLargeByValue-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">47398456 ns / op</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkCreateLargeByPointer-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">二十</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">61928751 ns / op</font></font></td>
</tr>
</tbody>
</table></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">黒魔術</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このプログラムが何を出力するか知っていますか？</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main 
<span class="hljs-keyword">type</span> A <span class="hljs-keyword">struct</span> {   <font></font>
    a, b <span class="hljs-keyword">int32</span> <font></font>
} <font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {   <font></font>
    a := <span class="hljs-built_in">new</span>(A)  <font></font>
    a.a = <span class="hljs-number">0</span> 
    a.b = <span class="hljs-number">1</span>   
    z := (*(*<span class="hljs-keyword">int64</span>)(unsafe.Pointer(a)))  <font></font>
    fmt.Println(z) <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムの結果は、プログラムが実行されるアーキテクチャによって異なります。</font><font style="vertical-align: inherit;">AMD64などのリトルエンディアンでは、プログラムは次のように表示します。</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mn>2</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>32</mn></mrow></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.039ex" height="2.509ex" viewBox="0 -970.7 1308.3 1080.4" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/oleg-bunin/blog/461291/&amp;usg=ALkJrhhBKLXuFG94zI9K5EBaSPS4-NNfpA#MJMAIN-32" x="0" y="0"></use><g transform="translate(500,393)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/oleg-bunin/blog/461291/&amp;usg=ALkJrhhBKLXuFG94zI9K5EBaSPS4-NNfpA#MJMAIN-33"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/oleg-bunin/blog/461291/&amp;usg=ALkJrhhBKLXuFG94zI9K5EBaSPS4-NNfpA#MJMAIN-32" x="500" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mrow class="MJX-TeXAtom-ORD"><mn>32</mn></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-1">2^{32}</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。ビッグエンディアン-1つ。リトルエンディアンではこの単位が数字の中央に表示され、ビッグエンディアンでは最後に表示されるため、結果は異なります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エンディアンが切り替わるプロセッサは世界中にまだあります。たとえば、Power PCなどです。この種の危険なトリックが何をするのかについて結論を下す前に、起動時にコンピュータに設定されているエンディアンを把握する必要があります。たとえば、一部のIBMマルチプロセッササーバーで実行されるGoコードを記述したとします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
安全でない黒魔術をすべて考慮する理由を説明するために、このコードを引用しました。使用する必要はありません。しかし、シリルはそれが必要であると信じています。そしてそれが理由です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GOB-Go Binary Marshallerと同じことをする関数があります。これはエンコーダですが、安全ではありません。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">encodeMut</span><span class="hljs-params">(data []<span class="hljs-keyword">uint64</span>)</span> <span class="hljs-params">(res []<span class="hljs-keyword">byte</span>)</span></span> {<font></font>
    sz := <span class="hljs-built_in">len</span>(data) * <span class="hljs-number">8</span> <font></font>
    dh := (*header)(unsafe.Pointer(&amp;data)) <font></font>
    rh := &amp;header{   <font></font>
        data: dh.data,   <font></font>
        <span class="hljs-built_in">len</span>:  sz,   
        <span class="hljs-built_in">cap</span>:  sz, <font></font>
    } <font></font>
    res = *(*[]<span class="hljs-keyword">byte</span>)(unsafe.Pointer(&amp;rh))  
    <span class="hljs-keyword">return</span> 
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際には、メモリの一部を取り、そこからバイトの配列を描画します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは注文でもありません-これらは2つの注文です。</font><font style="vertical-align: inherit;">したがって、Cyril Danshinは、高性能のコードを作成するときに、プログラムの本質に立ち入り、それを危険にさらすことをためらっていません。</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ベンチマークgob-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">200,000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8466 ns /オペレーション</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">120.94 MB /秒</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BenchmarkUnsafeMut-4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50,000,000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">37 ns /演算</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">27691.06 MB /秒</font></font></td>
</tr>
</tbody>
</table></div><blockquote>   Go   7   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">GolangConf</a> —   ,   Go   ,  ,       .        ,           — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>  . <br>
<br>
  ,    , , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">HighLoad++</a>.    . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>            -. </blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja461281/index.html">Red Hat（RHEL / CentOS）7のchroot環境でBIND DNSサーバーをセットアップするためのチュートリアル</a></li>
<li><a href="../ja461283/index.html">ソフトウェアアーキテクチャとシステム設計：全体像とリソースガイド</a></li>
<li><a href="../ja461285/index.html">5つの主要なサンプリングアルゴリズム</a></li>
<li><a href="../ja461287/index.html">ヒューリスティックとミューテーションに基づいた戦術ゲームで巧妙なAIを開発する</a></li>
<li><a href="../ja461289/index.html">CLion 2019.2リリース：組み込み開発サポート、MSVCのデバッガー、未使用のヘッダーファイルの検索</a></li>
<li><a href="../ja461297/index.html">現代の標的型攻撃はどのように見えるか</a></li>
<li><a href="../ja461299/index.html">PCが成功したソフトウェアでメディア業界を征服した方法：Pro ToolsとMedia Composerについて</a></li>
<li><a href="../ja461303/index.html">Troikaカードを必須の医療保険として使用する</a></li>
<li><a href="../ja461305/index.html">会社のネットワークとMitM。パート2</a></li>
<li><a href="../ja461307/index.html">VKハッカソン2019にご招待します。今年の賞金プールは200万ルーブルです。</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>