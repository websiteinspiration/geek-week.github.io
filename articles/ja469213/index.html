<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐅 👩🏼‍⚖️ 🐱 Rustを使用した組み合わせパーサーの探索 ⏬ 🤵 🐤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは、ハブル！「Rustを使用したパーサーコンビネーターの学習」という記事の翻訳を紹介します。
 

この記事では、Rustにすでに慣れている人のために、組み合わせパーサーの基本を説明します。他の知識は必要とされず、Rustに直接関連しないすべてのこと、およびその使用の予期しない側面について説...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Rustを使用した組み合わせパーサーの探索</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/469213/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは、ハブル！</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「Rustを使用したパーサーコンビネーターの学習」</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">という記事の翻訳を紹介します</font><font style="vertical-align: inherit;">。</font></font></p><br>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事では、Rustにすでに慣れている人のために、組み合わせパーサーの基本を説明します。</font><font style="vertical-align: inherit;">他の知識は必要とされず、Rustに直接関連しないすべてのこと、およびその使用の予期しない側面について説明します。</font><font style="vertical-align: inherit;">この記事は、Rustをまだ知らない場合の学習に役立ちません。この場合、コンビナトリアルパーサーを十分に理解できない可能性があります。</font><font style="vertical-align: inherit;">Rustについて学びたい場合は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「Rustプログラミング言語」</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">という本をお勧めし</font><font style="vertical-align: inherit;">ます。</font></font></em></p><a name="habracut"></a><br>
<h3 id="s-tochki-zreniya-novichka"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初心者の視点から</font></font></h3><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのプログラマーの生活の中で、彼はパーサーを必要とする時が来ます。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初心者プログラマーは、「パーサーとは何ですか？」と尋ねます。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中級レベルのプログラマーは、「簡単です。正規表現を作成します」と言います。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マスタープログラマーは、「逃げる、私はlexとyaccを知っている」と言います。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初心者は何よりもよく考える。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正規表現が悪いわけではありません。 （ただし、複雑なパーサーを正規表現として記述しないでください。）数千年にわたって完璧に磨き上げられたパーサーやレクサージェネレーターなどの強力なツールを使用することに喜びはありません。しかし、パーサーの基本を学ぶことは</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">喜び</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。これは、正規表現またはパーサージェネレーターを使用するときにパニックが発生した場合にも見逃されるものです。これらはどちらも、実際の問題を抽象化したものです。初心者の頭の中で、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">男性が言ったように</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、多くの可能性があります。専門家によると、正しい選択肢は1つだけです。</font></font></p><br>
<p>    ,      <br>
 ,     ,   <em> </em>.       ,       ,          .      ,    .  ,       .</p><br>
<h3 id="kak-rabotat-s-etoy-statyoy">    </h3><br>
<p>      Rust      <code>src/lib.rs</code>    (      ,    ,           ).   ,   ,     .   ,    <em></em>  ,    ,           .</p><br>
<p>    <code>rustc</code>  1.34.0   <code>2018</code>  .      , ,       <code>2018</code>  (,   <code>Cargo.toml</code>  <code>edition = "2018"</code>).       .</p><br>
<p>  ,   ,    ,  <code>cargo test</code>.</p><br>
<h3 id="xcruciating-yazyk-razmetki">Xcruciating  </h3><br>
<p>       XML.   :</p><br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">parent-element</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">single-element</span> <span class="hljs-attr">attribute</span>=<span class="hljs-string">"value"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">parent-element</span>&gt;</span></code></pre><br>
<p>XML-   <code>&lt;</code>  ,   ,      ,   <code>-</code>.         :     ,    <code>=</code>     . ,     <code>/&gt;</code>      ,  <code>&gt;</code>       ,   ,   <code>&lt;/</code>,    ,     ,    <code>&gt;</code>.</p><br>
<p> ,    .     ,     <em> </em>    .            —      ,     ,  .</p><br>
<p>      ,    :</p><br>
<pre><code class="rust hljs"><span class="hljs-meta">#[derive(Clone, Debug, PartialEq, Eq)]</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Element</span></span> {<font></font>
    name: <span class="hljs-built_in">String</span>,<font></font>
    attributes: <span class="hljs-built_in">Vec</span>&lt;(<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>)&gt;,<font></font>
    children: <span class="hljs-built_in">Vec</span>&lt;Element&gt;,<font></font>
}</code></pre><br>
<p>  ,     (     ),      (  )    ,     ,  .</p><br>
<p>(  , ,     <code>derive</code>.    .)</p><br>
<h3 id="opredelenie-parsera"> </h3><br>
<p>  ,    .</p><br>
<p> —        .  —  ,    .</p><br>
<p> ,    ,  ,     ,  ,              ,  ,  "    ".</p><br>
<p>         .   ,   ,   ,        ,   ,     : -,      -     ,        ,        .</p><br>
<p>     .</p><br>
<pre><code class="rust hljs"><span class="hljs-built_in">Fn</span>(Input) -&gt; <span class="hljs-built_in">Result</span>&lt;(Input, Output), Error&gt;</code></pre><br>
<p> :          ,   . ,    ,      <code>Element</code>.            ,     ,    .        :</p><br>
<pre><code class="rust hljs"><span class="hljs-built_in">Fn</span>(&amp;<span class="hljs-built_in">str</span>) -&gt; <span class="hljs-built_in">Result</span>&lt;(&amp;<span class="hljs-built_in">str</span>, Element), &amp;<span class="hljs-built_in">str</span>&gt;</code></pre><br>
<p>   ,        ,      ,   , «»  ,         .</p><br>
<p>,     <code>&amp;[u8]</code> ( ,   ASCII)    ,         ,    —   ,           <code>input[0]</code>,     <code>input[0..1]</code>.   ,     ,     ,     .</p><br>
<p>  ,     ,      ,   Unicode.  UTF-8,    Rust   UTF-8 ,       ,     ,           .</p><br>
<h3 id="nash-pervyy-parser">  </h3><br>
<p>   ,        <br>
 ,     <code>a</code>.</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">the_letter_a</span></span>(input: &amp;<span class="hljs-built_in">str</span>) -&gt; <span class="hljs-built_in">Result</span>&lt;(&amp;<span class="hljs-built_in">str</span>, ()), &amp;<span class="hljs-built_in">str</span>&gt; {
  <span class="hljs-keyword">match</span> input.chars().next() {
      <span class="hljs-literal">Some</span>(<span class="hljs-string">'a'</span>) =&gt; <span class="hljs-literal">Ok</span>((&amp;input[<span class="hljs-string">'a'</span>.len_utf8()..], ())),<font></font>
      _ =&gt; <span class="hljs-literal">Err</span>(input),<font></font>
  }<font></font>
}</code></pre><br>
<p>-,       :          <code>Result</code>  <code>(&amp;str, ())</code>,    <code>&amp;str</code>.  <code>(&amp;str, ())</code> —   :     ,       ,<br>
     . <code>&amp;str</code> —   ,   —     <code>()</code>,        ,       (   <code>a</code>),      <br>
 <code>a</code>       ,     .</p><br>
<p>,      .     ,             Unicode:          <code>chars()</code>      .     <code>char</code>,   <code>Option</code>,   <code>None</code>  ,     <code>char</code>   .</p><br>
<p>  , <code>char</code>    ,         Unicode. ,  ,  ,  Unicode  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">"grapheme cluster"</a>,      <code>char</code>,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">"scalar values"</a>,       . ,     ,           <code>chars</code>  ASCII,      .</p><br>
<p>    <code>Some('a')</code>,    ,   ,    ,     :<br>
<code>Ok((&amp;input['a'.len_utf8()..], ()))</code>.     ,      (<code>'a'</code>)           ,    <br>
<code>()</code>.     Unicode,       UTF-8  <code>'a'</code>    —   1 (      Unicode).</p><br>
<p>     <code>Some(char)</code>,     <code>None</code>,   .         ,      <code>input</code>     .     <code>a</code>,     .    , ,   ,   ,   "- -  ".</p><br>
<p>          XML,  ,     ,     <code>&lt;</code>,     -  .      <code>&gt;</code>,<code>/</code>  <code>=</code> , ,  ,    ,     ,   ?</p><br>
<h3 id="sozdanie-parsera"> </h3><br>
<p>    :  ,       <em> </em>,     .   ,          UTF-8,        Unicode.</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">match_literal</span></span>(expected: &amp;<span class="hljs-symbol">'static</span> <span class="hljs-built_in">str</span>)<font></font>
    -&gt; <span class="hljs-keyword">impl</span> <span class="hljs-built_in">Fn</span>(&amp;<span class="hljs-built_in">str</span>) -&gt; <span class="hljs-built_in">Result</span>&lt;(&amp;<span class="hljs-built_in">str</span>, ()), &amp;<span class="hljs-built_in">str</span>&gt;<font></font>
{<font></font>
    <span class="hljs-keyword">move</span> |input| <span class="hljs-keyword">match</span> input.get(<span class="hljs-number">0</span>..expected.len()) {
        <span class="hljs-literal">Some</span>(next) <span class="hljs-keyword">if</span> next == expected =&gt; {
            <span class="hljs-literal">Ok</span>((&amp;input[expected.len()..], ()))<font></font>
        }<font></font>
        _ =&gt; <span class="hljs-literal">Err</span>(input),<font></font>
    }<font></font>
}</code></pre><br>
<p>    .</p><br>
<p> ,    .     <code>expected</code>      <em></em> -   ,  ,    .  ,    <em>  </em>.  ,   ,  <em></em> ,    <code>the_letter_a</code> .</p><br>
<p> ,      ,   ,              .</p><br>
<p>    ,   ,         ,     ,  ,      <code>if next == expected</code>.      ,   ,    .</p><br>
<h3 id="testirovanie-nashego-parsera">  </h3><br>
<p>    ,  ,    .</p><br>
<pre><code class="rust hljs"><span class="hljs-meta">#[test]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">literal_parser</span></span>() {
    <span class="hljs-keyword">let</span> parse_joe = match_literal(<span class="hljs-string">"Hello Joe!"</span>);
    <span class="hljs-built_in">assert_eq!</span>(
        <span class="hljs-literal">Ok</span>((<span class="hljs-string">""</span>, ())),<font></font>
        parse_joe(<span class="hljs-string">"Hello Joe!"</span>)<font></font>
    );<font></font>
    <span class="hljs-built_in">assert_eq!</span>(
        <span class="hljs-literal">Ok</span>((<span class="hljs-string">" Hello Robert!"</span>, ())),<font></font>
        parse_joe(<span class="hljs-string">"Hello Joe! Hello Robert!"</span>)<font></font>
    );<font></font>
    <span class="hljs-built_in">assert_eq!</span>(
        <span class="hljs-literal">Err</span>(<span class="hljs-string">"Hello Mike!"</span>),<font></font>
        parse_joe(<span class="hljs-string">"Hello Mike!"</span>)<font></font>
    );<font></font>
}</code></pre><br>
<p>   : <code>match_literal("Hello Joe!")</code>.     <code>"Hello Joe!"</code>    ,        .</p><br>
<p>         ,  ,  ,        <code>()</code>,   «   ,    ,   ".</p><br>
<p> ,    <code>"Hello Joe! Hello Robert!"</code>  ,      <code>"Hello Joe!"</code>     : <code>" Hello Robert!"</code> (    ).</p><br>
<p> ,    : <code>"Hello Mike!"</code>   ,       .  ,  <code>Mike</code>  ,     ,   .</p><br>
<h3 id="parser-dlya-chego-to-menee-specifichnogo">  -  </h3><br>
<p>      <code>&lt;</code>, <code>&gt;</code>, <code>=</code>   <code>&lt;/</code>  <code>/&gt;</code>.    !</p><br>
<p>    <code>&lt;</code> —   .          .   <em> </em>      ...</p><br>
<p>…   .    ,        ,         <code>regex</code>.  ,        ,     Rust.</p><br>
<p>     ,    :   ,          ,<br>
,    <code>-</code>.</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">identifier</span></span>(input: &amp;<span class="hljs-built_in">str</span>) -&gt; <span class="hljs-built_in">Result</span>&lt;(&amp;<span class="hljs-built_in">str</span>, <span class="hljs-built_in">String</span>), &amp;<span class="hljs-built_in">str</span>&gt; {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> matched = <span class="hljs-built_in">String</span>::new();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> chars = input.chars();<font></font>
<font></font>
    <span class="hljs-keyword">match</span> chars.next() {
        <span class="hljs-literal">Some</span>(next) <span class="hljs-keyword">if</span> next.is_alphabetic() =&gt; matched.push(next),<font></font>
        _ =&gt; <span class="hljs-keyword">return</span> <span class="hljs-literal">Err</span>(input),<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> <span class="hljs-literal">Some</span>(next) = chars.next() {
        <span class="hljs-keyword">if</span> next.is_alphanumeric() || next == <span class="hljs-string">'-'</span> {<font></font>
            matched.push(next);<font></font>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">let</span> next_index = matched.len();
    <span class="hljs-literal">Ok</span>((&amp;input[next_index..], matched))<font></font>
}</code></pre><br>
<p> ,     .          ,     ,    .     ,     <code>()</code>   <code>String</code>       .  <code>String</code>   ,     .</p><br>
<p>   ,     <code>String</code>    <code>matched</code>.    .        <code>input</code>,     .</p><br>
<p>  — ,     .        ,    : <code>next.is_alphabetic()</code>.   Rust,     Unicode —       ,     ASCII.   ,         <code>matched</code>,   ,           .</p><br>
<p>        ,         ,        <code>is_alphanumeric()</code> (   <code>is_alphabetic()</code>   ,        )   <code>'-'</code>.</p><br>
<p>      -,     ,    ,     <code>String</code>,     <code>input</code> ,   . ,     ,  ,     .</p><br>
<p> ,      ,   -  -  .     ,      ,      ,   ,             ,          .          ,      ,          .</p><br>
<p>,   <code>Element</code> —  ,       XML .</p><br>
<pre><code class="rust hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Element</span></span> {<font></font>
    name: <span class="hljs-built_in">String</span>,<font></font>
    attributes: <span class="hljs-built_in">Vec</span>&lt;(<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>)&gt;,<font></font>
    children: <span class="hljs-built_in">Vec</span>&lt;Element&gt;,<font></font>
}</code></pre><br>
<p>          ,  <code>name</code>. <code>String</code>,    ,   .         <code>attribute</code>.</p><br>
<p>  .</p><br>
<pre><code class="rust hljs"><span class="hljs-meta">#[test]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">identifier_parser</span></span>() {
    <span class="hljs-built_in">assert_eq!</span>(
        <span class="hljs-literal">Ok</span>((<span class="hljs-string">""</span>, <span class="hljs-string">"i-am-an-identifier"</span>.to_string())),<font></font>
        identifier(<span class="hljs-string">"i-am-an-identifier"</span>)<font></font>
    );<font></font>
    <span class="hljs-built_in">assert_eq!</span>(
        <span class="hljs-literal">Ok</span>((<span class="hljs-string">" entirely an identifier"</span>, <span class="hljs-string">"not"</span>.to_string())),<font></font>
        identifier(<span class="hljs-string">"not entirely an identifier"</span>)<font></font>
    );<font></font>
    <span class="hljs-built_in">assert_eq!</span>(
        <span class="hljs-literal">Err</span>(<span class="hljs-string">"!not at all an identifier"</span>),<font></font>
        identifier(<span class="hljs-string">"!not at all an identifier"</span>)<font></font>
    );<font></font>
}</code></pre><br>
<p> ,      <code>"i-am-an-identifier"</code>  ,    .       <code>"not"</code>   ,         .        ,    ,   ,  .</p><br>
<h3 id="kombinatory"></h3><br>
<p>      <code>&lt;</code>,      ,     <em></em>.          ,  ,    <em> </em>        <em> </em>,      .  , <em></em> ,        . ,     .</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">pair</span></span>&lt;P1, P2, R1, R2&gt;(parser1: P1, parser2: P2) -&gt; <span class="hljs-keyword">impl</span> <span class="hljs-built_in">Fn</span>(&amp;<span class="hljs-built_in">str</span>) -&gt; <span class="hljs-built_in">Result</span>&lt;(&amp;<span class="hljs-built_in">str</span>, (R1, R2)), &amp;<span class="hljs-built_in">str</span>&gt;
<span class="hljs-keyword">where</span>
    P1: <span class="hljs-built_in">Fn</span>(&amp;<span class="hljs-built_in">str</span>) -&gt; <span class="hljs-built_in">Result</span>&lt;(&amp;<span class="hljs-built_in">str</span>, R1), &amp;<span class="hljs-built_in">str</span>&gt;,<font></font>
    P2: <span class="hljs-built_in">Fn</span>(&amp;<span class="hljs-built_in">str</span>) -&gt; <span class="hljs-built_in">Result</span>&lt;(&amp;<span class="hljs-built_in">str</span>, R2), &amp;<span class="hljs-built_in">str</span>&gt;,<font></font>
{<font></font>
    <span class="hljs-keyword">move</span> |input| <span class="hljs-keyword">match</span> parser1(input) {
        <span class="hljs-literal">Ok</span>((next_input, result1)) =&gt; <span class="hljs-keyword">match</span> parser2(next_input) {
            <span class="hljs-literal">Ok</span>((final_input, result2)) =&gt; <span class="hljs-literal">Ok</span>((final_input, (result1, result2))),
            <span class="hljs-literal">Err</span>(err) =&gt; <span class="hljs-literal">Err</span>(err),<font></font>
        },<font></font>
        <span class="hljs-literal">Err</span>(err) =&gt; <span class="hljs-literal">Err</span>(err),<font></font>
    }<font></font>
}</code></pre><br>
<p>   ,   ,  :    .</p><br>
<p> ,      : <code>P1</code>, <code>P2</code>, <code>R1</code>  <code>R2</code>.  <code>Parser 1</code>, <code>Parser 2</code>, <code>Result 1</code>  <code>Result 2</code>. <code>P1</code>  <code>P2</code>  ,   ,         :  ,    ,   <code>&amp;str</code>       <code>Result</code>      ,  .</p><br>
<p>      : <code>P1</code> —   ,   <code>R1</code>   ,  <code>P2</code>   <code>R2</code>.     ,      ,  <code>(R1, R2)</code>.  ,       ,     <code>P1</code>  ,   ,   <code>P2</code>  ,   <code>P1</code>,      ,       <code>(R1, R2)</code>.</p><br>
<p>  ,    ,   .        ,   ,         .  -     ,     ,   .</p><br>
<p> ,        , <code>match_literal</code>  <code>identifier</code>,         XML.   ,  ,   .</p><br>
<pre><code class="rust hljs"><span class="hljs-meta">#[test]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">pair_combinator</span></span>() {
    <span class="hljs-keyword">let</span> tag_opener = pair(match_literal(<span class="hljs-string">"&lt;"</span>), identifier);
    <span class="hljs-built_in">assert_eq!</span>(
        <span class="hljs-literal">Ok</span>((<span class="hljs-string">"/&gt;"</span>, ((), <span class="hljs-string">"my-first-element"</span>.to_string()))),<font></font>
        tag_opener(<span class="hljs-string">"&lt;my-first-element/&gt;"</span>)<font></font>
    );<font></font>
    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-literal">Err</span>(<span class="hljs-string">"oops"</span>), tag_opener(<span class="hljs-string">"oops"</span>));
    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-literal">Err</span>(<span class="hljs-string">"!oops"</span>), tag_opener(<span class="hljs-string">"&lt;!oops"</span>));<font></font>
}</code></pre><br>
<p>, !      : <code>((), String)</code>. ,      , <code>String</code>.       —           ,   ,        .     ,      <code>pair</code>     : <code>left</code>,          ,    <code>right</code>.       ,         <code>String</code>,  <code>pair</code>.</p><br>
<h3 id="vvedenie-v-funktor">  </h3><br>
<p>      ,     ,      : <code>map</code>.</p><br>
<p>    :   . , ,    ,   <code>((), String)</code>     ,      <code>String</code>.</p><br>
<p>     ,  ,      .     : <code>|(_left, right)| right</code>.  ,     <code>Fn(A) -&gt; B</code>  <code>A</code> —    ,  <code>B</code> — .</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">map</span></span>&lt;P, F, A, B&gt;(parser: P, map_fn: F) -&gt; <span class="hljs-keyword">impl</span> <span class="hljs-built_in">Fn</span>(&amp;<span class="hljs-built_in">str</span>) -&gt; <span class="hljs-built_in">Result</span>&lt;(&amp;<span class="hljs-built_in">str</span>, B), &amp;<span class="hljs-built_in">str</span>&gt;
<span class="hljs-keyword">where</span>
    P: <span class="hljs-built_in">Fn</span>(&amp;<span class="hljs-built_in">str</span>) -&gt; <span class="hljs-built_in">Result</span>&lt;(&amp;<span class="hljs-built_in">str</span>, A), &amp;<span class="hljs-built_in">str</span>&gt;,<font></font>
    F: <span class="hljs-built_in">Fn</span>(A) -&gt; B,<font></font>
{<font></font>
    <span class="hljs-keyword">move</span> |input| <span class="hljs-keyword">match</span> parser(input) {
        <span class="hljs-literal">Ok</span>((next_input, result)) =&gt; <span class="hljs-literal">Ok</span>((next_input, map_fn(result))),
        <span class="hljs-literal">Err</span>(err) =&gt; <span class="hljs-literal">Err</span>(err),<font></font>
    }<font></font>
}</code></pre><br>
<p>   ? <code>P</code> —  .  <code>A</code>  . <code>F</code> —  ,       <code>P</code>    ,    ,  <code>P</code>   ,     — <code>B</code>  <code>A</code></p><br>
<p>    <code>parser(input)</code> ,   ,   <code>result</code>       <code>map_fn(result)</code>,  <code>A</code>  <code>B</code>,     .</p><br>
<p>  ,        ,    <code>map</code>   ,    <code>Result</code> :</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">map</span></span>&lt;P, F, A, B&gt;(parser: P, map_fn: F) -&gt; <span class="hljs-keyword">impl</span> <span class="hljs-built_in">Fn</span>(&amp;<span class="hljs-built_in">str</span>) -&gt; <span class="hljs-built_in">Result</span>&lt;(&amp;<span class="hljs-built_in">str</span>, B), &amp;<span class="hljs-built_in">str</span>&gt;
<span class="hljs-keyword">where</span>
    P: <span class="hljs-built_in">Fn</span>(&amp;<span class="hljs-built_in">str</span>) -&gt; <span class="hljs-built_in">Result</span>&lt;(&amp;<span class="hljs-built_in">str</span>, A), &amp;<span class="hljs-built_in">str</span>&gt;,<font></font>
    F: <span class="hljs-built_in">Fn</span>(A) -&gt; B,<font></font>
{<font></font>
    <span class="hljs-keyword">move</span> |input|<font></font>
        parser(input)<font></font>
            .map(|(next_input, result)| (next_input, map_fn(result)))<font></font>
}</code></pre><br>
<p>  — ,   «»  Haskell    ,  .        <code>A</code>,       <code>map</code>,      <code>A</code>  <code>B</code>       ,    <code>B</code>  ,  .        Rust,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>Option</code></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>Result</code></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>Iterator</code></a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>Future</code></a>,     .     :    -         Rust,         ,    ,    ,   ,       <code>map</code>.</p><br>
<h3 id="vremya-dlya-tipazha">  </h3><br>
<p>,   ,         : <code>Fn(&amp;str) -&gt; Result&lt;(&amp;str, Output), &amp;str&gt;</code>. ,    ,    ,  ,   ,   ,     ,              .</p><br>
<p>        ,    :</p><br>
<pre><code class="rust hljs"><span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">ParseResult</span></span>&lt;<span class="hljs-symbol">'a</span>, Output&gt; = <span class="hljs-built_in">Result</span>&lt;(&amp;<span class="hljs-symbol">'a</span> <span class="hljs-built_in">str</span>, Output), &amp;<span class="hljs-symbol">'a</span> <span class="hljs-built_in">str</span>&gt;;</code></pre><br>
<p>  ,  ,     ,     <code>ParseResult&lt;String&gt;</code>  .     ,      ,      Rust       .      ,   <code>rustc</code>,     ,   .</p><br>
<p>  <code>'a</code>,   ,      <em> </em>.</p><br>
<p> .       ,       ,      .    ,     .</p><br>
<pre><code class="rust hljs"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Parser</span></span>&lt;<span class="hljs-symbol">'a</span>, Output&gt; {
    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">parse</span></span>(&amp;<span class="hljs-keyword">self</span>, input: &amp;<span class="hljs-symbol">'a</span> <span class="hljs-built_in">str</span>) -&gt; ParseResult&lt;<span class="hljs-symbol">'a</span>, Output&gt;;<font></font>
}</code></pre><br>
<p>        :  <code>parse()</code>,    :   ,   ,   .</p><br>
<p>    ,        ,    :</p><br>
<pre><code class="rust hljs"><span class="hljs-keyword">impl</span>&lt;<span class="hljs-symbol">'a</span>, F, Output&gt; Parser&lt;<span class="hljs-symbol">'a</span>, Output&gt; <span class="hljs-keyword">for</span> F
<span class="hljs-keyword">where</span>
    F: <span class="hljs-built_in">Fn</span>(&amp;<span class="hljs-symbol">'a</span> <span class="hljs-built_in">str</span>) -&gt; ParseResult&lt;Output&gt;,<font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">parse</span></span>(&amp;<span class="hljs-keyword">self</span>, input: &amp;<span class="hljs-symbol">'a</span> <span class="hljs-built_in">str</span>) -&gt; ParseResult&lt;<span class="hljs-symbol">'a</span>, Output&gt; {
        <span class="hljs-keyword">self</span>(input)<font></font>
    }<font></font>
}</code></pre><br>
<p> ,        ,   ,      <code>Parser</code>,          .</p><br>
<p>,   ,          .    <code>map</code>  ,   .</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">map</span></span>&lt;<span class="hljs-symbol">'a</span>, P, F, A, B&gt;(parser: P, map_fn: F) -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, B&gt;
<span class="hljs-keyword">where</span>
    P: Parser&lt;<span class="hljs-symbol">'a</span>, A&gt;,<font></font>
    F: <span class="hljs-built_in">Fn</span>(A) -&gt; B,<font></font>
{<font></font>
    <span class="hljs-keyword">move</span> |input|<font></font>
        parser.parse(input)<font></font>
            .map(|(next_input, result)| (next_input, map_fn(result)))<font></font>
}</code></pre><br>
<p>     :       ,      <code>parser.parse(input)</code>,     ,    <code>P</code> ,   ,    <code>Parser</code>,      ,   <code>Parser</code>.         ,     .      <code>'a'</code>,    ,       .</p><br>
<p>    <code>pair</code>   ,     :</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">pair</span></span>&lt;<span class="hljs-symbol">'a</span>, P1, P2, R1, R2&gt;(parser1: P1, parser2: P2) -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, (R1, R2)&gt;
<span class="hljs-keyword">where</span>
    P1: Parser&lt;<span class="hljs-symbol">'a</span>, R1&gt;,<font></font>
    P2: Parser&lt;<span class="hljs-symbol">'a</span>, R2&gt;,<font></font>
{<font></font>
    <span class="hljs-keyword">move</span> |input| <span class="hljs-keyword">match</span> parser1.parse(input) {
        <span class="hljs-literal">Ok</span>((next_input, result1)) =&gt; <span class="hljs-keyword">match</span> parser2.parse(next_input) {
            <span class="hljs-literal">Ok</span>((final_input, result2)) =&gt; <span class="hljs-literal">Ok</span>((final_input, (result1, result2))),
            <span class="hljs-literal">Err</span>(err) =&gt; <span class="hljs-literal">Err</span>(err),<font></font>
        },<font></font>
        <span class="hljs-literal">Err</span>(err) =&gt; <span class="hljs-literal">Err</span>(err),<font></font>
    }<font></font>
}</code></pre><br>
<p>    :            <code>parser.parse(input)</code>  <code>parser(input)</code>.</p><br>
<p>  ,       <code>pair</code>,       <code>map</code>.</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">pair</span></span>&lt;<span class="hljs-symbol">'a</span>, P1, P2, R1, R2&gt;(parser1: P1, parser2: P2) -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, (R1, R2)&gt;
<span class="hljs-keyword">where</span>
    P1: Parser&lt;<span class="hljs-symbol">'a</span>, R1&gt;,<font></font>
    P2: Parser&lt;<span class="hljs-symbol">'a</span>, R2&gt;,<font></font>
{<font></font>
    <span class="hljs-keyword">move</span> |input| {<font></font>
        parser1.parse(input).and_then(|(next_input, result1)| {<font></font>
            parser2.parse(next_input)<font></font>
                .map(|(last_input, result2)| (last_input, (result1, result2)))<font></font>
        })<font></font>
    }<font></font>
}</code></pre><br>
<p> <code>and_then</code>  <code>Result</code>   <code>map</code>,   ,        <code>Result</code>,    <code>Result</code>.             <code>match</code> .  <code>and_then</code>   ,  ,        <code>map</code>,    <code>left</code>  <code>right</code>.</p><br>
<h3 id="left-i-right">Left  Right</h3><br>
<p> <code>pair</code>  <code>map</code>  ,    <code>left</code>  <code>right</code>  :</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">left</span></span>&lt;<span class="hljs-symbol">'a</span>, P1, P2, R1, R2&gt;(parser1: P1, parser2: P2) -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, R1&gt;
<span class="hljs-keyword">where</span>
    P1: Parser&lt;<span class="hljs-symbol">'a</span>, R1&gt;,<font></font>
    P2: Parser&lt;<span class="hljs-symbol">'a</span>, R2&gt;,<font></font>
{<font></font>
    map(pair(parser1, parser2), |(left, _right)| left)<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">right</span></span>&lt;<span class="hljs-symbol">'a</span>, P1, P2, R1, R2&gt;(parser1: P1, parser2: P2) -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, R2&gt;
<span class="hljs-keyword">where</span>
    P1: Parser&lt;<span class="hljs-symbol">'a</span>, R1&gt;,<font></font>
    P2: Parser&lt;<span class="hljs-symbol">'a</span>, R2&gt;,<font></font>
{<font></font>
    map(pair(parser1, parser2), |(_left, right)| right)<font></font>
}<font></font>
</code></pre><br>
<p>   <code>pair</code>,          ,      <code>map</code>      ,    .</p><br>
<p>         ,     ,            .</p><br>
<p>     ,    <code>Parser</code>  <code>ParseResult</code>. <code>match_literal</code>   :</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">match_literal</span></span>&lt;<span class="hljs-symbol">'a</span>&gt;(expected: &amp;<span class="hljs-symbol">'static</span> <span class="hljs-built_in">str</span>) -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, ()&gt; {
    <span class="hljs-keyword">move</span> |input: &amp;<span class="hljs-symbol">'a</span> <span class="hljs-built_in">str</span>| <span class="hljs-keyword">match</span> input.get(<span class="hljs-number">0</span>..expected.len()) {
        <span class="hljs-literal">Some</span>(next) <span class="hljs-keyword">if</span> next == expected =&gt; <span class="hljs-literal">Ok</span>((&amp;input[expected.len()..], ())),<font></font>
        _ =&gt; <span class="hljs-literal">Err</span>(input),<font></font>
    }<font></font>
}</code></pre><br>
<p>      ,    ,       — <code>&amp;'a str</code>,  <code>rustc</code> .</p><br>
<p> <code>identifier</code>,     ,   ,      :</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">identifier</span></span>(input: &amp;<span class="hljs-built_in">str</span>) -&gt; ParseResult&lt;<span class="hljs-built_in">String</span>&gt; {</code></pre><br>
<p>  . <code>()</code>   .    .</p><br>
<pre><code class="rust hljs"><span class="hljs-meta">#[test]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">right_combinator</span></span>() {
    <span class="hljs-keyword">let</span> tag_opener = right(match_literal(<span class="hljs-string">"&lt;"</span>), identifier);
    <span class="hljs-built_in">assert_eq!</span>(
        <span class="hljs-literal">Ok</span>((<span class="hljs-string">"/&gt;"</span>, <span class="hljs-string">"my-first-element"</span>.to_string())),<font></font>
        tag_opener.parse(<span class="hljs-string">"&lt;my-first-element/&gt;"</span>)<font></font>
    );<font></font>
    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-literal">Err</span>(<span class="hljs-string">"oops"</span>), tag_opener.parse(<span class="hljs-string">"oops"</span>));
    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-literal">Err</span>(<span class="hljs-string">"!oops"</span>), tag_opener.parse(<span class="hljs-string">"&lt;!oops"</span>));<font></font>
}</code></pre><br>
<h3 id="odin-ili-bolshe">  </h3><br>
<p>     .      <code>&lt;</code>     .  ?       .</p><br>
<p>,   ,     .       ,    .</p><br>
<p>, ,         - , <em> </em>       : .</p><br>
<p>         (  )  .      .</p><br>
<p>   —      <em>   </em>,   <code>&lt;element attribute="value"/&gt;</code>   ,      .       ,     ,   <em>  </em>  .</p><br>
<p>         <code>identifier</code>,      .  ,          .</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">one_or_more</span></span>&lt;<span class="hljs-symbol">'a</span>, P, A&gt;(parser: P) -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, <span class="hljs-built_in">Vec</span>&lt;A&gt;&gt;
<span class="hljs-keyword">where</span>
    P: Parser&lt;<span class="hljs-symbol">'a</span>, A&gt;,<font></font>
{<font></font>
    <span class="hljs-keyword">move</span> |<span class="hljs-keyword">mut</span> input| {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> result = <span class="hljs-built_in">Vec</span>::new();<font></font>
<font></font>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-literal">Ok</span>((next_input, first_item)) = parser.parse(input) {<font></font>
            input = next_input;<font></font>
            result.push(first_item);<font></font>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">Err</span>(input);<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> <span class="hljs-literal">Ok</span>((next_input, next_item)) = parser.parse(input) {<font></font>
            input = next_input;<font></font>
            result.push(next_item);<font></font>
        }<font></font>
<font></font>
        <span class="hljs-literal">Ok</span>((input, result))<font></font>
    }<font></font>
}</code></pre><br>
<p> ,    ,    ,  <code>A</code>,        <code>Vec&lt;A&gt;</code> —   <code>A</code>.</p><br>
<p>     <code>identifier</code>.     ,     ,    .       ,      ,           .</p><br>
<p>   ,  :         <em></em>  ?       :</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">zero_or_more</span></span>&lt;<span class="hljs-symbol">'a</span>, P, A&gt;(parser: P) -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, <span class="hljs-built_in">Vec</span>&lt;A&gt;&gt;
<span class="hljs-keyword">where</span>
    P: Parser&lt;<span class="hljs-symbol">'a</span>, A&gt;,<font></font>
{<font></font>
    <span class="hljs-keyword">move</span> |<span class="hljs-keyword">mut</span> input| {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> result = <span class="hljs-built_in">Vec</span>::new();<font></font>
<font></font>
        <span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> <span class="hljs-literal">Ok</span>((next_input, next_item)) = parser.parse(input) {<font></font>
            input = next_input;<font></font>
            result.push(next_item);<font></font>
        }<font></font>
<font></font>
        <span class="hljs-literal">Ok</span>((input, result))<font></font>
    }<font></font>
}</code></pre><br>
<p>   ,  ,     .</p><br>
<pre><code class="rust hljs"><span class="hljs-meta">#[test]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">one_or_more_combinator</span></span>() {
    <span class="hljs-keyword">let</span> parser = one_or_more(match_literal(<span class="hljs-string">"ha"</span>));
    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-literal">Ok</span>((<span class="hljs-string">""</span>, <span class="hljs-built_in">vec!</span>[(), (), ()])), parser.parse(<span class="hljs-string">"hahaha"</span>));
    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-literal">Err</span>(<span class="hljs-string">"ahah"</span>), parser.parse(<span class="hljs-string">"ahah"</span>));
    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-literal">Err</span>(<span class="hljs-string">""</span>), parser.parse(<span class="hljs-string">""</span>));<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">#[test]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">zero_or_more_combinator</span></span>() {
    <span class="hljs-keyword">let</span> parser = zero_or_more(match_literal(<span class="hljs-string">"ha"</span>));
    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-literal">Ok</span>((<span class="hljs-string">""</span>, <span class="hljs-built_in">vec!</span>[(), (), ()])), parser.parse(<span class="hljs-string">"hahaha"</span>));
    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-literal">Ok</span>((<span class="hljs-string">"ahah"</span>, <span class="hljs-built_in">vec!</span>[])), parser.parse(<span class="hljs-string">"ahah"</span>));
    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-literal">Ok</span>((<span class="hljs-string">""</span>, <span class="hljs-built_in">vec!</span>[])), parser.parse(<span class="hljs-string">""</span>));<font></font>
}</code></pre><br>
<p>     :  <code>one_or_more</code>     ,             ,   <code>zero_or_more</code>      ,    .</p><br>
<p>           ,       ,     .     <code>one_or_more</code>   <code>zero_or_more</code>, -  :</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">one_or_more</span></span>&lt;<span class="hljs-symbol">'a</span>, P, A&gt;(parser: P) -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, <span class="hljs-built_in">Vec</span>&lt;A&gt;&gt;
<span class="hljs-keyword">where</span>
    P: Parser&lt;<span class="hljs-symbol">'a</span>, A&gt;,<font></font>
{<font></font>
    map(pair(parser, zero_or_more(parser)), |(head, <span class="hljs-keyword">mut</span> tail)| {<font></font>
        tail.insert(<span class="hljs-number">0</span>, head);<font></font>
        tail<font></font>
    })<font></font>
}</code></pre><br>
<p>     Rust,           <code>cons</code>  <code>Vec</code>,   ,     Lisp,    ,   . ,   :  .</p><br>
<p>   ,          :    ,       .  :                (       ).       ,      ,   <code>Clone</code>,      ,     ,          .</p><br>
<p>   <em></em> .  ,      <code>one_or_more</code>   ,  ,       ,      ,        ,     -  ,    ,   <code>RangeBound</code>            : <code>range(0..)</code>  <code>zero_or_more</code>, <code>range(1..)</code>  <code>one_or_more</code>, <code>range(5..=6)</code>     ,    .</p><br>
<p>      .           <code>zero_or_more</code>  <code>one_or_more</code>.</p><br>
<p>     ,        —  ,    <code>Rc</code>    ?</p><br>
<h3 id="predikatnyy-kombinator"> </h3><br>
<p>     ,         <code>one_or_more</code>      <code>zero_or_more</code>.</p><br>
<p>  ,  .     ,  <em></em>  .     ,    ,     ,       <code>&gt;</code>  <code>/&gt;</code>.    ,  <em></em>  .    ,   ,       ,        <em>  </em>  <em>  </em> ,    .</p><br>
<p>      .       .</p><br>
<p>-.         <code>match_literal</code>  ,    .   ?   -    ,       Unicode,    .        Rust,  ,  <code>char</code>   <code>is_whitespace</code>,    <code>is_alphabetic</code>  <code>is_alphanumeric</code>.</p><br>
<p>-.     ,      ,   <code>is_whitespace</code> ,     <code>identifier</code> .</p><br>
<p>-.    ,     .      <code>any_char</code>,    <code>char</code>   ,      ,   <code>pred</code>,       ,    : <code>pred(any_char, |c| c.is_whitespace())</code>.    ,      ,    :      .</p><br>
<p> <code>any_char</code> ,   ,       UTF-8.</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">any_char</span></span>(input: &amp;<span class="hljs-built_in">str</span>) -&gt; ParseResult&lt;<span class="hljs-built_in">char</span>&gt; {
    <span class="hljs-keyword">match</span> input.chars().next() {
        <span class="hljs-literal">Some</span>(next) =&gt; <span class="hljs-literal">Ok</span>((&amp;input[next.len_utf8()..], next)),<font></font>
        _ =&gt; <span class="hljs-literal">Err</span>(input),<font></font>
    }<font></font>
}</code></pre><br>
<p>  <code>pred</code>     ,   , .    ,       .     ,      <code>true</code>,    .       ,    .</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">pred</span></span>&lt;<span class="hljs-symbol">'a</span>, P, A, F&gt;(parser: P, predicate: F) -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, A&gt;
<span class="hljs-keyword">where</span>
    P: Parser&lt;<span class="hljs-symbol">'a</span>, A&gt;,<font></font>
    F: <span class="hljs-built_in">Fn</span>(&amp;A) -&gt; <span class="hljs-built_in">bool</span>,<font></font>
{<font></font>
    <span class="hljs-keyword">move</span> |input| {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-literal">Ok</span>((next_input, value)) = parser.parse(input) {
            <span class="hljs-keyword">if</span> predicate(&amp;value) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">Ok</span>((next_input, value));<font></font>
            }<font></font>
        }<font></font>
        <span class="hljs-literal">Err</span>(input)<font></font>
    }<font></font>
}</code></pre><br>
<p>  ,  ,    :</p><br>
<pre><code class="rust hljs"><span class="hljs-meta">#[test]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">predicate_combinator</span></span>() {
    <span class="hljs-keyword">let</span> parser = pred(any_char, |c| *c == <span class="hljs-string">'o'</span>);
    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-literal">Ok</span>((<span class="hljs-string">"mg"</span>, <span class="hljs-string">'o'</span>)), parser.parse(<span class="hljs-string">"omg"</span>));
    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-literal">Err</span>(<span class="hljs-string">"lol"</span>), parser.parse(<span class="hljs-string">"lol"</span>));<font></font>
}</code></pre><br>
<p>    ,     <code>whitespace_char</code>    :</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">whitespace_char</span></span>&lt;<span class="hljs-symbol">'a</span>&gt;() -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, <span class="hljs-built_in">char</span>&gt; {<font></font>
    pred(any_char, |c| c.is_whitespace())<font></font>
}</code></pre><br>
<p> ,     <code>whitespace_char</code>,     ,    , <em>   </em>,    , <em>   </em>.        <code>space1</code>  <code>space0</code> .</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">space1</span></span>&lt;<span class="hljs-symbol">'a</span>&gt;() -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">char</span>&gt;&gt; {<font></font>
    one_or_more(whitespace_char())<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">space0</span></span>&lt;<span class="hljs-symbol">'a</span>&gt;() -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">char</span>&gt;&gt; {<font></font>
    zero_or_more(whitespace_char())<font></font>
}</code></pre><br>
<h3 id="citiruemye-stroki"> </h3><br>
<p>         ? ,    ,          .     <code>identifier</code>    (  ,      <code>any_char</code>  <code>pred</code>   <code>*_or_more</code> ). <code>match_literal("=")</code>   <code>=</code>.         ,     .  ,      ,     .</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">quoted_string</span></span>&lt;<span class="hljs-symbol">'a</span>&gt;() -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, <span class="hljs-built_in">String</span>&gt; {<font></font>
    map(<font></font>
        right(<font></font>
            match_literal(<span class="hljs-string">"\""</span>),<font></font>
            left(<font></font>
                zero_or_more(pred(any_char, |c| *c != <span class="hljs-string">'"'</span>)),<font></font>
                match_literal(<span class="hljs-string">"\""</span>),<font></font>
            ),<font></font>
        ),<font></font>
        |chars| chars.into_iter().collect(),<font></font>
    )<font></font>
}</code></pre><br>
<p>      ,     ,    ,      ,   .</p><br>
<p>    <code>map</code> -   ,    ,    ,     ,    ,    :   .  <code>map</code>  <code>right</code>,    <code>right</code> —  ,   : <code>match_literal("\"")</code>.     .</p><br>
<p>   <code>right</code> —   .      <code>left</code>,    ,  <em></em>   <code>left</code>, ,   ,   <code>match_literal("\"")</code> —  .  ,   —    .</p><br>
<p>    <code>pred</code>  <code>any_char</code>,   ,    <em>   </em>,      <code>zero_or_more</code>,   :</p><br>
<ul>
<li> </li>
<li>      ,  <em></em>   </li>
<li>  </li>
</ul><br>
<p>  <code>right</code>  <code>left</code>          .</p><br>
<p> ,   . ,   <code>zero_or_more</code>? <code>Vec&lt;A&gt;</code>      <code>A</code>.  <code>any_char</code>  <code>char</code>.  ,    ,  <code>Vec&lt;char&gt;</code>.     <code>map</code>:   ,   <code>Vec&lt;char&gt;</code>  <code>String</code>,   ,     <code>String</code>  <code>Iterator&lt;Item = char&gt;</code>,      <code>vec_of_chars.into_iter().collect()</code>     ,    <code>String</code>.</p><br>
<p>    ,  ,    ,    ,  ,     ,   ,  ,            .</p><br>
<pre><code class="rust hljs"><span class="hljs-meta">#[test]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">quoted_string_parser</span></span>() {
    <span class="hljs-built_in">assert_eq!</span>(
        <span class="hljs-literal">Ok</span>((<span class="hljs-string">""</span>, <span class="hljs-string">"Hello Joe!"</span>.to_string())),<font></font>
        quoted_string().parse(<span class="hljs-string">"\"Hello Joe!\""</span>)<font></font>
    );<font></font>
}</code></pre><br>
<p>, , ,  ,    .</p><br>
<h3 id="nakonec-atributy-razbora">,  </h3><br>
<p>    , ,  <code>=</code>    .   ,      .</p><br>
<p>     .   ,      <code>Vec&lt;(String, String)&gt;</code>,      <code>(String, String)</code>,       <code>zero_or_more</code> . ,     .</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">attribute_pair</span></span>&lt;<span class="hljs-symbol">'a</span>&gt;() -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, (<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>)&gt; {<font></font>
    pair(identifier, right(match_literal(<span class="hljs-string">"="</span>), quoted_string()))<font></font>
}</code></pre><br>
<p>  !  :           <code>pair</code>,       <code>identifier</code>,    <code>String</code>,  <code>right</code>   <code>=</code>,      ,    <code>quoted_string</code> ,     <code>String</code>.</p><br>
<p>     <code>zero_or_more</code>,   ,        .</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">attributes</span></span>&lt;<span class="hljs-symbol">'a</span>&gt;() -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, <span class="hljs-built_in">Vec</span>&lt;(<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>)&gt;&gt; {<font></font>
    zero_or_more(right(space1(), attribute_pair()))<font></font>
}</code></pre><br>
<p>   :     ,<br>
  .   <code>right</code>       .</p><br>
<p>  .</p><br>
<pre><code class="rust hljs"><span class="hljs-meta">#[test]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">attribute_parser</span></span>() {
    <span class="hljs-built_in">assert_eq!</span>(
        <span class="hljs-literal">Ok</span>((
            <span class="hljs-string">""</span>,
            <span class="hljs-built_in">vec!</span>[<font></font>
                (<span class="hljs-string">"one"</span>.to_string(), <span class="hljs-string">"1"</span>.to_string()),<font></font>
                (<span class="hljs-string">"two"</span>.to_string(), <span class="hljs-string">"2"</span>.to_string())<font></font>
            ]<font></font>
        )),<font></font>
        attributes().parse(<span class="hljs-string">" one=\"1\" two=\"2\""</span>)<font></font>
    );<font></font>
}</code></pre><br>
<p> !  !</p><br>
<p>  , ,      rustc ,      ,          .  ,              .  ,    rustc,  ,   ,    <code>#![type_length_limit = "…some big number…"]</code>   ,      .   ,    <code>#![type_length_limit = "16777216"]</code>,          . ,   !</p><br>
<h3 id="tak-teper-zavershenie">  </h3><br>
<p>  , ,      ,    ,        NP-.        element:        ,   ,    ,        <code>zero_or_more</code>, ?</p><br>
<p>,     ,     . ,   ,      ,    :   <code>&lt;</code>,    .  ,       <code>(String, Vec&lt;(String, String)&gt;)</code>   .</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">element_start</span></span>&lt;<span class="hljs-symbol">'a</span>&gt;() -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, (<span class="hljs-built_in">String</span>, <span class="hljs-built_in">Vec</span>&lt;(<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>)&gt;)&gt; {<font></font>
    right(match_literal(<span class="hljs-string">"&lt;"</span>), pair(identifier, attributes()))<font></font>
}</code></pre><br>
<p>   ,        ,       .</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">single_element</span></span>&lt;<span class="hljs-symbol">'a</span>&gt;() -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, Element&gt; {<font></font>
    map(<font></font>
        left(element_start(), match_literal(<span class="hljs-string">"/&gt;"</span>)),<font></font>
        |(name, attributes)| Element {<font></font>
            name,<font></font>
            attributes,<font></font>
            children: <span class="hljs-built_in">vec!</span>[],<font></font>
        },<font></font>
    )<font></font>
}</code></pre><br>
<p>,  ,      —     <code>Element</code>!</p><br>
<p>     .</p><br>
<pre><code class="rust hljs"><span class="hljs-meta">#[test]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">single_element_parser</span></span>() {
    <span class="hljs-built_in">assert_eq!</span>(
        <span class="hljs-literal">Ok</span>((
            <span class="hljs-string">""</span>,<font></font>
            Element {<font></font>
                name: <span class="hljs-string">"div"</span>.to_string(),<font></font>
                attributes: <span class="hljs-built_in">vec!</span>[(<span class="hljs-string">"class"</span>.to_string(), <span class="hljs-string">"float"</span>.to_string())],<font></font>
                children: <span class="hljs-built_in">vec!</span>[]<font></font>
            }<font></font>
        )),<font></font>
        single_element().parse(<span class="hljs-string">"&lt;div class=\"float\"/&gt;"</span>)<font></font>
    );<font></font>
}</code></pre><br>
<p>…   ,       .</p><br>
<p>   <code>single_element</code>  ,          ,    ,    . ,        ,       ,       — ,       —   .</p><br>
<p>  ,        ,      ...</p><br>
<h3 id="beskonechnost-ne-predel">  </h3><br>
<p>  -      Rust, , ,      .</p><br>
<p>       .  ,      :</p><br>
<pre><code class="rust hljs"><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">List</span></span>&lt;A&gt; {<font></font>
    Cons(A, List&lt;A&gt;),<font></font>
    Nil,<font></font>
}</code></pre><br>
<p>  rustc    ,     <code>List&lt;A&gt;</code>   ,     <code>List::&lt;A&gt;::Cons</code>    <code>List&lt;A&gt;</code>,      .   rustc,      ,   ,     <em></em>  .</p><br>
<p>            ,       Rust.    ,   Rust,   ,     <em></em>     ,     <em></em>  ,    .    ,      .</p><br>
<p>   ,    .  ,   <code>List::Cons</code>   <code>A</code>   <em></em> <code>A</code>,     <code>A</code>  <em></em>   <code>A</code>.    ,   ,   ,    ,    <code>List::Cons</code>      ,    .    ,           Rust —  <code>Box</code>.</p><br>
<pre><code class="rust hljs"><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">List</span></span>&lt;A&gt; {<font></font>
    Cons(A, <span class="hljs-built_in">Box</span>&lt;List&lt;A&gt;&gt;),<font></font>
    Nil,<font></font>
}</code></pre><br>
<p>    <code>Box</code>   ,       .  ,          ,            <code>Box&lt;dyn Parser&lt;'a, A&gt;&gt;</code>.</p><br>
<p>  .  ?  ,        -    ,    ,          .       :   .      .  ,      ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  SIMD</a> (     ).</p><br>
<p>,     <code>Parser</code>     <em>Box</em>     ,      .</p><br>
<pre><code class="rust hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">BoxedParser</span></span>&lt;<span class="hljs-symbol">'a</span>, Output&gt; {<font></font>
    parser: <span class="hljs-built_in">Box</span>&lt;<span class="hljs-keyword">dyn</span> Parser&lt;<span class="hljs-symbol">'a</span>, Output&gt; + <span class="hljs-symbol">'a</span>&gt;,<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">impl</span>&lt;<span class="hljs-symbol">'a</span>, Output&gt; BoxedParser&lt;<span class="hljs-symbol">'a</span>, Output&gt; {
    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">new</span></span>&lt;P&gt;(parser: P) -&gt; <span class="hljs-keyword">Self</span>
    <span class="hljs-keyword">where</span>
        P: Parser&lt;<span class="hljs-symbol">'a</span>, Output&gt; + <span class="hljs-symbol">'a</span>,<font></font>
    {<font></font>
        BoxedParser {<font></font>
            parser: <span class="hljs-built_in">Box</span>::new(parser),<font></font>
        }<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">impl</span>&lt;<span class="hljs-symbol">'a</span>, Output&gt; Parser&lt;<span class="hljs-symbol">'a</span>, Output&gt; <span class="hljs-keyword">for</span> BoxedParser&lt;<span class="hljs-symbol">'a</span>, Output&gt; {
    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">parse</span></span>(&amp;<span class="hljs-keyword">self</span>, input: &amp;<span class="hljs-symbol">'a</span> <span class="hljs-built_in">str</span>) -&gt; ParseResult&lt;<span class="hljs-symbol">'a</span>, Output&gt; {
        <span class="hljs-keyword">self</span>.parser.parse(input)<font></font>
    }<font></font>
}</code></pre><br>
<p>,  ,    <code>BoxedParser</code>    <code>box</code>.    <code>BoxedParser</code>       (  <code>BoxedParser</code>,      ),    <code>BoxedParser::new(parser)</code>,    ,      <code>Box</code>    . ,   <code>Parser</code>  ,         .</p><br>
<p>         <code>Box</code>,  <code>BoxedParser</code>    <code>Parser</code>  ,   . ,   ,  ,           ,    ,     <em>  </em>,  , ,   <em> </em> .        .</p><br>
<h3 id="vozmozhnost-predstavlyaet-sebya">  </h3><br>
<p>,  ,       ,     .</p><br>
<p>   ,   ?      ,       ,       .    <code>quoted_string</code>:</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">quoted_string</span></span>&lt;<span class="hljs-symbol">'a</span>&gt;() -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, <span class="hljs-built_in">String</span>&gt; {<font></font>
    map(<font></font>
        right(<font></font>
            match_literal(<span class="hljs-string">"\""</span>),<font></font>
            left(<font></font>
                zero_or_more(pred(any_char, |c| *c != <span class="hljs-string">'"'</span>)),<font></font>
                match_literal(<span class="hljs-string">"\""</span>),<font></font>
            ),<font></font>
        ),<font></font>
        |chars| chars.into_iter().collect(),<font></font>
    )<font></font>
}</code></pre><br>
<p>    ,             .             <code>Parser</code>?</p><br>
<p>  ,     ,     <code>impl Trait</code>     ,   <code>impl Trait</code>     .</p><br>
<p>…      <code>BoxedParser</code>.       ,   <code>impl Parser&lt;'a, A&gt;</code>,    <em></em>  ,   <code>BoxedParser&lt;'a, A&gt;</code>.</p><br>
<p>  ,          ,           ,   <code>Parser</code>.</p><br>
<p>    <code>map</code>,    <code>Parser</code>  :</p><br>
<pre><code class="rust hljs"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Parser</span></span>&lt;<span class="hljs-symbol">'a</span>, Output&gt; {
    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">parse</span></span>(&amp;<span class="hljs-keyword">self</span>, input: &amp;<span class="hljs-symbol">'a</span> <span class="hljs-built_in">str</span>) -&gt; ParseResult&lt;<span class="hljs-symbol">'a</span>, Output&gt;;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">map</span></span>&lt;F, NewOutput&gt;(<span class="hljs-keyword">self</span>, map_fn: F) -&gt; BoxedParser&lt;<span class="hljs-symbol">'a</span>, NewOutput&gt;
    <span class="hljs-keyword">where</span>
        <span class="hljs-keyword">Self</span>: <span class="hljs-built_in">Sized</span> + <span class="hljs-symbol">'a</span>,<font></font>
        Output: <span class="hljs-symbol">'a</span>,<font></font>
        NewOutput: <span class="hljs-symbol">'a</span>,<font></font>
        F: <span class="hljs-built_in">Fn</span>(Output) -&gt; NewOutput + <span class="hljs-symbol">'a</span>,<font></font>
    {<font></font>
        BoxedParser::new(map(<span class="hljs-keyword">self</span>, map_fn))<font></font>
    }<font></font>
}</code></pre><br>
<p>  <code>'a</code>, ,    .  ,            —     ,          ,       <code>impl Trait</code>.</p><br>
<p>      <code>quoted_string</code> :</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">quoted_string</span></span>&lt;<span class="hljs-symbol">'a</span>&gt;() -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, <span class="hljs-built_in">String</span>&gt; {<font></font>
    right(<font></font>
        match_literal(<span class="hljs-string">"\""</span>),<font></font>
        left(<font></font>
            zero_or_more(pred(any_char, |c| *c != <span class="hljs-string">'"'</span>)),<font></font>
            match_literal(<span class="hljs-string">"\""</span>),<font></font>
        ),<font></font>
    )<font></font>
    .map(|chars| chars.into_iter().collect())<font></font>
}</code></pre><br>
<p>  ,   ,  <code>.map()</code>    <code>right()</code>.</p><br>
<p>        <code>pair</code>, <code>left</code>  <code>right</code>,       ,    ,    ,        <code>pair</code>.    ,       ,     <code>map</code>,         .</p><br>
<p>   — <code>pred</code>.        <code>Parser</code>:</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">pred</span></span>&lt;F&gt;(<span class="hljs-keyword">self</span>, pred_fn: F) -&gt; BoxedParser&lt;<span class="hljs-symbol">'a</span>, Output&gt;
<span class="hljs-keyword">where</span>
    <span class="hljs-keyword">Self</span>: <span class="hljs-built_in">Sized</span> + <span class="hljs-symbol">'a</span>,<font></font>
    Output: <span class="hljs-symbol">'a</span>,<font></font>
    F: <span class="hljs-built_in">Fn</span>(&amp;Output) -&gt; <span class="hljs-built_in">bool</span> + <span class="hljs-symbol">'a</span>,<font></font>
{<font></font>
    BoxedParser::new(pred(<span class="hljs-keyword">self</span>, pred_fn))<font></font>
}</code></pre><br>
<p>      <code>quoted_string</code>   <code>pred</code>,   :</p><br>
<pre><code class="rust hljs">zero_or_more(any_char.pred(|c| *c != <span class="hljs-string">'"'</span>)),</code></pre><br>
<p> ,     ,   ,     <code>zero_or_more</code>   —    «    <code>any_char</code>    »,    .  ,        <code>zero_or_more</code>  <code>one_or_more</code>  .</p><br>
<p>    <code>quoted_string</code>,    <code>map</code>  <code>single_element</code>:</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">single_element</span></span>&lt;<span class="hljs-symbol">'a</span>&gt;() -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, Element&gt; {<font></font>
    left(element_start(), match_literal(<span class="hljs-string">"/&gt;"</span>)).map(|(name, attributes)| Element {<font></font>
        name,<font></font>
        attributes,<font></font>
        children: <span class="hljs-built_in">vec!</span>[],<font></font>
    })<font></font>
}</code></pre><br>
<p>     <code>element_start</code>  ,    ,  ,   .          ...</p><br>
<p>…  ,       .             ,     .</p><br>
<p>   <code>map</code>  <code>pred</code>  <code>Box</code> — <em></em>     !</p><br>
<h3 id="obrabotka-detey-elementa">  </h3><br>
<p>        .    <code>single_element</code>,   ,     <code>&gt;</code>,    <code>/&gt;</code>.            ,        ,     .</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">open_element</span></span>&lt;<span class="hljs-symbol">'a</span>&gt;() -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, Element&gt; {<font></font>
    left(element_start(), match_literal(<span class="hljs-string">"&gt;"</span>)).map(|(name, attributes)| Element {<font></font>
        name,<font></font>
        attributes,<font></font>
        children: <span class="hljs-built_in">vec!</span>[],<font></font>
    })<font></font>
}</code></pre><br>
<p>,     ?     ,    ,      ,         <code>zero_or_more</code>,     ?  ,      , —      : ,   <em></em>  , <em></em>  .</p><br>
<p>  ,   ,      :     ,  ,      .    ,  ,   ,     <em>   </em>.   , ,   ,    ,   ,        ,    .</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">either</span></span>&lt;<span class="hljs-symbol">'a</span>, P1, P2, A&gt;(parser1: P1, parser2: P2) -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, A&gt;
<span class="hljs-keyword">where</span>
    P1: Parser&lt;<span class="hljs-symbol">'a</span>, A&gt;,<font></font>
    P2: Parser&lt;<span class="hljs-symbol">'a</span>, A&gt;,<font></font>
{<font></font>
    <span class="hljs-keyword">move</span> |input| <span class="hljs-keyword">match</span> parser1.parse(input) {<font></font>
        ok @ <span class="hljs-literal">Ok</span>(_) =&gt; ok,
        <span class="hljs-literal">Err</span>(_) =&gt; parser2.parse(input),<font></font>
    }<font></font>
}</code></pre><br>
<p>      <code>element</code>,     ,    (     <code>open_element</code>   ,       <code>element</code>).</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">element</span></span>&lt;<span class="hljs-symbol">'a</span>&gt;() -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, Element&gt; {<font></font>
    either(single_element(), open_element())<font></font>
}</code></pre><br>
<p>      .         ,  ,    ,    .      , ?</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">close_element</span></span>&lt;<span class="hljs-symbol">'a</span>&gt;(expected_name: <span class="hljs-built_in">String</span>) -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, <span class="hljs-built_in">String</span>&gt; {<font></font>
    right(match_literal(<span class="hljs-string">"&lt;/"</span>), left(identifier, match_literal(<span class="hljs-string">"&gt;"</span>)))<font></font>
        .pred(<span class="hljs-keyword">move</span> |name| name == &amp;expected_name)<font></font>
}</code></pre><br>
<p>  <code>pred</code>   ,   ?</p><br>
<p>          ,   :</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">parent_element</span></span>&lt;<span class="hljs-symbol">'a</span>&gt;() -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, Element&gt; {<font></font>
    pair(<font></font>
        open_element(),<font></font>
        left(zero_or_more(element()), close_element(…oops)),<font></font>
    )<font></font>
}</code></pre><br>
<p>       <code>close_element</code> ?  ,      .</p><br>
<p>  .       ,   <code>parent_element</code> ,     <code>open_element</code>   <code>element</code>   <code>parent_element</code>,  ,       XML.</p><br>
<p>,  ,     <code>and_then</code> ? ,  .    <code>and_then</code>:   -,   ,  ,       <em></em> ,    .     <code>pair</code>,   ,   ,       ,     .  , <code>and_then</code>   <code>Result</code>  <code>Option</code>,   ,      ,   <code>Result</code>  <code>Option</code>      <em></em>,   ,     ( ,    )).</p><br>
<p>,      .</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">and_then</span></span>&lt;<span class="hljs-symbol">'a</span>, P, F, A, B, NextP&gt;(parser: P, f: F) -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, B&gt;
<span class="hljs-keyword">where</span>
    P: Parser&lt;<span class="hljs-symbol">'a</span>, A&gt;,<font></font>
    NextP: Parser&lt;<span class="hljs-symbol">'a</span>, B&gt;,<font></font>
    F: <span class="hljs-built_in">Fn</span>(A) -&gt; NextP,<font></font>
{<font></font>
    <span class="hljs-keyword">move</span> |input| <span class="hljs-keyword">match</span> parser.parse(input) {
        <span class="hljs-literal">Ok</span>((next_input, result)) =&gt; f(result).parse(next_input),
        <span class="hljs-literal">Err</span>(err) =&gt; <span class="hljs-literal">Err</span>(err),<font></font>
    }<font></font>
}</code></pre><br>
<p>  ,    ,    <code>P</code>,   ,     <code>A</code>.    <code>F</code>,  <code>map</code>    <code>A</code>  <code>B</code>,     ,  <code>and_then</code>    <code>A</code>  <em>  </em> <code>NextP</code>,     <code>B</code>.    — <code>B</code>,    ,  ,     <code>NextP</code>   .</p><br>
<p>   :        ,     ,  ,     ,      <code>f</code>   ( <code>A</code>),  ,    <code>f(result)</code>,       <code>B</code>.   <em></em>          .    ,        ,    ,       <code>B</code></p><br>
<p> :        <code>P</code>,    ,    <code>f</code>     <code>P</code>,        <code>NextP</code>,    ,    .</p><br>
<p>       <code>Parser</code>,    <code>map</code>,    .</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">and_then</span></span>&lt;F, NextParser, NewOutput&gt;(<span class="hljs-keyword">self</span>, f: F) -&gt; BoxedParser&lt;<span class="hljs-symbol">'a</span>, NewOutput&gt;
<span class="hljs-keyword">where</span>
    <span class="hljs-keyword">Self</span>: <span class="hljs-built_in">Sized</span> + <span class="hljs-symbol">'a</span>,<font></font>
    Output: <span class="hljs-symbol">'a</span>,<font></font>
    NewOutput: <span class="hljs-symbol">'a</span>,<font></font>
    NextParser: Parser&lt;<span class="hljs-symbol">'a</span>, NewOutput&gt; + <span class="hljs-symbol">'a</span>,<font></font>
    F: <span class="hljs-built_in">Fn</span>(Output) -&gt; NextParser + <span class="hljs-symbol">'a</span>,<font></font>
{<font></font>
    BoxedParser::new(and_then(<span class="hljs-keyword">self</span>, f))<font></font>
}</code></pre><br>
<p>, ,    ?</p><br>
<p> ,   <em></em>  <code>pair</code>  :</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">pair</span></span>&lt;<span class="hljs-symbol">'a</span>, P1, P2, R1, R2&gt;(parser1: P1, parser2: P2) -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, (R1, R2)&gt;
<span class="hljs-keyword">where</span>
    P1: Parser&lt;<span class="hljs-symbol">'a</span>, R1&gt; + <span class="hljs-symbol">'a</span>,<font></font>
    P2: Parser&lt;<span class="hljs-symbol">'a</span>, R2&gt; + <span class="hljs-symbol">'a</span>,<font></font>
    R1: <span class="hljs-symbol">'a</span> + <span class="hljs-built_in">Clone</span>,<font></font>
    R2: <span class="hljs-symbol">'a</span>,<font></font>
{<font></font>
    parser1.and_then(<span class="hljs-keyword">move</span> |result1| parser2.map(<span class="hljs-keyword">move</span> |result2| (result1.clone(), result2)))<font></font>
}</code></pre><br>
<p>   ,   : <code>parser2.map()</code>  <code>parser2</code>     ,    <code>Fn</code>,   <code>FnOnce</code>,     <code>parser2</code>,     .  ,  Rust.     ,      ,        <code>pair</code>.</p><br>
<p>,         Rust,            <code>close_element</code>,   ,         .</p><br>
<p>   :</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">parent_element</span></span>&lt;<span class="hljs-symbol">'a</span>&gt;() -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, Element&gt; {<font></font>
    pair(<font></font>
        open_element(),<font></font>
        left(zero_or_more(element()), close_element(…oops)),<font></font>
    )<font></font>
}</code></pre><br>
<p>,   <code>and_then</code>,            <code>close_element</code>.</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">parent_element</span></span>&lt;<span class="hljs-symbol">'a</span>&gt;() -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, Element&gt; {<font></font>
    open_element().and_then(|el| {<font></font>
        left(zero_or_more(element()), close_element(el.name.clone())).map(<span class="hljs-keyword">move</span> |children| {
            <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> el = el.clone();<font></font>
            el.children = children;<font></font>
            el<font></font>
        })<font></font>
    })<font></font>
}</code></pre><br>
<p>    ,   <code>and_then</code>    <code>open_element()</code>,    ,    <code>close_element</code>.  ,       <code>open_element</code>      <code>and_then</code>.  ,         <code>Element</code>  <code>open_element</code>, ,   ,      .</p><br>
<p> ,  <code>map</code>    ,    <code>Element</code> ( <code>el</code>)   .    <code>clone()</code>,      <code>Fn</code>       .       ( <code>Vec&lt;Element&gt;</code> )       <code>Element</code>,        .</p><br>
<p>,     ,      <code>element</code>  ,    <code>open_element</code>  <code>parent_element</code>,      ,     ,   ,   !</p><br>
<h3 id="sobiraetes-li-vy-skazat-slovo-m-ili-dolzhen-ya">     ""   ?</h3><br>
<p>,    ,   <code>map</code>  «»   Haskell?</p><br>
<p><code>and_then</code> —    ,     Rust,      ,   <code>map</code>.   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>flat_map</code></a>  <code>Iterator</code>,     ,   .</p><br>
<p>    — "".     <code>Thing&lt;A&gt;</code>,      <code>and_then</code>,        <code>A</code>  <code>Thing&lt;B&gt;</code>,        <code>Thing&lt;B&gt;</code> —  .</p><br>
<p>    , ,     <code>Option&lt;A&gt;</code>,   ,    <code>Some(A)</code>  <code>None</code>,     ,   <code>Some(A)</code>,   <code>Some(B)</code></p><br>
<p>    . ,     <code>Future&lt;A&gt;</code>     ,  <code>and_then</code>      <code>Future&lt;B&gt;</code>,      <code>Future&lt;B&gt;</code>    <code>Future&lt;A&gt;</code>  ,     <code>Future&lt;A&gt;</code>.        <code>Future&lt;A&gt;</code>,   —   <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">1</a></sup>,   <code>Future&lt;B&gt;</code>.  ,   <code>Future</code>     ,    <code>and_then</code>   <em>  </em>,       <code>Future</code>,  .     ,     <em></em> <code>Future</code>,       .</p><br>
<p>     ,   Rust       ,   ,     ,  ,  ,       ,    ,    .  .</p><br>
<h3 id="probely-redux">, Redux</h3><br>
<p>  .</p><br>
<p>     ,    XML,      .       ,              (  ,        ,  <code>&lt; div / &gt;</code>,    ).</p><br>
<p>              .</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">whitespace_wrap</span></span>&lt;<span class="hljs-symbol">'a</span>, P, A&gt;(parser: P) -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, A&gt;
<span class="hljs-keyword">where</span>
    P: Parser&lt;<span class="hljs-symbol">'a</span>, A&gt;,<font></font>
{<font></font>
    right(space0(), left(parser, space0()))<font></font>
}</code></pre><br>
<p>   <code>element</code>  ,          <code>element</code>,  ,          ,   .</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">element</span></span>&lt;<span class="hljs-symbol">'a</span>&gt;() -&gt; <span class="hljs-keyword">impl</span> Parser&lt;<span class="hljs-symbol">'a</span>, Element&gt; {<font></font>
    whitespace_wrap(either(single_element(), parent_element()))<font></font>
}</code></pre><br>
<h3 id="my-na-finishnoy-pryamoy">   !</h3><br>
<p> ,    !    ,  .</p><br>
<pre><code class="rust hljs"><span class="hljs-meta">#[test]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">xml_parser</span></span>() {
    <span class="hljs-keyword">let</span> doc = <span class="hljs-string">r#"
        &lt;top label="Top"&gt;
            &lt;semi-bottom label="Bottom"/&gt;
            &lt;middle&gt;
                &lt;bottom label="Another bottom"/&gt;
            &lt;/middle&gt;
        &lt;/top&gt;"#</span>;
    <span class="hljs-keyword">let</span> parsed_doc = Element {<font></font>
        name: <span class="hljs-string">"top"</span>.to_string(),<font></font>
        attributes: <span class="hljs-built_in">vec!</span>[(<span class="hljs-string">"label"</span>.to_string(), <span class="hljs-string">"Top"</span>.to_string())],<font></font>
        children: <span class="hljs-built_in">vec!</span>[<font></font>
            Element {<font></font>
                name: <span class="hljs-string">"semi-bottom"</span>.to_string(),<font></font>
                attributes: <span class="hljs-built_in">vec!</span>[(<span class="hljs-string">"label"</span>.to_string(), <span class="hljs-string">"Bottom"</span>.to_string())],<font></font>
                children: <span class="hljs-built_in">vec!</span>[],<font></font>
            },<font></font>
            Element {<font></font>
                name: <span class="hljs-string">"middle"</span>.to_string(),<font></font>
                attributes: <span class="hljs-built_in">vec!</span>[],<font></font>
                children: <span class="hljs-built_in">vec!</span>[Element {<font></font>
                    name: <span class="hljs-string">"bottom"</span>.to_string(),<font></font>
                    attributes: <span class="hljs-built_in">vec!</span>[(<span class="hljs-string">"label"</span>.to_string(), <span class="hljs-string">"Another bottom"</span>.to_string())],<font></font>
                    children: <span class="hljs-built_in">vec!</span>[],<font></font>
                }],<font></font>
            },<font></font>
        ],<font></font>
    };<font></font>
    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-literal">Ok</span>((<span class="hljs-string">""</span>, parsed_doc)), element().parse(doc));<font></font>
}</code></pre><br>
<p> ,    -   ,   ,      :</p><br>
<pre><code class="rust hljs"><span class="hljs-meta">#[test]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">mismatched_closing_tag</span></span>() {
    <span class="hljs-keyword">let</span> doc = <span class="hljs-string">r#"
        &lt;top&gt;
            &lt;bottom/&gt;
        &lt;/middle&gt;"#</span>;
    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-literal">Err</span>(<span class="hljs-string">"&lt;/middle&gt;"</span>), element().parse(doc));<font></font>
}</code></pre><br>
<p>   ,        .     ,      <em></em>  ,       ,  , <em></em> .  ,  , ,  ,          .     ,       ,    , ,   ,    .</p><br>
<p>    :     ,   !  ,      ,  ,               <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">2</a></sup> .</p><br>
<p> ,   ,       .      !</p><br>
<h3 id="dopolnitelnye-resursy"> </h3><br>
<p> ,    ,       Rust ,   ,        - ,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>,       ,       .</p><br>
<p>       ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>pom</code></a>,           ,    .</p><br>
<p>      Rust  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>nom</code></a>   ,    <code>pom</code>    (    ,  ),          ,     .</p><br>
<p>       Rust  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>combine</code></a>,    .</p><br>
<p>      Haskell  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Parsec</a>.</p><br>
<p>,            <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><em>«  Haskell»</em></a>,          ,      Haskell.</p><br>
<h2 id="licenziya"></h2><br>
<p>     Bodil Stokke        Creative Commons Attribution-NonCommercial-ShareAlike 4.0.     ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">http://creativecommons.org/licenses/by-nc-sa/4.0/</a>.</p><br>
<h2 id="snoski"></h2><br>
<p>1:       .</p><br>
<p>2: ,      .</p><br>
<h2 id="ot-perevodchikov"> </h2><br>
<p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link">andreevlex</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link">funkill</a></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja469195/index.html">DevOpsProdigy KubeGraf v1.1.0</a></li>
<li><a href="../ja469203/index.html">朝食と訪問ハッカソンの強力な「カフェ」：データサイエンスコミュニティの発展にとって重要な理由</a></li>
<li><a href="../ja469205/index.html">ミュージアムデータアート。「Electronics MS 0511」の開梱</a></li>
<li><a href="../ja469209/index.html">安価なPhilips LEDランプと高価なLEDランプの違い</a></li>
<li><a href="../ja469211/index.html">ICDが銀行顧客向けのエコシステムを開発する方法</a></li>
<li><a href="../ja469215/index.html">R言語で日付を操作する（基本機能、およびlubridateパッケージとtimeperiodsRパッケージ）</a></li>
<li><a href="../ja469217/index.html">私見聖人チームリード会議2019</a></li>
<li><a href="../ja469219/index.html">IntelliJ IDEAのトップ20ナビゲーション機能。パート2</a></li>
<li><a href="../ja469221/index.html">カスケード：キャラクターの6ポイントポーズの予測</a></li>
<li><a href="../ja469223/index.html">バックドアとしてのLEDバックライト</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>