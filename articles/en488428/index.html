<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤽🏿 🧒🏼 👩🏽‍🔬 How do we predict the future in Yandex search: from bug fixes to discovery queries 🥨 🤙🏾 💃🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="People do not always accurately formulate their queries, so search engines should help them with this. My name is Sergey Yudin, I lead a group of sear...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>How do we predict the future in Yandex search: from bug fixes to discovery queries</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/488428/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">People do not always accurately formulate their queries, so search engines should help them with this. </font><font style="vertical-align: inherit;">My name is Sergey Yudin, I lead a group of search functionality analytics in Yandex. </font><font style="vertical-align: inherit;">Every day we improve something through machine learning. </font><font style="vertical-align: inherit;">Last year, we have been developing technology that foresees human interests. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With an expert from my team Anastasia Gaidashenko</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avgaydashenko</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I will tell readers of Habr how this technology works, I will describe architecture and applied algorithms. </font><font style="vertical-align: inherit;">You will also learn how the prediction of the next request differs from the prediction of future human interests.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cf/zh/ud/cfzhuds3ib6nylrxgaggutjqjaw.png"><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What does the user want?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's see how Yandex technologies help in solving problems, using the example of an imaginary user. Suppose he prints “save ticket” in the search box. What does he want to find? To learn about the accumulation of tickets, or was he just wrong? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/iz/bn/8g/izbn8giuy_nii2pfaws_a8-kd5u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yes, he was sealed up. He wants not to save, but to buy a ticket. Yandex understood him, the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">guardian helped</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> him in this </font><font style="vertical-align: inherit;">- a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">system that corrects incorrectly entered requests</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Mathematically, this system maximizes the likelihood of a correctly entered query, provided that the user entered the text. This problem has been solved in Yandex for more than ten years. And not only in the search. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, our imaginary user entered the request “buy a ticket”. At this point, a </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">sjest</font></a><font style="vertical-align: inherit;"> comes into play </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(or search suggestions). Sajest helps the user to formulate the request, to complete it correctly. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pd/mt/vn/pdmtvnin_dpcned2jb7cod8fdbg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Our sajest has come a long way. A couple of years ago, we complicated the task. I wanted to show not just the most logical completion of the request, but also to predict which request this particular user would enter in the end and start his prerender before the click. If you are interested in how this works, then you can </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">look at Habré</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Our imaginary user selects the end of the request from a series of tips: it turns out that he was looking for tickets to the Tretyakov Gallery. Thus, the recommendation system completed its first task - it </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">helped the user to formulate a request</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This task has been completed, but the user still has questions. What will he look for next? Maybe he wants to know how to get to the gallery? Yes, he prints Lavrushinsky per. 10 to verify the address. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vy/94/lp/vy94lpjvfk6lr-52qb3k-cifzn0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Can we predict this request? Yes. And we have been doing this for quite some time. There is such a block - “Also asked” at the end of the issue. It shows the queries that people usually ask after entering in the search field. It is in it that we will see our request with the address of the Tretyakov Gallery. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hh/x3/ol/hhx3oltmm93h_ti1ni2uooh15c8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We maximize the probability of a request subject to a previous user request. The system completed the second task - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">predicted the next request</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And then something very interesting happens. The user prints the request "when can I visit the Tretyakov Gallery for free." This request is different from the rest, runs counter to the user task, solves some orthogonal task. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rz/mg/rf/rzmgrfub13z2bgkquypwur2qk60.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But let's think: if we were looking for tickets to the gallery, what would we like to see as a recommendation? A huge number of people would like to know that a ticket may not need to be bought. This is the third, most difficult and interesting part of the task - to </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recommend something new and useful to the user. Something that he himself hadn’t thought of yet.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
We call such requests </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">discovery</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">We learn to identify them in our search logs, save and recommend them at the end of the issue. </font><font style="vertical-align: inherit;">And this is precisely the new and revolutionary task that we are actively working on now. </font><font style="vertical-align: inherit;">To a person buying Scandinavian sticks, Yandex may recommend a request on how to pick them up by height. </font><font style="vertical-align: inherit;">If a person travels often, then perhaps he will be interested in the search query "where to go without a visa." </font><font style="vertical-align: inherit;">Etc. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/p5/o9/xt/p5o9xthlj892hhg8u8wy5i7fv6c.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The mathematical formulation of the problem in this case will look like this: we do not maximize the probability of the next request, but the probability of a click on the request, which we recommend to the user based on his previous session.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How it works?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let’s look at how our recommendation system is implemented, what architecture is hidden behind it. But to begin with, we will determine what we generally want to get from the recommendation system. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Useful recommendations!</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Of course, we want the requests that we recommend to the user to suit his interests. They should be useful and relevant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scalability.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We hope that the system will be good: there will be more and more users, and the number of requests will increase. And we want to increase coverage for those on which we can make recommendations. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ease of implementation.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We assume that our system will still work, and we do not want to rewrite it many times. The system should be easy to implement, so that we can later improve it, not launching a new version, but improving the current one. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Having decided on our wishes, let's see how you can bring them to life. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We have some discovery database - a database of queries that may seem interesting and useful to our users. But if we start ranking this entire base, we will not have enough computing power. Users have many requests, they are diverse, so first we need to filter this database. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/us/jc/yf/usjcyf2m3adimt3i_a7wi1z4zhk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Filtering can be done by different methods. In Yandex, we use </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">kNN (k-nearest neighbors)</font></a><font style="vertical-align: inherit;"> for this</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- The basic classification algorithm in machine learning, known as the “nearest neighbor search”. Using this algorithm, we want to filter the database: select the most close queries to what may interest the user. To do this, we want to compare the user’s request and those requests that we are ready to recommend in vector space.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But in order to bring these requests into one vector space, we also need to come up with something. For example, you can use DSSM (Deep Structured Semantic Model) - a kind of black box that can translate different entities into one vector space. Initially, this approach was proposed in an article from Microsoft. But Yandex has already adapted it quite strongly for its tasks and has gone far from the original idea. If you are interested in reading more about this, then the information can be found, for example, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the article about the Palekh search algorithm</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3x/jl/fo/3xjlfo_sc9vwjwodm_jnec2bkka.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The next step is ranking. When we have a list of requests that are close to what the user might be interested in, we want to understand what will be more interesting to him and what is less.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, we selected 100 queries. It is unlikely that the user will scroll all 100. You need to select the top 5 and recommend it. To do this, we assign ratings to our requests. We get these estimates based on the probability of a click on a request that we recommend to the user based on his previous session. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How do we get the probability of the next click? Our system is already up and running, so we simply collect feedback from users - and thereby gradually improve our recommendation system. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mm/gt/9r/mmgt9rnsaxvvttfeg5iqgp9jw6u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now that we’ve reviewed all the steps separately, let's go back to the beginning and put it all together. Total: the user comes to us with some request, and we have some kind of recommendations base. We take this database and filter it, receiving requests that we want to arrange and recommend to the user.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o6/k0/x9/o6k0x9hi7k_eq0w2k4a_xueaasi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now recall that we generally formulated wishes for our recommendation system. And let's see how we can implement them in the resulting architecture. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, we wanted scalability in terms of improving the base. Our implementation method has all the properties necessary for such scaling. We should not keep the entire base in memory: as soon as the base expands so much that it will not fit on one cluster, we can split it into two. And if earlier we went through one cluster with kNN and selected the top 100, which we will rank, now we can go through two clusters separately and select, for example, the top 50 in each. Or, in general, break up clusters by topics and walk with kNN only on the desired topics.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To scale the number of users, you can simply add additional computing power and process each one separately, because in our architecture there are no places where we would have to keep all users in memory at the same time. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In some other approaches, there are places that filter, for example, when decomposing a matrix. </font><font style="vertical-align: inherit;">Matrix decomposition is another approach used in the recommendations. </font><font style="vertical-align: inherit;">In fact, Yandex also uses it, but not for filtering, but as additional features for training, because there is still a lot of information that is useful to analyze. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Additional features, new algorithms, and other methods can be applied to the rest of the architecture. </font><font style="vertical-align: inherit;">When the system is up and running, we can begin to improve it.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qp/1w/tz/qp1wtzx2h_cdqdduy17ibwxjeru.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Where does it work?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Such an architecture has already been implemented in Yandex, and in comparison with the usual reformulations, when we tried to advise the user to find out the address of the Tretyakov Gallery, we can already advise how to get to the Tretyakov Gallery without waiting in line or even free of charge. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yi/4i/zg/yi4izgzr-y6iilosuuew1bhfzp4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is a new level of interaction between the search engine and users. </font><font style="vertical-align: inherit;">We do not just correct mistakes and supplement requests, but learn to predict the interests of a person and offer him something new. </font><font style="vertical-align: inherit;">Perhaps this will be the search for the future. </font><font style="vertical-align: inherit;">What do you think?</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en488416/index.html">SLAE - Security Linux Assembly Expert Exam</a></li>
<li><a href="../en488418/index.html">REST API Authentication with Spring Security and MongoDB</a></li>
<li><a href="../en488422/index.html">10 lines of code to reduce the pain of your Vue project</a></li>
<li><a href="../en488424/index.html">What will happen to ITSM in 2020?</a></li>
<li><a href="../en488426/index.html">How to do a code review? Part 2: review navigation, speed, comments, conflicts</a></li>
<li><a href="../en488432/index.html">Snoop Project an incredible tool for Internet intelligence, which RuNet users have been waiting for so long - is available</a></li>
<li><a href="../en488436/index.html">Quickly create open-source chiptune music</a></li>
<li><a href="../en488438/index.html">The history of film audio formats: the German answer to compact cassettes - how was the fate of the development</a></li>
<li><a href="../en488440/index.html">Lords of DOOM: how two guys created a cult shooter and rocked the video game industry</a></li>
<li><a href="../en488442/index.html">Modern code for making HTTP requests in Swift 5 using Combine and using them in SwiftUI. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>