<!doctype html>
<html class="no-js" lang="hi">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯОД ЁЯСйЁЯП╜тАНЁЯдЭтАНЁЯСйЁЯП╝ ЁЯОЪя╕П рдПрдВрдЯрд┐рдЯреА рдлреНрд░реЗрдорд╡рд░реНрдХ рдХреЛрд░ рдХреЛ рдЧрддрд┐ рджреЗрдирд╛ тЖШя╕П тШФя╕П ЁЯСйЁЯП┐тАНЁЯЪТ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд▓рд╛рд▓рдЪреА рдордд рдмрдиреЛ!
 рдбреЗрдЯрд╛ рдХрд╛ рдЪрдпрди рдХрд░рддреЗ рд╕рдордп, рдЖрдкрдХреЛ рдПрдХ рд╕рдордп рдореЗрдВ рдЬрд┐рддрдиреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЙрддрдиреЗ рд╣реА рдЪреБрдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдПрдХ рддрд╛рд▓рд┐рдХрд╛ рд╕реЗ рд╕рднреА рдбреЗрдЯрд╛ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рди рдХ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>рдПрдВрдЯрд┐рдЯреА рдлреНрд░реЗрдорд╡рд░реНрдХ рдХреЛрд░ рдХреЛ рдЧрддрд┐ рджреЗрдирд╛</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487734/"><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓рд╛рд▓рдЪреА рдордд рдмрдиреЛ!</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдбреЗрдЯрд╛ рдХрд╛ рдЪрдпрди рдХрд░рддреЗ рд╕рдордп, рдЖрдкрдХреЛ рдПрдХ рд╕рдордп рдореЗрдВ рдЬрд┐рддрдиреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЙрддрдиреЗ рд╣реА рдЪреБрдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдПрдХ рддрд╛рд▓рд┐рдХрд╛ рд╕реЗ рд╕рднреА рдбреЗрдЯрд╛ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рди рдХрд░реЗрдВ! </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧрд▓рдд:</font></font></u><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> ctx = <span class="hljs-keyword">new</span> EFCoreTestContext(optionsBuilder.Options);                
<span class="hljs-comment">//    ID  ,       !</span>
ctx.FederalDistricts.Select(x=&gt; <span class="hljs-keyword">new</span> { x.ID, x.Name, x.ShortName }).ToList();
</code></pre> <br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╣реА рдврдВрдЧ рд╕реЗ:</font></font></u><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> ctx = <span class="hljs-keyword">new</span> EFCoreTestContext(optionsBuilder.Options);  
<span class="hljs-comment">//     ID     !</span>
ctx.FederalDistricts.Select(x=&gt; <span class="hljs-keyword">new</span> { x.Name, x.ShortName }).ToList();<font></font>
ctx.FederalDistricts.Select(x =&gt; <span class="hljs-keyword">new</span> MyClass { Name = x.Name, ShortName = x.ShortName }).ToList();
</code></pre><br>
<a name="habracut"></a><br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧрд▓рдд:</font></font></u><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> blogs = context.Blog.ToList(); <span class="hljs-comment">//       . ?</span>
<span class="hljs-comment">//     ?</span>
<span class="hljs-keyword">var</span> somePost = blogs.FirstOrDefault(x=&gt;x.Title.StartWidth(тАЬHello world!тАЭ));
</code></pre><br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╣реА рдврдВрдЧ рд╕реЗ:</font></font></u><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> somePost = context.Blog.FirstOrDefault(x=&gt;x.Title.StartWidth(тАЬHello world!тАЭ));
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХреАрдХреГрдд рдбреЗрдЯрд╛ рд╕рддреНрдпрд╛рдкрди рддрдм рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрдм рдХреЛрдИ рдХреНрд╡реЗрд░реА рдХреБрдЫ рд░рд┐рдХреЙрд░реНрдб рд▓реМрдЯрд╛рддреА рд╣реИред </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧрд▓рдд:</font></font></u><br>
<br>
<pre><code class="cs hljs">
<span class="hljs-keyword">var</span> blogs = context.Blogs.Where(blog =&gt; StandardizeUrl(blog.Url).Contains(<span class="hljs-string">"dotnet"</span>)).ToList();<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> <span class="hljs-title">StandardizeUrl</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> url</span>)</span><font></font>
{<font></font>
    url = url.ToLower();<font></font>
    <span class="hljs-keyword">if</span> (!url.StartsWith(<span class="hljs-string">"http://"</span>))<font></font>
    {<font></font>
        url = <span class="hljs-keyword">string</span>.Concat(<span class="hljs-string">"http://"</span>, url);<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> url;<font></font>
}<font></font>
</code></pre><br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╣реА рдврдВрдЧ рд╕реЗ:</font></font></u><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> blogs = context.Blogs.AsEnumerable().Where(blog =&gt; StandardizeUrl(blog.Url).Contains(<span class="hljs-string">"dotnet"</span>)).ToList();<font></font>
 <font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-keyword">var</span> blogs = context.Blogs.Where(blog =&gt; blog.Contains(<span class="hljs-string">"dotnet"</span>))<font></font>
    .OrderByDescending(blog =&gt; blog.Rating)<font></font>
    .Select(blog =&gt; <span class="hljs-keyword">new</span><font></font>
    {<font></font>
        Id = blog.BlogId,<font></font>
        Url = StandardizeUrl(blog.Url)<font></font>
    })<font></font>
    .ToList();<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╡рд╛рд╣, рд╡рд╛рд╣, рд╡рд╛рд╣, рддрд╛рд▓реА рдмрдЬреАред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ LINQ рддрдХрдиреАрдХреЛрдВ рдХреЗ рдЖрдкрдХреЗ рдЬреНрдЮрд╛рди рдХреЛ рдереЛрдбрд╝рд╛ рддрд╛рдЬрд╝рд╛ рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рд╣реИред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП рджреЗрдЦреЗрдВ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToList </font></font></i><i><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AsEnumerable</font></font></i></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> AsQueryable рдХреЗ </font><font style="vertical-align: inherit;">рдмреАрдЪ рдЕрдВрддрд░</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕реЛ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯрд╛рд▓рд╕реНрдЯ</font></font></i><br>
<br>
<ul>
<li>  .</li>
<li> <i>.ToList()</i>           (lazy loading),            .</li>
</ul><br>
<i>AsEnumerable</i><br>
<br>
<ul>
<li>   (lazy loading)</li>
<li> : <i>Func &lt;TSource, bool&gt;</i></li>
<li>          (   <b>Where/Take/Skip</b>   , ,   select * from Table1, </li>
<li>    ,    N )</li>
<li>    : <i>Linq-to-SQL + Linq-to-Object</i>.</li>
<li> <i>IEnumerable </i>          (lazy loading).</li>
</ul><br>
<i>AsQueryable</i><br>
<br>
<ul>
<li>   (lazy loading)</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">  :</a> <pre><code class="cs hljs">AsQueryable(IEnumerable)  AsQueryable&lt;TElement&gt;(IEnumerable&lt;TElement&gt;) </code></pre><br>
</li>
<li> Expression  T-SQL (   ),         .</li>
<li>  DbSet ( Entity Framework)    AsQueryable    .</li>
<li>   ,   <b>Take(5)</b>     <b>┬лselect top 5 * SQL┬╗</b>   .  ,       SQL  ,     .  <i>AsQueryable()</i>   ,  <i>AsEnumerable()</i>     T-SQL      Linq  .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдк рдПрдХ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреНрд╡реЗрд░реА рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдЬреЛ рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдкрд░ рдЪрд▓рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдмреЗрд╣рддрд░ рд╣реЛ рд╕рдХрддреА рд╣реИ, рддреЛ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AsQueryable рдХрд╛</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рдмрд╕реЗ рд╕рд░рд▓ рдорд╛рдорд▓реЗ рдореЗрдВ AsQueryable рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> IEnumerable&lt;EmailView&gt; <span class="hljs-title">GetEmails</span>(<span class="hljs-params"><span class="hljs-keyword">out</span> <span class="hljs-keyword">int</span> totalRecords, Guid? deviceWorkGroupID,
                DateTime? timeStart, DateTime? timeEnd, <span class="hljs-keyword">string</span> search, <span class="hljs-keyword">int</span>? confirmStateID, <span class="hljs-keyword">int</span>? stateTypeID, <span class="hljs-keyword">int</span>? limitOffset, <span class="hljs-keyword">int</span>? limitRowCount, <span class="hljs-keyword">string</span> orderBy, <span class="hljs-keyword">bool</span> desc</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> r = <span class="hljs-keyword">new</span> List&lt;EmailView&gt;();<font></font>
<font></font>
            <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> db = <span class="hljs-keyword">new</span> GJobEntities())<font></font>
            {<font></font>
                <span class="hljs-keyword">var</span> query = db.Emails.AsQueryable();<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (timeStart != <span class="hljs-literal">null</span> &amp;&amp; timeEnd != <span class="hljs-literal">null</span>)<font></font>
                {<font></font>
                    query = query.Where(p =&gt; p.Created &gt;= timeStart &amp;&amp; p.Created &lt;= timeEnd);<font></font>
                }<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (stateTypeID != <span class="hljs-literal">null</span> &amp;&amp; stateTypeID &gt; <span class="hljs-number">-1</span>)<font></font>
                {<font></font>
                    query = query.Where(p =&gt; p.EmailStates.OrderByDescending(x =&gt; x.AtTime).FirstOrDefault().EmailStateTypeID == stateTypeID);<font></font>
                }<font></font>
<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (confirmStateID != <span class="hljs-literal">null</span> &amp;&amp; confirmStateID &gt; <span class="hljs-number">-1</span>)<font></font>
                {<font></font>
                    <span class="hljs-keyword">var</span> boolValue = confirmStateID == <span class="hljs-number">1</span> ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;<font></font>
                    query = query.Where(p =&gt; p.IsConfirmed == boolValue);<font></font>
                }<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">string</span>.IsNullOrEmpty(search))<font></font>
                {<font></font>
                    search = search.ToLower();<font></font>
                    query = query.Where(p =&gt; (p.Subject + <span class="hljs-string">" "</span> + p.CopiesEmails + <span class="hljs-string">" "</span> + p.ToEmails + <span class="hljs-string">" "</span> + p.FromEmail + <span class="hljs-string">" "</span> + p.Body)<font></font>
                                        .ToLower().Contains(search));<font></font>
                }<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (deviceWorkGroupID != Guid.Empty)<font></font>
                {<font></font>
                    query = query.Where(x =&gt; x.SCEmails.FirstOrDefault().SupportCall.Device.DeviceWorkGroupDevices.FirstOrDefault(p =&gt; p.DeviceWorkGroupID == deviceWorkGroupID) != <span class="hljs-literal">null</span>);<font></font>
                }<font></font>
<font></font>
                totalRecords = query.Count();<font></font>
                query = query.OrderByDescending(p =&gt; p.Created);<font></font>
                <span class="hljs-keyword">if</span> (limitOffset.HasValue)<font></font>
                {<font></font>
                    query = query.Skip(limitOffset.Value).Take(limitRowCount.Value);<font></font>
                }<font></font>
                <span class="hljs-keyword">var</span> items = query.ToList(); <span class="hljs-comment">//    </span><font></font>
<font></font>
                <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> items)<font></font>
                {<font></font>
                    <span class="hljs-keyword">var</span> n = <span class="hljs-keyword">new</span> EmailView<font></font>
                    {<font></font>
                        ID = item.ID,<font></font>
                        SentTime = item.SentTime,<font></font>
                        IsConfirmed = item.IsConfirmed,<font></font>
                        Number = item.Number,<font></font>
                        Subject = item.Subject,<font></font>
                        IsDeleted = item.IsDeleted,<font></font>
                        ToEmails = item.ToEmails,<font></font>
                        Created = item.Created,<font></font>
                        CopiesEmails = item.CopiesEmails,<font></font>
                        FromEmail = item.FromEmail,<font></font>
                    };<font></font>
<font></font>
                    <span class="hljs-comment">//     - </span><font></font>
<font></font>
                    r.Add(n);<font></font>
                }<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">return</span> r;<font></font>
        }<font></font>
</code></pre><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдзрд╛рд░рдг рдкрдврд╝рдиреЗ рдХрд╛ рдЬрд╛рджреВ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрджрд┐ рдЖрдкрдХреЛ рдбреЗрдЯрд╛ рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рддреЛ рдмрд╕ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.AsNoTracking ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд┐рдзрд┐ рдХрд╛ </font><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">ред </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдзреАрдореА рдЧрддрд┐ рд╕реЗ рдирдореВрдирд╛ рд▓реЗрдирд╛</font></font></i><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> blogs = context.Blogs.ToList();</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд▓реНрджреА рд▓рд╛рдиреЗ (рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП)</font></font></i><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> blogs = context.Blogs.AsNoTracking().ToList();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдЖрдк рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдереЛрдбрд╝рд╛ рдЧрд░реНрдо рд╣реЛ рдЧрдП рд╣реИрдВ? </font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдмрдВрдзрд┐рдд рдбреЗрдЯрд╛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рдкреНрд░рдХрд╛рд░</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЙрди рд▓реЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдЬреЛ рднреВрд▓ рдЧрдП рд╣реИрдВ рдХрд┐ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрд▓рд╕реА рд▓реЛрдбрд┐рдВрдЧ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреНрдпрд╛ </font><i><font style="vertical-align: inherit;">рд╣реИ</font></i><font style="vertical-align: inherit;"> ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрд▓рд╕реА рд▓реЛрдбрд┐рдВрдЧ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(рдЖрд▓рд╕реА рд▓реЛрдбрд┐рдВрдЧ) рдХрд╛</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрд░реНрде рд╣реИ рдХрд┐ рдиреЗрд╡рд┐рдЧреЗрд╢рди рдХреА рд╕рдВрдкрддреНрддрд┐ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рджреМрд░рд╛рди рд╕рдВрдмрдВрдзрд┐рдд рдбреЗрдЯрд╛ рдХреЛ рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗ рдкрд╛рд░рджрд░реНрд╢реА рд░реВрдк рд╕реЗ рд▓реЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдФрд░ рдЕрдзрд┐рдХ рдкрдврд╝реЗрдВ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдБ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдФрд░ рд╕рд╛рде рд╣реА, рдореИрдВ рдЖрдкрдХреЛ рдЕрдиреНрдп рдкреНрд░рдХрд╛рд░ рдХреЗ рд▓реЛрдбрд┐рдВрдЧ рд╕рдВрдмрдВрдзрд┐рдд рдбреЗрдЯрд╛ рдХреА рдпрд╛рдж рджрд┐рд▓рд╛рддрд╛ рд╣реВрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рдХреНрд░рд┐рдп рд▓реЛрдб </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(рдИрдЧрд░ рд▓реЛрдбрд┐рдВрдЧ) рдХрд╛</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрд░реНрде рд╣реИ рдХрд┐ рд╕рдВрдмрдВрдзрд┐рдд рдбреЗрдЯрд╛ рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдЕрдиреБрд░реЛрдз рдХреЗ рднрд╛рдЧ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> context = <span class="hljs-keyword">new</span> BloggingContext())<font></font>
{<font></font>
    <span class="hljs-keyword">var</span> blogs = context.Blogs<font></font>
        .Include(blog =&gt; blog.Posts)<font></font>
            .ThenInclude(post =&gt; post.Author)<font></font>
                .ThenInclude(author =&gt; author.Photo)<font></font>
        .Include(blog =&gt; blog.Owner)<font></font>
            .ThenInclude(owner =&gt; owner.Photo)<font></font>
        .ToList();<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдзреНрдпрд╛рди! </font><font style="vertical-align: inherit;">рд╕рдВрд╕реНрдХрд░рдг EF Core 3.0.0 рдХреЗ рд╕рд╛рде рд╢реБрд░реВ, рдкреНрд░рддреНрдпреЗрдХ рд╢рд╛рдорд┐рд▓ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JOIN рд╕рдВрдмрдВрдзрдХ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреНрд░рджрд╛рддрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди SQL рдХреНрд╡реЗрд░реА рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝рд╛ рдЬрд╛рдПрдЧрд╛ </font><font style="vertical-align: inherit;">, рдЬрдмрдХрд┐ рдкрд┐рдЫрд▓реЗ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдЕрддрд┐рд░рд┐рдХреНрдд SQL рдХреНрд╡реЗрд░реА рдЙрддреНрдкрдиреНрдиред </font><font style="vertical-align: inherit;">рдпрд╣ рдЖрдкрдХреЗ рдкреНрд░рд╢реНрдиреЛрдВ рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреЛ рдмреЗрд╣рддрд░ рдпрд╛ рдмреЗрд╣рддрд░ рдХреЗ рд▓рд┐рдП рдмрджрд▓ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рдмрд╣реБрдд рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдмрдпрд╛рдиреЛрдВ рдХреЗ рд╕рд╛рде LINQ рдкреНрд░рд╢реНрдиреЛрдВ рдХреЛ рдХрдИ рдЕрд▓рдЧ-рдЕрд▓рдЧ LINQ рдкреНрд░рд╢реНрдиреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕реНрдкрд╖реНрдЯ рд▓реЛрдбрд┐рдВрдЧ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(рд╕реНрдкрд╖реНрдЯ рд▓реЛрдбрд┐рдВрдЧ) рдХрд╛</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрд░реНрде рд╣реИ рдХрд┐ рд╕рдВрдмрдВрдзрд┐рдд рдбреЗрдЯрд╛ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдмрд╛рдж рдореЗрдВ рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗ рд▓реЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> context = <span class="hljs-keyword">new</span> BloggingContext())<font></font>
{<font></font>
    <span class="hljs-keyword">var</span> blog = context.Blogs<font></font>
        .Single(b =&gt; b.BlogId == <span class="hljs-number">1</span>);<font></font>
<font></font>
    <span class="hljs-keyword">var</span> goodPosts = context.Entry(blog)<font></font>
        .Collection(b =&gt; b.Posts)<font></font>
        .Query()<font></font>
        .Where(p =&gt; p.Rating &gt; <span class="hljs-number">3</span>)<font></font>
        .ToList();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЭрдЯрдХрд╛ рдФрд░ рд╕рдлрд▓рддрд╛! </font><font style="vertical-align: inherit;">рдЖрдЧреЗ рдмрдврд╝рддреЗ рд░рд╣рдирд╛?</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рднреА рддреЗрдЬреА рд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реИрдВ?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ рд╕рдВрдмрдВрдзрдкрд░рдХ рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗ рдЬрдЯрд┐рд▓ рд░реВрдк рд╕реЗ рд╕рдВрд░рдЪрд┐рдд рдФрд░ рдЕрд╕рд╛рдорд╛рдиреНрдп рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╕рдордп рдирд╛рдЯрдХреАрдп рд░реВрдк рд╕реЗ рдЧрддрд┐ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рджреЛ рддрд░реАрдХреЗ рд╣реИрдВ: рдЕрдиреБрдХреНрд░рдорд┐рдд рджреГрд╢реНрдп (1) рдпрд╛, рдмреЗрд╣рддрд░, рдкреВрд░реНрд╡-рддреИрдпрд╛рд░ (рдЧрдгрдирд╛) рдбреЗрдЯрд╛ рдХреЛ рдкреНрд░рджрд░реНрд╢рди рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдлреНрд▓реИрдЯ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ (2)ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(1) </font><font style="vertical-align: inherit;">рдПрдордПрд╕ SQL тАЛтАЛрд╕рд░реНрд╡рд░ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдиреБрдХреНрд░рдорд┐рдд рджреГрд╢реНрдп</font></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдиреБрдХреНрд░рдорд┐рдд рджреГрд╢реНрдп рдореЗрдВ рдПрдХ рдЕрджреНрд╡рд┐рддреАрдп рдХреНрд▓рд╕реНрдЯрд░ рдЗрдВрдбреЗрдХреНрд╕ рд╣реИред </font><font style="vertical-align: inherit;">рдПрдХ рдЕрджреНрд╡рд┐рддреАрдп рдХреНрд▓рд╕реНрдЯрд░ рдЗрдВрдбреЗрдХреНрд╕ SQL тАЛтАЛрд╕рд░реНрд╡рд░ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдХрд┐рд╕реА рднреА рдЕрдиреНрдп рдХреНрд▓рд╕реНрдЯрд░ рдЗрдВрдбреЗрдХреНрд╕ рдХреА рддрд░рд╣ рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдиреБрдХреНрд░рдорд┐рдд рджреГрд╢реНрдп рдорд╛рдирдХ рд╡рд┐рдЪрд╛рд░реЛрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХрд╛ рдЬрдЯрд┐рд▓ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рд╢рд╛рдорд┐рд▓ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдмрдбрд╝реА рдорд╛рддреНрд░рд╛ рдореЗрдВ рдбреЗрдЯрд╛ рдПрдХрддреНрд░ рдХрд░рдирд╛ рдпрд╛ рдХрдИ рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХрд╛ рд╕рдВрдпреЛрдЬрдиред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрджрд┐ рдЗрд╕ рддрд░рд╣ рдХреЗ рд╡рд┐рдЪрд╛рд░реЛрдВ рдХреЛ рдЕрдХреНрд╕рд░ рдкреНрд░рд╢реНрдиреЛрдВ рдореЗрдВ рд╕рдВрджрд░реНрднрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╣рдо рджреГрд╢реНрдп рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрджреНрд╡рд┐рддреАрдп рдХреНрд▓рд╕реНрдЯрд░ рдЗрдВрдбреЗрдХреНрд╕ рдмрдирд╛рдХрд░ рдкреНрд░рджрд░реНрд╢рди рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдорд╛рдирдХ рджреГрд╢реНрдп рдХреЗ рд▓рд┐рдП, рдкрд░рд┐рдгрд╛рдо рд╕реЗрдЯ рдХреЛ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рдкрд░рд┐рдгрд╛рдо рд╕реЗрдЯ рдХреА рдЧрдгрдирд╛ рдкреНрд░рддреНрдпреЗрдХ рдХреНрд╡реЗрд░реА рдХреЗ рд▓рд┐рдП рдХреА рдЬрд╛рддреА рд╣реИ, рд▓реЗрдХрд┐рди рдХреНрд▓рд╕реНрдЯрд░ рдЗрдВрдбреЗрдХреНрд╕ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдкрд░рд┐рдгрд╛рдо рд╕реЗрдЯ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдЙрд╕реА рддрд░рд╣ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреИрд╕реЗ рдХреНрд▓рд╕реНрдЯрд░ рд╕реВрдЪреА рдХреЗ рд╕рд╛рде рддрд╛рд▓рд┐рдХрд╛ред рдХреНрд╡реЗрд░реА рдЬреЛ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЕрдиреБрдХреНрд░рдорд┐рдд рджреГрд╢реНрдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреА рд╣реИрдВ, рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рджреГрд╢реНрдп рд╕реЗ рдХреНрд▓рд╕реНрдЯрд░ рдЗрдВрдбреЗрдХреНрд╕ рдХреЗ рдЕрд╕реНрддрд┐рддреНрд╡ рд╕реЗ рднреА рд▓рд╛рдн рд╣реЛ рд╕рдХрддрд╛ рд╣реИред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкреНрд░рджрд░реНрд╢рди рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдПрдХ рд╕реВрдЪрдХрд╛рдВрдХ рдкреНрд░рд╕реНрддреБрдд рдХрд░рдирд╛ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рд▓рд╛рдЧрдд рд╣реИред рдпрджрд┐ рд╣рдо рдПрдХ рдЕрдиреБрдХреНрд░рдорд┐рдд рджреГрд╢реНрдп рдмрдирд╛рддреЗ рд╣реИрдВ, рддреЛ рд╣рд░ рдмрд╛рд░ рдЬрдм рд╣рдо рдмреЗрд╕ рдЯреЗрдмрд▓ рдореЗрдВ рдбреЗрдЯрд╛ рдмрджрд▓рддреЗ рд╣реИрдВ, рддреЛ SQL рд╕рд░реНрд╡рд░ рдХреЛ рдЗрди рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдореЗрдВ рди рдХреЗрд╡рд▓ рд╕реВрдЪрдХрд╛рдВрдХ рд░рд┐рдХреЙрд░реНрдб рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдмрд▓реНрдХрд┐ рджреГрд╢реНрдп рдореЗрдВ рд╕реВрдЪрдХрд╛рдВрдХ рд░рд┐рдХреЙрд░реНрдб рднреА рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред рдбреЗрд╡рд▓рдкрд░реНрд╕ рдФрд░ рдЙрджреНрдпрдореЛрдВ рдХреЗ рд▓рд┐рдП SQL рд╕рд░реНрд╡рд░ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ, рдСрдкреНрдЯрд┐рдорд╛рдЗрдЬрд╝рд░ рдЙрди рдЕрдиреБрдХреНрд░рдордгрд┐рдХрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдкреНрд░рд╢реНрдиреЛрдВ рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдХреНрд░рдорд┐рдд рджреГрд╢реНрдп рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдБрдХрд┐, SQL рд╕рд░реНрд╡рд░ рдХреЗ рдЕрдиреНрдп рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ, рдХреНрд╡реЗрд░реА рдореЗрдВ рдЕрдиреБрдХреНрд░рдорд┐рдд рджреГрд╢реНрдп рд╢рд╛рдорд┐рд▓ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рджреГрд╢реНрдп рдореЗрдВ рд╕реВрдЪрдХрд╛рдВрдХ рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдиреЗ рдХреЗ рд▓рд┐рдП NOEXPAND рд╕рдВрдХреЗрдд рдкреНрд░рджрд╛рди рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(2) рдпрджрд┐ рдЖрдк рдПрдХ рдЕрдиреБрд░реЛрдз рд╣реИ рдХрд┐ рддреАрди рдХреА рд░рд╛рд╢рд┐ рдореЗрдВ рдпрд╛ рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рд╡реГрджреНрдзрд┐ рд╣реБрдИ рд╣реИ рдХреЗ рд╕рд╛рде рд╕рдВрдмрдВрдзрд┐рдд рдЯреЗрдмрд▓ рдХреЗ рддреАрди рд╕реЗ рдЕрдзрд┐рдХ рдХреЗ рд╕реНрддрд░ рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреА рдЬрд░реВрд░рдд рд╣реИ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CRUD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЛрдб, рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛ рд╕рдордп-рд╕рдордп рдкрд░ рдкрд░рд┐рдгрд╛рдо рд╕реЗрдЯ рдХреА рдЧрдгрдирд╛ рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдЗрд╕реЗ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рд╕рд╣реЗрдЬреЗрдВ рдФрд░ рдкреНрд░рджрд░реНрд╢рди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдЬрд┐рд╕рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рддрд╛рд▓рд┐рдХрд╛ рдЬрд┐рд╕рдореЗрдВ рдбреЗрдЯрд╛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЙрд╕рдХреЗ рдкрд╛рд╕ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ рдореЗрдВ рдЦреЛрдЬ рдлрд╝реАрд▓реНрдб рдкрд░</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдПрдХ </font><b><font style="vertical-align: inherit;">рдкреНрд░рд╛рдердорд┐рдХ рдХреБрдВрдЬреА рдФрд░ рдЕрдиреБрдХреНрд░рдорд┐рдд</font></b><font style="vertical-align: inherit;"> рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП </font><font style="vertical-align: inherit;">ред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛?</font></font></h4> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рд╛рдБ! </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЬрд╣рд╛рдБ рднреА рд╕рдВрднрд╡ рд╣реЛ! </font><font style="vertical-align: inherit;">рдпрд╣рд╛рдБ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Do</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> myTask = GetFederalDistrictsAsync ();
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> myTask.Result)<font></font>
    {<font></font>
         <span class="hljs-comment">// </span><font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;List&lt;FederalDistrict&gt;&gt; GetFederalDistrictsAsync()<font></font>
{<font></font>
    <span class="hljs-keyword">var</span> conn = configurationRoot.GetConnectionString(<span class="hljs-string">"EFCoreTestContext"</span>);<font></font>
    optionsBuilder.UseSqlServer(conn);<font></font>
    <span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> context = <span class="hljs-keyword">new</span> EFCoreTestContext(optionsBuilder.Options);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> context.FederalDistricts.ToListAsync();<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдФрд░ рд╣рд╛рдБ, рдХреНрдпрд╛ рдЖрдк рдЙрддреНрдкрд╛рджрдХрддрд╛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рднреА рднреВрд▓ рдЧрдП рд╣реИрдВ? </font><font style="vertical-align: inherit;">Buum!</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> context.FederalDistricts.&lt;b&gt;AsNoTracking()&lt;/b&gt;.ToListAsync();</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдиреЛрдЯ: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Do ()</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд┐рдзрд┐ </font><font style="vertical-align: inherit;">рдХреЗрд╡рд▓ рдкреНрд░рджрд░реНрд╢рди рдХреЗ рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЬреЛрдбрд╝реА рдЧрдИ </font><font style="vertical-align: inherit;">рдереА </font><font style="vertical-align: inherit;">, рддрд╛рдХрд┐ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetFederalDist рдЬрд┐рд▓реЗAsync ()</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд┐рдзрд┐ рдХреА рд╕рдВрдЪрд╛рд▓рди рдХреНрд╖рдорддрд╛ рдХрд╛ рд╕рдВрдХреЗрдд рджрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЬреИрд╕рд╛ рдХрд┐ рдореЗрд░реЗ рд╕рд╣рдпреЛрдЧрд┐рдпреЛрдВ рдиреЗ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рд╣реИ, рд╢реБрджреНрдз рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдХреЗ рдПрдХ рдФрд░ рдЙрджрд╛рд╣рд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдФрд░ рдореБрдЭреЗ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ASP .NET рдХреЛрд░ рдореЗрдВ рдПрдХ рджреГрд╢реНрдп рдШрдЯрдХ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреА рдЕрд╡рдзрд╛рд░рдгрд╛ </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">рдХреЗ</font></a><font style="vertical-align: inherit;"> рдЖрдзрд╛рд░ рдкрд░ рдЗрд╕реЗ рджреЗрдиреЗ рджреЗрдВ </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-comment">//  </span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PopularPosts</span> : <span class="hljs-title">ViewComponent</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IStatsRepository _statsRepository;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PopularPosts</span>(<span class="hljs-params">IStatsRepository statsRepository</span>)</span><font></font>
        {<font></font>
            _statsRepository = statsRepository;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;IViewComponentResult&gt; <span class="hljs-title">InvokeAsync</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
           <span class="hljs-comment">//         -</span>
            <span class="hljs-keyword">var</span> federalDistricts = <span class="hljs-keyword">await</span> _statsRepository.GetFederalDistrictsAsync(); 
            <span class="hljs-keyword">var</span> model = <span class="hljs-keyword">new</span> TablePageModel()<font></font>
            {<font></font>
                FederalDistricts = federalDistricts,<font></font>
            };<font></font>
<font></font>
            <span class="hljs-keyword">return</span> View(model);<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-comment">// </span><font></font>
    <font></font>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span>  -   .... -</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IStatsRepository</span><font></font>
    {<font></font>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span>        </span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span>
        <span class="hljs-function">IEnumerable&lt;FederalDistrict&gt; <span class="hljs-title">FederalDistricts</span>(<span class="hljs-params"></span>)</span>;<font></font>
<font></font>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span>        </span>
	<span class="hljs-comment"><span class="hljs-doctag">///</span> !!!</span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span><font></font>
        Task&lt;List&lt;FederalDistrict&gt;&gt; GetFederalDistrictsAsync();<font></font>
    }	<font></font>
	<font></font>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> -   .... -</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StatsRepository</span> : <span class="hljs-title">IStatsRepository</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> DbContextOptionsBuilder&lt;EFCoreTestContext&gt;<font></font>
            optionsBuilder = <span class="hljs-keyword">new</span> DbContextOptionsBuilder&lt;EFCoreTestContext&gt;();
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IConfigurationRoot configurationRoot;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">StatsRepository</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            IConfigurationBuilder configurationBuilder = <span class="hljs-keyword">new</span> ConfigurationBuilder()<font></font>
                    .SetBasePath(Environment.CurrentDirectory)<font></font>
                    .AddJsonFile(<span class="hljs-string">"appsettings.json"</span>, optional: <span class="hljs-literal">true</span>, reloadOnChange: <span class="hljs-literal">true</span>);<font></font>
            configurationRoot = configurationBuilder.Build();<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;List&lt;FederalDistrict&gt;&gt; GetFederalDistrictsAsync()<font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> conn = configurationRoot.GetConnectionString(<span class="hljs-string">"EFCoreTestContext"</span>);<font></font>
            optionsBuilder.UseSqlServer(conn);<font></font>
            <span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> context = <span class="hljs-keyword">new</span> EFCoreTestContext(optionsBuilder.Options);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> context.FederalDistricts.Include(x =&gt; x.FederalSubjects).ToListAsync();<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> IEnumerable&lt;FederalDistrict&gt; <span class="hljs-title">FederalDistricts</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> conn = configurationRoot.GetConnectionString(<span class="hljs-string">"EFCoreTestContext"</span>);<font></font>
            optionsBuilder.UseSqlServer(conn);<font></font>
<font></font>
            <span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> ctx = <span class="hljs-keyword">new</span> EFCoreTestContext(optionsBuilder.Options);
            <span class="hljs-keyword">return</span> ctx.FederalDistricts.Include(x =&gt; x.FederalSubjects).ToList();<font></font>
        }<font></font>
    }<font></font>
<font></font>
   <span class="hljs-comment">//         Home\Index </span>
    &lt;div id=<span class="hljs-string">"tableContainer"</span>&gt;<font></font>
            @await Component.InvokeAsync(<span class="hljs-string">"PopularPosts"</span>)<font></font>
     &lt;/div&gt;<font></font>
  <span class="hljs-comment">//   HTML      Shared\Components\PopularPosts\Default.cshtml</span><font></font>
<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореБрдЭреЗ рдпрд╛рдж рджрд┐рд▓рд╛рдПрдВ рдЬрдм рдПрдВрдЯрд┐рдЯреА рдлреНрд░реЗрдорд╡рд░реНрдХ рдХреЛрд░ рдореЗрдВ рдкреНрд░рд╢реНрдиреЛрдВ рдХрд╛ рдирд┐рд╖реНрдкрд╛рджрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LINQ рд╕реНрдЯреЗрдЯрдореЗрдВрдЯреНрд╕ рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдкрд░, рдЖрдк рдмрд╕ рдореЗрдореЛрд░реА рдореЗрдВ рдПрдХ рдХреНрд╡реЗрд░реА рд╡реНрдпреВ рдмрдирд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рд╣реА рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЛ рдЕрдиреБрд░реЛрдз рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рдмрд╕реЗ рдЖрдо рд╕рдВрдЪрд╛рд▓рди рд╣реИрдВ рдЬреЛ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рднреЗрдЬреЗ рдЧрдП рдЕрдиреБрд░реЛрдз рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рд╣реЛрддреЗ рд╣реИрдВред</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реВрдк рдХреЗ рд▓рд┐рдП рдкрд░рд┐рдгрд╛рдореЛрдВ рдкрд░ Iterate рдХрд░реЗрдВред</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToList, ToArray, Single, Count рдЬреИрд╕реЗ рдСрдкрд░реЗрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ред</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрд╡реЗрд░реА рд╕реЗ рдбреЗрдЯрд╛ рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЗ рд▓рд┐рдПред</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдИрдПрдл рдХреЛрд░ рдХреЛрдб рдХреЛ рдХреИрд╕реЗ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░реЗрдВ?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(1) рдЖрд╡реЗрджрди рдХреА рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, рдЖрдкрдХреЛ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЗ рдбреЗрдЯрд╛рдмреЗрд╕ рддрдХ рдкрд╣реБрдВрдЪ рдХреЛрдб рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдЬрдЧрд╣ (рдЕрд▓рдЧрд╛рд╡ рдореЗрдВ) рд╕реЗ рдкреГрдердХ / рдкреГрдердХ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдЖрдкрдХреЛ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЛрдб рдЦреЛрдЬрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬреЛ рдкреНрд░рджрд░реНрд╢рди рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(2) рдЕрдкрдиреЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рд▓рд┐рдП рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдЕрдиреНрдп рд╣рд┐рд╕реНрд╕реЛрдВ рдЬреИрд╕реЗ рдХрд┐ рдпреВрдЬрд░ рдЗрдВрдЯрд░рдлреЗрд╕ рдпрд╛ рдПрдкреАрдЖрдИ рдЬреИрд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХреЛрдб рдХреЛ рди рдорд┐рд▓рд╛рдПрдВред </font><font style="vertical-align: inherit;">рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдбреЗрдЯрд╛рдмреЗрд╕ рдПрдХреНрд╕реЗрд╕ рдХреЛрдб рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдЕрдиреНрдп рдореБрджреНрджреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЪрд┐рдВрддрд╛ рдХрд┐рдП рдмрд┐рдирд╛ рдмрджрд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SaveChanges</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЗрдЯрд╛ рдХреЛ рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рдФрд░ рдЬрд▓реНрджреА рд╕реЗ рдХреИрд╕реЗ рдмрдЪрд╛рдпрд╛ рдЬрд╛рдП </font><font style="vertical-align: inherit;">?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрджрд┐ рд╕рдореНрдорд┐рд▓рд┐рдд рд░рд┐рдХреЙрд░реНрдб рд╕рдорд╛рди рд╣реИрдВ, рддреЛ рдпрд╣ рд╕рднреА рд░рд┐рдХреЙрд░реНрдб рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реЗрд╡ рдСрдкрд░реЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдордЭ рдореЗрдВ рдЖрддрд╛ рд╣реИред </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧрд▓рдд</font></font></i><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span>(<span class="hljs-keyword">var</span> db = <span class="hljs-keyword">new</span> NorthwindEntities())<font></font>
{<font></font>
<span class="hljs-keyword">var</span> transaction = db.Database.BeginTransaction();<font></font>
<font></font>
<span class="hljs-keyword">try</span><font></font>
{<font></font>
    <span class="hljs-comment">//   1</span>
    <span class="hljs-keyword">var</span>  obj1 = <span class="hljs-keyword">new</span> Customer();<font></font>
    obj1.CustomerID = <span class="hljs-string">"ABCDE"</span>;<font></font>
    obj1.CompanyName = <span class="hljs-string">"Company 1"</span>;<font></font>
    obj1.Country = <span class="hljs-string">"USA"</span>;<font></font>
    db.Customers.Add(obj1);<font></font>
<font></font>
  <span class="hljs-comment">//          db.SaveChanges();</span><font></font>
<font></font>
    <span class="hljs-comment">//   2</span>
    <span class="hljs-keyword">var</span>  obj2 = <span class="hljs-keyword">new</span> Customer();<font></font>
    obj2.CustomerID = <span class="hljs-string">"PQRST"</span>;<font></font>
    obj2.CompanyName = <span class="hljs-string">"Company 2"</span>;    <font></font>
    obj2.Country = <span class="hljs-string">"USA"</span>;<font></font>
    db.Customers.Add(obj2);<font></font>
<font></font>
    <span class="hljs-comment">//   </span><font></font>
    db.SaveChanges();<font></font>
<font></font>
    transaction.Commit();<font></font>
}<font></font>
<span class="hljs-keyword">catch</span><font></font>
{<font></font>
    transaction.Rollback();<font></font>
}<font></font>
}<font></font>
</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╣реА рдврдВрдЧ рд╕реЗ</font></font></i><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span>(<span class="hljs-keyword">var</span> db = <span class="hljs-keyword">new</span> NorthwindEntities())<font></font>
{<font></font>
<span class="hljs-keyword">var</span> transaction = db.Database.BeginTransaction();<font></font>
<font></font>
<span class="hljs-keyword">try</span><font></font>
{<font></font>
   <span class="hljs-comment">//  1</span>
    <span class="hljs-keyword">var</span>  obj1 = <span class="hljs-keyword">new</span> Customer();<font></font>
    obj1.CustomerID = <span class="hljs-string">"ABCDE"</span>;<font></font>
    obj1.CompanyName = <span class="hljs-string">"Company 1"</span>;<font></font>
    obj1.Country = <span class="hljs-string">"USA"</span>;<font></font>
    db.Customers.Add(obj1); <font></font>
<font></font>
    <span class="hljs-comment">//   2</span>
    <span class="hljs-keyword">var</span>  obj2 = <span class="hljs-keyword">new</span> Customer();<font></font>
    obj2.CustomerID = <span class="hljs-string">"PQRST"</span>;<font></font>
    obj2.CompanyName = <span class="hljs-string">"Company 2"</span>;    <font></font>
    obj2.Country = <span class="hljs-string">"USA"</span>;<font></font>
    db.Customers.Add(obj2);<font></font>
<font></font>
   <span class="hljs-comment">//    N </span><font></font>
    db.SaveChanges();<font></font>
<font></font>
    transaction.Commit();<font></font>
}<font></font>
<span class="hljs-keyword">catch</span><font></font>
{<font></font>
    transaction.Rollback();<font></font>
}<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдирд┐рдпрдо рдореЗрдВ рд╣рдореЗрд╢рд╛ рдЕрдкрд╡рд╛рдж рд╣реЛрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд▓реЗрдирджреЗрди рдХрд╛ рд╕рдВрджрд░реНрдн рдЬрдЯрд┐рд▓ рд╣реИ, рдЕрд░реНрдерд╛рдд, рдХрдИ рд╕реНрд╡рддрдВрддреНрд░ рд╕рдВрдЪрд╛рд▓рди рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рддреЛ рдЖрдк рдкреНрд░рддреНрдпреЗрдХ рдСрдкрд░реЗрд╢рди рдХреЗ рдмрд╛рдж рдмрдЪрд╛ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдФрд░ рд▓реЗрдирджреЗрди рдореЗрдВ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рднрдВрдбрд╛рд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдФрд░ рднреА рд╕рд╣реА рд╣реИред</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-comment">//    </span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;IActionResult&gt; <span class="hljs-title">AddDepositToHousehold</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> householdId, DepositRequestModel model</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> transaction = <span class="hljs-keyword">await</span> Context.Database.BeginTransactionAsync(IsolationLevel.Snapshot))<font></font>
    {<font></font>
        <span class="hljs-keyword">try</span><font></font>
        {<font></font>
            <span class="hljs-comment">//     </span>
            <span class="hljs-keyword">var</span> deposit = <span class="hljs-keyword">this</span>.Mapper.Map&lt;Deposit&gt;(model);
            <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.Context.Deposits.AddAsync(deposit);<font></font>
<font></font>
            <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.Context.SaveChangesAsync();<font></font>
<font></font>
            <span class="hljs-comment">//    </span>
               <span class="hljs-keyword">var</span> debtsToPay = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.Context.Debts.Where(d =&gt; d.HouseholdId == householdId &amp;&amp; !d.IsPaid).OrderBy(d =&gt; d.DateMade).ToListAsync();<font></font>
<font></font>
            debtsToPay.ForEach(d =&gt; d.IsPaid = <span class="hljs-literal">true</span>);<font></font>
<font></font>
            <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.Context.SaveChangesAsync();<font></font>
<font></font>
            <span class="hljs-comment">//   </span>
            <span class="hljs-keyword">var</span> household = <span class="hljs-keyword">this</span>.Context.Households.FirstOrDefaultAsync(h =&gt; h.Id == householdId);<font></font>
<font></font>
            household.Balance += model.DepositAmount;<font></font>
<font></font>
            <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.Context.SaveChangesAsync();<font></font>
<font></font>
            transaction.Commit();<font></font>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.Ok();<font></font>
        }<font></font>
        <span class="hljs-keyword">catch</span><font></font>
        {<font></font>
            transaction.Rollback();<font></font>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.BadRequest();<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреНрд░рд┐рдЧрд░, рдХрдореНрдкреНрдпреВрдЯреЗрдб рдлрд╝реАрд▓реНрдб, рдХрд╕реНрдЯрдо рдлрд╝рдВрдХреНрд╢рдВрд╕ рдФрд░ EF рдХреЛрд░</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EF Core рд╡рд╛рд▓реЗ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдкрд░ рд▓реЛрдб рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдпрд╣ рд╕рд░рд▓ рдЧрдгрдирд╛ рдХрд┐рдП рдЧрдП рдлрд╝реАрд▓реНрдб рдФрд░ рдбреЗрдЯрд╛рдмреЗрд╕ рдЯреНрд░рд┐рдЧрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдордЭ рдореЗрдВ рдЖрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдирд╣реАрдВ рд╣реЛрдирд╛ рдмреЗрд╣рддрд░ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмрд╣реБрдд рднреНрд░рдорд┐рдд рд╣реЛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдпреВрдЬрд╝рд░-рдбрд┐рдлрд╝рд╛рдЗрдВрдб рдлрд╝рдВрдХреНрд╢рдВрд╕ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рднреНрд░реВрдг рдХреЗ рд╕рдВрдЪрд╛рд▓рди рдХреЗ рджреМрд░рд╛рди рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ!</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдИрдПрдл рдХреЛрд░ рдореЗрдВ рдХрдВрдЬреНрдпреВрд░реЗрдмрд┐рд▓рд┐рдЯреА</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрджрд┐ рдЖрдк рддреЗрдЬреА рд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдм рдХреБрдЫ рд╕рдорд╛рдирд╛рдВрддрд░ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рддреЛрдбрд╝ рджреЗрдВ: рдИрдПрдл рдХреЛрд░ рд╕рдВрджрд░реНрдн рдХреЗ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдХрдИ рд╕рдорд╛рдирд╛рдВрддрд░ рд╕рдВрдЪрд╛рд▓рди рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдЧрд▓рд╛ рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдПрдХ рдСрдкрд░реЗрд╢рди рдХреЗ рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЖрдорддреМрд░ рдкрд░ рдкреНрд░рддреНрдпреЗрдХ рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдСрдкрд░реЗрд╢рди рдореЗрдВ рдкреНрд░рддреАрдХреНрд╖рд╛ рдХреАрд╡рд░реНрдб рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EF Core рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдХрд┐рд╕реА рдХреНрд╡реЗрд░реА рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╕рдордп рдкреНрд░рд╡рд╛рд╣ рдХреЛ рдЕрд╡рд░реБрджреНрдз рдХрд░рдиреЗ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдкреНрд░рд╢реНрдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдЕрдиреБрд░реЛрдз рдореЛрдЯреЗ рдЧреНрд░рд╛рд╣рдХреЛрдВ рдореЗрдВ рддреНрд╡рд░рд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╡реЗ рдПрдХ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдереНрд░реВрдкреБрдЯ рднреА рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд╣рд╛рдВ рдЖрдк рдЕрдиреНрдп рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╕рдВрднрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдереНрд░реЗрдб рдХреЛ рдореБрдХреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣рд╛рдБ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;List&lt;Blog&gt;&gt; GetBlogsAsync()<font></font>
{<font></font>
    <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> context = <span class="hljs-keyword">new</span> BloggingContext())<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> context.Blogs.ToListAsync();<font></font>
    }<font></font>
}</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ рд╕рдВрдХрд▓рд┐рдд рдкреНрд░рд╢реНрдиреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЖрдк рдХреНрдпрд╛ рдЬрд╛рдирддреЗ рд╣реИрдВ?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рдРрд╕рд╛ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рд╣реИ рдЬреЛ рдмрд╛рд░-рдмрд╛рд░ рдЗрдХрд╛рдИ рдврд╛рдВрдЪреЗ рдореЗрдВ рд╕рдВрд░рдЪрдирд╛рддреНрдордХ рд░реВрдк рд╕реЗ рд╕рдорд╛рди рдХреНрд╡реЗрд░реА рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЖрдк рдЕрдХреНрд╕рд░ рдХреНрд╡реЗрд░реА рдХреЛ рдПрдХ рдмрд╛рд░ рд╕рдВрдХрд▓рд┐рдд рдХрд░рдХреЗ рдФрд░ рд╡рд┐рднрд┐рдиреНрди рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рд╕рд╛рде рдХрдИ рдмрд╛рд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдЖрд╡реЗрджрди рдХреЛ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╢рд╣рд░ рдореЗрдВ рд╕рднреА рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ; рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рд╢рд╣рд░ рдХреЛ рд░рдирдЯрд╛рдЗрдо рдХреЗ рд░реВрдк рдореЗрдВ рдЗрдВрдЧрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред LINQ to Entities рдЗрд╕ рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рд▓рд┐рдП рд╕рдВрдХрд▓рд┐рдд рдкреНрд░рд╢реНрдиреЛрдВ рдХреЗ рдЙрдкрдпреЛрдЧ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
.NET рдлреНрд░реЗрдорд╡рд░реНрдХ 4.5 рдХреЗ рд╕рд╛рде рд╢реБрд░реВ, LINQ рдХреНрд╡реЗрд░реАрдЬрд╝ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдХреИрд╢ рдХреА рдЬрд╛рддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЖрдк рдЕрднреА рднреА рдмрд╛рдж рдХреЗ рд░рдиреЛрдВ рдореЗрдВ рдЗрд╕ рд▓рд╛рдЧрдд рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрдХрд▓рд┐рдд LINQ рдкреНрд░рд╢реНрдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рд╕рдВрдХрд▓рд┐рдд рдкреНрд░рд╢реНрди LINQ рдкреНрд░рд╢реНрдиреЛрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ рдХреБрд╢рд▓ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдХреИрд╢ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ EnQerable.Contains рдСрдкрд░реЗрдЯрд░ рдХреЛ рдЗрди-рдореЗрдореЛрд░реА рдХрд▓реЗрдХреНрд╢рдВрд╕ рдкрд░ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рд╡рд╛рд▓реА Entities рд╕реЗ LINQ рдХреНрд╡реЗрд░реАрдЬрд╝ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдХреИрд╢ рдирд╣реАрдВ рдХреА рдЬрд╛рддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕рдВрдХрд▓рд┐рдд LINQ рдкреНрд░рд╢реНрдиреЛрдВ рдореЗрдВ рдЗрди-рдореЗрдореЛрд░реА рдХрд▓реЗрдХреНрд╢рдВрд╕ рдХреЗ рдкреИрд░рд╛рдореАрдЯрд░ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХрдИ рдЙрджрд╛рд╣рд░рдг </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреЗрдЦреЗ рдЬрд╛ рд╕рдХрддреЗ </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">рд╣реИрдВ</font></a><font style="vertical-align: inherit;"> ред</font></font><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрдбрд╝реЗ DbContext рд╕рдВрджрд░реНрднреЛрдВ рдХреЛ рдордд рдмрдирд╛рдУ!</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдореИрдВ рдЖрдк рдореЗрдВ рд╕реЗ рдХрдИ рдХреЛ рдЬрд╛рдирддрд╛ рд╣реВрдВ, рдпрджрд┐ рд▓рдЧрднрдЧ рд╕рднреА рдирд╣реАрдВ, рдЖрд▓рд╕реА f_u__c_k__e_r__s рдФрд░ рдкреВрд░реЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреА, рдЖрдк рдПрдХ рд╕рдВрджрд░реНрдн рдореЗрдВ рд░рдЦрддреЗ рд╣реИрдВ, рдпрд╣ рдбреЗрдЯрд╛рдмреЗрд╕-рдкреНрд░рдердо рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╕рдЪ рд╣реИред </font><font style="vertical-align: inherit;">рдФрд░ рд╡реНрдпрд░реНрде рдореЗрдВ рддреБрдо рдХрд░рддреЗ рд╣реЛ! </font><font style="vertical-align: inherit;">рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рдВрджрд░реНрдн рдХреЛ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИред </font><font style="vertical-align: inherit;">рдмреЗрд╢рдХ, рд╕рдВрджрд░реНрднреЛрдВ рдХреЗ рдмреАрдЪ рдХрдиреЗрдХреНрд╢рди рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЛ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдпрд╣ рдПрдХ рдЛрдг рд╣реИред </font><font style="vertical-align: inherit;">рдПрдХ рддрд░реАрдХрд╛ рдпрд╛ рджреВрд╕рд░рд╛, рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рд╕рдВрджрд░реНрдн рдореЗрдВ 50 рд╕реЗ рдЕрдзрд┐рдХ рдЯреЗрдмрд▓ рд╣реИрдВ, рддреЛ рдЗрд╕реЗ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реЛрдЪрдирд╛ рдмреЗрд╣рддрд░ рд╣реИред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрджрд░реНрдн рд╕рдореВрд╣ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ (DdContext рдХреЛ рд╕рдорддрд▓ рдХрд░рдирд╛)</font></font></h4><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DbContext</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
рдкреВрд▓ </font><font style="vertical-align: inherit;">рдХрд╛ </font><font style="vertical-align: inherit;">рдЕрд░реНрде рдкреВрд▓ </font><font style="vertical-align: inherit;">рд╕реЗ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DbContext</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХрд╛ рдкреБрди: рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдирд╛ рд╣реИ </font><font style="vertical-align: inherit;">, рдЬрд┐рд╕рд╕реЗ рдХреБрдЫ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рд╣рд░ рдмрд╛рд░ рдПрдХ рдирдпрд╛ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдмрдирд╛рдиреЗ рд╕реЗ рдмреЗрд╣рддрд░ рдкреНрд░рджрд░реНрд╢рди рд╣реЛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">ADO.NET рдореЗрдВ рдХрдиреЗрдХреНрд╢рди рдкреВрд▓ рдмрдирд╛рдиреЗ рдХрд╛ рдпрд╣ рднреА рдореБрдЦреНрдп рдХрд╛рд░рдг рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдХрдиреЗрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдкреНрд░рджрд░реНрд╢рди рд▓рд╛рдн рдЕрдзрд┐рдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реЛрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рдХрдиреЗрдХреНрд╢рди рдЖрдорддреМрд░ рдкрд░ рдПрдХ рдХрдард┐рди рд╕рдВрд╕рд╛рдзрди рд╣реЛрддреЗ рд╣реИрдВред</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Diagnostics;
<span class="hljs-keyword">using</span> System.Linq;
<span class="hljs-keyword">using</span> System.Threading;
<span class="hljs-keyword">using</span> System.Threading.Tasks;
<span class="hljs-keyword">using</span> Microsoft.EntityFrameworkCore;
<span class="hljs-keyword">using</span> Microsoft.Extensions.DependencyInjection;<font></font>
<font></font>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Demos</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Blog</span><font></font>
    {<font></font>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> BlogId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Url { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BloggingContext</span> : <span class="hljs-title">DbContext</span><font></font>
    {<font></font>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">long</span> InstanceCount;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">BloggingContext</span>(<span class="hljs-params">DbContextOptions options</span>)
            : <span class="hljs-title">base</span>(<span class="hljs-params">options</span>)</span>
            =&gt; Interlocked.Increment(<span class="hljs-keyword">ref</span> InstanceCount);<font></font>
<font></font>
        <span class="hljs-keyword">public</span> DbSet&lt;Blog&gt; Blogs { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BlogController</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> BloggingContext _context;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">BlogController</span>(<span class="hljs-params">BloggingContext context</span>)</span> =&gt; _context = context;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">ActionAsync</span>(<span class="hljs-params"></span>)</span> =&gt; <span class="hljs-keyword">await</span> _context.Blogs.FirstAsync();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">string</span> ConnectionString<font></font>
            = <span class="hljs-string">@"Server=(localdb)\mssqllocaldb;Database=Demo.ContextPooling;Integrated Security=True;ConnectRetryCount=0"</span>;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)</span><font></font>
        {<font></font>
            services.AddDbContext&lt;BloggingContext&gt;(c =&gt; c.UseSqlServer(ConnectionString));<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> Threads = <span class="hljs-number">32</span>;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> Seconds = <span class="hljs-number">10</span>;<font></font>
<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">long</span> _requestsProcessed;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> serviceCollection = <span class="hljs-keyword">new</span> ServiceCollection();
            <span class="hljs-keyword">new</span> Startup().ConfigureServices(serviceCollection);
            <span class="hljs-keyword">var</span> serviceProvider = serviceCollection.BuildServiceProvider();<font></font>
<font></font>
            SetupDatabase(serviceProvider);<font></font>
<font></font>
            <span class="hljs-keyword">var</span> stopwatch = <span class="hljs-keyword">new</span> Stopwatch();<font></font>
<font></font>
            MonitorResults(TimeSpan.FromSeconds(Seconds), stopwatch);<font></font>
<font></font>
            <span class="hljs-keyword">await</span> Task.WhenAll(<font></font>
                Enumerable<font></font>
                    .Range(<span class="hljs-number">0</span>, Threads)<font></font>
                    .Select(_ =&gt; SimulateRequestsAsync(serviceProvider, stopwatch)));<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SetupDatabase</span>(<span class="hljs-params">IServiceProvider serviceProvider</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> serviceScope = serviceProvider.CreateScope())<font></font>
            {<font></font>
                <span class="hljs-keyword">var</span> context = serviceScope.ServiceProvider.GetService&lt;BloggingContext&gt;();<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (context.Database.EnsureCreated())<font></font>
                {<font></font>
                    context.Blogs.Add(<span class="hljs-keyword">new</span> Blog { Name = <span class="hljs-string">"The Dog Blog"</span>, Url = <span class="hljs-string">"http://sample.com/dogs"</span> });<font></font>
                    context.Blogs.Add(<span class="hljs-keyword">new</span> Blog { Name = <span class="hljs-string">"The Cat Blog"</span>, Url = <span class="hljs-string">"http://sample.com/cats"</span> });<font></font>
                    context.SaveChanges();<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">SimulateRequestsAsync</span>(<span class="hljs-params">IServiceProvider serviceProvider, Stopwatch stopwatch</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">while</span> (stopwatch.IsRunning)<font></font>
            {<font></font>
                <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> serviceScope = serviceProvider.CreateScope())<font></font>
                {<font></font>
                    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> BlogController(serviceScope.ServiceProvider.GetService&lt;BloggingContext&gt;()).ActionAsync();<font></font>
                }<font></font>
<font></font>
                Interlocked.Increment(<span class="hljs-keyword">ref</span> _requestsProcessed);<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MonitorResults</span>(<span class="hljs-params">TimeSpan duration, Stopwatch stopwatch</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> lastInstanceCount = <span class="hljs-number">0L</span>;
            <span class="hljs-keyword">var</span> lastRequestCount = <span class="hljs-number">0L</span>;
            <span class="hljs-keyword">var</span> lastElapsed = TimeSpan.Zero;<font></font>
<font></font>
            stopwatch.Start();<font></font>
<font></font>
            <span class="hljs-keyword">while</span> (stopwatch.Elapsed &lt; duration)<font></font>
            {<font></font>
                <span class="hljs-keyword">await</span> Task.Delay(TimeSpan.FromSeconds(<span class="hljs-number">1</span>));<font></font>
<font></font>
                <span class="hljs-keyword">var</span> instanceCount = BloggingContext.InstanceCount;
                <span class="hljs-keyword">var</span> requestCount = _requestsProcessed;
                <span class="hljs-keyword">var</span> elapsed = stopwatch.Elapsed;
                <span class="hljs-keyword">var</span> currentElapsed = elapsed - lastElapsed;
                <span class="hljs-keyword">var</span> currentRequests = requestCount - lastRequestCount;<font></font>
<font></font>
                Console.WriteLine(<font></font>
                    <span class="hljs-string">$"[<span class="hljs-subst">{DateTime.Now:HH:mm:ss.fff}</span>] "</span>
                    + <span class="hljs-string">$"Context creations/second: <span class="hljs-subst">{instanceCount - lastInstanceCount}</span> | "</span>
                    + <span class="hljs-string">$"Requests/second: <span class="hljs-subst">{Math.Round(currentRequests / currentElapsed.TotalSeconds)}</span>"</span>);<font></font>
<font></font>
                lastInstanceCount = instanceCount;<font></font>
                lastRequestCount = requestCount;<font></font>
                lastElapsed = elapsed;<font></font>
            }<font></font>
<font></font>
            Console.WriteLine();<font></font>
            Console.WriteLine(<span class="hljs-string">$"Total context creations: <span class="hljs-subst">{BloggingContext.InstanceCount}</span>"</span>);<font></font>
            Console.WriteLine(<font></font>
                <span class="hljs-string">$"Requests per second:     <span class="hljs-subst">{Math.Round(_requestsProcessed / stopwatch.Elapsed.TotalSeconds)}</span>"</span>);<font></font>
<font></font>
            stopwatch.Stop();<font></font>
        }</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EF рдХреЛрд░ рдореЗрдВ CRUD рдХреЗ рд╕рд╛рде рдЕрдирд╛рд╡рд╢реНрдпрдХ рддреНрд░реБрдЯрд┐рдпреЛрдВ рд╕реЗ рдХреИрд╕реЗ рдмрдЪреЗрдВ?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХрднреА рднреА рдПрдХ рд╣реА рдХреЛрдб рдореЗрдВ рдЧрдгрдирд╛ рди рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдХрд┐рд╕реА рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рдЧрдарди / рддреИрдпрд╛рд░реА рдФрд░ рдЙрд╕рдХреЗ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ / рдЕрджреНрдпрддрди рдХреЛ рд╣рдореЗрд╢рд╛ рдЕрд▓рдЧ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдмрд╕ рдЗрд╕реЗ рдлрд╝рдВрдХреНрд╢рди рджреНрд╡рд╛рд░рд╛ рдлреИрд▓рд╛рдПрдВ: рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рджрд░реНрдЬ рдХрд┐рдП рдЧрдП рдбреЗрдЯрд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдирд╛, рдЖрд╡рд╢реНрдпрдХ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдбреЗрдЯрд╛ рдХреА рдЧрдгрдирд╛ рдХрд░рдирд╛, рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдореИрдк рдХрд░рдирд╛ рдпрд╛ рдмрдирд╛рдирд╛ рдФрд░ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕реАрдЖрд░рдпреВрдбреА рдСрдкрд░реЗрд╢рдиред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпрд╛ рдХрд░реЗрдВ рдЬрдм рдЖрд╡реЗрджрди рдкреНрд░рджрд░реНрд╢рди рдХреЗ рд╕рд╛рде рдЪреАрдЬреЗрдВ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЦрд░рд╛рдм рд╣реИрдВ?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдмреАрдпрд░ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдпрд╣рд╛рдБ рдорджрдж рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЬреЛ рдорджрдж рдХрд░реЗрдЧрд╛ рд╡рд╣ рд╣реИ рдПрдкреНрд▓реАрдХреЗрд╢рди рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдореЗрдВ рдкрдврд╝рдиреЗ рдФрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдЬреБрджрд╛рдИ, рдЗрд╕рдХреЗ рдмрд╛рдж рд╕реЙрдХреЗрдЯреНрд╕ рдкрд░ рдЗрди рдСрдкрд░реЗрд╢рдВрд╕ рдХрд╛ рдЖрд╡рдВрдЯрдиред </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрдорд╛рдВрдб рдФрд░ рдХреНрд╡реЗрд░реА рд░рд┐рд╕реНрдкреЙрдиреНрд╕рд┐рдмрд┐рд▓рд┐рдЯреА рд╕реЗрдЧреНрд░рд┐рдЧреЗрд╢рди (CQRS) рдкреИрдЯрд░реНрди</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реЛрдЪреЗрдВ </font><font style="vertical-align: inherit;">, рдФрд░ рджреЛ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рдмреАрдЪ рдбрд╛рд▓рдиреЗ рдФрд░ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдЯреЗрдмрд▓ рдХреЛ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рдиреЗ рдХрд╛ рднреА рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдк, рджреЛрд╕реНрддреЛрдВ рдФрд░ рд╕рд╣рдХрд░реНрдорд┐рдпреЛрдВ рдХреЛ рдЧрддрд┐ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ!</font></font></i></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi487716/index.html">рдмрд┐рд▓реНрдХреБрд▓ рд╕рд╣реАред рдкрд╛рд░реНрд╕рд░</a></li>
<li><a href="../hi487720/index.html">рдкреНрд░рддрд┐рд╕реНрдкрд░реНрдзреА рдзрдирд╡рд╛рдж рдкрд░ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рд╢реАрд▓ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ)</a></li>
<li><a href="../hi487724/index.html">BlazingPizza: рд╢реБрд░реВ рд╕реЗ рдЕрдВрдд рддрдХ рдмреНрд▓реЗрдЬрд╝рд░ рдРрдкред рднрд╛рдЧ 2. рдПрдХ рдШрдЯрдХ рдЬреЛрдбрд╝реЗрдВ</a></li>
<li><a href="../hi487728/index.html">@ рдкрд╛рдпрдердирдЯреЗрдХ рд╕рдВрдХрд▓рди, рдЬрдирд╡рд░реА 2020</a></li>
<li><a href="../hi487730/index.html">рдкреНрд░рд╛рдХреГрддрд┐рдХ рднрд╛рд╖рд╛ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдгред рдкрд░рд┐рдгрд╛рдо 2019 рдФрд░ рд░реБрдЭрд╛рди 2020 рдХреЗ рд▓рд┐рдП</a></li>
<li><a href="../hi487738/index.html">рд╕реНрдХреАрдорд╛ рдПрдиреАрдореЗрд╢рди SCADA рдореЗрдВ</a></li>
<li><a href="../hi487740/index.html">рдПрдХ рдкреЛрд░реНрдЯреЗрдмрд▓ рдореИрдЧреНрдиреЗрдЯреЛрдореАрдЯрд░ рдХреЛ рдЗрдХрдЯреНрдард╛ рдХрд░рдирд╛</a></li>
<li><a href="../hi487742/index.html">рдЖрд░реНрдмрд┐рдЯреНрд░реЗрдЬ рдЯреНрд░реЗрдбрд┐рдВрдЧ (рдмреЗрд▓рдореИрди-рдлреЛрд░реНрдб рдПрд▓реНрдЧреЛрд░рд┐рдердо)</a></li>
<li><a href="../hi487744/index.html">FARO FOCUS S 70 рд▓реЗрдЬрд░ 3 рдбреА рд╕реНрдХреИрдирд░ рдХрд╛ рдкрд░рд┐рдЪрдп рджреЗрддрд╛ рд╣реИ</a></li>
<li><a href="../hi487746/index.html">рд╕рдирд╛рддрди</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>