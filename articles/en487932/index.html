<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéç üö∂ üë©üèª‚Äç‚öñÔ∏è Ideal normal maps for Unity (and other programs) üë©üèª‚Äç‚öïÔ∏è ‚õ∞Ô∏è üë©üèª‚Äç‚úàÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="... and how to figure out what's wrong with your content creation pipeline.
 
 
 Let's say you have an amazing high-poly model that the artist has wor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Ideal normal maps for Unity (and other programs)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487932/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... and how to figure out what's wrong with your content creation pipeline.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/89e/6f3/877/89e6f38773acdefc8f2680cf7bfd223a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's say you have an amazing high-poly model that the artist has worked on, and you want to put it into the game. </font><font style="vertical-align: inherit;">The artist showed screenshots of the model in his program and they look amazing. </font><font style="vertical-align: inherit;">Even after baking normal maps for the low-poly version, it still looks great.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3a4/810/be8/3a4810be8abd5ad6cb24fca98ee9e61c.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">See the greatness of this traditional model for testing normal maps! </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then the artist puts her in the game, and she looks ... a little wrong.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/350/fa2/e70/350fa2e7020b28db82bf99958d10f958.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shouldn't these faces be flat? </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The surfaces, which should be flat, are still a little rounded, some are even depressed, and even worse, strange stripes go along them. </font><font style="vertical-align: inherit;">Familiar situation? </font><font style="vertical-align: inherit;">Some of you probably came across it, thought: ‚ÄúWell, probably, it won‚Äôt work out better‚Äù, and moved on. </font><font style="vertical-align: inherit;">Perhaps a little dirt was applied to mask the most severe cases. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But there is actually something wrong with your content creation pipeline. </font><font style="vertical-align: inherit;">This is not always obvious, but the problem can be solved! * </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* If you assume that in some cases you can make changes to the content pipeline.</font></font></i><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foreword</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This article is about how to export ideal normal maps from other applications for use in Unity 5.3 and higher. </font><font style="vertical-align: inherit;">It does not talk about how to get high-quality normal maps, there are many other tutorials for this, so I won‚Äôt touch on this topic.</font></font><br>
<br>
<hr><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tangent space basis</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The problem is how the normal maps of the tangent space work. In particular, how does the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tangent space</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (or tangent basis) work. I will not go too far into the technical aspects of what they do. I, like other authors, have already </font></font><a rel="noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">talked about this</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but in short, the tangent space determines what the orientation of the direction in the normal map should represent. Which direction on the normal map is actually ‚Äúforward‚Äù, ‚Äúup‚Äù or ‚Äúright‚Äù. Roughly speaking, this orientation is the orientation of the UV coordinates of the texture and normals of the vertices. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is more important to understand that the program used to bake the normal map from the highpoly mesh to the lowpoly mesh must calculate its tangent space</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exactly the same as the program in which normal maps will be used</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Since different programs can use tangent space in different ways, normal baked maps for a mesh will not necessarily be the same for all applications. </font><font style="vertical-align: inherit;">Even for applications using the same tangent space!</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Know your enemy</font></font></h1><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coup due to obvious mistake</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The most common mistake is the ‚ÄúOpenGL vs Direct3D‚Äù problem. </font><font style="vertical-align: inherit;">They are also called normal maps Y + and Y-. </font><font style="vertical-align: inherit;">I included them here just for completeness. </font><font style="vertical-align: inherit;">Most likely, most people who have encountered this problem already know about it, or at least learned how to solve it. </font><font style="vertical-align: inherit;">Since normal maps are generated in one orientation, they are essentially useless for use in an application designed to use another.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/39a/064/afd/39a064afd8830af08c8841d279e234bc.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Normal maps in Direct3D orientation in the Unity engine, which expects an OpenGL orientation.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
This can be understood by the fact that the lighting seems to be inverted or falling from the other side, but only in some lighting directions. Some corners or faces may look completely normal until you move the light source.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And with this problem, everything is clear enough. </font><font style="vertical-align: inherit;">Most normal map baking applications have a nice large button or menu to switch between OpenGL / Direct3D or Y orientation option. Find out what orientation the target application uses and bake maps in it. </font><font style="vertical-align: inherit;">Unity uses OpenGL and Y +. </font><font style="vertical-align: inherit;">Unreal uses Direct3D and Y-. </font><font style="vertical-align: inherit;">This can be clearly understood by looking at the texture of the normal map itself. </font><font style="vertical-align: inherit;">If it seems that in the green channel they are lit "from above", then this is OpenGL orientation. </font><font style="vertical-align: inherit;">If from below, then this is Direct3D.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oddities with sRGB</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another common mistake is to use a texture marked as sRGB texture. This changes the way the GPU texture is sampled, forcing it to convert color values ‚Äã‚Äãfrom the sRGB space, from which people usually select color values, to a linear color space. For normal maps, this is not necessary. If you set the type to ‚ÄúNormal map‚Äù for the texture in Unity, the engine will automatically disable this option, but you can also disable the ‚ÄúsRGB (Color Texture)‚Äù option manually, and the texture will work as a normal map. At least in Unity 2017.1 and newer.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eed/4fa/006/eed4fa006eb6dc4cb232b61f6df0d95d.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Normal map with Default texture type and sRGB enabled.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
This problem can be recognized by the fact that normal maps are strongly biased in one direction. </font><font style="vertical-align: inherit;">In this model, almost every face looks as if it is directed towards a light source. </font><font style="vertical-align: inherit;">Obviously, this will not always be the case. </font><font style="vertical-align: inherit;">In a more detailed normal map, all parts will respond to lighting almost correctly, but slightly shift to some angle. </font><font style="vertical-align: inherit;">Sometimes it may look as if the entire surface of the mesh is distorted.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Too different to be normal</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another common problem is the use of different normal baking meshes in the game asset. </font><font style="vertical-align: inherit;">As with tangents, for everything to work, they must </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exactly</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> match. </font><font style="vertical-align: inherit;">This error often occurs if artists export meshes with incorrect vertex normals. </font><font style="vertical-align: inherit;">In this case, any application that opens the mesh will have to calculate them yourself. </font><font style="vertical-align: inherit;">There is no one right way to solve it, it all depends on the mesh, so make sure that you (or artists) export the model with the final normals!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/26b/196/2f9/26b1962f97b26c1f90e1143007844e30.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Normal maps baked on a smoothed mesh, displayed as on a mesh with sharp edges</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/970/07c/51d/97007c51d1aea9f42e5971e1a3d79ef6.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Normal maps baked on a mesh with sharp edges, displayed as on a smoothed mesh</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is another problem that is easy to spot. If the model should look like it has sharp edges, but the shading bends from these edges, then this means that you baked the normal map with smooth normals, but they are rendered on a mesh with a sharp edge. If the shading bends towards the edge, this means that the map was baked with a sharp edge and rendered on a smooth edge. In fact, in one model both cases may be present, because it is possible to indicate the smoothness or sharpness of individual edges, and even the degree of smoothness. But in fact, they are guaranteed to be erroneous if you allow another application to guess how it should be. The model presented above is an extreme case, and often everything is not so obvious, because large parts of the model may look completely normal. But in the general case,if you have several edges that look particularly strange, then this is probably due to a mismatch in the vertex normals.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MikkTSpace vs Autodesk</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A less noticeable problem is that when baking 3ds Max or Maya normal maps, they will always be incorrect in the Unity engine. </font><font style="vertical-align: inherit;">They will be wrong in Unreal, and in almost any other program, except for the one in which they were baked. </font><font style="vertical-align: inherit;">3ds Max normal maps do not work in Maya, and vice versa! </font><font style="vertical-align: inherit;">Each of these applications calculates tangent space in its own unique way, which does not correspond to other applications. </font><font style="vertical-align: inherit;">When used independently, they look </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perfect</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and if you generate normal maps for use in these programs, then try to bake normal maps in them. </font><font style="vertical-align: inherit;">Almost no </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">other</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> program is capable of baking the correct normal maps for these applications, so you seem to have no choice.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The only solution in this case is not to bake normal maps with these applications if you want to use them somewhere else. </font><font style="vertical-align: inherit;">If you need a free program, then use </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="noopener nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xNormal</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">This is an industry standard tool. </font><font style="vertical-align: inherit;">If you use Substance somewhere in the content creation pipeline, use it.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/350/fa2/e70/350fa2e7020b28db82bf99958d10f958.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3ds Max baked the normal map used by Unity The</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
easiest way to notice this problem is to see that flat faces have small dents or curvature. </font><font style="vertical-align: inherit;">In some cases, this can be very inconspicuous, especially in organic objects. </font><font style="vertical-align: inherit;">Therefore, problems of this kind often go unnoticed. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Many non-Autodesk applications have switched to a tangent space calculation method called </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="noopener nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MikkTSpace.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Both xNormal and Substance, as well as Blender, Unity, Unreal, Godot, Marmoset, Houdini, Modo and some others, by default use MikkTSpace or at least somehow support it, which greatly improves their compatibility. </font><font style="vertical-align: inherit;">In fact, over the past ten years, it has actually become the industry standard in all cases when normal maps of tangent space are used. </font><font style="vertical-align: inherit;">Presumably, at some point, 3ds Max will add their support, but it is unclear whether the developers plan to allow baking normal maps using MikkTSpace or simply provide support for viewing / rendering with their help.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Export Meshes and Substance Painter</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another problem with 3ds Max and Maya is that when exporting meshes from them there is an export option with ‚Äútangents and binormals‚Äù. They will not be in the actual tangents of MikkTSpace, but will be based on them. Some applications force-recalculate the correct MikkTSpace by default (for example, xNormal, Unity, and Unreal), but other applications use tangent meshes (if any) ‚Äúas they are‚Äù and compute MikkTSpace only if the mesh has no tangents. For example, Substance Painter uses tangent meshes if they are present as they are, that is, Painter creates normal maps very similar to baked 3ds Max! Similar, but not quite the same, so if you import them back into 3ds Max, they will not look as good as baked in Max.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MikkTSpace vs MikkTSpace?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The next problem is that there is more than one version of MikkTSpace! </font><font style="vertical-align: inherit;">Yes, that would not be the standard if </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">somehow it</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> did not introduce confusion. </font><font style="vertical-align: inherit;">MikkTSpace determines how the data should be stored in the mesh for each vertex, and how the data is used for rendering. </font><font style="vertical-align: inherit;">All MikkTSpace-enabled applications compute the same mesh data for vertices. </font><font style="vertical-align: inherit;">But there are two different ways to </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">use</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> this data in rendering. </font><font style="vertical-align: inherit;">MikkTSpace defines how to calculate the tangent vector and sign for each vertex based on the UV orientation. </font><font style="vertical-align: inherit;">But when using tangent space, the tangent to two points (bitangent) is recalculated either for each vertex or for each pixel. </font><font style="vertical-align: inherit;">This parameter should also be the same for baking and viewing.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
xNormal and Substance have the option to bake normal maps using both methods. These options are called ‚Äúcompute tangent space per fragment‚Äù in Substance and ‚Äúcompute binormal in the pixel shader‚Äù in xNormal. </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You do not need to</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> use it if you are baking for the built-in Unity rendering methods. However, it might </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">be worth</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> doing this for SRP, depending on the type you choose!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dc8/288/f49/dc8288f495d420416d8bd2ee5ae401c3.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XNormal ‚Äúpixel shader binormals‚Äù with built-in forward renderer Unity</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Visually, this looks like using a completely different tangent space, but is usually much less pronounced. Some faces may look as if the normal is a little distorted, and will not have a large dent. The solution here is very simple - do not select this option if you are baking for Unity's built-in rendering methods. Check the box if you bake Unreal or Unity engines for HDRP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Many sources say that Blender and Unity are identical, but in fact this is never true! Blender, like Unity, uses MikkTSpace and OpenGL orientation, but, like Unreal, uses binormals for each fragment binomals.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The good news is that now the LWRP, URP and Shader Graph shaders use binormals for each vertex, and the built-in HDRP shaders for each pixel. </font><font style="vertical-align: inherit;">In a future update of Shader Graph (7.2.0), the transition to pixel-by-pixel computing will be performed, and after some time, the built-in URP shaders will also switch to it. </font><font style="vertical-align: inherit;">And standard rendering methods can be changed using your own shaders, if you choose such a route.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Triangulate, triangulate, triangulate!</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The last problem is different ways of triangulating. </font><font style="vertical-align: inherit;">If you export meshes without preliminary triangulation, then there is no guarantee that other applications will triangulate the model in the same way. </font><font style="vertical-align: inherit;">This also harms normal maps! </font><font style="vertical-align: inherit;">Therefore, triangulate the meshes, either using the export options, or through the triangulation modifier.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/271/14f/174/27114f17454f66db812ec2673e72d97c.png"></div><br>
<i>  Substance Painter  ,   Unity  ,   3ds Max   (quads)</i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This appears very similar to a completely wrong tangent space, as if normal maps were baked in 3ds Max. But in the general case, they are a little sharper, almost bent, and do not look like smooth concavity. In this mesh, an X-shape is visible on the outer faces. This problem can be difficult and annoying when several people are working with the model in the content production pipeline in different applications, because it is often useful not to triangulate the mesh and save beautiful polygons. In this case, you have to either come to terms with the inconvenience, or make the last tool in the pipeline before exporting the model to the game also used to generate a mesh used for baking normals. Like a tangent space with normals of vertices (which are part of the tangent space),triangulation must also match exactly.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">List for creating perfect normal maps for Unity</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, here are tips for generating tangent space normal maps for lowpoly meshes from the original highpoly models for use in Unity:</font></font><br>
<br>
<ul>
<li><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No need to</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bake normal maps using 3ds Max, Maya or any other application that does not have the tangent option </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MikkTSpace</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Export meshes as </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">triangles</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , with </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">normals</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and </font></font><strong><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tangents.</font></font></strong></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Choose </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenGL</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or X + </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y +</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Z + as the orientation of the normal map when baking (as well as when creating a project for Substance Painter).</font></font></li>
<li><strong><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You do not need to</font></font></em> </strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> enable the options of tangents to the two points "</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> per pixel</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " / "</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> per fragment</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " when baking for the built-in rendering methods (proactive or deferred) or LWRP.</font></font></li>
<li><strong><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Include</font></font></em></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> options for tangents to the two</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äúper pixel‚Äù</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> /</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äúper fragment‚Äù</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> points</font><font style="vertical-align: inherit;">when baking for HDRP, and soon for URP.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leave the default model import options for Unity, with the normals set to ‚ÄúImport‚Äù and the tangents to ‚ÄúCalculate Mikktspace‚Äù.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That's all! </font><font style="vertical-align: inherit;">Every time you get perfectly baked normal maps!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3a4/810/be8/3a4810be8abd5ad6cb24fca98ee9e61c.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hooray! </font><font style="vertical-align: inherit;">The perfect normal map!</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bed/daa/477/beddaa477b105ae87e6dda113381e910.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... with reflections? </font><font style="vertical-align: inherit;">Ahem ..</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Well, the last one, we just ignore it. </font><font style="vertical-align: inherit;">As ‚Äúperfect‚Äù as possible with compressed texture formats with 8 bits per channel. </font><font style="vertical-align: inherit;">A dithering normal map may look a little better than stripes, but, unfortunately, not many tools provide this option. </font><font style="vertical-align: inherit;">Otherwise, you can use 16-bit normal maps. </font><font style="vertical-align: inherit;">But this is a topic for another article.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Learn more about MikkTSpace.</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The semi-official site of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="noopener nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mikktspace.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> explains the key benefits of MikkTSpace well. In particular, this space works well both for recounting and for transferring tangent data between programs with different mesh processing, while maintaining the integrity of the results. The site text is a copy of the already defunct Blender wiki page written by Morten S. Mikkelsen himself. Unfortunately, it only mentions the version with tangents to two points for each pixel, but not the version for each vertex, the default used by Unity and xNormal. Since Blender uses derivatives of per-pixel tangents, it is logical that only they are mentioned. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here are comments about these two options from the original </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="noopener nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mikktspace.h</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<blockquote>           ,    /.<br>
<br>
<code>bitangent = fSign * cross(vN, tangent);</code><br>
<br>
‚Ä¶<br>
<br>
    (/    )     ,          .<br>
<br>
,   ,       ,    ¬´¬ª  ,       : vT, vB  vN.<br>
<br>
  (  )<br>
<br>
<code>vNout = normalize( vNt.x * vT + vNt.y * vB + vNt.z * vN );</code><br>
<br>
 vNt ‚Äî    .         ¬´¬ª ,       ,    .<br>
<br>
‚Ä¶<br>
<br>
         ,     ,   ,        .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, in the original example, the tangent to two points is recreated in the vertex shader and passed to the pixel shader as another interpolated value. This is how the normal Unity shaders currently handle normal maps. An example of performing this task in a pixel shader is more an impromptu rather than a ‚Äúmain‚Äù example. In addition, since the implementation for Unity 5.3 (and xNormal?) Was created by Morten S. Mikkelsen himself, and both use tangents for each vertex, this is another proof of our theory. But then Blender used pixel-by-pixel tangents, and Morten was also involved. Probably, in fact, it was just an option that caused small changes in the finished Unity shaders, and while for real-time graphics, none of the methods were considered much better than the other.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The advantage of pixel-by-pixel implementation is the elimination of two interpolated values ‚Äã‚Äãat the cost of a little extra cost to ALU (pixel shader math). This means that instead of the three values ‚Äã‚Äãof Vector3 (tangent, tangent to two points and the normal), we only need Vector4 and Vector3 (tangent with a sign and normal). On modern GPUs, this is slightly faster. And it is </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definitely</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> faster when executed in the CPU, since it can be used for non-real-time renderers. From this point of view, it is logical that most of the industry decided to recreate the tangent to two points in the pixel, and not at the top.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It's funny that when I wrote this article, Morten promoted the transition in Unity SRP to pixel by pixel tangents to two points! </font><font style="vertical-align: inherit;">It‚Äôs just a bad luck that Unity‚Äôs built-in rendering methods have a legacy of inconvenient choices.</font></font><br>
<br>
<hr><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tangent space in different applications</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Although this article focuses mainly on Unity, since today this engine has become mainstream, I wanted my study to be more detailed. </font><font style="vertical-align: inherit;">Therefore, I created a list of various applications with information about the use of tangent space.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity (5.3+)</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Orientation:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OpenGL Y + </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tangent space:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MikkTSpace </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calculation of tangents to two points for MikkTSpace:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for vertices or for pixels * </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notes:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">by default, the engine forcibly redefines the tangents of the mesh upon import to use MikkTSpace. For advanced users, it has options for using tangent mesh, but this does not guarantee compatibility with normal maps baked in other tools, especially when using built-in shaders. They can be replaced with completely own shaders. And for its built-in shaders, HDRP uses pixel-by-pixel tangents to two points. At the time of writing, it was planned that the URP and Shader Graph shaders will also switch to pixel-by-pixel tangents to two points. Prior to Unity 5.3, the engine used </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=http://web.archive.org/web/20160306000702/" rel="noopener nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lengyel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tangents </font><font style="vertical-align: inherit;">, which can still be used by selecting the Legacy Tangents option in the mesh importer, but the built-in shaders no longer support this tangent space.</font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Addition: before URP 7.2.0 the processing of normal maps in Shader Graph was completely broken! </font><font style="vertical-align: inherit;">Neither MikkTSpace nor even the Lengyel tangent space is used correctly, and it is impossible to fix this inside the Shader Graph. </font><font style="vertical-align: inherit;">If possible, upgrade to 7.2.0.</font></font></em><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unreal engine 4</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Orientation:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Direct3D Y- </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tangent space:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MikkTSpace </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calculation of tangents to two points for MikkTSpace:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pixel by pixel </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notes:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> by default, the engine redefines tangents of the mesh when importing using MikkTSpace. </font><font style="vertical-align: inherit;">For advanced users, it has options for using a tangent mesh, but this does not guarantee compatibility with normal maps baked in other tools.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Godot</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Orientation:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OpenGL Y + </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tangent space:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MikkTSpace </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calculation of tangents to two points for MikkTSpace:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for each vertex </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notes:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> if there is no tangent data, it can compute tangent meshes in MikkTSpace upon import. </font><font style="vertical-align: inherit;">The engine documentation suggests exporting tangent mesh meshes, but since most tools do not export the correct tangent mesh, I would ignore this tip. </font><font style="vertical-align: inherit;">Even if you use the original tangent mesh, there is no guarantee that normal maps will look right.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Playcanvas</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Orientation:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OpenGL Y + </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tangent space: </font></font></strong> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=http://web.archive.org/web/20160306000702/" rel="noopener nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lengyel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="noopener nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sch√ºler</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calculation of tangents to two points:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for each vertex / based on derivatives </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notes:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> provides several methods for processing tangent space. Code generated tangents do not use MikkTSpace. It has options for using a tangent to two points for each vertex that either normalize the tangent space vectors in the ‚ÄúfastTbn‚Äù pixel shader </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">without normalizing the</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tangent space in the fragment shader (which we </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">need</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, since this corresponds to the implementation of MikkTSpace with a calculation for each vertex), or they use the derivative-based TBN, borrowed from </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="noopener nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Christian Schuler</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">it completely ignores the tangent of the mesh and calculates the tangent space in the pixel shader. </font><font style="vertical-align: inherit;">Now, by default, derivatives-based normal maps are used, for which, as far as I know, there are no tools for baking exact normal maps. </font><font style="vertical-align: inherit;">It‚Äôs possible that you can import meshes with existing normals and tangent data from MikkTSpace, and then use the ‚ÄúfastTbn‚Äù material option to match Unity‚Äôs built-in rendering methods, but I believe this should be done in code, not through the editor interface.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Filament</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Orientation:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OpenGL Y + </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tangent space:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MikkTSpace </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calculation of tangents to two points for MikkTSpace:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for each vertex </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notes:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> depending on performance in the future, the engine may go to pixel-by-pixel tangents to two points.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3ds max</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Orientation:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Direct3D Y- * </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tangent space:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> native </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mesh export options:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> export FBX files with Triangulate turned on, but Tangents and Binormals turned off. </font><font style="vertical-align: inherit;">Normals must always be exported. </font><font style="vertical-align: inherit;">Split per-vertex Normals can be left disabled. </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notes:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> By default, 3ds Max assumes that Direct3D orientation is used in normal maps, but has options for flipping X and Y orientations when using normal map textures on materials. </font><font style="vertical-align: inherit;">Baking always uses Direct3D orientation. </font><font style="vertical-align: inherit;">MikkTSpace support will appear in future versions.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maya</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Orientation:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OpenGL Y + </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tangent space:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> native </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mesh export options:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> export FBX files with Triangulate turned on, but Tangents and Binormals turned off. </font><font style="vertical-align: inherit;">Normals are always exported. </font><font style="vertical-align: inherit;">Split per-vertex Normals can be left disabled. </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notes:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> some people have told me that Maya partially already supports MikkTSpace, but I don‚Äôt know to what extent.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blender (2.57+)</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Orientation:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OpenGL Y + </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tangent space:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MikkTSpace </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calculation of tangents to two points for MikkTSpace:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for each pixel </font><strong><font style="vertical-align: inherit;">Mesh </font></strong></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">export options:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> export FBX files with a Smoothing value of "Normals Only". </font><font style="vertical-align: inherit;">You can export with or without Tangent Space if the target application also uses MikkTSpace, such as Unity or Unreal. </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notes:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Blender does not have a triangulation option when exporting to FBX, so use the Triangulate modifier first. </font><font style="vertical-align: inherit;">Normal maps baked in Blender will not be 100% compatible with Unity, but if you flip the green channel in a third-party application or in customized material, then they work perfectly in Unreal.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xNormal (3.17.5+)</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Orientation:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> customizable </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tangent space:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MikkTSpace * </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calculation of tangents to two points for MikkTSpace:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> customizable (for each vertex or pixel) </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Options for baking normal maps:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">has options for flipping all three axes of the normal map during export. Unity needs X + Y + Z +. There is also the option of using tangents to two points for each vertex or pixel (i.e. fragment). By default, xNormal uses tangents to two points for each vertex, but this can be changed in the Plugins Manager menu (power plug icon in the lower left corner) by clicking on ‚ÄúTangent basis calculator‚Äù, ‚ÄúMikk - TSpace‚Äù and clicking on Configure. A pop-up window will appear with the only option ‚ÄúCompute binormal in the pixel shader‚Äù. It must be turned off for Unity and turned on for Unreal. </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notes:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">although xNormal only supports MikkTSpace, its plugin system theoretically supports any tangent space. </font><font style="vertical-align: inherit;">So far, the only tangent space plugin I know is designed to bake the Unity 4 tangent space and is already useless. </font><font style="vertical-align: inherit;">That is, if approached realistically, the application only supports MikkTSpace.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Substance painter</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Orientation:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> customizable (OpenGL or Direct3D) </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tangent space:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MikkTSpace </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calculation of tangents to two points for MikkTSpace:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> customizable (for vertices or pixels) </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Baking options for normal maps:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> has baking options in OpenGL or Direct3D orientation. And an option for using tangents to two points for each vertex or pixel (fragment), which is configured by the ‚ÄúCompute tangent space per fragment‚Äù parameter. When exporting for built-in Unity rendering methods, you need to select OpenGL and disable Compute tangent space per fragment in the project and export options, and when exporting to Unreal or Unity HDRP, do the opposite. </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notes:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Substance Painter by default uses the tangent data that the imported mesh uses. </font><font style="vertical-align: inherit;">Unless you are exporting from Blender, you do not need it! </font><font style="vertical-align: inherit;">But there are no options to disable this feature. </font><font style="vertical-align: inherit;">Before importing into Substance Painter, export meshes </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">without</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tangents. </font><font style="vertical-align: inherit;">Earlier in the Substance documentation, it was mistakenly claimed that the calculations of tangents to two points </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
in Blender correspond to Unity, but now the error has been fixed!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Marmoset Toolbag 3</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Orientation:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> custom </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tangent space:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> custom </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calculation of tangents to two points for MikkTSpace:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pixel by pixel </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notes:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> it looks like the program has options for viewing or baking normal maps in almost any existing configuration. </font><font style="vertical-align: inherit;">Including ready-made settings for tangent spaces 3ds Max and Maya! </font><font style="vertical-align: inherit;">However, the tangent space option ‚ÄúMikk / xNormal‚Äù uses pixel-by-pixel tangents to two points, and this cannot be changed. </font><font style="vertical-align: inherit;">That is, the Marmoset Toolbag 3 cannot properly view or bake normal maps for the built-in Unity rendering methods. </font><font style="vertical-align: inherit;">Perhaps in future versions the situation will change, because developers are aware of the problem.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3DCoat</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Orientation:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> custom </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tangent space:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> custom </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calculation of tangents to two points for MikkTSpace</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :? </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notes: It</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> has many options for viewing and baking normal maps. </font><font style="vertical-align: inherit;">It is perfectly capable of matching Blender and UE4, therefore it supports pixel-by-pixel tangents to two points, but I do not know if vertex tangents to two points are used in the Unity preset.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Houdini (16.0.514+)</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Orientation:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> customizable </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tangent space:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> customizable * </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calculation of tangents to two points for MikkTSpace:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pixel by pixel </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notes:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> supports its own basis of tangents or MikkTSpace, both for viewing and for baking, but only in the pixel-by-pixel version. </font><font style="vertical-align: inherit;">It seems that by default it does not use MikkTSpace for rendering, but starting with Houdini 17.5. </font><font style="vertical-align: inherit;">Meshes can be modified with built-in nodes to use tangent MikkTSpace.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modo (10+?)</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Orientation:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> custom </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tangent space:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> custom </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calculation of two-point tangents for MikkTSpace:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> custom (vertex or pixel-by-pixel) * </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notes:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> it looks like it supports rendering and baking in different tangent spaces, as well as the option of pixel-by-pixel tangents to two points for export. </font><font style="vertical-align: inherit;">I have not tested this.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Knald</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Orientation:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> custom </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tangent space:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MikkTSpace </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calculation of tangents to two points for MikkTSpace:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pixel-by-pixel </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notes: it</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> uses MikkTSpace by default and redefines the tangents of imported meshes, but if necessary there is an option to use existing tangent meshes. </font><font style="vertical-align: inherit;">The orientation of normal maps can be flipped over with a parameter that applies to the entire project.</font></font><br>
<br>
<hr><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finally</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An important aspect is that if the low-poly model on which you bake is just a plane (for example, for tiling texture), then everything written is inconsequential and you can bake using any tool ... if you just keep everything in the correct orientation or later flip the corresponding texture channels. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, most of the problems listed in the article are noticeable only on solid models. </font><font style="vertical-align: inherit;">Organic forms can hide the most subtle differences, for example, the difference between vertex and pixel by pixel tangents to two points.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en487920/index.html">Overloading in C ++. Part I. Overloading functions and templates</a></li>
<li><a href="../en487922/index.html">Learning to deploy microservices. Part 1. Spring Boot and Docker</a></li>
<li><a href="../en487924/index.html">Kim Dotcom: Caught, the most wanted person online. Part 3</a></li>
<li><a href="../en487926/index.html">In search of physical education</a></li>
<li><a href="../en487930/index.html">Lecture night I want to gamedev</a></li>
<li><a href="../en487934/index.html">How we optimized our DNS server using GO tools</a></li>
<li><a href="../en487938/index.html">Introducing effector-dom using the example task list</a></li>
<li><a href="../en487940/index.html">Reproducible computing in R. How to separate code and data?</a></li>
<li><a href="../en487944/index.html">Machine learning in the energy sector, or not only everyone can watch tomorrow</a></li>
<li><a href="../en487948/index.html">Two-factor authentication in OpenVPN with Telegram bot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>