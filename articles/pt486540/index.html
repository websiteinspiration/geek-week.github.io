<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äçü§ù‚Äçüë®üèæ üë®‚Äçüíº üç´ HighLoad ++, Mikhail Makurov, Maxim Chernetsov (Intersvyaz): Zabbix, 100kNVPS em um servidor üë©üèª‚Äçüíº ü•® üé§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A pr√≥xima confer√™ncia HighLoad ++ ser√° realizada nos dias 6 e 7 de abril de 2020 em S√£o Petersburgo. Detalhes e ingressos aqui . HighLoad ++ Moscow 20...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>HighLoad ++, Mikhail Makurov, Maxim Chernetsov (Intersvyaz): Zabbix, 100kNVPS em um servidor</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/486540/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A pr√≥xima confer√™ncia HighLoad ++ ser√° realizada nos dias 6 e 7 de abril de 2020 em S√£o Petersburgo. Detalhes e ingressos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . HighLoad ++ Moscow 2018. Sal√£o de Moscou. 9 de novembro, 15h Resumos e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apresenta√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sa/dm/mu/sadmmupp8vt5l5vl5obukgut36a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Monitoramento - online e anal√≠tico. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* As principais limita√ß√µes da plataforma ZABBIX. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Solu√ß√£o para dimensionar o armazenamento anal√≠tico. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otimiza√ß√£o do servidor ZABBIX. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Otimiza√ß√£o da interface do usu√°rio. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Experi√™ncia em operar o sistema com cargas de mais de 40k NVPS. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Conclus√µes breves.</font></font><a name="habracut"></a><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Makurov (a seguir - MM):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ol√° pessoal! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maxim Chernetsov (daqui em diante - MCH):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Boa tarde! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Deixe-me apresentar Maxim. Max √© um engenheiro talentoso, o melhor networker que eu conhe√ßo. A Maxim lida com redes e servi√ßos, seu desenvolvimento e opera√ß√£o. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uj/pn/q6/ujpnq61idhrrwq2dszdhb3hxjza.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - E eu gostaria de falar sobre o Michael. Michael √© desenvolvedor de C. Ele escreveu algumas solu√ß√µes de processamento de tr√°fego altamente carregadas para nossa empresa. Vivemos e trabalhamos nos Urais, na cidade de severos camponeses de Chelyabinsk, na empresa Intersvyaz. Nossa empresa √© fornecedora de servi√ßos de Internet e televis√£o a cabo para um milh√£o de pessoas em 16 cidades. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MIL√çMETROS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- E vale dizer que a Intersvyaz √© muito mais do que apenas um provedor, √© uma empresa de TI. </font><font style="vertical-align: inherit;">A maioria das nossas decis√µes √© tomada pelo nosso departamento de TI. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dos servidores que processam o tr√°fego, ao call center e ao aplicativo m√≥vel. </font><font style="vertical-align: inherit;">Existem cerca de 80 pessoas no departamento de TI com compet√™ncias muito, muito diversas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre o Zabbix e sua arquitetura</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - E agora vou tentar estabelecer um recorde pessoal e dizer em um minuto o que √© o Zabbix (daqui em diante - "Zabbiks"). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Zabbix se posiciona como um sistema de monitoramento "pronto para uso" no n√≠vel corporativo. </font><font style="vertical-align: inherit;">Possui muitos recursos que simplificam a vida: regras avan√ßadas de escala√ß√£o, APIs para integra√ß√£o, agrupamento e detec√ß√£o autom√°tica de hosts e m√©tricas. </font><font style="vertical-align: inherit;">No Zabbix, existem as chamadas ferramentas de dimensionamento - proxies. </font><font style="vertical-align: inherit;">O Zabbix √© um sistema de c√≥digo aberto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Brevemente sobre arquitetura. </font><font style="vertical-align: inherit;">Podemos dizer que consiste em tr√™s componentes:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oc/fn/xv/ocfnxvdx0gy8qi4055lipyifl1q.jpeg"><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servidor. </font><font style="vertical-align: inherit;">Est√° escrito em C. </font><font style="vertical-align: inherit;">Com processamento e transmiss√£o de informa√ß√µes bastante complicados entre fluxos. </font><font style="vertical-align: inherit;">Todo o processamento ocorre nele: do recebimento at√© o salvamento no banco de dados.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todos os dados s√£o armazenados no banco de dados. </font><font style="vertical-align: inherit;">O Zabbix suporta MySQL, PostreSQL e Oracle.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A interface da web √© escrita em PHP. </font><font style="vertical-align: inherit;">Na maioria dos sistemas, ele vem com um servidor Apache, mas funciona com mais efici√™ncia no pacote nginx + php.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoje gostar√≠amos de contar da vida de nossa empresa uma hist√≥ria relacionada ao Zabbix ...</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hist√≥ria de vida da empresa Intersvyaz. </font><font style="vertical-align: inherit;">O que temos e o que √© necess√°rio?</font></font></h3><br>
<img src="https://habrastorage.org/webt/d2/cr/rk/d2crrkodjpn2arv0aojibu6vsq4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5 ou 6 meses atr√°s. Depois do trabalho ... </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Misha, ol√°! Que bom que eu consegui pegar voc√™ - h√° uma conversa. Novamente tivemos problemas com o monitoramento. Durante um acidente grave, tudo ficou mais lento e n√£o havia informa√ß√µes sobre o status da rede. Infelizmente, esta n√£o √© a primeira vez que se repete. Preciso da tua ajuda. Vamos fazer nosso monitoramento funcionar sob quaisquer circunst√¢ncias! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mas vamos sincronizar primeiro. Eu n√£o olho l√° h√° alguns anos. Tanto quanto me lembro, recusamos o Nagios e mudamos para o Zabbix h√° 8 anos. E agora parece que temos 6 servidores poderosos e cerca de uma d√∫zia de proxies. Estou confundindo alguma coisa? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Por pouco. 15 servidores, alguns dos quais s√£o m√°quinas virtuais. Mais importante, isso n√£o nos salva no momento em que mais precisamos. Como um acidente - os servidores est√£o diminuindo a velocidade e nada √© vis√≠vel. Tentamos otimizar a configura√ß√£o, mas isso n√£o fornece o ganho de desempenho ideal. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Entendo. Voc√™ olhou alguma coisa, voc√™ cavou algo do diagn√≥stico? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- A primeira coisa com a qual voc√™ precisa lidar √© apenas o banco de dados. </font><font style="vertical-align: inherit;">O MySQL √© carregado constantemente, preservando novas m√©tricas e, quando o Zabbix come√ßa a gerar v√°rios eventos, o banco de dados fica literalmente por v√°rias horas. </font><font style="vertical-align: inherit;">Eu j√° falei sobre a otimiza√ß√£o da configura√ß√£o, mas literalmente este ano atualizamos o hardware: h√° mais de cem gigabytes de mem√≥ria nos servidores e matrizes de disco nos SSD RAID-ahs - n√£o faz sentido expandi-lo linearmente. </font><font style="vertical-align: inherit;">O que n√≥s fazemos? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Entendo. </font><font style="vertical-align: inherit;">Em geral, o MySQL √© um banco de dados LTP. </font><font style="vertical-align: inherit;">Aparentemente, n√£o √© mais adequado para armazenar um arquivo de m√©tricas do nosso tamanho. </font><font style="vertical-align: inherit;">Vamos descobrir. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Vamos l√°!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Integra√ß√£o do Zabbix e Clickhouse como resultado do hackathon</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de algum tempo, recebemos dados interessantes: a </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2r/vp/of/2rvpofn2alwwhizhv4e7qrwhpsm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
maior parte do espa√ßo em nosso banco de dados foi ocupada pelo arquivo de m√©tricas e menos de 1% foi usado para configura√ß√£o, modelos e configura√ß√µes. </font><font style="vertical-align: inherit;">Naquela √©poca, h√° mais de um ano est√°vamos operando a solu√ß√£o de Big Data com base no Clickhouse. </font><font style="vertical-align: inherit;">A dire√ß√£o do movimento era √≥bvia para n√≥s. </font><font style="vertical-align: inherit;">No Hackathon da primavera, ele escreveu a integra√ß√£o do Zabbix ao Clickhouse para o servidor e o front-end. </font><font style="vertical-align: inherit;">Naquela √©poca, o Zabbix j√° tinha suporte para o ElasticSearch, e decidimos compar√°-los.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bg/jv/hq/bgjvhq9lwget5l-hy1xt9zz2mvo.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compare Clickhouse e Elasticsearch</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Para compara√ß√£o, geramos a mesma carga que o servidor Zabbix fornece e analisamos como os sistemas se comportariam. Escrevemos dados em lotes de 1000 linhas, usados ‚Äã‚ÄãCURL. Sugerimos anteriormente que o Clickhouse seria mais eficaz para o perfil de carga que o Zabbix. Os resultados at√© superaram nossas expectativas: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zz/iz/pj/zzizpjgv0rf9zjuuasv7mds7is8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
nas mesmas condi√ß√µes de teste, o Clickhouse gravou tr√™s vezes mais dados. Ao mesmo tempo, ambos os sistemas consumiram muito eficientemente (uma pequena quantidade de recursos) durante a leitura dos dados. Mas o "Elastix" exigiu uma grande quantidade de processador ao gravar:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zz/iz/pj/zzizpjgv0rf9zjuuasv7mds7is8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No total, a Clickhouse excedeu significativamente o Elastix no consumo e velocidade do processador. Ao mesmo tempo, devido √† compacta√ß√£o de dados, o ‚ÄúClickhouse‚Äù usa 11 vezes menos no disco r√≠gido e faz cerca de 30 vezes menos opera√ß√µes no disco: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yf/0u/ce/yf0uceb3lvfa4e3mdwz1fsgufkw.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sim, trabalhar com o subsistema de disco no ‚ÄúClickhouse‚Äù √© muito eficaz. Sob as bases, voc√™ pode usar enormes discos SATA e obter uma velocidade de grava√ß√£o de centenas de milhares de linhas por segundo. O sistema "pronto para uso" suporta sharding, replica√ß√£o, √© muito f√°cil de configurar. Estamos mais do que felizes com sua opera√ß√£o por um ano. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para otimizar os recursos, voc√™ pode instalar o "Clickhouse" ao lado da base principal existente e, assim, economizar muito tempo do processador e opera√ß√µes do disco. Tiramos o arquivo de m√©tricas para os clusters "Clickhouse" existentes:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qu/xr/p9/quxrp9ah4u-nhwlbkkcgynf2to0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descarregamos tanto o banco de dados principal do MySQL que podemos combin√°-lo na mesma m√°quina com o servidor Zabbix e abandonar o servidor dedicado para o MySQL.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como funciona a pesquisa no Zabbix?</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 meses atr√°s </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Bem, voc√™ pode esquecer os problemas com a base? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Isso √© certo! Outro problema que precisamos resolver √© a lenta coleta de dados. Agora, todos os nossos 15 proxies est√£o sobrecarregados com SNMP e processos de pesquisa. E n√£o h√° outro sen√£o configurar novos e novos servidores. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - √ìtimo. Mas primeiro me diga como a pesquisa funciona no Zabbix. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Em resumo, existem 20 tipos de m√©tricas e uma d√∫zia de maneiras de obt√™-las. O Zabbix pode coletar dados no modo "solicita√ß√£o-resposta" ou esperar novos dados atrav√©s da "Interface Trapper". </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f1/dd/jc/f1ddjcw--iidqz7psmv82znkwk0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vale ressaltar que no Zabbix original esse m√©todo (Trapper) √© o mais r√°pido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem proxies para balanceamento de carga:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ql/n3/2v/qln32vd8mjkz2xbe0bowbswrpsu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os proxies podem executar as mesmas fun√ß√µes de coleta que o servidor Zabbix, recebendo tarefas dele e enviando m√©tricas coletadas pela interface do Trapper. </font><font style="vertical-align: inherit;">Este √© o m√©todo de balanceamento de carga oficialmente recomendado. </font><font style="vertical-align: inherit;">Al√©m disso, os proxies s√£o √∫teis para monitorar uma infraestrutura remota que funciona por meio de NAT ou de um canal lento: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ba/uv/mh/bauvmh-9-mcmokuu7ldhtx59--0.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Tudo fica claro na arquitetura. </font><font style="vertical-align: inherit;">Devemos olhar para a fonte ... </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alguns dias depois</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hist√≥ria de como o nmap fping venceu</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Parece que eu cavei alguma coisa. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Diga-me! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Descobri que, durante as verifica√ß√µes de disponibilidade, o Zabbix faz uma verifica√ß√£o de at√© 128 hosts por vez. Tentei aumentar esse n√∫mero para 500 e removi o intervalo entre pacotes no ping (ping) - isso aumentou o desempenho em um fator de dois. Mas eu gostaria de grandes n√∫meros. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Na minha pr√°tica, √†s vezes tenho que verificar a disponibilidade de milhares de hosts e n√£o vi nada mais r√°pido que o nmap. Estou certo de que este √© o caminho mais r√°pido. Vamos tentar! Voc√™ precisa aumentar significativamente o n√∫mero de hosts em uma itera√ß√£o. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Verifica mais de quinhentos? 600? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Pelo menos alguns milhares. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MIL√çMETROS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- OK. A coisa mais importante que eu queria dizer: descobri que a maioria das pesquisas no Zabbix era feita de forma s√≠ncrona. Devemos refaz√™-lo de forma ass√≠ncrona. Em seguida, podemos aumentar drasticamente o n√∫mero de m√©tricas coletadas pelos pesquisadores, especialmente se aumentarmos o n√∫mero de m√©tricas em uma itera√ß√£o. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - √ìtimo! E quando? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Como sempre, ontem. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Comparamos as duas vers√µes do fping e do nmap:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qo/du/ii/qoduiid8hzk_wy8sxvgityvungo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em um grande n√∫mero de hosts, o nmap era esperado at√© cinco vezes mais eficiente. </font><font style="vertical-align: inherit;">Como o nmap verifica apenas o fato de disponibilidade e tempo de resposta, transferimos o c√°lculo de perda para acionadores e reduzimos significativamente os intervalos de verifica√ß√£o de disponibilidade. </font><font style="vertical-align: inherit;">Encontramos o n√∫mero ideal de hosts para o nmap na regi√£o de 4 mil por itera√ß√£o. </font><font style="vertical-align: inherit;">O Nmap nos permitiu reduzir em tr√™s vezes os custos de CPU para verifica√ß√µes de disponibilidade e reduzir o intervalo de 120 segundos para 10.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otimiza√ß√£o de polling</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ent√£o fomos para pesquisas. Est√°vamos interessados ‚Äã‚Äãprincipalmente na remo√ß√£o e agentes de SNMP. No Zabbix, a pesquisa foi realizada de forma s√≠ncrona e foram tomadas medidas especiais para aumentar a efici√™ncia do sistema. No modo s√≠ncrono, a indisponibilidade do host causa uma degrada√ß√£o significativa da pesquisa. Existe todo um sistema de estados, h√° processos especiais - os chamados pesquisadores inacess√≠veis, que funcionam apenas com hosts inacess√≠veis: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3g/h1/fm/3gh1fmfnq3nqxkpwsow7j4h80ra.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
este √© um coment√°rio que demonstra a matriz de estados, a complexidade do sistema de transi√ß√£o necess√°ria para que o sistema permane√ßa eficaz. Al√©m disso, a pesquisa s√≠ncrona √© bastante lenta:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h7/0r/tm/h70rtmvjonmj3itlmq4wk44vpr8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â por isso que milhares de threads de pesquisas em uma d√∫zia de proxies n√£o puderam coletar a quantidade necess√°ria de dados para n√≥s. A implementa√ß√£o ass√≠ncrona resolveu n√£o apenas os problemas com o n√∫mero de threads, mas tamb√©m simplificou significativamente o sistema de estado de hosts inacess√≠veis, porque para qualquer n√∫mero verificado em uma itera√ß√£o de polling, o tempo de espera m√°ximo era de 1 tempo limite: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/re/te/bj/retebjsm9vthvrjy7rmpobeiwqa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
al√©m disso, modificamos e melhoramos o sistema de polling para SNMP- consultas. O fato √© que a maioria n√£o pode responder a v√°rias solicita√ß√µes SNMP ao mesmo tempo. Portanto, criamos um modo h√≠brido quando a pesquisa SNMP do mesmo host faz assincronamente: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mj/9a/sj/mj9asjfzaisviljstpkdjpvmnya.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso √© feito para todo o pacote configur√°vel do host. No final, esse modo n√£o √© mais lento do que completamente ass√≠ncrono, pois a pesquisa de uma centena e meia de valores SNMP ainda √© muito mais r√°pida que um tempo limite.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nossas experi√™ncias mostraram que o n√∫mero ideal de solicita√ß√µes em uma itera√ß√£o √© de cerca de 8 mil com a pesquisa SNMP. </font><font style="vertical-align: inherit;">No total, a transi√ß√£o para o modo ass√≠ncrono permitiu acelerar o desempenho da pesquisa em 200 vezes, v√°rias centenas de vezes. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - As otimiza√ß√µes de pesquisa obtidas mostraram que n√£o apenas podemos nos livrar de todos os proxies, mas tamb√©m reduzir os intervalos para muitas verifica√ß√µes, e os proxies n√£o ser√£o necess√°rios como forma de compartilhar a carga. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cerca de tr√™s meses atr√°s</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mude a arquitetura - aumente a carga!</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Bem, Max, √© hora de ser produtivo? Eu preciso de um servidor poderoso e de um bom engenheiro. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Bem, planejamos. √â hora de decolar a 5.000 m√©tricas por segundo. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manh√£ ap√≥s a atualiza√ß√£o do </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Misha, atualizamos, mas revertemos de manh√£ ... Adivinhe que velocidade voc√™ alcan√ßou? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mil no m√°ximo 20. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sim, 25! Infelizmente, estamos onde come√ßamos. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - E ent√£o? Voc√™ recebeu algum diagn√≥stico? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sim, claro! Aqui, por exemplo, um top interessante: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6c/zv/6s/6czv6sdkoykmdkm0vn-sddnbbpw.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Vamos ver. Vejo que tentamos um grande n√∫mero de threads de pesquisa: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qb/a0/cl/qba0clfwpherpsufnk_7fbn5ioy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mas, ao mesmo tempo, n√£o conseguimos utilizar o sistema nem pela metade:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sp/wv/8b/spwv8blrzyggfwo5ps-objpypak.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E o desempenho geral √© bem pequeno, cerca de 4 mil m√©tricas por segundo: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tt/6o/zr/tt6ozrt2ortiof4kckeghltzrnq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
h√° mais alguma coisa? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sim, vest√≠gios de um dos pesquisadores: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/p8/ny/y3/p8nyy3kb_ffjhsjynlpz4wjfh8w.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - √â claramente visto aqui que o processo de vota√ß√£o est√° aguardando "sem√°foros". Estes s√£o bloqueios: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z7/ks/mh/z7ksmh8kes9yc23tm0vuyu5g8r8.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - N√£o est√° claro. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Veja, √© como uma situa√ß√£o em que v√°rios threads est√£o tentando trabalhar com recursos com os quais apenas um pode trabalhar por vez. Ent√£o, tudo o que eles podem fazer √© compartilhar esse recurso por tempo: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/in/ce/mo/incemofethgxpp3fwyabr8kstd4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
e a produtividade total do trabalho com esse recurso √© limitada pela velocidade de um n√∫cleo: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oq/oh/9f/oqoh9fqs9ppftn5mab3aivoo2nq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
existem duas maneiras de resolver esse problema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Atualize o ferro da m√°quina, mude para kernels mais r√°pidos:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/io/bd/zi/iobdziopu3g_vkfoengg2zhhcro.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou mude a arquitetura e </font><font style="vertical-align: inherit;">, ao mesmo tempo </font><font style="vertical-align: inherit;">, a carga: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nu/sl/wt/nuslwtjkx-poqob5ciqyyfifq48.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - A prop√≥sito, vamos colocar menos n√∫cleos em uma m√°quina de teste do que em uma de combate, mas eles s√£o 1,5 vezes mais r√°pidos em frequ√™ncia por n√∫cleo! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Est√° claro? </font><font style="vertical-align: inherit;">√â necess√°rio olhar para o c√≥digo do servidor.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caminho de dados no servidor Zabbix</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Para entender, come√ßamos a analisar como os dados s√£o transmitidos dentro do servidor Zabbix: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/v9/iu/a2/v9iua26a6om3flgzj_vb3te0hak.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagem legal, certo? Vamos passar por isso passo a passo para esclarecer mais ou menos. Existem fluxos e servi√ßos respons√°veis ‚Äã‚Äãpela coleta de dados: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h3/m9/kt/h3m9ktuwhpgwe1g4mbqjiw8l_zs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
eles transferem as m√©tricas coletadas atrav√©s do soquete para o gerenciador de pr√©-processador, onde est√£o na fila: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9d/ct/fv/9dctfvdiw2zaves1vn34gliuvmu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Preprocessor-manager ‚Äùtransfere dados para seus trabalhadores que executam as instru√ß√µes de pr√©-processamento e os devolvem de volta pelo mesmo soquete: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ma/qd/ss/maqdssje-vzlzzpfzl0x2cuthwo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
depois disso, o pr√©-processador O gerenciador os salva no cache do hist√≥rico:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5r/9q/vw/5r9qvwyriydt0pcroma7n-14fsa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A partir da√≠, eles s√£o apanhados por afundadores de hist√≥rico que desempenham v√°rias fun√ß√µes: por exemplo, calcular gatilhos, preencher o cache de valor e, o mais importante, salvar m√©tricas no reposit√≥rio de hist√≥rico. </font><font style="vertical-align: inherit;">Em geral, o processo √© complexo e muito confuso. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f7/o8/ih/f7o8ihzf_g5_2ecganu1t0zoss0.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - A primeira coisa que vimos √© que a maioria dos threads compete pelo chamado "cache de configura√ß√£o" (uma √°rea de mem√≥ria onde todas as configura√ß√µes do servidor s√£o armazenadas). </font><font style="vertical-align: inherit;">Especialmente muitos bloqueios s√£o feitos pelos fluxos respons√°veis ‚Äã‚Äãpela coleta de dados: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ba/oo/48/baoo48qthdg_pcp0ojgqh0de5us.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... uma vez que a configura√ß√£o armazena n√£o apenas m√©tricas com seus par√¢metros, mas tamb√©m filas, a partir das quais os pesquisadores obt√™m informa√ß√µes sobre o que fazer em seguida. </font><font style="vertical-align: inherit;">Quando h√° muitos pesquisadores, e um bloqueia a configura√ß√£o, o restante est√° aguardando solicita√ß√µes:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/y5/zb/np/y5zbnpqumrszencyhaasflytwvm.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os pesquisadores n√£o devem entrar em conflito</font></font></h3><br>
<img src="https://habrastorage.org/webt/kw/11/4f/kw114ff5k91eqlycs-yg8p8bmem.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, a primeira coisa que fizemos foi dividir a fila em 4 partes e permitir que os pesquisadores bloqueassem com seguran√ßa essas filas, essas partes ao mesmo tempo: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/la/gi/xu/lagixuseh1aghovklgd6m3blkxu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
isso eliminou a concorr√™ncia pelo cache de configura√ß√£o e a velocidade dos pesquisadores aumentou significativamente. </font><font style="vertical-align: inherit;">Mas ent√£o fomos confrontados com o fato de que o gerente do pr√©-processador come√ßou a acumular uma fila de tarefas:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ui/0c/4i/ui0c4i7aae8kqdvkdtorchzft-y.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O gerente do pr√©-processador deve poder priorizar</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso aconteceu quando ele n√£o tinha produtividade. </font><font style="vertical-align: inherit;">Ent√£o tudo o que podia fazer era solicita√ß√µes acumular dos processos de coleta de dados e adicionar a sua reserva at√© que ele come toda a mem√≥ria e trava: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9y/iy/oz/9yiyozxavyibcw8pog3tidwy-xc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para resolver este problema, n√≥s adicionamos uma segunda tomada, que foi alocado especificamente para trabalhadores: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rb/sz/25/rbsz25axpkn6a832h9k7otp9je4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim , o gerente do pr√©-processador teve a oportunidade de priorizar seu trabalho e, caso o buffer cres√ßa, a tarefa √© diminuir a velocidade da alimenta√ß√£o, dando aos trabalhadores a oportunidade de busc√°-lo: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qi/og/cg/qiogcgztt1an1ewlrear7oqxt7g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
descobrimos que uma das raz√µes para a desacelera√ß√£o era porque os pr√≥prios trabalhadores estavam competindo por </font><font style="vertical-align: inherit;">recurso vital para o seu trabalho. </font><font style="vertical-align: inherit;">Registramos esse problema com uma corre√ß√£o de bug e nas novas vers√µes do Zabbix ele j√° foi resolvido:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yd/6q/lr/yd6qlrqamuxreroffkeracyrnim.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aumentamos o n√∫mero de soquetes - obtemos o resultado</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, o pr√≥prio gerente de pr√©-processador se tornou um link estreito, pois √© um √∫nico encadeamento. </font><font style="vertical-align: inherit;">Ele repousava na velocidade do n√∫cleo, fornecendo uma velocidade m√°xima de cerca de 70 mil m√©tricas por segundo: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uk/s1/2_/uks12_i65kx3ohfqdfmvedyqdqw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
portanto, fizemos quatro, com quatro conjuntos de soquetes, trabalhadores: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qt/-u/ws/qt-uwsmlriplii491ao0we3jhg4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
e isso nos permitiu aumentar a velocidade para cerca de 130 mil m√©tricas: A </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ql/vp/cf/qlvpcfggoinhdxc4dfkniaz9po8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
n√£o linearidade do crescimento √© explicada pelo fato de haver competi√ß√£o pelo cache hist√≥rias. </font><font style="vertical-align: inherit;">Para ele, quatro gerentes de pr√©-processadores e sincronizadores hist√≥ricos competiram. </font><font style="vertical-align: inherit;">Nesse ponto, recebemos cerca de 130 mil m√©tricas por segundo em uma m√°quina de teste, utilizando-a em cerca de 95% no processador: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yo/7l/mh/yo7lmhcfcdbhek5blp5xdz0osfy.jpeg"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cerca de 2,5 meses atr√°s</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A recusa da comunidade snmp aumentou os NVPs em uma vez e meia</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Max, preciso de uma nova m√°quina de teste! N√£o nos encaixamos mais no atual. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - E o que √© agora? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Agora - 130k NVPs e um processador "de prateleira". </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Uau! Legal! Espere, eu tenho duas perguntas. De acordo com meus c√°lculos, nossa necessidade √© de 15 a 20 mil m√©tricas por segundo. Por que precisamos de mais? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Quero terminar o trabalho at√© o fim. Eu quero ver o quanto podemos extrair deste sistema. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mas ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mas √© in√∫til para os neg√≥cios. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Entendo. E a segunda pergunta: o que temos agora, podemos nos apoiar, sem a ajuda de um desenvolvedor? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MIL√çMETROS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Eu n√£o acho. Alterar o cache de configura√ß√£o √© um problema. Ele lida com altera√ß√µes na maioria dos threads e √© dif√≠cil de manter. Provavelmente, apoi√°-la ser√° muito dif√≠cil. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ent√£o voc√™ precisa de algum tipo de alternativa. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Existe essa op√ß√£o. Podemos mudar para n√∫cleos r√°pidos, enquanto abandonamos o novo sistema de travamento. Ainda temos o desempenho de 60 a 80 mil m√©tricas. Nesse caso, podemos deixar o restante do c√≥digo. Clickhouse, a pesquisa ass√≠ncrona funcionar√°. E ser√° f√°cil de manter. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - √ìtimo! Proponho me debru√ßar sobre isso.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de otimizar o lado do servidor, finalmente conseguimos executar o novo c√≥digo no produtivo. </font><font style="vertical-align: inherit;">Abandonamos parte das mudan√ßas em favor de mudar para uma m√°quina com kernels r√°pidos e minimizar o n√∫mero de altera√ß√µes no c√≥digo. </font><font style="vertical-align: inherit;">Tamb√©m simplificamos a configura√ß√£o e, se poss√≠vel, abandonamos as macros nos elementos de dados, pois s√£o a fonte de bloqueios adicionais. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bk/v7/tp/bkv7tps-i9usalann4sbqpdbkqm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, a rejei√ß√£o da macro snmp-community, que √© freq√ºentemente encontrada em documenta√ß√£o e exemplos, em nosso caso nos permitiu acelerar adicionalmente os NVPs em cerca de 1,5 vezes. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap√≥s dois dias em produ√ß√£o</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remover pop-ups do hist√≥rico de incidentes</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Misha, usamos o sistema por dois dias, e tudo funciona. Mas somente quando tudo funciona! Planejamos o trabalho com a transfer√™ncia de um segmento suficientemente grande da rede e, novamente, com as m√£os, verificamos que ele havia subido, ou n√£o. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - N√£o pode ser! Verificamos tudo 10 vezes. O servidor processa at√© a inacessibilidade completa da rede instantaneamente. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sim, eu entendo tudo: servidor, banco de dados, top, austat, logs - tudo √© r√°pido ... Mas olhamos para a interface da web e l√° temos o processador "na prateleira" no servidor e este: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vj/un/p2/vjunp2evh3whasvpw4hwsipeshk.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Entendo. Vamos assistir a web. Descobrimos que em uma situa√ß√£o em que havia um grande n√∫mero de incidentes ativos, a maioria dos widgets operacionais come√ßou a funcionar muito lentamente:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nz/vw/kz/nzvwkzfbeg-4r1iue0y4178eg2q.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O motivo disso foi a gera√ß√£o de pop-ups com um hist√≥rico de incidentes gerados para cada item da lista. </font><font style="vertical-align: inherit;">Portanto, nos recusamos a gerar essas janelas (comentaram 5 linhas no c√≥digo), e isso resolveu nossos problemas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O tempo de carregamento do widget, mesmo quando completamente inacess√≠vel, foi reduzido de alguns minutos para o aceit√°vel por 10 a 15 segundos, e o hist√≥rico ainda pode ser visualizado clicando no hor√°rio: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hu/dc/4l/hudc4lsz_skbshg7jphleuprc4a.jpeg"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap√≥s o trabalho. </font><font style="vertical-align: inherit;">2 meses atr√°s </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Misha, voc√™ est√° indo embora? </font><font style="vertical-align: inherit;">N√≥s temos que conversar. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - N√£o vou. </font><font style="vertical-align: inherit;">Mais uma vez algo com Zabbix? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Oh n√£o, relaxe! </font><font style="vertical-align: inherit;">Eu s√≥ queria dizer: tudo funciona, obrigado! </font><font style="vertical-align: inherit;">Cerveja comigo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zabbix √© eficaz</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Zabbix √© um sistema e fun√ß√£o bastante vers√°til e rico. </font><font style="vertical-align: inherit;">Pode ser usado para pequenas instala√ß√µes prontas para uso, mas com o crescimento das necessidades, ele precisa ser otimizado. </font><font style="vertical-align: inherit;">Para armazenar um grande arquivo de m√©tricas, use o armazenamento apropriado:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ pode usar as ferramentas integradas na forma de integra√ß√£o com o Elastixerch ou carregar o hist√≥rico em arquivos de texto (dispon√≠vel na quarta vers√£o);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ pode tirar proveito da nossa experi√™ncia e integra√ß√£o com a Clickhouse.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para aumentar drasticamente a velocidade da coleta de m√©tricas, colete-as de forma ass√≠ncrona e transfira-as pela interface do trapper para o servidor Zabbix; </font><font style="vertical-align: inherit;">ou voc√™ pode usar o patch para pollers ass√≠ncronos do pr√≥prio Zabbix. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Zabbix √© escrito em C e √© bastante eficaz. </font><font style="vertical-align: inherit;">A solu√ß√£o de v√°rios locais estreitos de arquitetura permite aumentar ainda mais sua produtividade e, em nossa experi√™ncia, receber mais de 100 mil m√©tricas em uma m√°quina com processador √∫nico.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5r/db/d2/5rdbd2jcvr75sosfvfa6ziniwps.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O mesmo patch do Zabbix</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Quero adicionar alguns pontos. </font><font style="vertical-align: inherit;">Todo o relat√≥rio atual, todos os testes e n√∫meros s√£o fornecidos para a configura√ß√£o que √© usada conosco. </font><font style="vertical-align: inherit;">Agora estamos retirando cerca de 20 mil m√©tricas por segundo. </font><font style="vertical-align: inherit;">Se voc√™ est√° tentando entender se isso funcionar√° para voc√™ - voc√™ pode comparar. </font><font style="vertical-align: inherit;">O que eles falaram hoje est√° publicado no GitHub como um patch: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/miklert/zabbix</font></font></a><br>
<br>
<img src="https://habrastorage.org/webt/xb/wd/y1/xbwdy18hq9dolceyxku_2wxsj4a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
O patch inclui:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">total integra√ß√£o com Clickhouse (servidor Zabbix e front-end);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">resolu√ß√£o de problemas com o gerenciador de pr√©-processador;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sondagem ass√≠ncrona.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O patch √© compat√≠vel com toda a vers√£o 4, incluindo lts. </font><font style="vertical-align: inherit;">Provavelmente, com altera√ß√µes m√≠nimas, ele funcionar√° na vers√£o 3.4. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obrigado pela aten√ß√£o.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quest√µes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pergunta da plat√©ia (doravante - A): - Boa tarde! Por favor, diga-me, voc√™ tem planos de intera√ß√£o intensa com a equipe do Zabbix ou eles t√™m com voc√™ para que isso n√£o seja um patch, mas o comportamento normal do Zabbix? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sim, certamente iremos cometer parte das mudan√ßas. Algo ser√°, algo permanecer√° no patch. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Muito obrigado pelo excelente relat√≥rio! Diga-me, por favor, depois de aplicar o patch, o suporte lateral do Zabbix permanecer√° e como continuar a atualiza√ß√£o para vers√µes superiores? Ser√° poss√≠vel atualizar o Zabbix ap√≥s o patch para 4.2, 5.0? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MIL√çMETROS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Eu n√£o posso dizer sobre suporte. Se eu fosse o suporte t√©cnico do Zabbix, provavelmente diria que n√£o, porque esse √© o c√≥digo de outra pessoa. Quanto √† base de c√≥digo 4.2, nossa posi√ß√£o √© a seguinte: "Iremos com o tempo e seremos atualizados na pr√≥xima vers√£o". Portanto, por algum tempo, carregaremos o patch para vers√µes atualizadas. Eu j√° disse no relat√≥rio: o n√∫mero de altera√ß√µes nas vers√µes ainda √© muito pequeno. Acho que a transi√ß√£o de 3,4 para 4. levou cerca de 15 minutos, algo mudou por l√°, mas n√£o muito importante. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ent√£o voc√™ planeja manter seu patch e pode coloc√°-lo em produ√ß√£o com seguran√ßa, recebendo no futuro atualiza√ß√µes de alguma forma? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - N√≥s recomendamos fortemente. Isso resolve muitos problemas para n√≥s. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Mais uma vez, gostaria de enfatizar que as mudan√ßas que n√£o se relacionam √† arquitetura e n√£o se relacionam a bloqueios, filas - s√£o modulares, est√£o em m√≥dulos separados. Mesmo por conta pr√≥pria, com pequenas altera√ß√µes, eles podem ser mantidos com bastante facilidade. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Se os detalhes forem interessantes, o ‚ÄúClickhouse‚Äù usa a chamada biblioteca de hist√≥rico. Est√° desatado - √© uma c√≥pia do suporte do Elastic, ou seja, √© configur√°vel. A pesquisa muda apenas os pesquisadores. Acreditamos que isso funcionar√° por um longo tempo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Muito obrigado. Mas diga-me, existe alguma documenta√ß√£o das altera√ß√µes feitas? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r7/vv/h3/r7vvh3optatasclqsm9tjftkmja.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MIL√çMETROS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Documenta√ß√£o √© um patch. </font><font style="vertical-align: inherit;">Obviamente, com a introdu√ß√£o do ‚ÄúClickhouse‚Äù, com a introdu√ß√£o de novos tipos de pollers, surgem novas op√ß√µes de configura√ß√£o. </font><font style="vertical-align: inherit;">O link do √∫ltimo slide possui uma breve descri√ß√£o de como us√°-lo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre como substituir o fping pelo nmap</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Como voc√™ finalmente implementou isso? </font><font style="vertical-align: inherit;">Voc√™ pode dar exemplos espec√≠ficos: s√£o seus strappers e um script externo? </font><font style="vertical-align: inherit;">O que eventualmente verifica tantos hosts t√£o rapidamente? </font><font style="vertical-align: inherit;">Como voc√™ consegue esses hosts? </font><font style="vertical-align: inherit;">O nmap precisa de alguma forma aliment√°-los, obt√™-los de algum lugar, coloc√°-los, iniciar algo? .. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Legal. Pergunta muito correta! O ponto √© este. Modificamos a biblioteca (ping ICMP, parte do Zabbix) para verifica√ß√µes de ICMP, que indicam o n√∫mero de pacotes - unidade (1), e o c√≥digo tenta usar o nmap. Ou seja, este √© o trabalho interno do Zabbix, tornou-se o trabalho interno do pinger. Consequentemente, nenhuma sincroniza√ß√£o ou uso de um trapper √© necess√°rio. Isso foi feito deliberadamente, a fim de deixar o sistema coerente e n√£o se envolver na sincroniza√ß√£o de dois sistemas b√°sicos: o que verificar, preencher atrav√©s do poller e se o preenchimento foi quebrado em n√≥s? .. Isso √© muito mais f√°cil. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Tamb√©m funciona para um proxy? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sim, mas n√£o verificamos. O c√≥digo de pesquisa √© o mesmo no Zabbix e no servidor. Deveria trabalhar. Enfatizo novamente: o desempenho do sistema √© tal que n√£o precisamos de um proxy.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - A resposta correta para a pergunta √©: "Por que voc√™ precisa de um proxy com esse sistema?" </font><font style="vertical-align: inherit;">S√≥ por causa do NAT'a ou para monitorar atrav√©s de um canal lento alguns ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - E voc√™ usa o Zabbix como al√©rgeno, se bem entendi. </font><font style="vertical-align: inherit;">Ou os gr√°ficos (onde est√° a camada de arquivamento) que voc√™ deixou para outro sistema, como o Grafana? </font><font style="vertical-align: inherit;">Ou voc√™ n√£o est√° usando esta funcionalidade? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Vou enfatizar mais uma vez: fizemos uma integra√ß√£o completa. </font><font style="vertical-align: inherit;">Colocamos hist√≥ria no "Clickhouse", mas ao mesmo tempo mudamos o front-end do php. </font><font style="vertical-align: inherit;">O php-frontend acessa ‚ÄúClickhouse‚Äù e faz todos os gr√°ficos de l√°. </font><font style="vertical-align: inherit;">Ao mesmo tempo, para ser sincero, temos uma parte que √© criada a partir do mesmo ‚ÄúClickhouse‚Äù, dos mesmos dados do Zabbix, dados em outros sistemas de exibi√ß√£o gr√°fica. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Em "Grafan" tamb√©m.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como foi tomada a decis√£o de alocar recursos?</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Compartilhe uma pequena cozinha interna. </font><font style="vertical-align: inherit;">Como foi tomada a decis√£o de alocar recursos para processamento s√©rio de produtos? </font><font style="vertical-align: inherit;">Estes s√£o, em geral, certos riscos. </font><font style="vertical-align: inherit;">E, por favor, diga-me, no contexto em que voc√™ apoiar√° novas vers√µes: como essa decis√£o se justifica do ponto de vista gerencial? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Aparentemente, n√£o contamos o drama da hist√≥ria muito bem. </font><font style="vertical-align: inherit;">N√≥s nos encontramos em uma situa√ß√£o em que algo tinha que ser feito, e seguimos essencialmente dois comandos paralelos:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um deles estava envolvido no lan√ßamento de um sistema de monitoramento usando novos m√©todos: monitoramento como servi√ßo, um conjunto padr√£o de solu√ß√µes de c√≥digo aberto que combinamos e, em seguida, tentamos alterar o processo de neg√≥cios para trabalhar com o novo sistema de monitoramento.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paralelamente, tivemos um programador entusiasmado que estava fazendo isso (sobre si mesmo). </font><font style="vertical-align: inherit;">Aconteceu que ele ganhou.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - E qual √© o tamanho da equipe? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ela est√° na sua frente. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Isso √©, como sempre, necess√°rio um apaixonado? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - N√£o sei o que √© um apaixonado. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Neste caso, aparentemente, voc√™. </font><font style="vertical-align: inherit;">Muito obrigado, voc√™ √© legal. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Obrigado.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre patches para o Zabbix</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Para um sistema que usa proxies (por exemplo, em alguns sistemas distribu√≠dos), √© poss√≠vel que voc√™ decida adaptar e corrigir, digamos, pollers, proxies e parcialmente o pr√©-processador do pr√≥prio Zabbix; e a intera√ß√£o deles? √â poss√≠vel otimizar desenvolvimentos existentes para um sistema com v√°rios proxies? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Eu sei que o servidor Zabbix √© montado usando um proxy (ele √© compilado e o c√≥digo √© obtido). N√£o testamos isso no produto. N√£o tenho certeza disso, mas, na minha opini√£o, o gerente do pr√©-processador n√£o √© usado no proxy. A tarefa do proxy √© pegar um conjunto de m√©tricas do Zabbix, preench√™-las (ele tamb√©m grava a configura√ß√£o, banco de dados local) e devolv√™-lo ao servidor Zabbix. Em seguida, o pr√≥prio servidor far√° o pr√©-processamento quando o receber.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O interesse em proxies √© compreens√≠vel. </font><font style="vertical-align: inherit;">Vamos verificar isso. </font><font style="vertical-align: inherit;">Este √© um t√≥pico interessante. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - A id√©ia era a seguinte: se voc√™ pode corrigir os pollers, eles podem ser corrigidos para proxies e interagir com o servidor, e o pr√©-processador para esses fins pode ser adaptado apenas no servidor. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Eu acho que tudo √© ainda mais simples. </font><font style="vertical-align: inherit;">Voc√™ pega o c√≥digo, aplica o patch e, em seguida, configura-o conforme necess√°rio - colete os servidores proxy (por exemplo, com ODBC) e distribua o c√≥digo corrigido para os sistemas. </font><font style="vertical-align: inherit;">Onde necess√°rio - colete proxies, onde necess√°rio - servidor. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Al√©m disso, voc√™ n√£o precisar√° corrigir a transmiss√£o do proxy no servidor, provavelmente? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - N√£o, √© padr√£o. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MIL√çMETROS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Na verdade, uma das id√©ias n√£o soou. </font><font style="vertical-align: inherit;">Sempre mantivemos um equil√≠brio entre uma explos√£o de id√©ias e o n√∫mero de mudan√ßas, a facilidade de suporte.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/3yRt9jSwrlg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um pouco de publicidade :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obrigado por ficar com a gente. Voc√™ gosta dos nossos artigos? Deseja ver materiais mais interessantes? Ajude-nos fazendo um pedido ou recomendando aos seus amigos o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS na nuvem para desenvolvedores a partir de US $ 4,99</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anal√≥gico exclusivo de servidores de n√≠vel b√°sico que foi inventado por n√≥s para voc√™: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toda a verdade sobre o VPS (KVM) E5-2697 v3 (6 n√∫cleos) 10 GB DDR4 480 GB SSD 1 Gbps de US $ 19 ou como dividir o servidor?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (as op√ß√µes est√£o dispon√≠veis com RAID1 e RAID10, at√© 24 n√∫cleos e at√© 40GB DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 vezes mais barato no data center Equinix Tier IV em Amsterd√£?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Somente n√≥s temos </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 TVs Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV a partir de US $ 199</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na Holanda!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - a partir de $ 99! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leia sobre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Como criar um pr√©dio de infraestrutura. </font><font style="vertical-align: inherit;">classe c usando servidores Dell R730xd E5-2650 v4 que custam 9.000 euros por um centavo?</font></font></a></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt486518/index.html">20 anos atr√°s</a></li>
<li><a href="../pt486528/index.html">Esta √© a norma - 3: tipos normais de mapas</a></li>
<li><a href="../pt486530/index.html">Convencional. Trabalhadores Honor√°rios. Novela biogr√°fica</a></li>
<li><a href="../pt486532/index.html">Backup de dados usando um monte de FreeFileSync e 7-zip</a></li>
<li><a href="../pt486538/index.html">Como eu carreguei soft skills online e o que isso me deu</a></li>
<li><a href="../pt486542/index.html">Analisar o som de um modem dial-up</a></li>
<li><a href="../pt486544/index.html">Duas horas e 3,5 d√≥lares. Como criei um site simples com visualiza√ß√£o da distribui√ß√£o do coronav√≠rus</a></li>
<li><a href="../pt486548/index.html">Fun√ß√µes recursivas primitivas e fun√ß√£o Ackerman</a></li>
<li><a href="../pt486552/index.html">‚ÄúC√≥digo cultural: os segredos de grupos e organiza√ß√µes extremamente bem-sucedidos‚Äù - notas do livro</a></li>
<li><a href="../pt486554/index.html">Slurm DevOps. Tr√™s dias de imers√£o no DevOps. E uma palestra de Anatoly Wasserman "O Problema Computacional do Socialismo"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>