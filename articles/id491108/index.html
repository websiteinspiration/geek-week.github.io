<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ”¬ ğŸ¤ŸğŸ¾ ğŸ‘¨â€ğŸ¨ Mengatur penyebaran ke banyak lingkungan k8 menggunakan helmfile ğŸ¤º ğŸ˜² ğŸ‘</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Helmfile - pembungkus untuk helm , yang memungkinkan Anda untuk mendeskripsikan banyak pelepasan helm di satu tempat, membuat parameter grafik mereka ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Mengatur penyebaran ke banyak lingkungan k8 menggunakan helmfile</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491108/"><p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Helmfile</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pembungkus untuk </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">helm</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang memungkinkan Anda untuk mendeskripsikan banyak pelepasan helm di satu tempat, membuat parameter grafik mereka untuk beberapa lingkungan, dan juga mengatur urutan penempatannya.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anda dapat membaca tentang helmfile sendiri dan contoh penggunaannya dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">readme</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">panduan praktik terbaik</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami akan berkenalan dengan cara-cara yang tidak jelas untuk menggambarkan rilis di helmfile</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Misalkan kita memiliki banyak grafik helm (misalnya, biarlah ada postgres dan semacam aplikasi backend) dan beberapa lingkungan (beberapa cluster kubernet, beberapa namespace'ov atau beberapa dari keduanya). </font><font style="vertical-align: inherit;">Kami mengambil helmfile, membaca dokumentasi dan mulai menggambarkan lingkungan dan rilis kami:</font></font></p><br>
<pre><code class="plaintext hljs">    .<font></font>
    â”œâ”€â”€ envs<font></font>
    â”‚&nbsp;&nbsp; â”œâ”€â”€ devel<font></font>
    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp; â””â”€â”€ values<font></font>
    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;     â”œâ”€â”€ backend.yaml<font></font>
    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;     â””â”€â”€ postgres.yaml<font></font>
    â”‚&nbsp;&nbsp; â””â”€â”€ production<font></font>
    â”‚&nbsp;&nbsp;     â””â”€â”€ values<font></font>
    â”‚&nbsp;&nbsp;         â”œâ”€â”€ backend.yaml<font></font>
    â”‚&nbsp;&nbsp;         â””â”€â”€ postgres.yaml<font></font>
    â””â”€â”€ helmfile.yaml</code></pre><a name="habracut"></a><br>
<h4 id="helmfileyaml"><strong><code>helmfile.yaml</code></strong></h4><br>
<pre><code class="plaintext hljs">environments:<font></font>
  devel:<font></font>
  production:<font></font>
<font></font>
releases:<font></font>
  - name: postgres<font></font>
    labels:<font></font>
      app: postgres<font></font>
    wait: true<font></font>
    chart: stable/postgresql<font></font>
    version: 8.4.0<font></font>
    values:<font></font>
      - envs/{{ .Environment.Name }}/values/postgres.yaml<font></font>
  - name: backend<font></font>
    labels:<font></font>
      app: backend<font></font>
    wait: true<font></font>
    chart: private-helm-repo/backend<font></font>
    version: 1.0.5<font></font>
    needs:<font></font>
      - postgres<font></font>
    values:<font></font>
      - envs/{{ .Environment.Name }}/values/backend.yaml</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami memiliki 2 lingkungan: </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devel</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">produksi</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - masing-masing memiliki nilai sendiri untuk grafik rilis helm. </font><font style="vertical-align: inherit;">Kami akan menyebarkan kepada mereka seperti ini:</font></font></p><br>
<pre><code class="plaintext hljs">helmfile -n &lt;namespace&gt; -e &lt;env&gt; apply</code></pre><br>
<h2 id="raznye-versii-helm-chartov-v-raznyh-okruzheniyah"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versi berbeda dari bagan helm di lingkungan yang berbeda</font></font></h2><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana jika kita perlu meluncurkan versi backend yang berbeda di lingkungan yang berbeda? </font><font style="vertical-align: inherit;">Bagaimana parameterisasi versi rilis? </font><font style="vertical-align: inherit;">Nilai lingkungan tersedia melalui</font></font><code>{{ .Values }}</code></p><br>
<h4 id="helmfileyaml-1"><strong><code>helmfile.yaml</code></strong></h4><br>
<pre><code class="diff hljs">environments:<font></font>
  devel:<font></font>
<span class="hljs-addition">+   values:</span>
<span class="hljs-addition">+   - charts:</span>
<span class="hljs-addition">+       versions:</span>
<span class="hljs-addition">+         backend: 1.1.0</span><font></font>
  production:<font></font>
<span class="hljs-addition">+   values:</span>
<span class="hljs-addition">+   - charts:</span>
<span class="hljs-addition">+       versions:</span>
<span class="hljs-addition">+         backend: 1.0.5</span><font></font>
...<font></font>
  - name: backend<font></font>
    labels:<font></font>
      app: backend<font></font>
    wait: true<font></font>
    chart: private-helm-repo/backend<font></font>
<span class="hljs-deletion">-   version: 1.0.5</span>
<span class="hljs-addition">+   version: {{ .Values.charts.versions.backend }}</span>
...</code></pre><br>
<h2 id="raznyy-nabor-prilozheniy-v-raznyh-okruzheniyah"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seperangkat aplikasi berbeda di lingkungan yang berbeda</font></font></h2><br>
<p>,        <code>production</code>  postgres,    ,        k8s          postgres?         (labels)</p><br>
<pre><code class="plaintext hljs">helmfile -n &lt;namespace&gt; -e devel apply<font></font>
helmfile -n &lt;namespace&gt; -e production -l app=backend apply</code></pre><br>
<p> ,     ,          ,     .  ?       ,         ""   ,  </p><br>
<pre><code class="diff hljs">    .<font></font>
    â”œâ”€â”€ envs<font></font>
    â”‚&nbsp;&nbsp; â”œâ”€â”€ devel<font></font>
    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp; â””â”€â”€ values<font></font>
    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;     â”œâ”€â”€ backend.yaml<font></font>
    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;     â””â”€â”€ postgres.yaml<font></font>
    â”‚&nbsp;&nbsp; â””â”€â”€ production<font></font>
    â”‚&nbsp;&nbsp;     â””â”€â”€ values<font></font>
    â”‚&nbsp;&nbsp;         â”œâ”€â”€ backend.yaml<font></font>
    â”‚&nbsp;&nbsp;         â””â”€â”€ postgres.yaml<font></font>
<span class="hljs-addition">+   â”œâ”€â”€ releases</span>
<span class="hljs-addition">+   â”‚&nbsp;&nbsp; â”œâ”€â”€ backend.yaml</span>
<span class="hljs-addition">+   â”‚&nbsp;&nbsp; â””â”€â”€ postgres.yaml</span><font></font>
    â””â”€â”€ helmfile.yaml<font></font>
</code></pre><br>
<h4 id="helmfileyaml-2"><strong><code>helmfile.yaml</code></strong></h4><br>
<pre><code class="diff hljs"><font></font>
  environments:<font></font>
    devel:<font></font>
      values:<font></font>
      - charts:<font></font>
          versions:<font></font>
            backend: 1.1.0<font></font>
      - apps:<font></font>
        - postgres<font></font>
        - backend<font></font>
<font></font>
    production:<font></font>
      values:<font></font>
      - charts:<font></font>
          versions:<font></font>
            backend: 1.0.5<font></font>
      - apps:<font></font>
        - backend<font></font>
<font></font>
<span class="hljs-deletion">- releases:</span>
<span class="hljs-deletion">-    - name: postgres</span>
<span class="hljs-deletion">-      labels:</span>
<span class="hljs-deletion">-        app: postgres</span>
<span class="hljs-deletion">-      wait: true</span>
<span class="hljs-deletion">-      chart: stable/postgresql</span>
<span class="hljs-deletion">-      version: 8.4.0</span>
<span class="hljs-deletion">-      values:</span>
<span class="hljs-deletion">-        - envs/{{ .Environment.Name }}/values/postgres.yaml</span>
<span class="hljs-deletion">-    - name: backend</span>
<span class="hljs-deletion">-      labels:</span>
<span class="hljs-deletion">-        app: backend</span>
<span class="hljs-deletion">-      wait: true</span>
<span class="hljs-deletion">-      chart: private-helm-repo/backend</span>
<span class="hljs-deletion">-     version: {{ .Values.charts.versions.backend }}</span>
<span class="hljs-deletion">-     needs:</span>
<span class="hljs-deletion">-       - postgres</span>
<span class="hljs-deletion">-     values:</span>
<span class="hljs-deletion">-       - envs/{{ .Environment.Name }}/values/backend.yaml</span>
<span class="hljs-addition">+ ---</span>
<span class="hljs-addition">+ bases:</span>
<span class="hljs-addition">+ {{- range .Values.apps }}</span>
<span class="hljs-addition">+   - releases/{{ . }}.yaml</span>
<span class="hljs-addition">+ {{- end }}</span></code></pre><br>
<h4 id="releasespostgresyaml"><strong><code>releases/postgres.yaml</code></strong></h4><br>
<pre><code class="plaintext hljs">releases:<font></font>
  - name: postgres<font></font>
    labels:<font></font>
      app: postgres<font></font>
    wait: true<font></font>
    chart: stable/postgresql<font></font>
    version: 8.4.0<font></font>
    values:<font></font>
      - envs/{{ .Environment.Name }}/values/postgres.yaml</code></pre><br>
<h4 id="releasesbackendyaml"><strong><code>releases/backend.yaml</code></strong></h4><br>
<pre><code class="plaintext hljs">releases:<font></font>
  - name: backend<font></font>
    labels:<font></font>
      app: backend<font></font>
    wait: true<font></font>
    chart: private-helm-repo/backend<font></font>
    version: {{ .Values.charts.versions.backend }}<font></font>
    needs:<font></font>
      - postgres<font></font>
    values:<font></font>
      - envs/{{ .Environment.Name }}/values/backend.yaml</code></pre><br>
<hr><br>
<p><strong></strong></p><br>
<p>  <code>bases:</code>    yaml  <code>---</code>,     releases (  ,  helmDefaults)   environments</p><br>
<hr><br>
<p>    postgres       production.  !</p><br>
<h2 id="pereopredelyaemye-globalnye-znacheniya-dlya-relizov">    </h2><br>
<p>, ,         helm ,        ,   , ,     <code>affinity</code>,      -   ,    .</p><br>
<p>          2   values:    ,      ,      ,        .</p><br>
<pre><code class="diff hljs">    .<font></font>
    â”œâ”€â”€ envs<font></font>
<span class="hljs-addition">+   â”‚&nbsp;&nbsp; â”œâ”€â”€ default</span>
<span class="hljs-addition">+   â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp; â””â”€â”€ values</span>
<span class="hljs-addition">+   â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;     â”œâ”€â”€ backend.yaml</span>
<span class="hljs-addition">+   â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;     â””â”€â”€ postgres.yaml</span><font></font>
    â”‚&nbsp;&nbsp; â”œâ”€â”€ devel<font></font>
    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp; â””â”€â”€ values<font></font>
    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;     â”œâ”€â”€ backend.yaml<font></font>
    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;     â””â”€â”€ postgres.yaml<font></font>
    â”‚&nbsp;&nbsp; â””â”€â”€ production<font></font>
    â”‚&nbsp;&nbsp;     â””â”€â”€ values<font></font>
    â”‚&nbsp;&nbsp;         â”œâ”€â”€ backend.yaml<font></font>
    â”‚&nbsp;&nbsp;         â””â”€â”€ postgres.yaml<font></font>
    â”œâ”€â”€ releases<font></font>
    â”‚&nbsp;&nbsp; â”œâ”€â”€ backend.yaml<font></font>
    â”‚&nbsp;&nbsp; â””â”€â”€ postgres.yaml<font></font>
    â””â”€â”€ helmfile.yaml</code></pre><br>
<h4 id="releasesbackendyaml-1"><strong><code>releases/backend.yaml</code></strong></h4><br>
<pre><code class="diff hljs">releases:<font></font>
  - name: backend<font></font>
    labels:<font></font>
      app: backend<font></font>
    wait: true<font></font>
    chart: private-helm-repo/backend<font></font>
    version: {{ .Values.charts.versions.backend }}<font></font>
    needs:<font></font>
      - postgres<font></font>
    values:<font></font>
<span class="hljs-addition">+     - envs/default/values/backend.yaml</span>
      - envs/{{ .Environment.Name }}/values/backend.yaml</code></pre><br>
<h4 id="envsdefaultvaluesbackendyaml"><strong><code>envs/default/values/backend.yaml</code></strong></h4><br>
<pre><code class="plaintext hljs">affinity:<font></font>
  podAntiAffinity:<font></font>
    preferredDuringSchedulingIgnoredDuringExecution:<font></font>
    - weight: 1<font></font>
      podAffinityTerm:<font></font>
        labelSelector:<font></font>
          matchExpressions:<font></font>
          - key: app.kubernetes.io/name<font></font>
            operator: In<font></font>
            values:<font></font>
            - backend<font></font>
        topologyKey: "kubernetes.io/hostname"</code></pre><br>
<h2 id="opredelenie-globalnyh-znacheniy-dlya-helm-chartov-vseh-relizov-na-urovne-okruzheniya">    helm      </h2><br>
<p>,        ingress â€”         <code>hosts:</code>,         ,                 ?      values,    ,     <code>.gotmpl</code>,  helmfile ,      .</p><br>
<pre><code class="diff hljs">    .<font></font>
    â”œâ”€â”€ envs<font></font>
    â”‚&nbsp;&nbsp; â”œâ”€â”€ default<font></font>
    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp; â””â”€â”€ values<font></font>
<span class="hljs-deletion">-   â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;     â”œâ”€â”€ backend.yaml</span>
<span class="hljs-deletion">-   â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;     â”œâ”€â”€ postgres.yaml</span>
<span class="hljs-addition">+   â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;     â”œâ”€â”€ backend.yaml.gotmpl</span>
<span class="hljs-addition">+   â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;     â””â”€â”€ postgres.yaml.gotmpl</span><font></font>
    â”‚&nbsp;&nbsp; â”œâ”€â”€ devel<font></font>
    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp; â””â”€â”€ values<font></font>
    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;     â”œâ”€â”€ backend.yaml<font></font>
    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;     â””â”€â”€ postgres.yaml<font></font>
    â”‚&nbsp;&nbsp; â””â”€â”€ production<font></font>
    â”‚&nbsp;&nbsp;     â””â”€â”€ values<font></font>
    â”‚&nbsp;&nbsp;         â”œâ”€â”€ backend.yaml<font></font>
    â”‚&nbsp;&nbsp;         â””â”€â”€ postgres.yaml<font></font>
    â”œâ”€â”€ releases<font></font>
    â”‚&nbsp;&nbsp; â”œâ”€â”€ backend.yaml<font></font>
    â”‚&nbsp;&nbsp; â””â”€â”€ postgres.yaml<font></font>
    â””â”€â”€ helmfile.yaml</code></pre><br>
<h4 id="helmfileyaml-3"><strong><code>helmfile.yaml</code></strong></h4><br>
<pre><code class="diff hljs">  environments:<font></font>
    devel:<font></font>
      values:<font></font>
      - charts:<font></font>
          versions:<font></font>
            backend: 1.1.0<font></font>
      - apps:<font></font>
        - postgres<font></font>
        - backend<font></font>
<span class="hljs-addition">+     - global:</span>
<span class="hljs-addition">+         ingressDomain: k8s.devel.domain</span><font></font>
<font></font>
    production:<font></font>
      values:<font></font>
      - charts:<font></font>
          versions:<font></font>
            backend: 1.0.5<font></font>
      - apps:<font></font>
        - backend<font></font>
<span class="hljs-addition">+     - global:</span>
<span class="hljs-addition">+         ingressDomain: production.domain</span><font></font>
  ---<font></font>
  bases:<font></font>
  {{- range .Values.apps }}<font></font>
    - releases/{{ . }}.yaml<font></font>
  {{- end }}</code></pre><br>
<h4 id="envsdefaultvaluesbackendyamlgotmpl"><strong><code>envs/default/values/backend.yaml.gotmpl</code></strong></h4><br>
<pre><code class="plaintext hljs">ingress:<font></font>
  enabled: true<font></font>
  paths:<font></font>
    - /api<font></font>
  hosts:<font></font>
    - {{ .Values.global.ingressDomain }}</code></pre><br>
<h4 id="envsdefaultvaluespostgresyamlgotmpl"><strong><code>envs/default/values/postgres.yaml.gotmpl</code></strong></h4><br>
<pre><code class="plaintext hljs">ingress:<font></font>
  enabled: true<font></font>
  paths:<font></font>
    - /<font></font>
  hosts:<font></font>
    - postgres.{{ .Values.global.ingressDomain }}</code></pre><br>
<hr><br>
<p><strong></strong></p><br>
<p>,  ingress   postgres â€”    ,               ,      -      ingress</p><br>
<hr><br>
<h2 id="podstanovka-sekretov-secrets-iz-znacheniy-okruzheniya">  (secrets)   </h2><br>
<p>           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">helm secrets</a> .  ,        secrets,       ,       default.yaml.gotmpl ,     ,    .  ,        ,          .</p><br>
<pre><code class="diff hljs">    .<font></font>
    â”œâ”€â”€ envs<font></font>
    â”‚&nbsp;&nbsp; â”œâ”€â”€ default<font></font>
    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp; â””â”€â”€ values<font></font>
    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;     â”œâ”€â”€ backend.yaml<font></font>
    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;     â””â”€â”€ postgres.yaml<font></font>
    â”‚&nbsp;&nbsp; â”œâ”€â”€ devel<font></font>
    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp; â”œâ”€â”€ values<font></font>
    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp; â”œâ”€â”€ backend.yaml<font></font>
    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp; â””â”€â”€ postgres.yaml<font></font>
<span class="hljs-addition">+   â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp; â””â”€â”€ secrets.yaml</span><font></font>
    â”‚&nbsp;&nbsp; â””â”€â”€ production<font></font>
    â”‚&nbsp;&nbsp;     â”œâ”€â”€ values<font></font>
    â”‚&nbsp;&nbsp;     â”‚&nbsp;&nbsp; â”œâ”€â”€ backend.yaml<font></font>
    â”‚&nbsp;&nbsp;     â”‚&nbsp;&nbsp; â””â”€â”€ postgres.yaml<font></font>
<span class="hljs-addition">+   â”‚&nbsp;&nbsp;     â””â”€â”€ secrets.yaml</span><font></font>
    â”œâ”€â”€ releases<font></font>
    â”‚&nbsp;&nbsp; â”œâ”€â”€ backend.yaml<font></font>
    â”‚&nbsp;&nbsp; â””â”€â”€ postgres.yaml<font></font>
    â””â”€â”€ helmfile.yaml</code></pre><br>
<h4 id="helmfileyaml-4"><strong><code>helmfile.yaml</code></strong></h4><br>
<pre><code class="diff hljs">  environments:<font></font>
    devel:<font></font>
      values:<font></font>
      - charts:<font></font>
          versions:<font></font>
            backend: 1.1.0<font></font>
      - apps:<font></font>
        - postgres<font></font>
        - backend<font></font>
      - global:<font></font>
          ingressDomain: k8s.devel.domain<font></font>
<span class="hljs-addition">+     secrets:</span>
<span class="hljs-addition">+       - envs/devel/secrets.yaml</span><font></font>
<font></font>
    production:<font></font>
      values:<font></font>
      - charts:<font></font>
          versions:<font></font>
            backend: 1.0.5<font></font>
      - apps:<font></font>
        - backend<font></font>
      - global:<font></font>
          ingressDomain: production.domain<font></font>
<span class="hljs-addition">+     secrets:</span>
<span class="hljs-addition">+       - envs/production/secrets.yaml</span><font></font>
  ---<font></font>
  bases:<font></font>
  {{- range .Values.apps }}<font></font>
    - releases/{{ . }}.yaml<font></font>
  {{- end }}</code></pre><br>
<h4 id="envsdevelsecretsyaml"><strong><code>envs/devel/secrets.yaml</code></strong></h4><br>
<pre><code class="plaintext hljs">secrets:<font></font>
    elastic:<font></font>
        password: ENC[AES256_GCM,data:hjCB,iv:Z1P6/6xBJgJoKLJ0UUVfqZ80o4L84jvZfM+uH9gBelc=,tag:dGqQlCZnLdRAGoJSj63rBQ==,type:int]<font></font>
...</code></pre><br>
<h4 id="envsproductionsecretsyaml"><strong><code>envs/production/secrets.yaml</code></strong></h4><br>
<pre><code class="plaintext hljs">secrets:<font></font>
    elastic:<font></font>
        password: ENC[AES256_GCM,data:ZB/VpTFk8f0=,iv:EA//oT1Cb5wNFigTDOz3nA80qD9UwTjK5cpUwLnEXjs=,tag:hMdIUaqLRA8zuFBd82bz6A==,type:str]<font></font>
...</code></pre><br>
<h4 id="envsdefaultvaluesbackendyamlgotmpl-1"><strong><code>envs/default/values/backend.yaml.gotmpl</code></strong></h4><br>
<pre><code class="plaintext hljs">elasticsearch:<font></font>
  host: elasticsearch<font></font>
  port: 9200<font></font>
  password: {{ .Values | getOrNil "secrets.elastic.password" | default "password" }}</code></pre><br>
<h4 id="envsdevelvaluesbackendyaml"><strong><code>envs/devel/values/backend.yaml</code></strong></h4><br>
<pre><code class="plaintext hljs">elasticsearch:<font></font>
  host: elastic-0.devel.domain</code></pre><br>
<h4 id="envsproductionvaluesbackendyaml"><strong><code>envs/production/values/backend.yaml</code></strong></h4><br>
<pre><code class="plaintext hljs">elasticsearch:<font></font>
  host: elastic-0.production.domain</code></pre><br>
<hr><br>
<p><strong></strong></p><br>
<p>, <code>getOrNil</code> â€”    go   helmfile, ,   <code>.Values.secrets</code>   ,   ,        <code>default</code>   -</p><br>
<hr><br>
<h2 id="zaklyuchenie"></h2><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hal-hal yang dijelaskan tampaknya cukup jelas, tetapi informasi tentang deskripsi penempatan yang nyaman di beberapa lingkungan menggunakan helmfile sangat langka, dan saya suka IaC (Infrastructure-as-Code) dan saya ingin memiliki deskripsi yang jelas tentang keadaan penyebaran.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sebagai kesimpulan, saya ingin menambahkan bahwa variabel untuk lingkungan default dapat, pada gilirannya, menjadi parameter oleh variabel lingkungan OS dari seorang pelari dari mana penyebaran akan diluncurkan, dan dengan demikian mendapatkan lingkungan yang dinamis</font></font></p><br>
<h4 id="helmfileyaml-5"><strong><code>helmfile.yaml</code></strong></h4><br>
<pre><code class="plaintext hljs">environments:<font></font>
  default:<font></font>
    values:<font></font>
    - global:<font></font>
        clusterDomain: {{ env "CLUSTER_DOMAIN" | default "cluster.local" }}<font></font>
        ingressDomain: {{ env "INGRESS_DOMAIN" }}</code></pre></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id491094/index.html">Menginstal Firebird 3 pada Versi Linux Modern: CentOS8 dan Ubuntu 19</a></li>
<li><a href="../id491100/index.html">Di Wanhao 5S, mereka mencetak boneka dengan tinggi seseorang</a></li>
<li><a href="../id491102/index.html">Bagaimana mengembangkan layanan ketika ada pesaing tangguh di sekitar</a></li>
<li><a href="../id491104/index.html">Bagaimana saya menemukan kesalahan perangkat keras pada tablet Lenovo MiiX 2 10 saya</a></li>
<li><a href="../id491106/index.html">Mengapa Anda perlu replikasi semi-sinkron?</a></li>
<li><a href="../id491110/index.html">Konversi rtf ke xml dalam C #</a></li>
<li><a href="../id491112/index.html">Jalan Menuju Kepolosan Jaringan - Cisco DNA</a></li>
<li><a href="../id491114/index.html">Relokasi cerdas atau cara memilih perusahaan untuk bekerja dan tidak menyesalinya</a></li>
<li><a href="../id491116/index.html">Standar Identifikasi Modern: OAuth 2.0, OpenID Connect, WebAuthn</a></li>
<li><a href="../id491118/index.html">Developer Heart: Devkits dari generasi ke-5 konsol (Bagian 1)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>