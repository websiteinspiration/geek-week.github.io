<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçµ üë®üèº‚Äçüé§ ‚öñÔ∏è Write-up CTFZone Quals 2019: Chicken üèáüèΩ üå≠ üèûÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Despite the postponement of the OFFZONE 2020 conference , there will be a CTFZone final ! This year it will be held for the first time online and will...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Write-up CTFZone Quals 2019: Chicken</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/bizone/blog/492222/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despite the postponement of the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OFFZONE 2020</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conference </font><font style="vertical-align: inherit;">, there </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> be a </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">CTFZone</font></a><font style="vertical-align: inherit;"> final </font><font style="vertical-align: inherit;">! </font><font style="vertical-align: inherit;">This year it will be held for the first time online and will be actively broadcast on social networks. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will announce the details later, but for now, we suggest exploring the webtask startup from the qualifying stage. </font><font style="vertical-align: inherit;">Analysis of the solution was sent to us by </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Devand MacLean</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> from Canada. </font><font style="vertical-align: inherit;">Especially for Habr, we have translated the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">text of the local startup</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and we invite you to find out which chain of vulnerabilities the participants encountered and what does the chicken have to do with it.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qq/kw/um/qqkwum4pqnrjnrgqxa9__wofqec.png"><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">general information</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Author of task:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pavel Sorokin </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Points:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 470 </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Number of teams that solved task:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2</font></font><br>
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Useful links:</font></font></b></p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://gchq.github.io/CyberChef/</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">https://docs.microsoft.com/en-us/aspnet/core/host-and-deploy/directory-structure?view=aspnetcore-3.0</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">https://jakeydocs.readthedocs.io/en/latest/tutorials/first-mvc-app/adding-view.html</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">https://github.com/0xd4d/dnSpy/releases</a></li>
</ul><br>
<h2> </h2><br>
<p>  , - :</p><br>
<ul>
<li>  <b><font color="#ff0000">(/Home/Index)</font></b>;</li>
<li>   <b><font color="#ff0000">(/Home/Hens)</font></b>;</li>
<li>   <b><font color="#ff0000">(/Home/Contact)</font></b>;</li>
<li>   <b><font color="#ff0000">(/Auth/Login)</font></b>.</li>
</ul><br>
<p>, &nbsp; ,   :</p><br>
<ul>
<li>    ;</li>
<li>  &nbsp;API  ,  &nbsp; .</li>
</ul><br>
<h2> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The / Home / Hens page contains links to download chicken ‚Äúpassports‚Äù.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7n/nc/1n/7nnc1nhfmbr0yfkok8ra-hqi1fo.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After decoding Base64, we find the parameter filename: 1.txt. </font><font style="vertical-align: inherit;">Using CyberChef, we encode </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / passwd</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in Base64 and follow the link: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://web-chicken.ctfz.one/File/Download?filename=L2V0Yy9wYXNzd2Q=</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
The contents of the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / passwd file</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on the server are </font><font style="vertical-align: inherit;">opened in the browser </font><font style="vertical-align: inherit;">, which means we get the right to read arbitrary files in the system. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When you try to find other files in the system, you may notice an error that appears every time you request a nonexistent file (or a file that cannot be read with the user rights of the application):</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/oc/au/su/ocausuexy92ii3ackgqn2fnh-ta.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Having seen that the error refers to the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ASPNETCORE_ENVIRONMENT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> environment </font><b><font style="vertical-align: inherit;">variable</font></b><font style="vertical-align: inherit;"> , we begin to study ASP.NET Core web application layouts. </font><font style="vertical-align: inherit;">And we see the following:</font></font><br>
 <br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/dr/oz/7s/droz7stwr6mkzt3buptphi6yt88.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To convert the necessary paths and file names and extract them to Base64, we write a small Python script ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fetch.py</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/aq/nv/of/aqnvofypmm8iiotr8xq0koyybtg.png"></div><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using this knowledge about the structure of the MVC web application created in ASP.NET Core, using fetch.py ‚Äã‚Äãwe get the source code for the following files:</font></font></p><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">../Views/Shared/_Layout.cshtml</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">../Views/Home/Index.cshtml</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">../Views/Home/Contact.cshtml</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">../Views/Home/Hens.cshtml</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">../Views/Auth/Login.cshtml</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Having done this and having studied the source code of each page, we find an interesting detail in Hens.cshtml </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7w/kp/mq/7wkpmqusqncbmjsdigxelqxxy2c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Line 1 contains the inclusion statement @ using StackHenneryMVCAppProject, which in ASP.NET means a link to a DLL file. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We open ../StackHenneryMVCAppProject.dll - but not through the Python utility in Kali Linux, but in the browser on Windows, because we are going to decompile this file in Windows. Through the use of such the URL: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://web-chicken.ctfz.one/File/Download?filename=Li4vU3RhY2tIZW5uZXJ5TVZDQXBwUHJvamVjdC5kbGw=</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Opening DLL-file in dnSpy (.NET decompiler), immediately see that in the method </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Initialize ()</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> class </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Config. Configuration</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which runs when the web application starts, reads the contents of the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chicken_domains_internal.txt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">. Using a Python script, we extract the contents of this file: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
web-chicken-flag</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
web-chicken-auth </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Initialize ()</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">connects to&nbsp; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">web-chicken-flag</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> via port 4321 and receives several parameters: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">secret_token</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSA_key</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and&nbsp; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flag</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unfortunately, it is not possible to initiate a connection to web-chicken-flag. But, when we set the local DNS hosts record to translate web-chicken-auth to the server‚Äôs external IP address ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">34.89.232.240</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), we manage to open </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http: // web-chicken-auth /</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Swagger UI</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> interface </font><font style="vertical-align: inherit;">that is used to describe and execute commands through the REST API.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zy/jq/he/zyjqherp-esnmlziil2jnubkram.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
While digging into the decompiled DLL file, you can notice that the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AuthController</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> controller </font><font style="vertical-align: inherit;">had not only the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Login ()</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method, but also the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Change_Password_Test ()</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/tz/zb/1c/tzzb1cui_v-acwn19zzbvi-5kbq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When we go to&nbsp; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ Auth / Change_Password_Test</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> we see this form:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/hx/-l/we/hx-lwesr4_cxhuu-ryjzb2ku76w.png"></div><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When studying the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Change_Password_Test ()</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method, </font><font style="vertical-align: inherit;">we understand that it processes four parameters of type String through an HTTP POST request:</font></font></p><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">username;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">new_password;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">old_password;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base_url.</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qx/ik/qt/qxikqtcwxuiix9mslp_stalz9ea.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A little lower in the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Change_Password_Test ()</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">we see: without receiving a value for </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base_url</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the method takes the value </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conf.auth_server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , that is </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">web-chicken-auth</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and then adds </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ auth / login</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to the end of the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base_url</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> value </font><font style="vertical-align: inherit;">, assigning the resulting string to the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requestUri</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> variable </font><font style="vertical-align: inherit;">:</font></font><br>
 <br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/-d/aa/uj/-daaujfp1ocf8i6l9gtf1rtvemi.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the next important part of the code, the string values ‚Äã‚Äãof the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">username</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and&nbsp; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">old_password parameters</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> from the HTTP POST request, and with them the&nbsp; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">secret_token</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> from the configuration, are inserted into the JSON string. Then, a JSON </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StringContent</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> object is created from this data </font><font style="vertical-align: inherit;">, which is sent as HTTP POST data to the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requestURI</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> variable </font><font style="vertical-align: inherit;">created in the previous step.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/3w/qd/5b/3wqd5b7hjj1ftppsvtcxvfdpdyi.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now the server waits for the HTTP POST request to&nbsp; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requestUri to</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> return the JSON object with the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parameter </font><font style="vertical-align: inherit;">equal to 0. If this does not happen, we get to the code branch that starts from line 6 and returns the view </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ Views / Auth / Login</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with the error </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Invalid login / password</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the HTTP POST request still </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">returns</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a JSON object with the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parameter </font><font style="vertical-align: inherit;">equal to 0, we go to the code branch from line 11. Then the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requestUri2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> variable </font><font style="vertical-align: inherit;">gets the value </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http: // web-chicken-auth</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , another JSON </font><b><font style="vertical-align: inherit;">StringContent</font></b><font style="vertical-align: inherit;"> object is created</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with the parameters from the original HTTP POST request, as in the previous part, and this data is sent to the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requestUri2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> address </font><font style="vertical-align: inherit;">&nbsp;in the HTTP PUT request. Finally, the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Password changed</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> message is returned to the client </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/cj/8y/wh/cj8ywhk0pr5vmdm8uyabhg26cf0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In a nutshell: the whole process begins with an HTTP POST request to&nbsp; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ Auth / Change_Password_Test</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which expects a certain number of parameters. It takes these values ‚Äã‚Äãand creates a JSON object to send it to&nbsp; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;base_url&gt; / auth / login</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> via HTTP POST. If in response it receives JSON with the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parameter </font><font style="vertical-align: inherit;">equal to 0, it creates another JSON object and sends an HTTP PUT request to&nbsp; </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http: // web-chicken-auth / auth / change_password</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When learning the REST API in Swagger UI, we see that in the decompiled DLL file there were not only the routes </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ auth / login</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;/ auth / change_password</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but also the route for </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ auth / password_recovery</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/oh/kn/3p/ohkn3pbbiptuoxndp_xxo-in92q.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This API route expected a JSON object with two parameters: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">email</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and&nbsp; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">secret_token</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . If he received it, then he returned a JSON object with a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> property </font><font style="vertical-align: inherit;">of 0 and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">message</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and&nbsp; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">token</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> strings </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qw/a1/j3/qwa1j37cbbppj5gpzr8iz6vdl2q.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It turns out that if we somehow force the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Check_Password_Test ()</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method to </font><font style="vertical-align: inherit;">immediately request the route </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ auth / password_recovery</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> instead of </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ auth / login</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , then to enter the password change branch it will be enough to enter a valid email address. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We again study the part of the code in which the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Check_Password_Test ()</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">assigns the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requestUri</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> value </font><font style="vertical-align: inherit;">in the original HTTP POST request, and we understand that we need to send the value </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http: // web-chicken-auth / auth / password_recovery #</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> as the base_url parameter, and requestUri in the final the result will be </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http: // web-chicken-auth / auth / password_recovery # / auth / login</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The # character in the HTTP URL indicates that part of the request address has ended. Therefore, the server that receives the request will simply ignore the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ auth / login part</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/-d/aa/uj/-daaujfp1ocf8i6l9gtf1rtvemi.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This, of course, is good, but we just have to figure out how the REST endpoint, where we now redirect the request, will receive the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">email</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> value </font><font style="vertical-align: inherit;">. Without this value, the request will fail, and we will not go any further. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We carefully look at how the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Check_Password_Test ()</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">creates JSON data, and we see that the input data is not cleared at all, which means that you can easily implement your parameters. It is enough to send the following parameters in the HTTP POST request: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
username = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">admin</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
old_password = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pwned "," email ":" admin@chicken.ctf.zone "," lol ":"</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
new_password = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p0tat0</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
base_url = </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http: // web-chicken-auth / auth / password_recovery #</font></font></a></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The resulting JSON object is sent to&nbsp; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ auth / password_recovery</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/02/h8/4-/02h84-3pz0w1c7_bg2hlyqt4k7o.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With this JSON data, we met the requirements that </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ auth / password_recovery</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> should return a response, after which the server will enter the password change branch (the JSON object contains the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">email</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> property </font><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Now </font><font style="vertical-align: inherit;">we no longer need the </font><font style="vertical-align: inherit;">value of </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">old_password</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In this code branch, we provided all the values ‚Äã‚Äãnecessary to change the password (the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">username</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> property </font><font style="vertical-align: inherit;">is </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">admin</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">password</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> property </font><font style="vertical-align: inherit;">is </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p0tat0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">The request is completed, and we get </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Password changed</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in response.</font></font><br>
 <br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/dl/pa/nw/dlpanwrefhtrjpvetawk6ed2nva.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It remains only to enter a new username and password on the login page!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ee/zx/is/eezxiswaxjxezkq8cezfrbinggs.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And here is our flag:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/yy/ge/iw/yygeiwxjauomdcsnyqp2pabdcou.png"></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en492212/index.html">Frontend development of portals on open source software: share experience</a></li>
<li><a href="../en492214/index.html">Why is it worth making meetings while walking? Proven by science, confirmed by the mafia</a></li>
<li><a href="../en492216/index.html">Saving Values ‚Äã‚Äãin a .Net Application at the Build Stage</a></li>
<li><a href="../en492218/index.html">Icon Design Rules to Remember</a></li>
<li><a href="../en492220/index.html">5 little-known secrets of Pandas</a></li>
<li><a href="../en492226/index.html">Price Comparison on Managed Kubernetes (2020)</a></li>
<li><a href="../en492228/index.html">As Sports.ru wrote their WYSIWYG editor</a></li>
<li><a href="../en492232/index.html">How Smartcalls became Voximplant Kit - rebranding and killer features</a></li>
<li><a href="../en492234/index.html">Research: why people are ready to receive less in social projects</a></li>
<li><a href="../en492242/index.html">M5Stack and its contacts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>