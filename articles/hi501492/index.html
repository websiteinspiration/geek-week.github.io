<!doctype html>
<html class="no-js" lang="hi">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯПд ЁЯМ╢я╕П ЁЯРЮ рдкрд╛рдпрдерди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд╛рд╡рд░ рдмреАрдЖрдИ рдХреЙрд╣реЛрд░реНрдЯ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рджреЛрд╣рд░рд╛рдПрдВ ЁЯд╡ЁЯП╗ ЁЯзЧЁЯП╗ ЁЯСД</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╢реБрдн рджреЛрдкрд╣рд░, рдкреНрд░рд┐рдп рдкрд╛рдардХреЛрдВ! рдЗрд╕ рдкреНрд░рдХрд╛рд╢рди рдХреЛ рд▓рд┐рдЦрдиреЗ рдХрд╛ рдХрд╛рд░рдг рдПрдХ рд╡реЗрдмрд┐рдирд╛рд░ рдерд╛, рдЬрд┐рд╕реЗ рдореИрдВрдиреЗ Youtube рдкрд░ рджреЗрдЦрд╛ред рд╡рд╣ рдмрд┐рдХреНрд░реА рдХреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдкрд┐рдд рдерд╛ред рд▓реЗрдЦрдХ рдиреЗ рдбреЗрдЯрд╛ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>рдкрд╛рдпрдерди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд╛рд╡рд░ рдмреАрдЖрдИ рдХреЙрд╣реЛрд░реНрдЯ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рджреЛрд╣рд░рд╛рдПрдВ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501492/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реБрдн рджреЛрдкрд╣рд░, рдкреНрд░рд┐рдп рдкрд╛рдардХреЛрдВ! </font><font style="vertical-align: inherit;">рдЗрд╕ рдкреНрд░рдХрд╛рд╢рди рдХреЛ рд▓рд┐рдЦрдиреЗ рдХрд╛ рдХрд╛рд░рдг рдПрдХ рд╡реЗрдмрд┐рдирд╛рд░ рдерд╛, рдЬрд┐рд╕реЗ рдореИрдВрдиреЗ Youtube рдкрд░ рджреЗрдЦрд╛ред </font><font style="vertical-align: inherit;">рд╡рд╣ рдмрд┐рдХреНрд░реА рдХреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдкрд┐рдд рдерд╛ред </font><font style="vertical-align: inherit;">рд▓реЗрдЦрдХ рдиреЗ рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП Power BI рдбреЗрд╕реНрдХрдЯреЙрдк рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред </font><font style="vertical-align: inherit;">рдореИрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╡реАрдбрд┐рдпреЛ рдХрд╛ рд▓рд┐рдВрдХ рдкреНрд░рджрд╛рди рдирд╣реАрдВ рдХрд░реВрдВрдЧрд╛, рддрд╛рдХрд┐ рдЗрд╕ рд▓реЗрдЦ рдХреЛ рдПрдХ рд╡рд┐рдЬреНрдЮрд╛рдкрди рдХреЗ рд░реВрдк рдореЗрдВ рдирд╣реАрдВ рдорд╛рдирд╛ рдЬрд╛рдП, рд▓реЗрдХрд┐рди рд╡рд░реНрдгрди рдХреЗ рджреМрд░рд╛рди рдореИрдВ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдирд┐рд░реНрдгрдп рдХреЗ рддрд░реНрдХ рдХреЛ рдмреЗрд╣рддрд░ рдврдВрдЧ рд╕реЗ рд╕рдордЭрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдореВрд▓ рд╕реНрд░реЛрдд рдХреЛ рдмрд┐рдЧрд╛рдбрд╝рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реВрдВрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕ рд╡реЗрдмрд┐рдирд╛рд░ рдиреЗ рдореБрдЭреЗ рдпрд╣ рд╡рд┐рдЪрд╛рд░ рджрд┐рдпрд╛ рдХрд┐ рдкрдВрдбреЛрдВ рдХреЗ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЗ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд╕рд╛рде DAX рд╕реВрддреНрд░реЛрдВ рдХреА рд╕рдВрднрд╛рд╡рдирд╛рдУрдВ рдХреЛ рджреЛрд╣рд░рд╛рдирд╛ рджрд┐рд▓рдЪрд╕реНрдк рд╣реЛрдЧрд╛ред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рджреЛ рдмрд┐рдВрджреБ рдЬрд┐рди рдкрд░ рдореИрдВ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдВред рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдпрд╣ рд╕рд╛рдордЧреНрд░реА рд╢реБрд░реБрдЖрддреА рд╡рд┐рд╢реНрд▓реЗрд╖рдХреЛрдВ рдХреЗ рд▓рд┐рдП рдЕрднрд┐рдкреНрд░реЗрдд рд╣реИ рдЬреЛ рдХреЗрд╡рд▓ рдкрд╛рдпрдерди рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рднрд╛рд╖рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдореЗрдВ рдЕрдкрдирд╛ рдкрд╣рд▓рд╛ рдХрджрдо рдЙрдард╛ рд░рд╣реЗ рд╣реИрдВред рдЖрджрд░реНрд╢ рдпрджрд┐ рдкрд╛рдардХ рдкрд╛рд╡рд░ рдмреАрдЖрдИ рдПрдирд╛рд▓рд┐рдЯрд┐рдХреНрд╕ рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рд╕реЗ рдкрд░рд┐рдЪрд┐рдд рд╣реИрдВред рджреВрд╕рд░реЗ, рдЪреВрдВрдХрд┐ DAX рдЧрдгрдирд╛ рдкреНрд░реЗрд░рдгрд╛ рд╕реНрд░реЛрдд рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддреА рд╣реИ, рдореИрдВ рдЬрд╣рд╛рдБ рддрдХ рд╕рдВрднрд╡ рд╣реЛ рд▓реЗрдЦрдХ рдХреЗ рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдХреА "рдкреНрд░рддрд┐рд▓рд┐рдкрд┐" рдХрд░реЗрдЧрд╛, рдФрд░ рдЕрдирд┐рд╡рд╛рд░реНрдп рд░реВрдк рд╕реЗ рдореБрдЦреНрдп рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдкреНрд░рддрд┐рдорд╛рдиреЛрдВ рд╕реЗ рдкреНрд░рд╕реНрдерд╛рди рд╣реЛрдЧрд╛ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд░рд┐рдЪрдп рдХреЗ рд╕рд╛рде, рдмрд╕ рдЗрддрдирд╛ рд╣реАред рдЖрдУ рдпрд╛рддреНрд░рд╛ рд╢реБрд░реВ рдХрд░реЗрдВ!</font></font><br>
<br>
<a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо JupyterLab рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рд╕рднреА рдЧрдгрдирд╛ рдХрд░реЗрдВрдЧреЗред рд▓реИрдкрдЯреЙрдк рд╕рдорд╛рдзрд╛рди ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓рд┐рдВрдХ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) рдореЗрдВ </font><font style="vertical-align: inherit;">рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд╛рд╡рд░ рдХреНрд╡реЗрд░реА рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЗрдЯрд╛ рдХреЛ Power BI рдореЗрдВ рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдпрд╣ рдПрдХ рджреГрд╢реНрдп рд╕рдВрдкрд╛рджрдХ рд╣реИ рдЬреЛ M рднрд╛рд╖рд╛ рдореЗрдВ рдкреНрд░рд╢реНрди рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИ)ред рд╡рд┐рдХрд╛рд╕ рдХреЗ рджреМрд░рд╛рди рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдирд┐рдпрдо рдХрд╛ рдкрд╛рд▓рди рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП: рд╕рднреА рдбреЗрдЯрд╛ рдкреНрд░реАрдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдкрд╛рд╡рд░ рдХреНрд╡реЗрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдФрд░ рдореЗрдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рдкрд╛рд╡рд░ рдзреБрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЧрдгрдирд╛ рдХреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдПред рдЪреВрдВрдХрд┐ рд╣рдорд╛рд░рд╛ рдореБрдЦреНрдп рдкреБрд╕реНрддрдХрд╛рд▓рдп рдкрдВрдбреЛрдВ рд╣реИ, рд╣рдо рддреБрд░рдВрдд рдЗрд╕рдХреА рдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред</font></font><br>
<br>
<pre><code class="python hljs">%%time
<span class="hljs-comment">#   </span>
path_to_data = <span class="hljs-string">"C:/Users/Pavel/Documents/Demo/"</span>
<span class="hljs-comment"># </span>
df = pd.read_csv(os.path.join(path_to_data, <span class="hljs-string">"ohortAnalysis_2016_2018.csv"</span>), sep=<span class="hljs-string">";"</span>, parse_dates=[<span class="hljs-string">"date"</span>], dayfirst=<span class="hljs-literal">True</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо рднрд╡рд┐рд╖реНрдп рдореЗрдВ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдордп рд▓реЗрдиреЗ рд╡рд╛рд▓реЗ рд╡рд░реНрдЧреЛрдВ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд░рдирдЯрд╛рдЗрдо рдкрд░ рдХреЛрдб рдХреА рд▓рд╛рдЗрдиреЛрдВ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░реЗрдВрдЧреЗред рд░реАрдб рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП рдкреВрд░реНрдг рдкрде рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдУрдПрд╕ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред рд▓реИрдкрдЯреЙрдк рд╡рд┐рдХрд╕рд┐рдд рдХрд░рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕рд░рд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдЗрд╕рдХреЗ рдмрд┐рдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдбреЗрдЯрд╛рд╕реЗрдЯ рд╕реНрд╡рдпрдВ рдмреЗрддрд░рддреАрдм рдврдВрдЧ рд╕реЗ рдмрдирд╛ рд╣реИред CSV рдлрд╝рд╛рдЗрд▓ рдореЗрдВ 1,048,575 рд▓рд╛рдЗрдиреЗрдВ рд╣реИрдВред Read_csv () рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рд╛рде рдбреЗрдЯрд╛ рдкрдврд╝рдирд╛ рдЖрдорддреМрд░ рдкрд░ рд╕реАрдзрд╛ рд╣реЛрддрд╛ рд╣реИред рдпрд╣ рдХреЙрд▓рдо рд╡рд┐рднрд╛рдЬрдХ рдФрд░ рдХреЙрд▓рдо рдХреЛ рддрд┐рдерд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ, рдпрджрд┐ рдХреЛрдИ рд╣реИ, рддреЛ рд╕рд░рдгреА рдореЗрдВред рдпрджрд┐ рдЬрд╛рдирдХрд╛рд░реА рдХреБрдЫ "рд╕реБрд╡рд┐рдзрд╛рдУрдВ" рдХреЗ рд╕рд╛рде рдЕрдкрд▓реЛрдб рдХреА рдЧрдИ рдереА, рддреЛ рдЖрдкрдХреЛ рдЕрддрд┐рд░рд┐рдХреНрдд рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдкреНрд░рддреНрдпреЗрдХ рдХреЙрд▓рдо рдХреЗ рд▓рд┐рдП рдПрдиреНрдХреЛрдбрд┐рдВрдЧ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдбреЗрдЯрд╛ рдкрд░рд┐рд╡рд░реНрддрди рдХреА рдкреНрд░рдЧрддрд┐ рдХреЛ рдиреЗрддреНрд░рд╣реАрди рд░реВрдк рд╕реЗ рдореЙрдирд┐рдЯрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд┐рд░ () рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдХреНрд╕рд░ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рд╕рднреА рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЛ рдирд╣реАрдВ рдХрд╛рдЯрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╕реНрдкрд╖реНрдЯ рдЦрд╛рдорд┐рдпрд╛рдВ рдореМрдХреЗ рдкрд░ рд╣реА рддрдп рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореЙрдбрд▓ рдореЗрдВ рдбреЗрдЯрд╛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╡реЗрдмрд┐рдирд╛рд░ рдХреЗ рд▓реЗрдЦрдХ рдбреЗрдЯрд╛ рд╕рд░рдгреА рдХреЛ рд╕реЙрд░реНрдЯ рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдЕрдиреБрдХреНрд░рдордгрд┐рдХрд╛ рдХреЗ рд╕рд╛рде рдПрдХ рд╕рд╣рд╛рдпрдХ рд╕реНрддрдВрдн рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЗрд╕ рдХреЙрд▓рдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рд▓реЗрдХрд┐рди рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдореЗрдВ рдлрд╝реАрд▓реНрдб рдХреА рд╕рд╣реА рдЧрдгрдирд╛ рдХреЛ рдЕрдзрд┐рдХ рдЖрд╕рд╛рдиреА рд╕реЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рдХреЛ рднреА рдХреНрд░рдордмрджреНрдз рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред</font></font><br>
<br>
<pre><code class="python hljs">%%time
<span class="hljs-comment">#  ,      </span>
df.sort_values([<span class="hljs-string">"user_id"</span>,<span class="hljs-string">"date"</span>], inplace = <span class="hljs-literal">True</span>)</code></pre><br>
<img src="https://habrastorage.org/webt/t7/ek/x9/t7ekx9mfwh5z7cahruxyrvlvetq.png" alt="рдЫрд╡рд┐"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдЧрд▓реЗ рдЪрд░рдг рдореЗрдВ, рдкрд╛рд╡рд░ рдмреАрдЖрдИ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдкрд░ рд╕рдорд╛рдзрд╛рди рдПрдХ рд╕рд╣рд╛рдпрдХ рддрд╛рд▓рд┐рдХрд╛ рдмрдирд╛рдиреЗ рдХрд╛ рдкреНрд░рд╕реНрддрд╛рд╡ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╕реЗ рдбреЗрдЯрд╛ рдореБрдЦреНрдп рд╕рд░рдгреА рдореЗрдВ рдЦреАрдВрдЪ рд▓рд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рддрд╛рд▓рд┐рдХрд╛ рдмрдирд╛рдирд╛ SUMMARIZE () рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдЪрдпрдирд┐рдд рд╕рдореВрд╣реЛрдВ рдХреЗ рд▓рд┐рдП рдХреБрд▓ рдпреЛрдЧреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдкрд┐рд╡рдЯ рддрд╛рд▓рд┐рдХрд╛ рдмрдирд╛рддрд╛ рд╣реИ: </font></font><code> df_groupby_user = SUMMARIZE(df;df[user_id];"first_date_transaction";MIN(df[date]);"total_amount_user";SUM(df[amount]);"count_transaction_user";COUNT(df[amount]))</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрдВрдбреЛрдВ рдХреЗ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдореЗрдВ рдЗрд╕рдХреЗ рд╕рдордХрдХреНрд╖ - рдЧреНрд░реБрдкрдмреА () рдлрд╝рдВрдХреНрд╢рди рд╣реИред рдЧреНрд░реБрдкрдмреА () рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрд╡рд╢реНрдпрдХ рдбреЗрдЯрд╛ рдлреНрд░реЗрдо, рдЧреНрд░реБрдкреЗрдмрд▓ рдХреЙрд▓рдо рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ, рдЕрдВрдд рдореЗрдВ рдЙрди рдХреЙрд▓рдореЛрдВ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░реЗрдВ рдЬрд┐рдирдХреЗ рд▓рд┐рдП рдПрдХрддреНрд░реАрдХрд░рдг рдХрд╛рд░реНрдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдкреНрд░рд╛рдкреНрдд рдкрд░рд┐рдгрд╛рдо reset_index () рдлрд╝рдВрдХреНрд╢рди рджреНрд╡рд╛рд░рд╛ рд╕рд╛рдорд╛рдиреНрдп рдбреЗрдЯрд╛ рдлрд╝реНрд░реЗрдо рдХреЗ рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдШрдЯрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдирд┐рд╖реНрдХрд░реНрд╖ рдореЗрдВ, рдЦреЗрддреЛрдВ рдХрд╛ рдирд╛рдо рдмрджрд▓реЗрдВред</font></font><br>
<br>
<pre><code class="python hljs">%%time
<span class="hljs-comment">#       user_id. </span>
df_groupby_user = df.groupby(by = [<span class="hljs-string">"user_id"</span>]).agg({<span class="hljs-string">"date"</span>: <span class="hljs-string">"min"</span>, <span class="hljs-string">"amount"</span>: [<span class="hljs-string">"sum"</span>,<span class="hljs-string">"count"</span>]})<font></font>
df_groupby_user.reset_index(inplace = <span class="hljs-literal">True</span>)
<span class="hljs-comment"># </span>
new_columns = [<span class="hljs-string">"user_id"</span>,<span class="hljs-string">"first_date_transaction"</span>, <span class="hljs-string">"total_amount_user"</span>,<span class="hljs-string">"count_transaction_user"</span>]<font></font>
df_groupby_user.columns = new_columns</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"рдкрд╣рд▓реА рдЦрд░реАрдж рдХреА рддрд╛рд░реАрдЦ" рдореАрдЯреНрд░рд┐рдХ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдкреНрд░рддрд┐ рдЧреНрд░рд╛рд╣рдХ рд▓реЗрдирджреЗрди рдХреА рд╕рдВрдЦреНрдпрд╛ рдФрд░ рдкреВрд░реА рдЕрд╡рдзрд┐ рдХреЗ рд▓рд┐рдП рдЧреНрд░рд╛рд╣рдХ рдЦрд░реАрдж рдХреА рдХреБрд▓ рд░рд╛рд╢рд┐ рдХреА рдЧрдгрдирд╛ рдХреА рдЬрд╛рддреА рд╣реИред рдорд╛рдк рд▓реИрдкрдЯреЙрдк рдореЗрдВ рдЙрдирдХреЗ рдЖрд╡реЗрджрди рдХреЛ рдирд╣реАрдВ рдорд┐рд▓рд╛, рд▓реЗрдХрд┐рди рд╣рдо рдЙрдиреНрд╣реЗрдВ рдирд╣реАрдВ рд╣рдЯрд╛рдПрдВрдЧреЗред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо рд╡реЗрдмрд┐рдирд╛рд░ рдкрд░ рд▓реМрдЯрддреЗ рд╣реИрдВред рдирдП рдореАрдЯреНрд░рд┐рдХ "рдкрд╣рд▓реА рдЦрд░реАрдж рдХрд╛ рд╡рд░реНрд╖-рдорд╣реАрдирд╛" рдХреА рдЧрдгрдирд╛ рдХреА рдЬрд╛рддреА рд╣реИред DAX рд╕реВрддреНрд░: </font></font><code> first_transaction = FORMAT(df_groupby_user[first_date_transaction];"YYYY-MM")</code><br>
<br>
<img src="https://habrastorage.org/webt/4l/3n/xo/4l3nxosdn2pddiqx3pffvtrniec.png" alt="рдЫрд╡рд┐"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд╛рдпрдерди рд╕рд┐рдВрдЯреИрдХреНрд╕ dt.strftime ('% Y-% m') рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдЖрдк рдкрд╛рдпрдерди рдореЗрдВ рджрд┐рдирд╛рдВрдХ рдФрд░ рд╕рдордп рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд╕рдВрдмрдВрдз рдореЗрдВ рдСрдирд▓рд╛рдЗрди рдкреНрд░рдХрд╛рд╢рдиреЛрдВ рдореЗрдВ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рдХрд╛ рд╡рд┐рд╕реНрддреГрдд рд╡рд┐рд╡рд░рдг рдорд┐рд▓реЗрдЧрд╛ред рдЗрд╕ рдХрджрдо рдкрд░, рдХреБрдЫ рдФрд░ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред рдСрдкрд░реЗрд╢рди рдХреЗ рд╕рдордп рдкрд░ рдзреНрдпрд╛рди рджреЗрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрдВрдбреЛрдВ рдХреА рддрд░рд╣ рдкреНрд░рджрд░реНрд╢рди (24.8 рд╕реЗрдХрдВрдб) рдмрд┐рд▓реНрдХреБрд▓ рдирд╣реАрдВред рдХреЛрдб рдХреА рд▓рд╛рдЗрди рдкрд┐рдЫрд▓реЗ рд╕рднреА рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдзреАрдореА рд╣реИред </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд▓рд┐рд╕реНрдЯрд┐рдВрдЧ рдХрд╛ рдпрд╣ рдЯреБрдХрдбрд╝рд╛ рд╕рдВрднрд╡ рд░рд┐рдлреИрдХреНрдЯрд░рд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдкрд╣рд▓рд╛ рдЙрдореНрдореАрджрд╡рд╛рд░ рдмрди рдЬрд╛рддрд╛ рд╣реИред</font></font><br>
<br>
<pre><code class="python hljs">%%time
<span class="hljs-comment">#  -</span>
df_groupby_user[<span class="hljs-string">"first_transaction"</span>] = df_groupby_user[<span class="hljs-string">"first_date_transaction"</span>].dt.strftime(<span class="hljs-string">'%Y-%m'</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рдлрд┐рд░ рд╕реЗ рд╡реЗрдмрд┐рдирд╛рд░ рдкрд░ рд▓реМрдЯрдиреЗ рдХрд╛ рд╕рдордп рд╣реИред </font><font style="vertical-align: inherit;">рдПрдХ рдкреНрд░рдореБрдЦ рдХреНрд╖реЗрддреНрд░ рджреНрд╡рд╛рд░рд╛ рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХрд╛ рдПрдХ рд╕рдВрдШ рд╣реИред </font><font style="vertical-align: inherit;">рддрдм рдЖрд╡рд╢реНрдпрдХ рдлрд╝реАрд▓реНрдб RELATED () рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдореБрдЦреНрдп рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдЦреАрдВрдЪреА рдЬрд╛рддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдкрдВрдбреЛрдВ рдХреЗ рдкрд╛рд╕ рдпрд╣ рд╕реБрд╡рд┐рдзрд╛ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдорд░реНрдЬ (), рдЬреНрд╡рд╛рдЗрди (), рдХреЙрдиреНрдХреИрдЯ () рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдкрд╣рд▓рд╛ рд╡рд┐рдХрд▓реНрдк рд▓рд╛рдЧреВ рдХрд░рдирд╛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рд╣реИред</font></font><br>
<br>
<pre><code class="python hljs">%%time
<span class="hljs-comment"># </span>
df_final = pd.merge(df, df_groupby_user, how = <span class="hljs-string">"left"</span>, on = <span class="hljs-string">"user_id"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд╣рд▓реЗ рд▓реЗрдирджреЗрди рдХреА рддрд╛рд░реАрдЦ рдХреЗ рд╕рд╛рде рдбреЗрдЯрд╛ рдореБрдЦреНрдп рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдЧрд┐рд░ рдЧрдпрд╛, рддреЛ рдЖрдк рдбреЗрд▓реНрдЯрд╛ рдХреА рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдо рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ (39.7 рд╕реЗрдХрдВрдб) рдХреЗ рд╕рдВрд╕рд╛рдзрди-рдЧрд╣рдирддрд╛ рдХреЛ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд▓рд╛рдЧреВ рдирд┐рд░реНрдорд╛рдг (рд▓реИрдореНрдмреНрдбрд╛ x: ...) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ рдХреЛрдб рдкреБрдирд░реНрд▓реЗрдЦрди рдХреЗ рд▓рд┐рдП рдПрдХ рдФрд░ рдЙрдореНрдореАрджрд╡рд╛рд░ рд╣реИред</font></font><br>
<br>
<pre><code class="python hljs">%%time
<span class="hljs-comment">#   "    "</span>
df_final[<span class="hljs-string">"delta_days"</span>] = df_final[<span class="hljs-string">"date"</span>] - df_final[<span class="hljs-string">"first_date_transaction"</span>]<font></font>
df_final[<span class="hljs-string">"delta_days"</span>] = df_final[<span class="hljs-string">"delta_days"</span>].apply(<span class="hljs-keyword">lambda</span> x: x.days)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореБрдЦреНрдп рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдХ рджрд┐рди рдХрд╛ рдбреЗрд▓реНрдЯрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдк рдХреЙрд▓рдо рдбреЗрдЯрд╛ рдХреЛ рдХреЙрд╣реЛрд░реНрдЯреНрд╕ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рд╕рд┐рджреНрдзрд╛рдВрдд: 0 (рдЬреЛ рдЧреНрд░рд╛рд╣рдХ рдХреЛ рдкрд╣рд▓реА рдмрд┐рдХреНрд░реА рд╣реИ) - рдХреЙрд╣реЛрд░реНрдЯ 0; рдорд╛рди 0 рд╕реЗ рдЕрдзрд┐рдХ рд╣реИ, рд▓реЗрдХрд┐рди 30 рд╕реЗ рдХрдо рдпрд╛ рдмрд░рд╛рдмрд░ 30 рд╣реИрдВ; рдорд╛рди 30 рд╕реЗ рдЕрдзрд┐рдХ, рд▓реЗрдХрд┐рди 90 рд╕реЗ рдХрдо рдпрд╛ рдмрд░рд╛рдмрд░ 90 рдЖрджрд┐ред рдЗрди рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП, DAX рдореЗрдВ, рдЖрдк CEILING () рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдирд┐рдХрдЯрддрдо рдкреВрд░реНрдгрд╛рдВрдХ рддрдХ рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдЧреЛрд▓ рдХрд░рддрд╛ рд╣реИ, рджреВрд╕рд░реЗ рдкреИрд░рд╛рдореАрдЯрд░ рд╕реЗ рдореВрд▓реНрдп рдХрд╛ рдПрдХ рдмрд╣реБред</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sd/mu/rh/sdmurhtsdqarznw92jwbklpvjvs.png" alt="рдЫрд╡рд┐"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд╛рдпрдерди рдореЗрдВ, рдореБрдЭреЗ рдПрдХ рд╕рдорд╛рди рдЧрдгрд┐рддреАрдп рдлрд╝рдВрдХреНрд╢рди рдирд╣реАрдВ рдорд┐рд▓рд╛, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдореИрдВрдиреЗ рдЗрд╕реЗ рдЧрдгрд┐рдд рдореЙрдбреНрдпреВрд▓ рдореЗрдВ рдЦреЛрдЬрдиреЗ рдХреА рдпреЛрдЬрдирд╛ рдмрдирд╛рдИ (рд╢рд╛рдпрдж рдореИрдВрдиреЗ рдЦрд░рд╛рдм рддрд░реАрдХреЗ рд╕реЗ рдЦреЛрдЬ рдХреА)ред рдЗрд╕рд▓рд┐рдП, рдореБрдЭреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдЬрд╛рдирд╛ рдкрдбрд╝рд╛ рдФрд░ рдХрдЯ () рдлрд╝рдВрдХреНрд╢рди рд▓рд╛рдЧреВ рдХрд░рдирд╛ рдкрдбрд╝рд╛ред рдХреЛрд╣реЙрд░реНрдЯреНрд╕ рдореЗрдВ рдбреЗрдЯрд╛ рдлреИрд▓рд╛рдиреЗ рдХреЗ рдмрд╛рдж, NaN рдХреЛ 0 рдХреЗ рд╕рдВрдЦреНрдпрд╛рддреНрдордХ рдорд╛рдиреЛрдВ рдореЗрдВ рдореИрдк рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рд╣рдо рдлрд╝рд┐рд▓рд░ () рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ, рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рд╢реНрд░реЗрдгреАрдмрджреНрдз рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд░рд╣реЗ рд╣реИрдВред рдкрд╣рд▓реЗ рдЖрдкрдХреЛ рд╢реНрд░реЗрдгреА рдореЗрдВ рдПрдХ рдирдпрд╛ рдорд╛рди рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдЗрд╕ рдХреЛрдб рд╕реВрдЪреА рдХреЗ рдЕрдВрдд рдореЗрдВ, рдбреЗрдЯрд╛ рдкреНрд░рдХрд╛рд░ рдХреЛ рдЗрдВрдЯ рдореЗрдВ рдмрджрд▓реЗрдВред рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рднрд╡рд┐рд╖реНрдп рдореЗрдВ, рдбреЗрдЯрд╛ рдлрд╝реНрд░реЗрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдкрд┐рд╡рдЯ рдЯреЗрдмрд▓ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рддреЗ рд╕рдордп, рдирдП рдХреЙрд╣реЛрд░реНрдЯ рдореВрд▓реНрдпреЛрдВ рдХреА рдПрдХ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХреЗ рдЕрдВрдд рдореЗрдВ рдкреНрд░рдХрдЯ рди рд╣реЛрдВред</font></font><br>
<br>
<pre><code class="python hljs">%%time
<span class="hljs-comment">#  . </span>
cut_labels_days = [x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range (<span class="hljs-number">30</span>, <span class="hljs-number">1230</span>, <span class="hljs-number">30</span>)]<font></font>
cut_bins_days = [x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range (<span class="hljs-number">0</span>, <span class="hljs-number">1230</span>, <span class="hljs-number">30</span>)]<font></font>
df_final[<span class="hljs-string">"cohort_days"</span>] = pd.cut(df_final[<span class="hljs-string">"delta_days"</span>], bins = cut_bins_days, labels=cut_labels_days, right = <span class="hljs-literal">True</span>)<font></font>
%%time<font></font>
<span class="hljs-comment">#     .   fillna   !</span>
df_final[<span class="hljs-string">"cohort_days"</span>] = df_final[<span class="hljs-string">"cohort_days"</span>].cat.add_categories([<span class="hljs-number">0</span>])<font></font>
df_final[<span class="hljs-string">"cohort_days"</span>].fillna(<span class="hljs-number">0</span>, inplace = <span class="hljs-literal">True</span>)<font></font>
%%time<font></font>
<span class="hljs-comment">#     .   fillna   !</span>
df_final[<span class="hljs-string">"cohort_days"</span>] = df_final[<span class="hljs-string">"cohort_days"</span>].cat.add_categories([<span class="hljs-number">0</span>])<font></font>
df_final[<span class="hljs-string">"cohort_days"</span>].fillna(<span class="hljs-number">0</span>, inplace = <span class="hljs-literal">True</span>)
<span class="hljs-comment">#    .    ,  "0"        ,     </span>
<span class="hljs-comment">#    .</span>
df_final[<span class="hljs-string">"cohort_days"</span>] = df_final[<span class="hljs-string">"cohort_days"</span>].astype(int)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pivot_table () рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рд╣рдореЗрдВ рд╡рд╛рдВрдЫрд┐рдд рдкрд┐рд╡рдЯ рддрд╛рд▓рд┐рдХрд╛ рдорд┐рд▓рддреА рд╣реИред рд╣рдореЗрдВ рдХрд╛рдлреА рд╕рд╛рд░реЗ рдХреЛрд╣рд░реНрдЯреНрд╕ рдорд┐рд▓рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдкрд░рд┐рдгрд╛рдо рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕реНрдХреНрд░реАрди рдкрд░ рдкреНрд░рджрд░реНрд╢рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рдЬрдм рдХреЛрдИ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдорд╛рдорд▓рд╛ рд╕реБрд▓рдЭрддрд╛ рд╣реИ, рддреЛ рдЖрдк рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЗ рд▓рд┐рдП рдереЛрдбрд╝рд╛ рд╕рдордп рдЕрдВрддрд░рд╛рд▓ рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рд╕рд╣рдпреЛрдЧрд┐рдпреЛрдВ рдХреЗ рдореВрд▓реНрдпреЛрдВ рдХреА рд╕реАрдорд╛ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br>
<br>
<pre><code class="python hljs">%%time
<span class="hljs-comment">#  </span>
df_pivot_table = pd.pivot_table(df_final, values=[<span class="hljs-string">"amount"</span>], index=[<span class="hljs-string">"first_transaction"</span>], columns=[<span class="hljs-string">"cohort_days"</span>], aggfunc=np.sum, fill_value = <span class="hljs-number">0</span>)</code></pre><br>
<img src="https://habrastorage.org/webt/e2/dn/u-/e2dnu-fry4n2hd4fl7_coqm_5mo.png" alt="рдЫрд╡рд┐"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Power BI рдореЗрдВ, рдЗрд╕ рддрд░рд╣ рдХреЗ рд╡рд┐рдЬрд╝реБрдЕрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдореИрдЯреНрд░рд┐рдХреНрд╕ рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sx/qh/gh/sxqhghd3km7lwdo-aycsry8xnn4.png" alt="рдЫрд╡рд┐"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдЧрд▓реЗ рдЪрд░рдг рдХреА рд╕рд╛рдЬрд┐рд╢ рд╣реИред рд╕реНрдерд┐рддрд┐ рдХреА рдмрд╛рд░реАрдХрд┐рдпрд╛рдВ рдпрд╣ рд╣реИ рдХрд┐ рд╣рдореЗрдВ рдПрдХ рд░рд╛рд╢рд┐ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд░рд╛рд╢рд┐ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдкрд╛рд╡рд░ рдмреАрдЖрдИ рдореЗрдВ, рдмрд╕ рдЖрд╡рд╢реНрдпрдХ 'рддреНрд╡рд░рд┐рдд рдХрд╛рд░реНрд░рд╡рд╛рдИ' рдореЗрдиреВ рдЖрдЗрдЯрдо рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ рдФрд░ рдЖрд╡рд╢реНрдпрдХ рдбреАрдПрдПрдХреНрд╕ рд╕реВрддреНрд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЙрддреНрдкрдиреНрди рд╣реЛрдЧрд╛ред рдкрдВрдбреЛрдВ рдХреЗ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЗ рд╕рд╛рде, рд╕реНрдерд┐рддрд┐ рдереЛрдбрд╝реА рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИред рд╣рдо рдореМрдЬреВрджрд╛ рдбреЗрдЯрд╛ рдлреНрд░реЗрдо рдХреЛ рдбрдмрд▓-рдХреНрд░рдорд┐рдХ рд░реВрдк рд╕реЗ рд╕рдореВрд╣рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдХрдореНрд╕рдо () рдлрд╝рдВрдХреНрд╢рди рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВред рдЪреВрдВрдХрд┐ рдкрд░рд┐рдгрд╛рдо рдЕрднреА рднреА рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЧреНрд░рд╛рдлрд╝ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рдлрд╝реНрд░реЗрдо рдХреА рдПрдХ рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдПрдВрдЧреЗред рд╕рдВрдЪрд┐рдд рдмрд┐рдХреНрд░реА рдореВрд▓реНрдп рдХрд╛рдлреА рдмрдбрд╝рд╛ рдерд╛, рдЗрд╕рд▓рд┐рдП рд╣рдо рдорд╛рдиреЛрдВ рдХреЛ 1,000,000 рд╕реЗ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдкрд░рд┐рдгрд╛рдо рдХреЛ рджрд╢рдорд▓рд╡ рдмрд┐рдВрджреБ рдХреЗ рдмрд╛рдж рджреЛ рдЕрдВрдХреЛрдВ рдореЗрдВ рдЧреЛрд▓ рдХрд░рддреЗ рд╣реИрдВред</font></font><br>
<br>
<pre><code class="python hljs">%%time
<span class="hljs-comment">#     amount</span>
df_pivot_table_cumsum = df_final.groupby(by = [<span class="hljs-string">"first_transaction"</span>,<span class="hljs-string">"cohort_days"</span>]).agg({<span class="hljs-string">"amount"</span>: [<span class="hljs-string">"sum"</span>]}).groupby(level=<span class="hljs-number">0</span>).cumsum().reset_index()<font></font>
df_pivot_table_cumsum.columns = [<span class="hljs-string">"first_transaction"</span>,<span class="hljs-string">"cohort_days"</span>,<span class="hljs-string">"cumsum_amount"</span>]<font></font>
%%time<font></font>
<span class="hljs-comment">#     </span><font></font>
df_pivot_table_cumsum_chart = copy.deepcopy(df_pivot_table_cumsum)<font></font>
<span class="hljs-comment">#     ,       Y.</span>
df_pivot_table_cumsum_chart[<span class="hljs-string">"cumsum_amount"</span>]=round(df_pivot_table_cumsum_chart[<span class="hljs-string">"cumsum_amount"</span>]/<span class="hljs-number">1000000</span>, <span class="hljs-number">2</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо рдЧреНрд░рд╛рдлрд╝ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреА рдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред рдЖрд░реЗрдЦ рдХреЛрдб рдХреА рд╕рд┐рд░реНрдл рдПрдХ рдкрдВрдХреНрддрд┐ рдореЗрдВ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдкрд░рд┐рдгрд╛рдо рдкреНрд░рднрд╛рд╡рд╢рд╛рд▓реА рдирд╣реАрдВ рд╣реИред рдпрд╣ рдЧреНрд░рд╛рдл рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдХрд┐рд╕реА рднреА рдмреАрдЖрдИ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдкрд░ рд╡рд┐рдЬрд╝реБрдЕрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЛ рдЦреЛ рджреЗрддрд╛ рд╣реИред рдЖрдк рдкреНрд▓реЙрдЯрд▓реА рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЛ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдРрдб-рдСрди рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╡реАрдбрд┐рдпреЛ рдореЗрдВ рджрд┐рдЦрд╛рдП рдЧрдП рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдпрд╣ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрд▓рдЧ рд╢реНрд░рдо рд▓рд╛рдЧрдд рд╣реИред</font></font><br>
<br>
<pre><code class="python hljs">%%time<font></font>
df_pivot_table_cumsum_chart.pivot(index=<span class="hljs-string">"cohort_days"</span>, columns=<span class="hljs-string">"first_transaction"</span>, values=<span class="hljs-string">"cumsum_amount"</span>).plot(figsize = (<span class="hljs-number">15</span>,<span class="hljs-number">11</span>))</code></pre><br>
<img src="https://habrastorage.org/webt/ya/2f/sj/ya2fsjju2epd-vvcn96gms0i5rm.png" alt="рдЫрд╡рд┐"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдЗрдП рд╣рдо рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдирд┐рд╖реНрдХрд░реНрд╖ рджреЗрддреЗ рд╣реИрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЧрдгрдирд╛ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ, рдкрдВрдбрд╕ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдкрд╛рд╡рд░ рдкрд┐рд╡рдЯ (DAX) рдХреЛ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдмрджрд▓ рд╕рдХрддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рддрд░рд╣ рдХреЗ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди рдХреА рд╡реНрдпрд╡рд╣рд╛рд░реНрдпрддрд╛ рдмрд╛рддрдЪреАрдд рдХреЗ рдмрд╛рд╣рд░ рдмрдиреА рд╣реБрдИ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд╛рдпрдерди рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЗ рдХрд╛рд░реНрдпреЛрдВ рдХреА рддрд░рд╣ DAX, рдПрдХ рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рд╕рдВрдкреВрд░реНрдг рдХреНрд╖реЗрддреНрд░реЛрдВ рдкрд░ рд╕рдВрдЪрд╛рд▓рди рдХрд░рдиреЗ рдХрд╛ рдЕрдЪреНрдЫрд╛ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЧрддрд┐, рд╕рд░рд▓рддрд╛ рдФрд░ рд╡рд┐рдЬрд╝реБрдЕрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдбрд┐рдЬрд╝рд╛рдЗрди рдореЗрдВ рдЖрд╕рд╛рдиреА рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ, рдкрдВрдбреЛрдВ рдХреЗ рд▓рд┐рдП рдкрд╛рд╡рд░ рдмреАрдЖрдИ рдмреЗрд╣рддрд░ рд╣реИред </font><font style="vertical-align: inherit;">рдореЗрд░реА рд░рд╛рдп рдореЗрдВ, рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдЧреНрд░рд╛рдлрд╝ (рд╕рд╛рде рд╣реА рдореЗрдЯрдкреНрд▓реЛрдЯрд▓рд┐рдм, рд╕реАрдмреЛрд░реНрди рд▓рд╛рдЗрдмреНрд░реЗрд░реАрдЬрд╝ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрдирд╛рдП рдЧрдП) рджреЛ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд╣реИрдВ: рдЖрдЙрдЯрд▓реЗрд░, рд╕реНрдерд╛рдиреАрдп рдорд┐рдиреАрдорд╛ / рдореИрдХреНрд╕рд┐рдорд╛ рдХреЗ рд▓рд┐рдП рдХрдИ рдбреЗрдЯрд╛ рдХрд╛ рдПрдХреНрд╕рдкреНрд░реЗрд╕ рд╡рд┐рд╢реНрд▓реЗрд╖рдг, рдпрд╛ рдкреНрд░рд╕реНрддреБрддрд┐ рдХреЗ рд▓рд┐рдП рд╕реНрд▓рд╛рдЗрдб рддреИрдпрд╛рд░ рдХрд░рдирд╛ред </font><font style="vertical-align: inherit;">рдмреАрдЖрдИ рд╕рдорд╛рдзрд╛рдиреЛрдВ рдХреЗ рд▓рд┐рдП рдЧреНрд░рд╛рдлрд┐рдХрд▓ рдХрдВрдЯреНрд░реЛрд▓ рдкреИрдирд▓ рдХрд╛ рд╡рд┐рдХрд╛рд╕ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рдмрдЪрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдмрд╕ рдЗрддрдирд╛ рд╣реАред </font><font style="vertical-align: inherit;">рд╕рднреА рд╕реНрд╡рд╛рд╕реНрдереНрдп, рд╢реБрднрдХрд╛рдордирд╛рдПрдВ рдФрд░ рдкреЗрд╢реЗрд╡рд░ рд╕рдлрд▓рддрд╛!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi501480/index.html">рдбреЗрдиреЛ v1.0: рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдФрд░ рдЯрд╛рдЗрдкрд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рд▓рд┐рдП рд╕реБрд░рдХреНрд╖рд┐рдд рд░рдирдЯрд╛рдЗрдоред рдлрд╝реАрдЪрд░ рдЕрд╡рд▓реЛрдХрди</a></li>
<li><a href="../hi501482/index.html">рд╡рд┐рджреЗрд╢реА рд╕реЗрдВрдЯреЙрд░реНрд╕</a></li>
<li><a href="../hi501484/index.html">рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рдХреЛ рддрдп рдХрд░рдирд╛ рд╣реЛрдЧрд╛</a></li>
<li><a href="../hi501488/index.html">рдордзреНрдп рд╕реЗ рд╡рд░рд┐рд╖реНрда рддрдХ рдХрд╛ рд░рд╛рд╕реНрддрд╛</a></li>
<li><a href="../hi501490/index.html">рдирдпрд╛ рдХреНрдпрд╛ рд╣реИ Python 3.9 рдореЗрдВ рдЕрдкреЗрдХреНрд╖рд┐рдд</a></li>
<li><a href="../hi501494/index.html">рдЖрддреНрдорд╛ рдХреЗ рд▓рд┐рдП рдЧреНрд░рд╛рдо рдирд╣реАрдВ: рдЕрд╕рдлрд▓ рдХреНрд░рд┐рдкреНрдЯреЛрдХрд░реЗрдВрд╕реА рдбреНрдпреВрд░реЛрд╡ рдХреА рдХрд╣рд╛рдиреА</a></li>
<li><a href="../hi501496/index.html">рдзреВрдордХреЗрддреБ рдЭреАрд▓, рдкреБрдирд░рд╛рд╡реГрддрд┐ рдХрд╛ рдкреВрд░рд╛ рд╣реЛрдирд╛</a></li>
<li><a href="../hi501498/index.html">RESTinio рд╕реЗ easy_parser рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рд╛рдзрд┐рдХрд░рдг HTTP рд╢реАрд░реНрд╖ рд▓реЗрдЦ рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП C ++ рдХреЛрдб рдХреЛ рдХрд┐рддрдирд╛ рд▓рд┐рдЦрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП?</a></li>
<li><a href="../hi501500/index.html">рд╡рд┐рдЬреБрдЕрд▓ рд╣реИрдХ: рдХреНрдпрд╛ рдзрдордХреА рдФрд░ рдХреИрд╕реЗ рдЕрдкрдиреЗ рдЖрдк рдХреЛ рдЬрд╛рд╕реВрд╕реА рд╕реЗ рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП</a></li>
<li><a href="../hi501502/index.html">рдирдИ рд▓реИрдм рдбрд┐рдЬрд┐рдЯрд▓ рд╕рдВрд╢реНрд▓реЗрд╖рдг рд╣реИрд░рд┐рд╕ рдмреБрдХ рдЬрд╛рд░реА рд░рдЦрддрд╛ рд╣реИ рдФрд░ FPGA рд╡реАрдбрд┐рдпреЛ рдЧреЗрдо рдмрдирд╛рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>