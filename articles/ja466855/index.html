<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💅🏿 😌 🚕 Unityでタワーディフェンスを作成する：シナリオと敵の波 🍩 🙋🏼 🌽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="[ チュートリアルの第1、第2、第3および第4の部分]
 
 

- 小、中、大サイズの敵のサポート。
- 敵の複数の波でゲームシナリオを作成します。
- アセット構成とゲームプレイ状態の分離。
- ゲームの開始、一時停止、勝利、敗北、スピードアップ。
- 無限に繰り返されるシナリオを作成します。
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Unityでタワーディフェンスを作成する：シナリオと敵の波</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466855/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font><font style="vertical-align: inherit;">チュートリアルの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分]</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小、中、大サイズの敵のサポート。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">敵の複数の波でゲームシナリオを作成します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アセット構成とゲームプレイ状態の分離。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲームの開始、一時停止、勝利、敗北、スピードアップ。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">無限に繰り返されるシナリオを作成します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、シンプルな</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タワーディフェンス</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲームの作成に関する一連のチュートリアルの5番目の部分です</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">その中で、さまざまな敵の波を生成するゲームプレイシナリオの作成方法を学びます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チュートリアルはUnity 2018.4.6f1で作成されました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b12/6aa/945/b126aa94582cc44651853c3ee69be82b.jpg" width="512" height="256"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">かなり快適になっています。</font></font></i><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">より多くの敵</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
毎回同じ青い立方体を作成することはそれほど興味深いことではありません。</font><font style="vertical-align: inherit;">より興味深いゲームプレイシナリオをサポートするための最初のステップは、いくつかのタイプの敵をサポートすることです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">敵の構成</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
敵をユニークにする方法はたくさんありますが、複雑にすることはありません。それらを小、中、大に分類します。</font><font style="vertical-align: inherit;">タグを付けるには、列挙を作成します</font></font><code>EnemyType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> EnemyType {<font></font>
	Small, Medium, Large<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><code>EnemyFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらの3種類の敵すべてをサポート</font><font style="vertical-align: inherit;">
する</font><font style="vertical-align: inherit;">ように</font><font style="vertical-align: inherit;">変更</font><font style="vertical-align: inherit;">してください。</font><font style="vertical-align: inherit;">3つの敵はすべて同じ構成フィールドを必要とするため</font></font><code>EnemyConfig</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、それらすべてを含む</font><font style="vertical-align: inherit;">ネストされたクラス</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">追加して</font><font style="vertical-align: inherit;">から、このタイプの3つの構成フィールドをファクトリーに追加します。</font><font style="vertical-align: inherit;">このクラスは構成にのみ使用され、他の場所では使用されないため、フィールドをパブリックにして、ファクトリがアクセスできるようにすることができます。</font><font style="vertical-align: inherit;">それ自体</font></font><code>EnemyConfig</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は公開する必要はありません。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">EnemyFactory</span> : <span class="hljs-title">GameObjectFactory</span> {<font></font>
<font></font>
	[<span class="hljs-meta">System.Serializable</span>]
	<span class="hljs-keyword">class</span> <span class="hljs-title">EnemyConfig</span> {<font></font>
<font></font>
		<span class="hljs-keyword">public</span> Enemy prefab = <span class="hljs-keyword">default</span>;<font></font>
<font></font>
		[<span class="hljs-meta">FloatRangeSlider(0.5f, 2f)</span>]
		<span class="hljs-keyword">public</span> FloatRange scale = <span class="hljs-keyword">new</span> FloatRange(<span class="hljs-number">1f</span>);<font></font>
<font></font>
		[<span class="hljs-meta">FloatRangeSlider(0.2f, 5f)</span>]
		<span class="hljs-keyword">public</span> FloatRange speed = <span class="hljs-keyword">new</span> FloatRange(<span class="hljs-number">1f</span>);<font></font>
<font></font>
		[<span class="hljs-meta">FloatRangeSlider(-0.4f, 0.4f)</span>]
		<span class="hljs-keyword">public</span> FloatRange pathOffset = <span class="hljs-keyword">new</span> FloatRange(<span class="hljs-number">0f</span>);<font></font>
	}<font></font>
	<font></font>
	[<span class="hljs-meta">SerializeField</span>]<font></font>
	EnemyConfig small = <span class="hljs-keyword">default</span>, medium = <span class="hljs-keyword">default</span>, large = <span class="hljs-keyword">default</span>;<font></font>
	<font></font>
	…<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
大きな敵には小さな敵よりも多くの論理があるため、各敵のヘルスをカスタマイズ可能にしましょう。</font></font><br>
<br>
<pre><code class="cs hljs">		[<span class="hljs-meta">FloatRangeSlider(10f, 1000f)</span>]
		<span class="hljs-keyword">public</span> FloatRange health = <span class="hljs-keyword">new</span> FloatRange(<span class="hljs-number">100f</span>);</code></pre><br><font style="vertical-align: inherit;"></font><code>Get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typeパラメータに</font><font style="vertical-align: inherit;">
追加し</font><font style="vertical-align: inherit;">て、特定のタイプの敵を取得できるようにします。デフォルトのタイプは中型になります。</font><font style="vertical-align: inherit;">タイプを使用して適切な構成を取得します。別の方法が役立ちます。その後、以前のように、ヘルス引数を追加するだけで、敵を作成して初期化します。</font></font><br>
<br>
<pre><code class="cs hljs">	<span class="hljs-function">EnemyConfig <span class="hljs-title">GetConfig</span> (<span class="hljs-params">EnemyType type</span>)</span> {
		<span class="hljs-keyword">switch</span> (type) {
			<span class="hljs-keyword">case</span> EnemyType.Small: <span class="hljs-keyword">return</span> small;
			<span class="hljs-keyword">case</span> EnemyType.Medium: <span class="hljs-keyword">return</span> medium;
			<span class="hljs-keyword">case</span> EnemyType.Large: <span class="hljs-keyword">return</span> large;<font></font>
		}<font></font>
		Debug.Assert(<span class="hljs-literal">false</span>, <span class="hljs-string">"Unsupported enemy type!"</span>);
		<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-function"><span class="hljs-keyword">public</span> Enemy <span class="hljs-title">Get</span> (<span class="hljs-params">EnemyType type = EnemyType.Medium</span>)</span> {<font></font>
		EnemyConfig config = GetConfig(type);<font></font>
		Enemy instance = CreateGameObjectInstance(config.prefab);<font></font>
		instance.OriginFactory = <span class="hljs-keyword">this</span>;<font></font>
		instance.Initialize(<font></font>
			config.scale.RandomValueInRange,<font></font>
			config.speed.RandomValueInRange,<font></font>
			config.pathOffset.RandomValueInRange,<font></font>
			config.health.RandomValueInRange<font></font>
		);<font></font>
		<span class="hljs-keyword">return</span> instance;<font></font>
	}</code></pre><br><font style="vertical-align: inherit;"></font><code>Enemy.Initialize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必須パラメーター</font><font style="vertical-align: inherit;">
に</font><font style="vertical-align: inherit;">ヘルス</font><font style="vertical-align: inherit;">を追加し、</font><font style="vertical-align: inherit;">それを使用して、敵のサイズで判断する代わりにヘルスを設定します。</font></font><br>
<br>
<pre><code class="cs hljs">	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Initialize</span> (<span class="hljs-params">
		<span class="hljs-keyword">float</span> scale, <span class="hljs-keyword">float</span> speed, <span class="hljs-keyword">float</span> pathOffset, <span class="hljs-keyword">float</span> health
	</span>)</span> {<font></font>
		…<font></font>
		Health = health;<font></font>
	}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さまざまな敵のデザインを作成します</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3人の敵のデザインを選択できますが、チュートリアルでは、最大限の単純化に努めます。</font><font style="vertical-align: inherit;">敵の元のプレハブを複製し、3つのサイズすべてに使用して、材料のみを変更しました。黄色は小、青は中、赤は大です。</font><font style="vertical-align: inherit;">プレハブキューブのスケールは変更しませんでしたが、工場のスケール構成を使用して寸法を設定しました。</font><font style="vertical-align: inherit;">また、サイズによっては、体力を上げて速度を落としました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bd7/070/231/bd707023151022e921c5b6956bb20c02.png" width="320" height="348"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3つのサイズの敵の立方体の工場。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最速の方法は、3つのタイプすべてがゲームに表示されることを確認し</font></font><code>Game.SpawnEnemy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、平均ではなくランダムなタイプの敵を取得</font><font style="vertical-align: inherit;">する</font><font style="vertical-align: inherit;">よう</font><font style="vertical-align: inherit;">に変更</font><font style="vertical-align: inherit;">することです。</font></font><br>
<br>
<pre><code class="cs hljs">	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SpawnEnemy</span> (<span class="hljs-params"></span>)</span> {<font></font>
		GameTile spawnPoint =<font></font>
			board.GetSpawnPoint(Random.Range(<span class="hljs-number">0</span>, board.SpawnPointCount));<font></font>
		Enemy enemy = enemyFactory.Get((EnemyType)(Random.Range(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>)));<font></font>
		enemy.SpawnOn(spawnPoint);<font></font>
		enemies.Add(enemy);<font></font>
	}</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/537/73b/b92/53773bb9299a8ec9c56b485718049e5b.png" width="230" height="230"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さまざまなタイプの敵。</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いくつかの工場</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今、敵の工場は3人の敵をたくさん設定します。</font><font style="vertical-align: inherit;">既存のファクトリーは3つのサイズの立方体を作成しますが、他に何かを作成する別のファクトリー、たとえば3つのサイズの球体を作成することを妨げるものはありません。</font><font style="vertical-align: inherit;">ゲーム内に別のファクトリを指定して、別のトピックに切り替えることで、作成された敵を変更できます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/65f/7e5/330/65f7e5330945ea654f1caef579fe567f.png" width="230" height="230"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">球状の敵。</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">敵の波</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ゲームプレイシナリオ作成の2番目のステップは、一定の頻度で敵をスポーンすることを拒否することです。</font><font style="vertical-align: inherit;">敵は、スクリプトが終了するか、プレイヤーが負けるまで、連続する波で作成する必要があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作成シーケンス</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
敵の1つの波は、波が完了するまで次々に作成される敵のグループで構成されます。 Waveにはさまざまな種類の敵を含めることができ、それらの作成間の遅延はさまざまです。実装を複雑にしないために、一定の頻度で同じタイプの敵を作成する単純なスポーンシーケンスから始めます。次に、波はそのようなシーケンスの単なるリストになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各シーケンスを構成するには、クラスを作成します</font></font><code>EnemySpawnSequence</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">かなり複雑なので、別のファイルに入れてください。</font><font style="vertical-align: inherit;">シーケンスは、使用するファクトリ、作成する敵のタイプ、それらの数と頻度を知っている必要があります。</font><font style="vertical-align: inherit;">設定を簡略化するために、次の敵を作成するまでの時間を決定する一時停止を最後のパラメーターにします。</font><font style="vertical-align: inherit;">このアプローチでは、Waveで複数の敵工場を使用できることに注意してください。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> UnityEngine;<font></font>
<font></font>
[<span class="hljs-meta">System.Serializable</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">EnemySpawnSequence</span> {<font></font>
<font></font>
	[<span class="hljs-meta">SerializeField</span>]<font></font>
	EnemyFactory factory = <span class="hljs-keyword">default</span>;<font></font>
<font></font>
	[<span class="hljs-meta">SerializeField</span>]<font></font>
	EnemyType type = EnemyType.Medium;<font></font>
<font></font>
	[<span class="hljs-meta">SerializeField, Range(1, 100)</span>]
	<span class="hljs-keyword">int</span> amount = <span class="hljs-number">1</span>;<font></font>
<font></font>
	[<span class="hljs-meta">SerializeField, Range(0.1f, 10f)</span>]
	<span class="hljs-keyword">float</span> cooldown = <span class="hljs-number">1f</span>;<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">波</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ウェーブは、敵の作成シーケンスの単純な配列です。</font></font><code>EnemyWave</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1つの標準シーケンスで始まる</font><font style="vertical-align: inherit;">アセットタイプを作成してみましょう</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> UnityEngine;<font></font>
<font></font>
[<span class="hljs-meta">CreateAssetMenu</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">EnemyWave</span> : <span class="hljs-title">ScriptableObject</span> {<font></font>
<font></font>
	[<span class="hljs-meta">SerializeField</span>]<font></font>
	EnemySpawnSequence[] spawnSequences = {<font></font>
		<span class="hljs-keyword">new</span> EnemySpawnSequence()<font></font>
	};<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで敵の波を作成できます。</font><font style="vertical-align: inherit;">たとえば、立方体の敵のグループを生成する波を作成しました。最初は10個の小さなものから始まり、周波数は1秒あたり2個です。</font><font style="vertical-align: inherit;">その後、1秒に1回作成される5つの平均が続き、最後に、5秒間休止して1つの大きな敵がいます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b16/af3/47f/b16af347f057760db35703515642db89.png" width="320" height="376"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">増加するキューブの波。</font></font></i><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シーケンス間に遅延を追加できますか？</font></font></b><div class="spoiler_text">   . ,        ,             ,     .<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/59b/ff4/3f9/59bff43f9a71002c0bd562f270b755ea.png" width="320" height="272"></div><br>
<i>      .</i></div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シナリオ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ゲームプレイシナリオは、一連の波から作成されます。</font><font style="vertical-align: inherit;">この</font></font><code>GameScenario</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のWaveの1つの配列で</font><font style="vertical-align: inherit;">アセットタイプ</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">作成し、</font><font style="vertical-align: inherit;">それを使用してシナリオを</font><font style="vertical-align: inherit;">作成しましょう</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> UnityEngine;<font></font>
<font></font>
[<span class="hljs-meta">CreateAssetMenu</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GameScenario</span> : <span class="hljs-title">ScriptableObject</span> {<font></font>
<font></font>
	[<span class="hljs-meta">SerializeField</span>]<font></font>
	EnemyWave[] waves = {};<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、小中大の敵（MSC）の2つの波でシナリオを作成しました。最初は立方体、次に球体です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/796/df0/73b/796df073b24d092d35093b6e56b8be79.png" width="320" height="142"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MSCの2つの波のシナリオ。</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シーケンスの動き</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アセットタイプはスクリプトの作成に使用されますが、これらはアセットであるため、ゲーム中に変化しないデータを含める必要があります。</font><font style="vertical-align: inherit;">ただし、シナリオを進めるには、どういうわけかそれらのステータスを追跡する必要があります。</font><font style="vertical-align: inherit;">1つの方法は、ゲームで使用されるアセットを複製して、複製がその状態を追跡するようにすることです。</font><font style="vertical-align: inherit;">ただし、アセット全体を複製する必要はありません。状態とアセットへのリンクだけで十分です。</font><font style="vertical-align: inherit;">では</font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、最初にの</font><font style="vertical-align: inherit;">別のクラスを作成しましょう</font></font><code>EnemySpawnSequence</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">シーケンスにのみ適用されるため、ネスト化します。</font><font style="vertical-align: inherit;">これは、シーケンスへの参照がある場合にのみ有効であるため、シーケンスパラメータを持つコンストラクタメソッドを指定します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/18c/752/4fd/18c7524fdac87c062a6c683bbdee1866.png" width="315" height="50"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シーケンスを参照するネストされたタイプの状態。</font></font></i><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">EnemySpawnSequence</span> {<font></font>
<font></font>
	…<font></font>
<font></font>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">State</span> {<font></font>
<font></font>
		EnemySpawnSequence sequence;<font></font>
<font></font>
		<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">State</span> (<span class="hljs-params">EnemySpawnSequence sequence</span>)</span> {
			<span class="hljs-keyword">this</span>.sequence = sequence;<font></font>
		}<font></font>
	}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
順々に前進を開始したい場合、これのために状態の新しいインスタンスが必要です。</font></font><code>Begin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態を作成して返す</font><font style="vertical-align: inherit;">メソッドにシーケンスを追加</font><font style="vertical-align: inherit;">します。</font><font style="vertical-align: inherit;">これにより、原因</font></font><code>Begin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">となる</font><font style="vertical-align: inherit;">すべての人が</font><font style="vertical-align: inherit;">州の遵守に責任を負うことになり、シーケンス自体は無国籍のままです。</font><font style="vertical-align: inherit;">同じシーケンスに沿って数回並行して進むことも可能です。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">EnemySpawnSequence</span> {<font></font>
<font></font>
	…<font></font>
	<font></font>
	<span class="hljs-function"><span class="hljs-keyword">public</span> State <span class="hljs-title">Begin</span> (<span class="hljs-params"></span>)</span> =&gt; <span class="hljs-keyword">new</span> State(<span class="hljs-keyword">this</span>);<font></font>
<font></font>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">State</span> { … }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ホットリブート後も状態を維持するには、状態をシリアル化可能にする必要があります。</font></font><br>
<br>
<pre><code class="cs hljs">	[<span class="hljs-meta">System.Serializable</span>]
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">State</span> { … }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプローチの欠点は、シーケンスを実行するたびに、新しい状態オブジェクトを作成する必要があることです。クラスではなく構造にすることで、メモリ割り当てを回避できます。状態が小さい限り、これは正常です。状態は値の型であることを覚えておいてください。転送するとコピーされるので、一箇所で追跡してください。</font></font><br>
<br>
<pre><code class="cs hljs">	[<span class="hljs-meta">System.Serializable</span>]
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> State { … }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シーケンスの状態は、生成された敵の数と一時停止時間の進行の2つの側面のみで構成されています。</font></font><code>Progress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">時間あたりの一時停止デルタの値を増やし、構成された値に達したときにそれをリセット</font><font style="vertical-align: inherit;">するメソッドを追加</font><font style="vertical-align: inherit;">します。これは、のスポーンタイムで発生する方法と同様</font></font><code>Game.Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">これが発生するたびに、敵の数を増やします。</font><font style="vertical-align: inherit;">さらに、シーケンスが最初に一時停止なしで敵を作成できるように、一時停止値は最大値で開始する必要があります。</font></font><br>
<br>
<pre><code class="cs hljs">		<span class="hljs-keyword">int</span> count;<font></font>
<font></font>
		<span class="hljs-keyword">float</span> cooldown;<font></font>
<font></font>
		<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">State</span> (<span class="hljs-params">EnemySpawnSequence sequence</span>)</span> {
			<span class="hljs-keyword">this</span>.sequence = sequence;<font></font>
			count = <span class="hljs-number">0</span>;<font></font>
			cooldown = sequence.cooldown;<font></font>
		}<font></font>
		<font></font>
		<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Progress</span> (<span class="hljs-params"></span>)</span> {<font></font>
			cooldown += Time.deltaTime;<font></font>
			<span class="hljs-keyword">while</span> (cooldown &gt;= sequence.cooldown) {<font></font>
				cooldown -= sequence.cooldown;<font></font>
				count += <span class="hljs-number">1</span>;<font></font>
			}<font></font>
		}</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/50c/aba/5e5/50caba5e50d89e05a6cb9a631feb1c6d.png" width="315" height="74"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態には必要なデータのみが含まれています。</font></font></i><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StateからEnemySpawnSequence.cooldownにアクセスできますか？</font></font></b><div class="spoiler_text">,   <code>State</code>      .          .</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必要な数の敵が作成され、一時停止が終了するまで、進行を続ける必要があります。</font><font style="vertical-align: inherit;">この時点で、</font></font><code>Progress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完了を報告する必要がありますが、ほとんどの場合、値を少し超えます。</font><font style="vertical-align: inherit;">したがって、この時点で、次のシーケンスで事前に使用するために、余分な時間を返す必要があります。</font><font style="vertical-align: inherit;">これを機能させるには、時間デルタをパラメーターに変換する必要があります。</font><font style="vertical-align: inherit;">また、まだ終了していないことを示す必要があります。これは、負の値を返すことで実現できます。</font></font><br>
<br>
<pre><code class="cs hljs">		<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> <span class="hljs-title">Progress</span> (<span class="hljs-params"><span class="hljs-keyword">float</span> deltaTime</span>)</span> {<font></font>
			cooldown += deltaTime;<font></font>
			<span class="hljs-keyword">while</span> (cooldown &gt;= sequence.cooldown) {<font></font>
				cooldown -= sequence.cooldown;<font></font>
				<span class="hljs-keyword">if</span> (count &gt;= sequence.amount) {
					<span class="hljs-keyword">return</span> cooldown;<font></font>
				}<font></font>
				count += <span class="hljs-number">1</span>;<font></font>
			}<font></font>
			<span class="hljs-keyword">return</span> <span class="hljs-number">-1f</span>;<font></font>
		}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どこにでも敵を作成する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シーケンスが敵を生成するためには</font></font><code>Game.SpawnEnemy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、別のパブリック静的メソッド</font><font style="vertical-align: inherit;">に変換</font><font style="vertical-align: inherit;">する</font><font style="vertical-align: inherit;">必要があり</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="cs hljs">	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SpawnEnemy</span> (<span class="hljs-params">EnemyFactory factory, EnemyType type</span>)</span> {<font></font>
		GameTile spawnPoint = instance.board.GetSpawnPoint(<font></font>
			Random.Range(<span class="hljs-number">0</span>, instance.board.SpawnPointCount)<font></font>
		);<font></font>
		Enemy enemy = factory.Get(type);<font></font>
		enemy.SpawnOn(spawnPoint);<font></font>
		instance.enemies.Add(enemy);<font></font>
	}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼自身</font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は敵を生成しなくなるため、</font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工場</font><font style="vertical-align: inherit;">から</font><font style="vertical-align: inherit;">敵</font><font style="vertical-align: inherit;">を削除し</font><font style="vertical-align: inherit;">、作成の速度、作成を促進するプロセス、および敵を作成するためのコードを</font><font style="vertical-align: inherit;">削除でき</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="cs hljs">	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span> (<span class="hljs-params"></span>)</span> {<font></font>
			}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我々は呼ぶ</font></font><code>Game.SpawnEnemy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font></font><code>EnemySpawnSequence.State.Progress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">敵のスコアを増加させた後。</font></font><br>
<br>
<pre><code class="cs hljs">		<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> <span class="hljs-title">Progress</span> (<span class="hljs-params"><span class="hljs-keyword">float</span> deltaTime</span>)</span> {<font></font>
			cooldown += deltaTime;<font></font>
			<span class="hljs-keyword">while</span> (cooldown &gt;= sequence.cooldown) {<font></font>
				…<font></font>
				count += <span class="hljs-number">1</span>;<font></font>
				Game.SpawnEnemy(sequence.factory, sequence.type);<font></font>
			}<font></font>
			<span class="hljs-keyword">return</span> <span class="hljs-number">-1f</span>;<font></font>
		}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">波の前進</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
波全体に沿って推進するときと同じように、シーケンスに沿って進行するアプローチを考えてみましょう。</font><font style="vertical-align: inherit;">ネストされた構造の新しいインスタンスを返す、</font></font><code>EnemyWave</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">彼自身のメソッドを</font><font style="vertical-align: inherit;">与えましょう</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この場合、状態には波のインデックスとアクティブシーケンスの状態が含まれ、最初のシーケンスの開始時に初期化されます。</font></font><code>Begin</code><font style="vertical-align: inherit;"></font><code>State</code><font style="vertical-align: inherit;"></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9eb/9f8/bc7/9eb9f8bc7769dd0c65624802ac2a97b8.png" width="315" height="128"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シーケンスの状態を含む波の状態。</font></font></i><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">EnemyWave</span> : <span class="hljs-title">ScriptableObject</span> {<font></font>
<font></font>
	[<span class="hljs-meta">SerializeField</span>]<font></font>
	EnemySpawnSequence[] spawnSequences = {<font></font>
		<span class="hljs-keyword">new</span> EnemySpawnSequence()<font></font>
	};<font></font>
<font></font>
	<span class="hljs-function"><span class="hljs-keyword">public</span> State <span class="hljs-title">Begin</span>(<span class="hljs-params"></span>)</span> =&gt; <span class="hljs-keyword">new</span> State(<span class="hljs-keyword">this</span>);<font></font>
<font></font>
	[<span class="hljs-meta">System.Serializable</span>]
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> State {<font></font>
<font></font>
		EnemyWave wave;<font></font>
<font></font>
		<span class="hljs-keyword">int</span> index;<font></font>
<font></font>
		EnemySpawnSequence.State sequence;<font></font>
<font></font>
		<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">State</span> (<span class="hljs-params">EnemyWave wave</span>)</span> {
			<span class="hljs-keyword">this</span>.wave = wave;<font></font>
			index = <span class="hljs-number">0</span>;<font></font>
			Debug.Assert(wave.spawnSequences.Length &gt; <span class="hljs-number">0</span>, <span class="hljs-string">"Empty wave!"</span>);<font></font>
			sequence = wave.spawnSequences[<span class="hljs-number">0</span>].Begin();<font></font>
		}<font></font>
	}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">わずかな変更を加えて、以前と同じアプローチを使用</font><font style="vertical-align: inherit;">
する</font></font><code>EnemyWave.State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font></font><code>Progress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">追加し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">まず、アクティブシーケンスに沿って移動し、時間デルタをこの呼び出しの結果で置き換えます。</font><font style="vertical-align: inherit;">残り時間が残っている間、次のシーケンスにアクセスし、アクセスされた場合は、そのシーケンスを進行します。</font><font style="vertical-align: inherit;">シーケンスが残っていない場合は、残りの時間を返します。</font><font style="vertical-align: inherit;">それ以外の場合は、負の値を返します。</font></font><br>
<br>
<pre><code class="cs hljs">		<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> <span class="hljs-title">Progress</span> (<span class="hljs-params"><span class="hljs-keyword">float</span> deltaTime</span>)</span> {<font></font>
			deltaTime = sequence.Progress(deltaTime);<font></font>
			<span class="hljs-keyword">while</span> (deltaTime &gt;= <span class="hljs-number">0f</span>) {
				<span class="hljs-keyword">if</span> (++index &gt;= wave.spawnSequences.Length) {
					<span class="hljs-keyword">return</span> deltaTime;<font></font>
				}<font></font>
				sequence = wave.spawnSequences[index].Begin();<font></font>
				deltaTime = sequence.Progress(deltaTime);<font></font>
			}<font></font>
			<span class="hljs-keyword">return</span> <span class="hljs-number">-1f</span>;<font></font>
		}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトの昇格</font></font></h3><br><font style="vertical-align: inherit;"></font><code>GameScenario</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同じ処理</font><font style="vertical-align: inherit;">
を追加</font><font style="vertical-align: inherit;">します。</font><font style="vertical-align: inherit;">この場合、状態には波のインデックスとアクティブな波の状態が含まれます。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GameScenario</span> : <span class="hljs-title">ScriptableObject</span> {<font></font>
<font></font>
	[<span class="hljs-meta">SerializeField</span>]<font></font>
	EnemyWave[] waves = {};<font></font>
<font></font>
	<span class="hljs-function"><span class="hljs-keyword">public</span> State <span class="hljs-title">Begin</span> (<span class="hljs-params"></span>)</span> =&gt; <span class="hljs-keyword">new</span> State(<span class="hljs-keyword">this</span>);<font></font>
<font></font>
	[<span class="hljs-meta">System.Serializable</span>]
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> State {<font></font>
<font></font>
		GameScenario scenario;<font></font>
<font></font>
		<span class="hljs-keyword">int</span> index;<font></font>
<font></font>
		EnemyWave.State wave;<font></font>
<font></font>
		<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">State</span> (<span class="hljs-params">GameScenario scenario</span>)</span> {
			<span class="hljs-keyword">this</span>.scenario = scenario;<font></font>
			index = <span class="hljs-number">0</span>;<font></font>
			Debug.Assert(scenario.waves.Length &gt; <span class="hljs-number">0</span>, <span class="hljs-string">"Empty scenario!"</span>);<font></font>
			wave = scenario.waves[<span class="hljs-number">0</span>].Begin();<font></font>
		}<font></font>
	}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トップレベルにいるため、このメソッド</font></font><code>Progress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はパラメーターを必要とせず、直接使用できます</font></font><code>Time.deltaTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">残り時間を返す必要はありませんが、スクリプトが完了したかどうかを示す必要があります。</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最後のウェーブの完了後</font><font style="vertical-align: inherit;">に戻り</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、スクリプトがまだアクティブであることを示します。</font></font><br>
<br>
<pre><code class="cs hljs">		<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Progress</span> (<span class="hljs-params"></span>)</span> {
			<span class="hljs-keyword">float</span> deltaTime = wave.Progress(Time.deltaTime);
			<span class="hljs-keyword">while</span> (deltaTime &gt;= <span class="hljs-number">0f</span>) {
				<span class="hljs-keyword">if</span> (++index &gt;= scenario.waves.Length) {
					<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
				}<font></font>
				wave = scenario.waves[index].Begin();<font></font>
				deltaTime = wave.Progress(deltaTime);<font></font>
			}<font></font>
			<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
		}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトの実行</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スクリプトを再生するに</font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、スクリプト構成フィールドとそのステータスの追跡が必要です。</font><font style="vertical-align: inherit;">Awakeでスクリプトを実行し</font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ゲームの残りの状態が更新されるまで</font><font style="vertical-align: inherit;">スクリプトを進め</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="cs hljs">	[<span class="hljs-meta">SerializeField</span>]<font></font>
	GameScenario scenario = <span class="hljs-keyword">default</span>;<font></font>
<font></font>
	GameScenario.State activeScenario;<font></font>
	<font></font>
	…<font></font>
	<font></font>
	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Awake</span> (<span class="hljs-params"></span>)</span> {<font></font>
		board.Initialize(boardSize, tileContentFactory);<font></font>
		board.ShowGrid = <span class="hljs-literal">true</span>;<font></font>
		activeScenario = scenario.Begin();<font></font>
	}<font></font>
	<font></font>
	…<font></font>
	<font></font>
	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span> (<span class="hljs-params"></span>)</span> {<font></font>
		…<font></font>
<font></font>
		activeScenario.Progress();<font></font>
<font></font>
		enemies.GameUpdate();<font></font>
		Physics.SyncTransforms();<font></font>
		board.GameUpdate();<font></font>
		nonEnemies.GameUpdate();<font></font>
	}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、設定されたスクリプトがゲームの開始時に起動されます。</font><font style="vertical-align: inherit;">プロモーションは完了するまで行われ、その後は何も起こりません。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/mk/x0/uf/mkx0ufxshpgvy29wjr_nxdmneu4.gif"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2つの波が10回加速しました。</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲームの開始と終了</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1つのシナリオを再現できますが、完了後は新しい敵は現れません。</font><font style="vertical-align: inherit;">ゲームを続行するには、手動で、またはプレーヤーが負けた/勝ったために、新しいシナリオを開始できるようにする必要があります。</font><font style="vertical-align: inherit;">複数のシナリオから選択して実装することもできますが、このチュートリアルではそれを考慮しません。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいゲームの始まり</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
理想的には、いつでも新しいゲームを開始する機会が必要です。</font><font style="vertical-align: inherit;">これを行うには、ゲーム全体の現在の状態をリセットする必要があります。つまり、多くのオブジェクトをリセットする必要があります。</font><font style="vertical-align: inherit;">まず、</font><font style="vertical-align: inherit;">すべての動作を利用</font><font style="vertical-align: inherit;">する</font></font><code>GameBehaviorCollection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">に追加し</font></font><code>Clear</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="cs hljs">	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Clear</span> (<span class="hljs-params"></span>)</span> {
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; behaviors.Count; i++) {<font></font>
			behaviors[i].Recycle();<font></font>
		}<font></font>
		behaviors.Clear();<font></font>
	}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、すべての動作を破棄できることを示唆していますが、これまでのところそうではありません。</font><font style="vertical-align: inherit;">これを機能させるには、</font></font><code>GameBehavior</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">抽象メソッドに</font><font style="vertical-align: inherit;">を追加し</font></font><code>Recycle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="cs hljs">	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Recycle</span> (<span class="hljs-params"></span>)</span>;</code></pre><br><font style="vertical-align: inherit;"></font><code>Recycle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス</font><font style="vertical-align: inherit;">
メソッド</font></font><code>WarEntity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は明示的にオーバーライドする必要があります。</font></font><br>
<br>
<pre><code class="cs hljs">	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Recycle</span> (<span class="hljs-params"></span>)</span> {<font></font>
		originFactory.Reclaim(<span class="hljs-keyword">this</span>);<font></font>
	}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そこ</font></font><code>Enemy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一切方法はまだありません</font></font><code>Recycle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ので、それを追加します。</font><font style="vertical-align: inherit;">彼がしなければならないのは、工場にそれを返却させることだけです。</font><font style="vertical-align: inherit;">次に</font></font><code>Recycle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、直接工場にアクセスする場所に</font><font style="vertical-align: inherit;">電話</font><font style="vertical-align: inherit;">します。</font></font><br>
<br>
<pre><code class="cs hljs">	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">GameUpdate</span> (<span class="hljs-params"></span>)</span> {
		<span class="hljs-keyword">if</span> (Health &lt;= <span class="hljs-number">0f</span>) {<font></font>
			Recycle();<font></font>
			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
		}<font></font>
<font></font>
		progress += Time.deltaTime * progressFactor;<font></font>
		<span class="hljs-keyword">while</span> (progress &gt;= <span class="hljs-number">1f</span>) {
			<span class="hljs-keyword">if</span> (tileTo == <span class="hljs-literal">null</span>) {<font></font>
				Recycle();<font></font>
				<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
			}<font></font>
			…<font></font>
		}<font></font>
		…<font></font>
	}<font></font>
<font></font>
	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Recycle</span> (<span class="hljs-params"></span>)</span> {<font></font>
		OriginFactory.Reclaim(<span class="hljs-keyword">this</span>);<font></font>
	}</code></pre><br>
<code>GameBoard</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">また、それをリセットする必要があるので、</font></font><code>Clear</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのタイルを空にし、すべての作成ポイントをリセットしてコンテンツを更新し、次に標準の開始点と終了点を設定</font><font style="vertical-align: inherit;">するメソッド</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">与えましょう</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次に、コードを繰り返す代わりに</font></font><code>Clear</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、最後にを</font><font style="vertical-align: inherit;">呼び出すことができます</font></font><code>Initialize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs">	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Initialize</span> (<span class="hljs-params">
		Vector2Int size, GameTileContentFactory contentFactory
	</span>)</span> {<font></font>
		…<font></font>
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>, y = <span class="hljs-number">0</span>; y &lt; size.y; y++) {
			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>; x &lt; size.x; x++, i++) {<font></font>
				…<font></font>
<font></font>
			}<font></font>
		}<font></font>
<font></font>
		Clear();<font></font>
	}<font></font>
	<font></font>
	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Clear</span> (<span class="hljs-params"></span>)</span> {
		<span class="hljs-keyword">foreach</span> (GameTile tile <span class="hljs-keyword">in</span> tiles) {<font></font>
			tile.Content = contentFactory.Get(GameTileContentType.Empty);<font></font>
		}<font></font>
		spawnPoints.Clear();<font></font>
		updatingContent.Clear();<font></font>
		ToggleDestination(tiles[tiles.Length / <span class="hljs-number">2</span>]);<font></font>
		ToggleSpawnPoint(tiles[<span class="hljs-number">0</span>]);<font></font>
	}</code></pre><br><font style="vertical-align: inherit;"></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font></font><code>BeginNewGame</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にを</font><font style="vertical-align: inherit;">
追加し、</font><font style="vertical-align: inherit;">敵、他のオブジェクト、フィールドをドロップしてから、新しいスクリプトを開始します。</font></font><br>
<br>
<pre><code class="cs hljs">	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">BeginNewGame</span> (<span class="hljs-params"></span>)</span> {<font></font>
		enemies.Clear();<font></font>
		nonEnemies.Clear();<font></font>
		board.Clear();<font></font>
		activeScenario = scenario.Begin();<font></font>
	}</code></pre><br><font style="vertical-align: inherit;"></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトに沿って移動する前にBキーを押した場合、</font><font style="vertical-align: inherit;">
このメソッドを呼び出し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="cs hljs">	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span> (<span class="hljs-params"></span>)</span> {<font></font>
		…<font></font>
<font></font>
		<span class="hljs-keyword">if</span> (Input.GetKeyDown(KeyCode.B)) {<font></font>
			BeginNewGame();<font></font>
		}<font></font>
<font></font>
		activeScenario.Progress();<font></font>
<font></font>
		…<font></font>
	}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">負け</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ゲームの目標は、一定数の敵が最終ポイントに到達する前にすべての敵を倒すことです。</font><font style="vertical-align: inherit;">敗北状態を引き起こすために必要な敵の数は</font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、構成フィールドに</font><font style="vertical-align: inherit;">追加するプレイヤーの初期の健康状態によって異なり</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">敵を数えるので、浮動小数点数ではなく整数を使用します。</font></font><br>
 <br>
<pre><code class="cs hljs">	[<span class="hljs-meta">SerializeField, Range(0, 100)</span>]
	<span class="hljs-keyword">int</span> startingPlayerHealth = <span class="hljs-number">10</span>;</code></pre><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4f3/9c5/11a/4f39c511ab9d362b1cc7e55610a317aa.png" width="320" height="38"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当初、プレイヤーのヘルスは10です。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アウェイクまたは新しいゲームの開始の場合、プレーヤーの現在のヘルスに初期値を割り当てます。</font></font><br>
<br>
<pre><code class="cs hljs">	<span class="hljs-keyword">int</span> playerHealth;<font></font>
<font></font>
	…<font></font>
	<font></font>
	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Awake</span> (<span class="hljs-params"></span>)</span> {<font></font>
		playerHealth = startingPlayerHealth;<font></font>
		…<font></font>
	}<font></font>
	<font></font>
	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">BeginNewGame</span> (<span class="hljs-params"></span>)</span> {<font></font>
		playerHealth = startingPlayerHealth;<font></font>
		…<font></font>
	}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パブリックの静的メソッドを追加して、</font></font><code>EnemyReachedDestination</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">敵が</font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エンドポイントに到達した</font><font style="vertical-align: inherit;">ことを報告できるようにし</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">これが発生した場合、プレーヤーの健康状態を下げます。</font></font><br>
<br>
<pre><code class="cs hljs">	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">EnemyReachedDestination</span> (<span class="hljs-params"></span>)</span> {<font></font>
		instance.playerHealth -= <span class="hljs-number">1</span>;<font></font>
	}</code></pre><br><font style="vertical-align: inherit;"></font><code>Enemy.GameUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">適切なときに</font><font style="vertical-align: inherit;">
このメソッドを呼び出し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="cs hljs">			<span class="hljs-keyword">if</span> (tileTo == <span class="hljs-literal">null</span>) {<font></font>
				Game.EnemyReachedDestination();<font></font>
				Recycle();<font></font>
				<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
			}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、</font></font><code>Game.Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">敗北</font><font style="vertical-align: inherit;">の</font><font style="vertical-align: inherit;">状態を</font><font style="vertical-align: inherit;">確認でき</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">プレーヤーのヘルスがゼロ以下の場合、敗北状態が発生します。</font><font style="vertical-align: inherit;">この情報をログに出力し、スクリプトに沿って移動する前に、すぐに新しいゲームを開始します。</font><font style="vertical-align: inherit;">ただし、これは、初期の健康状態が良好な場合にのみ行います。</font><font style="vertical-align: inherit;">これにより、初期ヘルスとして0を使用できるようになり、失うことが不可能になります。</font><font style="vertical-align: inherit;">そのため、スクリプトをテストすると便利です。</font></font><br>
<br>
<pre><code class="cs hljs">		<span class="hljs-keyword">if</span> (playerHealth &lt;= <span class="hljs-number">0</span> &amp;&amp; startingPlayerHealth &gt; <span class="hljs-number">0</span>) {<font></font>
			Debug.Log(<span class="hljs-string">"Defeat!"</span>);<font></font>
			BeginNewGame();<font></font>
		}<font></font>
<font></font>
		activeScenario.Progress();</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">勝利</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
敗北の代替手段は勝利です。これは、プレイヤーがまだ生きている場合、シナリオの最後に達成されます。</font><font style="vertical-align: inherit;">つまり、結果</font></font><code>GameScenario.Progess</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が等しい場合</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ログに勝利のメッセージを表示し、新しいゲームを開始して、すぐにそれを続行します。</font></font><br>
<br>
<pre><code class="cs hljs">		<span class="hljs-keyword">if</span> (playerHealth &lt;= <span class="hljs-number">0</span>) {<font></font>
			Debug.Log(<span class="hljs-string">"Defeat!"</span>);<font></font>
			BeginNewGame();<font></font>
		}<font></font>
<font></font>
		<span class="hljs-keyword">if</span> (!activeScenario.Progress()) {<font></font>
			Debug.Log(<span class="hljs-string">"Victory!"</span>);<font></font>
			BeginNewGame();<font></font>
			activeScenario.Progress();<font></font>
		}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、フィールドにまだ敵がいる場合でも、最後の一時停止の終了後に勝利します。</font><font style="vertical-align: inherit;">すべての敵が消えるまで勝利を延期する必要があります。これは、敵のコレクションが空かどうかを確認することで実現できます。</font><font style="vertical-align: inherit;">私たちは彼女が財産を持っていると仮定します</font></font><code>IsEmpty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs">		<span class="hljs-keyword">if</span> (!activeScenario.Progress() &amp;&amp; enemies.IsEmpty) {<font></font>
			Debug.Log(<span class="hljs-string">"Victory!"</span>);<font></font>
			BeginNewGame();<font></font>
			activeScenario.Progress();<font></font>
		}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
目的のプロパティをに追加します</font></font><code>GameBehaviorCollection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs">	<span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> IsEmpty =&gt; behaviors.Count == <span class="hljs-number">0</span>;</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">時間管理</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
時間管理機能も実装しましょう。これはテストに役立ち、多くの場合ゲームプレイ機能です。</font><font style="vertical-align: inherit;">まず、</font></font><code>Game.Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スペースバーのプレスを確認し、このイベントを使用してゲームの一時停止を有効/無効にします。</font><font style="vertical-align: inherit;">これは、値</font></font><code>Time.timeScale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を0と1の間で</font><font style="vertical-align: inherit;">切り替えることで実行できます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これはゲームロジックを変更しませんが、すべてのオブジェクトを所定の位置に固定します。</font><font style="vertical-align: inherit;">または、0の代わりに非常に小さい値、たとえば0.01を使用して、非常に遅いモーションを作成できます。</font></font><br>
<br>
<pre><code class="cs hljs">	<span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> pausedTimeScale = <span class="hljs-number">0f</span>;<font></font>
	<font></font>
	…<font></font>
	<font></font>
	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span> (<span class="hljs-params"></span>)</span> {<font></font>
		…<font></font>
		<font></font>
		<span class="hljs-keyword">if</span> (Input.GetKeyDown(KeyCode.Space)) {<font></font>
			Time.timeScale =<font></font>
				Time.timeScale &gt; pausedTimeScale ? pausedTimeScale : <span class="hljs-number">1f</span>;<font></font>
		}<font></font>
<font></font>
		<span class="hljs-keyword">if</span> (Input.GetKeyDown(KeyCode.B)) {<font></font>
			BeginNewGame();<font></font>
		}<font></font>
		…<font></font>
	}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、</font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲームの速度をスライダーに</font><font style="vertical-align: inherit;">追加して</font><font style="vertical-align: inherit;">、時間を短縮できるようにします。</font></font><br>
<br>
<pre><code class="cs hljs">	[<span class="hljs-meta">SerializeField, Range(1f, 10f)</span>]
	<span class="hljs-keyword">float</span> playSpeed = <span class="hljs-number">1f</span>;</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b5d/641/4e9/b5d6414e9cd53d7ac89c5c1b3699b806.png" width="320" height="38"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲームスピード。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一時停止がオンになっておらず、一時停止の値が時間スケールに割り当てられていない場合は、ゲームの速度と同じにします。</font><font style="vertical-align: inherit;">また、一時停止を解除するときは、統一ではなくゲームの速度を使用します。</font></font><br>
<br>
<pre><code class="cs hljs">		<span class="hljs-keyword">if</span> (Input.GetKeyDown(KeyCode.Space)) {<font></font>
			Time.timeScale =<font></font>
				Time.timeScale &gt; pausedTimeScale ? pausedTimeScale : playSpeed;<font></font>
		}<font></font>
		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Time.timeScale &gt; pausedTimeScale) {<font></font>
			Time.timeScale = playSpeed;<font></font>
		}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ループシナリオ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一部のシナリオでは、すべての波を数回通過する必要がある場合があります。</font><font style="vertical-align: inherit;">すべての波を数回ループすることによってシナリオを繰り返すことを可能にすることにより、そのような機能のサポートを実装することが可能です。</font><font style="vertical-align: inherit;">たとえば、最後のウェーブのみの繰り返しを有効にすることで、この機能をさらに改善できますが、このチュートリアルでは、シナリオ全体を繰り返すだけにします。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">周期的な波の前進</font></font></h3><br><font style="vertical-align: inherit;"></font><code>GameScenario</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">構成スライダーに</font><font style="vertical-align: inherit;">
追加して</font><font style="vertical-align: inherit;">サイクル数を設定します。デフォルトでは、値を1に割り当てます。最低でも、ゼロにすると、スクリプトは無限に繰り返されます。</font><font style="vertical-align: inherit;">そこで、負けられないサバイバルシナリオを作成します。ポイントは、プレイヤーがどれだけ耐えられるかを確認することです。</font></font><br>
<br>
<pre><code class="cs hljs">	[<span class="hljs-meta">SerializeField, Range(0, 10)</span>]
	<span class="hljs-keyword">int</span> cycles = <span class="hljs-number">1</span>;</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d0c/5d0/9df/d0c5d09dfd50e0e088c1848aaa32d531.png" width="320" height="38"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2サイクルのシナリオ。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで</font></font><code>GameScenario.State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、サイクル番号が追跡されます。</font></font><br>
<br>
<pre><code class="cs hljs">		<span class="hljs-keyword">int</span> cycle, index;<font></font>
<font></font>
		EnemyWave.State wave;<font></font>
<font></font>
		<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">State</span> (<span class="hljs-params">GameScenario scenario</span>)</span> {
			<span class="hljs-keyword">this</span>.scenario = scenario;<font></font>
			cycle = <span class="hljs-number">0</span>;<font></font>
			index = <span class="hljs-number">0</span>;<font></font>
			wave = scenario.waves[<span class="hljs-number">0</span>].Begin();<font></font>
		}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
では</font></font><code>Progress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、完了後にサイクルの増分を実行し</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、十分な数のサイクルが経過した場合にのみ</font><font style="vertical-align: inherit;">戻り</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">それ以外の場合は、波のインデックスをゼロにリセットし、動き続けます。</font></font><br>
<br>
<pre><code class="cs hljs">		<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Progress</span> (<span class="hljs-params"></span>)</span> {
			<span class="hljs-keyword">float</span> deltaTime = wave.Progress(Time.deltaTime);
			<span class="hljs-keyword">while</span> (deltaTime &gt;= <span class="hljs-number">0f</span>) {
				<span class="hljs-keyword">if</span> (++index &gt;= scenario.waves.Length) {
					<span class="hljs-keyword">if</span> (++cycle &gt;= scenario.cycles &amp;&amp; scenario.cycles &gt; <span class="hljs-number">0</span>) {
						<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
					}<font></font>
					index = <span class="hljs-number">0</span>;<font></font>
				}<font></font>
				wave = scenario.waves[index].Begin();<font></font>
				deltaTime = wave.Progress(deltaTime);<font></font>
			}<font></font>
			<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
		}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加速度</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プレイヤーが何とかサイクルを倒すことができれば、問題なく再び彼を倒すことができます。シナリオを複雑に保つには、複雑さを増す必要があります。これを行う最も簡単な方法は、後続のサイクルで、敵の作成間のすべての一時停止を減らすことです。その後、敵はより速く現れ、必然的にサバイバルシナリオでプレイヤーを倒します。</font><font style="vertical-align: inherit;">サイクルごとの加速を制御</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
する</font></font><code>GameScenario</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">構成スライダーを</font><font style="vertical-align: inherit;">追加し</font><font style="vertical-align: inherit;">ます。この値は、休止を減らすためにのみ、各サイクルの後にタイムスケールに追加されます。たとえば、加速度が0.5の場合、最初のサイクルの一時停止速度は×1、2番目のサイクルの速度は×1.5、3番目のサイクルは3番目の×2、4番目の×2.5のようになります。</font></font><br>
<br>
<pre><code class="cs hljs">	[<span class="hljs-meta">SerializeField, Range(0f, 1f)</span>]
	<span class="hljs-keyword">float</span> cycleSpeedUp = <span class="hljs-number">0.5f</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、時間スケールとを追加する必要があります</font></font><code>GameScenario.State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは常に最初は1に等しく、各サイクルの後に所定の加速度の値だけ増加します。</font></font><code>Time.deltaTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">波に沿って移動する前</font><font style="vertical-align: inherit;">にスケーリング</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">使用し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="cs hljs">		<span class="hljs-keyword">float</span> timeScale;<font></font>
<font></font>
		EnemyWave.State wave;<font></font>
<font></font>
		<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">State</span> (<span class="hljs-params">GameScenario scenario</span>)</span> {
			<span class="hljs-keyword">this</span>.scenario = scenario;<font></font>
			cycle = <span class="hljs-number">0</span>;<font></font>
			index = <span class="hljs-number">0</span>;<font></font>
			timeScale = <span class="hljs-number">1f</span>;<font></font>
			wave = scenario.waves[<span class="hljs-number">0</span>].Begin();<font></font>
		}<font></font>
<font></font>
		<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Progress</span> (<span class="hljs-params"></span>)</span> {
			<span class="hljs-keyword">float</span> deltaTime = wave.Progress(timeScale * Time.deltaTime);
			<span class="hljs-keyword">while</span> (deltaTime &gt;= <span class="hljs-number">0f</span>) {
				<span class="hljs-keyword">if</span> (++index &gt;= scenario.waves.Length) {
					<span class="hljs-keyword">if</span> (++cycle &gt;= scenario.cycles &amp;&amp; scenario.cycles &gt; <span class="hljs-number">0</span>) {
						<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
					}<font></font>
					index = <span class="hljs-number">0</span>;<font></font>
					timeScale += scenario.cycleSpeedUp;<font></font>
				}<font></font>
				wave = scenario.waves[index].Begin();<font></font>
				deltaTime = wave.Progress(deltaTime);<font></font>
			}<font></font>
			<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
		}</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qv/-d/3s/qv-d3srpikyuiorxx9vjk06wir8.gif"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">敵の作成速度が上がる3サイクル。</font><font style="vertical-align: inherit;">10回加速した。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しいチュートリアルのリリースに関する情報を受け取りますか？</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patreonで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私のページをフォローしてください</font><font style="vertical-align: inherit;">！</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリ</font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PDF記事</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja466839/index.html">ノートンコマンダーの歴史。パート1/3</a></li>
<li><a href="../ja466841/index.html">ラップトップがある場合、なぜ加熱パッド：原子レベルでの熱抵抗の研究</a></li>
<li><a href="../ja466845/index.html">逆インタビュー：会社に尋ねるべき質問は？</a></li>
<li><a href="../ja466849/index.html">noexcept-ctcheckまたはコンパイラーがnoexceptコードを作成するのに役立ついくつかの単純なマクロ</a></li>
<li><a href="../ja466851/index.html">Agilex Line-Intel 10nm FPGA</a></li>
<li><a href="../ja466857/index.html">iOS 13でのバックグラウンドアプリケーションの実行</a></li>
<li><a href="../ja466859/index.html">ADフェデレーションサービスを使用して、権利の配布でAWSユーザーを承認する</a></li>
<li><a href="../ja466861/index.html">ハッカソンを使用して現実から脱出する方法</a></li>
<li><a href="../ja466863/index.html">漸近線のセットアップ</a></li>
<li><a href="../ja466865/index.html">11月1日を待つ：暗号通貨の禁止または合法化</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>