<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš â™ï¸ ğŸ¤µğŸ» RabbitMQå’ŒSpring Bootçš„ç®€å•é›†æˆ ğŸ˜› ğŸ•ï¸ ğŸŒ¥ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨â€œ Springæ¡†æ¶å¼€å‘äººå‘˜ â€è¯¾ç¨‹å¼€å§‹ä¹‹å‰ï¼Œå‡†å¤‡äº†æœ¬æ–‡çš„ç¿»è¯‘ã€‚
 
 
 
 å¤§å®¶å¥½ï¼
 
 æˆ‘æƒ³ä¸æ‚¨åˆ†äº«ä¸€ä¸ªå¼€æ”¾æºä»£ç åº“ï¼Œè¯¥åº“æœ‰åŠ©äºRabbitMQä¸Spring Bootä¸Šçš„åº”ç”¨ç¨‹åºé›†æˆã€‚æ­¤å¤–ï¼Œè¯¥åº“æä¾›äº†ä¸€ç§ç»è¿‡æ”¹è¿›çš„é‡è¯•æ–°æ¦‚å¿µï¼ˆä¸æ ‡å‡†Spring AMQPæ–¹æ³•ç›¸æ¯”ï¼‰ã€‚
 ç®€åŒ–å—ï¼Ÿä½†æ˜¯å¦‚ä½•ï¼Ÿ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>RabbitMQå’ŒSpring Bootçš„ç®€å•é›†æˆ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/500936/"><i><b><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨â€œ Springæ¡†æ¶å¼€å‘äººå‘˜</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> â€è¯¾ç¨‹å¼€å§‹ä¹‹å‰ï¼Œå‡†å¤‡äº†æœ¬æ–‡çš„ç¿»è¯‘</font><font style="vertical-align: inherit;">ã€‚</font></font></b></i><br>
<br>
<img src="https://habrastorage.org/webt/yc/3k/dp/yc3kdpwvkd25ltyl0y2e41jwvsk.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¤§å®¶å¥½ï¼</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘æƒ³ä¸æ‚¨åˆ†äº«</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€ä¸ªå¼€æ”¾æºä»£ç åº“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè¯¥</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">åº“</font></a><font style="vertical-align: inherit;">æœ‰åŠ©äºRabbitMQä¸Spring Bootä¸Šçš„åº”ç”¨ç¨‹åºé›†æˆã€‚</font><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œè¯¥åº“æä¾›äº†ä¸€ç§ç»è¿‡æ”¹è¿›çš„é‡è¯•æ–°æ¦‚å¿µï¼ˆä¸æ ‡å‡†Spring AMQPæ–¹æ³•ç›¸æ¯”ï¼‰ã€‚</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç®€åŒ–å—ï¼Ÿ</font><font style="vertical-align: inherit;">ä½†æ˜¯å¦‚ä½•ï¼Ÿ</font></font></blockquote><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‡ªåŠ¨é…ç½®</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å‡è®¾æˆ‘ä»¬æƒ³ä½¿ç”¨Spring AMQPä¸RabbitMQè¿›è¡Œäº¤äº’ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨SSLï¼‰ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€äº›è±†ç±»ï¼Œå¦‚</font></font><code>ConnectionFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>RabbitAdmin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>RabbitTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><code>AbstractRabbitListenerContainerFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯ï¼Œæƒ³è±¡ä¸€ä¸‹RabbitMQä¸­æœ‰å‡ ä¸ªè™šæ‹Ÿä¸»æœºã€‚</font><font style="vertical-align: inherit;">é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨Spring AMQPï¼Œä½ éœ€è¦ç”¨çš„æ‰‹åŠ¨é…ç½®æ¯ä¸ªè™šæ‹Ÿä¸»æœºåˆ›å»ºè¿™æ ·ä¸€ä¸ªç”Ÿæ€ç³»ç»Ÿ</font></font><code>RabbitTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><code>RabbitListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jl/zr/hs/jlzrhsbdrmwg9oqcmv-hc4hlbjg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æ‚¨æ‰€è§ï¼Œæ‰€æœ‰è¿™äº›é…ç½®éƒ½éœ€è¦æ—¶é—´å¹¶ä¸”å¯èƒ½ä»¤äººå¤´ç–¼ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ„è¯†åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œå»ºè®®çš„åº“ä¼šè‡ªåŠ¨ä¸ºæ‚¨é…ç½®æ‰€æœ‰è¿™äº›beanã€‚</font><font style="vertical-align: inherit;">æ‚¨å”¯ä¸€éœ€è¦åšçš„å°±æ˜¯ç¡®å®šä¸­çš„é…ç½®</font></font><b><code>application.properties</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œç„¶åé­”æœ¯å°±ä¼šå‘ç”Ÿï¼</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å“‡ï¼Œä½†æ˜¯å…¶ä¸­çš„é…ç½®çœ‹èµ·æ¥åƒ</font></font><code><b>application.properties</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»€ä¹ˆï¼Ÿ</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸€åˆ‡éƒ½éå¸¸ç®€å•ã€‚</font><font style="vertical-align: inherit;">é¦–å…ˆï¼Œå±æ€§æœ‰ä¸€ä¸ªå‰ç¼€-this </font></font><b><code>spring.rabbitmq.custom</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¹‹åï¼Œæ‚¨å¿…é¡»æŒ‡å®šäº‹ä»¶çš„åç§°ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯éå¸¸é‡è¦çš„éƒ¨åˆ†ï¼Œå› ä¸ºåº“è¿›è¡Œçš„æ‰€æœ‰è®¾ç½®éƒ½åŸºäºè¯¥åç§°ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨äº‹ä»¶åç§°ä¹‹åï¼Œæ‚¨å¯ä»¥æŒ‡å®šå±æ€§å’Œå€¼ã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡æ¡£</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸­ä»‹ç»äº†æ‰€æœ‰å±æ€§</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å› æ­¤ï¼Œæ¨¡æ¿å¦‚ä¸‹ï¼š</font><font style="vertical-align: inherit;">
ä»¥ä¸‹æ˜¯ä¸¤ä¸ªä¸åŒè¿æ¥çš„ç¤ºä¾‹é…ç½®ã€‚</font></font><br>
<br>
<code><code>spring.rabbitmq.custom.&lt;</code>YOUR_EVENT&gt;.<code>&lt;</code>PROPERTY&gt;=<code>&lt;</code>VALUE&gt;<br>
</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="java hljs">spring.rabbitmq.custom.some-event.host=localhost<font></font>
spring.rabbitmq.custom.some-event.port=<span class="hljs-number">5672</span>
spring.rabbitmq.custom.some-event.ttlRetryMessage=<span class="hljs-number">5000</span>
spring.rabbitmq.custom.some-event.maxRetriesAttempts=<span class="hljs-number">5</span>
spring.rabbitmq.custom.some-event.ttlMultiply=<span class="hljs-number">2</span><font></font>
spring.rabbitmq.custom.some-event.queueRoutingKey=ROUTING.KEY.TEST<font></font>
spring.rabbitmq.custom.some-event.exchange=ex.custom.direct<font></font>
spring.rabbitmq.custom.some-event.exchangeType=direct<font></font>
spring.rabbitmq.custom.some-event.queue=queue.custom.test<font></font>
spring.rabbitmq.custom.some-event.autoCreate=<span class="hljs-keyword">true</span>
spring.rabbitmq.custom.some-event.concurrentConsumers=<span class="hljs-number">1</span>
spring.rabbitmq.custom.some-event.maxConcurrentConsumers=<span class="hljs-number">1</span><font></font>
spring.rabbitmq.custom.some-event.virtualHost=tradeshift<font></font>
spring.rabbitmq.custom.some-event.primary=<span class="hljs-keyword">true</span>
spring.rabbitmq.custom.some-event.sslConnection=<span class="hljs-keyword">true</span>
spring.rabbitmq.custom.some-event.tlsKeystoreLocation=file:<span class="hljs-comment">///etc/tradeshift/your-service/tls-keystore.pkcs12</span><font></font>
spring.rabbitmq.custom.some-event.tlsKeystorePassword=${RABBITMQ_PASS_CERT}<font></font>
<font></font>
spring.rabbitmq.custom.another-event.host=localhost<font></font>
spring.rabbitmq.custom.another-event.port=<span class="hljs-number">5672</span>
spring.rabbitmq.custom.another-event.ttlRetryMessage=<span class="hljs-number">5000</span>
spring.rabbitmq.custom.another-event.maxRetriesAttempts=<span class="hljs-number">5</span><font></font>
spring.rabbitmq.custom.another-event.queueRoutingKey=TEST.QUEUE<font></font>
spring.rabbitmq.custom.another-event.exchange=ex_test_1<font></font>
spring.rabbitmq.custom.another-event.exchangeType=direct<font></font>
spring.rabbitmq.custom.another-event.queue=queue_test_1<font></font>
spring.rabbitmq.custom.another-event.autoCreate=<span class="hljs-keyword">true</span>
spring.rabbitmq.custom.another-event.concurrentConsumers=<span class="hljs-number">1</span>
spring.rabbitmq.custom.another-event.maxConcurrentConsumers=<span class="hljs-number">1</span><font></font>
spring.rabbitmq.custom.another-event.username=guest<font></font>
spring.rabbitmq.custom.another-event.password=${RABBITMQ_PASS}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰ç¼–å†™ä»»ä½•ä»£ç ï¼</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¾ˆå¥½ï¼Œä½†æ˜¯æ‚¨æ˜¯åœ¨è°ˆè®ºæ–°çš„é‡æ’­ç­–ç•¥ï¼Œå¯¹å—ï¼Ÿ</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ˜¯çš„ï¼Œæˆ‘çš„æœ‹å‹è¯´ï¼</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯åœ¨è§£é‡Šè¿™ç§æ–°ç­–ç•¥ä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹RabbitMQå’ŒSpring AMQPçš„é»˜è®¤è¡Œä¸ºã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é»˜è®¤æƒ…å†µä¸‹ï¼ŒRabbitMQä¸æä¾›å…è®¸æ‚¨æ§åˆ¶æ•´ä¸ªæ¶ˆæ¯ç”Ÿå‘½å‘¨æœŸçš„é‡è¯•å¤„ç†ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¾‹å¦‚ï¼Œåœ¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RabbitMQ 3.8</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¹‹å‰</font><font style="vertical-align: inherit;">ï¼Œæ¶ˆæ¯å¤´æ²¡æœ‰ç”¨äºæ§åˆ¶é‡è¯•æ¬¡æ•°çš„å±æ€§ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RabbitMQçš„é»˜è®¤è¡Œä¸ºï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœæ‚¨å°šæœªå®šä¹‰</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”Ÿå­˜æ—¶é—´</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆTTLï¼Œç”Ÿå­˜æœŸï¼‰ï¼Œé‚£ä¹ˆRabbitMQå°†ä¸æ–­å°è¯•å°†æ‚¨çš„æ¶ˆæ¯æ’é˜Ÿã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœæ‚¨å®šä¹‰äº†TTLä½†æœªå®šä¹‰</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dlx</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œåˆ™åœ¨TTLä¹‹åï¼Œè¯¥æ¶ˆæ¯å°†ä»é˜Ÿåˆ—ä¸­åˆ é™¤ï¼Œå¹¶ä¸”æ‚¨å°†ä¸¢å¤±è¯¥æ¶ˆæ¯ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœå·²å®šä¹‰TTLå’Œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dlx</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œåˆ™åœ¨TTLä¹‹åï¼Œæ¶ˆæ¯å°†å‘é€åˆ°</font><font style="vertical-align: inherit;">dlxä¸­å®šä¹‰</font><font style="vertical-align: inherit;">çš„</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">äº¤æ¢å™¨</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/pg/kb/bu/pgkbbu4_hvodxqc5oqtnjlxp5mo.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RabbitMQé»˜è®¤è¡Œä¸º</font></font></i><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦å¢åŠ TTLï¼ˆä¾‹å¦‚ï¼Œåœ¨æ“ä½œä¸ç¨³å®šçš„æƒ…å†µä¸‹ï¼‰å¹¶æ§åˆ¶é‡è¯•æ¬¡æ•°æ€ä¹ˆåŠï¼Ÿ</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¥½é—®é¢˜ï¼</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨è¯¥è§£é‡Šä¸€ä¸‹Spring AQMPå’ŒSpring Rabbit Tuningåº“æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é‡è¯•ç­–ç•¥</font></font></h2><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring AMQPé»˜è®¤</font></font></h4><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é»˜è®¤æƒ…å†µä¸‹</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ä½¿ç”¨</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">Spring AMQPæ—¶ï¼Œ</font></a><font style="vertical-align: inherit;">æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å±æ€§å®šä¹‰é‡è¯•é€‰é¡¹ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯è¿™ç§æ–¹æ³•æœ‰é—®é¢˜ã€‚</font><font style="vertical-align: inherit;">é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æ‚¨å°è¯•å†æ¬¡ä¼ é€’æ¶ˆæ¯æ—¶ï¼ŒSpring AMQPå°†é˜»æ­¢æ‚¨çš„é˜Ÿåˆ—ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯ä»¥é€šè¿‡ä¸€ç§ç»•è¡Œæ–¹å¼è§£å†³æ­¤é—®é¢˜ï¼šä½¿ç”¨å¹¶è¡Œæ€§ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬åŠ è½½äº†JVMï¼Œè¿™ä¸æ˜¯æœ€å¥½çš„æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ‚¨æœ‰äº”ä¸ªæœ‰é—®é¢˜çš„æ¶ˆæ¯ï¼ˆå¦‚ç¤ºä¾‹ä¸­æ‰€ç¤ºï¼‰ï¼Œåˆ™ä¼šå†æ¬¡å‡ºç°ç“¶é¢ˆï¼Œå¹¶ä¸”æˆ‘ä»¬ä»ç„¶éœ€è¦æ‰‹åŠ¨ç¡®å®š-binä¸­</font></font><code>@Configuration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¯ä¸ªè¿æ¥å’Œå®¹å™¨</font><font style="vertical-align: inherit;">çš„bean </font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="java hljs">spring.rabbitmq.listener.simple.retry.enabled=<span class="hljs-keyword">true</span>
spring.rabbitmq.listener.simple.retry.initial-interval=<span class="hljs-number">2000</span>
spring.rabbitmq.listener.simple.retry.max-attempts=<span class="hljs-number">5</span>
spring.rabbitmq.listener.simple.retry.multiplier=<span class="hljs-number">2</span>
spring.rabbitmq.listener.simple.max-concurrency=<span class="hljs-number">5</span>
spring.rabbitmq.listener.simple.concurrency=<span class="hljs-number">5</span></code></pre><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring RabbitMQè°ƒæ•´</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥åº“é‡‡ç”¨ä¸åŒçš„æ–¹æ³•ï¼Œå¹¶å…·æœ‰å•ç‹¬çš„é‡è¯•é˜Ÿåˆ—ã€‚</font><font style="vertical-align: inherit;">è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åˆ°æœŸæ¶ˆæ¯å‚æ•°å’Œx-deathå‚æ•°æ§åˆ¶TTLï¼Œä»¥æ§åˆ¶é‡è¯•æ¬¡æ•°ã€‚</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½†æ˜¯å¦‚ä½•ï¼Ÿ</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬åœ¨é‡è¯•é˜Ÿåˆ—ä¸­ä½¿ç”¨dlxæ¦‚å¿µå°†æ¶ˆæ¯é‡æ–°å‘é€åˆ°ä¸»é˜Ÿåˆ—ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®x-deathå‚æ•°ï¼Œå¹¶ä¸”å¯ä»¥ä»¥ç¼–ç¨‹æ–¹å¼ç¡®å®šæ¶ˆæ¯çš„ç”Ÿå­˜æœŸã€‚</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨æ„ã€‚</font><font style="vertical-align: inherit;">ç”±äºæ­¤åº“æ˜¯Spring AMQPçš„æ‰©å±•ï¼Œå› æ­¤æ‚¨å¯ä»¥ä½¿ç”¨é»˜è®¤çš„é‡è¯•ç­–ç•¥ï¼Œå¹¶ä¸”ä»…å°†æ­¤åº“ç”¨äºè‡ªåŠ¨é…ç½®Beanã€‚</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/2t/d7/n3/2td7n3ayuw29wlik_b6y4xi_num.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring RabbitMQä¼˜åŒ–é‡è¯•</font></font></i><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å¯ä»¥åœ¨æ²¡æœ‰è‡ªåŠ¨é…ç½®çš„æƒ…å†µä¸‹ä½¿ç”¨é‡è¯•ç­–ç•¥å—ï¼Ÿ</font><font style="vertical-align: inherit;">æˆ‘å·²ç»æœ‰å¾ˆå¤šbeanï¼Œæ²¡æœ‰æ—¶é—´é‡å†™å®ƒä»¬ã€‚</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬çŸ¥é“ä¸–ç•Œå¹¶ä¸å®Œç¾ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ ‡å¿—å…è®¸æ‚¨ç¦ç”¨è‡ªåŠ¨é…ç½®ï¼Œä»…ä½¿ç”¨æˆ‘ä»¬çš„æ–¹æ³•è¿›è¡Œé‡å¤å¤„ç†å’Œå…¶ä»–ä¼˜åŠ¿ï¼ˆä¾‹å¦‚ç®±ç®¡ç†ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å±æ€§ç¦ç”¨è‡ªåŠ¨é…ç½®ï¼š</font></font><br>
<br>
<pre><code class="java hljs">spring.rabbitmq.enable.custom.autoconfiguration=<span class="hljs-keyword">false</span></code></pre><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½†æ˜¯æˆ‘æœ‰ä¸¤ä¸ªä¸åŒçš„è¿æ¥ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹è¯¥æ€ä¹ˆåŠï¼Ÿ</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœæ‚¨æœ‰å¤šä¸ªè¿æ¥ï¼Œå¹¶ä¸”è¦ç¦ç”¨è‡ªåŠ¨é…ç½®ï¼Œåˆ™éœ€è¦</font></font><code>RabbitTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºæ¯ä¸ªè¿æ¥</font><font style="vertical-align: inherit;">æŒ‡å®šBeanåç§°</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¿™</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™é‡Œ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æè¿°</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">
æ‚¨ä»ç„¶å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„bean </font><font style="vertical-align: inherit;">æ¥ç®€åŒ–Spring AMQPçš„å·¥ä½œã€‚</font></font><br>
<br>
<code><code>spring.rabbitmq.custom.&lt;</code>YOUR_EVENT&gt;.rabbitTemplateBeanName= <code>&lt;</code>RABBITTEMPLATE_BEAN_NAME&gt;</code><br>
<br><font style="vertical-align: inherit;"></font><code>RabbitTemplateHandler</code><font style="vertical-align: inherit;"></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¾ˆå¥½ï¼</font><font style="vertical-align: inherit;">æ‰€ä»¥ï¼Œæˆ‘æƒ³ç”¨è¿™ä¸ªã€‚</font><font style="vertical-align: inherit;">æˆ‘æ€æ ·æ‰èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼Ÿ</font><font style="vertical-align: inherit;">æ‚¨æœ‰ç¤ºä¾‹æˆ–æ–‡æ¡£å—ï¼Ÿ</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬åœ¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯¥å­˜å‚¨åº“ä¸­</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰ä¸€ä¸ªç¤ºä¾‹é¡¹ç›®</font><font style="vertical-align: inherit;">ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æŸ¥çœ‹å¦‚ä½•å¯¹å‘å¸ƒè€…å’Œè®¢é˜…è€…ä½¿ç”¨è¯¥åº“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†è¿™å¾ˆç®€å•ï¼Œæˆ‘å°†åœ¨è¿™é‡Œä¸¾ä¾‹è¯´æ˜ï¼</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘è¡Œäºº</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åº“ä¸­æœ‰ä¸€ä¸ªç±»ï¼Œ</font></font><code>RabbitTemplateHandler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éå¸¸æ˜“äºä½¿ç”¨ã€‚</font><font style="vertical-align: inherit;">æ‚¨éœ€è¦è°ƒç”¨è¯¥æ–¹æ³•</font></font><code>getRabbitTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶å°†è™šæ‹Ÿä¸»æœºä½œä¸ºå‚æ•°ä¼ é€’ï¼Œä»¥è·å–Bean </font></font><code>RabbitTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä¹‹åï¼Œæ‚¨å¯ä»¥è°ƒç”¨convertAndSendæ–¹æ³•å¹¶å°†å…¶ä¼ é€’ç»™äº¤æ¢å’Œè·¯ç”±å…³é”®å‚æ•°ã€‚</font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨æ„</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šäº¤æ¢å’Œè·¯ç”±å¯†é’¥å¯ä»¥ä½¿ç”¨æ³¨é‡Šè·å¾—</font></font></i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å€¼</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€ä¸ªä¾‹å­</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Value("${spring.rabbitmq.custom.some-event.exchange}")</span>
<span class="hljs-keyword">private</span> String exchangeSomeEvent;<font></font>
<font></font>
<span class="hljs-meta">@Value("${spring.rabbitmq.custom.some-event.queueRoutingKey}")</span>
<span class="hljs-keyword">private</span> String routingKeySomeEvent;<font></font>
<font></font>
<span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RabbitTemplateHandler rabbitTemplateHandler;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendMessage</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String message)</span> </span>{<font></font>
   rabbitTemplateHandler.getRabbitTemplate(<span class="hljs-string">"some-event"</span>).convertAndSend(exchangeSomeEvent, routingKeySomeEvent, message);<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®¢æˆ·</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®¢æˆ·ä¹Ÿå¾ˆç®€å•ã€‚</font><font style="vertical-align: inherit;">æ‚¨å”¯ä¸€éœ€è¦åšçš„å°±æ˜¯åœ¨æ–¹æ³•ä¸­æ·»åŠ ä¸€ä¸ªæ³¨é‡Š</font></font><code>RabbitListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆé»˜è®¤ä¸ºSpring AMQPæ³¨é‡Šï¼‰å¹¶ä¼ é€’åç§°</font></font><code>containerFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚ä½•ä¸ºè™šæ‹Ÿä¸»æœºæ‰¾åˆ°æ­£ç¡®çš„containerFactoryåç§°ï¼Ÿ</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‚¨ä¸éœ€è¦çŸ¥é“å®ƒï¼Œåªéœ€ä¼ é€’äº‹ä»¶çš„åç§°ï¼Œåº“å°±ä¼šä¸ºæ‚¨åšæ‰€æœ‰çš„é­”æœ¯ï¼</font><font style="vertical-align: inherit;">è¯¥åº“è¿˜å…·æœ‰æ¨èé‡è¯•å’Œdlqçš„åŠŸèƒ½ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‰“å¼€å®ƒä»¬éå¸¸ç®€å•ã€‚</font><font style="vertical-align: inherit;">æ‚¨éœ€è¦åœ¨æ–¹æ³•ä¸­æ·»åŠ æ³¨é‡Š</font></font><code>EnableRabbitRetryAndDlq</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå¹¶å°†å±æ€§åç§°ä½œä¸ºå‚æ•°ä¼ é€’ã€‚</font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨æ„</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ‚¨è¿˜å¯ä»¥æŒ‡å®šé‡è¯•å’Œdlqå¤„ç†å“ªäº›å¼‚å¸¸ã€‚</font><font style="vertical-align: inherit;">é»˜è®¤æƒ…å†µä¸‹ä¼šå¤„ç†å®ƒ</font></font><code>Exception.class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè¿™æ„å‘³ç€å¤„ç†æ‰€æœ‰å¼‚å¸¸ã€‚</font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¾‹ï¼š</font></font></b><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@RabbitListener(containerFactory = "some-event", queues = "${spring.rabbitmq.custom.some-event.queue}")</span>
<span class="hljs-meta">@EnableRabbitRetryAndDlq(event = "some-event", exceptions = { IllegalArgumentException.class, RuntimeException.class })</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onMessage</span><span class="hljs-params">(Message message)</span> </span>{<font></font>
   ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™å°±æ˜¯å…¨éƒ¨ï¼</font><font style="vertical-align: inherit;">å¸Œæœ›æ‚¨åƒæˆ‘ä»¬ä¸€æ ·å–œæ¬¢è¿™ä¸ªå›¾ä¹¦é¦†ï¼</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è€Œä¸”ï¼Œæœ€é‡è¦çš„æ˜¯ï¼šéšæ—¶è´¡çŒ®æˆ–å‘é€åé¦ˆï¼</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰¹åˆ«æ„Ÿè°¢</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®‰å¾·çƒˆÂ·è·¯æ˜“æ–¯Â·æˆˆéº¦æ–¯</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rogerio Bueno </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è±æ˜‚çº³å¤šÂ·è´¹é›·æ‹‰</font></font></a><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨å†Œå…è´¹è¯¾ç¨‹ã€‚</font></font></a><br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN500924/index.html">ä¸Evgeny Borisovçš„åœ¨çº¿ä¼šè®®JUG.ruâ€œå¼¹ç°§åˆ¶é€ è€…â€</a></li>
<li><a href="../zh-CN500928/index.html">2020å¹´æ•°å­—çªç ´ç«èµ›å¯åŠ¨åœ¨çº¿ITé©¬æ‹‰æ¾</a></li>
<li><a href="../zh-CN500930/index.html">æ¸¸æˆè®¾è®¡å¸ˆçš„å°ç§˜è¯€å¯ä»¥ä½¿ç©å®¶è®¨åŒæ‚¨çš„æ¸¸æˆ</a></li>
<li><a href="../zh-CN500932/index.html">åƒåœ¾é‚®ä»¶ä½œä¸ºä¿æŠ¤å·¥å…·</a></li>
<li><a href="../zh-CN500934/index.html">Winnumå®£å¸ƒæ——èˆ°ç‰ˆæœ¬Winnum Platform 4.3çš„æ–°ç‰ˆæœ¬</a></li>
<li><a href="../zh-CN500942/index.html">ç´«å¤–çº¿ï¼šæœ‰æ•ˆçš„æ¶ˆæ¯’å’Œå®‰å…¨æ€§</a></li>
<li><a href="../zh-CN500944/index.html">WexLang Reader-å¦‚ä½•è½»æ¾é˜…è¯»å¤–è¯­ä¹¦ç±ï¼ˆ104ç§è¯­è¨€ï¼‰</a></li>
<li><a href="../zh-CN500948/index.html">Rust 1.43.1ç‰ˆæœ¬ï¼šè°ƒæ•´ç‰ˆæœ¬</a></li>
<li><a href="../zh-CN500952/index.html">Pythonç¨‹åºå‘˜å…³é”®æŠ€èƒ½</a></li>
<li><a href="../zh-CN500956/index.html">ç§»åŠ¨MLï¼šå£è¢‹é‡Œçš„æœºå™¨å­¦ä¹  ç¬¬1éƒ¨åˆ†-é“</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>