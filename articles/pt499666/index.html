<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìñ üé¨ üëØ PEP 572 (Express√µes de atribui√ß√£o no python 3.8) üêª üìó üï¥üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√°, Habr. Desta vez, veremos o PEP 572, que fala sobre express√µes de atribui√ß√£o. Se voc√™ ainda √© c√©tico em rela√ß√£o ao operador ": =" ou n√£o entende c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>PEP 572 (Express√µes de atribui√ß√£o no python 3.8)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499666/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ol√°, Habr. </font><font style="vertical-align: inherit;">Desta vez, veremos o PEP 572, que fala sobre express√µes de atribui√ß√£o. </font><font style="vertical-align: inherit;">Se voc√™ ainda √© c√©tico em rela√ß√£o ao operador ": =" ou n√£o entende completamente as regras de uso, este artigo √© para voc√™. </font><font style="vertical-align: inherit;">Aqui voc√™ encontrar√° muitos exemplos e respostas para a pergunta: "Por que isso acontece?" </font><font style="vertical-align: inherit;">Este artigo acabou sendo o mais completo poss√≠vel e, se voc√™ tiver pouco tempo, observe a se√ß√£o que escrevi. </font><font style="vertical-align: inherit;">No in√≠cio, as principais ‚Äúteses‚Äù s√£o coletadas para um trabalho confort√°vel com express√µes de atribui√ß√£o. </font><font style="vertical-align: inherit;">Perdoe-me com anteced√™ncia se voc√™ encontrar erros (escreva sobre eles para mim, eu vou consertar). </font><font style="vertical-align: inherit;">Vamos come√ßar:</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEP 572 - Express√µes de atribui√ß√£o</font></font></h2><div class="scrollable-table"><table>
<tbody><tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pep</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">572</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T√≠tulo:</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Express√µes de atribui√ß√£o</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autores:</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chris Angelico &lt;rosuav em gmail.com&gt;, Tim Peters &lt;tim.peters em gmail.com&gt;, Guido van Rossum &lt;guido em python.org&gt;</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Discuss√£o:</font></font></b></td>
<td><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doc-sig em python.org</font></font></a></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estado:</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aceitaram</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um tipo:</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Padr√£o</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criada:</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">28 de fevereiro de 2018</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vers√£o Python:</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.8</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Publicar hist√≥ria:</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">28-fev-2018, 02-mar-2018, 23-mar-2018, 04-abr-2018, 17-abr-2018, 25-abr-2018, 09-jul-2018, 05-ago-2019</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permiss√£o para adotar o padr√£o:</font></font></b></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mail.python.org/pipermail/python-dev/2018-July/154601.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (com VPN por um longo tempo, mas √© carregado)</font></font></td>
</tr>
</tbody></table></div><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conte√∫do</font></font></b><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anota√ß√£o</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Justifica√ß√£o</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sintaxe e sem√¢ntica</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Altera√ß√µes nas especifica√ß√µes durante a implementa√ß√£o</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplos</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alternativas rejeitadas</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obje√ß√µes frequentes</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recomenda√ß√µes de estilo</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obrigado</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap√™ndice A: Conclus√µes de Tim Peters</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap√™ndice B: Um Int√©rprete de C√≥digo Bruto para Geradores</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap√™ndice C: Nenhuma altera√ß√£o na sem√¢ntica do escopo</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Refer√™ncias</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">direito autoral</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minha parte</font></font></a></li>
</ul><br>
<a name="ann"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anota√ß√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta conven√ß√£o abordar√° a possibilidade de atribui√ß√£o dentro de express√µes, usando a nova nota√ß√£o NAME: = expr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como parte das inova√ß√µes, o procedimento para calcular geradores de dicion√°rio (compreens√£o de dicion√°rio) foi atualizado. Isso garante que a express√£o da chave seja avaliada antes da express√£o do valor (isso permite vincular a chave a uma vari√°vel e, em seguida, reutilizar a vari√°vel criada no c√°lculo do valor correspondente √† chave). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante uma discuss√£o sobre esse PEP, esse operador ficou oficialmente conhecido como operador de morsa. O nome formal da constru√ß√£o √© "Express√£o de designa√ß√£o" (de acordo com o cabe√ßalho PEP: Express√µes de designa√ß√£o), mas pode ser chamado de "Express√µes nomeadas". Por exemplo, a implementa√ß√£o de refer√™ncia no CPython usa esse mesmo nome.</font></font><br>
<br>
<a name="oboc"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Justifica√ß√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A nomea√ß√£o √© uma parte importante da programa√ß√£o que permite o uso de um nome "descritivo" em vez de uma express√£o mais longa, al√©m de facilitar a reutiliza√ß√£o de valores. </font><font style="vertical-align: inherit;">Atualmente, isso s√≥ pode ser feito na forma de instru√ß√µes, o que torna esta opera√ß√£o indispon√≠vel ao gerar listas (compreens√£o da lista), bem como em outras express√µes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, nomear partes de uma express√£o grande pode ajudar na depura√ß√£o interativa, fornecendo ferramentas para exibir prompts e resultados intermedi√°rios. </font><font style="vertical-align: inherit;">Sem a capacidade de capturar os resultados de express√µes aninhadas, voc√™ precisar√° alterar o c√≥digo-fonte, mas, usando as express√µes de atribui√ß√£o, basta inserir alguns "marcadores" no formul√°rio "nome: = express√£o". </font><font style="vertical-align: inherit;">Isso elimina refatora√ß√£o desnecess√°ria e, portanto, reduz a probabilidade de altera√ß√µes n√£o intencionais do c√≥digo durante a depura√ß√£o (uma causa comum de Heisenbugs s√£o erros que alteram as propriedades do c√≥digo durante a depura√ß√£o e podem aparecer inesperadamente na produ√ß√£o]), e esse c√≥digo ser√° mais compreens√≠vel para outro para o programador.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A Import√¢ncia do C√≥digo Real</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante o desenvolvimento deste PEP, muitas pessoas (tanto defensores quanto cr√≠ticos) estavam muito focadas em exemplos de brinquedos, por um lado, e exemplos excessivamente complexos, por outro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O perigo dos exemplos de brinquedos √© duplo: eles geralmente s√£o muito abstratos para fazer algu√©m dizer "ah, isso √© irresist√≠vel" e tamb√©m s√£o facilmente rejeitados com as palavras "eu nunca escreveria isso". O perigo de exemplos excessivamente complexos √© que eles fornecem um ambiente conveniente para os cr√≠ticos, sugerindo que essa funcionalidade seja removida ("Isso √© muito confuso", dizem essas pessoas). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, h√° um bom uso para tais exemplos: eles ajudam a esclarecer a sem√¢ntica pretendida. Portanto, daremos alguns deles abaixo. No entanto, para ser </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">convincente</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , os exemplos devem se basear em</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥digo </font><b><font style="vertical-align: inherit;">real</font></b><font style="vertical-align: inherit;"> que foi escrito sem pensar neste PEP. Ou seja, o c√≥digo que faz parte de um aplicativo realmente √∫til (sem diferen√ßa: seja grande ou pequeno). Tim Peters nos ajudou muito olhando seus reposit√≥rios pessoais e escolhendo exemplos do c√≥digo que ele escreveu, o que (em sua opini√£o) seria mais compreens√≠vel se eles fossem reescritos (sem fanatismo) usando express√µes de atribui√ß√£o. Sua conclus√£o √© a seguinte: as mudan√ßas atuais trariam uma melhoria modesta, mas √≥bvia, em alguns bits de seu c√≥digo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outro exemplo de c√≥digo real √© a observa√ß√£o indireta de como os programadores valorizam a compacta√ß√£o. Guido van Rossum verificou a base de c√≥digo do Dropbox e encontrou algumas evid√™ncias de que os programadores preferem escrever menos linhas de c√≥digo do que usar algumas express√µes pequenas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Caso em quest√£o: Guido encontrou v√°rios pontos ilustrativos quando um programador repete uma subexpress√£o (diminuindo a velocidade do programa), mas salva uma linha extra de c√≥digo. </font><font style="vertical-align: inherit;">Por exemplo, em vez de escrever:</font></font><br>
<br>
<pre><code class="python hljs">match = re.match(data)<font></font>
group = match.group(<span class="hljs-number">1</span>) <span class="hljs-keyword">if</span> match <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os programadores preferiram esta op√ß√£o:</font></font><br>
<br>
<pre><code class="python hljs">group = re.match(data).group(<span class="hljs-number">1</span>) <span class="hljs-keyword">if</span> re.match(data) <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° outro exemplo, mostrando que os programadores √†s vezes est√£o dispostos a trabalhar mais para manter o "n√≠vel anterior" de indenta√ß√£o:</font></font><br>
<br>
<pre><code class="python hljs">match1 = pattern1.match(data)<font></font>
match2 = pattern2.match(data)<font></font>
<span class="hljs-keyword">if</span> match1:<font></font>
    result = match1.group(<span class="hljs-number">1</span>)
<span class="hljs-keyword">elif</span> match2:<font></font>
    result = match2.group(<span class="hljs-number">2</span>)
<span class="hljs-keyword">else</span>:<font></font>
    result = <span class="hljs-literal">None</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse c√≥digo calcula o padr√£o2, mesmo que o padr√£o1 j√° corresponda (nesse caso, a segunda subcondi√ß√£o nunca ser√° atendida). </font><font style="vertical-align: inherit;">Portanto, a seguinte solu√ß√£o √© mais eficaz, mas menos atraente:</font></font><br>
<br>
<pre><code class="python hljs">match1 = pattern1.match(data)
<span class="hljs-keyword">if</span> match1:<font></font>
    result = match1.group(<span class="hljs-number">1</span>)
<span class="hljs-keyword">else</span>:<font></font>
    match2 = pattern2.match(data)<font></font>
    <span class="hljs-keyword">if</span> match2:<font></font>
        result = match2.group(<span class="hljs-number">2</span>)
    <span class="hljs-keyword">else</span>:<font></font>
        result = <span class="hljs-literal">None</span></code></pre><br>
<a name="sint"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sintaxe e sem√¢ntica</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na maioria dos casos em que o Python usa express√µes arbitr√°rias, agora voc√™ pode usar express√µes de atribui√ß√£o. </font><font style="vertical-align: inherit;">Eles t√™m o formato NAME: = expr, em que expr √© qualquer express√£o v√°lida do Python, exceto a tupla n√£o par√™nteses, e NAME √© o identificador. </font><font style="vertical-align: inherit;">O valor dessa express√£o coincide com o original, mas um efeito adicional √© a atribui√ß√£o de um valor ao objeto de destino:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># Handle a matched regex</span>
<span class="hljs-keyword">if</span> (match := pattern.search(data)) <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
    <span class="hljs-comment"># Do something with match</span><font></font>
<font></font>
<span class="hljs-comment"># A loop that can't be trivially rewritten using 2-arg iter()</span>
<span class="hljs-keyword">while</span> chunk := file.read(<span class="hljs-number">8192</span>):<font></font>
   process(chunk)<font></font>
<font></font>
<span class="hljs-comment"># Reuse a value that's expensive to compute</span>
[y := f(x), y**<span class="hljs-number">2</span>, y**<span class="hljs-number">3</span>]<font></font>
<font></font>
<span class="hljs-comment"># Share a subexpression between a comprehension filter clause and its output</span>
filtered_data = [y <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> data <span class="hljs-keyword">if</span> (y := f(x)) <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>]</code></pre><br>
<a name="iskluch"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Casos excepcionais</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem v√°rios locais em que express√µes de atribui√ß√£o n√£o s√£o permitidas para evitar ambiguidade ou confus√£o entre os usu√°rios:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Express√µes de atribui√ß√£o que n√£o est√£o entre par√™nteses s√£o proibidas no n√≠vel "superior":</font></font><br>
<br>
<pre><code class="python hljs">y := f(x)  <span class="hljs-comment"># </span>
(y := f(x))  <span class="hljs-comment"># ,   </span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa regra facilitar√° ao programador escolher entre um operador de atribui√ß√£o e uma express√£o de atribui√ß√£o - n√£o haver√° situa√ß√£o sint√°tica na qual as duas op√ß√µes sejam equivalentes.</font></font></li>
<li>           . :<br>
<br>
<pre><code class="python hljs">y0 = y1 := f(x)  <span class="hljs-comment"># </span>
y0 = (y1 := f(x))  <span class="hljs-comment"># ,   </span></code></pre><br>
             . :<br>
<br>
<pre><code class="python hljs">foo(x = y := f(x))  <span class="hljs-comment"># </span>
foo(x=(y := f(x)))  <span class="hljs-comment"># ,     </span></code></pre><br>
 ,               .</li>
<li>           . :<br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>(<span class="hljs-params">answer = p := <span class="hljs-number">42</span></span>):</span>  <span class="hljs-comment"># </span><font></font>
    ...<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>(<span class="hljs-params">answer=(<span class="hljs-params">p := <span class="hljs-number">42</span></span>)</span>):</span>  <span class="hljs-comment"># Valid, though not great style</span>
    ...</code></pre><br>
        ,           (.    ,     ¬´¬ª     ).</li>
<li>           ,    . :<br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>(<span class="hljs-params">answer: p := <span class="hljs-number">42</span> = <span class="hljs-number">5</span></span>):</span>  <span class="hljs-comment"># </span><font></font>
    ...<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>(<span class="hljs-params">answer: (<span class="hljs-params">p := <span class="hljs-number">42</span></span>) = <span class="hljs-number">5</span></span>):</span>  <span class="hljs-comment"># ,  </span>
    ...</code></pre><br>
       : ,     "="  ":="   .</li>
<li>        -. :<br>
<br>
<pre><code class="python hljs">(<span class="hljs-keyword">lambda</span>: x := <span class="hljs-number">1</span>) <span class="hljs-comment"># </span>
<span class="hljs-keyword">lambda</span>: (x := <span class="hljs-number">1</span>) <span class="hljs-comment"># ,  </span>
(x := <span class="hljs-keyword">lambda</span>: <span class="hljs-number">1</span>) <span class="hljs-comment"># </span>
<span class="hljs-keyword">lambda</span> line: (m := re.match(pattern, line)) <span class="hljs-keyword">and</span> m.group(<span class="hljs-number">1</span>) <span class="hljs-comment"># Valid</span></code></pre><br>
-    ,  ":=".       .  ,     ,    ()  ,         .</li>
<li>   f-  . :<br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">f'<span class="hljs-subst">{(x:=<span class="hljs-number">10</span>)}</span>'</span>  <span class="hljs-comment"># ,  </span>
<span class="hljs-string">'10'</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>x = <span class="hljs-number">10</span>
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">f'<span class="hljs-subst">{x:=<span class="hljs-number">10</span>}</span>'</span>    <span class="hljs-comment"># ,  ,  '=10'</span>
<span class="hljs-string">'        10'</span></code></pre><br>
 ,    ,     f-,  .  f-   ":"    .    ,      f-      .     ,      .</li>
</ul><br>
<h3> </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma express√£o de atribui√ß√£o n√£o introduz um novo escopo. Na maioria dos casos, o escopo no qual a vari√°vel ser√° criada n√£o requer explica√ß√£o: ser√° atual. Se a vari√°vel usou as palavras-chave n√£o locais ou globais antes, a express√£o de atribui√ß√£o levar√° isso em considera√ß√£o. Somente lambda (sendo uma defini√ß√£o an√¥nima de uma fun√ß√£o) √© considerado um escopo separado para esses fins. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° um caso especial: uma express√£o de atribui√ß√£o que ocorre em geradores de listas, conjuntos, dicion√°rios ou nas pr√≥prias "express√µes de geradores" (doravante denominadas coletivamente como "geradores" (compreens√µes)) vincula a vari√°vel ao escopo que o gerador cont√©m, observando o modificador globab ou n√£o global, se existir.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A l√≥gica desse caso especial √© dupla. </font><font style="vertical-align: inherit;">Em primeiro lugar, permite capturar convenientemente o "membro" nas express√µes any () e all (), por exemplo:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> any((comment := line).startswith(<span class="hljs-string">'#'</span>) <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines):<font></font>
    print(<span class="hljs-string">"First comment:"</span>, comment)
<span class="hljs-keyword">else</span>:<font></font>
    print(<span class="hljs-string">"There are no comments"</span>)<font></font>
<font></font>
<span class="hljs-keyword">if</span> all((nonblank := line).strip() == <span class="hljs-string">''</span> <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines):<font></font>
    print(<span class="hljs-string">"All lines are blank"</span>)
<span class="hljs-keyword">else</span>:<font></font>
    print(<span class="hljs-string">"First non-blank line:"</span>, nonblank)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em segundo lugar, fornece uma maneira compacta de atualizar uma vari√°vel de um gerador, por exemplo:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># Compute partial sums in a list comprehension</span>
total = <span class="hljs-number">0</span>
partial_sums = [total := total + v <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> values]<font></font>
print(<span class="hljs-string">"Total:"</span>, total)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, o nome da vari√°vel da express√£o de atribui√ß√£o n√£o pode corresponder ao nome j√° usado nos geradores pelo loop for para iterar. </font><font style="vertical-align: inherit;">Os sobrenomes s√£o locais para o gerador em que aparecem. </font><font style="vertical-align: inherit;">Seria inconsistente se as express√µes de atribui√ß√£o tamb√©m se referissem ao escopo dentro do gerador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, [i: = i + 1 para i no intervalo (5)] n√£o √© v√°lido: o loop for determina que i √© local para o gerador, mas a parte ‚Äúi: = i + 1‚Äù insiste que i √© uma vari√°vel do externo escopo </font><font style="vertical-align: inherit;">Pelo mesmo motivo, os seguintes exemplos n√£o funcionar√£o:</font></font><br>
<br>
<pre><code class="python hljs">
[[(j := j) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)] <span class="hljs-comment"># </span>
[i := <span class="hljs-number">0</span> <span class="hljs-keyword">for</span> i, j <span class="hljs-keyword">in</span> stuff]                       <span class="hljs-comment"># </span>
[i+<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> (i := stuff)]                      <span class="hljs-comment"># </span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Embora seja tecnicamente poss√≠vel atribuir sem√¢ntica consistente para esses casos, √© dif√≠cil determinar se a maneira como entendemos essa sem√¢ntica funcionar√° em seu c√≥digo real. √â por isso que a implementa√ß√£o de refer√™ncia garante que esses casos aumentem o SyntaxError em vez de serem executados com um comportamento indefinido, dependendo da implementa√ß√£o espec√≠fica do hardware. Esta restri√ß√£o se aplica mesmo que uma express√£o de atribui√ß√£o nunca seja executada:</font></font><br>
<br>
<pre><code class="python hljs">[<span class="hljs-literal">False</span> <span class="hljs-keyword">and</span> (i := <span class="hljs-number">0</span>) <span class="hljs-keyword">for</span> i, j <span class="hljs-keyword">in</span> stuff]     <span class="hljs-comment"># </span>
[i <span class="hljs-keyword">for</span> i, j <span class="hljs-keyword">in</span> stuff <span class="hljs-keyword">if</span> <span class="hljs-literal">True</span> <span class="hljs-keyword">or</span> (j := <span class="hljs-number">1</span>)]  <span class="hljs-comment"># </span><font></font>
<font></font>
<span class="hljs-comment"># [.  . - ""   </span>
<span class="hljs-comment"># ,       </span>
<span class="hljs-comment"># ,    ,   ]</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para o corpo do gerador (a parte antes da primeira palavra-chave ‚Äúfor‚Äù) e a express√£o do filtro (a parte ap√≥s o ‚Äúif‚Äù e antes de qualquer ‚Äúfor‚Äù aninhado), essa restri√ß√£o se aplica exclusivamente a nomes de vari√°veis ‚Äã‚Äãque s√£o simultaneamente usados ‚Äã‚Äãcomo vari√°veis ‚Äã‚Äãiterativas. Como j√° dissemos, as express√µes Lambda introduzem um novo escopo expl√≠cito da fun√ß√£o e, portanto, podem ser usadas em express√µes de geradores sem restri√ß√µes adicionais. [Aproximadamente. novamente, exceto nesses casos: [i para i no intervalo (2, (lambda: (s: = 2) ()))]]</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Devido a limita√ß√µes de design na implementa√ß√£o de refer√™ncia (o analisador de tabela de s√≠mbolos n√£o pode reconhecer se os nomes da parte esquerda do gerador s√£o usados ‚Äã‚Äãna parte restante em que a express√£o iter√°vel est√° localizada), portanto, as express√µes de atribui√ß√£o s√£o completamente proibidas como parte da iter√°vel (na parte ap√≥s cada "entrada" e antes de qualquer palavra-chave subsequente "se" ou "para"). </font><font style="vertical-align: inherit;">Ou seja, todos esses casos s√£o inaceit√°veis:</font></font><br>
<br>
<pre><code class="python hljs">[i+<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> (j := stuff)]                    <span class="hljs-comment"># </span>
[i+<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> (k := stuff)]  <span class="hljs-comment"># </span>
[i+<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [j <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> (k := stuff)]]       <span class="hljs-comment"># </span>
[i+<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> (<span class="hljs-keyword">lambda</span>: (j := stuff))()]        <span class="hljs-comment"># </span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outra exce√ß√£o ocorre quando uma express√£o de atribui√ß√£o √© usada em geradores que est√£o no escopo de uma classe. </font><font style="vertical-align: inherit;">Se, ao usar as regras acima, ocorrer a cria√ß√£o de uma classe medida novamente no escopo, essa express√£o de atribui√ß√£o ser√° inv√°lida e resultar√° em um SyntaxError:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Example</span>:</span>
    [(j := i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)]  <span class="hljs-comment"># </span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(O motivo da √∫ltima exce√ß√£o √© o escopo impl√≠cito da fun√ß√£o criada pelo gerador - atualmente n√£o h√° mecanismo de tempo de execu√ß√£o para as fun√ß√µes se referirem a uma vari√°vel localizada no escopo da classe e n√£o queremos adicionar esse mecanismo. Se esse problema for resolvido, esse caso especial (possivelmente) ser√° removido da especifica√ß√£o das express√µes de atribui√ß√£o.Por favor, observe que esse problema ocorrer√° mesmo que voc√™ tenha criado uma vari√°vel anteriormente no escopo da classe e tente alter√°-la com uma express√£o de atribui√ß√£o do gerador.) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consulte o Ap√™ndice B para obter exemplos de como express√µes de atribui√ß√£o encontradas em geradores s√£o convertidas em c√≥digo equivalente.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prioridade relativa: =</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O operador: = √© agrupado mais forte que a v√≠rgula em todas as posi√ß√µes sint√°ticas, sempre que poss√≠vel, mas mais fraco que todos os outros operadores, incluindo ou, e, e n√£o, e express√µes condicionais (A se C mais B). Como segue na se√ß√£o "Casos excepcionais" acima, as express√µes de atribui√ß√£o nunca funcionam no mesmo "n√≠vel" que a atribui√ß√£o cl√°ssica =. Se uma ordem diferente de opera√ß√µes for necess√°ria, use par√™nteses. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O operador: = pode ser usado diretamente ao chamar o argumento posicional de uma fun√ß√£o. No entanto, isso n√£o funcionar√° diretamente no argumento. Alguns exemplos que esclarecem o que √© tecnicamente permitido e o que n√£o √© poss√≠vel:</font></font><br>
<br>
<pre><code class="python hljs">x := <span class="hljs-number">0</span> <span class="hljs-comment"># </span><font></font>
<font></font>
(x := <span class="hljs-number">0</span>) <span class="hljs-comment">#  </span><font></font>
<font></font>
x = y := <span class="hljs-number">0</span> <span class="hljs-comment"># </span><font></font>
<font></font>
x = (y := <span class="hljs-number">0</span>) <span class="hljs-comment">#  </span><font></font>
<font></font>
len(lines := f.readlines()) <span class="hljs-comment"># </span><font></font>
<font></font>
foo(x := <span class="hljs-number">3</span>, cat=<span class="hljs-string">'vector'</span>) <span class="hljs-comment"># </span><font></font>
<font></font>
foo(cat=category := <span class="hljs-string">'vector'</span>) <span class="hljs-comment"># </span><font></font>
<font></font>
foo(cat=(category := <span class="hljs-string">'vector'</span>)) <span class="hljs-comment">#  </span></code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A maioria dos exemplos "v√°lidos" acima n√£o √© recomendada para uso na pr√°tica, pois as pessoas que escanearam rapidamente o seu c√≥digo-fonte podem n√£o entender corretamente seu significado. </font><font style="vertical-align: inherit;">Mas, em casos simples, isso √© permitido:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># Valid</span>
<span class="hljs-keyword">if</span> any(len(longline := line) &gt;= <span class="hljs-number">100</span> <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines):<font></font>
    print(<span class="hljs-string">"Extremely long line:"</span>, longline)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este PEP recomenda que voc√™ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sempre</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> coloque espa√ßos em torno de: =, semelhante √† recomenda√ß√£o do PEP 8 para = para tarefas cl√°ssicas. </font><font style="vertical-align: inherit;">(A diferen√ßa da √∫ltima recomenda√ß√£o √© que ela pro√≠be espa√ßos em torno de =, que √© usado para passar argumentos principais para a fun√ß√£o.)</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mude a ordem dos c√°lculos.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ter uma sem√¢ntica bem definida, este acordo exige que o procedimento de avalia√ß√£o seja claramente definido. </font><font style="vertical-align: inherit;">Tecnicamente, esse n√£o √© um requisito novo. </font><font style="vertical-align: inherit;">O Python j√° possui uma regra de que subexpress√µes geralmente s√£o avaliadas da esquerda para a direita. </font><font style="vertical-align: inherit;">No entanto, as express√µes de atribui√ß√£o tornam esses "efeitos colaterais" mais vis√≠veis, e propomos uma altera√ß√£o na ordem de c√°lculo atual:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nos geradores de dicion√°rio {X: Y para ...}, Y √© atualmente avaliado antes de X. Sugerimos alterar isso para que X seja calculado antes de Y. (Em um ditado cl√°ssico como {X: Y} e tamb√©m em dict ((X, Y) para ...) isso j√° foi implementado. Portanto, os geradores de dicion√°rio devem cumprir esse mecanismo)</font></font></li>
</ul><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diferen√ßas entre express√µes de atribui√ß√£o e instru√ß√µes de atribui√ß√£o.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais importante, ": =" √© uma </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">express√£o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o que significa que pode ser usada nos casos em que as </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instru√ß√µes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o </font><b><font style="vertical-align: inherit;">s√£o</font></b><font style="vertical-align: inherit;"> v√°lidas, incluindo fun√ß√µes e geradores lambda. </font><font style="vertical-align: inherit;">Por outro lado, as </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">express√µes de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atribui√ß√£o n√£o suportam a funcionalidade estendida que pode ser usada nas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instru√ß√µes de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atribui√ß√£o:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A atribui√ß√£o em cascata n√£o √© suportada diretamente</font></font><br>
<br>
<pre><code class="python hljs">x = y = z = <span class="hljs-number">0</span>  <span class="hljs-comment"># Equivalent: (z := (y := (x := 0)))</span></code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Destinos" separados, exceto o nome da vari√°vel simples NAME, n√£o s√£o suportados:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># No equivalent</span><font></font>
a[i] = x<font></font>
self.rest = []</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A funcionalidade e as v√≠rgulas priorit√°rias diferem:</font></font><br>
<br>
<pre><code class="python hljs">x = <span class="hljs-number">1</span>, <span class="hljs-number">2</span>  <span class="hljs-comment"># Sets x to (1, 2)</span>
(x := <span class="hljs-number">1</span>, <span class="hljs-number">2</span>)  <span class="hljs-comment"># Sets x to 1</span></code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os valores de desempacotamento e empacotamento n√£o t√™m equival√™ncia "pura" ou n√£o s√£o totalmente suportados</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># Equivalent needs extra parentheses</span>
loc = x, y  <span class="hljs-comment"># Use (loc := (x, y))</span>
info = name, phone, *rest  <span class="hljs-comment"># Use (info := (name, phone, *rest))</span><font></font>
<font></font>
<span class="hljs-comment"># No equivalent</span><font></font>
px, py, pz = position<font></font>
name, phone, email, *other_info = contact</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As anota√ß√µes do tipo embutido n√£o s√£o suportadas:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># Closest equivalent is "p: Optional[int]" as a separate declaration</span>
p: Optional[int] = <span class="hljs-literal">None</span></code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o h√° forma abreviada de opera√ß√µes:</font></font><br>
<br>
<pre><code class="python hljs">total += tax  <span class="hljs-comment"># Equivalent: (total := total + tax)</span></code></pre></li>
</ul><br>
<a name="cpec"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Altera√ß√µes nas especifica√ß√µes durante a implementa√ß√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As seguintes altera√ß√µes foram feitas com base em nossa experi√™ncia e an√°lises adicionais ap√≥s a primeira grava√ß√£o deste PEP e antes do lan√ßamento do Python 3.8:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para garantir consist√™ncia com outras exce√ß√µes semelhantes e n√£o introduzir um novo nome que pode n√£o ser conveniente para os usu√°rios finais, a subclasse originalmente proposta de TargetScopeError para SyntaxError foi removida e reduzida ao SyntaxError usual. </font><font style="vertical-align: inherit;">[3]</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Devido a limita√ß√µes na an√°lise da tabela de caracteres CPython, a implementa√ß√£o de refer√™ncia da express√£o de atribui√ß√£o gera um SyntaxError para todos os usos nos iteradores. </font><font style="vertical-align: inherit;">Anteriormente, essa exce√ß√£o ocorria apenas se o nome da vari√°vel que estava sendo criada coincidisse com o j√° usado na express√£o iterativa. </font><font style="vertical-align: inherit;">Isso pode ser revisado se houver exemplos suficientemente convincentes, mas a complexidade adicional parece inadequada para casos de uso puramente "hipot√©ticos".</font></font></li>
</ul><br>
<a name="prim"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplos</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplos de biblioteca padr√£o do Python</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">site.py</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
env_base √© usado apenas em uma condi√ß√£o, portanto a atribui√ß√£o pode ser colocada em if, como o "cabe√ßalho" de um bloco l√≥gico.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo atual:</font></font><br>
<pre><code class="python hljs">env_base = os.environ.get(<span class="hljs-string">"PYTHONUSERBASE"</span>, <span class="hljs-literal">None</span>)
<span class="hljs-keyword">if</span> env_base:
    <span class="hljs-keyword">return</span> env_base</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo aprimorado:</font></font><br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> env_base := os.environ.get(<span class="hljs-string">"PYTHONUSERBASE"</span>, <span class="hljs-literal">None</span>):
    <span class="hljs-keyword">return</span> env_base</code></pre></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_pydecimal.py</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode evitar ifs aninhados, removendo um n√≠vel de recuo.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo atual:</font></font><br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> self._is_special:<font></font>
    ans = self._check_nans(context=context)<font></font>
    <span class="hljs-keyword">if</span> ans:
        <span class="hljs-keyword">return</span> ans</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo aprimorado:</font></font><br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> self._is_special <span class="hljs-keyword">and</span> (ans := self._check_nans(context=context)):
    <span class="hljs-keyword">return</span> ans</code></pre></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">copy.py</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O c√≥digo parece mais cl√°ssico e tamb√©m evita o aninhamento m√∫ltiplo de instru√ß√µes condicionais. </font><font style="vertical-align: inherit;">(Consulte o Ap√™ndice A para saber mais sobre a origem deste exemplo.)</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo atual:</font></font><br>
<pre><code class="python hljs">reductor = dispatch_table.get(cls)
<span class="hljs-keyword">if</span> reductor:<font></font>
    rv = reductor(x)<font></font>
<span class="hljs-keyword">else</span>:<font></font>
    reductor = getattr(x, <span class="hljs-string">"__reduce_ex__"</span>, <span class="hljs-literal">None</span>)
    <span class="hljs-keyword">if</span> reductor:<font></font>
        rv = reductor(<span class="hljs-number">4</span>)
    <span class="hljs-keyword">else</span>:<font></font>
        reductor = getattr(x, <span class="hljs-string">"__reduce__"</span>, <span class="hljs-literal">None</span>)
        <span class="hljs-keyword">if</span> reductor:<font></font>
            rv = reductor()<font></font>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">raise</span> Error(
                <span class="hljs-string">"un(deep)copyable object of type %s"</span> % cls)</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo aprimorado:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> reductor := dispatch_table.get(cls):<font></font>
    rv = reductor(x)<font></font>
<span class="hljs-keyword">elif</span> reductor := getattr(x, <span class="hljs-string">"__reduce_ex__"</span>, <span class="hljs-literal">None</span>):<font></font>
    rv = reductor(<span class="hljs-number">4</span>)
<span class="hljs-keyword">elif</span> reductor := getattr(x, <span class="hljs-string">"__reduce__"</span>, <span class="hljs-literal">None</span>):<font></font>
    rv = reductor()<font></font>
<span class="hljs-keyword">else</span>:
    <span class="hljs-keyword">raise</span> Error(<span class="hljs-string">"un(deep)copyable object of type %s"</span> % cls)</code></pre></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">datetime.py</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tz √© usado apenas para s + = tz. </font><font style="vertical-align: inherit;">Mover para dentro se ajuda a mostrar sua √°rea l√≥gica de uso.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo atual:</font></font><br>
<br>
<pre><code class="python hljs">s = _format_time(self._hour, self._minute,<font></font>
                 self._second, self._microsecond,<font></font>
                 timespec)<font></font>
tz = self._tzstr()<font></font>
<span class="hljs-keyword">if</span> tz:<font></font>
    s += tz<font></font>
<span class="hljs-keyword">return</span> s</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo aprimorado:</font></font><br>
<br>
<pre><code class="python hljs">s = _format_time(self._hour, self._minute,<font></font>
                 self._second, self._microsecond,<font></font>
                 timespec)<font></font>
<span class="hljs-keyword">if</span> tz := self._tzstr():<font></font>
    s += tz<font></font>
<span class="hljs-keyword">return</span> s</code></pre></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sysconfig.py</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chamar fp.readline () como uma ‚Äúcondi√ß√£o‚Äù no loop while (assim como chamar o m√©todo .match ()) na condi√ß√£o if torna o c√≥digo mais compacto sem complicar sua compreens√£o.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo atual:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<font></font>
    line = fp.readline()<font></font>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> line:
        <span class="hljs-keyword">break</span><font></font>
    m = define_rx.match(line)<font></font>
    <span class="hljs-keyword">if</span> m:<font></font>
        n, v = m.group(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)
        <span class="hljs-keyword">try</span>:<font></font>
            v = int(v)<font></font>
        <span class="hljs-keyword">except</span> ValueError:
            <span class="hljs-keyword">pass</span><font></font>
        vars[n] = v<font></font>
    <span class="hljs-keyword">else</span>:<font></font>
        m = undef_rx.match(line)<font></font>
        <span class="hljs-keyword">if</span> m:<font></font>
            vars[m.group(<span class="hljs-number">1</span>)] = <span class="hljs-number">0</span></code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo aprimorado:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">while</span> line := fp.readline():
    <span class="hljs-keyword">if</span> m := define_rx.match(line):<font></font>
        n, v = m.group(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)
        <span class="hljs-keyword">try</span>:<font></font>
            v = int(v)<font></font>
        <span class="hljs-keyword">except</span> ValueError:
            <span class="hljs-keyword">pass</span><font></font>
        vars[n] = v<font></font>
    <span class="hljs-keyword">elif</span> m := undef_rx.match(line):<font></font>
        vars[m.group(<span class="hljs-number">1</span>)] = <span class="hljs-number">0</span></code></pre></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simplificar geradores de listas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, o gerador de lista pode ser filtrado efetivamente "capturando" a condi√ß√£o:</font></font><br>
<br>
<pre><code class="python hljs">results = [(x, y, x/y) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> input_data <span class="hljs-keyword">if</span> (y := f(x)) &gt; <span class="hljs-number">0</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois disso, a vari√°vel pode ser reutilizada em outra express√£o:</font></font><br>
<br>
<pre><code class="python hljs">stuff = [[y := f(x), x/y] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe novamente que, nos dois casos, a vari√°vel </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est√° no mesmo escopo que as vari√°veis ‚Äã‚Äãresultam e outras coisas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capturar valores em condi√ß√µes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As express√µes de atribui√ß√£o podem ser efetivamente usadas nas condi√ß√µes de uma instru√ß√£o if ou while:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># Loop-and-a-half</span>
<span class="hljs-keyword">while</span> (command := input(<span class="hljs-string">"&gt; "</span>)) != <span class="hljs-string">"quit"</span>:<font></font>
    print(<span class="hljs-string">"You entered:"</span>, command)<font></font>
<font></font>
<span class="hljs-comment"># Capturing regular expression match objects</span>
<span class="hljs-comment"># See, for instance, Lib/pydoc.py, which uses a multiline spelling</span>
<span class="hljs-comment"># of this effect</span>
<span class="hljs-keyword">if</span> match := re.search(pat, text):<font></font>
    print(<span class="hljs-string">"Found:"</span>, match.group(<span class="hljs-number">0</span>))
<span class="hljs-comment"># The same syntax chains nicely into 'elif' statements, unlike the</span>
<span class="hljs-comment"># equivalent using assignment statements.</span>
<span class="hljs-keyword">elif</span> match := re.search(otherpat, text):<font></font>
    print(<span class="hljs-string">"Alternate found:"</span>, match.group(<span class="hljs-number">0</span>))
<span class="hljs-keyword">elif</span> match := re.search(third, text):<font></font>
    print(<span class="hljs-string">"Fallback found:"</span>, match.group(<span class="hljs-number">0</span>))<font></font>
<font></font>
<span class="hljs-comment"># Reading socket data until an empty string is returned</span>
<span class="hljs-keyword">while</span> data := sock.recv(<span class="hljs-number">8192</span>):<font></font>
    print(<span class="hljs-string">"Received data:"</span>, data)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em particular, essa abordagem pode eliminar a necessidade de criar um loop infinito, atribui√ß√£o e verifica√ß√£o de condi√ß√µes. </font><font style="vertical-align: inherit;">Tamb√©m permite desenhar um paralelo suave entre um ciclo que usa uma chamada de fun√ß√£o como sua condi√ß√£o, bem como um ciclo que n√£o apenas verifica a condi√ß√£o, mas tamb√©m usa o valor real retornado pela fun√ß√£o no futuro.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Garfo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um exemplo do mundo de baixo n√≠vel do UNIX: [aprox. </font><font style="vertical-align: inherit;">Fork () √© uma chamada de sistema em sistemas operacionais semelhantes ao Unix que cria um novo subprocesso em rela√ß√£o ao pai.]</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> pid := os.fork():
    <span class="hljs-comment"># Parent code</span>
<span class="hljs-keyword">else</span>:
    <span class="hljs-comment"># Child code</span></code></pre><br>
<a name="otklon"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alternativas rejeitadas</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, sugest√µes semelhantes s√£o bastante comuns na comunidade python. </font><font style="vertical-align: inherit;">Abaixo est√£o algumas sintaxes alternativas para express√µes de atribui√ß√£o que s√£o espec√≠ficas demais para entender e foram rejeitadas em favor do acima.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alterando o escopo para geradores</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em uma vers√£o anterior deste PEP, foi proposto fazer altera√ß√µes sutis nas regras de escopo dos geradores para torn√°-los mais adequados para uso no escopo das classes. </font><font style="vertical-align: inherit;">No entanto, essas propostas levariam a incompatibilidade com vers√µes anteriores e, portanto, foram rejeitadas. </font><font style="vertical-align: inherit;">Portanto, esse PEP foi capaz de se concentrar totalmente apenas nas express√µes de atribui√ß√£o.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ortografia alternativa</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, as express√µes de atribui√ß√£o propostas t√™m a mesma sem√¢ntica, mas s√£o escritas de maneira diferente.</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPR como NAME:</font></font><br>
<br>
<pre><code class="python hljs">stuff = [[f(x) <span class="hljs-keyword">as</span> y, x/y] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)]</code></pre><br>
   EXPR as NAME       import, except  with,         (,       ).<br>
<br>
( ,  ¬´with EXPR as VAR¬ª     EXPR  VAR,   EXPR.__enter__()        VAR.)<br>
<br>
 ,   ":="   :<br>
<ul>
<li>  ,  <b>if f(x) as y</b>     ,    ‚Äã‚Äã   <b>if f x blah-blah</b>,        <b>if f(x) and y</b>.</li>
<li>   ,  <b>as</b> ,           ,     : <ul>
<li>import foo as bar</li>
<li>except Exc as var</li>
<li>with ctxmgr() as var</li>
</ul><br>
 , <b>as</b>     if  while     ,   <b>as</b>  ¬´ ¬ª   .</li>
<li>  ¬´¬ª  <ul>
<li>NAME = EXPR</li>
<li>if NAME := EXPR</li>
</ul><br>
     .</li>
</ul></li>
<li>EXPR -&gt; NAME<br>
<br>
<pre><code class="python hljs">stuff = [[f(x) -&gt; y, x/y] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)]</code></pre><br>
     ,  R  Haskell,     . ( ,    - <b>y &lt; ‚Äî f (x) </b>   Python,      -   .)       ¬´as¬ª   ,      import, except  with,      .             Python (    ),      ":=" (   Algol-58)     .</li>
<li>  ¬´¬ª    <br>
<br>
<pre><code class="python hljs">stuff = [[(f(x) <span class="hljs-keyword">as</span> .y), x/.y] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)] <span class="hljs-comment"># with "as"</span>
stuff = [[(.y := f(x)), x/.y] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)] <span class="hljs-comment"># with ":="</span></code></pre><br>
         .         Python,        ,   .</li>
<li> where:       :<br>
<br>
<pre><code class="python hljs">value = x**<span class="hljs-number">2</span> + <span class="hljs-number">2</span>*x where:<font></font>
    x = spam(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">7</span>, q)</code></pre><br>
   (    ,     ¬´¬ª).      ,   ¬´¬ª  (  with:). . PEP 3150,      (    <i>given:</i> ).</li>
<li>TARGET from EXPR:<br>
<br>
<pre><code class="python hljs">stuff = [[y <span class="hljs-keyword">from</span> f(x), x/y] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â mais prov√°vel que essa sintaxe entre em conflito com os outros do que </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (a menos que voc√™ conte o aumento de Exc das constru√ß√µes Exc), mas, caso contr√°rio, ser√° compar√°vel a eles. </font><font style="vertical-align: inherit;">Em vez de um paralelo com expr como target: (o que pode ser √∫til, mas tamb√©m pode ser confuso), essa op√ß√£o n√£o tem paralelos com nada, mas √© surpreendentemente melhor lembrada.</font></font></li>
</ol><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Casos especiais em declara√ß√µes condicionais</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dos casos de uso mais comuns para express√µes de atribui√ß√£o s√£o as instru√ß√µes if e while. </font><font style="vertical-align: inherit;">Em vez de uma solu√ß√£o mais geral, o uso de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> melhora a sintaxe dessas duas instru√ß√µes adicionando um meio de capturar o valor a ser comparado:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> re.search(pat, text) <span class="hljs-keyword">as</span> match:<font></font>
    print(<span class="hljs-string">"Found:"</span>, match.group(<span class="hljs-number">0</span>))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso funciona bem, mas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SOMENTE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> quando a condi√ß√£o desejada √© baseada na "corre√ß√£o" do valor de retorno. </font><font style="vertical-align: inherit;">Portanto, esse m√©todo √© eficaz para casos espec√≠ficos (verifica√ß√£o de express√µes regulares, leitura de soquetes, retorno de uma string vazia quando a execu√ß√£o termina) e √© completamente in√∫til em casos mais complexos (por exemplo, quando a condi√ß√£o √© f (x) &lt;0 e voc√™ deseja salve o valor de f (x)). </font><font style="vertical-align: inherit;">Al√©m disso, isso n√£o faz sentido nos geradores de lista. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vantagens</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Sem ambig√ºidades sint√°ticas. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desvantagens</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : mesmo se voc√™ o usar apenas nas declara√ß√µes if / while, ele s√≥ funcionar√° bem em alguns casos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Casos especiais em geradores</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outro caso de uso comum para express√µes de atribui√ß√£o s√£o geradores (lista / conjunto / dict e genexps). </font><font style="vertical-align: inherit;">Como acima, foram feitas sugest√µes para solu√ß√µes espec√≠ficas.</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">onde, let ou dado:</font></font><br>
<br>
<pre><code class="python hljs">stuff = [(y, x/y) where y = f(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)]<font></font>
stuff = [(y, x/y) let y = f(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)]<font></font>
stuff = [(y, x/y) given y = f(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse m√©todo resulta em uma subexpress√£o entre o loop for e a express√£o principal. </font><font style="vertical-align: inherit;">Ele tamb√©m apresenta uma palavra-chave de idioma adicional, que pode criar conflitos. </font><font style="vertical-align: inherit;">Das tr√™s op√ß√µes, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">onde</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© a mais limpa e a mais leg√≠vel, mas ainda existem conflitos em potencial (por exemplo, SQLAlchemy e numpy t√™m seus m√©todos where, al√©m de tkinter.dnd.Icon na biblioteca padr√£o).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com NAME = EXPR:</font></font><br>
<br>
<pre><code class="python hljs">stuff = [(y, x/y) <span class="hljs-keyword">with</span> y = f(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)]</code></pre><br>
  ,     ,     <b>with</b>.         .   ,           ¬´¬ª  for.    C,         ,    .   : ¬´  ¬´with NAME = EXPR:¬ª       ,   ?¬ª</li>
<li>with EXPR as NAME:<br>
<br>
<pre><code class="python hljs">stuff = [(y, x/y) <span class="hljs-keyword">with</span> f(x) <span class="hljs-keyword">as</span> y <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)]</code></pre><br>
   ,    <b>as</b>,    .       ,        for.      with          </li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Independentemente do m√©todo escolhido, uma diferen√ßa sem√¢ntica acentuada ser√° introduzida entre geradores e suas vers√µes implementadas por meio de um loop for. </font><font style="vertical-align: inherit;">Seria imposs√≠vel envolver o ciclo em um gerador sem processar o est√°gio de cria√ß√£o das vari√°veis. </font><font style="vertical-align: inherit;">A √∫nica palavra-chave que pode ser reorientada para esta tarefa √© a palavra </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mas isso fornecer√° sem√¢nticas diferentes em diferentes partes do c√≥digo, o que significa que voc√™ precisa criar uma nova palavra-chave, mas isso envolve muitos custos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menor prioridade do operador</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O operador: = tem duas prioridades l√≥gicas. Ou deve ter a menor prioridade poss√≠vel (a par do operador de atribui√ß√£o). Ou deve ter preced√™ncia maior que os operadores de compara√ß√£o. Colocar sua prioridade entre operadores de compara√ß√£o e opera√ß√µes aritm√©ticas (para ser preciso: um pouco menor que o OR bit a bit) permitir√° que voc√™ fique sem par√™nteses na maioria dos casos, quando e se voc√™ o usar, pois √© mais prov√°vel que voc√™ deseje manter o valor de algo antes como a compara√ß√£o ser√° realizada:</font></font><br>
<br>
<pre><code class="python hljs">pos = <span class="hljs-number">-1</span>
<span class="hljs-keyword">while</span> pos := buffer.find(search_term, pos + <span class="hljs-number">1</span>) &gt;= <span class="hljs-number">0</span>:<font></font>
    ...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim que find () retorna -1, o loop termina. </font><font style="vertical-align: inherit;">Se: = liga os operandos t√£o livremente quanto =, ent√£o o resultado de find () ser√° ‚Äúcapturado‚Äù primeiro no operador de compara√ß√£o e geralmente retornar√° True ou False, o que √© menos √∫til. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Embora esse comportamento seja conveniente na pr√°tica em muitas situa√ß√µes, seria mais dif√≠cil de explicar. </font><font style="vertical-align: inherit;">E, portanto, podemos dizer que "o operador: = se comporta da mesma forma que o operador de atribui√ß√£o usual". </font><font style="vertical-align: inherit;">Ou seja, a prioridade para: = foi escolhida o mais pr√≥ximo poss√≠vel do operador = (exceto que: = tem prioridade maior que a v√≠rgula).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ d√° v√≠rgulas √† direita</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alguns cr√≠ticos argumentam que as express√µes de atribui√ß√£o devem reconhecer tuplas sem a adi√ß√£o de colchetes, para que as duas entradas sejam equivalentes:</font></font><br>
<br>
<pre><code class="python hljs">(point := (x, y))<font></font>
(point := x, y)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Na vers√£o atual do padr√£o, o √∫ltimo registro ser√° equivalente √† express√£o ((ponto: = x), y).) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas √© l√≥gico que nesse cen√°rio, ao usar a express√£o de atribui√ß√£o na chamada de fun√ß√£o, ele tamb√©m tenha uma prioridade mais baixa que a v√≠rgula, portanto, obtivemos seria a seguinte equival√™ncia confusa:</font></font><br>
<br>
<pre><code class="python hljs">foo (x: = <span class="hljs-number">1</span>, y)<font></font>
foo (x: = (<span class="hljs-number">1</span>, y))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E temos a √∫nica sa√≠da menos confusa: torne o operador: = uma prioridade mais baixa que a v√≠rgula.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sempre exigindo suportes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sempre foi proposto agrupar as express√µes de atribui√ß√£o. </font><font style="vertical-align: inherit;">Isso nos salvaria muitas ambiguidades. </font><font style="vertical-align: inherit;">De fato, muitas vezes ser√£o necess√°rios par√™nteses para extrair o valor desejado. </font><font style="vertical-align: inherit;">Mas nos seguintes casos, a presen√ßa de colchetes nos pareceu claramente sup√©rflua:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># Top level in if</span>
<span class="hljs-keyword">if</span> match := pattern.match(line):
    <span class="hljs-keyword">return</span> match.group(<span class="hljs-number">1</span>)<font></font>
<font></font>
<span class="hljs-comment"># Short call</span>
len(lines := f.readlines())</code></pre><br>
<a name="chast"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obje√ß√µes frequentes</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por que n√£o transformar as declara√ß√µes de atribui√ß√£o em express√µes?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C e linguagens similares definem o operador </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como uma express√£o, n√£o uma instru√ß√£o, como o Python. </font><font style="vertical-align: inherit;">Isso permite a atribui√ß√£o em muitas situa√ß√µes, incluindo locais onde as vari√°veis ‚Äã‚Äãs√£o comparadas. </font><font style="vertical-align: inherit;">As semelhan√ßas sint√°ticas entre if (x == y) e if (x = y) contradizem sua sem√¢ntica nitidamente diferente. </font><font style="vertical-align: inherit;">Assim, este PEP apresenta o operador: = para esclarecer suas diferen√ßas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por que se preocupar com </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">express√µes de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atribui√ß√£o </font><font style="vertical-align: inherit;">se existem </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instru√ß√µes de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atribui√ß√£o?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essas duas formas t√™m flexibilidades diferentes. </font><font style="vertical-align: inherit;">O operador: = pode ser usado dentro de uma express√£o maior e no operador = pode ser usado pela "fam√≠lia de minioperadores" do tipo "+ =". </font><font style="vertical-align: inherit;">Tamb√©m = permite atribuir valores por atributos e √≠ndices.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por que n√£o usar o escopo local e evitar a polui√ß√£o do espa√ßo para nome?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As vers√µes anteriores deste padr√£o inclu√≠am um escopo local real (limitado a uma declara√ß√£o) para express√µes de atribui√ß√£o, impedindo o vazamento e a polui√ß√£o do espa√ßo para nome. </font><font style="vertical-align: inherit;">Apesar do fato de que em algumas situa√ß√µes isso deu uma certa vantagem, em muitas outras isso complica a tarefa, e os benef√≠cios n√£o s√£o justificados pelas vantagens da abordagem existente. </font><font style="vertical-align: inherit;">Isso √© feito no interesse da simplicidade da linguagem. </font><font style="vertical-align: inherit;">Voc√™ n√£o precisa mais dessa vari√°vel? </font><font style="vertical-align: inherit;">Existe uma solu√ß√£o: exclua a vari√°vel usando a palavra-chave del ou adicione um sublinhado menor ao seu nome. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(O autor gostaria de agradecer a Guido van Rossum e Christophe Groth por suas sugest√µes para avan√ßar o padr√£o PEP nessa dire√ß√£o. [2])</font></font><br>
<br>
<a name="rekom"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recomenda√ß√µes de estilo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como as express√µes de atribui√ß√£o √†s vezes podem ser usadas em p√© de igualdade com um operador de atribui√ß√£o, surge a pergunta: o que ainda √© preferido? .. De acordo com outras conven√ß√µes de estilo (como o PEP 8), h√° duas recomenda√ß√µes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ pode usar as duas op√ß√µes de atribui√ß√£o, d√™ prefer√™ncia aos operadores. </font><font style="vertical-align: inherit;">Eles expressam mais claramente suas inten√ß√µes.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o uso de express√µes de atribui√ß√£o levar a ambiguidade na ordem de execu√ß√£o, reescreva o c√≥digo usando o operador cl√°ssico.</font></font></li>
</ol><br>
<a name="blag"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obrigado</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os autores deste padr√£o gostariam de agradecer a Nick Coghlan e Steven D'Aprano por suas contribui√ß√µes significativas a este PEP, bem como aos membros do Python Core Mentorship por sua ajuda na implementa√ß√£o disso.</font></font><br>
<br>
<a name="prilA"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap√™ndice A: Conclus√µes de Tim Peters</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° um pequeno ensaio que Tim Peters escreveu sobre esse t√≥pico. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o gosto do c√≥digo "confuso" e tamb√©m n√£o gosto de colocar l√≥gica conceitualmente n√£o relacionada em uma linha. </font><font style="vertical-align: inherit;">Ent√£o, por exemplo, em vez de:</font></font><br>
<br>
<pre><code class="python hljs">i = j = count = nerrors = <span class="hljs-number">0</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu prefiro escrever:</font></font><br>
<br>
<pre><code class="python hljs">i = j = <span class="hljs-number">0</span>
count = <span class="hljs-number">0</span>
nerrors = <span class="hljs-number">0</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, acho que vou encontrar v√°rios lugares onde quero usar express√µes de atribui√ß√£o. </font><font style="vertical-align: inherit;">Eu nem quero falar sobre o uso deles em express√µes que j√° est√£o esticadas para metade da tela. </font><font style="vertical-align: inherit;">Em outros casos, comportamentos como:</font></font><br>
<br>
<pre><code class="python hljs">mylast = mylast[<span class="hljs-number">1</span>]
<span class="hljs-keyword">yield</span> mylast[<span class="hljs-number">0</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Significativamente melhor que isso:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">yield</span> (mylast := mylast[<span class="hljs-number">1</span>])[<span class="hljs-number">0</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esses dois c√≥digos t√™m conceitos completamente diferentes e mistur√°-los seria uma loucura. </font><font style="vertical-align: inherit;">Em outros casos, a combina√ß√£o de express√µes l√≥gicas complica a compreens√£o do c√≥digo. </font><font style="vertical-align: inherit;">Por exemplo, reescrevendo:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<font></font>
    old = total<font></font>
    total += term<font></font>
    <span class="hljs-keyword">if</span> old == total:
        <span class="hljs-keyword">return</span> total<font></font>
    term *= mx2 / (i*(i+<span class="hljs-number">1</span>))<font></font>
    i += <span class="hljs-number">2</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em uma forma mais curta, perdemos a "l√≥gica". </font><font style="vertical-align: inherit;">Voc√™ precisa entender como esse c√≥digo funciona. </font><font style="vertical-align: inherit;">Meu c√©rebro n√£o quer fazer isso:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">while</span> total != (total := total + term):<font></font>
    term *= mx2 / (i*(i+<span class="hljs-number">1</span>))<font></font>
    i += <span class="hljs-number">2</span>
<span class="hljs-keyword">return</span> total</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas esses casos s√£o raros. </font><font style="vertical-align: inherit;">A tarefa de preservar o resultado √© muito comum e ‚Äúescasso √© melhor que denso‚Äù n√£o significa que ‚Äúquase vazio √© melhor que escasso‚Äù [aprox. </font><font style="vertical-align: inherit;">uma refer√™ncia ao Zen Python]. </font><font style="vertical-align: inherit;">Por exemplo, tenho muitas fun√ß√µes que retornam None ou 0 para dizer "N√£o tenho nada √∫til, mas como isso acontece com frequ√™ncia, n√£o quero incomod√°-lo com exce√ß√µes". </font><font style="vertical-align: inherit;">De fato, esse mecanismo tamb√©m √© usado em express√µes regulares que retornam None quando n√£o h√° correspond√™ncias. </font><font style="vertical-align: inherit;">Portanto, neste exemplo, muito c√≥digo:</font></font><br>
<br>
<pre><code class="python hljs">result = solution(xs, n)
<span class="hljs-keyword">if</span> result:
    <span class="hljs-comment"># use result</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acho a seguinte op√ß√£o mais compreens√≠vel e, claro, mais leg√≠vel:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> result := solution(xs, n):
    <span class="hljs-comment"># use result</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No come√ßo, n√£o dei muita import√¢ncia a isso, mas uma constru√ß√£o t√£o curta apareceu com tanta frequ√™ncia que logo come√ßou a me irritar que eu n√£o podia us√°-la. </font><font style="vertical-align: inherit;">Isso me surpreendeu! </font><font style="vertical-align: inherit;">[Aproximadamente. </font><font style="vertical-align: inherit;">aparentemente, isso foi escrito antes do lan√ßamento oficial do Python 3.8.] </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° outros casos em que as express√µes de atribui√ß√£o realmente "disparam". </font><font style="vertical-align: inherit;">Em vez de vasculhar meu c√≥digo novamente, Kirill Balunov deu um bom exemplo da fun√ß√£o copy () da biblioteca copy.py padr√£o:</font></font><br>
<br>
<pre><code class="python hljs">reductor = dispatch_table.get(cls)
<span class="hljs-keyword">if</span> reductor:<font></font>
    rv = reductor(x)<font></font>
<span class="hljs-keyword">else</span>:<font></font>
    reductor = getattr(x, <span class="hljs-string">"__reduce_ex__"</span>, <span class="hljs-literal">None</span>)
    <span class="hljs-keyword">if</span> reductor:<font></font>
        rv = reductor(<span class="hljs-number">4</span>)
    <span class="hljs-keyword">else</span>:<font></font>
        reductor = getattr(x, <span class="hljs-string">"__reduce__"</span>, <span class="hljs-literal">None</span>)
        <span class="hljs-keyword">if</span> reductor:<font></font>
            rv = reductor()<font></font>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">raise</span> Error(<span class="hljs-string">"un(shallow)copyable object of type %s"</span> % cls)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A crescente indenta√ß√£o √© enganosa: afinal, a l√≥gica √© plana: o primeiro teste bem-sucedido ‚Äúvence‚Äù:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> reductor := dispatch_table.get(cls):<font></font>
    rv = reductor(x)<font></font>
<span class="hljs-keyword">elif</span> reductor := getattr(x, <span class="hljs-string">"__reduce_ex__"</span>, <span class="hljs-literal">None</span>):<font></font>
    rv = reductor(<span class="hljs-number">4</span>)
<span class="hljs-keyword">elif</span> reductor := getattr(x, <span class="hljs-string">"__reduce__"</span>, <span class="hljs-literal">None</span>):<font></font>
    rv = reductor()<font></font>
<span class="hljs-keyword">else</span>:
    <span class="hljs-keyword">raise</span> Error(<span class="hljs-string">"un(shallow)copyable object of type %s"</span> % cls)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O simples uso de express√µes de atribui√ß√£o permite que a estrutura visual do c√≥digo enfatize o "plano" da l√≥gica. </font><font style="vertical-align: inherit;">Mas o recuo sempre crescente o torna impl√≠cito. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° outro pequeno exemplo do meu c√≥digo, que me deixou muito feliz porque me permitiu colocar a l√≥gica relacionada internamente em uma linha e remover o irritante n√≠vel de indenta√ß√£o "artificial". </font><font style="vertical-align: inherit;">√â exatamente isso que eu quero da declara√ß√£o if e facilita a leitura. </font><font style="vertical-align: inherit;">O c√≥digo a seguir:</font></font><br>
<br>
<pre><code class="python hljs">diff = x - x_base
<span class="hljs-keyword">if</span> diff:<font></font>
    g = gcd(diff, n)<font></font>
    <span class="hljs-keyword">if</span> g &gt; <span class="hljs-number">1</span>:
        <span class="hljs-keyword">return</span> g</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se tornou:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> (diff := x - x_base) <span class="hljs-keyword">and</span> (g := gcd(diff, n)) &gt; <span class="hljs-number">1</span>:
    <span class="hljs-keyword">return</span> g</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, na maioria das linhas em que a atribui√ß√£o de vari√°veis ‚Äã‚Äãocorre, eu n√£o usaria express√µes de atribui√ß√£o. </font><font style="vertical-align: inherit;">Mas esse design √© t√£o frequente que ainda h√° muitos lugares onde eu aproveitaria essa oportunidade. </font><font style="vertical-align: inherit;">Nos casos mais recentes, ganhei um pouco, como costumavam aparecer. </font><font style="vertical-align: inherit;">Na subparte restante, isso levou a melhorias m√©dias ou grandes. </font><font style="vertical-align: inherit;">Assim, eu usaria express√µes de atribui√ß√£o com muito mais frequ√™ncia do que um triplo se, mas com muito menos frequ√™ncia do que com a atribui√ß√£o aumentada [aprox. </font><font style="vertical-align: inherit;">op√ß√µes curtas: * =, / =, + =, etc.].</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo num√©rico</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu tenho outro exemplo que me impressionou mais cedo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se todas as vari√°veis ‚Äã‚Äãforem n√∫meros inteiros positivos e a vari√°vel </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a for</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> maior que a en√©sima raiz de x, esse algoritmo retornar√° o arredondamento "inferior" da en√©sima raiz de x (e aproximadamente dobra aproximadamente o n√∫mero de bits exatos por itera√ß√£o):</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">while</span> a &gt; (d := x // a**(n<span class="hljs-number">-1</span>)):<font></font>
    a = ((n<span class="hljs-number">-1</span>)*a + d) // n
<span class="hljs-keyword">return</span> a</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o est√° claro por que, mas essa variante do algoritmo √© menos √≥bvia do que um loop infinito com uma quebra de ramifica√ß√£o condicional (loop e meio). Tamb√©m √© dif√≠cil provar a corre√ß√£o dessa implementa√ß√£o sem depender de uma afirma√ß√£o matem√°tica (‚Äúm√©dia aritm√©tica - desigualdade m√©dia geom√©trica‚Äù) e sem saber algumas coisas n√£o triviais sobre como o arredondamento aninhado se comporta de maneira descendente. Mas aqui o problema j√° est√° em matem√°tica, e n√£o em programa√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E se voc√™ sabe tudo isso, a op√ß√£o que usa express√µes de atribui√ß√£o √© lida com muita facilidade, como uma frase simples: ‚ÄúVerifique a‚Äú estimativa ‚Äùatual e se ela for muito grande, reduza-a‚Äù e a condi√ß√£o permite salvar imediatamente o valor intermedi√°rio da condi√ß√£o do loop. Na minha opini√£o, a forma cl√°ssica √© mais dif√≠cil de entender:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<font></font>
    d = x // a**(n<span class="hljs-number">-1</span>)
    <span class="hljs-keyword">if</span> a &lt;= d:
        <span class="hljs-keyword">break</span>
    a = ((n<span class="hljs-number">-1</span>)*a + d) // n
<span class="hljs-keyword">return</span> a</code></pre><br>
<a name="prilB"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap√™ndice B: Um Int√©rprete de C√≥digo Bruto para Geradores</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este ap√™ndice tenta esclarecer (embora n√£o especifique) as regras pelas quais uma vari√°vel deve ser criada nas express√µes geradoras. </font><font style="vertical-align: inherit;">Para v√°rios exemplos ilustrativos, mostramos o c√≥digo-fonte onde o gerador √© substitu√≠do por uma fun√ß√£o equivalente em combina√ß√£o com alguns ‚Äúandaimes‚Äù. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como [x para ...] √© equivalente √† lista (x para ...), os exemplos n√£o perdem sua generalidade. </font><font style="vertical-align: inherit;">E, como esses exemplos se destinam apenas a esclarecer as regras gerais, eles n√£o afirmam ser realistas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota: os geradores agora s√£o implementados atrav√©s da cria√ß√£o de fun√ß√µes de gerador aninhadas (semelhantes √†s fornecidas neste ap√™ndice). </font><font style="vertical-align: inherit;">Os exemplos mostram a nova parte, que adiciona a funcionalidade apropriada para trabalhar com o escopo das express√µes de atribui√ß√£o (como se a atribui√ß√£o tivesse sido executada em um bloco contendo o gerador mais externo). </font><font style="vertical-align: inherit;">Para simplificar a ‚Äúinfer√™ncia de tipo‚Äù, esses exemplos ilustrativos n√£o levam em considera√ß√£o que as express√µes de atribui√ß√£o s√£o opcionais (mas levam em considera√ß√£o o escopo da vari√°vel criada dentro do gerador). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos primeiro lembrar qual c√≥digo √© gerado "sob o cap√¥" para geradores sem express√µes de atribui√ß√£o:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo fonte (o EXPR costuma usar a vari√°vel VAR):</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>():</span>
    a = [EXPR <span class="hljs-keyword">for</span> VAR <span class="hljs-keyword">in</span> ITERABLE]</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O c√≥digo convertido (n√£o vamos nos preocupar com conflitos de nome):</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>():</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">genexpr</span>(<span class="hljs-params">iterator</span>):</span>
        <span class="hljs-keyword">for</span> VAR <span class="hljs-keyword">in</span> iterator:
            <span class="hljs-keyword">yield</span> EXPR<font></font>
    a = list(genexpr(iter(ITERABLE)))</code></pre></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos adicionar uma express√£o de atribui√ß√£o simples.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fonte:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>():</span>
    a = [TARGET := EXPR <span class="hljs-keyword">for</span> VAR <span class="hljs-keyword">in</span> ITERABLE]
</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo convertido:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>():</span>
    <span class="hljs-keyword">if</span> <span class="hljs-literal">False</span>:<font></font>
        TARGET = <span class="hljs-literal">None</span>  <span class="hljs-comment"># Dead code to ensure TARGET is a local variable</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">genexpr</span>(<span class="hljs-params">iterator</span>):</span>
        <span class="hljs-keyword">nonlocal</span> TARGET
        <span class="hljs-keyword">for</span> VAR <span class="hljs-keyword">in</span> iterator:<font></font>
            TARGET = EXPR<font></font>
            <span class="hljs-keyword">yield</span> TARGET<font></font>
    a = list(genexpr(iter(ITERABLE)))</code></pre></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos adicionar a instru√ß√£o TARGET global √† declara√ß√£o da fun√ß√£o f ().</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fonte:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>():</span>
    <span class="hljs-keyword">global</span> TARGET<font></font>
    a = [TARGET := EXPR <span class="hljs-keyword">for</span> VAR <span class="hljs-keyword">in</span> ITERABLE]
</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo convertido:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>():</span>
    <span class="hljs-keyword">global</span> TARGET
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">genexpr</span>(<span class="hljs-params">iterator</span>):</span>
        <span class="hljs-keyword">global</span> TARGET
        <span class="hljs-keyword">for</span> VAR <span class="hljs-keyword">in</span> iterator:<font></font>
            TARGET = EXPR<font></font>
            <span class="hljs-keyword">yield</span> TARGET<font></font>
    a = list(genexpr(iter(ITERABLE)))</code></pre></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou vice-versa, vamos adicionar TARGET n√£o-local √† declara√ß√£o da fun√ß√£o f ().</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fonte:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">g</span>():</span><font></font>
    TARGET = ...<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>():</span>
        <span class="hljs-keyword">nonlocal</span> TARGET<font></font>
        a = [TARGET := EXPR <span class="hljs-keyword">for</span> VAR <span class="hljs-keyword">in</span> ITERABLE]
</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo convertido:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">g</span>():</span><font></font>
    TARGET = ...<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>():</span>
        <span class="hljs-keyword">nonlocal</span> TARGET
        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">genexpr</span>(<span class="hljs-params">iterator</span>):</span>
            <span class="hljs-keyword">nonlocal</span> TARGET
            <span class="hljs-keyword">for</span> VAR <span class="hljs-keyword">in</span> iterator:<font></font>
                TARGET = EXPR<font></font>
                <span class="hljs-keyword">yield</span> TARGET<font></font>
        a = list(genexpr(iter(ITERABLE)))</code></pre></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, vamos colocar dois geradores.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fonte:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>():</span>
    a = [[TARGET := i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>)] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>)]
    <span class="hljs-comment"># I.e., a = [[0, 1, 2], [0, 1, 2]]</span>
    print(TARGET)  <span class="hljs-comment"># prints 2</span>
</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo convertido:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>():</span>
    <span class="hljs-keyword">if</span> <span class="hljs-literal">False</span>:<font></font>
        TARGET = <span class="hljs-literal">None</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">outer_genexpr</span>(<span class="hljs-params">outer_iterator</span>):</span>
        <span class="hljs-keyword">nonlocal</span> TARGET
        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">inner_generator</span>(<span class="hljs-params">inner_iterator</span>):</span>
            <span class="hljs-keyword">nonlocal</span> TARGET
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> inner_iterator:<font></font>
                TARGET = i<font></font>
                <span class="hljs-keyword">yield</span> i
        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> outer_iterator:
            <span class="hljs-keyword">yield</span> list(inner_generator(range(<span class="hljs-number">3</span>)))<font></font>
    a = list(outer_genexpr(range(<span class="hljs-number">2</span>)))<font></font>
    print(TARGET)</code></pre></li>
</ul><br>
<a name="prilC"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap√™ndice C: Nenhuma altera√ß√£o na sem√¢ntica do escopo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe que no Python a sem√¢ntica do escopo n√£o mudou. </font><font style="vertical-align: inherit;">O escopo das fun√ß√µes locais ainda √© determinado no tempo de compila√ß√£o e tem uma extens√£o de tempo indefinida no tempo de execu√ß√£o (fechamento). </font><font style="vertical-align: inherit;">Exemplo:</font></font><br>
<br>
<pre><code class="python hljs">a = <span class="hljs-number">42</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>():</span>
    <span class="hljs-comment"># `a` is local to `f`, but remains unbound</span>
    <span class="hljs-comment"># until the caller executes this genexp:</span>
    <span class="hljs-keyword">yield</span> ((a := i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>))
    <span class="hljs-keyword">yield</span> <span class="hljs-keyword">lambda</span>: a + <span class="hljs-number">100</span>
    print(<span class="hljs-string">"done"</span>)
    <span class="hljs-keyword">try</span>:<font></font>
        print(<span class="hljs-string">f"`a` is bound to <span class="hljs-subst">{a}</span>"</span>)
        <span class="hljs-keyword">assert</span> <span class="hljs-literal">False</span>
    <span class="hljs-keyword">except</span> UnboundLocalError:<font></font>
        print(<span class="hljs-string">"`a` is not yet bound"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span>results = list(f()) <span class="hljs-comment"># [genexp, lambda]</span><font></font>
done<font></font>
`a` <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> yet bound
<span class="hljs-comment"># The execution frame for f no longer exists in CPython,</span>
<span class="hljs-comment"># but f's locals live so long as they can still be referenced.</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>list(map(type, results))<font></font>
[&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> '<span class="hljs-title">generator</span>'&gt;, &lt;<span class="hljs-title">class</span> '<span class="hljs-title">function</span>'&gt;]
&gt;&gt;&gt; <span class="hljs-title">list</span>(<span class="hljs-params">results[<span class="hljs-number">0</span>]</span>)
[0, 1, 2]
&gt;&gt;&gt; <span class="hljs-title">results</span>[1]()
102
&gt;&gt;&gt; <span class="hljs-title">a</span>
42</span></code></pre><br>
<a name="ssilki"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Refer√™ncias</font></font></h2><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prova de implementa√ß√£o de conceito</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Discuss√£o da sem√¢ntica das express√µes de atribui√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (a VPN √© r√≠gida, mas carregada)</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Discuss√£o do TargetScopeError no PEP 572</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (carregado de forma semelhante √† anterior)</font></font></li>
</ol><br>
<a name="avtori"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">direito autoral</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este documento foi disponibilizado ao p√∫blico. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fonte: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/python/peps/blob/master/pep-0572.rst</font></font></a><br>
<br>
<a name="my"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minha parte</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para come√ßar, vamos resumir:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para que as </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pessoas n√£o tentem</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> remover a dualidade sem√¢ntica, em muitos lugares "cl√°ssicos", onde se pode usar "=" e ": =", existem restri√ß√µes; portanto, o operador :: = geralmente deve estar entre colchetes. </font><font style="vertical-align: inherit;">Esses casos dever√£o ser revistos na se√ß√£o que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">descreve o uso b√°sico.</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A prioridade das express√µes de atribui√ß√£o √© um pouco maior que a de uma v√≠rgula. </font><font style="vertical-align: inherit;">Devido a isso, as tuplas n√£o s√£o formadas durante a atribui√ß√£o. </font><font style="vertical-align: inherit;">Tamb√©m possibilita o uso do operador: = ao passar argumentos para uma fun√ß√£o.</font></font></li>
<li> ,   ,    ,    .       .    lambda    ,    ¬´¬ª  .</li>
<li>        :   ,     </li>
<li>      ,   .</li>
<li>          /  .</li>
<li>   ,      .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No final, quero dizer que gostei do novo operador. </font><font style="vertical-align: inherit;">Ele permite que voc√™ escreva c√≥digos mais simples em condi√ß√µes, listas de "filtros" e tamb√©m (finalmente) remova a linha "mesma" e solit√°ria antes de se. </font><font style="vertical-align: inherit;">Se as pessoas usarem express√µes de atribui√ß√£o para a finalidade pretendida, ser√° uma ferramenta muito conveniente que aumentar√° a legibilidade e a beleza do c√≥digo (embora isso possa ser dito sobre qualquer linguagem funcional ...)</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt499654/index.html">Como implementar o CRM em um site remoto e vencer?</a></li>
<li><a href="../pt499656/index.html">Simula√ß√£o do controlador de temperatura PID</a></li>
<li><a href="../pt499658/index.html">Um trabalhador em vez de um testador? Vale a pena estudar Selenium em 2020?</a></li>
<li><a href="../pt499662/index.html">Raiz de confian√ßa para IoT e outras tend√™ncias de seguran√ßa da IoT</a></li>
<li><a href="../pt499664/index.html">Portando APIs para TypeScript como um solucionador de problemas</a></li>
<li><a href="../pt499668/index.html">Depend√™ncias do JavaScript do caminho para o inferno</a></li>
<li><a href="../pt499670/index.html">–Ø –ø–µ—Ä–µ—Ö–æ–∂—É –Ω–∞ JavaScript</a></li>
<li><a href="../pt499674/index.html">Outro passo para computadores √≥pticos</a></li>
<li><a href="../pt499676/index.html">Mais de 90 ferramentas √∫teis para o Kubernetes: implanta√ß√£o, gerenciamento, monitoramento, seguran√ßa e muito mais</a></li>
<li><a href="../pt499680/index.html">Aprendendo Kubernetes: B√°sico 14 a 16 de maio, Avan√ßado de 18 a 20 de maio</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>