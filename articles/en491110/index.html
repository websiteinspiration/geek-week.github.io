<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôâ üßòüèΩ üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø Convert rtf to xml in C # üè≥Ô∏è üéà üèí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the continuation of a series of posts on converting text files to xml using C #, I propose moving on to converting rtf files .
 

It would seem tha...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Convert rtf to xml in C #</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491110/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the continuation of a series of posts on converting text files to xml using C #, I propose moving on to converting </font></font><strong><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rtf</font></font></em></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> files </font><font style="vertical-align: inherit;">.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It would seem that this format is quite ancient, and very common, and if there is no library for it to convert all data to xml format by calling one method, then there must definitely be some kind of solution from Microsoft, at least similar to OpenXML . </font><font style="vertical-align: inherit;">However, if it were, then this article would not have been written.</font></font></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So what is a </font></font><strong><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReachTextFile (rtf)</font></font></em></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">? </font><font style="vertical-align: inherit;">By and large, the contents of the file are already structured and even reminiscent of a mixture of json, xml and xpath. </font><font style="vertical-align: inherit;">This can be easily verified by saving some Word document in </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rtf</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> format </font><font style="vertical-align: inherit;">, and then try reading it in a text editor such as </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notepad ++</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font></p><br>
<p><img src="https://habrastorage.org/webt/8m/b3/li/8mb3li9-qvtjhwpdvf2ftbuhfim.png"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I highlighted in red a piece of the file that contains information about the encoding: in general, the tags are encrypted with ansi encoding, and the text itself is encoded with ansicpg1251. </font><font style="vertical-align: inherit;">The text itself looks like this:</font></font></p><br>
<p><img src="https://habrastorage.org/webt/ww/9o/1r/ww9o1rm_ou0vzllefyqgqm8wyc0.png"></p><br>
<p>, ,    ,    ,    ‚Ä¶ ,  ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="></a>,       ,   <em>php</em>. </p><br>
<p> ,      ,  ,     , , , ,           .      -  . </p><br>
<p>,    ,    ,   rtf   <code>RichTextBox</code>,      : </p><br>
<ul>
<li>-,     <code>Windows.Forms</code>,        . </li>
<li>-,         . , <code>RichTextBox</code>       ,      ,    .</li>
</ul><br>
<p>,   nuget   <strong><em>RtfPipe</em></strong>.      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"></a>.</p><br>
<p> <em>RtfPipe</em>     .    <strong>rtf </strong> <strong>html</strong>.           ,         <em>HtmlAgilityPack</em>. </p><br>
<p>,        - ?    : <del> ,  </del>       ,  ,   ,    .     ,     rtf- , ,           ,     ,         ‚Äî , ,     ,   ,      ,    .</p><br>
<p>,   .</p><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> <span class="hljs-title">Convert</span>(<span class="hljs-params">Stream stream</span>)</span><font></font>
        {<font></font>
            stream.Position = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">string</span> rtf = <span class="hljs-keyword">string</span>.Empty;
            <span class="hljs-keyword">using</span> (StreamReader sr = <span class="hljs-keyword">new</span> StreamReader(stream))<font></font>
            {<font></font>
                rtf = sr.ReadToEnd();<font></font>
            }<font></font>
            <span class="hljs-comment">//      RtfPipe  Core </span><font></font>
            Encoding.RegisterProvider(CodePagesEncodingProvider.Instance);<font></font>
            <span class="hljs-comment">//    RtfPipe  html</span>
            <span class="hljs-keyword">var</span> html = Rtf.ToHtml(rtf);
            <span class="hljs-comment">//  html     ,   xml</span>
            <span class="hljs-keyword">return</span> ClearHtml(html);<font></font>
        }</code></pre><br>
<ol>
<li>       string.       <code>RtfPipe</code>.  ,          </li>
<li>,      .Net Core <u> </u>    <code>Encoding.RegisterProvider(CodePagesEncodingProvider.Instance);</code>.        RtfPipe.     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"></a>.<br>
   .Net Framework,          .</li>
<li><code>var html = Rtf.ToHtml(rtf);</code> ‚Äî          html . ,    ,       ,      (     ),     .</li>
</ol><br>
<p><img src="https://habrastorage.org/webt/gi/a9/7x/gia97x3knsms05eekeqlv1nbtgi.png"></p><br>
<p>       <code>string ClearHtml(string html)</code>,     <em>xml</em>:</p><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">string</span> <span class="hljs-title">ClearHtml</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> html</span>)</span><font></font>
{<font></font>
    <span class="hljs-comment">//  html   HtmlAgilityPack</span>
    HtmlDocument doc = <span class="hljs-keyword">new</span> HtmlDocument();<font></font>
    doc.LoadHtml(html);<font></font>
    <span class="hljs-comment">//    (),     style</span>
    <span class="hljs-keyword">var</span> elementsWithStyleAttribute = doc.DocumentNode.SelectNodes(<span class="hljs-string">"//@style"</span>);
    <span class="hljs-comment">//   ,    </span>
    <span class="hljs-keyword">var</span> excessNodes = doc.DocumentNode.SelectNodes(<span class="hljs-string">"//b|//u|//strong|//br"</span>);
    <span class="hljs-comment">//     html</span>
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> element <span class="hljs-keyword">in</span> excessNodes)<font></font>
    {<font></font>
        element.ParentNode.InnerHtml = element.InnerText;<font></font>
        element.Remove();<font></font>
    }<font></font>
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> element <span class="hljs-keyword">in</span> elementsWithStyleAttribute)<font></font>
    {<font></font>
        element.Attributes[<span class="hljs-string">"style"</span>].Remove();<font></font>
    }<font></font>
    <span class="hljs-comment">//    html</span>
    <span class="hljs-keyword">using</span> (StringWriter writer = <span class="hljs-keyword">new</span> StringWriter())<font></font>
    {<font></font>
        doc.Save(writer);<font></font>
        html = writer.ToString();<font></font>
    }<font></font>
    <span class="hljs-comment">//   html  xml</span>
    StringBuilder xml = <span class="hljs-keyword">new</span> StringBuilder();<font></font>
    xml.Append(<span class="hljs-string">"&lt;?xml version=\"1.0\"?&gt;&lt;documents&gt;&lt;document&gt;"</span>);<font></font>
    xml.Append(html);<font></font>
    xml.Append(<span class="hljs-string">"&lt;/documents&gt;&lt;/document&gt;"</span>);
    <span class="hljs-keyword">return</span> xml.ToString();<font></font>
}</code></pre><br>
<ol>
<li> ,    HtmlAgilityPack  nuget</li>
<li>  <code>doc</code>  <code>HtmlDocument</code>     <code>html</code></li>
<li>   , ,     .  ,      <code>style</code>,      ,    ,    ,   .</li>
<li>C     ,   <code>StringBuilder</code>    xml,     .</li>
</ol><br>
<p>   , ,   ,   .</p><br>
<p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"></a></p><br>
<p>   <strong>docx</strong>  <strong>xlsx</strong>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="></a></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en491100/index.html">On Wanhao 5S, they printed a doll with a height of a person</a></li>
<li><a href="../en491102/index.html">How to develop a service when there are tough competitors around</a></li>
<li><a href="../en491104/index.html">How I found a hardware glitch on my Lenovo MiiX 2 10 tablet</a></li>
<li><a href="../en491106/index.html">Why may you need semi-synchronous replication?</a></li>
<li><a href="../en491108/index.html">Organizing deployments to many k8s environments using helmfile</a></li>
<li><a href="../en491112/index.html">The Path to Network Innocence - Cisco DNA</a></li>
<li><a href="../en491114/index.html">Smart relocation or how to choose a company for work and not regret it</a></li>
<li><a href="../en491116/index.html">Modern Identification Standards: OAuth 2.0, OpenID Connect, WebAuthn</a></li>
<li><a href="../en491118/index.html">Developer Heart: Devkits of the 5th generation of consoles (Part 1)</a></li>
<li><a href="../en491120/index.html">$ mol: 4 years later</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>