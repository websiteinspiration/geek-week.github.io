<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏽‍🌾 🍉 😎 Da habe ich meinen Boten geschrieben ⚗️ 🌐 ⤵️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eines Abends, nach einem weiteren frustrierenden Tag voller Versuche, das Spiel auszugleichen, entschied ich, dass ich dringend eine Pause brauchte. I...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Da habe ich meinen Boten geschrieben</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490070/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eines Abends, nach einem weiteren frustrierenden Tag voller Versuche, das Spiel auszugleichen, entschied ich, dass ich dringend eine Pause brauchte. </font><font style="vertical-align: inherit;">Ich werde zu einem anderen Projekt wechseln, es schnell tun, das Selbstwertgefühl zurückgeben, das während der Entwicklung des Spiels nachgelassen hat, und das Spiel mit neuer Kraft im Sturm erobern! </font><font style="vertical-align: inherit;">Die Hauptsache ist, ein schönes und entspannendes Projekt zu wählen ... Schreiben Sie Ihren eigenen Messenger? </font><font style="vertical-align: inherit;">Ha! </font><font style="vertical-align: inherit;">Wie schwer kann es sein? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Den Code finden Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><img src="https://habrastorage.org/webt/_b/cw/av/_bcwavbn-h0r3vgv8zzhdkaq09y.jpeg"></td>
<td><img src="https://habrastorage.org/webt/97/4x/qd/974xqd470ltfwu6gge0hfnaqry4.jpeg"></td>
</tr>
</tbody></table></div><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kurzer Hintergrund</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fast ein Jahr lang, bevor er mit der Arbeit am Messenger begann, arbeitete er am Online-Multiplayer-Spiel Line Tower Wars. </font><font style="vertical-align: inherit;">Die Programmierung verlief gut, alles andere (insbesondere Balance und Bild) war nicht sehr gut. </font><font style="vertical-align: inherit;">Plötzlich stellte sich heraus, dass es zwei verschiedene Dinge sind, ein Spiel zu machen und ein lustiges Spiel zu machen (Spaß für jemand anderen als sich selbst). </font><font style="vertical-align: inherit;">Nach einem Jahr der Tortur musste ich mich ablenken lassen, also beschloss ich, mich an etwas anderem zu versuchen. </font><font style="vertical-align: inherit;">Die Wahl fiel auf die mobile Entwicklung, nämlich Flutter. </font><font style="vertical-align: inherit;">Ich habe viele gute Dinge über Flutter gehört und den Pfeil nach einem kurzen Experiment gemocht. </font><font style="vertical-align: inherit;">Ich beschloss, meinen eigenen Boten zu schreiben. </font><font style="vertical-align: inherit;">Erstens empfiehlt es sich, sowohl Client als auch Server zu implementieren. </font><font style="vertical-align: inherit;">Zweitens wird es etwas Bedeutendes im Portfolio geben, um nach Arbeit zu suchen. Ich bin gerade dabei.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geplante Funktionalität</font></font></h2><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Privat- und Gruppenchats</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Senden von Text, Bildern und Videos</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Audio- und Videoanrufe</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Empfangsbestätigung und Lesung (Häkchen von Votsap)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Drucke ..."</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benachrichtigungen</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suche nach QR-Code und Geolocation</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit Blick auf die Zukunft kann ich stolz (und erleichtert) sagen, dass fast alles, was geplant wurde und was noch nicht umgesetzt wurde, in naher Zukunft umgesetzt wird.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://player.vimeo.com/video/393246625" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sprachauswahl</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe lange nicht über die Wahl der Sprache nachgedacht. </font><font style="vertical-align: inherit;">Anfangs war es verlockend, den Dart sowohl für den Client als auch für den Server zu verwenden, aber eine genauere Untersuchung ergab, dass nicht viele Dart-Treiber verfügbar sind und solche, die nicht viel Vertrauen schaffen. </font><font style="vertical-align: inherit;">Obwohl ich nicht dafür bürgen werde, über den aktuellen Moment zu sprechen, hat sich die Situation möglicherweise verbessert. </font><font style="vertical-align: inherit;">Meine Wahl fiel also auf C #, mit dem ich in Unity gearbeitet habe.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Architektur</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Er begann mit dem Nachdenken über Architektur. </font><font style="vertical-align: inherit;">Wenn man bedenkt, dass dreieinhalb Leute höchstwahrscheinlich meinen Messenger benutzen werden, müsste man sich natürlich nicht mit Architektur im Allgemeinen beschäftigen. </font><font style="vertical-align: inherit;">Sie nehmen und tun wie in unzähligen Tutorials. </font><font style="vertical-align: inherit;">Hier ist der Knoten, hier ist der Mongo, hier sind die Web-Sockets. </font><font style="vertical-align: inherit;">Erledigt. </font><font style="vertical-align: inherit;">Und Firebase ist hier. </font><font style="vertical-align: inherit;">Aber es ist nicht interessant. </font><font style="vertical-align: inherit;">Ich habe mich für einen Messenger entschieden, der sich leicht horizontal skalieren lässt, als würde ich Millionen von Clients gleichzeitig erwarten. </font><font style="vertical-align: inherit;">Da ich jedoch keine Erfahrung in diesem Bereich hatte, musste ich alles in der Praxis durch die Methode der Fehler und wieder Fehler lernen.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die endgültige Architektur sieht so aus</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/xp/jc/n7/xpjcn7otuw8am5jv9yztpp1sgyu.png"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich behaupte nicht, dass eine solche Architektur super cool und zuverlässig ist, aber sie ist realisierbar und </font><font style="vertical-align: inherit;">sollte </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">theoretisch</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hohen Belastungen standhalten und horizontal skalieren, aber ich verstehe nicht wirklich, wie man sie überprüft. </font><font style="vertical-align: inherit;">Und ich hoffe, dass ich keinen offensichtlichen Moment verpasst habe, der allen außer mir bekannt ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachfolgend finden Sie eine detaillierte Beschreibung der einzelnen Komponenten.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frontend-Server</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Noch bevor ich mit dem Spiel anfing, war ich fasziniert vom Konzept eines asynchronen Single-Threaded-Servers. </font><font style="vertical-align: inherit;">Effektiv und ohne potenzielle Race'ov - was können Sie noch verlangen. </font><font style="vertical-align: inherit;">Um zu verstehen, wie solche Server angeordnet sind, begann ich mich mit dem </font></font><code>asyncio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python- </font><font style="vertical-align: inherit;">Sprachmodul zu beschäftigen </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Die Lösung, die ich sah, schien sehr elegant. </font><font style="vertical-align: inherit;">Kurz gesagt, die Pseudocode-Lösung sieht so aus.</font></font><br>
<pre><code class="cs hljs"><span class="hljs-comment">//  ,      ,    </span>
<span class="hljs-comment">//       .      socket.Receive</span>
<span class="hljs-comment">//     , :</span>
<span class="hljs-keyword">var</span> bytesReceived = Completer&lt;<span class="hljs-keyword">object</span>&gt;();<font></font>
selector.Register(<font></font>
    socket,<font></font>
    SocketEvent.Receive,<font></font>
    () =&gt; bytesReceived.Complete(<span class="hljs-literal">null</span>)<font></font>
);<font></font>
<font></font>
<span class="hljs-keyword">await</span> bytesReceived.Future;<font></font>
<font></font>
<span class="hljs-keyword">int</span> n = socket.Receive(...); <span class="hljs-comment">//   </span><font></font>
<font></font>
<span class="hljs-comment">// selector -     poll.   </span>
<span class="hljs-comment">//        (Receive </span>
<span class="hljs-comment">//  ), ,    ,  .</span>
<span class="hljs-comment">//   completer,      ,</span>
<span class="hljs-comment">//        , ,     .</span>
<span class="hljs-comment">//     ,       .</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit dieser einfachen Technik können wir eine große Anzahl von Sockets in einem einzigen Thread bedienen. </font><font style="vertical-align: inherit;">Wir blockieren niemals einen Stream, während wir darauf warten, dass Bytes empfangen oder gesendet werden. </font><font style="vertical-align: inherit;">Der Stream ist immer mit nützlicher Arbeit beschäftigt. </font><font style="vertical-align: inherit;">Parallelität, mit einem Wort. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Frontend-Server werden auf diese Weise implementiert. </font><font style="vertical-align: inherit;">Sie sind alle Single-Threaded und asynchron. </font><font style="vertical-align: inherit;">Für maximale Leistung müssen Sie daher so viele Server auf einem Computer ausführen, wie Kerne haben (4 in der Abbildung). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Frontend-Server liest die Nachricht vom Client und sendet sie basierend auf dem Nachrichtencode an eines der Themen in Kafka.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine kleine Fußnote für diejenigen, die mit Kafa nicht vertraut sind</font></font></b><div class="spoiler_text">   ,          RabbitMQ.    .       ,              (   authentication backend     authentication, ).  ?      -  ,         (partition).      ,      .      ,   ,       . ,             ( ,   ,  ,     (headers)).<br>
<br>
  ?     ?      .   (consumer)         (  consumer'),    ( )      . , ,      ,    2 ,       .   3 —     2.                .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Frontend-Server sendet eine Nachricht ohne Schlüssel an die Kafka (wenn kein Schlüssel vorhanden ist, sendet die Kafka einfach nacheinander Nachrichten an die Partei). Die Nachricht wird von einem der entsprechenden Backend-Server aus dem Thema abgerufen. Der Server verarbeitet die Nachricht und ... wie geht es weiter? Und was weiter hängt von der Art der Nachricht ab. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im häufigsten Fall tritt ein Anforderungs-Antwort-Zyklus auf. Zum Beispiel müssen wir für eine Registrierungsanfrage dem Kunden nur eine Antwort geben ( </font></font><code>Success</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>EmailAlreadyInUse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, usw). Auf eine Nachricht mit einer Einladung zu einem bestehenden Chat mit neuen Mitgliedern (Vasya, Emil und Julia) müssen wir jedoch sofort mit drei verschiedenen Arten von Nachrichten antworten. Der erste Typ - Sie müssen den Einladenden über das Ergebnis des Vorgangs informieren (plötzlich ist ein Serverfehler aufgetreten). Der zweite Typ - Sie müssen alle aktuellen Mitglieder des Chats benachrichtigen, dass sich jetzt solche und solche neuen Mitglieder im Chat befinden. Die dritte besteht darin, Einladungen an Vasya, Emil und Yulia zu senden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Okay, das klingt nicht sehr schwierig, aber um eine Nachricht an einen Client zu senden, müssen wir: 1) herausfinden, mit welchem ​​Frontend-Server dieser Client verbunden ist (wir wählen nicht aus, mit welchem ​​Server der Client eine Verbindung herstellen soll, der Balancer entscheidet für uns); 2) Senden einer Nachricht vom Backend-Server an den gewünschten Frontend-Server; 3) Senden Sie tatsächlich eine Nachricht an den Client.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Punkte 1 und 2 zu implementieren, habe ich mich für ein separates Thema entschieden (Thema "Frontend-Server"). Die Trennung von Authentifizierungs-, Sitzungs- und Aufrufthemen in Partitionen dient als Parallelisierungsmechanismus. Wir sehen, dass der Sitzungsserver stark ausgelastet ist? Wir fügen nur ein paar neue Partitions- und Sitzungsserver hinzu, und Kafka verteilt die Last für uns neu und entlädt die vorhandenen Sitzungsserver. Die Aufteilung des Themas "Frontend-Server" in die Partition dient als </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Routing-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mechanismus </font><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jeder Frontend-Server entspricht einem Teil des Themas "Frontend-Server" (mit demselben Index wie der Server selbst). Das heißt, Server 0 - Partition 0 und so weiter. Kafka ermöglicht es, nicht nur ein bestimmtes Thema, sondern auch einen bestimmten Teil eines bestimmten Themas zu abonnieren. Alle Frontend-Server bei Starts abonnieren die entsprechende Partition. Somit kann der Backend-Server eine Nachricht an einen bestimmten Frontend-Server senden, indem er eine Nachricht an eine bestimmte Partition sendet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Okay, jetzt, wenn der Client beitritt, müssen Sie nur noch ein Paar UserId - Frontend Server Index irgendwo speichern. Im Falle einer Trennung - löschen. Für diese Zwecke reicht jede der vielen speicherinternen Schlüsselwertdatenbanken aus. Ich habe einen Rettich gewählt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie es in der Praxis aussieht. </font><font style="vertical-align: inherit;">Nachdem die Verbindung hergestellt wurde, sendet Client Andrey zunächst eine Nachricht an den Server </font></font><code>Join</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Der Frontend-Server empfängt die Nachricht und leitet sie an das Sitzungsthema weiter. Dabei wird vorab der Header "Frontend Server" hinzugefügt: {index}. </font><font style="vertical-align: inherit;">Einer der Backend-Sitzungsserver empfängt eine Nachricht, liest das Autorisierungstoken, ermittelt, welcher Benutzertyp beigetreten ist, liest den vom Frontend-Server hinzugefügten Index und schreibt UserId - Index in den Rettich. </font><font style="vertical-align: inherit;">Von diesem Moment an wird der Client als online betrachtet, und jetzt wissen wir, über welchen Frontend-Server (und entsprechend über welchen Teil des Themas "Frontend-Server") wir ihn "erreichen" können, wenn andere Clients Nachrichten an Andrey senden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Tatsächlich ist der Prozess etwas komplizierter als ich beschrieben habe. </font><font style="vertical-align: inherit;">Sie finden es im Quellcode.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pseudocode des Frontend-Servers</font></font></h4><br>
<pre><code class="cs hljs"><span class="hljs-comment">// Frontend Server 6</span>
<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
    <span class="hljs-comment">// Consume from "Frontend Servers" topic, partition 6</span>
    <span class="hljs-keyword">var</span> messageToClient = consumer.Consume();
    <span class="hljs-keyword">if</span> (message != <span class="hljs-literal">null</span>) {<font></font>
        relayMessageToClient(messageToClient);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">var</span> callbacks = selector.Poll();
    <span class="hljs-keyword">while</span> (callbacks.TryDequeue(<span class="hljs-keyword">out</span> callback)) {<font></font>
        callback();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">long</span> now = DateTimeOffset.UtcNow.ToUnixTimeMilliseconds();
    <span class="hljs-keyword">while</span> (!callAtQueue.IsEmpty &amp;&amp; callAtQueue.PeekPriority() &lt;= now) {<font></font>
        callAtQueue.Dequeue()();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">while</span> (messagesToRelayToBackendServers.TryDequeue(<span class="hljs-keyword">out</span> messageFromClient)) {
        <span class="hljs-comment">// choose topic</span><font></font>
        producer.Produce(topic, messageFromClient);<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier gibt es ein paar Tricks. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) </font></font><code>relayMessageToClient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Es ist ein Fehler, einfach den gewünschten Socket zu nehmen und sofort eine Nachricht an ihn zu senden, da wir möglicherweise </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bereits</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine andere Nachricht an den Client senden. Wenn wir beginnen, Bytes zu senden, ohne zu überprüfen, ob der Socket gerade belegt ist, werden die Nachrichten gemischt. Wie an vielen anderen Stellen, an denen eine ordnungsgemäße Datenverarbeitung erforderlich ist, besteht der Trick darin, eine Warteschlange zu verwenden, nämlich eine Warteschlange von Completers ( </font></font><code>TaskCompletionSource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in C #).</font></font><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-keyword">async</span> <span class="hljs-title">relayMessageToClient</span>(<span class="hljs-params">message</span>)</span> {
    <span class="hljs-comment">// find client</span>
    <span class="hljs-keyword">await</span> client.ReadyToSend();
    <span class="hljs-keyword">await</span> sendMessage(client, message);<font></font>
    client.CompleteSend();<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">class</span> <span class="hljs-title">Client</span> {
    <span class="hljs-comment">// ...</span>
    sendMessageQueue = <span class="hljs-keyword">new</span> LinkedList&lt;Completer&lt;<span class="hljs-keyword">object</span>&gt;&gt;();<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">async</span> Future <span class="hljs-title">ReadyToSend</span>(<span class="hljs-params"></span>)</span> {
        <span class="hljs-keyword">var</span> sendMessage = Completer&lt;<span class="hljs-keyword">object</span>&gt;();
	<span class="hljs-keyword">if</span> (sendMessageQueue.IsEmpty) {<font></font>
	    sendMessageQueue.AddLast(sendMessage);<font></font>
	} <span class="hljs-keyword">else</span> {
	    <span class="hljs-keyword">var</span> prevSendMessage = sendMessageQueue.Last;<font></font>
	    sendMessageQueue.AddLast(sendMessage);<font></font>
	    <span class="hljs-keyword">await</span> prevSendMessage.Future;<font></font>
	}<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">CompleteSend</span>(<span class="hljs-params"></span>)</span> {
        <span class="hljs-keyword">var</span> sendMessage = sendMessageQueue.RemoveFirst();<font></font>
	sendMessage.Complete(<span class="hljs-literal">null</span>);<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn die Warteschlange nicht leer ist, ist der Socket derzeit bereits belegt. Erstellen Sie eine neue </font></font><code>completer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, fügen Sie sie der Warteschlange und </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vorherigen hinzu</font></font></i> <code>completer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Wenn die vorherige Nachricht gesendet wird, </font></font><code>CompleteSend</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wird sie abgeschlossen </font></font><code>completer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, wodurch der Server mit dem Senden der nächsten Nachricht beginnt. Eine solche Warteschlange ermöglicht auch die reibungslose Weitergabe von Ausnahmen. Angenommen, beim Senden einer Nachricht an einen Client ist ein Fehler aufgetreten. In diesem Fall müssen wir abschließen, mit der Ausnahme, dass nicht nur diese Nachricht gesendet wird, sondern auch alle Nachrichten, die derzeit in der Warteschlange warten (warten Sie auf </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'ah). Wenn wir dies nicht tun, hängen sie weiter und wir erhalten einen Speicherverlust. Der Kürze halber wird der Code, der dies tut, hier nicht angezeigt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2)</font></font><code>selector.Poll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Eigentlich ist es nicht einmal ein Trick, sondern nur ein Versuch, die Mängel der Methodenimplementierung auszugleichen </font></font><code>Socket.Select</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><code>selector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- nur ein Wrapper über diese Methode). Abhängig vom Betriebssystem unter der Haube verwendet diese Methode entweder </font></font><code>select</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oder </font></font><code>poll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Das ist hier aber nicht wichtig. Wichtig ist, wie diese Methode mit den Listen funktioniert, die wir der Eingabe zuführen (Liste der Sockets zum Lesen, Schreiben, Fehlerprüfung). Diese Methode verwendet Listen, fragt Sockets ab und belässt nur die Sockets in den Listen, die bereit sind, die erforderliche Operation auszuführen. Alle anderen Sockets werden aus den Listen geworfen. "Treten" erfolgt durch</font></font><code>RemoveAt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(das heißt, alle nachfolgenden Elemente werden verschoben, was ineffizient ist). Da wir bei jeder Iteration des Zyklus alle registrierten Sockets abfragen müssen, ist eine solche „Bereinigung“ im Allgemeinen schädlich. Daher müssen wir die Listen jedes Mal neu füllen. Wir können all diese Probleme mit einem benutzerdefinierten Problem umgehen </font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>RemoveAt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dessen </font><font style="vertical-align: inherit;">Methode </font><font style="vertical-align: inherit;">das Element nicht aus der Liste entfernt, sondern es einfach als gelöscht markiert. Die Klasse </font></font><code>ListForPolling</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist meine Implementierung einer solchen Liste. </font></font><code>ListForPolling</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funktioniert nur mit der Methode </font></font><code>Socket.Select</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und ist für nichts anderes geeignet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3)</font></font><code>callAtQueue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. In den meisten Fällen erwartet der Frontend-Server, nachdem er die Client-Nachricht an den Backend-Server gesendet hat, eine Antwort (Bestätigung, dass der Vorgang erfolgreich war, oder ein Fehler, wenn ein Fehler aufgetreten ist). Wenn er nicht innerhalb eines konfigurierbaren Zeitraums auf eine Antwort wartet, sendet er einen Fehler an den Client, damit er nicht auf eine Antwort wartet, die niemals kommen wird. </font></font><code>callAtQueue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ist eine Prioritätswarteschlange. Unmittelbar nachdem der Server die Nachricht an Kafka gesendet hat, geschieht Folgendes:</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">long</span> now = DateTimeOffset.UtcNow.ToUnixTimeMilliseconds();<font></font>
callAtQueue.Enqueue(callback, now + config.WaitForReplyMSec);<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Rückruf wird das Warten auf eine Antwort abgebrochen und das Senden von Serverfehlern beginnt. Wenn eine Antwort vom Backend-Server empfangen wird, führt der Rückruf nichts aus. </font><font style="vertical-align: inherit;">Es gibt keine Möglichkeit, es zu </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
verwenden </font></font><code>await Task.WhenAny(answerReceivedTask, Task.Delay(x))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, da der Code, nachdem er </font></font><code>Task.Delay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf dem Thread aus dem Pool ausgeführt wurde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier eigentlich alles über Frontend-Server. Hier ist eine leichte Korrektur erforderlich. In der Tat ist der Server nicht </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voll</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Single Threaded. Natürlich verwendet Kafka unter der Haube Threads, aber ich meine den Anwendungscode. Tatsache ist, dass das Senden einer Nachricht an das Thema kafka (produzieren) möglicherweise nicht erfolgreich ist. Im Falle eines Fehlers wiederholt Kafka das Senden einer bestimmten konfigurierbaren Anzahl von Malen. Wenn jedoch wiederholte Abfahrten fehlschlagen, gibt Kafka dieses Geschäft als hoffnungslos auf. Sie können überprüfen, ob die Nachricht erfolgreich gesendet wurde oder nicht, in </font></font><code>deliveryHandler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">der wir an die Methode übergeben </font></font><code>Produce</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Kafka ruft diesen Handler im E / A-Thread des Herstellers auf (dem Thread, der Nachrichten sendet). Wir müssen sicherstellen, dass die Nachricht erfolgreich gesendet wurde, und wenn nicht, das Warten auf eine Antwort vom Back-End-Server abbrechen (die Antwort wird nicht kommen, weil die Anforderung nicht gesendet wurde) und einen Fehler an den Client senden. Das heißt, wir können die Interaktion mit einem anderen Thread nicht vermeiden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Beim Schreiben eines Artikels wurde mir plötzlich klar, dass wir nicht </font></font><code>deliveryHandler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">an die Methode übergeben </font></font><code>Produce</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oder einfach alle Kafka-Fehler ignorieren können (der Fehler wird immer noch an das Client gesendet, das ich zuvor beschrieben habe) - dann wird unser gesamter Code Single-Threaded sein. </font><font style="vertical-align: inherit;">Jetzt denke ich darüber nach, wie ich es besser machen kann.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warum eigentlich Kafka, kein Kaninchen?</font></font></b><div class="spoiler_text">,        ,   ,  , ,   RabbitMQ?        .  , ,   .     ?    ,         frontend .   ,     backend ,      ,          .    ,       ,     .   ,       error-prone.  ,     <code>basicGet</code> ,    ,   ,      .     .      <code>basicGet</code>,      ,       .          .<br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Backend-Server</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Vergleich zum Frontend-Server gibt es hier praktisch keine interessanten Punkte. </font><font style="vertical-align: inherit;">Alle Backend-Server funktionieren auf die gleiche Weise. </font><font style="vertical-align: inherit;">Beim Start abonniert der Server das Thema (Authentifizierung, Sitzung oder Aufruf, abhängig von der Rolle), und die Kafka weist ihm eine oder mehrere Partitionen zu. </font><font style="vertical-align: inherit;">Der Server empfängt die Nachricht von Kafka, verarbeitet sie und sendet normalerweise eine oder mehrere Nachrichten als Antwort. </font><font style="vertical-align: inherit;">Fast echter Code:</font></font><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Run</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-keyword">long</span> lastCommitTime = DateTimeOffset.UtcNow.ToUnixTimeMilliseconds();<font></font>
<font></font>
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">var</span> consumeResult = consumer.Consume(<font></font>
            TimeSpan.FromMilliseconds(config.Consumer.PollTimeoutMSec)<font></font>
        );<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (consumeResult != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">var</span> workUnit = <span class="hljs-keyword">new</span> WorkUnit() {<font></font>
                ConsumeResult = consumeResult,<font></font>
            };<font></font>
<font></font>
            LinkedList&lt;WorkUnit&gt; workUnits;<font></font>
            <span class="hljs-keyword">if</span> (partitionToWorkUnits.ContainsKey(consumeResult.Partition)) {<font></font>
                workUnits = partitionToWorkUnits[consumeResult.Partition];<font></font>
            } <span class="hljs-keyword">else</span> {<font></font>
                workUnits = partitionToWorkUnits[consumeResult.Partition] =<font></font>
                    <span class="hljs-keyword">new</span> LinkedList&lt;WorkUnit&gt;();<font></font>
            }<font></font>
<font></font>
            workUnits.AddLast(workUnit);<font></font>
<font></font>
            handleWorkUnit(workUnit);<font></font>
        }<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (<font></font>
            DateTimeOffset.UtcNow.ToUnixTimeMilliseconds() - lastCommitTime &gt;=<font></font>
            config.Consumer.CommitIntervalMSec<font></font>
        ) {<font></font>
            commitOffsets();<font></font>
	    lastCommitTime = DateTimeOffset.UtcNow.ToUnixTimeMilliseconds();<font></font>
	}<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Welche Art von Offsets müssen festgeschrieben werden?</font></font></b><div class="spoiler_text">       .   —   (offset)    (0, 1  ).         0.        <code>TopicPartitionOffset</code>.    (consume)   ,   <code>ConsumeResult</code>, ,   ,   <code>TopicPartitionOffset</code>.     ?<br>
<br>
  at least once delivery,  ,              (    ).     ,           (commited) . ,  consumer         16,  ,  16 ,   ,      ,   .     -  consumer'     consumer'        ,    16 + 1 (   + 1).    17   .        N ,       .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe das automatische Festschreiben deaktiviert und mich selbst festgeschrieben. Dies ist erforderlich, da </font></font><code>handleWorkUnit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dies eine </font></font><code>async void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Methode </font><font style="vertical-align: inherit;">ist </font><font style="vertical-align: inherit;">, bei der die Nachrichtenverarbeitung tatsächlich ausgeführt wird. </font><font style="vertical-align: inherit;">Daher gibt es keine Garantie dafür, dass Nachricht 5 vor Nachricht 6 verarbeitet wird. Kafka speichert nur einen festgeschriebenen Offset (und keinen Satz von Offset), bevor der Offset festgeschrieben wird 6 müssen wir sicherstellen, dass alle vorherigen Nachrichten auch verarbeitet wurden. Darüber hinaus kann ein Back-End-Server Nachrichten von mehreren Partitionen gleichzeitig verarbeiten und muss daher sicherstellen, dass der richtige Offset für die entsprechende Partition festgeschrieben wird. Dazu verwenden wir eine Hash-Map der Formularpartition: Arbeitseinheiten. So sieht der Code aus </font></font><code>commitOffsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(diesmal echter Code):</font></font><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">commitOffsets</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-keyword">foreach</span> (LinkedList&lt;WorkUnit&gt; workUnits <span class="hljs-keyword">in</span> partitionToWorkUnits.Values) {<font></font>
        WorkUnit lastFinishedWorkUnit = <span class="hljs-literal">null</span>;<font></font>
        LinkedListNode&lt;WorkUnit&gt; workUnit;<font></font>
        <span class="hljs-keyword">while</span> ((workUnit = workUnits.First) != <span class="hljs-literal">null</span> &amp;&amp; workUnit.Value.IsFinished) {<font></font>
            lastFinishedWorkUnit = workUnit.Value;<font></font>
            workUnits.RemoveFirst();<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (lastFinishedWorkUnit != <span class="hljs-literal">null</span>) {<font></font>
            offsets.Add(lastFinishedWorkUnit.ConsumeResult.TopicPartitionOffset);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (offsets.Count &gt; <span class="hljs-number">0</span>) {<font></font>
        consumer.Commit(offsets);<font></font>
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> offset <span class="hljs-keyword">in</span> offsets) {<font></font>
            logger.Debug(<font></font>
                <span class="hljs-string">"{Identifier}: Commited offset {TopicPartitionOffset}"</span>,<font></font>
                identifier,<font></font>
                offset<font></font>
            );<font></font>
        }<font></font>
        offsets.Clear();<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie sehen können, durchlaufen wir die Einheiten, finden die letzte Einheit, die zu diesem Zeitpunkt fertiggestellt ist, danach </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gibt es keine unvollständigen mehr</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , und schreiben den entsprechenden Offset fest. </font><font style="vertical-align: inherit;">Eine solche Schleife ermöglicht es uns, "löchrige" Commits zu vermeiden. </font><font style="vertical-align: inherit;">Wenn wir beispielsweise derzeit 4 Einheiten ( </font></font><code>0: Finished, 1: Not Finished, 2: Finished, 3: Finished</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) haben, können wir nur die 0. Einheit festschreiben. Wenn wir die 3. Einheit sofort festschreiben, kann dies zum potenziellen Verlust der 1. Einheit führen, wenn der Server gerade stirbt.</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">class</span> <span class="hljs-title">WorkUnit</span> {
    <span class="hljs-keyword">public</span> ConsumeResult&lt;Null, <span class="hljs-keyword">byte</span>[]&gt; ConsumeResult { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> finished = <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> IsFinished =&gt; finished == <span class="hljs-number">1</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Finish</span>(<span class="hljs-params"></span>)</span> {<font></font>
        Interlocked.Increment(<span class="hljs-keyword">ref</span> finished);<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<br>
<code>handleWorkUnit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie gesagt, die </font></font><code>async void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Methode, und sie ist dementsprechend vollständig eingewickelt </font></font><code>try-catch-finally</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In </font></font><code>try</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ruft er den notwendigen Dienst und in </font></font><code>finally</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><code>workUnit.Finish()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Dienstleistungen sind ziemlich trivial. </font><font style="vertical-align: inherit;">Hier zum Beispiel, welcher Code ausgeführt wird, wenn der Benutzer eine neue Nachricht sendet:</font></font><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task&lt;ServiceResult&gt; <span class="hljs-title">createShareItem</span>(<span class="hljs-params">CreateShareItemMessage msg</span>)</span> {
    <span class="hljs-keyword">byte</span>[] message;
    <span class="hljs-keyword">byte</span>[] messageToPals1 = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">int</span>?[] partitions1 = <span class="hljs-literal">null</span>;<font></font>
<font></font>
    <span class="hljs-comment">//  UserId  .</span>
    <span class="hljs-keyword">long</span>? userId = hashService.ValidateSessionIdentifier(msg.SessionIdentifier);
    <span class="hljs-keyword">if</span> (userId != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">var</span> shareItem = <span class="hljs-keyword">new</span> ShareItemModel(<font></font>
            requestIdentifier: msg.RequestIdentifier,<font></font>
            roomIdentifier: msg.RoomIdentifier,<font></font>
            creatorId: userId,<font></font>
            timeOfCreation: <span class="hljs-literal">null</span>,<font></font>
            type: msg.ShareItemType,<font></font>
            content: msg.Content<font></font>
        );<font></font>
<font></font>
        <span class="hljs-comment">//      null,</span>
        <span class="hljs-comment">//     .</span>
        <span class="hljs-keyword">long</span>? timeOfCreation = <span class="hljs-keyword">await</span> storageService.CreateShareItem(shareItem);
        <span class="hljs-keyword">if</span> (timeOfCreation != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">//      .</span>
            List&lt;<span class="hljs-keyword">long</span>&gt; pals = <span class="hljs-keyword">await</span> inMemoryStorageService.GetRoomPals(<font></font>
                msg.RoomIdentifier<font></font>
            );<font></font>
            <span class="hljs-keyword">if</span> (pals == <span class="hljs-literal">null</span>) {
            	<span class="hljs-comment">//     -       .</span>
                pals = <span class="hljs-keyword">await</span> storageService.GetRoomPals(msg.RoomIdentifier);
                <span class="hljs-keyword">await</span> inMemoryStorageService.SaveRoomPals(msg.RoomIdentifier, pals);<font></font>
            }<font></font>
<font></font>
            <span class="hljs-comment">//    ,  .</span><font></font>
            pals.Remove(userId.Value);<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (pals.Count &gt; <span class="hljs-number">0</span>) {
            	<span class="hljs-comment">//  ack,  ,    </span>
                <span class="hljs-comment">//    .</span>
                <span class="hljs-keyword">await</span> storageService.CreateAck(<font></font>
                    msg.RequestIdentifier, userId.Value, msg.RoomIdentifier,<font></font>
                    timeOfCreation.Value, pals<font></font>
                );<font></font>
<font></font>
                <span class="hljs-comment">// in -  UserId, out -   frontend ,</span>
                <span class="hljs-comment">//    .  -   -</span>
                <span class="hljs-comment">//   null.</span>
                partitions1 = <span class="hljs-keyword">await</span> inMemoryStorageService.GetUserPartitions(pals);<font></font>
<font></font>
                List&lt;<span class="hljs-keyword">long</span>&gt; onlinePals = getOnlinePals(pals, partitions1);<font></font>
<font></font>
                <span class="hljs-comment">//    ,       .</span>
                <span class="hljs-comment">//         .</span>
                <span class="hljs-keyword">if</span> (onlinePals.Count &gt; <span class="hljs-number">0</span>) {<font></font>
                    messageToPals1 = converterService.EncodeNewShareItemMessage(<font></font>
                        userId.Value, timeOfCreation.Value, onlinePals, shareItem<font></font>
                    );<font></font>
                    nullRepeatedPartitions(partitions1);<font></font>
                    <span class="hljs-comment">// -         </span>
                    <span class="hljs-comment">// frontend ,    null' .</span><font></font>
                }<font></font>
            }<font></font>
<font></font>
            message = converterService.EncodeSuccessfulShareItemCreationMessage(<font></font>
                msg.RequestIdentifier, timeOfCreation.Value<font></font>
            );<font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
            message = converterService.EncodeMessage(<font></font>
                MessageCode.RoomNotFound, msg.RequestIdentifier<font></font>
            );<font></font>
        }<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        message = converterService.EncodeMessage(<font></font>
            MessageCode.UserNotFound, msg.RequestIdentifier<font></font>
        );<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ServiceResult(<font></font>
        message: message, <span class="hljs-comment">//    .</span>
        messageToPals1: messageToPals1, <span class="hljs-comment">//  -    .</span><font></font>
        partitions1: partitions1<font></font>
    );<font></font>
}<font></font>
</code></pre><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datenbank</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der größte Teil der Funktionalität von Diensten, die von Backend-Servern aufgerufen werden, besteht darin, der Datenbank einfach neue Daten hinzuzufügen und vorhandene zu verarbeiten. Natürlich ist es für den Messenger sehr wichtig, wie die Datenbank organisiert ist und wie wir damit arbeiten, und hier möchte ich sagen, dass ich mich nach sorgfältiger Prüfung aller Optionen sehr sorgfältig mit der Auswahl einer Datenbank befasst habe, aber dies ist nicht der Fall. Ich habe mich gerade für CockroachDb entschieden, weil es mit minimalem Aufwand viel verspricht und eine Postgres-kompatible Syntax hat (ich habe vorher mit Postgres gearbeitet). Es gab Gedanken, Cassandra zu benutzen, aber am Ende beschloss ich, mich mit etwas Vertrautem zu befassen. Ich hatte noch nie mit Kafka, Rabbit, Flutter und Dart oder WebRtc gearbeitet, deshalb habe ich beschlossen, Cassandra nicht mitzunehmen, weil ich Angst hatte, in einer ganzen Reihe neuer Technologien für mich zu ertrinken.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Von allen Teilen meines Projekts bezweifle ich am meisten das Datenbankdesign. Ich bin mir nicht sicher, ob die Entscheidungen, die ich getroffen habe, wirklich </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gute</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Entscheidungen sind. Alles funktioniert, könnte aber besser gemacht werden. Zum Beispiel gibt es Tabellen ShareRooms (wie ich Chats aufrufe) und ShareItems (wie ich Nachrichten aufrufe). Alle Benutzer, die einen Raum betreten, werden im jsonb-Feld dieses Raums aufgezeichnet. Dies ist praktisch, aber offensichtlich sehr langsam, daher werde ich es wahrscheinlich mit Fremdschlüsseln wiederholen. In der ShareItems-Tabelle werden beispielsweise </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alle</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nachrichten </font><font style="vertical-align: inherit;">gespeichert </font><font style="vertical-align: inherit;">. Das ist auch praktisch, aber da ShareItems eine der am meisten geladenen Tabellen ist (persistent </font></font><code>select</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und</font></font><code>insert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) könnte es sich lohnen, für jeden Raum einen neuen Tisch zu erstellen oder so ähnlich. Kokroach streut Datensätze auf verschiedenen Knoten, dementsprechend müssen Sie sorgfältig überlegen, welcher Datensatz verwendet werden soll, um maximale Leistung zu erzielen, aber ich habe dies nicht getan. Wie aus all dem hervorgeht, sind Datenbanken im Allgemeinen nicht meine Stärke. Im Moment teste ich im Allgemeinen alles auf Postgres und nicht auf Kokroach, da meine Arbeitsmaschine weniger belastet ist und bereits so schlecht von den Belastungen ist, dass sie bald abheben wird. Glücklicherweise unterscheidet sich der Code für Postgres und Kokroach erheblich, so dass das Umschalten nicht schwierig ist.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt bin ich dabei zu untersuchen, wie der Cocroach tatsächlich funktioniert (wie die Zuordnung zwischen SQL und Schlüsselwert erfolgt (der Cocroach verwendet RocksDb unter der Haube), wie er Daten zwischen Knoten, Replikaten usw. verteilt. Es hat sich natürlich gelohnt, Cocroach zu studieren, bevor man es benutzt, aber besser spät als nie.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich denke, dass sich die Basis stark verändern wird, wenn ich dieses Problem besser verstehe. Im Moment verfolgt mich der Acks-Tisch. In dieser Tabelle speichere ich Daten darüber, wer die Nachricht noch nicht empfangen und wer sie noch nicht gelesen hat (um die Häkchen des Benutzers anzuzeigen). Es ist einfach, den Benutzer zu benachrichtigen, dass seine Nachricht gelesen wurde, wenn der Benutzer jetzt online ist. Wenn nicht, müssen wir diese Informationen speichern, um den Benutzer später zu benachrichtigen. Und da Gruppenchats verfügbar sind, reicht es nicht aus, nur das Flag zu speichern, sondern Sie benötigen Daten zu einzelnen Benutzern. Hier bitten wir also direkt um die Verwendung von Bitfolgen (eine Zeile für Benutzer, die noch nicht empfangen haben, die zweite - für diejenigen, die noch nicht gelesen haben). Besonders Kokroach-Unterstützung </font></font><code>bit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und</font></font><code>bit varying</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ich habe jedoch nie herausgefunden, wie ich dieses Geschäft umsetzen soll, da sich die Zusammensetzung der Räume ständig ändern kann. Damit Bitstrings ihre Bedeutung behalten, müssen Benutzer im Raum in derselben Reihenfolge bleiben, was ziemlich schwierig ist, wenn beispielsweise ein Benutzer den Raum verlässt. Hier gibt es Optionen. Vielleicht lohnt es sich, -1 zu schreiben, anstatt den Benutzer aus dem jsonb-Feld zu löschen, damit die Reihenfolge erhalten bleibt, oder eine Versionsmethode zu verwenden, damit wir wissen, dass sich diese Bitfolge auf die Reihenfolge der Benutzer bezieht, die damals war. und nicht in der aktuellen Reihenfolge der Benutzer. Ich bin immer noch dabei darüber nachzudenken, wie dieses Geschäft besser implementiert werden kann, aber vorerst sind diejenigen, die die Benutzer noch nicht erhalten und nicht gelesen haben, auch nur jsonb-Felder. Da die Acks-Tabelle mit jeder Nachricht geschrieben wird, ist die Datenmenge groß.Obwohl der Datensatz natürlich gelöscht wird, wenn die Nachricht von allen empfangen und gelesen wird.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flattern</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe lange Zeit auf der Serverseite gearbeitet und für den Test einfache Konsolenclients verwendet, sodass ich nicht einmal ein Flutter-Projekt erstellt habe. </font><font style="vertical-align: inherit;">Und als ich es erstellt habe, dachte ich, dass der Serverteil ein </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">komplexer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Teil ist, und die Anwendung ist so, Müll, ich werde es in ein paar Tagen herausfinden. </font><font style="vertical-align: inherit;">Während der Arbeit am Server habe ich ein paar Mal Hello Worlds für das Flattern erstellt, um ein Gefühl für das Framework zu bekommen. Da der Messenger keine komplizierte Benutzeroberfläche benötigt, dachte ich, dass er vollständig bereit ist. </font><font style="vertical-align: inherit;">Die Benutzeroberfläche ist also wirklich Müll, aber die Implementierung der Funktionalität hat mir Probleme bereitet (und sie wird immer noch liefern, da nicht alles fertig ist).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Staatsverwaltung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das beliebteste Thema. Es gibt tausend Möglichkeiten, Ihren Zustand zu behandeln, und der empfohlene Ansatz wird alle sechs Monate geändert. Jetzt ist der Mainstream Anbieter. Persönlich habe ich zwei Möglichkeiten für mich gewählt: Block und Redux. Block (Business Logic Component) zur Verwaltung des lokalen Status und Redux zur Verwaltung des globalen Status. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bloc ist keine Art von Bibliothek (obwohl es natürlich auch eine Bibliothek gibt, die die Boilerplate reduziert, aber ich benutze sie nicht). Bloc ist ein Stream-basierter Ansatz. Im Allgemeinen ist Dart eine ziemlich nette Sprache und Streams sind im Allgemeinen so süß. Der Kern dieses Ansatzes besteht darin, dass wir die gesamte Geschäftslogik in Services umwandeln und zwischen der Benutzeroberfläche und den Services über einen Controller kommunizieren, der uns verschiedene Streams zur Verfügung stellt. Hat der Benutzer auf die Schaltfläche "Kontakt suchen" geklickt? Verwenden von</font></font><code>sink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(das andere Ende des Streams) Wir senden ein Ereignis an den Controller </font></font><code>SearchContactsEvent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Der Controller ruft den gewünschten Dienst auf, wartet auf das Ergebnis und gibt die Liste der Benutzer auch über den Stream an die Benutzeroberfläche zurück. Die Benutzeroberfläche wartet auf Ergebnisse mit </font></font><code>StreamBuilder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Widget, das jedes Mal neu erstellt wird, wenn neue Daten in dem Stream eintreffen, den sie abonniert haben). Das ist in der Tat alles. In einigen Fällen müssen wir die Benutzeroberfläche ohne Beteiligung des Benutzers aktualisieren (z. B. wenn eine neue Nachricht eingeht). Dies ist jedoch auch problemlos über Streams möglich. In der Tat, eine einfache MVC mit Streams, keine Magie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Vergleich zu einigen anderen Ansätzen erfordert der Block mehr Boilerplate, aber meiner Meinung nach ist es besser, native Lösungen ohne die Teilnahme von Bibliotheken von Drittanbietern zu verwenden, es sei denn, die Verwendung einer Lösung von Drittanbietern bietet einige </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">signifikante Ergebnisse</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vorteile. </font><font style="vertical-align: inherit;">Je mehr Abstraktionen oben sind, desto schwieriger ist es zu verstehen, was der Fehler ist, wenn ein Fehler auftritt. </font><font style="vertical-align: inherit;">Ich halte die Vorteile des Anbieters nicht für signifikant genug, um darauf umzusteigen. </font><font style="vertical-align: inherit;">Aber ich habe wenig Erfahrung in diesem Bereich, daher ist es wahrscheinlich, dass ich das Lager in Zukunft wechseln werde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, über Redux, und so weiß jeder alles, also gibt es nichts zu sagen. </font><font style="vertical-align: inherit;">Außerdem habe ich es aus der Anwendung herausgeschnitten :) Ich habe es verwendet, um mein Konto zu verwalten, aber als ich merkte, dass es in diesem Fall keine besonderen Vorteile gegenüber dem Block gibt, habe ich es ausgeschnitten, um nicht zu viel zu ziehen. </font><font style="vertical-align: inherit;">Aber im Allgemeinen halte ich Redux für eine nützliche Sache für die Verwaltung des globalen Staates.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der qualvollste Teil</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was kann ich tun, wenn der Benutzer eine Nachricht gesendet hat, die Internetverbindung jedoch vor dem Senden unterbrochen wurde? Was kann ich tun, wenn der Benutzer eine Lesebestätigung erhalten hat, die Anwendung jedoch geschlossen hat, bevor der entsprechende Datensatz in der Datenbank aktualisiert wurde? Was soll ich tun, wenn der Benutzer seinen Freund in das Zimmer eingeladen hat, aber bevor die Einladung gesendet wurde, ist seine Batterie leer? Haben Sie jemals ähnliche Fragen gestellt? Hier bin ich. Vor. Aber im Entwicklungsprozess begann ich mich zu wundern. Da die Verbindung jederzeit unterbrochen werden kann und das Telefon jederzeit ausgeschaltet wird, muss </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alles bestätigt werden</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Kein Spaß. Daher </font></font><code>Join</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lautet </font><font style="vertical-align: inherit;">die allererste Nachricht, die der Client an den Server sendet ( </font><font style="vertical-align: inherit;">wenn Sie sich erinnern), nicht nur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Hallo, ich bin online"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sondern </font><i><font style="vertical-align: inherit;">"Hallo"</font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Hallo, ich bin online und hier sind unbestätigte Zimmer, hier sind unbestätigte Bestätigungen, hier sind unbestätigte Zimmermitgliedschaftsvorgänge und hier sind die zuletzt empfangenen Nachrichten pro Zimmer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><i><font style="vertical-align: inherit;">" </font></i><font style="vertical-align: inherit;">Und der Server antwortet mit einem ähnlichen Blatt: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">„Während Sie offline waren, wurden solche und solche Nachrichten von solchen und solchen Benutzern gelesen, und sie luden auch Petja in diesen Raum ein, und Sveta verließ diesen Raum, und Sie wurden in diesen Raum eingeladen, aber zu Diese beiden Räume haben 40 neue Stellen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><i><font style="vertical-align: inherit;">“ </font></i><font style="vertical-align: inherit;">Ich würde wirklich gerne wissen, wie ähnliche Dinge in anderen Messenger gemacht werden, weil meine Implementierung nicht mit Anmut glänzt.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bilder</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Moment können Sie Text, Text + Bilder und nur Bilder senden. </font><font style="vertical-align: inherit;">Der Video-Upload wurde noch nicht implementiert. </font><font style="vertical-align: inherit;">Bilder werden etwas komprimiert und im Firebase-Speicher gespeichert. </font><font style="vertical-align: inherit;">Die Nachricht selbst enthält Links. </font><font style="vertical-align: inherit;">Nach Erhalt der Nachricht lädt der Client Bilder herunter, generiert Miniaturansichten und speichert alles im Dateisystem. </font><font style="vertical-align: inherit;">Dateipfade werden in die Datenbank geschrieben. </font><font style="vertical-align: inherit;">Die Generierung von Miniaturansichten ist übrigens der einzige Code, der in einem separaten Thread ausgeführt wird, da es sich um eine rechenintensive Operation handelt. </font><font style="vertical-align: inherit;">Ich starte einfach einen Worker-Stream, füttere ihn mit einem Bild und bekomme dafür eine Miniaturansicht. </font><font style="vertical-align: inherit;">Der Code ist extrem einfach, da Dart praktische Abstraktionen für die Arbeit mit Streams bietet.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ThumbnailGeneratorService</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThumbnailGeneratorService</span> </span>{<font></font>
  SendPort _sendPort;<font></font>
  final Queue&lt;Completer&lt;Uint8List&gt;&gt; _completerQueue =<font></font>
      Queue&lt;Completer&lt;Uint8List&gt;&gt;();<font></font>
<font></font>
  ThumbnailGeneratorService() {<font></font>
    <span class="hljs-keyword">var</span> receivePort = ReceivePort();<font></font>
    Isolate.spawn(startWorker, receivePort.sendPort);<font></font>
<font></font>
    receivePort.listen((data) {<font></font>
      <span class="hljs-keyword">if</span> (data is SendPort) {<font></font>
        _sendPort = data;<font></font>
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">var</span> completer = _completerQueue.removeFirst();<font></font>
        completer.complete(data);<font></font>
      }<font></font>
    });<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> startWorker(SendPort sendPort) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">var</span> receivePort = ReceivePort();<font></font>
    sendPort.send(receivePort.sendPort);<font></font>
<font></font>
    receivePort.listen((imageBytes) {<font></font>
      Image image = decodeImage(imageBytes);<font></font>
      Image thumbnail = copyResize(image, <span class="hljs-attr">width</span>: min(image.width, <span class="hljs-number">200</span>));<font></font>
<font></font>
      sendPort.send(Uint8List.fromList(encodePng(thumbnail)));<font></font>
    });<font></font>
  }<font></font>
<font></font>
  Future&lt;Uint8List&gt; generate(Uint8List imageBytes) {<font></font>
    <span class="hljs-keyword">var</span> completer = Completer&lt;Uint8List&gt;();<font></font>
    _completerQueue.add(completer);<font></font>
    <font></font>
    _sendPort.send(imageBytes);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> completer.future;<font></font>
  }<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Firebase-Authentifizierung wird ebenfalls verwendet, jedoch nur zur Autorisierung des Zugriffs auf den Firebase-Speicher (damit der Benutzer das Profilbild beispielsweise nicht an eine </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">andere Person</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ausfüllen kann </font><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Alle anderen Autorisierungen erfolgen über meine Server.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachrichtenformat</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie sind hier wahrscheinlich entsetzt, da ich normale Byte-Arrays verwende. Json verschwindet, weil Effizienz erforderlich ist und ich zu Beginn nichts über Protobuf wusste. Die Verwendung von Arrays erfordert viel Sorgfalt, da ein Index falsch ist und die Dinge schief gehen. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die ersten 4 Bytes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sind die Länge der Nachricht. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das nächste Byte</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist der Nachrichtencode. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die nächsten 16 Bytes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sind die Anforderungskennung (UUID). </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die nächsten 40 Bytes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sind das Autorisierungstoken. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Rest der Nachricht</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachrichtenlänge</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erforderlich, da ich keine http- oder Web-Sockets oder ein anderes Protokoll verwende, das die Trennung einer Nachricht von einer anderen ermöglicht. Meine Frontend-Server sehen nur Byte-Streams und müssen wissen, wo eine Nachricht endet und eine andere beginnt. Es gibt verschiedene Möglichkeiten, Nachrichten zu trennen (verwenden Sie beispielsweise ein Zeichen, das in Nachrichten nie als Trennzeichen gefunden wurde), aber ich habe es vorgezogen, die Länge anzugeben, da diese Methode die einfachste ist, obwohl sie mit Overhead verbunden ist, da die meisten Nachrichten fehlen und ein Byte zur Angabe der Länge. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Nachrichtencode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist nur eines der Mitglieder der Aufzählung</font></font><code>MessageCode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Das Routing wird gemäß dem Code ausgeführt. Da wir den Code ohne vorherige Deserialisierung aus dem Array extrahieren können, entscheidet der Frontend-Server, in welchem ​​Thema der Kafka eine Nachricht gesendet werden soll, anstatt diese Verantwortung an eine andere Person zu delegieren. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anfrage ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in den meisten Beiträgen vorhanden, aber nicht in allen. Es führt zwei Funktionen aus: Mit dieser Kennung stellt der Client die Entsprechung zwischen der gesendeten Anforderung und der empfangenen Antwort her (wenn der Client die Nachrichten A, B, C in dieser Reihenfolge gesendet hat, bedeutet dies nicht, dass die Antworten auch in der richtigen Reihenfolge vorliegen). Die zweite Funktion besteht darin, Duplikate zu vermeiden. Wie bereits erwähnt, garantiert kafka mindestens eine Lieferung. Das heißt, in seltenen Fällen können Nachrichten immer noch dupliziert werden. Durch Hinzufügen der Spalte RequestIdentifier mit einer eindeutigen Einschränkung zur gewünschten Datenbanktabelle können Sie das Einfügen eines Duplikats vermeiden. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autorisierungstoken</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ist eine UserId (8 Bytes) + 32 Bytes HmacSha256-Signatur. </font><font style="vertical-align: inherit;">Ich denke nicht, dass es sich lohnt, Jwt hier zu verwenden. </font><font style="vertical-align: inherit;">Jwt ist ungefähr 7-8 mal größer für was? </font><font style="vertical-align: inherit;">Meine Benutzer haben keine Ansprüche, daher ist eine einfache hmac-Signatur in Ordnung. </font><font style="vertical-align: inherit;">Eine Autorisierung durch andere Dienste ist und ist nicht geplant.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Audio- und Videoanrufe</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist lustig, dass ich die Implementierung von Audio- und Videoanrufen absichtlich verschoben habe, weil ich sicher war, dass ich die Probleme nicht lösen kann, aber tatsächlich stellte sich heraus, dass dies eine der am einfachsten zu implementierenden Funktionen ist. </font><font style="vertical-align: inherit;">Zumindest die Grundfunktionalität. </font><font style="vertical-align: inherit;">Im Allgemeinen dauerte das Hinzufügen von WebRtc zur Anwendung und das Abrufen der ersten Videositzung nur wenige Stunden, und auf wundersame Weise war der erste Test erfolgreich. </font><font style="vertical-align: inherit;">Vorher dachte ich, dass der Code, der beim ersten Mal funktionierte, ein Mythos war. </font><font style="vertical-align: inherit;">Normalerweise schlägt der erste Test einer neuen Funktion immer aufgrund eines dummen Fehlers wie "Dienst hinzugefügt, aber nicht in einem DI-Container registriert" fehl.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nicht sehr kurz über WebRtc für Uneingeweihte</font></font></b><div class="spoiler_text">WebRtc —  ,   peer-to-peer    , ,    peer-to-peer  ,     .   - ,     ,      .      ,      .<br>
<br>
          (peer-to-peer),     <i></i> ,  3   (     <i></i> ,  3  .           3 ).<br>
<br>
    — stun .   stun  ,    —  Source IP  Source Port      ,    <i></i> .    ?        - .       IP .      - , ,    ,   Source IP  Source Port    IP  -        NAT  [ Source IP | Source Port | Router External IP | Router Port ].     - ,   Dest IP  Dest Port     Router External IP  Router Port  NAT, ,    Source IP — Source Port     ,   .   , ,       ,      , ,    ,      NAT .       stun     NAT .     stun     Router External IP — Router Port.   — <i></i>   .     ,  «»    NAT (NAT traversal)  ,      NAT  ,     stun .<br>
*  NAT ,      . ,     ,  WebRtc    .<br>
<br>
  — turn.  ,       ,   peer-to-peer . Fallback .    , ,  ,  ,   ,   peer-to-peer     .    turn  — coturn,      .<br>
<br>
  — .    <i> </i>  ,    .       ,    .   —           .       .    ,          , ,     :)       —   .<br>
<br>
 WebRtc  3   : offer, answer  candidate.    offer     ,    answer,       .    , ,  ,    ,       .    (     )   ,  .<br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die WebRtc-Technologie selbst stellt eine Verbindung her und leitet Datenströme hin und her. Dies ist jedoch kein Rahmen für die Erstellung vollwertiger Anrufe. Mit Anruf meine ich eine Kommunikationssitzung mit der Möglichkeit, den Anruf abzubrechen, abzulehnen und anzunehmen sowie aufzulegen. Außerdem müssen Sie dem Anrufer mitteilen, ob die andere Seite bereits besetzt ist. Und auch um kleine Dinge wie "Warten Sie auf eine Antwort auf den Anruf N Sekunden, dann zurücksetzen" zu implementieren. Wenn Sie WebRtc einfach in bloßer Form in der Anwendung implementieren, werden bei einem eingehenden Anruf Kamera und Video spontan eingeschaltet, was natürlich nicht akzeptabel ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In seiner reinen Form bedeutet WebRtc normalerweise, Kandidaten so schnell wie möglich an die andere Partei zu senden, damit die Verhandlungen so schnell wie möglich beginnen, was logisch ist. In meinen Tests sind Kandidaten für die empfangende Partei in der Regel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">immer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">begann zu kommen, noch bevor das Angebot kommt. Solche „frühen“ Kandidaten können nicht verworfen werden, sie müssen in Erinnerung bleiben, damit sie später, wenn das Angebot eintrifft und </font></font><code>RTCPeerConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erstellt wird, zur Verbindung hinzugefügt werden. Die Tatsache, dass Kandidaten möglicherweise bereits vor dem Angebot eintreffen, sowie einige andere Gründe machen die Umsetzung vollwertiger Anrufe zu einer nicht trivialen Aufgabe. Was tun, wenn mehrere Benutzer gleichzeitig anrufen? Wir werden Kandidaten von allen erhalten, und obwohl wir Kandidaten von einem Benutzer von einem anderen trennen können, wird unklar, welche Kandidaten abzulehnen sind, da wir nicht wissen, wessen Angebot früher kommen wird. Es wird auch Probleme geben, wenn Kandidaten zu uns kommen und dann ein Angebot, wenn wir </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selbst</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> jemanden anrufen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem ich mehrere Optionen mit Bare WebRtc getestet hatte, kam ich zu dem Schluss, dass der Versuch, Anrufe in dieser Form zu tätigen, problematisch und mit Speicherlecks behaftet ist. Daher beschloss ich, dem WebRtc-Verhandlungsprozess eine weitere Stufe hinzuzufügen. Ich nenne diese Bühne </font></font><code>Inquire - Grant/Refuse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Idee ist sehr einfach, aber ich habe eine ganze Weile gebraucht, um sie zu erreichen. Der Anrufer </font><font style="vertical-align: inherit;">sendet </font><font style="vertical-align: inherit;">bereits vor dem Erstellen des Streams und </font></font><code>RTCPeerConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(und im Allgemeinen vor dem Ausführen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">von</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Code im Zusammenhang mit WebRtc) eine Nachricht über den Signalserver an die andere Seite </font></font><code>Inquire</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Auf der Empfangsseite wird geprüft, ob sich der Benutzer gerade in einer anderen Kommunikationssitzung befindet (einfaches </font></font><code>bool</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feld). Wenn dies der Fall ist, wird eine Nachricht zurückgesendet.</font></font><code>Refuse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auf diese Weise teilen wir dem Anrufer mit, dass der Benutzer beschäftigt ist, und dem Empfänger, dass das eine oder andere Telefon angerufen wurde, während er mit einem anderen Gespräch beschäftigt war. Wenn der Benutzer derzeit frei ist, ist er </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reserviert</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Die </font></font><code>Inquire</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sitzungskennung wird </font><font style="vertical-align: inherit;">in der Nachricht </font><font style="vertical-align: inherit;">gesendet, und diese Kennung wird als Kennung der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aktuellen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sitzung festgelegt. Wenn der Benutzer reserviert ist, lehnt er alle </font></font><code>Inquire/Offer/Candidate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachrichten mit anderen Sitzungskennungen als der aktuellen ab. Nach der Reservierung sendet der Empfänger eine Nachricht über den Signalserver an den Anrufer </font></font><code>Grant</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Es ist anzumerken, dass dieser Vorgang für den empfangenden Benutzer nicht sichtbar ist, da noch kein Anruf erfolgt. Und die Hauptsache hier ist nicht zu vergessen, eine Auszeit auf der Empfangsseite aufzuhängen. Plötzlich werden wir eine Sitzung reservieren und es wird kein Angebot folgen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Anrufer empfängt </font></font><code>Grant</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, und hier beginnt WebRtc mit Angeboten, Kandidaten, und dies ist für alle da. </font><font style="vertical-align: inherit;">Das Angebot fliegt zum Empfänger und er zeigt nach Erhalt einen Bildschirm mit den Schaltflächen Antworten / Ablehnen an. </font><font style="vertical-align: inherit;">Aber die Kandidaten erwarten wie immer niemanden. </font><font style="vertical-align: inherit;">Sie kommen wieder früher als das Angebot an, da es keinen Grund gibt, darauf zu warten, dass der Benutzer den Anruf entgegennimmt. </font><font style="vertical-align: inherit;">Er kann nicht antworten, aber ablehnen oder warten, bis das Zeitlimit abgelaufen ist - dann werden die Kandidaten einfach rausgeworfen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aktueller Status und zukünftige Pläne</font></font></h2><br>
<ul>
<li><font color="#009c50"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Privat- und Gruppenchats</font></font></font></li>
<li><font color="#009c50"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Senden von Text, Bildern</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und Videos</font></font></li>
<li><font color="#009c50"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Audio- und Videoanrufe</font></font></font></li>
<li><font color="#009c50"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Empfangsbestätigung und Lesen</font></font></font></li>
<li><font color="#009c50"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Drucke ..."</font></font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benachrichtigungen</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suche nach QR-Code und Geolocation</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Suche nach QR-Code ist unerwartet problematisch zu implementieren, da fast alle Plugins für den Code-Scan, die ich versucht habe, nicht gestartet werden können oder nicht richtig funktionieren. </font><font style="vertical-align: inherit;">Aber ich denke, die Probleme werden hier gelöst. </font><font style="vertical-align: inherit;">Und für die Umsetzung der Suche nach Geolocation habe ich noch nicht aufgenommen. </font><font style="vertical-align: inherit;">Theoretisch sollte es keine besonderen Probleme geben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Laufende Benachrichtigungen sowie das Senden von Videos.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was muss noch getan werden?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oh, viel. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstens</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gibt es keine Tests. Die Kollegen haben früher Tests geschrieben, also habe ich mich völlig entspannt. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zweitens</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist es derzeit nicht möglich </font><b><font style="vertical-align: inherit;">,</font></b><font style="vertical-align: inherit;"> Benutzer zu einem vorhandenen Chat einzuladen und den Chat zu verlassen. Der Servercode ist dafür bereit, der Clientcode nicht. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Drittens,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wenn die Fehlerbehandlung auf dem Server mehr oder weniger ist, gibt es keine Fehlerbehandlung auf dem Client. Es reicht nicht aus, nur einen Protokolleintrag zu erstellen, sondern Sie müssen den Vorgang wiederholen. Jetzt ist beispielsweise der Mechanismus zum erneuten Senden von Nachrichten nicht implementiert. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Viertens pingt der</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Server den Client nicht an, sodass eine Trennung nicht erkannt wird, wenn beispielsweise der Client das Internet verloren hat. Die Trennung wird nur erkannt, wenn der Client die Anwendung schließt. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fünftens werden</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Indizes nicht in der Datenbank verwendet.</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sechstens</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Optimierung. Der Code hat eine große Anzahl von Stellen, an denen so etwas geschrieben ist </font></font><code>// @@TODO: Pool</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Die meisten Arrays sind genau </font></font><code>new</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">das. Der Backend-Server erstellt viele Arrays mit fester Länge. Hier können und sollten Sie den Pool verwenden. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Siebtens</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gibt es viele Stellen auf dem Client, an denen der Code </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">endet, obwohl dies nicht erforderlich ist. Das Senden von Bildern zum Beispiel scheint daher langsam, weil der Code</font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es speichert Bilder im Dateisystem und generiert Miniaturansichten, bevor die Nachricht angezeigt wird, obwohl dies nicht erforderlich ist. Wenn Sie beispielsweise die Anwendung öffnen und während Ihrer Abwesenheit Bilder an Sie gesendet werden, ist der Start langsam, da alle diese Bilder erneut heruntergeladen, im System gespeichert, Miniaturansichten generiert werden und erst danach der Start beendet wird und Sie vom Begrüßungsbildschirm geworfen werden auf dem Startbildschirm. Alle diese redundanten Funktionen </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wurden zum einfacheren Debuggen erstellt, aber natürlich müssen Sie unnötiges Warten vor der Veröffentlichung vermeiden. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Achte</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Benutzeroberfläche ist jetzt zur Hälfte fertig, da ich nicht entschieden habe, wie ich sie sehen möchte. Daher ist jetzt nicht alles intuitiv, die Hälfte der Schaltflächen ist unklar, was sie tun. Und die Tasten werden oft nicht beim ersten Mal gedrückt, da sie jetzt nur noch Symbole mit </font></font><code>GestureDetector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und ohne Polsterung sind, sodass es nicht immer möglich ist, darauf zuzugreifen. Außerdem ist der Pixelüberlauf an einigen Stellen nicht behoben. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Neuntens ist es</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> jetzt sogar unmöglich, sich bei einem Konto </font><b><font style="vertical-align: inherit;">anzumelden,</font></b><font style="vertical-align: inherit;"> sondern nur noch bei der Anmeldung. Wenn Sie die Anwendung deinstallieren und neu installieren, können Sie sich daher nicht in Ihrem Konto anmelden :) </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zehntens wird</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> der Bestätigungscode nicht an die E-Mail gesendet. Jetzt ist der Code im Allgemeinen immer derselbe, da das Debuggen einfacher ist. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elfte</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Prinzip der Einzelverantwortung wird vielerorts verletzt. Benötigen Sie einen Refactor. Die Klassen, die für die Interaktion mit der Datenbank verantwortlich sind (sowohl auf dem Client als auch auf dem Server), sind im Allgemeinen sehr aufgebläht, da sie an </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">allen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Datenbankoperationen beteiligt sind. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zwölftens</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erwartet </font><b><font style="vertical-align: inherit;">der</font></b><font style="vertical-align: inherit;"> Frontend-Server jetzt immer eine Antwort vom Backend-Server, auch wenn die Nachricht kein Senden einer Antwort impliziert (z. B. eine Nachricht mit einem Code </font></font><code>IsTyping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und einige WebRtc-bezogene Nachrichten). Ohne auf eine Antwort zu warten, schreibt er daher einen Fehler in die Konsole, obwohl dies kein Fehler ist. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dreizehnte,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vollständige Bilder werden nicht beim Tippen geöffnet. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einhundert Millionen Fünftel</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einige Nachrichten, die stapelweise gesendet werden müssen, werden separat gesendet. Gleiches gilt für einige Datenbankoperationen. Anstatt einen einzelnen Befehl auszuführen, werden die Befehle in einer Schleife mit </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(brr ..) ausgeführt. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einhundert Millionen Sechstel,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> einige Werte sind fest codiert, anstatt konfigurierbar zu sein. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einhundertein Million Siebtel</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Anmeldung am Server erfolgt jetzt nur noch an der Konsole und auf dem Client im Allgemeinen direkt am Widget. Auf dem Hauptbildschirm befindet sich eine Registerkarte "Protokolle", auf der alle Protokolle gelöscht werden. Tatsache ist, dass meine Arbeitsmaschine sich weigert, sowohl den Emulator als auch alles für den Server Notwendige (Kafka, Datenbank, Rettich und alle Server) auszuführen. Die Belastung mit einem angeschlossenen Gerät hat auch nicht geklappt, in der Hälfte der Fälle hing alles fest, weil der Computer die Lasten nicht bewältigen konnte. Daher müssen Sie jedes Mal einen Build erstellen, ihn auf dem Gerät ablegen, installieren und so testen. Um die Protokolle anzuzeigen, lege ich sie direkt in das Widget. Perversion, ich weiß, aber es gibt keine Wahl. Aus dem gleichen Grund geben viele Methoden </font></font><code>Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und zurück</font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie sind (um die Ausnahme zu fangen und in das Widget zu werfen), obwohl sie es nicht sollten. Wenn Sie sich den Code ansehen, werden Sie </font></font><code>_logError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in vielen Klassen </font><font style="vertical-align: inherit;">eine hässliche </font><font style="vertical-align: inherit;">Methode sehen, die dies tut. Dies wird natürlich auch in den Papierkorb gelangen. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einhundert Millionen und acht,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> keine Geräusche. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einhundert Millionen und neunten müssen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie mehr Caching verwenden. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einhundert Millionen Zehntel,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> viel sich wiederholender Code. Beispielsweise überprüfen viele Aktionen zunächst die Gültigkeit des Tokens, und wenn es nicht gültig ist, senden sie einen Fehler. Ich denke, Sie müssen eine einfache Middleware-Pipeline implementieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und viele kleine Dinge, wie das Verketten von Strings anstelle von </font></font><code>StringBuilder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'a,</font></font><code>Dispose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nicht überall heißt es, wo es soll, und so weiter und so fort. </font><font style="vertical-align: inherit;">Im Allgemeinen befindet sich der Normalzustand des Projekts in der Entwicklung. </font><font style="vertical-align: inherit;">All das ist lösbar, aber es gibt ein grundlegendes Problem, über das ich bis zum letzten Moment nicht nachgedacht habe, weil es mir aus dem Kopf ging - der Messenger sollte auch dann funktionieren, wenn die Anwendung nicht geöffnet ist und meiner nicht funktioniert. </font><font style="vertical-align: inherit;">Um ehrlich zu sein, ist mir die Lösung dieses Problems noch nicht in den Sinn gekommen. </font><font style="vertical-align: inherit;">Hier kann man anscheinend nicht auf den nativen Code verzichten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich würde die Bereitschaft des Projekts mit 70% bewerten.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zusammenfassung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seit Beginn der Projektarbeiten sind sechs Monate vergangen. </font><font style="vertical-align: inherit;">Kombiniert mit Teilzeitarbeit und langen Pausen, aber trotzdem viel Zeit und Energie. </font><font style="vertical-align: inherit;">Ich plane, alle deklarierten Funktionen zu implementieren und etwas Ungewöhnliches wie Tic-Tac-Toe oder Entwürfe direkt im Raum hinzuzufügen. </font><font style="vertical-align: inherit;">Ohne Grund, nur weil es interessant ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie Fragen haben, schreiben Sie. </font><font style="vertical-align: inherit;">Mail ist auf Github.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de490054/index.html">17 Überraschungen für mein erstes Jahr mit dem Tesla Model 3</a></li>
<li><a href="../de490056/index.html">Black Box: Protokollierung vergessen</a></li>
<li><a href="../de490060/index.html">Wissensdiagramm suchen: Aufbau aus mehreren Quellen</a></li>
<li><a href="../de490066/index.html">Von China zum Südpol: Gemeinsam das Neutrino-Massen-Rätsel lösen</a></li>
<li><a href="../de490068/index.html">Fälschung von Zufälligkeit und Transformation durch Sortieren von Pseudozufallssequenzen</a></li>
<li><a href="../de490076/index.html">Sportklassifikation von E-Sport-Disziplinen</a></li>
<li><a href="../de490080/index.html">Как конкуренты могут легко заблокировать ваш сайт</a></li>
<li><a href="../de490082/index.html">Genetische Code-Analyse I.</a></li>
<li><a href="../de490084/index.html">Grundlegendes zur ECMAScript-Spezifikation, Teil 1</a></li>
<li><a href="../de490086/index.html">Anfänger Surf Guide oder Programmiererleben in Portugal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>