<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🗺️ 🚵🏼 🤦🏼 嵌入式Rust。使用STM32F103C8T6（Black Pill）调试板为Cortex-M3处理器开发 ☝🏿 👨🏽‍💼 ⛹🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="你好！我想向您介绍Rust Embedded项目。它允许我们使用Rust编程语言进行嵌入式平台（嵌入式Linux / RTOS / Bare Metal）的开发。
 
 
 在本文中，我们将考虑开始开发Cortex-M3微处理器所需的组件。之后，我们将编写一个简单的示例-内置LED闪烁。
 
 为此...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>嵌入式Rust。使用STM32F103C8T6（Black Pill）调试板为Cortex-M3处理器开发</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495948/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">你好！</font><font style="vertical-align: inherit;">我想向您介绍</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rust Embedded</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它允许我们使用Rust编程语言进行嵌入式平台（嵌入式Linux / RTOS / Bare Metal）的开发。</font></font><br>
<img src="https://habrastorage.org/webt/sh/5h/se/sh5hsergasrx_filqfoqh-yrbyu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在本文中，我们将考虑开始开发Cortex-M3微处理器所需的组件。</font><font style="vertical-align: inherit;">之后，我们将编写一个简单的示例-内置LED闪烁。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为此，我们需要价格合理且便宜的中文调试板STM32F103C8T6或Black Pill（由于黑色和小尺寸）。</font><font style="vertical-align: inherit;">还有一个蓝色的董事会版本-Blue Pill。</font><font style="vertical-align: inherit;">我不建议这样做，因为我听说它的电阻器错误，这会在使用USB端口时引起问题。</font><font style="vertical-align: inherit;">它与Black Pill的第二个区别是引脚排列（结论）。</font><font style="vertical-align: inherit;">但是稍后会更多。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们还将需要一个用于STM32调试板的程序员。</font><font style="vertical-align: inherit;">在本文中，我们将使用价格低廉的中文ST-Link V2编程器。</font></font><br>
<img src="https://habrastorage.org/webt/cb/rg/eu/cbrgeuyxins21rilbd3ayspihrg.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rust编译器版本</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，您需要确保编译器版本为1.31或更高版本。</font><font style="vertical-align: inherit;">您可以通过输入以下命令来检查编译器版本：</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; rustc --version</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组件安装</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在我们可以开始安装必要的组件。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GNU Arm嵌入式工具链</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将需要用于ARM芯片的调试器-arm-none-eabi-gdb。</font><font style="vertical-align: inherit;">启动安装程序，然后按照说明进行操作。</font><font style="vertical-align: inherit;">在安装结束时，请确保选中“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将路径添加到环境变量</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” </font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载链接</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
安装后，您可以通过在命令行中输入以下内容来检查是否一切正常：</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; arm-none-eabi-gdb -v</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果一切正常，那么您将看到已安装组件的版本。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ST-Link驱动程序</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们继续为ST-Link编程器安装驱动程序。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按照安装程序的说明进行操作，并确保安装正确</font><font style="vertical-align: inherit;">的驱动程序版本</font><font style="vertical-align: inherit;">（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">六十四位</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">三十二位</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），具体取决于操作系统的位深度。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接下载</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ST-Link工具</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下一步是安装固件所需的工具-ST-Link Tools。</font><font style="vertical-align: inherit;">下载档案并将其解压缩到任何方便的位置，您还需要</font><font style="vertical-align: inherit;">在环境变量“ </font><b><font style="vertical-align: inherit;">PATH</font></b><font style="vertical-align: inherit;"> ”中</font><font style="vertical-align: inherit;">指定</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bin</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子文件夹</font><font style="vertical-align: inherit;">（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stlink-1.3.0 \ bin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">路径</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接下载</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">货仓</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最后，安装软件包cargo-binutils，这是通过控制台中的两个命令完成的。</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; cargo install cargo-binutils<font></font>
&gt; rustup component add llvm-tools-preview</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这样就完成了组件的安装。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建和设置项目</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要继续，我们需要创建一个名为“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stm32f103c8t6</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” </font><font style="vertical-align: inherit;">的新项目</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">让我提醒您，这是通过以下命令完成的：</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; cargo new stm32f103c8t6</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目依赖性和优化</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cargo.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中连接必要的库</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="json hljs">[package]<font></font>
name = <span class="hljs-string">"stm32f103c8t6"</span>
version = <span class="hljs-string">"0.1.0"</span>
authors = [<span class="hljs-string">"Nick"</span>]<font></font>
edition = <span class="hljs-string">"2018"</span><font></font>
<font></font>
#      Cortex-M3<font></font>
[dependencies]<font></font>
cortex-m = <span class="hljs-string">"*"</span>
cortex-m-rt = <span class="hljs-string">"*"</span>
cortex-m-semihosting = <span class="hljs-string">"*"</span>
panic-halt = <span class="hljs-string">"*"</span>
nb = <span class="hljs-string">"0.1.2"</span>
embedded-hal = <span class="hljs-string">"0.2.3"</span><font></font>
<font></font>
#       stm32f1<font></font>
[dependencies.stm32f1xx-hal]<font></font>
version = <span class="hljs-string">"0.5.2"</span>
features = [<span class="hljs-string">"stm32f100"</span>, <span class="hljs-string">"rt"</span>]<font></font>
<font></font>
#   `cargo fix`!<font></font>
[[bin]]<font></font>
name = <span class="hljs-string">"stm32f103c8t6"</span>
test = <span class="hljs-literal">false</span>
bench = <span class="hljs-literal">false</span><font></font>
<font></font>
#   <font></font>
[profile.release]<font></font>
codegen-units = <span class="hljs-number">1</span> #  <font></font>
debug = <span class="hljs-literal">true</span> #  ,     Flash <font></font>
lto = <span class="hljs-literal">true</span> #  </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此外，您可以看到在文件末尾，已启用代码优化。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cortex-m-rt库要求我们在项目的根目录中创建一个文件，该文件必须称为“ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memory.x</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”。</font><font style="vertical-align: inherit;">它指示我们的设备有多少内存及其地址：</font></font><br>
<br>
<pre><code class="json hljs">MEMORY<font></font>
{<font></font>
 FLASH : ORIGIN = <span class="hljs-number">0x08000000</span>, LENGTH = 64K<font></font>
 RAM : ORIGIN = <span class="hljs-number">0x20000000</span>, LENGTH = 20K<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置目标平台和默认编译目标</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必须为编译器设置目标平台，这是通过以下命令完成的：</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; rustup target add thumbv7m-none-eabi</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
之后，</font><font style="vertical-align: inherit;">在根目录中</font><font style="vertical-align: inherit;">创建“ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.cargo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” </font><font style="vertical-align: inherit;">文件夹</font><font style="vertical-align: inherit;">，并在其中创建“ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">config</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” </font><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">。</font><i><font style="vertical-align: inherit;">配置</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
文件的内容</font><font style="vertical-align: inherit;">：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="json hljs">[target.thumbv7m-none-eabi]<font></font>
<font></font>
[target.'cfg(all(target_arch = <span class="hljs-string">"arm"</span>, target_os = <span class="hljs-string">"none"</span>))']<font></font>
<font></font>
rustflags = [<span class="hljs-string">"-C"</span>, <span class="hljs-string">"link-arg=-Tlink.x"</span>]<font></font>
<font></font>
[build]<font></font>
target = <span class="hljs-string">"thumbv7m-none-eabi"</span>  # Cortex-M3</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在其中，我们确定了默认的编译目标，这使我们可以</font><font style="vertical-align: inherit;">使用简单且熟悉的命令将</font><font style="vertical-align: inherit;">代码编译为ARM </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.elf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件：</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; cargo build --release</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为确保其正常工作，请考虑最简单的示例-使LED闪烁。</font><i><font style="vertical-align: inherit;">main.rs</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
文件的内容</font><font style="vertical-align: inherit;">：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="rust hljs"><span class="hljs-meta">#![deny(unsafe_code)]</span>
<span class="hljs-meta">#![no_std]</span>
<span class="hljs-meta">#![no_main]</span><font></font>
<font></font>
<span class="hljs-keyword">use</span> panic_halt <span class="hljs-keyword">as</span> _;<font></font>
<font></font>
<span class="hljs-keyword">use</span> nb::block;<font></font>
<font></font>
<span class="hljs-keyword">use</span> stm32f1xx_hal::{<font></font>
    prelude::*,<font></font>
    pac,<font></font>
    timer::Timer,<font></font>
};<font></font>
<span class="hljs-keyword">use</span> cortex_m_rt::entry;
<span class="hljs-keyword">use</span> embedded_hal::digital::v2::OutputPin;<font></font>
<font></font>
<span class="hljs-comment">//   .</span>
<span class="hljs-meta">#[entry]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() -&gt; ! {<font></font>
    <font></font>
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">let</span> cp = cortex_m::Peripherals::take().unwrap();
    <span class="hljs-keyword">let</span> dp = pac::Peripherals::take().unwrap();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> flash = dp.FLASH.constrain();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> rcc = dp.RCC.constrain();<font></font>
<font></font>
    <span class="hljs-keyword">let</span> clocks = rcc.cfgr.freeze(&amp;<span class="hljs-keyword">mut</span> flash.acr);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> gpiob = dp.GPIOB.split(&amp;<span class="hljs-keyword">mut</span> rcc.apb2);<font></font>
<font></font>
    <span class="hljs-comment">//   b12   .</span>
    <span class="hljs-comment">//  "crh"      .</span>
    <span class="hljs-comment">//   0-7,    "crl".</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> led = gpiob.pb12.into_push_pull_output(&amp;<span class="hljs-keyword">mut</span> gpiob.crh);
    <span class="hljs-comment">//        .</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> timer = Timer::syst(cp.SYST, &amp;clocks)<font></font>
    .start_count_down(<span class="hljs-number">1</span>.hz());<font></font>
<font></font>
    <span class="hljs-comment">//     </span>
    <span class="hljs-comment">//    .</span>
    <span class="hljs-keyword">loop</span> {<font></font>
        block!(timer.wait()).unwrap();<font></font>
        led.set_high().unwrap();<font></font>
        block!(timer.wait()).unwrap();<font></font>
        led.set_low().unwrap();<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在第一行中，使用-属性</font></font><code>#![deny(unsafe_code)]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们消除了使用不安全代码的可能性。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在第二行中，我们放置了属性</font></font><code>#![no_std]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这是必需的，因为我们正在为裸机创建应用程序，并且标准库需要一个操作系统。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来是一个属性</font></font><code>#![no_main]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">该属性</font><font style="vertical-align: inherit;">告诉编译器我们没有使用带有参数vector和return type的默认默认函数。这没有任何意义，因为我们没有操作系统或其他运行时来调用函数并处理返回值。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在属性之后，我们将必要的模块插入范围。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来是一个函数，在我们的案例中，出于习惯，我们称其为-</font></font><code>main()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。这是程序的入口，由属性确定</font></font><code>#[entry]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在main函数内部，我们为“拥有”所有外围设备的外围对象创建一个句柄。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
之后，我们可以将负责板上内置LED的引脚设置为输出。由于我的情况是</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">黑色药丸</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">板</font><font style="vertical-align: inherit;">，因此其中的LED连接到引脚</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B12</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如果您有</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蓝色药丸</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">板</font><font style="vertical-align: inherit;">，则引脚</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C13</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">负责内置LED </font><font style="vertical-align: inherit;">。因此，我们将引脚</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B12</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">为推挽输出并将其分配给变量</font></font><code>led</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在我们可以为系统计时器设置更新事件触发时间，并将其保存在变量中</font></font><code>timer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在我们的示例中，这个时间是一秒钟。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后，在一个无穷循环中，我们可以描述程序的逻辑。</font><font style="vertical-align: inherit;">这很简单，首先</font></font><code>timer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阻止程序执行，直到经过指定的时间为止。</font><font style="vertical-align: inherit;">下一步是将内置LED的引脚设置为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">high</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，使其点亮。</font><font style="vertical-align: inherit;">之后，该程序的执行再次被同一计时器阻塞一秒钟。</font><font style="vertical-align: inherit;">并且LED的引脚设置为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">低电平</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此熄灭。</font><font style="vertical-align: inherit;">此外，该程序被循环重复。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汇编</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在我们已经弄清了程序代码和逻辑，我们可以</font><font style="vertical-align: inherit;">使用以下命令将</font><font style="vertical-align: inherit;">其编译成一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.elf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件：</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; cargo build --release</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此格式不仅包含二进制代码，还包含一些标头和更多内容。</font><font style="vertical-align: inherit;">当文件由其他软件（例如操作系统或引导程序）启动时，此功能很有用。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，要在裸机上运行程序，我们不需要</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.elf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">，而需要</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.bin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.bin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">是一种软件映像，可以按字节写入微控制器的内存。</font><font style="vertical-align: inherit;">可以</font><font style="vertical-align: inherit;">使用以下命令</font><font style="vertical-align: inherit;">将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.elf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">转换为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.bin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; cargo objcopy --bin stm32f103c8t6 --target thumbv7m-none-eabi --release -- -O binary stm32f103c8t6.bin</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，我们的二进制文件已准备好用于固件。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将使用ST-Link V2编程器对开发板进行刷新。为此，您必须首先将其连接到板上。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在编程器外壳上，有一个插针连接器。您需要注意连接器中的切口，该切口也显示在图表上，以使您了解如何进行连接。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将</font><font style="vertical-align: inherit;">编程器</font><font style="vertical-align: inherit;">的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GND</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引脚与板上的相应引脚相连。 Ping </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SWDIO</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接到</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DIO</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引脚，</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SWCLK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引脚连接</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到CLK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将开发板连接到编程器后，我们可以将ST-Link连接到计算机。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接之前，请从板上断开所有其他电源的连接，如果有的话，否则可能会损坏板或计算机。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在我们可以检查连接：</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; st-info --descr</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在控制台中，我们应该看到“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F1中密度设备</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”行。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">固件</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（可选）在闪烁之前，如果上面有东西，您可以清除板子的内存：</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; st-flash erase</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最后，我们可以启动固件： </font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; st-flash write stm32f1.bin 0x8000000</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果一切操作正确，您应该会看到一个闪烁的LED。</font><font style="vertical-align: inherit;">恭喜你！</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结论</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，要刷新该板，必须使用顺序输入的以下命令集：</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; cargo build --release<font></font>
&gt; cargo objcopy --bin stm32f103c8t6 --target thumbv7m-none-eabi --release -- -O binary stm32f103c8t6.bin<font></font>
&gt; st-flash erase<font></font>
&gt; st-flash write stm32f1.bin 0x8000000</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了简化我们的生活，我们可以</font><font style="vertical-align: inherit;">使用这些命令</font><font style="vertical-align: inherit;">创建一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.bat</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件，然后从控制台运行它。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自作者</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您对这些指南感兴趣，欢迎访问我的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YouTube频道</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
另外，最近，我开通了</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegram频道</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在其中发布手册和书籍，新闻，幽默以及与Rust编程语言相关的其他内容的各种翻译。</font><font style="vertical-align: inherit;">在这里，您可以找到几个聊天室的链接，以便提出问题并获得帮助，提交项目或与志趣相投的人聊天。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
感谢您的关注！</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN495934/index.html">在家中的数据治理</a></li>
<li><a href="../zh-CN495938/index.html">机器学习文章精选：2020年3月的案例，指南和研究</a></li>
<li><a href="../zh-CN495942/index.html">节省时间，精力和工时</a></li>
<li><a href="../zh-CN495944/index.html">更新的TOP50（CIS超级计算机的等级）：动态和趋势</a></li>
<li><a href="../zh-CN495946/index.html">诺伯特·维纳（Norbert Wiener）：控制论之父</a></li>
<li><a href="../zh-CN495954/index.html">思科如何在远程访问模式和缺席的环境中运行20年？</a></li>
<li><a href="../zh-CN495956/index.html">得快点。优化IMAP电子邮件内容请求</a></li>
<li><a href="../zh-CN495960/index.html">只是AH-ny Wi-Fi。或我们如何在教育机构中构建Wi-Fi 6（AX）网络</a></li>
<li><a href="../zh-CN495962/index.html">Udalenka：他们打算如何在X5中切换到远程工作格式</a></li>
<li><a href="../zh-CN495966/index.html">荒谬的代码或“如何不写”</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>