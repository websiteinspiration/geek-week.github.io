<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚è±Ô∏è ‚öóÔ∏è üë®üèº‚Äçüåæ Assembling a portable magnetometer üìõ ‚õÑÔ∏è üöõ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Translation of an article from the Instructables training materials site A 
 
 
 
 magnetometer , sometimes also called a gaussometer, measures the st...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Assembling a portable magnetometer</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487740/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Translation of an article from the Instructables training materials site A </font></font></i><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/8d7/460/a59/8d7460a59fdaf80b0762c78817b8b772.jpg"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">magnetometer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sometimes also called a gaussometer, measures the strength of a magnetic field [ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in this case, magnetic induction / approx. perev.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]. This is a device necessary for measuring the strength of permanent magnets and electromagnets, as well as for establishing the field shape of non-trivial combinations of magnets. It is sensitive enough to detect the magnetization of metal objects. If the probe works fast enough, it will be able to detect time-varying fields from motors and transformers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mobile phones usually have a three-axis magnetometer, but it is optimized for a weak magnetic field of the Earth with a force of 1 Gauss = 0.1 mT [ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">millilitles</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] and is saturated in fields with induction of several mT. </font><font style="vertical-align: inherit;">It is usually not clear where exactly this sensor is located in the telephone, and it is often impossible to place it inside a bottleneck such as a magnet cut. </font><font style="vertical-align: inherit;">Moreover, it is better not to bring the smartphone to strong magnets at all.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article I will describe how to make the simplest portable magnetometer from common components: we need a linear Hall sensor, Arduino, a display and a button. </font><font style="vertical-align: inherit;">The total cost of the device does not exceed ‚Ç¨ 5, and it will measure induction from -100 to +100 mT with an error of 0.01 mT - much better than you might expect. </font><font style="vertical-align: inherit;">To obtain accurate absolute indicators, you will need to calibrate it: I will describe how this is done with the help of a long home-made solenoid.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 1: Hall Sensor</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Hall effect is</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> often used to measure magnetic fields. </font><font style="vertical-align: inherit;">When electrons pass through a conductor placed in a magnetic field, they are carried to the side, as a result of which a transverse potential difference appears in the conductor. </font><font style="vertical-align: inherit;">By choosing the material and geometry of the semiconductor correctly, you can get a measurable signal, which can then be amplified and produce a measurement of one component of the magnetic field. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I use SS49E as it is cheap and affordable. </font><font style="vertical-align: inherit;">What is worth noting from its </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Power: 2.7 - 6.5 V, which is perfectly compatible with 5 V for Arduino.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Zero signal: 2.25-2.75 V, approximately halfway between 0 and 5 V.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sensitivity: 1.0-1.75 mV / G, so calibration will be required to get accurate results.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Output voltage: 1.0 - 4.0 V (for operation from 5 V): the range is covered by the Arduino ADC.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Range: minimum ¬± 650 Gs, usually + / 1 1000 Gs.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Response time: 3 Œºs, that is, it is possible to carry out measurements with a frequency of tens of kHz.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Operating current: 6-10 mA, enough for a battery.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temperature error: 0.1% per degree Celsius. </font><font style="vertical-align: inherit;">It seems a little, but a deviation of 0.1% gives an error of 3 mT.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The sensor is compact, 4x3x3 mm, and measures the component of the magnetic field perpendicular to its front side. </font><font style="vertical-align: inherit;">It gives a positive value for fields going from the back to the front - for example, when it faces the south pole of a magnet. </font><font style="vertical-align: inherit;">The sensor has three contacts, +5 V, 0 V and the output is from left to right when viewed from the face.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 2: Required Materials</font></font></h2><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linear Hall Effect Sensor SS49E. </font><font style="vertical-align: inherit;">‚Ç¨ 1 for 10 pieces.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Arduino Uno with prototyping board or Arduino Nano without pins for the portable version.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Monochrome OLED display SSD1306 0.96 ‚Äùwith I2C interface.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Button.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For probe:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ballpoint pen or other durable tube.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3 thin wires slightly longer than the tube.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 12 cm heat shrink with a diameter of 1.5 mm.</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For portable version:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A large Tic-Tac box (18x46x83) or something similar.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 9V battery contacts</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Switch.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 3: First Version - Using the Prototyping Board</font></font></h2><br>
<img src="https://habrastorage.org/getpro/habr/post_images/3d1/b9e/060/3d1b9e060c37f24ba82f85358912c3e3.jpg"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/498/73e/346/49873e346880c76c4f3fcb14e876a904.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, always build a prototype to test the operation of all components and software! </font><font style="vertical-align: inherit;">The connection is visible in the picture: the Hall sensor is connected to the contacts Arduino + 5V, GND, A1 (from left to right). </font><font style="vertical-align: inherit;">The display connects to GND, + 5V, A5, A4 (from left to right). </font><font style="vertical-align: inherit;">The button, when pressed, should close the ground and A0. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> written in Arduino IDE v. </font><font style="vertical-align: inherit;">1.8.10. </font><font style="vertical-align: inherit;">Requires installation of the Adafruit_SSD1306 and Adafruit_GFX libraries. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If everything is done correctly, the display should give DC and AC values.</font></font><br>
 <br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 4: A bit about code</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you are not interested in the code, you can skip this part. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A key feature of the code is that the magnetic field is measured 2,000 times in a row. It takes 0.2 - 0.3 seconds. By tracking the sum and square of the sum of the measurements, it is possible to calculate the mean and standard deviations, which are given out as DC and AC. Averaging over a large number of measurements, we increase the accuracy, theoretically, by ‚àö2000 ‚âà 45. It turns out that using a 10-bit ADC, we get the accuracy of a 15-bit ADC! And it matters: 1 step of the ADC is 4 mV, that is, ~ 0.3 mT. Due to averaging, we reduce the error from 0.3 mT to 0.01 mT. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a bonus, we get the standard deviation, thus determining the changing field. A field oscillating with a frequency of 50 Hz goes through about 10 cycles during the measurement, so you can measure the value of AC.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After compilation, I got the following statistics: Sketch uses 16852 bytes (54%) of program storage space. </font><font style="vertical-align: inherit;">Maximum is 30720 bytes. </font><font style="vertical-align: inherit;">Global variables use 352 bytes (17%) of dynamic memory, leaving 1696 bytes for local variables. </font><font style="vertical-align: inherit;">Maximum is 2048 bytes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Most of the space is occupied by Adafruit libraries, but there is still plenty of room to add functionality.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 5: Cooking the Probe</font></font></h2><br>
<img src="https://habrastorage.org/getpro/habr/post_images/d19/008/e3f/d19008e3f9fcfabf97268bf58a70fecc.jpg"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/da6/d48/2e7/da6d482e7cfadc535b0492dc4c65afa8.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The probe is best fixed at the end of a narrow tube: it will simply be placed and held in tight places. </font><font style="vertical-align: inherit;">Any tube made of non-magnetic material will do. </font><font style="vertical-align: inherit;">The old ballpoint pen was perfect for me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prepare three thin flexible wires slightly longer than the tube. </font><font style="vertical-align: inherit;">In my cable there is no logic in the colors of the wires (orange + 5 V, red 0 V, gray - signal), it's just easier for me to remember them. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To use a probe with a prototype, solder pieces of wire to the end of the cable and insulate them with heat shrink. </font><font style="vertical-align: inherit;">Later they can be cut off and soldered directly to the Arduino.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 6: Assembling the Portable Instrument</font></font></h2><br>
<img src="https://habrastorage.org/getpro/habr/post_images/976/994/2b1/9769942b113cbb832959d4425ab17ab0.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The 9V battery, OLED screen and Arduino Nano comfortably fit inside a large Tic-Tac box. Its advantage is transparency - the screen is easy to read, even when inside. All fixed components (probe, switch and button) are placed on the cover so that everything can be removed from the box to replace the battery or update the code.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I never liked 9V batteries - they have a high price and low capacity. </font><font style="vertical-align: inherit;">But in my supermarket, they suddenly started selling their rechargeable version of NiMH for ‚Ç¨ 1, and I found that they were easy to charge if I fed 11 V through a 100 Ohm resistor and left overnight. </font><font style="vertical-align: inherit;">I ordered cheap battery connectors for myself, but they did not send them to me, so I disassembled the old 9 V battery to make a connector out of it. </font><font style="vertical-align: inherit;">Plus 9V batteries in its compactness, and in that Arduino works well on it when connected to Vin. </font><font style="vertical-align: inherit;">At +5 V there will be an adjustable voltage of 5 V, which will be needed for the OLED and the Hall sensor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Hall sensor, screen and button are connected in the same way as on the prototype. </font><font style="vertical-align: inherit;">Only the power button is added, between the battery and the Arduino.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 7: Calibration</font></font></h2><br>
<img src="https://habrastorage.org/getpro/habr/post_images/4f6/b07/2d6/4f6b072d66483eb1c2c9258c8cf06bf2.jpg"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/30a/ba4/f6c/30aba4f6c0895616babf2d4798a18ab0.jpg"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/dc6/0c8/834/dc60c8834df02e6bd2cfb15d2ec3cc7b.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The calibration constant in the code corresponds to the number prescribed in the documentation (1.4 mV / G), however, the range of this value (1.0-1.75 mV / G) is allowed in the documentation. To get accurate results, you need to calibrate the probe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The easiest way to get a well-defined magnetic field is to use a solenoid. The magnetic induction of the solenoid field is B = Œº </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * n * I. The magnetic constant (or magnetic permeability of the vacuum) is a natural constant: Œº </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 1.2566 x 10 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-6</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T / m / A. The field is uniform and depends only on the winding density n and current I, which can be measured with an error of about 1%. The formula works for an solenoid of infinite length, but it serves as a very good approximation for the field in its center if the ratio of its length to diameter exceeds 10. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To assemble a suitable solenoid, take a hollow cylindrical pipe 10 times longer than the diameter and wind it from an insulated wires. I used a PVC tube with an external diameter of 23 mm and made 566 turns extending 20.2 cm, which gives us n = 28 / cm = 2800 / m. The wire length is 42 m, the resistance is 10 ohms.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apply power to the coil and measure the current with a multimeter. </font><font style="vertical-align: inherit;">Use either an adjustable current source or a variable resistor to control the current. </font><font style="vertical-align: inherit;">Measure the magnetic field for different current values ‚Äã‚Äãand compare the readings. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Before calibration, I received 6.04 mT / A, although in theory it should have been 3.50 mT / A. </font><font style="vertical-align: inherit;">Therefore, I multiplied the calibration constant in the 18th line of the code by 0.58. </font><font style="vertical-align: inherit;">Done - the magnetometer is calibrated!</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en487724/index.html">BlazingPizza: Blazor app from start to finish. Part 2. Add a component</a></li>
<li><a href="../en487728/index.html">@Pythonetc compilation, January 2020</a></li>
<li><a href="../en487730/index.html">Natural Language Processing. Results 2019 and trends for 2020</a></li>
<li><a href="../en487734/index.html">Speeding up Entity Framework Core</a></li>
<li><a href="../en487738/index.html">Schema animation in SCADA</a></li>
<li><a href="../en487742/index.html">Arbitrage Trading (Bellman-Ford Algorithm)</a></li>
<li><a href="../en487744/index.html">FARO Introduces FOCUS S 70 Laser 3D Scanner</a></li>
<li><a href="../en487746/index.html">Eternal</a></li>
<li><a href="../en487748/index.html">$ 3 hardware encryption key - is this possible?</a></li>
<li><a href="../en487750/index.html">Some subtleties of injection collections in Spring</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>