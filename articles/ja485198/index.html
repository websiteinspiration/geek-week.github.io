<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🈲 👩🏿‍🚀 👩🏼‍🎤 .NETアプリケーションメソッドのパフォーマンスを測定する別の方法 👩🏻‍🤝‍👨🏾 😃 👩🏻‍🎨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="多くの場合、ボトルネックを特定し、アプリケーションのどの部分で速度が低下しているかを確認するために、アプリケーションメソッドのパフォーマンスに関する統計をリアルタイムで（アプリケーションが既に実行されている場合）収集する必要があります。
 

さらに、パフォーマンスデータ自体（メソッドの開発時間、呼...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>.NETアプリケーションメソッドのパフォーマンスを測定する別の方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485198/"><p><img src="https://habrastorage.org/webt/-q/hs/z8/-qhsz8oawswkr7chwsijjbkrr1y.png"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多くの場合、ボトルネックを特定し、アプリケーションのどの部分で速度が低下しているかを確認するために、アプリケーションメソッドのパフォーマンスに関する統計をリアルタイムで（アプリケーションが既に実行されている場合）収集する必要があります。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さらに、パフォーマンスデータ自体（メソッドの開発時間、呼び出しの開始日と終了日）に加えて、パフォーマンスが追跡される呼び出しコンテキスト（メソッド呼び出しの引数や開発者が追加した任意のデータなど）を保存すると便利です。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さて、「ケーキのチェリー」は、使用するツールの便利さとシンプルさであると考えることができます。これも重要です。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらの問題を解決するために、クロスプラットフォームのオープンソース.NETライブラリ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unchase.FluentPerformanceMeterが開発されました</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p><a name="habracut"></a><br>
<h2 id="vvedenie"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h2><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">したがって、この記事は、</font><font style="vertical-align: inherit;">メソッドのパフォーマンスを計算するために設計され</font><font style="vertical-align: inherit;">たクロスプラットフォームのオープンソースの</font><em><font style="vertical-align: inherit;">.Net Standard 2.0</font></em><font style="vertical-align: inherit;">ライブラリ</font><font style="vertical-align: inherit;">である</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unchase Fluent Performance Meter</font></font></strong></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">での作業の説明です</font><font style="vertical-align: inherit;">。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></p><br>
<p>     .NET Core  .NET Framework ,  <em>.Net Standard 2.0</em>,  :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong>  </strong></a>  <strong><em>public</em> </strong>  <strong><em>public</em> </strong>   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a> (        );</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong>  </strong></a>  <strong> </strong> (Custom Data). ,       ;     ;  <em>corellationId</em>,         ;</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong> </strong></a>   <strong>  </strong> (Steps)       .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a> ,         (   ,     );</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong>  </strong></a>  <strong>  </strong> (,   ,        );</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong>  </strong></a> (Commands),   <strong>   </strong>     (,      ,        );</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong>   </strong></a>  ,       (    ,       );</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong>   </strong></a>   ,      ;</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong>   </strong></a>   , <strong>  </strong> (Caller)  <em>IHttpContextAccesor</em>   Caller'   (,     ,   );</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong>   </strong></a>       (         );</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong> </strong></a>   <strong>   </strong>.</li>
</ul><br>
<p>             (  ,   —  ,    —   )        .</p><br>
<h2 id="soderzhanie"></h2><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> DI      (v2.1.0)</a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">     DiagnosticSource (v1.1.0)</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">      WatchingPerformanceAttribute (v2.0.0)</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">    </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   (Custom Data)     (Steps)</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   (Ignore)</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  (Commands)   (Actions)</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   (Exception Handlers)</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">    (Set Cache Time)</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">        (  )</a></li>
</ul></li>
</ul><br>
<h2 id="a-namestarta-nachalo-raboty">  </h2><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><em>NuGet</em> </a>   :</p><br>
<h4 id="vruchnuyu-s-pomoschyu-menedzhera-nuget-paketov-package-manager">    <em>NuGet</em>  (Package Manager):</h4><br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Install-Package</span> Unchase.FluentPerformanceMeter</code></pre><br>
<h4 id="s-pomoschyu-net-cli">  .NET CLI:</h4><br>
<pre><code class="powershell hljs">dotnet add package Unchase.FluentPerformanceMeter -<span class="hljs-literal">-version</span> {version}</code></pre><br>
<blockquote> {version} —   ,    .<br>
, <code>dotnet add package Unchase.FluentPerformanceMeter --version 1.0.0</code></blockquote><br>
<h2 id="a-namesimplesamplesa-primery-ispolzovaniya">  </h2><br>
<h3 id="izmerenie-proizvoditelnosti-metoda">  </h3><br>
<p>      (    )     (Action) <code>SimpleWatchingMethodStart</code>  (Controller) <code>PerformanceMeterController</code> <em>Asp.Net Core 2.2 WebAPI</em> .       <code>.WatchingMethod().Start()</code>     <code>.StartWatching()</code>.<br>
  v1.0.5    <code>.WatchingMethod().Start(SimpleWatchingMethodStart)</code>  <code>.StartWatching(SimpleWatchingMethodStart)</code>    . </p><br>
<blockquote>        <code>Unchase.FluentPerformanceMeter.Test*</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"> </a>.</blockquote><br>
<pre><code class="plaintext hljs">/// &lt;summary&gt;<font></font>
/// Test GET method with simple performance watching.<font></font>
/// &lt;/summary&gt;<font></font>
[HttpGet("SimpleWatchingMethodStart")]<font></font>
public ActionResult SimpleWatchingMethodStart()<font></font>
{   <font></font>
    // for C# 8 you can use:<font></font>
    //using var pm = PerformanceMeter&lt;PerformanceMeterController&gt;.StartWatching();<font></font>
<font></font>
    using (PerformanceMeter&lt;PerformanceMeterController&gt;.WatchingMethod().Start())<font></font>
    {<font></font>
        // put your code with some logic here<font></font>
<font></font>
        return Ok();<font></font>
    }<font></font>
}</code></pre><br>
<p>       - <code>PerformanceMeterController</code>    :</p><br>
<pre><code class="plaintext hljs">/// &lt;summary&gt;<font></font>
/// Get methods performance info for this controller.<font></font>
/// &lt;/summary&gt;<font></font>
/// &lt;returns&gt;Returns methods performance info.&lt;/returns&gt;<font></font>
[HttpGet("GetPerformanceInfo")]<font></font>
[IgnoreMethodPerformance]<font></font>
public ActionResult&lt;IPerformanceInfo&gt; GetPerformanceInfo()<font></font>
{<font></font>
    return Ok(PerformanceMeter&lt;PerformanceMeterController&gt;.PerformanceInfo);<font></font>
}</code></pre><br>
<p>   <code>SimpleWatchingMethodStart</code>   <code>GetPerformanceInfo</code> :</p><br>
<pre><code class="json hljs">{
  <span class="hljs-attr">"methodCalls"</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">"methodName"</span>: <span class="hljs-string">"SimpleWatchingMethodStart"</span>,
      <span class="hljs-attr">"elapsed"</span>: <span class="hljs-string">"00:00:00.0016350"</span>,
      <span class="hljs-attr">"caller"</span>: <span class="hljs-string">"unknown"</span>,
      <span class="hljs-attr">"startTime"</span>: <span class="hljs-string">"2019-12-06T10:27:27.3385385Z"</span>,
      <span class="hljs-attr">"endTime"</span>: <span class="hljs-string">"2019-12-06T10:27:27.3401735Z"</span>,
      <span class="hljs-attr">"customData"</span>: {},
      <span class="hljs-attr">"steps"</span>: []<font></font>
    }<font></font>
  ],<font></font>
  <span class="hljs-attr">"totalActivity"</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">"methodName"</span>: <span class="hljs-string">"SimpleWatchingMethodStart"</span>,
      <span class="hljs-attr">"callsCount"</span>: <span class="hljs-number">1</span><font></font>
    }<font></font>
  ],<font></font>
  <span class="hljs-attr">"currentActivity"</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">"methodName"</span>: <span class="hljs-string">"SimpleWatchingMethodStart"</span>,
      <span class="hljs-attr">"callsCount"</span>: <span class="hljs-number">0</span><font></font>
    }<font></font>
  ],<font></font>
  <span class="hljs-attr">"uptimeSince"</span>: <span class="hljs-string">"2019-12-06T10:27:27.3370183Z"</span>,
  <span class="hljs-attr">"className"</span>: <span class="hljs-string">"Unchase.FluentPerformanceMeter.TestWebAPI.Controllers.PerformanceMeterController"</span>,
  <span class="hljs-attr">"methodNames"</span>: [
    <span class="hljs-string">"SimpleWatchingMethodStart"</span><font></font>
  ],<font></font>
  <span class="hljs-attr">"customData"</span>: {},
  <span class="hljs-attr">"timerFrequency"</span>: <span class="hljs-number">10000000</span>
}</code></pre><br>
<h4 id="a-nameusingdisamplea-ispolzovanie-di-dlya-polucheniya-rezultatov-zamera-proizvoditelnosti">  DI     </h4><br>
<p>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><em>v2.1.0</em></a>        ,   <strong>DI</strong>  <em>ASP.NET Core</em> .<br>
     <code>Startap.cs</code>  :</p><br>
<pre><code class="plaintext hljs">public void ConfigureServices(IServiceCollection services)<font></font>
{<font></font>
    // ...<font></font>
<font></font>
    // adds a singleton service to the specified IPerformanceInfo&lt;MeasurableController&gt; with DI<font></font>
    services.AddSingleton(s =&gt; PerformanceMeter&lt;MeasurableController&gt;.PerformanceInfo);<font></font>
    // ... the same for another classes (controllers)<font></font>
<font></font>
    // ...<font></font>
}</code></pre><br>
<p> ,  DI,   , ,  :</p><br>
<pre><code class="plaintext hljs">[ApiController]<font></font>
[Route("api/v1/[controller]")]<font></font>
public class PerformanceMeterController : ControllerBase<font></font>
{<font></font>
    private readonly IPerformanceInfo&lt;PerformanceMeterController&gt; _performanceInfo;<font></font>
<font></font>
    public PerformanceMeterController(IPerformanceInfo&lt;PerformanceMeterController&gt; performanceInfo)<font></font>
    {<font></font>
        _performanceInfo = performanceInfo;<font></font>
    }<font></font>
<font></font>
    // ...<font></font>
<font></font>
    /// &lt;summary&gt;<font></font>
    /// Get methods performance info for this controller.<font></font>
    /// &lt;/summary&gt;<font></font>
    /// &lt;returns&gt;Returns methods performance info.&lt;/returns&gt;<font></font>
    [HttpGet("GetPerformanceInfoV2")]<font></font>
    [IgnoreMethodPerformance]<font></font>
    public ActionResult&lt;IPerformanceInfo&gt; GetPerformanceInfoV2()<font></font>
    {<font></font>
        return Ok(_performanceInfo);<font></font>
    }<font></font>
<font></font>
    // ...<font></font>
}</code></pre><br>
<h3 id="a-namediagnosticsourcesamplea-izmerenie-proizvoditelnosti-metoda-s-pomoschyu-diagnosticsource">      <code>DiagnosticSource</code></h3><br>
<p>   <em>v1.1.0</em>       <em>AspNetCore MVC</em>    <code>DiagnosticSource</code>    <code>WatchingWithDiagnosticSourceAttribute</code>.<br>
      <em>NuGet</em>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><code>Unchase.FluentPerformanceMeter.AspNetCore.Mvc</code></a>,    <code>Startap.cs</code>  :</p><br>
<pre><code class="plaintext hljs">public void ConfigureServices(IServiceCollection services)<font></font>
{<font></font>
    // ...<font></font>
<font></font>
    // allows to measure methods performance for class "MeasurableClass" and "MeasurableSecondClass"<font></font>
    services.AddPerformanceDiagnosticObserver&lt;MeasurableClass&gt;();<font></font>
    services.AddPerformanceDiagnosticObserver&lt;MeasurableSecondClass&gt;();<font></font>
    // ... the same for another classes<font></font>
<font></font>
    services.AddMvc();<font></font>
<font></font>
    // ...<font></font>
}<font></font>
<font></font>
public void Configure(IApplicationBuilder app, IHostingEnvironment env)<font></font>
{<font></font>
    // ...<font></font>
<font></font>
    app.UsePerformanceDiagnosticObserver();<font></font>
<font></font>
    app.UseMvc();<font></font>
}</code></pre><br>
<p>    <code>WatchingWithDiagnosticSourceAttribute</code>   :</p><br>
<pre><code class="plaintext hljs">[HttpGet("SimpleWatchingMethodStart")]<font></font>
[WatchingWithDiagnosticSource]<font></font>
public ActionResult SimpleWatchingMethodStart()<font></font>
{   <font></font>
    return Ok();<font></font>
}</code></pre><br>
<p>  :</p><br>
<pre><code class="plaintext hljs">[ApiController]<font></font>
[Route("api/v1/[controller]")]<font></font>
[Produces("application/json")]<font></font>
[SwaggerTag("Unchase.PerformanceMeter Test WebAPI Controller")]<font></font>
[WatchingWithDiagnosticSource]<font></font>
public class PerformanceMeterController : ControllerBase<font></font>
{<font></font>
    // measurable methods<font></font>
}</code></pre><br>
<p>   <em>v1.2.0</em>             <em>AspNetCore MVC</em>      <code>AddMethodArgumentsToCustomDataAttribute</code>     <code>WatchingWithDiagnosticSourceAttribute</code>:</p><br>
<pre><code class="plaintext hljs">[HttpPost("SimpleWatchingMethodStartWithArgs")]<font></font>
[WatchingWithDiagnosticSource]<font></font>
[AddMethodArgumentsToCustomData("actionArguments")]<font></font>
public ActionResult SimpleWatchingMethodStartWithArgs(DTOArgument arg)<font></font>
{<font></font>
    return Ok();<font></font>
}</code></pre><br>
<p>   <code>SimpleWatchingMethodStartWithArgs</code>   <code>GetPerformanceInfo</code> :</p><br>
<pre><code class="json hljs">{
  <span class="hljs-attr">"methodCalls"</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">"methodName"</span>: <span class="hljs-string">"SimpleWatchingMethodStartWithArgs"</span>,
      <span class="hljs-attr">"elapsed"</span>: <span class="hljs-string">"00:00:00.0016350"</span>,
      <span class="hljs-attr">"caller"</span>: <span class="hljs-string">"unknown"</span>,
      <span class="hljs-attr">"startTime"</span>: <span class="hljs-string">"2019-12-06T10:27:27.3385385Z"</span>,
      <span class="hljs-attr">"endTime"</span>: <span class="hljs-string">"2019-12-06T10:27:27.3401735Z"</span>,
      <span class="hljs-attr">"customData"</span>: {
        <span class="hljs-attr">"actionArguments"</span>: {
          <span class="hljs-attr">"arg"</span>: {
            <span class="hljs-attr">"data"</span>: <span class="hljs-string">"&lt;string_in_DTOArgument&gt;"</span><font></font>
          }<font></font>
        }<font></font>
      },<font></font>
      <span class="hljs-attr">"steps"</span>: []<font></font>
    }<font></font>
  ],<font></font>
  <span class="hljs-attr">"totalActivity"</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">"methodName"</span>: <span class="hljs-string">"SimpleWatchingMethodStartWithArgs"</span>,
      <span class="hljs-attr">"callsCount"</span>: <span class="hljs-number">1</span><font></font>
    }<font></font>
  ],<font></font>
  <span class="hljs-attr">"currentActivity"</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">"methodName"</span>: <span class="hljs-string">"SimpleWatchingMethodStartWithArgs"</span>,
      <span class="hljs-attr">"callsCount"</span>: <span class="hljs-number">0</span><font></font>
    }<font></font>
  ],<font></font>
  <span class="hljs-attr">"uptimeSince"</span>: <span class="hljs-string">"2019-12-06T10:27:27.3370183Z"</span>,
  <span class="hljs-attr">"className"</span>: <span class="hljs-string">"Unchase.FluentPerformanceMeter.TestWebAPI.Controllers.PerformanceMeterController"</span>,
  <span class="hljs-attr">"methodNames"</span>: [
    <span class="hljs-string">"SimpleWatchingMethodStartWithArgs"</span><font></font>
  ],<font></font>
  <span class="hljs-attr">"customData"</span>: {},
  <span class="hljs-attr">"timerFrequency"</span>: <span class="hljs-number">10000000</span>
}</code></pre><br>
<h3 id="a-namewatchingperformancesamplea-izmerenie-proizvoditelnosti-metoda-s-pomoschyu-atributa-watchingperformanceattribute">       <code>WatchingPerformanceAttribute</code></h3><br>
<p>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><em>v2.0.0</em></a>       <em>AspNetCore MVC</em>      <code>WatchingPerformanceAttribute</code>,         <code>Startup.cs</code>.<br>
      <em>NuGet</em>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><code>Unchase.FluentPerformanceMeter.AspNetCore.Mvc</code></a>,    <code>Startap.cs</code>  :</p><br>
<pre><code class="plaintext hljs">public void ConfigureServices(IServiceCollection services)<font></font>
{<font></font>
    // ...<font></font>
<font></font>
    // allows to measure methods performance for class "MeasurableController" with configuring options<font></font>
    services.AddPerformanceMeter&lt;MeasurableController&gt;(options =&gt; <font></font>
    {<font></font>
        // ALL of this is optional. You can simply call .AddPerformanceMeter&lt;MeasurableController&gt;() for all defaults<font></font>
        // Defaults: In-Memory for 5 minutes, everything watched, every user can see<font></font>
<font></font>
        // excludes a method from performance watching<font></font>
        options.ExcludeMethod(nameof(MeasurableController.MeasurableAction));<font></font>
<font></font>
        // to control which requests are watched, use the Func&lt;HttpRequest, bool&gt; option:<font></font>
        options.ShouldWatching = request =&gt; request.HttpContext.User.IsInRole("Dev");<font></font>
<font></font>
        // allows to add custom data from custom attributes ("MethodCustomDataAttribute", "MethodCallerAttribute") to performance watching<font></font>
        options.AddCustomDataFromCustomAttributes = false;<font></font>
<font></font>
        // allows to use "IgnoreMethodPerformanceAttribute" for excluding from performance watching<font></font>
        options.UseIgnoreMethodPerformanceAttribute = false;<font></font>
<font></font>
        // allows to watch actions performance annotated with special attribute ("WatchingPerformanceAttribute")<font></font>
        options.WatchForAnnotatedWithAttributeOnly = false;<font></font>
<font></font>
        // excludes a path from being watched<font></font>
        options.IgnorePath("/some_path");<font></font>
<font></font>
        // allows to add route path to custom data (with "pm_path" key)<font></font>
        options.AddRoutePathToCustomData = false;<font></font>
<font></font>
        // set cache time for the watched performance results for the controller class<font></font>
        options.SetMethodCallsCacheTime(5);<font></font>
<font></font>
        // adds common custom data (anonymous class) to class performance information<font></font>
        options.AddCustomData("Custom anonymous class", new { Name = "Custom Name", Value = 1 });<font></font>
<font></font>
        // set default exception handler for the controller class<font></font>
        options.SetDefaultExceptionHandler((ex) =&gt; Debug.WriteLine(ex.Message));<font></font>
    });<font></font>
    // ... and for "MeasurableSecondController" (without configuring options)<font></font>
    services.AddPerformanceMeter&lt;MeasurableSecondController&gt;();<font></font>
    // ... the same for another controllers<font></font>
<font></font>
    services.AddMvc();<font></font>
<font></font>
    // ...<font></font>
}<font></font>
<font></font>
public void Configure(IApplicationBuilder app, IHostingEnvironment env)<font></font>
{<font></font>
    // ...<font></font>
<font></font>
    app.UseRouting();<font></font>
<font></font>
    app.UseEndpoints(c =&gt;<font></font>
    {<font></font>
        c.MapControllers();<font></font>
<font></font>
        // use performance watching for concrete controller (for example, "MeasurableController")<font></font>
        app.UsePerformanceMeterFor&lt;MeasurableController&gt;();<font></font>
        // ... the same for another controllers<font></font>
    });<font></font>
}</code></pre><br>
<p>    <code>WatchingPerformanceAttribute</code>   :</p><br>
<pre><code class="plaintext hljs">[HttpGet("SimpleWatchingMethodStartWatchingPerformanceAttribute")]<font></font>
[WatchingPerformance]<font></font>
public ActionResult SimpleWatchingMethodStartWatchingPerformanceAttribute()<font></font>
{   <font></font>
    return Ok();<font></font>
}</code></pre><br>
<p>  :</p><br>
<pre><code class="plaintext hljs">[ApiController]<font></font>
[Route("api/v1/[controller]")]<font></font>
[Produces("application/json")]<font></font>
[SwaggerTag("Unchase.PerformanceMeter Test WebAPI Controller")]<font></font>
[WatchingPerformance]<font></font>
public class PerformanceMeterController : ControllerBase<font></font>
{<font></font>
    // measurable methods (actions)<font></font>
}</code></pre><br>
<h3 id="a-namesampleexternala-izmerenie-proizvoditelnosti-metoda-ispolzuemoy-biblioteki">     </h3><br>
<p>   <em>public</em>  <em>public</em>    ,         :</p><br>
<pre><code class="plaintext hljs">[HttpGet("GetThreadSleepPerformance")]<font></font>
public ActionResult&lt;string&gt; GetThreadSleepPerformance()<font></font>
{<font></font>
    using (PerformanceMeter&lt;Thread&gt;.WatchingMethod(nameof(Thread.Sleep)).Start())<font></font>
    {<font></font>
        Thread.Sleep(1000);<font></font>
    }<font></font>
<font></font>
    return Ok(PerformanceMeter&lt;Thread&gt;.PerformanceInfo.MethodCalls.FirstOrDefault(ta =&gt; ta.MethodName == nameof(Thread.Sleep))?.Elapsed);<font></font>
}</code></pre><br>
<p>  :</p><br>
<pre><code class="plaintext hljs">"00:00:01.0033040"</code></pre><br>
<p>         :</p><br>
<pre><code class="plaintext hljs">/// &lt;summary&gt;<font></font>
/// Get methods performance info for Thread class.<font></font>
/// &lt;/summary&gt;<font></font>
/// &lt;returns&gt;Returns Thread methods performance info.&lt;/returns&gt;<font></font>
[HttpGet("GetThreadPerformanceInfo")]<font></font>
[IgnoreMethodPerformance]<font></font>
public ActionResult&lt;IPerformanceInfo&gt; GetThreadPerformanceInfo()<font></font>
{<font></font>
    return Ok(PerformanceMeter&lt;Thread&gt;.PerformanceInfo);<font></font>
}</code></pre><br>
<blockquote> <code>IgnoreMethodPerformance</code>   ,         .</blockquote><p>      :</p><br>
<pre><code class="json hljs">{
  <span class="hljs-attr">"methodCalls"</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">"methodName"</span>: <span class="hljs-string">"Sleep"</span>,
      <span class="hljs-attr">"elapsed"</span>: <span class="hljs-string">"00:00:01.0033040"</span>,
      <span class="hljs-attr">"caller"</span>: <span class="hljs-string">"unknown"</span>,
      <span class="hljs-attr">"startTime"</span>: <span class="hljs-string">"2019-12-06T13:08:09.336624Z"</span>,
      <span class="hljs-attr">"endTime"</span>: <span class="hljs-string">"2019-12-06T13:08:10.339928Z"</span>,
      <span class="hljs-attr">"customData"</span>: {},
      <span class="hljs-attr">"steps"</span>: []<font></font>
    }<font></font>
  ],<font></font>
  <span class="hljs-attr">"totalActivity"</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">"methodName"</span>: <span class="hljs-string">"Abort"</span>,
      <span class="hljs-attr">"callsCount"</span>: <span class="hljs-number">0</span><font></font>
    },<font></font>
    <span class="hljs-comment">// ...</span><font></font>
    {<font></font>
      <span class="hljs-attr">"methodName"</span>: <span class="hljs-string">"Sleep"</span>,
      <span class="hljs-attr">"callsCount"</span>: <span class="hljs-number">1</span><font></font>
    }<font></font>
    <span class="hljs-comment">// ...</span><font></font>
  ],<font></font>
  <span class="hljs-attr">"currentActivity"</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">"methodName"</span>: <span class="hljs-string">"Abort"</span>,
      <span class="hljs-attr">"callsCount"</span>: <span class="hljs-number">0</span><font></font>
    },<font></font>
    <span class="hljs-comment">// ...</span><font></font>
    {<font></font>
      <span class="hljs-attr">"methodName"</span>: <span class="hljs-string">"Sleep"</span>,
      <span class="hljs-attr">"callsCount"</span>: <span class="hljs-number">1</span><font></font>
    }<font></font>
    <span class="hljs-comment">// ...</span><font></font>
  ],<font></font>
  <span class="hljs-attr">"uptimeSince"</span>: <span class="hljs-string">"2019-12-06T13:08:09.3357028Z"</span>,
  <span class="hljs-attr">"className"</span>: <span class="hljs-string">"System.Threading.Thread"</span>,
  <span class="hljs-attr">"methodNames"</span>: [
    <span class="hljs-string">"Abort"</span>,
    <span class="hljs-comment">// ...</span>
    <span class="hljs-string">"Sleep"</span>,
    <span class="hljs-comment">// ...</span><font></font>
  ],<font></font>
  <span class="hljs-attr">"customData"</span>: {},
  <span class="hljs-attr">"timerFrequency"</span>: <span class="hljs-number">10000000</span>
}</code></pre><br>
<h3 id="a-namesamplecustomdataa-dobavlenie-dopolnitelnyh-dannyh-custom-data-i-razbienie-na-shagi-steps">    (Custom Data)     (Steps)</h3><br>
<p>    (Custom Data)       . ,    - <code>PerformanceMeterController</code>:</p><br>
<pre><code class="plaintext hljs">[ApiController]<font></font>
[Route("api/v1/[controller]")]<font></font>
public class PerformanceMeterController : ControllerBase<font></font>
{<font></font>
    /// &lt;summary&gt;<font></font>
    /// Static constructor.<font></font>
    /// &lt;/summary&gt;<font></font>
    static PerformanceMeterController()<font></font>
    {<font></font>
        // add common custom data (string) to class performance information<font></font>
        PerformanceMeter&lt;PerformanceMeterController&gt;.AddCustomData("Tag", "CustomTag");<font></font>
<font></font>
        // add common custom data (anonymous class) to class performance information<font></font>
        PerformanceMeter&lt;PerformanceMeterController&gt;.AddCustomData("Custom anonymous class", new { Name = "Custom Name", Value = 1 });<font></font>
    }<font></font>
<font></font>
    // ... actions<font></font>
}</code></pre><br>
<p> ,     (Custom Data)        <code>.WithSettingData.CustomData("&lt;key&gt;", &lt;value&gt;)</code> (  ,     <code>MethodCustomDataAttribute</code>)     (Step)  ,      <code>.Step("&lt;step_name&gt;")</code>, —     <code>.AddCustomData("&lt;key&gt;", &lt;value&gt;)</code>:</p><br>
<pre><code class="plaintext hljs">/// &lt;summary&gt;<font></font>
/// Test GET method with simple performance watching (with steps).<font></font>
/// &lt;/summary&gt;<font></font>
[HttpGet("SimpleStartWatchingWithSteps")]<font></font>
[MethodCustomData("Custom data from attribute", "Attr")]<font></font>
public ActionResult SimpleStartWatchingWithSteps()<font></font>
{<font></font>
    using (var pm = PerformanceMeter&lt;PerformanceMeterController&gt;<font></font>
        .WatchingMethod()<font></font>
        .WithSettingData<font></font>
            .CustomData("coins", 1)<font></font>
            .CustomData("Coins sets", new <font></font>
            { <font></font>
                Gold = "Many",<font></font>
                Silver = 5<font></font>
            })<font></font>
        .Start())<font></font>
    {<font></font>
        // put your code with some logic here<font></font>
<font></font>
        // add "Step 1"<font></font>
        using (pm.Step("Step 1"))<font></font>
        {<font></font>
            Thread.Sleep(1000);<font></font>
        }<font></font>
<font></font>
        // add "Step 2" with custom data<font></font>
        using (var pmStep = pm.Step("Step 2").AddCustomData("step2 custom data", "data!"))<font></font>
        {<font></font>
            // add "Step 3 in Step 2"<font></font>
            using (pm.Step("Step 3 in Step 2"))<font></font>
            {<font></font>
                Thread.Sleep(1000);<font></font>
            }<font></font>
<font></font>
            // add custom data to "Step 2"<font></font>
            pmStep.AddCustomData("step2 another custom data", "data2!");<font></font>
<font></font>
            // get and remove custom data from "Step 2"<font></font>
            var customData = pmStep.GetAndRemoveCustomData&lt;string&gt;("step2 custom data");<font></font>
<font></font>
            // get custom data from "Step 2" (without removing)<font></font>
            var anotherCustomData = pmStep.GetCustomData&lt;string&gt;("step2 another custom data");<font></font>
<font></font>
            // ...<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<p>    <code>GetPerformanceInfo</code> :</p><br>
<pre><code class="json hljs">{
  <span class="hljs-attr">"methodCalls"</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">"methodName"</span>: <span class="hljs-string">"SimpleStartWatchingWithSteps"</span>,
      <span class="hljs-attr">"elapsed"</span>: <span class="hljs-string">"00:00:02.0083031"</span>,
      <span class="hljs-attr">"caller"</span>: <span class="hljs-string">"unknown"</span>,
      <span class="hljs-attr">"startTime"</span>: <span class="hljs-string">"2019-12-06T11:58:18.9006891Z"</span>,
      <span class="hljs-attr">"endTime"</span>: <span class="hljs-string">"2019-12-06T11:58:20.9089922Z"</span>,
      <span class="hljs-attr">"customData"</span>: {
        <span class="hljs-attr">"Coins sets"</span>: {
          <span class="hljs-attr">"gold"</span>: <span class="hljs-string">"Many"</span>,
          <span class="hljs-attr">"silver"</span>: <span class="hljs-number">5</span><font></font>
        },<font></font>
        <span class="hljs-attr">"coins"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">"Custom data from attribute"</span>: <span class="hljs-string">"Attr"</span><font></font>
      },<font></font>
      <span class="hljs-attr">"steps"</span>: [<font></font>
        {<font></font>
          <span class="hljs-attr">"stepName"</span>: <span class="hljs-string">"Step 1"</span>,
          <span class="hljs-attr">"elapsed"</span>: <span class="hljs-string">"00:00:01.0009758"</span>,
          <span class="hljs-attr">"startTime"</span>: <span class="hljs-string">"2019-12-06T11:58:18.9018272Z"</span>,
          <span class="hljs-attr">"endTime"</span>: <span class="hljs-string">"2019-12-06T11:58:19.902803Z"</span>,
          <span class="hljs-attr">"customData"</span>: {}<font></font>
        },<font></font>
        {<font></font>
          <span class="hljs-attr">"stepName"</span>: <span class="hljs-string">"Step 3 in Step 2"</span>,
          <span class="hljs-attr">"elapsed"</span>: <span class="hljs-string">"00:00:01.0004549"</span>,
          <span class="hljs-attr">"startTime"</span>: <span class="hljs-string">"2019-12-06T11:58:19.9046523Z"</span>,
          <span class="hljs-attr">"endTime"</span>: <span class="hljs-string">"2019-12-06T11:58:20.9051072Z"</span>,
          <span class="hljs-attr">"customData"</span>: {}<font></font>
        },<font></font>
        {<font></font>
          <span class="hljs-attr">"stepName"</span>: <span class="hljs-string">"Step 2"</span>,
          <span class="hljs-attr">"elapsed"</span>: <span class="hljs-string">"00:00:01.0029596"</span>,
          <span class="hljs-attr">"startTime"</span>: <span class="hljs-string">"2019-12-06T11:58:19.904534Z"</span>,
          <span class="hljs-attr">"endTime"</span>: <span class="hljs-string">"2019-12-06T11:58:20.9074936Z"</span>,
          <span class="hljs-attr">"customData"</span>: {
            <span class="hljs-attr">"step2 another custom data"</span>: <span class="hljs-string">"data2!"</span><font></font>
          }<font></font>
        }<font></font>
      ]<font></font>
    }<font></font>
  ],<font></font>
  <span class="hljs-attr">"totalActivity"</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">"methodName"</span>: <span class="hljs-string">"SimpleStartWatchingWithSteps"</span>,
      <span class="hljs-attr">"callsCount"</span>: <span class="hljs-number">1</span><font></font>
    }<font></font>
  ],<font></font>
  <span class="hljs-attr">"currentActivity"</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">"methodName"</span>: <span class="hljs-string">"SimpleStartWatchingWithSteps"</span>,
      <span class="hljs-attr">"callsCount"</span>: <span class="hljs-number">0</span><font></font>
    }<font></font>
  ],<font></font>
  <span class="hljs-attr">"uptimeSince"</span>: <span class="hljs-string">"2019-12-06T11:58:18.8801249Z"</span>,
  <span class="hljs-attr">"className"</span>: <span class="hljs-string">"Unchase.FluentPerformanceMeter.TestWebAPI.Controllers.PerformanceMeterController"</span>,
  <span class="hljs-attr">"methodNames"</span>: [
    <span class="hljs-string">"SimpleStartWatchingWithSteps"</span><font></font>
  ],<font></font>
  <span class="hljs-attr">"customData"</span>: {
    <span class="hljs-attr">"Tag"</span>: <span class="hljs-string">"CustomTag"</span>,
    <span class="hljs-attr">"Custom anonymous class"</span>: {
      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Custom Name"</span>,
      <span class="hljs-attr">"value"</span>: <span class="hljs-number">1</span><font></font>
    }<font></font>
  },<font></font>
  <span class="hljs-attr">"timerFrequency"</span>: <span class="hljs-number">10000000</span>
}</code></pre><br>
<h3 id="a-namesampleignorea-isklyuchenie-iz-zamera-ignore">    (Ignore)</h3><br>
<p>          (  <code>.Ignore()</code>  <code>.Executing().WithoutWatching().Start(&lt;Action&gt;)</code>),       (  <code>.StepIf("&lt;step_name&gt;", &lt;minSaveMs&gt;)</code>),      (          ):</p><br>
<pre><code class="plaintext hljs">using (var pm = PerformanceMeter&lt;PerformanceMeterController&gt;.WatchingMethod().Start())<font></font>
{<font></font>
    // put your code with some logic here<font></font>
<font></font>
    // sleep 1 sec<font></font>
    Thread.Sleep(1000);<font></font>
<font></font>
    // ignore this block in performance watching<font></font>
    using (pm.Ignore())<font></font>
    {<font></font>
        Thread.Sleep(5000);<font></font>
    }<font></font>
<font></font>
    // skip this step with minSaveMs (not save, but consider duration in method performance watching)<font></font>
    using (pm.StepIf("Skipped step", minSaveMs: 1000))<font></font>
    {<font></font>
        Thread.Sleep(500);<font></font>
    }<font></font>
<font></font>
    // execute action without performance watching<font></font>
    pm.Executing().WithoutWatching().Start(() =&gt; <font></font>
    {<font></font>
        Thread.Sleep(2000);<font></font>
    });<font></font>
<font></font>
    return Ok();<font></font>
}</code></pre><br>
<p>  :</p><br>
<pre><code class="json hljs">{
  <span class="hljs-attr">"methodCalls"</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">"methodName"</span>: <span class="hljs-string">"SimpleStartWatchingWithIgnored"</span>,
      <span class="hljs-attr">"elapsed"</span>: <span class="hljs-string">"00:00:01.5080227"</span>,
      <span class="hljs-attr">"caller"</span>: <span class="hljs-string">"unknown"</span>,
      <span class="hljs-attr">"startTime"</span>: <span class="hljs-string">"2019-12-06T12:34:36.9187359Z"</span>,
      <span class="hljs-attr">"endTime"</span>: <span class="hljs-string">"2019-12-06T12:34:38.4267586Z"</span>,
      <span class="hljs-attr">"customData"</span>: {},
      <span class="hljs-attr">"steps"</span>: []<font></font>
    }<font></font>
  ],<font></font>
  <span class="hljs-attr">"totalActivity"</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">"methodName"</span>: <span class="hljs-string">"SimpleStartWatchingWithIgnored"</span>,
      <span class="hljs-attr">"callsCount"</span>: <span class="hljs-number">1</span><font></font>
    }<font></font>
  ],<font></font>
  <span class="hljs-attr">"currentActivity"</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">"methodName"</span>: <span class="hljs-string">"SimpleStartWatchingWithIgnored"</span>,
      <span class="hljs-attr">"callsCount"</span>: <span class="hljs-number">0</span><font></font>
    }<font></font>
  ],<font></font>
  <span class="hljs-attr">"uptimeSince"</span>: <span class="hljs-string">"2019-12-06T12:34:36.9035129Z"</span>,
  <span class="hljs-attr">"className"</span>: <span class="hljs-string">"Unchase.FluentPerformanceMeter.TestWebAPI.Controllers.PerformanceMeterController"</span>,
  <span class="hljs-attr">"methodNames"</span>: [
    <span class="hljs-string">"SimpleStartWatchingWithIgnored"</span><font></font>
  ],<font></font>
  <span class="hljs-attr">"customData"</span>: { },
  <span class="hljs-attr">"timerFrequency"</span>: <span class="hljs-number">10000000</span>
}</code></pre><br>
<h3 id="a-namesamplecustomcommandsa-dobavlenie-komand-commands-i-deystviy-actions">   (Commands)   (Actions)</h3><br>
<p>  ,         ,    ,     <code>IPerformanceCommand</code>.<br>
          ,      . :</p><br>
<pre><code class="plaintext hljs">/// &lt;summary&gt;<font></font>
/// Custom executed command.<font></font>
/// &lt;/summary&gt;<font></font>
public class ExecutedCommand : IPerformanceCommand<font></font>
{<font></font>
    /// &lt;summary&gt;<font></font>
    /// Executed commad name.<font></font>
    /// &lt;/summary&gt;<font></font>
    public string CommandName =&gt; this.GetType().Name;<font></font>
<font></font>
    private string _customString { get; }<font></font>
<font></font>
    internal bool IsCommandExecuted { get; private set; }<font></font>
<font></font>
    /// &lt;summary&gt;<font></font>
    /// Constructor.<font></font>
    /// &lt;/summary&gt;<font></font>
    /// &lt;remarks&gt;<font></font>
    /// You can pass any data through the command constructor.<font></font>
    /// &lt;/remarks&gt;<font></font>
    /// &lt;param name="customString"&gt;&lt;/param&gt;<font></font>
    public ExecutedCommand(string customString) <font></font>
    {<font></font>
        this._customString = customString;<font></font>
    }<font></font>
<font></font>
    /// &lt;summary&gt;<font></font>
    /// Execute command.<font></font>
    /// &lt;/summary&gt;<font></font>
    /// &lt;param name="performanceInfo"&gt;&lt;see cref="IPerformanceInfo"/&gt;.&lt;/param&gt;<font></font>
    public void Execute(IPerformanceInfo performanceInfo)<font></font>
    {<font></font>
        // for example, write to the debug console some information<font></font>
        Debug.WriteLine(this.CommandName);<font></font>
        Debug.WriteLine(this._customString);<font></font>
        Debug.WriteLine($"Method names count: {performanceInfo.MethodNames.Count}");<font></font>
        this.IsCommandExecuted = true;<font></font>
    }<font></font>
}</code></pre><br>
<p>  (IPerformanceCommand)   (Action),      ,   :</p><br>
<pre><code class="plaintext hljs">// custom "ExecutedCommand" will be executed after performance watching is completed<font></font>
using (PerformanceMeter&lt;PerformanceMeterController&gt;<font></font>
    .WatchingMethod()<font></font>
    .WithExecutingOnComplete<font></font>
        .Command(new ExecutedCommand("bla-bla-bla"))<font></font>
        .Action((pi) =&gt;<font></font>
        {<font></font>
            Debug.WriteLine($"Class name: {pi.ClassName}");<font></font>
        })<font></font>
    .Start())<font></font>
{<font></font>
    return Ok();<font></font>
}</code></pre><br>
<p> ,       <em>Debug</em>-  :</p><br>
<pre><code class="plaintext hljs">ExecutedCommand<font></font>
bla-bla-bla<font></font>
Method names count: 13<font></font>
Class name: Unchase.FluentPerformanceMeter.TestWebAPI.Controllers.PerformanceMeterController</code></pre><br>
<h3 id="a-namesamplecustomexceptionhandlera-dobavlenie-obrabotchikov-isklyucheniy-exception-handlers">    (Exception Handlers)</h3><br>
<p>    ,       ,    ,      (Exception handler)  :</p><br>
<pre><code class="plaintext hljs">using (var pm = PerformanceMeter&lt;PerformanceMeterController&gt;.StartWatching())<font></font>
{<font></font>
    // execute action throws Exception with exception handler<font></font>
    pm.Executing()<font></font>
        .WithExceptionHandler((ex) =&gt; Debug.WriteLine(ex.Message))<font></font>
        .Start(() =&gt; throw new Exception("Exception"));<font></font>
<font></font>
    // execute action throws custom Exception with exception handler<font></font>
    pm.Executing&lt;CustomException&gt;()<font></font>
       .WithExceptionHandler((ex) =&gt; { Debug.WriteLine(ex.Message); })<font></font>
       .Start(() =&gt;<font></font>
       {<font></font>
           throw new CustomException("Custom exception was occured!");<font></font>
       });<font></font>
<font></font>
    return Ok();<font></font>
}</code></pre><br>
<p>  <code>CustomException</code>, :</p><br>
<pre><code class="plaintext hljs">/// &lt;summary&gt;<font></font>
/// Custom exception.<font></font>
/// &lt;/summary&gt;<font></font>
public class CustomException : Exception<font></font>
{<font></font>
    public CustomException(string message) : base(message) { }<font></font>
<font></font>
    public CustomException(string message, Exception innerException) : base(message, innerException) { }<font></font>
<font></font>
    public CustomException() { }<font></font>
}</code></pre><br>
<p>   <em>Debug</em>-  :</p><br>
<pre><code class="plaintext hljs">Exception<font></font>
Custom exception was occured!</code></pre><br>
<p> ,     ,    -       , ,    - <code>PerformanceMeterController</code>:</p><br>
<pre><code class="plaintext hljs">[ApiController]<font></font>
[Route("api/v1/[controller]")]<font></font>
public class PerformanceMeterController : ControllerBase<font></font>
{<font></font>
    /// &lt;summary&gt;<font></font>
    /// Static constructor.<font></font>
    /// &lt;/summary&gt;<font></font>
    static PerformanceMeterController()<font></font>
    {<font></font>
        // set default exception handler for PerformanceMeterController class<font></font>
        PerformanceMeter&lt;PerformanceMeterController&gt;.SetDefaultExceptionHandler((ex) =&gt; Debug.WriteLine(ex.Message));<font></font>
    }<font></font>
<font></font>
    // ... actions<font></font>
}</code></pre><br>
<h3 id="a-namesamplesettingcachetimea-ustanovka-vremeni-hraneniya-dannyh-set-cache-time">     (Set Cache Time)</h3><br>
<p>        ,       .   ,    ,    . ,       - <code>PerformanceMeterController</code>:</p><br>
<pre><code class="plaintext hljs">[ApiController]<font></font>
[Route("api/v1/[controller]")]<font></font>
public class PerformanceMeterController : ControllerBase<font></font>
{<font></font>
    /// &lt;summary&gt;<font></font>
    /// Static constructor.<font></font>
    /// &lt;/summary&gt;<font></font>
    static PerformanceMeterController()<font></font>
    {<font></font>
        // set cache time for PerformanceMeterController class<font></font>
        PerformanceMeter&lt;PerformanceMeterController&gt;.SetMethodCallsCacheTime(5);<font></font>
    }<font></font>
<font></font>
    // ... actions<font></font>
}</code></pre><br>
<h3 id="a-namesamplesetcallerandsourcewithstopa-dobavlenie-dannyh-o-vyzyvayuschem-metod-i-meste-vyzova-i-preryvanie-zamera-proizvoditelnosti">         (   )</h3><br>
<ul>
<li><p>     ,   ,     <code>.CallerFrom("&lt;caller_name&gt;")</code> (   ,  <em>IHttpContextAccessor</em>)     <code>[MethodCaller("&lt;caller_name&gt;")]</code>.  ,       ,      .</p><br>
</li>
<li><p>         <code>.WithSettingData.CallerSourceData()</code>.</p><br>
</li>
<li><p>      <code>using</code>    <code>.StopWatching()</code>    <code>Dispose()</code>:</p><br>
</li>
</ul><br>
<pre><code class="plaintext hljs">[HttpPost("StartWatchingWithCallerName")]<font></font>
[MethodCaller("testCaller")]<font></font>
public ActionResult&lt;string&gt; StartWatchingWithCallerName([FromBody] string value)<font></font>
{<font></font>
    // method performance info will reach with caller name (if internal HttpContextAccessor is null)<font></font>
    using (var pm = PerformanceMeter&lt;PerformanceMeterController&gt;<font></font>
        .WatchingMethod()<font></font>
        .WithSettingData<font></font>
            .CallerSourceData()<font></font>
            .CallerFrom("Test caller")<font></font>
        .Start())<font></font>
    {<font></font>
        pm.StopWatching(); // stop watching here (or you can use "pm.Dispose();")<font></font>
        Thread.Sleep(2000);<font></font>
<font></font>
        return Ok(value);<font></font>
    }<font></font>
}</code></pre><br>
<p>    <code>GetPerformanceInfo</code> :</p><br>
<pre><code class="json hljs">{
  <span class="hljs-attr">"methodCalls"</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">"methodName"</span>: <span class="hljs-string">"StartWatchingWithCallerName"</span>,
      <span class="hljs-attr">"elapsed"</span>: <span class="hljs-string">"00:00:00.0019172"</span>,
      <span class="hljs-attr">"caller"</span>: <span class="hljs-string">"Test caller"</span>,
      <span class="hljs-attr">"startTime"</span>: <span class="hljs-string">"2019-12-06T13:35:45.3164507Z"</span>,
      <span class="hljs-attr">"endTime"</span>: <span class="hljs-string">"2019-12-06T13:35:45.3183679Z"</span>,
      <span class="hljs-attr">"customData"</span>: {
        <span class="hljs-attr">"customData123"</span>: <span class="hljs-number">123</span>,
        <span class="hljs-attr">"callerSourceLineNumber"</span>: <span class="hljs-number">525</span>,
        <span class="hljs-attr">"callerSource"</span>: <span class="hljs-string">"D:\\GitHub\\Unchase.FluentPerformanceMeter\\Unchase.FluentPerformanceMeter.TestWebAPI\\Controllers\\PerformanceMeterController.cs"</span><font></font>
      },<font></font>
      <span class="hljs-attr">"steps"</span>: []<font></font>
    }<font></font>
  ],<font></font>
  <span class="hljs-attr">"totalActivity"</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">"methodName"</span>: <span class="hljs-string">"StartWatchingWithCallerName"</span>,
      <span class="hljs-attr">"callsCount"</span>: <span class="hljs-number">1</span><font></font>
    }<font></font>
  ],<font></font>
  <span class="hljs-attr">"currentActivity"</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">"methodName"</span>: <span class="hljs-string">"StartWatchingWithCallerName"</span>,
      <span class="hljs-attr">"callsCount"</span>: <span class="hljs-number">0</span><font></font>
    }<font></font>
  ],<font></font>
  <span class="hljs-attr">"uptimeSince"</span>: <span class="hljs-string">"2019-12-06T13:35:45.2601668Z"</span>,
  <span class="hljs-attr">"className"</span>: <span class="hljs-string">"Unchase.FluentPerformanceMeter.TestWebAPI.Controllers.PerformanceMeterController"</span>,
  <span class="hljs-attr">"methodNames"</span>: [
    <span class="hljs-string">"StartWatchingWithCallerName"</span><font></font>
  ],<font></font>
  <span class="hljs-attr">"customData"</span>: { },
  <span class="hljs-attr">"timerFrequency"</span>: <span class="hljs-number">10000000</span>
}</code></pre><br>
<h2 id="zaklyuchenie"></h2><br>
<p> ,           .NET    .      ,      .</p><br>
<p>,     ,       ,        .</p><br>
<p>  open-source ,         ,   bug-report' (     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"></a>;      !).</p><br>
<h2 id="upd">UPD</h2><br>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">03/08/2020-</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バージョン</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v2.0.0の</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新機能の説明が</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、「WatchingPerformanceAttribute属性を使用したメソッドパフォーマンスの測定」</font></font></strong></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セクションに</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><em><font style="vertical-align: inherit;">追加され</font></em></a><font style="vertical-align: inherit;">ました</font><font style="vertical-align: inherit;">。</font></font></p><br>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">03/14/2020-</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バージョン</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v2.1.0の</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新機能の説明</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を「DIを使用したパフォーマンス測定結果の取得」</font></font></strong></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セクションに</font><font style="vertical-align: inherit;">追加しました</font><font style="vertical-align: inherit;">。</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja485184/index.html">タブ付き投票結果</a></li>
<li><a href="../ja485186/index.html">兆ドル規模のスタートアップ、または最も成功したバレー企業が生まれた方法</a></li>
<li><a href="../ja485190/index.html">アンドリューウン「機械学習への情熱」47-58章の翻訳</a></li>
<li><a href="../ja485194/index.html">セグメントツリー：すばやく簡単</a></li>
<li><a href="../ja485196/index.html">AvitoTech On Tour：KazanでのGoおよびフロントエンドミーティング</a></li>
<li><a href="../ja485200/index.html">混乱の始まり：iOSアプリケーションの起動速度に関する検死</a></li>
<li><a href="../ja485202/index.html">抑制システム</a></li>
<li><a href="../ja485204/index.html">トップに戻る：Amazonの資本金がまもなく1兆ドルを超える理由</a></li>
<li><a href="../ja485206/index.html">Typescriptはどのように私をがっかりさせましたか？</a></li>
<li><a href="../ja485208/index.html">フォールトトレラントITインフラストラクチャの作成。パート2. oVirt 4.3クラスターのインストールと構成</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>