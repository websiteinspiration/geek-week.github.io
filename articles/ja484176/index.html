<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💼 🏳️‍🌈 🙎🏽 Unityでのステータステンプレートの実装 🦅 🤕 👩🏽‍🤝‍👨🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ゲーム内エンティティのプログラミングプロセスでは、さまざまな状況でさまざまな方法で行動しなければならない状況が発生します。これは、状態の使用を示唆しています。
 
 しかし、ブルートフォースを使用すると、コードはすぐに多くの入れ子になったif-elseステートメントを含む複雑な混乱に変わります。
 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Unityでのステータステンプレートの実装</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484176/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4fa/bf6/c19/4fabf6c19761d028d621903401a84746.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ゲーム内エンティティのプログラミングプロセスでは、さまざまな状況でさまざまな方法で行動しなければならない状況が発生します。これは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の使用を示唆しています</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、ブルートフォースを使用すると、コードはすぐに多くの入れ子になったif-elseステートメントを含む複雑な混乱に変わります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この問題のエレガントな解決策として</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、デザインパターン "State»</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（ステートデザインパターン）</font><font style="vertical-align: inherit;">を使用できます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このチュートリアルを彼に捧げます！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チュートリアルから：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UnityでStateテンプレートの基本を学びます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステートマシンとは何か、いつ使用するかについて学習します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらのコンセプトを使用して、キャラクターの動きを制御する方法を学びます。</font></font></li>
</ul><br>
<blockquote><em></em>:      ; ,       Unity      C#.  ,     Unity 2019.2  C# 7.</blockquote><a name="habracut"></a><br>
<h2>  </h2><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクト資料を</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ダウンロードしてください</font><font style="vertical-align: inherit;">。</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zipファイル</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">解凍し、</font><font style="vertical-align: inherit;">Unityで</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初期</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトを開き</font><em><font style="vertical-align: inherit;">ます</font></em><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクトには、開始するのに役立ついくつかのフォルダーがあります。</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">資産/ RWの</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォルダが含まれている</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アニメーション</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マテリアル</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モデル</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プレハブ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">資源</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シーン</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプト、</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サウンド</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォルダを</font><font style="vertical-align: inherit;">そこに含まれるリソースに基づいて命名します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チュートリアルを完了するには、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シーン</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプト</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のみを使用し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
行く</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RW /シーン</font></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Main</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を開き</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">ゲームモードでは、中世の城の中にいるフードにキャラクターが表示されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/478/f1b/4e1/478f1b4e1ec3a2e8702e365e4082a605.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再生]</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">クリックして</font><font style="vertical-align: inherit;">、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カメラ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">どのように</font><font style="vertical-align: inherit;">動き、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キャラクター</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フレームにフィットする</font><font style="vertical-align: inherit;">かを確認し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">現時点では、この小さなゲームではインタラクションはありません。チュートリアルで作業します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ba3/62c/536/ba362c53682371294f90576b5fd5adc6.gif"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キャラクターを探索する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
では</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">階層、</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">選択</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文字を</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インスペクタを</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チェックしてください</font><font style="vertical-align: inherit;">。</font><em><font style="vertical-align: inherit;">Character</font></em><font style="vertical-align: inherit;">コントロールロジックを含む同じ名前の</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンポーネント</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が表示されます</font><font style="vertical-align: inherit;">。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/957/ffd/2ba/957ffd2ba0299d4b509b75bedb094581.png"></div><br><font style="vertical-align: inherit;"><em><font style="vertical-align: inherit;">RW / Scriptsに</font></em><font style="vertical-align: inherit;">ある</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Character.csを</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
開き</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">
スクリプトは多くのアクションを実行しますが、それらのほとんどは私たちにとって重要ではありません。</font><font style="vertical-align: inherit;">とりあえず、以下の方法に注目しましょう。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><code>Move</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：キャラクターを移動し、浮動値</font></font><code>speed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を移動速度と</font></font><code>rotationSpeed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">角速度</font><font style="vertical-align: inherit;">として</font><font style="vertical-align: inherit;">取得します</font><font style="vertical-align: inherit;">。</font></font></li>
<li><code>ResetMoveParams</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：このメソッド</font><font style="vertical-align: inherit;">は、キャラクターの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">動き</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と角速度</font><font style="vertical-align: inherit;">を</font><i><font style="vertical-align: inherit;">アニメーション化する</font></i><font style="vertical-align: inherit;">ために使用されるパラメーターをリセットします</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">掃除だけに使用します。</font></font></li>
<li><code>SetAnimationBool</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><code>param</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Boolタイプ</font><font style="vertical-align: inherit;">のアニメーションパラメータを設定します</font><font style="vertical-align: inherit;">。</font></font></li>
<li><code>CheckCollisionOverlap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイプ</font></font><code>Vector3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">受け取り、</font><font style="vertical-align: inherit;">を返し</font></font><code>bool</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コライダー</font><font style="vertical-align: inherit;">から指定された半径内にあるかどうかを判断</font><font style="vertical-align: inherit;">します</font><font style="vertical-align: inherit;">。</font></font></li>
<li><code>TriggerAnimation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：入力アニメーションパラメータを切り替えます</font></font><code>param</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><code>ApplyImpulse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><code>force</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイプの</font><font style="vertical-align: inherit;">入力パラメータに等しい文字にパルスを適用します</font></font><code>Vector3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下にこれらのメソッドを示します。</font><font style="vertical-align: inherit;">私たちのチュートリアルでは、それらの内容と内部作業は重要ではありません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステートマシンとは</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ステートマシンは、コンテナーが特定の瞬間の状態を格納する概念です。</font><font style="vertical-align: inherit;">入力データに基づいて、現在の状態に応じて結論を出し、このプロセスを新しい状態に渡すことができます。</font><font style="vertical-align: inherit;">状態マシンは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="noopener"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態図</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">として表すことができます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">状態図を準備すると、システムの考えられるすべての状態とそれらの間の遷移について考えることができます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態機械</font></font></h3><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有限状態マシン</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FSM（有限状態マシン）</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、4つの主要な</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マシン</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファミリの1つです</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">オートマトンは単純な機械の抽象的なモデルです。</font><font style="vertical-align: inherit;">それらは</font><font style="vertical-align: inherit;">、コンピュータサイエンスの理論的な分野</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="noopener"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">であるオートマトン</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="noopener"><em><font style="vertical-align: inherit;">理論の</font></em></a><font style="vertical-align: inherit;">枠組みの中で研究されてい</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
手短に：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FSMは有限量の</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件で</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">構成され</font><em><font style="vertical-align: inherit;">ます</font></em><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">常に</font><font style="vertical-align: inherit;">、これらの状態の1つだけが</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アクティブ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各状態</font><font style="vertical-align: inherit;">は、受信した一連の</font><em><font style="vertical-align: inherit;">受信情報に</font></em><font style="vertical-align: inherit;">基づい</font><font style="vertical-align: inherit;">て、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出力</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">としてどの状態になるかを決定し</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出力状態が新しいアクティブ状態になります。</font><font style="vertical-align: inherit;">つまり、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態間に遷移があります</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c43/111/f04/c43111f045f3727ab5f3b02c05c6ecc2.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これをよりよく理解するために、地面にあるプラットフォームゲームのキャラクターを考えてください。</font><font style="vertical-align: inherit;">キャラクターは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">立ち</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">これは</font><font style="vertical-align: inherit;">、プレイヤーがボタンを押してキャラクターがジャンプするまでの</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アクティブな状態</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><i><font style="vertical-align: inherit;">Standing</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
状態</font><font style="vertical-align: inherit;">は、ボタンの押下を重要な</font><em><font style="vertical-align: inherit;">入力</font></em><font style="vertical-align: inherit;">として識別</font><font style="vertical-align: inherit;">し、</font><em><font style="vertical-align: inherit;">出力</font></em><font style="vertical-align: inherit;">として</font><i><font style="vertical-align: inherit;">Jumping</font></i><font style="vertical-align: inherit;">状態に切り替わります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
このような動きの状態が一定数あり、キャラクターは一度に1つの状態にしかなれないとします。</font><font style="vertical-align: inherit;">これはFSMの例です。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">階層型ステートマシン</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
複数の状態が共通の物理ロジックを共有するFSMを使用するプラットフォーマーを考えてみましょう。</font><font style="vertical-align: inherit;">たとえば、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しゃがんだ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態</font><font style="vertical-align: inherit;">と</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">立った</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態で移動したりジャンプしたりできます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この場合、いくつかの入力変数は、2つの異なる状態に対して同じ動作と情報出力をもたらします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような状況では、一般的な動作を他の状態に委任することが論理的です。</font><font style="vertical-align: inherit;">さいわい、これは</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">階層型</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステートマシン</font><font style="vertical-align: inherit;">を使用して実現できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
階層的FSMでは、ある</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サブステート</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">委任</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自分への着信情報</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サブステートは、</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これにより、ロジックを維持しながら、FSMのサイズと複雑さを適切に削減できます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステータステンプレート</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼らの著書「</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Design Patterns：Elements of Reusable Object-Oriented Software」、</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Erich Gamma、Richard Helm、Ralph JohnsonおよびJohn Vlissidis（</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Gang of Four</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">は、Stateテンプレートの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タスク</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を次のように</font><font style="vertical-align: inherit;">定義して</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
います。内部状態。</font><font style="vertical-align: inherit;">この場合、オブジェクトがそのクラスを変更したように見えます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これをよりよく理解するには、次の例を検討してください。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">動きのロジックに関する受信情報を受け取るスクリプトは、ゲーム内エンティティに添付されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このクラスは、</font><font style="vertical-align: inherit;">単に</font><i><font style="vertical-align: inherit;">状態</font></i><font style="vertical-align: inherit;">クラスのインスタンスを参照</font><font style="vertical-align: inherit;">する</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">現在の状態</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">格納し</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受信情報はこの現在の状態に委任されます。現在の状態はそれを処理し、それ自体の中で定義された動作を作成します。</font><font style="vertical-align: inherit;">また、必要な状態遷移も処理します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">現在の状態</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数</font><font style="vertical-align: inherit;">が異なる状態を参照する場合があるため、同じスクリプトクラスの動作が異なるように見えます。</font><font style="vertical-align: inherit;">これが「ステータス」テンプレートの本質です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このプロジェクトでは、前述の</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Character</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスの動作は、状態によって異なります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">しかし、私たちは彼に彼自身を振る舞わせる必要があります！</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3d8/d20/f59/3d8d20f5921bf342b2ac84b5677e9a3b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的な場合、各状態クラスには、全体として状態の動作を可能にする3つの重要なポイントがあります。</font></font><br>
<br>
<ul>
<li><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エントリ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：これは、エンティティが状態に入る瞬間であり、状態に入るときに一度だけ実行する必要があるアクションを実行します。</font></font></li>
<li><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">終了</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：入力と同様-すべてのリセット操作はここで実行され、状態が変化する前にのみ実行する必要があります。</font></font></li>
<li><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新ループ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">各フレームで実行される</font><font style="vertical-align: inherit;">基本的な</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新ロジック</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は次のとおり</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">これは、たとえば、物理を更新するためのサイクルとプレイヤー入力を処理するためのサイクルなど、いくつかの部分に分けることができます。</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a26/847/8e6/a268478e6da2566cc58d1083fefed27f.png"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態と状態マシンの定義</font></font></h3><br><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RW / Scriptsに</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
移動し</font><font style="vertical-align: inherit;">、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StateMachine.cs</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を開き</font><em><font style="vertical-align: inherit;">ます</font></em><font style="vertical-align: inherit;">。</font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ご</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">想像のとおり、ステートマシンはステートマシンの抽象化を提供します。</font></font><code>CurrentState</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このクラスの中に</font><font style="vertical-align: inherit;">何が</font><font style="vertical-align: inherit;">正しく入って</font><font style="vertical-align: inherit;">いるかに注目してください</font><font style="vertical-align: inherit;">。ステートマシンの現在のアクティブな状態へのリンクを保存します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の概念を定義するために、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RW / Scriptsに</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移動</font><font style="vertical-align: inherit;">し、IDEで</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">State.cs </font></font></em><font style="vertical-align: inherit;"><em><font style="vertical-align: inherit;">スクリプト</font></em><font style="vertical-align: inherit;">を開き</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font><font style="vertical-align: inherit;">プロジェクト</font><i><font style="vertical-align: inherit;">状態の</font></i><font style="vertical-align: inherit;">すべての</font><i><font style="vertical-align: inherit;">クラスの</font></i><font style="vertical-align: inherit;">派生元</font><font style="vertical-align: inherit;">となる</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モデル</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">として使用する抽象クラスです</font><font style="vertical-align: inherit;">。プロジェクト資料のコードの一部はすでに準備されています。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<code>DisplayOnUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">画面上のUIに現在の状態の名前のみを表示します。あなたはその内部構造を知る必要はありません</font></font><code>UIManager.Alignment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、それは値を持っているかもしれない</font><font style="vertical-align: inherit;">タイプの列挙子を受け取る</font></font><code>Left</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">か、または</font><font style="vertical-align: inherit;">入力パラメータとしてそれを理解するだけ</font></font><code>Right</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。画面の左下または右下の状態名の表示は、その状態に依存します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、2つの保護された変数、</font></font><code>character</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">およびがあり</font></font><code>stateMachine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。変数</font></font><code>character</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のインスタンスを指す</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文字</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス</font><font style="vertical-align: inherit;">、および</font></font><code>stateMachine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インスタンスを参照する</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステートマシンの</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態と関連します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
状態インスタンスを作成するとき、コンストラクターはとをバインド</font></font><code>character</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し</font></font><code>stateMachine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くのインスタンスのそれぞれ</font></font><code>Character</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シーンには、独自のステートとステートマシンのセットを含めることができます。</font><font style="vertical-align: inherit;">次のメソッド</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
を</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">State.csに</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加して</font><font style="vertical-align: inherit;">、ファイルを保存します。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Enter</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    DisplayOnUI(UIManager.Alignment.Left);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">HandleInput</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogicUpdate</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">PhysicsUpdate</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Exit</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの仮想メソッドは、上記の主要な状態項目を設定します。</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態マシン</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font><em><font style="vertical-align: inherit;">状態</font></em><font style="vertical-align: inherit;">間を遷移する</font><font style="vertical-align: inherit;">とき</font><em><font style="vertical-align: inherit;">、</font></em></font><code>Exit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前の状態と</font></font><code>Enter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しい</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アクティブ状態</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を呼び出します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<code>HandleInput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>LogicUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><code>PhysicsUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一緒</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に更新サイクルを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">設定</font><i><font style="vertical-align: inherit;">します</font></i><font style="vertical-align: inherit;">。</font></font><code>HandleInput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プレイヤー入力を処理します。</font></font><code>LogicUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本的なロジックを</font></font><code>PhyiscsUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">処理し、ロジックと物理演算</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">処理します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に</font><font style="vertical-align: inherit;">、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StateMachine.csを</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再度開き</font><font style="vertical-align: inherit;">、次のメソッドを追加してファイルを保存します。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Initialize</span>(<span class="hljs-params">State startingState</span>)</span><font></font>
{<font></font>
    CurrentState = startingState;<font></font>
    startingState.Enter();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ChangeState</span>(<span class="hljs-params">State newState</span>)</span><font></font>
{<font></font>
    CurrentState.Exit();<font></font>
<font></font>
    CurrentState = newState;<font></font>
    newState.Enter();<font></font>
}</code></pre><br>
<code>Initialize</code><font style="vertical-align: inherit;"></font><code>CurrentState</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値</font></font><code>startingState</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">割り当てて</font><font style="vertical-align: inherit;">呼び出すこと</font><font style="vertical-align: inherit;">により、状態マシンを構成します</font></font><code>Enter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これにより、ステートマシンが初期化され、アクティブ状態が初めて設定されます。</font><em><font style="vertical-align: inherit;">状態</font></em></font><br>
<br>
<code>ChangeState</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">遷移を処理し</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">参照をに置き換える前に</font></font><code>Exit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、古いものを</font><font style="vertical-align: inherit;">呼び出します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">結局、彼はを要求</font><font style="vertical-align: inherit;">する</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
したがって、</font><em><font style="vertical-align: inherit;">状態</font></em><font style="vertical-align: inherit;">と</font><em><font style="vertical-align: inherit;">状態マシン</font></em><font style="vertical-align: inherit;">を設定し</font><font style="vertical-align: inherit;">ます。</font></font><code>CurrentState</code><font style="vertical-align: inherit;"></font><code>newState</code><font style="vertical-align: inherit;"></font><code>Enter</code><font style="vertical-align: inherit;"></font><code>newState</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">運動状態の作成</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プレーヤーのゲーム内エンティティの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">動きの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
さまざまな</font><i><font style="vertical-align: inherit;">状態</font></i><font style="vertical-align: inherit;">を示す次の状態図を見てください</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このセクションでは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FSM</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図に示す</font><i><font style="vertical-align: inherit;">動きの</font></i><font style="vertical-align: inherit;">「ステータス」テンプレートを実装します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4fa/bf6/c19/4fabf6c19761d028d621903401a84746.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モーションステート、つまり</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Standing</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ducking</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、および</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jumping</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">注意してください</font><font style="vertical-align: inherit;">。また、入力データがどのようにステート間の遷移を引き起こすかにも</font><font style="vertical-align: inherit;">注意してください</font><font style="vertical-align: inherit;">。これは階層化されたFSMであり、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grounded</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ducking</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Standing </font></font></em><font style="vertical-align: inherit;"><em><font style="vertical-align: inherit;">サブステートのサブステート</font></em><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unityに戻り、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RW / Scripts / Statesに移動し</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。そこで、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stateで</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">終わる名前のC＃ファイルがいくつか見つかります</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの各ファイルは1つのクラスを定義し、各クラスはから継承され</font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。したがって、これらのクラスは、プロジェクトで使用する状態を定義します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開催中</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RW / Scripts</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォルダーの</font><em><font style="vertical-align: inherit;">Character.cs</font></em><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ファイルの</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上までスクロールして</font></font><code>#region Variables</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、次のコードを追加します。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> StateMachine movementSM;
<span class="hljs-keyword">public</span> StandingState standing;
<span class="hljs-keyword">public</span> DuckingState ducking;
<span class="hljs-keyword">public</span> JumpingState jumping;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これ</font></font><code>movementSM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、インスタンスのモーションロジックを処理するステートマシンを指します</font></font><code>Character</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">また、ムーブメントのタイプごとに実装する3つの状態へのリンクを追加しました。</font><font style="vertical-align: inherit;">同じファイルに</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
移動し</font></font><code>#region MonoBehaviour Callbacks</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">以下の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="noopener"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MonoBehaviour</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">追加して</font><font style="vertical-align: inherit;">保存します</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    movementSM = <span class="hljs-keyword">new</span> StateMachine();<font></font>
<font></font>
    standing = <span class="hljs-keyword">new</span> StandingState(<span class="hljs-keyword">this</span>, movementSM);<font></font>
    ducking = <span class="hljs-keyword">new</span> DuckingState(<span class="hljs-keyword">this</span>, movementSM);<font></font>
    jumping = <span class="hljs-keyword">new</span> JumpingState(<span class="hljs-keyword">this</span>, movementSM);<font></font>
<font></font>
    movementSM.Initialize(standing);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    movementSM.CurrentState.HandleInput();<font></font>
<font></font>
    movementSM.CurrentState.LogicUpdate();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">FixedUpdate</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    movementSM.CurrentState.PhysicsUpdate();<font></font>
}</code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この</font></font><code>Start</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードは、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステートマシンの</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インスタンスを作成して</font><font style="vertical-align: inherit;">割り当て</font></font><code>movementSM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、さらにさまざまなモーションステートのインスタンスを作成します。</font><font style="vertical-align: inherit;">それぞれのモーションステートを作成するとき、インスタンス</font><font style="vertical-align: inherit;">と同様に</font></font><code>Character</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、キーワードを使用</font><font style="vertical-align: inherit;">してインスタンスへの参照を渡し</font></font><code>this</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font><code>movementSM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">最後に、</font><font style="vertical-align: inherit;">初期状態</font><font style="vertical-align: inherit;">を呼び出し</font></font><code>Initialize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">て</font></font><code>movementSM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">渡し</font></font><code>Standing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この方法では</font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、我々は呼んで</font></font><code>HandleInput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>LogicUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のための</font></font><code>CurrentState</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機械</font></font><code>movementSM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">同様に、中に</font></font><code>FixedUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちを呼び出す</font></font><code>PhysicsUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ため</font></font><code>CurrentState</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の機械</font></font><code>movementSM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは基本的にタスクをアクティブな状態に委任します。</font><font style="vertical-align: inherit;">これが「ステータス」テンプレートの意味です。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、各運動状態の内部の動作を設定する必要があります。</font><font style="vertical-align: inherit;">あなた自身を支えてください、たくさんのコードがあります！</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あなたの足にしっかり</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトウィンドウの</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RW /スクリプト/状態に</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
戻り</font><font style="vertical-align: inherit;">ます。</font><em><font style="vertical-align: inherit;">Grounded.cs</font></em><font style="vertical-align: inherit;">を</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開い</font><font style="vertical-align: inherit;">て、このクラスにコンストラクターと一致するコンストラクターがあることに注意してください</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このクラスはそれから継承するので、これは論理的です。</font><font style="vertical-align: inherit;">他のすべての</font><i><font style="vertical-align: inherit;">状態</font></i><font style="vertical-align: inherit;">クラスでも同じことがわかります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
次のコードを追加します。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><code>State</code><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Enter</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">base</span>.Enter();<font></font>
    horizontalInput = verticalInput = <span class="hljs-number">0.0f</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Exit</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">base</span>.Exit();<font></font>
    character.ResetMoveParams();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">HandleInput</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">base</span>.HandleInput();<font></font>
    verticalInput = Input.GetAxis(<span class="hljs-string">"Vertical"</span>);<font></font>
    horizontalInput = Input.GetAxis(<span class="hljs-string">"Horizontal"</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">PhysicsUpdate</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">base</span>.PhysicsUpdate();<font></font>
    character.Move(verticalInput * speed, horizontalInput * rotationSpeed);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで何が起こるかです：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">親クラスで定義された仮想メソッドの1つを再定義します。</font><font style="vertical-align: inherit;">親に存在する可能性のあるすべての機能を保持するために、</font></font><code>base</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オーバーライドされた各メソッドから同じ名前で</font><font style="vertical-align: inherit;">メソッドを呼び出します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、今後も使用する重要なテンプレートです。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次の行の</font></font><code>Enter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数</font></font><code>horizontalInput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font></font><code>verticalInput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、デフォルト値に設定されます。</font></font></li>
<li> <code>Exit</code> ,   ,   <code>ResetMoveParams</code> <code></code>       .</li>
<li>  <code>HandleInput</code>  <code>horizontalInput</code>  <code>verticalInput</code>       .          <em>W</em>, <em>A</em>, <em>S</em>  <em>D</em>.</li>
<li> <code>PhysicsUpdate</code>    <code>Move</code>,   <code>horizontalInput</code>  <code>verticalInput</code>,    .   <code>speed</code>   ,   <code>rotationSpeed</code> —  .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Standing.cs</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">開い</font><font style="vertical-align: inherit;">て、継承元を確認し</font></font><code>Grounded</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">上で述べたように、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スタンディング</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Groundedの</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サブステートである</font><font style="vertical-align: inherit;">ために起こりました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この関係を実装する方法はいくつかありますが、このチュートリアルでは継承を使用します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の</font></font><code>override</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドを</font><font style="vertical-align: inherit;">追加して</font><font style="vertical-align: inherit;">、スクリプトを保存します。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Enter</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">base</span>.Enter();<font></font>
    speed = character.MovementSpeed;<font></font>
    rotationSpeed = character.RotationSpeed;<font></font>
    crouch = <span class="hljs-literal">false</span>;<font></font>
    jump = <span class="hljs-literal">false</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">HandleInput</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">base</span>.HandleInput();<font></font>
    crouch = Input.GetButtonDown(<span class="hljs-string">"Fire3"</span>);<font></font>
    jump = Input.GetButtonDown(<span class="hljs-string">"Jump"</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogicUpdate</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">base</span>.LogicUpdate();
    <span class="hljs-keyword">if</span> (crouch)<font></font>
    {<font></font>
        stateMachine.ChangeState(character.ducking);<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (jump)<font></font>
    {<font></font>
        stateMachine.ChangeState(character.jumping);<font></font>
    }<font></font>
}</code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">では</font></font><code>Enter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、から継承した変数を設定します</font></font><code>Grounded</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">適用</font></font><code>MovementSpeed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し、</font></font><code>RotationSpeed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文字に</font></font><code>speed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">して</font></font><code>rotationSpeed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次に、それらはそれぞれ、</font><font style="vertical-align: inherit;">キャラクターの本質を意図</font><font style="vertical-align: inherit;">した</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の移動速度と角速度</font><font style="vertical-align: inherit;">に関係します</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、入力を格納する変数</font></font><code>crouch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とは、</font><font style="vertical-align: inherit;">falseにリセット</font></font><code>jump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li> <code>HandleInput</code>  <code>crouch</code>  <code>jump</code>       .    Main     <em>Shift</em>   true.       <em>Space</em>  <code>jump</code> ().</li>
<li> <code>LogicUpdate</code>    <code>crouch</code>  <code>jump</code>  <code>bool</code>.  <code>crouch</code>  true,  <code>movementSM.CurrentState</code>   <code>character.ducking</code>.  <code>jump</code>  true,     <code>character.jumping</code>.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクトを保存してアセンブルし、[ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再生</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]をクリックします</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">キー</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、および</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用してシーンをナビゲートできます</font><font style="vertical-align: inherit;">。</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shift</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キー</font><font style="vertical-align: inherit;">または</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Space</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キーを押す</font><font style="vertical-align: inherit;">と、対応する状態がまだ実装されていないため、予期しない動作が発生します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/450/89a/564/45089a5640a8d492b20ac5948e0fdf69.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テーブルオブジェクトの下に移動してみてください。</font><font style="vertical-align: inherit;">キャラクターのコライダーの高さのため、これは不可能であることがわかります。</font><font style="vertical-align: inherit;">キャラクターがこれを行うことができるように、しゃがむ動作を追加する必要があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テーブルの下に登る</font></font></h3><br><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ducking.cs</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
スクリプトを開きます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">yと同じ理由で</font></font><code>Ducking</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、クラスからも継承する</font><font style="vertical-align: inherit;">ことに注意してください</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次の</font><font style="vertical-align: inherit;">メソッドを</font><font style="vertical-align: inherit;">追加して</font><font style="vertical-align: inherit;">、スクリプトを保存します。</font></font><code>Grounded</code><font style="vertical-align: inherit;"></font><code>Standing</code><font style="vertical-align: inherit;"></font><code>override</code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Enter</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">base</span>.Enter();<font></font>
    character.SetAnimationBool(character.crouchParam, <span class="hljs-literal">true</span>);<font></font>
    speed = character.CrouchSpeed;<font></font>
    rotationSpeed = character.CrouchRotationSpeed;<font></font>
    character.ColliderSize = character.CrouchColliderHeight;<font></font>
    belowCeiling = <span class="hljs-literal">false</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Exit</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">base</span>.Exit();<font></font>
    character.SetAnimationBool(character.crouchParam, <span class="hljs-literal">false</span>);<font></font>
    character.ColliderSize = character.NormalColliderHeight;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">HandleInput</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">base</span>.HandleInput();<font></font>
    crouchHeld = Input.GetButton(<span class="hljs-string">"Fire3"</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogicUpdate</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">base</span>.LogicUpdate();
    <span class="hljs-keyword">if</span> (!(crouchHeld || belowCeiling))<font></font>
    {<font></font>
        stateMachine.ChangeState(character.standing);<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">PhysicsUpdate</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">base</span>.PhysicsUpdate();<font></font>
    belowCeiling = character.CheckCollisionOverlap(character.transform.position +<font></font>
        Vector3.up * character.NormalColliderHeight);<font></font>
}</code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"></font><code>Enter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクワットアニメーションの切り替えを引き起こすパラメータ</font><font style="vertical-align: inherit;">内に</font><font style="vertical-align: inherit;">しゃがみが割り当てられ、スクワットアニメーションを有効にします。</font><font style="vertical-align: inherit;">プロパティ</font></font><code>character.CrouchSpeed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とは、</font></font><code>character.CrouchRotationSpeed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値が割り当てられた</font></font><code>speed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>rotation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">動きと文字の角速度戻り、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクワットに移動します</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、</font></font><code>character.CrouchColliderHeight</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キャラクターのコライダーのサイズを設定します。これにより、しゃがんだときにコライダーの希望の高さが返されます。</font><font style="vertical-align: inherit;">最後</font></font><code>belowCeiling</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にfalseにリセットされます。</font></font></li>
<li> <code>Exit</code>     false.    .     ,  <code>character.NormalColliderHeight</code>.</li>
<li> <code>HandleInput</code>  <code>crouchHeld</code>    .   <em>Main</em>  <em>Shift</em>  <code>crouchHeld</code>  true.</li>
<li> <code>PhysicsUpdate</code>  <code>belowCeiling</code>         <code>Vector3</code>       <code>CheckCollisionOverlap</code>.       ,   ,     - .</li>
<li> <code>LogicUpdate</code> ,   <code>crouchHeld</code>  <code>belowCeiling</code>  true.        true,  <code>movementSM.CurrentState</code>   <code>character.standing</code>.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクトをビルドし、[ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再生</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]をクリックします</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これで、ステージ内を移動できます。</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shift</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を押す</font><font style="vertical-align: inherit;">と、キャラクターが座り、スクワットで移動できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プラットフォームの下を登ることもできます。</font><font style="vertical-align: inherit;">プラットフォームの下で</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shift</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キーを放して</font><font style="vertical-align: inherit;">も、キャラクターはシェルターを離れるまでしゃがんでいます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee4/dce/657/ee4dce657ae6be49244106652a168a3a.gif"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">舞い上がる！</font></font></h3><br><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jumping.csを</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
開き</font><em><font style="vertical-align: inherit;">ます</font></em><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">というメソッドが表示され</font></font><code>Jump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">それがどのように機能するか心配する必要はありません。</font><font style="vertical-align: inherit;">物理学とアニメーションを考慮してキャラクターがジャンプできるように使用されていることを理解するだけで十分です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常の</font></font><code>override</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドを</font><font style="vertical-align: inherit;">追加して</font><font style="vertical-align: inherit;">、スクリプトを保存します</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Enter</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">base</span>.Enter();<font></font>
    SoundManager.Instance.PlaySound(SoundManager.Instance.jumpSounds);<font></font>
    grounded = <span class="hljs-literal">false</span>;<font></font>
    Jump();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogicUpdate</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">base</span>.LogicUpdate();
    <span class="hljs-keyword">if</span> (grounded)<font></font>
    {<font></font>
        character.TriggerAnimation(landParam);<font></font>
        SoundManager.Instance.PlaySound(SoundManager.Instance.landing);<font></font>
        stateMachine.ChangeState(character.standing);<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">PhysicsUpdate</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">base</span>.PhysicsUpdate();<font></font>
    grounded = character.CheckCollisionOverlap(character.transform.position);<font></font>
}</code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部では、</font></font><code>Enter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シングルトン</font></font><code>SoundManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がジャンプの音を再現します。</font><font style="vertical-align: inherit;">その後</font></font><code>grounded</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、デフォルト値にリセットされます。</font><font style="vertical-align: inherit;">最後に呼ばれてい</font></font><code>Jump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部では</font><font style="vertical-align: inherit;">、キャラクターの脚の隣</font><font style="vertical-align: inherit;">の</font></font><code>PhysicsUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポイント</font></font><code>Vector3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がに送信</font><font style="vertical-align: inherit;">されます。</font></font><code>CheckCollisionOverlap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これは、キャラクターが地面にいるときに</font></font><code>grounded</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trueが割り当てられる</font><font style="vertical-align: inherit;">ことを意味し</font><font style="vertical-align: inherit;">ます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">では</font></font><code>LogicUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>grounded</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trueの</font><font style="vertical-align: inherit;">場合</font><font style="vertical-align: inherit;">、</font></font><code>TriggerAnimation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タッチダウンアニメーション</font><font style="vertical-align: inherit;">を呼び出し</font><font style="vertical-align: inherit;">てオンにすると、タッチダウンサウンドが再生され、に</font></font><code>movementSM.CurrentState</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変わります</font></font><code>character.standing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、これで</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、「状態」テンプレート</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用し</font><em><font style="vertical-align: inherit;">た</font></em><font style="vertical-align: inherit;"> FSM変位の完全な実装が完了しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">プロジェクトをビルドして実行します。</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スペース</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">押し</font><font style="vertical-align: inherit;">てキャラクターをジャンプさせます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ebd/e16/05d/ebde1605dc739588529c51509e19c0a8.gif"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次はどこへ？</font></font></h2><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトの材料は、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドラフトプロジェクトおよび完成したプロジェクトを持っています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その有用性にもかかわらず、ステートマシンには制限があります。</font><font style="vertical-align: inherit;">並行ステートマシンとプッシュダウンオートマトンマシンは、これらの制限の一部を処理できます。</font><font style="vertical-align: inherit;">これらについては、Robert Nystromの著書「</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="noopener"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Game Programming Patterns」</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で読むことができます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、</font><font style="vertical-align: inherit;">より複雑なゲーム内エンティティを作成するために使用される</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="noopener"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">動作ツリー</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を調べることにより、トピックをより深く探求できます</font><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja484166/index.html">VVVVVV ??? VVVVVV !!! :)</a></li>
<li><a href="../ja484168/index.html">Angular CDKから仮想スクロールの戦略を書きます</a></li>
<li><a href="../ja484170/index.html">チェックポイントをR77.30から80.20に更新</a></li>
<li><a href="../ja484172/index.html">Unityでの継続的インテグレーション：組み立て時間を短縮し、リソースを節約する方法+ギフトとしてのペイライン</a></li>
<li><a href="../ja484174/index.html">「極端な」条件での城の飲酒、または「DOZOR」ショーへの参加方法</a></li>
<li><a href="../ja484178/index.html">Planet Earth用のインテリジェントイーサネットスイッチ</a></li>
<li><a href="../ja484180/index.html">Rostelecom仮想PBX：APIを介して実行できる内容と方法</a></li>
<li><a href="../ja484182/index.html">Xenobots：カエル細胞からの生きているナノロボット</a></li>
<li><a href="../ja484186/index.html">LDAP-「認証」はアンチパターンです</a></li>
<li><a href="../ja484188/index.html">データベース設計基準</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>