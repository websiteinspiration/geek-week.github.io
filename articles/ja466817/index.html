<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏽‍🤝‍👨🏻 🎡 🤱🏽 Varonisが暗号化マイニングウイルスを発見：私たちの調査 👩🏻‍🏫 👲🏾 🔓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="私たちのセキュリティ調査部門は最近、中規模企業の1つでほぼ完全に暗号化されたマイニングウイルスネットワークのケースを実施しました。分析
 収集マルウェアサンプルが新しい変形することが示された
 このようなウイルスが発見されたと呼ばれる、ノーマンその存在を隠すために様々な方法を用いて、。さらに、鉱業オ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Varonisが暗号化マイニングウイルスを発見：私たちの調査</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/varonis/blog/466817/"><img src="https://habrastorage.org/webt/b3/fo/_5/b3fo_5ib64rlap_izdap4paolls.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのセキュリティ調査部門は最近、中規模企業の1つでほぼ完全に暗号化されたマイニングウイルスネットワークのケースを実施しました。</font><font style="vertical-align: inherit;">分析</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
収集マルウェアサンプルが新しい変形することが示された</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このようなウイルスが</font><font style="vertical-align: inherit;">発見された</font><font style="vertical-align: inherit;">と呼ばれる、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ノーマン</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その存在を隠すために様々な方法を用いて、。</font><font style="vertical-align: inherit;">さらに、</font><font style="vertical-align: inherit;">鉱業オペレーターに関連している可能性の</font><font style="vertical-align: inherit;">ある</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インタラクティブなWebシェル</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が発見されました</font><font style="vertical-align: inherit;">。</font></font><br>
<a name="habracut"></a><br>
<h2><font color="#D21927"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">調査の概要</font></font></font></h2><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Varonisがクリプトマイナーによる大規模な感染を検出しました：社内のほとんどすべてのサーバーとワークステーションがそのようなソフトウェアに感染していた </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1年以上前に発生した最初の感染以来、変更と感染したデバイスの数は着実に増加しています</font></font></li>
<li>      Monero (Norman)         ,   </li>
<li>      DuckDNS (  Dynamic DNS)      (C&amp;C ),          </li>
<li> Norman —    Monero        — XMRig</li>
<li>           PHP-. ,    ,         .          </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> この記事では、リモートWebシェルおよび暗号マイナーに対する保護に関するVaronisの推奨事項を理解できます。</font></font></li>
</ul><br>
<h2><font color="#D21927"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">調査</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
調査は次のパイロット</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プラットフォーム</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サイバーセキュリティVaronis</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Varonis the Data Security Platform）</font><font style="vertical-align: inherit;">中に開始されました</font><font style="vertical-align: inherit;">。これにより、ファイルシステムでのこのアクションの異常に関連する、インターネットへのクエリ（Webプロキシ経由）に対するネットワークレベルの異常なイベントの疑わしい数をすばやく特定できます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
お客様はすぐに、プラットフォームによって識別されたデバイス</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
が、最近アプリケーションの障害とネットワークの速度低下を報告したのと同じユーザーに属している</font><font style="vertical-align: inherit;">ことを示しました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのチームは、Varonisプラットフォームによって生成されたアラートに従って、感染したステーションから別のステーションに移動しながら、お客様の環境を手動で調査しました。インシデント対応チームはまた</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、DatAlertモジュール</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">特別なルールを開発して、</font><font style="vertical-align: inherit;">アクティブにマイニングしているコンピューターを検出しました。これにより、脅威を迅速に排除することができました。収集されたマルウェアのサンプルは、フォレンジックおよび開発部門のチームに送信され、サンプルの追加調査を実施する必要があるとのことでした。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
感染したホストは、</font><b><font style="vertical-align: inherit;">DuckDNSコールの</font></b><font style="vertical-align: inherit;">使用を通じて発見されました</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザーが独自のドメイン名を作成し、それらを変化するIPアドレスにすばやくマップできるようにする動的DNSサービス。上記のように、インシデント内のマルウェアのほとんどはコントロールセンター（C＆C）に接続するためにDuckDNSに向かい、もう1つは構成パラメーターを取得したり、新しいデータを送信したりしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ほとんどすべてのサーバーとコンピューターがマルウェアに感染していました。基本的に、</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
暗号マイナーの一般的なバリアント</font><font style="vertical-align: inherit;">が使用されました</font><font style="vertical-align: inherit;">。その他のマルウェアには、パスワードダンプツール、PHPシェルなどがあり、数年前からいくつかのツールが機能しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果をお客様に提供し、マルウェアを環境から削除して、さらなる感染を阻止しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
発見されたすべての暗号鉱山労働者のサンプルのうち、1人は離れていました。</font><font style="vertical-align: inherit;">私たちは彼を</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ノーマン</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼んだ</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font color="#D21927"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会いましょう！</font><font style="vertical-align: inherit;">ノーマン </font><font style="vertical-align: inherit;">クリプトマイナー</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Normanは、XMRigコードに基づく高性能Monero暗号通貨マイナーです。</font><font style="vertical-align: inherit;">発見された他の鉱山労働者のサンプルとは異なり、ノーマンはセキュリティソフトウェアによる分析からそれを隠す方法を使用して、検出を回避し、それ以上の配布を防ぎます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一見すると、このマルウェアはsvchost.exeという名前で隠れている通常のマイナーです。</font><font style="vertical-align: inherit;">それにもかかわらず、研究はそれが仕事の検出とメンテナンスから隠すより興味深い方法を使用することを示しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このマルウェアの展開プロセスは、3つの段階に分けられます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> パフォーマンス;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 実装; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 鉱業。 </font></font></li>
</ul><br>
<h2><font color="#D21927"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップバイステップ分析</font></font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステージ1.実行</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のステップは、svchost.exe実行可能ファイルから始まります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
悪意のあるソフトウェアは、珍しいNSIS（Nullsoft Scriptable Install System）を使用してコンパイルされます。</font><font style="vertical-align: inherit;">NSISは、Windowsインストーラーの作成に使用されるオープンソースシステムです。</font><font style="vertical-align: inherit;">SFXと同様に、このシステムはファイルのアーカイブと、インストーラーの実行中に実行されるスクリプトファイルを作成します。</font><font style="vertical-align: inherit;">スクリプトファイルは、実行するファイルをプログラムに指示し、アーカイブ内の他のファイルと対話できます。</font></font><br>
<br>
<i><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実行可能ファイルからNSISスクリプトファイルを取得するには、7zipバージョン9.38を使用する必要があります。これは、新しいバージョンではこの関数が実装されていないためです。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NSISアーカイブマルウェアには、次のファイルが含まれています。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CallAnsiPlugin.dll、CLR.dll-.NET DLL関数を呼び出すためのNSISモジュール。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5zmjbxUIOVQ58qPR.dll-メインペイロードDLL; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4jy4sobf.acz、es1qdxg2.5pk、OIM1iVhZ.txt-ペイロードファイル。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Retreat.mp3、Cropped_controller_config_controller_i_lb.pngは、それ以上の悪意のあるアクティビティに関連付けられていない単なるファイルです。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ペイロードを実行するNSISスクリプトファイルのコマンドを以下に示します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dc/ch/st/dcchst5kvffhufreb1smhmw3lzs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
悪意のあるソフトウェアは、パラメータとして他のファイルを受け入れる5zmjbxUIOVQ58qPR.dll関数を呼び出すことによって実行されます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステージ2.実装 </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5zmjbxUIOVQ58qPR.dllファイルは、上記のNSISスクリプトから続くメインペイロードです。メタデータをすばやく分析したところ、DLLは元々Norman.dllと呼ばれていたことがわかりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DLLファイルは.NETで開発され</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
、有名な市販製品のAgile .NET Obfuscatorを使用した</font><font style="vertical-align: inherit;">トリプル難読化により、リバースエンジニアリングから保護されてい</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実装の過程で、多くの自己紹介実装操作は、自分のプロセスだけでなく他のプロセスにも関与します。 OSのビット深度に応じて、マルウェアは</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システムフォルダーへの異なるパスを選択し、異なるプロセスを開始します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jp/sy/zn/jpsyzngdt-zv5qoswztui4odjrs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マルウェアは、システムフォルダーへのパスに基づいて、開始する異なるプロセスを選択します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wp/q9/jc/wpq9jcqxrvwvbfkgh9-wca2qmsi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デプロイされたペイロードには2つの主要な機能があります。暗号マイナーの実行と検出の防止です。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OSが64ビットの場合</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
svchosts.exeソースファイル（NSISファイル）を実行すると、独自の新しいプロセスが作成され、そこにペイロードが挿入されます（1）。</font><font style="vertical-align: inherit;">その後すぐに、彼はnotepad.exeまたはexplorer.exeを起動し、それに暗号マイナーを注入します（2）。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3n/rc/bt/3nrcbtfzkotbmjp_zqdvrzt9r_0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、ソースファイルsvchost.exeがシャットダウンし、新しいファイルsvchost.exeがマイナープロセスの動作を監視するプログラムとして使用されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ng/ze/bq/ngzebqxper1bhxzwrqxvygimlac.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OSが32ビットの場合</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
元のsvchosts.exeファイル（NSISファイル）の実行中に、64ビットバージョンの場合と同様に、独自のプロセスを複製し、ペイロードを注入します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、マルウェアはexplorer.exeユーザープロセスにペイロードを挿入します。悪意のあるコードがすでにそこから新しいプロセス（wuapp.exeまたはvchost.exe）を開始し、それにマイナーを挿入します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kb/c3/2q/kbc32qdqrmcwqzciy5vhesry224.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
悪意のあるソフトウェアは、explorer.exeに実装の事実を隠し、以前に実装されたコードをwuapp.exeおよび空の値によって上書きします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dz/uz/ct/dzuzct_donm4jroc54uj4bqzy2i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
64ビット環境での実行の場合と同様に、元のsvchost.exeプロセスは終了し、2番目のプロセスは、ユーザーがプロセスを終了した場合にexplorer.exeに悪意のあるコードを再注入するために使用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実行アルゴリズムの最後に、マルウェアは常に合法的なプロセスに暗号マイナーを埋め込みます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、ユーザーがタスクマネージャーを起動したときにマイナーをシャットダウンして検出を防ぐように設計されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タスクマネージャを起動すると、wuapp.exeプロセスが終了することに注意してください。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nm/dw/y0/nmdwy02bz2qho6dgotsq_wprv6a.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タスクマネージャーを閉じた後、マルウェアはwuapp.exeプロセスを再度開始し</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
、鉱山労働者に再び注入します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステージ3.マイナー</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記のXMRigマイナーを検討してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
悪意のあるソフトウェア</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
は、OSのビット深度と実行アルゴリズムのステージに応じて</font><font style="vertical-align: inherit;">、偽装したUPXバージョンのマイナーをメモ帳、exe、explorer.exe、</font><font style="vertical-align: inherit;">svchost.exe、またはwuapp.exeに挿入します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マイナーのPEヘッダーが削除されました。下のスクリーンショットでは、UPXを使用してマスクされていることがわかります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/u0/es/8g/u0es8g-pm5lpx7bov_hwarxv-ws.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ダンプを作成して実行可能ファイルを再構築した後、それをなんとか立ち上げました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/il/nl/c-/ilnlc-lauzxcgsjrkg0pggo1wik.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ターゲットのXMRサイトへのアクセスが禁止されているため、このマイナーを効果的に無効にできることに注意してください。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マイナー構成：</font></font></strong><br>
<br>
<pre><code class="plaintext hljs">"url": "pool.minexmr.com:5555","user":<font></font>
"49WvfokdnuK6ojQePe6x2M3UCD59v3BQiBszkuTGE7wmNJuyAvHM9ojedgxMwNx9tZA33P84EeMLte7t6qZhxNHqHyfq9xA","pass":"x"</code></pre> <br>
<h2><font color="#D21927"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C＆Cにデータを転送する謎のPHPシェル</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この調査の過程で、フォレンジックスペシャリストは、注意を引くXSLファイルを発見しました。</font><font style="vertical-align: inherit;">サンプルを詳細に分析した後、コントロールセンター（C＆Cサーバー）に常時接続されている新しいPHPシェルが発見されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
XSLファイルは、お客様の環境のいくつかのサーバーで見つかり、sysWOW64ディレクトリのフォルダーにある既知のWindows実行可能ファイル（mscorsv.exe）によって起動されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マルウェアフォルダーはAutoRecoverと呼ばれ、</font><b><font style="vertical-align: inherit;">いくつかのファイルが</font></b><font style="vertical-align: inherit;">含まれ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ていました。</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XSLファイル：xml.XSL</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9つのDLLファイル</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実行可能ファイル：</font></font></b><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Msscorsv.exe</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wmiprvse.exe</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/dr/bc/nv/drbcnvij4atirz8jn_tncb6ndkc.png"><br>
<br>
<h2><font color="#D21927"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XSLファイル</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
XSLファイルは、CSSで使用されるテーブルに類似したスタイルシートであり、XMLドキュメントの表示方法を記述します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メモ帳を使用して、実際にはXSLファイルではなく、難読化されたZend Guard PHPコードであることがわかりました。</font><font style="vertical-align: inherit;">この奇妙な事実は、これが</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マルウェアのペイロードであり、その実行アルゴリズムに基づいている</font><font style="vertical-align: inherit;">ことを示唆し</font><font style="vertical-align: inherit;">ています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/b9/gx/z5/b9gxz56io5zcmlgbtephvyuxyn8.png"><br>
<br>
<h2><font color="#D21927"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9つのDLL</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
XSLファイルを最初に分析した結果、非常に多くの</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DLL </font><font style="vertical-align: inherit;">を持つこと</font><font style="vertical-align: inherit;">が理にかなっ</font><font style="vertical-align: inherit;">ていると結論づけました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">メインフォルダーには、php.dllと呼ばれるDLLと、SSLおよびMySQLに関連する他の3つのライブラリーが含まれています。</font><font style="vertical-align: inherit;">サブフォルダで、専門家は4つのPHPライブラリと1つのZend Guardライブラリを見つけました。</font><font style="vertical-align: inherit;">それらはすべて正当であり、PHPインストールパッケージから、または外部DLLとして取得されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この段階では、マルウェアはPHPに基づいており、Zend Guardによって難読化されていると想定されていました。</font></font><br>
<br>
<h2><font color="#D21927"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実行可能ファイル</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このフォルダーには、Mscorsv.exeとWmiprvse.exeの2つの実行可能ファイルも含まれていました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mscorsv.exeファイルを分析したところ、ProductNameパラメーターが「Microsoft。ネットフレームワーク。 " </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初は奇妙に見えましたが、Wmiprvse.exeの分析により、状況をよりよく理解することができました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wmiprvse.exeファイルも署名されていませんが、PHPグループの著作権記号とPHPアイコンが含まれています。大まかなスキャン中に、PHPヘルプからのコマンドがその行に見つかりました。 -versionスイッチで実行すると、これがZend Guardを実行するように設計された実行可能ファイルであることが発見されました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9c/xw/ju/9cxwjuu7xoqggrzco-tgun7kpsw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mscorsv.exeを同じ方法で起動すると、同じデータが表示されました。</font><font style="vertical-align: inherit;">これら2つのファイルのバイナリデータを比較し、メタデータの</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
著作権と会社名/製品名を</font><font style="vertical-align: inherit;">除いて、それらが同一であることを確認しました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mp/7y/qk/mp7yqkfz6uqusknzixm5vrwun9e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これに基づいて、XSLファイルには、mscorsv.exeという名前で非表示のZend Guard実行可能ファイルを使用して起動されるPHPコードが含まれていると結論付けられました。</font></font><br>
<br>
<h2><font color="#D21927"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XSLファイルの解析</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
専門家はインターネット検索を使用して、Zend Guardの難読化を解除し、元のxml.XSLファイルを復元するツールをすばやく入手</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5a/ek/nj/5aeknjt7mwgxx96m3t5twger2h0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しました。マルウェア自体が、コントロールセンター（C＆Cサーバー）に常に接続されているPHPシェルであることが判明しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
送受信するコマンドと出力は暗号化されます。</font><font style="vertical-align: inherit;">ソースコードを受け取ったので、暗号化キーとコマンドの両方がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このマルウェアには、次の組み込み機能が含まれています。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eval-コードで既存の変数を変更するために一般的に使用されます </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ローカルファイルレコード </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベースの機能 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PSEXECの機能 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非表示の実行 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロセスとサービスのマッピング </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の変数は、マルウェアに複数のバージョンがあることを示唆しています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/al/id/bs/alidbstswyy1huff1onuh5ma7bg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サンプルを収集したところ、次のバージョンが見つかりました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.5f</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.4p</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.4o</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システムにマルウェアが常に存在することを保証する唯一の機能は、実行されると、自身を実行するサービスを作成し、その名前</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
がバージョンごとに変更されることです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スペシャリストはインターネット上で同様のサンプルを見つけようとし、マルウェアを発見しました。マルウェア</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
は、既存のサンプルの以前のバージョンでした。</font><font style="vertical-align: inherit;">フォルダーの内容は類似していますが、XSLファイルが異なり、異なるバージョン番号が指定されています。</font></font><br>
<br>
<h2><font color="#D21927"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parle Wu Malwar？</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく、このマルウェアの祖国はフランスまたは別のフランス語圏の国です。SFXファイルには、作成者がWinRARのフランス語バージョンを使用して作成したことを示すフランス語のコメントが含まれていました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xq/e2/cd/xqe2cddtfruhzwvz3mro0iqglpm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、コード内の一部の変数と関数もフランス語で命名されました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vx/95/9d/vx959dqslson6ybxzoawqzzyvog.png"><br>
<br>
<img src="https://habrastorage.org/webt/sk/cv/rd/skcvrd_tj6ntrgghhjzl1fhpjy8.png"><br>
<br>
<h2><font color="#D21927"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">進行状況を監視し、新しいチームを待つ</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
専門家はマルウェアコードを変更し、既に変更された</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バージョンを</font><font style="vertical-align: inherit;">安全に起動して、</font><font style="vertical-align: inherit;">受け取ったコマンドに関する情報を収集しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xv/tf/uf/xvtfufticasuciea8sfzqyrpppc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の通信セッションの終わりに、専門家はマルウェアがEVAL64スタートアップキーの引数としてBase64でエンコードされたコマンドを受け取ることを確認しました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコマンドはデコードされて実行されます。</font><font style="vertical-align: inherit;">いくつかの内部変数（読み取りおよび書き込みバッファーのサイズ）を変更した後、マルウェアはコマンドを待機するという作業サイクルに入ります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在、新しいチームは受けていません。</font></font><br>
<br>
<h2><font color="#D21927"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インタラクティブなPHPシェルと暗号マイナー：それらは関連していますか？</font></font></font></h2> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Varonisの専門家は、NormanがPHPシェルに関連付けられているかどうかはわかりません。この仮定には賛否両論があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なぜ関連しているのか</font></font></h3><br>
<ul>
<li>               ,           .  ,       (,      ,     « »),        PHP-    ,   .</li>
<li>    ,    ,            .        . </li>
<li>  Norman,   PHP-   DuckDNS. </li>
</ul><br>
<h3>     </h3><br>
<ul>
<li>        PHP-    .     C++,   —  PHP. ,     ,     -. </li>
<li>      PHP-       . </li>
<li>      , ,    . </li>
</ul><br>
<h3>      </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コントロールセンター（C＆Cサーバー）からのコマンドを必要とする悪意のあるソフトウェアは、通常のウイルスのようには見えません。</font><font style="vertical-align: inherit;">そのアクションはそれほど予測可能ではなく、ハッカーやペンテスターに​​よる自動ツールやスクリプトなしで実行されるアクションに似ています。</font><font style="vertical-align: inherit;">したがって、マルウェアの署名なしでこれらの攻撃を検出することは、従来のウイルス対策スキャンよりも困難な作業です。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下は、リモートシェルから企業を保護するための3つの推奨事項です。</font></font></strong><br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのソフトウェアを最新の状態に保つ</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
攻撃者はソフトウェアとオペレーティングシステムの脆弱性を悪用して組織のネットワーク全体に拡散し、目的のデータを検索し</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
てそれ</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">盗みます。</font><font style="vertical-align: inherit;">パッチを適時にインストールすると、このような脅威のリスクが大幅に減少します。</font></font></li>
<li><b>      </b><br>
 ,         .        <br>
        ,       ,          .</li>
<li><b>  </b><br>
   / -            (C&amp;C ),          <br>
  .</li>
</ol><br>
<strong>   ?    : </strong><br>
<br>
<ol>
<li><b>    </b><br>
          ,    .</li>
<li><b>    - </b><br>
     ,                    .</li>
<li><b>            </b> (            ).<br>
             ,         .    ,            ,              .</li>
<li><b>   </b> <br>
 ,       .        («    .»).</li>
<li><b> DNS      Dynamic DNS ( DuckDNS)</b>\<br>
<br>
  ,  DuckDNS    Dynamic DNS        ,  DuckDNS             .</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インシデント対応計画</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を</font><b><font style="vertical-align: inherit;">作成する</font></b><font style="vertical-align: inherit;">このようなインシデントが灰色の暗号化マイニングの脅威を自動的に検出、制限、および排除するために必要な手順が整っていることを確認してください。</font></font></li>
</ol><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Varonisのお客様への注意。</font></font></strong><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Varonis DatAlertに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、暗号マイニング用のマルウェアを検出する脅威モデルが含まれています。</font><font style="vertical-align: inherit;">お客様は、ブラックリストの候補となるドメインに基づいて、ソフトウェアのターゲットを絞った検出に関する独自のルールを作成することもできます。</font><font style="vertical-align: inherit;">DatAlertの最新バージョンを使用し、適切な脅威モデルを適用していることを確認するには、営業担当者またはVaronisサポートにお問い合わせください。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja466807/index.html">Python、世界をむさぼり食う：1人の開発者のサイドプロジェクトとして、人気のプログラミング言語になった</a></li>
<li><a href="../ja466809/index.html">サークルは閉じています。ミタプスが夢の仕事を見つけるのにどのように役立ちましたか</a></li>
<li><a href="../ja466811/index.html">.NETプラットフォームの歴史と代替</a></li>
<li><a href="../ja466813/index.html">Posit-arithmetic：自分のフィールドで浮動小数点を打ち負かします。パート2</a></li>
<li><a href="../ja466815/index.html">NEC HYDRAstor HS8の技術概要など</a></li>
<li><a href="../ja466819/index.html">iOSでのプロモーションオファーの実装。サブスクリプションでさらに稼ぐには？</a></li>
<li><a href="../ja466821/index.html">Amazon AWS Marketplaceから3CXをインストールする</a></li>
<li><a href="../ja466823/index.html">Bitrix24でビジネスプロセスの移行を設定する方法</a></li>
<li><a href="../ja466829/index.html">Rでのbigint IDの操作に関するいくつかのタッチ</a></li>
<li><a href="../ja466831/index.html">モノリシックなUnixライクなOSの開発-ヒープ（4）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>