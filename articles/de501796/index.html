<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßöüèº ‚≠ïÔ∏è üó®Ô∏è 7 gef√§hrliche Fehler, die in C # /. NET leicht zu machen sind ‚¨õÔ∏è ‚öôÔ∏è üåù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor Beginn des Kurses ‚ÄûC # ASP.NET Core Developer‚Äú wurde eine √úbersetzung des Artikels erstellt .
 
 
 
 C # ist eine gro√üartige Sprache , und das .NE...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>7 gef√§hrliche Fehler, die in C # /. NET leicht zu machen sind</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/501796/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vor Beginn des Kurses </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄûC # ASP.NET Core Developer‚Äú wurde</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine √úbersetzung des Artikels erstellt </font><font style="vertical-align: inherit;">.</font></font></b></i><br>
<br>
<img src="https://habrastorage.org/webt/k8/vz/cz/k8vzcz5umofkpvfxz9zuj1pqibu.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C # ist eine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gro√üartige Sprache</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , und das .NET Framework ist auch sehr gut. </font><font style="vertical-align: inherit;">Durch die starke Eingabe in C # k√∂nnen Sie die Anzahl der Fehler reduzieren, die Sie im Vergleich zu anderen Sprachen hervorrufen k√∂nnen. </font><font style="vertical-align: inherit;">Au√üerdem hilft das allgemeine intuitive Design im Vergleich zu JavaScript (wo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wahr falsch ist</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) sehr. </font><font style="vertical-align: inherit;">Jede Sprache hat jedoch ihren eigenen Rechen, auf den man leicht treten kann, zusammen mit falschen Vorstellungen √ºber das erwartete Verhalten der Sprache und Infrastruktur. </font><font style="vertical-align: inherit;">Ich werde versuchen, einige dieser Fehler im Detail zu beschreiben.</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Verstehe die verz√∂gerte (faule) Ausf√ºhrung nicht</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich glaube, dass erfahrene Entwickler diesen .NET-Mechanismus kennen, aber er kann weniger sachkundige Kollegen √ºberraschen. Kurz gesagt, die Methoden / Operatoren, die </font><font style="vertical-align: inherit;">jedes Ergebnis </font><font style="vertical-align: inherit;">zur√ºckgeben </font></font><code><code>IEnumerable&lt;</code>T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>yield</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zum Zur√ºckgeben </font><font style="vertical-align: inherit;">verwenden </font><font style="vertical-align: inherit;">, werden nicht in der Codezeile ausgef√ºhrt, die sie tats√§chlich aufruft. Sie werden ausgef√ºhrt, wenn auf die resultierende Sammlung auf irgendeine Weise zugegriffen wird *. Beachten Sie, dass die meisten LINQ-Ausdr√ºcke ihre Ergebnisse schlie√ülich mit </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ausbeute zur√ºckgeben</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Betrachten Sie als Beispiel den folgenden ungeheuren Unit-Test.</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">TestMethod</span>]<font></font>
[<span class="hljs-meta">ExpectedException(typeof(ArgumentNullException))</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Ensure_Null_Exception_Is_Thrown</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
   <span class="hljs-keyword">var</span> result = RepeatString5Times(<span class="hljs-literal">null</span>);<font></font>
}<font></font>
[<span class="hljs-meta">TestMethod</span>]<font></font>
[<span class="hljs-meta">ExpectedException(typeof(InvalidOperationException))</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Ensure_Invalid_Operation_Exception_Is_Thrown</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
   <span class="hljs-keyword">var</span> result = RepeatString5Times(<span class="hljs-string">"test"</span>);
   <span class="hljs-keyword">var</span> firstItem = result.First();<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> IEnumerable&lt;<span class="hljs-keyword">string</span>&gt; <span class="hljs-title">RepeatString5Times</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> toRepeat</span>)</span><font></font>
{<font></font>
   <span class="hljs-keyword">if</span> (toRepeat == <span class="hljs-literal">null</span>)
       <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(toRepeat));
   <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++)<font></font>
   {   <font></font>
       <span class="hljs-keyword">if</span> (i == <span class="hljs-number">3</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(<span class="hljs-string">"3 is a horrible number"</span>);
       <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-string">$"<span class="hljs-subst">{toRepeat}</span> - <span class="hljs-subst">{i}</span>"</span>;<font></font>
   }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beide Tests schlagen fehl. Der erste Test schl√§gt fehl, da das Ergebnis nirgendwo verwendet wird und der Hauptteil der Methode niemals ausgef√ºhrt wird. Der zweite Test wird aus einem anderen, etwas weniger trivialen Grund fehlschlagen. Jetzt erhalten wir das erste Ergebnis des Aufrufs unserer Methode, um sicherzustellen, dass die Methode tats√§chlich ausgef√ºhrt wird. Der Mechanismus f√ºr die verz√∂gerte Ausf√ºhrung beendet die Methode jedoch so schnell wie m√∂glich. In diesem Fall haben wir nur das erste Element verwendet. Sobald wir die erste Iteration bestanden haben, stoppt die Methode ihre Ausf√ºhrung (daher wird i == 3 niemals wahr sein). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die verz√∂gerte Ausf√ºhrung ist tats√§chlich ein interessanter Mechanismus, insbesondere weil es einfach ist, LINQ-Abfragen zu verketten und Daten nur dann abzurufen, wenn Ihre Abfrage einsatzbereit ist.</font></font><br>
<br>
<h3>2. ,   Dictionary      ,     </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist besonders unangenehm und ich bin mir sicher, dass ich irgendwo Code habe, der auf dieser Annahme beruht. Wenn Sie Elemente zur Liste hinzuf√ºgen </font></font><code><code>List&lt;T&gt;</code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, werden diese in derselben Reihenfolge gespeichert, in der Sie sie hinzuf√ºgen - logisch. Manchmal muss ein anderes Objekt mit einem Element in der Liste verkn√ºpft sein. Die naheliegende L√∂sung besteht darin, ein W√∂rterbuch zu verwenden </font></font><code><code>Dictionary&lt;</code>TKey,TValue&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mit dem Sie einen zugeh√∂rigen Wert f√ºr den Schl√ºssel angeben k√∂nnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anschlie√üend k√∂nnen Sie das W√∂rterbuch mit foreach durchlaufen. In den meisten F√§llen verh√§lt es sich wie erwartet. Sie greifen auf die Elemente in derselben Reihenfolge zu, in der sie dem W√∂rterbuch hinzugef√ºgt wurden. Dieses Verhalten </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist jedoch undefiniert</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - d.h. Es ist ein gl√ºcklicher Zufall, auf den man sich nicht verlassen kann und den man immer erwartet. Dies wird in erkl√§rt</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft-Dokumentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , aber ich denke, nur wenige Leute haben diese Seite sorgf√§ltig studiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dies zu veranschaulichen, lautet die Ausgabe im folgenden Beispiel wie folgt: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dritte </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekunde</font></font></i><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> dict = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-keyword">string</span>, <span class="hljs-keyword">object</span>&gt;();       <font></font>
dict.Add(<span class="hljs-string">"first"</span>, <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>());<font></font>
dict.Add(<span class="hljs-string">"second"</span>, <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>());<font></font>
dict.Remove(<span class="hljs-string">"first"</span>);<font></font>
dict.Add(<span class="hljs-string">"third"</span>, <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>());
<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> entry <span class="hljs-keyword">in</span> dict)<font></font>
{<font></font>
    Console.WriteLine(entry.Key);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Glaube mir nicht? </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√úberpr√ºfen Sie hier online</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Flusssicherheit nicht ber√ºcksichtigen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Multithreading ist gro√üartig. Bei korrekter Implementierung k√∂nnen Sie die Leistung Ihrer Anwendung erheblich verbessern. Sobald Sie jedoch Multithreading eingeben, sollten Sie mit allen Objekten, die Sie √§ndern, sehr, sehr vorsichtig sein, da Sie m√∂glicherweise auf scheinbar zuf√§llige Fehler sto√üen, wenn Sie nicht vorsichtig genug sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Einfach ausgedr√ºckt sind viele Basisklassen in der .NET-Bibliothek nicht </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">threadsicher.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Dies bedeutet, dass Microsoft nicht garantiert, dass Sie diese Klasse mit mehreren Threads parallel verwenden k√∂nnen. </font><font style="vertical-align: inherit;">Dies w√§re kein gro√ües Problem, wenn Sie sofort damit verbundene Probleme finden k√∂nnten. Die Art des Multithreading impliziert jedoch, dass auftretende Probleme sehr instabil und unvorhersehbar sind - h√∂chstwahrscheinlich f√ºhren keine zwei Ausf√ºhrungen zum gleichen Ergebnis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Betrachten Sie beispielsweise diesen Codeblock, der einfach, aber nicht threadsicher ist </font></font><code><code>List&lt;T&gt;</code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> items = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">int</span>&gt;();
<span class="hljs-keyword">var</span> tasks = <span class="hljs-keyword">new</span> List&lt;Task&gt;();
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++)<font></font>
{<font></font>
   tasks.Add(Task.Run(() =&gt; {<font></font>
       <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">10000</span>; k++)<font></font>
       {<font></font>
           items.Add(i);<font></font>
       }<font></font>
   }));<font></font>
}<font></font>
Task.WaitAll(tasks.ToArray());<font></font>
Console.WriteLine(items.Count);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher f√ºgen wir der Liste jeweils 10.000 Mal Zahlen von 0 bis 4 hinzu, was bedeutet, dass die Liste letztendlich </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50.000</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Elemente </font><font style="vertical-align: inherit;">enthalten sollte </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Sollte ich? </font><font style="vertical-align: inherit;">Nun, es gibt eine kleine Chance, dass es am Ende so sein wird - aber unten sind die Ergebnisse von 5 meiner verschiedenen Starts:</font></font><br>
<br>
<pre><code class="plaintext hljs">28191<font></font>
23536<font></font>
44346<font></font>
40007<font></font>
40476</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier k√∂nnen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie es selbst online √ºberpr√ºfen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies liegt in der Tat daran, dass die Add-Methode nicht atomar ist, was bedeutet, dass der Thread die Methode unterbrechen kann, wodurch letztendlich die Gr√∂√üe des Arrays ge√§ndert werden kann, w√§hrend ein anderer Thread gerade ein Element hinzuf√ºgt, oder ein Element mit demselben Index hinzugef√ºgt wird als der andere Thread. Die IndexOutOfRange-Ausnahme kam einige Male zu mir, wahrscheinlich weil sich die Gr√∂√üe des Arrays w√§hrend des Hinzuf√ºgens ge√§ndert hat. Was machen wir hier? Wir k√∂nnen das Schl√ºsselwort lock verwenden, um sicherzustellen, dass nur ein Thread gleichzeitig ein (Add) -Element zur Liste hinzuf√ºgen kann. Dies kann jedoch die Leistung erheblich beeintr√§chtigen. Microsoft, nette Leute, bietet einige gro√üartige Sammlungen, die</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie sind threadsicher</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und hinsichtlich der Leistung hoch optimiert. </font><font style="vertical-align: inherit;">Ich habe bereits </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einen Artikel ver√∂ffentlicht, in dem beschrieben wird, wie Sie sie verwenden k√∂nnen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Missbrauch des verz√∂gerten (verz√∂gerten) Ladens in LINQ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das verz√∂gerte Laden ist eine gro√üartige Funktion sowohl f√ºr LINQ to SQL als auch f√ºr LINQ to Entities (Entity Framework), mit der Sie verwandte Tabellenzeilen nach Bedarf laden k√∂nnen. In einem meiner anderen Projekte habe ich eine </font><font style="vertical-align: inherit;">Tabelle </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Module"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und eine Tabelle </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Ergebnisse"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit einer Eins-zu-Viele-Beziehung (ein Modul kann viele Ergebnisse haben). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qh/ds/ww/qhdsww2vr9-_oslbtzgqx8rle50.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn ich ein bestimmtes Modul erhalten m√∂chte, m√∂chte ich sicher nicht, dass das Entity Framework jedes Ergebnis zur√ºckgibt, das die Modultabelle enth√§lt! Daher ist er klug genug, eine Abfrage auszuf√ºhren, um nur dann Ergebnisse zu erhalten, wenn ich sie brauche. Der folgende Code f√ºhrt also zwei Abfragen aus - eine zum Empfangen des Moduls und eine zum Empfangen der Ergebnisse (f√ºr jedes Modul).</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> db = <span class="hljs-keyword">new</span> DBEntities())<font></font>
{<font></font>
   <span class="hljs-keyword">var</span> modules = db.Modules;
   <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> module <span class="hljs-keyword">in</span> modules)<font></font>
   {<font></font>
       <span class="hljs-keyword">var</span> moduleType = module.Results;
      <span class="hljs-comment">//   </span><font></font>
   }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was ist jedoch, wenn ich Hunderte von Modulen habe? </font><font style="vertical-align: inherit;">Dies bedeutet, dass </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f√ºr jedes Modul</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine separate SQL-Abfrage zum Empfangen von Ergebnisdatens√§tzen ausgef√ºhrt </font><b><font style="vertical-align: inherit;">wird! </font></b><font style="vertical-align: inherit;">Dies wird nat√ºrlich den Server belasten und Ihre Anwendung erheblich verlangsamen. </font><font style="vertical-align: inherit;">Im Entity Framework ist die Antwort sehr einfach: Sie k√∂nnen angeben, dass Ihre Abfrage bestimmte Ergebnisse enth√§lt. </font><font style="vertical-align: inherit;">Im folgenden ge√§nderten Code wird nur eine SQL-Abfrage ausgef√ºhrt, die jedes Modul und jedes Ergebnis f√ºr dieses Modul enth√§lt (kombiniert zu einer Abfrage, die das Entity Framework in Ihrem Modell intelligent anzeigt).</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> db = <span class="hljs-keyword">new</span> DBEntities())<font></font>
{<font></font>
   <span class="hljs-keyword">var</span> modules = db.Modules.Include(b =&gt; b.Results);
   <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> module <span class="hljs-keyword">in</span> modules)<font></font>
   {<font></font>
       <span class="hljs-keyword">var</span> moduleType = module.Results;
      <span class="hljs-comment">//   </span><font></font>
   }<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Verstehen Sie nicht, wie LINQ to SQL / Entity Frameworks Abfragen √ºbersetzt</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da wir das LINQ-Thema angesprochen haben, sollte erw√§hnt werden, wie unterschiedlich Ihr Code ausgef√ºhrt wird, wenn er sich in einer LINQ-Abfrage befindet. Auf hoher Ebene wird erkl√§rt, dass der gesamte Code in einer LINQ-Abfrage mithilfe von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ausdr√ºcken</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in SQL √ºbersetzt wird. </font><font style="vertical-align: inherit;">Dies scheint offensichtlich, aber es ist sehr, sehr leicht, den Kontext zu vergessen, in dem Sie sich befinden, und letztendlich Probleme in Ihre Codebasis einzuf√ºhren. Im Folgenden habe ich eine Liste zusammengestellt, um einige typische Hindernisse zu beschreiben, auf die Sie sto√üen k√∂nnen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die meisten Methodenaufrufe funktionieren nicht.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Stellen Sie sich also vor, Sie haben die folgende Abfrage, um den Namen aller Module durch einen Doppelpunkt zu trennen und den zweiten Teil zu erfassen.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> modules = <span class="hljs-keyword">from</span> m <span class="hljs-keyword">in</span> db.Modules
              <span class="hljs-keyword">select</span> m.Name.Split(<span class="hljs-string">':'</span>)[<span class="hljs-number">1</span>];</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei den meisten LINQ-Anbietern tritt eine Ausnahme auf. Es gibt keine SQL-√úbersetzung f√ºr die Split-Methode. Einige Methoden werden </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√∂glicherweise</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> unterst√ºtzt, z. B. das Hinzuf√ºgen von Tagen zu einem Datum. Dies h√§ngt jedoch alles von Ihrem Anbieter ab. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diejenigen, die funktionieren, k√∂nnen zu unerwarteten Ergebnissen f√ºhren ...</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nehmen Sie den folgenden LINQ-Ausdruck (ich habe keine Ahnung, warum Sie dies in der Praxis tun w√ºrden, aber stellen Sie sich bitte vor, dass dies eine vern√ºnftige Anfrage ist).</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">int</span> modules = db.Modules.Sum(a =&gt; a.ID);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn die Modultabelle Zeilen enth√§lt, erhalten Sie die Summe der Bezeichner. </font><font style="vertical-align: inherit;">Klingt richtig! </font><font style="vertical-align: inherit;">Aber was ist, wenn Sie es stattdessen mit LINQ to Objects ausf√ºhren? </font><font style="vertical-align: inherit;">Wir k√∂nnen dies tun, indem wir die Sammlung von Modulen in eine Liste konvertieren, bevor wir unsere Summenmethode ausf√ºhren.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">int</span> modules = db.Modules.ToList().Sum(a =&gt; a.ID);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schock, Horror - es wird genau das Gleiche tun! Was ist jedoch, wenn Sie keine Zeilen in der Modultabelle hatten? LINQ to Objects gibt 0 zur√ºck, und die Entity Framework / LINQ to SQL-Version </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l√∂st</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine </font><b><font style="vertical-align: inherit;">InvalidOperationException aus</font></b><font style="vertical-align: inherit;"> , die besagt, dass "int?" Nicht konvertiert werden kann. in "int" ... wie. Dies liegt daran, dass beim Ausf√ºhren von SUM in SQL f√ºr eine leere Menge NULL anstelle von 0 zur√ºckgegeben wird. Daher wird stattdessen versucht, ein nullbares int zur√ºckzugeben. Hier sind einige </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tipps, um dies zu beheben, wenn Sie auf ein solches Problem sto√üen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wissen, wann Sie nur das gute alte SQL verwenden m√ºssen.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie eine √§u√üerst komplexe Anfrage ausf√ºhren, sieht Ihre √ºbersetzte Anfrage m√∂glicherweise so aus, als w√ºrde etwas ausgespuckt, immer wieder aufgefressen. </font><font style="vertical-align: inherit;">Leider habe ich keine Beispiele zu demonstrieren, aber nach der vorherrschenden Meinung mag ich es wirklich, verschachtelte Ansichten zu verwenden, was die Codepflege zu einem Albtraum macht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie au√üerdem auf Leistungsengp√§sse sto√üen, k√∂nnen Sie diese nur schwer beheben, da Sie keine direkte Kontrolle √ºber das generierte SQL haben. </font><font style="vertical-align: inherit;">F√ºhren Sie dies entweder in SQL aus oder delegieren Sie es an den Datenbankadministrator, falls Sie oder Ihr Unternehmen einen haben!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Falsche Rundung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun zu etwas, das etwas einfacher ist als die vorherigen Abs√§tze, aber ich habe es immer vergessen und endete mit unangenehmen Fehlern (und, wenn es mit Finanzen zusammenh√§ngt, einem w√ºtenden Flossen- / Gendirektor). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das .NET Framework enth√§lt eine hervorragende statische Methode in der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Math-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse </font><font style="vertical-align: inherit;">namens </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Round</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , die einen numerischen Wert verwendet und auf die angegebene Dezimalstelle rundet. Es funktioniert die meiste Zeit perfekt, aber was tun, wenn Sie versuchen, 2,25 auf die erste Dezimalstelle zu runden? Ich nehme an, Sie erwarten wahrscheinlich eine Runde auf 2,3 - daran sind wir alle gew√∂hnt, oder? In der Praxis stellt sich heraus, dass .NET </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Banker-Rundungen verwendet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">was das gegebene Beispiel auf 2.2 rundet! </font><font style="vertical-align: inherit;">Dies liegt an der Tatsache, dass Banker auf die n√§chste gerade Zahl gerundet werden, wenn sich die Zahl im ‚ÄûMittelpunkt‚Äú befindet. </font><font style="vertical-align: inherit;">Gl√ºcklicherweise kann dies in der Math.Round-Methode leicht √ºberschrieben werden.</font></font><br>
 <br>
<pre><code class="cs hljs">Math.Round(<span class="hljs-number">2.25</span>,<span class="hljs-number">1</span>, MidpointRounding.AwayFromZero)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. Schreckliche Klasse 'DBNull' </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies kann f√ºr manche zu unangenehmen Erinnerungen f√ºhren - ORM verbirgt diesen Schmutz vor uns, aber wenn Sie in die Welt des nackten ADO.NET (SqlDataReader und dergleichen) eintauchen, werden Sie DBNull.Value treffen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich bin mir nicht 100% sicher, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">warum</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NULL-Werte aus der Datenbank werden wie folgt verarbeitet (bitte kommentieren Sie unten, wenn Sie wissen!), Aber Microsoft hat beschlossen, ihnen einen speziellen Typ DBNull (mit einem statischen Feld Wert) zu pr√§sentieren. </font><font style="vertical-align: inherit;">Ich kann einen der Vorteile davon nennen - Sie erhalten keine unangenehmen NullReferenceException-Ausnahmen, wenn Sie auf ein Datenbankfeld zugreifen, das NULL ist. </font><font style="vertical-align: inherit;">Sie sollten jedoch nicht nur die sekund√§re Methode zur √úberpr√ºfung auf NULL-Werte unterst√ºtzen (die leicht zu vergessen ist und zu schwerwiegenden Fehlern f√ºhren kann), sondern auch die gro√üartigen Funktionen von C # verlieren, die Ihnen bei der Arbeit mit null helfen. </font><font style="vertical-align: inherit;">Was k√∂nnte so einfach sein wie</font></font><br>
 <br>
<pre><code class="cs hljs">reader.GetString(<span class="hljs-number">0</span>) ?? <span class="hljs-string">"NULL"</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
was schlie√ülich wird ...</font></font><br>
 <br>
<pre><code class="cs hljs">reader.GetString(<span class="hljs-number">0</span>) != DBNull.Value ? reader.GetString(<span class="hljs-number">0</span>) : <span class="hljs-string">"NULL"</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pfui.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hinweis</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies sind nur einige der nicht trivialen ‚ÄûRechen‚Äú, auf die ich in .NET gesto√üen bin. Wenn Sie mehr wissen, w√ºrde ich gerne von Ihnen unten h√∂ren.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ASP.NET Core:  </a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de501784/index.html">Wenn mein Auto im Weg ist</a></li>
<li><a href="../de501786/index.html">Neue Anwendung "Jellyfish". Warum flattern?</a></li>
<li><a href="../de501788/index.html">Erstellen parametrischer Objekte in nanoCAD Design BIM</a></li>
<li><a href="../de501790/index.html">Nichttriviale Animationen in SwiftUI</a></li>
<li><a href="../de501792/index.html">Wie FinFETs Vater dazu beitrug, Moores Gesetz zu retten</a></li>
<li><a href="../de501800/index.html">Kleine Osinta-Sitzung zur Modernisierung und Produktion von Funkkommunikationssystemen f√ºr die Streitkr√§fte der Russischen F√∂deration</a></li>
<li><a href="../de501804/index.html">Pfeil. Alles, was Sie √ºber Konstanten wissen m√ºssen</a></li>
<li><a href="../de501806/index.html">ACS: Probleme, L√∂sungen und Sicherheitsrisikomanagement</a></li>
<li><a href="../de501808/index.html">Die Liste der √Ñnderungen in D 2.092. Ausleihen Ausleihen</a></li>
<li><a href="../de501810/index.html">Coole 3D-Shooter auf einem alten Laptop: ein Test der Cloud-Gaming-Plattform GFN.RU</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>