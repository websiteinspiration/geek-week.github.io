<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéÖüèΩ üèì üß§ Python para el probador: c√≥mo los peque√±os scripts de c pandas ayudan a probar grandes conjuntos de datos üë®‚Äçüåæ ü§üüèª ü§òüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Trabajo como probador en un proyecto, cuya esencia es la recopilaci√≥n y el almacenamiento de diversos datos y la formaci√≥n de diversos informes y carg...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Python para el probador: c√≥mo los peque√±os scripts de c pandas ayudan a probar grandes conjuntos de datos</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486756/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabajo como probador en un proyecto, cuya esencia es la recopilaci√≥n y el almacenamiento de diversos datos y la formaci√≥n de diversos informes y cargas de archivos sobre la base de ellos. </font><font style="vertical-align: inherit;">Al generar dichos informes, se tienen en cuenta una gran cantidad de condiciones para la selecci√≥n de datos y, por lo tanto, al realizar las pruebas, debe trabajar mucho con las consultas SQL en la base de datos. </font><font style="vertical-align: inherit;">Pero para verificar la selecci√≥n correcta de datos y buscar datos en exceso / faltantes, esto a menudo no es suficiente, as√≠ que tuve que buscar herramientas adicionales para esto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como ya ten√≠a algunos conocimientos b√°sicos de Python, decid√≠ intentar escribir peque√±os scripts que me permitieran hacer algo con los datos existentes y as√≠ facilitar y acelerar el proceso de prueba. </font><font style="vertical-align: inherit;">En este art√≠culo te dir√© lo que sali√≥ de √©l.</font></font><br>
<a name="habracut"></a><br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dise√±ar un gui√≥n gui√≥n</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para escribir una secuencia de comandos, debe averiguar qu√© debe hacer exactamente la secuencia de comandos, qu√© datos deben ingresarse y qu√© datos se espera que salgan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pasos de muestra para el escenario:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obtenemos un archivo con datos en cierto formato (o varios archivos)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obtener datos de archivo / archivos</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seleccionamos los datos necesarios.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Realizamos algunas operaciones sobre datos</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cargamos datos a un archivo de Excel, si es necesario (generalmente este formato es el m√°s conveniente para su posterior an√°lisis y almacenamiento)</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego debe pensar c√≥mo y d√≥nde puede obtener informaci√≥n. </font><font style="vertical-align: inherit;">Puede ser un archivo creado manualmente con datos, cargando datos a una interfaz de usuario en un archivo con filtros, un archivo con an√°lisis de datos utilizando otro script, un archivo para cargar los resultados de una consulta SQL a la base de datos (puede cargar r√°pidamente datos a un archivo csv desde la base de datos), json -archivo o archivo xml con datos de la respuesta a una solicitud a la API, etc.</font></font><br>
<br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escribimos scripts en python usando pandas y otras bibliotecas.</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para escribir scripts en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> necesita instalar un int√©rprete y un IDE adecuado. </font><font style="vertical-align: inherit;">Tambi√©n es mejor crear un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entorno virtual</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> separado </font><font style="vertical-align: inherit;">para este proyecto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilizo diferentes bibliotecas para scripts, algunas de ellas son </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bibliotecas de python integradas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , algunas necesitan instalarse adicionalmente:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pandas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es una biblioteca para el an√°lisis de datos. </font><font style="vertical-align: inherit;">Le permite trabajar con datos de archivos de varios formatos, as√≠ como recibir datos directamente de la base de datos mediante una consulta SQL. </font><font style="vertical-align: inherit;">Los datos de los archivos se cargan en marcos de datos (visualmente las mismas tablas que en Excel), con datos en los que ya puede realizar diferentes operaciones: combine datos de diferentes marcos de datos por analog√≠a con join / union en SQL, seleccione los datos que necesita bajo ciertas condiciones, compare datos en diferentes columnas del marco de datos, etc.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openpyxl, xlrd</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : bibliotecas para trabajar con Excel.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El marco de script m√°s simple para trabajar con datos de archivos csv, json, Excel es el siguiente:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#   pandas</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
<font></font>
<span class="hljs-comment">#    csv-  -</span>
<span class="hljs-comment"># (        )</span>
<span class="hljs-comment">#       csv-     ";"</span>
df = pd.read_csv(<span class="hljs-string">'./csv_file.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>)<font></font>
<font></font>
<span class="hljs-comment"># </span>
<span class="hljs-comment">#    json-  -</span>
<span class="hljs-comment"># (        )</span>
<span class="hljs-comment"># df = pd.read_json('./json_file.json', encoding='utf-8')</span><font></font>
<font></font>
<span class="hljs-comment"># </span>
<span class="hljs-comment">#    Excel-  -,     </span>
<span class="hljs-comment"># (        )</span>
<span class="hljs-comment"># file_excel = 'Excel_file.xlsx'</span>
<span class="hljs-comment"># df = pd.ExcelFile(file_excel).parse('1')</span><font></font>
<font></font>
<font></font>
<span class="hljs-comment">#  -     -  </span>
<span class="hljs-comment">#    - final_df</span><font></font>
<font></font>
<font></font>
<span class="hljs-comment">#    Excel-,  </span>
<span class="hljs-comment">#          </span>
<span class="hljs-comment"># (      )</span>
writer = pd.ExcelWriter(<span class="hljs-string">'.xlsx'</span>)<font></font>
final_df.to_excel(writer, <span class="hljs-string">'1'</span>)<font></font>
writer.save()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este script, los datos de un archivo del formato requerido se cargan en un marco de datos, se seleccionan los datos necesarios y se realizan algunas operaciones en ellos, luego los datos se escriben en un nuevo archivo de Excel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si necesita trabajar con datos obtenidos como resultado de una consulta SQL a la base de datos, no puede exportarlos a un archivo csv, sino que inmediatamente los lleva a un marco de datos ejecutando una consulta SQL en la base de datos en el script mismo:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#   pandas</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-comment">#      ,     PostgreSQL</span>
<span class="hljs-comment"># (   -    )</span>
<span class="hljs-keyword">import</span> psycopg2<font></font>
<font></font>
<span class="hljs-comment">#    </span>
conn = psycopg2.connect(dbname=<span class="hljs-string">'_'</span>, host=<span class="hljs-string">''</span>, port=<span class="hljs-string">''</span>,<font></font>
                        user=<span class="hljs-string">''</span>, password=<span class="hljs-string">''</span>)<font></font>
<font></font>
<span class="hljs-comment">#   SQL-</span>
q = <span class="hljs-string">"""select ... 
    from ... 
    where ..."""</span><font></font>
<font></font>
<span class="hljs-comment">#    -,  SQL-</span><font></font>
df = pd.read_sql_query(q, conn)<font></font>
<font></font>
<font></font>
<span class="hljs-comment">#  -     -  </span>
<span class="hljs-comment">#    - final_df</span><font></font>
<font></font>
<font></font>
<span class="hljs-comment">#    Excel-,  </span>
<span class="hljs-comment">#          </span>
<span class="hljs-comment"># (      )</span>
writer = pd.ExcelWriter(<span class="hljs-string">'.xlsx'</span>)<font></font>
final_df.to_excel(writer, <span class="hljs-string">'1'</span>)<font></font>
writer.save()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si necesita obtener datos de un archivo xml, puede usar las bibliotecas dise√±adas para esto. </font><font style="vertical-align: inherit;">Yo uso la biblioteca incorporada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ElementTree</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando los datos se reciben en un marco de datos, puede combinarlos inmediatamente con datos de otro marco de datos (an√°logos de uni√≥n o uni√≥n en SQL) o realizar algunas operaciones en ellos, por ejemplo, eliminar duplicados, eliminar filas con valores vac√≠os en ciertas celdas , compare datos en varias columnas, seleccione las filas / columnas deseadas, etc. </font><font style="vertical-align: inherit;">Lea m√°s en la documentaci√≥n para pandas.</font></font><br>
<br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opciones de uso de script</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y ahora activamos la herramienta principal del probador y seleccionamos los datos / caracter√≠sticas de nuestro proyecto, para verificar qu√© scripts ser√≠an √∫tiles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se crearon archivos con una peque√±a cantidad de datos de prueba generados utilizando </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">generatedata</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para los scripts </font><font style="vertical-align: inherit;">. En realidad, los archivos de datos contienen decenas de miles de filas y una gran cantidad de columnas. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escenario # 1</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Hay tres archivos en formato csv con datos. Para cada l√≠nea de datos, hay un campo con un identificador de identificaci√≥n √∫nico. Los datos de estos archivos se seleccionan teniendo en cuenta ciertas condiciones y se ingresan en una tabla en la base de datos, luego estos datos se muestran en un informe en forma de una tabla en la interfaz de usuario. Es posible cargar datos en una interfaz de usuario a un archivo de Excel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suponga que las condiciones para seleccionar datos para un informe de los archivos de origen son las siguientes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los archivos pueden tener duplicados por identificaci√≥n, en un informe, un registro con el mismo identificador debe tenerse en cuenta solo una vez (en este caso, simplemente seleccionamos cualquiera de las filas con este identificador de los datos).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las filas con datos faltantes en la celda de la columna reg_date no deben contarse.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De hecho, puede haber m√°s condiciones de selecci√≥n, los datos tambi√©n se pueden comparar con los datos que ya est√°n en el sistema y solo se mostrar√°n en el informe los datos que se cruzan por identificaci√≥n, pero por ejemplo tendremos en cuenta solo las dos condiciones indicadas anteriormente.</font></font></li>
</ul><br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La tarea del probador:</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Compruebe que las l√≠neas con los objetos necesarios se seleccionan correctamente de los archivos de origen y que todos estos objetos se muestran en el informe en la interfaz de usuario. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redactamos un gui√≥n para el gui√≥n:</font></font></u><br>
<br>
<ul>
<li>  -      csv-,     - (   union  SQL),      id,       reg_date.</li>
<li>  UI     Excel-,   ,       -.</li>
<li> (merge)   -   (   outer join  SQL)          Excel-   .</li>
<li>              ,   ,   -   ,      ,   UI.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el archivo final, los datos contendr√°n solo una columna con id, si los nombres de las columnas en diferentes marcos de datos coinciden, y puede que no est√© claro qu√© columnas / filas de qu√© archivo se encontraban. </font><font style="vertical-align: inherit;">Por lo tanto, nombro las columnas con un identificador √∫nico por diferentes nombres en los archivos, o agrego una columna separada "Filas de un archivo de tal o cual" a cada archivo y pongo "S√≠" en √©l; luego, al analizar el archivo Excel resultante, es conveniente filtrar por esta columna porque </font><font style="vertical-align: inherit;">siempre contienen un valor y, al filtrar por ellos, ya puede comprender qu√© datos divergen en las columnas correspondientes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Datos de ejemplo del archivo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example1_csv_1.csv</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/of/5j/_u/of5j_us3u07uset3ljspbbwtrr4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Datos de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ejemplo del</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> archivo </font><i><font style="vertical-align: inherit;">report_UI.xlsx</font></i><font style="vertical-align: inherit;"> : Un </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uh/xy/1s/uhxy1sygvioxbbhlksppdpsar_e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
script de Python se ve as√≠:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#   pandas</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
<font></font>
<span class="hljs-comment">#     csv-    -</span>
<span class="hljs-comment"># (        )</span>
df_from_file1 = pd.read_csv(<span class="hljs-string">'./example1_csv_1.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>,<font></font>
                            usecols=[<span class="hljs-string">'id'</span>, <span class="hljs-string">'name'</span>, <span class="hljs-string">'email'</span>, <span class="hljs-string">'reg_date'</span>])<font></font>
df_from_file2 = pd.read_csv(<span class="hljs-string">'./example1_csv_2.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>,<font></font>
                            usecols=[<span class="hljs-string">'id'</span>, <span class="hljs-string">'name'</span>, <span class="hljs-string">'email'</span>,<span class="hljs-string">'reg_date'</span>])<font></font>
df_from_file3 = pd.read_csv(<span class="hljs-string">'./example1_csv_3.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>,<font></font>
                            usecols=[<span class="hljs-string">'id'</span>, <span class="hljs-string">'name'</span>, <span class="hljs-string">'email'</span>, <span class="hljs-string">'reg_date'</span>])<font></font>
<font></font>
<span class="hljs-comment">#    -    - </span>
<span class="hljs-comment"># (   union  SQL)</span><font></font>
df_from_csv = pd.concat([df_from_file1, df_from_file2, df_from_file3]).\<font></font>
    reset_index(drop=<span class="hljs-literal">True</span>)<font></font>
print(df_from_csv)<font></font>
<font></font>
<span class="hljs-comment">#       </span>
df_from_csv.drop_duplicates(subset=<span class="hljs-string">'id'</span>, keep=<span class="hljs-string">'first'</span>, inplace=<span class="hljs-literal">True</span>)<font></font>
print(df_from_csv)<font></font>
<font></font>
<span class="hljs-comment">#     NaN ( )   reg_date</span><font></font>
df_from_csv = df_from_csv.dropna()<font></font>
print(df_from_csv)<font></font>
<font></font>
<span class="hljs-comment">#    Excel-   UI  -,</span>
<span class="hljs-comment">#       </span>
<span class="hljs-comment"># (        )</span>
file_excel = <span class="hljs-string">'report_UI.xlsx'</span>
df_from_excel = pd.ExcelFile(file_excel).parse(<span class="hljs-string">'1'</span>)<font></font>
print(df_from_excel)<font></font>
<font></font>
<span class="hljs-comment">#  -     - </span>
<span class="hljs-comment"># -       UI</span>
<span class="hljs-comment"># (   outer join  SQL)</span>
df = df_from_csv.merge(df_from_excel, left_on=<span class="hljs-string">'id'</span>, right_on=<span class="hljs-string">""</span>, how=<span class="hljs-string">'outer'</span>)<font></font>
print(df)<font></font>
<font></font>
<span class="hljs-comment">#     Excel-</span>
writer = pd.ExcelWriter(<span class="hljs-string">'.xlsx'</span>)<font></font>
df.to_excel(writer, <span class="hljs-string">'1'</span>)<font></font>
writer.save()<font></font>
</code></pre><br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limitaciones:</font></font></u><br>
<br>
<ul>
<li>               (  ,       30 000 ).</li>
<li>   (  Excel)  /           ,            .</li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escenario No. 2</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
La secci√≥n contiene datos en forma de tabla para ciertos objetos de una sola fuente. El sistema recibir√° datos de una segunda fuente (integraci√≥n) y actualizar√° los datos de la tabla existente con estos datos. Cada registro en la tabla son datos para un objeto que tiene un identificador √∫nico. Si desde una nueva fuente los datos de un objeto por identificador coinciden con los datos de un objeto existente, entonces todos los campos de un registro existente se actualizan con datos de una nueva fuente (confirmado). Si la tabla a√∫n no tiene un objeto con un identificador de la segunda fuente, se crea un nuevo registro en la tabla con datos de la nueva fuente. Los datos del segundo sistema se pueden cargar en un archivo json de antemano. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La tarea del probador:</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prepare un archivo con datos para la prueba de antemano, a fin de verificar que los registros existentes se actualicen correctamente y se fijen con un signo de confirmaci√≥n en la base de datos si hay una coincidencia por identificador, y los nuevos registros se crean correctamente y se marcan con el signo de agregar a la base de datos si los registros con tales el identificador a√∫n no estaba. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redactamos un gui√≥n para el gui√≥n:</font></font></u><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cargamos los datos de la tabla de particiones al archivo de Excel en la interfaz de usuario (si esto no es posible, siempre puede exportar los datos del resultado de la consulta SQL utilizada en el c√≥digo para enviar datos a esta tabla en la interfaz de usuario) y rellenar los datos desde el primer marco de datos .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obtenemos el archivo json con datos de la segunda fuente y lo cargamos en el segundo marco de datos.</font></font></li>
<li>  (merge ‚Äî    outer join  SQL)    -    -          Excel-,        .      ,        ,      .</li>
</ul><br>
<u>:</u><br>
<br>
<ul>
<li>               (  ,       30 000 ).</li>
<li>  json-     /  ‚Äì           /,    -   json-   pandas        /.</li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escenario 3</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Se realiza una solicitud a la API del sistema, en respuesta a la cual se reciben datos sobre objetos en formato json. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarea del probador:</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> compare los datos de la respuesta a la solicitud a la API con los datos del resultado de la consulta SQL en la base de datos. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redactamos un gui√≥n para el gui√≥n:</font></font></u><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejecutamos la consulta SQL en la base de datos, exportamos los datos del resultado de la consulta a un archivo csv, cargamos estos datos en el primer marco de datos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guardamos los datos de la respuesta a la solicitud a la API en el archivo json, cargamos los datos del archivo en el segundo marco de datos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combinamos los datos (fusi√≥n, por analog√≠a con la uni√≥n externa en SQL) de dos marcos de datos recibidos en un nuevo marco de datos mediante un identificador √∫nico y descargamos los datos de este en un archivo Excel, en el que ya compararemos los datos por columnas utilizando las funciones de Sobresalir</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O los datos en las columnas en el marco de datos generales se pueden comparar usando pandas, mientras se descargan las filas con los mismos / diferentes datos en las columnas en un nuevo marco de datos / archivo Excel para su an√°lisis.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Datos de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ejemplo del</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> archivo </font><i><font style="vertical-align: inherit;">example3_csv.csv</font></i><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zx/e6/xz/zxe6xzjff9vbfwgntsfqb-qyykc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Datos de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ejemplo del</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> archivo </font><i><font style="vertical-align: inherit;">example3_json.json</font></i><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="json hljs">[<font></font>
    {<font></font>
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"16421118-4116"</span>,
        <span class="hljs-attr">"name_json"</span>: <span class="hljs-string">"Tempor Consulting"</span>,
        <span class="hljs-attr">"email_json"</span>: <span class="hljs-string">"Nullam.lobortis.quam@***"</span>,
        <span class="hljs-attr">"tel_json"</span>: <span class="hljs-string">"1-821-805-****"</span>,
        <span class="hljs-attr">"reg_date_json"</span>: <span class="hljs-string">"12-11-16"</span>,
        <span class="hljs-attr">"city_json"</span>: <span class="hljs-string">"Natales"</span><font></font>
    },<font></font>
    {<font></font>
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"16040210-2206"</span>,
        <span class="hljs-attr">"name_json"</span>: <span class="hljs-string">"Odio Etiam Incorporated"</span>,
        <span class="hljs-attr">"email_json"</span>: <span class="hljs-string">"arcu@***"</span>,
        <span class="hljs-attr">"tel_json"</span>: <span class="hljs-string">"1-730-291-****"</span>,
        <span class="hljs-attr">"reg_date_json"</span>: <span class="hljs-string">"26-06-05"</span>,
        <span class="hljs-attr">"city_json"</span>: <span class="hljs-string">"Viddalba"</span><font></font>
    },<font></font>
...<font></font>
]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El script de Python se ve as√≠:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#   pandas</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
<font></font>
<span class="hljs-comment">#    csv-  -</span>
<span class="hljs-comment"># (        )</span>
<span class="hljs-comment">#       csv-     ";"</span>
df_from_csv = pd.read_csv(<span class="hljs-string">'./example3_csv.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>)<font></font>
print(df_from_csv)<font></font>
<font></font>
<span class="hljs-comment">#    json-  -</span>
<span class="hljs-comment"># (        )</span>
df_from_json = pd.read_json(<span class="hljs-string">'./example3_json.json'</span>, encoding=<span class="hljs-string">'utf-8'</span>)<font></font>
print(df_from_json)<font></font>
<font></font>
<span class="hljs-comment">#  -    -</span>
<span class="hljs-comment"># (   outer join  SQL)</span>
df_csv_json = df_from_csv.merge(df_from_json, left_on=<span class="hljs-string">'id'</span>, <font></font>
                                right_on=<span class="hljs-string">"id"</span>, how=<span class="hljs-string">'outer'</span>)<font></font>
print(df_csv_json)<font></font>
<font></font>
<span class="hljs-comment">#    Excel-,   ,</span>
<span class="hljs-comment">#      -   ,</span>
<span class="hljs-comment">#          </span>
<span class="hljs-comment"># (      )</span>
<span class="hljs-comment"># writer = pd.ExcelWriter('.xlsx')</span>
<span class="hljs-comment"># df_csv_json.to_excel(writer, '1')</span>
<span class="hljs-comment"># writer.save()</span><font></font>
<font></font>
<span class="hljs-comment">#       </span>
<span class="hljs-comment"># (, name_csv  name_json) </span>
<span class="hljs-comment">#       Excel-  </span>
<span class="hljs-comment"># (        )</span>
unequal_data_df = df_csv_json.loc[df_csv_json[<span class="hljs-string">'name_csv'</span>] != <font></font>
                                  df_csv_json[<span class="hljs-string">'name_json'</span>]]<font></font>
unequal_data_df = unequal_data_df[[<span class="hljs-string">'id'</span>, <span class="hljs-string">'name_csv'</span>, <span class="hljs-string">'name_json'</span>]]<font></font>
print(unequal_data_df)<font></font>
<font></font>
writer = pd.ExcelWriter(<span class="hljs-string">'_name.xlsx'</span>)<font></font>
unequal_data_df.to_excel(writer, <span class="hljs-string">'1'</span>)<font></font>
writer.save()<font></font>
<font></font>
</code></pre><br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limitaciones:</font></font></u><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando trabaje con archivos con una gran cantidad de l√≠neas, tendr√° que dividirlos en archivos separados (aqu√≠ debe intentarlo, rara vez tengo archivos de m√°s de 30,000 l√≠neas).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si hay varios niveles de anidamiento de objetos / matrices de datos en el archivo json, desde los niveles internos se cargar√°n en la celda como un objeto / matriz, por lo tanto, trabajar con archivos json con pandas es conveniente solo para datos sin anidamiento excesivo de objetos / arrays.</font></font></li>
<li>       API         SQL-  ,             SQL-   .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si la respuesta a la solicitud a la API viene en formato xml, primero deber√° analizar los datos necesarios del archivo xml utilizando ElementTree u otra biblioteca y luego cargarlo en el marco de datos. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escenario No. 4</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En la interfaz de usuario, se descarga un archivo xml con datos sobre objetos, que se genera sobre la marcha a partir de datos en la base de datos sujetos a ciertas condiciones (por ejemplo, estados, fechas, a√±os u otros valores de par√°metros para los objetos). </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarea del probador:</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Compare la identificaci√≥n de identificadores √∫nicos de los objetos del archivo xml que se encuentran en el atributo de la etiqueta de la compa√±√≠a con los identificadores de los objetos del resultado de la consulta SQL en la base de datos. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redactamos un gui√≥n para el gui√≥n:</font></font></u><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guardamos los datos de la respuesta a la solicitud a la API en el archivo xml, obtenemos los datos necesarios de este archivo utilizando la biblioteca ElementTree, cargamos los datos en el primer marco de datos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejecutamos la consulta SQL en la base de datos, exportamos los datos del resultado de la consulta al archivo csv, cargamos estos datos en el segundo marco de datos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combinamos los datos (fusi√≥n, por analog√≠a con la uni√≥n externa en SQL) de dos marcos de datos recibidos en un nuevo marco de datos mediante un identificador √∫nico y descargamos los datos de este en un archivo de Excel.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A continuaci√≥n, abra el archivo resultante y analice las l√≠neas de datos.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Datos de ejemplo del archivo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example4_csv.csv</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gb/zk/ou/gbzkou2bivh2gsnk6do0lthh1_g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Datos de ejemplo del archivo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example4_xml.xml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : un </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zh/x4/no/zhx4noe3virrsagqnaduwpqyp_w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
script de Python tiene este aspecto:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#   ElementTree</span>
<span class="hljs-keyword">from</span> xml.etree <span class="hljs-keyword">import</span> ElementTree
<span class="hljs-comment">#   pandas</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
<font></font>
<span class="hljs-comment">#    xml-   </span>
<span class="hljs-comment"># (        )</span>
tree = ElementTree.parse(<span class="hljs-string">"example4_xml.xml"</span>)<font></font>
<font></font>
<span class="hljs-comment">#   </span><font></font>
root = tree.getroot()<font></font>
<font></font>
<span class="hljs-comment">#  ,     </span><font></font>
data_list = []<font></font>
i = <span class="hljs-number">1</span><font></font>
<font></font>
<span class="hljs-comment">#    -   id_type1  id_type2</span>
<span class="hljs-keyword">for</span> child <span class="hljs-keyword">in</span> root.iter(<span class="hljs-string">"companies"</span>):
    <span class="hljs-keyword">for</span> child_1 <span class="hljs-keyword">in</span> child.iter(<span class="hljs-string">"company"</span>):<font></font>
            data_list.append({<span class="hljs-string">""</span>: i, <span class="hljs-string">"id"</span>: child_1.get(<span class="hljs-string">"id_type1"</span>)
                                                <span class="hljs-keyword">or</span> child_1.get(<span class="hljs-string">"id_type2"</span>), 
                              <span class="hljs-string">"  xml"</span>: <span class="hljs-string">""</span>})<font></font>
            i += <span class="hljs-number">1</span><font></font>
<font></font>
<span class="hljs-comment">#     data_list  -</span>
df_from_xml = pd.DataFrame.from_dict(data_list, orient=<span class="hljs-string">'columns'</span>)<font></font>
print(df_from_xml)<font></font>
<font></font>
<span class="hljs-comment">#    csv-  -</span>
df_from_csv = pd.read_csv(<span class="hljs-string">'./example4_csv.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>)<font></font>
print(df_from_csv)<font></font>
<font></font>
<span class="hljs-comment">#  -   -</span>
<span class="hljs-comment"># (   outer join  SQL)</span>
df = df_from_csv.merge(df_from_xml, left_on=<span class="hljs-string">'id'</span>, right_on=<span class="hljs-string">"id"</span>, how=<span class="hljs-string">'outer'</span>)<font></font>
print(df)<font></font>
<font></font>
<span class="hljs-comment">#    Excel-</span>
<span class="hljs-comment">#          </span>
<span class="hljs-comment"># (      )</span>
writer = pd.ExcelWriter(<span class="hljs-string">'.xlsx'</span>)<font></font>
df.to_excel(writer, <span class="hljs-string">'1'</span>)<font></font>
writer.save()<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escenario 5</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En la interfaz de usuario, la secci√≥n muestra datos sobre objetos en forma de tabla. </font><font style="vertical-align: inherit;">Es posible cargar datos en un archivo de Excel. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La tarea del probador:</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comparar los datos de la tabla de particiones con los datos que se descargan en el archivo de Excel. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redactamos un gui√≥n para el gui√≥n:</font></font></u><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solicitamos a los desarrolladores una consulta SQL en la base de datos del c√≥digo que es responsable de enviar datos a la tabla de particiones en la interfaz de usuario.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejecutamos esta consulta SQL en la base de datos, cargamos los datos en un archivo csv y los cargamos en el primer marco de datos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cargamos los datos de la tabla de particiones al archivo de Excel en la interfaz de usuario y los cargamos en el segundo marco de datos.</font></font></li>
<li>  (merge ‚Äî    outer join  SQL)    -    -          Excel-,             Excel.</li>
<li>      -     pandas,      /      -/Excel-  .</li>
</ul><br>
<u>:</u><br>
<br>
<ul>
<li>    ,     Excel-  UI, ,         ,          .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, se pueden usar scripts similares simplemente para transferir datos desde archivos json o archivos csv a archivos Excel. </font><font style="vertical-align: inherit;">O bien, puede combinar datos de varios archivos de Excel en ciertas columnas y cargarlos en un nuevo archivo de Excel.</font></font><br>
<br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusi√≥n</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estos son solo algunos ejemplos de c√≥mo puede usar python + pandas para acelerar el proceso de prueba y encontrar errores. </font><font style="vertical-align: inherit;">De hecho, los pandas tienen muchas m√°s oportunidades para trabajar con datos, puede leer m√°s sobre esto en la documentaci√≥n de esta biblioteca. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quiz√°s su proyecto tenga otras opciones para usar dichos scripts y este art√≠culo lo ayudar√° a comenzar a usarlos en el trabajo de los evaluadores.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es486756/">https://habr.com/ru/post/es486756/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es486744/index.html">Un corrector de postura inteligente hecho en casa sali√≥ a la venta. Miramos el nuevo producto - IBACK</a></li>
<li><a href="../es486746/index.html">Escribe, no cortes. Lo que comenc√© a extra√±ar en las publicaciones de Habr</a></li>
<li><a href="../es486750/index.html">La serie "Para toda la humanidad": de una historia alternativa a la basura</a></li>
<li><a href="../es486752/index.html">Servidor web WSGI √∫nico que utiliza ESP8266. Parte 1</a></li>
<li><a href="../es486754/index.html">JIRA: reglas para la preparaci√≥n oportuna de software delicioso. TLDR 2: gesti√≥n de requisitos</a></li>
<li><a href="../es486760/index.html">Semana de la seguridad 06: rastreadores publicitarios en aplicaciones m√≥viles</a></li>
<li><a href="../es486762/index.html">Hospedaje de cabecera: la pr√°ctica espeluznante de hospedaje en el hogar</a></li>
<li><a href="../es486764/index.html">H√°galo usted mismo Schema.org: personalizando el micro dise√±o sin un programador</a></li>
<li><a href="../es486766/index.html">¬øC√≥mo transferir todas las transacciones en l√≠nea en el mercado de factoraje arcaico? Experiencia de Factoring Sberbank</a></li>
<li><a href="../es486768/index.html">Revisi√≥n del panel de administraci√≥n de Webasyst</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>