<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöã üåó ‚ôæ Cr√©ation de liaisons Python pour les biblioth√®ques C / C ++ √† l'aide de SIP. Partie 2 üßóüèæ üöß üë©üèΩ‚Äçüè≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans la premi√®re partie de l' article, nous avons examin√© les bases de l'utilisation de l'utilitaire SIP con√ßu pour cr√©er des liaisons Python pour les...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Cr√©ation de liaisons Python pour les biblioth√®ques C / C ++ √† l'aide de SIP. Partie 2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495636/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">premi√®re partie de l'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> article, nous avons examin√© les bases de l'utilisation de l'utilitaire SIP con√ßu pour cr√©er des liaisons Python pour les biblioth√®ques √©crites en C et C ++. </font><font style="vertical-align: inherit;">Nous avons examin√© les fichiers de base que vous devez cr√©er pour travailler avec SIP et avons commenc√© √† examiner les directives et les annotations. </font><font style="vertical-align: inherit;">Jusqu'√† pr√©sent, nous avons fait la liaison pour une biblioth√®que simple √©crite en C. Dans cette partie, nous allons voir comment faire la liaison pour une biblioth√®que C ++ qui contient des classes. </font><font style="vertical-align: inherit;">En utilisant l'exemple de cette biblioth√®que, nous verrons quelles techniques peuvent √™tre utiles lorsque vous travaillez avec une biblioth√®que orient√©e objet, et en m√™me temps nous traiterons de nouvelles directives et annotations pour nous.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tous les exemples de l'article sont disponibles dans le r√©f√©rentiel github √† l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adresse</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">https://github.com/Jenyay/sip-examples</font></a><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr√©er une liaison pour une biblioth√®que en C ++</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'exemple suivant, que nous consid√©rerons, se trouve dans le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_cpp_01</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cr√©ez d'abord une biblioth√®que pour laquelle nous ferons la liaison. </font><font style="vertical-align: inherit;">La biblioth√®que r√©sidera toujours dans le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et contiendra une classe - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Le fichier d'en-t√™te </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec la d√©claration de cette classe est le suivant:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> FOO_LIB</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FOO_LIB</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Foo</span> {</span>
    <span class="hljs-keyword">private</span>:
        <span class="hljs-keyword">int</span> _int_val;
        <span class="hljs-keyword">char</span>* _string_val;
    <span class="hljs-keyword">public</span>:<font></font>
        Foo(<span class="hljs-keyword">int</span> int_val, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* string_val);
        <span class="hljs-keyword">virtual</span> ~Foo();<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_int_val</span><span class="hljs-params">(<span class="hljs-keyword">int</span> val)</span></span>;
        <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">get_int_val</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_string_val</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* val)</span></span>;
        <span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">get_string_val</span><span class="hljs-params">()</span></span>;<font></font>
};<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'agit d'une classe simple avec deux getters et setters qui d√©finit et renvoie des valeurs de type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">L'impl√©mentation de la classe est la suivante:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"foo.h"</span></span><font></font>
<font></font>
Foo::Foo(<span class="hljs-keyword">int</span> int_val, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* string_val): _int_val(int_val) {<font></font>
    _string_val = <span class="hljs-literal">nullptr</span>;<font></font>
    set_string_val(string_val);<font></font>
}<font></font>
<font></font>
Foo::~Foo(){<font></font>
    <span class="hljs-keyword">delete</span>[] _string_val;<font></font>
    _string_val = <span class="hljs-literal">nullptr</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Foo::set_int_val</span><span class="hljs-params">(<span class="hljs-keyword">int</span> val)</span> </span>{<font></font>
    _int_val = val;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Foo::get_int_val</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> _int_val;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Foo::set_string_val</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* val)</span> </span>{
    <span class="hljs-keyword">if</span> (_string_val != <span class="hljs-literal">nullptr</span>) {
        <span class="hljs-keyword">delete</span>[] _string_val;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">auto</span> count = <span class="hljs-built_in">strlen</span>(val) + <span class="hljs-number">1</span>;<font></font>
    _string_val = <span class="hljs-keyword">new</span> <span class="hljs-keyword">char</span>[count];
    <span class="hljs-built_in">strcpy</span>(_string_val, val);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">Foo::get_string_val</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> _string_val;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour tester les fonctionnalit√©s de la biblioth√®que, le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contient √©galement le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.cpp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √† l'aide de la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"foo.h"</span></span><font></font>
<font></font>
<span class="hljs-keyword">using</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span>;
<span class="hljs-keyword">using</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span> </span>{
    <span class="hljs-keyword">auto</span> foo = Foo(<span class="hljs-number">10</span>, <span class="hljs-string">"Hello"</span>);
    <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"int_val: "</span> &lt;&lt; foo.get_int_val() &lt;&lt; <span class="hljs-built_in">endl</span>;
    <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"string_val: "</span> &lt;&lt; foo.get_string_val() &lt;&lt; <span class="hljs-built_in">endl</span>;<font></font>
<font></font>
    foo.set_int_val(<span class="hljs-number">0</span>);<font></font>
    foo.set_string_val(<span class="hljs-string">"Hello world!"</span>);<font></font>
<font></font>
    <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"int_val: "</span> &lt;&lt; foo.get_int_val() &lt;&lt; <span class="hljs-built_in">endl</span>;
    <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"string_val: "</span> &lt;&lt; foo.get_string_val() &lt;&lt; <span class="hljs-built_in">endl</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour construire la biblioth√®que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">utilisez le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Makefile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> suivant </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">CC=g++<font></font>
CFLAGS=-c -fPIC<font></font>
DIR_OUT=bin<font></font>
<font></font>
all: main<font></font>
<font></font>
main: main.o libfoo.a<font></font>
    $(CC) $(DIR_OUT)/main.o -L$(DIR_OUT) -lfoo -o $(DIR_OUT)/main<font></font>
<font></font>
main.o: makedir main.cpp<font></font>
    $(CC) $(CFLAGS) main.cpp -o $(DIR_OUT)/main.o<font></font>
<font></font>
libfoo.a: makedir foo.cpp<font></font>
    $(CC) $(CFLAGS) foo.cpp -o $(DIR_OUT)/foo.o<font></font>
    ar rcs $(DIR_OUT)/libfoo.a $(DIR_OUT)/foo.o<font></font>
<font></font>
makedir:<font></font>
    mkdir -p $(DIR_OUT)<font></font>
<font></font>
clean:<font></font>
    rm -rf $(DIR_OUT)/*<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La diff√©rence avec le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Makefile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans les exemples pr√©c√©dents, en plus de changer le compilateur de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g ++</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , est qu'une autre option </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-fPIC a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √©t√© ajout√©e pour la compilation </font><font style="vertical-align: inherit;">, qui indique au compilateur de placer le code dans la biblioth√®que d'une certaine mani√®re (le soi-disant "code ind√©pendant de la position"). √âtant donn√© que cet article ne concerne pas les compilateurs, nous n'examinerons pas plus en d√©tail ce que fait ce param√®tre et pourquoi il est n√©cessaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Commen√ßons √† lier pour cette biblioth√®que. Les fichiers </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sont </font><i><font style="vertical-align: inherit;">presque inchang√©s par</font></i><font style="vertical-align: inherit;"> rapport aux exemples pr√©c√©dents. Voici √† quoi ressemble maintenant le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="plaintext hljs">[build-system]<font></font>
requires = ["sip &gt;=5, &lt;6"]<font></font>
build-backend = "sipbuild.api"<font></font>
<font></font>
[tool.sip.metadata]<font></font>
name = "pyfoocpp"<font></font>
version = "0.1"<font></font>
license = "MIT"<font></font>
<font></font>
[tool.sip.bindings.pyfoocpp]<font></font>
headers = ["foo.h"]<font></font>
libraries = ["foo"]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, nos exemples √©crits en C ++ seront empaquet√©s dans le paquet </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoocpp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Python </font><font style="vertical-align: inherit;">, c'est peut-√™tre le seul changement notable dans ce fichier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> reste le m√™me que dans l'exemple </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_04</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> subprocess<font></font>
<font></font>
<span class="hljs-keyword">from</span> sipbuild <span class="hljs-keyword">import</span> Project<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FooProject</span>(<span class="hljs-params">Project</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_build_foo</span>(<span class="hljs-params">self</span>):</span>
        cwd = os.path.abspath(<span class="hljs-string">'foo'</span>)<font></font>
        subprocess.run([<span class="hljs-string">'make'</span>], cwd=cwd, capture_output=<span class="hljs-literal">True</span>, check=<span class="hljs-literal">True</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build</span>(<span class="hljs-params">self</span>):</span><font></font>
        self._build_foo()<font></font>
        super().build()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_sdist</span>(<span class="hljs-params">self, sdist_directory</span>):</span><font></font>
        self._build_foo()<font></font>
        <span class="hljs-keyword">return</span> super().build_sdist(sdist_directory)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_wheel</span>(<span class="hljs-params">self, wheel_directory</span>):</span><font></font>
        self._build_foo()<font></font>
        <span class="hljs-keyword">return</span> super().build_wheel(wheel_directory)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">install</span>(<span class="hljs-params">self</span>):</span><font></font>
        self._build_foo()<font></font>
        super().install()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et ici, </font><font style="vertical-align: inherit;">nous examinerons le </font><font style="vertical-align: inherit;">fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoocpp.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> plus en d√©tail. Permettez-moi de vous rappeler que ce fichier d√©crit l'interface du futur module Python: ce qu'il devrait inclure, √† quoi devrait ressembler l'interface de classe, etc. Le fichier .sip n'est pas n√©cessaire pour r√©p√©ter le fichier d'en-t√™te de biblioth√®que, bien qu'ils aient beaucoup en commun. Dans cette classe, de nouvelles m√©thodes peuvent √™tre ajout√©es qui n'√©taient pas dans la classe d'origine. Ceux. l'interface d√©crite dans le fichier .sip peut adapter les classes de biblioth√®que aux principes accept√©s en Python, si n√©cessaire. Dans le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoocpp.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">nous verrons de nouvelles directives pour nous. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons d'abord ce que contient ce fichier:</font></font><br>
<br>
<pre><code class="cpp hljs">%Module(name=foocpp, language=<span class="hljs-string">"C++"</span>)<font></font>
%DefaultEncoding <span class="hljs-string">"UTF-8"</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Foo</span> {</span><font></font>
    %TypeHeaderCode<font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;foo.h&gt;</span></span><font></font>
    %End<font></font>
<font></font>
    <span class="hljs-keyword">public</span>:<font></font>
        Foo(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*);<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_int_val</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>;
        <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">get_int_val</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_string_val</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;
        <span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">get_string_val</span><span class="hljs-params">()</span></span>;<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les premi√®res lignes doivent d√©j√† √™tre claires pour nous √† partir des exemples pr√©c√©dents. Dans la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Module</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">nous indiquons le nom du module Python qui sera cr√©√© (c'est-√†-dire, pour utiliser ce module, nous devrons utiliser les commandes </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import foocpp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from foocpp import ....</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dans la m√™me directive, nous indiquons que nous avons maintenant le langage - C ++. La </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">directive% DefaultEncoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d√©finit le codage qui sera utilis√© pour convertir la cha√Æne Python en types </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, la d√©claration d'interface de la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> suit </font><font style="vertical-align: inherit;">. Imm√©diatement apr√®s la d√©claration de la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il n'y a toujours pas utilis√© la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% TypeHeaderCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui se termine par la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% End</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . La </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">directive% TypeHeaderCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> doit contenir du code qui d√©clare l'interface de la classe C ++ pour laquelle l'encapsuleur est cr√©√©. En r√®gle g√©n√©rale, dans cette directive, il suffit d'inclure le fichier d'en-t√™te avec la d√©claration de classe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s cela, les m√©thodes de classe qui seront converties en m√©thodes de la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour le langage Python </font><font style="vertical-align: inherit;">sont r√©pertori√©es </font><font style="vertical-align: inherit;">. Il est important de noter qu'√† ce stade, nous d√©clarons uniquement les m√©thodes publiques qui seront accessibles √† partir de la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en Python (car il n'y a pas de membres priv√©s et prot√©g√©s en Python). Puisque nous avons utilis√© la directive </font><i><font style="vertical-align: inherit;">% DefaultEncoding</font></i><font style="vertical-align: inherit;"> au tout d√©but</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, puis dans les m√©thodes qui prennent des arguments de type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , vous ne pouvez pas utiliser l'annotation </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour sp√©cifier l'encodage pour convertir ces param√®tres en cha√Ænes Python et vice versa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il nous suffit maintenant de compiler le paquet </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoocpp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Python </font><font style="vertical-align: inherit;">et de le tester. </font><font style="vertical-align: inherit;">Mais avant d'assembler un package de roue √† part enti√®re, utilisons la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commande sip-build</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et voyons quels fichiers source SIP cr√©era pour une compilation ult√©rieure, et essayons de trouver en eux quelque chose de similaire √† la classe qui sera cr√©√©e en code Python. </font><font style="vertical-align: inherit;">Pour ce faire, la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commande sip-build</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ci </font><i><font style="vertical-align: inherit;">-</font></i><font style="vertical-align: inherit;"> dessus </font><font style="vertical-align: inherit;">doit √™tre appel√©e dans le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_cpp_01</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Par cons√©quent, le dossier de </font><i><font style="vertical-align: inherit;">g√©n√©ration</font></i><font style="vertical-align: inherit;"> sera cr√©√©.</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec le contenu suivant:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">construire</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚îî‚îÄ‚îÄ foocpp</font></font><font></font>
    ‚îú‚îÄ‚îÄ apiversions.c<font></font>
    ‚îú‚îÄ‚îÄ array.c<font></font>
    ‚îú‚îÄ‚îÄ array.h<font></font>
    ‚îú‚îÄ‚îÄ bool.cpp<font></font>
    ‚îú‚îÄ‚îÄ build<font></font>
    ‚îÇ&nbsp;&nbsp; ‚îî‚îÄ‚îÄ temp.linux-x86_64-3.8<font></font>
    ‚îÇ&nbsp;&nbsp;     ‚îú‚îÄ‚îÄ apiversions.o<font></font>
    ‚îÇ&nbsp;&nbsp;     ‚îú‚îÄ‚îÄ array.o<font></font>
    ‚îÇ&nbsp;&nbsp;     ‚îú‚îÄ‚îÄ bool.o<font></font>
    ‚îÇ&nbsp;&nbsp;     ‚îú‚îÄ‚îÄ descriptors.o<font></font>
    ‚îÇ&nbsp;&nbsp;     ‚îú‚îÄ‚îÄ int_convertors.o<font></font>
    ‚îÇ&nbsp;&nbsp;     ‚îú‚îÄ‚îÄ objmap.o<font></font>
    ‚îÇ&nbsp;&nbsp;     ‚îú‚îÄ‚îÄ qtlib.o<font></font>
    ‚îÇ&nbsp;&nbsp;     ‚îú‚îÄ‚îÄ sipfoocppcmodule.o<font></font>
    ‚îÇ&nbsp;&nbsp;     ‚îú‚îÄ‚îÄ sipfoocppFoo.o<font></font>
    ‚îÇ&nbsp;&nbsp;     ‚îú‚îÄ‚îÄ siplib.o<font></font>
    ‚îÇ&nbsp;&nbsp;     ‚îú‚îÄ‚îÄ threads.o<font></font>
    ‚îÇ&nbsp;&nbsp;     ‚îî‚îÄ‚îÄ voidptr.o<font></font>
    ‚îú‚îÄ‚îÄ descriptors.c<font></font>
    ‚îú‚îÄ‚îÄ foocpp.cpython-38-x86_64-linux-gnu.so<font></font>
    ‚îú‚îÄ‚îÄ int_convertors.c<font></font>
    ‚îú‚îÄ‚îÄ objmap.c<font></font>
    ‚îú‚îÄ‚îÄ qtlib.c<font></font>
    ‚îú‚îÄ‚îÄ sipAPIfoocpp.h<font></font>
    ‚îú‚îÄ‚îÄ sipfoocppcmodule.cpp<font></font>
    ‚îú‚îÄ‚îÄ sipfoocppFoo.cpp<font></font>
    ‚îú‚îÄ‚îÄ sip.h<font></font>
    ‚îú‚îÄ‚îÄ sipint.h<font></font>
    ‚îú‚îÄ‚îÄ siplib.c<font></font>
    ‚îú‚îÄ‚îÄ threads.c<font></font>
    ‚îî‚îÄ‚îÄ voidptr.c<font></font>
</pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En tant que t√¢che suppl√©mentaire, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">examinez</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> attentivement le fichier </font><i><font style="vertical-align: inherit;">sipfoocppFoo.cpp</font></i><font style="vertical-align: inherit;"> (nous ne </font><font style="vertical-align: inherit;">l' </font><i><font style="vertical-align: inherit;">expliquerons</font></i><font style="vertical-align: inherit;"> pas en d√©tail dans cet article):</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/*
 * Interface wrapper code.
 *
 * Generated by SIP 5.1.1
 */</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"sipAPIfoocpp.h"</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">line</span> 6 <span class="hljs-meta-string">"/home/jenyay/temp/2/pyfoocpp.sip"</span></span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;foo.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">line</span> 12 <span class="hljs-meta-string">"/home/jenyay/temp/2/build/foocpp/sipfoocppFoo.cpp"</span></span><font></font>
<font></font>
PyDoc_STRVAR(doc_Foo_set_int_val, <span class="hljs-string">"set_int_val(self, int)"</span>);<font></font>
<font></font>
<span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> {<span class="hljs-function"><span class="hljs-keyword">static</span> PyObject *<span class="hljs-title">meth_Foo_set_int_val</span><span class="hljs-params">(PyObject *, PyObject *)</span></span>;}
<span class="hljs-function"><span class="hljs-keyword">static</span> PyObject *<span class="hljs-title">meth_Foo_set_int_val</span><span class="hljs-params">(PyObject *sipSelf, PyObject *sipArgs)</span>
</span>{<font></font>
    PyObject *sipParseErr = SIP_NULLPTR;<font></font>
<font></font>
    {<font></font>
        <span class="hljs-keyword">int</span> a0;<font></font>
         ::Foo *sipCpp;<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (sipParseArgs(&amp;sipParseErr, sipArgs, <span class="hljs-string">"Bi"</span>, &amp;sipSelf, sipType_Foo, &amp;sipCpp, &amp;a0))<font></font>
        {<font></font>
            sipCpp-&gt;set_int_val(a0);<font></font>
<font></font>
            Py_INCREF(Py_None);<font></font>
            <span class="hljs-keyword">return</span> Py_None;<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/* Raise an exception if the arguments couldn't be parsed. */</span><font></font>
    sipNoMethod(sipParseErr, sipName_Foo, sipName_set_int_val, doc_Foo_set_int_val);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> SIP_NULLPTR;<font></font>
}<font></font>
<font></font>
PyDoc_STRVAR(doc_Foo_get_int_val, <span class="hljs-string">"get_int_val(self) -&gt; int"</span>);<font></font>
<font></font>
<span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> {<span class="hljs-function"><span class="hljs-keyword">static</span> PyObject *<span class="hljs-title">meth_Foo_get_int_val</span><span class="hljs-params">(PyObject *, PyObject *)</span></span>;}
<span class="hljs-function"><span class="hljs-keyword">static</span> PyObject *<span class="hljs-title">meth_Foo_get_int_val</span><span class="hljs-params">(PyObject *sipSelf, PyObject *sipArgs)</span>
</span>{<font></font>
    PyObject *sipParseErr = SIP_NULLPTR;<font></font>
<font></font>
    {<font></font>
         ::Foo *sipCpp;<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (sipParseArgs(&amp;sipParseErr, sipArgs, <span class="hljs-string">"B"</span>, &amp;sipSelf, sipType_Foo, &amp;sipCpp))<font></font>
        {<font></font>
            <span class="hljs-keyword">int</span> sipRes;<font></font>
<font></font>
            sipRes = sipCpp-&gt;get_int_val();<font></font>
<font></font>
            <span class="hljs-keyword">return</span> PyLong_FromLong(sipRes);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/* Raise an exception if the arguments couldn't be parsed. */</span><font></font>
    sipNoMethod(sipParseErr, sipName_Foo, sipName_get_int_val, doc_Foo_get_int_val);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> SIP_NULLPTR;<font></font>
}<font></font>
<font></font>
PyDoc_STRVAR(doc_Foo_set_string_val, <span class="hljs-string">"set_string_val(self, str)"</span>);<font></font>
<font></font>
<span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> {<span class="hljs-function"><span class="hljs-keyword">static</span> PyObject *<span class="hljs-title">meth_Foo_set_string_val</span><span class="hljs-params">(PyObject *, PyObject *)</span></span>;}
<span class="hljs-function"><span class="hljs-keyword">static</span> PyObject *<span class="hljs-title">meth_Foo_set_string_val</span><span class="hljs-params">(PyObject *sipSelf, PyObject *sipArgs)</span>
</span>{<font></font>
    PyObject *sipParseErr = SIP_NULLPTR;<font></font>
<font></font>
    {<font></font>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* a0;<font></font>
        PyObject *a0Keep;<font></font>
         ::Foo *sipCpp;<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (sipParseArgs(&amp;sipParseErr, sipArgs, <span class="hljs-string">"BA8"</span>, &amp;sipSelf, sipType_Foo, &amp;sipCpp, &amp;a0Keep, &amp;a0))<font></font>
        {<font></font>
            sipCpp-&gt;set_string_val(a0);<font></font>
            Py_DECREF(a0Keep);<font></font>
<font></font>
            Py_INCREF(Py_None);<font></font>
            <span class="hljs-keyword">return</span> Py_None;<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/* Raise an exception if the arguments couldn't be parsed. */</span><font></font>
    sipNoMethod(sipParseErr, sipName_Foo, sipName_set_string_val, doc_Foo_set_string_val);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> SIP_NULLPTR;<font></font>
}<font></font>
<font></font>
PyDoc_STRVAR(doc_Foo_get_string_val, <span class="hljs-string">"get_string_val(self) -&gt; str"</span>);<font></font>
<font></font>
<span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> {<span class="hljs-function"><span class="hljs-keyword">static</span> PyObject *<span class="hljs-title">meth_Foo_get_string_val</span><span class="hljs-params">(PyObject *, PyObject *)</span></span>;}
<span class="hljs-function"><span class="hljs-keyword">static</span> PyObject *<span class="hljs-title">meth_Foo_get_string_val</span><span class="hljs-params">(PyObject *sipSelf, PyObject *sipArgs)</span>
</span>{<font></font>
    PyObject *sipParseErr = SIP_NULLPTR;<font></font>
<font></font>
    {<font></font>
         ::Foo *sipCpp;<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (sipParseArgs(&amp;sipParseErr, sipArgs, <span class="hljs-string">"B"</span>, &amp;sipSelf, sipType_Foo, &amp;sipCpp))<font></font>
        {<font></font>
            <span class="hljs-keyword">char</span>*sipRes;<font></font>
<font></font>
            sipRes = sipCpp-&gt;get_string_val();<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (sipRes == SIP_NULLPTR)<font></font>
            {<font></font>
                Py_INCREF(Py_None);<font></font>
                <span class="hljs-keyword">return</span> Py_None;<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">return</span> PyUnicode_FromString(sipRes);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/* Raise an exception if the arguments couldn't be parsed. */</span><font></font>
    sipNoMethod(sipParseErr, sipName_Foo, sipName_get_string_val, doc_Foo_get_string_val);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> SIP_NULLPTR;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* Call the instance's destructor. */</span>
<span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> {<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">release_Foo</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *, <span class="hljs-keyword">int</span>)</span></span>;}
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">release_Foo</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *sipCppV, <span class="hljs-keyword">int</span>)</span>
</span>{
    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">reinterpret_cast</span>&lt; ::Foo *&gt;(sipCppV);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> {<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">dealloc_Foo</span><span class="hljs-params">(sipSimpleWrapper *)</span></span>;}
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">dealloc_Foo</span><span class="hljs-params">(sipSimpleWrapper *sipSelf)</span>
</span>{
    <span class="hljs-keyword">if</span> (sipIsOwnedByPython(sipSelf))<font></font>
    {<font></font>
        release_Foo(sipGetAddress(sipSelf), <span class="hljs-number">0</span>);<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> {<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> *<span class="hljs-title">init_type_Foo</span><span class="hljs-params">(sipSimpleWrapper *, PyObject *, 
                 PyObject *, PyObject **, PyObject **, PyObject **)</span></span>;}
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> *<span class="hljs-title">init_type_Foo</span><span class="hljs-params">(sipSimpleWrapper *, PyObject *sipArgs, PyObject *sipKwds,
                                   PyObject **sipUnused, PyObject **, PyObject **sipParseErr)</span>
</span>{<font></font>
     ::Foo *sipCpp = SIP_NULLPTR;<font></font>
<font></font>
    {<font></font>
        <span class="hljs-keyword">int</span> a0;
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* a1;<font></font>
        PyObject *a1Keep;<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (sipParseKwdArgs(sipParseErr, sipArgs, sipKwds, SIP_NULLPTR, sipUnused, <span class="hljs-string">"iA8"</span>, &amp;a0, &amp;a1Keep, &amp;a1))<font></font>
        {<font></font>
            sipCpp = <span class="hljs-keyword">new</span>  ::Foo(a0,a1);<font></font>
            Py_DECREF(a1Keep);<font></font>
<font></font>
            <span class="hljs-keyword">return</span> sipCpp;<font></font>
        }<font></font>
    }<font></font>
<font></font>
    {<font></font>
        <span class="hljs-keyword">const</span>  ::Foo* a0;<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (sipParseKwdArgs(sipParseErr, sipArgs, sipKwds, SIP_NULLPTR, sipUnused, <span class="hljs-string">"J9"</span>, sipType_Foo, &amp;a0))<font></font>
        {<font></font>
            sipCpp = <span class="hljs-keyword">new</span>  ::Foo(*a0);<font></font>
<font></font>
            <span class="hljs-keyword">return</span> sipCpp;<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> SIP_NULLPTR;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">static</span> PyMethodDef methods_Foo[] = {<font></font>
    {sipName_get_int_val, meth_Foo_get_int_val, METH_VARARGS, doc_Foo_get_int_val},<font></font>
    {sipName_get_string_val, meth_Foo_get_string_val, METH_VARARGS, doc_Foo_get_string_val},<font></font>
    {sipName_set_int_val, meth_Foo_set_int_val, METH_VARARGS, doc_Foo_set_int_val},<font></font>
    {sipName_set_string_val, meth_Foo_set_string_val, METH_VARARGS, doc_Foo_set_string_val}<font></font>
};<font></font>
<font></font>
PyDoc_STRVAR(doc_Foo, <span class="hljs-string">"\1Foo(int, str)\n"</span>
<span class="hljs-string">"Foo(Foo)"</span>);<font></font>
<font></font>
sipClassTypeDef sipTypeDef_foocpp_Foo = {<font></font>
    {<font></font>
        <span class="hljs-number">-1</span>,<font></font>
        SIP_NULLPTR,<font></font>
        SIP_NULLPTR,<font></font>
        SIP_TYPE_CLASS,<font></font>
        sipNameNr_Foo,<font></font>
        SIP_NULLPTR,<font></font>
        SIP_NULLPTR<font></font>
    },<font></font>
    {<font></font>
        sipNameNr_Foo,<font></font>
        {<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>},
        <span class="hljs-number">4</span>, methods_Foo,
        <span class="hljs-number">0</span>, SIP_NULLPTR,
        <span class="hljs-number">0</span>, SIP_NULLPTR,<font></font>
        {SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR,<font></font>
         SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR},<font></font>
    },<font></font>
    doc_Foo,<font></font>
    <span class="hljs-number">-1</span>,
    <span class="hljs-number">-1</span>,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    init_type_Foo,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    dealloc_Foo,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    release_Foo,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, construisez le package √† l'aide de la commande </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Apr√®s avoir ex√©cut√© cette commande, si tout se passe bien, un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fichier pyfoocpp-0.1-cp38-cp38-manylinux1_x86_64.whl</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou avec un nom similaire </font><font style="vertical-align: inherit;">sera cr√©√© </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Installez-le √† l'aide de la commande </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pip install --user pyfoocpp-0.1-cp38-cp38-manylinux1_x86_64.whl</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et ex√©cutez l'interpr√©teur Python pour v√©rifier:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> foocpp <span class="hljs-keyword">import</span> Foo
<span class="hljs-meta">&gt;&gt;&gt; </span>x = Foo(<span class="hljs-number">10</span>, <span class="hljs-string">'Hello'</span>)<font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.get_int_val()
<span class="hljs-number">10</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.get_string_val()
<span class="hljs-string">'Hello'</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.set_int_val(<span class="hljs-number">50</span>)
<span class="hljs-meta">&gt;&gt;&gt; </span>x.set_string_val(<span class="hljs-string">''</span>)<font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.get_int_val()
<span class="hljs-number">50</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.get_string_val()
<span class="hljs-string">''</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Travaux! </font><font style="vertical-align: inherit;">Ainsi, nous venons de cr√©er un module Python avec une liaison pour une classe en C ++. </font><font style="vertical-align: inherit;">De plus, nous apporterons de la beaut√© √† cette classe et ajouterons divers √©quipements.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajouter des propri√©t√©s</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les classes cr√©√©es √† l'aide de SIP ne sont pas n√©cessaires pour r√©p√©ter exactement l'interface de classe C ++. Par exemple, dans notre classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">il y a deux getters et deux setters, qui peuvent clairement √™tre combin√©s en une propri√©t√© pour rendre la classe plus ¬´Python¬ª. L'ajout de propri√©t√©s √† l'aide de sip est assez facile au fur et √† mesure, comme le montre un exemple dans le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_cpp_02</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet exemple est similaire au pr√©c√©dent, la principale diff√©rence r√©side dans le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoocpp.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui ressemble maintenant √† ceci:</font></font><br>
<br>
<pre><code class="cpp hljs">%Module(name=foocpp, language=<span class="hljs-string">"C++"</span>)<font></font>
%DefaultEncoding <span class="hljs-string">"UTF-8"</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Foo</span> {</span><font></font>
    %TypeHeaderCode<font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;foo.h&gt;</span></span><font></font>
    %End<font></font>
<font></font>
    <span class="hljs-keyword">public</span>:<font></font>
        Foo(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*);<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_int_val</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>;
        <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">get_int_val</span><span class="hljs-params">()</span></span>;<font></font>
        %Property(name=int_val, get=get_int_val, <span class="hljs-built_in">set</span>=set_int_val)<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_string_val</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;
        <span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">get_string_val</span><span class="hljs-params">()</span></span>;<font></font>
        %Property(name=string_val, get=get_string_val, <span class="hljs-built_in">set</span>=set_string_val)<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, tout est assez simple. Pour ajouter une propri√©t√©, la directive </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Property</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est pr√©vue </font><font style="vertical-align: inherit;">, qui a deux param√®tres requis: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nom</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour sp√©cifier le nom de la propri√©t√©, et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obtenir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour sp√©cifier une m√©thode qui renvoie une valeur (getter). Il peut ne pas y avoir de setter, mais si la propri√©t√© doit √©galement √™tre affect√©e de valeurs, la m√©thode setter est sp√©cifi√©e comme valeur du param√®tre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dans notre exemple, les propri√©t√©s sont cr√©√©es de mani√®re assez simple, car il existe d√©j√† des fonctions qui fonctionnent comme des getters et des setters. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous pouvons uniquement collecter le package √† l'aide de la commande </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , l'installer, apr√®s quoi nous v√©rifierons le fonctionnement des propri√©t√©s dans le mode de commande de l'interpr√©teur python:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> foocpp <span class="hljs-keyword">import</span> Foo
<span class="hljs-meta">&gt;&gt;&gt; </span>x = Foo(<span class="hljs-number">10</span>, <span class="hljs-string">"Hello"</span>)
<span class="hljs-meta">&gt;&gt;&gt; </span>x.int_val
<span class="hljs-number">10</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.string_val
<span class="hljs-string">'Hello'</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.int_val = <span class="hljs-number">50</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.string_val = <span class="hljs-string">''</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.get_int_val()
<span class="hljs-number">50</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.get_string_val()
<span class="hljs-string">''</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir dans l'exemple d'utilisation de la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , les </font><i><font style="vertical-align: inherit;">propri√©t√©s </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int_val</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">string_val</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonctionnent √† la fois pour la lecture et l'√©criture.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajouter des lignes de documentation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous continuerons d'am√©liorer notre classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">L'exemple suivant, situ√© dans le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_cpp_03,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> montre comment ajouter des lignes de documentation (docstring) √† divers √©l√©ments d'une classe. </font><font style="vertical-align: inherit;">Cet exemple est bas√© sur le pr√©c√©dent et le principal changement concerne le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoocpp.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Voici son contenu:</font></font><br>
<br>
<pre><code class="cpp hljs">%Module(name=foocpp, language=<span class="hljs-string">"C++"</span>)<font></font>
%DefaultEncoding <span class="hljs-string">"UTF-8"</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Foo</span> {</span><font></font>
%Docstring<font></font>
Class example from C++ library<font></font>
%End<font></font>
<font></font>
    %TypeHeaderCode<font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;foo.h&gt;</span></span><font></font>
    %End<font></font>
<font></font>
    <span class="hljs-keyword">public</span>:<font></font>
        Foo(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*);<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_int_val</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>;<font></font>
        %Docstring(format=<span class="hljs-string">"deindented"</span>, signature=<span class="hljs-string">"prepended"</span>)<font></font>
            Set integer value<font></font>
        %<span class="hljs-function">End

        <span class="hljs-keyword">int</span> <span class="hljs-title">get_int_val</span><span class="hljs-params">()</span></span>;<font></font>
        %Docstring(format=<span class="hljs-string">"deindented"</span>, signature=<span class="hljs-string">"prepended"</span>)<font></font>
            Return integer value<font></font>
        %End<font></font>
<font></font>
        %Property(name=int_val, get=get_int_val, <span class="hljs-built_in">set</span>=set_int_val)<font></font>
        {<font></font>
            %Docstring <span class="hljs-string">"deindented"</span>
                The property <span class="hljs-keyword">for</span> integer value<font></font>
            %End<font></font>
        };<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_string_val</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;<font></font>
        %Docstring(format=<span class="hljs-string">"deindented"</span>, signature=<span class="hljs-string">"appended"</span>)<font></font>
            Set <span class="hljs-built_in">string</span> value<font></font>
        %<span class="hljs-function">End

        <span class="hljs-keyword">char</span>* <span class="hljs-title">get_string_val</span><span class="hljs-params">()</span></span>;<font></font>
        %Docstring(format=<span class="hljs-string">"deindented"</span>, signature=<span class="hljs-string">"appended"</span>)<font></font>
            Return <span class="hljs-built_in">string</span> value<font></font>
        %End<font></font>
<font></font>
        %Property(name=string_val, get=get_string_val, <span class="hljs-built_in">set</span>=set_string_val)<font></font>
        {<font></font>
            %Docstring <span class="hljs-string">"deindented"</span>
                The property <span class="hljs-keyword">for</span> <span class="hljs-built_in">string</span> value<font></font>
            %End<font></font>
        };<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous l'avez d√©j√† compris, pour ajouter des lignes de documentation √† n'importe quel √©l√©ment de la classe, vous devez utiliser la directive </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Docstring</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Cet exemple montre plusieurs fa√ßons d'utiliser cette directive. Pour une meilleure compr√©hension de cet exemple, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">compilons</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imm√©diatement le paquet </font><i><font style="vertical-align: inherit;">pyfoocpp</font></i><font style="vertical-align: inherit;"> √† l'aide de la commande </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , installez-le, et nous d√©terminerons s√©quentiellement quel param√®tre de cette directive affecte quoi, compte tenu des lignes de documentation r√©sultantes en mode de commande Python. Permettez-moi de vous rappeler que les lignes de documentation sont stock√©es en tant que membres des </font><font style="vertical-align: inherit;">objets </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__doc__</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auxquels ces lignes appartiennent. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La premi√®re ligne de documentation concerne la classe </font><i><font style="vertical-align: inherit;">Foo</font></i><font style="vertical-align: inherit;"> .</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Comme vous pouvez le voir, toutes les lignes de documentation sont situ√©es entre les </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">directives% Docstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% End</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Les lignes 5-7 de cet exemple n'utilisent aucun param√®tre suppl√©mentaire de la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Docstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la ligne de documentation sera donc √©crite dans la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> telle </font><font style="vertical-align: inherit;">quelle </font><font style="vertical-align: inherit;">. C'est pourquoi il n'y a pas de retrait dans les lignes 5-7, sinon le retrait avant la ligne de documentation tomberait √©galement dans Foo .__ doc__. Nous nous assurerons que la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contient vraiment la ligne de documentation que nous avons introduite:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> foocpp <span class="hljs-keyword">import</span> Foo
<span class="hljs-meta">&gt;&gt;&gt; </span>Foo.__doc__
<span class="hljs-string">'Class example from C++ library'</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Docstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> suivante </font><font style="vertical-align: inherit;">, situ√©e sur les lignes 17-19, utilise deux param√®tres √† la fois. Le param√®tre de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">format</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> peut prendre l'une des deux valeurs: ¬´brut¬ª ou ¬´d√©sindent√©¬ª. Dans le premier cas, les lignes de documentation sont enregistr√©es au fur et √† mesure qu'elles sont √©crites et dans le second cas, les caract√®res d'espacement initiaux (mais pas les tabulations) sont supprim√©s. La valeur par d√©faut du cas si le param√®tre de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">format</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n'est </font><font style="vertical-align: inherit;">pas sp√©cifi√© peut √™tre d√©finie √† l'aide de la directive </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% DefaultDocstringFormat</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (nous la consid√©rerons un peu plus tard), et si elle n'est pas sp√©cifi√©e, alors on suppose que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">format = "raw"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En plus des lignes de documentation sp√©cifi√©es, SIP ajoute une description de sa signature (quels types de variables sont attendus √† l'entr√©e et quel type la fonction renvoie) aux lignes de documentation des fonctions. Le param√®tre de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">signature</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indique o√π placer une telle signature: avant la ligne de documentation sp√©cifi√©e ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">signature = "pr√©-ajout√©e"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), apr√®s celle-ci ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">signature = "ajout√©e"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) ou ne pas ajouter la signature ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">signature = "supprim√©e"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre exemple d√©finit le param√®tre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">signature = "prepended"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour les fonctions </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_int_val</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set_int_val</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ainsi que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">signature = " </font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">appended </font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">"</font></i><font style="vertical-align: inherit;"> pour les fonctions </font><i><font style="vertical-align: inherit;">get_string_val</font></i><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set_string_val</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Le param√®tre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">format = "deindented"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a √©galement √©t√© ajout√© </font><font style="vertical-align: inherit;">pour supprimer les espaces au d√©but de la ligne de documentation. V√©rifions le fonctionnement de ces param√®tres en Python:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span>Foo.get_int_val.__doc__
<span class="hljs-string">'get_int_val(self) -&gt; int\nReturn integer value'</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>Foo.set_int_val.__doc__
<span class="hljs-string">'set_int_val(self, int)\nSet integer value'</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>Foo.get_string_val.__doc__
<span class="hljs-string">'Return string value\nget_string_val(self) -&gt; str'</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>Foo.set_string_val.__doc__
<span class="hljs-string">'Set string value\nset_string_val(self, str)'</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, en utilisant le param√®tre </font><font style="vertical-align: inherit;">de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">signature</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Docstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">vous pouvez modifier la position de la description de la signature de fonction dans la ligne de documentation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pensez maintenant √† ajouter une ligne de documentation aux propri√©t√©s. Notez que dans ce cas, les </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">directives% Docstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% End</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sont </font><i><font style="vertical-align: inherit;">plac√©es</font></i><font style="vertical-align: inherit;"> entre accolades apr√®s la directive% Property. Ce format d'enregistrement est d√©crit dans la documentation de la directive </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Property</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notez √©galement comment nous </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sp√©cifions le</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> param√®tre de directive </font><i><font style="vertical-align: inherit;">% Docstring</font></i><font style="vertical-align: inherit;"> . Un tel format pour √©crire des directives est possible si nous ne d√©finissons que le premier param√®tre de la directive (dans ce cas, le param√®tre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">format</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">Ainsi, dans cet exemple, trois m√©thodes d'utilisation des directives sont utilis√©es √† la fois. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assurez-vous que la ligne de documentation des propri√©t√©s est d√©finie:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt;&gt;&gt; Foo.int_val.__doc__<font></font>
'The property for integer value'<font></font>
<font></font>
&gt;&gt;&gt; Foo.string_val.__doc__<font></font>
'The property for string value'<font></font>
<font></font>
&gt;&gt;&gt; help(Foo)<font></font>
Help on class Foo in module foocpp:<font></font>
<font></font>
class Foo(sip.wrapper)<font></font>
 |  Class example from C++ library<font></font>
 |  <font></font>
 |  Method resolution order:<font></font>
 |      Foo<font></font>
 |      sip.wrapper<font></font>
 |      sip.simplewrapper<font></font>
 |      builtins.object<font></font>
 |  <font></font>
 |  Methods defined here:<font></font>
 |  <font></font>
 |  get_int_val(...)<font></font>
 |      get_int_val(self) -&gt; int<font></font>
 |      Return integer value<font></font>
 |  <font></font>
 |  get_string_val(...)<font></font>
 |      Return string value<font></font>
 |      get_string_val(self) -&gt; str<font></font>
 |  <font></font>
 |  set_int_val(...)<font></font>
 |      set_int_val(self, int)<font></font>
 |      Set integer value<font></font>
 |  <font></font>
 |  set_string_val(...)<font></font>
 |      Set string value<font></font>
 |      set_string_val(self, str)<font></font>
...<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Simplifions cet exemple en d√©finissant les valeurs par d√©faut des param√®tres de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">format</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">signature</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √† l'aide des </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">directives </font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% DefaultDocstringFormat</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% DefaultDocstringSignature</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">L'utilisation de ces directives est illustr√©e dans l'exemple du dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_cpp_04</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoocpp.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans cet exemple contient le code suivant:</font></font><br>
<br>
<pre><code class="cpp hljs">%Module(name=foocpp, language=<span class="hljs-string">"C++"</span>)<font></font>
%DefaultEncoding <span class="hljs-string">"UTF-8"</span>
%DefaultDocstringFormat <span class="hljs-string">"deindented"</span>
%DefaultDocstringSignature <span class="hljs-string">"prepended"</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Foo</span> {</span><font></font>
    %Docstring<font></font>
    Class example from C++ library<font></font>
    %End<font></font>
<font></font>
    %TypeHeaderCode<font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;foo.h&gt;</span></span><font></font>
    %End<font></font>
<font></font>
    <span class="hljs-keyword">public</span>:<font></font>
        Foo(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*);<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_int_val</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>;<font></font>
        %Docstring<font></font>
            Set integer value<font></font>
        %<span class="hljs-function">End

        <span class="hljs-keyword">int</span> <span class="hljs-title">get_int_val</span><span class="hljs-params">()</span></span>;<font></font>
        %Docstring<font></font>
            Return integer value<font></font>
        %End<font></font>
<font></font>
        %Property(name=int_val, get=get_int_val, <span class="hljs-built_in">set</span>=set_int_val)<font></font>
        {<font></font>
            %Docstring<font></font>
                The property <span class="hljs-keyword">for</span> integer value<font></font>
            %End<font></font>
        };<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_string_val</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;<font></font>
        %Docstring<font></font>
            Set <span class="hljs-built_in">string</span> value<font></font>
        %<span class="hljs-function">End

        <span class="hljs-keyword">char</span>* <span class="hljs-title">get_string_val</span><span class="hljs-params">()</span></span>;<font></font>
        %Docstring<font></font>
            Return <span class="hljs-built_in">string</span> value<font></font>
        %End<font></font>
<font></font>
        %Property(name=string_val, get=get_string_val, <span class="hljs-built_in">set</span>=set_string_val)<font></font>
        {<font></font>
            %Docstring<font></font>
                The property <span class="hljs-keyword">for</span> <span class="hljs-built_in">string</span> value<font></font>
            %End<font></font>
        };<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au d√©but du fichier, les lignes </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% DefaultDocstringFormat "deindented"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% DefaultDocstringSignature "prepended" ont √©t√© ajout√©es</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , puis tous les param√®tres de la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Docstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ont √©t√© supprim√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir assembl√© et install√© cet exemple, nous pouvons voir √† quoi ressemble la description de la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que la commande </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">help (Foo)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> affiche </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt;&gt;&gt; from foocpp import Foo<font></font>
&gt;&gt;&gt; help(Foo)<font></font>
<font></font>
class Foo(sip.wrapper)<font></font>
 |  Class example from C++ library<font></font>
 |  <font></font>
 |  Method resolution order:<font></font>
 |      Foo<font></font>
 |      sip.wrapper<font></font>
 |      sip.simplewrapper<font></font>
 |      builtins.object<font></font>
 |  <font></font>
 |  Methods defined here:<font></font>
 |  <font></font>
 |  get_int_val(...)<font></font>
 |      get_int_val(self) -&gt; int<font></font>
 |      Return integer value<font></font>
 |  <font></font>
 |  get_string_val(...)<font></font>
 |      get_string_val(self) -&gt; str<font></font>
 |      Return string value<font></font>
 |  <font></font>
 |  set_int_val(...)<font></font>
 |      set_int_val(self, int)<font></font>
 |      Set integer value<font></font>
 |  <font></font>
 |  set_string_val(...)<font></font>
 |      set_string_val(self, str)<font></font>
 |      Set string value<font></font>
...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout a l'air assez soign√© et du m√™me type.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Renommer des classes et des m√©thodes</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme nous l'avons d√©j√† dit, l'interface fournie par les liaisons Python ne doit pas n√©cessairement correspondre √† l'interface fournie par la biblioth√®que C / C ++. Nous avons ajout√© des propri√©t√©s aux classes ci-dessus, et nous allons maintenant examiner une autre technique qui peut √™tre utile si des conflits de noms de classe ou de fonctions surviennent, par exemple, si un nom de fonction correspond √† un mot-cl√© Python. Pour ce faire, vous pouvez renommer des classes, des fonctions, des exceptions et d'autres entit√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour renommer une entit√©, l'annotation </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><i><font style="vertical-align: inherit;">utilis√©e</font></i><font style="vertical-align: inherit;"> , dont la valeur doit √™tre affect√©e √† un nouveau nom d'entit√©. Le travail avec l'annotation </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyName est</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> illustr√© dans l'exemple du dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_cpp_05</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Cet exemple est bas√© sur l'exemple pr√©c√©dent.</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_cpp_04</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et en diff√®re par le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoocpp.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dont le contenu ressemble maintenant √† ceci:</font></font><br>
<br>
<pre><code class="cpp hljs">%Module(name=foocpp, language=<span class="hljs-string">"C++"</span>)<font></font>
%DefaultEncoding <span class="hljs-string">"UTF-8"</span>
%DefaultDocstringFormat <span class="hljs-string">"deindented"</span>
%DefaultDocstringSignature <span class="hljs-string">"prepended"</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Foo</span> /<span class="hljs-title">PyName</span>=<span class="hljs-title">Bar</span>/ {</span><font></font>
    %Docstring<font></font>
    Class example from C++ library<font></font>
    %End<font></font>
<font></font>
    %TypeHeaderCode<font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;foo.h&gt;</span></span><font></font>
    %End<font></font>
<font></font>
    <span class="hljs-keyword">public</span>:<font></font>
        Foo(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*);<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_int_val</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span> /PyName</span>=set_integer_value/;<font></font>
        %Docstring<font></font>
            Set integer value<font></font>
        %<span class="hljs-function">End

        <span class="hljs-keyword">int</span> <span class="hljs-title">get_int_val</span><span class="hljs-params">()</span> /PyName</span>=get_integer_value/;<font></font>
        %Docstring<font></font>
            Return integer value<font></font>
        %End<font></font>
<font></font>
        %Property(name=int_val, get=get_integer_value, <span class="hljs-built_in">set</span>=set_integer_value)<font></font>
        {<font></font>
            %Docstring<font></font>
                The property <span class="hljs-keyword">for</span> integer value<font></font>
            %End<font></font>
        };<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_string_val</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span> /PyName</span>=set_string_value/;<font></font>
        %Docstring<font></font>
            Set <span class="hljs-built_in">string</span> value<font></font>
        %<span class="hljs-function">End

        <span class="hljs-keyword">char</span>* <span class="hljs-title">get_string_val</span><span class="hljs-params">()</span> /PyName</span>=get_string_value/;<font></font>
        %Docstring<font></font>
            Return <span class="hljs-built_in">string</span> value<font></font>
        %End<font></font>
<font></font>
        %Property(name=string_val, get=get_string_value, <span class="hljs-built_in">set</span>=set_string_value)<font></font>
        {<font></font>
            %Docstring<font></font>
                The property <span class="hljs-keyword">for</span> <span class="hljs-built_in">string</span> value<font></font>
            %End<font></font>
        };<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet exemple, nous avons renomm√© la </font><font style="vertical-align: inherit;">classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo en</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font><font style="vertical-align: inherit;">avons </font><font style="vertical-align: inherit;">√©galement attribu√© d'autres noms √† toutes les m√©thodes √† l'aide de l'annotation </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Je pense que tout ici est assez simple et clair, la seule chose √† laquelle il faut pr√™ter attention est la cr√©ation de propri√©t√©s. </font><font style="vertical-align: inherit;">Dans la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Property</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">les param√®tres </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> doivent sp√©cifier les noms des m√©thodes, car ils seront appel√©s dans la classe Python, et non les noms qu'ils ont √©t√© initialement appel√©s en code C ++. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compilez l'exemple, installez-le et voyez √† quoi ressemblera cette classe en Python:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt;&gt;&gt; from foocpp import Bar<font></font>
&gt;&gt;&gt; help(Bar)<font></font>
<font></font>
Help on class Bar in module foocpp:<font></font>
<font></font>
class Bar(sip.wrapper)<font></font>
 |  Class example from C++ library<font></font>
 |  <font></font>
 |  Method resolution order:<font></font>
 |      Bar<font></font>
 |      sip.wrapper<font></font>
 |      sip.simplewrapper<font></font>
 |      builtins.object<font></font>
 |  <font></font>
 |  Methods defined here:<font></font>
 |  <font></font>
 |  get_integer_value(...)<font></font>
 |      get_integer_value(self) -&gt; int<font></font>
 |      Return integer value<font></font>
 |  <font></font>
 |  get_string_value(...)<font></font>
 |      get_string_value(self) -&gt; str<font></font>
 |      Return string value<font></font>
 |  <font></font>
 |  set_integer_value(...)<font></font>
 |      set_integer_value(self, int)<font></font>
 |      Set integer value<font></font>
 |  <font></font>
 |  set_string_value(...)<font></font>
 |      set_string_value(self, str)<font></font>
 |      Set string value<font></font>
 |  <font></font>
 |  ----------------------------------------------------------------------<font></font>
 |  Data descriptors defined here:<font></font>
 |  <font></font>
 |  __weakref__<font></font>
 |      list of weak references to the object (if defined)<font></font>
 |  <font></font>
 |  int_val<font></font>
 |      The property for integer value<font></font>
 |  <font></font>
 |  string_val<font></font>
 |      The property for string value<font></font>
 |  <font></font>
 |  ----------------------------------------------------------------------<font></font>
...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√áa a march√©! </font><font style="vertical-align: inherit;">Nous avons r√©ussi √† renommer la classe elle-m√™me et ses m√©thodes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parfois, les biblioth√®ques utilisent l'accord que les noms de toutes les classes commencent par un pr√©fixe, par exemple, avec la lettre ¬´Q¬ª dans Qt ou ¬´wx¬ª dans wxWidgets. </font><font style="vertical-align: inherit;">Si, dans votre liaison Python, vous souhaitez renommer toutes les classes en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">supprimant</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ces pr√©fixes, afin de ne pas d√©finir l'annotation </font><i><font style="vertical-align: inherit;">PyName</font></i><font style="vertical-align: inherit;"> pour chaque classe, vous pouvez utiliser la directive </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% AutoPyName</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Nous ne consid√©rerons pas cette directive dans cet article, nous dirons seulement que la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% AutoPyName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> doit √™tre situ√©e √† l'int√©rieur de la directive </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Module</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et nous limiter √† un exemple de la documentation:</font></font><br>
<br>
<pre><code class="plaintext hljs">%Module PyQt5.QtCore<font></font>
{<font></font>
    %AutoPyName(remove_leading="Q")<font></font>
}<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajouter une conversion de type</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple d'utilisation de la classe std :: wstring</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jusqu'√† pr√©sent, nous avons examin√© les fonctions et les classes qui ont travaill√© avec des types simples comme </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pour ces types, SIP a automatiquement cr√©√© un convertisseur vers et depuis les classes Python. Dans l'exemple suivant, qui se trouve dans le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_cpp_06</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nous consid√©rerons le cas o√π les m√©thodes de classe acceptent et retournent des objets plus complexes, par exemple des cha√Ænes de STL. Pour simplifier l'exemple et ne pas compliquer la conversion d'octets en Unicode et vice versa, la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classe de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cha√Æne </font><i><font style="vertical-align: inherit;">std :: wstring</font></i><font style="vertical-align: inherit;"> sera utilis√©e dans cet exemple </font><font style="vertical-align: inherit;">. L'id√©e de cet exemple est de montrer comment vous pouvez d√©finir manuellement les r√®gles de conversion des classes C ++ vers et depuis les classes Python. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour cet exemple, nous allons changer la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de la biblioth√®que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Maintenant, la d√©finition de classe ressemblera √† ceci (fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> FOO_LIB</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FOO_LIB</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string&gt;</span></span><font></font>
<font></font>
<span class="hljs-keyword">using</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">wstring</span>;<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Foo</span> {</span>
    <span class="hljs-keyword">private</span>:
        <span class="hljs-keyword">int</span> _int_val;
        <span class="hljs-built_in">wstring</span> _string_val;
    <span class="hljs-keyword">public</span>:<font></font>
        Foo(<span class="hljs-keyword">int</span> int_val, <span class="hljs-built_in">wstring</span> string_val);<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_int_val</span><span class="hljs-params">(<span class="hljs-keyword">int</span> val)</span></span>;
        <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">get_int_val</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_string_val</span><span class="hljs-params">(<span class="hljs-built_in">wstring</span> val)</span></span>;
        <span class="hljs-function"><span class="hljs-built_in">wstring</span> <span class="hljs-title">get_string_val</span><span class="hljs-params">()</span></span>;<font></font>
};<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'impl√©mentation de la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo.cpp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"foo.h"</span></span><font></font>
<font></font>
<span class="hljs-keyword">using</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">wstring</span>;<font></font>
<font></font>
Foo::Foo(<span class="hljs-keyword">int</span> int_val, <span class="hljs-built_in">wstring</span> string_val):<font></font>
    _int_val(int_val), _string_val(string_val) {}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Foo::set_int_val</span><span class="hljs-params">(<span class="hljs-keyword">int</span> val)</span> </span>{<font></font>
    _int_val = val;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Foo::get_int_val</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> _int_val;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Foo::set_string_val</span><span class="hljs-params">(<span class="hljs-built_in">wstring</span> val)</span> </span>{<font></font>
    _string_val = val;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-built_in">wstring</span> <span class="hljs-title">Foo::get_string_val</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> _string_val;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.cpp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour v√©rifier les fonctionnalit√©s de la biblioth√®que:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"foo.h"</span></span><font></font>
<font></font>
<span class="hljs-keyword">using</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span>;
<span class="hljs-keyword">using</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span> </span>{
    <span class="hljs-keyword">auto</span> foo = Foo(<span class="hljs-number">10</span>, <span class="hljs-string">L"Hello"</span>);
    <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">L"int_val: "</span> &lt;&lt; foo.get_int_val() &lt;&lt; <span class="hljs-built_in">endl</span>;
    <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">L"string_val: "</span> &lt;&lt; foo.get_string_val().c_str() &lt;&lt; <span class="hljs-built_in">endl</span>;<font></font>
<font></font>
    foo.set_int_val(<span class="hljs-number">0</span>);<font></font>
    foo.set_string_val(<span class="hljs-string">L"Hello world!"</span>);<font></font>
<font></font>
    <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">L"int_val: "</span> &lt;&lt; foo.get_int_val() &lt;&lt; <span class="hljs-built_in">endl</span>;
    <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">L"string_val: "</span> &lt;&lt; foo.get_string_val().c_str() &lt;&lt; <span class="hljs-built_in">endl</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les fichiers </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo.cpp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.cpp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , comme pr√©c√©demment, se trouvent dans le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> processus de cr√©ation du </font><i><font style="vertical-align: inherit;">makefile</font></i><font style="vertical-align: inherit;"> et de la biblioth√®que n'a pas chang√©. </font><font style="vertical-align: inherit;">Il n'y a pas non plus de modifications importantes dans les fichiers </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoocpp.sip est</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devenu beaucoup plus compliqu√©:</font></font><br>
<br>
<pre><code class="cpp hljs">%Module(name=foocpp, language=<span class="hljs-string">"C++"</span>)<font></font>
%DefaultEncoding <span class="hljs-string">"UTF-8"</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Foo</span> {</span><font></font>
    %TypeHeaderCode<font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;foo.h&gt;</span></span><font></font>
    %End<font></font>
<font></font>
    <span class="hljs-keyword">public</span>:<font></font>
        Foo(<span class="hljs-keyword">int</span>, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">wstring</span>);<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_int_val</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>;
        <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">get_int_val</span><span class="hljs-params">()</span></span>;<font></font>
        %Property(name=int_val, get=get_int_val, <span class="hljs-built_in">set</span>=set_int_val)<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_string_val</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">wstring</span>)</span></span>;
        <span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">wstring</span> <span class="hljs-title">get_string_val</span><span class="hljs-params">()</span></span>;<font></font>
        %Property(name=string_val, get=get_string_val, <span class="hljs-built_in">set</span>=set_string_val)<font></font>
};<font></font>
<font></font>
%MappedType <span class="hljs-built_in">std</span>::<span class="hljs-built_in">wstring</span><font></font>
{<font></font>
%TypeHeaderCode<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string&gt;</span></span><font></font>
%End<font></font>
<font></font>
%ConvertFromTypeCode<font></font>
    <span class="hljs-comment">// Convert an std::wstring to a Python (Unicode) string</span><font></font>
    PyObject* newstring;<font></font>
    newstring = PyUnicode_FromWideChar(sipCpp-&gt;data(), <span class="hljs-number">-1</span>);
    <span class="hljs-keyword">return</span> newstring;<font></font>
%End<font></font>
<font></font>
%ConvertToTypeCode<font></font>
    <span class="hljs-comment">// Convert a Python (Unicode) string to an std::wstring</span>
    <span class="hljs-keyword">if</span> (sipIsErr == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">return</span> PyUnicode_Check(sipPy);<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (PyUnicode_Check(sipPy)) {<font></font>
        *sipCppPtr = <span class="hljs-keyword">new</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">wstring</span>(PyUnicode_AS_UNICODE(sipPy));
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
%End<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fins d'</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> illustration </font><i><font style="vertical-align: inherit;">, le</font></i><font style="vertical-align: inherit;"> fichier </font><i><font style="vertical-align: inherit;">pyfoocpp.sip n'ajoute</font></i><font style="vertical-align: inherit;"> pas de lignes de documentation. Si nous </font><font style="vertical-align: inherit;">ne </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conservions</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que la d√©claration de la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le fichier </font><i><font style="vertical-align: inherit;">pyfoocpp.sip</font></i><font style="vertical-align: inherit;"> sans la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% MappedType suivante</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nous obtiendrions l'erreur suivante pendant le processus de g√©n√©ration:</font></font><br>
<br>
<pre><code class="plaintext hljs">$ sip-wheel<font></font>
<font></font>
These bindings will be built: pyfoocpp.<font></font>
Generating the pyfoocpp bindings...<font></font>
sip-wheel: std::wstring is undefined<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous devons d√©crire explicitement comment un objet de type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std :: wstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sera converti en un objet Python, et √©galement d√©crire la transformation inverse. Pour d√©crire la conversion, nous devons travailler √† un niveau assez bas dans le langage C et utiliser l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API Python / C</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . √âtant donn√© que l'API Python / C est un gros sujet, digne m√™me d'un article s√©par√©, mais d'un livre, dans cette section, nous ne consid√©rerons que les fonctions utilis√©es dans l'exemple, sans entrer dans trop de d√©tails. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour d√©clarer des conversions d'objets C ++ en Python et vice versa, la directive </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% MappedType</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">pr√©vue</font></a><font style="vertical-align: inherit;"> , √† l'int√©rieur de laquelle il peut y avoir trois autres directives: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% TypeHeaderCode</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertToTypeCode</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertFromTypeCode</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Apr√®s l'expression </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% MappedType</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">vous devez sp√©cifier le type pour lequel les convertisseurs seront cr√©√©s. </font><font style="vertical-align: inherit;">Dans notre cas, la directive commence par l'expression </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% MappedType std :: wstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Nous avons d√©j√† rencontr√© la </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% TypeHeaderCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans la section </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr√©ation d'une liaison pour une biblioth√®que en C ++</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Permettez-moi de vous rappeler que cette directive est destin√©e √† d√©clarer les types utilis√©s ou √† inclure les fichiers d'en-t√™te dans lesquels ils sont d√©clar√©s. </font><font style="vertical-align: inherit;">Dans cet exemple </font><font style="vertical-align: inherit;">, la </font><i><font style="vertical-align: inherit;">cha√Æne du</font></i><font style="vertical-align: inherit;"> fichier d'en-t√™te </font><font style="vertical-align: inherit;">, o√π la classe </font><i><font style="vertical-align: inherit;">std :: string est</font></i><font style="vertical-align: inherit;"> d√©clar√©e, est </font><font style="vertical-align: inherit;">connect√©e </font><font style="vertical-align: inherit;">√† l'int√©rieur de la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% TypeHeaderCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">
Maintenant, nous devons d√©crire les transformations</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertFromTypeCode. </font><font style="vertical-align: inherit;">Conversion d'objets C ++ en Python</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous commen√ßons par convertir les objets </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std :: wstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en la </font><font style="vertical-align: inherit;">classe </font><font style="vertical-align: inherit;">Python </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Cette conversion dans l'exemple est la suivante:</font></font><br>
<br>
<pre><code class="cpp hljs">%ConvertFromTypeCode
    <span class="hljs-comment">// Convert an std::wstring to a Python (Unicode) string</span><font></font>
    PyObject* newstring;<font></font>
    newstring = PyUnicode_FromWideChar(sipCpp-&gt;data(), <span class="hljs-number">-1</span>);
    <span class="hljs-keyword">return</span> newstring;<font></font>
%End<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä l'int√©rieur de cette directive, nous avons la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipCpp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - un pointeur vers un objet √† partir du code C ++, par lequel nous devons cr√©er un objet Python et renvoyer l'objet cr√©√© √† partir de la directive √† l'aide de l' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instruction return</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dans ce cas, la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipCpp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est de type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std :: wstring *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pour cr√©er la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , utilisez la fonction </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyUnicode_FromWideChar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de l'API Python / C. Cette fonction accepte un tableau (pointeur) de type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const wchar_t * w</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comme premier param√®tre </font><font style="vertical-align: inherit;">, et la taille de ce tableau comme deuxi√®me param√®tre. Si vous passez la valeur -1 comme deuxi√®me param√®tre, la fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyUnicode_FromWideChar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> elle-m√™me calculera la longueur √† l'aide de la fonction</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wcslen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour obtenir le tableau </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wchar_t *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">utilisez la m√©thode </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de la classe </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std :: wstring</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyUnicode_FromWideChar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> renvoie un pointeur sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyObject</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NULL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en cas d'erreur. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyObject</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est n'importe quel objet Python, dans ce cas, ce sera la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans l'API Python / C, le travail avec les objets s'effectue g√©n√©ralement via des pointeurs </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyObject *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dans ce cas, </font><font style="vertical-align: inherit;">nous </font><i><font style="vertical-align: inherit;">renvoyons le</font></i><font style="vertical-align: inherit;"> pointeur </font><i><font style="vertical-align: inherit;">PyObject * √†</font></i><font style="vertical-align: inherit;"> partir de la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertFromTypeCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertToTypeCode. </font><font style="vertical-align: inherit;">Convertir des objets Python en C ++</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La conversion inverse d'un objet Python (essentiellement de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyObject *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) en classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std :: wstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><font style="vertical-align: inherit;">d√©crite dans la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertToTypeCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dans l'exemple </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_cpp_06, la</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conversion est la suivante:</font></font><br>
<br>
<pre><code class="cpp hljs">%ConvertToTypeCode
    <span class="hljs-comment">// Convert a Python (Unicode) string to an std::wstring</span>
    <span class="hljs-keyword">if</span> (sipIsErr == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">return</span> PyUnicode_Check(sipPy);<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (PyUnicode_Check(sipPy)) {<font></font>
        *sipCppPtr = <span class="hljs-keyword">new</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">wstring</span>(PyUnicode_AS_UNICODE(sipPy));
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
%End<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code de la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertToTypeCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> semble plus compliqu√©, car pendant le processus de conversion, il est appel√© plusieurs fois √† des fins diff√©rentes. Dans la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertToTypeCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">SIP cr√©e plusieurs variables que nous pouvons (ou devons) utiliser. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'une de ces variables, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyObject * sipPy,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un objet Python dont vous avez besoin pour cr√©er une instance de la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std :: wstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans ce cas </font><font style="vertical-align: inherit;">. Le r√©sultat devra √™tre √©crit dans une autre variable - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipCppPtr</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un double pointeur vers l'objet cr√©√©, c'est-√†-dire dans notre cas, cette variable sera de type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std :: wstring **</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un autre </font><i><font style="vertical-align: inherit;">% ConvertToTypeCode</font></i><font style="vertical-align: inherit;"> cr√©√© √† l'int√©rieur de la directive</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la variable est </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int * sipIsErr</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Si la valeur de cette variable est </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NULL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertToTypeCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est appel√©e uniquement pour v√©rifier si la conversion de type est possible. Dans ce cas, nous ne sommes pas oblig√©s d'effectuer la transformation, mais il suffit de v√©rifier si cela est possible en principe. Si possible, la directive doit renvoyer une valeur non nulle, sinon, si la conversion n'est pas possible, ils doivent retourner 0. Si ce pointeur n'est pas </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NULL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , alors vous devez effectuer la conversion, et si une erreur se produit pendant la conversion, le code d'erreur entier peut √™tre enregistr√© dans cette variable (√©tant donn√© que cette variable est un pointeur vers </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet exemple, pour v√©rifier que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipPy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est une cha√Æne unicode (classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), la macro </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyUnicode_Check</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">utilis√©e</font></a><font style="vertical-align: inherit;"> , qui prend un argument de type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyObject *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si l'argument pass√© est une cha√Æne unicode ou une classe qui en d√©rive. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La conversion en un objet C ++ est effectu√©e √† l'aide de la cha√Æne </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* sipCppPtr = new std :: wstring (PyUnicode_AS_UNICODE (sipPy));</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ici, la macro </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyUnicode_AS_UNICODE est appel√©e √†</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partir de l'API Python / C, qui renvoie un tableau de type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Py_UNICODE *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui √©quivaut √† </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wchar_t *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ce tableau est pass√© au constructeur de la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std :: wstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Comme mentionn√© ci-dessus, le r√©sultat est stock√© dans la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipCppPtr</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour le moment, la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyUnicode_AS_UNICODE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><font style="vertical-align: inherit;">d√©conseill√©e et il est recommand√© d'utiliser d'autres macros, mais cette macro est utilis√©e pour simplifier l'exemple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si la conversion a r√©ussi, la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertToTypeCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> doit renvoyer une valeur non nulle (dans ce cas 1), et en cas d'erreur, elle doit retourner 0.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V√©rifier </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons d√©crit la conversion du type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std :: wstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et vice versa, maintenant nous pouvons nous assurer que le package est correctement construit et que la liaison fonctionne comme il se doit. </font><font style="vertical-align: inherit;">Pour construire, appelez </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , puis installez le package √† l'aide de pip et v√©rifiez l'op√©rabilit√© en mode de commande Python:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> foocpp <span class="hljs-keyword">import</span> Foo
<span class="hljs-meta">&gt;&gt;&gt; </span>x = Foo(<span class="hljs-number">10</span>, <span class="hljs-string">'Hello'</span>)<font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.string_val
<span class="hljs-string">'Hello'</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.string_val = <span class="hljs-string">''</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.string_val
<span class="hljs-string">''</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>x.get_string_val()
<span class="hljs-string">''</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, tout fonctionne, il n'y a pas non plus de probl√®me avec la langue russe, c'est-√†-dire </font><font style="vertical-align: inherit;">Les conversions de cha√Ænes Unicode ont fonctionn√© correctement.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, nous avons couvert les bases de l'utilisation de SIP pour cr√©er des liaisons Python pour des biblioth√®ques √©crites en C et C ++. </font><font style="vertical-align: inherit;">Tout d'abord (dans la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">premi√®re partie</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), nous avons cr√©√© une biblioth√®que simple en C et trouv√© les fichiers qui doivent √™tre cr√©√©s pour fonctionner avec SIP. </font><font style="vertical-align: inherit;">Le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contient des informations sur le package (nom, num√©ro de version, licence et chemins d'acc√®s aux fichiers d'en-t√™te et d'objet). </font><font style="vertical-align: inherit;">√Ä l'aide du fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">vous pouvez influencer le processus de g√©n√©ration du package Python, par exemple, commencer √† cr√©er la biblioth√®que C / C ++ ou laisser l'utilisateur sp√©cifier l'emplacement des fichiers d'en-t√™te et d'objet de la biblioth√®que. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* .sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©crit l'interface du module Python listant les fonctions et classes qui seront contenues dans le module. </font><font style="vertical-align: inherit;">Des directives et des annotations sont utilis√©es </font><font style="vertical-align: inherit;">pour d√©crire l'interface dans le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* .sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . L'interface de classe Python ne doit pas n√©cessairement correspondre √† l'interface de classe C ++. Par exemple, vous pouvez ajouter des propri√©t√©s aux classes √† l'aide de la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Property</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , renommer des entit√©s √† l'aide de l'annotation </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ PyName /</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et ajouter des lignes de documentation √† l'aide de la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Docstring</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Types √©l√©mentaires comme </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etc. SIP se convertit automatiquement en classes Python similaires, mais si vous devez effectuer une conversion plus complexe, vous devez la programmer vous-m√™me dans la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% MappedType</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √† l'aide de l'API Python / C. La conversion de la classe Python en C ++ doit √™tre effectu√©e dans la directive imbriqu√©e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertToTypeCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . La conversion d'un type C ++ en une classe Python doit √™tre effectu√©e dans la directive imbriqu√©e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% ConvertFromTypeCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Certaines directives comme </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% DefaultEncoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% DefaultDocstringFormat</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% DefaultDocstringSignature</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sont auxiliaires et vous permettent de d√©finir des valeurs par d√©faut pour les cas o√π certains param√®tres d'annotation ne sont pas d√©finis explicitement.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, nous n'avons examin√© que les directives et les annotations les plus simples et les plus simples, mais bon nombre d'entre elles ont √©t√© ignor√©es. </font><font style="vertical-align: inherit;">Par exemple, il existe des directives pour g√©rer GIL, pour cr√©er de nouvelles exceptions Python, pour g√©rer manuellement la m√©moire et les r√©cup√©rateurs de place, pour peaufiner les classes pour diff√©rents syst√®mes d'exploitation, et bien d'autres qui peuvent √™tre utiles lors de la cr√©ation de liaisons de biblioth√®que C / C ++ complexes. </font><font style="vertical-align: inherit;">Nous avons √©galement ignor√© le probl√®me de la cr√©ation de packages pour diff√©rents syst√®mes d'exploitation, en nous limitant √† la construction sous Linux √† l'aide de compilateurs gcc / g ++.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©f√©rences</font></font></h2><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La premi√®re partie de l'article</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemples pour cet article</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page d'accueil SIP</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Documentation pour SIP</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Documentation de l'API Python / C</font></font></a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr495618/index.html">La mise en quarantaine entra√Æne des pertes. Comment vivre sans quarantaine?</a></li>
<li><a href="../fr495620/index.html">Assembl√© une moissonneuse de vid√©oconf√©rence √† Jabra Panacast, avantages et inconv√©nients pour le bureau et la maison</a></li>
<li><a href="../fr495622/index.html">Avion √† double syst√®me de climatisation num√©rique (SLE)</a></li>
<li><a href="../fr495624/index.html">Pourquoi la Xbox Series X sera le principal achat de 2020</a></li>
<li><a href="../fr495634/index.html">Tout le monde le fait: pourquoi les employ√©s sont la principale menace √† la s√©curit√© des informations de l'entreprise et comment y faire face</a></li>
<li><a href="../fr495638/index.html">Virgule en anglais: 5 r√®gles et 3 principales erreurs</a></li>
<li><a href="../fr495642/index.html">Commencez √† collecter les erreurs dans les fonctions de copie</a></li>
<li><a href="../fr495644/index.html">TS Total Sight. Outil de collecte d'√©v√©nements, d'analyse d'incidents et d'automatisation de la r√©ponse aux menaces</a></li>
<li><a href="../fr495646/index.html">Quels podcasts non stressants √† √©couter le week-end</a></li>
<li><a href="../fr495658/index.html">O√π obtenir de l'audio pour l'apprentissage automatique: une s√©lection de biblioth√®ques ouvertes sous licence Creative Commons</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>