<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💃🏿 👨🏼‍⚖️ 👨🏼‍🏭 Bitrix 自行审核 🦓 😃 🔈</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="大家好。
 
 当我在Bitrix中寻找有关日志记录（事件审计）的信息时，Habr上没有任何内容，但是其余的还有其他内容，但是谁能在那里找到呢？
 
 为了补充知识基础，我决定写这篇文章：分享我的经验并警告可能会发生的情况。
 
 问题的提法
 我的任务是开发最简单的广告结构会计系统，根据国家合同的...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Bitrix 自行审核</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491826/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大家好。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当我在Bitrix中寻找有关日志记录（事件审计）的信息时，Habr上没有任何内容，但是其余的还有其他内容，但是谁能在那里找到呢？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了补充知识基础，我决定写这篇文章：分享我的经验并警告可能会发生的情况。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题的提法</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我的任务是开发最简单的广告结构会计系统，根据国家合同的规定，该系统应在Bitrix（版本15）的基础上工作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可以在Bitrix一侧骑自行车，但我认为相对于客户而言这是不诚实的，Bitrix的功能得到了最大程度的利用：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户认证</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据存储系统（EAV）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据编辑器</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审核事件处理程序</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">授权用户动作的角色模型</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户管理</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用目录</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本文主要讨论审核事件，我还将介绍一些有关授权以及将自定义书签添加到信息块记录卡的信息。</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审核事件</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在开发的系统中，通过API处理数据（向地图添加新对象并更改其坐标），并通过Bitrix编辑器编辑对象的其他参数，因为API不会处理所有数据更改请求，因此仅API中的审核将无法完成，这意味着我们需要对Bitrix进行审核。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不是我不知道什么是审核，而是我不必经常编写审核。通常，这可以通过将行的旧版本（旧数据）写入单独的表中来解决，并且实现完全在DBMS一侧执行。而且，我们同时具有更改之前的状态和更改之后的状态。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要对DBMS触发器进行审核，或对Bitrix事件进行审核，两者之间的差异并不大。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
用于处理的事件已在脚本“</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bitrix / php_interface / init.php</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> “，如果没有文件，则需要创建它：</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">use</span> <span class="hljs-title">Topliner</span>\<span class="hljs-title">Scheme</span>\<span class="hljs-title">Logger</span>;
<span class="hljs-comment">//  </span>
<span class="hljs-keyword">require_once</span>($_SERVER[<span class="hljs-string">'DOCUMENT_ROOT'</span>] . <span class="hljs-string">'/vendor/autoload.php'</span>);
<span class="hljs-comment">//        </span>
<span class="hljs-keyword">if</span> (!defined(<span class="hljs-string">'IBLOCK_MODULE'</span>)) {<font></font>
    define(<span class="hljs-string">'IBLOCK_MODULE'</span>, <span class="hljs-string">'iblock'</span>);<font></font>
}<font></font>
<span class="hljs-comment">//    </span>
AddEventHandler(IBLOCK_MODULE, <span class="hljs-string">'OnIBlockElementAdd'</span>,
    <span class="hljs-keyword">Array</span>(Logger::class, <span class="hljs-string">'OnAdd'</span>));
<span class="hljs-comment">//     ,  -    ,              ,   </span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是一个处理程序的示例，在我的实现中有多个处理程序，可以在存储库中查看代码，链接将在文章结尾。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
用于处理每个事件的事件的方法的签名具有自己的签名，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将在Bitrix文档</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或首次亮相中</font><font style="vertical-align: inherit;">专门</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">查看</font></a><font style="vertical-align: inherit;">该签名，</font><font style="vertical-align: inherit;">并查看源代码（更清楚的是，在调试过程中，所有事件和调用处理程序的时刻也可以在源代码中看到）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这里，我们面对这样一个事实，当使用DBMS时，我们既有当前（旧）数据又要记录的数据（新），而当使用Bitrix时，我们既有旧数据也有新数据，但没有不会同时存在新旧事物。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
另一个问题是，在更改数据之前有多个事件，我无法理解它们之间的区别，同一故事是在更改数据后触发多个事件时，目光注视着选择的财富，实际上这只是选择的一种幻想。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我对Bitrix的拙见</font></font></b><div class="spoiler_text"><blockquote>       ,      ,    _  ,     (       Delphi        PHP),     .<br>
<br>
           depricated       «»,       .<br>
<br>
  « »       ( )  «» (, , )  ,              .                ,         «»  .<br>
<br>
             ,      :)<br>
<br>
            ,            ,       ,                  ,   ,       ,     ,   ?   .<br>
</blockquote><br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用全局状态</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要在事件处理程序之间保存和传递状态，您必须具有全局变量。</font><font style="vertical-align: inherit;">全局变量是无法重构的，因此我使用类的静态属性：</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Logger</span>
</span>{
    <span class="hljs-keyword">const</span> CHANGE = <span class="hljs-string">'change'</span>;
    <span class="hljs-keyword">const</span> REMOVE = <span class="hljs-string">'remove'</span>;
    <span class="hljs-keyword">const</span> CREATE = <span class="hljs-string">'create'</span>;
    <span class="hljs-keyword">const</span> UNDEFINED = <span class="hljs-string">'undefined'</span>;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> $operation = <span class="hljs-built_in">self</span>::UNDEFINED;<font></font>
<font></font>
    <span class="hljs-keyword">const</span> NO_VALUE = [];<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">static</span> $fields = <span class="hljs-built_in">self</span>::NO_VALUE;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">static</span> $properties = <span class="hljs-built_in">self</span>::NO_VALUE;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">static</span> $names = <span class="hljs-built_in">self</span>::NO_VALUE;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这里，您需要对“字段”和“属性”的用法进行解释。字段是每个信息块记录所具有的参数（标识符，名称，信息块“父”），属性是特定于特定类型信息块的记录的参数，在EAV模型中，这些是属性及其值。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
“名称”是属性的名称，在一种情况下，我们具有属性和名称的标识符，在另一种情况下，我们仅具有标识符，并且为了在日志中保留漂亮的记录，我们需要保存名称（我们当然可以减去标识符，但出于某些原因，您不想这样做）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
“操作”是当前操作，对于使用“字段”，Bitrix会给出特定的事件，当使用“属性”（函数“ SetPropertyValues”和“ SetPropertyValuesEx”）时，操作类型没有事件，在调用之前和之后都有一个事件，但是没有知道执行了什么操作（添加/更新/删除），因此该操作也需要从处理程序转移到处理程序。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
也许我没有弄清楚，在Bitrix中您可以同时看到其原样以及它将如何变化，或者也许有必要分别记录之前和之后的状态，但是出于某种原因，我决定日志条目应采用``属性''格式“％name％”是更改前的“ %%”，因此“&gt;”之后变为“％”后的“％”，因此在维护全局状态方面存在很多问题。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定是否需要更改</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
奇怪的是，但是将调用我们的处理程序来更改任何信息块的任何记录。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，在处理程序中，我们需要了解在参数中接收到的哪个信息块的记录。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一条记录的信息块具有两个值：信息块本身（'IBLOCK_ID'）和它的段（'IBLOCK_SECTION_ID'），段标识符有时位于带有索引'IBLOCK_SECTION_ID'的值的数组中，有时位于'IBLOCK_SECTION'的值的数组中，因此我通过以下方式读取段标识符这两个键的优先级都为“ IBLOCK_SECTION”。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此外，在某些情况下，原则上不能确定段标识符，因此，仅根据信息块标识符来检查是否需要向审核日志中添加条目。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
确定信息块和部分后，我们决定需要在日志中注册事件。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改前保存状态</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
每个信息块条目均由两部分组成，一部分是“字段”，这些参数可以通过方法进行更改：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CIBlockElement ::添加（） </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CIBlockElement ::更新（） </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CIBlockElement ::删除（）</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
另一部分是“属性”方法：</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CIBlockElement :: SetPropertyValues（）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CIBlockElement :: SetPropertyValuesEx（）</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我不记得为什么，但是最好不要在代码中使用CIBlockElement :: SetPropertyValuesEx（）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
事件处理程序中数据的每个部分彼此独立，因此，通过单击“保存”按钮，可以在审核日志中创建两个条目。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
“字段”和“属性”的事件签名不同，在处理“字段”的部分中，我们保存字段的当前状态并将值设置为“操作”，在处理“属性”的部分中，我们保存属性及其名称。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们当然是在“之前”处理程序中执行此操作的。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变更注册</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在“之后”处理程序中，我们写入日志。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
编译记录中的差异列表时，属性可能会出现多个值的问题。</font><font style="vertical-align: inherit;">记录它们的“之前”和“之后”状态的格式差异很大，以至于无法推断出另一个，因此，在确定是否注册更改时，您总是会得出结论，认为注册是必要的。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
存储库中</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">src / Topliner / Scheme / Logger.php文件中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审核的源代码</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将自定义标签添加到信息块卡（在Bitrix分类器中）</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要添加卡，使用类似于审核的方法-我们添加一个处理程序：</font></font><br>
<br>
<pre><code class="php hljs">AddEventHandler(<span class="hljs-string">'main'</span>, <span class="hljs-string">'OnAdminIBlockElementEdit'</span>,
    <span class="hljs-keyword">Array</span>(PermitTab::class, <span class="hljs-string">'OnInit'</span>));
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在“ OnInit”方法中，我们定义了在Bitrix编辑器中使用选项卡的其他方法：</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PermitTab</span>
</span>{
    <span class="hljs-keyword">const</span> LINKS = <span class="hljs-string">'links'</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">OnInit</span>(<span class="hljs-params">$arArgs</span>)
    </span>{<font></font>
        $permits = BitrixScheme::getPermits();<font></font>
        $pubPermits = BitrixScheme::getPublishedPermits();<font></font>
        $blockId = (<span class="hljs-keyword">int</span>)$arArgs[<span class="hljs-string">'IBLOCK'</span>][<span class="hljs-string">'ID'</span>];<font></font>
        $letShow = $blockId === $permits-&gt;getBlock()<font></font>
            || $blockId === $pubPermits-&gt;getBlock();<font></font>
        $result = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">if</span> ($letShow) {<font></font>
            $result = [<font></font>
                <span class="hljs-string">'TABSET'</span> =&gt; <span class="hljs-string">'LinksToConstructs'</span>,
                <span class="hljs-string">'GetTabs'</span> =&gt; [<span class="hljs-built_in">static</span>::class, <span class="hljs-string">'GetTabs'</span>],
                <span class="hljs-string">'ShowTab'</span> =&gt; [<span class="hljs-built_in">static</span>::class, <span class="hljs-string">'ShowTab'</span>],
                <span class="hljs-string">'Action'</span> =&gt; [<span class="hljs-built_in">static</span>::class, <span class="hljs-string">'Action'</span>],
                <span class="hljs-string">'Check'</span> =&gt; [<span class="hljs-built_in">static</span>::class, <span class="hljs-string">'Check'</span>],<font></font>
            ];<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">return</span> $result;<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，当然，我们检查该信息块是否需要显示用户选项卡，必要时设置方法。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这里没有什么特别要说的，请参阅</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">src / Topliner / Scheme / PermitTab.php存储库中的源</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并阅读文档。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">授权用户动作的角色模型</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bitrix的授权方法适用于线性权限范围，也就是说，一个场景可以拥有第一个和第二个，但不能拥有第三个，而另一个可以拥有第二个和第三个，而不能拥有第一个，您不能直接实现Bitrix。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于Bitrix中这种棘手的场景，只需检查一些权限，然后在执行操作的代码中即可查看用户是否具有权限，并允许一个角色的第一个和第二个角色以及该角色的第二个和第三个角色。</font></font><br>
<br>
<pre><code class="php hljs">        $constSec = BitrixScheme::getConstructs();<font></font>
        $isAllow = CIBlockSectionRights::UserHasRightTo(<font></font>
            $constSec-&gt;getBlock(), $constSec-&gt;getSection(),<font></font>
            BitrixPermission::ELEMENT_ADD, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">if</span> (!$isAllow) {<font></font>
            $output[<span class="hljs-string">'message'</span>] = <span class="hljs-string">'Forbidden, not enough permission;'</span>;<font></font>
        }<font></font>
</code></pre><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ constSec-&gt; getBlock（）-信息块标识符</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ constSec-&gt; getSection（）-段标识符</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BitrixPermission :: ELEMENT_ADD-权限代码</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在必要的信息块和部分的分类器（信息块目录）中，为角色分配适当的权限。</font><font style="vertical-align: inherit;">将角色分配给用户，一切都在您的控制之下。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">认证方式</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您需要某些页面的用户身份验证，只需添加：</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span>
define(<span class="hljs-string">"NEED_AUTH"</span>, <span class="hljs-literal">true</span>);
<span class="hljs-keyword">require</span>($_SERVER[<span class="hljs-string">"DOCUMENT_ROOT"</span>] . <span class="hljs-string">"/bitrix/header.php"</span>);
<span class="hljs-meta">?&gt;</span><font></font>
<font></font>
<span class="hljs-comment">//      </span><font></font>
<font></font>
<span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">require</span>($_SERVER[<span class="hljs-string">"DOCUMENT_ROOT"</span>] . <span class="hljs-string">"/bitrix/footer.php"</span>);
<span class="hljs-meta">?&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当加载这样的页面时，如果用户尚未登录，Bitrix将给出一个登录表单。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您只需要使用某种脚本来连接Bitrix，则：</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">require_once</span>($_SERVER[<span class="hljs-string">'DOCUMENT_ROOT'</span>]<font></font>
    . <span class="hljs-string">'/bitrix/modules/main/include/prolog_before.php'</span>);
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用目录</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bitrix中的“新”（截至2019年11月）目录称为“ HighloadBlock”，使用它们有点不标准。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
每个Hyload块都可以存储在单独的表中，因此，每次需要确定要读取的表的名称时，就可以访问目录。</font><font style="vertical-align: inherit;">为了不经常这样做，您需要在Bitrix中创建一个类的实例来访问数据。</font><font style="vertical-align: inherit;">在两行中创建一个实例：</font></font><br>
<br>
<pre><code class="php hljs">CModule::IncludeModule(<span class="hljs-string">'highloadblock'</span>);<font></font>
$entity = HighloadBlockTable::compileEntity(<span class="hljs-string">'ConstructionTypes'</span>);<font></font>
$reference = $entity-&gt;getDataClass();<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其中“ ConstructionTypes”是参考代码。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">为了</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
不经常写这两行，您可以编写一个类来为我们创建参考实例（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">src / Topliner / Bitrix / BitrixReference.php</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，我们将与常规Bitrix ORM类（D7）一起使用实例：</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-comment">/* <span class="hljs-doctag">@var</span> $reference DataManager */</span>
$data = $reference::getList(<span class="hljs-keyword">array</span>(
    <span class="hljs-string">'select'</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">'UF_NAME'</span>, <span class="hljs-string">'UF_XML_ID'</span>),
    <span class="hljs-string">'filter'</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">'UF_TYPE_ID'</span> =&gt; <span class="hljs-number">0</span>)<font></font>
    ));<font></font>
</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（小心，很多复制粘贴操作）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
感谢您的关注。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN491812/index.html">IntelliJ IDEA技巧和窍门：2.依赖性分析</a></li>
<li><a href="../zh-CN491814/index.html">网络图作为代码</a></li>
<li><a href="../zh-CN491816/index.html">[预测]未来的运输：长期展望</a></li>
<li><a href="../zh-CN491818/index.html">可靠数据传输的基础</a></li>
<li><a href="../zh-CN491824/index.html">爱所有人-5分钟内与TeamLeadConf一起获得最佳报告</a></li>
<li><a href="../zh-CN491828/index.html">DataMatrix或如何正确标记鞋子</a></li>
<li><a href="../zh-CN491832/index.html">与React Native相比，Flutter有8个优点</a></li>
<li><a href="../zh-CN491838/index.html">MIPT推出体育节目在线公开课程</a></li>
<li><a href="../zh-CN491840/index.html">可视化服务人员的工作</a></li>
<li><a href="../zh-CN491844/index.html">自动测试覆盖率可视化</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>