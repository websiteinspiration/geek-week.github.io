<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤³ğŸ» ğŸ™ï¸ ğŸ§¤ Sensor posisi sakelar lampu darurat ğŸ‘©ğŸ»â€âš•ï¸ ğŸ‘‚ğŸ¾ ğŸ¦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sebelum semua orang yang merancang sistem penerangan darurat otonom, cepat atau lambat, muncul masalah menyalakan dan mematikan lampu darurat. Bagaima...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Sensor posisi sakelar lampu darurat</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492808/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sebelum semua orang yang merancang sistem penerangan darurat otonom, cepat atau lambat, muncul masalah menyalakan dan mematikan lampu darurat. </font><font style="vertical-align: inherit;">Bagaimana melakukan ini dengan cara yang paling nyaman dan transparan, agar tidak merusak desain kamar dengan sakelar tambahan?</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/f4/90/kp/f490kpxmliwuhfpeeuf-lhmjhou.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Salah satu solusi di bawah luka.</font></font><br>
<a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Latar Belakang</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di dunia modern, banyak hal terkait dengan catu daya yang tidak terputus. Sebagian besar jenis kegiatan intelektual sudah tak terbayangkan tanpa komputer dan komunikasi yang beroperasi 24/7. Ini tidak baik atau buruk, dan Anda harus hidup dengannya. Terutama jika tempat kerja Anda tidak di kantor modern, diisi dengan UPS dan generator diesel cadangan, tetapi di apartemen sebuah bangunan bertingkat tinggi perumahan biasa. Dan kebetulan bahwa keandalan pasokan energi perumahan di sebagian besar kota-kota bekas Uni Soviet meninggalkan banyak hal yang diinginkan. Akibatnya, ulir yang menghubungkan outlet rumah dan pembangkit listrik terdekat memiliki kebiasaan buruk putus secara berkala. Kapan setiap enam bulan, dan kapan dan tiga kali sehari.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itulah sebabnya, ketika memulai perbaikan di apartemen baru, saya awalnya memasang kabel paralel dalam proyek untuk catu daya dan penerangan yang tidak terputus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya ingin sekali memiliki generator kuat dengan ICE, yang mampu memberikan daya normal ke seluruh apartemen, tetapi saya harus meninggalkan ide ini. Di rumah pribadi, pertanyaannya tidak akan muncul sama sekali, tetapi apartemen adalah hal lain. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masalah pertama adalah penghapusan gas buang, yang sama sekali tidak bisa ditempatkan di apartemen rumah dengan pemanas sentral. Nah, Anda tidak akan membuang selang tepat di luar jendela, di mana asap langsung tersedot ke jendela tetangga terdekat yang terbuka.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masalah kedua adalah kebisingan. Ya, generator empat-stroke inverter modern, ketika Anda mendengarnya di jalan, dapat tampak sangat sunyi. Dan jika Anda menggantung peredam tambahan, maka benar-benar diam. Tapi percayalah, dalam keadaan deenergisasi, yang berarti bangunan apartemen yang benar-benar sepi, bahkan gemuruh yang sepi seperti itu akan dapat didengar oleh semua tetangga. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Singkatnya, ide dengan generator mati, begitu jelas dan tidak lahir. Dari opsi nyata yang tersisa, hanya baterai yang tersisa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lebih jauh, saya membiarkan diri saya sebuah narasi sederhana tentang cobaan emosional dan keputusan yang dibuat pada orang pertama tanpa klaim kebenaran universal. </font><font style="vertical-align: inherit;">Dan saya segera memperingatkan bahwa argumen saya kepada seseorang mungkin tampak tidak meyakinkan, dan keputusan yang diambil kontroversial. </font><font style="vertical-align: inherit;">Tetapi, bagaimanapun, semua yang dijelaskan di sini saat ini diimplementasikan dalam perangkat keras dan berhasil melakukan tugas-tugas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan jika ada orang yang tertarik pada sisi praktis masalah ini dan tidak peduli bagaimana saya dapat hidup seperti itu, ia dapat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">melewatkan banyak surat dan langsung ke deskripsi solusi yang sudah jadi.</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secara singkat tentang memilih jenis baterai</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan meskipun masalah ini tidak ada hubungannya dengan topik artikel, saya ingin memasukkan lima sen saya di sini juga. Selain itu, yang tak terhindarkan muncul di bawah pernyataan seperti diskusi sering membawa banyak </font><font style="vertical-align: inherit;">informasi yang berguna </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lulz</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat ini, di abad perkembangan pesat energi alternatif, sistem catu daya tak terputus yang diproduksi secara industri yang terjangkau untuk rumah, dikombinasikan dengan pembangkit listrik tenaga surya atau angin, telah mulai muncul. Yang paling canggih di antara mereka menggunakan baterai lithium-ion dengan tumpukan "penambah" elektronik yang efektif dari keseluruhan sistem.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kasus saya, tidak ada pembicaraan tentang pembangkit listrik mini karena alasan obyektif, dan hanya sumber cadangan, yang dapat diperbarui dari outlet biasa selama â€œpencerahanâ€, yang menarik. Oleh karena itu, diputuskan untuk mengumpulkan semua barang elektronik UPS apartemen secara mandiri. Dan karena tangan saya benar-benar terlepas, hal pertama yang perlu diputuskan adalah jenis baterai yang digunakan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada awalnya, saya berpikir seperti ini: "Mengapa tidak lithium? </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pemuda trendi yang trendi</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Disegel, hemat energi, tahan lama. " Tetapi ketika saya melihat harga, semangat lithium saya terasa mereda. Pencarian cepat dalam kombinasi dengan aritmatika sekolah menunjukkan bahwa bahkan bank "26650" Cina yang sangat "bodoh" dengan (tentu saja) 5.000 mAH yang paling jujur â€‹â€‹akan berharga lima kali lebih banyak daripada baterai asam dengan intensitas energi yang sama. Dan jika Anda memilih sesuatu yang bukan dari bawah harga yang diurutkan berdasarkan harga, perbedaannya dengan mudah mencapai 8-10 kali. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan bagaimana Anda bisa menebus perbedaan yang begitu besar dalam nilai? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya, lithium menyimpan energi lebih efisien untuk setiap kilogram dan meter kubik, dan baterai seukuran balok rokok dengan mudah mencurahkan baterai timbal-asam sepuluh kilogram. Tetapi apakah fakta ini sangat penting untuk penggunaan alat tulis?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentu saja, "lithium" yang bagus, tetapi dengan pendekatan yang tepat akan bertahan lebih lama. </font><font style="vertical-align: inherit;">Tapi sepuluh kali?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Pada saat yang sama, di sisi lain dari skala, potensi ledakan baterai yang tidak diketahui asalnya, algoritma pengisian yang lebih kompleks, masalah dengan pembuangan (di mana setiap orang tunawisma tahu cara menggunakan baterai timah, sedangkan lithium jauh lebih rumit). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Singkatnya, dengan jumlah faktor, saya memutuskan untuk menunda ide lithium sampai iterasi berikutnya. Mungkin dalam beberapa tahun sesuatu akan berubah, tetapi untuk sekarang, memimpin adalah segalanya bagi kita.</font></font><br>
<br>
<blockquote>,      ,        .    ,    ,           ,           .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adapun baterai timbal, ada juga beberapa opsi. Pilihan "benar" adalah baterai cadangan khusus, yang digunakan dalam UPS, di stasiun pangkalan komunikasi seluler, dan tempat-tempat serupa lainnya di mana mereka diharuskan untuk dapat mengambil dan mengirimkan arus besar, kadang-kadang mengalami pelepasan yang kuat, dan memang bekerja tanpa mengganggu orang. untuk layanan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pilihan "benar" lainnya adalah baterai traksi untuk pemuat-otomatis listrik atau, apa-apaan, kapal selam diesel. Baterai ini memiliki daya tahan tinggi dan toleransi yang baik terhadap pelepasan yang dalam, sementara tidak menghilangkan kesempatan dari pemilik untuk "mengisi air."</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nah, opsi "salah" adalah baterai starter dari bengkel mobil terdekat. Baterai seperti itu dapat secara singkat memberikan daya hingga satu kilowatt ke gunung, tetapi pelepasan apa pun sangat menyusahkannya, seperti bekerja untuk orang yang malas. Dan kemuliaan baterai sekali pakai umumnya tertanam dalam baterai kalsium modern: "habis - ganti."</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baiklah, kalau begitu, saya harap tidak ada yang meragukan pilihan mana yang akhirnya saya pilih untuk implementasi? Benar, ketiga. Dan alasan di sini tidak hanya terletak pada amfibi berkutil yang terkenal, tetapi juga dalam perhitungan pragmatis sederhana. Baterai starter beberapa kali lebih murah daripada semua opsi lain, terkadang mendekati nilai lithium. Dan alih-alih mengguncang baterai yang mahal, Anda merasa jauh lebih bebas dalam situasi ketidakpedulian yang sehat, ketika penggantian menghasilkan kerugian dalam jumlah yang dibutuhkan untuk makanan selama beberapa minggu. Selain itu, jika Anda tidak membiarkan baterai ini habis sebelum kehilangan denyut nadi, maka masa pakai mereka dalam peran cadangan dihitung selama bertahun-tahun. Anda selalu dapat menempatkan baterai dengan kapasitas lebih besar, mengatur batas debit lebih lembut, dan masih mendapatkan rasio harga / kapasitas yang lebih baik daripada baterai "benar",menderita keputihan yang dalam.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hal utama dalam hal ini adalah menyediakan ventilasi setidaknya pada tingkat "lubang di dinding" di tempat pemasangan baterai. </font><font style="vertical-align: inherit;">Nah, atur perlindungan dangkal terhadap arus pendek, karena tegangan rendah dari sumber arus menumpulkan kewaspadaan dan semuanya bisa berakhir sangat buruk.</font></font><br>
<br>
<h3><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perang saat ini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> di satu apartemen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah beberapa jaminan moral yang disebabkan oleh keputusan akhir tentang jenis baterai, alasan baru segera muncul untuk berpikir dengan hati-hati. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Biarkan saya mengingatkan Anda bahwa pada awalnya saya ingin mendapatkan generator arus bolak-balik untuk 230 V. Namun, setelah berdamai dengan realitas objektif dan secara mental beralih ke baterai, inersia pemikiran telah membawa saya ke pasar online Cina yang terkenal untuk memilih konverter DC ke AC yang sesuai. Dan dalam proses mempelajari karakteristik, istilah "gelombang sinus yang dimodifikasi", yang dilupakan, pertama kali muncul, dan kemudian akal sehat mulai mengajukan pertanyaan tidak nyaman.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inti pertanyaan adalah sebagai berikut. Untuk menutupi semua kebutuhan energi apartemen dengan baterai kecil masih tidak akan berfungsi. Boiler, microwave, mesin cuci, komputer desktop yang kuat akan tetap tak tertahankan daya. Dan kulkas, kap mesin, dan bahkan kipas dangkal tidak akan dapat berfungsi dengan baik karena gelombang sinus yang sangat dimodifikasi ini. Tentu saja, ada inverter dengan gelombang sinus yang sebenarnya, tetapi mereka tidak hanya lebih mahal, tetapi juga kurang efisien. Dan masalah konsumen yang kuat masih belum terselesaikan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konsumen apa yang tetap dalam anggaran? Tidak begitu banyak dari mereka: elektronik konsumen seperti laptop dan telepon / tablet, router, server ARM, mood adalah TV, dan, tentu saja, pencahayaan. Selain itu, pesan awal artikel (dan motivasi pribadi saya) justru untuk memastikan fungsi workstation cadangan dalam bentuk laptop dan kenyamanan rumah tangga minimal, seperti lampu di toilet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hampir semua perangkat ini memerlukan voltase konstan dari 5 hingga 21 V untuk operasinya dan tidak perlu obyektif untuk pertama-tama meningkatkan voltase baterai menjadi 230 V AC, kemudian untuk menurunkan dan meluruskannya lagi untuk menambah atau mengurangi level awal. Pada transformasi ini, mudah untuk kehilangan hingga 50% energi, yang saya tidak tersenyum sama sekali.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Singkatnya, itulah ide yang mulus untuk menggunakan jaringan arus searah bertegangan rendah sebagai alternatif. </font><font style="vertical-align: inherit;">Dan setelah perhitungan perkiraan kerugian di kabel, awal 12 (13,8) V berubah menjadi lebih praktis 24 (27,6) V.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pada awalnya saya ingin mengambil bahkan 36 (41,4) B, tetapi setelah mempelajari karakteristik beberapa komponen elektronik yang saya rencanakan untuk digunakan untuk bekerja dengan semua ekonomi ini, saya harus mengurangi nafsu makan saya.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, dalam perkawatan alternatif dengan penampang 3,5 mm </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tembaga murni, tegangan pada akhirnya diterapkan dari dua aki mobil yang dihubungkan secara seri.</font></font><br>
<br>
<blockquote>,        .           (   )   .                ,      .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk memungkinkan konsumen di dalam kamar, satu outlet lagi ditambahkan ke setiap blok outlet "besar". Dan agar tidak ada yang mengacaukan outlet biasa dengan yang cadangan, produk tipe "Amerika" dengan kontak datar dengan lebar berbeda dipasang sebagai yang terakhir. Ini, pertama, tidak akan memungkinkan penyedot debu terhubung ke jaringan DC, dan kedua, outlet seperti itu, tidak seperti yang Eropa, selalu menggunakan polaritas yang sama ketika menggunakan steker "benar".</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/bl/sm/th/blsmthnmtxqcekbdftv8dfg3u2a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk outlet ini dibuat adaptor laptop, menurunkan tegangan ke 18-20 V yang diinginkan dan dilengkapi dengan konektor yang sesuai. </font><font style="vertical-align: inherit;">Jelaslah bahwa tumit dibuat dari muatan USB lima volt yang biasa untuk setiap hal kecil. </font><font style="vertical-align: inherit;">Nah, untuk berjaga-jaga, sepasang konverter 24/230 V kecil dibeli, dengan daya 50 dan 200 watt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kasing untuk pengisian daya dengan colokan Amerika, kabel daya yang sama, dan papan konverter pulsa turun siap dipesan dari Cina. </font><font style="vertical-align: inherit;">Sebuah besi solder dibutuhkan hanya untuk menghubungkan kabel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya tidak akan berbicara tentang pembangkit listrik dalam artikel ini, terutama karena tidak ada yang menarik di dalamnya, jadi saya akan langsung menuju ke salah satu masalah "bawah", yaitu masalah pemanfaatan energi yang diakumulasikan oleh baterai untuk keperluan penerangan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Petir</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, ketika kabel apartemen secara paralel dengan kabel utama, kabel dari jaringan DC alternatif dengan tegangan 24 (27,6) V ditarik.Di antara lain, sebuah loop yang terdiri dari sepasang kabel tersebut terpotong ke setiap kotak saklar dan kemudian bersama-sama dengan kabel jaringan 230 V mengarah ke lampu langit-langit (jika ada beberapa di dalam ruangan, maka kawat alternatif hanya mengarah satu).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang harus dilakukan dengan output dari jaringan DC di bidang lampu adalah masalah pendekatan individual. Sebagai sumber cahaya, strip LED 24 volt biasa dipilih. Segmen dengan panjang yang berbeda (sebanding dengan luas ruangan), tergantung pada desain perlengkapan, baik dipasang langsung di rumah mereka atau terpaku pada permukaan yang darinya akan bersinar dengan baik, dan dari tempat itu tidak akan sangat mencolok. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagaimanapun, ini lebih estetika daripada masalah teknis, dan sekarang ini adalah sesuatu yang lain. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, dalam kotak masing-masing sakelar, saya memiliki lilitan kawat fase dari jaringan 230 V untuk menyalakan lampu "biasa", dan lilitan kedua kabel jaringan DC untuk penerangan darurat. Dari sini dan menari.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada akhirnya, tantangan di depan saya adalah menciptakan perangkat tertentu yang dapat memisahkan tiga status dari satu sama lain:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listrik AC OK â†’ matikan lampu darurat.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jaringan AC tidak aktif, kontak sakelar ditutup â†’ nyalakan lampu darurat. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jaringan AC tidak aktif, kontak sakelar terbuka â†’ matikan lampu darurat.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menganggap tindakan itu satu sisi, yaitu, misalnya mematikan lampu yang sudah dimatikan tidak akan mengubah apa pun. </font><font style="vertical-align: inherit;">Status ini dapat dibedakan satu sama lain jika tugas menentukan operasi jaringan AC dan posisi kontak sakelar terpecahkan. </font><font style="vertical-align: inherit;">Pada saat yang sama, saya memiliki kondisi awal berikut:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manajemen pencahayaan utama dan darurat harus benar-benar transparan dari satu badan pengelola, tidak ada â€œkebun kolektifâ€ dari tombol tambahan.</font></font></li>
<li> ,  ,   ,        .</li>
<li>      ,        .</li>
<li>      â€“    ,  .</li>
<li>-        .</li>
<li>        (    ),  .</li>
<li>      .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentu saja, tidak adanya listrik AC di kotak nol ternyata menjadi salah perhitungan desain yang sangat rumit. </font><font style="vertical-align: inherit;">Tanpanya, penentuan keberadaan tegangan pada input sakelar menjadi tidak mungkin. </font><font style="vertical-align: inherit;">Secara teknis, dimungkinkan untuk menggunakan kabel negatif dari jaringan arus searah sebagai nol, tetapi ini bertentangan dengan paragraf 5 yang sama sekali tidak dapat dihancurkan dari ketentuan referensi saya.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensor</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun demikian, alternatif untuk mengukur tegangan listrik ada. Tidak perlu bagi saya untuk menentukan keberadaan tegangan, itu cukup untuk menentukan keberadaan arus dalam kawat fase dengan kontak saklar ditutup. Lagi pula, jika ada arus, maka ada tegangan. Selain itu, "pembacaan" dari arus yang tepat memungkinkan penerangan darurat diaktifkan tidak hanya jika terjadi kegagalan daya, tetapi juga jika terjadi pemadaman bola lampu dangkal. Metode ini tidak memungkinkan untuk menentukan keadaan jaringan AC ketika saklar dimatikan, tetapi keadaan ini tidak mengganggu saya, karena setelah sakelar dimatikan, penerangan darurat juga tidak akan berfungsi.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengetahui keberadaan arus dalam kawat cukup sederhana, terutama jika arus ini bolak-balik. </font><font style="vertical-align: inherit;">Di sini Anda dapat menerapkan, misalnya, sensor Hall yang mendeteksi medan magnet di sekitar kawat. </font><font style="vertical-align: inherit;">Tapi Anda bisa bertahan dengan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trafo arus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> biasa </font><font style="vertical-align: inherit;">, yang terdiri dari sirkuit magnetik cincin dengan belitan. </font><font style="vertical-align: inherit;">Kawat arus bolak-balik dilewatkan melalui cincin, yang menciptakan medan magnet dalam sirkuit magnetik. </font><font style="vertical-align: inherit;">Bidang ini pada gilirannya menginduksi arus sekunder pada belitan, sebanding dengan arus primer pada kawat. </font><font style="vertical-align: inherit;">Dengan demikian, perangkat sederhana ini memungkinkan Anda untuk mengukur kekuatan arus bolak-balik pada kabel apa pun, tanpa memutusnya dan umumnya tanpa koneksi galvanik dengan sirkuit utama.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pekerjaan klem saat ini, alat yang sangat berguna bagi teknisi listrik, didasarkan pada prinsip yang sama.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika ada trafo di dekat sakelar, cukup untuk mengukur tegangan pada belitan sekundernya untuk mengetahui apakah ada arus yang mengalir dalam rangkaian lampu. Kehadiran arus, seperti yang saya katakan, dalam perkiraan pertama menunjukkan dua fakta: ada tegangan di jaringan 230 V, dan saklar ditutup. Yang pertama dari fakta ini sangat penting untuk pengoperasian perangkat aktivasi pencahayaan darurat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Parameter input" kedua dari perangkat saya yang akan datang harus menjadi posisi kontak sakelar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Brainstorming" yang diprakarsai di antara rekan-rekan hobi membawa berbagai opsi untuk menentukan posisi sakelar, yang dirubah terutama untuk memodifikasi desain untuk menambah pasangan kontak ke dalamnya. Di sini ruang lingkup imajinasi cukup besar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dimungkinkan untuk mengambil saklar ganda alih-alih sakelar tunggal dan secara mekanis "menyejajarkan" bagiannya sehingga mereka menjadi satu kesatuan tunggal. Pilihan ini tidak berbeda dalam estetika eksternal dan tidak memecahkan masalah di ruangan-ruangan di mana pencahayaannya adalah sirkuit ganda dan saklar awalnya ganda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pilihan lain melibatkan pengenalan sakelar mikro atau sakelar buluh dengan magnet di mekanisme sakelar. Tetapi setelah mempelajari desain dari pemutus sirkuit yang diterapkan, opsi ini juga menghilang. Basis keramik monolitik dari sakelar yang baik tidak meninggalkan peluang bahkan untuk microswitch yang ringkas, dan sakelar magnet dan buluh tidak bekerja karena terlalu sedikit perjalanan kunci dan histeresis dalam kurva operasi / pelepasan sakelar buluh.</font></font><br>
<br>
<blockquote> Â«Â»        ,     . , ,       ,  .  ,   ,    ,               .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Singkatnya, itu perlu untuk datang dengan suatu metode yang tidak akan memerlukan modifikasi dari saklar. Dan metode ini ditemukan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di atas, saya menggambarkan transformator arus, yang memungkinkan Anda untuk menentukan keberadaan arus bolak-balik dalam kawat tanpa pecah dan kontak galvanik. Tetapi setiap transformator adalah perangkat dua arah (berbeda dengan sensor Hall yang sama), belitan primer dan sekundernya dapat dipertukarkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika kita menerapkan arus bolak-balik ke belitan sekunder dari transformator seperti itu, itu menginduksi tegangan pada ujung kawat yang diulir ke ring. Dan, yang paling penting, energi yang dikonsumsi oleh belitan dari sumber akan tergantung pada apakah arus sekunder di kawat menemukan jalannya untuk gerakan memutar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan di sini menjadi lebih menarik. </font><font style="vertical-align: inherit;">Sebuah kawat melewati cincin, yang segera, dalam beberapa sentimeter, terhubung ke salah satu kontak sakelar. </font><font style="vertical-align: inherit;">Tetap hanya untuk memberikan arus ini dengan jalur balik dari sisi lain saklar untuk mendapatkan perangkat untuk "merasakan" posisi kontak. </font><font style="vertical-align: inherit;">Dan untuk alasan bahwa arus ini bolak-balik, kapasitor konvensional dapat menjadi jembatan untuk itu.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gs/tr/g1/gstrg12mwdwhgu0qmbnl3twrfjc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada prinsipnya, untuk menutup rangkaian ini dalam kondisi tertentu, kapasitor tidak diperlukan. </font><font style="vertical-align: inherit;">Jika arus dengan frekuensi yang cukup tinggi â€œdipompaâ€ ke transformator, maka kapasitansi yang tersesat di antara kabel akan cukup untuk melintas.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/up/yp/ws/upypwscprb9xjbrlaye26xfkry8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, apa yang diperlukan untuk mengatur detektor seperti itu:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trafo arus.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meter tegangan output transformator.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sumber arus bolak-balik frekuensi tinggi.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meteran arus mengalir melalui belitan transformator terbalik.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yang paling sulit dalam hal memilih parameter optimal adalah transformator, yang dalam mode transformator saat ini harus memberikan tegangan yang dapat diterima dengan frekuensi 50 Hz, dan dalam mode â€œsensingâ€ aktif dari keadaan pemutus sirkuit, memiliki koefisien transmisi yang dapat diterima pada frekuensi ratusan KHz. </font><font style="vertical-align: inherit;">Elemen ini tidak mungkin untuk disimulasikan dalam program untuk memodelkan sirkuit elektronik, dan bahkan dengan perhitungan matematis, semuanya ternyata sangat sulit. </font><font style="vertical-align: inherit;">Saya harus mengambil besi solder di tangan saya dan menghabiskan waktu berjam-jam mengendarai berbagai pilihan untuk mencari yang terbaik. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jumlah belokan dan tahanan beban optimal dipilih secara empiris dan bukan fakta bahwa saya tidak melewatkan rasio terbaik. </font><font style="vertical-align: inherit;">Sebagai hasil dari percobaan, konstruksi berikut ini muncul:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inti ferit dengan permeabilitas 10.000, ukuran 10x6x4 mm.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Berliku 30 putaran dengan kawat enamel 0,25 mm.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beban aktif belitan adalah 1 kOhm.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Permeabilitas magnetiknya cukup besar, mungkin, masuk akal untuk menggunakan cincin untuk 5000 atau bahkan 2000 unit, tetapi dalam jumlah yang cukup saya memiliki cincin ini. </font><font style="vertical-align: inherit;">Secara umum, permeabilitas dalam hal ini adalah nilai kompromi. </font><font style="vertical-align: inherit;">Terlalu rendah membuat trafo tidak cocok untuk operasi pada frekuensi 50 Hz, dan terlalu tinggi merusak semuanya pada frekuensi di atas ratusan kilohertz. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berbagai percobaan mengukuhkan kenyataan gagasan itu dan hasil-hasil berikut diperoleh:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam mode transformator arus, koefisien transmisi ternyata sekitar satu milivolt per watt daya yang mengalir (tegangan 220-230 V).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam mode probe, tergantung pada frekuensi dan kapasitansi kebocoran, perbedaan arus dengan kontak tertutup dan terbuka dari saklar mencapai dua hingga tiga kali.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu saja. </font><font style="vertical-align: inherit;">Kedua nilai lebih dari cukup untuk fiksasi yang andal dari arus yang mengalir, dan untuk menentukan posisi kontak sakelar. </font><font style="vertical-align: inherit;">Hanya terserah implementasi spesifik.</font></font><br>
<br>
<a name="Solution"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam besi</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berbeda dengan sebagian besar desain lainnya, di sini sudah dalam tahap awal musyawarah, diputuskan untuk segera menggunakan mikrokontroler. </font><font style="vertical-align: inherit;">Berdasarkan kebutuhan dan pengalaman, pilihan jatuh pada ATtiny13A. </font><font style="vertical-align: inherit;">Chip ini memiliki ADC, dan dengan kemampuan untuk menggunakan sumber referensi internal 1,1 V, bukan tegangan suplai. </font><font style="vertical-align: inherit;">Ada PWM yang bagus untuk menghasilkan sinyal yang terdengar. </font><font style="vertical-align: inherit;">Dan, yang kemudian ternyata penting, ada EEPROM yang memungkinkan Anda untuk menyimpan data kalibrasi.</font></font><br>
<br>
<blockquote>,          Â«  ,       ,       - Â«Â» ,  Â».<br>
<br>
      .         .           .   ,   ,  ,         .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini Anda perlu menggabungkan setidaknya generator, meter tegangan, dan beberapa jenis pemicu untuk menyimpan keadaan saat ini di antara pengukuran. Secara umum, setiap sketsa spekulatif membutuhkan setidaknya tiga kasus hanya pada "inti", dan pengontrol ternyata jauh lebih praktis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tegangan dari trafo arus dengan beban 10-20 W adalah 10-20 mV dan terlalu kecil untuk memasok ke input DAC dengan batas bahkan 1,1 V. Oleh karena itu, selain pengontrol, Anda juga memerlukan amplifier dengan koefisien transfer sekitar 100 untuk meningkatkan minimum tegangan sinyal hingga ratusan milivolt.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secara umum, tegangan sinyal keluaran transformator arus tidak hanya bergantung pada daya beban, tetapi juga pada sifatnya. </font><font style="vertical-align: inherit;">Muatan aktif murni seperti bola Ilyich, misalnya, memberikan gelombang sinus level millivolt. </font><font style="vertical-align: inherit;">Bohlam LED dengan daya yang sama dengan daya pulsa sederhana memberikan ledakan singkat ke volt dan di atasnya. </font><font style="vertical-align: inherit;">Kita dapat memainkan ini, tetapi, pertama, saya ingin membuat perangkat universal, dan kedua, di apartemen ada satu lampu dengan unit catu daya eksternal yang dilengkapi dengan sirkuit PFC (yaitu, memiliki karakteristik konsumsi yang dekat dengan aktif).</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya tidak akan menyiksa pembaca dengan opsi perantara dan segera memberikan diagram terakhir perangkat.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/vd/at/a-/vdata-spt78rd_pzv7s5awoobya.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini tegangan DC melalui regulator linier ekonomis LM2931-5.0 memberi makan controller. Dalam hal perumahan, fungsionalitas, dan pinout, stabilizer ini mirip dengan 78L05 yang populer, tetapi berbeda dari itu dalam konsumsi intrinsik yang lebih rendah (sekitar 500 Î¼A pada beban 10 mA) dan toleransi yang lebih besar terhadap ledakan tegangan input yang pendek. Jika Anda berencana untuk bekerja dengan tegangan tidak lebih dari 20 V, Anda dapat menggunakan analog LP2950-5.0 yang lebih ekonomis.</font></font><br>
<br>
<blockquote>   LP2950-5.0        30 .      24      .    -      ,     ,       ,     ,   .          50%,   100%.</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trafo tidak ditampilkan dalam diagram, tetapi belitannya terhubung ke pin TR1 dan TR2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai elemen kunci untuk mengalihkan beban, digunakan transistor MOS saluran-rendah 2SJ196 P-channel saat ini (arus hingga 1 A harus mencukupi untuk lampu LED), tetapi yang lainnya cocok untuk pinout, arus maksimum, dan tegangan tiriskan maksimum dapat digunakan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain pengontrol dan kunci dari elemen aktif, dua transistor digunakan. Satu diperlukan untuk mengontrol rana tombol, beroperasi di bawah tegangan sumber darurat. Yang kedua bertindak sebagai sinyal penguat dari output transformator saat ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada titik ini, Anda dapat menggunakan op-amp, tetapi dalam hal detail, keuntungannya minimal, dan Anda harus melupakan bekerja pada frekuensi di atas beberapa ratus kilohertz.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini bukan sinyal yang diperkuat dari transformator itu sendiri yang diumpankan ke ADC, tetapi amplopnya, yang dapat diukur dengan sampel tunggal, dan bukan dengan digitalisasi "streaming" untuk beberapa waktu. Untuk mengisolasi amplop, dua dioda Schottky digunakan, dihubungkan sesuai dengan rangkaian penggandaan tegangan. Inklusi semacam itu membentuk detektor amplitudo klasik, di mana penurunan tegangan melintasi dioda sendiri sebagian besar dikompensasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prinsip pengoperasian sensor sederhana. Pertama, pertimbangkan algoritma tindakan yang diperlukan untuk mengukur arus di kawat.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam mode pengukuran saat ini, pin PB0 dimasukkan ke mode output dan didasarkan oleh logika nol. Ini mencegah setiap sinyal dari pengontrol dikirim ke titik TR1. Secara paralel, tindakan yang sama dilakukan pada pin PB3, sebagai akibatnya output atas kapasitor C2 di-ground. Kapasitor ini bersama dengan resistor R1 menciptakan filter low-pass dengan frekuensi cutoff sekitar 1500 Hz. Berkat filter ini, peran berbagai noise frekuensi tinggi dalam pembentukan sinyal yang diukur sangat berkurang. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemudian level tinggi diterapkan pada PB4 untuk memberi daya pada penguat sinyal. Setelah penyelesaian transien, arus 50 Hz dari output transformator diperkuat dan sampai ke penyearah, di mana ia mengisi kapasitor C8.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muatan kapasitor C8 diukur menggunakan ADC1 dan dari nilai tegangan yang diperoleh, ditarik kesimpulan tentang arus "primer" yang mengalir melalui transformator. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penginderaan aktif dilakukan secara berbeda. Pertama, pin PB0 diterjemahkan ke dalam solver PWM, dan sebuah sinyal diumpankan dengan frekuensi dari ratusan kilohertz ke unit megahertz. Sinyal ini agak dilemahkan oleh pembagi resistif dan diumpankan ke belitan transformator arus pada titik TR1. Kapasitor C1, bersama dengan satu lengan atas pembagi R4, menciptakan filter low-pass dengan frekuensi cutoff sekitar 1,5 MHz, yang mengurangi tingkat harmonik frekuensi tinggi dari pulsa persegi panjang.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah melewati belitan transformator, sinyal probe dari titik TR2 sampai ke amplifier dan detektor yang sama, juga pada akhirnya mengisi kapasitor C8 ke tegangan yang sebanding dengan beban dalam sirkuit "eksternal" transformator. Dengan cara yang sama, muatan kapasitor diukur menggunakan ADC mikrokontroler. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang penjelasan untuk beberapa "longgar". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resistor R5 dirancang untuk membatasi tegangan di gerbang sakelar daya, yang untuk MOSFET tegangan rendah biasanya tidak boleh melebihi 20 V. Dalam kasus saya, jaringan DC memiliki tegangan hingga 30 V, yang menentukan kebutuhan akan pembagi 1: 3, yang diperoleh bersamaan dengan R3. Ketika diberdayakan dari sumber kurang dari 20 V, resistor R5 tidak diperlukan (diganti dengan jumper).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kapasitor C4 dan C5 dihubungkan secara paralel untuk mencapai kapasitansi 2 Î¼F. Pasangan kapasitor ini patut diperhatikan karena harus mengirimkan sinyal baik frekuensi rendah dan tinggi dengan baik. Di sini dimungkinkan untuk menggunakan koneksi paralel kapasitor elektrolitik beberapa mikrofarad dan keramik seratus atau dua nanofarad, tetapi "elektrolit" dengan kapasitas sekecil itu tidak memberikan kenaikan ukuran jika dibandingkan dengan "keramik" mikrofarad. Benar, itu tidak mungkin untuk membeli kapasitor keramik di 2 mikrofarad, jadi saya menempatkan mereka berdua sama.</font></font><br>
<br>
<blockquote>,   50     2  ,      .   ,        .               .    100   , ,   .       .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resistor R4 dan R1 membentuk pembagi tegangan, yang kurang lebih menyamakan tegangan lima volt pada output PWM dengan tegangan output dari transformator arus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kapasitor C8, seperti yang disebutkan sebelumnya, mengakumulasi tegangan yang akan diukur. Lebih baik jika itu adalah kapasitor berkualitas tinggi dengan arus bocor minimum. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penyebutan khusus layak mendapatkan "sisir" dua pin TP1 / TP2 yang terhubung ke kaki reset mikrokontroler. Kontak ini digunakan tidak hanya untuk reboot, tetapi untuk masuk ke mode kalibrasi, yang dijelaskan di bawah ini. Sederhananya, setelah implementasi semua Wishlist, controller tidak lagi memiliki pin gratis, dan kebutuhan untuk menambahkan satu kontrol sederhana muncul selama debugging firmware. Jadi saya harus menggunakan kaki pengontrol reset untuk tujuan ini.</font></font><br>
<br>
<blockquote> Â«Â»  AVR     RESET       GPIO.         ,       .         ,        .   ,        ,      ,      ,            RESET.</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara umum, rangkaian ternyata cukup sederhana, dan semua "sihir" diimplementasikan dalam firmware mikrokontroler. Namun, setelah pembuatan prototipe, ternyata kapasitansi kabel untuk operasi "probe" yang andal seringkali tidak cukup. Perbedaan arus melalui transformator ternyata sebanding dengan tingkat gangguan dan operasi rangkaian menjadi tidak dapat diandalkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oleh karena itu, saya harus meninggalkan cincin ferit yang tergantung bebas di kabel, dan menambahkan sirkuit tegangan tinggi langsung ke papan dalam revisi perangkat yang baru, untuk memudahkan tugas penyelidikan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intinya di sini adalah menambahkan kapasitor khusus, dihidupkan sehingga cara terpendek untuk menutup jalur ke arus RF melalui kontak saklar.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/i-/_f/63/i-_f636miltufzwifkx4xaxnab0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kapasitor C10 harus dirancang untuk tegangan setidaknya kilovolt, dan kapasitansinya harus dipilih sesuai dengan prinsip kompromi sehingga keandalan operasi cukup untuk penggunaan praktis, dan bahwa arus kapasitif liar melalui lampu tidak terlalu besar. </font><font style="vertical-align: inherit;">Dalam praktiknya, Anda dapat mencoba "bermain-main" dengan denominasi ini, jika perlu.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimanapun, sebuah saklar yang dilengkapi dengan sensor semacam itu tidak lagi dapat dianggap ideal. </font><font style="vertical-align: inherit;">Sebaliknya, ini mirip dengan sakelar dengan indikator, oleh karena itu, pertama, ia dapat menyebabkan cahaya nyasar atau kedipan lampu LED berkualitas rendah, dan kedua, dapat menyebabkan sengatan listrik, meskipun bukan yang kuat. </font><font style="vertical-align: inherit;">Karena itu, Anda tidak perlu bekerja dengan kabel penerangan, hanya mengandalkan sakelar di dinding, selalu matikan "sakelar" di pintu masuk.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan, karena saya masih harus menambahkan bagian dari jaringan AC ke board, saya menambahkan dua choke shut-off di sana, yang tidak akan membiarkan arus probing frekuensi tinggi masuk ke kabel. Nilai praktis dari frekuensi tegangan probing dapat mencapai beberapa MHz dan saya, sebagai amatir radio, sangat muak dengan gagasan untuk meningkatkan jumlah gangguan dalam jaringan dengan tangan saya sendiri. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tersedak L1 dan L2 harus kekuatan, luka dengan kawat dari ketebalan terlihat pada halter atau inti tipe cincin. Sinyal tersedak dalam desain aksial "resistor" tidak dapat digunakan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Giliran utama transformator saat ini adalah seutas kawat yang diulir melalui cincin dan disolder ke titik TR3 dan TR4 di papan tulis. Lebih baik jika kabel ini dilindungi, saat menghubungkan layar ke TR5 dan TR6 di kedua sisi cincin.</font></font><br>
<br>
<blockquote> TR6       ,   .    -   ,           .          ,          .</blockquote><br>
<h3></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode firmware dan file HEX yang dirakit terpasang pada akhir artikel bersama dengan sirkuit dan tata letak papan sirkuit yang dicetak. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algoritma pendeteksi yang disetel sederhana. Sekali setiap tiga detik, pengontrol bangun dari tidur nyenyak, melakukan pengukuran, dan, jika perlu, mengubah status tombol kontrol dalam satu arah atau lainnya. Jadi, reaksi terhadap perubahan posisi sakelar mungkin memiliki penundaan hingga tiga detik. Tidak terlalu nyaman, tetapi ini dilakukan, pertama, untuk menghemat energi dari sumber cadangan, dan kedua, untuk secara signifikan mengurangi interval pemungutan suara tidak memungkinkan durasi transien pada berbagai tahap pengukuran. Interval minimum dapat dianggap sama dengan satu detik, tetapi kemudian rangkaian akan berada dalam mode konsumsi aktif hampir sepanjang waktu.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kesimpulannya, tentang konfigurasi. Karena fakta bahwa sensor yang berbeda harus bekerja dalam kondisi yang sama sekali berbeda sesuai dengan arus yang dikonsumsi oleh lampu, panjang dan fitur pengkabelan lainnya, tingkat interferensi, dan sejenisnya, tidak mungkin untuk menempatkan satu set universal parameter adaptif ke dalam firmware. Oleh karena itu, setiap sensor setelah pemasangan memerlukan kalibrasi tunggal di lokasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sensor memasuki mode kalibrasi setiap kali dihidupkan, sementara tidak ada data kalibrasi, atau setelah menutup kontak TP1 dan TP2. Memasuki tahap pertama kalibrasi ditandai dengan lampu darurat berkedip lima kali.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah berkedip lima kali, diberikan 7,5 detik untuk mengatur sakelar ke posisi "mati", jika dihidupkan sebelumnya. Setelah waktu ini, tingkat gangguan selalu hadir dalam jaringan AC diukur. Nilai yang diperoleh digunakan sebagai titik awal untuk pengukuran dalam siklus tugas. Juga pada saat ini, pemutus sirkuit dirasakan pada frekuensi yang berbeda untuk pemilihan berikutnya dari frekuensi paling "kontras".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, tahap kalibrasi kedua dimulai dan lampu darurat berkedip dua kali. Waktu 7,5 detik diberikan untuk mengalihkan sakelar ke posisi "on" dan setelah batas waktu program mengukur arus yang dikonsumsi oleh lampu. Jika lampu memiliki beberapa tingkat kecerahan, maka setelah dinyalakan, Anda harus segera mengubahnya ke level minimum, sehingga di masa depan sensor akan bekerja dengan benar dengan salah satu level yang tersedia.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Awal dari tahap kalibrasi ketiga dan terakhir ditandai dengan tiga kali flashing dari lampu darurat dan mensyaratkan bahwa sakelar tetap dalam mode â€œonâ€, dan jaringan pencahayaan dihilangkan energi pada level yang lebih tinggi (yaitu, dengan pemutus arus utama atau sekunder pada panel) selambat-lambatnya melalui yang sama 7,5 detik Dalam hal ini, bunyi kedua dari pemutus sirkuit sudah dihidupkan pada frekuensi yang berbeda dilakukan dan dengan mempertimbangkan nilai-nilai yang diperoleh pada tahap pertama, frekuensi dipilih di mana perbedaan arus melalui sakelar yang dinyalakan dan dimatikan adalah maksimum. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penyelesaian kalibrasi yang berhasil diindikasikan dengan satu kedipan tunggal lampu darurat dan, jika jaringan penerangan setelah tahap ketiga masih tidak aktif, dengan menyalakan lampu darurat dalam siklus operasi pemungutan suara berikutnya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika nilai arus dan resistansi yang diukur dalam kondisi yang berbeda terlalu dekat dan tidak dapat digunakan untuk deteksi yang andal, kalibrasi gagal. </font><font style="vertical-align: inherit;">Dalam hal ini, lampu penerangan darurat berkedip dua kali ketika posisi sakelar tidak berhasil, atau tiga kali ketika konsumsi lampu penerangan standar terlalu rendah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam hal keengganan sensor untuk melakukan kalibrasi dengan double blink di final, Anda harus mencoba meningkatkan kapasitas C10.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perangkat ini ternyata cukup sederhana, cukup ringkas untuk dimuat dalam kotak saklar, tetapi tidak untuk mengatakan bahwa itu sangat mudah untuk dikonfigurasi. </font><font style="vertical-align: inherit;">Tentu saja, itu tidak mengacu pada komponen "rumah pintar" modern, karena tidak memiliki 5G, kontrol cloud, dan bahkan WiFi dangkal dengan GPS tidak disediakan. </font><font style="vertical-align: inherit;">Namun demikian, delapan perangkat ini menjalankan fungsi satu-satunya, dan tidak ada lagi yang diperlukan dari mereka dalam kondisi mati.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode sumber firmware (Atmel Studio 7)</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> F_CPU 9600000 <span class="hljs-comment">//   (  : avrdude.exe -U lfuse:w:0x7a:m -U hfuse:w:0xff:m)</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/io.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/wdt.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/sleep.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/interrupt.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;util/delay.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/eeprom.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-comment">//#define PROTEUS</span><font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> <span class="hljs-keyword">bool</span>; <span class="hljs-comment">//   </span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> true  (0 == 0)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> false (0 != 0)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_U10BIT 0b0000001111111111 <span class="hljs-comment">//      </span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> INTERVAL         3   <span class="hljs-comment">//  , </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CUR_MINIMAL_DIFF 50  <span class="hljs-comment">//      , LSB</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RES_MINIMAL_DIFF 50  <span class="hljs-comment">//      , LSB</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FREQ_DIV_OFFSET  2   <span class="hljs-comment">//     </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FREQ_MAXIMAL_DIV 6   <span class="hljs-comment">//     </span></span><font></font>
<font></font>
EEMEM <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>  EEPROM_cur_edge;<font></font>
EEMEM <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>  EEPROM_res_edge; <font></font>
EEMEM <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> EEPROM_frequency_dividor;<font></font>
<font></font>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> cur_edge, res_edge; <span class="hljs-comment">//   ,   EEPROM    </span>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> frequency_dividor; <span class="hljs-comment">//   ,   EEPROM    </span>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> clk = <span class="hljs-number">0</span>; <span class="hljs-comment">//   watchdog</span>
<span class="hljs-keyword">bool</span> tp_reset = <span class="hljs-literal">false</span>; <span class="hljs-comment">//   TP1  TP2</span><font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init_vars</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">if</span>(MCUSR &amp; (<span class="hljs-number">1</span> &lt;&lt; EXTRF)) { <span class="hljs-comment">// ,       TP1  TP2</span>
    tp_reset = <span class="hljs-literal">true</span>;<font></font>
    MCUSR &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; EXTRF); <span class="hljs-comment">//  EXTRF       ,   </span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init_pins</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  DDRB |= (<span class="hljs-number">1</span> &lt;&lt; PB0) | (<span class="hljs-number">1</span> &lt;&lt; PB1) | (<span class="hljs-number">1</span> &lt;&lt; PB2) | (<span class="hljs-number">1</span> &lt;&lt; PB4); <span class="hljs-comment">//       </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    watchdog</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init_interrupts</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  sleep_enable(); <span class="hljs-comment">//   </span><font></font>
<font></font>
  WDTCR = (<span class="hljs-number">1</span> &lt;&lt; WDCE) | (<span class="hljs-number">1</span> &lt;&lt; WDE); <span class="hljs-comment">//  watchdog</span>
  WDTCR = (<span class="hljs-number">1</span> &lt;&lt; WDTIE) | WDTO_1S; <span class="hljs-comment">// watchdog      ,  1 </span><font></font>
<font></font>
  sei(); <span class="hljs-comment">//  </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init_settings</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  cur_edge = eeprom_read_word(&amp;EEPROM_cur_edge); <span class="hljs-comment">//   </span>
  res_edge = eeprom_read_word(&amp;EEPROM_res_edge); <span class="hljs-comment">//   </span>
  frequency_dividor = eeprom_read_byte(&amp;EEPROM_frequency_dividor); <span class="hljs-comment">//   </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_load</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    PORTB |= (<span class="hljs-number">1</span> &lt;&lt; PB1);<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    PORTB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB1);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">blink_load</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> count)</span> </span>{
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> i = <span class="hljs-number">0</span>; i &lt; count; ++i) {<font></font>
    _delay_ms(<span class="hljs-number">200</span>);<font></font>
    toggle_load(<span class="hljs-literal">true</span>);<font></font>
    _delay_ms(<span class="hljs-number">200</span>);<font></font>
    toggle_load(<span class="hljs-literal">false</span>);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   (   )</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stop</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  set_sleep_mode(SLEEP_MODE_PWR_DOWN);<font></font>
  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) sleep_cpu();<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_amp</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    PORTB |= (<span class="hljs-number">1</span> &lt;&lt; PB4); <span class="hljs-comment">//     PB4</span>
    _delay_ms(<span class="hljs-number">250</span>);      <span class="hljs-comment">//       200 .</span>
  } <span class="hljs-keyword">else</span> {<font></font>
    PORTB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB4);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_lpf</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    DDRB |= (<span class="hljs-number">1</span> &lt;&lt; PB3); <span class="hljs-comment">//  PB3    (  "0")     C2</span>
  } <span class="hljs-keyword">else</span> {<font></font>
    DDRB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB3); <span class="hljs-comment">//  PB3    ( )   C2  </span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_gen</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    TCCR0A |= (<span class="hljs-number">1</span> &lt;&lt; COM0A0) | (<span class="hljs-number">1</span> &lt;&lt; WGM01); <span class="hljs-comment">//    ( )    OC0A      OCR0A</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> PROTEUS</span>
    TCCR0B |= (<span class="hljs-number">1</span> &lt;&lt; CS00); <span class="hljs-comment">//    1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
    TCCR0B |= (<span class="hljs-number">1</span> &lt;&lt; CS00) | (<span class="hljs-number">1</span> &lt;&lt; CS02); <span class="hljs-comment">//    1024</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
    OCR0A = FREQ_DIV_OFFSET + frequency_dividor; <span class="hljs-comment">//   ,         OC0A</span>
  } <span class="hljs-keyword">else</span> {<font></font>
    TCCR0A = <span class="hljs-number">0</span>; <span class="hljs-comment">//  </span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_adc</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    DDRB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB2); <span class="hljs-comment">//  PB2    ( )</span>
    ADMUX = <span class="hljs-number">0b01</span> | (<span class="hljs-number">1</span> &lt;&lt; REFS0); <span class="hljs-comment">// PB2, 1.1v reference</span>
    ADCSRA = (<span class="hljs-number">1</span> &lt;&lt; ADPS0) | (<span class="hljs-number">1</span> &lt;&lt; ADPS1) | (<span class="hljs-number">1</span> &lt;&lt; ADPS2) | <span class="hljs-comment">//       = 128 (75 )</span>
             (<span class="hljs-number">1</span> &lt;&lt; ADIE) |  <span class="hljs-comment">//    </span>
             (<span class="hljs-number">1</span> &lt;&lt; ADEN);   <span class="hljs-comment">//  </span>
  } <span class="hljs-keyword">else</span> {<font></font>
    ADCSRA = <span class="hljs-number">0</span>; <span class="hljs-comment">//  </span>
    DDRB |= (<span class="hljs-number">1</span> &lt;&lt; PB2); <span class="hljs-comment">//  PB2    (  "0")   C8</span>
    _delay_ms(<span class="hljs-number">50</span>); <span class="hljs-comment">//      C8</span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">do_adc</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  set_sleep_mode(SLEEP_MODE_ADC); <span class="hljs-comment">//   "" </span>
  <span class="hljs-keyword">do</span> {<font></font>
    sleep_cpu(); <span class="hljs-comment">//      ,      ,   </span>
  } <span class="hljs-keyword">while</span>(ADCSRA &amp; (<span class="hljs-number">1</span> &lt;&lt; ADSC)); <span class="hljs-comment">//        ,  </span><font></font>
<font></font>
  <span class="hljs-keyword">return</span> ADC;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/*
//  
static void blink_bin(unsigned int value, unsigned char count) {
  for(unsigned char i = 0; i &lt; count; ++i) {
    _delay_ms(1000);
    toggle_load(true);
    if(value &amp; (1 &lt;&lt; (count - i - 1))) {
      _delay_ms(500);
    } else {
      _delay_ms(50);
    }
    toggle_load(false);
  }
}
*/</span><font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get_current</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> cur;<font></font>
<font></font>
  toggle_lpf(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">150</span>);<font></font>
  toggle_adc(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">50</span>); <span class="hljs-comment">//    C8</span>
  cur = do_adc(); <span class="hljs-comment">//  </span>
  toggle_adc(<span class="hljs-literal">false</span>);<font></font>
  toggle_lpf(<span class="hljs-literal">false</span>);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> cur;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get_resistance</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> res;<font></font>
<font></font>
  toggle_gen(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">150</span>);<font></font>
  toggle_adc(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">50</span>); <span class="hljs-comment">//    C8</span>
  toggle_gen(<span class="hljs-literal">false</span>); <span class="hljs-comment">//   ,   C8     </span>
  res = do_adc(); <span class="hljs-comment">//     </span>
  toggle_adc(<span class="hljs-literal">false</span>);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> MAX_U10BIT - res; <span class="hljs-comment">//      ,      </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">is_current</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">return</span> (get_current() &gt;= cur_edge);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">is_toggled_on</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">return</span> (get_resistance() &lt;= res_edge);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">do_main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  toggle_amp(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span><font></font>
<font></font>
  <span class="hljs-keyword">if</span>(is_current()) {<font></font>
    toggle_load(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  ,  </span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">if</span>(is_toggled_on()) {<font></font>
      toggle_load(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  ,  </span>
    } <span class="hljs-keyword">else</span> {<font></font>
      toggle_load(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  ,  </span><font></font>
    }<font></font>
  }<font></font>
<font></font>
  toggle_amp(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">first_on</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">return</span> (frequency_dividor == <span class="hljs-number">0xff</span>); <span class="hljs-comment">//   EEPROM   0xFF,        FREQ_MAXIMAL_DIV</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">calibrate</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> cur_off, cur_on, res_off, res_on, res_on_tmp, res_off_array[FREQ_MAXIMAL_DIV + <span class="hljs-number">1</span>], diff, max_diff, frequency_dividor_tmp;<font></font>
<font></font>
  blink_load(<span class="hljs-number">5</span>); <span class="hljs-comment">//    ,    </span>
  _delay_ms(<span class="hljs-number">7500</span>); <span class="hljs-comment">//      </span><font></font>
<font></font>
  toggle_amp(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span><font></font>
<font></font>
  cur_off = get_current(); <span class="hljs-comment">//      ( )</span><font></font>
<font></font>
  <span class="hljs-comment">//      </span>
  <span class="hljs-keyword">for</span>(frequency_dividor = <span class="hljs-number">0</span>; frequency_dividor &lt;= FREQ_MAXIMAL_DIV; ++frequency_dividor) {<font></font>
    res_off_array[frequency_dividor] = get_resistance();<font></font>
  }<font></font>
<font></font>
  blink_load(<span class="hljs-number">2</span>); <span class="hljs-comment">//     </span>
  _delay_ms(<span class="hljs-number">7500</span>); <span class="hljs-comment">//      </span><font></font>
<font></font>
  cur_on = get_current(); <span class="hljs-comment">//     </span><font></font>
<font></font>
  blink_load(<span class="hljs-number">3</span>); <span class="hljs-comment">//     </span>
  _delay_ms(<span class="hljs-number">7500</span>); <span class="hljs-comment">//      </span><font></font>
<font></font>
  <font></font>
  res_off = MAX_U10BIT;<font></font>
  res_on = MAX_U10BIT;<font></font>
  frequency_dividor_tmp = <span class="hljs-number">0</span>;<font></font>
  max_diff = <span class="hljs-number">0</span>;
  <span class="hljs-comment">//      </span>
  <span class="hljs-keyword">for</span>(frequency_dividor = <span class="hljs-number">0</span>; frequency_dividor &lt;= FREQ_MAXIMAL_DIV; ++frequency_dividor) {<font></font>
    res_on_tmp = get_resistance();<font></font>
<font></font>
    <span class="hljs-comment">//   ,      </span>
    <span class="hljs-keyword">if</span>(res_off_array[frequency_dividor] &gt; res_on_tmp) {<font></font>
      diff = res_off_array[frequency_dividor] - res_on_tmp;<font></font>
      <span class="hljs-keyword">if</span>(diff &gt; max_diff) {<font></font>
        res_off = res_off_array[frequency_dividor];<font></font>
        res_on = res_on_tmp;<font></font>
        frequency_dividor_tmp = frequency_dividor;<font></font>
        max_diff = diff;<font></font>
      }    <font></font>
    }<font></font>
  }<font></font>
  frequency_dividor = frequency_dividor_tmp;<font></font>
<font></font>
  toggle_amp(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  </span><font></font>
  <font></font>
  <span class="hljs-keyword">if</span>(cur_on &gt; cur_off + CUR_MINIMAL_DIFF) { <font></font>
    cur_edge = cur_off + (cur_on - cur_off) / <span class="hljs-number">2</span>; <span class="hljs-comment">//    ,     </span><font></font>
 <font></font>
    <span class="hljs-keyword">if</span>(res_on + RES_MINIMAL_DIFF &lt; res_off) {<font></font>
      res_edge = res_off - (res_off - res_on) / <span class="hljs-number">2</span>; <span class="hljs-comment">//    ,      </span><font></font>
<font></font>
      <span class="hljs-comment">//   </span><font></font>
      eeprom_write_word(&amp;EEPROM_cur_edge, cur_edge);<font></font>
      eeprom_write_word(&amp;EEPROM_res_edge, res_edge);<font></font>
      eeprom_write_byte(&amp;EEPROM_frequency_dividor, frequency_dividor);<font></font>
      <font></font>
      blink_load(<span class="hljs-number">1</span>); <span class="hljs-comment">//  </span>
    } <span class="hljs-keyword">else</span> {<font></font>
      blink_load(<span class="hljs-number">2</span>); <span class="hljs-comment">//    </span>
      <span class="hljs-keyword">if</span>(first_on()) stop();<font></font>
    }<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    blink_load(<span class="hljs-number">3</span>); <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">if</span>(first_on()) stop();<font></font>
  }<font></font>
}<font></font>
<font></font>
ISR(WDT_vect) {<font></font>
  WDTCR |= (<span class="hljs-number">1</span> &lt;&lt; WDTIE); <span class="hljs-comment">//    watchdog   ""    </span><font></font>
}<font></font>
<font></font>
EMPTY_INTERRUPT(ADC_vect); <span class="hljs-comment">//     ,     </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{<font></font>
  init_vars();<font></font>
  init_pins();       <font></font>
  init_interrupts(); <font></font>
  init_settings();<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(tp_reset || first_on()) {<font></font>
    calibrate(); <span class="hljs-comment">//          </span><font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">//  </span>
  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {<font></font>
    set_sleep_mode(SLEEP_MODE_PWR_DOWN);<font></font>
    sleep_cpu(); <span class="hljs-comment">//   watchdog</span><font></font>
<font></font>
    <span class="hljs-keyword">if</span>(++clk &gt;= INTERVAL) {<font></font>
      do_main(); <span class="hljs-comment">//  </span>
      clk = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
  }<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arsipkan dengan diagram, perkabelan, dan proyek Atmel Studio 7 yang lengkap</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id492788/index.html">Lelah, tetapi: Jerman sepenuhnya menghentikan gelombang pertama COVID-19</a></li>
<li><a href="../id492798/index.html">Orang-orang pergi untuk mengobrol di Internet, tetapi sekarang lagi mereka bermimpi offline. Apa yang terjadi?</a></li>
<li><a href="../id492800/index.html">Penyedia IoT GSM di Perumahan dan Utilitas Publik (Bagian 1)</a></li>
<li><a href="../id492804/index.html">Pada masalah replikasi aktivitas sosial di Internet sebagai kunci untuk meminimalkan peningkatan kejadian selama pandemi</a></li>
<li><a href="../id492806/index.html">Cara menautkan keterlibatan dengan monetisasi dalam game dan aplikasi seluler</a></li>
<li><a href="../id492810/index.html">[COVID-19] Tugas Anda adalah memuluskan puncak</a></li>
<li><a href="../id492812/index.html">Mencoba menjalankan jaringan GAN di OpenVINO</a></li>
<li><a href="../id492816/index.html">IntelliJ IDEA Tip & Trik: 4. Sinkronisasi dan bagikan pengaturan</a></li>
<li><a href="../id492820/index.html">.Net Core Api: mendapatkan data dalam permintaan dari berbagai sumber</a></li>
<li><a href="../id492822/index.html">Pengembang CSS - mengapa dunia membutuhkannya?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>