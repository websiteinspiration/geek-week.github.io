<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè© üçâ üòó Comment le ran√ßongiciel Ryuk qui attaque les entreprises üê† üëé üñäÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ryuk est l'une des options de ransomware les plus connues de ces derni√®res ann√©es. Depuis sa premi√®re apparition √† l'√©t√© 2018, il a dress√© une liste i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Comment le ran√ßongiciel Ryuk qui attaque les entreprises</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497696/"><img src="https://habrastorage.org/webt/wc/6r/b3/wc6rb3xxu-e_aw_mg1pxcy_23yq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ryuk est l'une des options de ransomware les plus connues de ces derni√®res ann√©es. </font><font style="vertical-align: inherit;">Depuis sa premi√®re apparition √† l'√©t√© 2018, il a dress√© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une liste impressionnante de victimes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , notamment dans le milieu des affaires, qui est la principale cible de ses attaques.</font></font><a name="habracut"></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Informations g√©n√©rales</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce document contient une analyse de l'option de ran√ßongiciel Ryuk, ainsi que le chargeur de d√©marrage responsable du t√©l√©chargement du malware sur le syst√®me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le ran√ßongiciel Ryuk est apparu pour la premi√®re fois √† l'√©t√© 2018. L'une des diff√©rences entre Ryuk et les autres ransomwares est qu'il vise √† attaquer les environnements d'entreprise. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä la mi-2019, des groupes de cybercriminalit√© ont attaqu√© un grand nombre de soci√©t√©s espagnoles √† l'aide de ce crypteur. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x5/ax/et/x5axetxacru5kb7h6er1vagmdqy.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. </font></font><br>
</i><br>
<img src="https://habrastorage.org/webt/oc/kn/ee/ockneevf4elmwczdwsmimtsvnuk.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure </font></font><br>
</i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">1: Extrait d'El Confidencial concernant l'attaque par ran√ßongiciel Ryuk [1] </font></i><i><font style="vertical-align: inherit;">2: Extrait d'El Pa√≠s √† propos d'une attaque par un ransomware Ryuk [2]</font></i></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Cette ann√©e, Ryuk a attaqu√© un grand nombre d'entreprises dans diff√©rents pays. Comme vous pouvez le voir dans les figures ci-dessous, l'Allemagne, la Chine, l'Alg√©rie et l'Inde ont le plus souffert.</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En comparant le nombre de cyberattaques, nous pouvons voir que des millions d'utilisateurs ont √©t√© affect√©s par Ryuk et l'√©norme quantit√© de donn√©es a √©t√© compromise, entra√Ænant de graves dommages √©conomiques. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-p/4u/y-/-p4uy-fnectlv0mqwtvupfa--vc.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 3: Illustration de l'activit√© mondiale de Ryuk. </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/sq/oe/hm/sqoehmto6enrwgz6kjt4_sdpgz0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 4:16 pays les plus touch√©s par Ryuk </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/qj/1_/d2/qj1_d2eze5bigcd0gqvvrwiw9ns.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 5: Nombre d'utilisateurs attaqu√©s par le ran√ßongiciel Ryuk (en millions)</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Selon le principe habituel de fonctionnement de ces menaces, ce ran√ßongiciel, une fois le cryptage termin√©, montre √† la victime une notification de ran√ßon, qui doit √™tre pay√©e en bitcoins √† l'adresse sp√©cifi√©e pour restaurer l'acc√®s aux fichiers crypt√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce malware a chang√© depuis sa premi√®re apparition.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une variante de cette menace analys√©e dans ce document a √©t√© d√©couverte lors d'une tentative de lancement d'une attaque en janvier 2020. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En raison de sa complexit√©, ce malware est souvent attribu√© √† des cybercriminels organis√©s, √©galement appel√©s groupes APT. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une partie du code Ryuk a une ressemblance notable avec le code et la structure d'un autre cryptographe Hermes bien connu, avec lequel ils ont un certain nombre de fonctions identiques. C'est pourquoi Ryuk √©tait initialement associ√© au groupe nord-cor√©en Lazarus, qui √† l'√©poque √©tait soup√ßonn√© d'√™tre derri√®re le ran√ßongiciel Hermes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par la suite, le Falcon X de CrowdStrike a not√© que Ryuk avait √©t√© cr√©√© par WIZARD SPIDER [4].</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe des preuves √† l'appui de cette hypoth√®se. Tout d'abord, ce ran√ßongiciel a √©t√© annonc√© sur le site Web exploit.in, qui est un march√© russe bien connu des logiciels malveillants et √©tait auparavant associ√© √† certains groupes APT russes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce fait exclut la th√©orie selon laquelle Ryuk pourrait √™tre d√©velopp√© par le groupe Lazarus APT, comme cela ne correspond pas √† la fa√ßon dont le groupe agit.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, Ryuk a √©t√© pr√©sent√© comme un chiffreur qui ne fonctionnera pas sur les syst√®mes russe, ukrainien et bi√©lorusse. Ce comportement est d√©termin√© par la fonction trouv√©e dans certaines versions de Ryuk, o√π il v√©rifie la langue du syst√®me dans lequel ce chiffreur s'ex√©cute et arr√™te son fonctionnement si le syst√®me est russe, ukrainien ou bi√©lorusse. Enfin, lors d'une analyse experte d'une machine pirat√©e par le groupe WIZARD SPIDER, plusieurs ¬´artefacts¬ª ont √©t√© d√©couverts qui auraient √©t√© utilis√©s dans le d√©veloppement de Ryuk en tant que variante du ran√ßongiciel Hermes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'autre part, les experts Gabriela Nicolao et Luciano Martins ont sugg√©r√© que le cryptographe pourrait avoir √©t√© d√©velopp√© par l'√©quipe CryptoTech APT [5].</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela d√©coule du fait que quelques mois avant l'apparition de Ryuk, ce groupe a post√© des informations sur le forum du m√™me site selon lequel il avait d√©velopp√© une nouvelle version du ran√ßongiciel Herm√®s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plusieurs utilisateurs du forum se sont demand√© si CryptoTech avait vraiment cr√©√© Ryuk. </font><font style="vertical-align: inherit;">Apr√®s cela, ce groupe s'est d√©fendu et a d√©clar√© qu'il avait des preuves qu'il avait d√©velopp√© 100% de ce crypteur.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Caract√©ristiques</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous commen√ßons par le chargeur de d√©marrage, dont la t√¢che est d'identifier le syst√®me dans lequel il se trouve, afin que vous puissiez ex√©cuter la version ¬´correcte¬ª du crypteur Ryuk. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le hachage du chargeur de d√©marrage est le suivant: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MD5 A73130B0E379A989CBA3D695A157A495 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SHA256 EF231EE1A2481B7E627921468E79BB4369CCFAEB19A575748DD2B664ABC4F469 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'une des caract√©ristiques de ce chargeur de d√©marrage est qu'il ne contient aucune donn√©e: les cr√©ateurs de ce malware n'ont inclus aucune information.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parfois, ils contiennent des donn√©es erron√©es afin de faire croire √† l'utilisateur qu'il est en train de lancer une application l√©gitime. </font><font style="vertical-align: inherit;">Cependant, comme nous le verrons plus tard, dans le cas o√π l'infection n'implique pas d'interaction avec l'utilisateur (comme c'est le cas avec ce chiffreur), les attaquants ne jugent pas n√©cessaire d'utiliser des m√©tadonn√©es. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rj/zx/yu/rjzxyuaec1nfxajxzwufks4hb0w.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. </font><font style="vertical-align: inherit;">6:</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Exemple de </font><i><font style="vertical-align: inherit;">m√©tadonn√©es L'√©chantillon a</font></i><font style="vertical-align: inherit;"> √©t√© compil√© au format 32 bits afin de pouvoir √™tre ex√©cut√© sur des syst√®mes 32 bits et 64 bits.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Vecteur de p√©n√©tration</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'√©chantillon qui t√©l√©charge et lance Ryuk est entr√© dans notre syst√®me via une connexion √† distance, et les param√®tres d'acc√®s ont √©t√© obtenus gr√¢ce √† une attaque RDP pr√©liminaire. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pt/jd/bj/ptjdbj8ce7mgfuy8vowq8gogitm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 7: Attack Registry Un</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
attaquant a r√©ussi √† se connecter √† distance √† un syst√®me. Apr√®s cela, il a cr√©√© un fichier ex√©cutable avec notre exemple. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce fichier ex√©cutable a √©t√© bloqu√© par une solution antivirus avant son lancement. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ez/gj/gq/ezgjgq4iagc2lep3pebhom5cox0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 8: blocage de l'√©chantillon </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/tg/zv/-k/tgzv-keet96r81465eywpeahn8a.jpeg"><br>
<img src="https://habrastorage.org/webt/c_/0j/wz/c_0jwzu0madpx1t-pmfdznt-xny.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 9: Exemple de verrouillage</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Lorsqu'un fichier malveillant √©tait bloqu√©, l'attaquant tentait de t√©l√©charger une version crypt√©e du fichier ex√©cutable, qui √©tait √©galement bloqu√©e. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/za/f8/mh/zaf8mhwwbu4rr9u_elmazc9cmns.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 10: Un ensemble d'√©chantillons qu'un attaquant a tent√© d'ex√©cuter</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Enfin, il a essay√© de t√©l√©charger un autre fichier malveillant via une console crypt√©e</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PowerShell afin de contourner la protection antivirus. </font><font style="vertical-align: inherit;">Mais il a √©galement √©t√© bloqu√©. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lw/4b/mj/lw4bmjqpqtkf1zrqhhe0zb-4rzm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. </font><font style="vertical-align: inherit;">11: PowerShell avec le contenu malveillant bloqu√© </font></font><br>
</i><br>
<img src="https://habrastorage.org/webt/eu/dj/he/eudjheox40zpaop3cphprkuc-5c.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. </font><font style="vertical-align: inherit;">12: PowerShell avec contenu malveillant bloqu√©</font></font><br>
 </i><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Bootloader</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsqu'il est ex√©cut√©, il √©crit le fichier ReadMe dans le dossier </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% temp%</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ce qui est typique de Ryuk. Ce fichier - une demande de ran√ßon, contenant l'adresse e-mail du domaine protonmail, ce qui est assez courant dans cette famille de logiciels malveillants: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msifelabem1981@protonmail.com </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/qt/pg/zm/qtpgzmcdohk4siulk9nuayvwhqm.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/bk/wa/u9/bkwau9on8kixa8bsmiikectemqu.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 13: Exigence de rachat</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Pendant l'ex√©cution du chargeur de d√©marrage, vous pouvez voir qu'il lance plusieurs fichiers ex√©cutables avec des noms al√©atoires. Ils sont stock√©s dans un dossier </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PUBLIC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cach√© </font><font style="vertical-align: inherit;">, mais si l'option </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Afficher les fichiers et dossiers cach√©s" n'est</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pas active dans le syst√®me d'exploitation </font><font style="vertical-align: inherit;">, ils resteront cach√©s. De plus, ces fichiers sont en 64 bits contrairement au fichier parent, qui est en 32 bits.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8b/ko/z3/8bkoz3_hgnilr-2i7sytnv5g2ik.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/fe/fb/z-/fefbz-5_yiuoiftotqmnei2hrvq.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 14: Fichiers ex√©cutables lanc√©s par l'exemple</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Comme vous pouvez le voir dans la figure ci-dessus, Ryuk lance icacls.exe, qui sera utilis√© pour modifier toutes les ACL (liste de contr√¥le d'acc√®s), garantissant ainsi l'acc√®s et changeant les indicateurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il obtient un acc√®s complet sous tous les utilisateurs √† tous les fichiers sur l'appareil (/ T) ind√©pendamment des erreurs (/ C) et sans afficher de messages (/ Q). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mf/bt/nc/mfbtnclxe4usjepbuizjzknslmu.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. Figure 15: Options d'ex√©cution pour icacls.exe lanc√©es par l'exemple</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Il est important de noter que Ryuk v√©rifie quelle version de Windows est en cours d'ex√©cution. Pour ce faire, il </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
v√©rifie la version √† l'aide de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetVersionExW</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dans laquelle il v√©rifie la valeur de l'indicateur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lpVersionInformation</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indiquant si la version actuelle de Windows est ult√©rieure √† </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows XP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lc/iv/yv/lcivyvqvjmm8jximv35wbo_v8ps.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/g8/t_/da/g8t_dabeoemyz2v0u93a8ivfilk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selon que vous ex√©cutez une version plus r√©cente que Windows XP, le chargeur de d√©marrage √©crit dans le dossier utilisateur local - dans ce cas, le dossier </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Public%</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gg/gr/at/gggrateobojjggmubdykjordzy4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 17: V√©rification de la version du syst√®me d'exploitation Le</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
fichier enregistr√© est Ryuk. Il le lance ensuite en passant sa propre adresse en tant que param√®tre. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hh/0f/ct/hh0fctenv0yqswmtw9rhmhjjwv0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 18: Ex√©cuter Ryuk via ShellExecute</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
La premi√®re chose que Ryuk fait est d'obtenir les param√®tres d'entr√©e. Cette fois, il y a deux param√®tres d'entr√©e (le fichier ex√©cutable lui-m√™me et l'adresse du dropper), qui sont utilis√©s pour supprimer leurs propres traces. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1r/wu/vo/1rwuvoxtlg3lmusyoiem1v-e3da.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/op/wf/f7/opwff7lstsb0iq-nbvfqipywy6y.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 19: Cr√©ation d'un processus</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez √©galement voir que d√®s qu'il a lanc√© ses fichiers ex√©cutables, il se supprime, ne laissant ainsi aucune trace de sa pr√©sence dans le dossier o√π il a √©t√© ex√©cut√©. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tp/ui/af/tpuiafv8uy2rmzsuememmnkaxxa.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. </font><font style="vertical-align: inherit;">20: suppression de fichiers</font></font></i><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. RYUK</font></font></h4><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1 Pr√©sence</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ryuk, comme les autres logiciels malveillants, essaie de rester sur le syst√®me aussi longtemps que possible. Comme indiqu√© ci-dessus, un moyen d'atteindre cet objectif est de cr√©er et d'ex√©cuter secr√®tement des fichiers ex√©cutables. Pour cela, la pratique la plus courante consiste √† modifier la cl√© de Registre </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CurrentVersion \ Run</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce cas, vous pouvez voir qu'√† cette fin, le premier fichier ex√©cutable </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VWjRF.exe</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
(le nom du fichier est g√©n√©r√© de mani√®re al√©atoire) lance </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sd/8b/g2/sd8bg232guhntext0cy-exeh3be.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/nn/og/fo/nnogfoscybmwjhn9xnwd0gw7118.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 21: Ex√©cution du fichier VWjRF.exe</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ensuite, une commande </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RUN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est entr√©e </font><font style="vertical-align: inherit;">avec le nom " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">svchos</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Ainsi, si vous souhaitez v√©rifier les cl√©s de registre √† tout moment, vous ne pouvez facilement pas remarquer ce changement, √©tant donn√© la similitude de ce nom avec svchost. Gr√¢ce √† cette cl√©, Ryuk assure sa pr√©sence dans le syst√®me. Si le syst√®me n'a pas encore √©t√© infect√© puis lorsque vous red√©marrez le syst√®me, l'ex√©cutable r√©essayera </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ta/my/42/tamy42jg8mihxlgmxgzfjzqvfui.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 22: L'exemple garantit la pr√©sence de la cl√© de registre</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nous pouvons √©galement voir que cet ex√©cutable arr√™te les deux services: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
" </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audioendpointbuilder</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", qui, comme son nom l'indique, correspond au syst√®me audio, </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h-/28/g8/h-28g8z69elv6rzdsjo2xuvrok4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 23: Exemple d'arr√™t du syst√®me audio</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">du service samss</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui est un service de gestion de compte. L'arr√™t de ces deux services est une caract√©ristique de Ryuk. Dans ce cas, si le syst√®me est connect√© au syst√®me SIEM, le chiffreur essaie de cesser d'envoyer </font><font style="vertical-align: inherit;">des avertissements </font><font style="vertical-align: inherit;">√† </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SIEM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ainsi, il d√©fend ses prochaines √©tapes, car certains services SAM ne pourront pas d√©marrer correctement leur travail apr√®s l'ex√©cution de Ryuk. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wj/fn/l1/wjfnl14it7llrkny9xpfvrs30di.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 24: L'√©chantillon arr√™te le service Samss </font></font></i><br>
 <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2 Privil√®ges</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
D'une mani√®re g√©n√©rale, Ryuk commence par un mouvement horizontal au sein du r√©seau ou est lanc√© par un autre programme malveillant, comme </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Emotet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trickbot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui en cas d'escalade de privil√®ges transf√®re ces droits √©lev√©s au chiffreur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä l'avance, en pr√©lude au processus d'impl√©mentation, nous voyons qu'il ex√©cute le processus </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImpersonateSelf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ce qui signifie que le contenu de s√©curit√© du jeton d'acc√®s sera transf√©r√© vers le flux, o√π il sera imm√©diatement re√ßu √† l'aide de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetCurrentThread</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9y/nm/ut/9ynmutmaqq2wovbdswheiipajcc.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 25: Appeler ImpersonateSelf</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ensuite, nous voyons qu'il associera le jeton d'acc√®s au flux. Nous voyons √©galement que l'un des drapeaux est </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DesiredAccess</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui peut √™tre utilis√© pour contr√¥ler l'acc√®s que le flux aura. Dans ce cas, la valeur qu'edx recevra doit √™tre </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TOKEN_ALL_ACESS,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou bien </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TOKEN_WRITE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ui/vc/a_/uivca_yeyyvr5m-hwyolmei6k3u.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/tm/gy/yg/tmgyygvshjspnungxwqitl_jqm0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 26: Cr√©ation d'un jeton de flux</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ensuite, il utilisera</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SeDebugPrivilege</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fera un appel pour obtenir des droits de d√©bogage de d√©bogage par rapport au flux, √† la suite de quoi, en sp√©cifiant </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PROCESS_ALL_ACCESS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , il pourra acc√©der √† n'importe quel processus requis. Maintenant, √©tant donn√© que le chiffreur a d√©j√† un flux pr√©par√©, il ne reste plus qu'√† passer √† l'√©tape finale. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0m/lf/ki/0mlfkifvdv7hk7rizfyus_7oco4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 27: Appeler SeDebugPrivilege et la fonction d'escalade des droits</font></font><br>
 </i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
D'une part, nous avons LookupPrivilegeValueW, qui nous fournit les informations n√©cessaires sur les privil√®ges que nous voulons augmenter. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ts/wd/db/tswddbwi0jyghyqjpniu6rphmpe.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 28: Demander des informations sur les privil√®ges pour leur escalade</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
D'autre part, nous avons </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AdjustTokenPrivileges</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui nous permet d'obtenir les droits n√©cessaires √† notre flux. Dans ce cas, le plus important est </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewState.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dont le drapeau accordera des privil√®ges. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ki/sx/pa/kisxpam9ymp6ivk8remgfwfx4aq.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/9m/0s/sa/9m0ssakqkkjd4wzm4wqfav-mn7g.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. Figure 29: D√©finition des droits pour le jeton </font></font></i><br>
 <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3 D√©ploiement</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dans cette section, nous allons montrer comment l'exemple ex√©cute le processus de d√©ploiement mentionn√© pr√©c√©demment dans ce rapport. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le principal objectif du processus de mise en ≈ìuvre, ainsi que l'escalade, est d'acc√©der aux </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clich√©s instantan√©s</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pour ce faire, il doit travailler avec le flux avec des droits sup√©rieurs √† ceux de l'utilisateur local. D√®s qu'il obtient ces droits sup√©rieurs, il supprimera les copies et apportera des modifications √† d'autres processus afin de rendre impossible le retour √† un point de restauration ant√©rieur du syst√®me d'exploitation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme c'est g√©n√©ralement le cas avec ce type de malware, il utilise </font><b><font style="vertical-align: inherit;">CreateToolHelp32Snapshot</font></b><font style="vertical-align: inherit;"> pour terminer l'impl√©mentation</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, il prend donc un instantan√© des processus en cours d'ex√©cution et tente d'acc√©der √† ces processus √† l'aide d' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenProcess</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . D√®s qu'il a acc√®s au processus, il ouvre √©galement un jeton avec ses informations pour obtenir les param√®tres du processus. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dc/do/xz/dcdoxzczq1ti1kf5fu_5y_rikc8.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Figure </font><i><font style="vertical-align: inherit;">30: R√©ception de processus d'un ordinateur</font></i><font style="vertical-align: inherit;"> Nous pouvons voir dynamiquement comment il re√ßoit une liste de processus en cours d'ex√©cution dans la routine 140002D9C √† l'aide de CreateToolhelp32Snapshot. Apr√®s les avoir re√ßus, il parcourt la liste, essayant d'ouvrir les processus un par un en utilisant OpenProcess jusqu'√† ce qu'il puisse le faire. Dans ce cas, le premier processus qu'il a pu ouvrir √©tait </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬´taskhost.exe¬ª</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/k0/24/og/k024ogcd6ioxwnjbfuhjuefrce4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 31: Ex√©cution dynamique d'une proc√©dure pour obtenir un processus</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous pouvons voir qu'il lit ensuite le jeton du processus, il s'agit donc d' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenProcessToken</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec la " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20008</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8j/zl/kn/8jzlkngsiwxlyol93ozqx8ebjrm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 32: Lecture des informations de jeton de processus</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Il v√©rifie √©galement que le processus dans lequel il sera incorpor√© n'est pas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">csrss.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">explorer.exe, lsaas.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou qu'il dispose d'un ensemble d'autorisations d' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">autorit√© NT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hr/xr/9k/hrxr9kefgjfbtsex5awxtlqmjcm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. Figure 33: Processus exclus.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nous pouvons voir dynamiquement comment il v√©rifie d'abord √† l'aide des informations de jeton de processus dans </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">140002D9C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour savoir si le compte dont les droits sont utilis√©s pour ex√©cuter le processus est un compte </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT AUTHORITY</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4v/_v/-c/4v_v-cloz4ndee9gs0qbihghn9k.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 34: V√©rification de NT AUTHORITY</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Et plus tard, en dehors de la proc√©dure, il v√©rifie qu'il ne s'agit pas de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">csrss.exe, explorer.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lsaas.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wa/uy/gg/wauyggzhisvonm1cyqr3cahfdc0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 35: V√©rification de NT AUTHORITY</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Apr√®s avoir pris un instantan√© des processus, ouvert les processus et v√©rifi√© qu'aucun d'entre eux n'est exclu, il est pr√™t √† noter les processus qui seront impl√©ment√©s en m√©moire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ce faire, il r√©serve d'abord une r√©gion en m√©moire ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VirtualAllocEx</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), y √©crit ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WriteProcessmemory</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) et cr√©e un flux ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateRemoteThread</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Pour utiliser ces fonctions, il utilise les PID des processus s√©lectionn√©s, qu'il avait pr√©c√©demment obtenus √† l'aide de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateToolhelp32Snapshot</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/s7/zp/pl/s7zpplpua6q4w1mgpurwvgtzyxy.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 36: Embed Code</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ici, nous pouvons observer dynamiquement comment il utilise le processus PID pour appeler la fonction </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VirtualAllocEx. </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/7n/k1/j-/7nk1j-saztq--oxfo2xwzyiowgk.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. Figure 37: Appel du </font></font></i><br>
 <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chiffrement </font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">VirtualAllocEx </font></i><b><font style="vertical-align: inherit;">5.4</font></b></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dans cette section, nous allons examiner une partie de cet exemple li√©e au chiffrement. Dans la figure suivante, vous pouvez voir deux routines appel√©es " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LoadLibrary_EncodeString</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " et " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encode_Func</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", qui sont responsables de l'ex√©cution de la proc√©dure de cryptage. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o5/iu/1r/o5iu1rimo3qfnbgpnl4mvwcpwug.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 38: Proc√©dures de chiffrement</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dans un premier temps, nous pouvons voir comment il charge une cha√Æne qui sera ensuite utilis√©e pour d√©sobscurcir tout ce qui est n√©cessaire: importations, DLL, commandes, fichiers et CSP. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/du/x6/te/dux6tehj_i7jcqkupvfdb3hlcfw.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 39: Cha√Æne de d√©sobfuscation</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La figure suivante montre la premi√®re importation qu'elle d√©sobfusque dans le registre R4, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LoadLibrary</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Cela sera utilis√© plus tard pour charger les DLL n√©cessaires. Nous pouvons √©galement voir une autre ligne dans le registre R12, qui est utilis√©e avec la ligne pr√©c√©dente pour effectuer la d√©sobfuscation. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/la/oo/to/laootohjrpgt3fa-yeetqz6rxzo.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 40: D√©sobfuscation dynamique</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Il continue de charger des commandes qu'il ex√©cutera plus tard pour d√©sactiver les sauvegardes, les points de restauration et les modes de d√©marrage sans √©chec. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ce/qt/le/ceqtleaezfngmfgtrlhpgxl-vbw.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 41: T√©l√©chargement des commandes</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ensuite, il charge l'emplacement o√π il d√©posera 3 fichiers: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows.bat, run.sct</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">start.bat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ef/wj/9f/efwj9fcrtd5vai-3jjp6kblwsu0.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/jx/sg/sa/jxsgsaqyu0omqswv0-eseu5aeok.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/yq/g4/ur/yqg4urwb1wqlo52wgoocuccbi00.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/i2/fc/2t/i2fc2t2mcj6qrwau7gikqb4ohf4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 42: Emplacements des fichiers</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces 3 fichiers sont utilis√©s pour v√©rifier les privil√®ges de chaque emplacement. Si les privil√®ges requis ne sont pas disponibles, Ryuk arr√™te l'ex√©cution. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il continue de charger des lignes correspondant √† trois fichiers. Le premier, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DECRYPT_INFORMATION.html</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , contient les informations n√©cessaires √† la restauration des fichiers. Le second, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PUBLIC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , contient la cl√© publique RSA. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vf/w1/do/vfw1doq6ayau0i8pkniuc-rd5mk.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 43: String DECRYPT INFORMATION.html</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Troisi√®mement, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNIQUE_ID_DO_NOT_REMOVE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , contient la cl√© chiffr√©e qui sera utilis√©e dans la prochaine routine pour effectuer le chiffrement. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/u_/1l/s1/u_1ls1stszk23gkrsh2mwonnvgi.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 44: ID UNIQUE NE PAS SUPPRIMER Cha√Æne</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Enfin, il charge les biblioth√®ques requises avec les importations requises et CSP ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Enhanced RSA</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fournisseur cryptographique AES</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7d/b9/q1/7db9q1wjr1k_y1bfsefiewsc-6g.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 45: T√©l√©chargement des biblioth√®ques Une</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
fois la d√©sobfuscation termin√©e, il proc√®de aux actions requises pour le cryptage: it√©rer sur tous les lecteurs logiques, effectuer ce qui √©tait charg√© dans le sous-programme pr√©c√©dent, renforcer la pr√©sence dans le syst√®me, supprimer le fichier RyukReadMe.html, crypter, it√©rer tous les lecteurs r√©seau, en passant aux appareils d√©couverts et √† leur cryptage. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout commence par le t√©l√©chargement de " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " et l'√©criture de la cl√© publique RSA. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_n/me/r-/_nmer-jvdpleozaujmoemqo7u9s.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 46: Pr√©paration du chiffrement</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Il r√©cup√®re ensuite tous les lecteurs logiques √† l'aide de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetLogicalDrives</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et d√©sactive toutes les sauvegardes, les points de r√©cup√©ration et les modes de d√©marrage sans √©chec.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fa/ov/f8/faovf8myihdrkrtulhzcu_50e8q.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 47: D√©sactivation des outils de r√©cup√©ration</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Apr√®s cela, il renforce sa pr√©sence dans le syst√®me, comme nous l'avons vu ci-dessus, et √©crit le premier fichier </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RyukReadMe.html</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TEMP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x8/7u/at/x87uatt-xtzmrn0un3-jqt5o0hw.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Figure </font><i><font style="vertical-align: inherit;">48: Publication d'une notification de rachat.</font></i><font style="vertical-align: inherit;"> Dans la figure suivante, vous pouvez voir comment il cr√©e un fichier, t√©l√©charge le contenu et l'√©crit: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vu/5o/2n/vu5o2nliyrqgsmugbe9jpx0-1mc.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. Figure 49: T√©l√©chargement et enregistrement du contenu d'un fichier</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Afin de pouvoir effectuer les m√™mes actions sur tous les appareils, il utilise </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
" </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">icacls.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " comme nous l'avons montr√© ci-dessus. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bd/6a/qb/bd6aqbnkrrba-polrck91kh53w0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 50: Utilisation d'icalcls.exe</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et enfin, il commence √† crypter les fichiers √† l'exception des fichiers "* .exe", "* .dll", des fichiers syst√®me et d'autres emplacements sp√©cifi√©s comme une liste blanche crypt√©e. </font><font style="vertical-align: inherit;">Pour cela, il utilise des importations: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptAcquireContextW</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (o√π l'utilisation d'AES et RSA est indiqu√©e), </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptDeriveKey, CryptGenKey</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptDestroyKey</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , etc. </font><font style="vertical-align: inherit;">On tente √©galement d'√©tendre son effet sur les p√©riph√©riques r√©seau d√©tect√©s √† l'aide de WNetEnumResourceW, puis de les chiffrer. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9j/yn/mj/9jynmjtzu26dwvfg3ugrthcxo0o.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. </font><font style="vertical-align: inherit;">51: Cryptage des fichiers syst√®me</font></font></i><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Importations et drapeaux connexes</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le tableau suivant r√©pertorie les importations et les indicateurs les plus pertinents utilis√©s par l'√©chantillon:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ri/bn/he/ribnhe9istspdndifpecxgnzljc.jpeg"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. CIO</font></font></h4><br>
<img src="https://habrastorage.org/webt/bf/gu/cr/bfgucrrkqw-l2jurn09ovgljhas.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©f√©rences</font></font></b><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">users \ Public \ run.sct</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menu D√©marrer \ Programmes \ D√©marrage \ start.bat AppData \ Roaming \ Microsoft \ Windows \ Start</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menu \ ProgrammesStartup \ start.bat</font></font></li>
</ul><br>
<br>
<img src="https://habrastorage.org/webt/ld/od/e2/ldode2_iiqa4jqw4ol46ch5dov4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rapport technique sur les ran√ßongiciels Ryuk compil√© par les experts du laboratoire antivirus de PandaLabs.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8. R√©f√©rences</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. ‚ÄúEveris y Prisa Radio sufren un grave ciberataque que secuestra sus sistemas.‚Äù Https: // www. elconfidencial.com/tecnologia/2019-11-04/ everis-la-ser-ciberataque-ransomware-15_2312019 /, Publicada el 04/11/2019. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. ¬´Un virus de origen ruso ataca a importantes empresas espa√±olas¬ª. Https: //elpais.com/ tecnologia / 2019/11/04 / actualidad / 1572897654_ 251312.html, Publicada el 04/11/2019. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. "Document VB2019: La vengeance de Shinigami: la longue queue du malware Ryuk." Https://securelist.com/ story-of-the-year-2019-cities-under-ransomware-siege / 95456 /, Publicada el 11 / </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
12/2019 4. ¬´Big Game Hunting with Ryuk: Another Lucrativebased Ransomware¬ª. Https: // www. crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/, Publicada el 01/10/2019.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5. ¬´Document VB2019: La vengeance de Shinigami: la longue queue du malware Ryuk.¬ª Https: // www. </font><font style="vertical-align: inherit;">virusbulletin.com/virusbulletin/2019/10/ vb2019-paper-shinigamis-revenge-long-tail-r</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr497680/index.html">Votre t√©l√©gramme semble couler</a></li>
<li><a href="../fr497682/index.html">Pavel Klemenkov, NVIDIA: Nous essayons de r√©duire l'√©cart entre ce qu'un scientifique des donn√©es peut faire et ce qu'il doit √™tre capable de faire.</a></li>
<li><a href="../fr497684/index.html">Courbe de battage m√©diatique: quelles technologies informatiques sont √† leur apog√©e et ce qui restera une demande stable</a></li>
<li><a href="../fr497686/index.html">Mat√©riau d'implant qui tue les bact√©ries</a></li>
<li><a href="../fr497688/index.html">Comment fonctionne l'√©cole du soir de Kubernetes</a></li>
<li><a href="../fr497700/index.html">Mitaps en ligne hebdomadaires sur le support et DevOps, la s√©curit√© et les robots √† partir du 17 avril</a></li>
<li><a href="../fr497702/index.html">Cinq tendances du stockage de donn√©es auxquelles vous devriez faire attention en 2020</a></li>
<li><a href="../fr497708/index.html">Nous vous invitons √† une s√©rie de webinaires Fujitsu en avril et mai</a></li>
<li><a href="../fr497714/index.html">Comment prot√©ger les processus et les extensions du noyau sur macOS</a></li>
<li><a href="../fr497724/index.html">Pr√©paration d'un serveur pour la publication d'une application Web en Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>