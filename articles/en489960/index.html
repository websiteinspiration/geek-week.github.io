<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ú® üì≠ üïó Automated build of a Delphi application üïô üí® ‚ùï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quite often, I came across the fact that Delphi developers (one can say traditionally) compile their applications with ‚Äúpens‚Äù, which is far from a pro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Automated build of a Delphi application</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489960/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quite often, I came across the fact that Delphi developers (one can say traditionally) compile their applications with ‚Äúpens‚Äù, which is far from a production solution, but from the outside looks like scrub and </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äúdo it on the knee‚Äù</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , although the products are very serious and sellable . This probably went back to the time when for automation it was necessary to come up with your own </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">batch files</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> that started the command line compiler </font></font><code>dcc32</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with the necessary parameters. </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Some even made their own ‚ÄúPublisher‚Äù - Delphi-expert, which does the work of the assembly server: compiles the project (though open in the IDE), exposing it with an incremented version number taken from some database, writes some changelog and copies it somewhere into network directory</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I will not go into the historical excursion </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as it was before</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . I will tell you how to eat / can now, and how to use it to increase the efficiency of my work.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The project file of the modern version of Delphi is a </font></font><code>.dproj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">file (hereinafter I will focus on Delphi 10 Rio, but with slight differences this is true for all earlier versions of Delphi, starting from 2007). It stores all the project settings, which are usually changed in the IDE (menu </font></font><code>Project - Options (Ctrl+Shift+F11)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). In this article, I will concentrate on the ‚Äúcore‚Äù ones that will be needed to demonstrate the general principles: this </font></font><code>Config</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is the configuration, the </font></font><code>Platform</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">platform, the </font></font><code>OutputDirectory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">path of the output file, and </font></font><code>ConditionalDefines</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(conditional compilation directives). The rest of the settings, if any need to be changed during assembly, I propose to identify yourself. This same </font></font><code>.dproj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">file, if you look into it with a regular text editor, is nothing more than an </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">MSBuild</font></a><font style="vertical-align: inherit;"> build script</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(let's create a simple console application and call it </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DelphiAutomatedBuild</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font></p><a name="habracut"></a><br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">Project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://schemas.microsoft.com/developer/msbuild/2003"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">PropertyGroup</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ProjectGuid</span>&gt;</span>{6880AD8E-6CB3-47B9-B8E3-7304CF6E9735}<span class="hljs-tag">&lt;/<span class="hljs-name">ProjectGuid</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ProjectVersion</span>&gt;</span>18.1<span class="hljs-tag">&lt;/<span class="hljs-name">ProjectVersion</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">FrameworkType</span>&gt;</span>None<span class="hljs-tag">&lt;/<span class="hljs-name">FrameworkType</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">MainSource</span>&gt;</span>DelphiAutomatedBuild.dpr<span class="hljs-tag">&lt;/<span class="hljs-name">MainSource</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Base</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-name">Base</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Config</span> <span class="hljs-attr">Condition</span>=<span class="hljs-string">"'$(Config)'==''"</span>&gt;</span>Debug<span class="hljs-tag">&lt;/<span class="hljs-name">Config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Platform</span> <span class="hljs-attr">Condition</span>=<span class="hljs-string">"'$(Platform)'==''"</span>&gt;</span>Win32<span class="hljs-tag">&lt;/<span class="hljs-name">Platform</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">TargetedPlatforms</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">TargetedPlatforms</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">AppType</span>&gt;</span>Console<span class="hljs-tag">&lt;/<span class="hljs-name">AppType</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">PropertyGroup</span>&gt;</span><font></font>
    ...<font></font>
</code></pre><br>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MSBuild build scripts are also used to describe projects, such as Visual Studio. </font><font style="vertical-align: inherit;">I will touch on some details of MSBuild, but I suggest the reader to master its basics on its own</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">What does this give us? </font><font style="vertical-align: inherit;">This allows us to build a Delphi project from the command line with one line ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which, in turn, allows us to automate the assembly of the project</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></p><br>
<pre><code class="plaintext hljs">msbuild /t:build DelphiAutomatedBuild.dproj</code></pre><br>
<p><em>  MSBuild?   Delphi,  MSBuild   ,  Delphi  .  ,   <code>%WINDIR%\Microsoft.Net\Framework\v3.5</code>,     .Net 4.0/4.5/4.6.         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">Microsoft</a>.    MSBuild  4.0,     ,   </em></p><br>
<p>          (hint:   <em></em> ,     ()    IDE ‚Äî <em>Show in Explorer</em>,   <em></em>  ‚Äî <em>  </em>),     : </p><br>
<pre><code class="plaintext hljs">...&gt;msbuild /t:build DelphiAutomatedBuild.dproj<font></font>
"msbuild"     <font></font>
,     .</code></pre><br>
<p>.  ,   MSBuild-  <code>PATH</code> .     :</p><br>
<pre><code class="plaintext hljs">set PATH=%WINDIR%\Microsoft.Net\Framework\v3.5;%PATH%</code></pre><br>
<p> :</p><br>
<pre><code class="plaintext hljs">...&gt;msbuild /t:build DelphiAutomatedBuild.dproj<font></font>
Microsoft (R) Build Engine  12.0.21005.1<font></font>
[Microsoft .NET Framework  4.0.30319.42000]<font></font>
(C)   (Microsoft Corporation).   .<font></font>
<font></font>
  24.11.2018 0:12:14.<font></font>
 "Z:\habr\delphi-automate-build\DelphiAutomatedBuild.dproj"   1 (  build).<font></font>
Z:\habr\delphi-automate-build\DelphiAutomatedBuild.dproj : error MSB4057:      "build".<font></font>
  "Z:\habr\delphi-automate-build\DelphiAutomatedBuild.dproj"  (  build)  .<font></font>
<font></font>
 .<font></font>
<font></font>
"Z:\habr\delphi-automate-build\DelphiAutomatedBuild.dproj" (  build ) (1) -&gt;<font></font>
  Z:\habr\delphi-automate-build\DelphiAutomatedBuild.dproj : error MSB4057:      "build".<font></font>
<font></font>
    : 0<font></font>
    : 1<font></font>
<font></font>
 : 00:00:00.04<font></font>
</code></pre><br>
<p> ,    .    ?    <code>build</code>? </p><br>
<p>    <code>.dproj</code>-,    :</p><br>
<pre><code class="xml hljs">...
    <span class="hljs-tag">&lt;<span class="hljs-name">Import</span> <span class="hljs-attr">Project</span>=<span class="hljs-string">"$(BDS)\Bin\CodeGear.Delphi.Targets"</span> <span class="hljs-attr">Condition</span>=<span class="hljs-string">"Exists('$(BDS)\Bin\CodeGear.Delphi.Targets')"</span>/&gt;</span>
...</code></pre><br>
<p>       Delphi<br>
<code>c:\Program Files\Embarcadero\Studio\20.0\Bin\CodeGear.Delphi.Targets</code>,       MSBuild-,     <code>Build</code>:</p><br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">Target</span> <span class="hljs-attr">Name</span>=<span class="hljs-string">"Build"</span><span class="hljs-attr">...</span></span></code></pre><br>
<p>..     <code>BDS</code> (<code>$(VAR)</code>  MSBuild    (Property) <code>VAR</code>,   ,     ),        Delphi,     (-,          Delphi,      <code>BDS</code>).     <code>$(BDS)</code>,   <code>.Targets</code>    Delphi    <code>Build</code>.<br>
 :</p><br>
<pre><code class="plaintext hljs">set BDS=c:\Program Files\Embarcadero\Studio\20.0</code></pre><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><pre><code class="plaintext hljs">...&gt;msbuild /t:build DelphiAutomatedBuild.dproj<font></font>
Microsoft (R) Build Engine  12.0.21005.1<font></font>
[Microsoft .NET Framework  4.0.30319.42000]<font></font>
(C)   (Microsoft Corporation).   .<font></font>
<font></font>
  24.11.2018 0:20:40.<font></font>
 "Z:\habr\delphi-automate-build\DelphiAutomatedBuild.dproj"   1 (  build).<font></font>
CreateProjectDirectories:<font></font>
    ".\Win32\Debug".<font></font>
BuildVersionResource:<font></font>
  C:\Program Files\Embarcadero\Studio\20.0\bin\cgrc.exe -c65001 DelphiAutomatedBuild.vrc -foDelphiAutomatedBuild.res <font></font>
  CodeGear Resource Compiler/Binder<font></font>
  Version 1.2.2 Copyright (c) 2008-2012 Embarcadero Technologies Inc.<font></font>
<font></font>
  Microsoft (R) Windows (R) Resource Compiler Version 6.0.5724.0<font></font>
<font></font>
  Copyright (C) Microsoft Corporation.  All rights reserved.<font></font>
<font></font>
   "DelphiAutomatedBuild.vrc" .<font></font>
_PasCoreCompile:<font></font>
  C:\Program Files\Embarcadero\Studio\20.0\bin\dcc32.exe -$O- -$W+ --no-config -B -Q -TX.exe -AGenerics.Collections=System.Generics.Collections;Generics.Defaults=System.Generics.Defaults;WinTypes=Winapi.Windows;WinProcs=Winapi.Windows;DbiTypes=BDE;DbiProcs=BDE;DbiErrs=BDE -DDEBUG -E.\Win32\Debug -I"c:\program files\embarcadero\studio\20.0\lib\Win32\debug";"c:\program files\embarcadero\studio\20.0\lib\Win32\release";C:\Users\USER\Documents\Embarcadero\Studio\20.0\Imports;"C:\Program Files\Embarcadero\Studio\20.0\Imports";"C:\Users\Public\Documents\RAD Studio\5.0\Dcp";"C:\Program Files\Embarcadero\Studio\20.0\include";C:\Users\USER\AppData\Local\Programs\TestInsight\Source -LE"C:\Users\Public\Documents\RAD Studio\5.0\Bpl" -LN"C:\Users\Public\Documents\RAD Studio\5.0\Dcp" -NU.\Win32\Debug -NSWinapi;System.Win;Data.Win;Datasnap.Win;Web.Win;Soap.Win;Xml.Win;Bde;System;Xml;Data;Datasnap;Web;Soap; -O"c:\program files\embarcadero\studio\20.0\lib\Win32\release";C:\Users\USER\Documents\Embarcadero\Studio\20.0\Imports;"C:\Program Files\Embarcadero\Studio\20.0\Imports";"C:\Users\Public\Documents\RAD Studio\5.0\Dcp";"C:\Program Files\Embarcadero\Studio\20.0\include";C:\Users\USER\AppData\Local\Programs\TestInsight\Source -R"c:\program files\embarcadero\studio\20.0\lib\Win32\release";C:\Users\USER\Documents\Embarcadero\Studio\20.0\Imports;"C:\Program Files\Embarcadero\Studio\20.0\Imports";"C:\Users\Public\Documents\RAD Studio\5.0\Dcp";"C:\Program Files\Embarcadero\Studio\20.0\include";C:\Users\USER\AppData\Local\Programs\TestInsight\Source -U"c:\program files\embarcadero\studio\20.0\lib\Win32\debug";"c:\program files\embarcadero\studio\20.0\lib\Win32\release";C:\Users\USER\Documents\Embarcadero\Studio\20.0\Imports;"C:\Program Files\Embarcadero\Studio\20.0\Imports";"C:\Users\Public\Documents\RAD Studio\5.0\Dcp";"C:\Program Files\Embarcadero\Studio\20.0\include";C:\Users\USER\AppData\Local\Programs\TestInsight\Source -CC -V -VN -NB"C:\Users\Public\Documents\RAD Studio\5.0\Dcp" -NH"C:\Users\Public\Documents\RAD Studio\5.0\hpp\Win32" -NO.\Win32\Debug   DelphiAutomatedBuild.dpr   <font></font>
  Embarcadero Delphi for Win32 compiler version 30.0<font></font>
  Copyright (c) 1983,2015 Embarcadero Technologies, Inc.<font></font>
  19 lines, 0.27 seconds, 100748 bytes code, 26044 bytes data.<font></font>
  "Z:\habr\delphi-automate-build\DelphiAutomatedBuild.dproj"  (  build).<font></font>
<font></font>
  .<font></font>
    : 0<font></font>
    : 0<font></font>
<font></font>
 : 00:00:01.32</code></pre></div></div><br>
<p>-!  .    <code>Win32\Debug</code>   <code>DelphiAutomatedBuild.exe</code>.</p><br>
<p>    ( ,     Debug-),        Release- (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">  </a>).  IDE   ,    ,   ,    ,       .    <code>.dproj</code>-,       </p><br>
<pre><code class="xml hljs">...
        <span class="hljs-tag">&lt;<span class="hljs-name">Config</span> <span class="hljs-attr">Condition</span>=<span class="hljs-string">"'$(Config)'==''"</span>&gt;</span>Debug<span class="hljs-tag">&lt;/<span class="hljs-name">Config</span>&gt;</span>
...</code></pre><br>
<p>  ,  ,   / <code>Config</code>,  ,       <code>Debug</code>. <em>   ,     IDE (  IDE    Release    ‚Äî   </em></p><br>
<pre><code class="xml hljs">...
        <span class="hljs-tag">&lt;<span class="hljs-name">Config</span> <span class="hljs-attr">Condition</span>=<span class="hljs-string">"'$(Config)'==''"</span>&gt;</span>Release<span class="hljs-tag">&lt;/<span class="hljs-name">Config</span>&gt;</span>
...</code></pre><br>
<p>       :</p><br>
<pre><code class="plaintext hljs">    {$IFDEF RELEASE}<font></font>
    WriteLn('This is RELEASE build');<font></font>
    {$ENDIF RELEASE}<font></font>
    {$IFDEF DEBUG}<font></font>
    WriteLn('This is DEBUG build');<font></font>
    {$ENDIF DEBUG}</code></pre><br>
<p> ,  conditional defines     Release  Debug-  RELEASE  DEBUG, </p><br>
<p>      <code>Config</code>    ,     :</p><br>
<pre><code class="plaintext hljs">...&gt;msbuild /t:build DelphiAutomatedBuild.dproj /p:Config=Release<font></font>
Microsoft (R) Build Engine  12.0.21005.1<font></font>
[Microsoft .NET Framework  4.0.30319.42000]<font></font>
(C)   (Microsoft Corporation).   .<font></font>
<font></font>
  24.11.2018 0:48:30.<font></font>
 "Z:\habr\delphi-automate-build\DelphiAutomatedBuild.dproj"   1 (  build).<font></font>
CreateProjectDirectories:<font></font>
    ".\Win32\Release".<font></font>
...</code></pre><br>
<pre><code class="plaintext hljs">...&gt;Win32\Debug\DelphiAutomatedBuild.exe<font></font>
This is DEBUG build<font></font>
<font></font>
...&gt;Win32\Release\DelphiAutomatedBuild.exe<font></font>
This is RELEASE build</code></pre><br>
<p>!</p><br>
<p>     (   )   -    ,      ,       ,           ‚Äî - . ,       .    <code>.dproj</code>:</p><br>
<pre><code class="xml hljs">...
        <span class="hljs-tag">&lt;<span class="hljs-name">DCC_ExeOutput</span>&gt;</span>.\$(Platform)\$(Config)<span class="hljs-tag">&lt;/<span class="hljs-name">DCC_ExeOutput</span>&gt;</span>
...</code></pre><br>
<p>  ?    (  ),    ,     ? </p><br>
<pre><code class="plaintext hljs">...&gt;msbuild /t:build DelphiAutomatedBuild.dproj /p:DCC_ExeOutput=binaries</code></pre><br>
<p>-!   <code>binaries</code>,   ‚Äî  <code>DelphiAutomatedBuild.exe</code>.   ? ,    <code>MSBuild</code>, ,  ,    <code>MSBuild</code>-,   ,        .    .      ...</p><br>
<p>    .      ,    (,      ). ,       <code>Config</code> ‚Äî <code>Debug</code>,  ‚Äî   ‚Äî <code>Release</code>,   , -,    (, <code>DCC_ExeOutput</code>     (  ‚Äî )),  -,        ,      (   <em></em>,     MSBuild-  ).         </p><br>
<pre><code class="plaintext hljs">...&gt;msbuild /t:build DelphiAutomatedBuild.dproj /p:DCC_ExeOutput=binaries</code></pre><br>
<p>      .  ? !<br>
   <code>Build</code>.     -  ,   IDE (   ; ,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">MMX</a>: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">DProjNormalizer</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">DProjSplitter</a>    ‚Äî <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">ProjectMagician</a> ‚Äî     <code>.dproj</code>-),     .   <strong>DAB.ciproj</strong> (CI-project,  CI ‚Äî Continuous Integration):</p><br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">Project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://schemas.microsoft.com/developer/msbuild/2003"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Target</span> <span class="hljs-attr">Name</span>=<span class="hljs-string">"Build"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">MSBuild</span> <span class="hljs-attr">Projects</span>=<span class="hljs-string">"DelphiAutomatedBuild.dproj"</span>
            <span class="hljs-attr">Targets</span>=<span class="hljs-string">"Build"</span>
            <span class="hljs-attr">Properties</span>=<span class="hljs-string">"Config=Debug"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">MSBuild</span> <span class="hljs-attr">Projects</span>=<span class="hljs-string">"DelphiAutomatedBuild.dproj"</span>
            <span class="hljs-attr">Targets</span>=<span class="hljs-string">"Build"</span>
            <span class="hljs-attr">Properties</span>=<span class="hljs-string">"Config=Release"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Target</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Project</span>&gt;</span>
</code></pre><br>
<p></p><br>
<pre><code class="plaintext hljs">...&gt;msbuild /t:build DAB.ciproj /p:DCC_ExeOutput=binaries</code></pre><br>
<p>‚Ä¶    <code>DelphiAutomatedBuild.exe</code>  <code>binaries</code>,  ,   :</p><br>
<pre><code class="plaintext hljs">...&gt;binaries\DelphiAutomatedBuild.exe<font></font>
This is RELEASE build</code></pre><br>
<p><code>DCC_Exeoutput</code>      <strong>MSBuild</strong> ‚Äî  ,           .     :</p><br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">Project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://schemas.microsoft.com/developer/msbuild/2003"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Target</span> <span class="hljs-attr">Name</span>=<span class="hljs-string">"Build"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">MSBuild</span> <span class="hljs-attr">Projects</span>=<span class="hljs-string">"DelphiAutomatedBuild.dproj"</span>
            <span class="hljs-attr">Targets</span>=<span class="hljs-string">"Build"</span>
            <span class="hljs-attr">Properties</span>=<span class="hljs-string">"Config=Debug;DCC_Exeoutput=$(DCC_ExeOutput)\Debug"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">MSBuild</span> <span class="hljs-attr">Projects</span>=<span class="hljs-string">"DelphiAutomatedBuild.dproj"</span>
            <span class="hljs-attr">Targets</span>=<span class="hljs-string">"Build"</span>
            <span class="hljs-attr">Properties</span>=<span class="hljs-string">"Config=Release;DCC_Exeoutput=$(DCC_ExeOutput)\Release"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Target</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Project</span>&gt;</span></code></pre><br>
<p> </p><br>
<pre><code class="plaintext hljs">...&gt;msbuild /t:build DAB.ciproj /p:DCC_ExeOutput=binaries</code></pre><br>
<p>       </p><br>
<p><code>binaries\Debug\DelphiAutomatedBuild.exe</code>  <code>binaries\Release\DelphiAutomatedBuild.exe</code>.</p><br>
<pre><code class="plaintext hljs">...&gt;binaries\Debug\DelphiAutomatedBuild.exe<font></font>
This is DEBUG build<font></font>
<font></font>
...&gt;binaries\Release\DelphiAutomatedBuild.exe<font></font>
This is RELEASE build</code></pre><br>
<p> ,     /   conditional define    (,    -,       ,      TRIAL )</p><br>
<p>  -   </p><br>
<pre><code class="plaintext hljs">    {$IFDEF TRIAL}<font></font>
    WriteLn('This is TRIAL version');<font></font>
    {$ENDIF TRIAL}</code></pre><br>
<p>  Debug- conditional define TRIAL  ,     .dproj:</p><br>
<pre><code class="plaintext hljs">        &lt;DCC_Define&gt;DEBUG;TRIAL;$(DCC_Define)&lt;/DCC_Define&gt;</code></pre><br>
<p>, ..   /p:DCC_Define=TRIAL,</p><br>
<pre><code class="plaintext hljs">...&gt;msbuild /t:build DAB.ciproj /p:DCC_ExeOutput=binaries /p:DCC_Define=TRIAL</code></pre><br>
<p></p><br>
<pre><code class="plaintext hljs">...&gt;binaries\Debug\DelphiAutomatedBuild.exe<font></font>
This is TRIAL version<font></font>
<font></font>
...&gt;binaries\Release\DelphiAutomatedBuild.exe<font></font>
This is TRIAL version</code></pre><br>
<p>,  -  , -  DEBUG  RELEASE,     , ..       define-.<br>
   ,         ,     .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"></a>.<br>
 <strong> </strong> <code>DCC_Define</code>:</p><br>
<pre><code class="plaintext hljs">...&gt;set DCC_Define=TRIAL<font></font>
...&gt;msbuild /t:build DAB.ciproj /p:DCC_ExeOutput=binaries<font></font>
...</code></pre><br>
<pre><code class="plaintext hljs">...&gt;binaries\Debug\DelphiAutomatedBuild.exe<font></font>
This is DEBUG build<font></font>
This is TRIAL version<font></font>
...&gt;binaries\Release\DelphiAutomatedBuild.exe<font></font>
This is RELEASE build<font></font>
This is TRIAL version</code></pre><br>
<p>  ,     ,         (   Git,     SVN   )   ,        ,   ,     ,              .</p><br>
<p> ,         . ?        ,     ,       ‚Äî -    "-",   ,   <del></del>  (   " " ‚Äî    ).</p><br>
<p>    Windows/Delphi-  <code>Major.Minor.Release.Build</code>, <em></em>  ,  ,       <code>Release</code>, , ,     .  ,     ,       .dproj-</p><br>
<pre><code class="plaintext hljs">        &lt;VerInfo_Keys&gt;CompanyName=;FileDescription=;FileVersion=1.0.0.0;InternalName=;LegalCopyright=;LegalTrademarks=;OriginalFilename=;ProductName=;ProductVersion=1.0.0.0;Comments=&lt;/VerInfo_Keys&gt;</code></pre><br>
<p> ,    .       <code>FileVersion=0.0.0.0</code>, ,  <code>FileVersion=$(Version)</code>,  <code>Version</code> ‚Äî ,      ,        ,        IDE ‚Äî , ..   ""   .      . ,   ,   ‚Äî CSV-,       .<br>
  ,    . MSBuild 4.0 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">    C#</a>,     ( ,    PATH    ).    </p><br>
<div class="spoiler"><b class="spoiler_title">Delphi.Version.Targets</b><div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">Project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">'http://schemas.microsoft.com/developer/msbuild/2003'</span> <span class="hljs-attr">ToolsVersion</span>=<span class="hljs-string">"12.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">UsingTask</span> <span class="hljs-attr">TaskName</span>=<span class="hljs-string">"__SetFileVersion"</span> <span class="hljs-attr">TaskFactory</span>=<span class="hljs-string">"CodeTaskFactory"</span> <span class="hljs-attr">AssemblyFile</span>=<span class="hljs-string">"$(MSBuildToolsPath)\Microsoft.Build.Tasks.v12.0.dll"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ParameterGroup</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">VerInfoKeys</span> <span class="hljs-attr">ParameterType</span>=<span class="hljs-string">"System.String"</span> <span class="hljs-attr">Required</span>=<span class="hljs-string">"true"</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">VerInfoProperties</span> <span class="hljs-attr">ParameterType</span>=<span class="hljs-string">"Microsoft.Build.Framework.ITaskItem[]"</span> <span class="hljs-attr">Required</span>=<span class="hljs-string">"true"</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Out</span> <span class="hljs-attr">ParameterType</span>=<span class="hljs-string">"System.String"</span> <span class="hljs-attr">Output</span>=<span class="hljs-string">"true"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ParameterGroup</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Task</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Code</span> <span class="hljs-attr">Type</span>=<span class="hljs-string">"Fragment"</span> <span class="hljs-attr">Language</span>=<span class="hljs-string">"cs"</span>&gt;</span>&lt;![CDATA[<font></font>
        // split values as CSV (by ";")<font></font>
        String[] verInfoKeysList = VerInfoKeys.Split(';');<font></font>
        Dictionary&lt;String, String&gt; d = new Dictionary&lt;String, String&gt;();<font></font>
        foreach (String verInfoValue in verInfoKeysList) {<font></font>
            // split values as "key=value"<font></font>
            if (! String.IsNullOrEmpty(verInfoValue)) {<font></font>
                String[] kv = verInfoValue.Split('=');<font></font>
                d.Add(kv[0], kv[1]);<font></font>
            }<font></font>
        }<font></font>
        if (VerInfoProperties.Length &gt; 0) {<font></font>
          foreach (ITaskItem item in VerInfoProperties) {<font></font>
            String value = item.GetMetadata("Value");<font></font>
            if (value.Length &gt; 0) {<font></font>
              Log.LogMessage("{0}: {1}", item.ItemSpec, value);<font></font>
              d.Remove(item.ItemSpec);<font></font>
              d.Add(item.ItemSpec, value);<font></font>
            }<font></font>
          }<font></font>
        }<font></font>
<font></font>
        List&lt;String&gt; L = new List&lt;String&gt;();<font></font>
        foreach (KeyValuePair&lt;String, String&gt; kv in d) {<font></font>
            L.Add(kv.Key + "=" + kv.Value);<font></font>
        }<font></font>
        _Out = String.Join(";", L.ToArray());<font></font>
]]&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">Code</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Task</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">UsingTask</span>&gt;</span><font></font>
<font></font>
  <span class="hljs-tag">&lt;<span class="hljs-name">Target</span> <span class="hljs-attr">Name</span>=<span class="hljs-string">'_SetVersionCode_Name'</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Message</span> <span class="hljs-attr">Text</span>=<span class="hljs-string">"$(VerInfo_Keys)"</span> /&gt;</span><font></font>
<font></font>
    <span class="hljs-tag">&lt;<span class="hljs-name">ItemGroup</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">VerInfoProperties</span> <span class="hljs-attr">Include</span>=<span class="hljs-string">"FileVersion"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Value</span>&gt;</span>$(FileVersion)<span class="hljs-tag">&lt;/<span class="hljs-name">Value</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">VerInfoProperties</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ItemGroup</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">__SetFileVersion</span> <span class="hljs-attr">VerInfoKeys</span>=<span class="hljs-string">"$(VerInfo_Keys)"</span> <span class="hljs-attr">VerInfoProperties</span>=<span class="hljs-string">"@(VerInfoProperties)"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Output</span> <span class="hljs-attr">PropertyName</span>=<span class="hljs-string">"VerInfo_Keys"</span> <span class="hljs-attr">TaskParameter</span>=<span class="hljs-string">"Out"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">__SetFileVersion</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Message</span> <span class="hljs-attr">Text</span>=<span class="hljs-string">"$(VerInfo_Keys)"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Target</span>&gt;</span><font></font>
<font></font>
  <span class="hljs-tag">&lt;<span class="hljs-name">Target</span> <span class="hljs-attr">Name</span>=<span class="hljs-string">'_SetFileVersion'</span> <span class="hljs-attr">BeforeTargets</span>=<span class="hljs-string">"_BuildRCFile"</span>
      <span class="hljs-attr">Condition</span>=<span class="hljs-string">"'$(FileVersion)' != ''"</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">CallTarget</span> <span class="hljs-attr">Targets</span>=<span class="hljs-string">'_SetVersionCode_Name'</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Target</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Project</span>&gt;</span> </code></pre></div></div><br>
<p>        .<br>
   <code>DelphiAutomatedBuild.dproj</code></p><br>
<pre><code class="xml hljs">...
<span class="hljs-tag">&lt;<span class="hljs-name">Import</span> <span class="hljs-attr">Project</span>=<span class="hljs-string">"Delphi.Version.Targets"</span> <span class="hljs-attr">Condition</span>=<span class="hljs-string">"$(MSBuildToolsVersion) &gt;= 4.0"</span> /&gt;</span>
...</code></pre><br>
<p><em>( "$(MSBuildToolsVersion) &gt;= 4.0"   ,          IDE, ,   ,  MSBuild 3.5,    UsingTask)</em></p><br>
<p> ,    <code>_SetFileVersion</code>,     <code>_BuildRCFile</code> (    :  <em></em> ,      ‚Äî . <code>$(BDS)\bin\Codegear.Common.Targets</code>),      <code>FileVersion</code>.      CSV-   <code>VerInfo_Keys</code>,     -,     ,      <code>VerInfo_Keys</code>. </p><br>
<p>    "Include version information in project"      (   ), :</p><br>
<pre><code class="plaintext hljs">...&gt;msbuild /t:build DAB.ciproj /p:DCC_ExeOutput=binaries /p:FileVersion=4.3.2.1</code></pre><br>
<pre><code class="plaintext hljs">...&gt;binaries\Debug\DelphiAutomatedBuild.exe<font></font>
This is RELEASE build<font></font>
This is TRIAL version<font></font>
This file version is 4.3.2.1<font></font>
...&gt;binaries\Release\DelphiAutomatedBuild.exe<font></font>
This is DEBUG build<font></font>
This is TRIAL version<font></font>
This file version is 4.3.2.1</code></pre><br>
<p>Profit!</p><br>
<h3 id="zaklyuchenie"></h3><br>
<p>     Delphi-  ,      ,   ,   ,          ,      ,       .   ,        (  ),        .</p><br>
<p>     </p><br>
<ol>
<li>     (  FixInsight,  !)   </li>
<li>  unit-  Delphi (,    ))).       )</li>
<li> ""  Delphi-  GitLab CI</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as well as how you can use the WinDbg debugger, for example, to find the reasons for applications crashing / crashing due to libraries written in Delphi (well, of course, how to integrate the formation of PDB files necessary for this into auto-assembly)</font></font></li>
</ol><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Z.Y. </font><font style="vertical-align: inherit;">I will be happy to answer any questions, including in a telegram, both </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in PM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and in the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Delphi_Lazarus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@DelphiCommunity chats</font></font></a></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en489948/index.html">News from the world of OpenStreetMap No. 499 (04.02.2020-10.02.2020)</a></li>
<li><a href="../en489952/index.html">Live and motivating desktop wallpapers</a></li>
<li><a href="../en489954/index.html">Seagate SkyHawk AI - huge and vindictive</a></li>
<li><a href="../en489956/index.html">We animate RecyclerView easily without switching to ViewPager2</a></li>
<li><a href="../en489958/index.html">Explanation: why wc on Haskell turned out to be ‚Äúfaster‚Äù than the analogue on C</a></li>
<li><a href="../en489962/index.html">Data Distribution in Apache Ignite</a></li>
<li><a href="../en489968/index.html">We catch the degradation of AA and AAA batteries at currents of 0.3 from the capacitance</a></li>
<li><a href="../en489970/index.html">Programmer, Pack and John Steinbeck</a></li>
<li><a href="../en489974/index.html">Kha vs HTML5: Compiling JavaScript in C ++</a></li>
<li><a href="../en489984/index.html">AMA about udalenka: ask - we answer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>