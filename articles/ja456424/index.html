<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏼 🚐 🐪 Utreexo：大量のUTXOビットコインの圧縮 🥌 👩🏻‍🤝‍👨🏼 👨🏻‍🚒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは、ハブル！
 

ビットコインネットワークでは、すべてのノードが多数のUTXOについてコンセンサスによって合意します。つまり、使用できるコインの数、使用者、使用条件は何ですか。UTXOのセットは、バリデータノードに最低限必要なデータセットです。これがないと、ノードは、受信トランザクションと...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Utreexo：大量のUTXOビットコインの圧縮</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456424/"><p><img src="https://habrastorage.org/webt/5_/dt/be/5_dtbegl1errsyauglpuftz1xus.png"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは、ハブル！</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビットコインネットワークでは、すべてのノードが多数のUTXOについてコンセンサスによって合意します。つまり、使用できるコインの数、使用者、使用条件は何ですか。</font><font style="vertical-align: inherit;">UTXOのセットは、バリデータノードに最低限必要なデータセットです。これがないと、ノードは、受信トランザクションとそれらを含むブロックの有効性を確認できません。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この点で、このセットの格納された表現を減らすためにあらゆる方法で試みが行われ、セキュリティの保証を失うことなくそれが圧縮されます。</font><font style="vertical-align: inherit;">保存されるデータの量が少ないほど、検証ノードのディスク領域の要件が低くなり、検証ノードの起動が安価になり、ネットワークを拡張してネットワークの安定性を向上させることができます。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このノートでは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lightning Network Paperの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">共著者</font><font style="vertical-align: inherit;">である</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thaddeus Dryja</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utreexo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">からの最近の提案のRustプロトタイプをキャプチャし</font><font style="vertical-align: inherit;">ます。これは</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">、ビットコインUTXOセット用に最適化された動的ハッシュベースのアキュムレータ</font></a><font style="vertical-align: inherit;">であり、検証ノードのディスク領域要件を削減します。</font></font></p><a name="habracut"></a><br>
<h2 id="v-chyom-problema"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何が問題ですか？</font></font></h2><br>
<p>       .  "  "           .  Bitcoin         — UTXO-set.       ,        ,    ,     ""  ""    ,     (,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">CoinJoin</a>).</p><br>
<p>    (,   )    .   Bitcoin      200   ,   .     ,  4 ,       -   .      - ,             (. ).</p><br>
<p>  (SPV)           (UTXO-set),   .</p><br>
<h2 id="utxo-i-utxo-set">UTXO  UTXO-set</h2><br>
<p>UTXO (Unspent Transaction Output) —   ,     ,   .           (spend)    UTXO-set.</p><br>
<p> UTXO   :</p><br>
<ul>
<li>coinbase-  :   UTXO     </li>
<li> :   UTXO,       UTXO</li>
</ul><br>
<p>   UTXO:<br>
<img src="https://habrastorage.org/webt/rw/ey/fh/rweyfhzcoy-cgcigbrlfv0qbypi.gif"> </p><br>
<p>       ()    UTXO,     .</p><br>
<p> -,      (double spend),    <strong></strong> UTXO   <strong></strong>  <strong></strong> .</p><br>
<p>    :</p><br>
<ul>
<li>  UTXO-set</li>
<li>  UTXO-set</li>
<li>    UTXO  </li>
</ul><br>
<p>        ,        ,          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>.</p><br>
<h2 id="akkumulyatory-dlya-utxo">  UTXO</h2><br>
<p>      UTXO <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>.</p><br>
<p>UTXO-set   ,       (IBD, initial block download),      ,               .      200         .  ,   IBD ,    UTXO-set    4 .</p><br>
<p>,   ,           ,           ,        .</p><br>
<p>     .   ,  ,     <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mn>1</mn><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.745ex" height="2.634ex" viewBox="0 -809.3 2043 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/post/456424/&amp;usg=ALkJrhjwFfiUvKGzp4-espG1UcJtbiLDeA#MJMATHI-4F" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/post/456424/&amp;usg=ALkJrhjwFfiUvKGzp4-espG1UcJtbiLDeA#MJMAIN-28" x="763" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/post/456424/&amp;usg=ALkJrhjwFfiUvKGzp4-espG1UcJtbiLDeA#MJMAIN-31" x="1153" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/post/456424/&amp;usg=ALkJrhjwFfiUvKGzp4-espG1UcJtbiLDeA#MJMAIN-29" x="1653" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-1">O(1)</script>,          ,  <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.724ex" height="2.634ex" viewBox="0 -809.3 4186.5 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/post/456424/&amp;usg=ALkJrhjwFfiUvKGzp4-espG1UcJtbiLDeA#MJMATHI-4F" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/post/456424/&amp;usg=ALkJrhjwFfiUvKGzp4-espG1UcJtbiLDeA#MJMAIN-28" x="763" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/post/456424/&amp;usg=ALkJrhjwFfiUvKGzp4-espG1UcJtbiLDeA#MJMATHI-6C" x="1153" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/post/456424/&amp;usg=ALkJrhjwFfiUvKGzp4-espG1UcJtbiLDeA#MJMATHI-6F" x="1451" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/post/456424/&amp;usg=ALkJrhjwFfiUvKGzp4-espG1UcJtbiLDeA#MJMATHI-67" x="1937" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/post/456424/&amp;usg=ALkJrhjwFfiUvKGzp4-espG1UcJtbiLDeA#MJMAIN-28" x="2417" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/post/456424/&amp;usg=ALkJrhjwFfiUvKGzp4-espG1UcJtbiLDeA#MJMATHI-6E" x="2807" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/post/456424/&amp;usg=ALkJrhjwFfiUvKGzp4-espG1UcJtbiLDeA#MJMAIN-29" x="3407" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/post/456424/&amp;usg=ALkJrhjwFfiUvKGzp4-espG1UcJtbiLDeA#MJMAIN-29" x="3797" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-2">O(log(n))</script>,  n —   .</p><br>
<p>           (inclusion proof)       .</p><br>
<p>  <strong></strong>         .</p><br>
<p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">RSA-,  Boneh, Bunz, Fisch   2018 </a>.       ,    <em> </em> (trusted setup).          trustless-  Bitcoin,              UTXO,    UTXO-set    .</p><br>
<h3 id="utreexo">Utreexo</h3><br>
<p> Thaddeus Dryja  Utreexo   <strong></strong>  <strong></strong> trusted-setup.</p><br>
<p>Utreexo       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>    ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Efficient asynchronous accumulators for distributed pki</a>,      .</p><br>
<h4 id="logicheskaya-struktura-akkumulyatora">  </h4><br>
<p>        .    .                 . </p><br>
<p> ,      ,     ,             . ,          ,    ,      <em>     </em>. </p><br>
<p> ,    Utreexo —     (Merkle root), <em>     </em>.</p><br>
<p>     <code>Vec&lt;Option&lt;Hash&gt;&gt;</code>.   <code>Option&lt;Hash&gt;</code>   ,     ,  ,        .</p><br>
<pre><code class="rust hljs"><span class="hljs-comment">/// SHA-256 </span>
<span class="hljs-meta">#[derive(Copy, Clone, Hash, Eq, PartialEq)]</span>
<span class="hljs-keyword">pub</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Hash</span></span>(<span class="hljs-keyword">pub</span> [<span class="hljs-built_in">u8</span>; <span class="hljs-number">32</span>]);<font></font>
<font></font>
<span class="hljs-meta">#[derive(Debug, Clone)]</span>
<span class="hljs-keyword">pub</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Utreexo</span></span> {
    <span class="hljs-keyword">pub</span> roots: <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">Option</span>&lt;Hash&gt;&gt;,<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">impl</span> Utreexo {
    <span class="hljs-keyword">pub</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">new</span></span>(capacity: <span class="hljs-built_in">usize</span>) -&gt; <span class="hljs-keyword">Self</span> {<font></font>
        Utreexo {<font></font>
            roots: <span class="hljs-built_in">vec!</span>[<span class="hljs-literal">None</span>; capacity],<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<h4 id="dobavlenie-elementov"> </h4><br>
<p>    <code>parent()</code>,   -    . </p><br>
<div class="spoiler"><b class="spoiler_title"> parent()</b><div class="spoiler_text"><p>    ,         ,     -:</p><br>
<pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">hash</span></span>(bytes: &amp;[<span class="hljs-built_in">u8</span>]) -&gt; Hash {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> sha = Sha256::new();<font></font>
    sha.input(bytes);<font></font>
    <span class="hljs-keyword">let</span> res = sha.result();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> res_bytes = [<span class="hljs-number">0u8</span>; <span class="hljs-number">32</span>];<font></font>
    res_bytes.copy_from_slice(res.as_slice());<font></font>
<font></font>
    Hash(res_bytes)<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">parent</span></span>(left: &amp;Hash, right: &amp;Hash) -&gt; Hash {
    <span class="hljs-keyword">let</span> concat = left<font></font>
        .<span class="hljs-number">0</span><font></font>
        .into_iter()<font></font>
        .chain(right.<span class="hljs-number">0</span>.into_iter())<font></font>
        .map(|b| *b)<font></font>
        .collect::&lt;<span class="hljs-built_in">Vec</span>&lt;_&gt;&gt;();<font></font>
<font></font>
    hash(&amp;concat[..])<font></font>
}</code></pre><br>
<p> ,    ,  Charles Bouillaguet, Pierre-Alain Fouque, Adi Shamir,  Sebastien Zimmer <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Second preimage attacks on dithered hash functions</a>,            .</p></div></div><br>
<p>     ,  ,     .          ,       .</p><br>
<div class="spoiler"><b class="spoiler_title">    </b><div class="spoiler_text"><p>   ,   <code>Update</code>,       .</p><br>
<pre><code class="rust hljs"><span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-keyword">pub</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Update</span></span>&lt;<span class="hljs-symbol">'a</span>&gt; {
    <span class="hljs-keyword">pub</span> utreexo: &amp;<span class="hljs-symbol">'a</span> <span class="hljs-keyword">mut</span> Utreexo,
    <span class="hljs-comment">// ProofStep  ""    </span>
    <span class="hljs-keyword">pub</span> updated: HashMap&lt;Hash, ProofStep&gt;,<font></font>
}</code></pre></div></div><br>
<p>    , :</p><br>
<ul>
<li>     <code>new_roots</code>      ,     :</li>
</ul><br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><pre><code class="rust hljs"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> new_roots = <span class="hljs-built_in">Vec</span>::new();<font></font>
<font></font>
<span class="hljs-keyword">for</span> root <span class="hljs-keyword">in</span> <span class="hljs-keyword">self</span>.roots.iter() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> vec = <span class="hljs-built_in">Vec</span>::&lt;Hash&gt;::new();
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-literal">Some</span>(hash) = root {<font></font>
        vec.push(*hash);<font></font>
    }<font></font>
<font></font>
    new_roots.push(vec);<font></font>
}</code></pre></div></div><br>
<ul>
<li>   ( <code>insertions</code>)    <code>new_roots[0]</code>:</li>
</ul><br>
<p><img src="https://habrastorage.org/webt/8f/ne/jg/8fnejgnqbngrgygwreduomorpni.gif"></p><br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><pre><code class="rust hljs">new_roots[<span class="hljs-number">0</span>].extend_from_slice(insertions);</code></pre></div></div><br>
<ul>
<li> "" (coalescing)       :<br>
<ul>
<li>  ,     :<br>
<ol>
<li>     ,   ,   </li>
<li>     </li>
</ol></li>
</ul></li>
</ul><br>
<p><img src="https://habrastorage.org/webt/df/dl/fm/dfdlfm0iw0tvwxtlomxmrml1ijc.gif"></p><br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><pre><code class="rust hljs"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..new_roots.len() {
    <span class="hljs-keyword">while</span> new_roots[i].len() &gt; <span class="hljs-number">1</span> {
        <span class="hljs-comment">//        </span>
        <span class="hljs-keyword">let</span> a = new_roots[i][new_roots[i].len() - <span class="hljs-number">2</span>];
        <span class="hljs-keyword">let</span> b = new_roots[i][new_roots[i].len() - <span class="hljs-number">1</span>];<font></font>
        new_roots[i].pop();<font></font>
        new_roots[i].pop();<font></font>
        <span class="hljs-keyword">let</span> hash = <span class="hljs-keyword">self</span>.parent(&amp;a, &amp;b);<font></font>
<font></font>
        <span class="hljs-comment">//     </span>
        <span class="hljs-keyword">if</span> new_roots.len() &lt;= i + <span class="hljs-number">1</span> {<font></font>
            new_roots.push(<span class="hljs-built_in">vec!</span>[]);<font></font>
        }<font></font>
<font></font>
        <span class="hljs-comment">//     </span>
        new_roots[i + <span class="hljs-number">1</span>].push(hash);<font></font>
<font></font>
        <span class="hljs-comment">//    ;</span>
        <span class="hljs-comment">//       </span>
        updated.insert(a, ProofStep { hash: b, is_left: <span class="hljs-literal">false</span> });<font></font>
        updated.insert(b, ProofStep {hash: a, is_left: <span class="hljs-literal">true</span> });<font></font>
    }<font></font>
}</code></pre></div></div><br>
<ul>
<li>        </li>
</ul><br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><pre><code class="rust hljs"><span class="hljs-keyword">for</span> (i, bucket) <span class="hljs-keyword">in</span> new_roots.into_iter().enumerate() {
    <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.roots.len() &lt;= i {
        <span class="hljs-keyword">self</span>.roots.push(<span class="hljs-literal">None</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> bucket.is_empty() {
        <span class="hljs-keyword">self</span>.roots[i] = <span class="hljs-literal">None</span>;<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">self</span>.roots[i] = <span class="hljs-literal">Some</span>(bucket[<span class="hljs-number">0</span>]);<font></font>
    }<font></font>
}</code></pre></div></div><br>
<h4 id="sozdanie-dokazatelstva-dlya-dobavlennyh-elementov">    </h4><br>
<p>     (<code>Proof</code>)     (Merkle Path),    <code>ProofStep</code>.     ,   .</p><br>
<pre><code class="rust hljs"><span class="hljs-comment">///         .</span>
<span class="hljs-meta">#[derive(Debug, Copy, Clone)]</span>
<span class="hljs-keyword">pub</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ProofStep</span></span> {
    <span class="hljs-keyword">pub</span> hash: Hash,
    <span class="hljs-keyword">pub</span> is_left: <span class="hljs-built_in">bool</span>,<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">///   .       .</span>
<span class="hljs-meta">#[derive(Debug, Clone)]</span>
<span class="hljs-keyword">pub</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Proof</span></span> {
    <span class="hljs-keyword">pub</span> steps: <span class="hljs-built_in">Vec</span>&lt;ProofStep&gt;,
    <span class="hljs-keyword">pub</span> leaf: Hash,<font></font>
}</code></pre><br>
<p>        ( <code>Update</code>),    ,      .             ,     :</p><br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><pre><code class="rust hljs"><span class="hljs-keyword">impl</span>&lt;<span class="hljs-symbol">'a</span>&gt; Update&lt;<span class="hljs-symbol">'a</span>&gt; {
    <span class="hljs-keyword">pub</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">prove</span></span>(&amp;<span class="hljs-keyword">self</span>, leaf: &amp;Hash) -&gt; Proof {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> proof = Proof {<font></font>
            steps: <span class="hljs-built_in">vec!</span>[],<font></font>
            leaf: *leaf,<font></font>
        };<font></font>
<font></font>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> item = *leaf;
        <span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> <span class="hljs-literal">Some</span>(s) = <span class="hljs-keyword">self</span>.updated.get(&amp;item) {<font></font>
            proof.steps.push(*s);<font></font>
            item = parent(&amp;item, &amp;s);<font></font>
        }<font></font>
<font></font>
        proof<font></font>
    }<font></font>
}</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">  </b><div class="spoiler_text"><p><img src="https://habrastorage.org/webt/8i/2h/gy/8i2hgyqkn8syqa0wdsybg3o9asm.gif"></p></div></div><br>
<h4 id="proverka-dokazatelstva-dlya-elementa">   </h4><br>
<p>    (inclusion proof)      ,        :</p><br>
<pre><code class="rust hljs"><span class="hljs-keyword">pub</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">verify</span></span>(&amp;<span class="hljs-keyword">self</span>, proof: &amp;Proof) -&gt; <span class="hljs-built_in">bool</span> {
    <span class="hljs-keyword">let</span> n = proof.steps.len();
    <span class="hljs-keyword">if</span> n &gt;= <span class="hljs-keyword">self</span>.roots.len() {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">let</span> expected = <span class="hljs-keyword">self</span>.roots[n];
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-literal">Some</span>(expected) = expected {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> current_parent = proof.leaf;
        <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> proof.steps.iter() {<font></font>
            current_parent = <span class="hljs-keyword">if</span> s.is_left {<font></font>
                parent(&amp;s.hash, &amp;current_parent)<font></font>
            } <span class="hljs-keyword">else</span> {<font></font>
                parent(&amp;current_parent, &amp;s.hash)<font></font>
            };<font></font>
        }<font></font>
<font></font>
        current_parent == expected<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-literal">false</span><font></font>
    }<font></font>
}</code></pre><br>
<p>:</p><br>
<div class="spoiler"><b class="spoiler_title">    A</b><div class="spoiler_text"><p><img src="https://habrastorage.org/webt/sx/49/dz/sx49dzfpgnzqv-x6-hl1fxgey1a.gif"></p></div></div><br>
<h4 id="udalenie-elementov"> </h4><br>
<p>         ,    .    ,      ,        .</p><br>
<p> :</p><br>
<ol>
<li>   ,    ,           </li>
<li>       ;      </li>
<li>  ,      </li>
<li>   ,    ,            </li>
</ol><br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><pre><code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">delete</span></span>(&amp;<span class="hljs-keyword">self</span>, proof: &amp;Proof, new_roots: &amp;<span class="hljs-keyword">mut</span> <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">Vec</span>&lt;Hash&gt;&gt;) -&gt; <span class="hljs-built_in">Result</span>&lt;(), ()&gt; {
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.roots.len() &lt; proof.steps.len() || <span class="hljs-keyword">self</span>.roots.get(proof.steps.len()).is_none() {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">Err</span>(());<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> height = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> hash = proof.leaf;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> s;<font></font>
<font></font>
    <span class="hljs-keyword">loop</span> {
        <span class="hljs-keyword">if</span> height &lt; new_roots.len() {
            <span class="hljs-keyword">let</span> (index, ok) = <span class="hljs-keyword">self</span>.find_root(&amp;hash, &amp;new_roots[height]);
            <span class="hljs-keyword">if</span> ok {
                <span class="hljs-comment">// Remove hash from new_roots</span><font></font>
                new_roots[height].remove(index);<font></font>
<font></font>
                <span class="hljs-keyword">loop</span> {
                    <span class="hljs-keyword">if</span> height &gt;= proof.steps.len() {
                        <span class="hljs-keyword">if</span> !<span class="hljs-keyword">self</span>.roots[height]<font></font>
                            .and_then(|h| <span class="hljs-literal">Some</span>(h == hash))<font></font>
                            .unwrap_or(<span class="hljs-literal">false</span>)<font></font>
                        {<font></font>
                            <span class="hljs-keyword">return</span> <span class="hljs-literal">Err</span>(());<font></font>
                        }<font></font>
<font></font>
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">Ok</span>(());<font></font>
                    }<font></font>
<font></font>
                    s = proof.steps[height];<font></font>
                    hash = <span class="hljs-keyword">self</span>.parent(&amp;hash, &amp;s);<font></font>
                    height += <span class="hljs-number">1</span>;<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">if</span> height &gt;= proof.steps.len() {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">Err</span>(());<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">while</span> height &gt; new_roots.len() {<font></font>
            new_roots.push(<span class="hljs-built_in">vec!</span>[]);<font></font>
        }<font></font>
<font></font>
        s = proof.steps[height];<font></font>
        new_roots[height].push(s.hash);<font></font>
        hash = <span class="hljs-keyword">self</span>.parent(&amp;hash, &amp;s);<font></font>
        height += <span class="hljs-number">1</span>;<font></font>
    }<font></font>
}</code></pre></div></div><br>
<p>   "":<br>
<img src="https://habrastorage.org/webt/pi/uf/rb/piufrb9ivxabdm_45vbmohgm5os.gif"></p><br>
<h2 id="integraciya-v-suschestvuyuschuyu-set">   </h2><br>
<p>  ,          UTXO,      UTXO-set.      .</p><br>
<p> -,    UTXO <em></em> (compact-state node),     — <em></em> (full node).           ,       UTXO,    ,    — .            Utreexo,            Bitcoin.</p><br>
<p>       ,      — <em></em>. - —   ,       Utreexo     <strong></strong> UTXO  UTXO-set.                .              .    :    <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>2</mn><mi>n</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.557ex" height="2.009ex" viewBox="0 -755.5 1101 865.1" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/post/456424/&amp;usg=ALkJrhjwFfiUvKGzp4-espG1UcJtbiLDeA#MJMAIN-32" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/post/456424/&amp;usg=ALkJrhjwFfiUvKGzp4-espG1UcJtbiLDeA#MJMATHI-6E" x="500" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-3">2n</script> ,    <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.141ex" height="2.634ex" viewBox="0 -809.3 2644 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/post/456424/&amp;usg=ALkJrhjwFfiUvKGzp4-espG1UcJtbiLDeA#MJMATHI-6C" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/post/456424/&amp;usg=ALkJrhjwFfiUvKGzp4-espG1UcJtbiLDeA#MJMATHI-6F" x="298" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/post/456424/&amp;usg=ALkJrhjwFfiUvKGzp4-espG1UcJtbiLDeA#MJMATHI-67" x="784" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/post/456424/&amp;usg=ALkJrhjwFfiUvKGzp4-espG1UcJtbiLDeA#MJMAIN-28" x="1264" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/post/456424/&amp;usg=ALkJrhjwFfiUvKGzp4-espG1UcJtbiLDeA#MJMATHI-6E" x="1654" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/post/456424/&amp;usg=ALkJrhjwFfiUvKGzp4-espG1UcJtbiLDeA#MJMAIN-29" x="2254" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-4">log(n)</script>    ,  n —   UTXO.</p><br>
<h3 id="arhitektura-seti"> </h3><br>
<p><img src="https://habrastorage.org/webt/fj/at/9t/fjat9tzhyxy_ncflmmzgt8ere_4.gif"></p><br>
<p>             .      ,      . -    ,      Utreexo      <strong></strong> UTXO   .        ,           —   .       ,         :       .   - ,      ,    UTXO      ,                -.</p><br>
<h2 id="zaklyuchenie"></h2><br>
<p>   Utreexo       Rust.   ,       .       ,       UTXO,             .        ,     (      )         .</p><br>
<p><strong></strong>:</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">GitHub  Utreexo  Rust</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Thaddeus Dryja</a> — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Utreexo: a dynamic hash-based accumulator optimized for the Bitcoin UTXO set</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記事からのアニメーションアートワーク</font></font></a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja456412/index.html">Yandexからの論争の的となっている革新-手紙を通じてアカウントにログイン</a></li>
<li><a href="../ja456414/index.html">データセンターでの火災に対する保護、またはデータの保存方法</a></li>
<li><a href="../ja456416/index.html">すべての本にアジャイル</a></li>
<li><a href="../ja456418/index.html">ビデオゲームの不正行為の簡単な歴史</a></li>
<li><a href="../ja456422/index.html">Styled Components v5の新バージョンの発表：Animal Grin</a></li>
<li><a href="../ja456426/index.html">BASS-ウイルス対策署名の自動合成のためのフレームワーク</a></li>
<li><a href="../ja456428/index.html">データ分析へのBIアプローチの実装方法：実用的な推奨事項</a></li>
<li><a href="../ja456430/index.html">技術的負債の永遠の問題</a></li>
<li><a href="../ja456432/index.html">セキュリティウィーク25：Evernoteの脆弱性と何百ものハッキングされたオンラインストア</a></li>
<li><a href="../ja456434/index.html">未来の職業：「あなたは誰が火星で働きますか？」</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>