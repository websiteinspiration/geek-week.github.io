<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤟🏼 👨🏿‍✈️ 📌 Windows PowerShellとは何で、何を食べますか？パート5：外部オブジェクトへのアクセス ‼️ 🐎 🕜</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Windowsオペレーティングシステムは、さまざまなオブジェクトインフラストラクチャをサポートしています。アプリケーションプログラミングインターフェイス（API）を使用してそれらにアクセスできますが、本格的なアプリケーションの開発が常に正当化されるとは限りません。PowerShellには、.NET、...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Windows PowerShellとは何で、何を食べますか？パート5：外部オブジェクトへのアクセス</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/498478/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/-b/i_/73/-bi_73lwdxmnzvtveeghrwvtqay.png"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windowsオペレーティングシステムは、さまざまなオブジェクトインフラストラクチャをサポートしています。</font><font style="vertical-align: inherit;">アプリケーションプログラミングインターフェイス（API）を使用してそれらにアクセスできますが、本格的なアプリケーションの開発が常に正当化されるとは限りません。</font><font style="vertical-align: inherit;">PowerShellには、.NET、COM、WMI（CIM）、およびADSIオブジェクトにインタラクティブにアクセスできる特別なコマンドレットがあります。</font><font style="vertical-align: inherit;">では</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シリーズの第四の部分、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我々は、.NETのコアクラスを中心とした基礎を学び、今は話題を深め、外部のオブジェクトとPowerShellの相互作用の機能を理解したいです。</font></font><a name="habracut"></a><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目次：</font></font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON、XML、CSVでの</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作業WMIおよびCIMでの</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作業COMオブジェクトでの</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作業ADSIディレクトリサービスでの作業</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出力のフォーマット</font></font></a><br>
<br>
<a name="section1"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON、XML、CSVを操作する</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PowerShellスクリプトでは、多くの場合、JSON、XML、およびCSVデータを解析する必要があります。通常、この必要性は、インターネットサービスまたは構成ファイルを操作するときに発生します。一部の管理者は正規表現を使用してデータを解析しようとしますが、そのような犠牲を払う必要はありません。PowerShellには、両方向の変換のための特別なコマンドレットがあります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ep/q6/tr/epq6trkxgw_sfw21p1wmfixyrfk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JSON形式を使用すると、さまざまなオブジェクトを記述できます。基本的には、ネスト可能なハッシュテーブルです。</font><font style="vertical-align: inherit;">PowerShellを使用してJSONオブジェクトを.NETオブジェクトに変換するのは簡単です。</font><font style="vertical-align: inherit;">インターネットサービスは通常、美しくフォーマットされたファイルではなく非常に長い行を提供するため、この変換はインタラクティブモードでの作業にも役立ちます。</font><font style="vertical-align: inherit;">以下の例では、複数行のテキスト変数を使用してJSONオブジェクトを記述しています。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$user</span> = <span class="hljs-string">@"
{
   "firstName": "Ivan",
   "lastName": "Danko",
   "address": {
       "streetAddress": "Kremlin",
       "city": "Moscow"
   },
   "phoneNumbers": [
       "+7 495 1234567",
       "+7 499 1234567"
   ]
}
"@</span> | <span class="hljs-built_in">ConvertFrom-Json</span>
</code></pre><br>
<img src="https://habrastorage.org/webt/vu/2j/x6/vu2jx6vrks90qvsuoehs6ky43ke.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
逆問題は同様の方法で解決されます：</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$file</span> = <span class="hljs-built_in">Get-ChildItem</span> C:\Windows\System32\notepad.exe
<span class="hljs-variable">$file</span>.VersionInfo | <span class="hljs-built_in">ConvertTo-Json</span></code></pre><br>
<img src="https://habrastorage.org/webt/rd/tb/dq/rdtbdqlfwsepqmnggw_2uk7omkw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果のJSON形式の文字列は、ネットワーク経由で別のアプリケーションに簡単に送信できます。</font><font style="vertical-align: inherit;">たとえば、一部のRESTfulサービスを使用できます。</font><font style="vertical-align: inherit;">ConvertFrom-Csv、ConvertTo-Csv、およびConvertTo-Xmlコマンドレットを使用した作業は、ほぼ同じ方法で構築されています。読者自身で検討することをお勧めします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
XMLとCSVを操作するには、他のコマンドレットが必要です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jz/hy/m7/jzhym7nqvb5id7fvdys9ao59meq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのツールを使用して、バイナリオブジェクトをテキスト形式に変換すると、プロパティではなくメソッドの値のみが保存されることを理解する必要があります。</font><font style="vertical-align: inherit;">PowerShellを使用してJSON、XML、またはCSVデータを.NETオブジェクトに変換できるのは、有効な場合のみです。</font></font><br>
<br>
<a name="section2"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WMIとCIMを使用する</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windows Management Instrumentation（WMI）は、Microsoftが開発し、Windowsに適合させたWBEM（Webベースのエンタープライズ管理）標準の実装です。これは、企業の分散情報環境を監視し、そのコンポーネントを管理するためのユニバーサルソリューションを作成するという考えに基づいています。次に、WBEMデータ構造はCommon Information Model（CIM）に基づいています。これは、コンピューターシステムの表現に対するオブジェクト指向アプローチを実装します。 WindowsでのWMIのさらなる開発とサポートは中止されました;インフラストラクチャを管理するための同様のメカニズム-CIMオブジェクトを使用することをお勧めします。それらを操作するために、PowerShell 3.0は特別なコマンドレットを導入しました。これをWMIの対応物と並行して検討します。コードにWMIを操作するためのコマンドレット呼び出しが含まれている場合は、可能であればコードを書き直す必要があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h6/io/mw/h6iomwnjjrssdkl_tw7gi0mwjhm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CIMモデル（WMIでも使用されます）のフレームワーク内で、オペレーティングシステムのデータは、プロパティとメソッドを持つクラスの形式で表示されます。クラスは階層的にグループ化され、名前空間テクノロジまたは管理領域によって論理的に関連付けられます。 CIMv2、Default、Secutiry、およびWMIのサブスペースを持つルートRoot名前空間があります。クラス（オブジェクト）のインスタンスを明確に識別し、対応するリソースの状態を説明するために、通常は読み取り専用のクラスプロパティが使用されます。リソースの管理にはメソッドが使用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスインスタンスには、次の形式のフルパスでアクセスできます。</font></font><br>
<br>
<pre><code class="powershell hljs">[\\<span class="hljs-type">ComputerName</span>\<span class="hljs-type">NameSpace</span>][:<span class="hljs-type">ClassName</span>][<span class="hljs-type">.KeyProperty1</span>=<span class="hljs-type">Value1</span>][,<span class="hljs-type">KeyProperty2</span>=<span class="hljs-type">Value2</span>]…]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どこ</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ComputerNameがコンピュータの名前です。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NameSpace-名前空間。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ClassName-クラスの名前。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
KeyProperty1 = Value1、KeyProperty2 = Value2-オブジェクトのプロパティと、それによって識別される値。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PowerShellの前は、単純なWMIツールは存在しませんでした。</font><font style="vertical-align: inherit;">オブジェクトにアクセスするには、高級言語（C ++、Visual Basic、Java Script）でやや複雑なプログラムを作成するか、独自の言語でWMICシェル（WMIコマンドライン、廃止予定）を研究する必要がありました。</font><font style="vertical-align: inherit;">PowerShellを使用すると、平均的なユーザーはコマンドラインまたはスクリプトからWMIオブジェクトにアクセスできます。</font><font style="vertical-align: inherit;">まず、WMIサブシステムに接続し、Get-WmiObjectコマンドレット（別名gwmi）を使用して利用可能なクラスのリストを取得します。</font><font style="vertical-align: inherit;">CIMクラスのリストを取得するには、Get-CimClassコマンドレットを使用します。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-CimClass</span>
<span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-List</span></code></pre><br>
<img src="https://habrastorage.org/webt/g7/1z/wz/g71zwzueejpnyrgwqkoqpxlwn7a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ローカルコンピューター上のクラスをリストしましたが、リモートに接続できます。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-CimClass</span> <span class="hljs-literal">-ComputerName</span> IP- 
<span class="hljs-built_in">Get-CimClass</span> <span class="hljs-literal">-ComputerName</span> _</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
または</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-ComputerName</span> IP- <span class="hljs-literal">-List</span>
<span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-ComputerName</span> _ <span class="hljs-literal">-List</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
既定では、Get-CimClassおよびGet-WmiObjectコマンドレットは、システムを管理するための多数のクラスを格納するRoot \ CIMV2名前空間に接続します。</font><font style="vertical-align: inherit;">名前空間を変更するには、-Namespaceパラメーターを使用します。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-CimClass</span> <span class="hljs-literal">-Namespace</span> Root
<span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-Namespace</span> Root <span class="hljs-literal">-List</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスの名前を知っているので、そのインスタンスを取得することは難しくありません。</font><font style="vertical-align: inherit;">次のコマンドは、Win32_Serviceのすべてのインスタンスを返します。</font><font style="vertical-align: inherit;">ローカルマシンに登録されているサービス：</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-WmiObject</span> Win32_Service</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
他のタイプのオブジェクトと同様に、プロパティとメソッドのリストはGet-Memberを使用して表示されます。</font><font style="vertical-align: inherit;">WMIオブジェクトメソッドには、直接またはInvoke-WmiMethodコマンドレットを使用してアクセスできます。</font><font style="vertical-align: inherit;">WMIオブジェクトのコマンドレットを使用して、並べ替え、フィルター処理、グループ化などを行うこともできます。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-WmiObject</span> Win32_Service | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/pq/rn/nk/pqrnnkbv1abfqzn5hlnsgunzamu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CIMオブジェクト（クラスのインスタンス）を取得するには、Get-CimInstanceコマンドレットを使用します。</font><font style="vertical-align: inherit;">WMIとは異なり、結果のCIMオブジェクト（結果オブジェクトまたはクラスインスタンス）にはクラスメソッドが含まれていません。</font><font style="vertical-align: inherit;">メソッドを直接抽出することはできないため、Invoke-CimMethodコマンドレットを呼び出す必要があります。</font><font style="vertical-align: inherit;">Win32_Serviceクラス（システムで実行されているサービス）と、ローカルマシン上のスプーラーサービスのインスタンスについて考えます。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-CimInstance</span> Win32_service <span class="hljs-literal">-filter</span> <span class="hljs-string">"Name='spooler'"</span> </code></pre><br>
<img src="https://habrastorage.org/webt/qm/jf/cz/qmjfcz-_u-le6js9tibb3qc5y2i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果のオブジェクトの構造を見てみましょう：</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-CimInstance</span> Win32_service <span class="hljs-literal">-filter</span> <span class="hljs-string">"Name='spooler'"</span> | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/t4/uo/ub/t4uoublc7mxrlb6khyrycfozod4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この時点では、CIMオブジェクトを操作するためのコマンドレットの利点は明らかではありません。</font><font style="vertical-align: inherit;">これらは主に分散環境でのリモート作業に関連しており、管理の実際的な問題を解決するためのシリーズの最後の記事で詳しく説明します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WMI固有のツールキットもあります。SQLのようなクエリ言語であるWMIクエリ言語（WQL）です。</font><font style="vertical-align: inherit;">サービスシステムの起動時にすべてのスタートアップを検索するWQLクエリは、次のようになります。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">select</span> * from win32_service <span class="hljs-built_in">where</span> startmode=<span class="hljs-string">"Auto"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PowerShellからは、次のように実行されます。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-Query</span> <span class="hljs-string">'select * from win32_service where startmode="Auto"'</span></code></pre><br>
<img src="https://habrastorage.org/webt/wc/y7/wf/wcy7wfk7619yx_9es0cjz9bi4vw.png"><br>
<br>
<a name="section3"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COMオブジェクトを操作する</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windowsのアプリケーション間の相互作用を確実にするために、オブジェクトをリンクして埋め込む技術（オブジェクトのリンクと埋め込みまたはOLE）が開発されました。その後、OLEオートメーションテクノロジが登場し、どのオートメーションクライアントアプリケーションが他のアプリケーションの機能（オートメーションサーバー）を呼び出すことができるかを支援しました。 OLEおよびOLEオートメーションは、ソフトウェアコンポーネントの単一のバイナリ標準を提供するコンポーネントオブジェクトモデル（COM）のコアテクノロジに基づいていました。これを使用して作成され、オペレーティングシステムに登録されたオブジェクトは、実行可能ファイルまたはダイナミックライブラリを使用して他のアプリケーションで使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
90年代半ば頃、OLEの代わりに、ActiveXという別の用語が使用され始めました。</font><font style="vertical-align: inherit;">.NETプラットフォームが登場する前は、ActiveXテクノロジが重要であると考えられていました。COMオブジェクトは、アプリケーションをWindowsに統合するために引き続き積極的に使用されています。</font><font style="vertical-align: inherit;">オブジェクトにアクセスするには、ProgIDが使用されます。これは、Windowsレジストリへの登録時にオブジェクトに割り当てられるシンボリック識別子です。</font><font style="vertical-align: inherit;">次の形式になります。</font></font><br>
<br>
<pre><code class="powershell hljs">_..</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常、バージョンは表示されません。</font></font><br>
<br>
<pre><code class="powershell hljs">_.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用可能なProgIDの例としては、InternetExplorer.Application（Internet Explorerアプリケーション）、Word.Application（Microsoft Wordアプリケーション）、WScript.Shell（WindowsスクリプトホストまたはWSHスクリプトサーバーオブジェクトモデルのシェルクラス）があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前の記事</font><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">説明した</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">New-Objectコマンドレット</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用してオブジェクトのインスタンスを作成し、</font><font style="vertical-align: inherit;">Get-Memberを使用してその構造を確認できます。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span> = <span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-ComObject</span> WScript.Shell
<span class="hljs-variable">$myshell</span> | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/bk/s5/fh/bks5fhq3q-yhle1fwb4-vjkqpk0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オブジェクトを操作するには、プロパティとメソッドを使用します。</font><font style="vertical-align: inherit;">たとえば、ユーザーのデスクトップにショートカットを作成するには、CreateShortcut（）メソッドを呼び出す必要があります。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$link</span> = <span class="hljs-variable">$myshell</span>.CreateShortcut(<span class="hljs-string">"<span class="hljs-variable">$Home</span>\Desktop\Home.lnk"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ショートカットはCOMオブジェクトでもあることに注意してください。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$link</span> | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/05/d8/4_/05d84_-mbzmfuffczrmr76khfyg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロパティを入力して保存する必要があります。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$link</span>.TargetPath = <span class="hljs-variable">$Home</span>
<span class="hljs-variable">$link</span>.Save()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このようにして、アクティブユーザーのデスクトップにショートカットを作成しました。次に、Shell.Application COMオブジェクトの例を使用して、外部オートメーションサービスの操作を分析します。</font><font style="vertical-align: inherit;">これを使用すると、Windowsエクスプローラーでいくつかのアクションを自動化できます。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>=<span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-ComObject</span> Shell.Application</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
または略して：</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>=<span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-com</span> Shell.Application
<span class="hljs-variable">$myshell</span> | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/__/iu/qy/__iuqyjf29nliwugz-jybihkfj0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Shell.Applicationオブジェクトには、いくつかの異なるウィンドウ管理メソッドがあります。</font><font style="vertical-align: inherit;">たとえば、特定のディレクトリの内容を表示するには、Explore（）を使用します。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>.Explore(<span class="hljs-string">"c:\"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ヘルプシステムはHelp（）メソッドを使用して呼び出されます。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>.Help()</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
検索ダイアログを呼び出すには、FindFiles（）、FindComputer（）、FindPrinter（）の3つのメソッドもあります。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>.FindFiles()
<span class="hljs-variable">$myshell</span>.FindComputer()
<span class="hljs-variable">$myshell</span>.FindPrinter()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FileRun（）メソッドを使用してプログラム起動ダイアログを開くことができます。日付/時刻設定ウィンドウを呼び出すには、SetTime（）メソッドが必要です。</font><font style="vertical-align: inherit;">たとえば、開いているウィンドウを管理するために、タスクバー設定ウィンドウ、使用可能なcplファイルの1つを示すコントロールパネル要素を呼び出すメソッドがあります。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>.MinimizeAll()
<span class="hljs-variable">$myshell</span>.UndoMinimizeAll()
<span class="hljs-variable">$myshell</span>.TileHorizontally()
<span class="hljs-variable">$myshell</span>.TileVertically()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windows（）メソッドを使用すると、エクスプローラーまたはInternet Explorerで開いているウィンドウのコレクションにアクセスできます。</font><font style="vertical-align: inherit;">このコレクションで使用できるプロパティとメソッドを見てみましょう。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>.Windows() | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/dq/ls/yo/dqlsyokgkrtk6rc-okuskmpwsvo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
他にも便利なCOMオブジェクトがあり、その数はシステムにインストールされているソフトウェアによって異なります。</font><font style="vertical-align: inherit;">かつて、Windowsの主な自動化ツールはWSHスクリプトサーバーでした。そのオブジェクトモデルにはCOMオブジェクトも含まれています。これは、既に説明したWScript.NetworkおよびWScript.Shellのネットワーク機能と連携するように設計されています。</font><font style="vertical-align: inherit;">後者は、デスクトップにショートカットを作成するだけでなく、たとえば、メッセージやボタンを含む情報ウィンドウを表示したり、アプリケーションを切り替えたり、プログラムを起動したり、キーストロークをシミュレートしたりすることができます。</font></font><br>
<br>
<a name="section4"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ADSI Directoryサービスの操作</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、カタログとは、一部のオブジェクトに関するデータが格納されている情報源を指します。ディレクトリサービスとは、格納されたオブジェクトにアクセスして操作できるようにする分散型コンピューターシステムの一部を意味します。ディレクトリサービスは、ネットワークオブジェクトとそれらを操作するサービスに関するデータを組み合わせることができます。これは、ネットワークリソースと対話するための単一のエントリポイントを表します。異種コンピュータネットワークには、このようなサービスが多数存在する可能性があります。非ドメインコンピュータ用のローカルSAM（セキュリティアカウントマネージャ）、Active Directoryなどです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さまざまなディレクトリサービスとのやり取りにはさまざまなツールが必要であり、不便が生じます。 MicrosoftはWindows 2000から、特定のネットワークアクセスプロトコルに依存しないオペレーティングシステム用の統合Active Directoryサービスインターフェイス（ADSI）テクノロジを導入しました。オブジェクトを検索するために、ディレクトリに名前空間が定義されています。異なるディレクトリサービスは異なる命名方法を使用するため、ADSIはオブジェクトを一意に識別する規則を定義します。 2部構成のバインディング文字列またはADsPathの概念が導入されました。名前の最初の部分はディレクトリサービス（ADSIプロバイダー）を定義し、2番目の部分はディレクトリ内のオブジェクトの場所を定義します。次に、さまざまなADSIプロバイダーを指定する例を示し</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。LDAP：//</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAPベースのディレクトリサービスに使用されます。</font><font style="vertical-align: inherit;">Active Directoryの場合。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinNT：//</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ローカルコンピュータに使用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PowerShellでADSIを操作するための特別なコマンドレットはありません。</font><font style="vertical-align: inherit;">代わりに、キャスト演算子[ADSI]が使用され、その後にバインディング文字列が続きます。</font><font style="vertical-align: inherit;">たとえば、ドメインtest.ruからユーザーIvanovに接続するには、次の構成が必要です。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$user</span> = [<span class="hljs-type">ADSI</span>]<span class="hljs-string">"LDAP://CN=Ivanov,DC=TEST,DC=RU"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ローカルアカウントを使用するには、対応する名前でコンピューターに接続する必要があります（ローカルコンピューターに接続するには、名前の代わりにドットを使用します）。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$computer</span> = [<span class="hljs-type">ADSI</span>]<span class="hljs-string">"WinNT://."</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、ローカルマシンに新しいユーザーIvanovを作成します。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$user</span> = <span class="hljs-variable">$computer</span>.Create(<span class="hljs-string">"user"</span>,<span class="hljs-string">"Ivanov"</span>)
<span class="hljs-variable">$user</span>.Put(<span class="hljs-string">"Description"</span>,<span class="hljs-string">"  PowerShell"</span>)
<span class="hljs-variable">$user</span>.SetInfo()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に接続します。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$user1</span> = [<span class="hljs-type">ADSI</span>]<span class="hljs-string">"WinNT://./Ivanov,user"</span>
<span class="hljs-variable">$user1</span>.Description</code></pre><br>
<img src="https://habrastorage.org/webt/pb/9l/5m/pb9l5mpw09oocoetnw3x4iawzmm.png"><br>
<br>
<a name="section5"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出力フォーマット</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インタラクティブな作業では、多くの場合、データを表示する必要があります。他のシェルでは、コマンドとユーティリティ自体が出力のフォーマットに関与していますが、関数とコマンドレットによって返されるバイナリオブジェクトは通常、これを行う方法を知りません。 PowerShellでは、パイプラインを通じてオブジェクトをフィードする4つの特別なコマンドレットによって出力がフォーマットされます。 Get-Helpを使用してより詳細な情報を取得できます：</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Format-Table</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、オブジェクトのプロパティの値または計算された値を列に含むテーブルの形式で出力をフォーマットします。データをグループ化する機能がサポートされています。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Format-List</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、オブジェクトをプロパティのリストとして表示します。各プロパティは新しい行に表示されます。データをグループ化する機能がサポートされています。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォーマットカスタム</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カスタムビューを使用して出力をフォーマットします。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Format-Wide</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、各オブジェクトの1つのプロパティのみが表示されるワイドテーブルの形式でオブジェクトをフォーマットします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リストされたコマンドレットが呼び出されない場合、表示されるデータのタイプに適したフォーマットモジュールが使用されます。表示ルールは、$ PSHomeディレクトリにある拡張子.ps1xmlが付いたXML形式の構成ファイルに保存されます。それらのリストは、次のコマンドを使用して取得できます。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">dir</span> <span class="hljs-variable">$pshome</span>\*format*.ps1xm</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
構成ファイルを手動で編集することはお勧めしません。独自のファイルを作成し、Update-FormatDataコマンドレットを使用してダウンロードしたファイルのリストに含めることをお勧めします。必要なタイプのデフォルトのフォーマッターが定義されていない場合、PowerShellはオブジェクトのプロパティを画面のリストに表示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、PowerShellでのオブジェクトの操作についての説明は終わりです。シリーズの最後の記事は、企業の分散情報環境の管理に関する実際的な問題の解決に向けられます。その中で、説明されているすべてのツールは私たちにとって有用です。主な焦点は、CIMオブジェクトとWMIとの比較です。過去のパーツは以下のリンクからご覧いただけます。</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> 1:   Windows PowerShell</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> 2:     Windows PowerShell</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> 3:      ,  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> 4:   ,  </a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/iq/fi/b4/iqfib45pgphfrxv--zfemt0qnmw.jpeg"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja498458/index.html">仮想バックグラウンドとオープンソースツールを使用したビデオ通話</a></li>
<li><a href="../ja498462/index.html">バナー付きの無限スクロール、または3つのビューを使用する方法</a></li>
<li><a href="../ja498466/index.html">レーザーとセンサーが裁判官を緊張させ続ける方法</a></li>
<li><a href="../ja498472/index.html">単一ページアプリケーションDockerイメージ</a></li>
<li><a href="../ja498476/index.html">アクセシビリティ 障害を持つユーザーがアプリケーションにアクセスできるようにする方法</a></li>
<li><a href="../ja498482/index.html">状況：米国のプロバイダーは、データをダウンロードするためのしきい値を削除するように求められます-最終的に</a></li>
<li><a href="../ja498484/index.html">Wi-Fi 6とHuawei P40：接続はどこですか？</a></li>
<li><a href="../ja498486/index.html">狭いニッチで検索広告の英語のセマンティクスを拡張する方法</a></li>
<li><a href="../ja498490/index.html">あなたがより良いリーダーになることを可能にする効果的な認証システム</a></li>
<li><a href="../ja498492/index.html">ハニー、私たちは官僚主義を殺します：デジタル化がサプライヤーとX5の間の対話をどのように変えているか</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>