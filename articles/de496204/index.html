<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨 🏆 🤲🏻 CI / CD-Prozessaktualisierung: Vorbereitung und Planung 😴 👂🏿 🚜</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Im Jahr 2020 ist es wahrscheinlich ziemlich schwierig, ein Projekt in einer Stapelbeschreibung zu finden, das keines der folgenden Wörter enthält: IaC...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>CI / CD-Prozessaktualisierung: Vorbereitung und Planung</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496204/"><img src="https://habrastorage.org/webt/vl/jg/11/vljg11dfzemfbyfy8oexvw73eyq.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Jahr 2020 ist es wahrscheinlich ziemlich schwierig, ein Projekt in einer Stapelbeschreibung zu finden, das keines der folgenden Wörter enthält: IaC, Microservices, Kubernetes, Docker, aws / azure / gcloud, Blockchain, ML, VR usw. </font><font style="vertical-align: inherit;">Und das ist großartig! </font><font style="vertical-align: inherit;">Fortschritt steht nicht still. </font><font style="vertical-align: inherit;">Wir wachsen, unsere Projekte wachsen mit uns, es erscheinen bequemere und funktionalere Werkzeuge, die moderne Probleme lösen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Guten Tag. Also wollte ich diesen Artikel beginnen. Aber dann habe ich einige Dinge überprüft, mit meinen Kollegen gesprochen und festgestellt, dass ich falsch liegen würde. Es gibt immer noch Projekte, die bereits über 15 Jahre alt sind, mit Managern und Teilnehmern, die alte Gläubige sind, und dementsprechend verfügen diese Projekte über einen alten Technologie-Stack, der in einem bestehenden Zoo nur schwer zu pflegen ist. Und aus irgendeinem Grund kann dieses Projekt nicht global aktualisiert werden (der Kunde ist ein Starover, es gibt kein Update, das Projekt ist sehr groß und die Migration verzögert sich oder jeder ist mit allem zufrieden), und Sie müssen es unterstützen. Noch unangenehmer, wenn ein ähnliches Projekt noch aktiv entwickelt wird. Es ist wie ein Schneeball. Der Kunde und die Öffentlichkeit benötigen Funktionen, der Code muss bereitgestellt werden, die Server müssen beachtet und gepflegt werden ... Aber das Bitpack - im Allgemeinen unterstützt es </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kein Quecksilber mehr</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ein solcher Fall wird zur Prüfung vorgeschlagen.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was berücksichtigt wird: Konvertieren von mercurial-git, Verschieben von CI von CruiseControl.NET nach TeamCity, von git-Bereitstellung zu Octopus mit einer </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kleinen</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Beschreibung des gesamten Prozesses. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Text ist sehr viel geworden, daher wird er in separate Teile unterteilt, um die Wahrnehmung zu erleichtern. </font><font style="vertical-align: inherit;">Es wird ein Inhaltsverzeichnis geben. </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teil 1: Was ist, warum ist es nicht so, Planung, ein kleiner Schlag. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich würde diesen Teil als nahezu technisch bezeichnen. </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teil 2: Teamcity. </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teil 3: Octopus Deploy. </font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Teil 4: hinter den Kulissen. </font><font style="vertical-align: inherit;">Unangenehme Momente, Pläne für die Zukunft, möglicherweise FAQ. </font><font style="vertical-align: inherit;">Höchstwahrscheinlich kann es auch als nahezu technisch bezeichnet werden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich würde dies aus vielen Gründen nicht als Leitfaden für Wiederholungen bezeichnen: unzureichendes Eintauchen in die Projektprozesse aufgrund von Zeitmangel, unzureichendes Üben solcher Dinge, ein riesiger Monolith, in dem alle Teilprojekte eng miteinander verflochten sind, und eine Reihe anderer Nuancen, die Sie zum Brennen, Staunen und Aushalten bringen , aber auf keinen Fall bitte nicht. </font><font style="vertical-align: inherit;">Aufgrund der Merkmale des Projekts (es ist ziemlich einzigartig) werden einige Schritte exklusiv für diesen Fall zugeschnitten.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klassische Einführung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir hatten ein Quecksilber-Repository, mehr als 300 (offen!) Brunchs, ccnet, ein weiteres ccnet + git (für Bereitstellungen) und eine ganze Reihe von Projektmodulen mit eigenen Konfigurationen und einzelnen Clients, vier Umgebungen und einer ganzen Reihe von Pools in IIS sowie cmd Skripte, SQL, mehr als fünfhundert Domänen, zwei Dutzend Builds und aktive Entwicklung zusätzlich. Nicht, dass dies alles notwendig gewesen wäre, aber es hat funktioniert, und es war unpraktisch und lang. Das einzige, was mich beunruhigte, war das Vorhandensein anderer Projekte, die meine Aufmerksamkeit erforderten. Nichts bei der Arbeit mit Aufgaben dieser Größenordnung ist gefährlicher als mangelnde Konzentration und Unterbrechung.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich wusste, dass ich früher oder später auf andere Aufgaben achten musste, und deshalb habe ich viel Zeit damit verbracht, die vorhandene Infrastruktur zu studieren, damit es später zumindest nicht zu ungelösten Problemen kommt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leider kann ich aufgrund der NDA keine vollständige Beschreibung des Projekts geben, sodass allgemeine technische Punkte berücksichtigt werden. Alle Namen, die sich auf das Projekt beziehen, werden ebenfalls übermalt. Ich entschuldige mich für den schwarzen Fleck auf den Screenshots.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eines der Hauptmerkmale des Projekts ist, dass es eine Reihe von Modulen hat, die einen Kern haben, sich jedoch in ihren Konfigurationen unterscheiden. Es gibt auch Module mit einem „speziellen“ Ansatz, die für Wiederverkäufer und insbesondere Großkunden entwickelt wurden. Ein Modul kann mehr als einen Client bedienen. Ein Kunde sollte als separate Organisation oder Gruppe von Personen verstanden werden, die Zugriff auf ein bestimmtes Modul erhalten. Jeder Client erhält Zugriff auf seine eigene Domain, hat sein eigenes Design und seine eigenen Standardeinstellungen. Der Client wird durch die von ihm verwendete Domäne identifiziert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das allgemeine Schema dieses Teils des Projekts kann wie folgt dargestellt werden:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ft/1p/jp/ft1pjp-5mnyfk2fu07salwryrew.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie sehen können, wird der Kern überall gleich verwendet, und dies kann verwendet werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gründe, warum die Aufgabe bestand, CI / CD-Prozesse zu überprüfen und zu aktualisieren:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CruiseControl.NET wurde als Build-System verwendet. </font><font style="vertical-align: inherit;">Die Zusammenarbeit mit ihm ist im Prinzip ein zweifelhaftes Vergnügen. </font><font style="vertical-align: inherit;">XML-Konfigurationen auf mehreren Bildschirmen, eine Reihe von Abhängigkeiten und Verknüpfungen von Konfigurationen untereinander, Mangel an modernen Lösungen für moderne Probleme.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einige Entwickler (hauptsächlich Leads) des Projekts müssen Zugriff auf Build-Server haben, und manchmal möchten sie die ccnet-Konfigurationen ändern, die nicht geändert werden sollten. </font><font style="vertical-align: inherit;">Ratet mal, was als nächstes passiert. </font><font style="vertical-align: inherit;">Sie benötigen eine einfache und bequeme Verwaltung der Rechte im CI-System, ohne den Entwicklern den Zugriff auf den Server zu entziehen. </font><font style="vertical-align: inherit;">Einfach gesagt, es gibt keine Textkonfiguration - es gibt keinen Ort, an dem man mit verspielten Händen klettern kann.</font></font></li>
<li>  - …  CCNET,        git.         (. ).</li>
<li> ,      .     ,      .&nbsp;</li>
<li>-       ,        —         (   )       .</li>
<li>   .        ?   ?     ?            .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suboptimaler Ressourceneinsatz und veralteter Prozess zum Erstellen und Bereitstellen von Code.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abbildung zu Absatz 3:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/hc/yk/kv/hcykkvp6zijbax7ykugimj3qwkq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Planungsphase wurde beschlossen, Teamcity als Build-System und Octopus als Bereitstellungssystem zu verwenden. </font><font style="vertical-align: inherit;">Die "eiserne" Infrastruktur des Kunden ist unverändert geblieben: separate dedizierte Server für Entwickler, Test, Staging und Produktion sowie Reseller-Server (hauptsächlich Produktionsumgebungen). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dem Kunden wurde am Beispiel eines der Module ein Proof of Concept zur Verfügung gestellt, ein Aktionsplan erstellt, Vorarbeiten durchgeführt (Installation, Konfiguration usw.). </font><font style="vertical-align: inherit;">Es macht wahrscheinlich keinen Sinn, dies zu beschreiben. </font><font style="vertical-align: inherit;">Wie man Team City installiert, kann auf der offiziellen Website nachgelesen werden. </font><font style="vertical-align: inherit;">Ich werde auf einige formulierte Anforderungen für das neue System separat eingehen:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einfache Wartung mit allen Konsequenzen (Backups, Updates, Problemlösung, falls vorhanden).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Universalität. </font><font style="vertical-align: inherit;">Entwickeln Sie im Idealfall ein allgemeines Schema, nach dem alle Module zusammengebaut und geliefert werden, und verwenden Sie es als Vorlage.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minimieren Sie die Zeit für das Hinzufügen neuer Build-Konfigurationen und die Wartung. </font><font style="vertical-align: inherit;">Clients werden hinzugefügt / entfernt. </font><font style="vertical-align: inherit;">Manchmal müssen neue Einstellungen vorgenommen werden. </font><font style="vertical-align: inherit;">Es ist notwendig, dass beim Erstellen eines neuen Moduls keine Verzögerung bei der Konfiguration seiner Lieferung auftritt.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ungefähr zu diesem Zeitpunkt erinnerten wir uns an die Einstellung der Unterstützung für Quecksilber-Repositories mit einem Bitbucket, und es wurde die Anforderung hinzugefügt, das Repository an git zu übertragen und dabei die Zweige und den Verlauf der Commits beizubehalten.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vorbereitung: Repository-Konvertierung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es scheint, dass jemand dieses Problem klar vor uns und anstelle von uns gelöst hat. </font><font style="vertical-align: inherit;">Sie müssen nur eine fertige Arbeitslösung finden. </font><font style="vertical-align: inherit;">Der schnelle Export erwies sich als nicht so schnell. </font><font style="vertical-align: inherit;">Außerdem hat es nicht funktioniert. </font><font style="vertical-align: inherit;">Leider sind keine Protokolle und Screenshots mehr vorhanden. </font><font style="vertical-align: inherit;">Tatsache ist, dass er nicht konnte. </font><font style="vertical-align: inherit;">Bitbucket bietet keinen eigenen Konverter (könnte aber). </font><font style="vertical-align: inherit;">Noch ein paar googelte Methoden und auch von. </font><font style="vertical-align: inherit;">Ich habe beschlossen, meine eigenen Skripte zu schreiben. Dies ist jedoch nicht das einzige Quecksilber-Repository, es wird sich in Zukunft als nützlich erweisen. </font><font style="vertical-align: inherit;">Hier werden frühe Entwicklungen vorgestellt (weil sie immer noch in der gleichen Form bleiben). </font><font style="vertical-align: inherit;">Die Logik der Arbeit sieht ungefähr so ​​aus:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir nehmen die Erweiterung mercurial hggit als Basis.&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir erhalten eine Liste aller Zweige des Quecksilber-Repositorys.&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir konvertieren Zweignamen (danke an mercurial und die Entwickler für die Leerzeichen in den Zweignamen, besonderer Dank für die Umlaute und andere Zeichen, die dem Leben Freude machen).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen Sie Lesezeichen (hg-Lesezeichen) und verschieben Sie sie in das Zwischen-Repository. </font><font style="vertical-align: inherit;">Wozu? </font><font style="vertical-align: inherit;">Weil Bitbucket und weil Sie kein Lesezeichen mit demselben Namen wie der Name des Zweigs erstellen können (z. B. Staging).&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entfernen Sie im neuen (bereits git) Repository das Postfix aus dem Zweignamen und migrieren Sie hgignore nach gitignore.&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zum Haupt-Repository verschieben. </font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auflisten von Befehlen nach Punkten:</font></font><br>
<br>
<ol>
<li><pre><code class="bash hljs">$ <span class="hljs-built_in">cd</span> /path/to/hg/repo<font></font>
$ cat &lt;&lt; EOF &gt;&gt; ./.hg/hgrc<font></font>
[extensions]<font></font>
hggit=<font></font>
EOF<font></font>
</code></pre></li>
<li><pre><code class="bash hljs">$ hg branches &gt; ../branches
</code></pre></li>
<li><pre><code class="bash hljs"><span class="hljs-meta">#!/usr/bin/env bash</span>
hgBranchList=<span class="hljs-string">"./branches"</span>
sed -i <span class="hljs-string">'s/:.*//g'</span> <span class="hljs-variable">${hgBranchList}</span>
symbolsToDelete=$(awk <span class="hljs-string">'{print $NF}'</span> FS=<span class="hljs-string">" "</span> <span class="hljs-variable">${hgBranchList}</span> &gt; sym_to_del.tmp)<font></font>
 <font></font>
i=0<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> hgBranch; <span class="hljs-keyword">do</span>
  hgBranches[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${hgBranch}</span>
  i=$((i+<span class="hljs-number">1</span>))
<span class="hljs-keyword">done</span> &lt;<span class="hljs-variable">${hgBranchList}</span><font></font>
 <font></font>
i=0<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> str; <span class="hljs-keyword">do</span>
  strToDel[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${str}</span>
  i=$((i+<span class="hljs-number">1</span>))
<span class="hljs-keyword">done</span> &lt; ./sym_to_del.tmp<font></font>
 <font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">${!strToDel[@]}</span>
<span class="hljs-keyword">do</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-variable">${hgBranches[$i]}</span> | sed <span class="hljs-string">"s/<span class="hljs-variable">${strToDel[$i]}</span>//"</span> &gt;&gt; result.tmp
<span class="hljs-keyword">done</span><font></font>
 <font></font>
sed -i <span class="hljs-string">'s/[ \t]*$//'</span> result.tmp<font></font>
sed <span class="hljs-string">'s/^/"/g'</span> result.tmp &gt; branches_hg<font></font>
sed -i <span class="hljs-string">'s/$/"/g'</span> branches_hg<font></font>
sed <span class="hljs-string">'s/ /-/g'</span> result.tmp &gt; branches_git<font></font>
sed -i <span class="hljs-string">'s/-\/-/\//g'</span> branches_git<font></font>
sed -i <span class="hljs-string">'s/-\//\//g'</span> branches_git<font></font>
sed -i <span class="hljs-string">'s/\/-/\//g'</span> branches_git<font></font>
sed -i <span class="hljs-string">'s/---/-/g'</span> branches_git<font></font>
sed -i <span class="hljs-string">'s/--/-/g'</span> branches_git<font></font>
rm sym_to_del.tmp<font></font>
rm result.tmp<font></font>
</code></pre></li>
<li><pre><code class="bash hljs"><span class="hljs-meta">#!/usr/bin/env bash</span>
gitBranchList=<span class="hljs-string">"./branches_git"</span>
hgBranchList=<span class="hljs-string">"./branches_hg"</span>
hgRepo=<span class="hljs-string">"/repos/reponame"</span><font></font>
 <font></font>
i=0<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> hgBranch; <span class="hljs-keyword">do</span>
  hgBranches[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${hgBranch}</span>
  i=$((i+<span class="hljs-number">1</span>))
<span class="hljs-keyword">done</span> &lt;<span class="hljs-variable">${hgBranchList}</span><font></font>
 <font></font>
i=0<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> gitBranch; <span class="hljs-keyword">do</span>
  gitBranches[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${gitBranch}</span>
  i=$((i+<span class="hljs-number">1</span>))
<span class="hljs-keyword">done</span> &lt;<span class="hljs-variable">${gitBranchList}</span><font></font>
 <font></font>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">${hgRepo}</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">${!gitBranches[@]}</span>
<span class="hljs-keyword">do</span>
  hg bookmark -r <span class="hljs-string">"<span class="hljs-variable">${hgBranches[$i]}</span>"</span> <span class="hljs-string">"<span class="hljs-variable">${gitBranches[$i]}</span>-cnv"</span>
<span class="hljs-keyword">done</span><font></font>
 <font></font>
hg push git+ssh://git@bitbucket.org:username/reponame-temp.git<font></font>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Done."</span>
</code></pre></li>
<li><pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># clone repo, run git branch -a, delete remotes/origin words to leave only branch names, delete -cnv postfix, delete default branch string because we can't delete it</span>
repo=<span class="hljs-string">"/repos/repo"</span>
gitBranchList=<span class="hljs-string">"./branches_git"</span>
defaultBranch=<span class="hljs-string">"default-cnv"</span>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> gitBranch; <span class="hljs-keyword">do</span>   gitBranches[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${gitBranch}</span>;   i=$((i+<span class="hljs-number">1</span>)); <span class="hljs-keyword">done</span> &lt; <span class="hljs-variable">$gitBranchList</span>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">$repo</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">${!gitBranches[@]}</span>; <span class="hljs-keyword">do</span> git checkout <span class="hljs-variable">${gitBranches[$i]}</span>-cnv; <span class="hljs-keyword">done</span>
git checkout <span class="hljs-variable">$defaultBranch</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">${!gitBranches[@]}</span>; <span class="hljs-keyword">do</span>
    git branch -m <span class="hljs-variable">${gitBranches[$i]}</span>-cnv <span class="hljs-variable">${gitBranches[$i]}</span>
    git push origin :<span class="hljs-variable">${gitBranches[$i]}</span>-cnv <span class="hljs-variable">${gitBranches[$i]}</span>
    git push origin -u <span class="hljs-variable">${gitBranches[$i]}</span>
<span class="hljs-keyword">done</span>
</code></pre></li>
<li><pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># clone repo, run git branch -a, delete remotes/origin words to leave only branch names, delete -cnv postfix, delete default branch string because we can't delete it</span>
repo=<span class="hljs-string">"/repos/repo"</span>
gitBranchList=<span class="hljs-string">"./branches_git"</span>
defaultBranch=<span class="hljs-string">"default"</span>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> gitBranch; <span class="hljs-keyword">do</span>   gitBranches[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${gitBranch}</span>;   i=$((i+<span class="hljs-number">1</span>)); <span class="hljs-keyword">done</span> &lt; <span class="hljs-variable">$gitBranchList</span>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">$repo</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">${!gitBranches[@]}</span>; <span class="hljs-keyword">do</span>
    git checkout <span class="hljs-variable">${gitBranches[$i]}</span>
    sed -i <span class="hljs-string">'1d'</span> .hgignore<font></font>
    mv .hgignore .gitignore<font></font>
    git add .<font></font>
    git commit -m <span class="hljs-string">"Migrated ignore file"</span>
<span class="hljs-keyword">done</span>
</code></pre></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde versuchen, die Bedeutung einiger Aktionen zu erläutern, nämlich die Verwendung eines Zwischen-Repositorys. Im Repository enthalten die Filialnamen nach der Konvertierung zunächst das Postfix „-cnv“. Dies liegt an der hg-Lesezeichenfunktion. Sie müssen diesen Postfix entfernen und anstelle von hgignore auch Gitignore-Dateien erstellen. All dies fügt den Verlauf hinzu und vergrößert daher das Repository (und dies in unangemessener Weise). Als weiteres Beispiel kann ich Folgendes anführen: Versuchen Sie, ein Repository zu erstellen, und verschieben Sie das erste Commit mit dem darin enthaltenen Code auf 300 MB. Fügen Sie es dann zu gitignore hinzu und schieben Sie es ohne es. Er wird in der Geschichte bleiben. Versuchen Sie nun, es aus dem Verlauf zu entfernen (Git-Filter-Zweig). Bei einer bestimmten Anzahl von Commits wird die resultierende Repository-Größe nicht verringert, sondern erhöht. Dies wird durch Optimierung gelöst, kann jedoch nicht auf Bitbucket initiiert werden.Es wird nur beim Importieren des Repositorys ausgeführt. Daher werden alle groben Vorgänge mit einem Zwischenprodukt ausgeführt und anschließend in ein neues importiert. Die Größe des Zwischenrepositorys im Finale betrug 1,15 G und die Größe der resultierenden 350 M.&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der gesamte Migrationsprozess war in mehrere Phasen unterteilt:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vorbereitung (Demo für den Kunden anhand eines Beispiels für einen Build, Softwareinstallation, Repository-Konvertierung, Aktualisierung vorhandener ccnet-Konfigurationen);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CI / CD-Konfiguration für die Entwicklungsumgebung und ihre Tests (das alte System arbeitet weiterhin parallel);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CI / CD-Einstellungen für die verbleibenden Umgebungen (parallel zu den vorhandenen "gut") und Tests;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Migrationsentwickler, Staging und Test;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Migrieren der Produktion und Übertragen von Domänen von alten IIS-Instanzen auf neue.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Beschreibung der erfolgreich abgeschlossenen Vorbereitungsphase wird derzeit abgeschlossen. </font><font style="vertical-align: inherit;">Einige großartige Erfolge wurden hier nicht erzielt, außer dass das bestehende System nicht zusammenbrach und das Quecksilber-Repository in Git migriert wurde. </font><font style="vertical-align: inherit;">Ohne eine Beschreibung dieser Prozesse gibt es jedoch keinen Kontext für technischere Teile. </font><font style="vertical-align: inherit;">Im nächsten Teil wird der Prozess zum Einrichten eines CI-Systems basierend auf Teamcity beschrieben.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de496184/index.html">LED-Anzeigetechnologie: Micro-LED vs. Mini LED</a></li>
<li><a href="../de496188/index.html">Wie man aufhört, Fernsehsendungen zu schauen und anfängt zu leben</a></li>
<li><a href="../de496190/index.html">Über Phrasal Verbs-2</a></li>
<li><a href="../de496192/index.html">Rust-Funktionen von Go aus aufrufen</a></li>
<li><a href="../de496194/index.html">Zur Binarisierung feinstrukturierter tomographischer Bilder</a></li>
<li><a href="../de496206/index.html">Eine Milliarde Operationen in der Datenbank in 0,3 Sekunden. Vergleichen Sie OLTP nicht mit OLAP, sondern QuestDB mit PostgreSQL</a></li>
<li><a href="../de496208/index.html">Wie JIT unseren C # -Code einfügt (Heuristik)</a></li>
<li><a href="../de496210/index.html">Die biologische Vielfalt hat sich möglicherweise aus dem Prinzip des Stein-Papier-Scherens entwickelt</a></li>
<li><a href="../de496212/index.html"># 04 - Und ein ganzes Byte reicht nicht ... | Nimm BK bei den Hörnern</a></li>
<li><a href="../de496214/index.html">AdColony: 89% der Publisher von mobilen Apps und Spielen verwenden Werbevideos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>