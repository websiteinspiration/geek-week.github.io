<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôÖüèΩ üë©üèΩ‚Äçüöí üë®üèø‚Äçüíº Stas Afanasyev. Juno Tuber√≠as basadas en io.Reader / io.Writer. Parte 1 üí§ üßñüèæ ‚õèÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En la charla, hablaremos sobre el concepto de io.Reader / io.Writer, por qu√© son necesarios, c√≥mo implementarlos correctamente y qu√© inconvenientes ex...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Stas Afanasyev. Juno Tuber√≠as basadas en io.Reader / io.Writer. Parte 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/491484/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En la charla, hablaremos sobre el concepto de io.Reader / io.Writer, por qu√© son necesarios, c√≥mo implementarlos correctamente y qu√© inconvenientes existen a este respecto, as√≠ como sobre la construcci√≥n de tuber√≠as basadas en implementaciones est√°ndar y personalizadas de io.Reader / io.Writer .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rd/nv/uj/rdnvujcjwsukejxq_6a9syayawu.jpeg"><a name="habracut"></a><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stanislav Afanasyev (en adelante - SA):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬°Buenas tardes! Me llamo Stas Vengo de Minsk, de la compa√±√≠a Juno. Gracias por venir en este d√≠a lluvioso, despu√©s de haber encontrado la fuerza para salir de la casa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoy quiero hablar con ustedes sobre un tema como la construcci√≥n de tuber√≠as Go basadas en las interfaces io.Reader / io.Writer. De lo que voy a hablar hoy es, en general, del concepto de interfaces io.Reader / io.Writer, por qu√© son necesarias, c√≥mo usarlas correctamente y, lo m√°s importante, c√≥mo implementarlas correctamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n hablaremos sobre la construcci√≥n de tuber√≠as basadas en diversas implementaciones de estas interfaces. Hablaremos sobre los m√©todos existentes, discutiremos sus ventajas y desventajas. Mencionar√© varias trampas (esto ser√° en abundancia).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de comenzar, debemos responder la pregunta, ¬øpor qu√© se necesitan estas interfaces? </font><font style="vertical-align: inherit;">Levanta las manos, que trabaja con Go con fuerza (todos los d√≠as, cada dos d√≠as) ... </font></font><br>
<br>
<img src="https://habrastorage.org/webt/d2/pd/f4/d2pdf4kdwdjk_vxkqz6fwckqrgk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Genial! </font><font style="vertical-align: inherit;">Todav√≠a tenemos una comunidad de Go. </font><font style="vertical-align: inherit;">Creo que muchos de ustedes han trabajado con estas interfaces, al menos han o√≠do hablar de ellas. </font><font style="vertical-align: inherit;">Puede que ni siquiera sepas sobre ellos, pero ciertamente deber√≠as haber escuchado algo sobre ellos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En primer lugar, estas interfaces son una abstracci√≥n de la operaci√≥n de entrada-salida en todas sus manifestaciones. </font><font style="vertical-align: inherit;">En segundo lugar, es una API muy conveniente que le permite construir tuber√≠as, como un constructor a partir de cubos, sin pensar realmente en los detalles internos de la implementaci√≥n. </font><font style="vertical-align: inherit;">Al menos eso fue originalmente pensado.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io.Reader</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta es una interfaz muy simple. Consiste en un solo m√©todo: el m√©todo de lectura. Conceptualmente, la implementaci√≥n de la interfaz io.Reader puede ser una conexi√≥n de red, por ejemplo, donde todav√≠a no hay datos, pero pueden aparecer all√≠: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/n-/4n/dc/n-4ndcbxpoxkul6h227ue7hruli.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
puede ser un b√∫fer en la memoria donde los datos ya existen y se pueden leer por completo. Tambi√©n puede ser un descriptor de archivo: podemos leer este archivo en pedazos si es muy grande. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La implementaci√≥n conceptual de la interfaz io.Reader es el acceso a algunos datos. Todos los casos que escrib√≠ son compatibles con el m√©todo Read. Solo tiene un argumento: este es el byte de corte.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un punto para hacer aqu√≠. Aquellos que vinieron a Go recientemente o vinieron de otra tecnolog√≠a, donde no hab√≠a una API similar (yo soy uno de esos), esta firma es un poco confusa. El m√©todo de lectura parece leer de alguna manera este segmento. De hecho, lo contrario es cierto: la implementaci√≥n de la interfaz Reader lee los datos que contiene y llena este segmento con los datos que tiene esta implementaci√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La cantidad m√°xima de datos que el m√©todo de lectura puede leer a pedido es igual a la longitud de este segmento. </font><font style="vertical-align: inherit;">Una implementaci√≥n regular devuelve tantos datos como puede devolver en el momento de la solicitud, o la cantidad m√°xima que cabe en este segmento. </font><font style="vertical-align: inherit;">Esto sugiere que Reader puede leerse en partes: al menos por byte, al menos diez, como lo desee. </font><font style="vertical-align: inherit;">Y el cliente que llama a Reader, de acuerdo con los valores de retorno del m√©todo Read, piensa c√≥mo vivir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El m√©todo Read devuelve dos valores:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√∫mero de bytes restados;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un error si ocurri√≥</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estos valores influyen en el comportamiento posterior del cliente. </font><font style="vertical-align: inherit;">Hay un gif en la diapositiva que muestra, muestra este proceso, que acabo de describir:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/si/ww/sf/siwwsf6u8mb1nkztg0ltnumkckw.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/p1/hk/mb/p1hkmbpfp8-twtnznjj2ihireaa.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Io.Reader - ¬øC√≥mo hacerlo?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay exactamente dos formas para que sus datos satisfagan la interfaz del lector. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/l0/fm/e7/l0fme7quz_tqzilkfiuiddpgjk4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El primero es el m√°s simple. Si tiene alg√∫n tipo de byte de corte y desea que satisfaga la interfaz del lector, puede implementar una biblioteca est√°ndar que ya satisfaga esta interfaz. Por ejemplo, Reader del paquete de bytes. En la diapositiva anterior, puede ver la firma de c√≥mo se crea este Reader. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay una forma m√°s complicada: implementar la interfaz del lector usted mismo. Hay aproximadamente 30 l√≠neas en la documentaci√≥n con reglas dif√≠ciles, restricciones que deben seguirse. Antes de hablar sobre todos ellos, me result√≥ interesante: ‚Äú¬øY en qu√© casos no hay suficientes implementaciones est√°ndar (biblioteca est√°ndar)? ¬øCu√°ndo es el momento en que necesitamos implementar la interfaz del lector nosotros mismos?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para responder a esta pregunta, tom√© los miles de repositorios m√°s populares en Github (por el n√∫mero de estrellas), los agregu√© y encontr√© todas las implementaciones de la interfaz Reader all√≠. </font><font style="vertical-align: inherit;">En la diapositiva, tengo algunas estad√≠sticas (categorizadas) de cu√°ndo las personas implementan esta interfaz.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La categor√≠a m√°s popular son las conexiones. </font><font style="vertical-align: inherit;">Esta es una implementaci√≥n de protocolos y envoltorios patentados para los tipos existentes. </font><font style="vertical-align: inherit;">Entonces, Brad Fitzpatrick tiene un proyecto Camlistore: hay un ejemplo en forma de statTrackingConn, que, en general, es un Wrapper ordinario sobre el tipo de estafa del paquete neto (agrega m√©tricas a este tipo).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La segunda categor√≠a m√°s popular son los buffers personalizados. </font><font style="vertical-align: inherit;">Aqu√≠ me gust√≥ el √∫nico ejemplo: dataBuffer del paquete x / net. </font><font style="vertical-align: inherit;">Su peculiaridad es que almacena datos cortados en fragmentos, y al restarlos pasa a trav√©s de estos fragmentos. </font><font style="vertical-align: inherit;">Si los datos en el fragmento han terminado, pasar√°n al siguiente fragmento. </font><font style="vertical-align: inherit;">Al mismo tiempo, tiene en cuenta la longitud, el lugar en el que puede llenar el segmento transmitido.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otra categor√≠a es todo tipo de barras de progreso, contando el n√∫mero de bytes restados con el env√≠o de m√©tricas ...</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En base a estos datos, podemos decir que la necesidad de implementar la interfaz io.Reader ocurre con bastante frecuencia. </font><font style="vertical-align: inherit;">Entonces comencemos a hablar sobre las reglas que est√°n en la documentaci√≥n.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reglas de documentaci√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como dije, la lista de reglas, y en general la documentaci√≥n es bastante grande, masiva. 30 l√≠neas son suficientes para una interfaz que consta de solo tres l√≠neas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La primera regla, la m√°s importante, se refiere al n√∫mero de bytes devueltos. Debe ser estrictamente mayor o igual que cero y menor o igual que la longitud del segmento enviado. ¬øPor qu√© es importante? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1k/kp/xh/1kkpxhahoiicme8z8vbdbq5ajbm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que este es un contrato bastante estricto, el cliente puede confiar en la cantidad que proviene de la implementaci√≥n. Hay Wrappers en la biblioteca est√°ndar (por ejemplo, bytes.Buffer y bufio). Hay un momento as√≠ en la biblioteca est√°ndar: algunas implementaciones conf√≠an en los lectores envueltos, otros no conf√≠an (hablaremos de esto m√°s adelante).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bufio no conf√≠a en nada, verifica absolutamente todo. </font><font style="vertical-align: inherit;">Bytes.Buffer conf√≠a absolutamente en todo lo que le llega. </font><font style="vertical-align: inherit;">Ahora demostrar√© lo que est√° sucediendo en relaci√≥n con esto ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora consideraremos tres casos posibles: estos son tres lectores implementados. </font><font style="vertical-align: inherit;">Son bastante sint√©ticos, √∫tiles para la comprensi√≥n. </font><font style="vertical-align: inherit;">Leeremos todos estos lectores usando el ayudante ReadAll. </font><font style="vertical-align: inherit;">Su firma se presenta en la parte superior de la diapositiva:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ib/c1/7b/ibc17bdqyrimk3xce2khqwera4w.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io.Reader # 1. </font><font style="vertical-align: inherit;">Ejemplo 1</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ReadAll es un ayudante que toma alg√∫n tipo de implementaci√≥n de la interfaz de Reader, la lee y devuelve los datos que ley√≥, as√≠ como un error. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nuestro primer ejemplo es Reader, que siempre devolver√° -1 y cero como un error, es decir, un NegativeReader. Ejec√∫telo y veamos qu√© sucede: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7n/3h/l-/7n3hl-2vdvmgvmw80eljlorapiw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
como sabe, el p√°nico sin ninguna raz√≥n es una se√±al de tonter√≠a. Pero qui√©n en este caso es tonto, yo o byte. Amortiguador, depende del punto de vista. Quienes escriben este paquete y lo siguen tienen diferentes puntos de vista. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQue pas√≥ aqu√≠? Bytes.Buffer acept√≥ un n√∫mero negativo de bytes, no verific√≥ que fuera negativo e intent√≥ cortar el b√∫fer interno a lo largo del l√≠mite superior, que recibi√≥, y salimos de los l√≠mites del segmento.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay dos problemas en este ejemplo. La primera es que la firma no tiene prohibido devolver n√∫meros negativos, y la documentaci√≥n est√° prohibida. Si la firma tuviera Uint, obtendr√≠amos un desbordamiento cl√°sico (cuando un n√∫mero con signo se interpreta como sin signo). Y este es un error muy complicado, que seguramente ocurrir√° el viernes por la noche, cuando ya est√©s en casa. Por lo tanto, el p√°nico en este caso es la opci√≥n preferida.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El segundo "punto" es que el seguimiento de la pila no comprende lo que sucedi√≥ en absoluto. Est√° claro que hemos ido m√°s all√° de los l√≠mites del sector, ¬øy qu√©? Cuando tiene una tuber√≠a multicapa y se produce un error de este tipo, no est√° claro de inmediato qu√© sucedi√≥. Por lo tanto, el bufio de la biblioteca est√°ndar tambi√©n "entra en p√°nico" en esta situaci√≥n, pero lo hace m√°s bellamente. Inmediatamente escribe: ‚ÄúRest√© un n√∫mero negativo de bytes. No har√© nada m√°s, no s√© qu√© hacer con √©l ".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y bytes. Buffer est√° entrando en p√°nico lo mejor que puede. </font><font style="vertical-align: inherit;">Publiqu√© un problema en Golang pidi√©ndome que agregue un error humano. </font><font style="vertical-align: inherit;">El tercer d√≠a, discutimos las perspectivas de esta decisi√≥n. </font><font style="vertical-align: inherit;">La raz√≥n es esta: hist√≥ricamente sucedi√≥ que diferentes personas en diferentes momentos tomaron diferentes decisiones descoordinadas. </font><font style="vertical-align: inherit;">Y ahora tenemos lo siguiente: en un caso no confiamos en absoluto en la implementaci√≥n (verificamos todo), y en el otro confiamos completamente, no obtenemos lo que proviene de all√≠. </font><font style="vertical-align: inherit;">Este es un problema no resuelto, y hablaremos m√°s sobre esto.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io.Reader # 1. </font><font style="vertical-align: inherit;">Ejemplo 2</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La siguiente situaci√≥n: nuestro lector siempre devolver√° 0 y cero como resultado. </font><font style="vertical-align: inherit;">Desde el punto de vista de los contratos, todo es legal aqu√≠, no hay problemas. </font><font style="vertical-align: inherit;">La √∫nica advertencia: la documentaci√≥n dice que no se recomienda que las implementaciones devuelvan los valores 0 y nulo, adem√°s del caso, cuando la longitud del segmento enviado es cero. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la vida real, tal lector puede causar muchos problemas. </font><font style="vertical-align: inherit;">Entonces, volvemos a la pregunta, ¬ødebemos confiar en Reader? </font><font style="vertical-align: inherit;">Por ejemplo, una verificaci√≥n est√° integrada en el bufio: lee secuencialmente Reader exactamente 100 veces; si dicho par de valores se devuelve 100 veces, simplemente devuelve NoProgress. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No hay nada como esto en bytes. </font><font style="vertical-align: inherit;">Si ejecutamos este ejemplo, obtenemos solo un bucle sin fin (ReadAll usa bytes.Buffer debajo del cap√≥, no Reader en s√≠):</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xh/br/zu/xhbrzuvnof4dxubt2d26i6q4l_q.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io.Reader # 1. </font><font style="vertical-align: inherit;">Ejemplo 2</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un ejemplo mas. </font><font style="vertical-align: inherit;">Tambi√©n es bastante sint√©tico, pero √∫til para comprender: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ga/pe/xp/gapexpzfyhd6za09ss_uuwbrmlk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
aqu√≠ siempre devolvemos 1 y cero. </font><font style="vertical-align: inherit;">Parece que tampoco hay problemas aqu√≠: todo es legal desde el punto de vista del contrato. </font><font style="vertical-align: inherit;">Hay un matiz: si ejecuto este ejemplo en mi computadora, se congelar√° despu√©s de 30 segundos ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto se debe al hecho de que el cliente que lee este Reader (es decir, bytes.Buffer) nunca recibe una se√±al del final de los datos: se lee, resta ... Adem√°s, obtiene un byte restado cada vez. </font><font style="vertical-align: inherit;">Para √©l, esto significa que en alg√∫n momento, el b√∫fer reposicionado finaliza, todav√≠a se ejecuta: la situaci√≥n se repite y se ejecuta hasta el infinito hasta que explota.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io.Reader # 2. </font><font style="vertical-align: inherit;">Error de retorno</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Llegamos a la segunda regla importante para implementar la interfaz de Reader: este es un retorno de error. </font><font style="vertical-align: inherit;">La documentaci√≥n establece tres errores que la implementaci√≥n deber√≠a devolver. </font><font style="vertical-align: inherit;">El m√°s importante de ellos es EOF. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EOF es el signo mismo del fin de los datos, que la implementaci√≥n deber√≠a devolver siempre que se quede sin datos. </font><font style="vertical-align: inherit;">Conceptualmente, esto no es, en general, un error, sino un error. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay otro error llamado UnexpectedEOF. </font><font style="vertical-align: inherit;">Si de repente mientras lee Reader ya no puede leer los datos, se pens√≥ que devolver√≠a UnexpectedEOF. </font><font style="vertical-align: inherit;">Pero, de hecho, este error se usa solo en un lugar de la biblioteca est√°ndar: en la funci√≥n ReadAtLeast.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-c/og/la/-coglawtrylyakbq0kxlc0ob9rs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otro error es NoProgress, del que ya hablamos. </font><font style="vertical-align: inherit;">La documentaci√≥n lo dice: esta es una se√±al de que la interfaz est√° implementada es una mierda.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Io.Reader # 3</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La documentaci√≥n estipula un conjunto de casos sobre c√≥mo devolver correctamente el error. </font><font style="vertical-align: inherit;">A continuaci√≥n puede ver tres casos posibles: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/m1/ef/si/m1efsipabh8oypgch-7_ni2syc8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
podemos devolver un error tanto con el n√∫mero de bytes restados como por separado. </font><font style="vertical-align: inherit;">Pero si de repente sus datos se agotan en su Reader, y no puede devolver el EOF [signo final] en este momento (muchas implementaciones de biblioteca est√°ndar funcionan de esa manera), entonces se supone que devolver√° EOF a la pr√≥xima llamada consecutiva (es decir, debe dejar ir cliente). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para el cliente, esto significa que no hay m√°s datos, ya no acudes a m√≠. </font><font style="vertical-align: inherit;">Si devuelve nulo y el cliente necesita datos, entonces debe volver a usted.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io.Reader. </font><font style="vertical-align: inherit;">Errores</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, seg√∫n Reader, estas fueron las principales reglas importantes. </font><font style="vertical-align: inherit;">Todav√≠a hay un conjunto de peque√±os, pero no son tan importantes y no conducen a tal situaci√≥n: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xv/iu/az/xviuazv5segzzd5ganrbinp8xli.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
antes de pasar por todo lo relacionado con Reader, debemos responder a la pregunta: ¬øes importante, ocurren errores a menudo en implementaciones personalizadas? </font><font style="vertical-align: inherit;">Para responder a esta pregunta, recurr√≠ a mi spool para obtener 1000 repositorios (y all√≠ obtuvimos alrededor de 550 implementaciones personalizadas). </font><font style="vertical-align: inherit;">Mir√© a trav√©s de los primeros cien con los ojos. </font><font style="vertical-align: inherit;">Por supuesto, esto no es un superan√°lisis, sino lo que es ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Identifiqu√© los dos errores m√°s populares:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nunca devuelve EOF;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">demasiada confianza en el lector envuelto.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nuevamente, este es un problema desde mi punto de vista. </font><font style="vertical-align: inherit;">Y de aquellos que est√°n viendo el paquete io, esto no es un problema. </font><font style="vertical-align: inherit;">Hablaremos de esto nuevamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Me gustar√≠a volver a un matiz. </font><font style="vertical-align: inherit;">Ver: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/te/3h/9q/te3h9q46okeg22rijrfyxrmi4da.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El cliente nunca debe interpretar el par 0 y cero como EOF. </font><font style="vertical-align: inherit;">Esto es un error! </font><font style="vertical-align: inherit;">Para Reader, este valor es solo una oportunidad para dejar ir al cliente. </font><font style="vertical-align: inherit;">Por lo tanto, los dos errores que mencion√© parecen insignificantes, pero es suficiente imaginar que tiene una tuber√≠a de varias capas en el producto y un peque√±o y astuto "bagul" en el medio, ¬°entonces el "golpe subterr√°neo" no tardar√° mucho, garantizado! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seg√∫n Reader, b√°sicamente todo. </font><font style="vertical-align: inherit;">Estas fueron las reglas b√°sicas de implementaci√≥n.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io.Writer</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el otro extremo de las tuber√≠as, tenemos io.Writer, que es donde usualmente escribimos datos. </font><font style="vertical-align: inherit;">Una interfaz muy similar: tambi√©n consta de un m√©todo (escritura), su firma es similar. </font><font style="vertical-align: inherit;">Desde el punto de vista de la sem√°ntica, la interfaz de Writer es m√°s comprensible: dir√≠a que tal como se escucha, se escribe. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fq/ya/ls/fqyalshoz2lwp48cs5u8oa9ymdk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El m√©todo Write toma un byte de segmento y lo escribe en su totalidad. </font><font style="vertical-align: inherit;">Tambi√©n tiene un conjunto de reglas que deben seguirse.</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El primero de estos se refiere al n√∫mero devuelto de bytes escritos. </font><font style="vertical-align: inherit;">Yo dir√≠a que no es tan estricto, porque no encontr√© un solo ejemplo cuando esto llevar√≠a a algunas consecuencias cr√≠ticas, por ejemplo, entrar en p√°nico. </font><font style="vertical-align: inherit;">Esto no es muy estricto porque existe la siguiente regla ...</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La implementaci√≥n de Writer es necesaria para devolver un error siempre que la cantidad de datos escritos sea inferior a la que se envi√≥. </font><font style="vertical-align: inherit;">Es decir, la grabaci√≥n parcial no es compatible. </font><font style="vertical-align: inherit;">Esto significa que no es muy importante cu√°ntos bytes se escribieron.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una regla m√°s: el escritor no debe modificar el segmento enviado, porque el cliente seguir√° trabajando con este segmento.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El escritor no debe contener esta porci√≥n (el lector tiene la misma regla). </font><font style="vertical-align: inherit;">Si necesita datos en su implementaci√≥n para algunas operaciones, solo necesita copiar esta diapositiva, y eso es todo.</font></font></li>
</ol><br>
<img src="https://habrastorage.org/webt/iy/tx/qe/iytxqemg1nabcwxyfzxtgszmjxy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lector y escritor, eso es todo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dendrograma</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Especialmente para este informe, gener√© un gr√°fico de implementaci√≥n y lo dise√±√© en forma de dendrograma. </font><font style="vertical-align: inherit;">Aquellos que quieran ahora pueden seguir este c√≥digo QR: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r2/zp/pq/r2zppqu-0snqu80oqyxxpxakkpc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
este dendrograma tiene todas las implementaciones de todas las interfaces del paquete io. </font><font style="vertical-align: inherit;">Este dendrograma es necesario para comprender simplemente: qu√© y con qu√© se puede unir en las tuber√≠as, d√≥nde y qu√© puede leer, d√≥nde puede escribir. </font><font style="vertical-align: inherit;">Todav√≠a lo consultar√© en el curso de mi informe, as√≠ que por favor consulte el c√≥digo QR.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tuber√≠as</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hablamos sobre qu√© es Reader, io.Writer. Ahora hablemos de la API que existe en la biblioteca est√°ndar para construir tuber√≠as. Empecemos con lo b√°sico. Tal vez ni siquiera sea interesante para nadie. Sin embargo, esto es muy importante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leeremos los datos del flujo de entrada est√°ndar (de Stdin): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zq/tq/4m/zqtq4mfocqntafmpk5m_scirhcm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stdin est√° representado en Go por una variable global de tipo archivo del paquete os. Si observa el dendrograma, notar√° que el tipo de archivo tambi√©n implementa las interfaces Reader y Writer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este momento estamos interesados ‚Äã‚Äãen Reader. Leeremos Stdin usando el mismo ayudante ReadAll que ya usamos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vale la pena se√±alar un matiz con respecto a este ayudante: ReadAll lee Reader hasta el final, pero determina el final por EOF, de acuerdo con el signo del final del que hablamos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora limitaremos la cantidad de datos que leemos de Stdin. Para hacer esto, hay una implementaci√≥n de LimitedReader en la biblioteca est√°ndar: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qq/dm/hn/qqdmhnj73dfyxpdlrpoffwzimgq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
me gustar√≠a que preste atenci√≥n a c√≥mo LimitedReader limita el n√∫mero de bytes a leer. Uno podr√≠a pensar que esta implementaci√≥n, este Wrapper, resta todo lo que est√° en el Reader, que envuelve, y luego da todo lo que queremos. Pero todo funciona un poco diferente ...</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LimitedReader recorta el segmento dado como argumento a lo largo del l√≠mite superior. </font><font style="vertical-align: inherit;">Y le pasa esta rebanada recortada a Reader, que la envuelve. </font><font style="vertical-align: inherit;">Esta es una demostraci√≥n clara de c√≥mo se regula la longitud de los datos le√≠dos en las implementaciones de la interfaz io.Reader.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Error al devolver el final del archivo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otro punto interesante: ¬°observe c√≥mo esta implementaci√≥n devuelve un error EOF! </font><font style="vertical-align: inherit;">Los valores nombrados devueltos se usan aqu√≠, y se asignan por los valores que obtenemos del Reader envuelto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y si sucede que hay m√°s datos en el Reader envuelto de los que necesitamos, asignamos los valores del Reader envuelto, por ejemplo, 10 bytes y cero, porque todav√≠a hay datos en el Reader envuelto. </font><font style="vertical-align: inherit;">Pero la variable n, que disminuye (en la pen√∫ltima l√≠nea), dice que hemos llegado al "fondo", el final de lo que necesitamos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la pr√≥xima iteraci√≥n, el cliente debe volver de nuevo; en la primera condici√≥n, recibir√° EOF. </font><font style="vertical-align: inherit;">Este es el caso que mencion√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Continuar√° muy pronto ...</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/kuyjuGk1USY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un poco de publicidad :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gracias por estar con nosotros. ¬øTe gustan nuestros art√≠culos? ¬øQuieres ver m√°s materiales interesantes? Ap√≥yenos haciendo un pedido o recomendando a sus amigos, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS en la nube para desarrolladores desde $ 4.99</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">an√°logo √∫nico de servidores de nivel b√°sico que inventamos para usted: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toda la verdad sobre VPS (KVM) E5-2697 v3 (6 n√∫cleos) 10GB DDR4 480GB SSD 1Gbps desde $ 19 o c√≥mo dividir el servidor?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (las opciones est√°n disponibles con RAID1 y RAID10, hasta 24 n√∫cleos y hasta 40GB DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 veces m√°s barato en el centro de datos Equinix Tier IV en Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Solo tenemos </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV desde $ 199</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en los Pa√≠ses Bajos.</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - ¬°desde $ 99! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lea sobre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C√≥mo construir un edificio de infraestructura. </font><font style="vertical-align: inherit;">clase c con servidores Dell R730xd E5-2650 v4 que cuestan 9,000 euros por un centavo?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es491462/index.html">Lectura de fin de semana: 12 podcasts, puesta de sol de la era FM y aplicaciones de meditaci√≥n</a></li>
<li><a href="../es491476/index.html">MEMS aceler√≥metros, magnet√≥metros y √°ngulos de orientaci√≥n</a></li>
<li><a href="../es491478/index.html">Un nuevo implante para ciegos se conecta directamente al cerebro</a></li>
<li><a href="../es491480/index.html">Proyecto CoVirus MVP: un mapa en l√≠nea de la infecci√≥n por coronavirus o un "bot√≥n rojo" en la mano</a></li>
<li><a href="../es491482/index.html">Presentamos PowerShell 7.0</a></li>
<li><a href="../es491486/index.html">Script personalizado al cerrar la tapa de la computadora port√°til y bloquear la pantalla sin dormir</a></li>
<li><a href="../es491488/index.html">¬øQu√© significa ser √°gil?</a></li>
<li><a href="../es491490/index.html">¬øC√≥mo hereda Gitlab-CI las variables de entorno?</a></li>
<li><a href="../es491494/index.html">La grandiosa estafa de la ciencia sovi√©tica: por qu√© una nave orbital reutilizable result√≥ ser √∫nica</a></li>
<li><a href="../es491496/index.html">Consejos y trucos de IntelliJ IDEA: 1. Comparaci√≥n de archivos y carpetas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>