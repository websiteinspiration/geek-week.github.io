<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ¿â€ğŸ”§ ğŸ–ğŸ¿ ğŸ˜¿ ä»Similinkè°ƒç”¨å…±äº«åº“ ğŸš­ ğŸ‘¨ğŸ»â€ğŸ¨ ğŸ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å—¨ï¼Œå“ˆä¼¯ï¼
 æˆ‘å‘æ‚¨ä»‹ç»äº†æˆ‘çš„åŒäº‹Mikhailæ’°å†™çš„ä¸€ç¯‡æ–‡ç« çš„ç¿»è¯‘ï¼Œè¯¥æ–‡ç« æ¶‰åŠåœ¨Simulinkä¸­è°ƒç”¨å…±äº«åº“çš„æ–¹æ³•ã€‚ä¸ºä»€ä¹ˆè¦åˆ›å»ºå®ƒï¼Ÿäº‹å®æ˜¯ï¼Œè®¸å¤šå…¬å¸å·²ç»æ‹¥æœ‰è®¸å¤šæˆ‘ä»¬æƒ³é‡å¤ä½¿ç”¨çš„é—ç•™æ¨¡å‹ï¼Œå¹¶ä¸”ç»å¸¸è¢«é—®åˆ°ä»¥ä¸‹é—®é¢˜ï¼šâ€œå¦‚ä½•å°†é—ç•™æ¨¡å‹é›†æˆåˆ°Simulinkï¼Ÿå¦‚æœæˆ‘çš„é—äº§æ˜¯DLLå½¢å¼çš„ï¼Ÿâ€å› æ­¤ï¼Œæ’°å†™äº†åŸå§‹æ–‡...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ä»Similinkè°ƒç”¨å…±äº«åº“</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/503908/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å—¨ï¼Œå“ˆä¼¯ï¼</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘å‘æ‚¨ä»‹ç»äº†æˆ‘çš„åŒäº‹Mikhailæ’°å†™çš„ä¸€ç¯‡æ–‡ç« çš„ç¿»è¯‘ï¼Œè¯¥æ–‡ç« æ¶‰åŠåœ¨Simulinkä¸­è°ƒç”¨å…±äº«åº“çš„æ–¹æ³•ã€‚ä¸ºä»€ä¹ˆè¦åˆ›å»ºå®ƒï¼Ÿäº‹å®æ˜¯ï¼Œè®¸å¤šå…¬å¸å·²ç»æ‹¥æœ‰è®¸å¤šæˆ‘ä»¬æƒ³é‡å¤ä½¿ç”¨çš„é—ç•™æ¨¡å‹ï¼Œå¹¶ä¸”ç»å¸¸è¢«é—®åˆ°ä»¥ä¸‹é—®é¢˜ï¼šâ€œå¦‚ä½•å°†é—ç•™æ¨¡å‹é›†æˆåˆ°Simulinkï¼Ÿå¦‚æœæˆ‘çš„é—äº§æ˜¯DLLå½¢å¼çš„ï¼Ÿâ€å› æ­¤ï¼Œæ’°å†™äº†åŸå§‹æ–‡ç« ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æŒ‡å¯¼ä¸‹ï¼Œè®¨è®ºäº†åœ¨Simulinkä¸­è°ƒç”¨å…±äº«åº“çš„å‡ ç§æ–¹æ³•ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹ä»£ç çš„æ‰€æœ‰æ›´æ”¹éƒ½æ˜¯åœ¨Mikhailçš„å…è®¸ä¸‹è¿›è¡Œçš„ï¼Œä»¥å…ä½¿æœ¬æ–‡è¿‡é‡ã€‚</font></font><br>
<br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨Simulinkæ¨¡å‹ä¸­ä½¿ç”¨å…±äº«åº“ä¸­çš„å‡½æ•°ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å‡è®¾æˆ‘ä»¬éœ€è¦å°†exlibåº“åµŒå…¥Simulinkä¸­ã€‚</font><font style="vertical-align: inherit;">å…¶ä»£ç åŒ…å«åœ¨</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exlib.c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exlib.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„æºä»£ç ä¸­</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„åº“ï¼Œå…¶ä¸­åŒ…å«ä¸‰ä¸ªå‡½æ•°ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void exlib_initï¼ˆvoidï¼‰</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -æ‰“å¼€æ–‡ä»¶è¿›è¡Œå†™å…¥ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void exlib_printï¼ˆæµ®åŠ¨æ•°æ®ï¼‰</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -å°†æ•°æ®å†™å…¥æ–‡ä»¶ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void exlib_termï¼ˆvoidï¼‰</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -å…³é—­æ–‡ä»¶ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å›¾ä¹¦é¦†ç»„è£…</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¦–å…ˆï¼Œç¼–è¯‘åº“ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœåº“å·²é¢„ç¼–è¯‘å¹¶ä»¥äºŒè¿›åˆ¶æ–‡ä»¶å½¢å¼æä¾›ï¼Œåˆ™æ— éœ€æ‰§è¡Œæ­¤æ­¥éª¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ç«‹å³è½¬åˆ°æ­¥éª¤3ï¼Œä½†æ˜¯è¯·è®°ä½ï¼Œè¦ä½¿ç”¨è¯¥åº“ï¼Œæ‚¨éœ€è¦ä»åº“æä¾›ç¨‹åºè·å–.dllæ–‡ä»¶ï¼ˆå¯¹äºLinuxä¸º.soï¼‰å’Œç›¸åº”çš„å¤´æ–‡ä»¶ï¼ˆ.hï¼‰ã€‚å¯¹äºWindowsï¼Œæ‚¨è¿˜éœ€è¦ä¸€ä¸ª.libæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸æ˜¯é™æ€åº“ï¼Œè€Œæ˜¯æ‰€è°“çš„å¯¼å…¥åº“ã€‚éšå¼é“¾æ¥éœ€è¦æ­¤å¯¼å…¥åº“ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä½¿ç”¨MATLAB mexå‘½ä»¤ï¼Œè¯¥å‘½ä»¤è°ƒç”¨å½“å‰çš„æ´»åŠ¨ä¸»æœºç¼–è¯‘å™¨ä»¥ç¼–è¯‘å…±äº«åº“ï¼ˆWindowsä¸Šä¸ºexlib.dllï¼ŒLinuxä¸Šä¸ºexlib.soï¼‰ã€‚ç¡®ä¿é¦–å…ˆæ‰§è¡Œå‘½ä»¤å¾ˆé‡è¦ã€‚</font></font><br>
<pre><code class="matlab hljs">mex -setup
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€‰æ‹©ä¸€ä¸ª</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ”¯æŒçš„ç¼–è¯‘å™¨</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ä½¿ç”¨mexç¼–è¯‘åº“ï¼š</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å»ºç«‹å›¾ä¹¦é¦†çš„ä»£ç </font></font></b>
                        <div class="spoiler_text"><pre><code class="matlab hljs">mingw = strfind(mex.getCompilerConfigurations(<span class="hljs-string">'C'</span>,<span class="hljs-string">'Selected'</span>).Name,<span class="hljs-string">'MinGW64 Compiler'</span>);
<span class="hljs-keyword">if</span> isunix
    <span class="hljs-comment">% GCC</span>
    mex(<span class="hljs-string">'LDEXT=.so'</span>,<span class="hljs-string">'LINKEXPORT='</span>,<span class="hljs-string">'LINKEXPORTVER='</span>,<span class="hljs-string">'LINKLIBS='</span>,<span class="hljs-string">'exlib.c'</span>);
<span class="hljs-keyword">elseif</span> mingw
    <span class="hljs-comment">% MinGW builds static shared library, so dll and lib files are the same</span>
    <span class="hljs-comment">% loadlibrary uses the dll file, while legacy code tool looks for the lib file</span>
    mex(<span class="hljs-string">'LDEXT=.lib'</span>,<span class="hljs-string">'LINKEXPORT='</span>,<span class="hljs-string">'LINKEXPORTVER='</span>,<span class="hljs-string">'LINKLIBS='</span>,<span class="hljs-string">'exlib.c'</span>);<font></font>
    mex(<span class="hljs-string">'LDEXT=.dll'</span>,<span class="hljs-string">'LINKEXPORT='</span>,<span class="hljs-string">'LINKEXPORTVER='</span>,<span class="hljs-string">'LINKLIBS='</span>,<span class="hljs-string">'exlib.c'</span>);
<span class="hljs-keyword">else</span>
    <span class="hljs-comment">% Visual</span>
    mex(<span class="hljs-string">'LDEXT=.dll'</span>,<span class="hljs-string">'LINKEXPORT='</span>,<span class="hljs-string">'LINKEXPORTVER='</span>,<span class="hljs-string">'CMDLINE300="del exlib.exp exlib.dll.manifest"'</span>,<span class="hljs-string">'exlib.c'</span>);
<span class="hljs-keyword">end</span>
Building with <span class="hljs-string">'gcc'</span>.<font></font>
MEX completed successfully.</code></pre><br>
</div>
                    </div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ£€æŸ¥ç¼–è¯‘çš„åº“</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¼–è¯‘åï¼Œæ‚¨éœ€è¦ç¡®ä¿å¯ä»¥åœ¨MATLABä¸­åŠ è½½å’Œä½¿ç”¨ç”Ÿæˆçš„åº“ï¼š</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ£€æŸ¥åº“çš„ä»£ç </font></font></b>
                        <div class="spoiler_text"><pre><code class="matlab hljs"><span class="hljs-comment">% Load the library</span>
[~,~] = loadlibrary([<span class="hljs-string">'exlib'</span>,system_dependent(<span class="hljs-string">'GetSharedLibExt'</span>)],<span class="hljs-string">'exlib.h'</span>);
<span class="hljs-comment">% Display functions available in the library</span>
libfunctionsview(<span class="hljs-string">'exlib'</span>);
<span class="hljs-comment">% Initialize</span>
calllib(<span class="hljs-string">'exlib'</span>,<span class="hljs-string">'exlib_init'</span>);
<span class="hljs-comment">% Step</span>
<span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:<span class="hljs-number">10</span>
    calllib(<span class="hljs-string">'exlib'</span>,<span class="hljs-string">'exlib_print'</span>,single(<span class="hljs-built_in">i</span>));
<span class="hljs-keyword">end</span>
<span class="hljs-comment">% Terminate</span>
calllib(<span class="hljs-string">'exlib'</span>,<span class="hljs-string">'exlib_term'</span>);
<span class="hljs-comment">% Unload the library</span>
unloadlibrary(<span class="hljs-string">'exlib'</span>);
<span class="hljs-comment">% Show contents of generated file</span>
<span class="hljs-built_in">type</span>(<span class="hljs-string">'exlib.txt'</span>);
<span class="hljs-number">0.000000</span>
<span class="hljs-number">1.000000</span>
<span class="hljs-number">2.000000</span>
<span class="hljs-number">3.000000</span>
<span class="hljs-number">4.000000</span>
<span class="hljs-number">5.000000</span>
<span class="hljs-number">6.000000</span>
<span class="hljs-number">7.000000</span>
<span class="hljs-number">8.000000</span>
<span class="hljs-number">9.000000</span>
<span class="hljs-number">10.000000</span>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæˆ‘ä»¬ç¡®ä¿ä¸€åˆ‡æ­£å¸¸ï¼Œè®©æˆ‘ä»¬å¼€å§‹ä½¿ç”¨Simulinkï¼</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨Så‡½æ•°è°ƒç”¨å…±äº«åº“</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Så‡½æ•°ä½¿æ‚¨å¯ä»¥åœ¨Simulinkä¸­ä½¿ç”¨Cä»£ç ã€‚</font><font style="vertical-align: inherit;">è¿™ç§æ–¹æ³•å…è®¸ç”¨æˆ·å¼€å‘åŠ è½½åº“å’Œè°ƒç”¨å…¶å‡½æ•°æ‰€éœ€çš„ä»»ä½•Cä»£ç ã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œå°†æ­¤ä»£ç ç¼–è¯‘ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ŒSimulinkå¯ä»¥è¯†åˆ«è¯¥äºŒè¿›åˆ¶æ–‡ä»¶å¹¶å°†å…¶é“¾æ¥åˆ°å…±äº«åº“ã€‚</font><font style="vertical-align: inherit;">æ­¤äºŒè¿›åˆ¶æ–‡ä»¶ç§°ä¸ºSå‡½æ•°ã€‚</font><font style="vertical-align: inherit;">Simulinkæœ‰ä¸€ä¸ªç”¨äºè°ƒç”¨æ­¤Så‡½æ•°çš„å—ã€‚</font><font style="vertical-align: inherit;">æœ‰å‡ ç§æ–¹æ³•å¯ä»¥åœ¨Simulinkä¸­åˆ›å»ºSå‡½æ•°ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨æ—§ç‰ˆä»£ç å·¥å…·</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¬¬ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¼ ç»Ÿä»£ç å·¥å…·</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè¯¥å·¥å…·å¯å¸®åŠ©æ‚¨æ ¹æ®ä½¿ç”¨MATLABåˆ›å»ºçš„è§„èŒƒè‡ªåŠ¨åˆ›å»ºSå‡½æ•°ã€‚</font><font style="vertical-align: inherit;">åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼ŒSå‡½æ•°é“¾æ¥åˆ°å¯¼å…¥åº“ï¼ˆåœ¨Windowsä¸Šï¼Œæˆ‘ä»¬éœ€è¦ç›¸åº”çš„* .libæ–‡ä»¶ï¼‰ï¼Œç„¶åè°ƒç”¨è¯¥åº“å‡½æ•°ã€‚</font><font style="vertical-align: inherit;">è¿™ç§æ–¹æ³•ç§°ä¸ºéšå¼é“¾æ¥ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¦–å…ˆï¼Œæ‚¨éœ€è¦åˆå§‹åŒ–æ—§ç‰ˆä»£ç å·¥å…·çš„ç»“æ„</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”¨äºåˆå§‹åŒ–æ—§ç‰ˆä»£ç å·¥å…·ç»“æ„çš„ä»£ç </font></font></b>
                        <div class="spoiler_text"><pre><code class="matlab hljs">specs = legacy_code(<span class="hljs-string">'initialize'</span>);
<span class="hljs-comment">% Prototype for the initialization function</span>
specs.StartFcnSpec = <span class="hljs-string">'exlib_init()'</span>;
<span class="hljs-comment">% Prototype for the step function</span>
specs.OutputFcnSpec = <span class="hljs-string">'exlib_print(single u1)'</span>;
<span class="hljs-comment">% Prototype for the terminate function</span>
specs.TerminateFcnSpec = <span class="hljs-string">'exlib_term()'</span>;
<span class="hljs-comment">% Shared library to link with (.so on Linux and .dll on Windows)</span>
specs.HostLibFiles = {[<span class="hljs-string">'exlib'</span>,strrep(system_dependent(<span class="hljs-string">'GetSharedLibExt'</span>),<span class="hljs-string">'.dll'</span>,<span class="hljs-string">'.lib'</span>)]};
<span class="hljs-comment">% We must supply header file when linking with shared library, otherwise</span>
<span class="hljs-comment">% compiler might make wrong assumptions about function's prototype.</span>
specs.HeaderFiles = {<span class="hljs-string">'exlib.h'</span>};<font></font>
specs.SFunctionName = <span class="hljs-string">'sfun_exlib'</span>;
</code></pre><br>
</div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆ›å»ºä¸€ä¸ªSå‡½æ•°ï¼Œè¿›è¡Œç¼–è¯‘å’Œé“¾æ¥ï¼š</font></font><br>
<pre><code class="matlab hljs">legacy_code(<span class="hljs-string">'generate_for_sim'</span>,specs);<font></font>
### Start Compiling sfun_exlib<font></font>
    mex(<span class="hljs-string">'sfun_exlib.c'</span>, <span class="hljs-string">'-I/tmp/simulink_shrlib_fex'</span>, <span class="hljs-string">'/tmp/simulink_shrlib_fex/exlib.so'</span>)<font></font>
Building with <span class="hljs-string">'gcc'</span>.<font></font>
MEX completed successfully.<font></font>
### Finish Compiling sfun_exlib<font></font>
### Exit<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€åï¼Œåˆ›å»ºSimulinkå—ï¼š</font></font><br>
<pre><code class="matlab hljs">legacy_code(<span class="hljs-string">'slblock_generate'</span>,specs);
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿è¡Œæ¨¡æ‹Ÿï¼š</font></font><br>
<pre><code class="matlab hljs">open_system(<span class="hljs-string">'simlib_test'</span>);<font></font>
snapnow;<font></font>
sim(<span class="hljs-string">'simlib_test'</span>);
<span class="hljs-comment">% Observe the results:</span>
<span class="hljs-built_in">type</span>(<span class="hljs-string">'exlib.txt'</span>);
<span class="hljs-number">0.000000</span>
<span class="hljs-number">1.000000</span>
<span class="hljs-number">2.000000</span>
<span class="hljs-number">3.000000</span>
<span class="hljs-number">4.000000</span>
<span class="hljs-number">5.000000</span>
<span class="hljs-number">6.000000</span>
<span class="hljs-number">7.000000</span>
<span class="hljs-number">8.000000</span>
<span class="hljs-number">9.000000</span>
<span class="hljs-number">10.000000</span></code></pre><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰‹åŠ¨ç¼–å†™Så‡½æ•°</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¬¬äºŒç§æ–¹æ³•æ˜¯ç¼–å†™è‡ªå·±çš„Så‡½æ•°ï¼Œä»¥åŠ è½½å…±äº«åº“å¹¶ä»è¯¥åº“ä¸­è°ƒç”¨å‡½æ•°ã€‚</font><font style="vertical-align: inherit;">è¿™ç§æ–¹æ³•å°†ä½¿ç”¨æ˜¾å¼é“¾æ¥ï¼Œä¹Ÿç§°ä¸ºè¿è¡Œæ—¶é“¾æ¥ã€‚</font><font style="vertical-align: inherit;">æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯é‡‡ç”¨æ—§ç‰ˆä»£ç å·¥å…·ä¹‹å‰è‡ªåŠ¨ç”Ÿæˆçš„Så‡½æ•°ã€‚</font><font style="vertical-align: inherit;">åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œä¿®æ”¹äº†</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mdlStart</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mdlOutputs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mdlTerminate</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡½æ•°</font><font style="vertical-align: inherit;">ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¿®æ”¹åè¿™äº›åŠŸèƒ½çš„å¤–è§‚å¦‚ä¸‹ï¼š</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŸ¥çœ‹ä»£ç </font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mdlStart</span><span class="hljs-params">(SimStruct *S)</span>
</span>{
  <span class="hljs-comment">/*
   * Load the dynamic library
   */</span><font></font>
<font></font>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined(__GNUC__) &amp;&amp; !defined(__MINGW32__)</span>
    <span class="hljs-keyword">void</span> (*exlib_init_ptr)(<span class="hljs-keyword">void</span>);<font></font>
    dllHandle = dlopen(<span class="hljs-string">"./exlib.so"</span>,RTLD_LAZY);<font></font>
    exlib_init_ptr = dlsym(dllHandle, <span class="hljs-string">"exlib_init"</span>);
  <span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
    exlib_init_type exlib_init_ptr = <span class="hljs-literal">NULL</span>;<font></font>
    dllHandle = LoadLibrary(<span class="hljs-string">"exlib.dll"</span>);<font></font>
    exlib_init_ptr = (exlib_init_type)GetProcAddress(dllHandle,<span class="hljs-string">"exlib_init"</span>);
  <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
  exlib_init_ptr();<font></font>
}<font></font>
</code></pre><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mdlOutputs</span><span class="hljs-params">(SimStruct *S, int_T tid)</span>
</span>{<font></font>
  real32_T *u1 = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined(__GNUC__) &amp;&amp; !defined(__MINGW32__)</span>
    <span class="hljs-keyword">void</span> (*exlib_print_ptr)(<span class="hljs-keyword">float</span>);<font></font>
    exlib_print_ptr = dlsym(dllHandle,<span class="hljs-string">"exlib_print"</span>);
  <span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
    exlib_print_type exlib_print_ptr = <span class="hljs-literal">NULL</span>;<font></font>
    exlib_print_ptr = (exlib_print_type)GetProcAddress(dllHandle,<span class="hljs-string">"exlib_print"</span>);
  <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
  <span class="hljs-comment">/*
   * Get access to Parameter/Input/Output/DWork/size information
   */</span>
  u1 = (real32_T *) ssGetInputPortSignal(S, <span class="hljs-number">0</span>);<font></font>
<font></font>
  <span class="hljs-comment">/*
   * Call the function from library
   */</span><font></font>
  exlib_print_ptr( *u1);<font></font>
}<font></font>
</code></pre><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mdlTerminate</span><span class="hljs-params">(SimStruct *S)</span>
</span>{
  <span class="hljs-comment">/*
   * Unload the dynamic library
   */</span><font></font>
<font></font>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined(__GNUC__) &amp;&amp; !defined(__MINGW32__)</span>
    <span class="hljs-keyword">void</span> (*exlib_term_ptr)(<span class="hljs-keyword">void</span>);<font></font>
    exlib_term_ptr = dlsym(dllHandle,<span class="hljs-string">"exlib_term"</span>);<font></font>
    exlib_term_ptr();<font></font>
    dlclose(dllHandle);<font></font>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
    exlib_term_type exlib_term_ptr = <span class="hljs-literal">NULL</span>;<font></font>
    exlib_term_ptr = (exlib_term_type)GetProcAddress(dllHandle,<span class="hljs-string">"exlib_term"</span>);<font></font>
    exlib_term_ptr();<font></font>
    FreeLibrary(dllHandle);<font></font>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¼–è¯‘ç”Ÿæˆçš„Så‡½æ•°ï¼š</font></font><br>
<pre><code class="matlab hljs"><span class="hljs-keyword">if</span> isunix<font></font>
    mex(<span class="hljs-string">'sfun_exlib_dyn.c'</span>,<span class="hljs-string">'-ldl'</span>);
<span class="hljs-keyword">else</span>
    mex(<span class="hljs-string">'sfun_exlib_dyn.c'</span>);
<span class="hljs-keyword">end</span>
Building with <span class="hljs-string">'gcc'</span>.<font></font>
MEX completed successfully.</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¹¶è¿è¡Œæ¨¡æ‹Ÿï¼š</font></font><br>
<pre><code class="matlab hljs">open_system(<span class="hljs-string">'simlib_test_dyn'</span>);<font></font>
sim(<span class="hljs-string">'simlib_test_dyn'</span>);
<span class="hljs-comment">% Observe the results:</span>
<span class="hljs-built_in">type</span>(<span class="hljs-string">'exlib.txt'</span>);
<span class="hljs-number">0.000000</span>
<span class="hljs-number">1.000000</span>
<span class="hljs-number">2.000000</span>
<span class="hljs-number">3.000000</span>
<span class="hljs-number">4.000000</span>
<span class="hljs-number">5.000000</span>
<span class="hljs-number">6.000000</span>
<span class="hljs-number">7.000000</span>
<span class="hljs-number">8.000000</span>
<span class="hljs-number">9.000000</span>
<span class="hljs-number">10.000000</span></code></pre><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨S-Function Builder</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S-Function Builder</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¨¡å—</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å•å…ƒï¼Œå°±å¤æ‚æ€§è€Œè¨€ï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯ä¼ ç»Ÿä»£ç å·¥å…·å’Œæ‰‹å†™Så‡½æ•°ä¹‹é—´çš„äº¤å‰ã€‚</font><font style="vertical-align: inherit;">S-Function Builderæä¾›äº†ä¸€ä¸ªå›¾å½¢ç•Œé¢ï¼Œæè¿°äº†S-functionçš„ç‰¹æ€§ï¼Œå¹¶ä¸”S-functionæ˜¯è‡ªåŠ¨åˆ›å»ºçš„ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½¿ç”¨S-Function Builderæœ‰ä¸€äº›æ€§èƒ½é™åˆ¶å’Œé—®é¢˜ã€‚</font><font style="vertical-align: inherit;">å½“å‰ï¼Œè¿™è¢«è®¤ä¸ºæ˜¯åˆ›å»ºSå‡½æ•°çš„ä¸€ç§è¿‡æ—¶æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">å»ºè®®ä½¿ç”¨CåŠŸèƒ½å—ï¼Œè¯¥åŠŸèƒ½å—å‡ºç°åœ¨R2020açš„å‘è¡Œç‰ˆä¸­ï¼Œç¨åè¿›è¡Œè®¨è®ºã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨MATLAB Functionè°ƒç”¨å…±äº«åº“ </font></font></h2><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MATLAB Function</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
æ¨¡å—</font><font style="vertical-align: inherit;">å…è®¸æ‚¨ä½¿ç”¨MATLABè¯­è¨€æ¥æè¿°Simulinkä¸­çš„è‡ªå®šä¹‰ç®—æ³•ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¦ä»MATLABå‡½æ•°è°ƒç”¨å…±äº«åº“ï¼Œè¯·ä½¿ç”¨</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coder.ceval</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡½æ•°</font><font style="vertical-align: inherit;">ï¼Œè¯¥</font><font style="vertical-align: inherit;">å‡½æ•°</font><font style="vertical-align: inherit;">åªèƒ½åœ¨MATLABå‡½æ•°çš„ä¸»ä½“ï¼ˆè€ŒéMATLABï¼‰ä¸­ä½¿ç”¨ã€‚</font><font style="vertical-align: inherit;">Coder.cevalä¸éœ€è¦MATLAB Coderå³å¯å·¥ä½œã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”¨äºè°ƒç”¨å…±äº«åº“çš„MATLAB Functionæ¨¡å—çš„ä»£ç ï¼š</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŸ¥çœ‹ä»£ç </font></font></b>
                        <div class="spoiler_text"><pre><code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fcn</span><span class="hljs-params">(u)</span></span>
<span class="hljs-comment">%#codegen</span><font></font>
<font></font>
<span class="hljs-comment">% Keep track of initialization and runtime count</span>
<span class="hljs-keyword">persistent</span> runTimeCnt<font></font>
<font></font>
<span class="hljs-comment">% Generate library path on the fly (current directory in this case)</span>
coder.extrinsic(<span class="hljs-string">'pwd'</span>,<span class="hljs-string">'system_dependent'</span>);<font></font>
libpath = coder.const(pwd);<font></font>
<span class="hljs-comment">% Shared library to link with</span>
libname = coder.const([<span class="hljs-string">'exlib'</span>,strrep(system_dependent(<span class="hljs-string">'GetSharedLibExt'</span>),<span class="hljs-string">'.dll'</span>,<span class="hljs-string">'.lib'</span>)]);
<span class="hljs-comment">% Add the external library. Mark it as precompiled, so it won't appear as</span>
<span class="hljs-comment">% makefile target during code generation.</span>
coder.updateBuildInfo(<span class="hljs-string">'addLinkObjects'</span>,libname,libpath,<span class="hljs-number">1000</span>,<span class="hljs-built_in">true</span>,<span class="hljs-built_in">true</span>);<font></font>
coder.updateBuildInfo(<span class="hljs-string">'addIncludePaths'</span>,libpath);<font></font>
coder.cinclude(<span class="hljs-string">'exlib.h'</span>);<font></font>
<font></font>
<span class="hljs-keyword">if</span> <span class="hljs-built_in">isempty</span>(runTimeCnt)
    <span class="hljs-comment">% Initialize</span>
    coder.ceval(<span class="hljs-string">'exlib_init'</span>);<font></font>
    runTimeCnt = <span class="hljs-number">0</span>;
<span class="hljs-keyword">end</span>
<span class="hljs-comment">% Step</span>
coder.ceval(<span class="hljs-string">'exlib_print'</span>,single(u));<font></font>
runTimeCnt = runTimeCnt+<span class="hljs-number">1</span>;
<span class="hljs-comment">% Terminate on the 10th step</span>
<span class="hljs-keyword">if</span> (runTimeCnt == <span class="hljs-number">11</span>)<font></font>
    coder.ceval(<span class="hljs-string">'exlib_term'</span>);
<span class="hljs-keyword">end</span>
</code></pre><br>
</div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™ç§æ–¹æ³•æœ‰ä¸€ä¸ªç¼ºç‚¹-ç¼ºä¹åœ¨ä»¿çœŸç»“æŸæ—¶è°ƒç”¨å®Œæˆå‡½æ•°çš„å¥½æ–¹æ³•ï¼ˆä¸MATLAB Systemå—ç›¸æ¯”ï¼‰ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‚¨å¯ä»¥é€šè¿‡è®¾ç½®exlib_termï¼ˆï¼‰æ¥å®šä¹‰æ¨¡å‹çš„å®Œæˆå‡½æ•°ã€‚åœ¨æ¨¡å‹è®¾ç½®ä¸­çš„</font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¨¡æ‹Ÿç›®æ ‡-&gt;è‡ªå®šä¹‰ä»£ç -&gt;ç»ˆæ­¢åŠŸèƒ½</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç±»åˆ«ä¸­</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚å¦‚æœåœ¨æ¨¡å‹è®¾ç½®ä¸­è®¾ç½®äº†â€œå¯¼å…¥è‡ªå®šä¹‰ä»£ç â€å‚æ•°ï¼Œåˆ™éœ€è¦åœ¨â€œæ¨¡æ‹Ÿç›®æ ‡â€é¢æ¿ä¸­æŒ‡å®šæ‰€æœ‰ä»£ç ä¾èµ–æ€§ï¼ˆè€Œä¸æ˜¯ä½¿ç”¨</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coder.cinclude</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coder.updateBuildInfo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã€‚å¦‚æœæœªè®¾ç½®æ­¤å‚æ•°ï¼Œåˆ™å¯ä»¥ç»„åˆæ¥è‡ªSimulation Targetï¼Œcoder.cincludeå’Œcoder.updateBuildInfoçš„è®¾ç½®ã€‚</font></font><br>
</i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coder.cinclude</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coder.updateBuildInfo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå¹¶</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŒ‰ç…§</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çº¦å®š</font><font style="vertical-align: inherit;">è°ƒç”¨</font><i><font style="vertical-align: inherit;">exlib_termï¼ˆï¼‰</font></i><font style="vertical-align: inherit;">ï¼Œå¦‚ä¸Šé¢çš„ç¤ºä¾‹æ‰€ç¤ºã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿è¡Œæ¨¡æ‹Ÿï¼š</font></font><br>
<pre><code class="matlab hljs">open_system(<span class="hljs-string">'simlib_test_mlf'</span>);<font></font>
sim(<span class="hljs-string">'simlib_test_mlf'</span>);
<span class="hljs-comment">% Observe the results:</span>
<span class="hljs-built_in">type</span>(<span class="hljs-string">'exlib.txt'</span>);
<span class="hljs-number">0.000000</span>
<span class="hljs-number">1.000000</span>
<span class="hljs-number">2.000000</span>
<span class="hljs-number">3.000000</span>
<span class="hljs-number">4.000000</span>
<span class="hljs-number">5.000000</span>
<span class="hljs-number">6.000000</span>
<span class="hljs-number">7.000000</span>
<span class="hljs-number">8.000000</span>
<span class="hljs-number">9.000000</span>
<span class="hljs-number">10.000000</span></code></pre><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»Stateflowè°ƒç”¨å…±äº«åº“ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœè¦åœ¨</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stateflow</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å›¾ä¸­ä½¿ç”¨å…±äº«åº“å‡½æ•°ï¼Œ</font><font style="vertical-align: inherit;">åˆ™åº”ç›´æ¥ä»Stateflowè°ƒç”¨è¿™äº›å‡½æ•°ã€‚ Stateflowæ–‡æ¡£ä¸­æœ‰ä¸€äº›ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨Stateflowä¸­è°ƒç”¨å¤–éƒ¨å‡½æ•°éå¸¸ç®€å•-æ‚¨éœ€è¦åœ¨Stateflowå›¾ä¸­æŒ‡å®šå‡½æ•°çš„åç§°ï¼š</font></font><br>
<img src="https://habrastorage.org/webt/_f/3m/z7/_f3mz7djr11eebq8egiisjpk9ru.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ­¤å¤–ï¼Œæ‚¨éœ€è¦é…ç½®æ¨¡å‹å‚æ•°ï¼Œä»¥ä¾¿StateflowçŸ¥é“åœ¨å“ªé‡Œå¯»æ‰¾è¿™äº›å¤–éƒ¨å‡½æ•°ã€‚åœ¨</font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simulation</font></font></i></b><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Target- </font></font></i><font style="vertical-align: inherit;"><b><i><font style="vertical-align: inherit;">&gt;è‡ªå®šä¹‰ä»£ç -&gt;åº“çš„è®¾ç½®ä¸­ï¼Œæ‚¨</font></i></b><font style="vertical-align: inherit;">éœ€è¦è¾“å…¥</font><i><font style="vertical-align: inherit;">exlib.libï¼ˆæˆ–Linuxä¸­çš„exlib.soï¼‰</font></i><font style="vertical-align: inherit;">ã€‚åœ¨</font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simulation</font></font></i></b><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Target- </font></font></i><font style="vertical-align: inherit;"><b><i><font style="vertical-align: inherit;">&gt;è‡ªå®šä¹‰ä»£ç -&gt;å¤´æ–‡ä»¶ä¸­ï¼Œæ‚¨</font></i></b><font style="vertical-align: inherit;">éœ€è¦è¾“å…¥</font><i><font style="vertical-align: inherit;">#includeâ€œ exlib.hâ€</font></i><font style="vertical-align: inherit;">ã€‚åŒæ ·é‡è¦çš„æ˜¯ä¸è¦å¿˜è®°æŒ‡å®šå®ŒæˆåŠŸèƒ½ã€‚åœ¨</font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simulation</font></font></i></b><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Target- </font></font></i><font style="vertical-align: inherit;"><b><i><font style="vertical-align: inherit;">&gt;è‡ªå®šä¹‰ä»£ç -&gt; Terminateå‡½æ•°</font></i></b><font style="vertical-align: inherit;">å¿…é¡»æŒ‡å®š</font><i><font style="vertical-align: inherit;"> exlib_termï¼ˆï¼‰; </font></i><font style="vertical-align: inherit;">ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿è¡Œæ¨¡æ‹Ÿï¼š</font></font><br>
<pre><code class="matlab hljs"><span class="hljs-keyword">if</span> isunix<font></font>
    set_param(<span class="hljs-string">'simlib_test_sf'</span>,<span class="hljs-string">'SimUserLibraries'</span>,<span class="hljs-string">'exlib.so'</span>);
<span class="hljs-keyword">end</span>
sim(<span class="hljs-string">'simlib_test_sf'</span>);
<span class="hljs-comment">% Observe the results:</span>
<span class="hljs-built_in">type</span>(<span class="hljs-string">'exlib.txt'</span>);
<span class="hljs-number">0.000000</span>
<span class="hljs-number">1.000000</span>
<span class="hljs-number">2.000000</span>
<span class="hljs-number">3.000000</span>
<span class="hljs-number">4.000000</span>
<span class="hljs-number">5.000000</span>
<span class="hljs-number">6.000000</span>
<span class="hljs-number">7.000000</span>
<span class="hljs-number">8.000000</span>
<span class="hljs-number">9.000000</span>
<span class="hljs-number">10.000000</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯·æ³¨æ„ï¼Œæœ¬èŠ‚ä¸­çš„ä¿¡æ¯é€‚ç”¨äºä½¿ç”¨</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cæ“ä½œè¯­è¨€çš„</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Stateflowå›¾</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å¦‚æœStateflowå›¾ä½¿ç”¨</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MATLABåŠ¨ä½œè¯­è¨€</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œåˆ™</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éœ€è¦coder.ceval</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä¸MATLAB Functionä¸€æ ·ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨MATLAB Systemæ¨¡å—è°ƒç”¨å…±äº«åº“ </font></font></h2> <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MATLAB Systemæ¨¡å—</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…è®¸æ‚¨åœ¨Simulinkä¸­ä½¿ç”¨ç³»ç»Ÿå¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">æœ‰å…³æ­¤å—çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§æ–‡æ¡£ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹ç³»ç»Ÿå¯¹è±¡çš„æ”¯æŒå‡ºç°åœ¨R2013bçš„Simulinkä¸­ã€‚</font><font style="vertical-align: inherit;">è®¸å¤šäººä½¿ç”¨ç³»ç»Ÿå¯¹è±¡æ˜¯å› ä¸ºå®ƒä»¬å¯ä»¥è½»æ¾å®šä¹‰åˆå§‹åŒ–ï¼Œä»¿çœŸå’Œå®ŒæˆåŠŸèƒ½ã€‚</font><font style="vertical-align: inherit;">è€Œä¸”ï¼Œç³»ç»Ÿå¯¹è±¡å¯ä»¥å°†è¾…åŠ©MATLABä»£ç ç”¨äºè¿™äº›åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼Œç”¨äºæ­¥è¿›å‡½æ•°çš„é¢„å¤„ç†å’Œåå¤„ç†ï¼‰ï¼Œè€Œæ— éœ€ç¼–å†™Cä»£ç ï¼Œ</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™å°±æ˜¯MATLAB Systemæ¨¡å—ä¸­ä½¿ç”¨çš„ç³»ç»Ÿå¯¹è±¡çš„æ ·å­ï¼š</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç³»ç»Ÿç›®æ ‡ä»£ç </font></font></b>
                        <div class="spoiler_text"><pre><code class="matlab hljs"><span class="hljs-keyword">classdef</span> exlib &lt; matlab.System
    <span class="hljs-comment">% Call exlib shared library</span>
    <span class="hljs-comment">%</span>
    <span class="hljs-comment">% This example shows how to call shared library from Simulink using</span>
    <span class="hljs-comment">% MATLAB System block.</span>
    <span class="hljs-keyword">properties</span> (Nontunable,Access=private)<font></font>
        libName = exlib.getLibName;<font></font>
        libPath = pwd;<font></font>
        libHeader = <span class="hljs-string">'exlib.h'</span>;
    <span class="hljs-keyword">end</span><font></font>
    <font></font>
    <span class="hljs-keyword">methods</span> (Static)
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">libName</span> = <span class="hljs-title">getLibName</span></span>
            <span class="hljs-keyword">if</span> isunix<font></font>
                libName = <span class="hljs-string">'exlib.so'</span>;
            <span class="hljs-keyword">else</span>
                libName = <span class="hljs-string">'exlib.lib'</span>;
            <span class="hljs-keyword">end</span>
        <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span><font></font>
    <font></font>
    <span class="hljs-keyword">methods</span> (Access=protected)
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setupImpl</span><span class="hljs-params">(obj, ~)</span></span>
            <span class="hljs-comment">% Initialize.</span>
            coder.updateBuildInfo(<span class="hljs-string">'addLinkObjects'</span>,obj.libName,obj.libPath,<span class="hljs-number">1000</span>,<span class="hljs-built_in">true</span>,<span class="hljs-built_in">true</span>);<font></font>
            coder.updateBuildInfo(<span class="hljs-string">'addIncludePaths'</span>,obj.libPath);<font></font>
            coder.cinclude(obj.libHeader);<font></font>
            coder.ceval(<span class="hljs-string">'exlib_init'</span>);
        <span class="hljs-keyword">end</span><font></font>
        <font></font>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stepImpl</span><span class="hljs-params">(~, u)</span></span>
            <span class="hljs-comment">% Step.</span>
            coder.ceval(<span class="hljs-string">'exlib_print'</span>,u);
        <span class="hljs-keyword">end</span><font></font>
        <font></font>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">releaseImpl</span><span class="hljs-params">(~)</span></span>
            <span class="hljs-comment">% Terminate.</span>
            coder.ceval(<span class="hljs-string">'exlib_term'</span>);
        <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></code></pre><br>
</div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿è¡Œæ¨¡æ‹Ÿï¼š</font></font><br>
<pre><code class="matlab hljs">open_system(<span class="hljs-string">'simlib_test_mls'</span>);<font></font>
sim(<span class="hljs-string">'simlib_test_mls'</span>);
<span class="hljs-comment">% Observe the results:</span>
<span class="hljs-built_in">type</span>(<span class="hljs-string">'exlib.txt'</span>);
<span class="hljs-number">0.000000</span>
<span class="hljs-number">1.000000</span>
<span class="hljs-number">2.000000</span>
<span class="hljs-number">3.000000</span>
<span class="hljs-number">4.000000</span>
<span class="hljs-number">5.000000</span>
<span class="hljs-number">6.000000</span>
<span class="hljs-number">7.000000</span>
<span class="hljs-number">8.000000</span>
<span class="hljs-number">9.000000</span>
<span class="hljs-number">10.000000</span></code></pre><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨Cè°ƒç”¨ç¨‹åºå—è°ƒç”¨å…±äº«åº“ </font></font></h2> <br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cè°ƒç”¨ç¨‹åº</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
å—</font><font style="vertical-align: inherit;">å…è®¸æ‚¨ç›´æ¥ä»Simulinkè°ƒç”¨Cå‡½æ•°ã€‚æœ‰å…³æ­¤å—çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§æ–‡æ¡£ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯ä¸€ç§ç›¸å¯¹è¾ƒæ–°çš„æ–¹æ³•ï¼Œæœ€æ—©å‡ºç°åœ¨MATLAB R2018bä¸­ã€‚å…¶ä¸»è¦ç›®çš„æ˜¯ä½¿Simulinkä¸­çš„å‡½æ•°è°ƒç”¨å’ŒCåº“å˜å¾—éå¸¸ç®€å•ã€‚ä½†æ˜¯å®ƒæœ‰å±€é™æ€§ï¼Œæ‚¨å¯ä»¥åœ¨æ­¤å—çš„æ–‡æ¡£ä¸­é˜…è¯»ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°†</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exlib.so/exlib.lib</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·»åŠ åˆ°</font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simulation</font></font></i></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;"> Target- </font></i><b><i><font style="vertical-align: inherit;">&gt;åº“</font></i></b><font style="vertical-align: inherit;">å¹¶</font><font style="vertical-align: inherit;">åœ¨æ¨¡å‹è®¾ç½®çš„</font><b><i><font style="vertical-align: inherit;">Simulation</font></i></b></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Target- </font></font></i><font style="vertical-align: inherit;"></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; Header</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸­åŒ…å«</font><i><font style="vertical-align: inherit;">#includeâ€œ exlib.hâ€</font></i><font style="vertical-align: inherit;">å</font><font style="vertical-align: inherit;">ï¼Œåªéœ€å•å‡»Cè°ƒç”¨ç¨‹åºå—ä¸­çš„â€œåˆ·æ–°è‡ªå®šä¹‰ä»£ç â€æŒ‰é’®ï¼ŒæŸ¥çœ‹åº“ä¸­åŒ…å«çš„æ‰€æœ‰åŠŸèƒ½ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€‰æ‹©</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exlib_print</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡½æ•°å</font><font style="vertical-align: inherit;">ï¼Œå°†è‡ªåŠ¨å¡«å†™ç«¯å£è§„èŒƒå¯¹è¯æ¡†ï¼š</font></font><br>
<img src="https://habrastorage.org/webt/4s/sz/bd/4sszbddxgbpffb3urxzbw2dv-ua.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŒæ ·ï¼Œæ‚¨éœ€è¦å°†</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exlib_init</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exlib_term</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡½æ•°è°ƒç”¨æ·»åŠ </font><font style="vertical-align: inherit;">åˆ°Simulation Targetã€‚</font><font style="vertical-align: inherit;">æ‚¨è¿˜å¯ä»¥æ·»åŠ å‡ ä¸ªå…¶ä»–çš„Cè°ƒç”¨ç¨‹åºå—æ¥ç›´æ¥è°ƒç”¨åˆå§‹åŒ–å’Œç»ˆæ­¢å‡½æ•°ã€‚</font><font style="vertical-align: inherit;">è¿™äº›Cè°ƒç”¨ç¨‹åºå—éœ€è¦æ”¾ç½®åœ¨Initialize Functionå’ŒTerminate Functionå­ç³»ç»Ÿä¸­ã€‚</font><font style="vertical-align: inherit;">æ‚¨è¿˜å¯ä»¥è€ƒè™‘Stateflowä¸­çš„ä»¥ä¸‹ç¤ºä¾‹ï¼š</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®¡åˆ’å­ç³»ç»Ÿåœ¨ç‰¹å®šæ—¶é—´æ‰§è¡Œ</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
è¿è¡Œæ¨¡æ‹Ÿï¼š</font></font><br>
<pre><code class="matlab hljs">open_system(<span class="hljs-string">'simlib_test_ccaller'</span>);
<span class="hljs-keyword">if</span> isunix<font></font>
    set_param(<span class="hljs-string">'simlib_test_ccaller'</span>,<span class="hljs-string">'SimUserLibraries'</span>,<span class="hljs-string">'exlib.so'</span>);
<span class="hljs-keyword">end</span>
sim(<span class="hljs-string">'simlib_test_ccaller'</span>);
<span class="hljs-comment">% Observe the results:</span>
<span class="hljs-built_in">type</span>(<span class="hljs-string">'exlib.txt'</span>);
<span class="hljs-number">0.000000</span>
<span class="hljs-number">1.000000</span>
<span class="hljs-number">2.000000</span>
<span class="hljs-number">3.000000</span>
<span class="hljs-number">4.000000</span>
<span class="hljs-number">5.000000</span>
<span class="hljs-number">6.000000</span>
<span class="hljs-number">7.000000</span>
<span class="hljs-number">8.000000</span>
<span class="hljs-number">9.000000</span>
<span class="hljs-number">10.000000</span></code></pre><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨CåŠŸèƒ½å—è°ƒç”¨å…±äº«åº“</font></font></h2> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°†å¤–éƒ¨ä»£ç é›†æˆåˆ°Simulinkä¸­çš„æœ€æ–°</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŠŸèƒ½</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯</font><b><font style="vertical-align: inherit;">CåŠŸèƒ½</font></b><font style="vertical-align: inherit;">å—</font><font style="vertical-align: inherit;">ã€‚ä»–å‡ºç°åœ¨R2020aä¸­ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°±æ˜“ç”¨æ€§è€Œè¨€ï¼Œå®ƒç±»ä¼¼äºCè°ƒç”¨ç¨‹åºå—ï¼Œä½†å…è®¸æ‚¨å›´ç»•å¯¼å…¥çš„å‡½æ•°åˆ›å»ºCåŒ…è£…å™¨ï¼ˆå› æ­¤ï¼Œæ­¤å—ç±»ä¼¼äºS-Function Builderï¼‰ã€‚ä½†æ˜¯ï¼Œå¾ˆå¯èƒ½ï¼Œä½¿ç”¨CåŠŸèƒ½å—çš„ä¸»è¦åœºæ™¯ä¸æ˜¯è°ƒç”¨ç°æœ‰çš„Cå‡½æ•°ï¼Œè€Œæ˜¯ç¼–å†™å°æ®µCä»£ç ï¼ˆå¦‚æœåº”ç”¨ç¨‹åºä¸­éœ€è¦è¿™æ ·çš„ä»£ç ï¼‰ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½éœ€è¦è®¿é—®ç¡¬ä»¶å¯„å­˜å™¨æˆ–ç¼–è¯‘å™¨çš„å†…ç½®å‡½æ•°ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸è¦å¿˜è®°å°†</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exlib.so/exlib.lib</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·»åŠ </font><font style="vertical-align: inherit;">åˆ°è®¾ç½®</font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â€œæ¨¡æ‹Ÿç›®æ ‡-&gt;åº“â€</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#includeâ€œ exlib.hâ€ä¸­</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨</font><font style="vertical-align: inherit;">æ¨¡å‹è®¾ç½®</font><font style="vertical-align: inherit;">ä¸­çš„</font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â€œä»¿çœŸç›®æ ‡-&gt;å¤´æ–‡ä»¶â€</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®¾ç½®ä¸­ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¹‹åï¼Œåœ¨CåŠŸèƒ½å—çš„è®¾ç½®ä¸­ï¼Œæ‚¨éœ€è¦ä¸ºæ•°æ®ç±»å‹ä¸ºsingleçš„è¾“å…¥æ•°æ®æ·»åŠ ä¸€ä¸ªå­—ç¬¦ï¼Œå¹¶æŒ‡å®šè¾“å‡ºï¼Œå¼€å§‹å’Œç»“æŸä»£ç ï¼š</font></font><br>
<img src="https://habrastorage.org/webt/pm/ek/uz/pmekuz8kkzafgxf8ky1v8coqqla.png"><br>
<br>
<pre><code class="matlab hljs">open_system(<span class="hljs-string">'simlib_test_cfunction'</span>);
<span class="hljs-keyword">if</span> isunix<font></font>
    set_param(<span class="hljs-string">'simlib_test_cfunction'</span>,<span class="hljs-string">'SimUserLibraries'</span>,<span class="hljs-string">'exlib.so'</span>);
<span class="hljs-keyword">end</span>
sim(<span class="hljs-string">'simlib_test_cfunction'</span>);
<span class="hljs-comment">% Observe the results:</span>
<span class="hljs-built_in">type</span>(<span class="hljs-string">'exlib.txt'</span>);
<span class="hljs-number">0.000000</span>
<span class="hljs-number">1.000000</span>
<span class="hljs-number">2.000000</span>
<span class="hljs-number">3.000000</span>
<span class="hljs-number">4.000000</span>
<span class="hljs-number">5.000000</span>
<span class="hljs-number">6.000000</span>
<span class="hljs-number">7.000000</span>
<span class="hljs-number">8.000000</span>
<span class="hljs-number">9.000000</span>
<span class="hljs-number">10.000000</span></code></pre><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è°ƒç”¨ä½¿ç”¨åµŒå…¥å¼ç¼–ç å™¨ç”Ÿæˆçš„å…±äº«åº“ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½¿ç”¨åµŒå…¥å¼ç¼–ç å™¨çš„ä¸€ç§æ–¹æ¡ˆæ˜¯ä»Simulinkæ¨¡å‹è‡ªåŠ¨ç”ŸæˆCä»£ç å¹¶å°†æ­¤ä»£ç æ‰“åŒ…åœ¨å…±äº«åº“ä¸­ã€‚è¯¥æ–‡æ¡£ä¸­è¿˜æœ‰ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•è‡ªåŠ¨ç”Ÿæˆå…±äº«åº“å¹¶ä»ç”¨Cç¼–å†™çš„å¤–éƒ¨åº”ç”¨ç¨‹åºä¸­è°ƒç”¨å®ƒã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨åªéœ€è¦åœ¨åŒä¸€Simulinkæ¨¡å‹ä¸­å°†ç®—æ³•æˆ–ç®—æ³•çš„ä¸€éƒ¨åˆ†ä½œä¸ºCä»£ç è¿è¡Œï¼Œé‚£ä¹ˆæœ€å¥½ä½¿ç”¨Simulink Coderçš„SåŠŸèƒ½æˆ–</font><i><font style="vertical-align: inherit;">è½¯ä»¶åœ¨ç¯</font></i><font style="vertical-align: inherit;">ä»¿çœŸ</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå¦‚æœå°†Embedded Coderç”Ÿæˆçš„å…±äº«åº“ç”¨äºåŠè‡ªç„¶å»ºæ¨¡ï¼Œåˆ™å¯èƒ½æœ‰å¿…è¦å°†åŒä¸€åº“é›†æˆåˆ°å…¶ä»–å¼€å‘äººå‘˜ä½¿ç”¨çš„è¾ƒå¤§æ¨¡å‹ä¸­ï¼Œä»è€Œä¿æŠ¤å…¶çŸ¥è¯†äº§æƒã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½¿ç”¨ç”±Embedded Coderç”Ÿæˆçš„å…±äº«åº“ä¸ä½¿ç”¨æœ¬æ–‡ä¸­ä½¿ç”¨çš„å…±äº«åº“æ²¡æœ‰ä»€ä¹ˆä¸åŒã€‚</font><font style="vertical-align: inherit;">è€ƒè™‘ä¸€ä¸ªå…·æœ‰ä¸¤ä¸ªè¾“å…¥å’Œä¸€ä¸ªè¾“å‡ºçš„ç®€å•æ¨¡å‹ï¼š</font></font><br>
<pre><code class="matlab hljs">open_system(<span class="hljs-string">'simlib_test_ert'</span>);<font></font>
snapnow;<font></font>
</code></pre><br>
<img src="https://habrastorage.org/webt/wt/vo/wu/wtvowu3jc24ttsqd1qfgok9jxpc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å»ºç«‹æ¨¡å‹åï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ª.dllæ–‡ä»¶ï¼ˆåœ¨Linuxä¸Šä¸º.soï¼‰ï¼Œä¸€ä¸ª.libæ–‡ä»¶ï¼ˆç”¨äº.dllçš„å¯¼å…¥åº“ï¼‰å’Œä¸€ä¸ª.expæ–‡ä»¶ï¼ˆç”¨äºä¸.dllé“¾æ¥çš„å¯¼å‡ºæ–‡ä»¶ï¼‰ã€‚</font></font><br>
<pre><code class="matlab hljs"><span class="hljs-keyword">if</span> isunix<font></font>
    set_param(<span class="hljs-string">'simlib_test_ert'</span>,<span class="hljs-string">'CustomHeaderCode'</span>,<span class="hljs-string">'#include &lt;stddef.h&gt;'</span>);
<span class="hljs-keyword">end</span>
rtwbuild(<span class="hljs-string">'simlib_test_ert'</span>);<font></font>
### Starting build procedure <span class="hljs-keyword">for</span>: simlib_test_ert<font></font>
### Successful completion of build procedure <span class="hljs-keyword">for</span>: simlib_test_ert</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”Ÿæˆçš„å…±äº«åº“å¯¼å‡ºä»¥ä¸‹å­—ç¬¦ï¼š</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-function">ex_init
<span class="hljs-keyword">double</span> <span class="hljs-title">ex_step</span><span class="hljs-params">(<span class="hljs-keyword">double</span>, <span class="hljs-keyword">double</span>)</span>
simlib_test_ert_terminate</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é»˜è®¤æƒ…å†µä¸‹ï¼Œè¾“å…¥å’Œè¾“å‡ºè¢«å¯¼å‡ºä¸ºå…¨å±€å­—ç¬¦ï¼Œå¹¶ä¸”åˆå§‹åŒ–ï¼Œæ­¥éª¤å’Œå®ŒæˆåŠŸèƒ½éµå¾ªæ¨¡å‹å‘½åçº¦å®šã€‚</font><font style="vertical-align: inherit;">å¦‚æœ‰å¿…è¦ï¼Œæ‚¨å¯ä»¥é…ç½®å‡½æ•°åŸå‹ï¼Œç¬¦å·åç§°ç­‰ï¼ˆæœ‰å…³è¿™äº›è®¾ç½®çš„è®¨è®ºä¸åœ¨æœ¬æ–‡è®¨è®ºèŒƒå›´ä¹‹å†…ï¼‰ã€‚</font><font style="vertical-align: inherit;">åœ¨æ­¤æ¨¡å‹ä¸­ï¼Œæ¨¡å‹çš„é˜¶è·ƒå‡½æ•°çš„åŸå‹å®šä¹‰ä¸º</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Out1 = ex_stepï¼ˆIn1ï¼ŒIn2ï¼‰</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¦è°ƒç”¨è¿™äº›å‡½æ•°ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ä¸Šé¢åˆ—å‡ºçš„æ–¹æ³•ä¹‹ä¸€ã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨MATLABå‡½æ•°ï¼ˆä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä»…è°ƒç”¨stepå‡½æ•°ï¼‰ï¼š</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŸ¥çœ‹ä»£ç </font></font></b>
                        <div class="spoiler_text"><pre><code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">y</span> = <span class="hljs-title">fcn</span><span class="hljs-params">(u1, u2)</span></span>
<span class="hljs-comment">%#codegen</span><font></font>
<font></font>
<span class="hljs-comment">% Generate library path on the fly</span>
coder.extrinsic(<span class="hljs-string">'RTW.getBuildDir'</span>,<span class="hljs-string">'fullfile'</span>);<font></font>
buildDir = coder.const(RTW.getBuildDir(<span class="hljs-string">'simlib_test_ert'</span>));<font></font>
libpath = coder.const(buildDir.CodeGenFolder);<font></font>
incpath = coder.const(fullfile(buildDir.BuildDirectory,<span class="hljs-string">'simlib_test_ert.h'</span>));
<span class="hljs-comment">% Shared library to link with</span>
<span class="hljs-keyword">if</span> isunix<font></font>
    ext = <span class="hljs-string">'.so'</span>;<font></font>
    libname = [<span class="hljs-string">'simlib_test_ert'</span>,ext];
<span class="hljs-keyword">else</span>
    ext = <span class="hljs-string">'.lib'</span>;<font></font>
    libname = [<span class="hljs-string">'simlib_test_ert_'</span>,computer(<span class="hljs-string">'arch'</span>),ext];
<span class="hljs-keyword">end</span>
<span class="hljs-comment">% Add the external library. Mark it as precompiled, so it won't appear as</span>
<span class="hljs-comment">% makefile target during code generation.</span>
coder.updateBuildInfo(<span class="hljs-string">'addLinkObjects'</span>,libname,libpath,<span class="hljs-number">1000</span>,<span class="hljs-built_in">true</span>,<span class="hljs-built_in">true</span>);<font></font>
coder.updateBuildInfo(<span class="hljs-string">'addIncludePaths'</span>,libpath);<font></font>
coder.cinclude(incpath);<font></font>
<font></font>
<span class="hljs-comment">% Initialize output</span>
y = <span class="hljs-number">0</span>;
<span class="hljs-comment">% Step</span>
y = coder.ceval(<span class="hljs-string">'ex_step'</span>,u1,u2);</code></pre><br>
</div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿è¡Œæ¨¡æ‹Ÿå¹¶æŸ¥çœ‹å…¶ç»“æœï¼š</font></font><br>
<pre><code class="matlab hljs">open_system(<span class="hljs-string">'simlib_test_callert'</span>);<font></font>
sim(<span class="hljs-string">'simlib_test_callert'</span>);<font></font>
snapnow;<font></font>
</code></pre><br>
<img src="https://habrastorage.org/webt/ga/qw/vt/gaqwvt2gg4g87wrtxufr78pezxa.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘ç°</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ¬æ–‡ä»‹ç»äº†ä»Simulinkæ¨¡å‹è°ƒç”¨å…±äº«åº“çš„å„ç§æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">éšå¼å’Œæ˜¾å¼é“¾æ¥éƒ½è¢«è€ƒè™‘äº†ã€‚</font><font style="vertical-align: inherit;">æ‰€æœ‰æ–¹æ³•éƒ½å„æœ‰åˆ©å¼Šï¼Œå…¶é€‚ç”¨æ€§å–å†³äºç‰¹å®šçš„å·¥ä½œæµç¨‹ï¼Œè¦æ±‚å’Œç›®æ ‡ã€‚</font><font style="vertical-align: inherit;">å½“ä½¿ç”¨å…±äº«åº“å®ç°éšå¼é“¾æ¥æ—¶</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ï¼Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¼ ç»Ÿä»£ç å·¥å…·</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–¹æ³•æœ€æœ‰æ•ˆï¼Œå› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä»åº“ä¸­ç›´æ¥è°ƒç”¨å‡½æ•°ï¼Œè€Œé“¾æ¥å™¨å°†è´Ÿè´£å…¶ä½™çš„å·¥ä½œã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MATLAB Systemæ¨¡å—</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯å¦ä¸€ç§æä¾›ä»¥ä¸‹å¥½å¤„çš„æ–¹æ³•ï¼š</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸åˆå§‹åŒ–ï¼Œæ­¥éª¤å’Œå®ŒæˆåŠŸèƒ½çš„èŒƒä¾‹å®Œå…¨å…¼å®¹ï¼Œå¯è®©æ‚¨å°†æ‰€æœ‰è¿™äº›åŠŸèƒ½ç»´æŠ¤åœ¨æ¨¡å—æœ¬èº«å†…ï¼Œè€Œä¸æ˜¯åœ¨æ¨¡å‹èŒƒå›´å†…</font></font><br>
</li>
<li>       <br>
</li>
<li>    MATLAB     MATLAB<br>
</li>
<li> MATLAB System           (,    S-)<br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½¿ç”¨MATLAB Functionæ¨¡å—çš„ç¼ºç‚¹åœ¨äºï¼Œå…¶ä½¿ç”¨ä¼šå¯¼è‡´ä»£ç ç”Ÿæˆè¿‡ç¨‹ä¸­äº§ç”Ÿé¢å¤–çš„å¼€é”€ã€‚å› æ­¤ï¼Œä¼ ç»Ÿä»£ç å·¥å…·å’ŒSå‡½æ•°ä»ç„¶æ˜¯ç”Ÿæˆäº§å“ä»£ç çš„é¦–é€‰ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‰‹å†™çš„Så‡½æ•°æœ€é€‚åˆç”¨äºå®ç°åˆ°å…±äº«åº“çš„æ˜¾å¼é“¾æ¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦ä½¿ç”¨è¯¸å¦‚</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LoadLibrary / dlopen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetProcAddress / dlsym</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FreeLibrary / dlcloseä¹‹ç±»çš„</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡½æ•°æ‰èƒ½è°ƒç”¨è¿™äº›å‡½æ•°ã€‚</font><font style="vertical-align: inherit;">åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒR2018bä¸­å¼•å…¥</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„Cè°ƒç”¨ç¨‹åºå—</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯è°ƒç”¨Cå‡½æ•°çš„æœ€ç®€å•æ–¹æ³•ï¼Œä½†æ˜¯å®ƒæœ‰å…¶å±€é™æ€§ã€‚</font><b><font style="vertical-align: inherit;">CåŠŸèƒ½</font></b><font style="vertical-align: inherit;">å—ä¹Ÿå¯ä»¥è¿™æ ·è¯´ã€‚</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™æ˜¯R2020açš„æœ€æ–°äº§å“ã€‚</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">åœ¨æ­¤å¤„</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ä¸‹è½½æºä»£ç å’Œæ¨¡å‹</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN503894/index.html">åœ¨çº¿ä¼šè®®NskTechTalksï¼ƒ12çš„å…¬å‘Šï¼šå‰ç«¯å¼€å‘äººå‘˜å¯ä»¥åœ¨å“ªé‡Œå‘å±•ï¼Œå¦‚æœä»€ä¹ˆéƒ½æ²¡æœ‰å‘¢ï¼Ÿ</a></li>
<li><a href="../zh-CN503898/index.html">ä¸€æ—¥è¿œç¨‹å‰ç«¯</a></li>
<li><a href="../zh-CN503902/index.html">å¦‚ä½•è®©é‚»å±…ä»äº‹ä»–ä»¬çš„é¡¹ç›®æˆ–é“¶è¡Œçš„InnerSourceå·¥ä½œ</a></li>
<li><a href="../zh-CN503904/index.html">ä¸–ç•Œå’Œnä¸ªä¸–ç•Œï¼Œæˆ–äººæ–‡ç§‘å­¦</a></li>
<li><a href="../zh-CN503906/index.html">LabVIEW NXG-ç®€å•æ•°æ®ç±»å‹å’Œç±»å‹å¼ºåˆ¶</a></li>
<li><a href="../zh-CN503910/index.html">å¯¹å»è¿‡â€œ udalenkaâ€çš„äººè¿›è¡Œå®éªŒ</a></li>
<li><a href="../zh-CN503916/index.html">å­¦ä¹ åœ¨äº¤æ˜“æ‰€äº¤æ˜“ã€‚ç¬¬ä¸€éƒ¨åˆ†ï¼šå»ºç«‹æµ‹è¯•ç¯å¢ƒ</a></li>
<li><a href="../zh-CN503918/index.html">ä½¿ç”¨Goæ¨¡å—ç®¡ç†è½¯ä»¶åŒ…ï¼šå®ç”¨æŒ‡å—</a></li>
<li><a href="../zh-CN503920/index.html">æˆ‘ä»¬å¦‚ä½•åœ¨STM32ä¸Šæµ‹è¯•éº¦å…‹é£ç³»ç»Ÿï¼šYandexè®¾å¤‡å¼€å‘äººå‘˜çš„ç»éªŒ</a></li>
<li><a href="../zh-CN503922/index.html">æ¬§ç›Ÿä¸ºä½•è¦é“²é™¤é¥¼å¹²å¢™</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>