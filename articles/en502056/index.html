<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò¢ üíØ ü§∑üèΩ How to Build a Smart Home and Not Go Crazy üë©üèΩ‚Äçüîß ‚¨áÔ∏è üë®üèø‚Äçüè≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Smart furniture, which itself takes care of the order in the house, is a must-have for almost any futuristic picture. In fact, a self-regulating clima...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>How to Build a Smart Home and Not Go Crazy</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/bary_io/blog/502056/"><img src="https://habrastorage.org/webt/io/mx/xk/iomxxk5qmmqlguhptngp9zjlptu.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Smart furniture, which itself takes care of the order in the house, is a must-have for almost any futuristic picture. In fact, a self-regulating climate, automatic on and off lights and voice control of household appliances - all this can be configured now. But it will take a little experience, basic knowledge in the field of technology and sometimes programming, as well as a whole sea of ‚Äã‚Äãfantasy. In my case, I did so that only fantasy is enough, but first things first ...</font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/bq/rp/k5/bqrpk5eo6zggo-delsghlgs7y1o.jpeg" width="300" height="200" align="right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I became interested in the idea of ‚Äã‚Äãa ‚Äúsmart home‚Äù about five years ago. At first I made the simplest system. She controlled the light in the corridor and the bathroom by the motion sensor, the hood by the humidity sensor, and also the weather station - at that time everyone was crazy about them. Every self-respecting DIY-box had to make a weather station. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First of all, I equipped the apartment with a controlled relay to automatically turn on the light in the corridor and bathroom. It looked like this: one sensor stood in the hallway, the second in the bathroom.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If someone went to the bathroom, then the corridor sensor detected his movement and immediately turned on the light in the corridor and in the bathroom. At the same time, if no one entered the bathroom, then this was already fixed by the sensor located inside the bathroom. After 15 seconds, the light turned off there. If a person entered the bathroom, then the light in the corridor turned off after a minute.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I also thought over such cases if someone was thinking too much while sitting on a ‚Äúwhite friend‚Äù in the bathroom (I had a combined bathroom). For this, the light in the bathroom was divided into two groups. One turned off 3 minutes after the sensor in the bathroom stopped detecting movements, the other after 5 minutes. So for more than five minutes to stay motionless in the bathroom in the light did not work. Very disciplining. However, you could always move your hand and continue to think about the essentials. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A humidity sensor also worked in the bathroom, which automatically started the hood if the humidity exceeded 50%. As soon as the room was ventilated to 45% humidity, the hood turned off.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Management went - or rather tried to go - through the Arduino platform.&nbsp; </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a8/lo/0v/a8lo0valnq03awxxkgr-j2bvnxa.jpeg" width="265" height="222"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Photo taken from the </font></font></i><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><i><font style="vertical-align: inherit;">manufacturer's</font></i></a><i><font style="vertical-align: inherit;"> website</font></i></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><i><font style="vertical-align: inherit;"></font></i></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Almost immediately, it became clear that this platform was not entirely about creating a smart home. The main disadvantage of working with Arduino was that the platform worked without a network, and without it, no truly unified ecosystem could be obtained. Of course, I could redo the Arduino and add network support, but why? I chose a simpler path and changed this platform to another.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Having played enough with Arduino, I reconnected the house to the ESP-8266 board. In fact, this is the same Arduino, but with Wi-Fi + it is more compact in size. This module is still popular with manufacturers of gadgets for smart homes.&nbsp; </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ui/kh/ql/uikhqljobo7gz8pz2tpcfcqhbvm.jpeg" width="265" height="222"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Photo taken from the </font></font></i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Internet</font></font></i></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In parallel, I tried to make the smart home even smarter. For example, solve the problem of round-the-clock underfloor heating or an air conditioner that is always on. For this, I bought Beok Chinese WiFi thermostats. They allowed to turn off the floor heating remotely, but had to do it through a special application in the phone.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I solved the problem of remote control of the air conditioner using the Broadlink RM Pro infrared signal emulator. Nothing complicated: you record a signal from the air conditioning control panel to the emulator (there can be any technique controlled by the remote control), and then on the phone you press a button in the application, and the emulator plays the previously recorded signal. In the case of the air conditioner, I got the opportunity to turn it on and off, set the operation mode and set other parameters remotely.&nbsp;&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also installed Livolo switches. With their help, I could also turn the lights on and off over the air.&nbsp; </font></font><br>
<br>
<img src="https://habrastorage.org/webt/to/bz/s6/tobzs6u41nh4d_b_eq7tovpop8y.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of the minuses: for control, I had to install a separate application again and there was no feedback, that is, I could not see that the light was on if it was turned on or off by someone manually using a conventional switch.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Various controlled WiFi relays such as Sonoff or Tuya and even the expensive Danalock for locking the apartment, which also required a separate application, also appeared in the house. Almost all these little things (with the exception of Danalock) I bought on the Chinese site Aliexpress, where they cost a penny and allowed me to experiment without serious investments.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One of the first relatively serious purchases was the Tion breather. </font><font style="vertical-align: inherit;">With automatic CO2 control, he more or less coped, but the temperature of the air heating in the winter constantly had to be adjusted manually. </font><font style="vertical-align: inherit;">And again - to manage it was necessary to install a separate application.&nbsp;</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8w/pn/pd/8wpnpdu6oip9ck-a_qn8z6bv8i4.jpeg" width="265" height="222"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The photo was taken from the </font></font></i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">manufacturer‚Äôs</font></font></i></a><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;"> website </font></i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><i><font style="vertical-align: inherit;">.</font></i></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
All the sensors and controllers that I tried then, I can‚Äôt even remember. </font><font style="vertical-align: inherit;">My smartphone was clogged with applications to manage them. </font><font style="vertical-align: inherit;">It was a whole zoo, which constantly had to follow. </font><font style="vertical-align: inherit;">I tried to combine the management of these applications through all sorts of aggregators like HomeBridge / MajorDomo, etc. </font><font style="vertical-align: inherit;">But everyone showed their significant shortcomings:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unfriendly interface, and sometimes just a terrible interface</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lack of support for all used applications</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">complex connection</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The search for an application for centralized management of such a volume of sensors, controllers and other control systems has not led to success. Then I tried to independently bring to mind one of the ‚Äúsmart‚Äù devices - the very Tion breather. I wrote a script to automatically control the heating temperature depending on the room temperature. The fact is that the ventilation system did not have an automatic adjustment of the air heating temperature. It turned out that the room was either super-hot or super-cold. There was no way to achieve a middle ground. Here, with the help of a written script and breather, this problem was solved.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Success with a script for the breather prompted me to create my own application for managing a smart home. The main goal was to create a program with convenient integration of smart devices, multi-level automation conditions and the ability to manage all devices in the house.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For about a year, I myself was engaged in back-end and front-end application development.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The server side is written in NodeJS. The choice in favor of NodeJS was made due to the developed community, in which there are implemented protocols for almost all devices on the market. The client part is written in Angular (Ionic) and runs on Android / iOS. In general, the classic client-server architecture. </font></font><br>
<br>
<i><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On a note:</font></font></strong></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the process of working on the application, I got a technical insight about the use of impurities when writing device drivers. </font><font style="vertical-align: inherit;">I don‚Äôt know, maybe for some it‚Äôs elementary, but it really became easier for me to breathe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I rewrote device drivers many times until I came to something like this:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example code of one of the devices</font></font></b>
                        <div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword">import</span> {XiaomiSubdeviceV2} <span class="hljs-keyword">from</span> <span class="hljs-string">'../xiaomi.subdevice.v2'</span>;
<span class="hljs-keyword">import</span> {load_power} <span class="hljs-keyword">from</span> <span class="hljs-string">'../capabilities/load_power'</span>;
<span class="hljs-keyword">import</span> {power_plug} <span class="hljs-keyword">from</span> <span class="hljs-string">'../capabilities/power_plug'</span>;
<span class="hljs-keyword">import</span> {PowerPurpose} <span class="hljs-keyword">from</span> <span class="hljs-string">'../../base/PowerPurpose'</span>;
<span class="hljs-keyword">import</span> {Relay} <span class="hljs-keyword">from</span> <span class="hljs-string">'../../base/types/Relay'</span>;
<span class="hljs-keyword">import</span> {HomeKitAccessory} <span class="hljs-keyword">from</span> <span class="hljs-string">'../../hap/HomeKitAccessory'</span>;
<span class="hljs-keyword">import</span> {Lightbulb2Accessory} <span class="hljs-keyword">from</span> <span class="hljs-string">'../../hap/Lightbulb2Accessory'</span>;
<span class="hljs-keyword">import</span> {Yandex} <span class="hljs-keyword">from</span> <span class="hljs-string">'../../yandex/Yandex'</span>;
<span class="hljs-keyword">import</span> {YandexLightOrSwitch} <span class="hljs-keyword">from</span> <span class="hljs-string">'../../yandex/YandexLightOrSwitch'</span>;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LumiPlug</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">XiaomiSubdeviceV2</span>.<span class="hljs-title">with</span>(<span class="hljs-title">Relay</span>, <span class="hljs-title">power_plug</span>, <span class="hljs-title">load_power</span>, <span class="hljs-title">PowerPurpose</span>,
  <span class="hljs-title">HomeKitAccessory</span>, <span class="hljs-title">Lightbulb2Accessory</span>,
  <span class="hljs-title">Yandex</span>, <span class="hljs-title">YandexLightOrSwitch</span>) </span>{<font></font>
<font></font>
  onCreate() {<font></font>
    <span class="hljs-keyword">super</span>.onCreate();
    <span class="hljs-keyword">this</span>.model = <span class="hljs-string">'Mi Smart Plug'</span>;
    <span class="hljs-keyword">this</span>.class_name = <span class="hljs-string">'lumi.plug'</span>;
    <span class="hljs-keyword">this</span>.driver_name = <span class="hljs-string">'Mi Smart Plug'</span>;
    <span class="hljs-keyword">this</span>.driver_type = <span class="hljs-number">3</span>;
    <span class="hljs-keyword">this</span>.parent_class_name = <span class="hljs-string">'lumi.gateway'</span>;<font></font>
  }<font></font>
<font></font>
  getIcon() {<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-string">'socket'</span>;<font></font>
  }<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The bottom line is that despite the abundance of different devices, they all do approximately the same thing and provide approximately the same information. </font><font style="vertical-align: inherit;">Therefore, all the capabilities of the devices were placed in separate impurities, of which the final driver ultimately consists. </font><font style="vertical-align: inherit;">For example, the application supports many devices that have the on / off function. </font><font style="vertical-align: inherit;">It is made in a separate impurity and is used identically for all devices. </font><font style="vertical-align: inherit;">Elementary, Watson!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What did this result in: any driver of a new device is written quite quickly and easily, because everything is standardized and there is no need to worry about further storage of the received information. For completely new protocols (which I did not have yet), impurities are also written that are based on existing ones. They already receive device information and transmit it further down the chain. This approach allowed us to reduce the amount of code by tens of times (initially, each driver was a copy of a similar driver). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So gradually I went through all the circles of hell to finish backing and the front. When the application acquired a fairly tolerable look, I thought: why not share your development with the public? Partners were found for the project and assistants to bring the application to mind.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First of all, it was necessary to bring to mind the design of the application. To do this, I had to turn to professional designers. I naively believed that it would take 3-4 months, but in the end the process dragged on. Despite the fact that the structure of the application has not changed much from the original source, literally everything had to be redone. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In parallel, I - not alone, but with a team of project partners - bought up the most popular devices for a smart home and added an application if it did not support these gadgets. Soon, however, it became clear that there was not enough money for all smart devices, so we decided to talk with existing players in the market and agree on free test samples of equipment for free. We were not denied, and Wirenboard and MiMiSmart became the first serious suppliers.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, together with the guys, I created a new application for smart home automation with a classic client-server architecture, which is put on any platform, and with a convenient modern design. </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meet the BARY *. </font></font></a></b><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* The name did not come from the name of Bari Alibasov, but from the character of Arthur C. Doyle‚Äôs book ‚ÄúThe Hound of the Baskervilles‚Äù by Barrymore‚Äôs butler - your personal ‚Äúsmart butler‚Äù.&nbsp;</font></font></i><br>
<br>
<h1><font color="#5153e1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What happened: description of the application with beautiful pictures and cats</font></font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main screen is a convenient dashboard with the ability to view and manage parameters of automated rooms. Convenient - this is the key word, because dashboards in those applications that I tried to work with myself had to be manually configured. Not the most pleasant pastime. The </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gz/dl/9k/gzdl9kdk2n5x2fjmlmfwtcnxjas.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
house can be divided into zones, and zones - into rooms. Each room has various parameters: temperature, humidity, current electricity consumption, etc., as well as selected actions. If we click on the room, we will fall into the list of devices connected to it: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yg/f-/22/ygf-224hyp7be9qrzf2ifh3plv8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here you can turn on / off the device, and also see its main parameter. When switching to a device, more detailed control with a full list of functions will be available.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All devices are connected using the same settings. For many devices there is a connection wizard. No configs for those who like hotter! Basically, it comes down to specifying the IP address of the device (for many devices there is an auto search). If the IP address suddenly changes, then it's okay, the server will find it at the new address automatically.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/q1/2b/ee/q12beeqowea3lu7egovw_8y0yry.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is integration with Apple HomeKit, it is used for voice control through Siri. All devices supported in BARY integrate with Apple HomeKit with a single tick (hello to HomeBridge fans). Not without the support of Yandex Alice. She was more friendly in terms of interface commands. For example, Siri does not want to close the curtains with the command ‚Äúclose the curtains‚Äù, cannot set a certain volume level on TV and so on. Yandex.Alice does not have such kookies.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For the convenience of managing smart lands, automation has been implemented: the rules for the execution of any actions when fulfilling a set of conditions. Automations are logical, multi-level, i.e. you can do something like: ‚ÄúCondition 1 and (Condition 2 or Condition 3).‚Äù All in a beautiful logical automation editor:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/c-/hg/bf/c-hgbflmqnmyu7ld7owltj5g5ao.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Personally, I already had a hundred automation programs, and any of them can be quickly found, because everything is grouped by room and device: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xl/xz/n9/xlxzn9o8tycbcxwnvtlw9w014ym.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Scripts are also supported in the application. A scenario is a complex of actions that is performed under some condition from automation. For my smart home, I use only the standard set: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fy/62/_d/fy62_dwup-9j5zyhvj-b3jd0i-4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I have left home / return home via Apple TV - it turns on / off automatically when everyone left home, or someone returned home. You come home, and the announcer with sad eyes from Channel 1 already meets you there. Well, great? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, what kind of smart home without the ability to watch a cat? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cl/4l/sj/cl4lsjn0wyslby9mavknwlmplts.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can connect any camera that is capable of delivering an RTSP stream.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Separately, I want to say about the statistics block. It turned out quite informative: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8k/vh/g4/8kvhg4ixvnkduzunurcf-lputrg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the legend, the red bar is the deviation from the average values ‚Äã‚Äãfor the last six months, the gray bar is the flow rate within the average values. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the picture, my statistics for September. It was cold, the heating had not yet been given, so the heating was constantly turned on at the ventilation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can also see statistics for any connected device: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/at/iw/ju/atiwjujpwobznspvzjvidoc8g9m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By the way, the availability of automation and statistics have reduced electricity costs by more than 2 times. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All occurring events are stored and can be viewed: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qh/ss/kw/qhsskw7yzjbhg8vhfpj1bsohmdo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also on the main page there is a special tab that collects all the main indicators selected by the user:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lw/78/kc/lw78kcs-ca7xyq_uljlybmp5uqc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By the way, water metering is implemented through the Xiaomi door / window open sensor. </font><font style="vertical-align: inherit;">To do this, instead of a reed switch, the output from the pulse counter is soldered to a special contact, and a virtual counter is created in BARY, in which you can specify this sensor as the source of pulses.</font></font><br>
<br>
<h1><font color="#5153e1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Architecture and Security</font></font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The client-server exchange is encrypted using AES technology, and the server is located directly inside the automated room. </font><font style="vertical-align: inherit;">In my opinion, this maximally protects the system from third-party unwanted interventions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If there is no white IP address, then you can connect the cloud. </font><font style="vertical-align: inherit;">It will act as an intermediary, without the ability to decrypt commands, because </font><font style="vertical-align: inherit;">keys are on the server.&nbsp;</font></font><br>
<br>
<h1><font color="#5153e1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Where to get</font></font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The server side can be run on almost any existing platform - thanks NodeJS. </font><font style="vertical-align: inherit;">For the most common platforms, we have prepared scripts that will do all the work automatically. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For Raspberry Pi based on Debian Stretch: </font></font><br>
<br>
<code>wget -qO- "http://bary.io/install?target=pi" | sudo bash</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The target parameter is responsible for the target platform and can have the following values:</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry Pi (Debian Stretch)</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pi</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry Pi (Debian Buster)</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pi_buster</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tinker Board (Debian Stretch)</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tb</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wiren Board (Debian Stretch)</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wb</font></font><br>
</td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If someone wants to install on another platform, write to us and we will update the script. </font><font style="vertical-align: inherit;">If you encounter any difficulties - also write. </font><font style="vertical-align: inherit;">We really need feedback.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The application is freely available on </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Play</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">App Store</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Perhaps by the end of the year, the application will become paid.</font></font><br>
<br>
<h1><font color="#5153e1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Why did I write this article? </font><font style="vertical-align: inherit;">The main goal is to get feedback from you. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Currently, the project is developing rapidly, and our entire team is trying to maximize the list of supported equipment available on the market. </font><font style="vertical-align: inherit;">Although I‚Äôm not alone working on the project, the tasks remained the same - to create the most convenient application that takes into account the wishes and solves the problems of everyone who was involved in the independent installation of smart solutions for the home. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We are open to dialogue on possible integrations and are ready to implement equipment support from companies interested in partnership as soon as possible. </font><font style="vertical-align: inherit;">You get a ready-made application and do not waste time developing software. </font><font style="vertical-align: inherit;">And we get a wide range of supported devices for every taste and color. </font><font style="vertical-align: inherit;">All is well.&nbsp;</font></font><br>
<br>
<h1><font color="#5153e1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Immediate plans and rainbow Wishlist</font></font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Currently, my team and I are actively engaged in the development of a video storage unit. It will be possible to place the video in your home storage or in a cloud service. I think at the beginning of next year it will be possible to talk about a new release. Should it be possible to review the best pearls of a cat entertaining himself while the owners are not at home?&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next year we plan more integrations with various services: a list of purchases and to-do, a calendar, etc. He came up, looked at one screen - and everything was in full view. Several turn-key projects have shown that this task is relevant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We also plan to start the production of controllers with preinstalled software for batch solutions of a smart home (currently the batch solution "software + hardware" is available together with our partners</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wiren Board</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And support for Google Home and Amazon Alexa. </font><font style="vertical-align: inherit;">Well, the expansion of the range of supported equipment, of course. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By the way, who cares, you can see the list of supported devices (not complete) on </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">our website</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and if something is not found in the list, then ask in the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">telegram group</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will be very grateful if you share what you lack in existing applications and what functions you would add in our place. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thank you all for reading. </font><font style="vertical-align: inherit;">Let's make our homes smarter together!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en502046/index.html">Five years Rust</a></li>
<li><a href="../en502048/index.html">Complex behavior without neural networks and training. The philosophical basis</a></li>
<li><a href="../en502050/index.html">A few notes about Culture</a></li>
<li><a href="../en502052/index.html">Kubernetes best practices. Create small containers</a></li>
<li><a href="../en502054/index.html">Convolutional neural network and its integration in iOS (part 2)</a></li>
<li><a href="../en502066/index.html">Simple console commands that everyone should know</a></li>
<li><a href="../en502068/index.html">110 volts on your computer</a></li>
<li><a href="../en502070/index.html">The history of Pentax (article plus video)</a></li>
<li><a href="../en502072/index.html">Docking the ISS using JavaScript and compass</a></li>
<li><a href="../en502076/index.html">Trolley Robot 2.0. Part 1. Autonomous navigation of a home robot based on ROS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>