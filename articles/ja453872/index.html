<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔶 🤦🏻 😥 ニューラルネットワークを使用した写真の復元 👩🏼‍🚒 😄 👨🏽‍🔧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="みなさん、こんにちは。Mail.ruGroupのコンピュータービジョンチームのリサーチプログラマーです。今年の戦勝記念日のために、軍事写真の復元プロジェクトを作ることにしました。写真修復とは何ですか？3つの段階で構成されています。
 
 

- すべての画像の欠陥を見つけます。 
- 周囲のピクセル...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ニューラルネットワークを使用した写真の復元</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/453872/"><img src="https://habrastorage.org/getpro/habr/post_images/333/44a/c78/33344ac788b63200841180799417f934.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
みなさん、こんにちは。Mail.ruGroupのコンピュータービジョンチームのリサーチプログラマーです。</font><font style="vertical-align: inherit;">今年の戦勝記念日の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ために、軍事写真の復元プロジェクト</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を作ることにしました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">写真修復とは何ですか？</font><font style="vertical-align: inherit;">3つの段階で構成されています。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべての画像の欠陥を見つけます。 </font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">周囲のピクセルの値に基づいて、見つかった欠陥を塗りつぶします。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">画像に色を付けます。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、復元の各段階について詳細に説明し、データを取得する方法と場所、学習したネットワーク、実行した内容、踏んだレーキの種類について説明します。 </font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">欠陥検索</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アップロードした写真の欠陥に関連するすべてのピクセルを見つけたいと考えています。まず、戦時中の人々がどのような写真をアップロードするかを理解する必要があります。私たちはデータを私たちと共有したImmortal Regimentプロジェクトの主催者に向かいました。それらを分析した後、人々はしばしばシングルまたはグループのポートレートをアップロードしていることに気付きました。これらには中程度または多数の欠陥があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、トレーニングサンプルを収集する必要がありました。セグメンテーションタスクのトレーニングサンプルは、すべての欠陥がマークされた画像とマスクです。最も簡単な方法は、マーカーに写真をマーカーに与えることです。もちろん、人々は欠陥を見つけるのが得意ですが、問題はマークアップが非常に長いプロセスであることです。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/127/d6e/718/127d6e718955e50d4af09e8c6acf55b5.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1枚の写真の欠陥に関連するピクセルをマークするのに1時間から1営業日かかるため、数週間で100枚以上の写真のサンプルを組み立てることは困難です。</font><font style="vertical-align: inherit;">したがって、私たちは何らかの形でデータを補足して欠陥を自分で書きました。きれいな写真を撮り、人工的な欠陥を適用して、画像の特定の部分が損傷していることを示すマスクを得ました。</font><font style="vertical-align: inherit;">トレーニングサンプルの主要部分は、手動でマークされた79枚の写真で、そのうち11枚はテストサンプルに転送されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
セグメンテーションタスクの最も一般的なアプローチ：事前トレーニング済みのエンコーダーでUnetを使用し、量を最小限に抑える</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>B</mi><mi>C</mi><mi>E</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.306ex" height="2.134ex" viewBox="0 -809.3 2284.5 918.9" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhj6Lr0Oz3rCi6nshHF92Drxy5fBvw#MJMATHI-42" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhj6Lr0Oz3rCi6nshHF92Drxy5fBvw#MJMATHI-43" x="759" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhj6Lr0Oz3rCi6nshHF92Drxy5fBvw#MJMATHI-45" x="1520" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi><mi>C</mi><mi>E</mi></math></span></span><script type="math/tex" id="MathJax-Element-1">BCE</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バイナリクロスエントロピー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）および</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>D</mi><mi>I</mi><mi>C</mi><mi>E</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.638ex" height="2.134ex" viewBox="0 -809.3 2858 918.9" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhj6Lr0Oz3rCi6nshHF92Drxy5fBvw#MJMATHI-44" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhj6Lr0Oz3rCi6nshHF92Drxy5fBvw#MJMATHI-49" x="828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhj6Lr0Oz3rCi6nshHF92Drxy5fBvw#MJMATHI-43" x="1333" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhj6Lr0Oz3rCi6nshHF92Drxy5fBvw#MJMATHI-45" x="2093" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi><mi>I</mi><mi>C</mi><mi>E</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">DICE</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソレンセン–サイコロ係数</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
欠陥セグメンテーションの問題で、このアプローチではどのような問題が発生しますか？</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写真に多くの欠陥があり、非常に汚れていて、時間の経過とともにぼろぼろになっているように見えても、欠陥が占める面積は、画像の損傷していない部分よりもはるかに小さいです。</font><font style="vertical-align: inherit;">この問題を解決するには、ポジティブクラスの重みを</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>B</mi><mi>C</mi><mi>E</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.306ex" height="2.134ex" viewBox="0 -809.3 2284.5 918.9" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhj6Lr0Oz3rCi6nshHF92Drxy5fBvw#MJMATHI-42" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhj6Lr0Oz3rCi6nshHF92Drxy5fBvw#MJMATHI-43" x="759" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhj6Lr0Oz3rCi6nshHF92Drxy5fBvw#MJMATHI-45" x="1520" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi><mi>C</mi><mi>E</mi></math></span></span><script type="math/tex" id="MathJax-Element-3">BCE</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、最適な重みは、欠陥に属するピクセルの数に対するすべての純粋なピクセルの数の比率になります。 </font></font><br>
</li>
<li>   ,     Unet     ,  Albunet-18,     .   Albunet-18      5  stride  .     .         :  max pooling   ,  stride  1      3.<br>
</li>
<li>      , ,    256  256  512  512,       - .      .   production      1024  1024.          .  -          . <br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トレーニング中、1枚のカードに約20枚の写真が配置されます。</font><font style="vertical-align: inherit;">このため、BatchNormレイヤーの平均と分散の推定は不正確です。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インプレースのBatchNorm</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">この問題の解決に役立ちます</font><font style="vertical-align: inherit;">。これは、最初にメモリを節約し、次に、すべてのカード間で統計を同期するバージョンのSynchronized BatchNormを備えています。</font><font style="vertical-align: inherit;">ここで、1つのカードの20枚の画像ではなく、4枚のカードの80枚の画像の平均と分散を考慮します。</font><font style="vertical-align: inherit;">これにより、ネットワークの収束が向上します。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結局、体重が増える </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>B</mi><mi>C</mi><mi>E</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.306ex" height="2.134ex" viewBox="0 -809.3 2284.5 918.9" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhj6Lr0Oz3rCi6nshHF92Drxy5fBvw#MJMATHI-42" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhj6Lr0Oz3rCi6nshHF92Drxy5fBvw#MJMATHI-43" x="759" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhj6Lr0Oz3rCi6nshHF92Drxy5fBvw#MJMATHI-45" x="1520" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi><mi>C</mi><mi>E</mi></math></span></span><script type="math/tex" id="MathJax-Element-4">BCE</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アーキテクチャを変更し、インプレースBatchNormを使用することで、写真の欠陥の検索を開始しました。</font><font style="vertical-align: inherit;">しかし、Test Time Augmentationを追加することで、少しでも安くすることができます。</font><font style="vertical-align: inherit;">入力イメージでネットワークを1回実行し、それをミラーリングして再度ネットワークを実行できます。これにより、小さな欠陥を見つけることができます。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/c75/95b/702/c7595b702dcb921dac612b0218ce13e4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、私たちのネットワークは18時間で4つのGeForce 1080Tiに集中しました。</font><font style="vertical-align: inherit;">推論には290ミリ秒かかります。</font><font style="vertical-align: inherit;">結局のところ、十分に長くなりますが、これは小さな欠陥を探しているという事実の代償です。</font><font style="vertical-align: inherit;">検証</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>D</mi><mi>I</mi><mi>C</mi><mi>E</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.638ex" height="2.134ex" viewBox="0 -809.3 2858 918.9" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhj6Lr0Oz3rCi6nshHF92Drxy5fBvw#MJMATHI-44" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhj6Lr0Oz3rCi6nshHF92Drxy5fBvw#MJMATHI-49" x="828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhj6Lr0Oz3rCi6nshHF92Drxy5fBvw#MJMATHI-43" x="1333" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhj6Lr0Oz3rCi6nshHF92Drxy5fBvw#MJMATHI-45" x="2093" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi><mi>I</mi><mi>C</mi><mi>E</mi></math></span></span><script type="math/tex" id="MathJax-Element-5">DICE</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.35に等しい </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>R</mi><mi>O</mi><mi>C</mi><mi>A</mi><mi>U</mi><mi>C</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.596ex" height="2.134ex" viewBox="0 -809.3 4562 918.9" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhj6Lr0Oz3rCi6nshHF92Drxy5fBvw#MJMATHI-52" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhj6Lr0Oz3rCi6nshHF92Drxy5fBvw#MJMATHI-4F" x="759" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhj6Lr0Oz3rCi6nshHF92Drxy5fBvw#MJMATHI-43" x="1523" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhj6Lr0Oz3rCi6nshHF92Drxy5fBvw#MJMATHI-41" x="2283" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhj6Lr0Oz3rCi6nshHF92Drxy5fBvw#MJMATHI-55" x="3034" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhj6Lr0Oz3rCi6nshHF92Drxy5fBvw#MJMATHI-43" x="3801" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi><mi>O</mi><mi>C</mi><mi>A</mi><mi>U</mi><mi>C</mi></math></span></span><script type="math/tex" id="MathJax-Element-6">ROCAUC</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -0.93。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フラグメントの修復</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unetはこの問題を再び解決するのに役立ちました。入力には、元の画像と、クリーンなスペースを単位でマークするマスクと、ゼロで塗りつぶしたいピクセルを彼に与えました。データは次のように収集しました。インターネットから、OpenImagesV4などの写真付きの大きなデータセットを取得し、実際の形状と似た欠陥を人為的に追加しました。その後、不足している部品を修復するようにネットワークをトレーニングしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このタスクのためにUnetをどのように変更できますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常の畳み込みの代わりに、部分（部分畳み込み）を使用できます。彼女の考えは、カーネルで画像の領域を折りたたむとき、欠陥に関連するピクセル値を考慮しないということです。これにより、ペイントがより正確になります。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">NVIDIA記事</font></a><font style="vertical-align: inherit;">の例</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。中央の図では、通常のコンボリューションでUnetを使用し、右側でパーシャルコンボリューション</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/a85/3f7/dd8/a853f7dd856ac6b3bc8e37c10a2d6fd6.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
を使用しています。ネットワークを5日間トレーニングしました。最終日、BatchNormをフリーズしました。これにより、画像の塗装部分の境界が目立たなくなりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ネットワークは、50ミリ秒で512 x 512の画像を処理します。検証PSNRは26.4です。ただし、このタスクでは、メトリックを無条件に信頼することはできません。そのため、最初にデータに対していくつかの優れたモデルを実行し、結果を匿名化してから、さらに気に入ったモデルに投票しました。そこで、最終的なモデルを選択しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
画像をきれいにするために欠陥を人為的に追加したことを述べました。</font><font style="vertical-align: inherit;">トレーニングするときは、重ね合わせた欠陥の最大サイズを注意深く監視する必要があります。これは、ネットワークが学習プロセスで見たことのない非常に大きな欠陥があると、非常に幻想的になり、まったく適用できない結果になるためです。</font><font style="vertical-align: inherit;">したがって、大きな欠陥をペイントする必要がある場合は、トレーニング中に大きな欠陥も適用してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次にアルゴリズムの例を示します。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/787/a8e/e8c/787a8ee8cb164e50e450d1498b9f285b.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">着色</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
欠陥を分割してペイントしました。3番目のステップは色の再構成です。 「不滅の連隊」の写真の中に、シングルまたはグループのポートレートがたくさんあることを思い出させてください。そして私達は私達のネットワークが彼らとうまく機能することを望みました。私たちが知っているどのサービスも肖像画をすばやくうまくペイントできないため、独自のカラー化を行うことにしました。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/015/bce/bf1/015bcebf15ef1ee069fdf08f16e00542.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GitHubには、</font><font style="vertical-align: inherit;">写真に色を付けるための</font><font style="vertical-align: inherit;">人気のある</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">あり</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。平均して、彼はこの仕事をうまくやっていますが、いくつかの問題があります。たとえば、彼は服を青く塗るのが大好きです。したがって、それも拒否しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そこで、カラー化のためのニューラルネットワークを作ることにしました。最も明白なアイデア：白黒の画像を取り、赤、緑、青の3つのチャネルを予測します。しかし、一般的に言えば、作業を簡略化できます。色のRGB表現ではなく、YCbCr表現で作業できます。コンポーネントYは輝度（輝度）です。ダウンロードした白黒画像はYチャンネルですので、再利用します。 CbとCrを予測するために残されました。Cbは青と明るさの違いで、Crは赤と明るさの違いです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/k8/ke/l_/k8kel_xrjco6euolh8ypkchjm8g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
なぜYCbCrビューを選択したのですか？</font><font style="vertical-align: inherit;">人間の目は、色の変化よりも明るさの変化の影響を受けやすくなっています。</font><font style="vertical-align: inherit;">そのため、最初は目に影響を受けやすいY成分（明るさ）を再利用し、CbとCrを予測します。この場合、色の「偽」に気付かないため、少し間違いを犯す可能性があります。</font><font style="vertical-align: inherit;">この機能は、チャンネルの帯域幅がすべての色を完全に送信するのに十分ではなかったカラーテレビの黎明期に積極的に使用され始めました。</font><font style="vertical-align: inherit;">画像はYCbCrに転送され、そのままYコンポーネントに転送され、CbとCrは2回圧縮されました。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ベースラインの組み立て方</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
事前にトレーニングされたエンコーダーでUnetを使用して、実際のCbCrと予測されたものの間のL1損失を最小化できます。ポートレートに色を付けたいので、OpenImagesの写真に加えて、タスクに固有の写真を追加する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
軍服を着た人々のカラー写真はどこで入手できますか？古い写真を趣味として、または注文するためにインターネット上の人々がいます。彼らはこれを非常に慎重に行い、すべてのニュアンスを完全に遵守しようとします。ユニフォーム、エポレット、メダルを着色し、彼らはアーカイブ資料に変わります。そのため、彼らの仕事の結果は信頼できます。全部で200点の手描き写真を使用しました。 2番目の有用なデータソースは、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">労働者と農民の赤軍</font></a><font style="vertical-align: inherit;">のサイトです。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。その作成者の1人は、大祖国戦争中に軍服のほぼすべての変形で写真が撮られました。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/d35/18e/8da/d3518e8dad1e35c660626f248d3375b1.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いくつかの写真では、彼は有名なアーカイブ写真から人々のポーズを繰り返しました。彼が白い背景で撮影したのは特に良いことです。これにより、さまざまな自然のオブジェクトを背景に追加して、データを非常にうまく拡張できました。また、人々の通常の現代的な肖像画を使用し、記章や戦時中の衣服のその他の属性でそれらを補完しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはAlbuNet-50をトレーニングしました-これはUnetで、AlbuNet-50がエンコーダーとして使用されています。</font><font style="vertical-align: inherit;">ネットワークは適切な結果を出し始めました：皮膚はピンク、目は灰青色、ショルダーストラップは黄色がかっています。</font><font style="vertical-align: inherit;">しかし問題は彼女が点で絵を描いたことです。</font><font style="vertical-align: inherit;">これは、L1エラーの観点から、色を予測しようとするよりも何もしない方が有利な場合があるためです。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/a5a/f7e/41c/a5af7e41cab54d1d20224e8f70a4e677.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結果をGround Truthの写真と比較しています</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。Klimbim</font></font></a></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">というニックネームでアーティストを手動で色付けし</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ます。この問題を解決するにはどうすればよいですか。</font><font style="vertical-align: inherit;">弁別器が必要です。入力に画像を提供するニューラルネットワークであり、この画像がどの程度リアルに見えるかを示します。</font><font style="vertical-align: inherit;">下の写真は手描きで、もう1つはニューラルネットワークです。</font><font style="vertical-align: inherit;">あなたはどちらを思いますか？</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/88b/6c1/26d/88b6c126d96e794dfd5c99a6429f0aeb.png"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回答</font></font></b><div class="spoiler_text">   .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
判別子として、記事</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Self-Attention GANの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">判別子を使用し</font><font style="vertical-align: inherit;">ます。これは小さな畳み込みネットワークで、最後の層にはいわゆるセルフアテンションが組み込まれています。これにより、画像の詳細に「注意を払う」ことができます。スペクトル正規化も使用します。正確な説明と動機は記事にあります。 L1損失と弁別子によって返されたエラーの組み合わせでネットワークをトレーニングしました。これで、ネットワークは画像の詳細をより適切に描画し、背景の一貫性が向上しました。別の例：左側はL1-lossのみでトレーニングされたネットワークの結果、右側はL1-lossと弁別子エラーでトレーニングされた結果です。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/851/9a1/a22/8519a1a22f1b372ea2da94e29c42635f.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4つのGeforce 1080Tiでは、トレーニングに2日かかりました。</font><font style="vertical-align: inherit;">ネットワークは、512 x 512の画像で30ミリ秒で機能し、検証MSEは34.4でした。</font><font style="vertical-align: inherit;">インペインティングの問題と同様に、メトリックは完全に信頼することはできません。</font><font style="vertical-align: inherit;">したがって、検証に最適なメトリックを持つ6つのモデルを選択し、最適なモデルに盲目的に投票しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モデルを本番環境に導入した後、実験を続け、ピクセルごとのL1損失ではなく、知覚上の損失を最小限に抑える方がよいという結論に達しました。</font><font style="vertical-align: inherit;">これを計算するには、VGG-16ネットワークを介してネットワーク予測と元の写真を実行し、下位レイヤーの属性マップを取得して、MSEで比較する必要があります。</font><font style="vertical-align: inherit;">このアプローチは、より多くの領域を描画し、よりカラフルな画像を取得するのに役立ちます。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/494/7a2/23f/4947a223f3d8424355f8c666f6dc4f4d.jpg"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論と結論</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unetはクールなモデルです。最初のセグメンテーションの問題では、高解像度画像のトレーニングと操作で問題が発生したため、インプレースBatchNormを使用します。 2番目のタスク（インペインティング）では、通常の畳み込みの代わりに、部分畳み込みを使用しました。これにより、より良い結果を得ることができました。 Unetの色付けの問題では、非現実的な画像の生成器を微調整し、知覚的損失を使用する小さな弁別器ネットワークを追加しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目の結論は、アクセサは重要であるということです。</font><font style="vertical-align: inherit;">また、トレーニングの前に写真をマークする段階だけでなく、最終的な結果を検証するためにも必要です。これは、塗装の欠陥や色付けの問題では、人の助けを借りて結果を検証する必要があるためです。</font><font style="vertical-align: inherit;">ユーザーに3枚の写真を提供します。欠陥が削除された元の写真、欠陥が削除されて色付けされた写真、および欠陥の検索とペイントのアルゴリズムが間違っている場合の色付けされた写真のみ。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ミリタリーアルバム</font></a><font style="vertical-align: inherit;">プロジェクトの</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
写真をいくつか撮り、</font><font style="vertical-align: inherit;">ニューラルネットワークで処理しました。</font><font style="vertical-align: inherit;">ここで得られた結果は以下のとおりです。</font><font style="vertical-align: inherit;">
そして、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ここに</font></a><font style="vertical-align: inherit;">、あなたは元の解像度にし、処理の各段階でそれらを見ることができます。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/fba/800/4d4/fba8004d46046a5d57c52a239e625365.jpg"><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja453862/index.html">pathlibを使用する理由</a></li>
<li><a href="../ja453864/index.html">コンソールでマウスとキーボードを使用することは不正行為ですか？</a></li>
<li><a href="../ja453866/index.html">React Hooks、HOC、またはRender Propを使用したAPIリクエスト</a></li>
<li><a href="../ja453868/index.html">nRF52832のガラスパネル付きタッチミニスイッチ</a></li>
<li><a href="../ja453870/index.html">PowerShellでReverse socks5プロキシを記述します（パート1）</a></li>
<li><a href="../ja453874/index.html">ロシアンルーレットから安全なLOTOへ：データセンターの担当者を保護する方法</a></li>
<li><a href="../ja453876/index.html">Yandex.Practicumの場合と同様に、フロントエンドの非同期化が成功しました：Redux-Saga、postMessage、Jupyterによるアクロバティックな数値</a></li>
<li><a href="../ja453882/index.html">ソリューションアーキテクトの職業に関する優れたガイド（+役立つリンクのリスト）</a></li>
<li><a href="../ja453884/index.html">誇大広告または再フラッシュカメラ？</a></li>
<li><a href="../ja453886/index.html">プログラム作品</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>