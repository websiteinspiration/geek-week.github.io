<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐽 👩‍🚒 ☄️ Golang + Phaser3 = MMORPG - Client und Server 🐿️ 🙍🏾 📤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Im letzten Artikel haben wir mit Ihnen sozusagen ein Leerzeichen erstellt, auf dessen Grundlage unser Universum erstellt wird. Die Visualisierung mit ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Golang + Phaser3 = MMORPG - Client und Server</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488794/"><img src="https://habrastorage.org/webt/ra/gk/at/ragkatgmqj9evur6anqx3rlos3e.gif" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im letzten Artikel haben wir mit Ihnen sozusagen ein Leerzeichen erstellt, auf dessen Grundlage unser Universum erstellt wird. Die Visualisierung mit der Konsole mag gut aussehen, aber Textzeichen sind langweilig und nicht sehr schön. In diesem Artikel konzentrieren wir uns auf die Visualisierung unserer Kacheln mit Phaser.js </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im letzten Artikel sah unser Projekt folgendermaßen aus: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mb/5r/nh/mb5rnhfwbge-ytwhwqk_hu9psrc.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt werden wir andere Tools für die Webentwicklung verwenden. Ich hoffe, Sie haben Node.js und npm installiert, wenn nicht, installieren Sie es dringend. </font><font style="vertical-align: inherit;">Und so öffnen wir das Terminal und starten:</font></font><br>
<a name="habracut"></a><br>
<pre><code class="bash hljs">$ npm install phaser@3.22.0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach erfolgreichem Abschluss des Teams sollten wir Folgendes sehen:</font></font><br>
<br>
<pre><code class="bash hljs">+ phaser@3.22.0<font></font>
added 15 packages from 48 contributors and audited 20 packages <span class="hljs-keyword">in</span> 4.38s
</code></pre><br>
<img src="https://habrastorage.org/webt/kv/iq/rd/kviqrdtp_esg27iy8xdwi1o5mmu.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es sind so großartige Module erschienen, dass wir jetzt ein Verzeichnis für unseren Kunden erstellen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hc/jg/bm/hcjgbmqtqyh5s-yaagdgps8edxq.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Inhalten werden wir Spielressourcen speichern, d. H. </font><font style="vertical-align: inherit;">unsere Sprites. </font><font style="vertical-align: inherit;">Wir werden auch zwei Dateien game.js und MainScene.js erstellen, im Stammverzeichnis (wo sich die Datei main.go befindet) create index.html </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
game.js - speichert die Haupteinstellungen für das Spiel </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MainScene.js - es enthält die Klasse der Hauptspielszene </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
index.html - Die Seite, auf der die Szene gerendert wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verbinden Sie unsere Skripte sofort mit index.html und wir werden nicht mehr zu dieser Datei zurückkehren:</font></font><br>
<br>
<pre><code class="xml hljs">    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"node_modules/phaser/dist/phaser.js"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"Client/game.js"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In MainScene.js werden wir eine kleine Klassenvorlage für unsere zukünftige Szene erstellen:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> {MainScene}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainScene</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Phaser</span>.<span class="hljs-title">Scene</span></span>{
<span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">super</span>({<span class="hljs-attr">key</span>: <span class="hljs-string">'MainScene'</span>})<font></font>
}<font></font>
preload() {<font></font>
<font></font>
}<font></font>
create() {<font></font>
<font></font>
}<font></font>
update() {<font></font>
<font></font>
}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fügen Sie in game.js typische Einstellungen hinzu, die Ihnen gefallen. Hier sind meine:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> {MainScene} <span class="hljs-keyword">from</span> <span class="hljs-string">"./MainScene.js"</span>;
<span class="hljs-keyword">let</span> config = {
    <span class="hljs-attr">type</span>: Phaser.AUTO,
    <span class="hljs-attr">width</span>: <span class="hljs-number">800</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">600</span>,
    <span class="hljs-attr">disableContextMenu</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">background</span>: <span class="hljs-string">'black'</span>,
    <span class="hljs-attr">physics</span>: {
        <span class="hljs-attr">default</span>: <span class="hljs-string">'arcade'</span>,
        <span class="hljs-attr">arcadePhysics</span>: {
            <span class="hljs-attr">overlapBias</span>: <span class="hljs-number">1</span><font></font>
        }<font></font>
    },<font></font>
    <span class="hljs-attr">scene</span>:[MainScene],
    <span class="hljs-attr">pixelArt</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">roundPixels</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">antialias</span>: <span class="hljs-literal">true</span><font></font>
<font></font>
}<font></font>
<span class="hljs-keyword">let</span> game = <span class="hljs-keyword">new</span> Phaser.Game(config);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt brauchen wir einen HTTP-Server, auf dem dies in wenigen Zeilen erfolgt. </font><font style="vertical-align: inherit;">Gehen Sie zu main.go und erstellen Sie einen Server:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"html/template"</span>
	<span class="hljs-string">"net/http"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	<span class="hljs-comment">//     </span>
	http.HandleFunc(<span class="hljs-string">"/"</span>, indexHandler)
	<span class="hljs-comment">//      (,   .)</span>
	http.Handle(<span class="hljs-string">"/node_modules/phaser/dist/"</span>, http.StripPrefix(<span class="hljs-string">"/node_modules/phaser/dist/"</span>, http.FileServer(http.Dir(<span class="hljs-string">"./node_modules/phaser/dist/"</span>))))<font></font>
	http.Handle(<span class="hljs-string">"/Client/"</span>, http.StripPrefix(<span class="hljs-string">"/Client/"</span>, http.FileServer(http.Dir(<span class="hljs-string">"./Client/"</span>))))<font></font>
	http.Handle(<span class="hljs-string">"/Client/Content/"</span>, http.StripPrefix(<span class="hljs-string">"/Client/Content/"</span>, http.FileServer(http.Dir(<span class="hljs-string">"./Client/Content/"</span>))))
	<span class="hljs-comment">//  .   ,   8080</span>
	err := http.ListenAndServe(<span class="hljs-string">":8080"</span>, <span class="hljs-literal">nil</span>)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
		fmt.Println(err.Error())<font></font>
	}<font></font>
}<font></font>
<span class="hljs-comment">//   index.html,      </span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">indexHandler</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {<font></font>
	fmt.Println(<span class="hljs-string">"indexAction"</span>)<font></font>
	t, _ := template.ParseFiles(<span class="hljs-string">"index.html"</span>)<font></font>
	err := t.Execute(w, <span class="hljs-string">"index"</span>)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
		fmt.Println(err.Error())<font></font>
	}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, wir haben unseren eigenen Webserver und Client! </font><font style="vertical-align: inherit;">Lass uns anfangen! </font><font style="vertical-align: inherit;">Öffnen Sie die Konsole:</font></font><br>
<br>
<pre><code class="bash hljs">$ go run main.go</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir öffnen den Browser und versuchen, eine Verbindung zu unserem Server herzustellen </font></font><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localhost: 8080</font></font></blockquote><br>
<img src="https://habrastorage.org/webt/k5/85/pw/k585pwr9ihknt_hx2glcnyzgrua.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie einen schwarzen Bildschirm gesehen haben, haben Sie alles richtig gemacht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen wir also einen weiteren Handler, mit dem wir unseren Block im JSON-Format erhalten. </font><font style="vertical-align: inherit;">Erstellen Sie ein separates Verzeichnis und nennen Sie es GameController. Hier arbeiten alle Handler mit den Spieldaten. Erstellen Sie die Datei Map_Controller.go. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Außerdem benötigen wir eine verbesserte</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chunk.go</font></font></b><div class="spoiler_text"><pre><code class="go hljs"><span class="hljs-keyword">package</span> Chunk<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"exampleMMO/PerlinNoise"</span>
	<span class="hljs-string">"fmt"</span><font></font>
)<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">var</span> TILE_SIZE = <span class="hljs-number">16</span>
<span class="hljs-keyword">var</span> CHUNK_SIZE = <span class="hljs-number">16</span> * <span class="hljs-number">16</span>
<span class="hljs-keyword">var</span> PERLIN_SEED <span class="hljs-keyword">float32</span> = <span class="hljs-number">160</span><font></font>
<font></font>
<span class="hljs-keyword">type</span> Chunk <span class="hljs-keyword">struct</span> {<font></font>
	ChunkID [<span class="hljs-number">2</span>]<span class="hljs-keyword">int</span> <span class="hljs-string">`json:"chunkID"`</span>
	Map     <span class="hljs-keyword">map</span>[Coordinate]Tile <span class="hljs-string">`json:"map"`</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/*
  
*/</span>
<span class="hljs-keyword">type</span> Tile <span class="hljs-keyword">struct</span> {<font></font>
	Key <span class="hljs-keyword">string</span> <span class="hljs-string">`json:"key"`</span>
	X   <span class="hljs-keyword">int</span>    <span class="hljs-string">`json:"x"`</span>
	Y   <span class="hljs-keyword">int</span>    <span class="hljs-string">`json:"y"`</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/*
    
*/</span>
<span class="hljs-keyword">type</span> Coordinate <span class="hljs-keyword">struct</span> {<font></font>
	X <span class="hljs-keyword">int</span> <span class="hljs-string">`json:"x"`</span>
	Y <span class="hljs-keyword">int</span> <span class="hljs-string">`json:"y"`</span><font></font>
}<font></font>
<font></font>
<font></font>
<font></font>
<span class="hljs-comment">/*
    ,      
 [1,1]
*/</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewChunk</span><span class="hljs-params">(idChunk Coordinate)</span> <span class="hljs-title">Chunk</span></span> {<font></font>
	fmt.Println(<span class="hljs-string">"New Chank"</span>, idChunk)<font></font>
	chunk := Chunk{ChunkID: [<span class="hljs-number">2</span>]<span class="hljs-keyword">int</span>{idChunk.X, idChunk.Y}}
	<span class="hljs-keyword">var</span> chunkXMax, chunkYMax <span class="hljs-keyword">int</span>
	<span class="hljs-keyword">var</span> chunkMap <span class="hljs-keyword">map</span>[Coordinate]Tile<font></font>
	chunkMap = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[Coordinate]Tile)<font></font>
	chunkXMax = idChunk.X * CHUNK_SIZE<font></font>
	chunkYMax = idChunk.Y * CHUNK_SIZE<font></font>
<font></font>
	<span class="hljs-keyword">switch</span> {
	<span class="hljs-keyword">case</span> chunkXMax &lt; <span class="hljs-number">0</span> &amp;&amp; chunkYMax &lt; <span class="hljs-number">0</span>:<font></font>
		{<font></font>
			<span class="hljs-keyword">for</span> x := chunkXMax + CHUNK_SIZE; x &gt; chunkXMax; x -= TILE_SIZE {
				<span class="hljs-keyword">for</span> y := chunkYMax + CHUNK_SIZE; y &gt; chunkYMax; y -= TILE_SIZE {<font></font>
<font></font>
					posX := <span class="hljs-keyword">float32</span>(x - (TILE_SIZE / <span class="hljs-number">2</span>))<font></font>
					posY := <span class="hljs-keyword">float32</span>(y + (TILE_SIZE / <span class="hljs-number">2</span>))<font></font>
					tile := Tile{}<font></font>
					tile.X = <span class="hljs-keyword">int</span>(posX)<font></font>
					tile.Y = <span class="hljs-keyword">int</span>(posY)<font></font>
					perlinValue := PerlinNoise.Noise(posX/PERLIN_SEED, posY/PERLIN_SEED)<font></font>
					<span class="hljs-keyword">switch</span> {
					<span class="hljs-keyword">case</span> perlinValue &lt; <span class="hljs-number">-0.01</span>:<font></font>
						tile.Key = <span class="hljs-string">"Water"</span>
					<span class="hljs-keyword">case</span> perlinValue &gt;= <span class="hljs-number">-0.01</span> &amp;&amp; perlinValue &lt; <span class="hljs-number">0</span>:<font></font>
						tile.Key = <span class="hljs-string">"Sand"</span>
					<span class="hljs-keyword">case</span> perlinValue &gt;= <span class="hljs-number">0</span> &amp;&amp; perlinValue &lt;= <span class="hljs-number">0.5</span>:<font></font>
						tile.Key = <span class="hljs-string">"Ground"</span>
					<span class="hljs-keyword">case</span> perlinValue &gt; <span class="hljs-number">0.5</span>:<font></font>
						tile.Key = <span class="hljs-string">"Mount"</span><font></font>
					}<font></font>
					chunkMap[Coordinate{X: tile.X, Y: tile.Y}] = tile<font></font>
<font></font>
				}<font></font>
			}<font></font>
		}<font></font>
	<span class="hljs-keyword">case</span> chunkXMax &lt; <span class="hljs-number">0</span>:<font></font>
		{<font></font>
			<span class="hljs-keyword">for</span> x := chunkXMax + CHUNK_SIZE; x &gt; chunkXMax; x -= TILE_SIZE {
				<span class="hljs-keyword">for</span> y := chunkYMax - CHUNK_SIZE; y &lt; chunkYMax; y += TILE_SIZE {<font></font>
					posX := <span class="hljs-keyword">float32</span>(x - (TILE_SIZE / <span class="hljs-number">2</span>))<font></font>
					posY := <span class="hljs-keyword">float32</span>(y + (TILE_SIZE / <span class="hljs-number">2</span>))<font></font>
					tile := Tile{}<font></font>
					tile.X = <span class="hljs-keyword">int</span>(posX)<font></font>
					tile.Y = <span class="hljs-keyword">int</span>(posY)<font></font>
					perlinValue := PerlinNoise.Noise(posX/PERLIN_SEED, posY/PERLIN_SEED)<font></font>
					<span class="hljs-keyword">switch</span> {
					<span class="hljs-keyword">case</span> perlinValue &lt; <span class="hljs-number">-0.12</span>:<font></font>
						tile.Key = <span class="hljs-string">"Water"</span>
					<span class="hljs-keyword">case</span> perlinValue &gt;= <span class="hljs-number">-0.12</span> &amp;&amp; perlinValue &lt;= <span class="hljs-number">0.5</span>:<font></font>
						tile.Key = <span class="hljs-string">"Ground"</span>
					<span class="hljs-keyword">case</span> perlinValue &gt; <span class="hljs-number">0.5</span>:<font></font>
						tile.Key = <span class="hljs-string">"Mount"</span><font></font>
					}<font></font>
					chunkMap[Coordinate{X: tile.X, Y: tile.Y}] = tile<font></font>
				}<font></font>
			}<font></font>
		}<font></font>
	<span class="hljs-keyword">case</span> chunkYMax &lt; <span class="hljs-number">0</span>:<font></font>
		{<font></font>
			<span class="hljs-keyword">for</span> x := chunkXMax - CHUNK_SIZE; x &lt; chunkXMax; x += TILE_SIZE {
				<span class="hljs-keyword">for</span> y := chunkYMax + CHUNK_SIZE; y &gt; chunkYMax; y -= TILE_SIZE {<font></font>
					posX := <span class="hljs-keyword">float32</span>(x + (TILE_SIZE / <span class="hljs-number">2</span>))<font></font>
					posY := <span class="hljs-keyword">float32</span>(y - (TILE_SIZE / <span class="hljs-number">2</span>))<font></font>
					tile := Tile{}<font></font>
					tile.X = <span class="hljs-keyword">int</span>(posX)<font></font>
					tile.Y = <span class="hljs-keyword">int</span>(posY)<font></font>
					perlinValue := PerlinNoise.Noise(posX/PERLIN_SEED, posY/PERLIN_SEED)<font></font>
					<span class="hljs-keyword">switch</span> {
					<span class="hljs-keyword">case</span> perlinValue &lt; <span class="hljs-number">-0.12</span>:<font></font>
						tile.Key = <span class="hljs-string">"Water"</span>
					<span class="hljs-keyword">case</span> perlinValue &gt;= <span class="hljs-number">-0.12</span> &amp;&amp; perlinValue &lt;= <span class="hljs-number">0.5</span>:<font></font>
						tile.Key = <span class="hljs-string">"Ground"</span>
					<span class="hljs-keyword">case</span> perlinValue &gt; <span class="hljs-number">0.5</span>:<font></font>
						tile.Key = <span class="hljs-string">"Mount"</span><font></font>
					}<font></font>
					chunkMap[Coordinate{X: tile.X, Y: tile.Y}] = tile<font></font>
<font></font>
				}<font></font>
			}<font></font>
		}<font></font>
	<span class="hljs-keyword">default</span>:<font></font>
		{<font></font>
			<span class="hljs-keyword">for</span> x := chunkXMax - CHUNK_SIZE; x &lt; chunkXMax; x += TILE_SIZE {
				<span class="hljs-keyword">for</span> y := chunkYMax - CHUNK_SIZE; y &lt; chunkYMax; y += TILE_SIZE {<font></font>
					posX := <span class="hljs-keyword">float32</span>(x + (TILE_SIZE / <span class="hljs-number">2</span>))<font></font>
					posY := <span class="hljs-keyword">float32</span>(y + (TILE_SIZE / <span class="hljs-number">2</span>))<font></font>
					tile := Tile{}<font></font>
					tile.X = <span class="hljs-keyword">int</span>(posX)<font></font>
					tile.Y = <span class="hljs-keyword">int</span>(posY)<font></font>
					perlinValue := PerlinNoise.Noise(posX/PERLIN_SEED, posY/PERLIN_SEED)<font></font>
					<span class="hljs-keyword">switch</span> {
					<span class="hljs-keyword">case</span> perlinValue &lt; <span class="hljs-number">-0.12</span>:<font></font>
						tile.Key = <span class="hljs-string">"Water"</span>
					<span class="hljs-keyword">case</span> perlinValue &gt;= <span class="hljs-number">-0.12</span> &amp;&amp; perlinValue &lt;= <span class="hljs-number">0.5</span>:<font></font>
						tile.Key = <span class="hljs-string">"Ground"</span>
					<span class="hljs-keyword">case</span> perlinValue &gt; <span class="hljs-number">0.5</span>:<font></font>
						tile.Key = <span class="hljs-string">"Mount"</span><font></font>
					}<font></font>
					chunkMap[Coordinate{X: tile.X, Y: tile.Y}] = tile<font></font>
<font></font>
				}<font></font>
			}<font></font>
		}<font></font>
<font></font>
	}<font></font>
	chunk.Map = chunkMap<font></font>
	<span class="hljs-keyword">return</span> chunk<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben gerade json-Schlüssel zu unseren Strukturen hinzugefügt und die Chunk-Erstellung ein wenig verbessert. Wir </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
kehren zu Map_Controller zurück.</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> GameController<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"encoding/json"</span>
	<span class="hljs-string">"exampleMMO/Chunk"</span>
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"net/http"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Map_Handler</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {<font></font>
			c:= Chunk.NewChunk(Chunk.Coordinate{<span class="hljs-number">1</span>,<span class="hljs-number">1</span>})<font></font>
			 js, e :=json.Marshal(c)<font></font>
			 <span class="hljs-keyword">if</span> e!= <span class="hljs-literal">nil</span> {<font></font>
			 	fmt.Println(e.Error())<font></font>
			 }<font></font>
			 fmt.Println(<span class="hljs-keyword">string</span>(js))<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
und fügen Sie eine Zeile zu main.go hinzu</font></font><br>
<br>
<pre><code class="go hljs">	http.HandleFunc(<span class="hljs-string">"/map"</span>, GameController.Map_Handler)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versuchen wir, den Server zu starten und gehen Sie zu localhost: 8080 / map. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ausgabe im Terminal:</font></font><br>
<br>
<pre><code class="bash hljs">New Chank {1 1}<font></font>
json: unsupported <span class="hljs-built_in">type</span>: map[Chunk.Coordinate]Chunk.Tile
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ja, wir haben vergessen, dass in Golang bei der Serialisierung die Kartenschlüssel eine Zeichenfolge sein müssen. </font><font style="vertical-align: inherit;">Für die Serialisierung prüft Go, ob der Typ mit der TextMarshaler-Schnittstelle übereinstimmt, und ruft die MarshalText () -Methode auf. Wir müssen lediglich die MarshalText () -Methode für unseren Koordinatentyp erstellen. Wir </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
kehren zu Chunk.go zurück und fügen den folgenden Code hinzu:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t Coordinate)</span> <span class="hljs-title">MarshalText</span><span class="hljs-params">()</span> <span class="hljs-params">([]<span class="hljs-keyword">byte</span>, error)</span></span> {<font></font>
<font></font>
	<span class="hljs-keyword">return</span> []<span class="hljs-keyword">byte</span>(<span class="hljs-string">"["</span> + strconv.Itoa(t.X) + <span class="hljs-string">","</span> + strconv.Itoa(t.Y) + <span class="hljs-string">"]"</span>), <span class="hljs-literal">nil</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können Ihre Implementierung schreiben. Das Wichtigste ist, dass diese Methode eine eindeutige Zeichenfolge zurückgibt. </font><font style="vertical-align: inherit;">Wir werden diesen Schlüssel verwenden, um Chunks auf dem Client zu verwalten. Lassen Sie uns nun überprüfen, wie unser Controller funktioniert, den Server erneut starten und die Ausgabe an die Konsole anzeigen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xm/cv/fu/xmcvfu0hilosymyu172rdgr2gjk.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ja, alles ist in Ordnung. Lassen Sie uns nun einen Abschluss für den Stream ziehen und zwei Zeilen am Ende unseres Controllers hinzufügen:</font></font><br>
<br>
<pre><code class="go hljs">
	w.Header().Set(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)<font></font>
	w.Write(js)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beenden Sie vorerst Golang und kehren Sie zum Kunden zurück. </font><font style="vertical-align: inherit;">Wir werden drei Titel brauchen, obwohl wir tatsächlich vier davon haben, aber im Moment haben wir drei oder sogar zwei. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/14/ep/mt/14epmtlekh0tcaxqbyykzummptk.png"><br>
<br>
<img src="https://habrastorage.org/webt/q6/c3/nw/q6c3nwanc2id9a7-d770lxvrusu.png"><br>
<br>
<img src="https://habrastorage.org/webt/of/vf/9v/ofvf9vdoa0-dcuz-2smdbh5sx3i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fügen Sie unsere Kacheln zum Inhaltsverzeichnis hinzu und beginnen Sie mit MainScene.js zu arbeiten. Für die ersten Ergebnisse benötigen wir einige Funktionen:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainScene</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Phaser</span>.<span class="hljs-title">Scene</span></span>{
<span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">super</span>({<span class="hljs-attr">key</span>: <span class="hljs-string">'MainScene'</span>})<font></font>
<font></font>
}<font></font>
preload() {<font></font>
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">this</span>.load.image(<span class="hljs-string">"Ground"</span>, <span class="hljs-string">"Client/Content/sprGrass.png"</span>)
    <span class="hljs-keyword">this</span>.load.image(<span class="hljs-string">"Water"</span>, <span class="hljs-string">"Client/Content/sprWater1.png"</span>)
    <span class="hljs-keyword">this</span>.load.image(<span class="hljs-string">"Sand"</span>, <span class="hljs-string">"Client/Content/sprGrass.png"</span>)<font></font>
<font></font>
<font></font>
}<font></font>
create() {<font></font>
    <span class="hljs-keyword">this</span>.getGameMap()<font></font>
}<font></font>
update() {<font></font>
<font></font>
}<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-keyword">async</span> getGameMap() {
    <span class="hljs-keyword">let</span> res = <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">"/map"</span>)
    <span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> res.json()    
    <span class="hljs-keyword">this</span>.drawChunk(result.map)<font></font>
<font></font>
}<font></font>
<span class="hljs-comment">//      </span><font></font>
drawChunk(map) {<font></font>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> chunkKey <span class="hljs-keyword">in</span> map) {
        <span class="hljs-keyword">this</span>.add.image(map[chunkKey].x,map[chunkKey].y, map[chunkKey].key)<font></font>
    }<font></font>
}<font></font>
<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Server gibt unseren Chunk in Form eines JSON-Objekts an uns zurück. Sie können seine Struktur in der Browserkonsole anzeigen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7t/4u/p4/7t4up4ltauu_8d652po4svdvcae.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und so hat Phaser ihn im Browser gerendert: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kd/mr/y8/kdmry87ve-4eepdorxng_omh3h8.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben die einfachste Arbeit zwischen Server und Client untersucht. Im nächsten Artikel werden wir sofort 9 Chunks zeichnen und navigieren zur Welt. </font><font style="vertical-align: inherit;">Den gesamten Code und die Ressourcen aus dem Artikel finden Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de488780/index.html">Mozilla verlor im Browserkrieg, glaubt aber immer noch, dass es das Internet retten könnte</a></li>
<li><a href="../de488782/index.html">Wie gefällt Ihnen diese Option zur Abhängigkeitsverwaltung in Python?</a></li>
<li><a href="../de488784/index.html">Kommerzialisierung von Verbesserungen der freien Software unter Copyleft-Lizenzen</a></li>
<li><a href="../de488786/index.html">Wie detailliert sollte eine User Story sein?</a></li>
<li><a href="../de488792/index.html">Überwachung der Standortverfügbarkeit in Russland am Knie</a></li>
<li><a href="../de488796/index.html">Lernen, Microservices bereitzustellen. Teil 2. Kubernetes</a></li>
<li><a href="../de488800/index.html">Agil: 9 schlechte Tipps</a></li>
<li><a href="../de488806/index.html">Ist das nicht konstruktiv oder dienen Sie dem König die Petition?</a></li>
<li><a href="../de488808/index.html">Programmierer, lassen Sie uns die Quellen klassischer Programme untersuchen</a></li>
<li><a href="../de488810/index.html">Wir beleben den Hexapod wieder. Teil eins</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>