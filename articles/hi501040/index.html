<!doctype html>
<html class="no-js" lang="hi">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯТС тЫ░я╕П ЁЯСитАНЁЯСйтАНЁЯСзтАНЁЯСз рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдореЗрдВ рд╡рд┐рд╢рд┐рд╖реНрдЯ рддреНрд░реБрдЯрд┐рдпрд╛рдВ рдЬреЛ рдкреЛрд╕реНрдЯрдЧреНрд░реИрдХреНрд╕реНрд▓ рдореЗрдВ рдмреНрд▓реЛрдЯ рдХреА рдУрд░ рд▓реЗ рдЬрд╛рддреА рд╣реИрдВред рдПрдВрдбреНрд░реЗ рд╕рд╛рд▓рдирд┐рдХреЛрд╡ ЁЯН╢ ЁЯОЮя╕П ЁЯТ▒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдореЗрд░рд╛ рд╕реБрдЭрд╛рд╡ рд╣реИ рдХрд┐ рдЖрдк рдПрдВрдбреНрд░реА рд╕рд╛рд▓рдирд┐рдХреЛрд╡ рджреНрд╡рд╛рд░рд╛ 2016 рдХреА рд╢реБрд░реБрдЖрдд рдХреА рд░рд┐рдкреЛрд░реНрдЯ рдХреЗ рдбрд┐рдХреЛрдбрд┐рдВрдЧ рдХреЗ рд╕рд╛рде рдЦреБрдж рдХреЛ рдкрд░рд┐рдЪрд┐рдд рдХрд░рддреЗ рд╣реИрдВ "рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдореЗрдВ рд╡рд┐рд╢рд┐рд╖реНрдЯ рддреНрд░реБрдЯрд┐рдпрд╛рдВ рдЬреЛ рдк...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдореЗрдВ рд╡рд┐рд╢рд┐рд╖реНрдЯ рддреНрд░реБрдЯрд┐рдпрд╛рдВ рдЬреЛ рдкреЛрд╕реНрдЯрдЧреНрд░реИрдХреНрд╕реНрд▓ рдореЗрдВ рдмреНрд▓реЛрдЯ рдХреА рдУрд░ рд▓реЗ рдЬрд╛рддреА рд╣реИрдВред рдПрдВрдбреНрд░реЗ рд╕рд╛рд▓рдирд┐рдХреЛрд╡</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501040/"><p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореЗрд░рд╛ рд╕реБрдЭрд╛рд╡ рд╣реИ рдХрд┐ рдЖрдк рдПрдВрдбреНрд░реА рд╕рд╛рд▓рдирд┐рдХреЛрд╡ рджреНрд╡рд╛рд░рд╛ 2016 рдХреА рд╢реБрд░реБрдЖрдд рдХреА рд░рд┐рдкреЛрд░реНрдЯ рдХреЗ рдбрд┐рдХреЛрдбрд┐рдВрдЧ рдХреЗ рд╕рд╛рде рдЦреБрдж рдХреЛ рдкрд░рд┐рдЪрд┐рдд рдХрд░рддреЗ рд╣реИрдВ "рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдореЗрдВ рд╡рд┐рд╢рд┐рд╖реНрдЯ рддреНрд░реБрдЯрд┐рдпрд╛рдВ рдЬреЛ рдкреЛрд╕реНрдЯрдЧреНрд░реИрдХреНрд╕реНрд▓ рдореЗрдВ рдмреНрд▓реЛрдЯ рдХреА рдУрд░ рд▓реЗ рдЬрд╛рддреА рд╣реИрдВ"</font></font></strong></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рд░рд┐рдкреЛрд░реНрдЯ рдореЗрдВ, рдореИрдВ рдЙрди рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдореЗрдВ рдореБрдЦреНрдп рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░реВрдВрдЧрд╛ рдЬреЛ рдЖрд╡реЗрджрди рдХреЛрдб рдХреЛ рдбрд┐рдЬрд╛рдЗрди рдХрд░рдиреЗ рдФрд░ рд▓рд┐рдЦрдиреЗ рдХреЗ рдЪрд░рдг рдореЗрдВ рдЙрддреНрдкрдиреНрди рд╣реЛрддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдФрд░ рдореИрдВ рдХреЗрд╡рд▓ рдЙрди рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЛ рд▓реЗ рдЬрд╛рдКрдВрдЧрд╛ рдЬреЛ Postgresql рдореЗрдВ рдкреНрд░рд╕реНрдлреБрдЯрд┐рдд рд╣реЛрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдПрдХ рдирд┐рдпрдо рдХреЗ рд░реВрдк рдореЗрдВ, рдпрд╣ рдПрдХ рдкреВрд░реЗ рдХреЗ рд░реВрдк рдореЗрдВ рдЖрдкрдХреЗ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреЗ рдЕрдВрдд рдХреА рд╢реБрд░реБрдЖрдд рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╢реБрд░реВ рдореЗрдВ рдЗрд╕рдХреЗ рд▓рд┐рдП рдХреЛрдИ рдкреВрд░реНрд╡рд╛рдкреЗрдХреНрд╖рд╛рдПрдВ рджрд┐рдЦрд╛рдИ рдирд╣реАрдВ рджреЗ рд░рд╣реА рдереАрдВред</font></font></p><br>
<p><img src="https://habrastorage.org/webt/j4/gz/vk/j4gzvk96v4s9_slh-p4gnciohqw.png"></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рднреА рдХрд╛ рд╕реНрд╡рд╛рдЧрдд рдХрд░рддреЗ рд╣реБрдП рдЦреБрд╢реА рд╣реБрдИ! </font><font style="vertical-align: inherit;">рдпрд╣ рд░рд┐рдкреЛрд░реНрдЯ рдореЗрд░реЗ рд╕рд╣рдпреЛрдЧреА рд╕реЗ рдкрд╣рд▓реЗ рдХреА рддрд░рд╣ рддрдХрдиреАрдХреА рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рд░рд┐рдкреЛрд░реНрдЯ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдмреИрдХреЗрдВрдб рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреЗ рдЙрджреНрджреЗрд╢реНрдп рд╕реЗ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХрд╛рдлреА рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдЧреНрд░рд╛рд╣рдХ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдФрд░ рд╡реЗ рд╕рднреА рдПрдХ рд╣реА рдЧрд▓рддреА рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдореИрдВ рдЖрдкрдХреЛ рдЙрдирдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрддрд╛рдКрдВрдЧрд╛ </font><font style="vertical-align: inherit;">рдореИрдВ рд╕рдордЭрд╛рдКрдВрдЧрд╛ рдХрд┐ рдпреЗ рддреНрд░реБрдЯрд┐рдпрд╛рдВ рдХрд┐рд╕ рдШрд╛рддрдХ рдФрд░ рдмреБрд░реЗ рдХрд╛ рдиреЗрддреГрддреНрд╡ рдХрд░рддреА рд╣реИрдВред</font></font></p><br>
<p><img src="https://habrastorage.org/webt/9o/25/7s/9o257sxpafvagscbtymhpyqqakg.png"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧрд▓рддрд┐рдпрд╛рдБ рдХреНрдпреЛрдВ рдХреА рдЬрд╛рддреА рд╣реИрдВ? </font><font style="vertical-align: inherit;">рд╡реЗ рджреЛ рдХрд╛рд░рдгреЛрдВ рд╕реЗ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ: рд╕рдВрдпреЛрдЧ рд╕реЗ, рд╢рд╛рдпрдж рдпрд╣ рдХреБрдЫ рддрдВрддреНрд░ рдХреА рдЕрдЬреНрдЮрд╛рдирддрд╛ рдХреЗ рдХрд╛рд░рдг рднреА рд╣реИ рдЬреЛ рдЖрдзрд╛рд░ рдФрд░ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреЗ рдмреАрдЪ рдХреЗ рд╕реНрддрд░ рдХреЗ рд╕рд╛рде-рд╕рд╛рде рдЖрдзрд╛рд░ рдореЗрдВ рднреА рд╣реЛрддрд╛ рд╣реИред</font></font></p><br>
<p>        ,    .    ,   .     ,   ,        .        . </p><br>
<p><img src="https://habrastorage.org/webt/ch/r5/vr/chr5vre616zbkrcrk_fcbaz60ak.png"></p><br>
<p>    ,      .     ,      .   -       .</p><br>
<p><img src="https://habrastorage.org/webt/jx/m_/ng/jxm_nggqmszbi0aa-x0sl8lan-q.png"></p><br>
<p>  :   , 2 MB.           .     тАУ 2 000     .</p><br>
<p><img src="https://habrastorage.org/webt/fx/hv/ed/fxhvedvfa8g_cbgyxmfeadzgiyq.png"></p><br>
<p>        ,    ,  .   2   .   тАУ  ,      . </p><br>
<p>     ,       .    2 MB.    . </p><br>
<p>      , .    . </p><br>
<p>   тАУ    .  ,    .      ,   тАУ   -.        .</p><br>
<p><img src="https://habrastorage.org/webt/7k/kd/_3/7kkd_32jzk8cmll4xgh4hgsgg78.png"></p><br>
<p>      .           .    ,         ,  . ,    (   )      . </p><br>
<p>   ,            ,    .      тАУ 2 000  ,     . </p><br>
<p><img src="https://habrastorage.org/webt/ln/oi/kk/lnoikk3gactr_rj8v3f0af_suro.png"></p><br>
<p>     .  -     .    : </p><br>
<ul>
<li>    тАУ  ,          .      . . .   ,                  ,    -    .        тАУ ,  .</li>
<li> ,       -   exception.    exception    .         . </li>
<li>  тАУ     .   .    .  ,       ,     . </li>
</ul><br>
<p>    ? </p><br>
<p> ,         .       bloat.       ,          ,      .        .        10     , 10    ,      20 .        . </p><br>
<p>  ,  .    ,      .        ,   ,            300 .        , . .     .</p><br>
<p><img src="https://habrastorage.org/webt/72/q9/ca/72q9caetfeh_s85jaz2ekfjhsvw.png"></p><br>
<p>           . . .       .       Postgres   ,  -     .</p><br>
<p><img src="https://habrastorage.org/webt/dx/21/3d/dx213dhxb1rxroqoht-fjkl-flq.png"></p><br>
<p>     ?  .            .     ,   ,       .    .     ,          .    .    тАУ          ,          . </p><br>
<p><img src="https://habrastorage.org/webt/7k/lc/rq/7klcrqmf767vibtfeyvfcnytqoi.png"></p><br>
<p>    .     ,      .     .      .    . </p><br>
<p> ,      ,     ,    .     ,   .  -      .     ,    . </p><br>
<p><img src="https://habrastorage.org/webt/_j/he/_i/_jhe_ix0hqxffvpmj0_j_dfdugc.png"></p><br>
<p> : ┬л      ?┬╗.      .     ,         .          .      .     .          .       -   ,        . </p><br>
<p><img src="https://habrastorage.org/webt/6u/zb/uu/6uzbuuhl9l1dzipogae1xmq087u.png"></p><br>
<p>     ,    :         .         .</p><br>
<p>      ,           .          . ,     -  . . .              .     . </p><br>
<p>  ,   ,  .        ,      . </p><br>
<p><img src="https://habrastorage.org/webt/xa/vx/5u/xavx5up_mbqc52btb-_7nwssgaa.png"></p><br>
<p>  ,   ,       ,    .    .      ?</p><br>
<p>   .  -     .      .     , ,   .      .    ,   ,  ,     .   ,       .     -  Postgres.</p><br>
<p>  ?   -  ,       : ┬л , , id   ,        ┬╗.     id.         .   ,  -       ,        ,      ,    .   .</p><br>
<p>        ,   -   .    ,    ,   .       , . .     -   ,      ,   .       PostgreSQL.</p><br>
<p><img src="https://habrastorage.org/webt/ff/5v/ir/ff5virwfhf3vlipk3m-d_paqfvg.png"></p><br>
<p>    ?     ?</p><br>
<p>    - , - , -  .  .      ,      ,    id.   id,     ,  .    ,        .    ,      .        . </p><br>
<p>        . -   , ,  .        ?    ,        .         . </p><br>
<p>      .        ,          . </p><br>
<p>    ,       :  ,  ,    .        ┬лbloat┬╗,       . ,  2 MB,  300 MB?                 .</p><br>
<p><img src="https://habrastorage.org/webt/y5/sj/mu/y5sjmulskvpso8avoizedjlmspg.png"></p><br>
<p>     ? </p><br>
<ul>
<li>        150 .        ,       . </li>
<li>       .        ,     .      ,          ,    -     .     ,          ,      . </li>
<li>       .     ,     . </li>
<li>      ,        10   , 10    ,            10   , . .     .         20   , 10   .  ,          .    -  ,  , , ,   . </li>
<li> : ┬л   ?┬╗,           ,   . </li>
</ul><br>
<p><img src="https://habrastorage.org/webt/mu/8n/es/mu8ness1qpe1lcxbssbsvzahea4.png"></p><br>
<p>     ,  . </p><br>
<p>     ,  .  ,   -     ,  -  .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">pgstattuple</a>.   ,    ,     ,    . </p><br>
<p> ,     ,   .     .       .  тАУ  VACUUM FULL.  ,   ,     . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">Pg_repack</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">pgcompacttable</a> тАУ      .        . </p><br>
<p>     ,   .        . ,    .    . </p><br>
<p> ,    , ,    ,   ,      :</p><br>
<ul>
<li>   .       -. <strong>     idle in transaction</strong>.  ,     , -      ,   . </li>
<li>  ,   ,        .    .    .     ┬л┬╗ ,    . </li>
</ul><br>
<p><img src="https://habrastorage.org/webt/c5/ml/bb/c5mlbbr-awkevvdayxmrv_mo-o8.png"></p><br>
<p>      ,         ,       VACUUM FULLтАЩ  .     production.</p><br>
<p>          .          . </p><br>
<p><img src="https://habrastorage.org/webt/mf/v7/lp/mfv7lpm5hb875bsiz9d3bhbfltw.png"></p><br>
<p>     ,      ,  ,              . ,      ,     .     ,       ,    ,     ,     .          .    , ,   .</p><br>
<p><img src="https://habrastorage.org/webt/x-/-v/zt/x--vztacibsriajurryybhx7x90.png"></p><br>
<p>    .   .    ,    ,    .     . </p><br>
<p> ,         </p><br>
<p><img src="https://habrastorage.org/webt/er/je/qy/erjeqyfmzmqt6mamwovpkdce-_i.png"></p><br>
<ul>
<li>      .  ,           :   ,    .     ,     -   ETL.     .         . </li>
<li> ,        . ,   ,  .    ,      ,    . </li>
<li> . </li>
<li>  .  . </li>
</ul><br>
<p><img src="https://habrastorage.org/webt/dt/20/wf/dt20wfy6x4wrt9r3pp8wiufxcvi.png"></p><br>
<p>    ?              .       -. </p><br>
<p>        .   .  ,      .  ,        ,   2 .    ,    .     . </p><br>
<p><img src="https://habrastorage.org/webt/jm/kx/bh/jmkxbhmxuqvkqdb6klcwnkbhkgq.png"></p><br>
<p>          .         ,   .    . </p><br>
<p><img src="https://habrastorage.org/webt/sp/qf/5i/spqf5iac8b7dka6dbsdgltikv40.png"></p><br>
<p>   ,            .      . </p><br>
<p>      ,   .   . </p><br>
<p>  тАУ   .  ,      3 .    тАУ 3 .  ,         ,    . </p><br>
<p> ,      .  .       тАУ hot_standby_feedback.  . Hot_standby_feedback       .        .       .</p><br>
<p><img src="https://habrastorage.org/webt/8b/mb/dj/8bmbdjqpu-xvnqvvi-oo29dgttk.png"></p><br>
<p>         -?   -     .    ,      .   ,       -       -.   ,     ,    .        .            .  - . </p><br>
<p><img src="https://habrastorage.org/webt/4e/ib/ne/4eibnen11hx3m6prbe55bwsua9c.png"></p><br>
<p>     ,         .       .        .      ,   . </p><br>
<p><img src="https://habrastorage.org/webt/ob/hd/mz/obhdmztz6o_ks2_s5v47m3om9ki.png"></p><br>
<p>   ,    ,      ?</p><br>
<ul>
<li>   .        ,  ,            .     .  .  ,   Load Average  . </li>
<li>  ,        .   ,   .  ,  . </li>
<li>  .      raid.      .     .  ,  ,   . </li>
<li> : ,   .   . </li>
<li>  -      . </li>
</ul><br>
<p><img src="https://habrastorage.org/webt/1i/jz/8b/1ijz8bgp8qwrihslh52nmopyflk.png"></p><br>
<p>          .   .    .  ,         .             ,    ,    ,   . </p><br>
<p> .    -    -  .        -   .  , -,    ,    .      .      ,      .</p><br>
<p><img src="https://habrastorage.org/webt/eo/bh/bg/eobhbgp0qi84jmah2rgt4qi4k_y.png"></p><br>
<p>  ,      ,      .       . ,  ,  .        .       ,      . </p><br>
<p><img src="https://habrastorage.org/webt/vl/bl/97/vlbl97m63q5xbodozflngxns2va.png"></p><br>
<p>              - ,    . </p><br>
<p>    .  .   .    ,      . </p><br>
<ul>
<li>  hot_standby_feedback? ,        .        -     .    -     ,          . </li>
<li> max_standby_streaming_delay? ,   тАУ  .         ,      -  ,    .      ,      .     , ,     -   .  ,    ,     тАУ    ,              . </li>
<li>,      , ,     hot_standby_feedback  .      .    ,    .    .     ,     .       .  .       ,    . </li>
<li>          ,          .    streaming_delay.         .      ,     6 ,  .    . </li>
</ul><br>
<p>     :</p><br>
<ul>
<li>  .</li>
<li>    ,   . </li>
</ul><br>
<p>    .    . </p><br>
<p><img src="https://habrastorage.org/webt/pp/rt/v7/pprtv72jjqpv1h92ytkly6l2q8o.png"></p><br>
<p>    ,     . </p><br>
<p><img src="https://habrastorage.org/webt/50/ac/ws/50acwsegb4pnh0mnqhrhnkxpmfe.png"></p><br>
<ul>
<li>   .    .      .   ,       ,          ,       . </li>
<li>    . ,      ,       . , ,     ,         .       :       . </li>
<li>          . , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">Liquibase</a>.    .      .  .  .     ,      .       .  , .  . </li>
<li>  ,  . </li>
</ul><br>
<p><img src="https://habrastorage.org/webt/3i/0p/zd/3i0pzdxv5jsip1tylx0ya4j3efq.png"></p><br>
<p>      .        ,    15 GB.       ,       ,      . </p><br>
<p><img src="https://habrastorage.org/webt/af/8h/55/af8h55v9-pmhl4cxxeal6knig3m.png"></p><br>
<p>          ,           ,    .         ,    . . .          5     ,        ,   7,5. </p><br>
<p><img src="https://habrastorage.org/webt/eg/vq/wp/egvqwpk4ywpu3p7vvavc9cf8j3i.png"></p><br>
<p>     . </p><br>
<p>  , :</p><br>
<ul>
<li>    . </li>
<li>    . </li>
<li>     ,  . </li>
<li>, ,       ,   ,    . </li>
</ul><br>
<p>   bloat,     . </p><br>
<p><img src="https://habrastorage.org/webt/yc/5g/0y/yc5g0y3mlnw53wtdmy4hcokdyfu.png"></p><br>
<p>  ,  ,     ,      .       . </p><br>
<p><img src="https://habrastorage.org/webt/zx/uq/pd/zxuqpdxaazk54i9bbjo2gyxavq4.png"></p><br>
<p>       ,   ,             .            7,5,   .       2 ,      1,5 , . .     .    тАУ    .          . </p><br>
<p><img src="https://habrastorage.org/webt/ry/6a/6g/ry6a6g7_shhfpn9hrukkqgu1wza.png"></p><br>
<p>   ,     .    .      .</p><br>
<ul>
<li>     .     . </li>
<li>     .     DBA  ,     DBA.   .  ,       ,  ,     . </li>
<li>   ,   ,     ,    , . .   ,     :</li>
<li>  ,        . </li>
<li>         .    ? -,      .  ,     -     -. </li>
<li>     ,        ,          ,     . </li>
<li> ,        (     )  ,       .    тАУ      . </li>
<li>         ,           ,    .   -  ,      . </li>
<li>       . </li>
</ul><br>
<p>      bloat     . </p><br>
<p>    . </p><br>
<p><img src="https://habrastorage.org/webt/g4/3-/be/g43-beor7ucrudazmduy_nhiaig.png"></p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">https://github.com/dataegret/pg-utils/blob/master/sql/table_bloat.sql</a></p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">https://github.com/dataegret/pg-utils/blob/master/sql/table_bloat_approx.sql</a></p><br>
<p>      ,       . </p><br>
<p> ,   bloat,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">pgstattuple</a>.</p><br>
<p>    ,        .    .    . </p><br>
<ul>
<li>   ,        bloat  . </li>
<li>     ,     тАУ  bloat   bloat  .     ,  bloat   Postgres  .     MVCC. </li>
<li> 20 % bloat тАУ       . . .        . </li>
</ul><br>
<p>  ,    ,  , ,    . </p><br>
<p>  ,   bloat:</p><br>
<ul>
<li>       , . .        VACUUM FULL.             ,      .   VACUUM FULL?                .      .   ,    .          .  ,         :    ,    ,   .  VACUUM FULL     ,   .</li>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">pg_repack</a>.        VACUUM FULL,                .              ,     ,        ,   .          VACUUM FULL.      ,     ,     .      ,       -. </li>
<li>  тАУ  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">pgcompacttable</a>.      ,       .    pgcompacttable  ,            .       ,    ,      ,     .       , . .       .         . </li>
</ul><br>
<p>  . </p><br>
<p><img src="https://habrastorage.org/webt/nf/-z/pi/nf-zpinx8zbhv1j-jh-59ve35pi.png"></p><br>
<p>    bloat       ,      :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">https://www.slideshare.net/alexius2Mb/where-is-the-space-postgres</a> тАУ    .    ,     Postgres      .              bloat. </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">https://github.com/dataegret/pg-utils</a> тАУ     ,           .        bloat. </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"></a>   ,     . </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">http://blog.dataegret.com/2Mb018/03/postgresql-bloatbusters.html</a> тАУ    .         bloat       . </li>
</ul><br>
<p>       ,            ,      .     .   !</p><br>
<p></p><br>
<p><em>  !    ,    .     ? . .    ,        ,     -  .    -  joins.  -   ,   ,     - . . .    ,   .   ?    ,   ?    ?</em></p><br>
<p>   тАУ      ,   DBA.</p><br>
<p><em> .</em></p><br>
<p> PostgreSQL   ,  pg_stat_activity,     .    ,     .</p><br>
<p><em>   5    ?</em></p><br>
<p> cron  .      ,    . . .     ,   .   ,    .    .</p><br>
<p><em>  ,   ?</em></p><br>
<p>  .    .      .</p><br>
<p><em>  !   pg_repack  .      , тАж</em></p><br>
<p>   . </p><br>
<p>тАж <em>     .         ?</em></p><br>
<p>,     , . . pg_repack     ,  . ,  -    .     . </p><br>
<p><em>. .    - ?</em></p><br>
<p>       ,     . </p><br>
<p><em>  ,  VACUUM FULL?</em></p><br>
<p>VACUUM FULL,  ,    .      ,    .  pg_repack        .       ,    ,    . </p><br>
<p><em>!     .     ,     . . .  тАУ    .       -  ?</em></p><br>
<p>. Postgres   .    .    ,     .   id ,    ,    .     ,     .  -      .      ,           .     . </p><br>
<p><em> .      .   . ,     .      .     -  ,         .</em> </p><br>
<p>,       .  Postgres     .     .  ,     ,    tos-.    : , json.     .          bloat, . .   .    . </p><br>
<p><em>  !        statement timeout?</em></p><br>
<p> .    .  . .     ,    ,     .     . . .      cron,  .      ,     .    ,    10 .         .      pg_stat_activity.</p><br>
<p><em>  !       .       ,    .  - exception,    rollback .    .      .   , .      ,    PostgreSQL     ,    ?</em></p><br>
<p>      ,      ,   ,   ORM,  .    .     auto commit on,    ,   .</p><br>
<p><em>. .     ?</em></p><br>
<p>   .    .  auto commit on.   .   ,  - .      ┬лstart transaction┬╗  ┬лend transaction┬╗,      . </p><br>
<p><em>!   ! ,     ,  -      .  - ,    ?</em> </p><br>
<p>   -  . </p><br>
<p><em>, DBA   ,     . .</em></p><br>
<p>   ,     -   ,    . </p><br>
<p><em>    ?</em></p><br>
<p>    reserved space, . .        ,    ,    .     ,  .     тАУ  ,        .   - ,     . </p><br>
<p><em>  ?</em></p><br>
<p>   .    ,    ,     ,  .      ,    ,    .    . </p><br>
<p><em>  !    . -,   ,  ,           ,    .       ,   .    ?</em></p><br>
<p>   . </p><br>
<p><em>    ?</em></p><br>
<p>   . , pg_rapack, pgcompacttable.   ,  .  VACUUM FULL   ,   , . .    . </p><br>
<p><em>  .   ,          .  ,   тАУ  ,   тАУ  .</em> </p><br>
<p>    ?    ,    .    .   ,  ?   -  .          ,     ,     ,         ,    .      ,      ,     ,       ,   .   PostgreSQL  ,    .     ,      ,      . </p><br>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдВрдбреНрд░реА, рдПрдХ рд╕рд╡рд╛рд▓ рд╣реИред </font><font style="vertical-align: inherit;">рдкреНрд░рд╕реНрддреБрддрд┐ рдХреЗ рджреМрд░рд╛рди рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рджрд┐рдЦрд╛рдП рдЧрдП рдпреЗ рдЕрджреНрднреБрдд рд░реЗрдЦрд╛рдВрдХрди, рдХрд╛рдо рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╣реИ, рдЖрдкрдХреА рдХрд┐рд╕реА рддрд░рд╣ рдХреА рдЙрдкрдпреЛрдЧрд┐рддрд╛? </font><font style="vertical-align: inherit;">рдХреНрдпрд╛ рд░реЗрдЦрд╛рдВрдХрди рдмрдирд╛рдпрд╛?</font></font></em></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдПрдХ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдУрдХреЗрдореАрдЯрд░</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реЗрд╡рд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред</font></font></p><br>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпрд╛ рдпрд╣ рдПрдХ рд╡рд╛рдгрд┐рдЬреНрдпрд┐рдХ рдЙрддреНрдкрд╛рдж рд╣реИ?</font></font></em></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рдБред </font><font style="vertical-align: inherit;">рдпрд╣ рдПрдХ рд╡рд╛рдгрд┐рдЬреНрдпрд┐рдХ рдЙрддреНрдкрд╛рдж рд╣реИред</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi501022/index.html">"рдореИрдВ рд░реЗрдЧрд┐рд╕реНрддрд╛рди рдореЗрдВ рд╣реВрдБ": рдХреНрдпреЛрдВ рдЖрддреНрдо-рдЕрд▓рдЧрд╛рд╡ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдПрдХ рдЧрдВрднреАрд░ рддрдирд╛рд╡ рдмрди рдЧрдпрд╛ рдФрд░ рдЗрд╕рдХрд╛ рдкрд░рд┐рдгрд╛рдо рдХреНрдпрд╛ рд╣реБрдЖ</a></li>
<li><a href="../hi501026/index.html">рджреВрд░рд╕реНрде рдмреИрдВрдХрд┐рдВрдЧ рдкрд╣рдЪрд╛рди: рдЬрдЯрд┐рд▓ рд╕реЗ рд╕рд░рд▓ рдпрд╛ рдмреИрдВрдХреЛрдВ рд╕реЗ, рдЖрдкрдХреЛ рдмрд╛рдпреЛрдореЗрдЯреНрд░рд┐рдХреНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреНрдпреЛрдВ рд╣реИ?</a></li>
<li><a href="../hi501030/index.html">рдХреЛрдб рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдбреЗрдореЛ рджреВрд╕рд░реА рд╡рд╛рд╕реНрддрд╡рд┐рдХрддрд╛</a></li>
<li><a href="../hi501032/index.html">рдЪреАрдиреА рднрд╛рдЧреЛрдВ рд╕реЗ рд╕рд╕реНрддрд╛ рд╕рд░реНрд╡рд░ред рднрд╛рдЧ 1, рд▓реЛрд╣рд╛</a></li>
<li><a href="../hi501034/index.html">рдЖрдИрдмреАрдПрдо рд╕рд╛рдкреНрддрд╛рд╣рд┐рдХ рд╕реЗрдорд┐рдирд╛рд░ - рдордИ 2020</a></li>
<li><a href="../hi501042/index.html">рдЕрдиреБрдкрд╛рд▓рди рдкрд░ рд▓рд╛рдЗрдХрдмреЗрдЬ: рд╣рдо рд╕реВрдЪрдирд╛ рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдирд┐рдпрд╛рдордХреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЛ рд╕рдордЭрддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi501044/index.html">рдмреЗрд╡рдХреВрдлреЛрдВ рдХреЗ рд▓рд┐рдП рд▓реЛрдЧреЛрдВ рдХреЛ рдордд рдкрдХрдбрд╝реЛ рдпрд╛ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ рдкреГрд╖реНрдарднреВрдорд┐ рд╡рд╛рд▓рд╛ рд╡реНрдпрдХреНрддрд┐ рд╕реЗрд▓ рдЯреЙрд╡рд░ (рд╡реАрдбрд┐рдпреЛ) рдХреЛ рдХреИрд╕реЗ рдЬрд▓рд╛ рд╕рдХрддрд╛ рд╣реИ</a></li>
<li><a href="../hi501048/index.html">OpenVPN рдкрд░ рджреВрд░рд╕реНрде рдХрд╛рд░реНрдп SMB рд╕рдВрдЧрдарди рдХрд╛ рд╕рдВрдЧрдарди</a></li>
<li><a href="../hi501050/index.html">рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ рдФрд░ LabVIEW рд╕рд╛рдореБрджрд╛рдпрд┐рдХ рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░реЗрдВ</a></li>
<li><a href="../hi501052/index.html">рдЪреАрдиреА рдЕрдВрддрд░рд┐рдХреНрд╖ рдпрд╛рди рдХреА рд╡рд╛рдкрд╕реА</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>