<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏿‍🔧 🏟️ ⏸️ 静的コード分析が使用されていないために検出できないエラー 🎟️ 😩 🚧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="時折、オープンソースプロジェクトのチェックに関する記事の読者は、PVS-Studio静的コードアナライザーが、重要ではないか、アプリケーションにまったく影響を与えないエラーの大部分を検出することに気づきます。本当にそうです。手動テスト、ユーザーレビュー、その他の高価な方法により、重要なエラーのほとん...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>静的コード分析が使用されていないために検出できないエラー</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/460119/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">時折、オープンソースプロジェクトのチェックに関する記事の読者は、PVS-Studio静的コードアナライザーが、重要ではないか、アプリケーションにまったく影響を与えないエラーの大部分を検出することに気づきます。本当にそうです。手動テスト、ユーザーレビュー、その他の高価な方法により、重要なエラーのほとんどはすでに修正されています。同時に、これらのエラーの多くは、コードの作成段階でも見つかり、時間、評判、お金の損失を最小限に抑えて修正できました。この記事では、プロジェクトの作成者が静的コード分析を使用した場合にすぐに修正される実際のエラーの例をいくつか紹介します。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d3a/231/281/d3a2312812d914f22a3793c5f8e15ce7.png"></div><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アイデアは非常に簡単です。プルリクエストの例についてGitHubを見てみましょう。そのコメントは、これがバグ修正であることを示しています。そして、PVS-Studio静的コードアナライザーを使用して、これらのエラーを見つけてください。修正されたエラーがアナライザーによって検出された場合、これは、コードの作成段階でも修正できることを意味します。そして、エラーが早く修正されれば、それだけ安くなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、GitHubは私たちを失望させ、このトピックに関する優れたスマートな記事を作成することを許可しませんでした。 GitHub自体にもグリッチ（または機能）があり、特定のプログラミング言語でのみ記述されたプロジェクトのプルリクエストでコメントを検索できません。さて、私は「それを調理する方法を知りません」。 C ++、C＃、またはJavaのプロジェクトでコメントを探すように言ったことに関係なく、結果はPHP、Python、JavaScriptなどを含むすべての言語で表示されます。その結果、適切なケースを探すのは非常に退屈な作業でした。私は自分をいくつかの例に限定します。ただし、これらは、定期的に使用した場合の静的コード分析ツールの有用性を示すのに十分です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エラーが早い段階で検出された場合はどうなりますか？</font><font style="vertical-align: inherit;">答えは簡単です。プログラマーはその兆候を待つ必要がなく、欠陥のあるコードを探して修正する必要があります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studioがすぐに検出できるエラーを見てみましょう</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。最初の例は</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、SatisfactoryModLoaderプロジェクトからの引用です。</font><font style="vertical-align: inherit;">エラーを修正する前のコードは次のようになっています。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// gets an API function from the mod handler</span>
<span class="hljs-function">SML_API PVOID <span class="hljs-title">getAPIFunction</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name)</span> </span>{
  <span class="hljs-keyword">bool</span> found = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">for</span> (Registry reg : modHandler.APIRegistry) {
    <span class="hljs-keyword">if</span> (reg.name == name) {<font></font>
      found = <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (!found) {
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> msg = ...;<font></font>
    MessageBoxA(<span class="hljs-literal">NULL</span>, <font></font>
                msg.c_str(), <font></font>
                <span class="hljs-string">"SatisfactoryModLoader Fatal Error"</span>, <font></font>
                MB_ICONERROR);<font></font>
    <span class="hljs-built_in">abort</span>();<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードには、PVS-Studioがすぐに警告を表示するエラーが含まれていました</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。V591</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非void関数は値を返す必要があります。</font><font style="vertical-align: inherit;">ModFunctions.cpp 44 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記の関数には</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がない</font><font style="vertical-align: inherit;">ため、正式には未定義の値が返されます。</font><font style="vertical-align: inherit;">プログラマーはコードアナライザーを使用しなかったため、自分でエラーを探す必要がありました。</font><font style="vertical-align: inherit;">編集後の機能：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// gets an API function from the mod handler</span>
<span class="hljs-function">SML_API PVOID <span class="hljs-title">getAPIFunction</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name)</span> </span>{
  <span class="hljs-keyword">bool</span> found = <span class="hljs-literal">false</span>; <font></font>
  PVOID func = <span class="hljs-literal">NULL</span>;
  <span class="hljs-keyword">for</span> (Registry reg : modHandler.APIRegistry) {
    <span class="hljs-keyword">if</span> (reg.name == name) {<font></font>
      func = reg.func;<font></font>
      found = <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (!found) {
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> msg = ...;<font></font>
    MessageBoxA(<span class="hljs-literal">NULL</span>, <font></font>
                msg.c_str(), <font></font>
                <span class="hljs-string">"SatisfactoryModLoader Fatal Error"</span>, <font></font>
                MB_ICONERROR);<font></font>
    <span class="hljs-built_in">abort</span>();<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> func;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「：コミットで、著者は重大なバグのように示されていることを好奇心で</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">固定</font></font></i><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重大なバグ</font></font></i></b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> API関数が返されませんでした</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」。</font><font style="vertical-align: inherit;">mc6809プロジェクト履歴</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
の2番目の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コミットで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、次のコードが修正されました。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mc6809dis_direct</span><span class="hljs-params">(
  <span class="hljs-keyword">mc6809dis__t</span> *<span class="hljs-keyword">const</span> dis,
  <span class="hljs-keyword">mc6809__t</span>    *<span class="hljs-keyword">const</span> cpu,
  <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>   *<span class="hljs-keyword">const</span> op,
  <span class="hljs-keyword">const</span> <span class="hljs-keyword">bool</span>          b16
)</span>
</span>{<font></font>
  assert(dis != <span class="hljs-literal">NULL</span>);<font></font>
  assert(op != <span class="hljs-literal">NULL</span>);<font></font>
<font></font>
  addr.b[MSB] = cpu-&gt;dp;<font></font>
  addr.b[LSB] = (*dis-&gt;read)(dis, dis-&gt;next++);<font></font>
<font></font>
  ...<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (cpu != <span class="hljs-literal">NULL</span>)<font></font>
  {<font></font>
    ...<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
著者は1行だけ修正しました。</font><font style="vertical-align: inherit;">彼は表現を置き換えました</font></font><br>
<br>
<pre><code class="cpp hljs">addr.b[MSB] = cpu-&gt;dp;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
表現について</font></font><br>
<br>
<pre><code class="cpp hljs">addr.b[MSB] = cpu != <span class="hljs-literal">NULL</span> ? cpu-&gt;dp : <span class="hljs-number">0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
旧バージョンのコードでは</font><font style="vertical-align: inherit;">、ヌルポインターと等しい</font><font style="vertical-align: inherit;">かどうかの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チェックはありませんでした</font><font style="vertical-align: inherit;">。 2番目の引数として関数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mc6809dis_directに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nullポインターが渡さ</font><font style="vertical-align: inherit;">れたことが突然判明した場合</font><font style="vertical-align: inherit;">は、関数の本体で逆参照されます。結果は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">嘆かわしく、予測不可能</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
nullポインターの逆参照は、私たちが言われている最も一般的なパターンの1つです。「これは重大なエラーではありません。まあ、彼女はコードに住んでいて、逆参照が発生した場合、プログラムは静かにクラッシュし、それだけです。」 C ++プログラマーからこれを聞くのは奇妙で悲しいですが、人生は人生です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いずれにせよ、このプロジェクトでは、コミットヘッダーに次のように示されているため、このような逆参照はバグに変わりました。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バグ修正--- NULLデリファレンス</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクト開発者がPVS-Studioを使用した場合、彼はコードをチェックして2か月半前に警告を検出できたでしょう（これは、エラーが発生してからどれだけ経過したかです）：</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V595</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'cpu'ポインターはnullptrに対して検証される前に利用されました。行をチェックしてください：1814、1821。mc6809dis.c 1814 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、エラーが発生した場合でもエラーが解消され、時間と、おそらく開発者の神経を節約できます:) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別の興味深い</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">編集の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font><font style="vertical-align: inherit;">libmortonプロジェクトで見つかりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
修正されたコード：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> morton&gt;
<span class="hljs-keyword">inline</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">findFirstSetBitZeroIdx</span><span class="hljs-params">(<span class="hljs-keyword">const</span> morton x, 
                                   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>* firstbit_location)</span>
</span>{
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> _MSC_VER &amp;&amp; !_WIN64</span>
  <span class="hljs-comment">// 32 BIT on 32 BIT</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">sizeof</span>(morton) &lt;= <span class="hljs-number">4</span>) {
    <span class="hljs-keyword">return</span> _BitScanReverse(firstbit_location, x) != <span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-comment">// 64 BIT on 32 BIT</span>
  <span class="hljs-keyword">else</span> {<font></font>
    *firstbit_location = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (_BitScanReverse(firstbit_location, (x &gt;&gt; <span class="hljs-number">32</span>))) { <span class="hljs-comment">// check first part</span>
      firstbit_location += <span class="hljs-number">32</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> _BitScanReverse(firstbit_location, (x &amp; <span class="hljs-number">0xFFFFFFFF</span>)) != <span class="hljs-number">0</span>;<font></font>
  }<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">elif</span>  _MSC_VER &amp;&amp; _WIN64</span><font></font>
  ....<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">elif</span> __GNUC__</span><font></font>
  ....<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼の編集では、プログラマーは式 " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">firstbit_location + = 32</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "を " </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></i></b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> firstbit_location + = 32</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "に</font><i><font style="vertical-align: inherit;">置き換え</font></i><font style="vertical-align: inherit;">ます。プログラマー</font><font style="vertical-align: inherit;">は、</font><i><font style="vertical-align: inherit;">firstbit_location</font></i><font style="vertical-align: inherit;">ポインターが</font><i><font style="vertical-align: inherit;">バインドさ</font></i><font style="vertical-align: inherit;">れている変数の値に</font><font style="vertical-align: inherit;">数値</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が追加</font><i><font style="vertical-align: inherit;">さ</font></i><font style="vertical-align: inherit;">れることを</font><font style="vertical-align: inherit;">期待して</font><font style="vertical-align: inherit;">いましたが、ポインターに直接追加されました。ポインターの変更された値は他で使用されず、変数の期待値は変更されませんでした。</font><font style="vertical-align: inherit;">
PVS-Studioは次のコードに対して警告を発行します：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V1001</font></a><font style="vertical-align: inherit;"> 'firstbit_location'変数が割り当てられていますが、関数の最後で使用されていません。 morton_common.h 22</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変更されたものの、さらに使用されていない表現では何がひどいものになりそうですか？ V1001の診断は明らかに、特に危険なバグを特定することを目的としたものではありません。それにもかかわらず、彼女はプログラムのロジックに影響を与える重要なエラーを発見しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、このエラーを見つけるのは簡単ではないことがわかりました！彼女はファイルが作成されたその瞬間からプログラムに参加しただけでなく、隣接する行の多くの編集を生き延び、プロジェクトに3（</font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">！</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）年間</font><font style="vertical-align: inherit;">存在しました</font><font style="vertical-align: inherit;">。この間ずっと、プログラムのロジックは壊れていて、開発者が期待したとおりに機能しませんでした。彼らがPVS-Studioを使用した場合、エラーははるかに早く検出されたはずです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、別の美しい例を考えてみましょう。</font><font style="vertical-align: inherit;">GitHubでバグ修正を収集していたときに、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このコンテンツの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修正を何度か見つけました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">修正されたエラーはここにありました：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">kvm_arch_prepare_memory_region</span><span class="hljs-params">(...)</span>
</span>{<font></font>
  ...<font></font>
  <span class="hljs-keyword">do</span> {
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">vm_area_struct</span> *<span class="hljs-title">vma</span> = <span class="hljs-title">find_vma</span>(<span class="hljs-title">current</span>-&gt;<span class="hljs-title">mm</span>, <span class="hljs-title">hva</span>);</span>
    <span class="hljs-keyword">hva_t</span> vm_start, vm_end;<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (vma-&gt;vm_flags &amp; VM_PFNMAP) {<font></font>
      ...<font></font>
      <span class="hljs-keyword">phys_addr_t</span> pa = (vma-&gt;vm_pgoff &lt;&lt; PAGE_SHIFT) +<font></font>
        vm_start - vma-&gt;vm_start;<font></font>
      ...<font></font>
    }<font></font>
    ...<font></font>
  } <span class="hljs-keyword">while</span> (hva &lt; reg_end);<font></font>
  ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studioは、コードのこのセクションに警告を出しました：</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V629</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'vma-&gt; vm_pgoff &lt;&lt; 12'式を検査することを検討してください。</font><font style="vertical-align: inherit;">32ビット値のビットシフトと、それに続く64ビットタイプへの拡張。</font><font style="vertical-align: inherit;">mmu.c 1795 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
式「</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">phys_addr_t pa =（vma-&gt; vm_pgoff &lt;&lt; PAGE_SHIFT）+ vm_start-vma-&gt; vm_start;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」で</font><font style="vertical-align: inherit;">使用されている変数宣言</font><font style="vertical-align: inherit;">を確認したところ、上記のコードは次の合成例に似ていることがわかりました。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">foo</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> a, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> b)</span>
</span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> x = (a &lt;&lt; <span class="hljs-number">12</span>) + b;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
32ビット変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xFFFFF</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">より大きい場合</font><font style="vertical-align: inherit;">、上位12ビットには少なくとも1つの非ゼロ値が含まれます。この変数に左シフト演算を適用すると、これらの有効ビットが失われ、その結果、</font><font style="vertical-align: inherit;">不正な情報が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に書き込ま</font><font style="vertical-align: inherit;">れ</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上位ビットの損失をなくすには、最初に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unsigned long long</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">型に</font><font style="vertical-align: inherit;">キャストし</font><i><font style="vertical-align: inherit;">、</font></i><font style="vertical-align: inherit;">その後にシフト操作を実行する必要があります。</font></font><br>
<br>
<pre><code class="cpp hljs">pa = (<span class="hljs-keyword">phys_addr_t</span>)vma-&gt;vm_pgoff &lt;&lt; PAGE_SHIFT;<font></font>
pa += vm_start - vma-&gt;vm_start;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pa</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は常に正しい値を書き込みます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべては問題ありませんが、このバグは、記事の最初の例のように、コミットの作成者がコメントで個別に書いたため、重大であることが判明しました。さらに、このエラーは膨大な数のプロジェクトで発生しました。悲劇の規模を十分に理解するには、</font><font style="vertical-align: inherit;">GitHubでこのバグ修正を検索するときに結果の数を確認する</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こと</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をお</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">勧め</font></a><font style="vertical-align: inherit;">します。怖いですね。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e38/6c7/682/e386c76827f9118ec91d04935304d779.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そこで、静的コードアナライザーを定期的に使用するメリットを示すために、新しいアプローチを採用しました。</font><font style="vertical-align: inherit;">楽しんでいただけたでしょうか。</font><font style="vertical-align: inherit;">PVS-Studio静的コードアナライザーを</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ダウンロードして試し</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">て、独自のプロジェクトをテストしてください。</font><font style="vertical-align: inherit;">執筆時点では、さまざまなエラーパターンを検出するために約700の診断ルールが実装されています。</font><font style="vertical-align: inherit;">C、C ++、C＃、およびJavaがサポートされています。</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事を英語圏の読者と共有したい場合は、翻訳へのリンクを使用してください：George Gribkov。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">静的コード分析が使用されていないために検出されないエラー</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja460109/index.html">Angular：アプリケーションを確認する必要があるが、バックエンドの準備がまだ整っていない場合</a></li>
<li><a href="../ja460111/index.html">SAP Business One 9.3の更新バージョン：変更点</a></li>
<li><a href="../ja460113/index.html">JSOC CERT、またはUnbanalフォレンジックの生涯からのいくつかの物語</a></li>
<li><a href="../ja460115/index.html">Erlangでの10年間のプログラミング</a></li>
<li><a href="../ja460117/index.html">ロシアの最大の顧客は大きなジャックポットか頭痛の種ですか？AGIMAエクスペリエンス</a></li>
<li><a href="../ja460125/index.html">Node.jsまたはJava：パフォーマンス、リソース、フロー制御、人気、個人的な経験</a></li>
<li><a href="../ja460129/index.html">ロボットとイチゴ：AIがフィールドの歩留まりを向上させる方法</a></li>
<li><a href="../ja460131/index.html">Sophos XG Firewall：従来のMEからNGFWまで、情報セキュリティインシデントへの自動応答</a></li>
<li><a href="../ja460133/index.html">Kotlin / Everywhere-ショーケースの練習：7月31日</a></li>
<li><a href="../ja460135/index.html">セキュリティウィーク29：ズーム、セキュリティ、ドラマの脆弱性</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>