<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòµ üßëüèæ‚Äçü§ù‚Äçüßëüèæ üë≤üèø Python for the tester: how small c pandas scripts help test large datasets üõ∂ üòÉ üöá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I work as a tester on a project, the essence of which is the collection and storage of various data and the formation of various reports and file uplo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Python for the tester: how small c pandas scripts help test large datasets</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486756/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I work as a tester on a project, the essence of which is the collection and storage of various data and the formation of various reports and file uploads on their basis. </font><font style="vertical-align: inherit;">When generating such reports, a large number of conditions for data selection are taken into account, and therefore, when testing, you have to work a lot with SQL queries in the database. </font><font style="vertical-align: inherit;">But to verify the correct selection of data and search for excess / missing data, this often does not suffice, so I had to look for additional tools for this. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since I already had some basic python knowledge, I decided to try to write small scripts that would allow me to do something with the existing data and thereby facilitate and speed up the testing process. </font><font style="vertical-align: inherit;">In this article I will tell you what came of it.</font></font><br>
<a name="habracut"></a><br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Designing a script script</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To write a script, you need to figure out what exactly the script should do, what data needs to be input and what data is expected to be output. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sample steps for the scenario:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We get a file with data in a certain format (or several files)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get data from file / files</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We select the necessary data</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We perform some operations on data</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We upload data to an Excel file, if necessary (usually this format is the most convenient for further analysis and storage)</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then you need to think about how and where you can get input. </font><font style="vertical-align: inherit;">It can be a manually created file with data, uploading data to a UI into a file with filters, a file with parsing data using another script, a file to upload the results of an SQL query to the database (you can quickly upload data to a csv file from the database), json -file or xml-file with data from the response to a request to API, etc.</font></font><br>
<br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We write scripts in python using pandas and other libraries</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To write scripts in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> you need to install an interpreter and a suitable IDE. </font><font style="vertical-align: inherit;">It is also best to create a separate </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">virtual environment</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for this project. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I use different libraries for scripts, some of them are </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">built-in python libraries</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , some need to be installed additionally:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pandas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is a library for data analysis. </font><font style="vertical-align: inherit;">It allows you to work with data from files of various formats, as well as receive data directly from the database using an SQL query. </font><font style="vertical-align: inherit;">Data from files are loaded into data frames (visually the same tables as in Excel), with data in which you can already perform different operations: combine data from different data frames by analogy with join / union in SQL, select the necessary data under certain conditions, compare data in different columns of the data frame, etc.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openpyxl, xlrd</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - libraries for working with Excel.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The simplest script framework for working with data from csv, json, Excel files is as follows:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#   pandas</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
<font></font>
<span class="hljs-comment">#    csv-  -</span>
<span class="hljs-comment"># (        )</span>
<span class="hljs-comment">#       csv-     ";"</span>
df = pd.read_csv(<span class="hljs-string">'./csv_file.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>)<font></font>
<font></font>
<span class="hljs-comment"># </span>
<span class="hljs-comment">#    json-  -</span>
<span class="hljs-comment"># (        )</span>
<span class="hljs-comment"># df = pd.read_json('./json_file.json', encoding='utf-8')</span><font></font>
<font></font>
<span class="hljs-comment"># </span>
<span class="hljs-comment">#    Excel-  -,     </span>
<span class="hljs-comment"># (        )</span>
<span class="hljs-comment"># file_excel = 'Excel_file.xlsx'</span>
<span class="hljs-comment"># df = pd.ExcelFile(file_excel).parse('1')</span><font></font>
<font></font>
<font></font>
<span class="hljs-comment">#  -     -  </span>
<span class="hljs-comment">#    - final_df</span><font></font>
<font></font>
<font></font>
<span class="hljs-comment">#    Excel-,  </span>
<span class="hljs-comment">#          </span>
<span class="hljs-comment"># (      )</span>
writer = pd.ExcelWriter(<span class="hljs-string">'.xlsx'</span>)<font></font>
final_df.to_excel(writer, <span class="hljs-string">'1'</span>)<font></font>
writer.save()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this script, data from a file of the required format is loaded into a data frame, the necessary data is selected and some operations are performed on them, then the data is written to a new Excel file. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you need to work with data obtained as a result of an SQL query to the database, you can not export them to a csv file, but immediately get them into a data frame by executing an SQL query in the database in the script itself:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#   pandas</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-comment">#      ,     PostgreSQL</span>
<span class="hljs-comment"># (   -    )</span>
<span class="hljs-keyword">import</span> psycopg2<font></font>
<font></font>
<span class="hljs-comment">#    </span>
conn = psycopg2.connect(dbname=<span class="hljs-string">'_'</span>, host=<span class="hljs-string">''</span>, port=<span class="hljs-string">''</span>,<font></font>
                        user=<span class="hljs-string">''</span>, password=<span class="hljs-string">''</span>)<font></font>
<font></font>
<span class="hljs-comment">#   SQL-</span>
q = <span class="hljs-string">"""select ... 
    from ... 
    where ..."""</span><font></font>
<font></font>
<span class="hljs-comment">#    -,  SQL-</span><font></font>
df = pd.read_sql_query(q, conn)<font></font>
<font></font>
<font></font>
<span class="hljs-comment">#  -     -  </span>
<span class="hljs-comment">#    - final_df</span><font></font>
<font></font>
<font></font>
<span class="hljs-comment">#    Excel-,  </span>
<span class="hljs-comment">#          </span>
<span class="hljs-comment"># (      )</span>
writer = pd.ExcelWriter(<span class="hljs-string">'.xlsx'</span>)<font></font>
final_df.to_excel(writer, <span class="hljs-string">'1'</span>)<font></font>
writer.save()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you need to get data from an xml file, then you can use the libraries designed for this. </font><font style="vertical-align: inherit;">I use the built-in library </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ElementTree</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When the data is received in a data frame, you can immediately combine it with data from another data frame (analogues of join or union in SQL) or perform some operations on them, for example, remove duplicates, remove rows with empty values ‚Äã‚Äãin certain cells , compare data in multiple columns, select the desired rows / columns, etc. </font><font style="vertical-align: inherit;">Read more in the documentation for pandas.</font></font><br>
<br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script Usage Options</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And now we turn on the main tool of the tester and select the data / features on our project, for verification of which such scripts would be useful. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Files with a small amount of test data generated using </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">generatedata</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> were created for the scripts </font><font style="vertical-align: inherit;">. In reality, data files contain tens of thousands of rows and a large number of columns. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scenario # 1</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
There are three files in csv format with data. For each data line, there is a field with a unique identifier id. Data from these files are selected taking into account certain conditions and entered into a table in the database, then these data are displayed in a report in the form of a table on the UI. It is possible to upload data on a UI to an Excel file. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suppose that the conditions for selecting data for a report from source files are as follows:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Files can have duplicates by id, in a report, a record with the same identifier should be taken into account only once (in this case, we simply select any one of the rows with this identifier from the data).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rows with missing data in the reg_date column cell should not be counted.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In fact, there can be more selection conditions, also the data can be compared with the data already in the system and only intersecting data by id will be displayed in the report, but for example we will take into account only the two conditions indicated above.</font></font></li>
</ul><br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The task of the tester:</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Check that the lines with the necessary objects are correctly selected from the source files and that all these objects are displayed in the report on the UI. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We compose a script for the script:</font></font></u><br>
<br>
<ul>
<li>  -      csv-,     - (   union  SQL),      id,       reg_date.</li>
<li>  UI     Excel-,   ,       -.</li>
<li> (merge)   -   (   outer join  SQL)          Excel-   .</li>
<li>              ,   ,   -   ,      ,   UI.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the final file, the data will contain only one column with id, if the names of the columns in different data frames coincided, and it may not be clear which columns / rows from which file were. </font><font style="vertical-align: inherit;">Therefore, I either name the columns with a unique identifier by different names in the files, or add a separate column ‚ÄúRows from a file of such and such‚Äù to each file and put ‚ÄúYes‚Äù in it - then when analyzing the resulting Excel file it‚Äôs convenient to filter by this column because </font><font style="vertical-align: inherit;">they always contain a value and, filtering by them, you can already understand what data diverges in the corresponding columns. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example data from file </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example1_csv_1.csv</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/of/5j/_u/of5j_us3u07uset3ljspbbwtrr4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example data from </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">report_UI.xlsx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">: A </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uh/xy/1s/uhxy1sygvioxbbhlksppdpsar_e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
python script looks like this:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#   pandas</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
<font></font>
<span class="hljs-comment">#     csv-    -</span>
<span class="hljs-comment"># (        )</span>
df_from_file1 = pd.read_csv(<span class="hljs-string">'./example1_csv_1.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>,<font></font>
                            usecols=[<span class="hljs-string">'id'</span>, <span class="hljs-string">'name'</span>, <span class="hljs-string">'email'</span>, <span class="hljs-string">'reg_date'</span>])<font></font>
df_from_file2 = pd.read_csv(<span class="hljs-string">'./example1_csv_2.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>,<font></font>
                            usecols=[<span class="hljs-string">'id'</span>, <span class="hljs-string">'name'</span>, <span class="hljs-string">'email'</span>,<span class="hljs-string">'reg_date'</span>])<font></font>
df_from_file3 = pd.read_csv(<span class="hljs-string">'./example1_csv_3.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>,<font></font>
                            usecols=[<span class="hljs-string">'id'</span>, <span class="hljs-string">'name'</span>, <span class="hljs-string">'email'</span>, <span class="hljs-string">'reg_date'</span>])<font></font>
<font></font>
<span class="hljs-comment">#    -    - </span>
<span class="hljs-comment"># (   union  SQL)</span><font></font>
df_from_csv = pd.concat([df_from_file1, df_from_file2, df_from_file3]).\<font></font>
    reset_index(drop=<span class="hljs-literal">True</span>)<font></font>
print(df_from_csv)<font></font>
<font></font>
<span class="hljs-comment">#       </span>
df_from_csv.drop_duplicates(subset=<span class="hljs-string">'id'</span>, keep=<span class="hljs-string">'first'</span>, inplace=<span class="hljs-literal">True</span>)<font></font>
print(df_from_csv)<font></font>
<font></font>
<span class="hljs-comment">#     NaN ( )   reg_date</span><font></font>
df_from_csv = df_from_csv.dropna()<font></font>
print(df_from_csv)<font></font>
<font></font>
<span class="hljs-comment">#    Excel-   UI  -,</span>
<span class="hljs-comment">#       </span>
<span class="hljs-comment"># (        )</span>
file_excel = <span class="hljs-string">'report_UI.xlsx'</span>
df_from_excel = pd.ExcelFile(file_excel).parse(<span class="hljs-string">'1'</span>)<font></font>
print(df_from_excel)<font></font>
<font></font>
<span class="hljs-comment">#  -     - </span>
<span class="hljs-comment"># -       UI</span>
<span class="hljs-comment"># (   outer join  SQL)</span>
df = df_from_csv.merge(df_from_excel, left_on=<span class="hljs-string">'id'</span>, right_on=<span class="hljs-string">""</span>, how=<span class="hljs-string">'outer'</span>)<font></font>
print(df)<font></font>
<font></font>
<span class="hljs-comment">#     Excel-</span>
writer = pd.ExcelWriter(<span class="hljs-string">'.xlsx'</span>)<font></font>
df.to_excel(writer, <span class="hljs-string">'1'</span>)<font></font>
writer.save()<font></font>
</code></pre><br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limitations:</font></font></u><br>
<br>
<ul>
<li>               (  ,       30 000 ).</li>
<li>   (  Excel)  /           ,            .</li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scenario No. 2</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
The section contains data in the form of a table for certain objects from a single source. The system will receive data from a second source (integration) and update the existing table data with this data. Each record in the table is data for one object that has a unique identifier. If from a new source the data of an object by identifier coincides with the data of an existing object, then all fields of an existing record are updated with data from a new source (confirmed). If the table does not yet have an object with an identifier from the second source, then a new record is created in the table with data from the new source. Data from the second system can be uploaded to a json file in advance. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The task of the tester:</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prepare a file with data for the test in advance, in order to verify that the existing records are updated correctly and they are affixed with a confirmation sign in the database if there is a match by identifier, and new records are correctly created and they are marked with the sign of adding to the database if records with such the identifier was not yet. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We compose a script for the script:</font></font></u><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We upload the data from the partition table to the Excel file on the UI (if this is not possible, you can always export the data from the result of the SQL query used in the code to output data to this table on the UI) and fill the data from it into the first data frame .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We get the json file with data from the second source and load it into the second data frame.</font></font></li>
<li>  (merge ‚Äî    outer join  SQL)    -    -          Excel-,        .      ,        ,      .</li>
</ul><br>
<u>:</u><br>
<br>
<ul>
<li>               (  ,       30 000 ).</li>
<li>  json-     /  ‚Äì           /,    -   json-   pandas        /.</li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scenario 3</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
A request is made to the system API, in response to which data on objects in json format is received. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tester's task:</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Compare the data from the response to the request to the API with the data from the result of the SQL query in the database. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We compose a script for the script:</font></font></u><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We execute the SQL query in the database, export the data from the query result to a csv file, load this data into the first data frame.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We save the data from the response to the request to the API in the json file, load the data from the file into the second data frame.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We combine the data (merge - by analogy with outer join in SQL) from two received data frames into one new data frame by a unique identifier and unload the data from it into an Excel file, in which we will already compare data by columns using the functions of Excel</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Or the data on the columns in the general data frame can be compared using pandas, while unloading the rows with the same / different data in the columns into a new data frame / Excel file for analysis.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example data from </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example3_csv.csv</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zx/e6/xz/zxe6xzjff9vbfwgntsfqb-qyykc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example data from </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example3_json.json</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="json hljs">[<font></font>
    {<font></font>
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"16421118-4116"</span>,
        <span class="hljs-attr">"name_json"</span>: <span class="hljs-string">"Tempor Consulting"</span>,
        <span class="hljs-attr">"email_json"</span>: <span class="hljs-string">"Nullam.lobortis.quam@***"</span>,
        <span class="hljs-attr">"tel_json"</span>: <span class="hljs-string">"1-821-805-****"</span>,
        <span class="hljs-attr">"reg_date_json"</span>: <span class="hljs-string">"12-11-16"</span>,
        <span class="hljs-attr">"city_json"</span>: <span class="hljs-string">"Natales"</span><font></font>
    },<font></font>
    {<font></font>
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"16040210-2206"</span>,
        <span class="hljs-attr">"name_json"</span>: <span class="hljs-string">"Odio Etiam Incorporated"</span>,
        <span class="hljs-attr">"email_json"</span>: <span class="hljs-string">"arcu@***"</span>,
        <span class="hljs-attr">"tel_json"</span>: <span class="hljs-string">"1-730-291-****"</span>,
        <span class="hljs-attr">"reg_date_json"</span>: <span class="hljs-string">"26-06-05"</span>,
        <span class="hljs-attr">"city_json"</span>: <span class="hljs-string">"Viddalba"</span><font></font>
    },<font></font>
...<font></font>
]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The python script looks like this:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#   pandas</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
<font></font>
<span class="hljs-comment">#    csv-  -</span>
<span class="hljs-comment"># (        )</span>
<span class="hljs-comment">#       csv-     ";"</span>
df_from_csv = pd.read_csv(<span class="hljs-string">'./example3_csv.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>)<font></font>
print(df_from_csv)<font></font>
<font></font>
<span class="hljs-comment">#    json-  -</span>
<span class="hljs-comment"># (        )</span>
df_from_json = pd.read_json(<span class="hljs-string">'./example3_json.json'</span>, encoding=<span class="hljs-string">'utf-8'</span>)<font></font>
print(df_from_json)<font></font>
<font></font>
<span class="hljs-comment">#  -    -</span>
<span class="hljs-comment"># (   outer join  SQL)</span>
df_csv_json = df_from_csv.merge(df_from_json, left_on=<span class="hljs-string">'id'</span>, <font></font>
                                right_on=<span class="hljs-string">"id"</span>, how=<span class="hljs-string">'outer'</span>)<font></font>
print(df_csv_json)<font></font>
<font></font>
<span class="hljs-comment">#    Excel-,   ,</span>
<span class="hljs-comment">#      -   ,</span>
<span class="hljs-comment">#          </span>
<span class="hljs-comment"># (      )</span>
<span class="hljs-comment"># writer = pd.ExcelWriter('.xlsx')</span>
<span class="hljs-comment"># df_csv_json.to_excel(writer, '1')</span>
<span class="hljs-comment"># writer.save()</span><font></font>
<font></font>
<span class="hljs-comment">#       </span>
<span class="hljs-comment"># (, name_csv  name_json) </span>
<span class="hljs-comment">#       Excel-  </span>
<span class="hljs-comment"># (        )</span>
unequal_data_df = df_csv_json.loc[df_csv_json[<span class="hljs-string">'name_csv'</span>] != <font></font>
                                  df_csv_json[<span class="hljs-string">'name_json'</span>]]<font></font>
unequal_data_df = unequal_data_df[[<span class="hljs-string">'id'</span>, <span class="hljs-string">'name_csv'</span>, <span class="hljs-string">'name_json'</span>]]<font></font>
print(unequal_data_df)<font></font>
<font></font>
writer = pd.ExcelWriter(<span class="hljs-string">'_name.xlsx'</span>)<font></font>
unequal_data_df.to_excel(writer, <span class="hljs-string">'1'</span>)<font></font>
writer.save()<font></font>
<font></font>
</code></pre><br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limitations:</font></font></u><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When working with files with a very large number of lines, you will have to break them into separate files (here you need to try, I rarely have files over 30,000 lines).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If there are several levels of nesting of objects / data arrays in the json file, then from the internal levels they will be loaded into the cell as an object / array, therefore working with json files with pandas is convenient only for data without excessive nesting of objects / arrays.</font></font></li>
<li>       API         SQL-  ,             SQL-   .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the response to the request to the API comes in xml format, then you will first need to parse the necessary data from the xml file using ElementTree or another library and then load it into the data frame. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scenario No. 4</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
On the UI an xml-file with data on objects is downloaded, which is generated on the fly from data in the database subject to certain conditions (for example, statuses, dates, years or other parameter values ‚Äã‚Äãfor objects are taken into account). </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tester's task:</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Compare the unique identifiers id of the objects from the xml file that are in the attribute of the company tag with the identifiers of the objects from the result of the SQL query in the database. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We compose a script for the script:</font></font></u><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We save the data from the response to the request to the API in the xml-file, get the necessary data from this file using the ElementTree library, load the data into the first data frame.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We execute the SQL query in the database, export the data from the query result to the csv file, load this data into the second data frame.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We merge the data (merge - similar to outer join in SQL) from two received data frames into one new data frame by a unique identifier and unload the data from it into an Excel file.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next, open the resulting file and analyze the data lines.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example data from </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example4_csv.csv</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gb/zk/ou/gbzkou2bivh2gsnk6do0lthh1_g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example data from </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example4_xml.xml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">: A </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zh/x4/no/zhx4noe3virrsagqnaduwpqyp_w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
python script looks like this:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#   ElementTree</span>
<span class="hljs-keyword">from</span> xml.etree <span class="hljs-keyword">import</span> ElementTree
<span class="hljs-comment">#   pandas</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
<font></font>
<span class="hljs-comment">#    xml-   </span>
<span class="hljs-comment"># (        )</span>
tree = ElementTree.parse(<span class="hljs-string">"example4_xml.xml"</span>)<font></font>
<font></font>
<span class="hljs-comment">#   </span><font></font>
root = tree.getroot()<font></font>
<font></font>
<span class="hljs-comment">#  ,     </span><font></font>
data_list = []<font></font>
i = <span class="hljs-number">1</span><font></font>
<font></font>
<span class="hljs-comment">#    -   id_type1  id_type2</span>
<span class="hljs-keyword">for</span> child <span class="hljs-keyword">in</span> root.iter(<span class="hljs-string">"companies"</span>):
    <span class="hljs-keyword">for</span> child_1 <span class="hljs-keyword">in</span> child.iter(<span class="hljs-string">"company"</span>):<font></font>
            data_list.append({<span class="hljs-string">""</span>: i, <span class="hljs-string">"id"</span>: child_1.get(<span class="hljs-string">"id_type1"</span>)
                                                <span class="hljs-keyword">or</span> child_1.get(<span class="hljs-string">"id_type2"</span>), 
                              <span class="hljs-string">"  xml"</span>: <span class="hljs-string">""</span>})<font></font>
            i += <span class="hljs-number">1</span><font></font>
<font></font>
<span class="hljs-comment">#     data_list  -</span>
df_from_xml = pd.DataFrame.from_dict(data_list, orient=<span class="hljs-string">'columns'</span>)<font></font>
print(df_from_xml)<font></font>
<font></font>
<span class="hljs-comment">#    csv-  -</span>
df_from_csv = pd.read_csv(<span class="hljs-string">'./example4_csv.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>)<font></font>
print(df_from_csv)<font></font>
<font></font>
<span class="hljs-comment">#  -   -</span>
<span class="hljs-comment"># (   outer join  SQL)</span>
df = df_from_csv.merge(df_from_xml, left_on=<span class="hljs-string">'id'</span>, right_on=<span class="hljs-string">"id"</span>, how=<span class="hljs-string">'outer'</span>)<font></font>
print(df)<font></font>
<font></font>
<span class="hljs-comment">#    Excel-</span>
<span class="hljs-comment">#          </span>
<span class="hljs-comment"># (      )</span>
writer = pd.ExcelWriter(<span class="hljs-string">'.xlsx'</span>)<font></font>
df.to_excel(writer, <span class="hljs-string">'1'</span>)<font></font>
writer.save()<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scenario 5</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
At the UI, the section displays data on objects in the form of a table. </font><font style="vertical-align: inherit;">It is possible to upload data to an Excel file. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The task of the tester:</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Compare the data from the partition table with the data that is downloaded to the Excel file. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We compose a script for the script:</font></font></u><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We ask developers for an SQL query in the database from the code that is responsible for outputting data to the partition table on the UI.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We execute this SQL-query in the database, upload the data to a csv file, load the data from it into the first data frame.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We upload the data from the partition table to the Excel file on the UI and load the data from it into the second data frame.</font></font></li>
<li>  (merge ‚Äî    outer join  SQL)    -    -          Excel-,             Excel.</li>
<li>      -     pandas,      /      -/Excel-  .</li>
</ul><br>
<u>:</u><br>
<br>
<ul>
<li>    ,     Excel-  UI, ,         ,          .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also, similar scripts can be used simply to transfer data from json-files or csv-files to Excel-files. </font><font style="vertical-align: inherit;">Or, you can combine data from several Excel files in certain columns and upload them into one new Excel file.</font></font><br>
<br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
These are just a few examples of how you can use python + pandas to speed up the testing process and find bugs. </font><font style="vertical-align: inherit;">In fact, pandas has much more opportunities for working with data, you can read more about this in the documentation for this library. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perhaps your project has other options for using such scripts and this article will help you begin to use them in the work of testers.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/en486756/">https://habr.com/ru/post/en486756/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en486744/index.html">A smart domestic-made posture corrector went on sale. We looked at the new product - IBACK</a></li>
<li><a href="../en486746/index.html">Write, do not cut. What I began to miss in Habr's publications</a></li>
<li><a href="../en486750/index.html">The series "For All Mankind": from an alternative story to trash</a></li>
<li><a href="../en486752/index.html">Unique WSGI web server using ESP8266. Part 1</a></li>
<li><a href="../en486754/index.html">JIRA: rules for the timely preparation of delicious software. TLDR 2: requirements management</a></li>
<li><a href="../en486760/index.html">Security Week 06: advertising trackers in mobile applications</a></li>
<li><a href="../en486762/index.html">Bedside hosting: the creepy practice of home hosting</a></li>
<li><a href="../en486764/index.html">Do-it-yourself Schema.org: customizing micro-layout without a programmer</a></li>
<li><a href="../en486766/index.html">How to transfer all transactions online in the archaic factoring market? Experience of Sberbank Factoring</a></li>
<li><a href="../en486768/index.html">Revision of the Webasyst admin panel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>