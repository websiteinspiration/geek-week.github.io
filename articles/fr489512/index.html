<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§µüèø ü§≥üèø üë©‚ÄçüöÄ Battement. BlOC, fournisseur, async - Shelf Architecture üßí üëå ü§öüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="introduction
 Lorsque vous essayez d'√©crire une application, la premi√®re chose que vous rencontrez est de savoir comment organiser l'architecture de l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Battement. BlOC, fournisseur, async - Shelf Architecture</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489512/"><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">introduction</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous essayez d'√©crire une application, la premi√®re chose que vous rencontrez est de savoir comment organiser l'architecture de l'application. </font><font style="vertical-align: inherit;">Et en ce qui concerne Flutter, la t√™te peut compl√®tement contourner ce que Google donne - Vanilla, Scoped Model, BLoC, MVP, MVC, MVVM, MVI, etc. </font><font style="vertical-align: inherit;">Supposons que vous d√©cidiez d'aller de la mani√®re la plus √† la mode (celle que Google a conseill√© en 2018) et d'utiliser BLOC. </font><font style="vertical-align: inherit;">Qu'Est-ce que c'est? </font><font style="vertical-align: inherit;">Comment l'utiliser? </font><font style="vertical-align: inherit;">Ou peut-√™tre Redux ou RxDart? </font><font style="vertical-align: inherit;">- bien que l'arr√™t concerne ¬´l'autre¬ª ... Mais quoi de neuf? </font><font style="vertical-align: inherit;">Quelles biblioth√®ques connecter? </font><font style="vertical-align: inherit;">Bloc, Flutter_bloc, bloc_pattern, etc.? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un tel nombre d'options d'architecture et d'outils pour leur mise en ≈ìuvre peut vraiment retarder longtemps la phase de s√©lection.</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour qui l'article</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'article sera principalement utile √† ceux qui commencent tout juste √† apprendre Flutter et ne savent pas par o√π commencer. </font><font style="vertical-align: inherit;">Je vais montrer une des options pour impl√©menter l'application sur Flutter. </font><font style="vertical-align: inherit;">Cela vous permettra de ¬´sentir¬ª Flutter, puis de d√©cider par vous-m√™me comment et √† l'aide de quoi vous allez √©crire vos applications.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mod√®les et outils. </font><font style="vertical-align: inherit;">Bref et simple</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Commen√ßons donc. La premi√®re chose √† noter est qu'il existe une architecture d'application (mod√®le, mod√®le, concept de construction) - c'est exactement la m√™me chose: BLoC, MVP, MVC, MVVM, MVI, etc. Beaucoup de ces architectures sont utilis√©es non seulement dans Flutter, mais aussi dans d'autres langages de programmation. Question - que choisir? √Ä mon avis, vous devez choisir ce que vous connaissez bien, mais seulement si cela implique une r√©activit√© et une s√©paration stricte de la logique m√©tier de l'interface (oui, oui - ¬´une voiture peut √™tre de n'importe quelle couleur si elle est noire¬ª). Quant √† la s√©paration de l'interface et de la logique m√©tier, je pense qu'il n'y a pas lieu d'expliquer, mais quant √† la r√©activit√© - essayez, si vous n'avez pas essay√© - au final c'est vraiment tr√®s pratique et ¬´beau¬ª. Si vous ne pouvez pas le choisir vous-m√™me, alors laissez-le faire pour nous par les gars les plus stupides de Google - BLOC. Nous avons compris l'architecture.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, les outils - il y a des biblioth√®ques pr√™tes √† l'emploi - Bloc, Flutter_bloc, bloc_pattern - quel est le meilleur? Je ne sais pas - tout le monde est bon. Vous pouvez choisir et comparer pendant longtemps, mais l√† encore, comme dans l'arm√©e - il vaut mieux prendre une mauvaise d√©cision pour l'instant que de ne pas en prendre. Et pour l'instant, je sugg√®re de revenir dans le sillage du mod et d'utiliser Provider (ce que les m√™mes gars recommandent d'utiliser en 2019).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout cela nous permettra de faire √† la fois bloc global et bloc local, selon les besoins. </font><font style="vertical-align: inherit;">Beaucoup a √©t√© √©crit sur l'architecture de BLoC (√† savoir un mod√®le, pas des biblioth√®ques), je pense que vous ne devriez pas vous y attarder en d√©tail. </font><font style="vertical-align: inherit;">Je note un seul point dans cet article, le BLoC classique ne sera pas utilis√©, mais l√©g√®rement modifi√© - dans les actions BLoC (√©v√©nements) ne seront pas transmises via Sinks, mais les fonctions BLoC seront appel√©es. </font><font style="vertical-align: inherit;">Simplement, pour le moment, je ne vois pas les avantages d'utiliser des √©viers - et comme ils ne sont pas l√†, alors pourquoi compliquer votre vie?</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calcul asynchrone et parall√®le dans Dart</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela vaut √©galement la peine de clarifier le concept d'asynchronie dans Dart, car nous parlons de r√©activit√©. Tr√®s souvent, aux premiers stades de la connaissance de Dart, la signification des fonctions asynchrones (async) n'est pas correctement comprise. Vous devez toujours vous rappeler que ¬´par d√©faut¬ª, le programme s'ex√©cute dans un seul thread, et l'asynchronie vous permet uniquement de modifier la s√©quence de commandes, plut√¥t que de les ex√©cuter en parall√®le. Autrement dit, si vous ex√©cutez simplement la fonction avec des calculs volumineux simplement en la marquant comme asynchrone, l'interface sera bloqu√©e. Async ne d√©marre PAS un nouveau thread. Comment asynchroniser et attendre le travail, il y a beaucoup d'informations sur Internet, donc je ne m'attarderai pas l√†-dessus non plus.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous devez faire de gros calculs et en m√™me temps ne pas bloquer l'interface, vous devez utiliser la fonction de calcul (pour le hardcore sp√©cial, vous pouvez utiliser des isolats). </font><font style="vertical-align: inherit;">Cela va vraiment d√©marrer un thread d'ex√©cution s√©par√©, qui aura √©galement sa propre zone de m√©moire s√©par√©e (ce qui est tr√®s triste et triste). </font><font style="vertical-align: inherit;">Vous ne pouvez communiquer avec de tels flux que par le biais de messages pouvant contenir des types de donn√©es simples, leurs listes.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mettons-nous √† la pratique</font></font></h1><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formulation du probl√®me</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essayons d'√©crire l'application la plus simple - que ce soit une sorte d'annuaire t√©l√©phonique. </font><font style="vertical-align: inherit;">Nous utiliserons Firebase comme stockage - cela nous permettra de cr√©er une application "cloud". </font><font style="vertical-align: inherit;">Je vais ignorer comment connecter Firebase au projet (plus d'un article a √©t√© √©crit sur ce sujet et je ne vois pas l'int√©r√™t de le r√©p√©ter. Remarque: Cloud Firestore est utilis√© dans ce projet.). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela devrait √™tre comme ceci:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xy/yj/js/xyyjjsknqbe1owqlc1vnbnec-pu.gif"><br>
<br>
<h1> <br>
</h1><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description de l'application</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre application contiendra en externe:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fen√™tre d'autorisation Firebase (la logique de cette fen√™tre sera contenue dans MainBloc).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fen√™tre d'information - affichera des informations sur l'utilisateur sous lequel le programme est autoris√© (la logique de cette fen√™tre sera √©galement contenue dans MainBloc).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fen√™tre de r√©pertoire sous la forme d'une liste de t√©l√©phones (la logique de cette fen√™tre sera contenue dans un PhonebookBloc s√©par√©).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menu d'application qui changera d'√©cran.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'application interne sera construite comme suit: chaque √©cran contiendra un fichier avec des widgets d'√©cran, un fichier de bloc (avec la classe de bloc correspondante), un fichier d'actions (contient des classes simples d√©crivant les √©v√©nements qui affectent l'√©tat du bloc), un fichier d'√©tats (contient des classes simples qui refl√®tent l'√©tat du bloc ), le fichier data_model contenant la classe de r√©f√©rentiel (responsable de la r√©ception des donn√©es) et la classe de donn√©es (stocke les donn√©es de logique m√©tier de bloc).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'application fonctionnera comme ceci - lorsque l'√©cran est ouvert, le bloc correspondant est initialis√© avec la valeur d'√©tat initiale et, si n√©cessaire, une action initiale est appel√©e dans le constructeur de bloc. </font><font style="vertical-align: inherit;">L'√©cran est construit / reconstruit en fonction de l'√©tat, qui renvoie le bloc. </font><font style="vertical-align: inherit;">L'utilisateur effectue certaines actions dans l'application qui ont des actions correspondantes. </font><font style="vertical-align: inherit;">Les actions sont transmises √† la classe de bloc, o√π elles sont trait√©es dans la fonction mapEventToState et le bloc renvoie le nouvel √©tat √† l'√©cran, en fonction duquel l'√©cran est reconstruit.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Structure des fichiers</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, nous cr√©ons un projet Flutter vide et cr√©ons la structure du projet de ce type (je note que dans le projet de d√©monstration, certains fichiers resteront √©ventuellement vides):</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h8/r5/5j/h8r55j-7shyieywjwqkpkj-lwxi.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fen√™tre d'autorisation. </font><font style="vertical-align: inherit;">Mainbloc</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous devez maintenant impl√©menter l'autorisation dans Firebase. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Commen√ßons par cr√©er des classes d'√©v√©nements (il est pratique de transf√©rer des donn√©es via des √©v√©nements en bloc) et des √©tats pour le bloc principal: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fichier MainBloc \ actions</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainBlocAction</span></span>{<font></font>
  String get password =&gt; <span class="hljs-keyword">null</span>;<font></font>
  String get email =&gt; <span class="hljs-keyword">null</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fichier MainBloc \ states</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainBlocState</span></span>{<font></font>
  bool busy;<font></font>
  MainBlocState({<span class="hljs-keyword">this</span>.busy = <span class="hljs-keyword">false</span>});<font></font>
  copy(bool busy) {<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'indicateur occup√© dans la classe d'√©tat est utilis√© pour afficher progress_hud dans l'interface et exclure les lectures de donn√©es inutiles de la base de donn√©es lors du d√©filement dans la liste. </font><font style="vertical-align: inherit;">Avant que toutes les op√©rations du bloc ne commencent, un nouvel √©tat de l'ancien type avec l'indicateur occup√© est √©mis vers le flux de sortie - de cette fa√ßon, l'interface re√ßoit une notification indiquant que l'op√©ration a commenc√©. </font><font style="vertical-align: inherit;">√Ä la fin de l'op√©ration, un nouvel √©tat est envoy√© au flux avec l'indicateur occup√© effac√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les h√©ritiers de la classe MainBlocState d√©crivent l'√©tat du bloc d'application principal. </font><font style="vertical-align: inherit;">Les h√©ritiers de MainBlocAction d√©crivent les √©v√©nements qui s'y produisent.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La classe MainBloc contient 4 √©l√©ments principaux - la fonction de "conversion" des √©v√©nements en √©tats (Future mapEventToState), l'√©tat Bloc est _blocState, le r√©f√©rentiel d'√©tat de bloc est le repo et le flux d'√©tat "de sortie" (dont les √©l√©ments d'interface suivent) est blocStream. Fondamentalement, ce sont tous des √©l√©ments qui fournissent une fonctionnalit√© bloc-a. Parfois, il est conseill√© d'utiliser 2 flux de sortie dans un bloc - un tel exemple sera plus faible. Je ne l'√©num√©rerai pas ici - vous pouvez le voir en t√©l√©chargeant le projet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La classe de r√©f√©rentiel de bloc contient la logique de travail avec Firebase et un objet (donn√©es) qui stocke les donn√©es n√©cessaires √† la logique m√©tier que ce bloc impl√©mente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fichier MainBloc \ data_model</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainRepo</span></span>{<font></font>
<font></font>
  <span class="hljs-keyword">final</span> MainData data = MainData();<font></font>
<font></font>
  FirebaseAuth get firebaseInst =&gt; MainData.firebaseInst;<font></font>
<font></font>
  FirebaseUser _currentUser;<font></font>
<font></font>
  <span class="hljs-function">Future&lt;bool&gt; <span class="hljs-title">createUserWithEmailAndPassword</span><span class="hljs-params">(
      String email, String password)</span> async </span>{
    <span class="hljs-keyword">var</span> dataUser;
      <span class="hljs-keyword">try</span> {<font></font>
        dataUser =<font></font>
            (await firebaseInst.createUserWithEmailAndPassword(<font></font>
                email: email, password: password))<font></font>
                .user;<font></font>
      } <span class="hljs-keyword">catch</span> (e) {<font></font>
        print(Error.safeToString(e));<font></font>
        print(e.code);<font></font>
        print(e.message);<font></font>
      }<font></font>
      <span class="hljs-keyword">if</span> (dataUser == <span class="hljs-keyword">null</span>){<font></font>
        data.setState(IsNotLogged());<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<font></font>
      }<font></font>
<font></font>
      _currentUser = dataUser;<font></font>
      data.setState(IsLogged(),<font></font>
          uid: _currentUser.uid,<font></font>
          email: _currentUser.email);<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<font></font>
  }<font></font>
<font></font>
  ...}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainData</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> firebaseInst = FirebaseAuth.instance;
  <span class="hljs-keyword">static</span> MainBlocState _authState = IsNotLogged();
  <span class="hljs-keyword">static</span> MainBlocState get authState =&gt; _authState;
  <span class="hljs-keyword">static</span> String _uid;
  <span class="hljs-keyword">static</span> String get uid =&gt; _uid;
  <span class="hljs-keyword">static</span> String _email;
  <span class="hljs-keyword">static</span> String get email =&gt; _email;<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setState</span><span class="hljs-params">(MainBlocState newState,
      {String uid = <span class="hljs-string">''</span>, String email = <span class="hljs-string">''</span>})</span> </span>{<font></font>
    _authState = newState;<font></font>
    _uid = uid;<font></font>
    _email = email;<font></font>
  }<font></font>
}<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La classe MainData stocke √©galement l'√©tat, mais l'√©tat d'autorisation dans Firebase, et non l'√©tat Bloc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons √©crit la logique du bloc principal, maintenant nous pouvons commencer √† impl√©menter l'√©cran d'autorisation / enregistrement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MainBloc est initialis√© dans le fichier principal: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le fichier principal</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-comment">// This widget is the root of your application.</span>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function">Widget <span class="hljs-title">build</span><span class="hljs-params">(BuildContext context)</span> </span>{
    <span class="hljs-keyword">return</span> Provider(<font></font>
        create: (context) =&gt; MainBloc(),<font></font>
        dispose: (context, value) =&gt; value.dispose(),<font></font>
        child: MaterialApp(<font></font>
          routes: menuRoutes,<font></font>
        ));<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est temps de faire une petite digression sur StreamBuilder, Provider, StreamProvider, Consumer et Selector.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Retraite sur les fournisseurs</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fournisseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - transf√®re uniquement la valeur stock√©e dans l'arborescence. Et vous ne pouvez y acc√©der qu'apr√®s la g√©n√©ration de l'enfant, c'est-√†-dire vous devez cr√©er un sous-widget. Pas responsable de la mise √† jour des widgets. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StreamBuilder</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - un widget qui surveille le flux et est compl√®tement reconstruit lorsqu'il </font><b><font style="vertical-align: inherit;">re√ßoit un</font></b><font style="vertical-align: inherit;"> nouvel objet du flux. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StreamProvider</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - un widget qui surveille le flux et lorsqu'un nouvel objet est re√ßu, il signale que les widgets enfants (ceux qui sont d√©clar√©s en tant que classe distincte avec la m√©thode de construction) doivent √™tre reconstruits. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consumer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selector</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sont des ¬´sucres syntaxiques¬ª, c'est-√†-dire il s'agit en fait d'un ¬´wrapper¬ª qui contient la construction et masque le widget en dessous. Dans Selector-e, vous pouvez effectuer un filtrage suppl√©mentaire des mises √† jour.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, lorsque vous devez reconstruire la plupart de l'√©cran √† chaque √©v√©nement, vous pouvez utiliser l'option avec Provider et StreamBuilder. </font><font style="vertical-align: inherit;">Lorsqu'il est n√©cessaire de reconstruire des parties de l'arborescence des widgets pr√®s des feuilles, il est conseill√© d'utiliser StreamProvider en combinaison avec Consumer et Selector pour exclure les reconstructions inutiles de l'arborescence.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autorisation </font><font style="vertical-align: inherit;">Continuation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors de la saisie de l'application, l'utilisateur doit acc√©der √† la fen√™tre d'autorisation / d'enregistrement, et √† ce moment le menu de l'application ne devrait pas encore √™tre disponible pour lui. Le deuxi√®me point - pour rafra√Æchir partiellement cet √©cran n'a pas beaucoup de sens, nous pouvons donc utiliser StreamBuilder pour construire l'interface. Et le troisi√®me point du projet utilise Navigator pour naviguer entre les √©crans. Lors de la r√©ception d'un √©v√©nement d'autorisation r√©ussie, il est n√©cessaire d'appeler la transition vers l'√©cran d'informations. Mais juste √† l'int√©rieur de Build StreamBuilder, cela ne fonctionnera pas - il y aura une erreur. Pour contourner ce probl√®me, vous pouvez utiliser la classe wrapper auxiliaire StreamBuilderWithListener (Eugene Brusov - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stackoverflow.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, la liste de cet √©cran est auth_screen lui-m√™me (je vais donner ici en partie): </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fichier auth_screen</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">Widget <span class="hljs-title">build</span><span class="hljs-params">(BuildContext context)</span> </span>{
  <span class="hljs-keyword">var</span> bloc = Provider.of&lt;MainBloc&gt;(context, listen: <span class="hljs-keyword">false</span>);
  <span class="hljs-keyword">return</span> StreamBuilderWithListener&lt;MainBlocState&gt;(<font></font>
      stream: bloc.blocStream.stream,<font></font>
      listener: (value) {<font></font>
        <span class="hljs-comment">//not allowed call navigator push in build</span>
        <span class="hljs-keyword">if</span> (value is IsLogged) {<font></font>
          Navigator.of(context).pushReplacementNamed(InfoScreen.nameMenuItem);<font></font>
        }<font></font>
      },<font></font>
      initialData: bloc.state,<font></font>
      builder: (context, snappShot) {<font></font>
        <span class="hljs-keyword">if</span> (snappShot.data is IsLoggedOnStart) {
          <span class="hljs-keyword">return</span> LoggedWidget();<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (snappShot.data is IsLogged) {
          <span class="hljs-comment">//not allowed call navigator push in build</span>
          <span class="hljs-keyword">return</span> ModalProgressHUD(<font></font>
              inAsyncCall: <span class="hljs-keyword">true</span>,<font></font>
          child: Text(<span class="hljs-string">''</span>),);<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (snappShot.data is IsNotLogged) {
          <span class="hljs-keyword">return</span> SignInAndSignUpWidget();<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> Scaffold(body: Text(<span class="hljs-string">"                Unknown event"</span>));<font></font>
      });<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, un StreamBuilderWithListener est cr√©√© pour √©couter le flux depuis le bloc. </font><font style="vertical-align: inherit;">Et en fonction de l'√©tat actuel, le widget LoggedWidget (si l'utilisateur est d√©j√† connect√©) ou SignInAndSignUpWidget (si l'utilisateur n'est pas encore connect√©) est appel√©. </font><font style="vertical-align: inherit;">Si bloc renvoie l'√©tat IsLogged, le basculement vers un nouvel √©cran √† l'aide de Navigator ne se produit pas dans le g√©n√©rateur (ce qui entra√Ænerait une erreur), mais dans l'√©couteur. </font><font style="vertical-align: inherit;">Dans les widgets sous-jacents, l'interface est construite sur la base des donn√©es renvoy√©es ici. </font><font style="vertical-align: inherit;">Ici, le bundle Provider + StreamBuilder est r√©ellement utilis√©, car </font><font style="vertical-align: inherit;">lorsque l'√©tat du bloc change, pratiquement toute l'interface change. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour transf√©rer des donn√©es vers un bloc, TextEditingController et les param√®tres d'action sont utilis√©s: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fichier auth_screen</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_SignUpWidgetWidgetState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span> </span>{<font></font>
  String _email, _password;<font></font>
<font></font>
  <span class="hljs-keyword">final</span> TextEditingController _emailController = TextEditingController();
  <span class="hljs-keyword">final</span> TextEditingController _passwordController = TextEditingController();<font></font>
<font></font>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">initState</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">super</span>.initState();<font></font>
    _emailController.addListener(_onEmailChanged);<font></font>
    _passwordController.addListener(_onPasswordChanged);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function">Widget <span class="hljs-title">build</span><span class="hljs-params">(BuildContext context)</span> </span>{
    <span class="hljs-keyword">return</span> Column(<font></font>
      children: &lt;Widget&gt;[<font></font>
        TextFormField(<font></font>
          controller: _emailController,<font></font>
          decoration: InputDecoration(<font></font>
              labelText: <span class="hljs-string">'email'</span>),<font></font>
        ),<font></font>
        TextFormField(<font></font>
          controller: _passwordController,<font></font>
          obscureText: <span class="hljs-keyword">true</span>,<font></font>
          decoration: InputDecoration(<font></font>
              labelText: <span class="hljs-string">'password'</span>),<font></font>
        ),<font></font>
        RaisedButton(<font></font>
            child: Text(<span class="hljs-string">'sign up'</span>),<font></font>
            onPressed: () {<font></font>
              Provider.of&lt;MainBloc&gt;(context, listen: <span class="hljs-keyword">false</span>).mapEventToState(<font></font>
                  Registration(_email, _password));<font></font>
            })<font></font>
      ],<font></font>
    );<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dispose</span><span class="hljs-params">()</span> </span>{<font></font>
    _emailController.dispose();<font></font>
    _passwordController.dispose();<font></font>
    <span class="hljs-keyword">super</span>.dispose();<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">_onEmailChanged</span><span class="hljs-params">()</span> </span>{<font></font>
    _email = _emailController.text;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">_onPasswordChanged</span><span class="hljs-params">()</span> </span>{<font></font>
    _password = _passwordController.text;<font></font>
  }<font></font>
}<font></font>
 <font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fen√™tre PhoneBookScreen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et maintenant, parlons un peu de notre fen√™tre PhoneBookScreen. C'est la fen√™tre la plus int√©ressante - ici l'interface est construite sur la base de 2 flux de bloc, et il y a aussi une liste avec d√©filement et pagination (pagination). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PhonebookScreen \ screen File</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PhonebookTopPart</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{<font></font>
<font></font>
  <span class="hljs-function">StatefulWidget <span class="hljs-title">caseWidget</span><span class="hljs-params">(PhonebookState state)</span> </span>{
    <span class="hljs-keyword">if</span> (state is PhonebookListOpened) {
      <span class="hljs-keyword">return</span> PhonebookList();
    <span class="hljs-comment">//} else if (data is PhonebookCardToViewOpened) {</span>
    }<span class="hljs-keyword">else</span> ModalProgressHUD(<font></font>
      inAsyncCall: <span class="hljs-keyword">true</span>,<font></font>
      child: Text(<span class="hljs-string">''</span>),);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function">Widget <span class="hljs-title">build</span><span class="hljs-params">(BuildContext context)</span> </span>{
    <span class="hljs-keyword">var</span> bloc = Provider.of&lt;PhonebookBloc&gt;(context, listen: <span class="hljs-keyword">false</span>);
    <span class="hljs-keyword">return</span> StreamProvider&lt;PhonebookState&gt;(<font></font>
        create: (context) =&gt; bloc.blocStream.stream,<font></font>
        initialData: bloc.state,<font></font>
        child: Selector&lt;PhonebookState,PhonebookState&gt;(<font></font>
            selector: (_,state)=&gt;state,<font></font>
            shouldRebuild: (previous, next){<span class="hljs-keyword">return</span> (previous.runtimeType!=next.runtimeType);},<font></font>
            builder: (_, state, __) { <span class="hljs-keyword">return</span> ModalProgressHUD(<font></font>
                inAsyncCall: state.busy,<font></font>
                child: Scaffold(<font></font>
                  appBar: AppBar(<font></font>
                    title: Text(<span class="hljs-string">"Phones list"</span>),<font></font>
                  ),<font></font>
                  drawer: MenuWidget(),<font></font>
                  body: caseWidget(state),<font></font>
                ));}<font></font>
        ));<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le premier StreamProvider est n√©cessaire pour basculer entre les diff√©rents √©crans du r√©pertoire - liste, carte de contact, carte de contact pour l'√©dition, etc. Le widget pour l'√©cran est s√©lectionn√© dans la fonction caseWidget (mais dans cet exemple, seule la vue de la liste est impl√©ment√©e - vous pouvez essayer d'impl√©menter la vue pour la carte de visite - c'est tr√®s simple et ce ne sera pas un mauvais d√©but.). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur cet √©cran, un tas de StreamProvider + Selector / Consumer est d√©j√† utilis√©, car il y a un d√©filement de la liste et il n'est pas conseill√© de reconstruire l'√©cran entier avec lui (c'est-√†-dire que la reconstruction des widgets provient du s√©lecteur / consommateur correspondant et plus bas dans l'arborescence). </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et voici l'impl√©mentation de la liste elle-m√™me: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PhonebookScreen \ screen file</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_PhonebookListState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">PhonebookList</span>&gt; </span>{<font></font>
  ScrollController _scrollController = ScrollController();<font></font>
<font></font>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">initState</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">super</span>.initState();<font></font>
    _scrollController.addListener(_scrollListener);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function">Widget <span class="hljs-title">build</span><span class="hljs-params">(BuildContext context)</span> </span>{
    <span class="hljs-keyword">var</span> bloc = Provider.of&lt;PhonebookBloc&gt;(context, listen: <span class="hljs-keyword">false</span>);
    <span class="hljs-keyword">var</span> list = bloc.repo.data.list;
    <span class="hljs-keyword">return</span> Container(<font></font>
        child: StreamProvider&lt;PhonebookState&gt;(<font></font>
            create: (context) =&gt; bloc.scrollStream.stream,<font></font>
            initialData: bloc.scrollState,<font></font>
            child: Consumer&lt;PhonebookState&gt;(<font></font>
              builder: (_, state, __) {<font></font>
                <span class="hljs-keyword">return</span> ListView.builder(<font></font>
                    controller: _scrollController,<font></font>
                    itemCount: list.length,<font></font>
                    itemBuilder: (BuildContext context, <span class="hljs-keyword">int</span> index) {
                      <span class="hljs-keyword">return</span> ListTile(<font></font>
                        title: Text(list[index].data[<span class="hljs-string">'name'</span>]),<font></font>
                        subtitle: Text(list[index].data[<span class="hljs-string">'phone'</span>]),<font></font>
                      );<font></font>
                    });<font></font>
              },<font></font>
            )));<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">_scrollListener</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">double</span> delta = MediaQuery<font></font>
        .of(context)<font></font>
        .size<font></font>
        .height * <span class="hljs-number">3</span>;
    <span class="hljs-keyword">double</span> maxScroll = _scrollController.position.maxScrollExtent;
    <span class="hljs-keyword">double</span> currentScroll = _scrollController.position.pixels;
    <span class="hljs-keyword">if</span> (maxScroll - currentScroll &lt;= delta) {<font></font>
      Provider.of&lt;PhonebookBloc&gt;(context, listen: <span class="hljs-keyword">false</span>)<font></font>
          .mapEventToState(ScrollPhonebook());<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dispose</span><span class="hljs-params">()</span> </span>{<font></font>
    _scrollController.removeListener(_scrollListener);<font></font>
    <span class="hljs-keyword">super</span>.dispose();<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, nous voyons le deuxi√®me StreamProvider, qui surveille le deuxi√®me flux de bloc, qui est responsable du d√©filement. La pagination est organis√©e en standard via _scrollListener (contr√¥leur: _scrollController). Bien que la fen√™tre soit int√©ressante, mais √©tant donn√© la description d√©taill√©e de la premi√®re fen√™tre, il n'y a rien de plus √† dire ici. Par cons√©quent, c'est tout aujourd'hui.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'objectif de cet article n'√©tait pas de montrer le code parfait, c'est-√†-dire que vous pouvez trouver ici de nombreux points pour l'optimisation - correctement ¬´divis√©¬ª en fichiers, utilisez une instance, des mixins et similaires quelque part. </font><font style="vertical-align: inherit;">En outre, ce qui "supplie" la prochaine √©tape - vous pouvez cr√©er une carte de contact. </font><font style="vertical-align: inherit;">La t√¢che principale √©tait de structurer les connaissances, de d√©finir un certain vecteur pour la construction de l'application, de donner des explications sur certains moments de la conception d'une application sur Flutter qui n'√©taient pas tr√®s √©vidents aux premiers stades de la connaissance. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le projet peut √™tre t√©l√©charg√© √†</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (pour l'inscription, vous pouvez utiliser n'importe quel courrier avec un mot de passe d'au moins 6 caract√®res. Lors de la nouvelle autorisation, le mot de passe doit √™tre le m√™me que celui utilis√© lors de l'inscription).</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr489496/index.html">Recherche d'employ√©s et recherche d'emploi: ma vision de l'int√©rieur et de l'ext√©rieur</a></li>
<li><a href="../fr489500/index.html">√âvaluation des t√¢ches aux points d'histoire</a></li>
<li><a href="../fr489502/index.html">S√©l√©nium + AutoIT. Windows Test Automation Windows</a></li>
<li><a href="../fr489504/index.html">Comment commencer √† cr√©er une carte dans UE4</a></li>
<li><a href="../fr489510/index.html">Essayer de r√©soudre le probl√®me du choix des billets avant les vacances # 2</a></li>
<li><a href="../fr489514/index.html">T√©l√©chargez et stockez gratuitement des fichiers de toute taille sur Google Drive. Bug ou fonctionnalit√©?</a></li>
<li><a href="../fr489516/index.html">Friends React Native et Fastlane</a></li>
<li><a href="../fr489518/index.html">Les membres √©changent un √©change √† faible co√ªt aux √âtats-Unis</a></li>
<li><a href="../fr489526/index.html">Jeux √† somme nulle et conditions de Karush-Kun-Takker</a></li>
<li><a href="../fr489528/index.html">Vous ne regardez pas les publicit√©s pendant le d√©veloppement? D√©sordre</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>