<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍💼 🍇 👨🏾‍🏫 Monitoring all memory used by a webpage: performance.measureMemory () 👨🏾‍🚒 👍🏻 🆒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The author of the article, the translation of which we publish today, talks about how to monitor the memory allocated to web pages. Careful attention ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Monitoring all memory used by a webpage: performance.measureMemory ()</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/497986/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The author of the article, the translation of which we publish today, talks about how to monitor the memory allocated to web pages. </font><font style="vertical-align: inherit;">Careful attention to the memory of pages working in production helps maintain the productivity of web projects at a high level.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/uj/ux/6i/ujux6ittjoa4u5aoapnuhggx4ca.jpeg"></a><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Browsers automatically control the memory allocated to web pages. When a page creates an object, the browser, using its internal mechanisms, allocates memory to store this object. Since memory is not an infinite resource, the browser periodically performs garbage collection, during which unnecessary objects are detected and the memory they occupy is cleared. The process of detecting such objects, however, is not ideal. It </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">has</font></a><font style="vertical-align: inherit;"> been </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proven</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that absolutely accurate and complete identification of such objects is an insoluble task. As a result, browsers are replacing the idea of ​​finding “unnecessary objects” with the idea of ​​finding “unreachable objects”. If a web page cannot access the object through the variables it has and the fields of other objects accessible to it, this means that the browser can safely clear the memory occupied by such an object. The difference between “unnecessary” and “unreachable” leads to memory leaks, as illustrated in the following example:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> object = { <span class="hljs-attr">a</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(<span class="hljs-number">1000</span>), <span class="hljs-attr">b</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(<span class="hljs-number">2000</span>) };<font></font>
setInterval(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(object.a), <span class="hljs-number">1000</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is a large unnecessary array here </font></font><code>b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but the browser does not free the memory it occupies due to the fact that it is reachable through the object property </font></font><code>object.b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the callback. As a result, the memory occupied by this array is leaking. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Memory leaks are a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">common</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> occurrence in web development. They very easily appear in programs when, for example, developers forget to unsubscribe from the event listener, when they accidentally capture objects in an element </font></font><code>iframe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, when they forget to close the worker, when they collect objects in arrays. If a web page has memory leaks, this leads to the fact that over time the memory consumption of the page increases. Such a page seems slow and slow for users.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first step in solving this problem is to take measurements. </font><font style="vertical-align: inherit;">The new </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performance.measureMemory ()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> API </font><font style="vertical-align: inherit;">allows developers to measure memory usage by web pages in production and, as a result, detect memory leaks that slip through local tests.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How is the new performance.measureMemory () API different from the old performance.memory?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you are familiar with the existing non-standard API </font></font><code>performance.memory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, then you may be interested in the question of how the new API differs from the old one. The main difference is that the old API returns the size of the JavaScript heap, and the new one evaluates the memory usage of the entire web page. This distinction is important when Chrome organizes heap sharing between multiple web pages (or multiple instances of the same page). In such cases, the results returned by the old API may be distorted. Since the old API is defined in terms specific to the implementation, such as a heap, standardizing it is a hopeless business.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another difference is that in Chrome, the new API takes memory measurements when collecting garbage. </font><font style="vertical-align: inherit;">This reduces the “noise” in the measurement results, but may take some time to get the results. </font><font style="vertical-align: inherit;">Please note that creators of other browsers may decide to implement the new API without binding to garbage collection.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recommended Ways to Use the New API</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The use of memory by web pages depends on the occurrence of events, on user actions, on garbage collection. </font><font style="vertical-align: inherit;">That is why the API is </font></font><code>performance.measureMemory()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">designed to study the level of memory usage in production. </font><font style="vertical-align: inherit;">The results of calling this API in a test environment are less useful. </font><font style="vertical-align: inherit;">Here are examples of options for using it:</font></font><br>
<br>
<ul>
<li>          -     .</li>
<li>A/B-  ,            .</li>
<li>            .</li>
<li>    ,  .           .</li>
</ul><br>
<h2><font color="#3AC1EF"> </font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Currently, the API in question is supported only in Chrome 83, according to the Origin Trial scheme. </font><font style="vertical-align: inherit;">The results returned by the API are highly implementation dependent, as different browsers use different ways of representing objects in memory and different ways of evaluating memory usage. </font><font style="vertical-align: inherit;">Browsers can exclude some areas of memory from accounting if the complete accounting of all used memory is an unreasonably difficult or impossible task. </font><font style="vertical-align: inherit;">As a result, we can say that the results produced by this API in different browsers are not comparable. </font><font style="vertical-align: inherit;">It makes sense to compare only the results obtained in the same browser.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Current work progress</font></font></font></h2><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">condition</font></font></strong></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Creating API Explanations</font></font><br>
</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Completed</font></font></a></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Creating a draft specification</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performed</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Gathering feedback and finalizing the project</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performed</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Origin Trial Tests</font></font><br>
</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performed</font></font></a></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Launch</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Not started</font></font></td>
</tr>
</tbody></table></div><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using performance.measureMemory ()</font></font></font></h2><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Enable Origin Trial Support</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The API </font></font><code>performance.measureMemory()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is available in Chrome 83 according to the Origin Trial scheme. </font><font style="vertical-align: inherit;">This phase is expected to end with the release of Chrome 84. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Origin Trial allows developers to take advantage of Chrome’s new features and share feedback on the convenience, usability, and effectiveness of these features with the web community. </font><font style="vertical-align: inherit;">Details about this program can be found </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">You can subscribe to the program on </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> registration </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">page</font></a><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Registration in the Origin Trial program</font></font></font></h3><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Request a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> token for the opportunity you are interested in.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add the token to the pages of the pilot project. </font><font style="vertical-align: inherit;">There are 2 ways to do this:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add a </font></font><code>&lt;meta&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tag </font></font><code>origin-trial</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to the title of each page. </font><font style="vertical-align: inherit;">For example, it might look like this: </font></font><code>&lt;meta http-equiv="origin-trial" content="TOKEN_GOES_HERE"&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you have access to the server settings, it can add a token using an HTTP header </font></font><code>Origin-Trial</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">As a result, the response header should appear something like the following: </font></font><code>Origin-Trial: TOKEN_GOES_HERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul></li>
</ol><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Enabling a new feature through Chrome flags</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to experiment with </font></font><code>performance.measureMemory()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, while dispensing with the Origin Trial token, you need to enable the flag </font></font><code>#experimental-web-platform-features</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in </font></font><code>chrome://flags</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Checking API Use</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A function call </font></font><code>performance.measureMemory()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">may fail, with a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SecurityError thrown</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">This can happen if the environment does not meet the security requirements for information leaks. </font><font style="vertical-align: inherit;">During the Origin Trial test in Chrome, this API requires the inclusion of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Site Isolation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">When the API is ready for normal use, it will rely on the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crossOriginIsolated</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> property </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">A web page can operate in this mode by setting the headers </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COOP and COEP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here is a sample code:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (performance.measureMemory) {
&nbsp;&nbsp;<span class="hljs-keyword">let</span> result;
&nbsp;&nbsp;<span class="hljs-keyword">try</span> {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;result = <span class="hljs-keyword">await</span> performance.measureMemory();<font></font>
&nbsp;&nbsp;} <span class="hljs-keyword">catch</span> (error) {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> DOMException &amp;&amp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error.name === <span class="hljs-string">"SecurityError"</span>) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"The context is not secure."</span>);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;} <span class="hljs-keyword">else</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">throw</span> error;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;<span class="hljs-built_in">console</span>.log(result);<font></font>
}<font></font>
</code></pre><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Local testing</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chrome takes a memory measurement when collecting garbage. </font><font style="vertical-align: inherit;">This means that accessing the API does not instantly resolve the promise. </font><font style="vertical-align: inherit;">To get the result, you need to wait for the next garbage collection session. </font><font style="vertical-align: inherit;">The API forcibly starts garbage collection after a certain timeout, which is currently set to 20 seconds. </font><font style="vertical-align: inherit;">If you run Chrome with a command line flag </font></font><code>--enable-blink-features='ForceEagerMeasureMemory'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, the timeout will be reduced to zero, which is useful for local debugging and local testing.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is recommended that you use the new API by defining a global memory monitor that measures the level of memory usage of the entire page and sends the results to the server, where they can be aggregated and analyzed. The easiest way to work with this API is to take periodic measurements. For example, they can run every </font></font><code>M</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minute. This, however, introduces distortions into the data, since peaks in memory use can occur between the measurements. The following example demonstrates how, using </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the Poisson process</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , to make measurements free of systematic errors. This approach ensures that measurement sessions can, with equal probability, occur at any point in time ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here is a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> demonstration of this approach,</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is the source code). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, declare a function that plans the next start of a session to measure the amount of consumed memory using a function </font></font><code>setTimeout()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with a randomly set interval. </font><font style="vertical-align: inherit;">This function should be called after loading the page in the browser window.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">scheduleMeasurement</span>(<span class="hljs-params"></span>) </span>{
&nbsp;&nbsp;<span class="hljs-keyword">if</span> (!performance.measureMemory) {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"performance.measureMemory() is not available."</span>);
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>;<font></font>
&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;<span class="hljs-keyword">const</span> interval = measurementInterval();
&nbsp;&nbsp;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Scheduling memory measurement in "</span> +
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">Math</span>.round(interval / <span class="hljs-number">1000</span>) + <span class="hljs-string">" seconds."</span>);<font></font>
&nbsp;&nbsp;setTimeout(performMeasurement, interval);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//       .</span>
<span class="hljs-built_in">window</span>.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{<font></font>
&nbsp;&nbsp;scheduleMeasurement();<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The function </font></font><code>measurementInterval()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">finds a random interval, expressed in milliseconds, set in such a way that one measurement would be carried out approximately every five minutes. </font><font style="vertical-align: inherit;">If you are interested in the mathematical concepts on which this function is based, read about the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exponential distribution</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">measurementInterval</span>(<span class="hljs-params"></span>) </span>{
&nbsp;&nbsp;<span class="hljs-keyword">const</span> MEAN_INTERVAL_IN_MS = <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>;
&nbsp;&nbsp;<span class="hljs-keyword">return</span> -<span class="hljs-built_in">Math</span>.log(<span class="hljs-built_in">Math</span>.random()) * MEAN_INTERVAL_IN_MS;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, the asynchronous function </font></font><code>performMeasurement()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calls our API, records the result, and plans the next measurement.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">performMeasurement</span>(<span class="hljs-params"></span>) </span>{
&nbsp;&nbsp;<span class="hljs-comment">// 1.  performance.measureMemory().</span>
&nbsp;&nbsp;<span class="hljs-keyword">let</span> result;
&nbsp;&nbsp;<span class="hljs-keyword">try</span> {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;result = <span class="hljs-keyword">await</span> performance.measureMemory();<font></font>
&nbsp;&nbsp;} <span class="hljs-keyword">catch</span> (error) {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> DOMException &amp;&amp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error.name === <span class="hljs-string">"SecurityError"</span>) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"The context is not secure."</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//    .</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">throw</span> error;<font></font>
&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;<span class="hljs-comment">// 2.  .</span>
&nbsp;&nbsp;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Memory usage:"</span>, result);
&nbsp;&nbsp;<span class="hljs-comment">// 3.   .</span><font></font>
&nbsp;&nbsp;scheduleMeasurement();<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The measurement results may look like this:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// ,    :</span><font></font>
{<font></font>
&nbsp;&nbsp;<span class="hljs-attr">bytes</span>: <span class="hljs-number">60</span>_000_000,
&nbsp;&nbsp;<span class="hljs-attr">breakdown</span>: [<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">bytes</span>: <span class="hljs-number">40</span>_000_000,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">attribution</span>: [<span class="hljs-string">"https://foo.com"</span>],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">userAgentSpecificTypes</span>: [<span class="hljs-string">"Window"</span>, <span class="hljs-string">"JS"</span>]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">bytes</span>: <span class="hljs-number">20</span>_000_000,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">attribution</span>: [<span class="hljs-string">"https://foo.com/iframe"</span>],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">userAgentSpecificTypes</span>: [<span class="hljs-string">"Window"</span>, <span class="hljs-string">"JS"</span>]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;]<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An estimate of the overall level of memory usage is displayed in the field </font></font><code>bytes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. When deriving this estimate, the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">separators of the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> digits of numbers are used. These values ​​are highly implementation dependent. If they are received for different browsers, then you can not compare them. The way they are obtained can vary even in different versions of the same browser. While the Origin Trial program lasts, the return values ​​include indicators of JavaScript memory usage by the main window, indicators of memory usage of elements </font></font><code>iframe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from the same site, and indicators of related windows. When the API is ready, this value will be information about the memory consumed by JavaScript, the DOM, all elements </font></font><code>iframe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">associated with windows and web workers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
List</font></font><code>breakdown</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gives more detailed information about the used memory. </font><font style="vertical-align: inherit;">Each entry describes a piece of memory and associates this fragment with a set of windows, elements </font></font><code>iframe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or workers identified by a URL. </font><font style="vertical-align: inherit;">The field </font></font><code>userAgentSpecificTypes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lists the types of memory determined by the implementation features. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is important to consider these lists in a general way and not try, relying on the features of a certain browser, to analyze everything based on them. </font><font style="vertical-align: inherit;">For example, some browsers may return empty list </font></font><code>breakdown</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or empty fields </font></font><code>attribution</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Other browsers may return </font></font><code>attribution</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">multiple URLs </font><font style="vertical-align: inherit;">in an element </font><font style="vertical-align: inherit;">, indicating that they cannot pinpoint which of these URLs the memory belongs to.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feedback</font></font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Web Performance Community Group</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and the Chrome development team will be happy to find out what you think about </font></font><code>performance.measureMemory()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and learn about your experience using this API.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Share your ideas about the API device with us</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Is there something in this API that doesn't work as expected? </font><font style="vertical-align: inherit;">Maybe it lacks something that you need to implement your idea? </font><font style="vertical-align: inherit;">Open a new task in the </font><font style="vertical-align: inherit;">project </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tracker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or comment on an existing task.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Report an implementation issue</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Found a bug in your Chrome implementation? </font><font style="vertical-align: inherit;">Or maybe it turned out that the implementation is different from the specification? </font><font style="vertical-align: inherit;">Record the error here: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">new.crbug.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Try to include as much detail as possible in your message, include simple instructions on how to reproduce the error, and indicate that the problem is related to </font></font><code>Blink&gt;PerformanceAPIs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Glitch is a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> very good way to demonstrate errors </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Support us</font></font></font></h2><br><font style="vertical-align: inherit;"></font><code>performance.measureMemory()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Are you </font><font style="vertical-align: inherit;">
planning to use </font><font style="vertical-align: inherit;">? </font><font style="vertical-align: inherit;">If so, tell us about it. </font><font style="vertical-align: inherit;">These stories help the Chrome development team prioritize. </font><font style="vertical-align: inherit;">These stories show the creators of other browsers the importance of supporting new features. </font><font style="vertical-align: inherit;">If you want, send a tweet to </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ChromiumDev</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and tell us about where and how you use the new API. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dear readers! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Have you tried </font></font><code>performance.measureMemory()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/iq/fi/b4/iqfib45pgphfrxv--zfemt0qnmw.jpeg"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en497964/index.html">Telemedicine. Reverse Engineering Electronic Stethoscope</a></li>
<li><a href="../en497968/index.html">Web Developer Resources: APIs and UI Elements</a></li>
<li><a href="../en497980/index.html">How much water has leaked? We solve the problem by a moonwalk on Haskell</a></li>
<li><a href="../en497982/index.html">Functional and process approach to management. How and what to manage?</a></li>
<li><a href="../en497984/index.html">Migrating from reCAPTCHA to hCaptcha in Cloudflare</a></li>
<li><a href="../en497988/index.html">React Application Performance Profiling</a></li>
<li><a href="../en497990/index.html">PostgreSQL: Development of extensions (functions) in C language</a></li>
<li><a href="../en497994/index.html">Language mechanics escape analysis</a></li>
<li><a href="../en497996/index.html">You do not want to strengthen immunity. Or the extremes of the human body</a></li>
<li><a href="../en498000/index.html">Things I would like to know before developing my own game</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>