<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧓🏼 🤰🏿 👲🏼 Prometheusのデータウェアハウスの選択：ThanosとVictoriaMetrics 🙇 🤰🏿 👨‍👨‍👦‍👦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="みなさん、こんにちは。以下は、Big Monitoring Meetup 4でのレポートの筆記録です。
 

Prometheusは、さまざまなシステムおよびサービスの監視システムであり、システム管理者は、システムの現在のパラメーターに関する情報を収集し、システムの運用における逸脱の通知を受け取るよ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Prometheusのデータウェアハウスの選択：ThanosとVictoriaMetrics</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482272/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">みなさん、こんにちは。</font><font style="vertical-align: inherit;">以下は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Big Monitoring Meetup 4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">での</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">レポートの</font></a><font style="vertical-align: inherit;">筆記録です</font><font style="vertical-align: inherit;">。</font></font></p><br>
<p><strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prometheus</font></font></a></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、さまざまなシステムおよびサービスの監視システムであり、システム管理者は、システムの現在のパラメーターに関する情報を収集し、システムの運用における逸脱の通知を受け取るようにアラートを構成できます。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レポートでは</font><font style="vertical-align: inherit;">、プロメテウスメトリックの長期保存のためのプロジェクトである</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thanos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VictoriaMetrics</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を比較し</font><font style="vertical-align: inherit;">ます。</font></font></p><a name="habracut"></a><br>
<p><img src="https://habrastorage.org/webt/vm/ha/hd/vmhahdu2edj4dsc6o3lvzaf-noo.png"></p><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/HyOXAdQE0Pk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<p><img src="https://habrastorage.org/webt/op/ni/ao/opniaodpqcis34bw3f4-twdnsic.png"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まず、プロメテウスについてお話します。</font><font style="vertical-align: inherit;">これは、特定のターゲットからメトリックを収集し、ローカルストレージに保存する監視システムです。</font><font style="vertical-align: inherit;">Prometheusは、メトリックをリモートストレージに書き込み、アラートを生成し、ルールを記録できます。</font></font></p><br>
<p><img src="https://habrastorage.org/webt/dl/ji/yn/dljiynnywlw3fcjl7oc3m7lgstw.png"></p><br>
<h3 id="ogranicheniya-prometheus"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prometheusの制限：</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グローバルクエリビューはありません。</font><font style="vertical-align: inherit;">これは、プロメテウスの独立したインスタンスがいくつかある場合です。</font><font style="vertical-align: inherit;">メトリックを収集します。</font><font style="vertical-align: inherit;">そして、プロメテウスのさまざまなインスタンスから収集されたこれらのすべてのメトリックに加えてリクエストを作成したいとします。</font><font style="vertical-align: inherit;">Prometheusはこれを許可しません。</font></font></li>
<li> prometheus     . Prometheus       .       target'   Prometheus'.</li>
<li>   Prometheus        ,           .</li>
<li> Prometheus  -    .</li>
</ul><br>
<p><img src="https://habrastorage.org/webt/t3/wi/lf/t3wilf2sbn7ndupjqbe1wgxqrzw.png"></p><br>
<h3 id="resheniya-etih-problemzadach">  /?</h3><br>
<p> :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Thanos</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">VictoriaMetrics</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Uber M3</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Cortex</a></li>
</ul><br>
<p>      ,  Prometheus.    remote storage     .          : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Thanos</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">VictoriaMetrics</a>.</p><br>
<p>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Thanos</a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"> </a>.    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Thanos</a>    .</p><br>
<p><img src="https://habrastorage.org/webt/wg/bq/-b/wgbq-b3pwr1emeewan-q5hszprs.png"></p><br>
<p>Thanos  ,   Prometheus   ,     S3,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">GCS</a>    object storage.</p><br>
<p><img src="https://habrastorage.org/webt/p7/4g/rj/p74grj159fi9xb58vq-hphcrqyi.png"></p><br>
<p>  Thanos  global query view.    ,   object storage c   Prometheus.</p><br>
<p><img src="https://habrastorage.org/webt/aj/3u/wi/aj3uwi8dd4wgy-fyogditn--kek.png"></p><br>
<p>Thanos  PromQL  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Prometheus querying API</a>.</p><br>
<p><img src="https://habrastorage.org/webt/sr/t7/ql/srt7qlyoruhbxr5wglfuyhi9jp4.png"></p><br>
<p>Thanos   Prometheus   .</p><br>
<p><img src="https://habrastorage.org/webt/3y/ws/ik/3ywsiklzziqimz1aig7uzieblqw.png"></p><br>
<p>Thanos    ,   Prometheus.</p><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">VictoriaMetrics</a>.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"></a>,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">VictoriaMetrics</a>.</p><br>
<p><img src="https://habrastorage.org/webt/z9/q2/wv/z9q2wvhshsoqb1ron0jx47djiwc.png"></p><br>
<p>VictoriaMetrics     prometheus  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">remote write API</a> ,  Prometheus.</p><br>
<p><img src="https://habrastorage.org/webt/pl/xl/ad/plxladg1rdvyudc0wzs5oc2ljsa.png"></p><br>
<p>VictoriaMetrics  global query view,     Prometheus      VictoriaMetrics. ,        .</p><br>
<p><img src="https://habrastorage.org/webt/9l/cp/aw/9lcpawp68_pq2mrhzya9okprroy.png"></p><br>
<p>VictoriaMetrics  ,   Thanos — PromQL  Prometheus querying API.</p><br>
<p><img src="https://habrastorage.org/webt/d1/t1/ek/d1t1ek9rbq_ftlasl48scoriyq0.png"></p><br>
<p>   Thanos,   VictoriaMetrics          . </p><br>
<p><img src="https://habrastorage.org/webt/ps/t6/gu/pst6guuoseu2dicx9tra1bvjhry.png"></p><br>
<p>VictoriaMetrics    Thanos,      .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Single-node </a>,   .        1          1 . VictoriaMetrics     .      100     1- . </p><br>
<p><img src="https://habrastorage.org/webt/tb/s7/t4/tbs7t4unnruaytt7duwambgofne.png"></p><br>
<p> Thanos    2017 ,     .   Thanos    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">improbable.io</a>. </p><br>
<p><img src="https://habrastorage.org/webt/ik/g7/dg/ikg7dgnmbyiph40zo7v7kyhxrdy.png"></p><br>
<p>  2019     0.5.0,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">gossip</a> . E   Thanos,         .   Thanos  ,      - gossip .     .  ,    . </p><br>
<p><img src="https://habrastorage.org/webt/5y/bu/cu/5ybucuovkh85tqwsrv3cjre-zmu.png"></p><br>
<p>    2019      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">256</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Cloud Native Computing Foundation</a>.</p><br>
<p><img src="https://habrastorage.org/webt/16/rz/x_/16rzx_bswddquoqw4cmw9txobxa.png"></p><br>
<p>    Thanos   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Cloud Native Computing Foundation</a>,    Prometheus, Kubernetes    .</p><br>
<p><img src="https://habrastorage.org/webt/9c/i2/ic/9ci2ictg_n0xtgdcxtklghw4n2w.png"></p><br>
<p>  2018    VictoriaMetrics.</p><br>
<p><img src="https://habrastorage.org/webt/wi/li/co/wiliconuw5mwhyzizzthqk8a2og.png"></p><br>
<p>  2018      VictoriaMetrics.</p><br>
<p><img src="https://habrastorage.org/webt/gd/th/ka/gdthkaxubi8jzg8gedilcotjdje.png"></p><br>
<p>  2018   Single-node .</p><br>
<p><img src="https://habrastorage.org/webt/ui/r7/23/uir723wmd-l1dwxds6katr8cfco.png"></p><br>
<p>  2019 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"> </a>   Single-node,    . </p><br>
<p><img src="https://habrastorage.org/webt/a7/tk/ug/a7tkughz1ut9dmlfb6ued1irbh8.png"></p><br>
<p>  2019,   Thanos,     CNCF foundation   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">255</a>.       ,    Thanos. </p><br>
<p><img src="https://habrastorage.org/webt/pk/dm/zr/pkdmzr2xn880osldinx6sb10-ai.png"></p><br>
<p>,  ,       .   .</p><br>
<p><img src="https://habrastorage.org/webt/mw/2w/we/mw2wwenfu8tecrrkyrkx-8dhf-8.png"></p><br>
<p>   ,   Thanos  VictoriaMetrics.</p><br>
<p><img src="https://habrastorage.org/webt/1w/by/96/1wby96ev7cqhx7-psbem1b-bf-i.png"></p><br>
<p>  Thanos.   —   Prometheus.   —   Thanos.     . Thanos Sidecar —  ,      Prometheus.   ,    Prometheus   storage  S3    Object Storage. </p><br>
<p>   ,  Thanos Store Gateway,      c Object Storage     Thanos Query. Thanos Query  PromQL  Prometheus API.       Prometheus.   PromQL,    Thanos Store Gateway, Thanos Store Gateway     Object Storage,   .</p><br>
<p>    Object Storage       -   Thanos Sidecar,         Object Storage S3,       Prometheus       .</p><br>
<p>    ? Thanos Query ,   Thanos Store Gateway,       Thanos Sidecar,     Prometheus. </p><br>
<p> Thanos Sidecar,   ,     Prometheus,       .</p><br>
<p>  ,    ,   Thanos    .  Thanos Compact,       Object Storage    ,     Thanos Sidecar'. Thanos Sidecar        .  ,        ,       .    ,      Thanos Store Gateway,         , .  Thanos Store Gateway  .     Thanos Compact,       ,         overhead  Thanos Store Gateway.</p><br>
<p>     Thanos Ruler.   Prometheus alerting rules    Prometheus recording rules,        Object Storage.      , ..  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">   </a>.</p><br>
<p>     Thanos. </p><br>
<p><img src="https://habrastorage.org/webt/os/em/y4/osemy4ys_bkpy-ngxj7jg-gdmom.png"></p><br>
<p>    VictoriaMetrics.</p><br>
<p> VictoriaMetrics  2 : Single-node   . Single-node    .  Single-node   ,   .        . ,     —      Single-node .     .    —     . </p><br>
<p>  .      : vmselect, vminsert  vmstorage.      ,     . Insert      :  Prometheus remote write API, Influx line , Graphite    OpenTSDB . Insert   ,      storage ,    . Select ,   ,  PromQL .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">PromQL</a>,   Prometheus querying API,     ,   Prometheus  Grafana   Prometheus API . Select  promql ,  ,         storage ,      .</p><br>
<p><img src="https://habrastorage.org/webt/sb/co/mx/sbcomx2usdrwzbyfgqjubvoichg.png"></p><br>
<p>   Thanos  VictoriaMetrics.</p><br>
<p><img src="https://habrastorage.org/webt/hv/gw/r6/hvgwr6nk7yh4nog7rpjac4fn0se.png"></p><br>
<p>  Thanos.  ,     Thanos,   bucket  Object Storage,   S3  GCS,  Thanos Sidecar    . </p><br>
<p><img src="https://habrastorage.org/webt/st/hk/5s/sthk5swss1mkaalb4p3oiebnesq.png"></p><br>
<p>   Prometheus   Thanos Sidecar.       data compaction  Prometheus. Data compaction       Prometheus  ,    .</p><br>
<p>   Thanos Sidecar   Prometheus',     data compaction,   Thanos Sidecar       data compaction.  ,   Prometheus               . ,    ,       ,       ,    ,    ,     data compaction.</p><br>
<p><img src="https://habrastorage.org/webt/gd/as/pw/gdaspwys_r63cegoxqovl9bcmie.png"></p><br>
<p> Thanos      (data retention)   storage  6-8 ,    overhead    .</p><br>
<p>     Thanos Sidecar,     Object Storage Bucket   .  Thanos Compactor  Thanos Store Gateway. </p><br>
<p><img src="https://habrastorage.org/webt/cw/4f/yk/cw4fyksvnkmp1tcn-clf-2gzx3q.png"></p><br>
<p>    Thanos Query   ,       Thanos Store Gateway,    ,       Thanos Sidecar.</p><br>
<p>    . </p><br>
<p><img src="https://habrastorage.org/webt/vf/sc/30/vfsc30z00pvcnupbdym2jztx09k.png"></p><br>
<p>        Thanos Query   .     Prometheus'    -,    VPC,      .    Thanos Query   -   ,     .</p><br>
<p>    - , , ,    .   Thanos Query       Thanos Sidecar,    -.           Thanos Sidecar.   ,        ,    "  ". </p><br>
<p><img src="https://habrastorage.org/webt/rb/ka/aw/rbkaawevhardp1d85mhgdejylxg.png"></p><br>
<p> VictoriaMetrics   .  Single-node         . </p><br>
<p><img src="https://habrastorage.org/webt/co/ui/ll/couillafhtmobnbutejgs6qvszu.png"></p><br>
<p>               ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">helm chart</a>      Kubernetes.     Kubernetes . Helm chart    ,     . ,     storage node,     .</p><br>
<p><img src="https://habrastorage.org/webt/jb/ta/0t/jbta0t7qcko6jov_x1ximqkfni0.png"></p><br>
<p> ,        ,      Prometheus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">  remote write url</a>,         storage   remote storage.   ,           Thanos.       VictoriaMetrics   Prometheus',   Prometheus'    VictoriaMetrics   . </p><br>
<p><img src="https://habrastorage.org/webt/u3/3a/if/u33aifuu7myx3vvs0mkbeysfnei.png"></p><br>
<p>  Thanos  VictoriaMetrics.</p><br>
<p><img src="https://habrastorage.org/webt/fq/dt/d2/fqdtd27cjx-yktnyozgxoon2pte.png"></p><br>
<p> Thanos    Sidecar,        Object Storage.         ,         Object Storage,  Object Storage   . Thanos Sidecar     ,   ,       .      ,        Object Storage.    retention (6-8  ),     ,     Object Storage.</p><br>
<p><img src="https://habrastorage.org/webt/z7/bm/cx/z7bmcxgwyscnrnnehhtjvuqipho.png"></p><br>
<p>Thanos ompactor-    - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">race'  Sidecar</a>. ompactor-    Object Storage        .   ompactor-    Sidecar',     : Sidecar     , Compactor ,     . Compactor   .          . .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"></a>.</p><br>
<p><img src="https://habrastorage.org/webt/_u/c6/hb/_uc6hbgr_kl9l2an5yl0cs9hfba.png"></p><br>
<p>Store Gateway     - race'  Compactor'  Sidecar'.    ,   Store Gateway     Compactor'  Sidecar'. ,    ,  Store Gateway    ,    .</p><br>
<p><img src="https://habrastorage.org/webt/-y/20/ur/-y20urze7qgwxkrklj8ave_ct3i.png"></p><br>
<p>Query   Thanos     ,   Sidecar-  Store Gateway     .    ,     ,     .      .    VictoriaMetrics     . </p><br>
<p><img src="https://habrastorage.org/webt/2g/op/wp/2gopwpbh41vviugdebarsjuql4w.png"></p><br>
<p>   Thanos, VictoriaMetrics   .      Prometheus  VictoriaMetrics,   ,   Prometheus       Write Ahead Log,    2 .          VictoriaMetrics,    . Prometheus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">       VictoriaMetrics</a>.</p><br>
<p><img src="https://habrastorage.org/webt/kg/nl/mv/kgnlmvkqxfagsjhodoybpwzl7am.png"></p><br>
<p>   Thanos,     object storage    , Prometheus     remote write   remote storage,   VictoriaMetrics.     local storage  Prometheus.     local storage,        ,      remote storage.</p><br>
<p><img src="https://habrastorage.org/webt/ba/xj/90/baxj90beqmojti9xkubodbkbvdw.png"></p><br>
<p>Kubernetes       Thanos.   Thanos     Kubernetes ,      VictoriaMetrics.</p><br>
<p><img src="https://habrastorage.org/webt/gz/lb/6l/gzlb6lg2dkrabcovqcohvovd-mk.png"></p><br>
<p> VictoriaMetrics      .   VictoriaMetrics,    .    SIGINT    VictoriaMetrics  gracefull shutdown.     ,    ,    .       . </p><br>
<p><img src="https://habrastorage.org/webt/qz/yf/8c/qzyf8cvpqlimwabno0zx7v5_rxw.png"></p><br>
<p> VictoriaMetrics    .       . </p><br>
<p><img src="https://habrastorage.org/webt/hl/le/sj/hllesjwiv-f1wosgssd7wp6aclo.png"></p><br>
<p>    Thanos  VictoriaMetrics.</p><br>
<p><img src="https://habrastorage.org/webt/xs/ec/b0/xsecb0yy15vimtsl9k9quqplyiw.png"></p><br>
<p> Thanos   . Prometheus       .   ,    ,         Object Storage,   S3. </p><br>
<p><img src="https://habrastorage.org/webt/fg/xo/yo/fgxoyo1q8mihcdy7m_yyio_pyum.png"></p><br>
<p>Store Gateway   ompactor          Object Storage,      .      ,      Store Gateway  ompactor   .  Thanos  issues   ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Store Gateway  ompactor      </a>.</p><br>
<p><img src="https://habrastorage.org/webt/-n/k3/rg/-nk3rgph8ghszyegz1j8jx89bio.png"></p><br>
<p>Thanos ,         Prometheus.     .       Query ,      Store Gateway    Sidecar ,       .         ,   Store Gateway    Sidecar. </p><br>
<p>     . ,    Prometheus,      .   Prometheus,       . Prometheus,       ,    ,    .  Sidecar   .      .  Query       .          Sidecar.</p><br>
<p><img src="https://habrastorage.org/webt/mg/an/ra/mganracsmhkyz1_1aq014v_6cfc.png"></p><br>
<p>  Thanos   ,   Sidecar'   Store Gateway . ,    Sidecar'       -,         . ,        ,     .</p><br>
<p><img src="https://habrastorage.org/webt/1t/m2/j7/1tm2j75o5cpscbevahbz4m0wusk.png"></p><br>
<p> VictoriaMetrics    .    —  ,     ,    VictoriaMetrics.     60%    ,  VictoriaMetrics   60%   VictoriaMetrics  Kubernetes.</p><br>
<p>    ,     VictoriaMetrics. ,     ,        VictoriaMetrics. -           .       ,   , -,  ,  VictoriaMetrics     out of memory, , -,     ,             .  VictoriaMetrics      .   ,       .  :      .</p><br>
<p><img src="https://habrastorage.org/webt/3q/eo/25/3qeo25x5juqpyquhllrhpt9eh34.png"></p><br>
<p> .  retentionPeriod — ,      1 .  ,    VictoriaMetrics  .     VictoriaMetrics  .</p><br>
<p>  VictoriaMetrics   ,     .   :      ?   retentionPeriod    1 .       retentionPeriod. </p><br>
<p><img src="https://habrastorage.org/webt/n1/5a/jm/n15ajmeqozq7zfzc0uv3imzfebw.png"></p><br>
<p>   .</p><br>
<p><img src="https://habrastorage.org/webt/k8/b7/br/k8b7brhqxwy1fa1vdurx0yolgra.png"></p><br>
<p> Thanos   ,  downsampling: 5-   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"> </a>.      issue  github,    issues,    downsampling,     ,    ,   .</p><br>
<p><img src="https://habrastorage.org/webt/iv/nq/4v/ivnq4vtxkkwf_1hs40ttkyhd1ie.png"></p><br>
<p> Thanos     Prometheus HA pairs.   Prometheus'            target'  Thanos    Object Storage. Thanos     ,    VictoriaMetrics.</p><br>
<p><img src="https://habrastorage.org/webt/wn/rv/jh/wnrvjhzqrcx6_o9hoojijeivb8o.png"></p><br>
<p> Thanos  alert ,     Thanos.   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">    production</a>.</p><br>
<p><img src="https://habrastorage.org/webt/ti/qp/ci/tiqpcidg_t_ahj9lornrey8_rda.png"></p><br>
<p> Thanos ,    Thanos   Prometheus — . Thanos  Prometheus      .    Thanos  Prometheus   .</p><br>
<p><img src="https://habrastorage.org/webt/en/vo/o-/envoo-2amya3w4xo2c5lg-pa1bo.png"></p><br>
<p> VictoriaMetrics    — MetricsQL.   VictoriaMetrics  PromQL,       big monitoring metup.</p><br>
<p><img src="https://habrastorage.org/webt/yk/xq/hi/ykxqhipgapygdv7ra2c6rmaitnk.png"></p><br>
<p>VictoriaMetrics       . VictoriaMetrics       Prometheus,     Influx, OpenTSDB  Graphite.</p><br>
<p><img src="https://habrastorage.org/webt/0k/zy/jp/0kzyjptb5sbscny1ffsdh2irqau.png"></p><br>
<p> VictoriaMetrics         Thanos  Prometheus. </p><br>
<p>   ,     2-5          Prometheus  Thanos.</p><br>
<p><img src="https://habrastorage.org/webt/2y/xz/yg/2yxzygpbfnqt3ldibpggeo35rpw.png"></p><br>
<p>   VictoriaMetrics —    . </p><br>
<p><img src="https://habrastorage.org/webt/kk/jd/hy/kkjdhy-zae6bc_3uqu6yp3q1gwy.png"></p><br>
<p>   . </p><br>
<p><img src="https://habrastorage.org/webt/79/yz/yw/79yzywujo1uxm6zc5rti6ebjzpq.png"></p><br>
<p>   Thanos  ,      object storage,   .</p><br>
<p>    object storage,         ($10   ).      object storage,          ,       AWS —  .    ,    $10  $230  1.    ,        Thanos .</p><br>
<p><img src="https://habrastorage.org/webt/eg/--/mv/eg--mv_wpjcv4m-tojp8l9r60ea.png"></p><br>
<p> Thanos      Compact, Store Gateway, Query ,    ,     .</p><br>
<p><img src="https://habrastorage.org/webt/pz/0v/np/pz0vnpflfebkxmaqi3sbbucktz0.png"></p><br>
<p> VictoriaMetrics  .     GCE HDD ,   $40  1.  VictoriaMetrics   HDD ,    SSD,      . VictoriaMetrics   HDD.</p><br>
<p><img src="https://habrastorage.org/webt/dr/6q/lz/dr6qlzowqew8et2zpev1wkrq4cs.png"></p><br>
<p> VictoriaMetrics    :  Single-nod    ,     Thanos ,    ,  —   . </p><br>
<p><img src="https://habrastorage.org/webt/ja/72/cr/ja72crhogqpdixrt8jzj-komdcq.png"></p><br>
<p> . </p><br>
<p><img src="https://habrastorage.org/webt/od/ji/fw/odjifwunkpjdwuqq-hbpwswu_cy.png"></p><br>
<p> Thanos   —  Gitlab. Gitlab    Thanos.      .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">issues</a>,         - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">   Thanos</a>:     Store Gateway  Query .      . </p><br>
<p>-       . </p><br>
<p> ,      —   Improbable,    Thanos.    Thanos. Improbable — ,     .</p><br>
<p><img src="https://habrastorage.org/webt/t4/yh/y4/t4yhy4gyfrimyzyfopgdwk1ixyc.png"></p><br>
<p> VictoriaMetrics    :</p><br>
<ul>
<li>wix.com  </li>
<li>Adidas  VictoriaMetrics       PromCon 2019</li>
<li>TrafficStars — ad network</li>
<li>Seznam.cz —   .</li>
</ul><br>
<p>    ,      .    . </p><br>
<ul>
<li>   . ,   Improbable.</li>
<li>   .</li>
<li>  .</li>
<li>   ,    VictoriaMetrics.    VictoriaMetrics   ,       50      .        .      .</li>
<li> ,    VictoriaMetrics,     .      .</li>
</ul><br>
<p><img src="https://habrastorage.org/webt/lw/0f/r3/lw0fr3hdyce3yw6n0i3ywjnpxhs.png">.</p><br>
<p>VictoriaMetrics  Thanos   ,   :</p><br>
<ul>
<li>Global query view</li>
<li>  </li>
<li> retention</li>
</ul><br>
<p><img src="https://habrastorage.org/webt/pv/-b/ob/pv-bobndxjkjrcukph5xm3sa-98.png"></p><br>
<p>.</p><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">telegram </a>.</p><br>
<p><img src="https://habrastorage.org/webt/gu/0s/w5/gu0sw56ppge1icdy-ensv-wl3f4.png"></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja482258/index.html">ニューラルネットワークのしくみと、大金を持ち始めた理由</a></li>
<li><a href="../ja482260/index.html">TelegramBot。基本的な機能。ステッカーと顔文字。（パート3）</a></li>
<li><a href="../ja482262/index.html">Talend Open Studioにログインする方法</a></li>
<li><a href="../ja482264/index.html">ブラジル、ダークマジック、モータルコンバット、火星、15,000人。オンティコ年結果</a></li>
<li><a href="../ja482268/index.html">未来の巨大構造：ダイソン球、恒星エンジン、「ブラックホール爆弾」</a></li>
<li><a href="../ja482274/index.html">ASP.NETでSystem.Drawingの使用を停止すべき5つの理由</a></li>
<li><a href="../ja482276/index.html">GOST R57580。トレンドから効率的な自動化まで</a></li>
<li><a href="../ja482280/index.html">コスプレはどうですか。アイザッククラークのデッドスペース2の高度なスーツコスチューム</a></li>
<li><a href="../ja482282/index.html">ARMv7時代の終わり、またはゲームの移植について少し</a></li>
<li><a href="../ja482284/index.html">「50色の茶色」または「これまでの道のり」</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>