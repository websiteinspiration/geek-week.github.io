<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>☑️ 💆🏻 👨🏻‍🔬 Pourquoi vaut-il la peine d'installer un système d'exploitation 64 bits sur le Raspberry Pi4 👄 🧘🏾 🎅🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'un des avantages de travailler pour une société de logiciels est que vous avez souvent la possibilité de tester de nouveaux prototypes de matériel. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Pourquoi vaut-il la peine d'installer un système d'exploitation 64 bits sur le Raspberry Pi4</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488120/"><img src="https://habrastorage.org/getpro/habr/post_images/0cc/a7b/84a/0cca7b84aa3da5d217f72f7d3dc84d1b.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'un des avantages de travailler pour une société de logiciels est que vous avez souvent la possibilité de tester de nouveaux prototypes de matériel. Cependant, pas dans ce cas - j'ai acheté un Raspberry Pi4 car il est très bon marché! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le Raspberry Pi4 possède un ARM Cortex A72 quadricœur, jusqu'à 4 Go de mémoire et un port Ethernet gigabit - le tout pour seulement 35 $. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur Raspberry Pi4 ont OS </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspbian</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (basé sur Debian), et la bibliothèque de produits finis, donc je l'ai mis dans la carte SD pour démarrer plus rapidement. J'ai recherché syslog et j'ai remarqué que le noyau et tous les programmes utilisateur étaient compilés en armv7 - c'est-à-dire pour la mémoire 32 bits.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je sais que Raspberry Pi4 prend en charge 64 bits, donc je ne voulais pas y exécuter de système d'exploitation 32 bits. </font><font style="vertical-align: inherit;">J'ai pris une autre carte mémoire et j'ai mis Debian dessus. </font><font style="vertical-align: inherit;">Debian, ne contenant rien de superflu, compilé en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aarch64</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ce qui signifie de la mémoire 64 bits.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir téléchargé le système d'exploitation 64 bits, je me suis intéressé à la façon dont il fonctionne mieux en 32 bits, j'ai donc effectué plusieurs tests.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tests de vitesse synthétiques</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La première chose qui m'est venue à l'esprit était l'ancien test de la dhrystone, qui existe depuis la nuit des temps. Ce programme a été écrit en 1988, et il traite des calculs mathématiques. Il est peu probable qu'il soit capable de simuler la charge actuelle, et nous ne pouvons l'utiliser que pour maintenir une sorte de connectivité avec les anciens matériels et programmes. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/698/5f6/083/6985f6083a6d12ec86b7ad6a71c0ee5d.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une application de résumé moderne est mieux simulée par le calcul des hachages, j'ai donc voulu exécuter un test avec SHA1. Malheureusement, l'utilitaire sha1sum a été compilé sans prise en charge des fonctions libssl ou du noyau cryptographique, j'ai donc dû le compiler à partir de la source. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour éviter les goulots d'étranglement dans les E / S, je calcule un hachage d'un fichier de 2 Go avec l'option truncate -s 2 Go, il n'y a donc pas d'entrée ou de sortie de la carte:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/b20/b3f/738/b20b3f73835d8f9b1e14c92286b7b049.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SHA1 est un test plus réaliste que la dhrystone, car cet algorithme est utilisé dans un grand nombre d'applications - torrents, git, etc.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAM</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un système 64 bits donne accès à une mémoire de 8 octets par lecture / écriture. </font><font style="vertical-align: inherit;">J'ai écrit un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">programme simple</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui place un grand tampon - elle l'écrit, puis le lit. </font><font style="vertical-align: inherit;">Pour garantir une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">réelle allocation de mémoire,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> j'ai utilisé mlock (). </font><font style="vertical-align: inherit;">Dans ce test, le volume de la mémoire tampon est de 2 Go: la mémoire tampon de 3 Go a fonctionné en mode 64 bits et en mode 32 bits, elle a généré une erreur de «mémoire insuffisante».</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/08a/53c/2cd/08a53c2cdc361820aa817cfdd2d6ed02.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encodage audio</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai remarqué que de nombreux utilisateurs de Raspberry Pi4 utilisent un ordinateur comme centre multimédia, j'ai donc commencé la tâche d'encodage audio avec les deux codecs les plus populaires. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai encodé la composition "Echoes" de Pink Floyd car c'est une piste assez longue et vous pouvez en obtenir des valeurs mesurées. </font><font style="vertical-align: inherit;">Pour éviter les retards d'E / S, les fichiers source et de destination ont été stockés sur ramfs:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/131/58a/8cb/13158a8cb3b7849d02ab52c6881bffd9.png"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/b25/7a2/623/b257a26231bf005fddd15715187e516e.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mesures de vitesse du réseau</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre option pour utiliser Raspberry Pi4 est comme VPN ou pare-feu. Je ne recommande pas d'utiliser de tels systèmes à de telles fins, mais beaucoup de gens ont toujours une connexion Internet lente (moins de 100 Mo), donc ils peuvent ne pas prêter attention au fonctionnement lent du Raspberry Pi4. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Première question: combien de trafic le Raspberry Pi4 peut-il gérer? Nous devons mesurer la puissance réseau nette de l'ordinateur, sans les limitations des interfaces physiques, j'ai donc commencé la session iperf3 entre les deux conteneurs. Cependant, les conteneurs échangent des données via une paire de veths, et veth accélère le trafic via de faux déchargements.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le déchargement du calcul de la somme de contrôle IP se fait simplement en refusant de le compter, et le déchargement de la segmentation TCP en refusant de segmenter et de réassembler le trafic: un gros morceau de données de 64K est simplement transféré en mémoire tel quel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour éviter de tels moments, j'ai interdit le déchargement avec la commande </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ethtool -K veth0 tx off rx off tso off gro off gso off</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/a26/549/b2c/a26549b2c6ac9a2737f791f317dcf733.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pare-feu</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'équipement réseau le plus rapide est capable de - supprimer une partie du trafic, et le moyen le plus rapide de le faire est de passer par la règle TC. </font><font style="vertical-align: inherit;">Afin de ne pas atteindre la vitesse maximale possible, j'ai utilisé la taille de trame Ethernet minimale, 64b. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/f81/e12/4af/f81e124af378a94ce8c620e3f285d7ac.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien que les deux systèmes n'aient pas atteint la vitesse de transfert maximale (1,5 Mb / s), le cœur 64 bits a montré une vitesse légèrement supérieure à celle du 32 bits. </font><font style="vertical-align: inherit;">Si vous souhaitez utiliser Raspberry Pi4 comme pare-feu, assurez-vous d'utiliser le noyau 64 bits.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPN</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un autre cas d'utilisation courant pour Raspberry Pi4 est un serveur VPN, ou plutôt OpenVPN. </font><font style="vertical-align: inherit;">Je préfère WireGuard, j'ai donc vérifié les deux programmes car ils sont tous les deux faciles à installer: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/467/c2f/a26/467c2fa2634f3568d4574654eb0faaa0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
comme prévu, OpenVPN est 10 fois plus lent que WireGuard. </font><font style="vertical-align: inherit;">Ce qui n'était pas attendu, c'est qu'OpenVPN fonctionne à la même vitesse à 32 et 64 bps. </font><font style="vertical-align: inherit;">WireGuard sature presque le port gigabit dans les deux cas - nous avons peut-être atteint la limite NIC. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour savoir si WireGuard pouvait fonctionner encore plus rapidement, j'ai effectué un autre test avec deux conteneurs qui n'utilisaient pas Ethernet physique. </font><font style="vertical-align: inherit;">Le seul problème était que le client et le serveur iperf3 fonctionnaient sur le Raspberry Pi4, chargeant deux cœurs.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/aff/4ec/d3f/aff4ecd3f9ded87dd079827c3d7dfc8b.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme prévu, OpenVPN et WireGuard 32 bits, limités par le processeur, ont fait moins bien et WireGuard 64 bits a fait mieux.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusions</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je lis souvent des déclarations comme «ça n'en vaut pas la peine», «vous gagnerez quelques millisecondes», etc., tout simplement parce que le Raspberry Pi4 n'est pas un ordinateur très puissant. </font><font style="vertical-align: inherit;">Ce n'est pas vrai! </font><font style="vertical-align: inherit;">Comme toute personne impliquée dans l'équipement embarqué le sait, l'optimisation logicielle du matériel lent est encore plus importante que du matériel rapide. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je savais déjà qu'un système d'exploitation 64 bits fonctionnerait mieux sur le Raspberry Pi4, mais je ne savais pas combien mieux. </font><font style="vertical-align: inherit;">J'ai donc fait tous ces tests. </font><font style="vertical-align: inherit;">J'espère que tu as aimé!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr488104/index.html">DBA: trouver des index inutiles</a></li>
<li><a href="../fr488108/index.html">SAP HANA Lab dans Azure</a></li>
<li><a href="../fr488112/index.html">Comprendre les itérateurs en Python</a></li>
<li><a href="../fr488116/index.html">Cinq leçons importantes sur l'équilibre du jeu</a></li>
<li><a href="../fr488118/index.html">Rapport de situation d'hiver Haxe</a></li>
<li><a href="../fr488122/index.html">Distillateur compact d'aérogel, d'aluminium et d'essuie-mains à 1,5 $</a></li>
<li><a href="../fr488128/index.html">Forfaits préférentiels: qu'est-ce qui s'ajoute aux salaires des informaticiens en Arménie?</a></li>
<li><a href="../fr488130/index.html">Apprenez l'anglais en utilisant Telegram bot</a></li>
<li><a href="../fr488134/index.html">Augmenter CI sur github pour Android en une journée</a></li>
<li><a href="../fr488136/index.html">Comment le robot Atlas a-t-il appris à faire des cascades acrobatiques, insupportables pour une personne ordinaire?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>