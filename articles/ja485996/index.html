<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš¸ ğŸ² ğŸ‚ğŸ¼ ã‚¢ãƒ—ãƒªã®Elastic APM âš°ï¸ ğŸ¥ ğŸ§‘ğŸ¼â€ğŸ¤â€ğŸ§‘ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç§ã¯é•·ã„é–“è¨˜äº‹ã‚’ç™ºè¡Œã—ã¦ã„ã¾ã›ã‚“ã§ã—ãŸãŒã€ã“ã®è¨˜äº‹ã¯ãã‚Œã»ã©å¤§ããã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€ã†ã¾ãã„ã‘ã°æœ‰ç”¨ã§ã™ã€‚ãƒ¡ãƒˆãƒªãƒƒã‚¯ã®åé›†ã«Prometheusã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’æ±ºå®šã—ãŸå¾Œ...ã—ã°ã‚‰ãã—ã¦ã€Elasticã®ã‚¹ã‚¿ãƒƒã‚¯å…¨ä½“ãŒã™ã§ã«ã‚ã‚Šã€ã“ã®ã‚¹ã‚¿ãƒƒã‚¯å†…ã®ãƒ¡ãƒˆãƒªãƒƒã‚¯ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã“ã¨ã‚’æ±ºå®šã—ãŸãŸã‚ã€Ela...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ã‚¢ãƒ—ãƒªã®Elastic APM</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485996/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§ã¯é•·ã„é–“è¨˜äº‹ã‚’ç™ºè¡Œã—ã¦ã„ã¾ã›ã‚“ã§ã—ãŸãŒã€ã“ã®è¨˜äº‹ã¯ãã‚Œã»ã©å¤§ããã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€ã†ã¾ãã„ã‘ã°æœ‰ç”¨ã§ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ¡ãƒˆãƒªãƒƒã‚¯ã®åé›†ã«Prometheusã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’æ±ºå®šã—ãŸå¾Œ...ã—ã°ã‚‰ãã—ã¦ã€Elasticã®ã‚¹ã‚¿ãƒƒã‚¯å…¨ä½“ãŒã™ã§ã«ã‚ã‚Šã€ã“ã®ã‚¹ã‚¿ãƒƒã‚¯å†…ã®ãƒ¡ãƒˆãƒªãƒƒã‚¯ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã“ã¨ã‚’æ±ºå®šã—ãŸãŸã‚ã€Elastic APMã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚</font></font></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã—ãŸãŒã£ã¦ã€Elastic APMã¯ãƒ¡ãƒˆãƒªãƒƒã‚¯ã‚’æ“ä½œã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã“ã®ãŸã‚ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯Elastic APMã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆã•ã¾ã–ã¾ãªè¨€èªã®ãƒ¡ãƒˆãƒªãƒƒã‚¯ã‚’åé›†ã™ã‚‹ãŸã‚ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">Elastic APM .NET Agentã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³4.6.2ä»¥é™ã€.NET Frameworkã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ãƒ¡ãƒˆãƒªãƒƒã‚¯ã‚’ã‚µãƒ¼ãƒãƒ¼ï¼ˆElastic APMã‚µãƒ¼ãƒãƒ¼ï¼‰ã«é€ä¿¡ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">å¿…è¦ãªã™ã¹ã¦ã®è¨­å®šã¯ã€Elastic APMã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒäºˆæœŸã™ã‚‹ç‰¹å®šã®ã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ã¦web.configã«æ›¸ãè¾¼ã¾ã‚Œã¾ã™ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°‘ãªãã¨ã‚‚Elastic APMã‚µãƒ¼ãƒãƒ¼ã®URLã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">åˆ†å‰²ã™ã‚‹ãŸã‚ã«ã€LCã§ãƒ¡ãƒˆãƒªãƒƒã‚¯ã‚’è¡¨ç¤ºã™ã‚‹ã¨ãã«ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ç’°å¢ƒã«ã‚ˆã£ã¦ã€æ¬¡ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒå¿…è¦ã§ã™ã€‚</font></font></p><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ElasticApmï¼šServiceName-ã‚µãƒ¼ãƒ“ã‚¹ã®åå‰ã€‚æ¬¡ã®ãƒ«ãƒ¼ãƒ«ã‚’æº€ãŸã™å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š^ [a-zA-Z0-9 _-] + $ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ElasticApmï¼šç’°å¢ƒ-ç’°å¢ƒã®åå‰ã«ã‚ˆã‚Šã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ¬ãƒ™ãƒ«ã§ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒãƒ¼ã‚¸ãƒ§ãƒ³7.2ä»¥é™ã®Kibanaã§ã®ã¿ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¾ã™ã€‚</font></font></li>
</ul><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¡ãƒˆãƒªãƒƒã‚¯ãŒé€ä¿¡ã•ã‚Œã‚‹ã¾ã§ã®æ™‚é–“ã‚’è¨­å®šã™ã‚‹ã«ã¯ã€æ¬¡ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒå¿…è¦ã§ã™ã€‚</font></font></p><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ElasticApmï¼šMetricsInterval-ãƒ¡ãƒˆãƒªãƒƒã‚¯ãŒã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œã‚‹ã¾ã§ã®æ™‚é–“ã‚’è¨­å®šã§ãã¾ã™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯5ç§’ï¼‰ã€‚</font><font style="vertical-align: inherit;">æ™‚é–“ã‚’0ã«è¨­å®šã™ã‚‹ã¨ã€ãƒ¡ãƒˆãƒªãƒƒã‚¯ã¯ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">ã“ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã®æ¸¬å®šã¯ã™ã¹ã¦ç§’å˜ä½ã§ã™ã€‚</font></font></li>
</ul><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã‚’æ§‹æˆã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼šElasticApmï¼šLogLevelã€‚ </font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">web.configã¸ã®å…¥åŠ›ä¾‹ï¼š</font></font></p><br>
<pre><code class="xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-comment">&lt;!-- ... --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- ... --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">appSettings</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- ... --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">add</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"ElasticApm:ServerUrls"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"https://my-apm-server:8200"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">add</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"ElasticApm:MetricsInterval"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"10"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">add</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"ElasticApm:Environment"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Stage"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">add</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"ElasticApm:ServiceName"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Web.Api"</span> /&gt;</span>
        <span class="hljs-comment">&lt;!-- ... --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">appSettings</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- ... --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elastic APMã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä½œæ¥­å˜ä½ã¯ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆITransactionã‚¿ã‚¤ãƒ—ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ã§ã™ã€‚</font><font style="vertical-align: inherit;">ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã¯Reporterã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå†…ã§åé›†ã•ã‚Œã€æŒ‡å®šã•ã‚ŒãŸæ™‚é–“ã«ä¸€åº¦ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">é€ä¿¡æ™‚é–“ã®è¨­å®šã¯ä¸Šè¨˜ã®ã¨ãŠã‚Šã§ã™ã€‚</font></font></p><br>
<p>      StartTransaction,    End().   StartTransaction     CaptureTransaction,       End(),        .    ,      CaptureException.</p><br>
<p>    ,      .    â€”  â€”         Labels   . </p><br>
<p>,   ?    ,         ITransaction:</p><br>
<pre><code class="plaintext hljs">public class MeasurementData<font></font>
{<font></font>
    public static string ApmServerUrl =&gt; ConfigurationManager.AppSettings["ElasticApm:ServerUrls"] ?? "http://localhost:8200";<font></font>
<font></font>
    public static string MetricsInterval =&gt; ConfigurationManager.AppSettings["ElasticApm:MetricsInterval"] ?? "10";<font></font>
<font></font>
    public static string ApmEnvironment =&gt; ConfigurationManager.AppSettings["ElasticApm:Environment"] ?? "local";<font></font>
<font></font>
    public static string ServiceName =&gt; ConfigurationManager.AppSettings["ElasticApm:ServiceName"] ?? "Api";<font></font>
<font></font>
    public ITransaction MetricsObject { get; set; }<font></font>
<font></font>
    //   <font></font>
    public static ITransaction Create(string metricsName)<font></font>
    {<font></font>
        Environment.SetEnvironmentVariable(ConfigConsts.EnvVarNames.ServerUrls, ApmServerUrl);<font></font>
        Environment.SetEnvironmentVariable(ConfigConsts.EnvVarNames.MetricsInterval, MetricsInterval);<font></font>
        Environment.SetEnvironmentVariable(ConfigConsts.EnvVarNames.Environment, ApmEnvironment);<font></font>
        Environment.SetEnvironmentVariable(ConfigConsts.EnvVarNames.ServiceName, ServiceName);<font></font>
        return Agent.Tracer.StartTransaction(metricsName, ApiConstants.TypeRequest);<font></font>
    }<font></font>
}</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¬¡ã«ã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã¿ã€ä¾‹å¤–ã‚’ä¿å­˜ã™ã‚‹ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Œäº†ã™ã‚‹ãƒ“ãƒ«ãƒ€ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚</font></font></p><br>
<pre><code class="plaintext hljs">public class MetricsBuilder<font></font>
{<font></font>
    private readonly MeasurementData _measurementData = new MeasurementData();<font></font>
    private string _metricName;<font></font>
<font></font>
    public void BuildMetrics(string metricName)<font></font>
    {<font></font>
        //      ,  <font></font>
        _metricName = string.IsNullOrEmpty(metricName) ? "api_payment_request_duration" : metricName;<font></font>
        CheckAndCreateMetricsObjects();<font></font>
    }<font></font>
<font></font>
    //     <font></font>
    public void AddMetricsLabels(string key, string value)<font></font>
    {<font></font>
        CheckAndCreateMetricsObjects();<font></font>
<font></font>
        if (!_measurementData.MetricsObject.Labels.ContainsKey(key))<font></font>
        {<font></font>
            _measurementData.MetricsObject.Labels.Add(key, value);<font></font>
            return;<font></font>
        }<font></font>
<font></font>
        _measurementData.MetricsObject.Labels[key] = value;<font></font>
    }<font></font>
<font></font>
    //   <font></font>
    public void CaptureMetricException(Exception exception)<font></font>
    {<font></font>
        CheckAndCreateMetricsObjects();<font></font>
        _measurementData.MetricsObject.CaptureException(exception);<font></font>
    }<font></font>
<font></font>
    public void Dispose()<font></font>
    {<font></font>
        CheckAndCreateMetricsObjects();<font></font>
        _measurementData.MetricsObject.End();<font></font>
    }<font></font>
<font></font>
    // ,      ,<font></font>
    //   - <font></font>
    private void CheckAndCreateMetricsObjects()<font></font>
    {<font></font>
        if (_measurementData.MetricsObject == null)<font></font>
        {<font></font>
            _measurementData.MetricsObject = MeasurementData.Create(_metricName);<font></font>
<font></font>
            Logger.Info($"{nameof(MetricsBuilder)}: CurrentTransaction: {JsonConvert.SerializeObject(Agent.Tracer.CurrentTransaction)} " +<font></font>
                        $"ServerUrls: {JsonConvert.SerializeObject(Agent.Config.ServerUrls)} " +<font></font>
                        $"MetricsIntervalInMilliseconds: {JsonConvert.SerializeObject(Agent.Config.MetricsIntervalInMilliseconds)}");<font></font>
        }<font></font>
    }<font></font>
}<font></font>
<font></font>
public interface IMetricsService : IDisposable<font></font>
{<font></font>
    void AddMetricsLabels(string key, string value);<font></font>
<font></font>
    void CaptureMetricException(string message, Exception exception);<font></font>
}<font></font>
<font></font>
public class MetricsService : IMetricsService<font></font>
{<font></font>
    private readonly MetricsBuilder _builder;<font></font>
<font></font>
    public MetricsService(string metricName)<font></font>
    {<font></font>
        _builder = new MetricsBuilder();<font></font>
        Build(metricName);<font></font>
    }<font></font>
<font></font>
    public void AddMetricsLabels(string key, string value)<font></font>
    {<font></font>
        try<font></font>
        {<font></font>
            _builder.AddMetricsLabels(key, value);<font></font>
        }<font></font>
        catch (Exception exception)<font></font>
        {<font></font>
            CaptureMetricException("Can't write metrics labels", exception);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    public void CaptureMetricException(string message, Exception exception)<font></font>
    {<font></font>
        Logger.Error(message, exception);<font></font>
<font></font>
        try<font></font>
        {<font></font>
            _builder.CaptureMetricException(exception);<font></font>
        }<font></font>
        catch (Exception exec)<font></font>
        {<font></font>
            Logger.Error("Can't write capture exception of metrics", exec);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    public void Dispose()<font></font>
    {<font></font>
        try<font></font>
        {<font></font>
            _builder.Dispose();<font></font>
        }<font></font>
        catch (Exception exception)<font></font>
        {<font></font>
            CaptureMetricException($"Can't to do correct dispose of object: {typeof(MetricsService)}", exception);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    private void Build(string metricName)<font></font>
    {<font></font>
        try<font></font>
        {<font></font>
            _builder.BuildMetrics(metricName);<font></font>
        }<font></font>
        catch (Exception exception)<font></font>
        {<font></font>
            CaptureMetricException("Can't create metrics object", exception);<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¡ãƒˆãƒªãƒƒã‚¯ãŒåé›†ã•ã‚Œã‚‹ã‚¯ãƒ©ã‚¹ã§ã¯ã€MetricsServiceã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ä¾å­˜é–¢ä¿‚ã‚’æ­£ã—ãå®Ÿè£…ã™ã‚‹ãŸã‚ã«ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã‚’ç™»éŒ²ã™ã‚‹ã“ã¨ã‚’å¿˜ã‚Œãªã„ã§ãã ã•ã„ã€‚</font></font></p><br>
<pre><code class="plaintext hljs">public class TestClientMetricsService : ITestObject<font></font>
{<font></font>
    private readonly ITestObject _testObject;<font></font>
<font></font>
    public TestClientMetricsService (ITestObject testObject)<font></font>
    {<font></font>
        _testObject = testObject;<font></font>
    }<font></font>
<font></font>
    public ProcessingResult TestMethod()<font></font>
    {<font></font>
        return WriteMetrics("Test_Method", () =&gt; _testObject.Test());<font></font>
    }<font></font>
<font></font>
    private ProcessingResult WriteMetrics(string methodName, Func&lt;Result&gt; testMethod)<font></font>
    {<font></font>
        using (var metricsService = new MetricsService(methodName))<font></font>
        {<font></font>
            try<font></font>
            {<font></font>
                metricsService.AddMetricsLabels("assemblyName", Assembly.GetCallingAssembly().FullName);<font></font>
<font></font>
                var requestResult = testMethod();<font></font>
<font></font>
                metricsService.AddMetricsLabels("success", requestResult?.Success.ToString() ?? "false");<font></font>
                metricsService.AddMetricsLabels("resultCode", requestResult?.GetResultCode().ToString());<font></font>
<font></font>
                return requestResult;<font></font>
            }<font></font>
            catch (Exception exception)<font></font>
            {<font></font>
                metricsService.CaptureMetricException("Can't write metrics", exception);<font></font>
                throw;<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã®è¨˜äº‹ãŒã€Elastic APMã‚’ãƒ¡ãƒˆãƒªãƒƒã‚¯ã‚’åé›†ã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ä½¿ç”¨ã—ãŸã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¨ã£ã¦å½¹ç«‹ã¤ã“ã¨ã‚’é¡˜ã£ã¦ã„ã¾ã™ã€‚</font></font><cut></cut></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja485982/index.html">ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ¬ãƒƒã‚¹ãƒ³ã€‚ä¸»é¡Œé ˜åŸŸã¨ãã®æ•°å­¦ãƒ¢ãƒ‡ãƒ«</a></li>
<li><a href="../ja485984/index.html">Warcraft IIIãŒæ–°ã—ã„ã‚¸ãƒ£ãƒ³ãƒ«ã‚’ç”Ÿã¿å‡ºã—ã€ãƒ•ãƒ©ãƒ³ãƒãƒ£ã‚¤ã‚ºã®é¡”ã‚’å¤‰ãˆã€ãƒªãƒã‚¹ã‚¿ãƒ¼ã‚’å—ã‘å–ã£ãŸæ–¹æ³•</a></li>
<li><a href="../ja485988/index.html">ã€ãƒ­ã‚³ãƒã‚¤ã‚¶ã‚±ãƒ¼ã‚¹ã€‘ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã®è¨ˆç®—ã‚’2å¹´åŠã§2ä¸‡å€é«˜é€ŸåŒ–ã™ã‚‹æ–¹æ³•</a></li>
<li><a href="../ja485990/index.html">è‡ªå‹•åŒ–ã¯æ®ºã™ã®ã‹ï¼Ÿ</a></li>
<li><a href="../ja485994/index.html">ImportExportDataSql-ç„¡æ–™ã®MSSQLãƒ‡ãƒ¼ã‚¿ã‚³ãƒ³ãƒãƒ¼ã‚¿ãƒ¼</a></li>
<li><a href="../ja485998/index.html">LyXï¼šç·è«–ã€‚ãƒ‘ãƒ¼ãƒˆ2</a></li>
<li><a href="../ja486000/index.html">ADSM3ã€‚IPAM / DCIMã‚·ã‚¹ãƒ†ãƒ </a></li>
<li><a href="../ja486002/index.html">Azure Cosmos DBã®åˆ©ç‚¹ã¨è½ã¨ã—ç©´</a></li>
<li><a href="../ja486006/index.html">ã‚¹ã‚¿ãƒƒã‚¯ã«ãƒãƒ£ãƒƒãƒˆã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ä¿å­˜ã™ã‚‹</a></li>
<li><a href="../ja486014/index.html">SLACãƒ„ã‚¢ãƒ¼ï¼šã‚¹ã‚¿ãƒ³ãƒ•ã‚©ãƒ¼ãƒ‰ã®ç±³å›½ã‚¨ãƒãƒ«ã‚®ãƒ¼çœå›½ç«‹åŠ é€Ÿå™¨ç ”ç©¶æ‰€</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>