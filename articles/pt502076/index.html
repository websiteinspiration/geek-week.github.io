<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äçüîß üôãüèª ü§∂üèº Rob√¥ de carrinho 2.0. Parte 1. Navega√ß√£o aut√¥noma de um rob√¥ dom√©stico baseado em ROS üë¥üèø ‚ò™Ô∏è üõµ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O projeto foi constru√≠do com base em outro projeto bem conhecido em seus c√≠rculos - linorobot (linorobot.org), usando componentes dispon√≠veis para um ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Rob√¥ de carrinho 2.0. Parte 1. Navega√ß√£o aut√¥noma de um rob√¥ dom√©stico baseado em ROS</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502076/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O projeto foi constru√≠do com base em outro projeto bem conhecido em seus c√≠rculos - linorobot (linorobot.org), usando componentes dispon√≠veis para um simples leigo. </font><font style="vertical-align: inherit;">Os objetivos que foram definidos: alcan√ßar o movimento aut√¥nomo do rob√¥ em casa usando componentes de baixo custo, avaliar o desempenho dos mini-PCs para os fins declarados, configurar a pilha de navega√ß√£o para se mover nos espa√ßos estreitos do Khrushchev.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/OGxB34-heds" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ferro</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A lista de componentes nos s√≥lidos √© a seguinte:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">framboesa pi 3b - 2800 r .;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lidar rplidar a1 - 7500 p .;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pontes de for√ßa l298n -2pcs - 400 esfregar;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rodado com codificadores do tipo A e B - 2000 r. </font><font style="vertical-align: inherit;">(210 rpm - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">teenzy 3,2 - 2100 r .;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imu 9250 (9150 ou 6050) - 240 p .;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">banco de pot√™ncia a 10000mH - 1500 r.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 baterias 18650 e suporte -600 p.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conversor abaixador dc-dc c 5V a 3.3V - 20p.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um peda√ßo de madeira compensada, parquet -? </font><font style="vertical-align: inherit;">esfregar.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Total: 17160 p. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* O custo pode ser reduzido substituindo teenzy pelo arduino mega 2560 (600 p.), E lidar substituindo o kinect v.1 (1000 p.): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ec/vb/v4/ecvbv42ipnldzd5vhureodavsqi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, deve-se notar que o primeiro kinect tem uma visibilidade m√≠nima (√°rea cega) de 0,5 m, o que pode afetar negativamente a navega√ß√£o em condi√ß√µes apertadas e √© bastante volumoso. </font><font style="vertical-align: inherit;">O lidar tem uma zona cega de menos de 0,2 m. O Kinect v.2 n√£o se encaixa no raspberry 3b (n√£o possui usb 3.0). </font><font style="vertical-align: inherit;">O mega do Arduino √© inferior ao tamanho teenzy (e algumas caracter√≠sticas); al√©m disso, voc√™ precisar√° refazer um pouco o c√≥digo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, o "design" se parece com o seguinte: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ou/ru/x9/ourux9icibrxsh4ruai61e3wkx4.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/yg/bh/0h/ygbh0hlvz8juq6qi4e9tarrhznq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√© claro que n√£o h√° beleza aqui, mas n√£o √© isso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m do pr√≥prio rob√¥, √© altamente desej√°vel ter um PC externo no qual ser√£o projetadas c√°psulas gr√°ficas para visualizar as a√ß√µes do rob√¥ (rviz, gazebo).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Montagem do rob√¥</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ele √© pintado em detalhes no site do projeto - um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ent√£o vamos nos concentrar nos pontos que causam dificuldades. </font><font style="vertical-align: inherit;">Primeiro, voc√™ precisa considerar que os codificadores no rodado s√£o alimentados por 3,3V e, quando 5V √© aplicado, falham perfeitamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O script de instala√ß√£o linorobot foi instalado com sucesso no ubuntu 16.04, ubuntu 18.04. </font><font style="vertical-align: inherit;">Vers√µes ROS: ROS cin√©ticas ou ROS mel√≥dicas. </font><font style="vertical-align: inherit;">No raspberry 3b, voc√™ deve primeiro criar um arquivo de troca. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O principal c√≥digo teenzy est√° no caminho:</font></font><br>
<br>
<pre><code class="bash hljs">roscd linorobot/teensy/firmware/lib/config<font></font>
nano lino_base_config.h<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E derramou nele com o comando:</font></font><br>
<br>
<pre><code class="bash hljs">roscd linorobot/teensy/firmware<font></font>
platformio run --target upload<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os pacotes de comandos acima ser√£o usados ‚Äã‚Äãcom bastante frequ√™ncia; portanto, faz sentido adicion√°-los aos aliases. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Devido √†s dificuldades na montagem do rob√¥, a correla√ß√£o correta de contatos conectados, que vai de l298n a teenzy, pode ser problem√°tica. </font><font style="vertical-align: inherit;">Apesar do diagrama de conex√£o extremamente claro, as rodas podem se comportar de maneira diferente e precisam experimentar, escolhendo a atribui√ß√£o correta de pinos no c√≥digo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No meu caso, ficou assim:</font></font><br>
<br>
<pre><code class="bash hljs">/// ENCODER PINS
<span class="hljs-comment">#define MOTOR1_ENCODER_A 14</span>
<span class="hljs-comment">#define MOTOR1_ENCODER_B 15 </span><font></font>
<font></font>
<span class="hljs-comment">#define MOTOR2_ENCODER_A 11</span>
<span class="hljs-comment">#define MOTOR2_ENCODER_B 12 </span><font></font>
//MOTOR PINS<font></font>
<span class="hljs-comment">#ifdef USE_L298_DRIVER</span>
  <span class="hljs-comment">#define MOTOR_DRIVER L298</span><font></font>
<font></font>
  <span class="hljs-comment">#define MOTOR1_PWM 21</span>
  <span class="hljs-comment">#define MOTOR1_IN_A 1</span>
  <span class="hljs-comment">#define MOTOR1_IN_B 20</span><font></font>
<font></font>
  <span class="hljs-comment">#define MOTOR2_PWM 5</span>
  <span class="hljs-comment">#define MOTOR2_IN_A 8</span>
  <span class="hljs-comment">#define MOTOR2_IN_B 6</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo ponto √© prescrever a especifica√ß√£o das rodas do rob√¥:</font></font><br>
<br>
<pre><code class="bash hljs">//define your robot<span class="hljs-string">' specs here
#define MAX_RPM 210               // motor'</span>s maximum RPM
<span class="hljs-comment">#define COUNTS_PER_REV 1365       // wheel encoder's no of ticks per rev</span>
<span class="hljs-comment">#define WHEEL_DIAMETER 0.065       // wheel's diameter in meters</span>
<span class="hljs-comment">#define PWM_BITS 8                // PWM Resolution of the microcontroller</span>
<span class="hljs-comment">#define LR_WHEELS_DISTANCE 0.235  // distance between left and right wheels</span>
<span class="hljs-comment">#define FR_WHEELS_DISTANCE 0.30   // distance between front and rear wheels. Ignore this if you're on 2WD/ACKERMANN</span>
<span class="hljs-comment">#define MAX_STEERING_ANGLE 0.415  // max steering angle. This only applies to Ackermann st</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A RPM pode ser encontrada na especifica√ß√£o da roda, mas CPR (COUNTS_PER_REV) √© o valor calculado. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CPR = PPR x 4. O PPR de nossas rodas 341. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* O PPR pode ser visualizado na especifica√ß√£o ou executar o c√≥digo no </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rob√¥ roslaunch linorobot minimal.launch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e girar a roda em 360 graus. PPR ser√° igual ao valor num√©rico que ser√° exibido na tela ap√≥s a rota√ß√£o da roda: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/be/7z/ks/be7zksecqhlyuyv-e_dkxqdyrwe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* PPR = abs (RECENT_COUNT - INITIAL_COUNT). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, CPR = 1364. Voc√™ tamb√©m precisa definir WHEEL_DIAMETER e LR_WHEELS_DISTANCE em metros. Al√©m disso, LR_WHEELS_DISTANCE √© a dist√¢ncia entre os eixos centrais das rodas, e n√£o de ponta a ponta. Outros indicadores podem ser ignorados se o rob√¥ for de duas rodas, diferencial (n√£o omni). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O terceiro ponto que pode causar dificuldades - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imu calibra√ß√£o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Para fazer isso, seguindo as instru√ß√µes, √© necess√°rio fixar o rob√¥ em determinadas posi√ß√µes. As dicas estar√£o no c√≥digo ao executar o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">script rosrun imu_calib do_calib</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gg/fj/9e/ggfj9eg71ilp0baj7rvshjl-fmw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ap√≥s a conclus√£o, imu_calib.yaml com as configura√ß√µes ser√° gerado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â melhor executar a calibra√ß√£o, apesar do fato de haver um arquivo padr√£o com configura√ß√µes de imu. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Al√©m disso, a calibra√ß√£o imu pode afetar a dire√ß√£o do movimento do rob√¥ pelo teleop (esquerda em vez de direita e vice-versa, enquanto o movimento para frente e para tr√°s estava correto). A situa√ß√£o n√£o foi resolvida pelo rearranjo de pinos no c√≥digo. O pr√≥prio Imu foi fixado e calibrado com suportes de cabe√ßa para baixo, fixado na parte traseira da base do rob√¥. Sua (imu) virada sem recalibra√ß√£o resolveu o problema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quarto ponto - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calibra√ß√£o pid</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No site do projeto, o procedimento para implementar o ajuste √© descrito em detalhes - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, ser√° dif√≠cil para um iniciante descobrir o que √© e como trabalhar com ele. </font><font style="vertical-align: inherit;">Em geral, a regula√ß√£o pid √© necess√°ria para garantir que o rob√¥ se mova de maneira uniforme, sem solavancos / frenagens bruscas. </font><font style="vertical-align: inherit;">Tr√™s par√¢metros s√£o respons√°veis ‚Äã‚Äãpor isso: p, i, d. </font><font style="vertical-align: inherit;">Seus valores est√£o contidos no c√≥digo principal enviado ao teenzy:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#define K_P 2.0 // P constant angle</span>
<span class="hljs-comment">#define K_I 0.3 // I constant</span>
<span class="hljs-comment">#define K_D 0.1 // D constant</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode experimentar com eles executando o rob√¥:</font></font><br>
<br>
<pre><code class="bash hljs">roslaunch linorobot minimal.launch
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais adiante no PC externo em tr√™s terminais diferentes:</font></font><br>
<br>
<pre><code class="bash hljs">rosrun lino_pid pid_configure<font></font>
rosrun teleop_twist_keyboard teleop_twist_keyboard.py<font></font>
rqt<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Movendo os controles deslizantes p, d, i no terminal rqt e controlando o rob√¥ no terminal teleop_twist_keyboard, voc√™ pode obter os resultados necess√°rios sem precisar fazer o download do c√≥digo com os novos par√¢metros pid a cada vez no teenzy: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qr/9m/ef/qr9mefipf7mqz9vwqqyqkktkeug.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
isto √©, tudo acontece </font><font style="vertical-align: inherit;">instantaneamente </font><font style="vertical-align: inherit;">e no firmware teenzy pode ter significados completamente diferentes. </font><font style="vertical-align: inherit;">* Voc√™ n√£o pode se concentrar em gr√°ficos, porque </font><font style="vertical-align: inherit;">visualmente, e assim ser√° entendido como o rob√¥ est√° viajando. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eles recomendam come√ßar com a configura√ß√£o dos valores p = 1,0, d = 0,1, i = 0,1. </font><font style="vertical-align: inherit;">No nosso caso, os valores s√£o os seguintes (obtidos experimentalmente) p = 2,0, i = 0,3, d = 0,1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, esses valores devem ser definidos no c√≥digo e preenchidos em pequenos detalhes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, n√£o esque√ßa de definir o c√≥digo (DEBUG 0 em vez de DEBUG 1):</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#define DEBUG 0</span></code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Odometria</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para orienta√ß√£o do rob√¥ e navega√ß√£o subseq√ºente, s√£o usados ‚Äã‚Äãdados do lidar, dados do imu e do codificador da roda. Se a calibra√ß√£o da imu for realizada corretamente, o lidar est√° instalado corretamente e os valores do codificador est√£o corretos, ent√£o n√£o deve haver problemas com a odometria. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para verificar se a odometria est√° correta, voc√™ precisa montar um pouco no rob√¥ via teleop e ver os valores no t√≥pico odom, isso est√° escrito na p√°gina do projeto - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E tamb√©m observe a concha visual do rviz: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rr/td/si/rrtdsilkdlggf3ifjhk1uhl8bz0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
uma c√©lula no rviz √© de 1 m; portanto, √© recomend√°vel que o rob√¥ passe esse medidor no editor visual e tamb√©m em esp√©cie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, a dist√¢ncia percorrida √© exibida no indicador w: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i1/oj/l6/i1ojl6vg5jyugymjwgk-5cfsrlm.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tamb√©m deve tender a 1 m. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mesmo se aplica aos √¢ngulos de rota√ß√£o do rob√¥:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/l0/uf/bv/l0ufbvhsko99na50frablnrvsc4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* No rviz e no live, o rob√¥ deve girar nos mesmos √¢ngulos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Odometria de um LIDAR √© definido de uma forma similar - uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">liga√ß√£o A.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dist√¢ncia do radar de laser para a parede mais pr√≥xima ao vivo e em rviz deve corresponder.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TF</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em ROS, aten√ß√£o especial √© dada √†s transforma√ß√µes - tf. </font><font style="vertical-align: inherit;">Em termos gerais, esse conceito descreve a correla√ß√£o de objetos em rela√ß√£o um ao outro no espa√ßo. </font><font style="vertical-align: inherit;">Para que os objetos n√£o fiquem no ar e o programa entenda como eles s√£o apresentados em rela√ß√£o um ao outro, √© preciso prestar aten√ß√£o √†s configura√ß√µes tf. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No projeto, todas as conex√µes tf j√° est√£o configuradas uma em rela√ß√£o √† outra e voc√™ s√≥ precisa ajustar os indicadores, por exemplo, indicar como o lidar est√° localizado. </font><font style="vertical-align: inherit;">Isso √© necess√°rio para o rob√¥ entender que o obst√°culo n√£o surgiu diretamente na frente dele, mas na frente do lidar, que √© separado do centro do rob√¥ a uma certa dist√¢ncia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos para o diret√≥rio apropriado:</font></font><br>
<br>
<pre><code class="bash hljs">roscd linorobot/launch<font></font>
nano bringup.launch<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A base em si est√° localizada a uma dist√¢ncia de 0,065 m do piso:</font></font><br>
<br>
<pre><code class="bash hljs">&lt;node pkg=<span class="hljs-string">"tf_ros"</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">"static_transform_publisher"</span> name=<span class="hljs-string">"base_footprint_to_base_link"</span> args=<span class="hljs-string">"0 0 0.065 0 0 0  /base_footprint /base_link "</span>/&gt;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No laser.launch, voc√™ precisa definir a localiza√ß√£o do lidar em rela√ß√£o ao centro da base do rob√¥:</font></font><br>
<br>
<pre><code class="bash hljs">roscd linorobot/launch/include<font></font>
nano laser.launch<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No meu caso, o lidar √© deslocado ao longo do eixo x: -0,08, y: 0,04 e "sobe" acima da base (eixo z): 0,08m:</font></font><br>
<br>
<pre><code class="bash hljs">&lt;node pkg=<span class="hljs-string">"tf2_ros"</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">"static_transform_publisher"</span> name=<span class="hljs-string">"base_link_to_laser"</span>
args=<span class="hljs-string">"-0.08 0.04 0.08 0 0 0  /base_link /laser "</span>/&gt;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No rviz, esse local pode ser observado visualmente: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1v/rz/gj/1vrzgjmhx-gf-jar7jxfbhcovte.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
embora n√£o esteja longe do lidar, </font><font style="vertical-align: inherit;">ajustaremos </font><font style="vertical-align: inherit;">sua frequ√™ncia para que ele d√™ mais pontos (por padr√£o, ele fornece 4k), isso ajudar√° na constru√ß√£o do mapa:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> linorobot/launch/include/lidar<font></font>
nano rplidar.launch<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adicionar par√¢metro:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"scan_mode"</span>  <span class="hljs-attr">type</span>=<span class="hljs-string">"string"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Boost"</span>/&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
e mudar </font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"angle_compensate"</span>    <span class="hljs-attr">type</span>=<span class="hljs-string">"bool"</span>   <span class="hljs-attr">value</span>=<span class="hljs-string">"false"</span>/&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, 8k est√£o √† nossa disposi√ß√£o: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zf/u0/fq/zfu0fqd4d7nwmuv50am1qhwqxbm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
a localiza√ß√£o f√≠sica do lidar no rob√¥ tamb√©m importa:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/46/mw/vq/46mwvqq3kj7nxpskvoadm7xe738.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Construindo um mapa da sala 2d</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No site do projeto, prop√µe-se construir um mapa da sala lan√ßando em dois terminais:</font></font><br>
<br>
<pre><code class="bash hljs">roslaunch linorobot bringup.launch<font></font>
roslaunch linorobot slam.launch<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, a pr√°tica mostrou que o slam, que vem por padr√£o com o projeto, se recusa a trabalhar quando o modo lidar √© 8k: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ze/xa/a5/zexaa5f_1byvgcvvvkvcr7cowbi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
enquanto no modo 4k, os cart√µes n√£o s√£o muito bem-sucedidos, s√£o muito barulhentos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, √© melhor usar outro slam - hector-slam. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como instal√°-lo √© indicado </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s a instala√ß√£o, o procedimento para criar um mapa ser√° o mesmo, mas em vez de roslaunch linorobot slam.launch, execute roslaunch my_hector_mapping my_launch.launch Os </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mapas s√£o mais limpos, mas √© melhor modific√°- </font><font style="vertical-align: inherit;">los </font><font style="vertical-align: inherit;">em um editor gr√°fico, removendo os desnecess√°rios, especialmente se o lidar colidir com espelhos ao criar o mapa : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cn/zo/jv/cnzojvfwpkwgldoo3mylfwwh-yg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o esque√ßa de salvar o mapa do quarto:</font></font><br>
<br>
<pre><code class="bash hljs">rosrun map_server map_saver -f my-map
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Os mapas s√£o melhor obtidos em um crep√∫sculo agrad√°vel, o que tirar√° o m√°ximo proveito do or√ßamento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Continua.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt502056/index.html">Como construir uma casa inteligente e n√£o enlouquecer</a></li>
<li><a href="../pt502066/index.html">Comandos simples do console que todos devem conhecer</a></li>
<li><a href="../pt502068/index.html">110 volts no seu computador</a></li>
<li><a href="../pt502070/index.html">A hist√≥ria da Pentax (artigo mais v√≠deo)</a></li>
<li><a href="../pt502072/index.html">Ancorando a ISS usando JavaScript e b√∫ssola</a></li>
<li><a href="../pt502080/index.html">M√©todo Kanban: Exemplo PNZ No. 1, o processo de estudo de medi√ß√£o em uma startup</a></li>
<li><a href="../pt502084/index.html">Verifica√ß√£o do portal de servi√ßos p√∫blicos regionais sob carga atrav√©s do operador de marionetes</a></li>
<li><a href="../pt502086/index.html">Configurando o Minio para que o usu√°rio possa trabalhar apenas com seu bucket</a></li>
<li><a href="../pt502088/index.html">Uma hist√≥ria de excesso e perda de tempo. De acordo com py3</a></li>
<li><a href="../pt502092/index.html">Suporte tecnol√≥gico e regulat√≥rio para servi√ßos de confian√ßa digital na Federa√ß√£o Russa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>