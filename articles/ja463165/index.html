<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👶🏻 🦊 💫 電報がDPIを取り消してロックする-偽のTLS 🏄 📣 👩🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Telegramは、新しいバージョンのブロッキングバイパスをテストしています-通常のTLS（https）でのトラフィックのマスキング。
 背景：Telegramをブロックする試みはさまざまな国で行われ、最初のブロックオプションは単純でした-TelegramサーバーのIPアドレスをブロックします。
 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>電報がDPIを取り消してロックする-偽のTLS</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463165/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b9c/92b/840/b9c92b840fb4935195c7064a42d5422a.jpg" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Telegramは、新しいバージョンのブロッキングバイパスをテストしています-通常のTLS（https）でのトラフィックのマスキング。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景：Telegramをブロックする試みはさまざまな国で行われ、最初のブロックオプションは単純でした-TelegramサーバーのIPアドレスをブロックします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
電報は、利用可能なIPを定期的に変更することにより、この攻撃をうまく阻止しますが、最初の接続に長い時間が</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
かかります</font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">ソックスプロキシが少し後に利用可能になりましたが、プロトコルは暗号化を意味せず、これにより、ソックストンネルの内部だけを見て、内部が何であるかを特定できました彼-電報、プロキシをブロックします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のラウンドは、MTProtoプロトコルを使用するテレグラムプロキシサーバーであるMTProto Proxyのリリースでしたが、いくつかの問題もありました-パケットサイズは非常に特徴的で具体的であり、多くのDPIは最初のパケットの後でテレグラムを決定し始めました-アクセスをブロックしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この動作に対する答えは、MTProtoプロトコルの新バージョンの導入でした。ランダムな長さのため、テレグラムトンネルが目の前にあると判断するのはより難しくなり、DPIの一部がトラフィックを「別の」部分として分類し始めましたが、特徴的なパターンを特定し、ある程度の確率（100％ではない）で識別することを学びましたトラフィックがテレグラムに関連していることを確認する</font></font><br>
</blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今、私たちは次の段階（それは最終的または最終的なようです）に</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">進み</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">- </font><b><font style="vertical-align: inherit;">ステガノグラフィー</font></b><font style="vertical-align: inherit;">。</font></font><br>
<blockquote><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステガノグラフィー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（ギリシャ語。Στεγανός「隠された」+γράφω「私が書いた」;文字。「秘密の執筆」）-そのような転送（保管）の実際の機密性を考慮に入れて情報を送信または保管する方法。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">つまり、Telegramは通常のTLS（https）トラフィックのふりをします。</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なぜごっこ？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
答えは表面にあります-現在、ほとんどのトラフィックはTLS（https）です。このプロトコルを使用する場合、これはプロバイダーまたはDPIに表示されます。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あなたのIP</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPサーバー</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接続ドメイン（URLは表示されません）</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、最後のアイテムを削除するために活発な作業が進行中であり、2つのIPに加えて、内容が不明な暗号化されたトンネルがありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような状況では、すべての非標準プロトコルが注目を集め始め、この問題の解決策は1つです。TLS（https）のように見える場合、質問は少なくなります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">技術的な実装</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しいプロトコルを使用する場合、MTProtoストリームは標準のHTTPS（最初のトンネルネゴシエーションメッセージ）でラップされ、その中でドメイン（偽）が転送されます。</font><font style="vertical-align: inherit;">MTProtoプロトコルのネゴシエーション後-Fake-TLSは使用されません。その後、トラフィックは通常の長さのランダムな長さ（dd-キー）のMTProtoプロトコルを使用し始めます。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考までに：TelegramはMTProto Proxyに3種類のキーを使用します。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常のキー（DPIによって簡単に決定）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初の2文字-dd-ランダムなメッセージ長（DPIは最初の接続ネゴシエーションパケットによってのみプロトコルを決定できます-通常のhttps / TLSのように見えます）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初の2文字-ee-偽のTLS +ランダムなメッセージの長さ（DPIはプロトコルを決定できません。最初のメッセージとそれ以降のすべてのメッセージはHTTPS / TLSのように見えます）</font></font></li>
</ol><br>
</blockquote> <h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どこで試す？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しい標準をサポートするプロキシサーバーはすでに2つあります</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（かなり前にddキーのサポートを追加しましたが、公式のプロキシサーバーはまだありません）</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
偽のTLSプロキシモードのサポート：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/alexbers/mtprotoproxy</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erlang </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/seriyps/mtproto_proxy/tree/fake-tls</font></font></a></li>
</ol><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：この記事の執筆時点での記事-偽のtls機能は実験的なものであるため、ソフトウェアのベータ版またはアルファ版（プロキシとクライアントの両方）を使用する必要があります。</font></font></b><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どのクライアントが新しいモードをサポートしていますか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Telegramデスクトップのベータ版、Telegram iOS、</font><font style="vertical-align: inherit;">Androidの安定版</font><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">言い</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どうやって試す？</font></font></h2><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">たとえば、Pythonではプロキシを使用します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロキシをインストールします。 </font></font><br>
<br>
<pre><code class="bash">git clone https://github.com/alexbers/mtprotoproxy.git; cd mtprotoproxy</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ローンチ： </font></font><br>
<br>
<pre><code class="bash">python3 mtprotoproxy.py</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添え字付きのキー（実験的）がコンソールに表示されます-必要です： </font></font><br>
<br>
<pre><code class="bash">tg: tg://proxy?server=8.8.8.8&amp;port=443&amp;secret=7gAAAAAAAAAAAAAAAAAAAABnb29nbGUuY29t (experimental)</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常どおりクライアントにデータを入力します。おめでとうございます。これで、新しいFake TLSモードを使用しています。</font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">舞台裏で何が起こっているのですか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、両方のプロキシサーバーが接続時にGoogle.comドメインを使用します。つまり、プロバイダーまたはDPIはGoogle.comへのHTTPS接続を確認しますが、IPはサーバーになります。将来的には、プロキシの作成者は他のドメインに入ると約束し、クライアントが存在しない場合はクライアントを阻止することができます。接続をネゴシエートするときに別のドメインを使用します。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font><font style="vertical-align: inherit;">接続は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバー</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（IP）に</font><font style="vertical-align: inherit;">行き</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">が、</font><font style="vertical-align: inherit;">Google.comドメインは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヘッダー</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で転送さ</font><font style="vertical-align: inherit;">れ</font><font style="vertical-align: inherit;">ます</font></font></blockquote> <h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fake TLSが優れている理由</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前述のように、HTTPSプロトコルを使用する場合、プロバイダーまたはDPIは、接続をブロックするときに2つの基準のみでガイドできます。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPサーバー</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドメイン</font></font></li>
</ol><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして最後のアイテムはすぐに消えます（eSNIに感謝します）。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロキシを偽のTLSに切り替えると、プロバイダーから見えなくなります。たとえば、サーバーがクラウド内にあり、調整中にGoogleや一部のGoogleドメインが使用されている場合、外部からの統計分析は役に立ちません。その後、一部のGoogleサービスはHTTPS / TLSプロトコルで動作します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マイナス点はありますか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
小さいですが、ブラウザを使用してプロキシにアクセスした場合、接続は確立されないと予想されます（秘密はありません）。</font><font style="vertical-align: inherit;">外部から見ると、正しく構成されていないHTTPSサーバーのように見えます。</font><font style="vertical-align: inherit;">これはブロッキングの基準になりますか？</font><font style="vertical-align: inherit;">-いいえ、サーバーは、たとえば個人証明書やその他の情報を期待できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、将来的には、シークレットに加えて、一連のシークレット+ドメイン（偽）を認証フィールドとして使用し、サーバーが別のドメインでアクセスされる場合-完全に通常のサイトを表示するが、自分だけが知っているドメインである場合-MTProtoトンネルを上げることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、これはeSNI（暗号化ドメインヘッダー）の実装後にのみ可能になります。暗号化なしで送信されるようになりました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成長する余地はありますか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、私の意見では、Telegramはまだすべての手段を使用して非表示にしていません。https/ TLSに加えて、WebSocketを使用してトラフィックを非表示にすることは理にかなっています。これにより、トラフィックの識別と分類がさらに複雑になります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
独自のMTProtoプロキシサーバーを使用している場合-新しい標準を検討し、テレグラムクライアントのすべてのパブリックバージョンで使用可能になったらすぐに、すべてのユーザーをそのサーバーに転送します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
はい、小さな問題があります-すべての人（シークレット）の接続文字列を更新する必要があります。これは変更されますが、これによりプロキシを非表示にする成功率が向上します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しい標準への転送に加えて、プロキシをポート443（HTTPSの標準）に変換し、非暗号化接続（ddとeeのないキー）をブロックし、すべてをeeに移行した後、プロキシを含むddキーもこれを実行できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、プロキシの前にドメイン定義を備えたバランサをインストールし、プロキシで構成されたドメイン以外のドメインをリクエストする場合は、eSNI標準が実装されるとすぐに実際のサイトを表示する必要があります。これにより、保護が無料で強化されます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あなたも興味があるかもしれません。</font></font></h2><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSLH：SSH / HTTPS / OpenVPN /テレグラムを単一ポート443の背後に隠す</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegramが公式のMTProto Proxy Serverをリリース</font></font></a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja463149/index.html">アランケイは古くて忘れられていたが重要なプログラミングの本を読むことを勧めます</a></li>
<li><a href="../ja463151/index.html">虫眼鏡の下のiOS 13</a></li>
<li><a href="../ja463155/index.html">ホワイトノイズは黒い四角を描画します。パート2.ソリューション</a></li>
<li><a href="../ja463157/index.html">I2CとSPIディスプレイを接続するESP32-CAMビデオストリーミングサーバー</a></li>
<li><a href="../ja463159/index.html">セキュリティ、数字、メール、そして広告について</a></li>
<li><a href="../ja463167/index.html">トレーニングVRプロジェクトの開発を開始するために必要な資料</a></li>
<li><a href="../ja463169/index.html">オープンソース補聴器-仕組み</a></li>
<li><a href="../ja463171/index.html">ニューラルネットワークとディープラーニング：オンラインチュートリアル、第6章、パート1：ディープラーニング</a></li>
<li><a href="../ja463175/index.html">機械学習モデル間の依存関係と継承の可視化</a></li>
<li><a href="../ja463177/index.html">ホームクレジットのサービスデスク。そして中身は？...</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>