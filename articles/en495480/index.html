<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨ğŸ¼â€ğŸ’» âœŠğŸ¾ ğŸ„ Creating Python bindings for C / C ++ libraries using SIP. Part 1 ğŸ–ï¸ ğŸ˜§ ğŸ™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sometimes, while working on a project in Python, there is a desire to use a library that is not written in Python, but, for example, in C or C ++. The...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Creating Python bindings for C / C ++ libraries using SIP. Part 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495480/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sometimes, while working on a project in Python, there is a desire to use a library that is not written in Python, but, for example, in C or C ++. The reasons for this may be different. First, Python is a wonderful language, but in some situations it is not fast enough. And if you see that performance is limited by the features of the Python language, then it makes sense to write part of the program in another language (in this article we will talk about C and C ++), arrange this part of the program as a library, make Python bindings (Python bindings) on top of it and use the module thus obtained as a normal Python library. Secondly, a situation often happens when you know that there is a library that solves the required problem, but, unfortunately, this library is not written in Python, but in the same C or C ++.In this case, we can also make a Python binding over the library and use it without thinking about the fact that the library was not originally written in Python.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are various tools for creating Python bindings, ranging from lower-level ones like the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python / C API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to higher-level ones like </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SWIG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SIP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I did not have the goal of comparing different ways of creating Python bindings, but I would like to talk about the basics of using one tool, namely </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SIP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Initially, SIP was designed to create a binding around the Qt library - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyQt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and is also used to develop other large Python libraries, for example, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wxPython</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article, gcc will be used as the compiler for C, and g ++ will be used as the C ++ compiler. </font><font style="vertical-align: inherit;">All examples were tested under Arch Linux and Python 3.8. </font><font style="vertical-align: inherit;">In order not to complicate the examples, the topic of compilation for different operating systems and using different compilers (for example, Visual Studio) is not included in the scope of this article. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can download all the examples for this article from the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repository on github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The repository with SIP sources is located at </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.riverbankcomputing.com/hg/sip/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mercurial is used as the version control system for SIP.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Making a binding over a library in C</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Writing a library in C</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This example is located in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_01</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">in the source, but in this article we will assume that we are doing everything from scratch. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's start with a simple example. </font><font style="vertical-align: inherit;">First, weâ€™ll make a simple C library, which we will then run from a Python script. </font><font style="vertical-align: inherit;">Let our library be the only function</font></font><br>
<br>
<pre><code class="plaintext hljs">int foo(char*);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
which will take a string and return its length multiplied by 2. The </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
header file </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> may look, for example, like this:</font></font><br>
<br>
<pre><code class="plaintext hljs">#ifndef FOO_LIB<font></font>
#define FOO_LIB<font></font>
<font></font>
int foo(char* str);<font></font>
<font></font>
#endif<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And the file with the implementation of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo.cpp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="plaintext hljs">#include &lt;string.h&gt;<font></font>
<font></font>
#include "foo.h"<font></font>
<font></font>
int foo(char* str) {<font></font>
	return strlen(str) * 2;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To test the library's functionality, we will write a simple </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> program </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">#include &lt;stdio.h&gt;<font></font>
<font></font>
#include "foo.h"<font></font>
<font></font>
int main(int argc, char* argv[]) {<font></font>
	char* str = "0123456789";<font></font>
	printf("%d\n", foo(str));<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For accuracy, create a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Makefile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="plaintext hljs">CC=gcc<font></font>
CFLAGS=-c<font></font>
DIR_OUT=bin<font></font>
<font></font>
all: main<font></font>
<font></font>
main: main.o libfoo.a<font></font>
	$(CC) $(DIR_OUT)/main.o -L$(DIR_OUT) -lfoo -o $(DIR_OUT)/main<font></font>
<font></font>
main.o: makedir main.c<font></font>
	$(CC) $(CFLAGS) main.c -o $(DIR_OUT)/main.o<font></font>
<font></font>
libfoo.a: makedir foo.c<font></font>
	$(CC) $(CFLAGS) foo.c -o $(DIR_OUT)/foo.o<font></font>
	ar rcs $(DIR_OUT)/libfoo.a $(DIR_OUT)/foo.o<font></font>
<font></font>
makedir:<font></font>
	mkdir -p $(DIR_OUT)<font></font>
<font></font>
clean:<font></font>
	rm -rf $(DIR_OUT)/*<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let all the sources of the library </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are located in a subfolder of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the source folder:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo_c_01 /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â””â”€â”€ foo</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â”œâ”€â”€ foo.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â”œâ”€â”€ foo.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â”œâ”€â”€ main.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â””â”€â”€ Makefile</font></font><font></font>
</pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We go into the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">and compile the sources using the command</font></font><br>
<br>
<pre><code class="bash hljs">make
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
During compilation, the text will be displayed.</font></font><br>
<br>
<pre><code class="bash hljs">mkdir -p bin<font></font>
gcc -c main.c -o bin/main.o<font></font>
gcc -c foo.c -o bin/foo.o<font></font>
ar rcs bin/libfoo.a bin/foo.o<font></font>
gcc bin/main.o -Lbin -lfoo -o bin/main<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The compilation result will be placed in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">inside the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo_c_01 /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â””â”€â”€ foo</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â”œâ”€â”€ bin</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â”‚ â”œâ”€â”€ foo.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â”‚ â”œâ”€â”€ libfoo.a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â”‚ â”œâ”€â”€ main</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â”‚ â””â”€â”€ main.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â”œâ”€â”€ foo.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â”œâ”€â”€ foo.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â”œâ”€â”€ main.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â””â”€â”€ Makefile</font></font><font></font>
</pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We compiled a library for static linking and a program that uses it under the name </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">After compilation, you can verify that the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> program </font><font style="vertical-align: inherit;">starts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's make a Python binding over the foo library.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SIP Basics</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First you need to install SIP. </font><font style="vertical-align: inherit;">This is done standardly, as with all other libraries using pip:</font></font><br>
<br>
<pre><code class="bash hljs">pip install --user sip
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, if you are working in a virtual environment, then the --user parameter, indicating that the SIP library needs to be installed in the user folder, and not globally in the system, should not be specified. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What do we need to do so that the foo library can be called from Python code? At a minimum, you need to create two files: one of them in TOML format and name it </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and the second is a file with the extension .sip. Let's deal with each of them sequentially. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We need to agree on the structure of the source. Inside the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder is the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">, which contains the source for the library. After compilation </font><font style="vertical-align: inherit;">, the </font><i><font style="vertical-align: inherit;">bin</font></i><font style="vertical-align: inherit;"> folder is created </font><font style="vertical-align: inherit;">inside the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which will contain all the compiled files. </font><font style="vertical-align: inherit;">Later we will add the ability for the user to specify the paths to the header and object files of the library through the command line. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Files required for SIP will be located in the same folder as the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pyproject.toml</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">is not an invention of SIP developers, but the Python project description format described in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEP 517 â€œA build-system independent format for source treesâ€</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEP 518 â€œSpecifying Minimum Build System Requirements for Python Projectsâ€</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . This is a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TOML file</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which can be considered as a more advanced version of the ini format, in which the parameters are stored in the form of â€œkey = valueâ€, and the parameters can be located not just in sections like [foo], which are called tables in TOML terms, but and in subsections of the form [foo.bar.spam]. Parameters can contain not only strings, but also lists, numbers, and Boolean values.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This file is supposed to describe everything that is needed to build a Python package, and not necessarily using SIP. </font><font style="vertical-align: inherit;">However, as we will see a little later, in some cases this file will not be enough, and in addition it will need to create a small Python script. </font><font style="vertical-align: inherit;">But let's talk about everything in order. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A full description of all the possible parameters of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">that are related to SIP can be found on </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the SIP documentation page</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For our example, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create the pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">at the same level as the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo_c_01 /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”œâ”€â”€ foo</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ bin</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ foo.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ libfoo.a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ main</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â””â”€â”€ main.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ foo.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ foo.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ main.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â””â”€â”€ Makefile</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â””â”€â”€ pyproject.toml</font></font><font></font>
</pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The contents of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will be as follows:</font></font><br>
<br>
<pre><code class="plaintext hljs">[build-system]<font></font>
requires = ["sip &gt;=5, &lt;6"]<font></font>
build-backend = "sipbuild.api"<font></font>
<font></font>
[tool.sip.metadata]<font></font>
name = "pyfoo"<font></font>
version = "0.1"<font></font>
license = "MIT"<font></font>
<font></font>
[tool.sip.bindings.pyfoo]<font></font>
headers = ["foo.h"]<font></font>
libraries = ["foo"]<font></font>
include-dirs = ["foo"]<font></font>
library-dirs = ["foo/bin"]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[build-system]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> section </font><font style="vertical-align: inherit;">(â€œtableâ€ in TOML terms) is standard and is described in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEP 518</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">It contains two parameters:</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requires</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - a list of packages needed to build our package. </font><font style="vertical-align: inherit;">The package dependency description format is described in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEP 508 Dependency specification for Python Software Packages</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In this case, we only need the sip package version 5.x.</font></font></li>
<li><i>build-backend</i> ,        .  ,          Python-,    .        ,   ,    SIP,     Â«sipbuild.apiÂ».</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Other parameters are described in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[tool.sip. *]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sections </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[tool.sip.metadata]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> section </font><font style="vertical-align: inherit;">contains general information about the package: the name of the package to be built (our package will be called </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but do not confuse this name with the name of the module, which we will later import into Python), the version number of the package (in our case version number â€œ0.1â€) and license (for example, â€œ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MIT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> â€). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The most important from the point of view of the assembly is described in the [tool.sip.bindings. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note the package name in the section header. </font><font style="vertical-align: inherit;">We have added two parameters to this section:</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">headers</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - a list of header files that are needed to use the foo library.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libraries</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - a list of object files compiled for static linking.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">include-dirs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is the path where to look for additional header files besides those that are attached to the C compiler. In this case, where to look for the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">library-dirs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is the path where to look for additional object files besides those that are attached to the C compiler. In this case, this is the folder in which the compiled library file </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo is created</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, we created the first necessary file for SIP. </font><font style="vertical-align: inherit;">Now we move on to creating the next file that will describe the contents of the future Python module.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pyfoo.sip</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Create the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">in the same folder as the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo_c_01 /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”œâ”€â”€ foo</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ bin</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ foo.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ libfoo.a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ main</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â””â”€â”€ main.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ foo.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ foo.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ main.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â””â”€â”€ Makefile</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”œâ”€â”€ pyfoo.sip</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â””â”€â”€ pyproject.toml</font></font><font></font>
</pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A file with the extension .sip describes the interface of the source library, which will be converted into a module in Python. </font><font style="vertical-align: inherit;">This file has its own format, which we will now consider, and resembles the C / C ++ header file with additional markup, which should help SIP create a Python module. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In our example, this file should be called </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , because before that, in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><i><font style="vertical-align: inherit;">,</font></i><font style="vertical-align: inherit;"> we created the [tool.sip.bindings. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]. In the general case, there can be several such partitions and, accordingly, there must be several * .sip files. But if we have several sip files, then this is a special case from the point of view of SIP, and we will not consider it in this article. Please note that in the general case, the name of the .sip file (and, accordingly, the name of the section) may not coincide with the name of the package, which is specified in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parameter </font><font style="vertical-align: inherit;">in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[tool.sip.metadata]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> section </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consider the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">from our example:</font></font><br>
<br>
<pre><code class="cpp hljs">%Module(name=foo, language=<span class="hljs-string">"C"</span>)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">foo</span><span class="hljs-params">(<span class="hljs-keyword">char</span>*)</span></span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lines that begin with the character "%" are called directives. They should tell SIP how to properly assemble and style the Python module. A complete list of directives is described on </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this documentation page</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Some directives have additional parameters. Parameters may not be required. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this example, we use two directives; we will get to know some other directives in the following examples. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">starts with the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Module</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> directive </font><i><font style="vertical-align: inherit;">(name = foo, language = â€œCâ€)</font></i><font style="vertical-align: inherit;"> . Please note that </font><font style="vertical-align: inherit;">we specified the </font><font style="vertical-align: inherit;">value of the first parameter ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) without quotes, and the value of the second parameter ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">language</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) with quotes, like strings in C / C ++. </font><font style="vertical-align: inherit;">This is a requirement of this directive as described in the documentation for the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Module</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> directive </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Module</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> directive, </font><font style="vertical-align: inherit;">only the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parameter is required </font><font style="vertical-align: inherit;">, which sets the name of the Python module from which we will import the library function. </font><font style="vertical-align: inherit;">In this case, the module is called </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , it will contain the function </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , so after assembly and installation we will import it using the code:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> foo <span class="hljs-keyword">import</span> foo
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We could make this module nested in another module by replacing this line, for example, with this:</font></font><br>
<br>
<pre><code class="cpp hljs">%Module(name=foo.bar, language=<span class="hljs-string">"C"</span>)<font></font>
...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then import the function </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo would</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> need to be as follows:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> foo.bar <span class="hljs-keyword">import</span> foo
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">language</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parameter </font><font style="vertical-align: inherit;">of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Module</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> directive </font><font style="vertical-align: inherit;">indicates the language in which the source library is written. </font><font style="vertical-align: inherit;">The value of this parameter can be either â€œCâ€ or â€œC ++â€. </font><font style="vertical-align: inherit;">If this parameter is not specified, then SIP will assume that the library is written in C ++. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now look at the last line of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">foo</span><span class="hljs-params">(<span class="hljs-keyword">char</span>*)</span></span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is a description of the interface of the function from the library that we want to put in the Python module. </font><font style="vertical-align: inherit;">Based on this declaration, sip will create a Python function. </font><font style="vertical-align: inherit;">I think that everything should be clear here.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We collect and check</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now everything is ready to build a Python package with a binding for a C library. First of all, you need to build the library itself. </font><font style="vertical-align: inherit;">Go to the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_01 / foo /</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">and start the build using the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make command</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="bash hljs">$ make<font></font>
<font></font>
mkdir -p bin<font></font>
gcc -c main.c -o bin/main.o<font></font>
gcc -c foo.c -o bin/foo.o<font></font>
ar rcs bin/libfoo.a bin/foo.o<font></font>
gcc bin/main.o -Lbin -lfoo -o bin/main<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If everything went well, then the </font><i><font style="vertical-align: inherit;">bin</font></i><font style="vertical-align: inherit;"> folder will be created </font><font style="vertical-align: inherit;">inside the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">, in which, among other files, there will be a compiled </font><i><font style="vertical-align: inherit;">libfoo.a</font></i><font style="vertical-align: inherit;"> library </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Let me remind you that here, in order not to be distracted from the main topic, we are only talking about building under Linux using gcc. </font><font style="vertical-align: inherit;">
Go back to the </font><i><font style="vertical-align: inherit;">pyfoo_c_01</font></i><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Now it's time to get to know the SIP teams. </font><font style="vertical-align: inherit;">After installing SIP, the following command line commands will become available ( </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">documentation page</font></a><font style="vertical-align: inherit;"> ):</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-build</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Creates a Python extension object file.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-install</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Creates a Python extension object file and installs it.</font></font></li>
<li><i>sip-sdist</i>.      .tar.gz,      pip.</li>
<li><i>sip-wheel</i>.     wheel (   .whl).</li>
<li><i>sip-module</i>.  ,      ,   SIP.  ,    ,    .         ,       standalone project,      ,     ,     ,    .</li>
<li><i>sip-distinfo</i>.     <i>.dist-info</i>,       wheel.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
These commands need to be run from the folder where the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file is </font><i><font style="vertical-align: inherit;">located</font></i><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To get started, to better understand the operation of SIP, run the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-build command</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , with the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--verbose</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> option </font><font style="vertical-align: inherit;">for more detailed output to the console, and see what happens during the build process. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
$ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-build --verbose</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
These bindings will be built: pyfoo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Generating the pyfoo bindings ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compiling the 'foo' module ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
building 'foo' extension </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
creating build </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
creating build / temp.linux-x86_64-3.8</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I. -I ../../ foo -I / usr / include / python3.8 -c sipfoocmodule.c -o build / temp.linux-x86_64-3.8 / sipfoocmodule.o </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sipfoocmodule.c: In the func_foo function: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sipfoocmodule .c: 29: 22: warning: implicit function declaration â€œfooâ€ [-Wimplicit-function-declaration] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 29 | sipRes = foo (a0); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ^ ~~</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I. -I ../../ foo -I / usr / include / python3.8 -c array.c -o build / temp.linux-x86_64-3.8 / array.o </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-unused-result -Wsign -compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I. -I ../../ foo -I / usr / include / python3.8 -c bool.cpp -o build / temp.linux-x86_64-3.8 / bool.o</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I. -I ../../ foo -I / usr / include / python3.8 -c objmap.c -o build / temp.linux-x86_64-3.8 / objmap.o </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-unused-result -Wsign -compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I. -I ../../ foo -I / usr / include / python3.8 -c qtlib.c -o build / temp.linux-x86_64-3.8 / qtlib.o</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I. -I ../../ foo -I / usr / include / python3.8 -c int_convertors.c -o build / temp.linux-x86_64-3.8 / int_convertors.o </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-unused-result -Wsign -compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I. -I ../../ foo -I / usr / include / python3.8 -c voidptr.c -o build / temp.linux-x86_64-3.8 / voidptr.o</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I. -I ../../ foo -I / usr / include / python3.8 -c apiversions.c -o build / temp.linux-x86_64-3.8 / apiversions.o </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-unused-result -Wsign -compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I. -I ../../ foo -I / usr / include / python3.8 -c descriptors.c -o build / temp.linux-x86_64-3.8 / descriptors.o</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I. -I ../../ foo -I / usr / include / python3.8 -c threads.c -o build / temp.linux-x86_64-3.8 / threads.o </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-unused-result -Wsign -compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I. -I ../../ foo -I / usr / include / python3.8 -c siplib.c -o build / temp.linux-x86_64-3.8 / siplib.o</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c: In the function "slot_richcompare": </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c: 9536: 16: warning: "st" may be used without initialization in this function [-Wmaybe-uninitialized] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 9536 | slot = findSlotInClass (ctd, st); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ^ ~~~~~~~~~~~~~~~~~~~~~~~~ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c: 10671: 19: note: â€œstâ€ was declared here </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
10671 | sipPySlotType st; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ^ ~ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c: In the function "parsePass2": </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c: 5625: 32: warning: "owner" may be used without initialization in this function [-Wmaybe-uninitialized] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 5625 | * owner = arg; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ~~~~~~~ ^ ~</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
g ++ -pthread -shared -Wl, -O1, - sort-common, - as-needed, -z, relro, -z, now -fno-semantic-interposition -Wl, -O1, - sort-common, --as-needed, -z, relro, -z, now build / temp.linux-x86_64-3.8 / sipfoocmodule.o build / temp.linux-x86_64-3.8 / array.o build / temp.linux-x86_64-3.8 /bool.o build / temp.linux-x86_64-3.8 / objmap.o build / temp.linux-x86_64-3.8 / qtlib.o build / temp.linux-x86_64-3.8 / int_convertors.o build / temp.linux-x86_64 -3.8 / voidptr.o build / temp.linux-x86_64-3.8 / apiversions.o build / temp.linux-x86_64-3.8 / descriptors.o build / temp.linux-x86_64-3.8 / threads.o build / temp.linux -x86_64-3.8 / siplib.o -L ../../ foo / bin -L / usr / lib -lfoo -o / home / jenyay / projects / soft / sip-examples / pyfoo_c_01 / build / foo / foo. cpython-38-x86_64-linux-gnu.so </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The project has been built.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will not go deep into the work of SIP, but it can be seen from the output that some sources are compiling. </font><font style="vertical-align: inherit;">These sources can be seen in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build / foo /</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder created by this command </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_01</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”œâ”€â”€ build</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â””â”€â”€ foo</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ apiversions.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ array.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ array.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ bool.cpp</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ build</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â””â”€â”€ temp.linux-x86_64-3.8</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ apiversions.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ array.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ bool.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ descriptors.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ int_convertors.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ objmap.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ qtlib.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ sipfoocmodule.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ siplib.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ threads.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â””â”€â”€ voidptr.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ descriptors.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ foo.cpython-38-x86_64-linux-gnu.so</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ int_convertors.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ objmap.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ qtlib.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ sipAPIfoo.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ sipfoocmodule.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ sip.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ sipint.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ siplib.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ threads.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â””â”€â”€ voidptr.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”œâ”€â”€ foo</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ bin</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ foo.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ libfoo.a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ main</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â””â”€â”€ main.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ foo.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ foo.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ main.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â””â”€â”€ Makefile</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”œâ”€â”€ pyfoo.sip</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â””â”€â”€ pyproject.toml</font></font><font></font>
</pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auxiliary sources appeared </font><font style="vertical-align: inherit;">
in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build / foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Out of curiosity, let's look at the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipfoocmodule.c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">, since it directly relates to the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> module </font><font style="vertical-align: inherit;">that will be created:</font></font><br>
<br>
<pre><code class="plaintext hljs">/*<font></font>
 * Module code.<font></font>
 *<font></font>
 * Generated by SIP 5.1.1<font></font>
 */<font></font>
<font></font>
#include "sipAPIfoo.h"<font></font>
<font></font>
/* Define the strings used by this module. */<font></font>
const char sipStrings_foo[] = {<font></font>
    'f', 'o', 'o', 0,<font></font>
};<font></font>
<font></font>
PyDoc_STRVAR(doc_foo, "foo(str) -&gt; int");<font></font>
<font></font>
static PyObject *func_foo(PyObject *sipSelf,PyObject *sipArgs)<font></font>
{<font></font>
    PyObject *sipParseErr = SIP_NULLPTR;<font></font>
<font></font>
    {<font></font>
        char* a0;<font></font>
<font></font>
        if (sipParseArgs(&amp;sipParseErr, sipArgs, "s", &amp;a0))<font></font>
        {<font></font>
            int sipRes;<font></font>
<font></font>
            sipRes = foo(a0);<font></font>
<font></font>
            return PyLong_FromLong(sipRes);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    /* Raise an exception if the arguments couldn't be parsed. */<font></font>
    sipNoFunction(sipParseErr, sipName_foo, doc_foo);<font></font>
<font></font>
    return SIP_NULLPTR;<font></font>
}<font></font>
<font></font>
/* This defines this module. */<font></font>
sipExportedModuleDef sipModuleAPI_foo = {<font></font>
    0,<font></font>
    SIP_ABI_MINOR_VERSION,<font></font>
    sipNameNr_foo,<font></font>
    0,<font></font>
    sipStrings_foo,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    0,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    0,<font></font>
    SIP_NULLPTR,<font></font>
    0,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    {SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR,<font></font>
            SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR},<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR<font></font>
};<font></font>
<font></font>
/* The SIP API and the APIs of any imported modules. */<font></font>
const sipAPIDef *sipAPI_foo;<font></font>
<font></font>
/* The Python module initialisation function. */<font></font>
#if defined(SIP_STATIC_MODULE)<font></font>
PyObject *PyInit_foo(void)<font></font>
#else<font></font>
PyMODINIT_FUNC PyInit_foo(void)<font></font>
#endif<font></font>
{<font></font>
    static PyMethodDef sip_methods[] = {<font></font>
        {sipName_foo, func_foo, METH_VARARGS, doc_foo},<font></font>
        {SIP_NULLPTR, SIP_NULLPTR, 0, SIP_NULLPTR}<font></font>
    };<font></font>
<font></font>
    static PyModuleDef sip_module_def = {<font></font>
        PyModuleDef_HEAD_INIT,<font></font>
        "foo",<font></font>
        SIP_NULLPTR,<font></font>
        -1,<font></font>
        sip_methods,<font></font>
        SIP_NULLPTR,<font></font>
        SIP_NULLPTR,<font></font>
        SIP_NULLPTR,<font></font>
        SIP_NULLPTR<font></font>
    };<font></font>
<font></font>
    PyObject *sipModule, *sipModuleDict;<font></font>
    /* Initialise the module and get it's dictionary. */<font></font>
    if ((sipModule = PyModule_Create(&amp;sip_module_def)) == SIP_NULLPTR)<font></font>
        return SIP_NULLPTR;<font></font>
<font></font>
    sipModuleDict = PyModule_GetDict(sipModule);<font></font>
<font></font>
    if ((sipAPI_foo = sip_init_library(sipModuleDict)) == SIP_NULLPTR)<font></font>
        return SIP_NULLPTR;<font></font>
<font></font>
    /* Export the module and publish it's API. */<font></font>
    if (sipExportModule(&amp;sipModuleAPI_foo, SIP_ABI_MAJOR_VERSION, SIP_ABI_MINOR_VERSION, 0) &lt; 0)<font></font>
    {<font></font>
        Py_DECREF(sipModule);<font></font>
        return SIP_NULLPTR;<font></font>
    }<font></font>
    /* Initialise the module now all its dependencies have been set up. */<font></font>
    if (sipInitModule(&amp;sipModuleAPI_foo,sipModuleDict) &lt; 0)<font></font>
    {<font></font>
        Py_DECREF(sipModule);<font></font>
        return SIP_NULLPTR;<font></font>
    }<font></font>
<font></font>
    return sipModule;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you worked with the Python / C API, you will see familiar functions. Pay particular attention to the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">func_foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">starting at line 18. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result of compilation of these sources, the file </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build / foo / foo.cpython-38-x86_64-linux-gnu.so</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will be created </font><font style="vertical-align: inherit;">, and it contains the Python extension, which still needs to be installed correctly. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to compile the extension and install it right away, you can use the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-install</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> command </font><font style="vertical-align: inherit;">, but we wonâ€™t use it, because by default it tries to install the created Python extension globally into the system. This command has a parameter </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--target-dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, with which you can specify the path where you want to install the extension, but we better use other tools that create packages, which can then be installed using pip. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, use the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-sdist command</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Using it is very simple:</font></font><br>
<br>
<pre><code class="bash hljs">$ sip-sdist<font></font>
<font></font>
The sdist has been built.<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After that, the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo-0.1.tar.gz</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file will be created </font><font style="vertical-align: inherit;">, which can be installed using the command:</font></font><br>
<br>
<pre><code class="bash hljs">pip install --user pyfoo-0.1.tar.gz
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, the following information will be shown and the package will be installed:</font></font><br>
<br>
<pre><code class="plaintext hljs">Processing ./pyfoo-0.1.tar.gz<font></font>
  Installing build dependencies ... done<font></font>
  Getting requirements to build wheel ... done<font></font>
    Preparing wheel metadata ... done<font></font>
Building wheels for collected packages: pyfoo<font></font>
  Building wheel for pyfoo (PEP 517) ... done<font></font>
  Created wheel for pyfoo: filename=pyfoo-0.1-cp38-cp38-manylinux1_x86_64.whl size=337289 sha256=762fc578...<font></font>
  Stored in directory: /home/jenyay/.cache/pip/wheels/54/dc/d8/cc534fff...<font></font>
Successfully built pyfoo<font></font>
Installing collected packages: pyfoo<font></font>
  Attempting uninstall: pyfoo<font></font>
    Found existing installation: pyfoo 0.1<font></font>
    Uninstalling pyfoo-0.1:<font></font>
      Successfully uninstalled pyfoo-0.1<font></font>
Successfully installed pyfoo-0.1<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's make sure that we managed to make a Python binding. </font><font style="vertical-align: inherit;">We start Python and try to call the function. </font><font style="vertical-align: inherit;">Let me remind you that according to our settings, the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> package </font><font style="vertical-align: inherit;">contains the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> module </font><font style="vertical-align: inherit;">, which has the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> foo <span class="hljs-keyword">import</span> foo
<span class="hljs-meta">&gt;&gt;&gt; </span>foo(<span class="hljs-string">b'123456'</span>)
<span class="hljs-number">12</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Please note that as a parameter to the function, we pass not just a string, but a byte string b'123456 '- a direct analogue of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to C. A little later, we will add the conversion of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and vice versa. The result was expected. Let me remind you that the function </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> returns the double size of an array of type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , passed to it as a parameter. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's try passing a </font><font style="vertical-align: inherit;">regular Python string </font><font style="vertical-align: inherit;">to the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">instead of a list of bytes.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> foo <span class="hljs-keyword">import</span> foo
<span class="hljs-meta">&gt;&gt;&gt; </span>foo(<span class="hljs-string">'123456'</span>)<font></font>
<font></font>
Traceback (most recent call last):<font></font>
  File <span class="hljs-string">"&lt;stdin&gt;"</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<font></font>
TypeError: foo(str): argument <span class="hljs-number">1</span> has unexpected type <span class="hljs-string">'str'</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The created binding was unable to convert the string to </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; we will discuss how to teach it how to do this in the next section. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Congratulations, we made the first binding on a library written in C. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exit the Python interpreter and assemble the assembly in wheel format. As you most likely know, wheel is a relatively new package format that has been used universally recently. The format is described in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEP 427, â€œThe Wheel Binary Package Format 1.0,â€</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> but a description of the features of the wheel format is a topic worthy of a separate large article. It is important for us that the user can easily install the package in wheel format using pip. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A package in wheel format is no more complicated than a package in sdist format. To do this, in the folder with the file</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> need to execute the command</font></font><br>
<br>
<pre><code class="bash hljs">sip-wheel
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After running this command, the build process will be shown and there may be warnings from the compiler: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
$ sip-wheel </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
These bindings will be built: pyfoo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Generating the pyfoo bindings ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compiling the 'foo' module ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sipfoocmodule.c: In the func_foo function: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sipfoocmodule.c: 29:22: warning: implicit declaration of the foo function [-Wimplicit-function-declaration] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 29 | sipRes = foo (a0); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ^ ~~ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c: In the function "slot_richcompare": </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c: 9536: 16: warning: "st" may be used without initialization in this function [-Wmaybe-uninitialized] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 9536 | slot = findSlotInClass (ctd, st); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ^ ~~~~~~~~~~~~~~~~~~~~~~~~ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c: 10671: 19: remark: â€œstâ€ was declared here</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
10671 | sipPySlotType st; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ^ ~ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c: In the function "parsePass2": </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c: 5625: 32: warning: "owner" may be used without initialization in this function [-Wmaybe-uninitialized] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 5625 | * owner = arg; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ~~~~~~~ ^ ~ ~ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The wheel has been built. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When the assembly is completed (our small project compiles quickly), a file with the name </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo-0.1-cp38-cp38-manylinux1_x86_64.whl</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or similar </font><font style="vertical-align: inherit;">will appear in the project folder </font><font style="vertical-align: inherit;">. The name of the generated file may differ depending on your operating system and version of Python. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we can install this package using pip:</font></font><br>
<br>
<pre><code class="bash hljs">pip install --user --upgrade pyfoo-0.1-cp38-cp38-manylinux1_x86_64.whl
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--upgrade</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> option is used </font><i><font style="vertical-align: inherit;">here</font></i><font style="vertical-align: inherit;"> so that pip replaces the pyfoo module installed earlier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Further, the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> module </font><font style="vertical-align: inherit;">and the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> package </font><font style="vertical-align: inherit;">can be used, as shown above.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Add conversion rules to char *</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the previous section, we encountered a problem that the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">can only accept a set of bytes, but not strings. Now we will fix this shortcoming. To do this, we will use another SIP tool - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">annotations</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Annotations are used inside .sip files and are applied to some code elements: functions, classes, function arguments, exceptions, variables, etc. Annotations are written between forward slashes: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ annotation /</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An annotation can work as a flag, which can be in the state set or not set, for example: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ ReleaseGIL /</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , or some annotations need to be assigned some values, for example: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ Encoding = "UTF-8" /</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. If several annotations need to be applied to some object, then they are separated by commas inside slashes: / annotation_1, annotation_2 /. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the following example, which is located in the folder </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_02</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , add a file </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> annotation parameter function </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="plaintext hljs">%Module(name=foo, language="C")<font></font>
<font></font>
int foo(char* /Encoding="UTF-8"/);<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> annotation </font><font style="vertical-align: inherit;">indicates in which encoding the string to be passed to the function should be encoded. The values â€‹â€‹for this annotation may be: ASCII, Latin-1, UTF-8, or None. If the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> annotation is </font><font style="vertical-align: inherit;">not specified or equal to </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">None</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , then the parameter for such a function is not subjected to any encoding and is passed to the function as is, but in this case the parameter in Python code must be of type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bytes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , i.e. an array of bytes, as we saw in the previous example. If the encoding is specified, then this parameter can be a string (type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in Python). </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> annotation </font><font style="vertical-align: inherit;">can only be applied to parameters of type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's check how the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">from the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> module </font><font style="vertical-align: inherit;">now works </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">To do this, as before, you must first compile the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> library by </font><font style="vertical-align: inherit;">invoking </font><font style="vertical-align: inherit;">the </font><i><font style="vertical-align: inherit;">make</font></i><font style="vertical-align: inherit;"> command </font><font style="vertical-align: inherit;">inside the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">, and then </font><font style="vertical-align: inherit;">call the command, for example, </font><i><font style="vertical-align: inherit;">sip-wheel,</font></i><font style="vertical-align: inherit;"> from the </font><i><font style="vertical-align: inherit;">pyfoo_c_02</font></i><font style="vertical-align: inherit;"> example folder </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The file </font><i><font style="vertical-align: inherit;">pyfoo-0.2-cp38-cp38-manylinux1_x86_64.whl</font></i><font style="vertical-align: inherit;"> or with a similar name </font><font style="vertical-align: inherit;">will be created </font><font style="vertical-align: inherit;">, which can be set using the command:</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="bash hljs">pip install --user --upgrade pyfoo-0.2-cp38-cp38-manylinux1_x86_64.whl
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If everything went well, start the Python interpreter and try to call the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">with a string argument:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> foo <span class="hljs-keyword">import</span> foo<font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>foo(<span class="hljs-string">b'qwerty'</span>)
<span class="hljs-number">12</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>foo(<span class="hljs-string">'qwerty'</span>)
<span class="hljs-number">12</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>foo(<span class="hljs-string">''</span>)
<span class="hljs-number">24</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, we make sure that using </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bytes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is still possible. After that, we make sure that now we can pass </font><font style="vertical-align: inherit;">string arguments </font><font style="vertical-align: inherit;">to the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">as well. Note that the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">for a string argument with Russian letters returned a value twice as large as for a string containing only Latin letters. This happened because the function </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> does not count the string length in characters (and doubles it), but the length of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> array </font><font style="vertical-align: inherit;">, and since in UTF-8 encoding Russian letters occupy 2 bytes, then the size of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> array </font><font style="vertical-align: inherit;">after conversion from Python strings turned out to be twice as long. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fine! We solved the problem with the function argument</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but what if we have dozens or hundreds of such functions in our library, will you have to specify the parameter encoding for each of them? Often the encoding used in a program is the same, and there is no purpose for different functions to indicate different encodings. In this case, SIP has the ability to specify the default encoding, and if for some function the encoding needs some other, then it can be redefined using the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> annotation </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To set the encoding of function parameters by default, the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% DefaultEncoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> directive is </font><i><font style="vertical-align: inherit;">used</font></i><font style="vertical-align: inherit;"> . Its use is shown in the example located in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_03</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to take advantage of directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% DefaultEncoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , change the file </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, now its contents are as follows:</font></font><br>
<br>
<pre><code class="plaintext hljs">%Module(name=foo, language="C")<font></font>
%DefaultEncoding "UTF-8"<font></font>
<font></font>
int foo(char*);<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now, if the argument is a function of type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , etc. </font><font style="vertical-align: inherit;">If </font><font style="vertical-align: inherit;">there is no </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> annotation </font><font style="vertical-align: inherit;">, then the encoding is taken from the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% DefaultEncoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> directive </font><font style="vertical-align: inherit;">, and if it is not, then the conversion is not performed, and for all parameters </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , etc. </font><font style="vertical-align: inherit;">it is necessary to transfer not lines, but </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bytes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An example from the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_03</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><i><font style="vertical-align: inherit;">is</font></i><font style="vertical-align: inherit;"> collected and verified in the same way as an example from the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_02</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Briefly about project.py. </font><font style="vertical-align: inherit;">Automate assembly</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So far, we have used two utility files to create a Python binding - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Now we will get acquainted with another such file, which should be called </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . With this script, we can influence the build process of our package. Let's do the build automation. In order to collect the examples </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_01</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_03</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> from the previous sections, you had to first go to the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo /</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">, compile there using the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make command</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , return to the folder where the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file is </font><i><font style="vertical-align: inherit;">located,</font></i><font style="vertical-align: inherit;"> and only then start building the package using one of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip- *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> commands </font><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now our goal is to make sure that when executing the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-build</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-sdist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-wheel </font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">commands</font></i><font style="vertical-align: inherit;"> , the assembly of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C-library is started first </font><font style="vertical-align: inherit;">, and then the command itself is already launched. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An example created in this section is located in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_04</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> source </font><font style="vertical-align: inherit;">folder </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To change the build process, we can </font><font style="vertical-align: inherit;">declare a class </font><font style="vertical-align: inherit;">in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">(the file name should be just that) that is derived from the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipbuild.Project</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> class </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">This class has methods that we can override on our own. </font><font style="vertical-align: inherit;">Currently we are interested in the following methods:</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Called during the call to the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-build command</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build_sdist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Called when the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-sdist command is called</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build_wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Called when the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> command is called </font><font style="vertical-align: inherit;">.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">install</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Called when the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-install</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> command is invoked </font><font style="vertical-align: inherit;">.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That is, we can redefine the behavior of these commands. </font><font style="vertical-align: inherit;">Strictly speaking, the listed methods are declared in the abstract class </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipbuild.AbstractProject</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , from which the derived class </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipbuild.Project</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is created </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Create a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">with the following contents:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> subprocess<font></font>
<font></font>
<span class="hljs-keyword">from</span> sipbuild <span class="hljs-keyword">import</span> Project<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FooProject</span>(<span class="hljs-params">Project</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_build_foo</span>(<span class="hljs-params">self</span>):</span>
        cwd = os.path.abspath(<span class="hljs-string">'foo'</span>)<font></font>
        subprocess.run([<span class="hljs-string">'make'</span>], cwd=cwd, capture_output=<span class="hljs-literal">True</span>, check=<span class="hljs-literal">True</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build</span>(<span class="hljs-params">self</span>):</span><font></font>
        self._build_foo()<font></font>
        super().build()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_sdist</span>(<span class="hljs-params">self, sdist_directory</span>):</span><font></font>
        self._build_foo()<font></font>
        <span class="hljs-keyword">return</span> super().build_sdist(sdist_directory)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_wheel</span>(<span class="hljs-params">self, wheel_directory</span>):</span><font></font>
        self._build_foo()<font></font>
        <span class="hljs-keyword">return</span> super().build_wheel(wheel_directory)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">install</span>(<span class="hljs-params">self</span>):</span><font></font>
        self._build_foo()<font></font>
        super().install()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We declared the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FooProject</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> class </font><font style="vertical-align: inherit;">, derived from the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipbuild.Project</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> class </font><i><font style="vertical-align: inherit;">,</font></i><font style="vertical-align: inherit;"> and </font><i><font style="vertical-align: inherit;">defined the</font></i><font style="vertical-align: inherit;"> methods </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build_sdist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build_wheel,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">install in it</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . In all these methods, we call the methods of the same name from the base class, before calling the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_build_foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">, which starts the execution of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make command</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note that the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build_sdist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build_wheel methods</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> should return the name of the file they created. This is not written in the documentation, but is indicated in the SIP sources. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we do not need to run the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make command</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">manually to build the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> library </font><font style="vertical-align: inherit;">, this will be done automatically. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you now </font><font style="vertical-align: inherit;">run the </font><i><font style="vertical-align: inherit;">sip-wheel</font></i><font style="vertical-align: inherit;"> command </font><font style="vertical-align: inherit;">in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_04</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">, a file is created with the name pyfoo-0.4-cp38-cp38-manylinux1_x86_64.whl or similar depending on your operating system and version of Python. </font><font style="vertical-align: inherit;">
This package can be installed using the command:</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="bash hljs">pip install --user --upgrade pyfoo-0.4-cp38-cp38-manylinux1_x86_64.whl
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After that, you can make sure that the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">from the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> module </font><font style="vertical-align: inherit;">still works.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Add command line options to build</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The following example is in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_05</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">, and the package has a version number of 0.5 (see the settings in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">). This example is based on an </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example from the documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with some corrections. In this example, we will redo our </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">and add new command line options for the build. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In our examples, we are building a very simple library </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and in real projects, the library can be quite large and then it will not make sense to include it in the source code of the Python binding project. Let me remind you that SIP was originally created to create a binding for such a huge library as Qt. You can, of course, argue that submodules from git can help organize the source, but thatâ€™s not the point. Suppose that the library may not be in the folder with the binding source. In this case, the question arises, where should the SIP collector look for the library header and object files? In this case, different users may have their own ways of placing the library. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To solve this problem, we will add two new command-line options to the build system, with which you can specify the path to the file </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (parameter </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--foo-include-dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) and to the library object file (parameter </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--foo-library-dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). In addition, we will assume that if these parameters are not specified, then the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> library </font><font style="vertical-align: inherit;">is still located along with the binding sources. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We need to create the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file again </font><font style="vertical-align: inherit;">, and in it declare a class derived from </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipbuild.Project</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Let's look at the new version of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file first </font><font style="vertical-align: inherit;">, and then </font><font style="vertical-align: inherit;">see </font><font style="vertical-align: inherit;">how it works.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> os<font></font>
<font></font>
<span class="hljs-keyword">from</span> sipbuild <span class="hljs-keyword">import</span> Option, Project<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FooProject</span>(<span class="hljs-params">Project</span>):</span>
    <span class="hljs-string">"""        
       foo.
    """</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_options</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-string">"""     . """</span><font></font>
<font></font>
        tools = [<span class="hljs-string">'build'</span>, <span class="hljs-string">'install'</span>, <span class="hljs-string">'sdist'</span>, <span class="hljs-string">'wheel'</span>]<font></font>
<font></font>
        <span class="hljs-comment">#   .</span><font></font>
        options = super().get_options()<font></font>
<font></font>
        <span class="hljs-comment">#   </span>
        inc_dir_option = Option(<span class="hljs-string">'foo_include_dir'</span>,<font></font>
                                help=<span class="hljs-string">"the directory containing foo.h"</span>,<font></font>
                                metavar=<span class="hljs-string">"DIR"</span>,<font></font>
                                default=os.path.abspath(<span class="hljs-string">'foo'</span>),<font></font>
                                tools=tools)<font></font>
        options.append(inc_dir_option)<font></font>
<font></font>
        lib_dir_option = Option(<span class="hljs-string">'foo_library_dir'</span>,<font></font>
                                help=<span class="hljs-string">"the directory containing the foo library"</span>,<font></font>
                                metavar=<span class="hljs-string">"DIR"</span>,<font></font>
                                default=os.path.abspath(<span class="hljs-string">'foo/bin'</span>),<font></font>
                                tools=tools)<font></font>
<font></font>
        options.append(lib_dir_option)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> options<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">apply_user_defaults</span>(<span class="hljs-params">self, tool</span>):</span>
        <span class="hljs-string">"""    . """</span><font></font>
<font></font>
        <span class="hljs-comment">#     </span><font></font>
        super().apply_user_defaults(tool)<font></font>
<font></font>
        <span class="hljs-comment">#  ,         </span><font></font>
        self.foo_include_dir = os.path.abspath(self.foo_include_dir)<font></font>
        self.foo_library_dir = os.path.abspath(self.foo_library_dir)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, tool</span>):</span>
        <span class="hljs-string">"""   . """</span><font></font>
<font></font>
        <span class="hljs-comment">#   pyfoo</span>
        <span class="hljs-comment"># (  pyproject.toml  [tool.sip.bindings.pyfoo])</span>
        foo_bindings = self.bindings[<span class="hljs-string">'pyfoo'</span>]<font></font>
<font></font>
        <span class="hljs-comment">#   include_dirs  </span>
        <span class="hljs-keyword">if</span> self.foo_include_dir <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            foo_bindings.include_dirs = [self.foo_include_dir]<font></font>
<font></font>
        <span class="hljs-comment">#   library_dirs  </span>
        <span class="hljs-keyword">if</span> self.foo_library_dir <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            foo_bindings.library_dirs = [self.foo_library_dir]<font></font>
<font></font>
        super().update(tool)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We again created the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FooProject</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> class </font><font style="vertical-align: inherit;">, derived from </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipbuild.Project</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . In this example, the automatic assembly of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> library is disabled </font><font style="vertical-align: inherit;">, because now it is assumed that it can be in some other place, and by the time the binding is created, the header and object files should be ready. </font><font style="vertical-align: inherit;">Three methods are redefined </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FooProject</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> class </font><font style="vertical-align: inherit;">: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_user_defaults,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">update</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Consider them more carefully. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's start with the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">. This method should return a list of instances of the </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">sipbuild.Option</font></a><font style="vertical-align: inherit;"> class</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Each list item is a command line option. Inside the overridden method, we get the list of default </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">options</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (the </font><i><font style="vertical-align: inherit;">options</font></i><font style="vertical-align: inherit;"> variable </font><font style="vertical-align: inherit;">) by calling the base class method of the same name, then create two new options ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--foo_include_dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--foo_library_dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) and add them to the list, and then return this list from the function. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The constructor of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> class </font><font style="vertical-align: inherit;">accepts one required parameter (option name) and a sufficiently large number of optional ones that describe the type of value for this parameter, default value, parameter description, and some others. This example uses the following options for the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> constructor </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<ul>
<li><i>help</i>   ,   ,     <i>sip-wheel -h</i></li>
<li><i>metavar</i> â€”  ,    ,       .     <i>metavar</i>  Â«DIRÂ»,   ,     â€” .</li>
<li><i>default</i> â€”     .    ,          ,   <i>foo</i>   ,      (    ).</li>
<li><i>tools</i> â€”  ,        .        <i>sip-build</i>, <i>sip-install</i>, <i>sip-sdist</i>  <i>sip-wheel</i>,  tools = ['build', 'install', 'sdist', 'wheel'].</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The following overloaded </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_user_defaults</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><i><font style="vertical-align: inherit;">is</font></i><font style="vertical-align: inherit;"> designed to set parameter values â€‹â€‹that the user can pass through the command line. The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_user_defaults</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">from the base class creates a </font><font style="vertical-align: inherit;">variable (class member) </font><font style="vertical-align: inherit;">for each command line parameter created in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">, so it is important to call the base class method of the same name before using the created variables so that all variables created using the command line parameters are created and initialized with default values . After that, in our example, the variables </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.foo_include_dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font><i><font style="vertical-align: inherit;">self.foo_library_dir</font></i><font style="vertical-align: inherit;"> will be created</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. If the user has not specified the corresponding command line parameters, then they will take default values â€‹â€‹according to the parameters of the constructor of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> class </font><font style="vertical-align: inherit;">( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">default</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parameter </font><font style="vertical-align: inherit;">). If the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">default</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parameter is </font><font style="vertical-align: inherit;">not set, then depending on the type of the expected parameter value, it will be initialized either None, or an empty list, or 0. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inside the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_user_defaults</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method, </font><i><font style="vertical-align: inherit;">we</font></i><font style="vertical-align: inherit;"> make sure that the paths in the variables </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.foo_include_dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.foo_library_dir are</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> always absolute. This is necessary so that it does not depend on what the working folder will be at the time the assembly starts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The last overloaded method in this class is </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">update.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. This method is called when it is necessary to apply to the project the changes made before this. For example, change or add the parameters specified in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">. In the previous examples, we set the paths to the header and object files using the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">include-dirs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">library-dirs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parameters, </font><font style="vertical-align: inherit;">respectively, inside the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[tool.sip.bindings.pyfoo]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> section </font><font style="vertical-align: inherit;">. Now we will set these parameters from the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> script </font><font style="vertical-align: inherit;">, so in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">we will </font><font style="vertical-align: inherit;">remove these parameters:</font></font><br>
<br>
<pre><code class="plaintext hljs">[build-system]<font></font>
requires = ["sip &gt;=5, &lt;6"]<font></font>
build-backend = "sipbuild.api"<font></font>
<font></font>
[tool.sip.metadata]<font></font>
name = "pyfoo"<font></font>
version = "0.3"<font></font>
license = "MIT"<font></font>
<font></font>
[tool.sip.bindings.pyfoo]<font></font>
headers = ["foo.h"]<font></font>
libraries = ["foo"]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inside the method </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">update</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> us from the dictionary </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.bindings</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> keyed </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gat instance </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipbuild.Bindings</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . The key name corresponds to the [tool.sip.bindings. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ] from the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">, and the class instance thus obtained describes the settings described in this section. Then, the members of this class </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">include_dirs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">library_dirs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (the names of the members correspond to the parameters </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">include-dirs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">library-dirs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with a hyphen replaced by underscores) are assigned lists containing the paths stored in the members </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.foo_include_dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.foo_library_dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. In this example, for accuracy, we check that the values </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.foo_include_dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.foo_library_dir are</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> not equal to </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">None</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but in this example this condition is always fulfilled because the command line parameters we created have default values. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, we prepared the configuration files so that during the assembly it was possible to indicate the paths to the header and object files. Let's check what happened. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, make sure that the default values â€‹â€‹work. To do this, go to the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_05 / foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">and build the library using the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make command</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , since we disabled the automatic library build in this example. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After that, go to the folder</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_05</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and run the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> command </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">As a result of this command, the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo-0.5-cp38-cp38-manylinux1_x86_64.whl file</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or with a similar name </font><font style="vertical-align: inherit;">will be created </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now move the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">somewhere outside the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_05</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">and run the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> command again </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">As a result, we get the expected error informing that we do not have an object library file:</font></font><br>
<br>
<pre><code class="plaintext hljs">usr/bin/ld:   -lfoo<font></font>
collect2: :  ld     1<font></font>
sip-wheel: Unable to compile the 'foo' module: command 'g++' failed with exit status 1<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After that, run </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> using the new command-line option:</font></font><br>
<br>
<pre><code class="bash hljs">sip-wheel --foo-include-dir <span class="hljs-string">".../foo"</span> --foo-library-dir <span class="hljs-string">".../foo/bin"</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instead of the ellipsis, you need to specify the path to the folder where you moved the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">with the assembled library. </font><font style="vertical-align: inherit;">As a result, the assembly should succeed in creating the .whl file. </font><font style="vertical-align: inherit;">The created module can be installed and tested in the same way as in the previous sections.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Check the order of calling methods from project.py</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The next example, which we will consider, will be very simple; it will demonstrate the order of calling the methods of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Project</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> class </font><font style="vertical-align: inherit;">, which we overloaded in the previous sections. This can be useful in order to understand when variables can be initialized. This example is located in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_06</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">in the source repository. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The essence of this example is to </font><font style="vertical-align: inherit;">overload all the methods that we used before </font><font style="vertical-align: inherit;">in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FooProject</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> class </font><font style="vertical-align: inherit;">, which is located in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">, and add calls to the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function to them </font><font style="vertical-align: inherit;">, which would display the name of the method in which it is located:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> sipbuild <span class="hljs-keyword">import</span> Project<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FooProject</span>(<span class="hljs-params">Project</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_options</span>(<span class="hljs-params">self</span>):</span>
        print(<span class="hljs-string">'get_options()'</span>)<font></font>
        options = super().get_options()<font></font>
        <span class="hljs-keyword">return</span> options<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">apply_user_defaults</span>(<span class="hljs-params">self, tool</span>):</span>
        print(<span class="hljs-string">'apply_user_defaults()'</span>)<font></font>
        super().apply_user_defaults(tool)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">apply_nonuser_defaults</span>(<span class="hljs-params">self, tool</span>):</span>
        print(<span class="hljs-string">'apply_nonuser_defaults()'</span>)<font></font>
        super().apply_nonuser_defaults(tool)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, tool</span>):</span>
        print(<span class="hljs-string">'update()'</span>)<font></font>
        super().update(tool)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build</span>(<span class="hljs-params">self</span>):</span>
        print(<span class="hljs-string">'build()'</span>)<font></font>
        super().build()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_sdist</span>(<span class="hljs-params">self, sdist_directory</span>):</span>
        print(<span class="hljs-string">'build_sdist()'</span>)
        <span class="hljs-keyword">return</span> super().build_sdist(sdist_directory)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_wheel</span>(<span class="hljs-params">self, wheel_directory</span>):</span>
        print(<span class="hljs-string">'build_wheel()'</span>)
        <span class="hljs-keyword">return</span> super().build_wheel(wheel_directory)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">install</span>(<span class="hljs-params">self</span>):</span>
        print(<span class="hljs-string">'install()'</span>)<font></font>
        super().install()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Attentive readers should note that in addition to the previously used methods, the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_nonuser_defaults ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">, which we have not talked about before </font><font style="vertical-align: inherit;">, is overloaded in this example </font><font style="vertical-align: inherit;">. This method recommends setting default values â€‹â€‹for all variables that cannot be changed through command line parameters. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><i><font style="vertical-align: inherit;">,</font></i><font style="vertical-align: inherit;"> return the explicit path to the library:</font></font><br>
<br>
<pre><code class="plaintext hljs">[build-system]<font></font>
requires = ["sip &gt;=5, &lt;6"]<font></font>
build-backend = "sipbuild.api"<font></font>
<font></font>
[tool.sip.metadata]<font></font>
name = "pyfoo"<font></font>
version = "0.4"<font></font>
license = "MIT"<font></font>
<font></font>
[tool.sip.bindings.pyfoo]<font></font>
headers = ["foo.h"]<font></font>
libraries = ["foo"]<font></font>
include-dirs = ["foo"]<font></font>
library-dirs = ["foo/bin"]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For the project </font><font style="vertical-align: inherit;">to build </font><font style="vertical-align: inherit;">successfully, you need to go into the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">and build the library there using the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make command</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . After that, return to the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_06</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">and run, for example, the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> command </font><font style="vertical-align: inherit;">. As a result, if you discard the compiler warnings, the following text will be displayed: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options () </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_nonuser_defaults () </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options () </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options () </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_user_defaults () </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options () </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">update ()</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
These bindings will be built: pyfoo. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build_wheel ()</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Generating the pyfoo bindings ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compiling the 'foo' module ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The wheel has been built.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bold lines are displayed that are output from our </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">. Thus, we see that the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><i><font style="vertical-align: inherit;">is</font></i><font style="vertical-align: inherit;"> called several times, and this must be taken into account if you are going to initialize any member variable in the class that is derived from </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Project</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">is not the best place for this. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is also useful to remember that the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_nonuser_defaults</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><i><font style="vertical-align: inherit;">is</font></i><font style="vertical-align: inherit;"> called before the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_user_defaults</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">, i.e. in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_user_defaults</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><i><font style="vertical-align: inherit;">it is</font></i><font style="vertical-align: inherit;"> already possible to use variables whose values â€‹â€‹are set in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_nonuser_defaults</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After that, the </font><i><font style="vertical-align: inherit;">update</font></i><font style="vertical-align: inherit;"> method is called</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and at the very end, the method directly responsible for the assembly, in our case, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build_wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Conclusion to the first part</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article, we began to study the SIP tool designed to create Python bindings for libraries written in C or C ++. In this first part of the article, we examined the basics of using SIP using the example of creating a Python binding for a very simple library written in C. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We figured out the files that you need to create to work with SIP. The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">contains information about the package (name, version number, license, and paths to header and object files). Using the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file, </font><font style="vertical-align: inherit;">you can influence the build process of the Python package, for example, start building the C-library or let the user specify the location of the header and object files of the library. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the </font><i><font style="vertical-align: inherit;">* .sip</font></i><font style="vertical-align: inherit;"> file</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">describes the interface of the Python module listing the functions and classes that will be contained in the module. </font><font style="vertical-align: inherit;">Directives and annotations are used </font><font style="vertical-align: inherit;">to describe the interface in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* .sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the second part of the article, we will create a binding over an object-oriented library written in C ++, and by its example we will study techniques that will be useful in describing the interface of C ++ classes, and at the same time we will deal with new directives and annotations for us. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To be continued.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> References</font></font></h2><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Examples for this article</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SIP Homepage</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Documentation for SIP</font></font></a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en495468/index.html">Price tag recognition algorithm that works even on data collection terminals</a></li>
<li><a href="../en495472/index.html">Switching to vegetarianism will not prevent people from becoming infected from diseases like COVID-19</a></li>
<li><a href="../en495474/index.html">DataGrip 2020.1: Launch configurations, export to Excel, results in the editor and more</a></li>
<li><a href="../en495476/index.html">Why the Atari DeepMind AI success is disappointing</a></li>
<li><a href="../en495478/index.html">Big and small data tester: trends, theory, my story</a></li>
<li><a href="../en495484/index.html">How Unix pipelines are implemented</a></li>
<li><a href="../en495486/index.html">New Threats to Confidential Data: Acronis Global Survey Results</a></li>
<li><a href="../en495490/index.html">Testing and QA section at the DUMP 2020 conference. What to expect this year? Spoiler: a pair of painkillers and cherries</a></li>
<li><a href="../en495492/index.html">Unreal Engine 4 iOS Game Release Features</a></li>
<li><a href="../en495494/index.html">Creating an additional kube-scheduler with a custom set of planning rules</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>