<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòë üò• ü§ôüèæ Blitz.Engine: Sistema de ativos üë∂üèæ üë©üèº‚Äçü§ù‚Äçüë®üèø üí†</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Antes de entendermos como o sistema de ativos do mecanismo Blitz.Engine funciona , precisamos decidir o que √© ativo e o que exatamente queremos dizer ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Blitz.Engine: Sistema de ativos</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498300/"><img src="https://habrastorage.org/webt/yk/rv/sv/ykrvsv2-nadxe5rvvs7gj8iw-9w.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de entendermos como o sistema de ativos do mecanismo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blitz.Engine funciona</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , precisamos decidir o que √© ativo e o que exatamente queremos dizer com sistema de ativos. Segundo a Wikipedia, um ativo de jogo √© um objeto digital, consistindo principalmente dos mesmos dados, uma entidade indivis√≠vel que representa parte do conte√∫do do jogo e possui certas propriedades. Do ponto de vista do modelo de programa, um ativo pode aparecer como um objeto criado em algum conjunto de dados. Os ativos podem ser armazenados como um arquivo separado. Por sua vez, um sistema de ativos √© um monte de c√≥digo de programa respons√°vel por carregar e operar ativos de v√°rios tipos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De fato, o sistema de ativos √© uma grande parte do mecanismo de jogo, que pode se tornar um assistente leal para desenvolvedores de jogos ou transformar suas vidas em um inferno. </font><font style="vertical-align: inherit;">Na minha opini√£o, a decis√£o l√≥gica foi concentrar esse "inferno" em um s√≥ lugar, protegendo cuidadosamente outros desenvolvedores da equipe. </font><font style="vertical-align: inherit;">Vamos falar sobre o que fizemos nesta s√©rie de artigos - vamos l√°!</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artigos planejados sobre o t√≥pico:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Declara√ß√£o de requisitos e vis√£o geral da arquitetura</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ciclo de vida do ativo</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vis√£o geral detalhada da classe AssetManager</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Integra√ß√£o no ECS</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GlobalAssetCache</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Requisitos e Motivos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os requisitos do sistema de carregamento de ativos nasceram entre uma rocha e um local dif√≠cil. </font><font style="vertical-align: inherit;">Uma bigorna era o desejo de fazer algo fechado em si mesmo, para que funcionasse sem escrever c√≥digo externo. </font><font style="vertical-align: inherit;">Bem, ou quase sem escrever c√≥digo externo. </font><font style="vertical-align: inherit;">O martelo se tornou realidade. </font><font style="vertical-align: inherit;">E aqui est√° o que acabamos com:</font></font><br>
<br>
<ol>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gerenciamento autom√°tico de mem√≥ria</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o que significa que n√£o h√° necessidade de chamar a fun√ß√£o de libera√ß√£o do ativo. </font><font style="vertical-align: inherit;">Ou seja, assim que todos os objetos externos que usam o ativo s√£o destru√≠dos, o ativo √© destru√≠do. </font><font style="vertical-align: inherit;">A motiva√ß√£o aqui √© simples - escreva menos c√≥digo. </font><font style="vertical-align: inherit;">Menos c√≥digo significa menos erros.</font></font></li>
<li><i> <b></b>  </i>,           (    AssetManager‚Äôa).   ,      .   ‚Äî      .       ,     ¬´¬ª    .<br>
    ,      ,       ().       ‚Äî    ,  . ,     ,              .         ,      ,    .        ,   ,    .</li>
<li><i>   </i>      .  :        .         ,         .</li>
<li><i> (shared)  </i>. ,         .  ,    .           ¬´¬ª ,               .</li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Priorize o carregamento de ativos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Existem apenas tr√™s n√≠veis de prioridade: Alto, M√©dio, Baixo. </font><font style="vertical-align: inherit;">Dentro da mesma prioridade, os ativos s√£o carregados na ordem da solicita√ß√£o. </font><font style="vertical-align: inherit;">Imagine uma situa√ß√£o: um jogador clica em "Para batalhar" e o carregamento do n√≠vel come√ßa. </font><font style="vertical-align: inherit;">Junto com isso, a tarefa de preparar o sprite da tela de carregamento cai na fila de download. </font><font style="vertical-align: inherit;">Mas como alguns dos ativos de n√≠vel entraram na fila antes do sprite, o jogador olha para a tela preta por algum tempo.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, formulamos uma regra simples para n√≥s mesmos: "Tudo o que pode ser feito no thread do AssetManager deve ser feito no thread do AssetManager". </font><font style="vertical-align: inherit;">Por exemplo, preparando uma parti√ß√£o da paisagem e textura das normais com base em um mapa de altura, vinculando um programa GPU, etc.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alguns detalhes de implementa√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de come√ßarmos a entender como o sistema de carregamento de ativos funciona, precisamos nos familiarizar com duas classes amplamente usadas no mecanismo Blitz.Engine:</font></font><br>
<br>
<ul>
<li><code>Type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: informa√ß√µes de tempo de execu√ß√£o sobre algum tipo. </font><font style="vertical-align: inherit;">Esse tipo √© semelhante ao tipo </font></font><code>Type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">da linguagem C #, com a exce√ß√£o de que n√£o fornece acesso aos campos e m√©todos do tipo. </font><font style="vertical-align: inherit;">Cont√©m: nome do tipo, v√°rios sinais como </font></font><code>is_floating, is_pointer, is_const</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etc. </font><font style="vertical-align: inherit;">O m√©todo </font></font><code>Type::instance&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retorna uma constante em um lan√ßamento de aplicativo </font></font><code>const Type*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o que permite que voc√™ fa√ßa verifica√ß√µes no formul√°rio</font></font><code>if (type == Type::instance&lt;T&gt;())</code></li>
<li><code>Any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: permite empacotar o valor de qualquer tipo m√≥vel ou copi√°vel. </font><font style="vertical-align: inherit;">O conhecimento de que tipo √© empacotado √© </font></font><code>Any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">armazenado como const </font></font><code>Type*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>Any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sabe como calcular um hash de acordo com seu conte√∫do e tamb√©m como comparar o conte√∫do para obter igualdade. </font><font style="vertical-align: inherit;">Ao longo do caminho, permite fazer convers√µes do tipo atual para outro. </font><font style="vertical-align: inherit;">Este √© um tipo de repensar a classe any da biblioteca padr√£o ou da biblioteca de refor√ßo.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo lista de ativos sistema de carregamento √© baseada em tr√™s classes: </font></font><code>AssetManager, AssetBase, IAssetSerializer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">No entanto, antes de prosseguir com a descri√ß√£o dessas classes, deve-se dizer que o c√≥digo externo usa um alias </font></font><code>Asset&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que √© declarado assim:</font></font><br>
<br>
<pre><code class="cpp hljs">Asset = <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;T&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
onde T √© um AssetBase ou um tipo espec√≠fico de ativo. Usando shared_ptr em qualquer lugar, alcan√ßamos o atendimento ao requisito n√∫mero 1 (Gerenciamento autom√°tico de mem√≥ria). </font></font><br>
<br>
<code>AssetManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Esta √© uma classe finita que n√£o tem herdeiros. Essa classe define o ciclo de vida de um ativo e envia mensagens sobre altera√ß√µes no estado de um ativo. Ele tamb√©m </font></font><code>AssetManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">armazena uma √°rvore de depend√™ncia entre ativos e uma liga√ß√£o de ativos a arquivos em disco, escuta </font></font><code>FileWatcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e implementa uma recarga de ativos. E o mais importante, ele </font></font><code>AssetManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lan√ßa um encadeamento separado, implementa uma fila de tarefas para preparar o ativo e encapsula toda a sincroniza√ß√£o com outros encadeamentos de aplicativos (a solicita√ß√£o de ativos pode ser feita a partir de qualquer encadeamento de aplicativos, incluindo o fluxo de download). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao mesmo tempo, </font></font><code>AssetManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opera com um ativo abstrato</font></font><code>AssetBase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, delegando a tarefa de criar e carregar um ativo de um tipo espec√≠fico para o herdeiro </font></font><code>IAssetSerializer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Vou contar mais sobre como isso acontece nos artigos subsequentes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como parte do requisito n√∫mero 4 (compartilhamento de ativos), uma das perguntas mais importantes foi "o que usar como identificador de ativos?" </font><font style="vertical-align: inherit;">A solu√ß√£o mais simples e aparentemente √≥bvia seria usar o caminho para o arquivo a ser baixado. </font><font style="vertical-align: inherit;">No entanto, esta decis√£o imp√µe uma s√©rie de limita√ß√µes s√©rias:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para criar um ativo, este √∫ltimo deve ser representado como um arquivo em disco, o que remove a capacidade de criar ativos de tempo de execu√ß√£o com base em outros ativos.</font></font></li>
<li>    . ,    GPUProgram     (defines).      ,       .</li>
<li>         ,   .</li>
<li>        .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o consideramos os par√°grafos 3 e 4 como um argumento desde o in√≠cio, pois n√£o havia sequer um pensamento de que isso pudesse ser √∫til. No entanto, esses recursos posteriormente facilitaram bastante o desenvolvimento do editor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, decidimos usar a chave do ativo como um identificador, que no n√≠vel </font></font><code>AssetManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© representado pelo tipo </font></font><code>Any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. O </font></font><code>Any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">herdeiro sabe </font><font style="vertical-align: inherit;">interpretar </font></font><code>IAssetSerializer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ela mesma </font></font><code>AssetManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conhece apenas a rela√ß√£o entre o tipo de chave e o herdeiro </font></font><code>IAssetSerializer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. O c√≥digo que solicita um ativo geralmente sabe que tipo de ativo ele precisa e opera com uma chave de um tipo espec√≠fico. Tudo √© mais ou menos assim:</font></font><br>
<br>
<pre><code class="cpp hljs">
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Texture</span>:</span> <span class="hljs-keyword">public</span> AssetBase<font></font>
{<font></font>
<span class="hljs-keyword">public</span>:
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">PathKey</span>
    {</span><font></font>
        FilePath path;<font></font>
        <span class="hljs-function"><span class="hljs-keyword">size_t</span> <span class="hljs-title">hash</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span></span>;
        <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-keyword">const</span> PathKey&amp; other);<font></font>
    };<font></font>
<font></font>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MemoryKey</span>
    {</span>
        u32 width = <span class="hljs-number">1</span>;<font></font>
        u32 height = <span class="hljs-number">1</span>;<font></font>
        u32 level_count = <span class="hljs-number">1</span>;<font></font>
        TextureFormat format = RBGA8;<font></font>
        TextureType type = TEX_2D;<font></font>
        <span class="hljs-function">Vector&lt;Vector&lt;u8*&gt;&gt; data</span>; <span class="hljs-comment">// Face&lt;MipLevels&lt;Image&gt;&gt;</span><font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">size_t</span> <span class="hljs-title">hash</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span></span>;
        <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-keyword">const</span> MemoryKey&amp; other);<font></font>
    };<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TextureSerializer</span>:</span> <span class="hljs-keyword">public</span> IAssetSerializer<font></font>
{<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AssetManager</span> <span class="hljs-title">final</span>
{</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
    Asset&lt;T&gt; <span class="hljs-title">get_asset</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Any&amp; key, ...)</span></span>;
    <span class="hljs-function">Asset&lt;AssetBase&gt; <span class="hljs-title">get_asset</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Any&amp; key, ...)</span></span>;<font></font>
};<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{<font></font>
   ...<font></font>
   <span class="hljs-function">Texture::PathKey <span class="hljs-title">key</span><span class="hljs-params">(<span class="hljs-string">"/path_to_asset"</span>)</span></span>;<font></font>
   Asset&lt;Texture&gt; asset = asset_manager-&gt;get_asset&lt;Texture&gt;(key);<font></font>
   ...<font></font>
<font></font>
   Texture::MemoryKey mem_key;<font></font>
   mem_key.width = <span class="hljs-number">128</span>;<font></font>
   mem_key.format = <span class="hljs-number">128</span>;<font></font>
   mem_key.level_count = <span class="hljs-number">1</span>;<font></font>
   mem_key.format = A8;<font></font>
   mem_key.type = TEX_2D;<font></font>
   Vector&lt;u8*&gt;&amp; mip_chain = mem_key.data.emplace_back();<font></font>
   mip_chain.push_back(generage_sdf_font());<font></font>
   <font></font>
   Asset&lt;Texture&gt; sdf_font_texture = asset_manager-&gt;get_asset&lt;Texture&gt;(mem_key);<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O m√©todo </font></font><code>hash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e o operador de compara√ß√£o internos </font></font><code>PathKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s√£o necess√°rios para o funcionamento das opera√ß√µes de classe correspondentes </font></font><code>Any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas n√£o vamos nos deter sobre isso em detalhes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, o que acontece no c√≥digo acima: no momento da chamada, a </font></font><code>get_asset(key)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chave ser√° copiada para um objeto tempor√°rio do tipo </font></font><code>Any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que, por sua vez, ser√° passado para o m√©todo </font></font><code>get_asset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Em seguida, </font></font><code>AssetManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pegue o tipo de chave do argumento. No nosso caso, ser√°:</font></font><br>
<br>
<pre><code class="cpp hljs">Type::instance&lt;MyAsset::PathKey&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por esse tipo, ele encontrar√° o objeto serializador e delegar√° ao serializador todas as opera√ß√µes subseq√ºentes (cria√ß√£o e carregamento). </font></font><br>
<br>
<code>AssetBase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Esta √© a classe base para todos os tipos de ativos no mecanismo. </font><font style="vertical-align: inherit;">Essa classe armazena a chave do ativo, o estado atual do ativo (carregado, na fila etc.), bem como o texto do erro se o carregamento do ativo falhar. </font><font style="vertical-align: inherit;">De fato, a estrutura interna √© um pouco mais complicada, mas consideraremos isso junto com o ciclo de vida do ativo. </font></font><br>
<br>
<code>IAssetSerializer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, como o nome indica, √© a classe base da entidade que est√° preparando o ativo. </font><font style="vertical-align: inherit;">De fato, o herdeiro dessa classe n√£o est√° apenas carregando o ativo:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aloca√ß√£o e desaloca√ß√£o de um objeto de ativo de um tipo espec√≠fico.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carregando um ativo de um tipo espec√≠fico.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compilar uma lista de caminhos de arquivo com base nos quais o ativo √© constru√≠do. </font><font style="vertical-align: inherit;">Essa lista √© necess√°ria para o mecanismo de recarregamento de ativos quando um arquivo √© alterado. </font><font style="vertical-align: inherit;">Surge a pergunta: por que a lista de caminhos, e n√£o um caminho? </font><font style="vertical-align: inherit;">Recursos simples, como texturas, podem realmente ser constru√≠dos com base em um √∫nico arquivo. </font><font style="vertical-align: inherit;">No entanto, se observarmos o sombreador, veremos que a reinicializa√ß√£o ocorrer√° n√£o apenas se o texto do sombreador for alterado, mas tamb√©m se o arquivo conectado ao sombreador for alterado atrav√©s da diretiva de inclus√£o.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Salvando ativo em disco. </font><font style="vertical-align: inherit;">√â usado ativamente tanto na edi√ß√£o de ativos quanto na prepara√ß√£o de ativos para o jogo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Informa os tipos de chaves que ele suporta.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E a √∫ltima pergunta que quero abordar na estrutura deste artigo: por que voc√™ precisa ter v√°rios tipos de chaves em um serializador / ativo? </font><font style="vertical-align: inherit;">Vamos resolver isso por sua vez.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um serializador - v√°rios tipos de chaves</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos dar um exemplo de um ativo </font></font><code>GPUProgram</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ou seja, um sombreador). </font><font style="vertical-align: inherit;">Para carregar um shader em nosso mecanismo, s√£o necess√°rias as seguintes informa√ß√µes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O caminho para o arquivo shader.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lista de defini√ß√µes de pr√©-processador.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O est√°gio para o qual o sombreador √© montado e compilado (v√©rtice, fragmento, computa√ß√£o).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O nome do ponto de entrada.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reunindo essas informa√ß√µes, obtemos a chave shader, usada no jogo. No entanto, durante o desenvolvimento de um jogo ou mecanismo, geralmente √© necess√°rio exibir algumas informa√ß√µes de depura√ß√£o na tela, √†s vezes com um sombreador espec√≠fico. E nessa situa√ß√£o, pode ser conveniente escrever o texto do sombreador diretamente no c√≥digo. Para fazer isso, podemos obter o segundo tipo de chave, que em vez do caminho para o arquivo e a lista de defini√ß√µes de pr√©-processador conter√£o o texto do sombreador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere outro exemplo: textura. A maneira mais f√°cil de criar uma textura √© carreg√°-la do disco. Para fazer isso, precisamos do caminho para o arquivo ( </font></font><code>PathKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Mas tamb√©m podemos gerar o conte√∫do da textura por algoritmo e criar uma textura a partir de uma matriz de bytes ( </font></font><code>MemoryKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). O terceiro tipo de chave pode ser uma chave para criar uma </font></font><code>RenderTarget</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">textura ( </font></font><code>RTKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dependendo do tipo de chave, v√°rios mecanismos de rasteriza√ß√£o de glifos podem ser usados: stb (StbFontKey), FreeType (FTFontKet) ou um gerador de fonte de campo de dist√¢ncia assinado autoassinado (SDFFontKey). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A anima√ß√£o do quadro-chave pode ser carregada ( </font></font><code>PathKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) ou gerada pelo c√≥digo ( </font></font><code>MemoryKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um ativo - v√°rios tipos de chaves</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagine que temos um </font></font><code>ParticleEffect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ativo que descreve as regras para gera√ß√£o de part√≠culas. Al√©m disso, temos um editor conveniente para esse ativo. Ao mesmo tempo, o editor de n√≠veis e o editor de part√≠culas s√£o um aplicativo com v√°rias janelas. Isso √© conveniente porque voc√™ pode abrir um n√≠vel, colocar uma fonte de part√≠culas nele e observar o efeito no ambiente do n√≠vel, enquanto edita o pr√≥prio efeito. Se tivermos um tipo de chave, o objeto de efeito usado no mundo da edi√ß√£o de efeitos e no mundo dos n√≠veis ser√° o mesmo. Todas as altera√ß√µes feitas no editor de efeitos ser√£o vis√≠veis imediatamente no n√≠vel. √Ä primeira vista, isso pode parecer uma ideia interessante, mas vamos olhar para os seguintes cen√°rios:</font></font><br>
<br>
<ol>
<li>    ,   ,    ,    .   ,            . </li>
<li>-       ,    .        ,            .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, √© poss√≠vel uma situa√ß√£o em que criamos dois tipos diferentes de ativos a partir de um arquivo em um disco usando dois tipos diferentes de chaves. </font><font style="vertical-align: inherit;">Utilizando a chave do tipo "jogo", criamos uma estrutura de dados otimizada para um trabalho r√°pido no jogo. </font><font style="vertical-align: inherit;">Usando o tipo de chave "editorial", criamos uma estrutura de dados que √© conveniente para edi√ß√£o. </font><font style="vertical-align: inherit;">Dessa maneira, nosso editor implementa a edi√ß√£o </font></font><code>BlendTree</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de anima√ß√µes esquel√©ticas. </font><font style="vertical-align: inherit;">Com base em um tipo de chave, o sistema de ativos nos cria um ativo com uma √°rvore honesta e v√°rios sinais sobre a altera√ß√£o da topologia, o que √© muito conveniente na edi√ß√£o, mas bastante lento no jogo. </font><font style="vertical-align: inherit;">De acordo com um tipo diferente de chave, o serializador cria outro tipo de ativo: o ativo n√£o possui m√©todos para alterar a √°rvore e a pr√≥pria √°rvore √© transformada em uma matriz de n√≥s, em que o link para o n√≥ √© um √≠ndice na matriz.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ep√≠logo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resumindo, gostaria de concentrar sua aten√ß√£o nas solu√ß√µes que mais influenciaram o desenvolvimento do mecanismo:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usando uma estrutura customizada como uma chave de ativo, n√£o um caminho de arquivo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carregamento de ativos apenas no modo ass√≠ncrono.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um esquema flex√≠vel para gerenciar o compartilhamento de ativos (um ativo - v√°rios tipos de chaves).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A capacidade de receber ativos do mesmo tipo usando fontes de dados diferentes (suporte para v√°rios tipos de chaves em um serializador).</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ aprender√° como exatamente essas decis√µes influenciaram a implementa√ß√£o do c√≥digo interno e do externo na pr√≥xima s√©rie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autor:</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exmix</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt498290/index.html">Hidrologia processual: simula√ß√£o din√¢mica de rios e lagos</a></li>
<li><a href="../pt498292/index.html">Economize muito dinheiro em grandes volumes no PostgreSQL</a></li>
<li><a href="../pt498294/index.html">Detec√ß√£o de Objetos Reconhe√ßa e governe. Parte 1</a></li>
<li><a href="../pt498296/index.html">Design no n√≠vel do sistema. Parte 1. Da ideia ao sistema</a></li>
<li><a href="../pt498298/index.html">Empresas usam recompensas de insetos para comprar sil√™ncio de hackers</a></li>
<li><a href="../pt498302/index.html">Licen√ßa avan√ßada da OIT. Por que √© necess√°rio agora?</a></li>
<li><a href="../pt498304/index.html">Automatize as tarefas de administra√ß√£o da API do VMware vSphere usando o Ansible</a></li>
<li><a href="../pt498308/index.html">Algoritmo gen√©tico Python para encontrar extremos globais</a></li>
<li><a href="../pt498310/index.html">Tr√™s armadilhas do aprendizado de m√°quina e como evit√°-las</a></li>
<li><a href="../pt498312/index.html">Desenvolvimento de uma rede el√©trica de aeronaves usando projeto orientado a modelo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>