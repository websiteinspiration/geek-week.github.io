<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåé üö¥üèæ ü§õüèº PEP 3107 (Feature Annotations) üëáüèº ü•´ ‚óºÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello everyone. I decided to fully understand the Python annotations and at the same time translate a series of PEPs documenting this topic. We will s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>PEP 3107 (Feature Annotations)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500134/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello everyone. </font><font style="vertical-align: inherit;">I decided to fully understand the Python annotations and at the same time translate a series of PEPs documenting this topic. </font><font style="vertical-align: inherit;">We will start with the 3.X standards and end with the innovations in python 3.8. </font><font style="vertical-align: inherit;">I must say right away that this PEP is one of the most basic and its reading is only useful for beginners. </font><font style="vertical-align: inherit;">Well, let's go:</font></font><br>
<a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEP 572 - Feature Annotations</font></font></h2><div class="scrollable-table"><table>
<tbody><tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pep</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3107</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Title:</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Feature Annotations</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Authors:</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Collin Winter &lt;collinwinter at google.com&gt;, Tony Lownds &lt;tony at lownds.com&gt;</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Status:</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Final</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A type:</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Standard</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Created:</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2-Dec-2006</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python version:</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.0</font></font></td>
</tr>
</tbody></table></div><br>
<a name="ann"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Annotation to the standard</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This PEP introduces syntax for adding arbitrary annotations (metadata) to functions in Python.</font></font><br>
<br>
<a name="oboc"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Justification</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Functions in Python 2.x did not have a built-in way to annotate parameters and return values. </font><font style="vertical-align: inherit;">To address this gap, many tools and libraries have appeared. </font><font style="vertical-align: inherit;">Some of them use the decorators described in PEP 318, while others analyze docstring functions and look for information there. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This PEP aims to provide a single, standard way to annotate functions in order to reduce the confusion that has existed up to this point, caused by the wide variation in mechanisms and syntax.</font></font><br>
<br>
<a name="osnovi"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feature Annotation Basics</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Before we start discussing Python 3.0 feature annotations, let's first talk about their features in general terms:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Annotations for parameters and return values ‚Äã‚Äãof functions are completely optional.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Annotations are nothing more than a way to associate arbitrary expressions with different parts of a function at compile time. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Python itself does not pay any attention to annotations. </font><font style="vertical-align: inherit;">The only thing is that it allows you to access them, which is described in the "Getting Access to Feature Annotations" section below. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Annotations only make sense when interpreted by third-party libraries. </font><font style="vertical-align: inherit;">They can do whatever they want with function annotations. </font><font style="vertical-align: inherit;">For example, one library may use string annotations to provide improved reference data, for example:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compile</span>(<span class="hljs-params">source: <span class="hljs-string">"something compilable"</span>,
            filename: <span class="hljs-string">"where the compilable thing comes from"</span>,
            mode: <span class="hljs-string">"is this a single statement or a suite?"</span></span>):</span>
    ...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another library may use Python function and method annotations to check for type matching. </font><font style="vertical-align: inherit;">This library can use annotations to show what types of input data it expects and what type of data it will return. </font><font style="vertical-align: inherit;">Perhaps it will be something like this:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">haul</span>(<span class="hljs-params">item: Haulable, *vargs: PackAnimal</span>) -&gt; Distance:</span>
    ...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We repeat once again: the annotations of </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">none</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> of the examples in themselves have </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">any</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> meaning. </font><font style="vertical-align: inherit;">They acquire real meaning only in combination with third-party libraries.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As follows from paragraph 2, this PEP does not attempt to introduce any standard mechanism for processing annotations even for built-in types. </font><font style="vertical-align: inherit;">All this work is assigned to third-party libraries.</font></font></li>
</ol><br>
<a name="sint"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Syntax</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parameters</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parameter annotations are optional expressions following the name of the parameter itself:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span> (<span class="hljs-params">a: , b:  = <span class="hljs-number">5</span></span>):</span>
    ...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In pseudogrammatics, parameters now look like: </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parameter [: expression] [= expression]</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">That is, annotations, like default values, are optional and always precede the latter. </font><font style="vertical-align: inherit;">Just like an equal sign is used to indicate a default value, a colon is used for annotations. </font><font style="vertical-align: inherit;">All annotation expressions, like default values, are evaluated when a function definition is executed. </font><font style="vertical-align: inherit;">Getting "extra" arguments (ie * args and ** kwargs) has the same syntax:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>(<span class="hljs-params">*args: expression, **kwargs: expression</span>):</span>
    ...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Annotations for nested parameters always follow the parameter name, not the last bracket. </font><font style="vertical-align: inherit;">Annotation of each ‚Äúname‚Äù in the nested parameter is not required:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>(<span class="hljs-params">(<span class="hljs-params">x1, y1: expression</span>),
        (<span class="hljs-params">x2: expression, y2: expression</span>)=(<span class="hljs-params">None, None</span>)</span>):</span>
    ...</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Return values</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So far, we have not provided an example of how to annotate the return type in functions. </font><font style="vertical-align: inherit;">This is done like this:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sum</span>() -&gt; expression:</span>
    ...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That is, the literal -&gt; and some kind of expression can now follow the list of parameters. </font><font style="vertical-align: inherit;">Like parameter annotations, this expression will be evaluated when the function definition is executed. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The full grammar of function declarations is now as follows:</font></font><br>
<br>
<pre><code class="python hljs">decorator: <span class="hljs-string">'@'</span> dotted_name [ <span class="hljs-string">'('</span> [arglist] <span class="hljs-string">')'</span> ] NEWLINE<font></font>
decorators: decorator+<font></font>
funcdef: [decorators] <span class="hljs-string">'def'</span> NAME parameters [<span class="hljs-string">'-&gt;'</span> test] <span class="hljs-string">':'</span> suite<font></font>
parameters: <span class="hljs-string">'('</span> [typedargslist] <span class="hljs-string">')'</span>
typedargslist: ((tfpdef [<span class="hljs-string">'='</span> test] <span class="hljs-string">','</span>)*<font></font>
                (<span class="hljs-string">'*'</span> [tname] (<span class="hljs-string">','</span> tname [<span class="hljs-string">'='</span> test])* [<span class="hljs-string">','</span> <span class="hljs-string">'**'</span> tname]<font></font>
                 | <span class="hljs-string">'**'</span> tname)<font></font>
                | tfpdef [<span class="hljs-string">'='</span> test] (<span class="hljs-string">','</span> tfpdef [<span class="hljs-string">'='</span> test])* [<span class="hljs-string">','</span>])<font></font>
tname: NAME [<span class="hljs-string">':'</span> test]<font></font>
tfpdef: tname | <span class="hljs-string">'('</span> tfplist <span class="hljs-string">')'</span>
tfplist: tfpdef (<span class="hljs-string">','</span> tfpdef)* [<span class="hljs-string">','</span>]</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lambdas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lambda functions do not support annotations. </font><font style="vertical-align: inherit;">Of course, the syntax could be corrected by adding the ability to "wrap" the arguments in brackets, but it was decided not to make such a change, because:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This would violate backward compatibility.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lambdas are neutral and anonymous by definition</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lambdas can always be rewritten as functions</font></font></li>
</ol><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get access to feature annotations</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After compilation, function annotations become available through the __annotations__ attribute. </font><font style="vertical-align: inherit;">This attribute is a mutable dictionary comparing the names of variables and the values ‚Äã‚Äãof the annotations indicated to them. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The __annotations__ dictionary has a special "return" key. </font><font style="vertical-align: inherit;">This key is present only if an annotation has also been defined for the return value of the function. </font><font style="vertical-align: inherit;">For example, the following annotation:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span> (<span class="hljs-params">a: <span class="hljs-string">'x'</span>, b: <span class="hljs-number">5</span> + <span class="hljs-number">6</span>, c: list</span>) -&gt; max (2, 9):</span>
    ...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Will be returned via the __annotations__ attribute as:</font></font><br>
<br>
<pre><code class="python hljs">{<span class="hljs-string">'a'</span>: <span class="hljs-string">'x'</span>,
 <span class="hljs-string">'b'</span>: <span class="hljs-number">11</span>,
 <span class="hljs-string">'c'</span>: list,
 <span class="hljs-string">'return'</span>: <span class="hljs-number">9</span>}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The key name ‚Äúreturn‚Äù was chosen because it cannot conflict with the parameter name (any attempt to use return as the parameter name will result in a SyntaxError exception). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The __annotations__ attribute will be empty if the function does not have annotations or if the function was created through a lambda expression.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Use cases</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
During the discussion of annotations, we examined several options for their use. </font><font style="vertical-align: inherit;">Some of them are presented here and grouped according to the "class" of information that is transmitted. </font><font style="vertical-align: inherit;">Also included here are examples of existing products and packages that can use annotation.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Providing Type Information</font></font><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type check</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IDE Tips on Expected and Returned Argument Types</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Function overloading / generic functions [approx. </font><font style="vertical-align: inherit;">function overloading is popular in other languages ‚Äã‚Äãand consists in the existence of several functions with the same names, but at the same time, the number of parameters accepted by them varies]</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bridges between different programming languages</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adaptation </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Predicate logic functions</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mapping a database query</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RPC parameter marshaling [approx. </font><font style="vertical-align: inherit;">Marshaling is the process of converting information stored in RAM into a format suitable for storage or transmission. </font><font style="vertical-align: inherit;">RPC - Remote Procedure Call]</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Providing other information</font></font><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Documenting parameters and return values</font></font></li>
</ul></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Standard library</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pydoc and inspect modules</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The pydoc module will display annotations in the function reference information. </font><font style="vertical-align: inherit;">The inspect module will change and will support annotations.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link to other PEPs</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Function Signature Objects</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Function signature objects must provide function annotations. </font><font style="vertical-align: inherit;">Parameter object and other things may change. </font><font style="vertical-align: inherit;">[approx. </font><font style="vertical-align: inherit;">Signature (Signature) of the function - part of its general declaration, allowing the means of translation to identify the function among others]</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The reference implementation was included in the py3k branch (formerly ‚Äúp3yk‚Äù) as revision 53170</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rejected offers</font></font></h2><br>
<ul>
<li>BDFL [.   ]       ,       ,  : ¬´ ¬ª</li>
<li>     stdlib              ,       ,      .           .</li>
<li>        ,  ,         .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despite further discussion, it was decided not to standardize the mechanism for annotation interaction. </font><font style="vertical-align: inherit;">Such an agreement at this stage would be premature. </font><font style="vertical-align: inherit;">We want to allow these agreements to develop organically, based on a real situation, and not try to force everyone to use some kind of contrived scheme.</font></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en500118/index.html">Five steps to making the inevitable, or a cross-selling referral system</a></li>
<li><a href="../en500120/index.html">About copyright, or how should we properly ‚Äúprotect the artist‚Äù?</a></li>
<li><a href="../en500126/index.html">Analysis: 3 reasons to do financial literacy</a></li>
<li><a href="../en500128/index.html">Architecture and design of Android applications (my experience)</a></li>
<li><a href="../en500132/index.html">COVID-19: random process model</a></li>
<li><a href="../en500138/index.html">Briefly about SAFe, LeSS and other Agile frameworks</a></li>
<li><a href="../en500140/index.html">"Up to 10 thousand": more than 25 reviews of headphones</a></li>
<li><a href="../en500142/index.html">Manage rights at the facility level</a></li>
<li><a href="../en500144/index.html">David O'Brien (Xirus): Metrics! Metrics! Metrics! Part 1</a></li>
<li><a href="../en500146/index.html">Job search in Germany as a product manager and more. Part 3/5. What you need to do before you start sending out CVs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>