<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ≤Ô∏è üîØ üë©‚Äçüéì La verdad en primer lugar, o por qu√© el sistema debe dise√±arse en funci√≥n del dispositivo de la base de datos üéÄ üôãüèº ‚ôìÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr! 
 
 Continuamos explorando el tema de Java y Spring , incluso a nivel de base de datos. Hoy ofrecemos leer sobre por qu√©, cuando se dise√±an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>La verdad en primer lugar, o por qu√© el sistema debe dise√±arse en funci√≥n del dispositivo de la base de datos</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/498816/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hola Habr! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Continuamos explorando el tema de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , incluso a nivel de base de datos. Hoy ofrecemos leer sobre por qu√©, cuando se dise√±an aplicaciones grandes, es la estructura de la base de datos, y no el c√≥digo Java, lo que deber√≠a tener un significado decisivo sobre c√≥mo se hace esto y cu√°les son las excepciones a esta regla.</font></font><br>
<a name="habracut"></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este art√≠culo bastante tard√≠o, explicar√© por qu√© creo que en casi todos los casos el modelo de datos en la aplicaci√≥n debe dise√±arse "en base a la base de datos" y no "en funci√≥n de las capacidades de Java" (u otro lenguaje de cliente con el que trabaje). </font><font style="vertical-align: inherit;">Al elegir el segundo enfoque, te embarcas en un largo viaje de dolor y sufrimiento tan pronto como tu proyecto comienza a crecer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este art√≠culo se basa en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">una pregunta que se</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hace en Stack Overflow. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Interesantes discusiones sobre reddit en las secciones </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ r / java</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ r / programaci√≥n</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Codigo de GENERACION</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Me sorprende que haya una capa tan peque√±a de usuarios que, habi√©ndose familiarizado con jOOQ, est√°n indignados por el hecho de que cuando trabaja jOOQ se basa seriamente en la generaci√≥n de c√≥digo fuente. Nadie te molesta para usar jOOQ como mejor te parezca, y no te obliga a usar la generaci√≥n de c√≥digo. Pero de manera predeterminada (como se describe en el manual), trabajar con jOOQ sucede de esta manera: comienza con un esquema de base de datos (heredado), realiza ingenier√≠a inversa utilizando el generador de c√≥digo jOOQ, para obtener un conjunto de clases que representan sus tablas, y luego escriba consultas de tipo seguro en estas tablas:</font></font><br>
<br>
<pre><code class="java hljs">	<span class="hljs-keyword">for</span> (Record2&lt;String, String&gt; record : DSL.using(configuration)
<span class="hljs-comment">//   ^^^^^^^^^^^^^^^^^^^^^^^      </span>
<span class="hljs-comment">//     ,    </span>
<span class="hljs-comment">//   SELECT </span><font></font>
 <font></font>
       .select(ACTOR.FIRST_NAME, ACTOR.LAST_NAME)<font></font>
<span class="hljs-comment">//           vvvvv ^^^^^^^^^^^^  ^^^^^^^^^^^^^^^  </span><font></font>
       .from(ACTOR)<font></font>
       .orderBy(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)) {
    <span class="hljs-comment">// ...</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El c√≥digo se genera manualmente fuera del ensamblaje o manualmente con cada ensamblaje. </font><font style="vertical-align: inherit;">Por ejemplo, dicha regeneraci√≥n puede seguir inmediatamente despu√©s de la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">migraci√≥n de la base de datos Flyway, que tambi√©n se puede hacer de forma manual o autom√°tica</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Generaci√≥n de c√≥digo fuente</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Varias filosof√≠as, ventajas y desventajas est√°n asociadas con tales enfoques para la generaci√≥n de c√≥digo, manual y autom√°tico, que no voy a discutir en detalle en este art√≠culo. Pero, en general, todo el punto del c√≥digo generado es que nos permite reproducir en Java esa "verdad" que damos por sentado, ya sea dentro de nuestro sistema o fuera de √©l. En cierto sentido, los compiladores que generan bytecode, c√≥digo de m√°quina u otro tipo de c√≥digo fuente hacen lo mismo: obtenemos una representaci√≥n de nuestra "verdad" en otro idioma, independientemente de razones espec√≠ficas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay muchos generadores de c√≥digo de este tipo. Por ejemplo, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XJC puede generar c√≥digo Java basado en archivos XSD o WSDL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . El principio es siempre el mismo:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hay algo de verdad (interna o externa), por ejemplo, especificaci√≥n, modelo de datos, etc.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Necesitamos una representaci√≥n local de esta verdad en nuestro lenguaje de programaci√≥n.</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, generar tal representaci√≥n es casi siempre recomendable, para evitar la redundancia.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proveedores de tipos y procesamiento de anotaciones</font></font></h4> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota: otro enfoque m√°s moderno y espec√≠fico para la generaci√≥n de c√≥digo para jOOQ est√° asociado con el uso de proveedores de tipos, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en la forma en que se implementan en F #</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En este caso, el compilador genera el c√≥digo, en realidad en la etapa de compilaci√≥n. </font><font style="vertical-align: inherit;">En forma de fuentes, dicho c√≥digo, en principio, no existe. </font><font style="vertical-align: inherit;">Existen herramientas similares, aunque menos elegantes, en Java: estos son procesadores de anotaciones como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lombok</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cierto sentido, aqu√≠ suceden las mismas cosas que en el primer caso, con la excepci√≥n de:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No ve el c√≥digo generado (¬øtal vez esta situaci√≥n le parece a alguien no tan repulsivo?)</font></font></li>
<li>  ,    ,  , ¬´¬ª    .     Lombok,   ‚Äú‚Äù.      ,        .</li>
</ul><br>
<h4>     ?</h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s de la pregunta dif√≠cil de c√≥mo es mejor comenzar la generaci√≥n de c√≥digo, de forma manual o autom√°tica, es necesario mencionar que hay personas que creen que la generaci√≥n de c√≥digo no es necesaria en absoluto. La raz√≥n de este punto de vista, que encontr√© con mayor frecuencia, es que es dif√≠cil configurar la tuber√≠a de ensamblaje. S√≠, muy duro Hay costos adicionales de infraestructura. Si reci√©n est√° comenzando a trabajar con un determinado producto (ya sea jOOQ, o JAXB, o Hibernate, etc.), lleva tiempo configurar el entorno de trabajo que le gustar√≠a gastar en aprender la API en s√≠, y luego extraer valor de √©l.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si la sobrecarga asociada con la comprensi√≥n del dispositivo del generador es demasiado grande, entonces la API realmente trabaj√≥ un poco en la usabilidad del generador de c√≥digo (y en el futuro, resulta que la configuraci√≥n del usuario es complicada). La facilidad de uso debe ser la m√°xima prioridad para cualquier API de este tipo. Pero este es solo un argumento en contra de la generaci√≥n de c√≥digo. Por lo dem√°s, es completamente completamente manual escribir una representaci√≥n local de la verdad interna o externa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muchos dir√°n que no tienen tiempo para hacer todo esto. Tienen plazos para su S√∫per Producto. Alg√∫n tiempo despu√©s peinamos los transportadores de ensamblaje, llegar√° a tiempo. Les responder√©: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sd/ah/5v/sdah5v4nuslp0dylmjlrvcu0qfu.png"><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Original</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alan O'Rourke, Audience Stack. </font></font></a> <br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pero en Hibernate / JPA es muy f√°cil escribir c√≥digo "para Java".</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De Verdad. </font><font style="vertical-align: inherit;">Para Hibernate y sus usuarios, esto es tanto una bendici√≥n como una maldici√≥n. </font><font style="vertical-align: inherit;">En Hibernate, simplemente puede escribir un par de entidades, como esta:</font></font><br>
<br>
<pre><code class="java hljs">	<span class="hljs-meta">@Entity</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>{
  <span class="hljs-meta">@Id</span>
  <span class="hljs-keyword">int</span> id;<font></font>
  String title;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y casi todo est√° listo. </font><font style="vertical-align: inherit;">Ahora el destino de Hibernate es generar "detalles" complejos de c√≥mo se definir√° exactamente esta entidad en el DDL de su "dialecto" SQL:</font></font><br>
<br>
<pre><code class="sql hljs">	<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> book (
  <span class="hljs-keyword">id</span> <span class="hljs-built_in">INTEGER</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">GENERATED</span> <span class="hljs-keyword">ALWAYS</span> <span class="hljs-keyword">AS</span> <span class="hljs-keyword">IDENTITY</span>,<font></font>
  title <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">50</span>),<font></font>
 <font></font>
  <span class="hljs-keyword">CONSTRAINT</span> pk_book PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-keyword">id</span>)<font></font>
);<font></font>
 <font></font>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> i_book_title <span class="hljs-keyword">ON</span> book (title);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... y comenzamos a manejar la aplicaci√≥n. </font><font style="vertical-align: inherit;">Una oportunidad realmente genial para comenzar r√°pidamente y probar cosas diferentes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, permitir. </font><font style="vertical-align: inherit;">Estaba enga√±ando</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øHibernate realmente aplica la definici√≥n de esta clave primaria con nombre?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øHibernate crear√° un √≠ndice en TITLE? </font><font style="vertical-align: inherit;">"S√© con certeza que lo necesitaremos".</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øHibernate hace exactamente esta clave identificable en la Especificaci√≥n de identidad?</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Probablemente no. </font><font style="vertical-align: inherit;">Si est√° desarrollando su proyecto desde cero, siempre es conveniente simplemente eliminar la base de datos anterior y generar una nueva tan pronto como agregue las anotaciones necesarias. </font><font style="vertical-align: inherit;">Entonces, la entidad Libro eventualmente tomar√° la forma:</font></font><br>
<br>
<pre><code class="java hljs">	<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "book", indexes = {
  @Index(name = "i_book_title", columnList = "title")
})</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>{
  <span class="hljs-meta">@Id</span>
  <span class="hljs-meta">@GeneratedValue(strategy = IDENTITY)</span>
  <span class="hljs-keyword">int</span> id;<font></font>
  String title;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Frio. </font><font style="vertical-align: inherit;">Regenerado. </font><font style="vertical-align: inherit;">Nuevamente, en este caso, al principio ser√° muy f√°cil.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pero luego tienes que pagar por ello</font></font></h4> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tarde o temprano tienes que entrar en producci√≥n. En ese momento, ese modelo dejar√° de funcionar. Porque: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
en producci√≥n ya no ser√° posible, si es necesario, descartar la base de datos anterior y comenzar desde cero. Su base de datos se convertir√° en una heredada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A partir de ahora, tendr√° que escribir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">secuencias de comandos de migraci√≥n DDL, por ejemplo, utilizando Flyway</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ¬øY qu√© pasa entonces con tus entidades? Puede adaptarlos manualmente (y as√≠ duplicar su carga de trabajo) u ordenar a Hibernate que los regenere por usted (¬øqu√© posibilidades hay de que se generen de esta manera para satisfacer sus expectativas?) De todos modos, pierde.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, tan pronto como entre en producci√≥n, necesitar√° parches calientes. </font><font style="vertical-align: inherit;">Y deben ponerse en producci√≥n muy r√°pidamente. </font><font style="vertical-align: inherit;">Dado que no ha preparado y organizado una transportaci√≥n fluida de sus migraciones para la producci√≥n, est√° remendando todo salvajemente. </font><font style="vertical-align: inherit;">Y luego no tienes tiempo para hacer todo bien. </font><font style="vertical-align: inherit;">Y rega√±e a Hibernate, porque siempre se puede culpar a cualquiera, pero no a usted ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cambio, desde el principio todo se podr√≠a hacer de una manera completamente diferente. </font><font style="vertical-align: inherit;">Por ejemplo, ponga ruedas redondas en una bicicleta.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Base de datos primero</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La verdadera "verdad" en el esquema de su base de datos y la "soberan√≠a" sobre ella se encuentran dentro de la base de datos. </font><font style="vertical-align: inherit;">Un esquema se define solo en la base de datos y en ning√∫n otro lugar, y cada cliente tiene una copia de este esquema, por lo que es completamente recomendable imponer el cumplimiento del esquema y su integridad, para hacerlo directamente en la base de datos, donde se almacena la informaci√≥n. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta es incluso la vieja sabidur√≠a gastada. </font><font style="vertical-align: inherit;">Las claves primarias y √∫nicas son buenas. </font><font style="vertical-align: inherit;">Las claves for√°neas son buenas. </font><font style="vertical-align: inherit;">La comprobaci√≥n de l√≠mites es buena. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las declaraciones</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> son buenas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, esto no es todo. </font><font style="vertical-align: inherit;">Por ejemplo, usando Oracle, probablemente desee especificar:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øEn qu√© espacio de tabla est√° tu tabla? </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øCu√°l es su valor PCTFREE? </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øCu√°l es el tama√±o de la cach√© en su secuencia (detr√°s del identificador)</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quiz√°s todo esto no sea importante en sistemas peque√±os, pero no es necesario esperar la transici√≥n al √°rea de "big data"; es posible y mucho antes comenzar a beneficiarse de las optimizaciones de almacenamiento proporcionadas por el proveedor, como las mencionadas anteriormente. </font><font style="vertical-align: inherit;">Ninguno de los ORM que he visto (incluido jOOQ) proporciona acceso al conjunto completo de opciones de DDL que es posible que desee utilizar en su base de datos. </font><font style="vertical-align: inherit;">Los ORM ofrecen algunas herramientas que ayudan a escribir DDL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero al final, un circuito bien dise√±ado se escribe manualmente en DDL. </font><font style="vertical-align: inherit;">Cualquier DDL generado es solo una aproximaci√≥n de √©l.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© pasa con el modelo del cliente?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como se mencion√≥ anteriormente, en el cliente necesitar√° una copia del esquema de su base de datos, la vista del cliente. No hace falta decir que esta vista del cliente debe estar sincronizada con el modelo real. ¬øCu√°l es la mejor manera de lograr esto? Usando un generador de c√≥digo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todas las bases de datos proporcionan su metainformaci√≥n a trav√©s de SQL. Aqu√≠ le mostramos c√≥mo obtener todas las tablas en diferentes dialectos de SQL de su base de datos:</font></font><br>
<br>
<pre><code class="sql hljs">	<span class="hljs-comment">-- H2, HSQLDB, MySQL, PostgreSQL, SQL Server</span>
<span class="hljs-keyword">SELECT</span> table_schema, table_name
<span class="hljs-keyword">FROM</span> information_schema.tables<font></font>
 <font></font>
<span class="hljs-comment">-- DB2</span>
<span class="hljs-keyword">SELECT</span> tabschema, tabname
<span class="hljs-keyword">FROM</span> syscat.tables<font></font>
 <font></font>
<span class="hljs-comment">-- Oracle</span>
<span class="hljs-keyword">SELECT</span> owner, table_name
<span class="hljs-keyword">FROM</span> all_tables<font></font>
 <font></font>
<span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span>
<span class="hljs-keyword">FROM</span> sqlite_master<font></font>
 <font></font>
<span class="hljs-comment">-- Teradata</span>
<span class="hljs-keyword">SELECT</span> databasename, tablename
<span class="hljs-keyword">FROM</span> dbc.tables
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estas consultas (o similares, dependiendo de si tambi√©n tiene que considerar representaciones, representaciones materializadas, funciones con un valor de tabla) tambi√©n se realizan utilizando una llamada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>DatabaseMetaData.getTables()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de JDBC o utilizando el metam√≥dulo jOOQ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A partir de los resultados de tales consultas, es relativamente f√°cil generar cualquier vista de cliente de su modelo de base de datos, independientemente de qu√© tecnolog√≠a se utilice en su cliente.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si usa JDBC o Spring, puede crear un conjunto de constantes de cadena </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si usa JPA, puede generar entidades ellos mismos </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si usa jOOQ, puede generar el metamodelo jOOQ</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dependiendo de cu√°ntas funciones ofrezca la API de su cliente (por ejemplo, jOOQ o JPA), el metamodelo generado puede ser realmente rico y completo. </font><font style="vertical-align: inherit;">Tomemos, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">por ejemplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la posibilidad de uniones impl√≠citas que </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">aparecieron en jOOQ 3.11</font></a><font style="vertical-align: inherit;"> , que se basa en la metainformaci√≥n generada sobre las relaciones de claves for√°neas entre sus tablas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora, cualquier incremento de la base de datos conducir√° autom√°ticamente a la actualizaci√≥n del c√≥digo del cliente. </font><font style="vertical-align: inherit;">Imagina por ejemplo:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> book <span class="hljs-keyword">RENAME</span> <span class="hljs-keyword">COLUMN</span> title <span class="hljs-keyword">TO</span> book_title;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øRealmente te gustar√≠a hacer este trabajo dos veces? </font><font style="vertical-align: inherit;">En ning√∫n caso. </font><font style="vertical-align: inherit;">Simplemente arregle el DDL, ejec√∫telo a trav√©s de su canal de ensamblaje y obtenga la entidad actualizada:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "book", indexes = {
 
  //    ?
  @Index(name = "i_book_title", columnList = "book_title")
})</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>{
  <span class="hljs-meta">@Id</span>
  <span class="hljs-meta">@GeneratedValue(strategy = IDENTITY)</span>
  <span class="hljs-keyword">int</span> id;<font></font>
 <font></font>
  <span class="hljs-meta">@Column("book_title")</span><font></font>
  String bookTitle;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O una clase jOOQ actualizada. </font><font style="vertical-align: inherit;">La mayor√≠a de los cambios DDL tambi√©n afectan la sem√°ntica, no solo la sintaxis. </font><font style="vertical-align: inherit;">Por lo tanto, puede ser conveniente ver en el c√≥digo compilado qu√© c√≥digo se ver√° (o puede ser) afectado por el incremento de su base de datos.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La unica verdad</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No importa qu√© tecnolog√≠a use, siempre hay un modelo que es la √∫nica fuente de verdad para alg√∫n subsistema, o, al menos, debemos esforzarnos por esto y evitar tal confusi√≥n empresarial, donde la "verdad" est√° en todas partes y en ninguna parte. </font><font style="vertical-align: inherit;">Todo puede ser mucho m√°s simple. </font><font style="vertical-align: inherit;">Si solo est√° intercambiando archivos XML con alg√∫n otro sistema, simplemente use XSD. </font><font style="vertical-align: inherit;">Mire el metamodelo INFORMATION_SCHEMA de jOOQ en formato XML: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.jooq.org/xsd/jooq-meta-3.10.0.xsd</font></font></a><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XSD se entiende bien</font></font></li>
<li>XSD     XML         </li>
<li>XSD        </li>
<li>XSD     Java   XJC</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El √∫ltimo punto es importante. </font><font style="vertical-align: inherit;">Cuando nos comunicamos con un sistema externo utilizando mensajes XML, queremos estar seguros de la validez de nuestros mensajes. </font><font style="vertical-align: inherit;">Esto es muy f√°cil de lograr con JAXB, XJC y XSD. </font><font style="vertical-align: inherit;">Ser√≠a una locura esperar que, cuando nos acercamos al dise√±o de ‚ÄúJava primero‚Äù, donde hacemos nuestros mensajes en forma de objetos Java, de alguna manera pudieran mostrarse claramente en XML y enviarse para su consumo a otro sistema. </font><font style="vertical-align: inherit;">El XML generado de esta manera ser√≠a de muy baja calidad, no documentado y ser√≠a dif√≠cil de desarrollar. </font><font style="vertical-align: inherit;">Si hubiera un acuerdo sobre el nivel de calidad de servicio (SLA) en dicha interfaz, lo arruinar√≠amos de inmediato. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Honestamente, eso es exactamente lo que sucede todo el tiempo desde la API hasta JSON, pero esa es otra historia, lo juro la pr√≥xima vez ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bases de datos: es lo mismo</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando trabajas con bases de datos, entiendes que son, en principio, similares. La base posee sus datos y debe administrar el esquema. Cualquier modificaci√≥n realizada en el esquema debe implementarse directamente en DDL para actualizar una √∫nica fuente de verdad. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando se produce una actualizaci√≥n de origen, todos los clientes tambi√©n deben actualizar sus copias del modelo. Algunos clientes pueden escribirse en Java usando jOOQ e Hibernate o JDBC (o todos a la vez). Se pueden escribir otros clientes en Perl (queda desearles buena suerte) y otros en C #. No importa. El modelo principal est√° en la base de datos. Los modelos generados con ORM, generalmente de baja calidad, est√°n poco documentados y son dif√≠ciles de desarrollar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, no cometas errores. </font><font style="vertical-align: inherit;">No cometer errores desde el principio. </font><font style="vertical-align: inherit;">Trabajar desde una base de datos. </font><font style="vertical-align: inherit;">Cree una tuber√≠a de implementaci√≥n que pueda automatizarse. </font><font style="vertical-align: inherit;">Active los generadores de c√≥digo para que sea conveniente copiar su modelo de base de datos y volcarlo en los clientes. </font><font style="vertical-align: inherit;">Y deja de preocuparte por los generadores de c√≥digo. </font><font style="vertical-align: inherit;">Ellos son buenos. </font><font style="vertical-align: inherit;">Con ellos ser√°s m√°s productivo. </font><font style="vertical-align: inherit;">Solo necesita pasar un poco de tiempo desde el principio para configurarlos, y luego tendr√° a√±os de mayor productividad que formar√°n la historia de su proyecto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasta entonces, gracias.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Explicaci√≥n</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para mayor claridad: este art√≠culo de ninguna manera aboga por que, bajo el modelo de su base de datos, necesite doblar todo el sistema (es decir, √°rea tem√°tica, l√≥gica comercial, etc., etc.). </font><font style="vertical-align: inherit;">En este art√≠culo, digo que el c√≥digo del cliente que interact√∫a con la base de datos debe actuar sobre la base del modelo de la base de datos para que no reproduzca el modelo de la base de datos en el estado de "primera clase". </font><font style="vertical-align: inherit;">Esta l√≥gica generalmente se encuentra en el nivel de acceso a datos de su cliente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En arquitecturas de dos niveles, que a√∫n se conservan en algunos lugares, tal modelo de sistema puede ser el √∫nico posible. </font><font style="vertical-align: inherit;">Sin embargo, en la mayor√≠a de los sistemas, el nivel de acceso a datos me parece un "subsistema" que encapsula un modelo de base de datos.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Excepciones</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay excepciones a cualquier regla, y ya he dicho que un enfoque con primac√≠a de la base de datos y generaci√≥n de c√≥digo fuente a veces puede ser inapropiado. </font><font style="vertical-align: inherit;">Aqu√≠ hay un par de excepciones (probablemente hay otras):</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando el circuito es desconocido, y debe abrirse. </font><font style="vertical-align: inherit;">Por ejemplo, usted es un proveedor de una herramienta para ayudar a los usuarios a navegar cualquier esquema. </font><font style="vertical-align: inherit;">Uf </font><font style="vertical-align: inherit;">No hay generaci√≥n de c√≥digo. </font><font style="vertical-align: inherit;">Pero a√∫n as√≠, la base de datos est√° por encima de todo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando se debe generar un circuito sobre la marcha para resolver un problema determinado. </font><font style="vertical-align: inherit;">Este ejemplo parece una versi√≥n ligeramente fantasiosa del patr√≥n de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor de atributo de entidad</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , es decir, realmente no tiene un esquema bien definido. </font><font style="vertical-align: inherit;">En este caso, a menudo es imposible estar seguro de que un RDBMS es adecuado para usted.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las excepciones son inherentemente excepcionales. </font><font style="vertical-align: inherit;">En la mayor√≠a de los casos que involucran el uso de un RDBMS, el esquema se conoce de antemano, se encuentra dentro del RDBMS y es la √∫nica fuente de "verdad", y todos los clientes tienen que adquirir copias que se derivan de √©l. </font><font style="vertical-align: inherit;">Idealmente, debe usar un generador de c√≥digo.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es498796/index.html">Pol√≠tica de seguridad de contenido en Magento 2</a></li>
<li><a href="../es498798/index.html">Sigue aprendiendo y aprendiendo con JetBrains</a></li>
<li><a href="../es498800/index.html">C√≥mo le ense√±√© a mi computadora a jugar Dobble con OpenCV y Deep Learning</a></li>
<li><a href="../es498808/index.html">Vim con soporte YAML para Kubernetes</a></li>
<li><a href="../es498814/index.html">Fallaste una pregunta te√≥rica sobre la Seguridad Social, y te pusieron fin. ¬øEsto es normal? // Estamos condenados # 3</a></li>
<li><a href="../es498820/index.html">Algunas preguntas m√°s dif√≠ciles sobre .NET y C #</a></li>
<li><a href="../es498822/index.html">Desarrollo y creaci√≥n desde cero de una m√°quina arcade para cuatro jugadores.</a></li>
<li><a href="../es498826/index.html">SIL y Salesforce</a></li>
<li><a href="../es498828/index.html">C√≥mo la sal de mesa y las prote√≠nas aumentar√°n la supervivencia del implante</a></li>
<li><a href="../es498830/index.html">Hash + cach√©: optimizaci√≥n de procesamiento de flujo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>