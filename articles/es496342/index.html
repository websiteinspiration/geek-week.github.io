<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßñüèº üë©üèΩ‚Äçü§ù‚Äçüë®üèæ üìå Actualizaci√≥n del proceso de CI / CD: teamcity üà¥ ‚öúÔ∏è ‚òòÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este es el segundo art√≠culo de una serie sobre la actualizaci√≥n de procesos de CI / CD. Hasta este punto, se estaban haciendo preparativos para establ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Actualizaci√≥n del proceso de CI / CD: teamcity</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496342/"><img src="https://habrastorage.org/webt/cu/y-/hg/cuy-hgxvywohqkg_tbyr2wn268c.png" alt="imagen" align="left" width="300"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este es el segundo art√≠culo de una serie sobre la actualizaci√≥n de procesos de CI / CD. Hasta este punto, se estaban haciendo preparativos para establecer nuevas herramientas, a saber: planificaci√≥n, reuniones diarias, resoluci√≥n de desacuerdos, en general, todo sin lo cual no ser√≠a posible construir de manera competente un proceso de trabajo. Y ahora, todos los problemas se han resuelto, estamos seguros de que podemos continuar con el desarrollo, y nuestro c√≥digo no se hundir√° en el agujero negro con el comienzo del verano.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perm√≠tame recordarle la tabla de contenido de la lista de art√≠culos, as√≠ como los breves resultados de la parte anterior. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 1: qu√© es, por qu√© no es as√≠, planificar, una peque√±a fiesta.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Yo llamar√≠a a esta parte casi t√©cnica. </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 2: teamcity. </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 3: despliegue de pulpo.</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Parte 4: detr√°s de escena. Momentos desagradables, planes para el futuro, posiblemente preguntas frecuentes. Lo m√°s probable es que tambi√©n se le pueda llamar casi t√©cnico.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Proporcionamos al cliente una prueba de concepto de un nuevo sistema de entrega de actualizaciones, identificamos las deficiencias del sistema existente, seleccionamos la base para el nuevo, hicimos un plan de transici√≥n y convertimos nuestro repositorio mercurial a git. Adem√°s, en la parte anterior, describimos las caracter√≠sticas del proyecto que afectar√°n todo el proceso posterior.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como se mencion√≥ anteriormente, la soluci√≥n existente no cumpl√≠a con los requisitos modernos. Inicialmente, lo m√°s probable es que se haya configurado una compilaci√≥n en ccnet. La primera compilaci√≥n con la que todo comenz√≥ (como una gran explosi√≥n, s√≠). Luego, aparentemente, la persona que lo configur√≥ todo, presion√≥ ctrl + c, ctrl + v, corrigi√≥ un par de l√≠neas y recibi√≥ una nueva configuraci√≥n. Y durante todo el tiempo posterior, esto se hizo un n√∫mero suficiente de veces para que el c√≥digo fuente en el servidor de compilaci√≥n ocupara m√°s de 60G. ¬°Y estos son solo la fuente! Y hay registros, artefactos de compilaci√≥n, archivos temporales, etc. Solo esto me hizo pensar. Al observar el sistema anterior, se pod√≠a ver lo siguiente: se realiz√≥ un paso de compilaci√≥n para cada m√≥dulo. De hecho, se ensambl√≥ el mismo n√∫cleo. Y este ensamblado se almacen√≥ para cada m√≥dulo (junto con la fuente) en el servidor.Los resultados de la compilaci√≥n (90% id√©nticos) se introdujeron en repositorios locales (implementaci√≥n de git) y, por supuesto, tambi√©n tomaron su lugar. Era posible y necesario dejar esto.&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuraci√≥n general&nbsp;</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En esta etapa, se supone que ya hay una teamcity configurada y un pulpo. </font><font style="vertical-align: inherit;">En la etapa de instalaci√≥n y configuraci√≥n, no nos detenemos en detalle. </font><font style="vertical-align: inherit;">Por conveniencia, anotamos la url y la api-token del pulpo en env teamcity, que, por cierto, para el proyecto ra√≠z se ve as√≠: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sa/vw/ir/savwiryxdsw8fpgrgvdzavejho0.png" alt="imagen"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.apiUserName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.apiUserPassword</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> son accesos api para el usuario de teamcity (se necesitar√°n m√°s adelante), </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.buildPath</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env .sourcePath</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : rutas predeterminadas para compilar archivos y archivos fuente, respectivamente, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.octoApiKey</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.octoUrl</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : URL de token y octopus. </font><font style="vertical-align: inherit;">Todav√≠a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.teamcityUrl</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a√±adido. </font><font style="vertical-align: inherit;">Bueno, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.tt.exe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ruta a la utilidad de transformaci√≥n de texto. </font><font style="vertical-align: inherit;">Esta utilidad genera todas las configuraciones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De los complementos de terceros, solo se instala la integraci√≥n de Octopus Deploy.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para no sobrecargar la gran cantidad de texto, solo se examinar√°n en detalle aquellos pasos en los que haya algo que merezca la atenci√≥n. </font><font style="vertical-align: inherit;">Se supone que todo lo dem√°s es comprensible en funci√≥n de los datos presentados y el conocimiento del lector. </font><font style="vertical-align: inherit;">En cualquier caso, si tiene alguna pregunta, me complacer√° responderla.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desglose del proyecto, versiones, nombres</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El resultado fue un esquema de proyecto de este tipo (como una imagen, porque hay un problema al mostrar una lista multinivel): </font></font><br>
<img src="https://habrastorage.org/webt/-4/oq/gh/-4oqghadht5sr4rdpk7f3igz5do.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
versionaremos los paquetes de la siguiente manera: major.minor.patch, donde major es hasta ahora 1, menor es el contador de compilaci√≥n de la configuraci√≥n de Build, el parche es el contador de compilaci√≥n para la configuraci√≥n Implementar (no es necesario para la configuraci√≥n de compilaci√≥n, por lo tanto, siempre 0). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: la</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> versi√≥n anterior se describe aqu√≠. Lo estamos redise√±ando para que se base en la etiqueta git. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3v/kl/ov/3vklovvjqjnhwa8yg0b3lxtduns.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por ejemplo, aqu√≠ 1 es mayor, 95 es menor y 1 es parche.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el nuevo proceso para m√≥dulos habr√° una compilaci√≥n que luego se implementar√° en cada m√≥dulo. Es decir, el c√≥digo fuente se almacena en una sola copia para cada entorno, el resultado de la compilaci√≥n tambi√©n lo es, ya que es com√∫n para todos los m√≥dulos. Las configuraciones y bibliotecas √∫nicas se empaquetan en un paquete individual en la etapa de implementaci√≥n. Esto utilizar√° efectivamente el espacio en disco y reducir√° el tiempo de entrega de cada paquete. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la etapa de preparaci√≥n, hubo una breve reuni√≥n separada sobre la convenci√≥n de nombrar archivos de configuraci√≥n. Sol√≠a ‚Äã‚Äãser (era justo), pero no siempre es lo mismo. Adem√°s, el nombre de la configuraci√≥n no siempre conten√≠a suficiente informaci√≥n. Como resultado, todos los nombres de configuraci√≥n fueron los siguientes: </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConfigurationType.Environment.ModName.config</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">donde ConfigurationType puede ser AppSettings, Web, etc. </font><font style="vertical-align: inherit;">Medio ambiente: desarrollo, prueba, puesta en escena, producci√≥n. </font><font style="vertical-align: inherit;">ModName es el nombre √∫nico del m√≥dulo.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√≥dulos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos los proyectos de m√≥dulos funcionan con el mismo principio.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada entorno tiene una configuraci√≥n de compilaci√≥n que:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Realiza la restauraci√≥n nuget (instalador NuGet, restauraci√≥n nuget)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Genera configuraciones (l√≠nea de comando, transformaci√≥n de texto)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soluci√≥n Buildit (Visual studio sln)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recoge archivos de env.buildPath en zip y lo empuja hacia octopus (implementaci√≥n de Octopus: paquetes push)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creaci√≥n de lanzamiento (sin implementaci√≥n) (implementaci√≥n de lanzamiento de Octopus)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Restablece la versi√≥n del parche (powershell)</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n hay configuraciones de implementaci√≥n que funcionan en funci√≥n de la plantilla y hacen lo siguiente:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recoge las configuraciones que se generaron en la etapa de compilaci√≥n (paso 2) (paquetes de implementaci√≥n de implementaci√≥n de Octopus)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementar la versi√≥n principal (que se cre√≥ en el paso 6 de la compilaci√≥n) (implementaci√≥n de Octopus: implementaci√≥n de la versi√≥n)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementaci√≥n de la versi√≥n individual (que se cre√≥ en el paso 1 de la configuraci√≥n actual) (implementaci√≥n de Octopus: implementaci√≥n de la versi√≥n)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Muestra una lista de todos los dominios para este m√≥dulo en el registro (paso para la conveniencia del probador y desarrollador). </font><font style="vertical-align: inherit;">(Potencia Shell).</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para cada configuraci√≥n de despliegue, la configuraci√≥n de compilaci√≥n se agrega a la dependencia. </font><font style="vertical-align: inherit;">Esto hace posible iniciar autom√°ticamente la compilaci√≥n cuando se implementa si no es relevante, as√≠ como la capacidad de restablecer la versi√≥n del parche. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Implementar_toda la configuraci√≥n. </font><font style="vertical-align: inherit;">De hecho, esta es una cadena de compilaci√≥n que describe que primero debe ejecutar la compilaci√≥n si no es relevante, y luego instalar simult√°neamente todos los modos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se parece a esto: veamos </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rq/ps/ck/rqpsckl2g8rrt9voltbt082itcu.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
algunos de los pasos con un poco m√°s de detalle.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build.Configuraci√≥n general</font></font></h3><br>
<img src="https://habrastorage.org/webt/g_/5j/b9/g_5jb95h7ei6qexbvckqd8sxs7e.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desde un formato de n√∫mero de compilaci√≥n inusual </font><font style="vertical-align: inherit;">Ser√° explicado m√°s tarde.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build.env</font></font></h3><br>
<img src="https://habrastorage.org/webt/a4/nr/bx/a4nrbxt_8ol6yjuo64npqfxuota.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
inter√©s aqu√≠ son: </font><i><font style="vertical-align: inherit;">env.coreProjectName</font></i><font style="vertical-align: inherit;"> : establecido para todo el proyecto. </font><font style="vertical-align: inherit;">Necesario para identificar el proyecto en pulpo. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.Environment</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : establecido para el subproyecto M√≥dulos. </font><font style="vertical-align: inherit;">Es necesario seleccionar las configuraciones correctas seg√∫n el entorno. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.octoChannel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : el canal en el pulpo en el que cae el paquete. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Igual</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que el medio </font><i><font style="vertical-align: inherit;">ambiente</font></i><font style="vertical-align: inherit;"> . </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.serviceName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es el nombre de la soluci√≥n. </font><font style="vertical-align: inherit;">B√°sicamente, la variable se agrega para facilitar la visualizaci√≥n. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.tenantRoleTag</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : etiqueta de </font><i><font style="vertical-align: inherit;">inquilino</font></i><font style="vertical-align: inherit;"> en el pulpo. </font><font style="vertical-align: inherit;">M√°s detalles en la secci√≥n de pulpo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build.4 </font></font></h3><br>
<img src="https://habrastorage.org/webt/a4/da/r1/a4dar1z6_kawzfttqbuvoivu_mm.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregue al archivo con el nombre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% env.serviceName%.% Build.number% .zip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> archivos del directorio con el resultado de la compilaci√≥n, excluyendo todas las configuraciones, y dll de la carpeta bin / native. </font><font style="vertical-align: inherit;">Los √∫ltimos se agregaron manualmente al servidor web una vez y nadie los volver√° a tocar. </font><font style="vertical-align: inherit;">Si es necesario, tambi√©n se actualizar√°n manualmente (para esto se planea escribir un script por separado, pero seremos honestos). </font><font style="vertical-align: inherit;">Esto se debe al hecho de que estas bibliotecas est√°n "retenidas" por el grupo de IIS, y para una implementaci√≥n exitosa debe detenerse y luego iniciarse, lo que lleva alg√∫n tiempo. </font><font style="vertical-align: inherit;">Al excluir estas bibliotecas de la implementaci√≥n, podemos omitir el paso de detener el grupo, lo que reducir√° el tiempo de implementaci√≥n y, en consecuencia, el tiempo de inactividad.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build.5</font></font></h3><br>
<img src="https://habrastorage.org/webt/us/hu/zx/ushuzxwer8u3iwqnuuqpjbuoodo.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creo que todo est√° claro aqu√≠, excepto por qu√© el campo Entorno est√° vac√≠o. </font><font style="vertical-align: inherit;">En lo que se refiere al paquete, el pulpo toma una decisi√≥n basada en la etiqueta de prelanzamiento (configurada en los canales). </font><font style="vertical-align: inherit;">Esta etiqueta est√° contenida en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% build.number%</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (la misma etapa en la pantalla en Build.General). </font><font style="vertical-align: inherit;">Entonces, en este caso result√≥ ser m√°s conveniente. </font><font style="vertical-align: inherit;">Tambi√©n vale la pena prestar atenci√≥n a la casilla de verificaci√≥n </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Mostrar proceso de implementaci√≥n"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Si no est√° instalado, timsity considera que la construcci√≥n es exitosa tan pronto como el pulpo ha comenzado (¬°pero no ha terminado!) El trabajo. </font><font style="vertical-align: inherit;">Es decir, si la casilla de verificaci√≥n no est√° instalada y algo sali√≥ mal durante la fase de implementaci√≥n, sin mirar la interfaz de Octopus, no lo sabremos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build.6</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nada inusual, solo un script de PowerShell e informaci√≥n de la documentaci√≥n de Teamcity.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$pair</span> = <span class="hljs-string">"%env.apiUserName%:%env.apiUserPassword%"</span>
<span class="hljs-variable">$encodedCreds</span> = [<span class="hljs-type">System.Convert</span>]::ToBase64String([<span class="hljs-type">System.Text.Encoding</span>]::ASCII.GetBytes(<span class="hljs-variable">$pair</span>))
<span class="hljs-variable">$basicAuthValue</span> = <span class="hljs-string">"Basic <span class="hljs-variable">$encodedCreds</span>"</span>
<span class="hljs-variable">$depUri</span>=<span class="hljs-string">"%env.teamcityUrl%/app/rest/buildTypes?locator=snapshotDependency:(from:(build:(id:%teamcity.build.id%)),includeInitial:false)"</span>
<span class="hljs-comment"># Get all dependencies of main build</span>
<span class="hljs-variable">$result</span> = (<span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Headers</span> <span class="hljs-selector-tag">@</span>{<span class="hljs-string">'Origin'</span>=<span class="hljs-string">'http://localhost:8090'</span>; <span class="hljs-string">"Authorization"</span>=<span class="hljs-string">"<span class="hljs-variable">$basicAuthValue</span>"</span>} <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$depUri</span>)
<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$i</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$result</span>.buildTypes.buildType.Count) { <span class="hljs-variable">$buildId</span> += <span class="hljs-variable">$result</span>.buildTypes.buildType.id }
<span class="hljs-variable">$buildId</span> = <span class="hljs-variable">$buildId</span> | <span class="hljs-built_in">Where-Object</span> { <span class="hljs-variable">$_</span> <span class="hljs-operator">-ne</span> <span class="hljs-string">'Module_DeployAll'</span> }
<span class="hljs-comment"># Reset all child build counters to 1. This build counters are patch versions in every build. (1.build.patch)</span>
<span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> <span class="hljs-operator">-lt</span> <span class="hljs-variable">$buildId</span>.Count; <span class="hljs-variable">$i</span>++) {
  <span class="hljs-variable">$buildCounterUri</span> = <span class="hljs-string">"%env.teamcityUrl%/httpAuth/app/rest/buildTypes/"</span>+<span class="hljs-variable">$buildId</span>[<span class="hljs-variable">$i</span>]+<span class="hljs-string">"/settings/buildNumberCounter"</span>
  <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Method</span> Put <span class="hljs-literal">-Headers</span> <span class="hljs-selector-tag">@</span>{<span class="hljs-string">'accept'</span>=<span class="hljs-string">'text/plain'</span>; <span class="hljs-string">'Origin'</span>=<span class="hljs-string">'http://localhost:8090'</span>; <span class="hljs-string">"Authorization"</span>=<span class="hljs-string">"<span class="hljs-variable">$basicAuthValue</span>"</span>} <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$buildCounterUri</span> <span class="hljs-literal">-ContentType</span> <span class="hljs-string">"text/plain"</span> <span class="hljs-literal">-Body</span> <span class="hljs-number">1</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ necesitamos un usuario api en teamcity (se crea env para √©l). </font><font style="vertical-align: inherit;">Iniciamos sesi√≥n, tomamos todas las configuraciones que dependen de la configuraci√≥n de compilaci√≥n y restablecemos su contador de compilaci√≥n a 1. De hecho, para cada versi√≥n de parche, este es un indicador de cu√°ntas veces se implement√≥ la misma compilaci√≥n para un m√≥dulo en particular. </font><font style="vertical-align: inherit;">Si no hay 1, significa que algo sali√≥ mal con el proceso de implementaci√≥n o funcionamiento del m√≥dulo en la versi√≥n actual, y requiere atenci√≥n.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementar.General</font></font></h3><br>
<img src="https://habrastorage.org/webt/aa/lx/p4/aalxp4uzeiofjnfo0tfdx57z0cs.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Formato de versi√≥n: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.% dep.Module_Build.build.counter%.% Build.counter% -staging</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , donde </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% dep.Module_Build.build.counter%</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es la variable del sistema teamcity cuyo valor corresponde al contador de compilaci√≥n de la configuraci√≥n de construcci√≥n correspondiente (debe agregarse a dependencias) </font><font style="vertical-align: inherit;">De hecho, aqu√≠ 1 es la versi√≥n principal, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% dep.Module_Build.build.counter%</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es menor y </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% build.counter%</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es parche. </font><font style="vertical-align: inherit;">la puesta en escena es una etiqueta de prelanzamiento.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deploy.Env</font></font></h3><br>
<img src="https://habrastorage.org/webt/wl/lc/sv/wllcsv3zxji40gzu-p1ef-vlgu4.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al agregar un nuevo m√≥dulo, solo se agrega la configuraci√≥n para su implementaci√≥n y se </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indica</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> el valor de la variable </font><i><font style="vertical-align: inherit;">env.modName</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Todas las dem√°s variables se heredan de los proyectos principales. </font><font style="vertical-align: inherit;">La variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.tenantModTag</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para un pulpo se forma a partir de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.modName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementar.2</font></font></h3><br>
<img src="https://habrastorage.org/webt/zt/yx/2q/ztyx2q7ffqxfpwxtsrrol6ojfqy.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Implementar paquete principal.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√∫mero de versi√≥n m√°s reciente: use la √∫ltima versi√≥n disponible para este entorno. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Etiqueta de inquilino: etiqueta de cliente / organizaci√≥n. </font><font style="vertical-align: inherit;">M√°s detalles en la secci√≥n de pulpo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par√°metros adicionales de cli. </font><font style="vertical-align: inherit;">Aqu√≠ indicamos el canal en el que caer√° nuestro paquete, as√≠ como los par√°metros adicionales. </font><font style="vertical-align: inherit;">Esto tambi√©n se discutir√° por separado en la secci√≥n de pulpo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementar.3</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al igual que Deploy.2, solo se implementa un paquete de m√≥dulo individual.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementar.4</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este paso tambi√©n se describir√° en detalle a continuaci√≥n, ya que recibe datos del pulpo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las configuraciones para el sitio web de la empresa y el m√≥dulo especial se basan en el mismo principio, y los puntos principales en ellos son los mismos, por lo que no veo el punto de describirlos con el mismo detalle. Son uno, no necesitan implementarse muchas veces, y de hecho hay restauraci√≥n nuget, transformaci√≥n de texto, msbuild, push de pulpo, octopus create release + deploy.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obtenga m√°s informaci√≥n sobre configuraciones √∫nicas. </font><font style="vertical-align: inherit;">Para algunos mods, puede que no haya entornos (por ejemplo, etapas), deben implementarse en otros servidores o debe establecer manualmente el identificador del cliente (tome la configuraci√≥n b√°sica y cambie algunos campos en √©l usando powershell). </font><font style="vertical-align: inherit;">Es decir, funcionan seg√∫n el mismo principio que los m√≥dulos principales. </font><font style="vertical-align: inherit;">Su singularidad radica en el hecho de que se agregan / cambian pasos para ellos, o se cambia el servidor de implementaci√≥n y no se ajustan a la plantilla, por lo que lleva un poco m√°s de tiempo crearlos. </font><font style="vertical-align: inherit;">Afortunadamente, hay pocos de ellos.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teamcity: resumen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La implementaci√≥n de teamcity permiti√≥ un enfoque m√°s √≥ptimo para el proceso de ensamblaje de la aplicaci√≥n. Ahora lleva mucho menos tiempo: en lugar de crear el mismo c√≥digo cada vez, lo creamos una vez. Tambi√©n hacemos un mejor uso del espacio en disco, el tr√°fico de red y el tiempo de computaci√≥n. Anteriormente, el n√∫mero de paquetes para implementaci√≥n (repositorios con artefactos) era igual al n√∫mero de m√≥dulos. Cada paquete pesaba aproximadamente 100M en forma comprimida. Ahora tenemos el n√∫mero de paquetes uno m√°s que el n√∫mero de m√≥dulos, con un paquete que pesa aproximadamente los mismos 100M y el resto unos 500K. Adem√°s de una interfaz m√°s f√°cil de usar, registros convenientes y, lo que es m√°s importante, reduce el tiempo de mantenimiento del sistema de compilaci√≥n y agrega configuraciones. Ahora agregar un nuevo m√≥dulo lleva de 15 minutos a media hora.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por separado, debe decirse sobre las plantillas, ya que es la estandarizaci√≥n lo que nos permite ahorrar tiempo en la creaci√≥n de nuevas configuraciones y su posterior mantenimiento. Todas las configuraciones para interactuar con Octopus (desplegar) se basan en una sola plantilla. En primer lugar, permite unificar y, por lo tanto, simplificar el proceso. En segundo lugar, como ya se mencion√≥, ahorra tiempo al agregar nuevas configuraciones: hemos conectado una plantilla, cambiado una variable, y eso es todo. Y lo m√°s importante, las plantillas simplifican el mantenimiento. Todos los cambios realizados en la plantilla son heredados por las configuraciones basadas en ella. Por lo tanto, si necesitamos agregar alg√∫n paso a todas las configuraciones a la vez, no necesitamos hacer clic en todas, simplemente agregue este paso a la plantilla.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Naturalmente, el proceso de configuraci√≥n de teamcity fue de la mano con la configuraci√≥n de Octopus. </font><font style="vertical-align: inherit;">Es simplemente imposible describir en paralelo en el texto, ya que existe una gran posibilidad de confusi√≥n. </font><font style="vertical-align: inherit;">Por lo tanto, la descripci√≥n se ha compartido y en esta parte solo se describen los pasos para proporcionar CI. </font><font style="vertical-align: inherit;">El proceso de configuraci√≥n del pulpo se describir√° a continuaci√≥n.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es496332/index.html">Antidron: reflejo de UAV y ataques quadrocopter</a></li>
<li><a href="../es496334/index.html">Revisi√≥n del Dell U4919DW: monitor de pantalla curva ultra ancha de 49 pulgadas</a></li>
<li><a href="../es496336/index.html">¬øPara qu√© sirven los medidores inteligentes?</a></li>
<li><a href="../es496338/index.html">Crisis y eso es todo</a></li>
<li><a href="../es496340/index.html">Capacitamos a la red generativa competitiva para dibujar im√°genes en Azure ML</a></li>
<li><a href="../es496344/index.html">¬øSon los hackathons en l√≠nea de cuarentena el momento adecuado?</a></li>
<li><a href="../es496346/index.html">Agregamos una comprobaci√≥n de hash de rootkit hunter en el script diario</a></li>
<li><a href="../es496348/index.html">Estudios de casos de API de almacenamiento web</a></li>
<li><a href="../es496350/index.html">¬°No pasar√°s! - Las impresoras 3D responden al coronavirus</a></li>
<li><a href="../es496354/index.html">Programaci√≥n ternaria: juega con el emulador</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>