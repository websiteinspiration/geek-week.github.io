<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😘 🍀 👩🏾‍🤝‍👩🏼 HackTheBox. Nest pas à pas. Flux NTFS, marche arrière C # et SMB 😏 ⭐️ 🧑🏾‍🤝‍🧑🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je continue de publier des solutions envoyées pour un traitement ultérieur à partir du site HackTheBox . 
 
 Dans cet article, nous nous promenons dan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>HackTheBox. Nest pas à pas. Flux NTFS, marche arrière C # et SMB</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/505620/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/1q/ca/yw/1qcaywxbp6rhhpdnvzrz962rtuq.png" alt="image"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je continue de publier des solutions envoyées pour </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un traitement ultérieur à</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partir du site </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">HackTheBox</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, nous nous promenons dans les ressources SMB depuis longtemps, trouvons des flux NTFS alternatifs et inversons l'application en C #. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La connexion au laboratoire se fait via VPN. </font><font style="vertical-align: inherit;">Il est recommandé de ne pas se connecter à partir d'un ordinateur de travail ou d'un hôte où les données importantes pour vous sont disponibles, car vous vous retrouvez sur un réseau privé avec des personnes qui connaissent quelque chose dans le domaine de la sécurité de l'information :)</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Information organisationnelle</font></font></b>
                        <div class="spoiler_text">      ,     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">  Telegram</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">    </a>   .    , ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">    </a>.<br>
<a name="habracut"></a><br>
      .          ,  -      ,      .<br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recon</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette machine a une adresse IP 10.10.10.178, que j'ajoute à / etc / hosts.</font></font><br>
<br>
<pre><code class="plaintext hljs">10.10.10.178    nest.htb</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, nous analysons les ports ouverts. </font><font style="vertical-align: inherit;">Puisqu'il faut beaucoup de temps pour analyser tous les ports avec nmap, je vais d'abord le faire avec masscan. </font><font style="vertical-align: inherit;">Nous analysons tous les ports TCP et UDP à partir de l'interface tun0 à une vitesse de 500 paquets par seconde.</font></font><br>
<br>
<pre><code class="bash hljs">masscan -e tun0 -p1-65535,U:1-65535 10.10.10.178  --rate=500</code></pre><br>
<img src="https://habrastorage.org/webt/xj/kx/xl/xjkxxlv08bbqnoe4gbgwtguoxps.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, pour des informations plus détaillées sur les services qui fonctionnent sur les ports, nous allons exécuter une analyse avec l'option -A.</font></font><br>
<br>
<pre><code class="bash hljs">nmap -A nest.htb -p445,4386</code></pre><br>
<img src="https://habrastorage.org/webt/m0/of/ri/m0ofrismd3eiavaq3pwsdwrnf5u.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, prêtons attention à la ressource SMB. Essayons de nous connecter en tant qu'invité. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/er/ja/sr/erjasr0e1z10xlk-viawzul3ztw.png" alt="image"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sauna </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et découvrez les ressources disponibles. Examinons récursivement tout le contenu dont nous disposons. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/eo/g7/m_/eog7m_ppephro2mox1k3qiiav4w.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parmi les fichiers ci-dessus, la note la plus intéressante est «Welcome Email.txt». Nous allons nous connecter à la ressource et enregistrer ce fichier sur notre machine locale. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pz/bj/np/pzbjnpsuibvqekhaw8srf-94ns8.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et dans le message lui-même, la ressource et les informations d'identification pour s'y connecter sont signalées. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sa/j2/gh/saj2ghkvbfk8lny49jizvvawyfm.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons tout le contenu de la ressource, mais déjà en utilisant les informations d'identification trouvées. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kx/ld/_8/kxld_8g1kwwcgrzgsjidyj8xi1o.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce cas, nous devrions toujours être intéressés par les fichiers de configuration, car vous pouvez y trouver les noms des ressources, des services ou même des informations d'identification. Par conséquent, nous nous connectons à nouveau à la ressource et prenons toutes les configurations.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n1/rr/zm/n1rrzmayhnjffj3qcrykh_fmsq0.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et dans un fichier, nous trouvons le nom de la ressource privée "Secure $", et dans l'autre - les informations d'identification de l'utilisateur. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/b1/f0/wc/b1f0wciwt8jctq6xpggbn6h3-oi.png" alt="image"><br>
<br>
<img src="https://habrastorage.org/webt/v7/gp/cz/v7gpcze1fwtf_5ktriy3x7tn3c4.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais le mot de passe ne correspond pas, apparemment il est crypté. Mais il s'avère qu'il s'agit de la ressource trouvée avec les informations d'identification existantes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9l/x0/bg/9lx0bgkmvtsdmun0mmxdbg4apo4.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais nous ne pouvons pas afficher le contenu du répertoire informatique, car nous avons un répertoire à l'intérieur (il découle de la configuration). Nous examinons l'intégralité du contenu de \ Secure $ \ IT \ Carl \. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vq/pz/af/vqpzaftcpmf2e8fipswnp2m-p7q.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le projet VisualBasic s'y trouve. Je me suis connecté via l'explorateur et j'ai copié le dossier du projet sur la machine locale. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vh/x5/fj/vhx5fj_fhxvhyflzzj51sdjztvm.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous ouvrons le projet et trouvons l'endroit où le mot de passe est lu dans la configuration et décrypté. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yl/rl/2t/ylrl2tkmtdg2m6cemcg7v12cy3q.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après un rapide coup d'œil au principe de chiffrement lui-même, je ne voulais pas vraiment grimper, alors nous chargeons le projet dans Visual Studio et modifions le code pour trouver le mot de passe lors du débogage.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d8/bm/5x/d8bm5xgp4myrmxhfarjrkptq-as.png" alt="image"><br>
<br>
<img src="https://habrastorage.org/webt/-q/oq/nd/-qoqndiavdp-95wpjrqvscvbzbs.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous découvrons donc le vrai mot de passe de l'utilisateur. </font><font style="vertical-align: inherit;">Nous nous connectons et prenons le jeton.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pg/xc/xq/pgxcxqkosw6yyvbxw9ylt7hehc0.png" alt="image"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RACINE</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous regardons plus loin dans le répertoire de travail de l'utilisateur. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xq/82/ua/xq82uaot_ewfco-r8zoccjit8sg.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À partir du fichier de configuration, nous comprenons ce qui fonctionne sur le deuxième port. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sc/e4/bu/sce4buc1y2ojoojs5afzfjgi72o.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais en se connectant et en voyant de l'aide, nous comprenons que nous avons besoin d'un mot de passe. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5i/6t/x5/5i6tx5hboicu1cy54axpuwgby9m.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons dans le répertoire et téléchargeons l'application, peut-être en l'analysant, nous pouvons trouver le mot de passe. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kw/hz/r4/kwhzr41tyd7ycefdozvehrcxdpc.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est heureux que cette application soit écrite en C #, cela nous permettra de décompiler facilement l'ensemble du projet en utilisant dnSpy. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vb/yv/je/vbyvjettxqh2e1kmkuy5uld6k9g.png" alt="image"><br>
<br>
<img src="https://habrastorage.org/webt/b-/03/dd/b-03ddpj7wa36l3yquitc4qe4eu.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, le programme, le programme reçoit un fichier de configuration en entrée, d'où il obtient certains paramètres. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ru/bh/4c/rubh4cc_xlxeuoeid_zbzrixlvy.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais nous ne trouvons rien dans le projet. </font><font style="vertical-align: inherit;">En outre, beaucoup de temps a été passé jusqu'à ce que la réalisation vienne à pair dans le fichier vide "Debug Mode Password.txt". </font><font style="vertical-align: inherit;">Connectez la ressource réseau.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lj/za/ww/ljzaww9bc1okdei5zb6ijm2mili.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons maintenant tous les flux de ce fichier. Et nous déterminons que le flux de mots de passe contient 15 caractères. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jc/ex/ui/jcexuiyaeurfbkqtyifktjyl7l8.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous le lisons, trouvons le mot de passe pour le mode debug (terne ... ça arrive). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h6/j-/zd/h6j-zdp23tjyzvghmvtavtueuvs.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous nous connectons à nouveau, entrez ce mot de passe et consultez l'aide. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kb/ow/qx/kbowqxqut1w80cxgj-emecsytv8.png" alt="image"><br>
<br>
<img src="https://habrastorage.org/webt/2_/le/oz/2_leozjuut9uequuljlrsbipvre.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, cela valait la peine de se promener dans l'application, car vous devez trouver une sorte de configuration pour le projet décompilé. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pc/ny/qy/pcnyqykndlb9rjh8sxkzxssa-q0.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A en juger par le nom de l'application, passons à LDAP. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4k/sw/wl/4kswwl3l-kjdx_mxow_q4jb31pg.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et encore une fois, nous trouvons l'application que nous avons déjà et le fichier de configuration. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ix/kq/wf/ixkqwfnbqek_xvaqotvzb4ttp9i.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce sont les paramètres qui sont convertis dans l'application. Recherchez la fonction de déchiffrement et tracez la valeur sur la console avant de la renvoyer. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vj/ao/fr/vjaofrlr3cxfxlo45gwp1zntgk4.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, nous allons modifier l'une des conditions afin que l'application ne s'arrête pas lors de la recherche d'un fichier.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7x/x-/f_/7xx-f_w2b8glnjotuipvuezzjbw.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous recompilons le projet et exécutons l'application, en spécifiant la configuration comme argument. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fo/ug/s5/fougs58hhnawb91i6tpbsybm63s.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et nous obtenons le mot de passe administrateur. </font><font style="vertical-align: inherit;">Ensuite, nous nous connectons avec succès en utilisant psexec. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_u/ty/ku/_utykuvl0nxpltgzolgmckr19eq.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons un contrôle total sur la machine. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez nous rejoindre sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegram</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vous y trouverez du matériel intéressant, des cours fusionnés ainsi que des logiciels. </font><font style="vertical-align: inherit;">Créons une communauté dans laquelle il y aura des gens qui connaissent bien de nombreux domaines de l'informatique, puis nous pourrons toujours nous entraider pour tout problème informatique et de sécurité de l'information.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr505608/index.html">Vuex - résoudre un vieux différend avec de nouvelles méthodes</a></li>
<li><a href="../fr505612/index.html">MK-61: historique, émulation, appareil</a></li>
<li><a href="../fr505614/index.html">Les taux des dépôts des plus grandes banques sont tombés à un minimum historique: comment cela affecte-t-il l'économie et où change-t-il</a></li>
<li><a href="../fr505616/index.html">Reconnaissance de l'alphabet russe: de la collecte d'un ensemble de données à la création d'une interface graphique</a></li>
<li><a href="../fr505618/index.html">Modèles GRASP: Créateur</a></li>
<li><a href="../fr505624/index.html">Comment traiter une trame de données avec des milliards d'enregistrements en quelques secondes?</a></li>
<li><a href="../fr505632/index.html">Allocateurs de mémoire</a></li>
<li><a href="../fr505634/index.html">Paramètres de proxy pour WSL (Ubuntu)</a></li>
<li><a href="../fr505640/index.html">Évaluation de la publication Objectivité</a></li>
<li><a href="../fr505642/index.html">Coroutines transparentes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>