<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕳️ ⬜️ ⏮️ “什么码头？” 或者我们使用Xamarin（Android）上的移动应用程序通过蓝牙控制控制器 👨🏻‍🚀 ↔️ 💫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在上一篇文章中，我答应过谈如何使用UART将CANNY 3 tiny连接到蓝牙。而且由于您在这些五月的假期中不会真正散散步，因此决定度过一段有益的时光，并且仍然信守诺言。但是仅仅将控制器连接到蓝牙适配器HC-06，对于Habr来说太容易了。
 
 因此，我们不仅会连接所有内容，还将使用C＃和Xama...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>“什么码头？” 或者我们使用Xamarin（Android）上的移动应用程序通过蓝牙控制控制器</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500454/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在上</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一篇文章中，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我答应过谈如何使用UART将CANNY 3 tiny连接到蓝牙。</font><font style="vertical-align: inherit;">而且由于您在这些五月的假期中不会真正散散步，因此决定度过一段有益的时光，并且仍然信守诺言。</font><font style="vertical-align: inherit;">但是仅仅将控制器连接到蓝牙适配器HC-06，对于Habr来说太容易了。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们不仅会连接所有内容，还将使用C＃和Xamarin为电路编写一个原始的Android应用程序。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您喜欢我喜欢的“限位开关”和簧片开关的监控，欢迎您的到来。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/a6/2t/ai/a62taim0dwnonrmzzjhicax8q-g.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这就是我们今天要谈论的内容：</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一部分：简介</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二部分：连接CANNY 3 tiny的电路和程序</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第三部分：我们在Xamarin上为Android编写了一个应用程序</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第四部分：结论</font></font></a><br>
<a name="I"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 第一部分：简介</font></font></h2> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我先从好的代码开始，除了在C＃中插入程序代码外，这一次，本文将相对较小，因为我们已较早地研究了使用控制器的基本技术。</font><font style="vertical-align: inherit;">为了不再重复，这里列出了一些文章，在这些文章中，我们已经研究了使用CANNY控制器的基本方法：</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“一，二，三-烧圣诞树！” </font><font style="vertical-align: inherit;">或我第一次看到CANNY 3微型控制器</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -在本文中，我们分析了控制器的含义，以及在CannyLab开发环境中工作的基础知识。</font></font><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“目的地有很多伪装……”，或者我们使用CANNY 3 tiny和光敏电阻自动控制灯</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -在本文中，我们研究了使用USB虚拟COM端口，将传感器连接到ADC以及在控制器输出端使用高频PWM的方法。</font></font><br>
</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">«  ...»         (CANNY  Arduino)  Raspberry PI</a> —        UART,     .<br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在准备本文时，我使用了以下硬件：CANNY 3微型控制器，HC-06蓝牙适配器，限位开关（Trema模块），簧片开关，旧有线耳机，面包板，电线，鳄鱼。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将构建一个系统，该系统使用移动应用程序监视两个传感器的状态，并在必要时可以手动发出警报。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本文将介绍的所有内容都是出于教育和示范目的而发明的。我只是想展示一些与控制器一起使用的技巧，以及一次购买的铁片，以某种方式计算出它们的价值。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
尽管要解决的问题的性质与现实相去甚远，但我们可以想象，我们正在隔室的滑动门后面制造一个监视系统。</font><font style="vertical-align: inherit;">当它开始移动时，簧片开关将起作用，并且在路径的尽头它将向拖车发出信号。</font><font style="vertical-align: inherit;">例如，如果我们需要引起注意，以使门关闭，我们将通过扬声器发出“吱吱”的信号。</font><font style="vertical-align: inherit;">是的，我没有扬声器，但是有旧耳机。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jq/wn/cn/jqwncnwbb_hvquu7qyfhlvhw10q.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">好吧，和往常一样，一个音符。</font><font style="vertical-align: inherit;">我强烈不建议将本文中的材料用作最终的真理。</font><font style="vertical-align: inherit;">我本人第一次做很多事情，当然可以做得更好。</font></font><br>
</i><br>
<a name="II"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二部分：连接CANNY 3 tiny的电路和程序</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，为了不冒犯</font><font style="vertical-align: inherit;">他人的</font><font style="vertical-align: inherit;">版权，我从</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">论坛上</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">借来了东西</font><font style="vertical-align: inherit;">，但我自己通过将它们</font><font style="vertical-align: inherit;">连接到HC-06 </font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">想法来</font><font style="vertical-align: inherit;">适应他们的</font><font style="vertical-align: inherit;">想法，方法是通过``串行蓝牙终端''应用程序控制它并在开发图表时使用一些技巧</font><font style="vertical-align: inherit;">你的任务。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接线图如下：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kt/lj/7c/ktlj7chkvqtuk-omahss0xxyxx4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
限位开关和簧片开关连接到6号和5号控制器的端子，耳机连接到4号端子（具有RF PWM），UART RX是1号端子，UART TX是2号端子，3号端子。它用于提供“ + 5V”，输出“-”-与“地”进行通信。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是组装时的样子：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/57/hy/du/57hydukatcvw7-mihshfkaykr20.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我在CannyLab 1.42版中为CANNY 3开发了图表（程序），也许在其他版本的开发环境中以及与其他控制器一起使用时，有必要对图表进行更改。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是发生的事情：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/l8/mb/yr/l8mbyr6rzisiqurje5vrboprrio.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
与控制器设置和通过UART发送消息相关</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">模块在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一篇文章中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已分解</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们更详细地研究剩下的两个。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接收UART消息</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”块</font><font style="vertical-align: inherit;">负责打开警笛（耳机）。原则上，需要解析通过UART接收消息的示例。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，我们检查接收到的数据是否在UART中，如果存在，则将其发送到D触发器输入“ E”，在这种情况下，触发器将复制“ D”输入中的值，然后将其写入通过UART接收的消息中的前两个字符。我不想使所有事情复杂化，因此我们将进一步使用一个简单的方案。我们假设UART会收到从00到99的任何数字，我们会将其从符号形式转换为数字形式（我建议阅读</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转换器模块的工作方式；</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我有一个小的“插头”）。此外，前沿检测器的输入上的任何值&gt; 0“都将导致一个信号，该信号在RF PWM模式下运行5秒钟将输出5导通。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以使用RF PWM的填充时间在设置中播放，耳机中的声音将取决于此。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们继续前进</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“消息的形成</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><b><font style="vertical-align: inherit;">”</font></b><font style="vertical-align: inherit;">乍一看它的实现似乎很不寻常。这是因为我并没有真正弄清楚如何使用串行蓝牙终端程序以及Xamarin中的相同蓝牙协议。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我会向前走一点，说我还没有学会如何在智能手机上接收从控制器发送的消息。如果上一篇文章中的有线UART一切都显而易见，那么实际上是使用蓝牙，而不是发送的消息，只能读取其一部分，并且违反了传输命令的含义。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我认为最简单的解决方案是传输单个号码，这样可以保证到达接收方而不会造成损失。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在我们的案例中，我们监视磁簧开关和限位开关的离散状态。也就是说，我们只有4种可能的组合：簧片开关和限位开关关闭，仅一个打开，两个都打开。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
由于簧片开关和限位开关会给出离散信号（0/1），因此您需要以某种方式区分它们。为此，我们将簧片信号的值乘以2.现在事实证明，信号的总和将为我们提供从0到3的值。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在我们将分析一个非显而易见的选项，将其加上50事实是CannyLab向UART发送了两个字符，即03，而不是3，但是正如我所说，存在丢失某些信息的风险。例如，从值01开始，智能手机上的程序只能读取第一个“ 0”，这已经是一个错误。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可能会感到困惑并转换数据，例如用一些字母或空格替换寄存器的“ D1”字符，但我决定简化一下。我将值01转换为51（02转换为52，依此类推）。这五个不带信号，我在智能手机的程序级别将其剪切掉了。因此，我们始终保证保留消息的有用部分。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将程序加载到控制器中，单击“运行”，如果一切按计划进行，则HC-06将定期闪烁红色LED。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，我们将智能手机与适配器配对。现在，您可以在“串行蓝牙终端”应用程序或任何其他具有类似功能的应用程序中检查性能。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
写下蓝牙适配器的地址，这将在下一章中对我们很有用。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7q/9_/cj/7q9_cjavutr8evwh-bzcjo7lu_o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如您所见，根据传感器的状态，数据来了，如果您发送“ 11”，则在耳机中会听到讨厌的尖叫声。</font><font style="vertical-align: inherit;">我们可以在这里停止，但让我们来概述一个原始应用程序。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可以从</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载用于控制器的程序和用于智能手机的程序的源代码。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我想指出的是，您不必在CANNY控制器上专门在硬件中实现所有功能，您可以为Arduino或其他喜欢的控制器编写程序。</font><font style="vertical-align: inherit;">最初，我本人还计划为Arduino写草图的另一个版本，但是由于我几乎杀死了所有的五月假期，所以我再也没有能力连接CANNY和智能手机应用程序。</font></font><br>
<a name="III"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第三部分：编写Xamarin Android应用程序 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
坦率地说，我知道Xamarin并不是移动开发最受欢迎的解决方案。也许您已经有一个问题：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“我为什么选择它？”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。我想用Psoya Korolenko同名歌曲中的话回答他：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ky/lq/bd/kylqbdcllbxokagsfxfjtasavrg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
老实说，没有客观原因。就在几年前，我学习了C＃的基础知识，每个人都想看看Xamarin是什么。而现在，由于“自我孤立”，人们终于可以动手了。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好吧，让我再次提醒您。这是我第一次见到Xamarin，这是我的第一个Android应用程序。不要盲目复制我的曲线代码，如果突然之间您可以找到更漂亮的解决方案，请使用它。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在开发程序时，我依赖</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">于此材料</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这篇文章并没有特别的嚼劲，甚至是西班牙语，所以我仍然觉得可以与您分享我在该主题上的变化。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我在Visual Studio 2019社区版中构建了该程序。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，如图所示，创建一个新的空Android项目（Xamarin）。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gw/ic/hz/gwichz5ldmq0k8wgpoedzpnt41u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我仅对三个文件进行了更改，它们可以在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub上</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全查看</font><font style="vertical-align: inherit;">，在这里我们将仅分析重要的部分：</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AndroidManifest.xml</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
2权限已添加到标准模板中：</font></font><br>
<br>
<pre><code class="cs hljs">  &lt;uses-permission android:name=<span class="hljs-string">"android.permission.BLUETOOTH"</span>/&gt;<font></font>
  &lt;uses-permission android:name=<span class="hljs-string">"android.permission.BLUETOOTH_ADMIN"</span>/&gt;
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">activity_main.xml</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
默认容器（RelativeLayout）已被删除。</font><font style="vertical-align: inherit;">相反，添加LinearLayout容器仅仅是因为它更简单。</font><font style="vertical-align: inherit;">在此容器中，所有元素都垂直对齐，并在屏幕的整个宽度上延伸。</font></font><br>
<br>
<pre><code class="cs hljs">&lt;LinearLayout<font></font>
    xmlns:android=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
    android:orientation=<span class="hljs-string">"vertical"</span>
    android:minWidth=<span class="hljs-string">"25px"</span>
    android:minHeight=<span class="hljs-string">"25px"</span>
    android:layout_width=<span class="hljs-string">"match_parent"</span>
    android:layout_height=<span class="hljs-string">"match_parent"</span>
    android:id=<span class="hljs-string">"@+id/linearLayout1"</span>&gt;<font></font>
    &lt;TextView<font></font>
        android:text=<span class="hljs-string">"Reed switch status - undefined"</span>
        android:layout_width=<span class="hljs-string">"match_parent"</span>
        android:layout_height=<span class="hljs-string">"wrap_content"</span>
        android:id=<span class="hljs-string">"@+id/rSwitch"</span>
        android:textSize=<span class="hljs-string">"12pt"</span> /&gt;<font></font>
    &lt;TextView<font></font>
        android:text=<span class="hljs-string">"End sensor status - undefined"</span>
        android:layout_width=<span class="hljs-string">"match_parent"</span>
        android:layout_height=<span class="hljs-string">"wrap_content"</span>
        android:id=<span class="hljs-string">"@+id/EndSensor"</span>
        android:textSize=<span class="hljs-string">"12pt"</span> /&gt;<font></font>
    &lt;Button<font></font>
        android:layout_width=<span class="hljs-string">"match_parent"</span>
        android:layout_height=<span class="hljs-string">"wrap_content"</span>
        android:id=<span class="hljs-string">"@+id/startSiren"</span>
        android:text=<span class="hljs-string">"Send signal to siren"</span> /&gt;<font></font>
    &lt;Switch<font></font>
        android:layout_width=<span class="hljs-string">"match_parent"</span>
        android:layout_height=<span class="hljs-string">"wrap_content"</span>
        android:id=<span class="hljs-string">"@+id/bltSwitch"</span>
        android:<span class="hljs-keyword">checked</span>=<span class="hljs-string">"false"</span>
        android:showText=<span class="hljs-string">"true"</span>
        android:text=<span class="hljs-string">"Connect bluetooth"</span> /&gt;<font></font>
    &lt;TextView<font></font>
        android:text=<span class="hljs-string">"status"</span>
        android:textAppearance=<span class="hljs-string">"?android:attr/textAppearanceSmall"</span>
        android:layout_width=<span class="hljs-string">"match_parent"</span>
        android:layout_height=<span class="hljs-string">"wrap_content"</span>
        android:id=<span class="hljs-string">"@+id/status"</span> /&gt;<font></font>
&lt;/LinearLayout&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
任何稍微熟悉HTML布局或XML的人都可以轻松理解用户界面的结构。</font><font style="vertical-align: inherit;">我们有三个只读文本字段（TextView），一个开关（Switch），基本上像一个复选框一样工作，还有一个普通按钮（Button）。</font><font style="vertical-align: inherit;">可以通过从构造函数中拖放元素来将元素放置在窗体上，也可以在属性窗口或代码中将元素设置为更方便的ID，文本存根和其他参数。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
剩下要描述程序的逻辑。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MainActivity.cs</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
下面，在扰流板下方，整个代码是为了方便起见</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完整的MainActivity.cs代码</font></font></b>
                        <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-comment">// based on http://alejandroruizvarela.blogspot.com/2014/01/bluetooth-arduino-xamarinandroid.html</span>
<span class="hljs-comment">// for this article https://habr.com/ru/post/500454/</span><font></font>
<font></font>
<font></font>
<span class="hljs-comment">// based on http://alejandroruizvarela.blogspot.com/2014/01/bluetooth-arduino-xamarinandroid.html</span>
<span class="hljs-comment">// for this article https://habr.com/ru/post/500454/</span><font></font>
<font></font>
<font></font>
<span class="hljs-keyword">using</span> Android.App;
<span class="hljs-keyword">using</span> Android.OS;
<span class="hljs-keyword">using</span> Android.Support.V7.App;
<span class="hljs-keyword">using</span> Android.Runtime;
<span class="hljs-keyword">using</span> Android.Widget;
<span class="hljs-keyword">using</span> System.Linq;
<span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.IO;
<span class="hljs-keyword">using</span> Java.Util;
<span class="hljs-keyword">using</span> Android.Bluetooth;
<span class="hljs-keyword">using</span> System.Threading.Tasks;<font></font>
<font></font>
<span class="hljs-keyword">namespace</span> _6.<span class="hljs-title">Canny_Xanarin_Bluetooth_Android</span><font></font>
{<font></font>
    [<span class="hljs-meta">Activity(Label = <span class="hljs-meta-string">"Control Canny 3 tiny via bluetooth"</span>, Theme = <span class="hljs-meta-string">"@style/AppTheme"</span>, MainLauncher = true)</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> : <span class="hljs-title">AppCompatActivity</span><font></font>
    {<font></font>
<font></font>
        Button startSiren;<font></font>
        TextView rSwitch;<font></font>
        TextView EndSensor;<font></font>
        Switch bltSwitch;<font></font>
        TextView status;<font></font>
        <span class="hljs-keyword">private</span> Java.Lang.String dataToSend;
        <span class="hljs-keyword">private</span> BluetoothAdapter mBluetoothAdapter = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">private</span> BluetoothSocket btSocket = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">private</span> Stream outStream = <span class="hljs-literal">null</span>;
        <span class="hljs-comment">// don't forget change addres to your device:</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> address = <span class="hljs-string">"98:D3:91:F9:6C:F6"</span>;
        <span class="hljs-comment">// MY_UUID can be saved as is</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> UUID MY_UUID = UUID.FromString(<span class="hljs-string">"00001101-0000-1000-8000-00805F9B34FB"</span>);
        <span class="hljs-keyword">private</span> Stream inStream = <span class="hljs-literal">null</span>;<font></font>
<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnCreate</span>(<span class="hljs-params">Bundle savedInstanceState</span>)</span><font></font>
        {<font></font>
<font></font>
            <span class="hljs-keyword">base</span>.OnCreate(savedInstanceState);<font></font>
            Xamarin.Essentials.Platform.Init(<span class="hljs-keyword">this</span>, savedInstanceState);
            <span class="hljs-comment">// Set our view from the "main" layout resource</span><font></font>
            SetContentView(Resource.Layout.activity_main);<font></font>
<font></font>
            startSiren = FindViewById&lt;Button&gt;(Resource.Id.startSiren);<font></font>
            rSwitch = FindViewById&lt;TextView&gt;(Resource.Id.rSwitch);<font></font>
            EndSensor = FindViewById&lt;TextView&gt;(Resource.Id.EndSensor);<font></font>
            status = FindViewById&lt;TextView&gt;(Resource.Id.status);<font></font>
            bltSwitch = FindViewById&lt;Switch&gt;(Resource.Id.bltSwitch);<font></font>
<font></font>
<font></font>
            startSiren.Click += startSiren_ClickOnButtonClicked;<font></font>
            bltSwitch.CheckedChange += bltSwitch_HandleCheckedChange;<font></font>
            CheckBt();<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CheckBt</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            mBluetoothAdapter = BluetoothAdapter.DefaultAdapter;<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (!mBluetoothAdapter.Enable())<font></font>
            {<font></font>
                Toast.MakeText(<span class="hljs-keyword">this</span>, <span class="hljs-string">"Bluetooth Off"</span>,<font></font>
                    ToastLength.Short).Show();<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (mBluetoothAdapter == <span class="hljs-literal">null</span>)<font></font>
            {<font></font>
                Toast.MakeText(<span class="hljs-keyword">this</span>,
                    <span class="hljs-string">"Bluetooth does not exist or is busy"</span>, ToastLength.Short)<font></font>
                    .Show();<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">startSiren_ClickOnButtonClicked</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> sender, EventArgs e</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">if</span> (bltSwitch.Checked)<font></font>
            {<font></font>
                <span class="hljs-keyword">try</span><font></font>
                {<font></font>
                    dataToSend = <span class="hljs-keyword">new</span> Java.Lang.String(<span class="hljs-string">"11"</span>);<font></font>
                    writeData(dataToSend);<font></font>
                    System.Console.WriteLine(<span class="hljs-string">"Send signal to siren"</span>);<font></font>
                }<font></font>
                <span class="hljs-keyword">catch</span> (System.Exception execept)<font></font>
                {<font></font>
                    System.Console.WriteLine(<span class="hljs-string">"Error when send data"</span> + execept.Message);<font></font>
                }<font></font>
<font></font>
            }<font></font>
            <span class="hljs-keyword">else</span> status.Text = <span class="hljs-string">"bluetooth not connected"</span>;<font></font>
        }<font></font>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">bltSwitch_HandleCheckedChange</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> sender, CompoundButton.CheckedChangeEventArgs e</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">if</span> (e.IsChecked)<font></font>
            {<font></font>
                Connect();<font></font>
            }<font></font>
            <span class="hljs-keyword">else</span><font></font>
            {<font></font>
                status.Text = <span class="hljs-string">"bluetooth not connected"</span>;
                <span class="hljs-keyword">if</span> (btSocket.IsConnected)<font></font>
                {<font></font>
                    <span class="hljs-keyword">try</span><font></font>
                    {<font></font>
                        btSocket.Close();<font></font>
                        System.Console.WriteLine(<span class="hljs-string">"Connection closed"</span>);<font></font>
                    }<font></font>
                    <span class="hljs-keyword">catch</span> (System.Exception ex)<font></font>
                    {<font></font>
                        Console.WriteLine(ex.Message);<font></font>
                    }<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Connect</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            BluetoothDevice device = mBluetoothAdapter.GetRemoteDevice(address);<font></font>
            System.Console.WriteLine(<span class="hljs-string">"Connection in progress"</span> + device);<font></font>
            mBluetoothAdapter.CancelDiscovery();<font></font>
            <span class="hljs-keyword">try</span><font></font>
            {<font></font>
                btSocket = device.CreateRfcommSocketToServiceRecord(MY_UUID);<font></font>
                btSocket.Connect();<font></font>
                System.Console.WriteLine(<span class="hljs-string">"Correct Connection"</span>);<font></font>
                status.Text = <span class="hljs-string">"Correct Connection to bluetooth"</span>;<font></font>
            }<font></font>
            <span class="hljs-keyword">catch</span> (System.Exception e)<font></font>
            {<font></font>
                Console.WriteLine(e.Message);<font></font>
                <span class="hljs-keyword">try</span><font></font>
                {<font></font>
                    btSocket.Close();<font></font>
                    System.Console.WriteLine(<span class="hljs-string">"Connection closed"</span>);<font></font>
                }<font></font>
                <span class="hljs-keyword">catch</span> (System.Exception)<font></font>
                {<font></font>
                    System.Console.WriteLine(<span class="hljs-string">"Impossible to connect"</span>);<font></font>
                    status.Text = <span class="hljs-string">"Impossible to connect"</span>;<font></font>
                }<font></font>
                System.Console.WriteLine(<span class="hljs-string">"Socket Created"</span>);<font></font>
  <font></font>
            }<font></font>
            beginListenForData();<font></font>
<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">beginListenForData</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">try</span><font></font>
            {<font></font>
                inStream = btSocket.InputStream;<font></font>
            }<font></font>
            <span class="hljs-keyword">catch</span> (System.IO.IOException ex)<font></font>
            {<font></font>
                Console.WriteLine(ex.Message);<font></font>
            }<font></font>
            Task.Factory.StartNew(() =&gt; {<font></font>
                <span class="hljs-keyword">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];
                <span class="hljs-keyword">int</span> bytes;<font></font>
                <font></font>
                <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)<font></font>
                {<font></font>
<font></font>
                    <span class="hljs-keyword">try</span><font></font>
                    {<font></font>
                        bytes = inStream.Read(buffer, <span class="hljs-number">0</span>, <span class="hljs-number">1024</span>);<font></font>
                        System.Console.WriteLine(<span class="hljs-string">"bytes "</span> + bytes.ToString());
                        <span class="hljs-keyword">if</span> (bytes &gt; <span class="hljs-number">0</span>)<font></font>
                        {<font></font>
                            <font></font>
                            RunOnUiThread(() =&gt; {<font></font>
                                <span class="hljs-keyword">string</span> valor = System.Text.Encoding.ASCII.GetString(buffer).Replace(<span class="hljs-string">"5"</span>,String.Empty);
                                <span class="hljs-comment">// transform string for deleate all symbols except 1-4(command from canny).</span>
                                <span class="hljs-keyword">string</span> command = <span class="hljs-keyword">new</span> <span class="hljs-keyword">string</span>(valor.Where(<span class="hljs-keyword">char</span>.IsDigit).ToArray());<font></font>
<font></font>
                                <span class="hljs-keyword">if</span> (command.Length &gt; <span class="hljs-number">0</span>)<font></font>
                                {<font></font>
                                     status.Text=<span class="hljs-string">"data successfully readed"</span>;<font></font>
                                    System.Console.WriteLine(<span class="hljs-string">"command  "</span> + command);
                                    <span class="hljs-keyword">switch</span> (Int32.Parse(command))<font></font>
                                    {<font></font>
                                        <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<font></font>
                                            rSwitch.Text = <span class="hljs-string">"reed switch - disconnected "</span>;<font></font>
                                            EndSensor.Text = <span class="hljs-string">"end sensor - not pressed "</span>;
                                            <span class="hljs-keyword">break</span>;
                                        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
                                            rSwitch.Text = <span class="hljs-string">"reed switch - disconnected "</span>;<font></font>
                                            EndSensor.Text = <span class="hljs-string">"end sensor - pressed "</span>;
                                            <span class="hljs-keyword">break</span>;
                                        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
                                            rSwitch.Text = <span class="hljs-string">"reed switch - connected "</span>;<font></font>
                                            EndSensor.Text = <span class="hljs-string">"end sensor - not pressed "</span>;
                                            <span class="hljs-keyword">break</span>;
                                        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<font></font>
                                            rSwitch.Text = <span class="hljs-string">"reed switch - connected "</span>;<font></font>
                                            EndSensor.Text = <span class="hljs-string">"end sensor - pressed "</span>;
                                        <span class="hljs-keyword">break</span>;<font></font>
                                    }<font></font>
                                }<font></font>
                            });<font></font>
                        }<font></font>
                    }<font></font>
                    <span class="hljs-keyword">catch</span> (Java.IO.IOException)<font></font>
                    {<font></font>
                        RunOnUiThread(() =&gt; {<font></font>
                            EndSensor.Text = <span class="hljs-string">"End sensor status - undefined"</span>;<font></font>
                            rSwitch.Text = <span class="hljs-string">"Reed switch status - undefined "</span>;<font></font>
                        });<font></font>
                        <span class="hljs-keyword">break</span>;<font></font>
                    }<font></font>
                }<font></font>
            });<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writeData</span>(<span class="hljs-params">Java.Lang.String data</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">try</span><font></font>
            {<font></font>
                outStream = btSocket.OutputStream;<font></font>
            }<font></font>
            <span class="hljs-keyword">catch</span> (System.Exception e)<font></font>
            {<font></font>
                System.Console.WriteLine(<span class="hljs-string">"Error with OutputStream when write to Serial port"</span> + e.Message);<font></font>
            }<font></font>
<font></font>
            Java.Lang.String message = data;<font></font>
<font></font>
            <span class="hljs-keyword">byte</span>[] msgBuffer = message.GetBytes();<font></font>
<font></font>
            <span class="hljs-keyword">try</span><font></font>
            {<font></font>
                outStream.Write(msgBuffer, <span class="hljs-number">0</span>, msgBuffer.Length);<font></font>
                System.Console.WriteLine(<span class="hljs-string">"Message sent"</span>);<font></font>
            }<font></font>
            <span class="hljs-keyword">catch</span> (System.Exception e)<font></font>
            {<font></font>
                System.Console.WriteLine(<span class="hljs-string">"Error with  when write message to Serial port"</span> + e.Message);<font></font>
                status.Text = <span class="hljs-string">"Error with  when write message to Serial port"</span>;<font></font>
            }<font></font>
        }<font></font>
<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnRequestPermissionsResult</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> requestCode, <span class="hljs-keyword">string</span>[] permissions, [GeneratedEnum] Android.Content.PM.Permission[] grantResults</span>)</span><font></font>
        {<font></font>
            Xamarin.Essentials.Platform.OnRequestPermissionsResult(requestCode, permissions, grantResults);<font></font>
<font></font>
            <span class="hljs-keyword">base</span>.OnRequestPermissionsResult(requestCode, permissions, grantResults);<font></font>
        }<font></font>
    }<font></font>
 }<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在分为几部分。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
具有名称空间，类声明等连接的块 </font><font style="vertical-align: inherit;">我会想念。</font></font><br>
 <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们创建变量，稍后将使用它们绑定用户界面元素：</font></font><br>
<br>
<pre><code class="cs hljs">   Button startSiren;<font></font>
   TextView rSwitch;<font></font>
   TextView EndSensor;<font></font>
   Switch bltSwitch;<font></font>
   TextView status;<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来是我所依赖的示例中的代码。</font><font style="vertical-align: inherit;">某些方法的操作所必需的变量（字段）。</font></font><br>
<br>
<pre><code class="cs hljs">  <span class="hljs-keyword">private</span> Java.Lang.String dataToSend;
        <span class="hljs-keyword">private</span> BluetoothAdapter mBluetoothAdapter = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">private</span> BluetoothSocket btSocket = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">private</span> Stream outStream = <span class="hljs-literal">null</span>;
        <span class="hljs-comment">// don't forget change addres to your device:</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> address = <span class="hljs-string">"98:D3:91:F9:6C:F6"</span>;
        <span class="hljs-comment">// MY_UUID can be saved as is</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> UUID MY_UUID = UUID.FromString(<span class="hljs-string">"00001101-0000-1000-8000-00805F9B34FB"</span>);
        <span class="hljs-keyword">private</span> Stream inStream = <span class="hljs-literal">null</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于我们来说，在此处将HC-06模块的地址驱动到地址字段中非常重要。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
由于这是我第一次使用智能手机进行开发，包括使用Xamarin，因此我决定不对其进行复杂化处理，因此设备地址（如原始示例中所示）是固定的。</font><font style="vertical-align: inherit;">如果需要，您可以看一下</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本文</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，似乎已经实现了对可用蓝牙设备的搜索。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
继续。</font></font><br>
<br>
<pre><code class="cs hljs">
        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnCreate</span>(<span class="hljs-params">Bundle savedInstanceState</span>)</span><font></font>
        {<font></font>
<font></font>
            <span class="hljs-keyword">base</span>.OnCreate(savedInstanceState);<font></font>
            Xamarin.Essentials.Platform.Init(<span class="hljs-keyword">this</span>, savedInstanceState);
            <span class="hljs-comment">// Set our view from the "main" layout resource</span><font></font>
            SetContentView(Resource.Layout.activity_main);<font></font>
<font></font>
            startSiren = FindViewById&lt;Button&gt;(Resource.Id.startSiren);<font></font>
            rSwitch = FindViewById&lt;TextView&gt;(Resource.Id.rSwitch);<font></font>
            EndSensor = FindViewById&lt;TextView&gt;(Resource.Id.EndSensor);<font></font>
            status = FindViewById&lt;TextView&gt;(Resource.Id.status);<font></font>
            bltSwitch = FindViewById&lt;Switch&gt;(Resource.Id.bltSwitch);<font></font>
<font></font>
<font></font>
            startSiren.Click += startSiren_ClickOnButtonClicked;<font></font>
            bltSwitch.CheckedChange += bltSwitch_HandleCheckedChange;<font></font>
            CheckBt();<font></font>
        }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此方法是自动创建的，我们的任务是将其中的UI对象与该类的字段相关联，并附加处理程序以响应事件（</font></font><code>startSiren.Click  bltSwitch.CheckedChange</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过蓝牙检查连接：</font></font><br>
<br>
<pre><code class="cs hljs">
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CheckBt</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            mBluetoothAdapter = BluetoothAdapter.DefaultAdapter;<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (!mBluetoothAdapter.Enable())<font></font>
            {<font></font>
                Toast.MakeText(<span class="hljs-keyword">this</span>, <span class="hljs-string">"Bluetooth Off"</span>,<font></font>
                    ToastLength.Short).Show();<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (mBluetoothAdapter == <span class="hljs-literal">null</span>)<font></font>
            {<font></font>
                Toast.MakeText(<span class="hljs-keyword">this</span>,
                    <span class="hljs-string">"Bluetooth does not exist or is busy"</span>, ToastLength.Short)<font></font>
                    .Show();<font></font>
            }<font></font>
        }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
打开警笛。</font><font style="vertical-align: inherit;">本质上只是将字符“ 11”发送给控制器：</font></font><br>
<br>
<pre><code class="cs hljs">
   <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">startSiren_ClickOnButtonClicked</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> sender, EventArgs e</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">if</span> (bltSwitch.Checked)<font></font>
            {<font></font>
                <span class="hljs-keyword">try</span><font></font>
                {<font></font>
                    dataToSend = <span class="hljs-keyword">new</span> Java.Lang.String(<span class="hljs-string">"11"</span>);<font></font>
                    writeData(dataToSend);<font></font>
                    System.Console.WriteLine(<span class="hljs-string">"Send signal to siren"</span>);<font></font>
                }<font></font>
                <span class="hljs-keyword">catch</span> (System.Exception execept)<font></font>
                {<font></font>
                    System.Console.WriteLine(<span class="hljs-string">"Error when send data"</span> + execept.Message);<font></font>
                }<font></font>
<font></font>
            }<font></font>
            <span class="hljs-keyword">else</span> status.Text = <span class="hljs-string">"bluetooth not connected"</span>;<font></font>
        }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
检查开关的状态（如果向右移动，则表明它已打开）： </font></font><br>
<br>
<pre><code class="cs hljs">   <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">bltSwitch_HandleCheckedChange</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> sender, CompoundButton.CheckedChangeEventArgs e</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">if</span> (e.IsChecked)<font></font>
            {<font></font>
                Connect();<font></font>
            }<font></font>
            <span class="hljs-keyword">else</span><font></font>
            {<font></font>
                <span class="hljs-keyword">if</span> (btSocket.IsConnected)<font></font>
                {<font></font>
                    <span class="hljs-keyword">try</span><font></font>
                    {<font></font>
                        btSocket.Close();<font></font>
                        System.Console.WriteLine(<span class="hljs-string">"Connection closed"</span>);<font></font>
                    }<font></font>
                    <span class="hljs-keyword">catch</span> (System.Exception ex)<font></font>
                    {<font></font>
                        Console.WriteLine(ex.Message);<font></font>
                    }<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当您打开电源时，我们将开始与蓝牙的连接。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
连接本身的实现：</font></font><br>
<br>
<pre><code class="cs hljs">   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Connect</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            BluetoothDevice device = mBluetoothAdapter.GetRemoteDevice(address);<font></font>
            System.Console.WriteLine(<span class="hljs-string">"Connection in progress"</span> + device);<font></font>
            mBluetoothAdapter.CancelDiscovery();<font></font>
            <span class="hljs-keyword">try</span><font></font>
            {<font></font>
                btSocket = device.CreateRfcommSocketToServiceRecord(MY_UUID);<font></font>
                btSocket.Connect();<font></font>
                System.Console.WriteLine(<span class="hljs-string">"Correct Connection"</span>);<font></font>
                status.Text = <span class="hljs-string">"Correct Connection to bluetooth"</span>;<font></font>
            }<font></font>
            <span class="hljs-keyword">catch</span> (System.Exception e)<font></font>
            {<font></font>
                Console.WriteLine(e.Message);<font></font>
                <span class="hljs-keyword">try</span><font></font>
                {<font></font>
                    btSocket.Close();<font></font>
                    System.Console.WriteLine(<span class="hljs-string">"Connection closed"</span>);<font></font>
                }<font></font>
                <span class="hljs-keyword">catch</span> (System.Exception)<font></font>
                {<font></font>
                    System.Console.WriteLine(<span class="hljs-string">"Impossible to connect"</span>);<font></font>
                    status.Text = <span class="hljs-string">"Impossible to connect"</span>;<font></font>
                }<font></font>
                System.Console.WriteLine(<span class="hljs-string">"Socket Created"</span>);<font></font>
  <font></font>
            }<font></font>
            beginListenForData();<font></font>
<font></font>
        }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是最重要的方法之一-直接读取数据：</font></font><br>
<br>
<pre><code class="cs hljs">
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">beginListenForData</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">try</span><font></font>
            {<font></font>
                inStream = btSocket.InputStream;<font></font>
            }<font></font>
            <span class="hljs-keyword">catch</span> (System.IO.IOException ex)<font></font>
            {<font></font>
                Console.WriteLine(ex.Message);<font></font>
            }<font></font>
            Task.Factory.StartNew(() =&gt; {<font></font>
                <span class="hljs-keyword">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];
                <span class="hljs-keyword">int</span> bytes;<font></font>
                <font></font>
                <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)<font></font>
                {<font></font>
<font></font>
                    <span class="hljs-keyword">try</span><font></font>
                    {<font></font>
                        bytes = inStream.Read(buffer, <span class="hljs-number">0</span>, <span class="hljs-number">1024</span>);<font></font>
                        System.Console.WriteLine(<span class="hljs-string">"bytes "</span> + bytes.ToString());
                        <span class="hljs-keyword">if</span> (bytes &gt; <span class="hljs-number">0</span>)<font></font>
                        {<font></font>
                            <font></font>
                            RunOnUiThread(() =&gt; {<font></font>
                                <span class="hljs-keyword">string</span> valor = System.Text.Encoding.ASCII.GetString(buffer).Replace(<span class="hljs-string">"5"</span>,String.Empty);
                                <span class="hljs-comment">// transform string for deleate all symbols except 1-4(command from canny).</span>
                                <span class="hljs-keyword">string</span> command = <span class="hljs-keyword">new</span> <span class="hljs-keyword">string</span>(valor.Where(<span class="hljs-keyword">char</span>.IsDigit).ToArray());<font></font>
<font></font>
                                <span class="hljs-keyword">if</span> (command.Length &gt; <span class="hljs-number">0</span>)<font></font>
                                {<font></font>
                                     status.Text=<span class="hljs-string">"data successfully readed"</span>;<font></font>
                                    System.Console.WriteLine(<span class="hljs-string">"command  "</span> + command);
                                    <span class="hljs-keyword">switch</span> (Int32.Parse(command))<font></font>
                                    {<font></font>
                                        <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<font></font>
                                            rSwitch.Text = <span class="hljs-string">"reed switch - disconnected "</span>;<font></font>
                                            EndSensor.Text = <span class="hljs-string">"end sensor - not pressed "</span>;
                                            <span class="hljs-keyword">break</span>;
                                        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
                                            rSwitch.Text = <span class="hljs-string">"reed switch - disconnected "</span>;<font></font>
                                            EndSensor.Text = <span class="hljs-string">"end sensor - pressed "</span>;
                                            <span class="hljs-keyword">break</span>;
                                        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
                                            rSwitch.Text = <span class="hljs-string">"reed switch - connected "</span>;<font></font>
                                            EndSensor.Text = <span class="hljs-string">"end sensor - not pressed "</span>;
                                            <span class="hljs-keyword">break</span>;
                                        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<font></font>
                                            rSwitch.Text = <span class="hljs-string">"reed switch - connected "</span>;<font></font>
                                            EndSensor.Text = <span class="hljs-string">"end sensor - pressed "</span>;
                                        <span class="hljs-keyword">break</span>;<font></font>
                                    }<font></font>
                                }<font></font>
                            });<font></font>
                        }<font></font>
                    }<font></font>
                    <span class="hljs-keyword">catch</span> (Java.IO.IOException)<font></font>
                    {<font></font>
                        RunOnUiThread(() =&gt; {<font></font>
                            EndSensor.Text = <span class="hljs-string">"End sensor status - undefined"</span>;<font></font>
                            rSwitch.Text = <span class="hljs-string">"Reed switch status - undefined "</span>;<font></font>
                        });<font></font>
                        <span class="hljs-keyword">break</span>;<font></font>
                    }<font></font>
                }<font></font>
            });<font></font>
        }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
据我所知，我在示例中留下了该方法的许多元素，首先，它与数据流建立了连接，如果缓冲区中有一些内容与读取的数据一起被读取，则将其读取到变量中</font></font><code>valor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">而且，正如我所承诺的，我们只需删除数字“ 5”。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，我们从读取的消息中删除除数字以外的所有字符</font></font><code>string command = new string(valor.Where(char.IsDigit).ToArray());</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
，然后，一切变得简单，这取决于所</font><font style="vertical-align: inherit;">收到的数字，</font><font style="vertical-align: inherit;">从而在UI中显示此状态。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我没有从根本上更改这两种方法：</font></font><br>
<br>
<pre><code class="cs hljs">  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writeData</span>(<span class="hljs-params">Java.Lang.String data</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">try</span><font></font>
            {<font></font>
                outStream = btSocket.OutputStream;<font></font>
            }<font></font>
            <span class="hljs-keyword">catch</span> (System.Exception e)<font></font>
            {<font></font>
                System.Console.WriteLine(<span class="hljs-string">"Error with OutputStream when write to Serial port"</span> + e.Message);<font></font>
            }<font></font>
<font></font>
            Java.Lang.String message = data;<font></font>
<font></font>
            <span class="hljs-keyword">byte</span>[] msgBuffer = message.GetBytes();<font></font>
<font></font>
            <span class="hljs-keyword">try</span><font></font>
            {<font></font>
                outStream.Write(msgBuffer, <span class="hljs-number">0</span>, msgBuffer.Length);<font></font>
                System.Console.WriteLine(<span class="hljs-string">"Message sent"</span>);<font></font>
            }<font></font>
            <span class="hljs-keyword">catch</span> (System.Exception e)<font></font>
            {<font></font>
                System.Console.WriteLine(<span class="hljs-string">"Error with  when write message to Serial port"</span> + e.Message);<font></font>
                status.Text = <span class="hljs-string">"Error with  when write message to Serial port"</span>;<font></font>
            }<font></font>
        }<font></font>
<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnRequestPermissionsResult</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> requestCode, <span class="hljs-keyword">string</span>[] permissions, [GeneratedEnum] Android.Content.PM.Permission[] grantResults</span>)</span><font></font>
        {<font></font>
            Xamarin.Essentials.Platform.OnRequestPermissionsResult(requestCode, permissions, grantResults);<font></font>
<font></font>
            <span class="hljs-keyword">base</span>.OnRequestPermissionsResult(requestCode, permissions, grantResults);<font></font>
        }<font></font>
    }<font></font>
 }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
据我了解，此代码块实现了消息的发送和事件处理程序，以扩大访问蓝牙的权限。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好了，剩下的就是建立</font><font style="vertical-align: inherit;">用于</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">调试应用程序</font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的智能手机连接</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
奇怪的是，但是它可以工作：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/jm/vs/5z/jmvs5zdesg9lvfprcdbp5-cebes.png"><br>
<a name="IV"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 第四部分：结论</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该程序的工作方式如下：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8b/4r/kv/8b4rkvzlvtcl-nnqh-fb1dm8cey.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是我在Android上为智能手机开发应用程序的第一次经验。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我想指出的是，旧计算机上的VS 2019和Xamarin的运行速度非常慢。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在项目的第一次组装中，我真的设法吃了这些柔软的法式面包卷和喝茶。而且，坦白地说，应用程序本身很痛苦，打开/关闭开关不能很方便地工作，但是另一方面，鉴于我对.NET的基本开发技术只有一点点熟悉，而且我根本不是程序员，所以我什至可以无需完成单个教程或单个课程，就可以在一天内概述您的第一个应用程序。因此，用于创建基本应用程序的进入阈值非常低。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
据我了解，CANNY控制器可用于汽车（尤其是家用汽车）的调试，因此很有可能具有某种“功能”并为其编写智能手机应用程序。</font><font style="vertical-align: inherit;">要记住的主要事情是，当通过车辆的车载网络供电时，控制器的输出也将具有与输入相同的电压（例如12V而不是5V）。</font><font style="vertical-align: inherit;">不要忘记保护蓝牙适配器，以免其意外失效。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这篇文章对我来说非常费力，我希望一切都没有白费，您会喜欢的。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN500444/index.html">区分初学者和经验丰富的9种Python编程技能</a></li>
<li><a href="../zh-CN500446/index.html">关于R2DBC和PostgreSQL的几句话</a></li>
<li><a href="../zh-CN500448/index.html">Prometheus：通过Blackbox导出程序进行HTTP监视</a></li>
<li><a href="../zh-CN500450/index.html">用儿童合成器制作MIDI键盘</a></li>
<li><a href="../zh-CN500452/index.html">深度学习的高度推理</a></li>
<li><a href="../zh-CN500456/index.html">BpfTrace-最后，在Linux上完全替代Dtrace</a></li>
<li><a href="../zh-CN500458/index.html">在线语音技术功能：入门包</a></li>
<li><a href="../zh-CN500462/index.html">检测场景变化并将h264视频剪辑保存到Raspberry Pi中而不进行解码</a></li>
<li><a href="../zh-CN500468/index.html">Java功能指南8-14</a></li>
<li><a href="../zh-CN500470/index.html">使您现有的业务解决方案适应SwiftUI。第3部分。使用体系结构</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>