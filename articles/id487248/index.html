<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§›ğŸ¾ ğŸ“™ â†•ï¸ Sedikit lagi tentang pengujian yang tidak tepat â˜”ï¸ ğŸ‘¦ğŸ¿ ğŸ†“</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Suatu hari saya tidak sengaja melihat kode bahwa seorang pengguna mencoba untuk memantau kinerja RAM di mesin virtualnya. Saya tidak akan memberikan k...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Sedikit lagi tentang pengujian yang tidak tepat</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487248/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suatu hari saya tidak sengaja melihat kode bahwa seorang pengguna mencoba untuk memantau kinerja RAM di mesin virtualnya. </font><font style="vertical-align: inherit;">Saya tidak akan memberikan kode ini (ada "alas kaki") dan hanya meninggalkan yang paling penting. </font><font style="vertical-align: inherit;">Jadi, kucingnya ada di studio!</font></font><br>
<a name="habracut"></a><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/time.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CNT 1024</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SIZE (1024*1024)</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">timeval</span> <span class="hljs-title">start</span>;</span>
	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">timeval</span> <span class="hljs-title">end</span>;</span>
	<span class="hljs-keyword">long</span> millis;
	<span class="hljs-keyword">double</span> gbs;
	<span class="hljs-keyword">char</span> ** buffers;<font></font>
	buffers = <span class="hljs-keyword">new</span> <span class="hljs-keyword">char</span>*[CNT];
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;CNT;i++) {<font></font>
		buffers[i] = <span class="hljs-keyword">new</span> <span class="hljs-keyword">char</span>[SIZE];<font></font>
	}<font></font>
	gettimeofday(&amp;start, <span class="hljs-literal">NULL</span>);
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;CNT;i++) {
		<span class="hljs-built_in">memset</span>(buffers[i], <span class="hljs-number">0</span>, SIZE);<font></font>
	}<font></font>
	gettimeofday(&amp;end, <span class="hljs-literal">NULL</span>);<font></font>
	millis = (end.tv_sec - start.tv_sec) * <span class="hljs-number">1000</span> +<font></font>
		(end.tv_usec - start.tv_usec) / <span class="hljs-number">1000</span>;<font></font>
	gbs = <span class="hljs-number">1000.0</span> / millis;
	<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; gbs &lt;&lt; <span class="hljs-string">" GB/s\n"</span>;
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;CNT;i++) {
		<span class="hljs-keyword">delete</span> buffers[i];<font></font>
	}<font></font>
	<span class="hljs-keyword">delete</span> buffers;
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semuanya sederhana - kami mengalokasikan memori dan menulis satu gigabyte ke dalamnya. Dan apa yang ditunjukkan oleh tes ini? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ ./memtest </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.06504 GB / s</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Sekitar 4GB / s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa?!?! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagaimana?!?!? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah Core i7 (meskipun bukan yang terbaru), DDR4, prosesornya hampir tidak dimuat - MENGAPA?!?! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jawabannya, seperti biasa, luar biasa biasa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Operator baru (seperti fungsi malloc, omong-omong) sebenarnya tidak mengalokasikan memori. Dengan panggilan ini, pengalokasi melihat daftar bagian bebas di kumpulan memori, dan jika tidak ada, panggilan sbrk () untuk memperbesar segmen data, dan kemudian mengembalikan program tautan ke alamat dari bagian yang baru dipilih. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masalahnya adalah area yang dipilih benar-benar virtual. Halaman memori nyata tidak dialokasikan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan ketika akses pertama ke setiap halaman dari segmen yang dipilih ini terjadi, MMU "menembak" kesalahan halaman, setelah itu halaman virtual dimana akses dibuat ditugaskan ke yang asli. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oleh karena itu, pada kenyataannya, kami menguji bukan kinerja modul bus dan RAM, tetapi kinerja MMU dan VMM dari sistem operasi. </font><font style="vertical-align: inherit;">Dan untuk menguji kinerja RAM yang sebenarnya, kita hanya perlu menginisialisasi bagian yang dialokasikan sekali. </font><font style="vertical-align: inherit;">Misalnya, seperti ini:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/time.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CNT 1024</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SIZE (1024*1024)</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">timeval</span> <span class="hljs-title">start</span>;</span>
	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">timeval</span> <span class="hljs-title">end</span>;</span>
	<span class="hljs-keyword">long</span> millis;
	<span class="hljs-keyword">double</span> gbs;
	<span class="hljs-keyword">char</span> ** buffers;<font></font>
	buffers = <span class="hljs-keyword">new</span> <span class="hljs-keyword">char</span>*[CNT];
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;CNT;i++) {
                <span class="hljs-comment">// FIXED HERE!!!</span>
		buffers[i] = <span class="hljs-keyword">new</span> <span class="hljs-keyword">char</span>[SIZE](); <span class="hljs-comment">// Add brackets, &amp;$# !!!</span><font></font>
	}<font></font>
	gettimeofday(&amp;start, <span class="hljs-literal">NULL</span>);
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;CNT;i++) {
		<span class="hljs-built_in">memset</span>(buffers[i], <span class="hljs-number">0</span>, SIZE);<font></font>
	}<font></font>
	gettimeofday(&amp;end, <span class="hljs-literal">NULL</span>);<font></font>
	millis = (end.tv_sec - start.tv_sec) * <span class="hljs-number">1000</span> +<font></font>
		(end.tv_usec - start.tv_usec) / <span class="hljs-number">1000</span>;<font></font>
	gbs = <span class="hljs-number">1000.0</span> / millis;
	<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; gbs &lt;&lt; <span class="hljs-string">" GB/s\n"</span>;
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;CNT;i++) {
		<span class="hljs-keyword">delete</span> buffers[i];<font></font>
	}<font></font>
	<span class="hljs-keyword">delete</span> buffers;
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artinya, kita cukup menginisialisasi buffer yang dialokasikan dengan nilai default (char 0). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Memeriksa: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ ./memtest </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
28,5714 GB / s</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Hal lain. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Moral - jika Anda membutuhkan buffer besar untuk bekerja dengan cepat dan cepat, jangan lupa untuk menginisialisasi mereka.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id487248/">https://habr.com/ru/post/id487248/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id487232/index.html">Pencetakan kekebalan pada masa kanak-kanak: asal mula perlindungan virus</a></li>
<li><a href="../id487234/index.html">Besi atau optimasi? Badoo, Avito dan Mamba - tentang kinerja PHP</a></li>
<li><a href="../id487238/index.html">Bagaimana merancang peralatan perlindungan jaringan listrik</a></li>
<li><a href="../id487242/index.html">Februari Acara TI Digest</a></li>
<li><a href="../id487246/index.html">Otoritas Sertifikasi Tensor dapat membahayakan kunci pribadi pelanggan</a></li>
<li><a href="../id487250/index.html">Alfa tertunda berbaur</a></li>
<li><a href="../id487254/index.html">Cara menggunakan kamera CCTV tidak hanya untuk memantau penyusup</a></li>
<li><a href="../id487256/index.html">Membakar dan kembali dari abu atau orang Phoenix</a></li>
<li><a href="../id487258/index.html">PHP asinkron</a></li>
<li><a href="../id487260/index.html">NoVerify: linter PHP yang bekerja cepat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>