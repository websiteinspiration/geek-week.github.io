<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÜóÔ∏è üõë ‚ùï Arquitectura limpia a trav√©s de los ojos de un desarrollador de Python üë®üèæ‚Äçüî¨ üÜí üßïüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¬°Hola! Mi nombre es Eugene, soy desarrollador de Python. Durante el √∫ltimo a√±o y medio, nuestro equipo comenz√≥ a aplicar activamente los principios de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Arquitectura limpia a trav√©s de los ojos de un desarrollador de Python</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/exness/blog/494370/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°Hola! Mi nombre es Eugene, soy desarrollador de Python. Durante el √∫ltimo a√±o y medio, nuestro equipo comenz√≥ a aplicar activamente los principios de Arquitectura limpia, alej√°ndose del modelo cl√°sico de MVC. Y hoy hablar√© sobre c√≥mo llegamos a esto, qu√© nos da y por qu√© la transferencia directa de enfoques de otros PL no siempre es una buena soluci√≥n.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/t_/hs/tl/t_hstlzmkevavrg4y8tazjdfu4c.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Python ha sido mi principal herramienta de desarrollo durante m√°s de siete a√±os. Cuando me preguntan qu√© es lo que m√°s me gusta de √©l, respondo que esta es su </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">excelente legibilidad</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . El primer conocido comenz√≥ con una lectura del libro </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Programaci√≥n de una mente colectiva"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Estaba interesado en los algoritmos descritos en √©l, pero todos los ejemplos estaban en un lenguaje que a√∫n no me resultaba familiar. Esto no era habitual (Python todav√≠a no era corriente en el aprendizaje autom√°tico), las listas a menudo se escrib√≠an en pseudoc√≥digo o usando diagramas. Pero despu√©s de una r√°pida introducci√≥n al lenguaje, apreci√© su concisi√≥n: todo fue </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f√°cil y claro, nada superfluo y distractor, solo la esencia del proceso descrito.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">El principal m√©rito de esto es el sorprendente dise√±o del lenguaje, el az√∫car sint√°ctico muy intuitivo. </font><font style="vertical-align: inherit;">Esta expresividad siempre ha sido apreciada en la comunidad. </font><font style="vertical-align: inherit;">Lo </font><font style="vertical-align: inherit;">que </font><font style="vertical-align: inherit;">" </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">importa esto</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", necesariamente presente en las primeras p√°ginas de cualquier libro de texto, cuesta: parece un supervisor invisible, eval√∫a constantemente sus acciones. </font><font style="vertical-align: inherit;">En los foros, val√≠a la pena el uso de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CamelCase de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> alguna manera </font><font style="vertical-align: inherit;">en el nombre de la variable en la lista, por lo que inmediatamente el √°ngulo de discusi√≥n cambi√≥ hacia el idioma del c√≥digo propuesto con referencias a PEP8.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La b√∫squeda de la elegancia m√°s el poderoso dinamismo del lenguaje han creado muchas bibliotecas con una API realmente encantadora.&nbsp;</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, Python, aunque potente, es solo una herramienta que le permite escribir c√≥digo expresivo y autodocumentado, pero </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no garantiza esto</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ni el cumplimiento de PEP8. </font><font style="vertical-align: inherit;">Cuando nuestra tienda en l√≠nea aparentemente simple en Django comienza a ganar dinero y, como resultado, aumenta las funciones, en un momento nos damos cuenta de que no es tan simple, e incluso hacer cambios b√°sicos requiere m√°s y m√°s esfuerzo, y lo m√°s importante, esta tendencia </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est√° creciendo. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© pas√≥ y cu√°ndo sali√≥ todo mal?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo malo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El c√≥digo incorrecto no es uno que no sigue PEP8 o no cumple con los requisitos de complejidad ciclom√°tica. </font><font style="vertical-align: inherit;">El c√≥digo incorrecto es, en primer lugar, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dependencias no controladas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lo que lleva al hecho de que un cambio en un lugar del programa conduce a cambios impredecibles en otras partes. </font><font style="vertical-align: inherit;">Estamos perdiendo el control sobre el c√≥digo; expandir la funcionalidad requiere un estudio detallado del proyecto. </font><font style="vertical-align: inherit;">Dicho c√≥digo pierde su flexibilidad y, por as√≠ decirlo, se resiste a realizar cambios, mientras que el programa en s√≠ mismo se vuelve "fr√°gil".&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arquitectura limpia</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La arquitectura elegida de la aplicaci√≥n deber√≠a evitar este problema, y ‚Äã‚Äãno somos los primeros en encontrarlo: ha habido una discusi√≥n en la comunidad Java sobre la creaci√≥n de un dise√±o de aplicaci√≥n √≥ptimo durante mucho tiempo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En 2000, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Robert Martin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (tambi√©n conocido como t√≠o Bob) en su art√≠culo " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Principios de dise√±o y dise√±o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " reuni√≥ cinco principios para dise√±ar aplicaciones OOP bajo el acr√≥nimo memorable </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SOLID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Estos principios han sido bien recibidos por la comunidad y han ido mucho m√°s all√° del ecosistema de Java. Sin embargo, son de naturaleza muy abstracta. M√°s tarde hubo varios intentos de desarrollar un dise√±o de aplicaci√≥n general basado en principios S√ìLIDOS. Estos incluyen: "Arquitectura hexagonal", "Puertos y adaptadores", "Arquitectura bulbosa" y todos tienen mucho en com√∫n, aunque diferentes detalles de implementaci√≥n. Y en 2012, el mismo Robert Martin public√≥ un art√≠culo, donde propuso su propia versi√≥n llamada " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arquitectura limpia</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/c32/3a9/769/c323a9769c90f4e28a17e1d5c05ab160.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seg√∫n el t√≠o Bob, la arquitectura es principalmente " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fronteras y barreras</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", es necesario comprender claramente las necesidades y limitar las interfaces de software para no perder el control sobre la aplicaci√≥n. Para hacer esto, el programa </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se divide en capas.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Al pasar de una capa a otra, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">solo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se pueden transferir </font><b><font style="vertical-align: inherit;">datos</font></b><font style="vertical-align: inherit;"> (las estructuras simples y los </font><font style="vertical-align: inherit;">objetos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DTO</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pueden actuar como datos </font><font style="vertical-align: inherit;">): esta es la regla de los l√≠mites. </font><font style="vertical-align: inherit;">Otra frase citada con mayor frecuencia de que "la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aplicaci√≥n deber√≠a gritar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " significa que lo principal en la aplicaci√≥n no es el marco utilizado o la tecnolog√≠a de almacenamiento de datos, sino lo que realmente hace esta aplicaci√≥n, qu√© funci√≥n desempe√±a: la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l√≥gica empresarial de la</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aplicaci√≥n . </font><font style="vertical-align: inherit;">Por lo tanto, las capas no tienen una estructura lineal, sino </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">una jerarqu√≠a</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">De ah√≠ dos reglas m√°s:</font></font><br>
 <br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La regla de prioridad para la capa interna</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : es la capa interna la que determina la interfaz a trav√©s de la cual interactuar√° con el mundo exterior;</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regla de dependencia</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : las dependencias deben dirigirse desde la capa interna hacia la externa.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La √∫ltima regla es bastante at√≠pica en el mundo de Python. </font><font style="vertical-align: inherit;">Para aplicar cualquier escenario complicado de l√≥gica de negocios, siempre necesita acceder a servicios externos (por ejemplo, una base de datos), pero para evitar esta dependencia, la capa de l√≥gica de negocios </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe declarar la interfaz</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> por la cual interactuar√° con el mundo exterior. </font><font style="vertical-align: inherit;">Esta t√©cnica se llama " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inversi√≥n de dependencia</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " (la letra D en S√ìLIDO) y se usa ampliamente en lenguajes con escritura est√°tica. </font><font style="vertical-align: inherit;">Seg√∫n Robert Martin, esta es la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">principal ventaja que vino con la OOP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estas tres reglas son la esencia de la arquitectura limpia:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regla de cruce de fronteras;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regla de dependencia;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La regla de prioridad de la capa interna.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las ventajas de este enfoque incluyen:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Facilidad de prueba</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : las capas est√°n aisladas, respectivamente, se pueden probar sin parches de mono, puede configurar granularmente el recubrimiento para diferentes capas, dependiendo del grado de su importancia;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La facilidad de cambiar las reglas de negocio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ya que todas se recopilan en un solo lugar, no se extienden por el proyecto y no se mezclan con c√≥digo de bajo nivel;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Independencia de los agentes externos</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : la presencia de abstracciones entre la l√≥gica empresarial y el mundo exterior en ciertos casos le permite cambiar las fuentes externas sin afectar las capas internas. </font><font style="vertical-align: inherit;">Funciona si no ha vinculado la l√≥gica de negocios a las caracter√≠sticas espec√≠ficas de los agentes externos, por ejemplo, transacciones de bases de datos;</font></font></li>
<li><b> </b>,   ,     ,      .</li>
</ul><br>
<blockquote>     ,    .           .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>.     ¬´<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> Clean Architecture</a>¬ª.<br>
</blockquote><br>
<h2>  Python</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta es una teor√≠a, se pueden encontrar ejemplos de aplicaci√≥n pr√°ctica en el art√≠culo original, los informes y el libro de Robert Martin. Se basan en varios patrones de dise√±o comunes del mundo de Java: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adaptador, Gateway, Interactor, Fasade, Repository, DTO</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bueno, ¬øqu√© pasa con Python? Como dije, el laconismo se valora en la comunidad de Python. Lo que se ha arraigado en otros est√° lejos del hecho de que arraigar√° con nosotros. La primera vez que volv√≠ a este tema hace tres a√±os, entonces no hab√≠a muchos materiales sobre el tema del uso de Arquitectura limpia en Python, pero el primer enlace en Google fue </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el proyecto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Leonardo Giordani: el autor describe en detalle el proceso de creaci√≥n de una API para un sitio de b√∫squeda de propiedades utilizando el m√©todo TDD, aplicando arquitectura limpia.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desafortunadamente, a pesar de la explicaci√≥n escrupulosa y siguiendo todos los c√°nones del t√≠o Bob, este ejemplo es bastante </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aterrador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La API del proyecto consta de un m√©todo: obtener una lista con un filtro disponible. Creo que incluso para un desarrollador novato, el c√≥digo para dicho proyecto no tomar√° m√°s de 15 l√≠neas. Pero en este caso, tom√≥ seis paquetes. Puede referirse a un dise√±o no completamente exitoso, y esto es cierto, pero en cualquier caso, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es dif√≠cil para alguien explicar la efectividad de este enfoque</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , refiri√©ndose a este proyecto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay un problema m√°s grave, si no lee el art√≠culo y comienza a estudiar el proyecto de inmediato, entonces es bastante dif√≠cil de entender. Considere la implementaci√≥n de la l√≥gica de negocios:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> rentomatic.response_objects <span class="hljs-keyword">import</span> response_objects <span class="hljs-keyword">as</span> res<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoomListUseCase</span>(<span class="hljs-params">object</span>):</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, repo</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.repo = repo<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">execute</span>(<span class="hljs-params">self, request_object</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> request_object:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> res.ResponseFailure.build_from_invalid_request_object(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request_object)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">try</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rooms = self.repo.list(filters=request_object.filters)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> res.ResponseSuccess(rooms)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> exc:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> res.ResponseFailure.build_system_error(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">"{}: {}"</span>.format(exc.__class__.__name__, <span class="hljs-string">"{}"</span>.format(exc)))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La clase RoomListUseCase que implementa la l√≥gica empresarial (no muy similar a la l√≥gica empresarial, ¬øverdad?) Del proyecto se inicializa mediante el objeto </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pero, ¬øqu√© es un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repositorio</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? Por supuesto, desde el contexto, podemos entender que el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repositorio</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> implementa la plantilla de Repositorio para acceder a los datos, si miramos el cuerpo de RoomListUseCase, entendemos que debe tener un m√©todo de lista, cuya entrada es una lista de filtros, que no est√° clara en la salida, debe mirar en ResponseSuccess. ¬øY si el escenario es m√°s complejo, con acceso m√∫ltiple a la fuente de datos? Resulta entender qu√© es un repositorio, </font><b><font style="vertical-align: inherit;">solo</font></b><font style="vertical-align: inherit;"> puede </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">referirse a la implementaci√≥n</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ¬øPero d√≥nde est√° ella ubicada? Se encuentra en un m√≥dulo separado, que de ninguna manera est√° asociado con RoomListUseCase. Por lo tanto, para comprender lo que est√° sucediendo, debe subir al nivel superior (el nivel del marco) y ver qu√© se alimenta a la entrada de la clase al crear el objeto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede pensar que enumero las desventajas de la escritura din√°mica, pero esto no es del todo cierto. Es </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">una escritura din√°mica que le permite escribir c√≥digo expresivo y compacto</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Me viene a la mente la analog√≠a con los microservicios, cuando cortamos un monolito en microservicios, el dise√±o adquiere una rigidez adicional, ya que todo se puede hacer dentro del microservicio (PL, marcos, arquitectura), pero debe cumplir con la interfaz declarada. As√≠ que aqu√≠: cuando dividimos nuestro proyecto en capas,</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las relaciones entre las capas deben ser consistentes con el contrato</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mientras que dentro de la capa, el contrato es opcional. De lo contrario, debe mantener un contexto bastante amplio en su cabeza. Recuerde, dije que el problema con el c√≥digo incorrecto son las dependencias y, por lo tanto, sin una interfaz expl√≠cita, nuevamente volvemos a donde quer√≠amos escapar, a la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ausencia de relaciones expl√≠citas de causa y efecto</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<blockquote>    <i>repo</i>     RoomListUseCase,    execute ‚Äî <b>   </b>.       -    ,   ,     .     -        . ,   ,    ,  <i>repo</i>   .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, en ese momento abandon√© Clean Architecture en un nuevo proyecto, nuevamente aplicando el cl√°sico MVC. Pero, despu√©s de llenar el siguiente lote de conos, volvi√≥ a esta idea un a√±o despu√©s, cuando, por fin, comenzamos a lanzar servicios en Python 3.5+. Como saben, trajo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anotaciones de tipo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clases de datos.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Dos potentes herramientas de descripci√≥n de interfaz. Bas√°ndome en ellos, dibuj√© un prototipo del servicio, y el resultado ya fue mucho mejor: las capas dejaron de dispersarse, a pesar del hecho de que todav√≠a hab√≠a mucho c√≥digo, especialmente cuando se integraba con el marco. Pero eso fue suficiente para comenzar a aplicar este enfoque en peque√±os proyectos. Poco a poco, comenzaron a aparecer marcos que se centraron en el uso m√°ximo de anotaciones de tipo: apistar (ahora starlette), marco fundido. El paquete pydantic / FastAPI ahora es com√∫n, y la integraci√≥n con dichos marcos se ha vuelto mucho m√°s f√°cil. As√≠ es como se ver√≠a el ejemplo anterior de restomatic / services.py:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Optional, List
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Room</span>(<span class="hljs-params">BaseModel</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;code: str<font></font>
&nbsp;&nbsp;&nbsp;size: int<font></font>
&nbsp;&nbsp;&nbsp;price: int<font></font>
&nbsp;&nbsp;&nbsp;latitude: float<font></font>
&nbsp;&nbsp;&nbsp;longitude: float<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoomFilter</span>(<span class="hljs-params">BaseModel</span>):</span>
&nbsp;&nbsp;&nbsp;code: Optional[str] = <span class="hljs-literal">None</span>
&nbsp;&nbsp;&nbsp;price_min: Optional[int] = <span class="hljs-literal">None</span>
&nbsp;&nbsp;&nbsp;price_max: Optional[int] = <span class="hljs-literal">None</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoomStorage</span>:</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_rooms</span>(<span class="hljs-params">self, filters: RoomFilter</span>) -&gt; List[Room]:</span> ...<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoomListUseCase</span>:</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, repo: RoomStorage</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.repo = repo<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show_rooms</span>(<span class="hljs-params">self, filters: RoomFilter</span>) -&gt; List[Room]:</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rooms = self.repo.get_rooms(filters=filters)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> rooms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RoomListUseCase: una clase que implementa la l√≥gica empresarial del proyecto. No debe prestar atenci√≥n al hecho de que todo lo que hace el m√©todo show_rooms es llamar a RoomStorage (no se me ocurri√≥ este ejemplo). En la vida real, tambi√©n puede haber un c√°lculo de descuento, clasificar una lista basada en anuncios, etc. Sin embargo, el m√≥dulo es autosuficiente. Si queremos usar este escenario en otro proyecto, tendremos que implementar RoomStorage. Y lo que se necesita para esto es claramente visible desde el m√≥dulo. A diferencia del ejemplo anterior, dicha capa </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es autosuficiente</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , y al cambiarla no es necesario tener en cuenta todo el contexto. A partir de dependencias no sist√©micas solo piramidales, por qu√©, quedar√° claro en el complemento del marco. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin dependencias</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, otra forma de mejorar la legibilidad del c√≥digo, no un contexto adicional, incluso un desarrollador novato podr√° comprender lo que hace este m√≥dulo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un escenario de l√≥gica de negocios no tiene que ser una clase; a continuaci√≥n se muestra un ejemplo de un escenario similar en forma de funci√≥n:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rool_list_use_case</span>(<span class="hljs-params">filters: RoomFilter, repo: RoomStorage</span>) -&gt; List[Room]:</span><font></font>
&nbsp;&nbsp;&nbsp;rooms = repo.get_rooms(filters=filters)<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> rooms</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y aqu√≠ est√° la conexi√≥n con el marco:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> List
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Depends
<span class="hljs-keyword">from</span> rentomatic <span class="hljs-keyword">import</span> services, adapters<font></font>
app = FastAPI()<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_use_case</span>() -&gt; services.RoomListUseCase:</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> services.RoomListUseCase(adapters.MemoryStorage())<font></font>
<font></font>
<span class="hljs-meta">@app.post("/rooms", response_model=List[services.Room])</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rooms</span>(<span class="hljs-params">filters: services.RoomFilter, use_case=Depends(<span class="hljs-params">get_use_case</span>)</span>):</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> use_case.show_rooms(filters)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usando la funci√≥n get_use_case, FastAPI implementa el patr√≥n de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inyecci√≥n de dependencia</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . No tenemos que preocuparnos por la serializaci√≥n de datos, FastAPI realiza todo el trabajo junto con pydantic. Por desgracia, los datos no son siempre formato de l√≥gica de negocio adecuado para la emisi√≥n en directo en el restaurante &lt;y, por el contrario, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la l√≥gica de negocio no sabe d√≥nde ven√≠an los datos - con barras, solicitud cuerpo, galletas, etc</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . En este caso, el cuerpo de la funci√≥n de sala tendr√° una cierta conversi√≥n de datos de entrada y salida, pero en la mayor√≠a de los casos, si trabajamos con la API, una funci√≥n proxy tan f√°cil es suficiente.&nbsp;</font></font><br>
<br>
<blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>   , ,    ,    RoomStorage.  ,     15 ,     ,      ,         .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No separ√© intencionalmente la capa de l√≥gica empresarial, como sugiere el modelo can√≥nico de Arquitectura Limpia. </font><font style="vertical-align: inherit;">Se supon√≠a que la clase Room estaba en la capa de regi√≥n de dominio Entity que representa la regi√≥n de dominio, pero para este ejemplo no hay necesidad de esto. </font><font style="vertical-align: inherit;">Al combinar las capas Entity y UseCase, el proyecto no deja de ser una implementaci√≥n de Arquitectura limpia. </font><font style="vertical-align: inherit;">El propio Robert Martin ha dicho repetidamente que el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√∫mero de capas puede variar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tanto hacia arriba como hacia abajo. </font><font style="vertical-align: inherit;">Al mismo tiempo, el proyecto cumple con los criterios principales de Arquitectura limpia:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regla de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cruce de fronteras: los modelos pirad√≠nicos, que son esencialmente DTO, </font><b><font style="vertical-align: inherit;">cruzan fronteras</font></b><font style="vertical-align: inherit;"> ;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regla de dependencia</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : la capa de l√≥gica de negocios es independiente de otras capas;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La regla de prioridad para la capa interna</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : es la capa de l√≥gica de negocios que define la interfaz (RoomStorage), a trav√©s de la cual la l√≥gica de negocios interact√∫a con el mundo exterior.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoy, varios proyectos de nuestro equipo, implementados usando el enfoque descrito, est√°n trabajando en la producci√≥n. </font><font style="vertical-align: inherit;">Intento organizar incluso los servicios m√°s peque√±os de esta manera. </font><font style="vertical-align: inherit;">Se entrena bien, surgen preguntas en las que no hab√≠a pensado antes. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por ejemplo, ¬øqu√© es la l√≥gica de negocios aqu√≠? </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esto est√° lejos de ser siempre obvio, por ejemplo, si est√° escribiendo alg√∫n tipo de proxy. </font><font style="vertical-align: inherit;">Otro punto importante es </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aprender a pensar de manera diferente.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cuando recibimos una tarea, generalmente comenzamos a pensar en los marcos, los servicios utilizados, sobre si ser√° necesaria una l√≠nea aqu√≠, donde es mejor almacenar estos datos, que se pueden almacenar en cach√©. En el enfoque que dicta la arquitectura limpia, primero debemos implementar la l√≥gica de negocios y solo luego pasar a implementar la interacci√≥n con la infraestructura, ya que, seg√∫n Robert Martin, la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tarea principal de la arquitectura</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es retrasar el momento en que la conexi√≥n con cualquier La capa de infraestructura ser√° una parte integral de su aplicaci√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, veo una perspectiva favorable para usar Clean Architecture en Python. </font><font style="vertical-align: inherit;">Pero la forma, muy probablemente, ser√° significativamente diferente de c√≥mo se acepta en otros PL. </font><font style="vertical-align: inherit;">En los √∫ltimos a√±os, he visto un aumento significativo en el inter√©s en el tema de la arquitectura en la comunidad. </font><font style="vertical-align: inherit;">Por lo tanto, en la √∫ltima PyCon hubo varios informes sobre el uso de DDD, y los chicos de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">los laboratorios secos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> deben notarse por separado </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En nuestra empresa, muchos equipos ya est√°n implementando el enfoque descrito en un grado u otro. </font><font style="vertical-align: inherit;">Todos estamos haciendo lo mismo, hemos crecido, nuestros proyectos han crecido, la comunidad de Python tiene que trabajar con esto, definir el estilo y el lenguaje comunes que, por ejemplo, una vez se convirtieron para todos los Django.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es494350/index.html">Resumen de eventos en l√≠nea de marzo y abril</a></li>
<li><a href="../es494354/index.html">Conocimiento y condici√≥n</a></li>
<li><a href="../es494356/index.html">Linux Newbie Aircrack-ng Tutorial</a></li>
<li><a href="../es494364/index.html">GDPR: consentimiento para el procesamiento de datos personales</a></li>
<li><a href="../es494366/index.html">Mitaps en l√≠nea para toda la semana, a partir del 27 de marzo (en la parte posterior, m√≥vil, QA, PM y todo)</a></li>
<li><a href="../es494372/index.html">Software de verificaci√≥n totalmente ruso: una vista interior</a></li>
<li><a href="../es494374/index.html">Autobuses el√©ctricos y sus bater√≠as: ¬øqu√© es el titanato de litio? (Parte 1)</a></li>
<li><a href="../es494376/index.html">Buffer de profundidad jer√°rquica</a></li>
<li><a href="../es494380/index.html">Introducci√≥n a la gesti√≥n estrat√©gica de productos</a></li>
<li><a href="../es494384/index.html">Encuesta funcional</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>