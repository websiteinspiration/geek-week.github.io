<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍🤝‍👨🏼 🤽🏿 🧛🏽 Encadenamiento de CI / CD y automatización de Docker 👨🏿‍🎓 🤚🏿 👩🏼‍🚀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Escribí mis primeros sitios a finales de los 90. Luego ponerlos en condiciones de trabajo fue muy simple. Había un servidor Apache en algún alojamient...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Encadenamiento de CI / CD y automatización de Docker</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/488668/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escribí mis primeros sitios a finales de los 90. Luego ponerlos en condiciones de trabajo fue muy simple. Había un servidor Apache en algún alojamiento compartido, podría iniciar sesión en este servidor a través de FTP, escribiendo algo así en la línea del navegador </font></font><code>ftp://ftp.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Luego fue necesario ingresar un nombre y contraseña y subir archivos al servidor. Hubo otros momentos, todo era más fácil que ahora. </font><font style="vertical-align: inherit;">
En las últimas dos décadas, todo ha cambiado mucho. Los sitios se han vuelto más complejos, deben ensamblarse antes de ser lanzados a producción. Un único servidor se ha convertido en una pluralidad de servidores que trabajan detrás de equilibradores de carga; el uso de sistemas de control de versiones se ha convertido en algo común.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/cg/bv/ch/cgbvchdac53hqrfbqadsqimp0oa.jpeg"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para mi proyecto personal, tenía una configuración especial. Y sabía que necesitaba la capacidad de implementar un sitio en producción, realizando solo una acción: escribir código en una sucursal </font></font><code>master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en GitHub. Además, sabía que para garantizar el funcionamiento de mi pequeña aplicación web, no quería administrar un gran clúster de Kubernetes, ni utilizar la tecnología Docker Swarm, ni mantener un parque de servidores con pods, agentes y todo tipo de dificultades. Para lograr el objetivo de simplificar el trabajo tanto como sea posible, necesitaba familiarizarme con CI / CD.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si tiene un proyecto pequeño (en nuestro caso estamos hablando de un proyecto Node.js) y le gustaría aprender cómo automatizar la implementación de este proyecto, mientras se asegura de que lo que está almacenado en el repositorio coincida exactamente lo que funciona en producción, creo que te puede interesar este artículo.</font></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prerrequisitos</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se espera que el lector de este artículo tenga conocimientos básicos del área de la línea de comandos y escriba scripts de Bash. </font><font style="vertical-align: inherit;">Además, necesitará las cuentas de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travis CI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker Hub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metas</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No diré que este artículo puede llamarse incondicionalmente un "manual de capacitación". </font><font style="vertical-align: inherit;">Es más bien un documento en el que hablo sobre lo que aprendí y describo el proceso de prueba y despliegue de código en producción que me conviene, realizado en un solo paso automatizado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Así es como terminó mi flujo de trabajo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Excepto el código enviado a cualquier rama del repositorio, </font></font><code>master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se realizan </font><font style="vertical-align: inherit;">las </font><font style="vertical-align: inherit;">siguientes acciones:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Construye el proyecto en Travis CI.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se realizan todas las pruebas unitarias, de integración y de extremo a extremo.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solo para el código que entra en </font></font><code>master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">las siguientes retenciones:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todo lo dicho anteriormente, más ...</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cree la imagen de Docker en función del código, la configuración y el entorno actuales.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Colocar una imagen en el Docker Hub.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conexión al servidor de producción.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cargar la imagen del Docker Hub al servidor.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detenga el contenedor actual e inicie uno nuevo basado en la nueva imagen.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si no sabe absolutamente nada sobre Docker, sobre imágenes y contenedores, no se preocupe. </font><font style="vertical-align: inherit;">Te contaré todo sobre esto.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿Qué es un CI / CD?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La abreviatura CI / CD significa "integración continua / despliegue continuo" - "integración continua / despliegue continuo".</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Integración continua</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La integración continua es un proceso durante el cual los desarrolladores se comprometen con el repositorio principal del código fuente del proyecto (generalmente a una rama </font></font><code>master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Al mismo tiempo, la calidad del código se garantiza mediante la realización de pruebas automatizadas.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Despliegue continuo</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El despliegue continuo es el despliegue automatizado frecuente de código en producción. </font><font style="vertical-align: inherit;">La segunda parte de la abreviatura CI / CD a veces se describe como "entrega continua" ("entrega continua"). </font><font style="vertical-align: inherit;">Esto, en general, es lo mismo que "implementación continua", pero "entrega continua" implica la necesidad de una confirmación manual de los cambios antes de comenzar el proceso de implementación del proyecto.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comienzo de trabajo</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La aplicación en la que lo dominé todo se llama </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TakeNote</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Este es el proyecto web en el que estoy trabajando, diseñado para tomar notas. Al principio traté de hacer un </font><font style="vertical-align: inherit;">proyecto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JAMStack</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o simplemente una aplicación frontend sin servidor, para aprovechar las </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">capacidades</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> estándar de alojamiento e implementación </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">que</font></a><font style="vertical-align: inherit;"> ofrece </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">Netlify</font></a><font style="vertical-align: inherit;"> . A medida que crecía la complejidad de la aplicación, necesitaba crear su parte de servidor, lo que significaba que tendría que formar mi propia estrategia para la integración automatizada y la implementación automatizada del proyecto.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En mi caso, la aplicación es un servidor Express que se ejecuta en el entorno Node.js, que sirve una aplicación React de una sola página y admite una API de servidor segura. </font><font style="vertical-align: inherit;">Esta arquitectura sigue la estrategia que se encuentra en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esta</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> guía de autenticación de pila completa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consulté con un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">amigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que es un experto en automatización y le pregunté qué necesitaba hacer para que funcionara como lo necesitaba. </font><font style="vertical-align: inherit;">Me dio una idea de cómo debería ser un flujo de trabajo automatizado, descrito en la sección Objetivos de este artículo. </font><font style="vertical-align: inherit;">El hecho de que me estableciera tales objetivos significaba que necesitaba descubrir cómo usar Docker.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estibador</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Docker es una herramienta que, gracias a la tecnología de contenedorización, facilita la distribución de aplicaciones, así como la implementación y el lanzamiento en el mismo entorno, incluso si la plataforma Docker funciona en entornos diferentes. Para empezar, necesitaba tener las herramientas de línea de comandos de Docker (CLI) a mi disposición. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las instrucciones</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para instalar Docker no se pueden llamar muy claras y comprensibles, pero puede aprender de él que para dar el primer paso de instalación, debe descargar Docker Desktop (para Mac o Windows). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Docker Hub es casi lo mismo que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para repositorios git, o el registro </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">npm</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para paquetes de JavaScript. </font><font style="vertical-align: inherit;">Este es un repositorio en línea para imágenes Docker. </font><font style="vertical-align: inherit;">Se conecta a él Docker Desktop. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, para comenzar con Docker, debe hacer dos cosas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instalar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker Desktop</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regístrese en el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker Hub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Después de eso, puede verificar que la CLI de Docker esté funcionando ejecutando el siguiente comando para verificar la versión de Docker:</font></font><br>
<br>
<pre><code class="plaintext hljs">docker -v</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego, inicie sesión en Docker Hub ingresando, cuando se le solicite, su nombre de usuario y contraseña:</font></font><br>
<br>
<pre><code class="plaintext hljs">docker login</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para utilizar Docker, debe comprender los conceptos de imágenes y contenedores.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Imágenes</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una imagen es algo así como un plan que contiene instrucciones para construir un contenedor. </font><font style="vertical-align: inherit;">Esta es una instantánea inmutable del sistema de archivos y la configuración de la aplicación. </font><font style="vertical-align: inherit;">Los desarrolladores pueden compartir fácilmente imágenes.</font></font><br>
<br>
<pre><code class="plaintext hljs">#     <font></font>
docker images</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este comando mostrará una tabla con el siguiente encabezado:</font></font><br>
<br>
<pre><code class="plaintext hljs">REPOSITORY &nbsp; &nbsp; TAG     IMAGE ID &nbsp; &nbsp; CREATED     SIZE<font></font>
---</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuación, consideraremos algunos ejemplos de comandos en el mismo formato: primero viene un comando con un comentario y luego un ejemplo de lo que puede generar.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Contenedores</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un contenedor es un paquete ejecutable que contiene todo lo que necesita para ejecutar una aplicación. </font><font style="vertical-align: inherit;">Una aplicación con este enfoque siempre funcionará igual, independientemente de la infraestructura: en un entorno aislado y en el mismo entorno. </font><font style="vertical-align: inherit;">El punto es que en diferentes entornos, se lanzan instancias de la misma imagen.</font></font><br>
<br>
<pre><code class="plaintext hljs">#   <font></font>
docker ps -a<font></font>
CONTAINER ID &nbsp; &nbsp; IMAGE     COMMAND &nbsp; &nbsp; CREATED     STATUS     PORTS &nbsp; &nbsp; NAMES<font></font>
---</code></pre><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Etiquetas</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una etiqueta es una indicación de una versión específica de una imagen.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Resumen del comando Docker</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquí hay una descripción general de algunos comandos Docker de uso común.</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Equipo</font></font><br>
</th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto</font></font><br>
</th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Actuar</font></font><br>
</th>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker Build</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formar</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ensamblar una imagen desde Dockerfile</font></font><br>
</td>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etiqueta acoplable</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formar</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etiquetado de imagen</font></font><br>
</td>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imágenes de la ventana acoplable</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formar</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listado de imágenes</font></font><br>
</td>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker Run</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envase</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lanzamiento de contenedor basado en imágenes</font></font><br>
</td>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">empuje de estibador</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formar</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enviar una imagen al registro</font></font><br>
</td>
</tr>
<tr>
<td><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estibador</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formar</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descargar imagen del registro</font></font><br>
</td>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docker ps</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envase</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lista de contenedores</font></font><br>
</td>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">poda del sistema acoplable</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imagen / Contenedor</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eliminar contenedores e imágenes no utilizados</font></font><br>
</td>
</tr>
</tbody></table></div><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Dockerfile</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sé cómo ejecutar una aplicación de producción localmente. </font><font style="vertical-align: inherit;">Tengo una configuración de Webpack diseñada para crear una aplicación React lista para usar. </font><font style="vertical-align: inherit;">A continuación, tengo un comando que inicia un servidor basado en Node.js en el puerto </font></font><code>5000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Se parece a esto:</font></font><br>
<br>
<pre><code class="plaintext hljs">npm i &nbsp; &nbsp; &nbsp; &nbsp; #  <font></font>
npm run build #  React-<font></font>
npm run start #  Node-</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cabe señalar que no tengo una aplicación de ejemplo para este material. </font><font style="vertical-align: inherit;">Pero aquí, para los experimentos, cualquier aplicación Node simple es adecuada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para usar el contenedor, debe dar instrucciones a Docker. </font><font style="vertical-align: inherit;">Esto se realiza a través de un archivo llamado </font></font><code>Dockerfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ubicado en el directorio raíz del proyecto. </font><font style="vertical-align: inherit;">Este archivo, al principio, parece bastante oscuro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero lo que contiene solo describe, con comandos especiales, algo similar a configurar un entorno de trabajo. </font><font style="vertical-align: inherit;">Estos son algunos de estos comandos:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DESDE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : este comando inicia el archivo. </font><font style="vertical-align: inherit;">Indica la imagen básica en base a la cual se construye el contenedor.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COPIAR</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : copia archivos de una fuente local a un contenedor.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WORKDIR</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : configuración del directorio de trabajo para los siguientes comandos.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EJECUTAR</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : ejecuta comandos.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPOSE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Configuración del puerto.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PUNTO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DE </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">ENTRADA</font></a><font style="vertical-align: inherit;"> : especifica el comando a ejecutar.</font></font></li>
</ul><br>
<code>Dockerfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> podría verse más o menos así:</font></font><br>
<br>
<pre><code class="plaintext hljs">#   <font></font>
FROM node:12-alpine<font></font>
<font></font>
#        app/<font></font>
COPY . app/<font></font>
<font></font>
#  app/    <font></font>
WORKDIR app/<font></font>
<font></font>
#   ( npm ci  npm i,     )<font></font>
RUN npm ci --only-production<font></font>
<font></font>
#   React-  <font></font>
RUN npm run build<font></font>
<font></font>
#   <font></font>
EXPOSE 5000<font></font>
<font></font>
#  Node-<font></font>
ENTRYPOINT npm run start</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dependiendo de la imagen base seleccionada, es posible que deba instalar dependencias adicionales. </font><font style="vertical-align: inherit;">El hecho es que algunas imágenes básicas (como Node Alpine Linux) están diseñadas para hacerlas lo más compactas posible. </font><font style="vertical-align: inherit;">Como resultado, es posible que no tengan algunos de los programas con los que cuenta.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Construir, etiquetar y lanzar contenedor</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El montaje local y el lanzamiento del contenedor es, después de que tenemos </font></font><code>Dockerfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, las tareas son bastante simples. </font><font style="vertical-align: inherit;">Antes de enviar una imagen al Docker Hub, debe probarla localmente.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Asamblea</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero debe recopilar la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> especificando un nombre y, opcionalmente, una etiqueta (si no se especifica la etiqueta, el sistema asignará automáticamente una etiqueta a la imagen </font></font><code>latest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br>
<br>
<pre><code class="plaintext hljs">#  <font></font>
docker build -t &lt;image&gt;:&lt;tag&gt; .</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Después de ejecutar este comando, puede observar cómo Docker construye la imagen.</font></font><br>
<br>
<pre><code class="plaintext hljs">Sending build context to Docker daemon &nbsp; 2.88MB<font></font>
Step 1/9 : FROM node:12-alpine<font></font>
&nbsp;---&gt; ...  ...<font></font>
Successfully built 123456789123<font></font>
Successfully tagged &lt;image&gt;:&lt;tag&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El ensamblaje puede demorar un par de minutos; todo depende de cuántas dependencias tenga. </font><font style="vertical-align: inherit;">Después de completar el ensamblaje, puede ejecutar el comando </font></font><code>docker images</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y echar un vistazo a la descripción de su nueva imagen.</font></font><br>
<br>
<pre><code class="plaintext hljs">REPOSITORY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TAG               IMAGE ID&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CREATED              SIZE<font></font>
&lt;image&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; latest            123456789123&nbsp; &nbsp; &nbsp; &nbsp; About a minute ago   x.xxGB</code></pre><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Inicio</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La imagen es creada. </font><font style="vertical-align: inherit;">Y esto significa que, sobre esta base, es posible lanzar un contenedor. </font><font style="vertical-align: inherit;">Como quiero poder acceder a la aplicación que se ejecuta en el contenedor en la dirección </font></font><code>localhost:5000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que </font></font><code>5000:5000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instalé </font><font style="vertical-align: inherit;">en el lado izquierdo del par </font><font style="vertical-align: inherit;">en el siguiente comando </font></font><code>5000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En el lado derecho está el puerto de contenedores.</font></font><br>
<br>
<pre><code class="plaintext hljs">#      5000    5000<font></font>
docker run -p 5000:5000 &lt;image&gt;:&lt;tag&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora que el contenedor se creó e inició, puede usar el comando </font></font><code>docker ps</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para ver la información sobre este contenedor (o puede usar el comando </font></font><code>docker ps -a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que muestra información sobre todos los contenedores, no solo los que funcionan).</font></font><br>
<br>
<pre><code class="plaintext hljs">CONTAINER ID&nbsp; &nbsp; &nbsp; &nbsp; IMAGE               COMMAND&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CREATED              STATUS                  &nbsp; &nbsp; PORTS                    NAMES<font></font>
987654321234&nbsp; &nbsp; &nbsp; &nbsp; &lt;image&gt;             "/bin/sh -c 'npm run…" &nbsp; 6 seconds ago        Up 6 seconds            &nbsp; &nbsp; 0.0.0.0:5000-&gt;5000/tcp   stoic_darwin</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si va a la dirección ahora </font></font><code>localhost:5000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, puede ver la página de la aplicación de trabajo, que se ve exactamente igual a la página de la aplicación que trabaja en el entorno de producción.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Asignación y publicación de etiquetas</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para usar una de las imágenes creadas en el servidor de producción, necesitamos poder descargar esta imagen desde Docker Hub. </font><font style="vertical-align: inherit;">Esto significa que primero debe crear un repositorio para el proyecto en Docker Hub. </font><font style="vertical-align: inherit;">Después de eso, tendremos a nuestra disposición un lugar donde puede arreglar la imagen. </font><font style="vertical-align: inherit;">Se debe cambiar el nombre de la imagen para que comience con nuestro nombre de usuario en Docker Hub. </font><font style="vertical-align: inherit;">Después de esto debería ser el nombre del repositorio. </font><font style="vertical-align: inherit;">Al final del nombre puede ser cualquier etiqueta. </font><font style="vertical-align: inherit;">El siguiente es un ejemplo de nombrar imágenes usando este esquema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora puede recopilar la imagen con un nuevo nombre y ejecutar el comando </font></font><code>docker push</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para enviarla al repositorio de Docker Hub.</font></font><br>
<br>
<pre><code class="plaintext hljs">docker build -t &lt;username&gt;/&lt;repository&gt;:&lt;tag&gt; .<font></font>
docker tag &lt;username&gt;/&lt;repository&gt;:&lt;tag&gt; &lt;username&gt;/&lt;repository&gt;:latest<font></font>
docker push &lt;username&gt;/&lt;repository&gt;:&lt;tag&gt;<font></font>
<font></font>
#     , , :<font></font>
docker build -t user/app:v1.0.0 .<font></font>
docker tag user/app:v1.0.0 user/app:latest<font></font>
docker push user/app:v1.0.0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si todo va bien, la imagen estará disponible en Docker Hub y se puede descargar fácilmente al servidor o transferirse a otros desarrolladores.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Próximos pasos</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasta la fecha, nos hemos asegurado de que la aplicación, en forma de contenedor Docker, funcione localmente. </font><font style="vertical-align: inherit;">Subimos el contenedor al Docker Hub. </font><font style="vertical-align: inherit;">Todo esto significa que ya hemos progresado muy bien hacia la meta. </font><font style="vertical-align: inherit;">Ahora necesitamos resolver dos preguntas más:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuración de una herramienta de CI para probar e implementar código.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurar el servidor de producción para que pueda cargar y ejecutar nuestro código.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En nuestro caso, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travis CI se</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utiliza como una solución CI / CD </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Como servidor: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DitigalOcean</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cabe señalar que aquí puede usar otra combinación de servicios. </font><font style="vertical-align: inherit;">Por ejemplo, en lugar de Travis CI, puede usar CircleCI o Github Actions. </font><font style="vertical-align: inherit;">Y en lugar de DigitalOcean: AWS o Linode. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decidimos trabajar con Travis CI, y en este servicio ya tengo algo configurado. </font><font style="vertical-align: inherit;">Por lo tanto, ahora hablaré brevemente sobre cómo prepararlo para el trabajo.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travis ci</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Travis CI es una herramienta para probar e implementar código. No me gustaría entrar en las complejidades de configurar Travis CI, ya que cada proyecto es único, y esto no traerá muchos beneficios. Pero le contaré sobre los conceptos básicos que le permitirán comenzar si decide usar Travis CI. Elijas lo que elijas: Travis CI, CircleCI, Jenkins u otra cosa, se usarán métodos de configuración similares en todas partes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para comenzar a trabajar con Travis CI, vaya al </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sitio web del proyecto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y crea una cuenta. </font><font style="vertical-align: inherit;">Luego integre Travis CI con su cuenta de GitHub. </font><font style="vertical-align: inherit;">Durante la configuración del sistema, deberá especificar el repositorio con el que desea automatizar y habilitar el acceso al mismo. </font><font style="vertical-align: inherit;">(Uso GitHub, pero estoy seguro de que Travis CI puede integrarse con BitBucket, GitLab y otros servicios similares). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada vez que se toma Travis CI para trabajar, se inicia un servidor que ejecuta los comandos especificados en el archivo de configuración, incluida la implementación de las ramas del repositorio correspondientes.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Ciclo de vida de la tarea</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El archivo de configuración de Travis CI, llamado </font></font><code>.travis.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y almacenado en el directorio raíz del proyecto, admite el concepto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eventos del </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">ciclo de vida del</font></a><font style="vertical-align: inherit;"> trabajo. </font><font style="vertical-align: inherit;">Estos eventos se enumeran en el orden en que ocurren:</font></font><br>
<br>
<ul>
<li><code>apt addons</code></li>
<li><code>cache components</code></li>
<li><code>before_install</code></li>
<li><code>install</code></li>
<li><code>before_script</code></li>
<li><code>script</code></li>
<li><code>before_cache</code></li>
<li><code>after_success  after_failure</code></li>
<li><code>before_deploy</code></li>
<li><code>deploy</code></li>
<li><code>after_deploy</code></li>
<li><code>after_script</code></li>
</ul><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Pruebas</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el archivo de configuración, voy a configurar el servidor local Travis CI. Como lenguaje, elegí el Nodo 12 y le dije al sistema que instalara las dependencias necesarias para usar Docker. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo lo que aparece en la lista </font></font><code>.travis.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se ejecutará cuando se ejecuten todas las solicitudes de extracción a todas las ramas del repositorio, a menos que se especifique lo contrario. Esta es una característica útil, ya que significa que podemos probar todo el código que ingresa al repositorio. Esto le permite saber si el código está listo para ser escrito en la sucursal </font></font><code>master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y si interrumpirá el proceso de construcción del proyecto. En esta configuración global, instalo todo localmente, inicio el servidor de desarrollo Webpack en segundo plano (esta es una característica de mi flujo de trabajo) y ejecuto las pruebas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si desea mostrar iconos con información sobre la cobertura del código en su repositorio, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aquí</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> puede encontrar instrucciones breves sobre el uso de Jest, Travis CI y Overol para recopilar y mostrar esta información. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Así que aquí está el contenido del archivo </font></font><code>.travis.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">#  <font></font>
language: node_js<font></font>
<font></font>
#   Node.js<font></font>
node_js:<font></font>
&nbsp;&nbsp;- '12'<font></font>
<font></font>
services:<font></font>
&nbsp;&nbsp;#    Docker<font></font>
&nbsp;&nbsp;- docker<font></font>
<font></font>
install:<font></font>
&nbsp;&nbsp;#    <font></font>
&nbsp;&nbsp;- npm ci<font></font>
<font></font>
before_script:<font></font>
&nbsp;&nbsp;#      <font></font>
&nbsp;&nbsp;- npm run dev &amp;<font></font>
<font></font>
script:<font></font>
&nbsp;&nbsp;#  <font></font>
&nbsp;&nbsp;- npm run test</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquí finalizan las acciones que se realizan para todas las ramas del repositorio y para las solicitudes de extracción.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Despliegue</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Basado en el supuesto de que todas las pruebas automatizadas se completaron con éxito, opcionalmente, podemos implementar el código en el servidor de producción. </font><font style="vertical-align: inherit;">Dado que queremos hacer esto solo para el código de una rama </font></font><code>master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, le damos al sistema las instrucciones adecuadas en la configuración de implementación. </font><font style="vertical-align: inherit;">Antes de intentar usar el código en su proyecto, que consideraremos más adelante, me gustaría advertirle que debe tener un script real que se llame para su implementación.</font></font><br>
<br>
<pre><code class="plaintext hljs">deploy:<font></font>
&nbsp;&nbsp;#  Docker-     Docker Hub<font></font>
&nbsp;&nbsp;provider: script<font></font>
&nbsp;&nbsp;script: bash deploy.sh<font></font>
&nbsp;&nbsp;on:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;branch: master</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El script de implementación resuelve dos problemas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cree, etiquete y envíe la imagen al Docker Hub utilizando la herramienta CI (en nuestro caso, es Travis CI).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cargando la imagen en el servidor, deteniendo el contenedor antiguo e iniciando el nuevo (en nuestro caso, el servidor se ejecuta en la plataforma DigitalOcean).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero debe configurar el proceso automático de ensamblaje, etiquetado y envío de la imagen al Docker Hub. Todo esto es muy similar a lo que ya hicimos manualmente, excepto que aquí necesitamos una estrategia para asignar etiquetas únicas a las imágenes y automatizar el inicio de sesión. Tuve dificultades con algunos detalles del script de implementación, como una estrategia de etiquetado, iniciar sesión, codificar claves SSH, establecer una conexión SSH. Pero, afortunadamente, mi novio maneja bash muy bien, así como muchas otras cosas. Me ayudó a escribir este guión.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, la primera parte del script es enviar la imagen al Docker Hub. Esto es bastante simple El esquema de etiquetado que utilicé implica combinar un git hash y una etiqueta git, si existe. Esto permite la creación de una etiqueta única y simplifica la identificación del ensamblaje en el que se basa. </font></font><code>DOCKER_USERNAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>DOCKER_PASSWORD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">son variables de entorno del usuario que se pueden configurar mediante la interfaz Travis CI. Travis CI procesa automáticamente los datos confidenciales para que no caigan en las manos equivocadas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquí está la primera parte del guión </font></font><code>deploy.sh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="plaintext hljs">#!/bin/sh<font></font>
set -e #     <font></font>
<font></font>
IMAGE="&lt;username&gt;/&lt;repository&gt;" &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #  Docker<font></font>
GIT_VERSION=$(git describe --always --abbrev --tags --long) # Git-  <font></font>
<font></font>
#    <font></font>
docker build -t ${IMAGE}:${GIT_VERSION} .<font></font>
docker tag ${IMAGE}:${GIT_VERSION} ${IMAGE}:latest<font></font>
<font></font>
#   Docker Hub   <font></font>
echo "${DOCKER_PASSWORD}" | docker login -u "${DOCKER_USERNAME}" --password-stdin<font></font>
docker push ${IMAGE}:${GIT_VERSION}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo que será la segunda parte del script depende completamente de qué host está utilizando y cómo está organizada la conexión. En mi caso, dado que uso Digital Ocean, los comandos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doctl</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se usan para conectarse al servidor </font><font style="vertical-align: inherit;">. Cuando trabaje con Aws, se utilizará una utilidad </font></font><code>aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Configurar el servidor no fue particularmente difícil. Entonces, configuré una gota basada en la imagen base. Cabe señalar que el sistema que seleccioné requiere una instalación manual única de Docker y un inicio manual único de Docker. Usé Ubuntu 18.04 para instalar Docker, así que si usas Ubuntu para hacer lo mismo, puedes seguir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esta</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sencilla guía.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No estoy hablando aquí de comandos específicos para el servicio, ya que este aspecto puede variar mucho en diferentes casos. </font><font style="vertical-align: inherit;">Solo daré un plan de acción general que se lleva a cabo después de conectarse a través de SSH al servidor en el que se implementará el proyecto:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Necesita encontrar el contenedor que se está ejecutando actualmente y detenerlo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Luego, en segundo plano, debe iniciar un nuevo contenedor.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deberá establecer el puerto del servidor local en un valor </font></font><code>80</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; esto le permitirá ingresar al sitio en la dirección del formulario </font></font><code>example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, sin especificar el puerto, y no usar la dirección como </font></font><code>example.com:5000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y, por último, debe eliminar todos los contenedores e imágenes antiguos.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquí está la continuación del guión.</font></font><br>
<br>
<pre><code class="plaintext hljs">#  ID  <font></font>
CONTAINER_ID=$(docker ps | grep takenote | cut -d" " -f1)<font></font>
<font></font>
#   ,  ,  <font></font>
docker stop ${CONTAINER_ID}<font></font>
docker run --restart unless-stopped -d -p 80:5000 ${IMAGE}:${GIT_VERSION}<font></font>
docker system prune -a -f</code></pre><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algunas cosas a considerar</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quizás cuando se conecte al servidor a través de SSH desde Travis CI, verá una advertencia que no permitirá que la instalación continúe, ya que el sistema esperará a que el usuario responda.</font></font><br>
<br>
<pre><code class="plaintext hljs">The authenticity of host '&lt;hostname&gt; (&lt;IP address&gt;)' can't be established.<font></font>
RSA key fingerprint is &lt;key fingerprint&gt;.<font></font>
Are you sure you want to continue connecting (yes/no)?</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aprendí que la clave de cadena se puede codificar en base64 para guardarla en una forma en que sea conveniente y confiable trabajar con ella. </font><font style="vertical-align: inherit;">En la etapa de instalación, puede decodificar la clave pública y escribirla en un archivo </font></font><code>known_hosts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para deshacerse del error anterior.</font></font><br>
<br>
<pre><code class="plaintext hljs">echo &lt;public key&gt; | base64 #  &lt; ,   base64&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la práctica, este comando puede verse así:</font></font><br>
<br>
<pre><code class="plaintext hljs">echo "123.45.67.89 ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAklOUpkDHrfHY17SbrmTIpNLTGK9Tjom/BWDSU<font></font>
GPl+nafzlHDTYW7hdI4yZ5ew18JH4JW9jbhUFrviQzM7xlELEVf4h9lFX5QVkbPppSwg0cda3<font></font>
Pbv7kOdJ/MTyBlWXFCR+HAo3FXRitBqxiX1nKhXpHAZsMciLq8V6RjsNAQwdsdMFvSlVK/7XA<font></font>
t3FaoJoAsncM1Q9x5+3V0Ww68/eIFmb1zuUFljQJKprrX88XypNDvjYNby6vw/Pb0rwert/En<font></font>
mZ+AW4OZPnTPI89ZPmVMLuayrD2cE86Z/il8b+gw3r3+1nKatmIkjn2so1d01QraTlMqVSsbx<font></font>
NrRFi9wrf+M7Q== you@example.com" | base64</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y esto es lo que da: una cadena codificada en base64:</font></font><br>
<br>
<pre><code class="plaintext hljs">MTIzLjQ1LjY3Ljg5IHNzaC1yc2EgQUFBQUIzTnphQzF5YzJFQUFBQUJJd0FBQVFFQWtsT1Vwa0RIcmZIWTE3U2JybVRJcE5MVEdLOVRqb20vQldEU1UKR1BsK25hZnpsSERUWVc3aGRJNHlaNWV3MThKSDRKVzlqYmhVRnJ2aVF6TTd4bEVMRVZmNGg5bEZYNVFWa2JQcHBTd2cwY2RhMwpQYnY3a09kSi9NVHlCbFdYRkNSK0hBbzNGWFJpdEJxeGlYMW5LaFhwSEFac01jaUxxOFY2UmpzTkFRd2RzZE1GdlNsVksvN1hBCnQzRmFvSm9Bc25jTTFROXg1KzNWMFd3NjgvZUlGbWIxenVVRmxqUUpLcHJyWDg4WHlwTkR2allOYnk2dncvUGIwcndlcnQvRW4KbVorQVc0T1pQblRQSTg5WlBtVk1MdWF5ckQyY0U4NlovaWw4YitndzNyMysxbkthdG1Ja2puMnNvMWQwMVFyYVRsTXFWU3NieApOclJGaTl3cmYrTTdRPT0geW91QGV4YW1wbGUuY29tCg==</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquí está el equipo mencionado anteriormente</font></font><br>
<br>
<pre><code class="plaintext hljs">install:<font></font>
&nbsp;&nbsp;- echo &lt;  ,   base64&gt; | base64 -d &gt;&gt; $HOME/.ssh/known_hosts</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se puede usar el mismo enfoque con una clave privada cuando se establece una conexión, ya que es posible que necesite una clave privada para acceder al servidor. </font><font style="vertical-align: inherit;">Cuando trabaje con una clave, solo necesita garantizar su almacenamiento seguro en la variable de entorno de Travis CI, para que no se muestre en ningún lado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otra cosa a la que debe prestar atención es que puede necesitar ejecutar todo el script de implementación, presentado como una sola línea, por ejemplo, usando </font></font><code>doctl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Esto puede requerir un esfuerzo adicional.</font></font><br>
<br>
<pre><code class="plaintext hljs">doctl compute ssh &lt;droplet&gt; --ssh-command "    &amp;&amp; "</code></pre><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TLS / SSL y equilibrio de carga</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Después de hacer todo lo que se discutió anteriormente, el último problema que surgió ante mí fue que el servidor no tenía SSL. Como utilizo el servidor Node.js, para que los </font><font style="vertical-align: inherit;">NXEX y Let's Encrypt Proxys revertidos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funcionen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , necesito jugar mucho.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Realmente no tenía ganas de hacer todas estas configuraciones SSL manualmente, así que creé un equilibrador de carga y grabé información al respecto en DNS. En el caso de DigitalOcean, por ejemplo, la creación de un certificado autofirmado autofirmado en un equilibrador de carga es un procedimiento simple, gratuito y rápido. Este enfoque tiene una ventaja adicional que, si es necesario, hace que sea muy fácil configurar SSL en una variedad de servidores que ejecutan un equilibrador de carga. Esto permite a los propios servidores no "pensar" en absoluto sobre SSL, sino usar el puerto como de costumbre </font></font><code>80</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Por lo tanto, configurar SSL en un equilibrador de carga es mucho más simple y conveniente que los métodos de configuración SSL alternativos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora puede cerrar en el servidor todos los puertos que aceptan conexiones entrantes, excepto el puerto </font></font><code>80</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilizado para la comunicación con el equilibrador de carga y el puerto </font></font><code>22</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para SSH. </font><font style="vertical-align: inherit;">Como resultado, un intento de acceder directamente al servidor en cualquier puerto, con la excepción de estos dos, fallará.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resumen</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Después de hacer todo lo que se describe en este artículo, ya no tenía miedo de la plataforma Docker o del concepto de cadenas automatizadas de CI / CD. Pude configurar una cadena de integración continua, durante la cual se prueba el código antes de que entre en producción y el código se implementa automáticamente en el servidor. Todo esto para mí todavía es relativamente nuevo, y estoy seguro de que hay formas de mejorar mi flujo de trabajo automatizado y hacerlo más eficiente. Por lo tanto, si usted tiene alguna idea sobre este tema, dejar que </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">me</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sé. Espero que este artículo te haya ayudado en tus asuntos. Quiero creer que después de leerlo, has aprendido tanto como yo, mientras descubrí todo lo que te dije al respecto. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PD:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hay </font><font style="vertical-align: inherit;">una imagen </font><font style="vertical-align: inherit;">en nuestro </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mercado</font></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que se instala con un solo clic. </font><font style="vertical-align: inherit;">Puede verificar el funcionamiento de los contenedores en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Todos los nuevos clientes tienen 3 días gratuitos para realizar las pruebas. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¡Queridos lectores! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿Utiliza tecnologías CI / CD en sus proyectos?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es488658/index.html">Usar faiss para buscar espacios multidimensionales</a></li>
<li><a href="../es488660/index.html">¿Es hora de olvidarse de React y actualizar a Svelte?</a></li>
<li><a href="../es488662/index.html">Extensiones de navegador requeridas por cada desarrollador web</a></li>
<li><a href="../es488664/index.html">Encontrar el kit de herramientas perfecto: analizar plantillas de proyectos de Python populares</a></li>
<li><a href="../es488666/index.html">10 componentes de reacción para todas las ocasiones</a></li>
<li><a href="../es488670/index.html">Acerca de los registros de máscara</a></li>
<li><a href="../es488672/index.html">Depuración de microcontroladores ARM Cortex-M por UART</a></li>
<li><a href="../es488674/index.html">Infografía con Excel y PowerPoint</a></li>
<li><a href="../es488678/index.html">Grandes apetitos para pequeños buffers en Node.js</a></li>
<li><a href="../es488682/index.html">¿Cómo probar las habilidades de programación de Python? Tareas de Yandex</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>