<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’…ğŸ¿ ğŸ® ğŸˆ·ï¸ ã‚½ãƒ¼ã‚¹ã¨Android NDKã‚’ä½¿ç”¨ã—ã¦Androidãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚screencapãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’èµ·å‹•ã—ã¾ã™ ğŸ’¡ ãŠ™ï¸ ğŸ–•ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç§ã¯Androidãƒ‡ãƒã‚¤ã‚¹ã®è‡ªå‹•åŒ–ã«å¾“äº‹ã—ã¦ãŠã‚Šã€SDKã¾ãŸã¯Android OSã«å¿…è¦ãªæ©Ÿèƒ½ãŒãªã„ã‹ã€ãã®å‹•ä½œãŒé…ã„ã¾ãŸã¯éå¸¸ã«é…ã„ã“ã¨ãŒã‚ˆãã‚ã‚Šã¾ã™ã€‚
 
 Native Development Kitï¼ˆNDKï¼‰ã®æ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ã€Javaã®åŒã˜æ©Ÿèƒ½ã‚ˆã‚Šã‚‚é«˜é€Ÿã«å®Ÿè¡Œã•ã‚Œã‚‹æ©Ÿèƒ½ã‚’ä½œæˆã§ãã¾ã™ã€‚ã“ã®ã‚¯...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ã‚½ãƒ¼ã‚¹ã¨Android NDKã‚’ä½¿ç”¨ã—ã¦Androidãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚screencapãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’èµ·å‹•ã—ã¾ã™</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456264/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§ã¯Androidãƒ‡ãƒã‚¤ã‚¹ã®è‡ªå‹•åŒ–ã«å¾“äº‹ã—ã¦ãŠã‚Šã€SDKã¾ãŸã¯Android OSã«å¿…è¦ãªæ©Ÿèƒ½ãŒãªã„ã‹ã€ãã®å‹•ä½œãŒé…ã„ã¾ãŸã¯éå¸¸ã«é…ã„ã“ã¨ãŒã‚ˆãã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Native Development Kitï¼ˆNDKï¼‰ã®æ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ã€Javaã®åŒã˜æ©Ÿèƒ½ã‚ˆã‚Šã‚‚é«˜é€Ÿã«å®Ÿè¡Œã•ã‚Œã‚‹æ©Ÿèƒ½ã‚’ä½œæˆã§ãã¾ã™ã€‚ã“ã®ã‚¯ã‚¸ãƒ©ãŒåŸå› ã§ã€C / C ++ã§è¨˜è¿°ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«è¿½åŠ ã—ãŸã‚Šã€Androidãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹ç”¨ã®ç‹¬è‡ªã®ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ãŸã‚Šã§ãã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®è¨˜äº‹ã§ã¯ã€Android OSã®ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚’æ§‹æˆã™ã‚‹æ–¹æ³•ã¨ã€ã“ã®OSã®æ—¢å­˜ã®ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã®æ©Ÿèƒ½ã‚’è£œå®Œã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¤ºã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãŸã¨ãˆã°ã€ç”»é¢å…¨ä½“ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’å–å¾—ã—ãŸã‚Šã€ã€Œç”Ÿãƒ‡ãƒ¼ã‚¿ã€ã‚’æä¾›ã—ãŸã‚Šã™ã‚‹ã ã‘ã§ãªãã€æŒ‡å®šã—ãŸãƒã‚¤ãƒ³ãƒˆã®ãƒ”ã‚¯ã‚»ãƒ«ã‚«ãƒ©ãƒ¼ã‚’è¿”ã—ãŸã‚Šã€ç›®çš„ã®é ˜åŸŸã®ã¿ã®ç”»åƒã‚’å–å¾—ã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã˜ã‚ƒã€è¡Œã“ã†ï¼</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NDKã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</font></font></h3><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android NDK</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’</font><font style="vertical-align: inherit;">
ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—</font><font style="vertical-align: inherit;">ã¦ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‚’è§£å‡ã™ã‚‹ã‹ã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDK Managerã‚’</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»‹ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ã¾ã™</font></a><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã¾ã è¿½åŠ ã—ã¦ã„ãªã„å ´åˆã¯ã€è¿½åŠ ã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ„ãƒ¼ãƒ«ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt-get install android-tools-adb android-tools-fastboot</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦ã€ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç”¨ã®ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€ã‚’ä½œæˆã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs"> ./android-ndk-r12b/build/tools/make_standalone_toolchain.py --arch &lt;arm or arm64 or other&gt; --install-dir ~/arm</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç§ã®HOMTOM HT16ã¯armeabi-v7aã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ¼ã§ã‚ã‚‹ãŸã‚ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs"> ./android-ndk-r12b/build/tools/make_standalone_toolchain.py --arch arm --install-dir ~/arm</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå¿…è¦ãªã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã¾ã§å¾…æ©Ÿã—ã¾ã™ï¼ˆç´„5åˆ†ç¨‹åº¦ï¼‰ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒã‚§ãƒƒã‚¯</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°¡å˜ãªã‚³ãƒ¼ãƒ‰ã§hello_world.cãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> <span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"hello world"</span>);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦ãã‚Œã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ã¿ã¦ãã ã•ã„ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">~/arm/bin/clang -pie hello_world.c -o hello_world</code></pre><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
å±æ€§ã‚’ä½¿ç”¨ã—</font><font style="vertical-align: inherit;">ã¦ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æŒ‡å®šã—ã€</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-pieã‚¹ã‚¤ãƒƒãƒ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’ä½¿ç”¨ã—</font><font style="vertical-align: inherit;">ã¦ã€PIEãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã¨ãã®ã™ã¹ã¦ã®ä¾å­˜é–¢ä¿‚ãŒã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã‚‹ãŸã³ã«ä»®æƒ³ãƒ¡ãƒ¢ãƒªå†…ã®ãƒ©ãƒ³ãƒ€ãƒ ãªå ´æ‰€ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹ã“ã¨ã‚’ç¤ºã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãŒæˆåŠŸã—ãŸå ´åˆã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é›»è©±ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">adb push ./hello_world /data/<span class="hljs-built_in">local</span>/tmp</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦ã€ãƒã‚¤ãƒŠãƒªã‚’è©¦ã—ã¦ãã ã•ã„ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">adb shell<font></font>
/data/<span class="hljs-built_in">local</span>/tmp/hello_world</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã€Œhello worldã€ã¨ã„ã†ãƒ•ãƒ¬ãƒ¼ã‚ºã®å‡ºåŠ›ã‚’è¦‹ãŸå ´åˆã€ã‚ãªãŸã¯ã™ã¹ã¦ã‚’æ­£ã—ãè¡Œã„ã¾ã—ãŸï¼</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã‚Œã§ã‚‚ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆã¯ã€ãŠãã‚‰ãé–“é•ã£ãŸã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’é¸æŠã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å‰Šé™¤ã—ã¦ã€æ­£ã—ã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å†ä½œæˆã—ã¦ãã ã•ã„ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ±ºå®šã™ã‚‹ã«ã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã§ãã¾ã™</font></font><br>
<br>
<pre><code class="bash hljs">adb shell cat /proc/cpuinfo</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚½ãƒ¼ã‚¹ã¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚ŒãŸãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ†æã¯éå¸¸ã«æ™‚é–“ãŒã‹ã‹ã‚Šã€Androidã¯ã‚ªãƒ¼ãƒ—ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã§ã‚ã‚‹ãŸã‚ã€ã“ã®å“è³ªã‚’æ´»ç”¨ã—ã¦ã¿ã¦ãã ã•ã„ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã“ã«è¡Œã£</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¦</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€Androidã®æ­£ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ¢ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã•ã¦ã€ã™ã§ã«-ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã®ç›®çš„ã®ã‚½ãƒ¼ã‚¹ã‚’æ¢ã—ã¦ãã ã•ã„ã€‚</font><font style="vertical-align: inherit;">ã‚‚ã¡ã‚ã‚“ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚‚ã‚ã‚Šã¾ã™-ã‚°ãƒ¼ã‚°ãƒ«ã¨ã€Œæ­£ã—ã„è¦æ±‚ã€ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç§ã®å ´åˆã€å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã¯</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã®ãƒªãƒ³ã‚¯ã«ã‚ã‚Š</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">screencap.cpp</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs">
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;errno.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fcntl.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;linux/fb.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/ioctl.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/mman.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;binder/ProcessState.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;gui/SurfaceComposerClient.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;gui/ISurfaceComposer.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ui/DisplayInfo.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ui/PixelFormat.h&gt;</span></span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Fix Skia.</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> GCC diagnostic push</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> GCC diagnostic ignored <span class="hljs-meta-string">"-Wunused-parameter"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SkImageEncoder.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SkData.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> GCC diagnostic pop</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> android;
<span class="hljs-keyword">static</span> <span class="hljs-keyword">uint32_t</span> DEFAULT_DISPLAY_ID = ISurfaceComposer::eDisplayIdMain;
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">usage</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* pname)</span>
</span>{
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>,
            <span class="hljs-string">"usage: %s [-hp] [-d display-id] [FILENAME]\n"</span>
            <span class="hljs-string">"   -h: this message\n"</span>
            <span class="hljs-string">"   -p: save the file as a png.\n"</span>
            <span class="hljs-string">"   -d: specify the display id to capture, default %d.\n"</span>
            <span class="hljs-string">"If FILENAME ends with .png it will be saved as a png.\n"</span>
            <span class="hljs-string">"If FILENAME is not given, the results will be printed to stdout.\n"</span>,<font></font>
            pname, DEFAULT_DISPLAY_ID<font></font>
    );<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> SkColorType <span class="hljs-title">flinger2skia</span><span class="hljs-params">(PixelFormat f)</span>
</span>{
    <span class="hljs-keyword">switch</span> (f) {
        <span class="hljs-keyword">case</span> PIXEL_FORMAT_RGB_565:
            <span class="hljs-keyword">return</span> kRGB_565_SkColorType;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">return</span> kN32_SkColorType;<font></font>
    }<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">status_t</span> <span class="hljs-title">vinfoToPixelFormat</span><span class="hljs-params">(<span class="hljs-keyword">const</span> fb_var_screeninfo&amp; vinfo,
        <span class="hljs-keyword">uint32_t</span>* bytespp, <span class="hljs-keyword">uint32_t</span>* f)</span>
</span>{
    <span class="hljs-keyword">switch</span> (vinfo.bits_per_pixel) {
        <span class="hljs-keyword">case</span> <span class="hljs-number">16</span>:<font></font>
            *f = PIXEL_FORMAT_RGB_565;<font></font>
            *bytespp = <span class="hljs-number">2</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">24</span>:<font></font>
            *f = PIXEL_FORMAT_RGB_888;<font></font>
            *bytespp = <span class="hljs-number">3</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">32</span>:
            <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> do better decoding of vinfo here</span><font></font>
            *f = PIXEL_FORMAT_RGBX_8888;<font></font>
            *bytespp = <span class="hljs-number">4</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">return</span> BAD_VALUE;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> NO_ERROR;<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">status_t</span> <span class="hljs-title">notifyMediaScanner</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* fileName)</span> </span>{
    <span class="hljs-function">String8 <span class="hljs-title">cmd</span><span class="hljs-params">(<span class="hljs-string">"am broadcast -a android.intent.action.MEDIA_SCANNER_SCAN_FILE -d file://"</span>)</span></span>;
    <span class="hljs-function">String8 <span class="hljs-title">fileUrl</span><span class="hljs-params">(<span class="hljs-string">"\""</span>)</span></span>;<font></font>
    fileUrl.append(fileName);<font></font>
    fileUrl.append(<span class="hljs-string">"\""</span>);<font></font>
    cmd.append(fileName);<font></font>
    cmd.append(<span class="hljs-string">" &gt; /dev/null"</span>);
    <span class="hljs-keyword">int</span> result = system(cmd.<span class="hljs-built_in">string</span>());
    <span class="hljs-keyword">if</span> (result &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unable to broadcast intent for media scanner.\n"</span>);
        <span class="hljs-keyword">return</span> UNKNOWN_ERROR;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> NO_ERROR;<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span>
</span>{<font></font>
    ProcessState::self()-&gt;startThreadPool();<font></font>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* pname = argv[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">bool</span> png = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">int32_t</span> displayId = DEFAULT_DISPLAY_ID;
    <span class="hljs-keyword">int</span> c;
    <span class="hljs-keyword">while</span> ((c = getopt(argc, argv, <span class="hljs-string">"phd:"</span>)) != <span class="hljs-number">-1</span>) {
        <span class="hljs-keyword">switch</span> (c) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'p'</span>:<font></font>
                png = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'d'</span>:<font></font>
                displayId = atoi(optarg);<font></font>
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'?'</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-string">'h'</span>:<font></font>
                usage(pname);<font></font>
                <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
        }<font></font>
    }<font></font>
    argc -= optind;<font></font>
    argv += optind;<font></font>
    <span class="hljs-keyword">int</span> fd = <span class="hljs-number">-1</span>;
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* fn = <span class="hljs-literal">NULL</span>;
    <span class="hljs-keyword">if</span> (argc == <span class="hljs-number">0</span>) {<font></font>
        fd = dup(STDOUT_FILENO);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (argc == <span class="hljs-number">1</span>) {<font></font>
        fn = argv[<span class="hljs-number">0</span>];<font></font>
        fd = open(fn, O_WRONLY | O_CREAT | O_TRUNC, <span class="hljs-number">0664</span>);
        <span class="hljs-keyword">if</span> (fd == <span class="hljs-number">-1</span>) {
            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Error opening file: %s (%s)\n"</span>, fn, strerror(errno));
            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
        }<font></font>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> len = <span class="hljs-built_in">strlen</span>(fn);
        <span class="hljs-keyword">if</span> (len &gt;= <span class="hljs-number">4</span> &amp;&amp; <span class="hljs-number">0</span> == <span class="hljs-built_in">strcmp</span>(fn+len<span class="hljs-number">-4</span>, <span class="hljs-string">".png"</span>)) {<font></font>
            png = <span class="hljs-literal">true</span>;<font></font>
        }<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">if</span> (fd == <span class="hljs-number">-1</span>) {<font></font>
        usage(pname);<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">void</span> <span class="hljs-keyword">const</span>* mapbase = MAP_FAILED;
    <span class="hljs-keyword">ssize_t</span> mapsize = <span class="hljs-number">-1</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-keyword">const</span>* base = <span class="hljs-literal">NULL</span>;
    <span class="hljs-keyword">uint32_t</span> w, s, h, f;
    <span class="hljs-keyword">size_t</span> size = <span class="hljs-number">0</span>;
    <span class="hljs-comment">// Maps orientations from DisplayInfo to ISurfaceComposer</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">uint32_t</span> ORIENTATION_MAP[] = {<font></font>
        ISurfaceComposer::eRotateNone, <span class="hljs-comment">// 0 == DISPLAY_ORIENTATION_0</span>
        ISurfaceComposer::eRotate270, <span class="hljs-comment">// 1 == DISPLAY_ORIENTATION_90</span>
        ISurfaceComposer::eRotate180, <span class="hljs-comment">// 2 == DISPLAY_ORIENTATION_180</span>
        ISurfaceComposer::eRotate90, <span class="hljs-comment">// 3 == DISPLAY_ORIENTATION_270</span><font></font>
    };<font></font>
    ScreenshotClient screenshot;<font></font>
    sp&lt;IBinder&gt; display = SurfaceComposerClient::getBuiltInDisplay(displayId);<font></font>
    <span class="hljs-keyword">if</span> (display == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unable to get handle for display %d\n"</span>, displayId);
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
    }<font></font>
    Vector&lt;DisplayInfo&gt; configs;<font></font>
    SurfaceComposerClient::getDisplayConfigs(display, &amp;configs);<font></font>
    <span class="hljs-keyword">int</span> activeConfig = SurfaceComposerClient::getActiveConfig(display);
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">size_t</span>&gt;(activeConfig) &gt;= configs.size()) {
        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Active config %d not inside configs (size %zu)\n"</span>,<font></font>
                activeConfig, configs.size());<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">uint8_t</span> displayOrientation = configs[activeConfig].orientation;
    <span class="hljs-keyword">uint32_t</span> captureOrientation = ORIENTATION_MAP[displayOrientation];
    <span class="hljs-keyword">status_t</span> result = screenshot.update(display, Rect(), <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-1U</span>,
            <span class="hljs-literal">false</span>, captureOrientation);
    <span class="hljs-keyword">if</span> (result == NO_ERROR) {<font></font>
        base = screenshot.getPixels();<font></font>
        w = screenshot.getWidth();<font></font>
        h = screenshot.getHeight();<font></font>
        s = screenshot.getStride();<font></font>
        f = screenshot.getFormat();<font></font>
        size = screenshot.getSize();<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* fbpath = <span class="hljs-string">"/dev/graphics/fb0"</span>;
        <span class="hljs-keyword">int</span> fb = open(fbpath, O_RDONLY);
        <span class="hljs-keyword">if</span> (fb &gt;= <span class="hljs-number">0</span>) {
            <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">fb_var_screeninfo</span> <span class="hljs-title">vinfo</span>;</span>
            <span class="hljs-keyword">if</span> (ioctl(fb, FBIOGET_VSCREENINFO, &amp;vinfo) == <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">uint32_t</span> bytespp;
                <span class="hljs-keyword">if</span> (vinfoToPixelFormat(vinfo, &amp;bytespp, &amp;f) == NO_ERROR) {
                    <span class="hljs-keyword">size_t</span> offset = (vinfo.xoffset + vinfo.yoffset*vinfo.xres) * bytespp;<font></font>
                    w = vinfo.xres;<font></font>
                    h = vinfo.yres;<font></font>
                    s = vinfo.xres;<font></font>
                    size = w*h*bytespp;<font></font>
                    mapsize = offset + size;<font></font>
                    mapbase = mmap(<span class="hljs-number">0</span>, mapsize, PROT_READ, MAP_PRIVATE, fb, <span class="hljs-number">0</span>);
                    <span class="hljs-keyword">if</span> (mapbase != MAP_FAILED) {<font></font>
                        base = (<span class="hljs-keyword">void</span> <span class="hljs-keyword">const</span> *)((<span class="hljs-keyword">char</span> <span class="hljs-keyword">const</span> *)mapbase + offset);<font></font>
                    }<font></font>
                }<font></font>
            }<font></font>
            close(fb);<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (base != <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">if</span> (png) {
            <span class="hljs-keyword">const</span> SkImageInfo info = SkImageInfo::Make(w, h, flinger2skia(f),<font></font>
                                                       kPremul_SkAlphaType);<font></font>
            <span class="hljs-function">SkAutoTUnref&lt;SkData&gt; <span class="hljs-title">data</span><span class="hljs-params">(SkImageEncoder::EncodeData(info, base, s*bytesPerPixel(f),
                    SkImageEncoder::kPNG_Type, SkImageEncoder::kDefaultQuality))</span></span>;
            <span class="hljs-keyword">if</span> (data.get()) {<font></font>
                write(fd, data-&gt;data(), data-&gt;size());<font></font>
            }<font></font>
            <span class="hljs-keyword">if</span> (fn != <span class="hljs-literal">NULL</span>) {<font></font>
                notifyMediaScanner(fn);<font></font>
            }<font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
            write(fd, &amp;w, <span class="hljs-number">4</span>);<font></font>
            write(fd, &amp;h, <span class="hljs-number">4</span>);<font></font>
            write(fd, &amp;f, <span class="hljs-number">4</span>);
            <span class="hljs-keyword">size_t</span> Bpp = bytesPerPixel(f);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> y=<span class="hljs-number">0</span> ; y&lt;h ; y++) {<font></font>
                write(fd, base, w*Bpp);<font></font>
                base = (<span class="hljs-keyword">void</span> *)((<span class="hljs-keyword">char</span> *)base + s*Bpp);<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
    close(fd);<font></font>
    <span class="hljs-keyword">if</span> (mapbase != MAP_FAILED) {<font></font>
        munmap((<span class="hljs-keyword">void</span> *)mapbase, mapsize);<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’éƒ¨åˆ†çš„ã«åˆ†æã—ã¾ã™ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DEFAULT_DISPLAY_ID-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’å–å¾—ã™ã‚‹ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã®è­˜åˆ¥å­ã€‚ä»Šå›ã®ä¾‹ã§ã¯ã€</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0ã€‚flinger2skia</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŠã‚ˆã³</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vinfoToPixelFormat-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”»åƒã®å½¢å¼ã‚’æ±ºå®šã—ã¾ã™ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">notifyMediaScanner-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã§ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒä½œæˆã•ã‚ŒãŸå¾Œã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ­£ã—ãè¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã«ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚’å‘¼ã³å‡ºã•ãªã„å ´åˆã€ä½œæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã™ã¹ã¦ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒè¡¨ç¤ºã§ãã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸»ãªæ©Ÿèƒ½ã¯ã€Œèª­ã¿å–ã‚Šã€ãŒé›£ã—ããªã„ãŸã‚ã€ç”»åƒãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«ç›´æ¥é–¢ä¸ã™ã‚‹é‡è¦ãªãƒã‚¤ãƒ³ãƒˆã®ã¿ã‚’åˆ†æã—ã¾ã™ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ dev /ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯/ fb0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-ã“ã‚Œã¯ã€ã„ã‚ã‚†ã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒãƒƒãƒ•ã‚¡ã§ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ•ãƒ¬ãƒ¼ãƒ ãƒãƒƒãƒ•ã‚¡ã¯ã€1ã¤ä»¥ä¸Šã®ãƒ“ãƒ‡ã‚ªãƒ•ãƒ¬ãƒ¼ãƒ ã‚’çŸ­æœŸçš„ã«ä¿å­˜ã™ã‚‹ãŸã‚ã®ãƒ“ãƒ‡ã‚ªãƒ¡ãƒ¢ãƒªé ˜åŸŸã§ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ¡ã‚¤ãƒ³ã‚³ãƒ¼ãƒ‰ã«åŸºã¥ã„ã¦ã€ç”»é¢ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹Androidãƒ‡ãƒã‚¤ã‚¹ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã—ãŸãŒã£ã¦ã€ã€Œãƒ©ãƒƒã‚­ãƒ¼ã€ã§ã‚ã‚Œã°ã€vinfo.xoffsetã¨vinfo.yoffsetã‚’èªè­˜ã—ï¼ˆã»ã¨ã‚“ã©ã®å ´åˆã€ã“ã‚Œã‚‰ã¯0ã«ãªã‚Šã¾ã™ï¼‰ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ç°¡å˜ã«è‰²æƒ…å ±ã‚’å–å¾—ã§ãã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">dd <span class="hljs-keyword">if</span>=/dev/graphics/fb0 bs=&lt;bytes per pixel&gt; count=1 skip=&lt;pixel offset&gt; 2&gt;/dev/null | hd</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç§ã®å ´åˆã€ã™ã¹ã¦ãŒãã‚Œã»ã©å˜ç´”ã§ã¯ãªãã€ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ç”»åƒã«é–¢ã™ã‚‹æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">screenshot.update</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å–å¾—ã™ã‚‹2ç•ªç›®ã®æ–¹æ³•ã§ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®é–¢æ•°ã«ã¯ã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã“ã«</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚ã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰ãŒã„ãã¤ã‹ã‚ã‚Š</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ã¾ã™</font></a><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ•°ãŒæœ€ã‚‚å¤šã„é–¢æ•°ã®èª¬æ˜ã‚’è€ƒãˆã¦ã¿ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs">ScreenshotClient::update(<span class="hljs-keyword">const</span> sp&lt;IBinder&gt;&amp; display,<font></font>
        Rect sourceCrop, <span class="hljs-keyword">uint32_t</span> reqWidth, <span class="hljs-keyword">uint32_t</span> reqHeight,
        <span class="hljs-keyword">uint32_t</span> minLayerZ, <span class="hljs-keyword">uint32_t</span> maxLayerZ,
        <span class="hljs-keyword">bool</span> useIdentityTransform, <span class="hljs-keyword">uint32_t</span> rotation)</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">display-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¿…è¦ãªãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã¸ã®ãƒªãƒ³ã‚¯ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourceCrop-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¸æŠã—ãŸç”»åƒé ˜åŸŸã®ãƒˆãƒªãƒŸãƒ³ã‚°ã€‚å·¦ä¸Šã¨å³ä¸‹ã®åº§æ¨™ã‚’å«ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆåˆè¨ˆ4ã¤ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿xLeftã€yTopã€xRightã€yBottomï¼‰ã€‚åŸç‚¹ã¯å·¦ä¸Šéš…ã§ã™ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reqWidth</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -è¿”ã•ã‚ŒãŸç”»åƒã®å¹…</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reqHeight</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -è¿”ã•ã‚ŒãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã®é«˜ã•</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minLayerZ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maxLayerZ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -ã“ã‚Œã‚‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ä½œæ¥­ã‚’ç†è§£ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã§ã—ãŸã‹ã€‚å€¤ã‚’åˆ—æŒ™ã™ã‚‹ã¨ãƒ–ãƒ©ãƒƒã‚¯ã‚¿ãƒƒãƒ—ãŒç”Ÿæˆã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">useIdentityTransform</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -trueã®å ´åˆã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¸Šã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ç„¡åŠ¹ã«ã—ã¾ã™ã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACTION_MANAGE_OVERLAY_PERMISSION </font></font></a><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³</font></b><font style="vertical-align: inherit;">ã‚’ä½¿ç”¨ã™ã‚‹</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£</font></a></font><br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-ç”»åƒã®å›è»¢ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã—ãŸãŒã£ã¦ã€ãƒ”ã‚¯ã‚»ãƒ«ã®è‰²ã‚’å–å¾—ã™ã‚‹ã«ã¯ã€xLeftã¨yTopã‚’1ã ã‘ã‚·ãƒ•ãƒˆã—ã¦è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã¯0ã‹ã‚‰å§‹ã¾ã‚Šã€æŒ‡å®šã—ãŸåº§æ¨™ã‚’xRightã€yBottomã«è¨­å®šã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">reqWidthã¨reqHeightã§å€¤ã‚’1ã«è¨­å®šã—ã¾ã™ã€‚ã“ã®é–¢æ•°ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã§ã€å¿…è¦ãªé ˜åŸŸã®å¢ƒç•Œã‚’æ±ºå®šã§ãã¾ã™ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŸºæœ¬çš„ãªscreencap.cppã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®Ÿéš›ã€ã“ã‚Œã¯æœ€ã‚‚é›£ã—ã„éƒ¨åˆ†ã§ã‚ã‚Šã€æ•°æ—¥ã¾ãŸã¯1é€±é–“ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚æ®‹å¿µãªãŒã‚‰ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã«æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®screencapã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®è¿…é€Ÿãªè§£æ±ºç­–ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸãŸã‚ã€clangã¨ãã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ç‰¹ã«è‹¦ç—›ã‚’å¼·ã„ã‚‰ã‚Œã¾ã—ãŸã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’ã™ãã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒ¼ã¯ãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„ã“ã¨ã‚’å¸¸ã«æ–­è¨€ã—ã€ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã“ã¨ã‚’å ±å‘Šã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ãŒã€ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã®ãŸã‚ã€æœ€åˆã¯NDKãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ãªã„ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚ã‚¨ãƒ©ãƒ¼ã¯ã€ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¾ãŸã¯ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã©ã“ã«ç½®ãã¹ãã‹ã‚’ç¤ºã—ã¾ã™ã€‚ã“ã‚Œã‚’è¡Œã†ã«ã¯ã€ä¸è¶³ã—ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€sysrootãŒé…ç½®ã•ã‚Œã¦ã„ã‚‹å ´æ‰€ï¼ˆclangãŒæ¤œç´¢ã—ã¦ã„ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰ã‚’è¦‹ã¤ã‘ã‚‹ã«ã¯ã€æ¬¡ã®ã€Œæ©Ÿèƒ½ã€ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs">echo <span class="hljs-string">"#include &lt;bogus.h&gt; int main(){}"</span> &gt; t.c; ~/arm/bin/clang  -v t.c; rm t.c</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚¨ãƒ©ãƒ¼ã«ã¯ã€ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ã®ãƒ‘ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">clangãŒåˆ¥ã®å ´æ‰€ã«ã‚ã‚‹å ´åˆã¯ã€ãƒ‘ã‚¹ã‚’å¤‰æ›´ã—ã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ­ã‚°</font></font></b><div class="spoiler_text"><pre><code class="bash hljs">Android (4751641 based on r328903) clang version 7.0.2 (https://android.googlesource.com/toolchain/clang 003100370607242ddd5815e4a043907ea9004281) (https://android.googlesource.com/toolchain/llvm 1d739ffb0366421d383e04ff80ec2ee591315116) (based on LLVM 7.0.2svn)<font></font>
Target: armv7a-none-linux-android16<font></font>
Thread model: posix<font></font>
InstalledDir: /Users/macbookair/arm/bin<font></font>
Found candidate GCC installation: /Users/macbookair/arm/bin/../lib/gcc/arm-linux-androideabi/4.9.x<font></font>
Selected GCC installation: /Users/macbookair/arm/bin/../lib/gcc/arm-linux-androideabi/4.9.x<font></font>
Candidate multilib: thumb;@mthumb<font></font>
Candidate multilib: armv7<span class="hljs-_">-a</span>;@march=armv7<span class="hljs-_">-a</span>
Candidate multilib: armv7<span class="hljs-_">-a</span>/thumb;@march=armv7<span class="hljs-_">-a</span>@mthumb<font></font>
Candidate multilib: .;<font></font>
Selected multilib: armv7<span class="hljs-_">-a</span>;@march=armv7<span class="hljs-_">-a</span>
 <span class="hljs-string">"/Users/macbookair/arm/bin/clang70"</span> -cc1 -triple armv7-none-linux-android16 -emit-obj -mrelax-all -<span class="hljs-built_in">disable</span>-free -<span class="hljs-built_in">disable</span>-llvm-verifier -discard-value-names -main-file-name t.c -mrelocation-model pic -pic-level 2 -pic-is-pie -mthread-model posix -mdisable-fp-elim -fmath-errno -masm-verbose -mconstructor-aliases -fuse-init-array -target-cpu generic -target-feature +soft-float-abi -target-abi aapcs-linux -mfloat-abi soft -fallow-half-arguments-and-returns -dwarf-column-info -debugger-tuning=gdb -target-linker-version 241.9 -v -resource-dir /Users/macbookair/arm/lib64/clang/7.0.2 -isysroot /Users/macbookair/arm/bin/../sysroot -internal-isystem /Users/macbookair/arm/bin/../sysroot/usr/<span class="hljs-built_in">local</span>/include -internal-isystem /Users/macbookair/arm/lib64/clang/7.0.2/include -internal-externc-isystem /Users/macbookair/arm/bin/../sysroot/include -internal-externc-isystem /Users/macbookair/arm/bin/../sysroot/usr/include -fdebug-compilation-dir /Users/macbookair/Downloads/sji-android-screen-capture-master/src/android/capture -ferror-limit 19 -fmessage-length 80 -fno-signed-char -fobjc-runtime=gcc -fdiagnostics-show-option -fcolor-diagnostics -o /var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/t-9f5ef7.o -x c t.c<font></font>
clang -cc1 version 7.0.2 based upon LLVM 7.0.2svn default target x86_64-apple-darwin18.0.0<font></font>
ignoring nonexistent directory <span class="hljs-string">"/Users/macbookair/arm/bin/../sysroot/include"</span>
<span class="hljs-comment">#include "..." search starts here:</span>
<span class="hljs-comment">#include &lt;...&gt; search starts here:</span>
 /Users/macbookair/arm/bin/../sysroot/usr/<span class="hljs-built_in">local</span>/include<font></font>
 /Users/macbookair/arm/lib64/clang/7.0.2/include<font></font>
 /Users/macbookair/arm/bin/../sysroot/usr/include<font></font>
End of search list.<font></font>
t.c:1:10: error: expected <span class="hljs-string">"FILENAME"</span> or &lt;FILENAME&gt;
<span class="hljs-comment">#include &lt;bogus.h&gt; int main(){}</span><font></font>
         ^<font></font>
1 error generated.<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Googleã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€å¿…è¦ãªã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¢ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ç§ã®å ´åˆã€æ¬¡ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ•ã‚¡ã‚¤ãƒ«</font></font></b><div class="spoiler_text"><pre><code class="bash hljs">// <font></font>
~/arm/sysroot/usr/include/binder<font></font>
~/arm/sysroot/usr/include/utils<font></font>
~/arm/sysroot/usr/include/cutils<font></font>
~/arm/sysroot/usr/include/<span class="hljs-built_in">log</span><font></font>
~/arm/sysroot/usr/include/system<font></font>
~/arm/sysroot/usr/include/gui<font></font>
~/arm/sysroot/usr/include/ui<font></font>
~/arm/sysroot/usr/include/hardware<font></font>
~/arm/sysroot/usr/ports<font></font>
<font></font>
// <font></font>
~/arm/sysroot/usr/include/SkAnnotation.h<font></font>
~/arm/sysroot/usr/include/SkAtomics.h<font></font>
~/arm/sysroot/usr/include/SkBBHFactory.h<font></font>
~/arm/sysroot/usr/include/SkBitmap.h<font></font>
~/arm/sysroot/usr/include/SkBitmapDevice.h<font></font>
~/arm/sysroot/usr/include/SkBlitRow.h<font></font>
~/arm/sysroot/usr/include/SkBlurTypes.h<font></font>
~/arm/sysroot/usr/include/SkCanvas.h<font></font>
~/arm/sysroot/usr/include/SkChunkAlloc.h<font></font>
~/arm/sysroot/usr/include/SkClipStack.h<font></font>
~/arm/sysroot/usr/include/SkColor.h<font></font>
~/arm/sysroot/usr/include/SkColorFilter.h<font></font>
~/arm/sysroot/usr/include/SkColorPriv.h<font></font>
~/arm/sysroot/usr/include/SkColorTable.h<font></font>
~/arm/sysroot/usr/include/SkComposeShader.h<font></font>
~/arm/sysroot/usr/include/SkData.h<font></font>
~/arm/sysroot/usr/include/SkDataTable.h<font></font>
~/arm/sysroot/usr/include/SkDeque.h<font></font>
~/arm/sysroot/usr/include/SkDevice.h<font></font>
~/arm/sysroot/usr/include/SkDither.h<font></font>
~/arm/sysroot/usr/include/SkDocument.h<font></font>
~/arm/sysroot/usr/include/SkDraw.h<font></font>
~/arm/sysroot/usr/include/SkDrawable.h<font></font>
~/arm/sysroot/usr/include/SkDrawFilter.h<font></font>
~/arm/sysroot/usr/include/SkDrawLooper.h<font></font>
~/arm/sysroot/usr/include/SkDrawPictureCallback.h<font></font>
~/arm/sysroot/usr/include/SkEndian.h<font></font>
~/arm/sysroot/usr/include/SkError.h<font></font>
~/arm/sysroot/usr/include/SkFilterQuality.h<font></font>
~/arm/sysroot/usr/include/SkFixed.h<font></font>
~/arm/sysroot/usr/include/SkFlattenable.h<font></font>
~/arm/sysroot/usr/include/SkFlattenableSerialization.h<font></font>
~/arm/sysroot/usr/include/SkFloatBits.h<font></font>
~/arm/sysroot/usr/include/SkFloatingPoint.h<font></font>
~/arm/sysroot/usr/include/SkFont.h<font></font>
~/arm/sysroot/usr/include/SkFontHost.h<font></font>
~/arm/sysroot/usr/include/SkFontLCDConfig.h<font></font>
~/arm/sysroot/usr/include/SkFontStyle.h<font></font>
~/arm/sysroot/usr/include/SkGraphics.h<font></font>
~/arm/sysroot/usr/include/SkImage.h<font></font>
~/arm/sysroot/usr/include/SkImageDecoder.h<font></font>
~/arm/sysroot/usr/include/SkImageEncoder.h<font></font>
~/arm/sysroot/usr/include/SkImageFilter.h<font></font>
~/arm/sysroot/usr/include/SkImageGenerator.h<font></font>
~/arm/sysroot/usr/include/SkImageInfo.h<font></font>
~/arm/sysroot/usr/include/SkInstCnt.h<font></font>
~/arm/sysroot/usr/include/SkLazyPtr.h<font></font>
~/arm/sysroot/usr/include/SkMallocPixelRef.h<font></font>
~/arm/sysroot/usr/include/SkMask.h<font></font>
~/arm/sysroot/usr/include/SkMaskFilter.h<font></font>
~/arm/sysroot/usr/include/SkMath.h<font></font>
~/arm/sysroot/usr/include/SkMatrix.h<font></font>
~/arm/sysroot/usr/include/SkMetaData.h<font></font>
~/arm/sysroot/usr/include/SkMultiPictureDraw.h<font></font>
~/arm/sysroot/usr/include/SkMutex.h<font></font>
~/arm/sysroot/usr/include/SkOnce.h<font></font>
~/arm/sysroot/usr/include/SkOSFile.h<font></font>
~/arm/sysroot/usr/include/SkPackBits.h<font></font>
~/arm/sysroot/usr/include/SkPaint.h<font></font>
~/arm/sysroot/usr/include/SkPath.h<font></font>
~/arm/sysroot/usr/include/SkPathEffect.h<font></font>
~/arm/sysroot/usr/include/SkPathMeasure.h<font></font>
~/arm/sysroot/usr/include/SkPathRef.h<font></font>
~/arm/sysroot/usr/include/SkPicture.h<font></font>
~/arm/sysroot/usr/include/SkPictureRecorder.h<font></font>
~/arm/sysroot/usr/include/SkPixelRef.h<font></font>
~/arm/sysroot/usr/include/SkPixelSerializer.h<font></font>
~/arm/sysroot/usr/include/SkPoint.h<font></font>
~/arm/sysroot/usr/include/SkPostConfig.h<font></font>
~/arm/sysroot/usr/include/SkPreConfig.h<font></font>
~/arm/sysroot/usr/include/SkRasterizer.h<font></font>
~/arm/sysroot/usr/include/SkRect.h<font></font>
~/arm/sysroot/usr/include/SkRefCnt.h<font></font>
~/arm/sysroot/usr/include/SkRegion.h<font></font>
~/arm/sysroot/usr/include/SkRRect.h<font></font>
~/arm/sysroot/usr/include/SkScalar.h<font></font>
~/arm/sysroot/usr/include/SkShader.h<font></font>
~/arm/sysroot/usr/include/SkSize.h<font></font>
~/arm/sysroot/usr/include/SkSpinlock.h<font></font>
~/arm/sysroot/usr/include/SkStream.h<font></font>
~/arm/sysroot/usr/include/SkString.h<font></font>
~/arm/sysroot/usr/include/SkStrokeRec.h<font></font>
~/arm/sysroot/usr/include/SkSurface.h<font></font>
~/arm/sysroot/usr/include/SkSurfaceProps.h<font></font>
~/arm/sysroot/usr/include/SkTArray.h<font></font>
~/arm/sysroot/usr/include/SkTDArray.h<font></font>
~/arm/sysroot/usr/include/SkTDict.h<font></font>
~/arm/sysroot/usr/include/SkTDStack.h<font></font>
~/arm/sysroot/usr/include/SkTemplates.h<font></font>
~/arm/sysroot/usr/include/SkTextBlob.h<font></font>
~/arm/sysroot/usr/include/SkThread.h<font></font>
~/arm/sysroot/usr/include/SkTime.h<font></font>
~/arm/sysroot/usr/include/SkTInternalLList.h<font></font>
~/arm/sysroot/usr/include/SkTLazy.h<font></font>
~/arm/sysroot/usr/include/SkTRegistry.h<font></font>
~/arm/sysroot/usr/include/SkTSearch.h<font></font>
~/arm/sysroot/usr/include/SkTypeface.h<font></font>
~/arm/sysroot/usr/include/SkTypes.h<font></font>
~/arm/sysroot/usr/include/SkUnPreMultiply.h<font></font>
~/arm/sysroot/usr/include/SkUserConfig.h<font></font>
~/arm/sysroot/usr/include/SkUtils.h<font></font>
~/arm/sysroot/usr/include/SkWeakRefCnt.h<font></font>
~/arm/sysroot/usr/include/SkWriteBuffer.h<font></font>
~/arm/sysroot/usr/include/SkWriter32.h<font></font>
~/arm/sysroot/usr/include/SkXfermode.h<font></font>
<font></font>
//   <font></font>
~/arm/sysroot/usr/include/android/log.h<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦ã€ãã‚Œã¯ã“ã“ã§å½¼ãŒæˆåŠŸã—ã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹ã§ã—ã‚‡ã†ã€ã™ã¹ã¦è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«</font></font><br>
<br>
<pre><code class="bash hljs">~/arm/bin/clang -pie screencap.cpp -o ./screencap</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦ç§ãŸã¡ã¯ã²ã©ã„çµæœã‚’å¾—ã¾ã™ï¼š</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç·Šå¼µã—ãªã„ã‚ˆã†ã«</font></font></b><div class="spoiler_text"><pre><code class="bash hljs">/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ProcessState::self()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ProcessState::startThreadPool()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ScreenshotClient::ScreenshotClient()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::SurfaceComposerClient::getBuiltInDisplay(int)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::SurfaceComposerClient::getDisplayConfigs(android::sp&lt;android::IBinder&gt; const&amp;, android::Vector&lt;android::DisplayInfo&gt;*)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::SurfaceComposerClient::getActiveConfig(android::sp&lt;android::IBinder&gt; const&amp;)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ScreenshotClient::update(android::sp&lt;android::IBinder&gt; const&amp;, android::Rect, unsigned int, unsigned int, unsigned int, unsigned int, bool, unsigned int)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ScreenshotClient::getPixels() const'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ScreenshotClient::getWidth() const'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ScreenshotClient::getHeight() const'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ScreenshotClient::getStride() const'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ScreenshotClient::getFormat() const'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ScreenshotClient::getSize() const'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::bytesPerPixel(int)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'SkImageEncoder::EncodeData(SkImageInfo const&amp;, void const*, unsigned int, SkImageEncoder::Type, int)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::bytesPerPixel(int)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ScreenshotClient::~ScreenshotClient()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ScreenshotClient::~ScreenshotClient()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'stderr'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'stderr'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'stderr'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> usage(char const*): error: undefined reference to <span class="hljs-string">'stderr'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> notifyMediaScanner(char const*): error: undefined reference to <span class="hljs-string">'android::String8::String8(char const*)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> notifyMediaScanner(char const*): error: undefined reference to <span class="hljs-string">'android::String8::String8(char const*)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> notifyMediaScanner(char const*): error: undefined reference to <span class="hljs-string">'android::String8::append(char const*)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> notifyMediaScanner(char const*): error: undefined reference to <span class="hljs-string">'android::String8::append(char const*)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> notifyMediaScanner(char const*): error: undefined reference to <span class="hljs-string">'android::String8::append(char const*)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> notifyMediaScanner(char const*): error: undefined reference to <span class="hljs-string">'android::String8::append(char const*)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> notifyMediaScanner(char const*): error: undefined reference to <span class="hljs-string">'android::String8::~String8()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> notifyMediaScanner(char const*): error: undefined reference to <span class="hljs-string">'android::String8::~String8()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> notifyMediaScanner(char const*): error: undefined reference to <span class="hljs-string">'android::String8::~String8()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> notifyMediaScanner(char const*): error: undefined reference to <span class="hljs-string">'android::String8::~String8()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o(.ARM.extab+0x0): error: undefined reference to <span class="hljs-string">'__gxx_personality_v0'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o(.ARM.extab+0x48): error: undefined reference to <span class="hljs-string">'__gxx_personality_v0'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> android::sp&lt;android::ProcessState&gt;::~sp(): error: undefined reference to <span class="hljs-string">'android::RefBase::decStrong(void const*) const'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o(.ARM.extab.text._ZN7android2spINS_12ProcessStateEED2Ev+0x0): error: undefined reference to <span class="hljs-string">'__gxx_personality_v0'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> android::Vector&lt;android::DisplayInfo&gt;::Vector(): error: undefined reference to <span class="hljs-string">'android::VectorImpl::VectorImpl(unsigned int, unsigned int)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> android::Vector&lt;android::DisplayInfo&gt;::operator[](unsigned int) const: error: undefined reference to <span class="hljs-string">'__android_log_assert'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o(.ARM.extab.text._ZN12SkAutoTUnrefI6SkDataED2Ev+0x0): error: undefined reference to <span class="hljs-string">'__gxx_personality_v0'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> android::Vector&lt;android::DisplayInfo&gt;::~Vector(): error: undefined reference to <span class="hljs-string">'android::VectorImpl::finish_vector()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> android::Vector&lt;android::DisplayInfo&gt;::~Vector(): error: undefined reference to <span class="hljs-string">'android::VectorImpl::~VectorImpl()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> android::Vector&lt;android::DisplayInfo&gt;::~Vector(): error: undefined reference to <span class="hljs-string">'android::VectorImpl::~VectorImpl()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> android::sp&lt;android::IBinder&gt;::~sp(): error: undefined reference to <span class="hljs-string">'android::RefBase::decStrong(void const*) const'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> __clang_call_terminate: error: undefined reference to <span class="hljs-string">'__cxa_begin_catch'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> __clang_call_terminate: error: undefined reference to <span class="hljs-string">'std::terminate()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> android::Vector&lt;android::DisplayInfo&gt;::~Vector(): error: undefined reference to <span class="hljs-string">'operator delete(void*)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> SkRefCntBase::unref() const: error: undefined reference to <span class="hljs-string">'SkDebugf(char const*, ...)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:typeinfo <span class="hljs-keyword">for</span> android::Vector&lt;android::DisplayInfo&gt;: error: undefined reference to <span class="hljs-string">'vtable for __cxxabiv1::__vmi_class_type_info'</span>
/Users/macbookair/Documents/<span class="hljs-built_in">test</span>/bin/../lib/gcc/arm-linux-androideabi/4.9.x/../../../../arm-linux-androideabi/bin/ld: the vtable symbol may be undefined because the class is missing its key <span class="hljs-keyword">function</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:typeinfo <span class="hljs-keyword">for</span> android::Vector&lt;android::DisplayInfo&gt;: error: undefined reference to <span class="hljs-string">'typeinfo for android::VectorImpl'</span>
clang70: error: linker <span class="hljs-built_in">command</span> failed with <span class="hljs-built_in">exit</span> code 1 (use -v to see invocation)
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç§ã«ã¨ã£ã¦ã€ãã‚Œã¯æœ¬å½“ã®åœ°ç„ã§ã—ãŸã€ãªãœãªã‚‰ </font><font style="vertical-align: inherit;">å¤šãã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Šã¾ã—ãŸãŒã€ã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã¯å¤‰æ›´ã•ã‚Œãªã‹ã£ãŸãŸã‚ã€ç†è«–çš„ã«ã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">ã“ã®æ®µéšã§ç§ã¯é•·ã„é–“è…°ã‚’ä¸‹ã‚ã—ã€ç©æ¥µçš„ã«ã‚°ãƒ¼ã‚°ãƒ«ã‚¨ãƒ©ãƒ¼ã‚’å§‹ã‚ã¾ã—ãŸãŒã€å¿…è¦ãªç­”ãˆã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã§ã—ãŸã€‚</font><font style="vertical-align: inherit;">è¦šãˆã¦ã„ãªã„clangãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’å­¦ã¶ã“ã¨ã«ã—ãŸã®ã§ã™ãŒã€ã“ã®è§£æ±ºç­–ã¯ç§ã‚’æ•‘ã„ã¾ã—ãŸï¼</font><font style="vertical-align: inherit;">çµå±€ã®ã¨ã“ã‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã€clangã«ã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ï¼ˆã¾ãŸã¯</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ld</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰--unresolved-symbolsãŒã‚ã‚Šã€ã“ã‚ŒãŒæœªè§£æ±ºã®æ–‡å­—ã®å‡¦ç†ã‚’æ‹…å½“ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã¾ã£ãŸãã®é–“é•ã„ã§ã€ã“ã‚ŒãŒäº‹å®Ÿã§ã‚ã‚‹ã¨ã¯è¨€ãˆã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ ã—ã¦ã€å†åº¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">~/arm/bin/clang -pie screencap.cpp  -o ./screencap -Wl,--unresolved-symbols=ignore-all -s</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€å¾Œã«ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã¯æˆåŠŸã—ã¾ã—ãŸï¼</font><font style="vertical-align: inherit;">å®Ÿéš›ã€å•é¡Œã®ã»ã¨ã‚“ã©ã¯ãªããªã£ãŸã¨ã™ã§ã«æ€ã£ã¦ã„ã¾ã—ãŸãŒã€ãã“ã«ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</font><font style="vertical-align: inherit;">æ¬¡ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œå§‹ã‚ã¾ã—ãŸã€‚</font></font><br>
<br>
<pre><code class="bash hljs">CANNOT LINK EXECUTABLE: cannot locate symbol <span class="hljs-string">"_ZN7android12ProcessState4selfEv"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
çµå±€ã®ã¨ã“ã‚ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã«ã¯è¿½åŠ ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒååˆ†ã‚ã‚Šã¾ã—ãŸãŒã€Androidãƒ‡ãƒã‚¤ã‚¹ã§ã¯ã€ã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã™ã¹ã¦.soãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">å¾Œã§ã“ã®å•é¡Œã«ã¤ã„ã¦å¤šã‹ã‚Œå°‘ãªã‹ã‚Œã†ã¾ãè§£æã—ãŸã®ã§ã€å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã‚’è¦‹ã¤ã‘ã‚‹æ¯”è¼ƒçš„ç°¡å˜ãªæ–¹æ³•ã‚’è¦‹ã¤ã‘ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã‚’è¡Œã†ã«ã¯ã€Androidãƒ‡ãƒã‚¤ã‚¹ï¼ˆ/ system / bin / screencapï¼‰ã«ã‚ã‚‹ãƒã‚¤ãƒŠãƒªscreencapãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã§é–‹ãã€ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹.soãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã®åå‰ã‚’ã™ã¹ã¦ç¢ºèªã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ç§ã®å ´åˆã€ã“ã®éƒ¨åˆ†ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®åå‰ãŒä»˜ã„ãŸãƒ‘ãƒ¼ãƒ„</font></font></b><div class="spoiler_text"><pre><code class="bash hljs">...libdl.so__libc_initlibc.so__cxa_atexit__register_atfork__gnu_Unwind_Find_exidxLIBC_PRIVATE_ZNK7android6VectorINS_11DisplayInfoEE12do_constructEPvj__snprintf_chk__aeabi_memset__aeabi_memcpy_ZNK7android6VectorINS_11DisplayInfoEE10do_destroyEPvj_ZNK7android6VectorINS_11DisplayInfoEE7do_copyEPvPKvj_ZNK7android6VectorINS_11DisplayInfoEE8do_splatEPvPKvj_ZNK7android6VectorINS_11DisplayInfoEE15do_move_forwardEPvPKvj_ZNK7android6VectorINS_11DisplayInfoEE16do_move_backwardEPvPKvj_ZN7android10VectorImpl13finish_vectorEv_ZN7android10VectorImplD2Ev_ZTVN7android6VectorINS_11DisplayInfoEEE_ZdlPvsignal__android_log_print_ZN7android12ProcessState4selfEv_ZN7android12ProcessState15startThreadPoolEv_ZNK7android7RefBase9decStrongEPKvgetoptatoidupopen__errnostrerrorfprintfstrlenstrcmp_ZN7android16ScreenshotClientC1Ev_ZN7android21SurfaceComposerClient17getBuiltInDisplayEi_ZN7android10VectorImplC2Ejj_ZN7android21SurfaceComposerClient17getDisplayConfigsERKNS_2spINS_7IBinderEEEPNS_6VectorINS_11DisplayInfoEEE_ZN7android21SurfaceComposerClient15getActiveConfigERKNS_2spINS_7IBinderEEE_ZN7android16ScreenshotClient6updateERKNS_2spINS_7IBinderEEENS_4RectEjjjjbj_ZNK7android16ScreenshotClient9getPixelsEv_ZNK7android16ScreenshotClient8getWidthEv_ZNK7android16ScreenshotClient9getHeightEv_ZNK7android16ScreenshotClient9getStrideEv_ZNK7android16ScreenshotClient9getFormatEv_ZNK7android16ScreenshotClient7getSizeEvioctlclose_ZN7android13bytesPerPixelEi_ZN14SkImageEncoder10EncodeDataERK11SkImageInfoPKvjNS_4TypeEiwrite_ZN7android7String8C1EPKc_ZN7android7String86appendEPKcsystemfputs_ZN7android7String8D1Evmunmap_ZN7android16ScreenshotClientD1Evmmapoptargstderroptindabort_edata__bss_start_endlibcutils.solibutils.solibbinder.solibskia.solibui.solibgui.solibc++.solibm.so...
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®éƒ¨åˆ†ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ã¨æ¯”è¼ƒã—ã¦ã€ä¸è¶³ã—ã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®å ´åˆã€ãã‚Œã‚‰ã¯libgui.soã€libui.soã€libcutils.soã€libutils.soã€libbinder.soã€libskia.soã§ã‚ã‚‹ã“ã¨ãŒåˆ¤æ˜ã—ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ç§ãŸã¡ã¯å½¼ã‚‰ã®å ´æ‰€ã‚’æ¢ã—ã¦ã„ã¾ã™ï¼ˆå®Ÿéš›ã€å½¼ã‚‰ã¯åŒã˜å ´æ‰€ã«ã„ã¾ã™ï¼‰ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">find -name <span class="hljs-string">'libskia.so'</span> 2&gt;/dev/null<font></font>
/system/lib/libskia.so<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã™ã¹ã¦ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’sdcard / libsã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ï¼ˆlibskia.soã®ä¾‹ï¼‰ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">./system/lib/libskia.so /sdcard/
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
adb pullã‚’ä½¿ç”¨ã—ã¦ã€mobã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‹ã‚‰ãƒ‡ãƒã‚¤ã‚¹ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">adb pull /sdcard/libs ~/arm
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã‚Œã‚‰ã‚’å¿…è¦ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã—ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¾ã™ãŒã€æ–°ã—ã„* .soãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã€ã‚¢ã‚»ãƒ³ãƒ–ãƒ«æ™‚ã«ã™ã¹ã¦ã®.soãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã‚’åŒã˜æ–¹æ³•ã§ä½¿ç”¨ã™ã‚‹ã‹ã€ãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒªãƒ³ã‚¯ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã“ã¨ã‚’ç¤ºã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">~/arm/bin/clang -pie screencap.cpp *.so -o ./screencap -Wl,--unresolved-symbols=ignore-all -s
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãŒæˆåŠŸã—ã€mobã§ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ãŒèµ·å‹•ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ‡ãƒã‚¤ã‚¹ã«ã¯ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çµè«–ã¨çµæœ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãŠæ°—ã¥ãã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ã€Œä»–ã®èª°ã‹ã®ã‚³ãƒ¼ãƒ‰ã«ã€æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã¯ã€ãã‚Œã»ã©å˜ç´”ãªä½œæ¥­ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¤‰æ›´ã•ã‚ŒãŸscreencapãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ¼ãƒ‰ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãã®çµ„ã¿ç«‹ã¦ã¯ã‚ªãƒªã‚¸ãƒŠãƒ«ã¨åŒã˜æ–¹æ³•ã§è¡Œã‚ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">è¿½åŠ ã•ã‚ŒãŸå¤‰æ›´ã¯ã»ã¨ã‚“ã©ã®èª­è€…ã«ç†è§£ã§ãã‚‹ã¨æ€ã†ã®ã§ã€ã‚³ãƒ¡ãƒ³ãƒˆã—ãªã„ã“ã¨ã«ã—ã¾ã—ãŸã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">screencap.cppã®æ”¹å–„</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;errno.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fcntl.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;linux/fb.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/ioctl.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/mman.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;binder/ProcessState.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;gui/SurfaceComposerClient.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;gui/ISurfaceComposer.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ui/DisplayInfo.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ui/PixelFormat.h&gt;</span></span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Fix Skia.</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> GCC diagnostic push</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> GCC diagnostic ignored <span class="hljs-meta-string">"-Wunused-parameter"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SkImageEncoder.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SkData.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> GCC diagnostic pop</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> android;
<span class="hljs-keyword">static</span> <span class="hljs-keyword">uint32_t</span> DEFAULT_DISPLAY_ID = ISurfaceComposer::eDisplayIdMain;
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">usage</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* pname)</span>
</span>{
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>,
            <span class="hljs-string">"usage: %s [-hpcr] [-d display-id] [FILENAME] [x1 y1] [x2 y2]\n"</span>
            <span class="hljs-string">"   -h: this message\n"</span>
            <span class="hljs-string">"   -p: save the file as a png.\n"</span>
            <span class="hljs-string">"   -d: specify the display id to capture, default %d.\n"</span>
            <span class="hljs-string">"   -c: print pixel color [x y].\n"</span>
            <span class="hljs-string">"   -r: get rectangle area [x1 - left y1 - top x2 - right y2 - bottom].\n"</span>
            <span class="hljs-string">"If FILENAME ends with .png it will be saved as a png.\n"</span>
            <span class="hljs-string">"If FILENAME is not given, the results will be printed to stdout.\n"</span>,<font></font>
            pname, DEFAULT_DISPLAY_ID<font></font>
    );<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> SkColorType <span class="hljs-title">flinger2skia</span><span class="hljs-params">(PixelFormat f)</span>
</span>{
    <span class="hljs-keyword">switch</span> (f) {
        <span class="hljs-keyword">case</span> PIXEL_FORMAT_RGB_565:
            <span class="hljs-keyword">return</span> kRGB_565_SkColorType;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">return</span> kN32_SkColorType;<font></font>
    }<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">status_t</span> <span class="hljs-title">vinfoToPixelFormat</span><span class="hljs-params">(<span class="hljs-keyword">const</span> fb_var_screeninfo&amp; vinfo,
        <span class="hljs-keyword">uint32_t</span>* bytespp, <span class="hljs-keyword">uint32_t</span>* f)</span>
</span>{
    <span class="hljs-keyword">switch</span> (vinfo.bits_per_pixel) {
        <span class="hljs-keyword">case</span> <span class="hljs-number">16</span>:<font></font>
            *f = PIXEL_FORMAT_RGB_565;<font></font>
            *bytespp = <span class="hljs-number">2</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">24</span>:<font></font>
            *f = PIXEL_FORMAT_RGB_888;<font></font>
            *bytespp = <span class="hljs-number">3</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">32</span>:
            <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> do better decoding of vinfo here</span><font></font>
            *f = PIXEL_FORMAT_RGBX_8888;<font></font>
            *bytespp = <span class="hljs-number">4</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">return</span> BAD_VALUE;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> NO_ERROR;<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">status_t</span> <span class="hljs-title">notifyMediaScanner</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* fileName)</span> </span>{
    <span class="hljs-function">String8 <span class="hljs-title">cmd</span><span class="hljs-params">(<span class="hljs-string">"am broadcast -a android.intent.action.MEDIA_SCANNER_SCAN_FILE -d file://"</span>)</span></span>;
    <span class="hljs-function">String8 <span class="hljs-title">fileUrl</span><span class="hljs-params">(<span class="hljs-string">"\""</span>)</span></span>;<font></font>
    fileUrl.append(fileName);<font></font>
    fileUrl.append(<span class="hljs-string">"\""</span>);<font></font>
    cmd.append(fileName);<font></font>
    cmd.append(<span class="hljs-string">" &gt; /dev/null"</span>);
    <span class="hljs-keyword">int</span> result = system(cmd.<span class="hljs-built_in">string</span>());
    <span class="hljs-keyword">if</span> (result &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unable to broadcast intent for media scanner.\n"</span>);
        <span class="hljs-keyword">return</span> UNKNOWN_ERROR;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> NO_ERROR;<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span>
</span>{<font></font>
    ProcessState::self()-&gt;startThreadPool();<font></font>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* pname = argv[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">int</span> x1,x2,y1,y2;
    <span class="hljs-keyword">bool</span> png = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">bool</span> color = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">bool</span> rectangle = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">int32_t</span> displayId = DEFAULT_DISPLAY_ID;
    <span class="hljs-keyword">int</span> c;
    <span class="hljs-keyword">while</span> ((c = getopt(argc, argv, <span class="hljs-string">"phdcr:"</span>)) != <span class="hljs-number">-1</span>) {
        <span class="hljs-keyword">switch</span> (c) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'p'</span>:<font></font>
                png = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'d'</span>:<font></font>
                displayId = atoi(optarg);<font></font>
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'c'</span>:<font></font>
                color = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'r'</span>:<font></font>
                rectangle = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'?'</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-string">'h'</span>:<font></font>
                usage(pname);<font></font>
                <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
        }<font></font>
    }<font></font>
<font></font>
    argc -= optind;<font></font>
    <font></font>
    <span class="hljs-keyword">if</span> (color) {<font></font>
        x1 = atoi(argv[<span class="hljs-number">2</span>])<span class="hljs-number">-1</span>;<font></font>
        y1 = atoi(argv[<span class="hljs-number">3</span>])<span class="hljs-number">-1</span>;<font></font>
        x2 = atoi(argv[<span class="hljs-number">2</span>]);<font></font>
        y2 = atoi(argv[<span class="hljs-number">3</span>]);<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rectangle) {<font></font>
        x1 = atoi(argv[<span class="hljs-number">3</span>]);<font></font>
        y1 = atoi(argv[<span class="hljs-number">4</span>]);<font></font>
        x2 = atoi(argv[<span class="hljs-number">5</span>]);<font></font>
        y2 = atoi(argv[<span class="hljs-number">6</span>]);<font></font>
        optind--;<font></font>
    }<font></font>
<font></font>
    <font></font>
    argv += optind;<font></font>
<font></font>
    <span class="hljs-keyword">int</span> fd = <span class="hljs-number">-1</span>;
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* fn = <span class="hljs-literal">NULL</span>;
    <span class="hljs-keyword">if</span> (argc == <span class="hljs-number">0</span>) {<font></font>
        fd = dup(STDOUT_FILENO);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (argc == <span class="hljs-number">1</span> || argc == <span class="hljs-number">4</span>) {<font></font>
        fn = argv[<span class="hljs-number">0</span>];<font></font>
        fd = open(fn, O_WRONLY | O_CREAT | O_TRUNC, <span class="hljs-number">0664</span>);
        <span class="hljs-keyword">if</span> (fd == <span class="hljs-number">-1</span>) {
            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Error opening file: %s (%s)\n"</span>, fn, strerror(errno));
            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
        }<font></font>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> len = <span class="hljs-built_in">strlen</span>(fn);
        <span class="hljs-keyword">if</span> (len &gt;= <span class="hljs-number">4</span> &amp;&amp; <span class="hljs-number">0</span> == <span class="hljs-built_in">strcmp</span>(fn+len<span class="hljs-number">-4</span>, <span class="hljs-string">".png"</span>)) {<font></font>
            png = <span class="hljs-literal">true</span>;<font></font>
        }<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">if</span> (fd == <span class="hljs-number">-1</span> &amp;&amp; !color &amp;&amp; !rectangle) {<font></font>
        usage(pname);<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
    }<font></font>
    <font></font>
    <font></font>
    <span class="hljs-keyword">void</span> <span class="hljs-keyword">const</span>* mapbase = MAP_FAILED;
    <span class="hljs-keyword">ssize_t</span> mapsize = <span class="hljs-number">-1</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-keyword">const</span>* base = <span class="hljs-literal">NULL</span>;
    <span class="hljs-keyword">uint32_t</span> w, s, h, f;
    <span class="hljs-keyword">size_t</span> size = <span class="hljs-number">0</span>;
    <span class="hljs-comment">// Maps orientations from DisplayInfo to ISurfaceComposer</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">uint32_t</span> ORIENTATION_MAP[] = {<font></font>
        ISurfaceComposer::eRotateNone, <span class="hljs-comment">// 0 == DISPLAY_ORIENTATION_0</span>
        ISurfaceComposer::eRotate270, <span class="hljs-comment">// 1 == DISPLAY_ORIENTATION_90</span>
        ISurfaceComposer::eRotate180, <span class="hljs-comment">// 2 == DISPLAY_ORIENTATION_180</span>
        ISurfaceComposer::eRotate90, <span class="hljs-comment">// 3 == DISPLAY_ORIENTATION_270</span><font></font>
    };<font></font>
    ScreenshotClient screenshot;<font></font>
    sp&lt;IBinder&gt; display = SurfaceComposerClient::getBuiltInDisplay(displayId);<font></font>
    <span class="hljs-keyword">if</span> (display == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unable to get handle for display %d\n"</span>, displayId);
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
    }<font></font>
    Vector&lt;DisplayInfo&gt; configs;<font></font>
    SurfaceComposerClient::getDisplayConfigs(display, &amp;configs);<font></font>
    <span class="hljs-keyword">int</span> activeConfig = SurfaceComposerClient::getActiveConfig(display);
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">size_t</span>&gt;(activeConfig) &gt;= configs.size()) {
        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Active config %d not inside configs (size %zu)\n"</span>,<font></font>
                activeConfig, configs.size());<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">uint8_t</span> displayOrientation = configs[activeConfig].orientation;
    <span class="hljs-keyword">uint32_t</span> captureOrientation = ORIENTATION_MAP[displayOrientation];
    <span class="hljs-keyword">status_t</span> result;
    <span class="hljs-keyword">if</span> (color || rectangle) {<font></font>
        result = screenshot.update(display, Rect(x1,y1,x2,y2), x2-x1, y2-y1, <span class="hljs-number">0</span>, <span class="hljs-number">-1U</span>,
            <span class="hljs-literal">false</span>, captureOrientation);<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> {<font></font>
        result = screenshot.update(display, Rect(), <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-1U</span>,
            <span class="hljs-literal">false</span>, captureOrientation);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (result == NO_ERROR) {<font></font>
        base = screenshot.getPixels();<font></font>
        w = screenshot.getWidth();<font></font>
        h = screenshot.getHeight();<font></font>
        s = screenshot.getStride();<font></font>
        f = screenshot.getFormat();<font></font>
        size = screenshot.getSize();<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (color) {
            <span class="hljs-keyword">size_t</span> Bpp = <span class="hljs-number">4</span>; <span class="hljs-comment">//bytesPerPixel</span>
            <span class="hljs-keyword">char</span>* rawImageData;<font></font>
            rawImageData = (<span class="hljs-keyword">char</span> *)base;<font></font>
            base = (<span class="hljs-keyword">void</span> *)((<span class="hljs-keyword">char</span> *)base + Bpp);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-keyword">sizeof</span>(rawImageData); i++) {
                <span class="hljs-built_in">printf</span>( <span class="hljs-string">"%02X"</span>, rawImageData[i]);<font></font>
            }<font></font>
            <font></font>
            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
        }<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* fbpath = <span class="hljs-string">"/dev/graphics/fb0"</span>;
        <span class="hljs-keyword">int</span> fb = open(fbpath, O_RDONLY);
        <span class="hljs-keyword">if</span> (fb &gt;= <span class="hljs-number">0</span>) {
            <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">fb_var_screeninfo</span> <span class="hljs-title">vinfo</span>;</span>
            <span class="hljs-keyword">if</span> (ioctl(fb, FBIOGET_VSCREENINFO, &amp;vinfo) == <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">uint32_t</span> bytespp;
                <span class="hljs-keyword">if</span> (vinfoToPixelFormat(vinfo, &amp;bytespp, &amp;f) == NO_ERROR) {
                    <span class="hljs-keyword">size_t</span> offset = (vinfo.xoffset + vinfo.yoffset*vinfo.xres) * bytespp;<font></font>
                    w = vinfo.xres;<font></font>
                    h = vinfo.yres;<font></font>
                    s = vinfo.xres;<font></font>
                    size = w*h*bytespp;<font></font>
                    mapsize = offset + size;<font></font>
                    mapbase = mmap(<span class="hljs-number">0</span>, mapsize, PROT_READ, MAP_PRIVATE, fb, <span class="hljs-number">0</span>);
                    <span class="hljs-keyword">if</span> (mapbase != MAP_FAILED) {<font></font>
                        base = (<span class="hljs-keyword">void</span> <span class="hljs-keyword">const</span> *)((<span class="hljs-keyword">char</span> <span class="hljs-keyword">const</span> *)mapbase + offset);<font></font>
                    }<font></font>
                }<font></font>
            }<font></font>
            close(fb);<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (base != <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">if</span> (png) {
            <span class="hljs-keyword">const</span> SkImageInfo info = SkImageInfo::Make(w, h, flinger2skia(f), kPremul_SkAlphaType);
            <span class="hljs-function">SkAutoTUnref&lt;SkData&gt; <span class="hljs-title">data</span><span class="hljs-params">(SkImageEncoder::EncodeData(info, base, s*bytesPerPixel(f),
                    SkImageEncoder::kPNG_Type, SkImageEncoder::kDefaultQuality))</span></span>;
            <span class="hljs-keyword">if</span> (data.get()) {<font></font>
                write(fd, data-&gt;data(), data-&gt;size());<font></font>
            }<font></font>
            <span class="hljs-keyword">if</span> (fn != <span class="hljs-literal">NULL</span>) {<font></font>
                notifyMediaScanner(fn);<font></font>
            }<font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
            write(fd, &amp;w, <span class="hljs-number">4</span>);<font></font>
            write(fd, &amp;h, <span class="hljs-number">4</span>);<font></font>
            write(fd, &amp;f, <span class="hljs-number">4</span>);
            <span class="hljs-keyword">size_t</span> Bpp = bytesPerPixel(f);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> y=<span class="hljs-number">0</span> ; y&lt;h ; y++) {<font></font>
                write(fd, base, w*Bpp);<font></font>
                base = (<span class="hljs-keyword">void</span> *)((<span class="hljs-keyword">char</span> *)base + s*Bpp);<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
    close(fd);<font></font>
    <span class="hljs-keyword">if</span> (mapbase != MAP_FAILED) {<font></font>
        munmap((<span class="hljs-keyword">void</span> *)mapbase, mapsize);<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ”ã‚¯ã‚»ãƒ«ã®è‰²ã‚’å–å¾—ã™ã‚‹ä¾‹ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">./screencap -c 100 100</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç‰¹å®šã®é ˜åŸŸã®ç”»åƒã‚’å–å¾—ã™ã‚‹ä¾‹ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">./screencap -r /sdcard/test.png 0 0 720 640</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã«</font><font style="vertical-align: inherit;">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ã¦ã„ã‚‹</font></a><font style="vertical-align: inherit;">ã®ã§ã€èˆˆå‘³ã®ã‚ã‚‹æ–¹ã¯å¤§æ­“è¿ã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PSå®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«ã«å¿…è¦ãªã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¾ãŸã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã«å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¦‹ã¤ã‘ã‚‹æœ€è‰¯ã®æ–¹æ³•ãŒã‚ã‹ã£ã¦ã„ã‚‹å ´åˆã¯ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚è¨˜äº‹ã«ã“ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’è¿½åŠ ã—ã¾ã™ã€‚</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja456250/index.html">ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ­ãƒ¼ã‚«ãƒªã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã¨RTLã®ã‚µãƒãƒ¼ãƒˆã€‚Yandex.Taxiã‚’å ±å‘Šã™ã‚‹</a></li>
<li><a href="../ja456256/index.html">Androidã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚¬ã‚¤ãƒ‰</a></li>
<li><a href="../ja456258/index.html">GNU FDL 1.3ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã«åŸºã¥ãã€ŒFree as in Freedomã€ã®ãƒ­ã‚·ã‚¢èªã¸ã®ç¿»è¨³ã¯é¢¨ã®ã‚ˆã†ã«ç„¡æ–™ã€ãƒ“ãƒ¼ãƒ«ã®ã‚ˆã†ã«ç„¡æ–™</a></li>
<li><a href="../ja456260/index.html">ãƒ•ã‚§ã‚¢ã‚¨ã‚³ãƒãƒŸãƒ¼ãƒˆãƒ¼ã‚¯</a></li>
<li><a href="../ja456262/index.html">ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ç„¡ç·š-ãã‚Œã¯ã©ã®ã‚ˆã†ã«æ©Ÿèƒ½ã—ã¾ã™ã‹ï¼Ÿãƒ‘ãƒ¼ãƒˆ9</a></li>
<li><a href="../ja456266/index.html">ãƒ¢ãƒã‚¤ãƒ«ï¼ƒ302é–‹ç™ºè€…å‘ã‘ã®èˆˆå‘³æ·±ã„è³‡æ–™ã®ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆï¼ˆ6æœˆ10ã€œ16æ—¥ï¼‰</a></li>
<li><a href="../ja456270/index.html">Redisã‚¹ãƒˆãƒªãƒ¼ãƒ -ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã®ä¿¡é ¼æ€§ã¨ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£</a></li>
<li><a href="../ja456272/index.html">Android Lintã¨ã¯ä½•ã§ã™ã‹ï¼Ÿã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã®è¨˜è¿°ã«ã©ã®ã‚ˆã†ã«å½¹ç«‹ã¡ã¾ã™ã‹ï¼Ÿ</a></li>
<li><a href="../ja456274/index.html">å¿ƒç†å­¦è€…ï¼šã‚»ãƒƒã‚¯ã‚¹ãƒ­ãƒœãƒƒãƒˆã¯ã€ä»–ã®äººã€…ã¨ã®é–¢ä¿‚ã‚’å¿…è¦ã¨ã—ãªã„ã‚«ãƒƒãƒ—ãƒ«ãŒã„ãªã„å ´åˆã€äººã€…ã®æ•°ã®å¢—åŠ ã«ã¤ãªãŒã‚Šã¾ã™</a></li>
<li><a href="../ja456276/index.html">æƒ…å ±ã¨ã¯ï¼Ÿ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>