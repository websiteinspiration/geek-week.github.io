<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💅🏿 🏮 🈷️ ソースとAndroid NDKを使用してAndroidバイナリファイルをビルドします。screencapユーティリティを起動します 💡 ㊙️ 🖕🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="私はAndroidデバイスの自動化に従事しており、SDKまたはAndroid OSに必要な機能がないか、その動作が遅いまたは非常に遅いことがよくあります。
 
 Native Development Kit（NDK）の機能を使用して、Javaの同じ機能よりも高速に実行される機能を作成できます。このク...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ソースとAndroid NDKを使用してAndroidバイナリファイルをビルドします。screencapユーティリティを起動します</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456264/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私はAndroidデバイスの自動化に従事しており、SDKまたはAndroid OSに必要な機能がないか、その動作が遅いまたは非常に遅いことがよくあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Native Development Kit（NDK）の機能を使用して、Javaの同じ機能よりも高速に実行される機能を作成できます。このクジラが原因で、C / C ++で記述されたコードをアプリケーションに追加したり、Androidモバイルデバイス用の独自のバイナリファイルを作成したりできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、Android OSのバイナリファイルのコンパイルを構成する方法と、このOSの既存のバイナリファイルの機能を補完するプロセスを示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、画面全体のスクリーンショットを取得したり、「生データ」を提供したりするだけでなく、指定したポイントのピクセルカラーを返したり、目的の領域のみの画像を取得したりすることができます。</font><font style="vertical-align: inherit;">じゃ、行こう！</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NDKをインストールする</font></font></h3><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android NDK</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">
ダウンロードし</font><font style="vertical-align: inherit;">てアーカイブを解凍するか、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDK Managerを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介してインストールし</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まだ追加していない場合は、追加できます。</font><font style="vertical-align: inherit;">ツール：</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt-get install android-tools-adb android-tools-fastboot</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、モバイルデバイスのアーキテクチャ用の「プロジェクト」を作成します。</font></font><br>
<br>
<pre><code class="bash hljs"> ./android-ndk-r12b/build/tools/make_standalone_toolchain.py --arch &lt;arm or arm64 or other&gt; --install-dir ~/arm</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私のHOMTOM HT16はarmeabi-v7aアーキテクチャーであるため、次のコマンドを使用します。</font></font><br>
<br>
<pre><code class="bash hljs"> ./android-ndk-r12b/build/tools/make_standalone_toolchain.py --arch arm --install-dir ~/arm</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、スクリプトが必要なすべてのファイルを作成するまで待機します（約5分程度）。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パフォーマンスチェック</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
簡単なコードでhello_world.cファイルを作成します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> <span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"hello world"</span>);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてそれをコンパイルしてみてください：</font></font><br>
<br>
<pre><code class="bash hljs">~/arm/bin/clang -pie hello_world.c -o hello_world</code></pre><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
属性を使用し</font><font style="vertical-align: inherit;">てファイル名を指定し、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-pieスイッチ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用し</font><font style="vertical-align: inherit;">て、PIEバイナリファイルとそのすべての依存関係が、アプリケーションが実行されるたびに仮想メモリ内のランダムな場所に読み込まれることを示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンパイルが成功した場合は、ファイルを電話にアップロードします。</font></font><br>
<br>
<pre><code class="bash hljs">adb push ./hello_world /data/<span class="hljs-built_in">local</span>/tmp</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、バイナリを試してください：</font></font><br>
<br>
<pre><code class="bash hljs">adb shell<font></font>
/data/<span class="hljs-built_in">local</span>/tmp/hello_world</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「hello world」というフレーズの出力を見た場合、あなたはすべてを正しく行いました！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでもエラーが発生する場合は、おそらく間違ったアーキテクチャを選択している可能性があります。このディレクトリを削除して、正しいディレクトリで再作成してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アーキテクチャを決定するには、次のコマンドを実行できます</font></font><br>
<br>
<pre><code class="bash hljs">adb shell cat /proc/cpuinfo</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソースとライブラリ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンパイルされたバイナリファイルの分析は非常に時間がかかり、Androidはオープンシステムであるため、この品質を活用してみてください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここに行っ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">て</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Androidの正しいバージョンを探します。</font><font style="vertical-align: inherit;">さて、すでに-アーカイブをダウンロードして、バイナリファイルの目的のソースを探してください。</font><font style="vertical-align: inherit;">もちろん、オプションもあります-グーグルと「正しい要求」。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の場合、必要なファイルは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このリンクにあり</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">screencap.cpp</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs">
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;errno.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fcntl.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;linux/fb.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/ioctl.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/mman.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;binder/ProcessState.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;gui/SurfaceComposerClient.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;gui/ISurfaceComposer.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ui/DisplayInfo.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ui/PixelFormat.h&gt;</span></span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Fix Skia.</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> GCC diagnostic push</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> GCC diagnostic ignored <span class="hljs-meta-string">"-Wunused-parameter"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SkImageEncoder.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SkData.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> GCC diagnostic pop</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> android;
<span class="hljs-keyword">static</span> <span class="hljs-keyword">uint32_t</span> DEFAULT_DISPLAY_ID = ISurfaceComposer::eDisplayIdMain;
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">usage</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* pname)</span>
</span>{
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>,
            <span class="hljs-string">"usage: %s [-hp] [-d display-id] [FILENAME]\n"</span>
            <span class="hljs-string">"   -h: this message\n"</span>
            <span class="hljs-string">"   -p: save the file as a png.\n"</span>
            <span class="hljs-string">"   -d: specify the display id to capture, default %d.\n"</span>
            <span class="hljs-string">"If FILENAME ends with .png it will be saved as a png.\n"</span>
            <span class="hljs-string">"If FILENAME is not given, the results will be printed to stdout.\n"</span>,<font></font>
            pname, DEFAULT_DISPLAY_ID<font></font>
    );<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> SkColorType <span class="hljs-title">flinger2skia</span><span class="hljs-params">(PixelFormat f)</span>
</span>{
    <span class="hljs-keyword">switch</span> (f) {
        <span class="hljs-keyword">case</span> PIXEL_FORMAT_RGB_565:
            <span class="hljs-keyword">return</span> kRGB_565_SkColorType;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">return</span> kN32_SkColorType;<font></font>
    }<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">status_t</span> <span class="hljs-title">vinfoToPixelFormat</span><span class="hljs-params">(<span class="hljs-keyword">const</span> fb_var_screeninfo&amp; vinfo,
        <span class="hljs-keyword">uint32_t</span>* bytespp, <span class="hljs-keyword">uint32_t</span>* f)</span>
</span>{
    <span class="hljs-keyword">switch</span> (vinfo.bits_per_pixel) {
        <span class="hljs-keyword">case</span> <span class="hljs-number">16</span>:<font></font>
            *f = PIXEL_FORMAT_RGB_565;<font></font>
            *bytespp = <span class="hljs-number">2</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">24</span>:<font></font>
            *f = PIXEL_FORMAT_RGB_888;<font></font>
            *bytespp = <span class="hljs-number">3</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">32</span>:
            <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> do better decoding of vinfo here</span><font></font>
            *f = PIXEL_FORMAT_RGBX_8888;<font></font>
            *bytespp = <span class="hljs-number">4</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">return</span> BAD_VALUE;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> NO_ERROR;<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">status_t</span> <span class="hljs-title">notifyMediaScanner</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* fileName)</span> </span>{
    <span class="hljs-function">String8 <span class="hljs-title">cmd</span><span class="hljs-params">(<span class="hljs-string">"am broadcast -a android.intent.action.MEDIA_SCANNER_SCAN_FILE -d file://"</span>)</span></span>;
    <span class="hljs-function">String8 <span class="hljs-title">fileUrl</span><span class="hljs-params">(<span class="hljs-string">"\""</span>)</span></span>;<font></font>
    fileUrl.append(fileName);<font></font>
    fileUrl.append(<span class="hljs-string">"\""</span>);<font></font>
    cmd.append(fileName);<font></font>
    cmd.append(<span class="hljs-string">" &gt; /dev/null"</span>);
    <span class="hljs-keyword">int</span> result = system(cmd.<span class="hljs-built_in">string</span>());
    <span class="hljs-keyword">if</span> (result &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unable to broadcast intent for media scanner.\n"</span>);
        <span class="hljs-keyword">return</span> UNKNOWN_ERROR;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> NO_ERROR;<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span>
</span>{<font></font>
    ProcessState::self()-&gt;startThreadPool();<font></font>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* pname = argv[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">bool</span> png = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">int32_t</span> displayId = DEFAULT_DISPLAY_ID;
    <span class="hljs-keyword">int</span> c;
    <span class="hljs-keyword">while</span> ((c = getopt(argc, argv, <span class="hljs-string">"phd:"</span>)) != <span class="hljs-number">-1</span>) {
        <span class="hljs-keyword">switch</span> (c) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'p'</span>:<font></font>
                png = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'d'</span>:<font></font>
                displayId = atoi(optarg);<font></font>
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'?'</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-string">'h'</span>:<font></font>
                usage(pname);<font></font>
                <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
        }<font></font>
    }<font></font>
    argc -= optind;<font></font>
    argv += optind;<font></font>
    <span class="hljs-keyword">int</span> fd = <span class="hljs-number">-1</span>;
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* fn = <span class="hljs-literal">NULL</span>;
    <span class="hljs-keyword">if</span> (argc == <span class="hljs-number">0</span>) {<font></font>
        fd = dup(STDOUT_FILENO);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (argc == <span class="hljs-number">1</span>) {<font></font>
        fn = argv[<span class="hljs-number">0</span>];<font></font>
        fd = open(fn, O_WRONLY | O_CREAT | O_TRUNC, <span class="hljs-number">0664</span>);
        <span class="hljs-keyword">if</span> (fd == <span class="hljs-number">-1</span>) {
            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Error opening file: %s (%s)\n"</span>, fn, strerror(errno));
            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
        }<font></font>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> len = <span class="hljs-built_in">strlen</span>(fn);
        <span class="hljs-keyword">if</span> (len &gt;= <span class="hljs-number">4</span> &amp;&amp; <span class="hljs-number">0</span> == <span class="hljs-built_in">strcmp</span>(fn+len<span class="hljs-number">-4</span>, <span class="hljs-string">".png"</span>)) {<font></font>
            png = <span class="hljs-literal">true</span>;<font></font>
        }<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">if</span> (fd == <span class="hljs-number">-1</span>) {<font></font>
        usage(pname);<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">void</span> <span class="hljs-keyword">const</span>* mapbase = MAP_FAILED;
    <span class="hljs-keyword">ssize_t</span> mapsize = <span class="hljs-number">-1</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-keyword">const</span>* base = <span class="hljs-literal">NULL</span>;
    <span class="hljs-keyword">uint32_t</span> w, s, h, f;
    <span class="hljs-keyword">size_t</span> size = <span class="hljs-number">0</span>;
    <span class="hljs-comment">// Maps orientations from DisplayInfo to ISurfaceComposer</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">uint32_t</span> ORIENTATION_MAP[] = {<font></font>
        ISurfaceComposer::eRotateNone, <span class="hljs-comment">// 0 == DISPLAY_ORIENTATION_0</span>
        ISurfaceComposer::eRotate270, <span class="hljs-comment">// 1 == DISPLAY_ORIENTATION_90</span>
        ISurfaceComposer::eRotate180, <span class="hljs-comment">// 2 == DISPLAY_ORIENTATION_180</span>
        ISurfaceComposer::eRotate90, <span class="hljs-comment">// 3 == DISPLAY_ORIENTATION_270</span><font></font>
    };<font></font>
    ScreenshotClient screenshot;<font></font>
    sp&lt;IBinder&gt; display = SurfaceComposerClient::getBuiltInDisplay(displayId);<font></font>
    <span class="hljs-keyword">if</span> (display == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unable to get handle for display %d\n"</span>, displayId);
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
    }<font></font>
    Vector&lt;DisplayInfo&gt; configs;<font></font>
    SurfaceComposerClient::getDisplayConfigs(display, &amp;configs);<font></font>
    <span class="hljs-keyword">int</span> activeConfig = SurfaceComposerClient::getActiveConfig(display);
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">size_t</span>&gt;(activeConfig) &gt;= configs.size()) {
        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Active config %d not inside configs (size %zu)\n"</span>,<font></font>
                activeConfig, configs.size());<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">uint8_t</span> displayOrientation = configs[activeConfig].orientation;
    <span class="hljs-keyword">uint32_t</span> captureOrientation = ORIENTATION_MAP[displayOrientation];
    <span class="hljs-keyword">status_t</span> result = screenshot.update(display, Rect(), <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-1U</span>,
            <span class="hljs-literal">false</span>, captureOrientation);
    <span class="hljs-keyword">if</span> (result == NO_ERROR) {<font></font>
        base = screenshot.getPixels();<font></font>
        w = screenshot.getWidth();<font></font>
        h = screenshot.getHeight();<font></font>
        s = screenshot.getStride();<font></font>
        f = screenshot.getFormat();<font></font>
        size = screenshot.getSize();<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* fbpath = <span class="hljs-string">"/dev/graphics/fb0"</span>;
        <span class="hljs-keyword">int</span> fb = open(fbpath, O_RDONLY);
        <span class="hljs-keyword">if</span> (fb &gt;= <span class="hljs-number">0</span>) {
            <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">fb_var_screeninfo</span> <span class="hljs-title">vinfo</span>;</span>
            <span class="hljs-keyword">if</span> (ioctl(fb, FBIOGET_VSCREENINFO, &amp;vinfo) == <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">uint32_t</span> bytespp;
                <span class="hljs-keyword">if</span> (vinfoToPixelFormat(vinfo, &amp;bytespp, &amp;f) == NO_ERROR) {
                    <span class="hljs-keyword">size_t</span> offset = (vinfo.xoffset + vinfo.yoffset*vinfo.xres) * bytespp;<font></font>
                    w = vinfo.xres;<font></font>
                    h = vinfo.yres;<font></font>
                    s = vinfo.xres;<font></font>
                    size = w*h*bytespp;<font></font>
                    mapsize = offset + size;<font></font>
                    mapbase = mmap(<span class="hljs-number">0</span>, mapsize, PROT_READ, MAP_PRIVATE, fb, <span class="hljs-number">0</span>);
                    <span class="hljs-keyword">if</span> (mapbase != MAP_FAILED) {<font></font>
                        base = (<span class="hljs-keyword">void</span> <span class="hljs-keyword">const</span> *)((<span class="hljs-keyword">char</span> <span class="hljs-keyword">const</span> *)mapbase + offset);<font></font>
                    }<font></font>
                }<font></font>
            }<font></font>
            close(fb);<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (base != <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">if</span> (png) {
            <span class="hljs-keyword">const</span> SkImageInfo info = SkImageInfo::Make(w, h, flinger2skia(f),<font></font>
                                                       kPremul_SkAlphaType);<font></font>
            <span class="hljs-function">SkAutoTUnref&lt;SkData&gt; <span class="hljs-title">data</span><span class="hljs-params">(SkImageEncoder::EncodeData(info, base, s*bytesPerPixel(f),
                    SkImageEncoder::kPNG_Type, SkImageEncoder::kDefaultQuality))</span></span>;
            <span class="hljs-keyword">if</span> (data.get()) {<font></font>
                write(fd, data-&gt;data(), data-&gt;size());<font></font>
            }<font></font>
            <span class="hljs-keyword">if</span> (fn != <span class="hljs-literal">NULL</span>) {<font></font>
                notifyMediaScanner(fn);<font></font>
            }<font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
            write(fd, &amp;w, <span class="hljs-number">4</span>);<font></font>
            write(fd, &amp;h, <span class="hljs-number">4</span>);<font></font>
            write(fd, &amp;f, <span class="hljs-number">4</span>);
            <span class="hljs-keyword">size_t</span> Bpp = bytesPerPixel(f);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> y=<span class="hljs-number">0</span> ; y&lt;h ; y++) {<font></font>
                write(fd, base, w*Bpp);<font></font>
                base = (<span class="hljs-keyword">void</span> *)((<span class="hljs-keyword">char</span> *)base + s*Bpp);<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
    close(fd);<font></font>
    <span class="hljs-keyword">if</span> (mapbase != MAP_FAILED) {<font></font>
        munmap((<span class="hljs-keyword">void</span> *)mapbase, mapsize);<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードを部分的に分析します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DEFAULT_DISPLAY_ID-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリーンショットを取得するディスプレイの識別子。今回の例では、</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0。flinger2skia</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vinfoToPixelFormat-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">画像の形式を決定します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">notifyMediaScanner-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルシステムでイメージが作成された後、ファイルを正しく表示できるようにブロードキャストを送信する必要があります。このブロードキャストを呼び出さない場合、作成されたファイルをすべてのアプリケーションが表示できるわけではありません。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
主な機能は「読み取り」が難しくないため、画像データの取得に直接関与する重要なポイントのみを分析します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ dev /グラフィック/ fb0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-これは、いわゆるフレームバッファです。</font><font style="vertical-align: inherit;">フレームバッファは、1つ以上のビデオフレームを短期的に保存するためのビデオメモリ領域です。</font><font style="vertical-align: inherit;">メインコードに基づいて、画面イメージをこのファイルに保存するAndroidデバイスのバージョンがあることがわかります。</font><font style="vertical-align: inherit;">したがって、「ラッキー」であれば、vinfo.xoffsetとvinfo.yoffsetを認識し（ほとんどの場合、これらは0になります）、コンソールを使用して簡単に色情報を取得できます。</font></font><br>
<br>
<pre><code class="bash hljs">dd <span class="hljs-keyword">if</span>=/dev/graphics/fb0 bs=&lt;bytes per pixel&gt; count=1 skip=&lt;pixel offset&gt; 2&gt;/dev/null | hd</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の場合、すべてがそれほど単純ではなく、このファイルには画像に関する情報が含まれていません。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">screenshot.update</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、イメージを取得する2番目の方法です。</font><font style="vertical-align: inherit;">この関数には、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あるオーバーロードされたメソッドがいくつかあり</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パラメータの数が最も多い関数の説明を考えてみます。</font></font><br>
<br>
<pre><code class="cpp hljs">ScreenshotClient::update(<span class="hljs-keyword">const</span> sp&lt;IBinder&gt;&amp; display,<font></font>
        Rect sourceCrop, <span class="hljs-keyword">uint32_t</span> reqWidth, <span class="hljs-keyword">uint32_t</span> reqHeight,
        <span class="hljs-keyword">uint32_t</span> minLayerZ, <span class="hljs-keyword">uint32_t</span> maxLayerZ,
        <span class="hljs-keyword">bool</span> useIdentityTransform, <span class="hljs-keyword">uint32_t</span> rotation)</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">display-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要なディスプレイへのリンク。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourceCrop-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">選択した画像領域のトリミング。左上と右下の座標を含めることができます（合計4つのパラメータxLeft、yTop、xRight、yBottom）。原点は左上隅です。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reqWidth</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -返された画像の幅</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reqHeight</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -返されたイメージの高さ</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minLayerZ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maxLayerZ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -これらのパラメータの作業を理解することができませんでしたか。値を列挙するとブラックタップが生成されることがある</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">useIdentityTransform</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -trueの場合、アプリケーションの上のオーバーレイレイヤーを無効にします。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACTION_MANAGE_OVERLAY_PERMISSION </font></font></a><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">ローテーション</font></b><font style="vertical-align: inherit;">を使用する</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">アクティビティ</font></a></font><br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-画像の回転。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、ピクセルの色を取得するには、xLeftとyTopを1だけシフトして設定する必要があります。</font><font style="vertical-align: inherit;">カウントダウンは0から始まり、指定した座標をxRight、yBottomに設定します。</font><font style="vertical-align: inherit;">reqWidthとreqHeightで値を1に設定します。この関数のパラメーターを変更することで、必要な領域の境界を決定できます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本的なscreencap.cppのコンパイル</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、これは最も難しい部分であり、数日または1週間かかる場合があります。残念ながら、ネットワーク上に新しいバージョンのscreencapを構築するための迅速な解決策が見つからなかったため、clangとそのパラメーターを使用して特に苦痛を強いられました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードをすぐにコンパイルしようとすると、コンパイラーはファイルがないことを常に断言し、ファイルがあることを報告することがありますが、コンストラクターは必要ありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、最初はNDKライブラリにないすべてのファイルを追加しました。エラーは、このファイルまたはそのファイルをどこに置くべきかを示します。これを行うには、不足しているファイルを追加する必要があり、sysrootが配置されている場所（clangが検索しているディレクトリ）を見つけるには、次の「機能」を使用できます。</font></font><br>
<br>
<pre><code class="cpp hljs">echo <span class="hljs-string">"#include &lt;bogus.h&gt; int main(){}"</span> &gt; t.c; ~/arm/bin/clang  -v t.c; rm t.c</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エラーには、このディレクトリへのパスが表示されます。</font><font style="vertical-align: inherit;">clangが別の場所にある場合は、パスを変更します。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ログ</font></font></b><div class="spoiler_text"><pre><code class="bash hljs">Android (4751641 based on r328903) clang version 7.0.2 (https://android.googlesource.com/toolchain/clang 003100370607242ddd5815e4a043907ea9004281) (https://android.googlesource.com/toolchain/llvm 1d739ffb0366421d383e04ff80ec2ee591315116) (based on LLVM 7.0.2svn)<font></font>
Target: armv7a-none-linux-android16<font></font>
Thread model: posix<font></font>
InstalledDir: /Users/macbookair/arm/bin<font></font>
Found candidate GCC installation: /Users/macbookair/arm/bin/../lib/gcc/arm-linux-androideabi/4.9.x<font></font>
Selected GCC installation: /Users/macbookair/arm/bin/../lib/gcc/arm-linux-androideabi/4.9.x<font></font>
Candidate multilib: thumb;@mthumb<font></font>
Candidate multilib: armv7<span class="hljs-_">-a</span>;@march=armv7<span class="hljs-_">-a</span>
Candidate multilib: armv7<span class="hljs-_">-a</span>/thumb;@march=armv7<span class="hljs-_">-a</span>@mthumb<font></font>
Candidate multilib: .;<font></font>
Selected multilib: armv7<span class="hljs-_">-a</span>;@march=armv7<span class="hljs-_">-a</span>
 <span class="hljs-string">"/Users/macbookair/arm/bin/clang70"</span> -cc1 -triple armv7-none-linux-android16 -emit-obj -mrelax-all -<span class="hljs-built_in">disable</span>-free -<span class="hljs-built_in">disable</span>-llvm-verifier -discard-value-names -main-file-name t.c -mrelocation-model pic -pic-level 2 -pic-is-pie -mthread-model posix -mdisable-fp-elim -fmath-errno -masm-verbose -mconstructor-aliases -fuse-init-array -target-cpu generic -target-feature +soft-float-abi -target-abi aapcs-linux -mfloat-abi soft -fallow-half-arguments-and-returns -dwarf-column-info -debugger-tuning=gdb -target-linker-version 241.9 -v -resource-dir /Users/macbookair/arm/lib64/clang/7.0.2 -isysroot /Users/macbookair/arm/bin/../sysroot -internal-isystem /Users/macbookair/arm/bin/../sysroot/usr/<span class="hljs-built_in">local</span>/include -internal-isystem /Users/macbookair/arm/lib64/clang/7.0.2/include -internal-externc-isystem /Users/macbookair/arm/bin/../sysroot/include -internal-externc-isystem /Users/macbookair/arm/bin/../sysroot/usr/include -fdebug-compilation-dir /Users/macbookair/Downloads/sji-android-screen-capture-master/src/android/capture -ferror-limit 19 -fmessage-length 80 -fno-signed-char -fobjc-runtime=gcc -fdiagnostics-show-option -fcolor-diagnostics -o /var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/t-9f5ef7.o -x c t.c<font></font>
clang -cc1 version 7.0.2 based upon LLVM 7.0.2svn default target x86_64-apple-darwin18.0.0<font></font>
ignoring nonexistent directory <span class="hljs-string">"/Users/macbookair/arm/bin/../sysroot/include"</span>
<span class="hljs-comment">#include "..." search starts here:</span>
<span class="hljs-comment">#include &lt;...&gt; search starts here:</span>
 /Users/macbookair/arm/bin/../sysroot/usr/<span class="hljs-built_in">local</span>/include<font></font>
 /Users/macbookair/arm/lib64/clang/7.0.2/include<font></font>
 /Users/macbookair/arm/bin/../sysroot/usr/include<font></font>
End of search list.<font></font>
t.c:1:10: error: expected <span class="hljs-string">"FILENAME"</span> or &lt;FILENAME&gt;
<span class="hljs-comment">#include &lt;bogus.h&gt; int main(){}</span><font></font>
         ^<font></font>
1 error generated.<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Googleにアクセスして、必要なすべてのファイルを探します。</font><font style="vertical-align: inherit;">私の場合、次のディレクトリとファイルを追加する必要がありました。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディレクトリとファイル</font></font></b><div class="spoiler_text"><pre><code class="bash hljs">// <font></font>
~/arm/sysroot/usr/include/binder<font></font>
~/arm/sysroot/usr/include/utils<font></font>
~/arm/sysroot/usr/include/cutils<font></font>
~/arm/sysroot/usr/include/<span class="hljs-built_in">log</span><font></font>
~/arm/sysroot/usr/include/system<font></font>
~/arm/sysroot/usr/include/gui<font></font>
~/arm/sysroot/usr/include/ui<font></font>
~/arm/sysroot/usr/include/hardware<font></font>
~/arm/sysroot/usr/ports<font></font>
<font></font>
// <font></font>
~/arm/sysroot/usr/include/SkAnnotation.h<font></font>
~/arm/sysroot/usr/include/SkAtomics.h<font></font>
~/arm/sysroot/usr/include/SkBBHFactory.h<font></font>
~/arm/sysroot/usr/include/SkBitmap.h<font></font>
~/arm/sysroot/usr/include/SkBitmapDevice.h<font></font>
~/arm/sysroot/usr/include/SkBlitRow.h<font></font>
~/arm/sysroot/usr/include/SkBlurTypes.h<font></font>
~/arm/sysroot/usr/include/SkCanvas.h<font></font>
~/arm/sysroot/usr/include/SkChunkAlloc.h<font></font>
~/arm/sysroot/usr/include/SkClipStack.h<font></font>
~/arm/sysroot/usr/include/SkColor.h<font></font>
~/arm/sysroot/usr/include/SkColorFilter.h<font></font>
~/arm/sysroot/usr/include/SkColorPriv.h<font></font>
~/arm/sysroot/usr/include/SkColorTable.h<font></font>
~/arm/sysroot/usr/include/SkComposeShader.h<font></font>
~/arm/sysroot/usr/include/SkData.h<font></font>
~/arm/sysroot/usr/include/SkDataTable.h<font></font>
~/arm/sysroot/usr/include/SkDeque.h<font></font>
~/arm/sysroot/usr/include/SkDevice.h<font></font>
~/arm/sysroot/usr/include/SkDither.h<font></font>
~/arm/sysroot/usr/include/SkDocument.h<font></font>
~/arm/sysroot/usr/include/SkDraw.h<font></font>
~/arm/sysroot/usr/include/SkDrawable.h<font></font>
~/arm/sysroot/usr/include/SkDrawFilter.h<font></font>
~/arm/sysroot/usr/include/SkDrawLooper.h<font></font>
~/arm/sysroot/usr/include/SkDrawPictureCallback.h<font></font>
~/arm/sysroot/usr/include/SkEndian.h<font></font>
~/arm/sysroot/usr/include/SkError.h<font></font>
~/arm/sysroot/usr/include/SkFilterQuality.h<font></font>
~/arm/sysroot/usr/include/SkFixed.h<font></font>
~/arm/sysroot/usr/include/SkFlattenable.h<font></font>
~/arm/sysroot/usr/include/SkFlattenableSerialization.h<font></font>
~/arm/sysroot/usr/include/SkFloatBits.h<font></font>
~/arm/sysroot/usr/include/SkFloatingPoint.h<font></font>
~/arm/sysroot/usr/include/SkFont.h<font></font>
~/arm/sysroot/usr/include/SkFontHost.h<font></font>
~/arm/sysroot/usr/include/SkFontLCDConfig.h<font></font>
~/arm/sysroot/usr/include/SkFontStyle.h<font></font>
~/arm/sysroot/usr/include/SkGraphics.h<font></font>
~/arm/sysroot/usr/include/SkImage.h<font></font>
~/arm/sysroot/usr/include/SkImageDecoder.h<font></font>
~/arm/sysroot/usr/include/SkImageEncoder.h<font></font>
~/arm/sysroot/usr/include/SkImageFilter.h<font></font>
~/arm/sysroot/usr/include/SkImageGenerator.h<font></font>
~/arm/sysroot/usr/include/SkImageInfo.h<font></font>
~/arm/sysroot/usr/include/SkInstCnt.h<font></font>
~/arm/sysroot/usr/include/SkLazyPtr.h<font></font>
~/arm/sysroot/usr/include/SkMallocPixelRef.h<font></font>
~/arm/sysroot/usr/include/SkMask.h<font></font>
~/arm/sysroot/usr/include/SkMaskFilter.h<font></font>
~/arm/sysroot/usr/include/SkMath.h<font></font>
~/arm/sysroot/usr/include/SkMatrix.h<font></font>
~/arm/sysroot/usr/include/SkMetaData.h<font></font>
~/arm/sysroot/usr/include/SkMultiPictureDraw.h<font></font>
~/arm/sysroot/usr/include/SkMutex.h<font></font>
~/arm/sysroot/usr/include/SkOnce.h<font></font>
~/arm/sysroot/usr/include/SkOSFile.h<font></font>
~/arm/sysroot/usr/include/SkPackBits.h<font></font>
~/arm/sysroot/usr/include/SkPaint.h<font></font>
~/arm/sysroot/usr/include/SkPath.h<font></font>
~/arm/sysroot/usr/include/SkPathEffect.h<font></font>
~/arm/sysroot/usr/include/SkPathMeasure.h<font></font>
~/arm/sysroot/usr/include/SkPathRef.h<font></font>
~/arm/sysroot/usr/include/SkPicture.h<font></font>
~/arm/sysroot/usr/include/SkPictureRecorder.h<font></font>
~/arm/sysroot/usr/include/SkPixelRef.h<font></font>
~/arm/sysroot/usr/include/SkPixelSerializer.h<font></font>
~/arm/sysroot/usr/include/SkPoint.h<font></font>
~/arm/sysroot/usr/include/SkPostConfig.h<font></font>
~/arm/sysroot/usr/include/SkPreConfig.h<font></font>
~/arm/sysroot/usr/include/SkRasterizer.h<font></font>
~/arm/sysroot/usr/include/SkRect.h<font></font>
~/arm/sysroot/usr/include/SkRefCnt.h<font></font>
~/arm/sysroot/usr/include/SkRegion.h<font></font>
~/arm/sysroot/usr/include/SkRRect.h<font></font>
~/arm/sysroot/usr/include/SkScalar.h<font></font>
~/arm/sysroot/usr/include/SkShader.h<font></font>
~/arm/sysroot/usr/include/SkSize.h<font></font>
~/arm/sysroot/usr/include/SkSpinlock.h<font></font>
~/arm/sysroot/usr/include/SkStream.h<font></font>
~/arm/sysroot/usr/include/SkString.h<font></font>
~/arm/sysroot/usr/include/SkStrokeRec.h<font></font>
~/arm/sysroot/usr/include/SkSurface.h<font></font>
~/arm/sysroot/usr/include/SkSurfaceProps.h<font></font>
~/arm/sysroot/usr/include/SkTArray.h<font></font>
~/arm/sysroot/usr/include/SkTDArray.h<font></font>
~/arm/sysroot/usr/include/SkTDict.h<font></font>
~/arm/sysroot/usr/include/SkTDStack.h<font></font>
~/arm/sysroot/usr/include/SkTemplates.h<font></font>
~/arm/sysroot/usr/include/SkTextBlob.h<font></font>
~/arm/sysroot/usr/include/SkThread.h<font></font>
~/arm/sysroot/usr/include/SkTime.h<font></font>
~/arm/sysroot/usr/include/SkTInternalLList.h<font></font>
~/arm/sysroot/usr/include/SkTLazy.h<font></font>
~/arm/sysroot/usr/include/SkTRegistry.h<font></font>
~/arm/sysroot/usr/include/SkTSearch.h<font></font>
~/arm/sysroot/usr/include/SkTypeface.h<font></font>
~/arm/sysroot/usr/include/SkTypes.h<font></font>
~/arm/sysroot/usr/include/SkUnPreMultiply.h<font></font>
~/arm/sysroot/usr/include/SkUserConfig.h<font></font>
~/arm/sysroot/usr/include/SkUtils.h<font></font>
~/arm/sysroot/usr/include/SkWeakRefCnt.h<font></font>
~/arm/sysroot/usr/include/SkWriteBuffer.h<font></font>
~/arm/sysroot/usr/include/SkWriter32.h<font></font>
~/arm/sysroot/usr/include/SkXfermode.h<font></font>
<font></font>
//   <font></font>
~/arm/sysroot/usr/include/android/log.h<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、それはここで彼が成功しているように見えるでしょう、すべて追加する必要があります。</font><font style="vertical-align: inherit;">コンパイル</font></font><br>
<br>
<pre><code class="bash hljs">~/arm/bin/clang -pie screencap.cpp -o ./screencap</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして私たちはひどい結果を得ます：</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">緊張しないように</font></font></b><div class="spoiler_text"><pre><code class="bash hljs">/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ProcessState::self()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ProcessState::startThreadPool()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ScreenshotClient::ScreenshotClient()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::SurfaceComposerClient::getBuiltInDisplay(int)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::SurfaceComposerClient::getDisplayConfigs(android::sp&lt;android::IBinder&gt; const&amp;, android::Vector&lt;android::DisplayInfo&gt;*)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::SurfaceComposerClient::getActiveConfig(android::sp&lt;android::IBinder&gt; const&amp;)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ScreenshotClient::update(android::sp&lt;android::IBinder&gt; const&amp;, android::Rect, unsigned int, unsigned int, unsigned int, unsigned int, bool, unsigned int)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ScreenshotClient::getPixels() const'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ScreenshotClient::getWidth() const'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ScreenshotClient::getHeight() const'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ScreenshotClient::getStride() const'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ScreenshotClient::getFormat() const'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ScreenshotClient::getSize() const'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::bytesPerPixel(int)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'SkImageEncoder::EncodeData(SkImageInfo const&amp;, void const*, unsigned int, SkImageEncoder::Type, int)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::bytesPerPixel(int)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ScreenshotClient::~ScreenshotClient()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'android::ScreenshotClient::~ScreenshotClient()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'stderr'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'stderr'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">'stderr'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> usage(char const*): error: undefined reference to <span class="hljs-string">'stderr'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> notifyMediaScanner(char const*): error: undefined reference to <span class="hljs-string">'android::String8::String8(char const*)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> notifyMediaScanner(char const*): error: undefined reference to <span class="hljs-string">'android::String8::String8(char const*)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> notifyMediaScanner(char const*): error: undefined reference to <span class="hljs-string">'android::String8::append(char const*)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> notifyMediaScanner(char const*): error: undefined reference to <span class="hljs-string">'android::String8::append(char const*)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> notifyMediaScanner(char const*): error: undefined reference to <span class="hljs-string">'android::String8::append(char const*)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> notifyMediaScanner(char const*): error: undefined reference to <span class="hljs-string">'android::String8::append(char const*)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> notifyMediaScanner(char const*): error: undefined reference to <span class="hljs-string">'android::String8::~String8()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> notifyMediaScanner(char const*): error: undefined reference to <span class="hljs-string">'android::String8::~String8()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> notifyMediaScanner(char const*): error: undefined reference to <span class="hljs-string">'android::String8::~String8()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> notifyMediaScanner(char const*): error: undefined reference to <span class="hljs-string">'android::String8::~String8()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o(.ARM.extab+0x0): error: undefined reference to <span class="hljs-string">'__gxx_personality_v0'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o(.ARM.extab+0x48): error: undefined reference to <span class="hljs-string">'__gxx_personality_v0'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> android::sp&lt;android::ProcessState&gt;::~sp(): error: undefined reference to <span class="hljs-string">'android::RefBase::decStrong(void const*) const'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o(.ARM.extab.text._ZN7android2spINS_12ProcessStateEED2Ev+0x0): error: undefined reference to <span class="hljs-string">'__gxx_personality_v0'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> android::Vector&lt;android::DisplayInfo&gt;::Vector(): error: undefined reference to <span class="hljs-string">'android::VectorImpl::VectorImpl(unsigned int, unsigned int)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> android::Vector&lt;android::DisplayInfo&gt;::operator[](unsigned int) const: error: undefined reference to <span class="hljs-string">'__android_log_assert'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o(.ARM.extab.text._ZN12SkAutoTUnrefI6SkDataED2Ev+0x0): error: undefined reference to <span class="hljs-string">'__gxx_personality_v0'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> android::Vector&lt;android::DisplayInfo&gt;::~Vector(): error: undefined reference to <span class="hljs-string">'android::VectorImpl::finish_vector()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> android::Vector&lt;android::DisplayInfo&gt;::~Vector(): error: undefined reference to <span class="hljs-string">'android::VectorImpl::~VectorImpl()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> android::Vector&lt;android::DisplayInfo&gt;::~Vector(): error: undefined reference to <span class="hljs-string">'android::VectorImpl::~VectorImpl()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> android::sp&lt;android::IBinder&gt;::~sp(): error: undefined reference to <span class="hljs-string">'android::RefBase::decStrong(void const*) const'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> __clang_call_terminate: error: undefined reference to <span class="hljs-string">'__cxa_begin_catch'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> __clang_call_terminate: error: undefined reference to <span class="hljs-string">'std::terminate()'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> android::Vector&lt;android::DisplayInfo&gt;::~Vector(): error: undefined reference to <span class="hljs-string">'operator delete(void*)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:<span class="hljs-keyword">function</span> SkRefCntBase::unref() const: error: undefined reference to <span class="hljs-string">'SkDebugf(char const*, ...)'</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:typeinfo <span class="hljs-keyword">for</span> android::Vector&lt;android::DisplayInfo&gt;: error: undefined reference to <span class="hljs-string">'vtable for __cxxabiv1::__vmi_class_type_info'</span>
/Users/macbookair/Documents/<span class="hljs-built_in">test</span>/bin/../lib/gcc/arm-linux-androideabi/4.9.x/../../../../arm-linux-androideabi/bin/ld: the vtable symbol may be undefined because the class is missing its key <span class="hljs-keyword">function</span>
/var/folders/_4/7d51802j1hz2rnmql8kngx5w0000gn/T/screencap-175810.o:screencap.cpp:typeinfo <span class="hljs-keyword">for</span> android::Vector&lt;android::DisplayInfo&gt;: error: undefined reference to <span class="hljs-string">'typeinfo for android::VectorImpl'</span>
clang70: error: linker <span class="hljs-built_in">command</span> failed with <span class="hljs-built_in">exit</span> code 1 (use -v to see invocation)
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私にとって、それは本当の地獄でした、なぜなら </font><font style="vertical-align: inherit;">多くのファイルにはエラーがありましたが、これらのファイルの内容は変更されなかったため、理論的にはエラーになりません。</font><font style="vertical-align: inherit;">この段階で私は長い間腰を下ろし、積極的にグーグルエラーを始めましたが、必要な答えを見つけることができませんでした。</font><font style="vertical-align: inherit;">覚えていないclangチュートリアルを学ぶことにしたのですが、この解決策は私を救いました！</font><font style="vertical-align: inherit;">結局のところ</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
、clangにはパラメーター（または</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ld</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）--unresolved-symbolsがあり、これが未解決の文字の処理を担当します。</font><font style="vertical-align: inherit;">まったくの間違いで、これが事実であるとは言えません。</font><font style="vertical-align: inherit;">パラメータを追加して、再度コンパイルします。</font></font><br>
<br>
<pre><code class="bash hljs">~/arm/bin/clang -pie screencap.cpp  -o ./screencap -Wl,--unresolved-symbols=ignore-all -s</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、コンパイルは成功しました！</font><font style="vertical-align: inherit;">実際、問題のほとんどはなくなったとすでに思っていましたが、そこにはありませんでした。</font><font style="vertical-align: inherit;">次のようなエラーが表示され始めました。</font></font><br>
<br>
<pre><code class="bash hljs">CANNOT LINK EXECUTABLE: cannot locate symbol <span class="hljs-string">"_ZN7android12ProcessState4selfEv"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結局のところ、コンパイラには追加されたファイルが十分ありましたが、Androidデバイスでは、これらのファイルはすべて.soライブラリに保存されています。</font><font style="vertical-align: inherit;">後でこの問題について多かれ少なかれうまく解析したので、必要なライブラリーを見つける比較的簡単な方法を見つけました。</font><font style="vertical-align: inherit;">これを行うには、Androidデバイス（/ system / bin / screencap）にあるバイナリscreencapファイルをテキストエディターで開き、このファイルで使用されている.soライブラリーの名前をすべて確認します。</font><font style="vertical-align: inherit;">私の場合、この部分は次のとおりです。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用するライブラリの名前が付いたパーツ</font></font></b><div class="spoiler_text"><pre><code class="bash hljs">...libdl.so__libc_initlibc.so__cxa_atexit__register_atfork__gnu_Unwind_Find_exidxLIBC_PRIVATE_ZNK7android6VectorINS_11DisplayInfoEE12do_constructEPvj__snprintf_chk__aeabi_memset__aeabi_memcpy_ZNK7android6VectorINS_11DisplayInfoEE10do_destroyEPvj_ZNK7android6VectorINS_11DisplayInfoEE7do_copyEPvPKvj_ZNK7android6VectorINS_11DisplayInfoEE8do_splatEPvPKvj_ZNK7android6VectorINS_11DisplayInfoEE15do_move_forwardEPvPKvj_ZNK7android6VectorINS_11DisplayInfoEE16do_move_backwardEPvPKvj_ZN7android10VectorImpl13finish_vectorEv_ZN7android10VectorImplD2Ev_ZTVN7android6VectorINS_11DisplayInfoEEE_ZdlPvsignal__android_log_print_ZN7android12ProcessState4selfEv_ZN7android12ProcessState15startThreadPoolEv_ZNK7android7RefBase9decStrongEPKvgetoptatoidupopen__errnostrerrorfprintfstrlenstrcmp_ZN7android16ScreenshotClientC1Ev_ZN7android21SurfaceComposerClient17getBuiltInDisplayEi_ZN7android10VectorImplC2Ejj_ZN7android21SurfaceComposerClient17getDisplayConfigsERKNS_2spINS_7IBinderEEEPNS_6VectorINS_11DisplayInfoEEE_ZN7android21SurfaceComposerClient15getActiveConfigERKNS_2spINS_7IBinderEEE_ZN7android16ScreenshotClient6updateERKNS_2spINS_7IBinderEEENS_4RectEjjjjbj_ZNK7android16ScreenshotClient9getPixelsEv_ZNK7android16ScreenshotClient8getWidthEv_ZNK7android16ScreenshotClient9getHeightEv_ZNK7android16ScreenshotClient9getStrideEv_ZNK7android16ScreenshotClient9getFormatEv_ZNK7android16ScreenshotClient7getSizeEvioctlclose_ZN7android13bytesPerPixelEi_ZN14SkImageEncoder10EncodeDataERK11SkImageInfoPKvjNS_4TypeEiwrite_ZN7android7String8C1EPKc_ZN7android7String86appendEPKcsystemfputs_ZN7android7String8D1Evmunmap_ZN7android16ScreenshotClientD1Evmmapoptargstderroptindabort_edata__bss_start_endlibcutils.solibutils.solibbinder.solibskia.solibui.solibgui.solibc++.solibm.so...
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この部分をコンパイル済みファイルと比較して、不足しているライブラリを見つけることができます。</font><font style="vertical-align: inherit;">この場合、それらはlibgui.so、libui.so、libcutils.so、libutils.so、libbinder.so、libskia.soであることが判明しました。</font><font style="vertical-align: inherit;">私たちは彼らの場所を探しています（実際、彼らは同じ場所にいます）：</font></font><br>
<br>
<pre><code class="bash hljs">find -name <span class="hljs-string">'libskia.so'</span> 2&gt;/dev/null<font></font>
/system/lib/libskia.so<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのライブラリをsdcard / libsにコピーします（libskia.soの例）：</font></font><br>
<br>
<pre><code class="bash hljs">./system/lib/libskia.so /sdcard/
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
adb pullを使用して、mobからファイルをコピーします。</font><font style="vertical-align: inherit;">コンピュータからデバイス：</font></font><br>
<br>
<pre><code class="bash hljs">adb pull /sdcard/libs ~/arm
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それらを必要なディレクトリに配置してコンパイルしますが、新しい* .soパラメーターを使用して、アセンブル時にすべての.soライブラリーを同じ方法で使用するか、ファイルにリンクを指定する必要があることを示します。</font></font><br>
<br>
<pre><code class="bash hljs">~/arm/bin/clang -pie screencap.cpp *.so -o ./screencap -Wl,--unresolved-symbols=ignore-all -s
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これでコンパイルが成功し、mobでバイナリファイルが起動します。</font><font style="vertical-align: inherit;">デバイスにはエラーがありません。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論と結果</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
お気づきかもしれませんが、「他の誰かのコードに」機能を追加することは、それほど単純な作業ではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変更されたscreencapファイルのコードを以下に示します。</font><font style="vertical-align: inherit;">その組み立てはオリジナルと同じ方法で行われます。</font><font style="vertical-align: inherit;">追加された変更はほとんどの読者に理解できると思うので、コメントしないことにしました。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">screencap.cppの改善</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;errno.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fcntl.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;linux/fb.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/ioctl.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/mman.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;binder/ProcessState.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;gui/SurfaceComposerClient.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;gui/ISurfaceComposer.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ui/DisplayInfo.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ui/PixelFormat.h&gt;</span></span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Fix Skia.</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> GCC diagnostic push</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> GCC diagnostic ignored <span class="hljs-meta-string">"-Wunused-parameter"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SkImageEncoder.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SkData.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> GCC diagnostic pop</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> android;
<span class="hljs-keyword">static</span> <span class="hljs-keyword">uint32_t</span> DEFAULT_DISPLAY_ID = ISurfaceComposer::eDisplayIdMain;
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">usage</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* pname)</span>
</span>{
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>,
            <span class="hljs-string">"usage: %s [-hpcr] [-d display-id] [FILENAME] [x1 y1] [x2 y2]\n"</span>
            <span class="hljs-string">"   -h: this message\n"</span>
            <span class="hljs-string">"   -p: save the file as a png.\n"</span>
            <span class="hljs-string">"   -d: specify the display id to capture, default %d.\n"</span>
            <span class="hljs-string">"   -c: print pixel color [x y].\n"</span>
            <span class="hljs-string">"   -r: get rectangle area [x1 - left y1 - top x2 - right y2 - bottom].\n"</span>
            <span class="hljs-string">"If FILENAME ends with .png it will be saved as a png.\n"</span>
            <span class="hljs-string">"If FILENAME is not given, the results will be printed to stdout.\n"</span>,<font></font>
            pname, DEFAULT_DISPLAY_ID<font></font>
    );<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> SkColorType <span class="hljs-title">flinger2skia</span><span class="hljs-params">(PixelFormat f)</span>
</span>{
    <span class="hljs-keyword">switch</span> (f) {
        <span class="hljs-keyword">case</span> PIXEL_FORMAT_RGB_565:
            <span class="hljs-keyword">return</span> kRGB_565_SkColorType;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">return</span> kN32_SkColorType;<font></font>
    }<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">status_t</span> <span class="hljs-title">vinfoToPixelFormat</span><span class="hljs-params">(<span class="hljs-keyword">const</span> fb_var_screeninfo&amp; vinfo,
        <span class="hljs-keyword">uint32_t</span>* bytespp, <span class="hljs-keyword">uint32_t</span>* f)</span>
</span>{
    <span class="hljs-keyword">switch</span> (vinfo.bits_per_pixel) {
        <span class="hljs-keyword">case</span> <span class="hljs-number">16</span>:<font></font>
            *f = PIXEL_FORMAT_RGB_565;<font></font>
            *bytespp = <span class="hljs-number">2</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">24</span>:<font></font>
            *f = PIXEL_FORMAT_RGB_888;<font></font>
            *bytespp = <span class="hljs-number">3</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">32</span>:
            <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> do better decoding of vinfo here</span><font></font>
            *f = PIXEL_FORMAT_RGBX_8888;<font></font>
            *bytespp = <span class="hljs-number">4</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">return</span> BAD_VALUE;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> NO_ERROR;<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">status_t</span> <span class="hljs-title">notifyMediaScanner</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* fileName)</span> </span>{
    <span class="hljs-function">String8 <span class="hljs-title">cmd</span><span class="hljs-params">(<span class="hljs-string">"am broadcast -a android.intent.action.MEDIA_SCANNER_SCAN_FILE -d file://"</span>)</span></span>;
    <span class="hljs-function">String8 <span class="hljs-title">fileUrl</span><span class="hljs-params">(<span class="hljs-string">"\""</span>)</span></span>;<font></font>
    fileUrl.append(fileName);<font></font>
    fileUrl.append(<span class="hljs-string">"\""</span>);<font></font>
    cmd.append(fileName);<font></font>
    cmd.append(<span class="hljs-string">" &gt; /dev/null"</span>);
    <span class="hljs-keyword">int</span> result = system(cmd.<span class="hljs-built_in">string</span>());
    <span class="hljs-keyword">if</span> (result &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unable to broadcast intent for media scanner.\n"</span>);
        <span class="hljs-keyword">return</span> UNKNOWN_ERROR;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> NO_ERROR;<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span>
</span>{<font></font>
    ProcessState::self()-&gt;startThreadPool();<font></font>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* pname = argv[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">int</span> x1,x2,y1,y2;
    <span class="hljs-keyword">bool</span> png = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">bool</span> color = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">bool</span> rectangle = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">int32_t</span> displayId = DEFAULT_DISPLAY_ID;
    <span class="hljs-keyword">int</span> c;
    <span class="hljs-keyword">while</span> ((c = getopt(argc, argv, <span class="hljs-string">"phdcr:"</span>)) != <span class="hljs-number">-1</span>) {
        <span class="hljs-keyword">switch</span> (c) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'p'</span>:<font></font>
                png = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'d'</span>:<font></font>
                displayId = atoi(optarg);<font></font>
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'c'</span>:<font></font>
                color = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'r'</span>:<font></font>
                rectangle = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'?'</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-string">'h'</span>:<font></font>
                usage(pname);<font></font>
                <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
        }<font></font>
    }<font></font>
<font></font>
    argc -= optind;<font></font>
    <font></font>
    <span class="hljs-keyword">if</span> (color) {<font></font>
        x1 = atoi(argv[<span class="hljs-number">2</span>])<span class="hljs-number">-1</span>;<font></font>
        y1 = atoi(argv[<span class="hljs-number">3</span>])<span class="hljs-number">-1</span>;<font></font>
        x2 = atoi(argv[<span class="hljs-number">2</span>]);<font></font>
        y2 = atoi(argv[<span class="hljs-number">3</span>]);<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rectangle) {<font></font>
        x1 = atoi(argv[<span class="hljs-number">3</span>]);<font></font>
        y1 = atoi(argv[<span class="hljs-number">4</span>]);<font></font>
        x2 = atoi(argv[<span class="hljs-number">5</span>]);<font></font>
        y2 = atoi(argv[<span class="hljs-number">6</span>]);<font></font>
        optind--;<font></font>
    }<font></font>
<font></font>
    <font></font>
    argv += optind;<font></font>
<font></font>
    <span class="hljs-keyword">int</span> fd = <span class="hljs-number">-1</span>;
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* fn = <span class="hljs-literal">NULL</span>;
    <span class="hljs-keyword">if</span> (argc == <span class="hljs-number">0</span>) {<font></font>
        fd = dup(STDOUT_FILENO);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (argc == <span class="hljs-number">1</span> || argc == <span class="hljs-number">4</span>) {<font></font>
        fn = argv[<span class="hljs-number">0</span>];<font></font>
        fd = open(fn, O_WRONLY | O_CREAT | O_TRUNC, <span class="hljs-number">0664</span>);
        <span class="hljs-keyword">if</span> (fd == <span class="hljs-number">-1</span>) {
            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Error opening file: %s (%s)\n"</span>, fn, strerror(errno));
            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
        }<font></font>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> len = <span class="hljs-built_in">strlen</span>(fn);
        <span class="hljs-keyword">if</span> (len &gt;= <span class="hljs-number">4</span> &amp;&amp; <span class="hljs-number">0</span> == <span class="hljs-built_in">strcmp</span>(fn+len<span class="hljs-number">-4</span>, <span class="hljs-string">".png"</span>)) {<font></font>
            png = <span class="hljs-literal">true</span>;<font></font>
        }<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">if</span> (fd == <span class="hljs-number">-1</span> &amp;&amp; !color &amp;&amp; !rectangle) {<font></font>
        usage(pname);<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
    }<font></font>
    <font></font>
    <font></font>
    <span class="hljs-keyword">void</span> <span class="hljs-keyword">const</span>* mapbase = MAP_FAILED;
    <span class="hljs-keyword">ssize_t</span> mapsize = <span class="hljs-number">-1</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-keyword">const</span>* base = <span class="hljs-literal">NULL</span>;
    <span class="hljs-keyword">uint32_t</span> w, s, h, f;
    <span class="hljs-keyword">size_t</span> size = <span class="hljs-number">0</span>;
    <span class="hljs-comment">// Maps orientations from DisplayInfo to ISurfaceComposer</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">uint32_t</span> ORIENTATION_MAP[] = {<font></font>
        ISurfaceComposer::eRotateNone, <span class="hljs-comment">// 0 == DISPLAY_ORIENTATION_0</span>
        ISurfaceComposer::eRotate270, <span class="hljs-comment">// 1 == DISPLAY_ORIENTATION_90</span>
        ISurfaceComposer::eRotate180, <span class="hljs-comment">// 2 == DISPLAY_ORIENTATION_180</span>
        ISurfaceComposer::eRotate90, <span class="hljs-comment">// 3 == DISPLAY_ORIENTATION_270</span><font></font>
    };<font></font>
    ScreenshotClient screenshot;<font></font>
    sp&lt;IBinder&gt; display = SurfaceComposerClient::getBuiltInDisplay(displayId);<font></font>
    <span class="hljs-keyword">if</span> (display == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unable to get handle for display %d\n"</span>, displayId);
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
    }<font></font>
    Vector&lt;DisplayInfo&gt; configs;<font></font>
    SurfaceComposerClient::getDisplayConfigs(display, &amp;configs);<font></font>
    <span class="hljs-keyword">int</span> activeConfig = SurfaceComposerClient::getActiveConfig(display);
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">size_t</span>&gt;(activeConfig) &gt;= configs.size()) {
        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Active config %d not inside configs (size %zu)\n"</span>,<font></font>
                activeConfig, configs.size());<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">uint8_t</span> displayOrientation = configs[activeConfig].orientation;
    <span class="hljs-keyword">uint32_t</span> captureOrientation = ORIENTATION_MAP[displayOrientation];
    <span class="hljs-keyword">status_t</span> result;
    <span class="hljs-keyword">if</span> (color || rectangle) {<font></font>
        result = screenshot.update(display, Rect(x1,y1,x2,y2), x2-x1, y2-y1, <span class="hljs-number">0</span>, <span class="hljs-number">-1U</span>,
            <span class="hljs-literal">false</span>, captureOrientation);<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> {<font></font>
        result = screenshot.update(display, Rect(), <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-1U</span>,
            <span class="hljs-literal">false</span>, captureOrientation);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (result == NO_ERROR) {<font></font>
        base = screenshot.getPixels();<font></font>
        w = screenshot.getWidth();<font></font>
        h = screenshot.getHeight();<font></font>
        s = screenshot.getStride();<font></font>
        f = screenshot.getFormat();<font></font>
        size = screenshot.getSize();<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (color) {
            <span class="hljs-keyword">size_t</span> Bpp = <span class="hljs-number">4</span>; <span class="hljs-comment">//bytesPerPixel</span>
            <span class="hljs-keyword">char</span>* rawImageData;<font></font>
            rawImageData = (<span class="hljs-keyword">char</span> *)base;<font></font>
            base = (<span class="hljs-keyword">void</span> *)((<span class="hljs-keyword">char</span> *)base + Bpp);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-keyword">sizeof</span>(rawImageData); i++) {
                <span class="hljs-built_in">printf</span>( <span class="hljs-string">"%02X"</span>, rawImageData[i]);<font></font>
            }<font></font>
            <font></font>
            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
        }<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* fbpath = <span class="hljs-string">"/dev/graphics/fb0"</span>;
        <span class="hljs-keyword">int</span> fb = open(fbpath, O_RDONLY);
        <span class="hljs-keyword">if</span> (fb &gt;= <span class="hljs-number">0</span>) {
            <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">fb_var_screeninfo</span> <span class="hljs-title">vinfo</span>;</span>
            <span class="hljs-keyword">if</span> (ioctl(fb, FBIOGET_VSCREENINFO, &amp;vinfo) == <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">uint32_t</span> bytespp;
                <span class="hljs-keyword">if</span> (vinfoToPixelFormat(vinfo, &amp;bytespp, &amp;f) == NO_ERROR) {
                    <span class="hljs-keyword">size_t</span> offset = (vinfo.xoffset + vinfo.yoffset*vinfo.xres) * bytespp;<font></font>
                    w = vinfo.xres;<font></font>
                    h = vinfo.yres;<font></font>
                    s = vinfo.xres;<font></font>
                    size = w*h*bytespp;<font></font>
                    mapsize = offset + size;<font></font>
                    mapbase = mmap(<span class="hljs-number">0</span>, mapsize, PROT_READ, MAP_PRIVATE, fb, <span class="hljs-number">0</span>);
                    <span class="hljs-keyword">if</span> (mapbase != MAP_FAILED) {<font></font>
                        base = (<span class="hljs-keyword">void</span> <span class="hljs-keyword">const</span> *)((<span class="hljs-keyword">char</span> <span class="hljs-keyword">const</span> *)mapbase + offset);<font></font>
                    }<font></font>
                }<font></font>
            }<font></font>
            close(fb);<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (base != <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">if</span> (png) {
            <span class="hljs-keyword">const</span> SkImageInfo info = SkImageInfo::Make(w, h, flinger2skia(f), kPremul_SkAlphaType);
            <span class="hljs-function">SkAutoTUnref&lt;SkData&gt; <span class="hljs-title">data</span><span class="hljs-params">(SkImageEncoder::EncodeData(info, base, s*bytesPerPixel(f),
                    SkImageEncoder::kPNG_Type, SkImageEncoder::kDefaultQuality))</span></span>;
            <span class="hljs-keyword">if</span> (data.get()) {<font></font>
                write(fd, data-&gt;data(), data-&gt;size());<font></font>
            }<font></font>
            <span class="hljs-keyword">if</span> (fn != <span class="hljs-literal">NULL</span>) {<font></font>
                notifyMediaScanner(fn);<font></font>
            }<font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
            write(fd, &amp;w, <span class="hljs-number">4</span>);<font></font>
            write(fd, &amp;h, <span class="hljs-number">4</span>);<font></font>
            write(fd, &amp;f, <span class="hljs-number">4</span>);
            <span class="hljs-keyword">size_t</span> Bpp = bytesPerPixel(f);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> y=<span class="hljs-number">0</span> ; y&lt;h ; y++) {<font></font>
                write(fd, base, w*Bpp);<font></font>
                base = (<span class="hljs-keyword">void</span> *)((<span class="hljs-keyword">char</span> *)base + s*Bpp);<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
    close(fd);<font></font>
    <span class="hljs-keyword">if</span> (mapbase != MAP_FAILED) {<font></font>
        munmap((<span class="hljs-keyword">void</span> *)mapbase, mapsize);<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ピクセルの色を取得する例：</font></font><br>
<br>
<pre><code class="bash hljs">./screencap -c 100 100</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特定の領域の画像を取得する例：</font></font><br>
<br>
<pre><code class="bash hljs">./screencap -r /sdcard/test.png 0 0 720 640</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このプロジェクトは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">アップロードされ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ている</font></a><font style="vertical-align: inherit;">ので、興味のある方は大歓迎です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS実行可能ファイルに必要なソースコードまたはコンパイルに必要なライブラリを見つける最良の方法がわかっている場合は、コメントを追加してください。記事にこのアドバイスを追加します。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja456250/index.html">アプリケーションのローカリゼーションとRTLのサポート。Yandex.Taxiを報告する</a></li>
<li><a href="../ja456256/index.html">Androidアプリケーションアーキテクチャガイド</a></li>
<li><a href="../ja456258/index.html">GNU FDL 1.3ライセンスに基づく「Free as in Freedom」のロシア語への翻訳は風のように無料、ビールのように無料</a></li>
<li><a href="../ja456260/index.html">フェアエコノミートーク</a></li>
<li><a href="../ja456262/index.html">ソフトウェア無線-それはどのように機能しますか？パート9</a></li>
<li><a href="../ja456266/index.html">モバイル＃302開発者向けの興味深い資料のダイジェスト（6月10〜16日）</a></li>
<li><a href="../ja456270/index.html">Redisストリーム-メッセージングシステムの信頼性とスケーラビリティ</a></li>
<li><a href="../ja456272/index.html">Android Lintとは何ですか？サポートされているコードの記述にどのように役立ちますか？</a></li>
<li><a href="../ja456274/index.html">心理学者：セックスロボットは、他の人々との関係を必要としないカップルがいない場合、人々の数の増加につながります</a></li>
<li><a href="../ja456276/index.html">情報とは？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>