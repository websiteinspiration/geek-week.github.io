<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ôàÔ∏è üõÄüèº üßëüèø‚Äçü§ù‚Äçüßëüèª Casos para utilizar herramientas de an√°lisis de anomal√≠as de red: detecci√≥n de fugas ü•ê üë©üèª‚Äçüè´ üì∂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En uno de los eventos, se produjo una discusi√≥n interesante sobre la utilidad de las soluciones de la clase NTA (Network Traffic Analysis), que, utili...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Casos para utilizar herramientas de an√°lisis de anomal√≠as de red: detecci√≥n de fugas</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/cisco/blog/487346/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En uno de los eventos, se produjo una discusi√≥n interesante sobre la utilidad de las soluciones de la clase NTA (Network Traffic Analysis), que, utilizando la infraestructura de red de telemetr√≠a de Netflow (u otros protocolos de flujo), permite detectar una amplia gama de ataques. Mis oponentes argumentaron que al analizar los encabezados y la informaci√≥n relacionada (y la NTA no analiza el cuerpo de los datos del paquete, a diferencia de los sistemas de detecci√≥n de ataques cl√°sicos, IDS), no se puede ver mucho. En este art√≠culo intentar√© refutar esta opini√≥n y hacer que la conversaci√≥n sea m√°s sustantiva, dar√© algunos ejemplos reales cuando la NTA realmente ayude a identificar varias anomal√≠as y amenazas que faltan en el per√≠metro o incluso m√°s all√° del per√≠metro. Y comenzar√© con la amenaza que lleg√≥ primero en la clasificaci√≥n de amenazas del a√±o pasado y, creo, seguir√° si√©ndolo este a√±o.Se tratar√° de fugas de informaci√≥n y la capacidad de detectarlas a trav√©s de la telemetr√≠a de red.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No considerar√© la situaci√≥n con las manos torcidas de los administradores que dejaron Internet sin protecci√≥n Elastic o MongoDB. Hablemos de las acciones espec√≠ficas de los atacantes, como fue el caso con la aclamada historia de las agencias de cr√©dito Equifax. Perm√≠tame recordarle que en este caso, los atacantes penetraron primero a trav√©s de la vulnerabilidad sin parchear en el portal web p√∫blico y luego en los servidores de bases de datos internos. Permaneciendo inadvertidos durante varios meses, pudieron robar datos de 146 millones de clientes de agencias de cr√©dito. ¬øPodr√≠a identificarse un incidente de este tipo utilizando soluciones DLP? Lo m√°s probable es que no, ya que los DLP cl√°sicos no est√°n dise√±ados para la tarea de monitorear el tr√°fico de las bases de datos utilizando protocolos espec√≠ficos, e incluso bajo la condici√≥n de que este tr√°fico est√© encriptado.Pero la soluci√≥n de la clase NTA puede detectar f√°cilmente tales fugas al superar un cierto valor umbral de la cantidad de informaci√≥n descargada de la base de datos. A continuaci√≥n, mostrar√© c√≥mo se configura y descubre todo esto utilizando la soluci√≥n Cisco Stealthwatch Enterprise.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, lo primero que debemos hacer es comprender d√≥nde est√°n ubicados nuestros servidores de bases de datos en la red, determinar sus direcciones y agruparlos. En Cisco Stealthwatch, la tarea de inventario se puede realizar manualmente o mediante un clasificador especial que analiza el tr√°fico y, de acuerdo con los protocolos utilizados y el comportamiento del nodo, le permite atribuirlo a una u otra categor√≠a. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ri/n5/uy/rin5uykkickqn7znft9qa0ulllu.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de tener informaci√≥n sobre todos los servidores de bases de datos, comenzamos una investigaci√≥n para descubrir si estamos filtrando grandes cantidades de datos del grupo deseado de nodos. Vemos que en nuestro caso, las bases de datos se comunican m√°s activamente con los servidores DHCP y los controladores de dominio.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lb/xq/1z/lbxq1znvwtgzs01n4quxfwtgjli.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los atacantes a menudo establecen control sobre cualquiera de los nodos de la red y lo usan como cabeza de puente para desarrollar su ataque. A nivel del tr√°fico de red, parece una anomal√≠a: el escaneo de la red desde este nodo es cada vez m√°s frecuente, se capturan datos del recurso compartido de archivos o la interacci√≥n con cualquier servidor. Por lo tanto, nuestra pr√≥xima tarea es comprender con qui√©n se comunican exactamente nuestras bases de datos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wb/er/0b/wber0bo8wqxtkswej7n7vmoffc8.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el grupo de servidores DHCP, resulta que este es un nodo con la direcci√≥n 10.201.0.15, interacci√≥n con la que representa aproximadamente el 50% de todo el tr√°fico de los servidores de bases de datos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yz/yb/vb/yzybvbnmgicokharg8oxu57lxwm.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La siguiente pregunta l√≥gica que nos hacemos como parte de la investigaci√≥n es: ‚Äú¬øY c√≥mo es este nodo 10.201.0.15? ¬øCon qui√©n est√° interactuando? ¬øCon qu√© frecuencia? ¬øQu√© protocolos?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mt/-s/ac/mt-sacge5hjgo2jwerw7omqwmlk.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resulta que el nodo que nos interesa se comunica con varios segmentos y nodos de nuestra red (lo cual no es sorprendente, ya que es un servidor DHCP), pero la pregunta causa demasiada interacci√≥n con el servidor terminal con la direcci√≥n 10.201.0.23. ¬øEsto es normal? Claramente hay alg√∫n tipo de anomal√≠a. Un servidor DHCP no puede comunicarse tan activamente con un servidor terminal: 5610 transmisiones y 23.5 GB de datos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4i/mk/jm/4imkjmqkv1eumztrmdyb88etx3c.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y esta interacci√≥n se lleva a cabo a trav√©s de NFS. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vl/2a/wo/vl2awoxjk2kijyg494rvz8bqsr4.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øDamos el siguiente paso e intentamos entender con qui√©n interact√∫a nuestro servidor terminal? Resulta que tiene una comunicaci√≥n bastante activa con el mundo exterior, con nodos en los Estados Unidos, Gran Breta√±a, Canad√°, Dinamarca, los Emiratos √Årabes Unidos, Qatar, Suiza, etc.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uw/yr/3s/uwyr3shmwntm1clarsxud2xfcgq.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La sospecha fue causada por el hecho de la interacci√≥n P2P con Puerto Rico, que representaba el 90% de todo el tr√°fico. Adem√°s, nuestro servidor terminal transmiti√≥ m√°s de 17 GB de datos a Puerto Rico a trav√©s del puerto 53, que est√° conectado con el protocolo DNS. ¬øTe imaginas que tienes un volumen de datos transmitido a trav√©s de DNS? Y le recuerdo que, seg√∫n la investigaci√≥n de Cisco, el 92% del malware usa DNS para ocultar su actividad (descargar actualizaciones, recibir comandos, descargar datos). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f1/mm/5b/f1mm5b4rmsqx5butgpw-mlsmk0e.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y si el protocolo DNS de la UIT no solo est√° abierto, sino que no se inspecciona, entonces tenemos un gran agujero en nuestro per√≠metro. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yt/_4/dj/yt_4djyxlui4rzkyvsko1zsejlu.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tan pronto como el nodo 10.201.0.23 nos haya causado tales sospechas, ¬øveremos con qui√©n sigue hablando?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zh/ya/7r/zhya7r8umwppjkxvidzpmpca9zy.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nuestro "sospechoso" intercambia la mitad de todo el tr√°fico con el nodo 10.201.3.18, que se coloca en un grupo de estaciones de trabajo de empleados del departamento de ventas y marketing. ¬øQu√© tan t√≠picos son estos para nuestra organizaci√≥n para que el servidor de terminal se "comunique" con la computadora del vendedor o comercializador?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pu/vq/nf/puvqnfekb1fdkqjenprrlsesxpi.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, realizamos una investigaci√≥n y descubrimos la siguiente imagen. Los datos del servidor de la base de datos se "vertieron" en un servidor DHCP con su posterior transferencia a trav√©s de NFS a un servidor terminal dentro de nuestra red, y luego a direcciones externas en Puerto Rico utilizando el protocolo DNS. Esta es una clara violaci√≥n de las pol√≠ticas de seguridad. Al mismo tiempo, el servidor de terminal tambi√©n interactu√≥ con una de las estaciones de trabajo dentro de la red. ¬øQu√© caus√≥ este incidente? ¬øUna cuenta robada? Dispositivo infectado? No sabemos. Esto requerir√° una continuaci√≥n de la investigaci√≥n, que se bas√≥ en la soluci√≥n de clase NTA, que permite analizar las anomal√≠as del tr√°fico de la red.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ge/wt/vo/gewtvo6-5k-41fdkkxaozhlep7q.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y ahora estamos interesados ‚Äã‚Äãen ¬øqu√© haremos con las violaciones identificadas de la pol√≠tica de seguridad? Puede realizar un an√°lisis regular de acuerdo con el esquema anterior, o puede configurar la pol√≠tica NTA para que se√±ale de inmediato cuando se detectan violaciones similares. Esto se realiza a trav√©s del men√∫ general correspondiente o para cada conexi√≥n detectada durante la investigaci√≥n. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cc/rp/qa/ccrpqaqizyxou5zjqqfw36hsl4i.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As√≠ es como se ver√° la regla de detecci√≥n de interacci√≥n, cuyo origen es el servidor de la base de datos, y el destino es cualquier nodo externo, as√≠ como cualquier servidor web interno, excluyendo los servidores web.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hu/xy/ah/huxyah2skmz8jpc7d3dhtxtl3xe.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si se detecta dicho evento, el sistema de an√°lisis de tr√°fico de red genera inmediatamente una se√±al de alarma de correspondencia y, seg√∫n la configuraci√≥n, lo env√≠a a SIEM, utilizando los medios de comunicaci√≥n con el administrador, o incluso puede bloquear autom√°ticamente la violaci√≥n detectada (Cisco Stealthwatch lo hace al interactuar con Cisco ISE ) </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lj/ii/rn/ljiirng2huuf6qzjxg-kiagufcu.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recuerde que cuando mencion√© el caso con Equifax, mencion√© que los atacantes usaron un canal encriptado para volcar datos. Para DLP, este tr√°fico se convierte en una tarea insoluble, pero para las soluciones de clase NTA, no lo hacen: supervisan cualquier exceso de tr√°fico o interacci√≥n no autorizada entre nodos, independientemente del uso de cifrado.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/u2/qg/qg/u2qgqgkkrsk_etuu7nav-k9hndg.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solo se mostr√≥ un caso arriba (en los siguientes materiales consideraremos otros ejemplos de uso de NTA para fines de seguridad de la informaci√≥n), pero de hecho, las soluciones modernas de la clase Network Traffic Analysis le permiten crear reglas muy flexibles y tener en cuenta no solo los par√°metros b√°sicos del encabezado del paquete IP: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/15/ya/uk/15yaukzbimtm-o-yf41wnibz2ik.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sino tambi√©n realice un an√°lisis m√°s profundo, hasta asociar el incidente con el nombre de usuario de Active Directory, buscar archivos maliciosos por hash (por ejemplo, obtenido como un indicador de compromiso de SOSOPKA, FinCERT, Cisco Threat Grid, etc.), etc.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dc/oe/55/dcoe55wr_luv_kvpjjrqwapc5jc.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es f√°cil de implementar. Por ejemplo, as√≠ es como la regla habitual busca detectar todo tipo de interacci√≥n entre servidores de bases de datos y nodos externos utilizando cualquier protocolo durante los √∫ltimos 30 d√≠as. Vemos que nuestras bases de datos "se comunicaron" con nodos externos al segmento DBMS utilizando los protocolos DNS, SMB y puerto 8088. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hn/70/nh/hn70nhlbp10lmjmgbkjj_8_bs8i.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s de la forma tabular para presentar los resultados de investigaciones o b√∫squedas, tambi√©n podemos visualizarlos. Para nuestro escenario, un fragmento del diagrama de flujo de la red puede verse as√≠: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zs/yv/jf/zsyvjfgvrptgxwgv0eefnyz5pju.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
y desde el mismo mapa podemos administrar pol√≠ticas: bloquear conexiones o automatizar el proceso de creaci√≥n de reglas de monitoreo para los flujos de inter√©s para nosotros.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ix/tj/rk/ixtjrkszqelbtsgpwdmdxdluubm.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ hay un ejemplo bastante interesante y animado del uso de herramientas de monitoreo de Netflow (y otros protocolos de flujo) para la ciberseguridad. </font><font style="vertical-align: inherit;">En las siguientes notas, planeo mostrar c√≥mo puede usar NTA para detectar c√≥digo malicioso (por ejemplo, Shamoon), servidores maliciosos (por ejemplo, la campa√±a DNSpionage), programas de acceso remoto (RAT), omitir proxies corporativos, etc.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es487332/index.html">Prueba las bombillas LED Ergolux baratas</a></li>
<li><a href="../es487334/index.html">C√≥mo "remoto" mejora la colaboraci√≥n</a></li>
<li><a href="../es487336/index.html">Unidad: habilite Multidex o demasiados m√©todos</a></li>
<li><a href="../es487340/index.html">Como hicimos el pr√≥ximo dise√±ador de chat bots. Parte 1</a></li>
<li><a href="../es487342/index.html">Lecci√≥n # 2 - Reuniones y eventos</a></li>
<li><a href="../es487348/index.html">Clasificaci√≥n de tareas prioritarias - aplicaci√≥n IL TEMPO</a></li>
<li><a href="../es487356/index.html">¬øVas a cambiar? Piensa otra vez</a></li>
<li><a href="../es487358/index.html">BERT, ELMO y Co. en im√°genes (c√≥mo la capacitaci√≥n de transferencia lleg√≥ a la PNL)</a></li>
<li><a href="../es487360/index.html">El anonimato de los datos no garantiza su completo anonimato.</a></li>
<li><a href="../es487362/index.html">Angular 9 ya est√° disponible: Ivy ha llegado</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>