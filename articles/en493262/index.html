<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï¥üèº „äôÔ∏è üîò Starting with Core Data! Difficult in simple words üêº ‚õ±Ô∏è ü§±üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A lot of topics have already been written with Core Data, but most of these articles are in English, as well as using a lot of ‚Äúsmart‚Äù words that can ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Starting with Core Data! Difficult in simple words</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493262/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A lot of topics have already been written with Core Data, but most of these articles are in English, as well as using a lot of ‚Äúsmart‚Äù words that can confuse beginners. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article, I will try to talk about this framework from Apple in an understandable language, so that even the "smallest" programmers can get out information for themselves, and get that minimum amount of knowledge that will help them in their projects either.</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Small offtopic</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Core Data is a very powerful tool that allows you to save data in your application and use it later. </font><font style="vertical-align: inherit;">In this article, I will NOT talk about working with multiple context with subsequent synchronization, how to solve migration problems and various advance features. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The target audience of this article is people who generally had no experience with Core Data.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Well ... Let's get started!</font></font></h4> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To start, you need to create the .xcdatamodeld file itself, after you open it, at the bottom of the screen you will see the ‚ÄúAdd entity‚Äù button. </font><font style="vertical-align: inherit;">By clicking on it, your object model will be created: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ti/eu/c5/tieuc5lzlieaqlnl2hzsnbgnypu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And now, in more detail:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Your Entity. </font><font style="vertical-align: inherit;">You can think of Entity as your data structure, which has inheritance from a certain class - NSManagedObject, and will also have certain fields for writing data, more on that later.</font></font></li>
<li> Attributes.    Entity    .    +       .    : <br>
<ul>
<li>Integer 16/32/64 ‚Äî        .       ,      .       Int,         .<br>
: Integer16(15)</li>
<li>Decimal/Double/Float ‚Äî          .       ,      .</li>
<li>String ‚Äî        .</li>
<li>Boolean ‚Äî        .</li>
<li>Date ‚Äî        Date. <br>
<blockquote>NOTE: Core Data           00:00:00 UTC 1  1970   .</blockquote></li>
<li>Binary Data ‚Äî       Data<br>
<blockquote>NOTE:      Allow External Storage. Core Data   ,     100 ,       Core Data        .           . </blockquote></li>
<li>UUID ‚Äî          UUID.</li>
<li>URI ‚Äî        URL</li>
<li>Transformable ‚Äî     ,       NSCoding.</li>
</ul><br>
</li>
<li> Relationship.           Entity. Relationships  :<br>
<br>
<ol>
<li>One-to-One</li>
<li>One-to-Many</li>
<li>Many-to-Many</li>
</ol><br>
  Relationships.<br>
 <br>
   3 Entities, Andrey, Home, Car. <br>
<br>
<ul>
<li>     ‚Äî One-to-One Relationship.</li>
<li>    1,    2    ‚Äî One-to-Many Relationship.</li>
<li> Many-to-Many Relationship     .                       .</li>
</ul></li>
<li>         Entity</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Codegen field. </font><font style="vertical-align: inherit;">In short, this field indicates who will govern the creation of NSManagedObject classes. </font><font style="vertical-align: inherit;">For ease of operation, select </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manual / None</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , then Core Data will be able to create the necessary classes for your Entity itself. </font><font style="vertical-align: inherit;">About it below.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To create our Entity class, use: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Editor&gt; Create NSManagedObject Subclass. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/d7/yl/b6/d7ylb6nrjnzpsqytkn4-lzq-ctq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you want to set default values ‚Äã‚Äãfor your attributes, use the method:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">awakeFromInsert</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.awakeFromInsert()<font></font>
        date = <span class="hljs-type">Date</span>()<font></font>
}</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Work with NSManagedObjectContext and PersistentStoreCoordinator</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Core Data Stack Hierarchy: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sp/jl/dr/spjldrdtwsjpgd5_6zxq7snxvj8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In simple terms, all of your Entitys are shown as Managed Objects in the diagram above. </font><font style="vertical-align: inherit;">All our Managed Objects are stored in NSManagedObjectContext. </font><font style="vertical-align: inherit;">Context It refers to the NSPersistentStoreCoordinator which stores your saved data as a Row Cache after accessing SQL, but this is not the case now. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To create an instance of your ManagedObject (Entity), you must refer to your NSPersistentContainer which is a wrapper for your NSPersistentStoreCoordinator.</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">var</span> persistentContainer: <span class="hljs-type">NSPersistentContainer</span> = {
      <span class="hljs-keyword">let</span> container = <span class="hljs-type">NSPersistentContainer</span>(name: <span class="hljs-string">"SavingLearn"</span>)<font></font>
      container.loadPersistentStores(completionHandler: { (storeDescription, error) <span class="hljs-keyword">in</span>
          <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> error = error <span class="hljs-keyword">as</span> <span class="hljs-type">NSError?</span> {
              <span class="hljs-built_in">fatalError</span>(<span class="hljs-string">"Unresolved error \(error), \(error.userInfo)"</span>)<font></font>
          }<font></font>
      })<font></font>
      <span class="hljs-keyword">return</span> container<font></font>
  }()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, we need to access the NSManagedObjectContext through our PersistentContainer: </font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">var</span> context: <span class="hljs-type">NSManagedObjectContext</span> = {
    <span class="hljs-keyword">return</span> persistentContainer.viewContext<font></font>
  }()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we can create an instance of our ManageObject from our context and assign it a value:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">var</span> person = <span class="hljs-type">Person</span>(context: context)<font></font>
person.age = <span class="hljs-number">32</span></code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saving Object</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To save, we use a simple function: </font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">saveContext</span> <span class="hljs-params">()</span></span> {
      <span class="hljs-keyword">if</span> context.hasChanges {
          <span class="hljs-keyword">do</span> {
              <span class="hljs-keyword">try</span> context.save()<font></font>
          } <span class="hljs-keyword">catch</span> {<font></font>
            context.rollback()<font></font>
              <span class="hljs-keyword">let</span> nserror = error <span class="hljs-keyword">as</span> <span class="hljs-type">NSError</span>
              <span class="hljs-built_in">fatalError</span>(<span class="hljs-string">"Unresolved error \(nserror), \(nserror.userInfo)"</span>)<font></font>
          }<font></font>
      }<font></font>
  }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the method above, we check our context for changes and if they are present, we make a save. </font><font style="vertical-align: inherit;">In case of an error, the method is executed:</font></font><br>
<br>
<pre><code class="swift hljs">context.rollback()</code></pre><br>
<blockquote><pre><code class="swift hljs">rollback()</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The method returns our context to its original state and cancels all changes that were made on it.</font></font></blockquote><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Delete object</font></font></b><br>
<br>
<pre><code class="swift hljs">context.delete(object)</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Allows us to easily remove an object from Core Data.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NOTE: For the changes to take effect, it is necessary to save the context, otherwise all changes will not be saved. </font></font><pre><code class="swift hljs">context.save()</code></pre> </blockquote><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Retrieving All Objects</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to get an array of our objects from Core Data, we must perform NSFetchRequest. </font><font style="vertical-align: inherit;">I will not go deep into the full power of FetchRequest since this article is designed for beginners.</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">let</span> fetchRequest: <span class="hljs-type">NSFetchRequest</span>&lt;<span class="hljs-type">Person</span>&gt; = <span class="hljs-type">Person</span>.fetchRequest()
<span class="hljs-keyword">let</span> objects = <span class="hljs-keyword">try</span> context.fetch(fetchRequest)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Under the hood, NSFetchRequest does a great job: </font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSFetchRequest Goes to Persistent Store Coordinator</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Persistent Store Coordinator sends request to Persistent Store </font></font></li>
<li>Persistent Store     SQL</li>
<li>SQL       .    ID  Row Value.  Row Value   Persistent Store      Row Cache   ID. </li>
<li>Persistent Store  Managed Objects   ID     Persistent Store Coordinator.    fault ()          .   Managed Object Context      ID, Core Data       SQL.</li>
<li>Persistent Store Coordinator   context  Managed Object</li>
<li>   Core Data    .        <pre><code class="swift hljs">includePendingChanges = <span class="hljs-literal">false</span></code></pre> </li>
<li>  NSManagedObject </li>
</ol><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NOTE: While the NSFetchRequest Managed Object Context is running and the Persistent Store Coordinator is running in a synchronous queue, all processes are blocked while another process is running. </font></font></blockquote><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article, I described the minimum information needed to work with Core Data in my opinion. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now you can create your own data models, save, delete and retrieve them. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you are interested in a more ‚Äúadvance‚Äù topic about working with Core Data and interesting tips, then write in the comments and I will figure out what can be done about it. </font><font style="vertical-align: inherit;">Happy coding!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en493244/index.html">What can a quantum computer</a></li>
<li><a href="../en493248/index.html">Webinar "Winnum Opportunities for Industrial Analytics"</a></li>
<li><a href="../en493250/index.html">What is happening with travel right now - and how to protect yourself in transport</a></li>
<li><a href="../en493252/index.html">Teaching experience at a development school, or why you need to go to school after university</a></li>
<li><a href="../en493254/index.html">The system of mass wiretapping of the population was practically useless for the FBI</a></li>
<li><a href="../en493264/index.html">Where you were before, or Implicit features of BI BA</a></li>
<li><a href="../en493266/index.html">45 youtube channels in English for IT professionals</a></li>
<li><a href="../en493268/index.html">Pentester Applied</a></li>
<li><a href="../en493272/index.html">How to enable Google docs offline in the new Microsoft Edge</a></li>
<li><a href="../en493274/index.html">30+ concise professional recommendations for Android developer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>