<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüë©‚Äçüëß üöÑ üìô Minecraft-Erstellung in einer Woche in C ++ und Vulkan üë®üèø‚Äçüíº üåΩ üé§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich habe mir die Aufgabe gestellt, Minecraft in einer Woche mit meiner eigenen Engine in C ++ und Vulkan von Grund auf neu zu erstellen. Ich wurde von...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Minecraft-Erstellung in einer Woche in C ++ und Vulkan</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487832/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich habe mir die Aufgabe gestellt, Minecraft in einer Woche mit meiner eigenen Engine in C ++ und Vulkan von Grund auf neu zu erstellen. </font><font style="vertical-align: inherit;">Ich wurde von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hopson</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> inspiriert </font><font style="vertical-align: inherit;">, der dasselbe mit C ++ und OpenGL tat. </font><font style="vertical-align: inherit;">Im Gegenzug wurde er von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shane Beck</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> inspiriert, der von Minecraft inspiriert war, dessen Inspirationsquelle Infiniminer war, dessen Entstehung vermutlich vom echten Bergbau inspiriert war.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa1/8b2/50c/aa18b250ce4120bd3a0dc94c01a63621.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das GitHub-Repository f√ºr dieses Projekt ist </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Jeder Tag hat sein eigenes Git-Tag. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nat√ºrlich hatte ich nicht vor, Minecraft buchst√§blich neu zu erschaffen. </font><font style="vertical-align: inherit;">Dieses Projekt sollte ein p√§dagogisches sein. </font><font style="vertical-align: inherit;">Ich wollte lernen, wie man Vulkan in etwas Komplizierterem als </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vulkan-tutorial.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder der Demo von Sasha Willem verwendet. </font><font style="vertical-align: inherit;">Daher liegt der Schwerpunkt auf dem Design der Vulkan-Engine und nicht auf dem Design des Spiels.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aufgaben</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Entwicklung auf Vulkan ist viel langsamer als auf OpenGL, daher konnte ich viele der Funktionen dieses Minecraft nicht in das Spiel integrieren. </font><font style="vertical-align: inherit;">Es gibt keine Mobs, kein Handwerk, keinen roten Stein, keine Blockphysik usw. </font><font style="vertical-align: inherit;">Die Ziele des Projekts waren von Anfang an folgende:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen eines Terrain-Rendering-Systems</font></font><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maischen</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beleuchtung</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen eines Gel√§ndegeneratorsystems</font></font><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linderung</font></font></li>
</ul><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B√§ume</font></font></li>
</ul><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Biomes</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hinzuf√ºgen der F√§higkeit, das Gel√§nde zu √§ndern und Bl√∂cke zu bewegen</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich musste einen Weg finden, dies alles zu implementieren, ohne dem Spiel eine GUI hinzuzuf√ºgen, da ich keine GUI-Bibliotheken finden konnte, die mit Vulkan funktionieren und einfach zu integrieren sind.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bibliotheken</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nat√ºrlich wollte ich keine Vulkan-Anwendung von Grund auf neu schreiben. </font><font style="vertical-align: inherit;">Um den Entwicklungsprozess zu beschleunigen, werde ich nach M√∂glichkeit vorgefertigte Bibliotheken verwenden. </font><font style="vertical-align: inherit;">N√§mlich:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VulkanWrapper</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - mein eigener C ++ - Wrapper f√ºr die Vulkan-API</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GLFW</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - f√ºr Windows und Benutzereingaben</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VulkanMemoryAllocator</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - zum </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Zuweisen</font></a><font style="vertical-align: inherit;"> von Vulkan-Speicher</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GLM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - f√ºr mathematische Vektoren und Matrizen</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - f√ºr Signale / Slots und ECS</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - f√ºr Dienstprogramme zum Laden von </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Bildern</font></a></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FastNoise</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - zur Erzeugung von 3D-Rauschen</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tag 1</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Am ersten Tag bereitete ich eine Vulkan-Kesselplatte und ein Motorskelett vor. </font><font style="vertical-align: inherit;">Der gr√∂√üte Teil des Codes war ein Boilerplate und ich konnte ihn einfach von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vulkan-tutorial.com kopieren</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Es enthielt auch einen Trick zum Speichern von Scheitelpunktdaten als Teil eines Scheitelpunkt-Shaders. </font><font style="vertical-align: inherit;">Dies bedeutete, dass ich nicht einmal die Speicherzuordnung anpassen musste. </font><font style="vertical-align: inherit;">Nur ein einfacher F√∂rderer, der nur eines kann: ein Dreieck zeichnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Engine ist einfach genug, um den Renderer von Dreiecken zu unterst√ºtzen. </font><font style="vertical-align: inherit;">Es hat ein Fenster und eine Spielschleife, an die Systeme angeschlossen werden k√∂nnen. </font><font style="vertical-align: inherit;">Die GUI ist durch die im Fenstertitel angezeigte Bildrate begrenzt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Projekt gliedert sich in zwei Teile: </font></font><code>VoxelEngine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>VoxelGame</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/875/3cd/190/8753cd190975239ad550e8c0c8b27d00.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tag 2</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe die Vulkan Memory Allocator-Bibliothek integriert. </font><font style="vertical-align: inherit;">Diese Bibliothek k√ºmmert sich um die meisten Funktionen der Vulkan-Speicherzuweisung: Speichertypen, Ger√§tespeicherhaufen und sekund√§re Zuweisung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem ich eine Speicherzuordnung hatte, erstellte ich Klassen f√ºr Netze und Scheitelpunktpuffer. </font><font style="vertical-align: inherit;">Ich habe den Renderer der Dreiecke so ge√§ndert, dass er die Klasse der Netze verwendet und nicht die im Shader integrierten Arrays. </font><font style="vertical-align: inherit;">Derzeit werden Netzdaten durch manuelles Rendern der Dreiecke an die GPU √ºbertragen.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/627/28d/0fc/62728d0fce9015f2be4dad88f18c7b7a.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es hat sich wenig ge√§ndert</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tag 3</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe ein Graph-Rendering-System hinzugef√ºgt. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dieser Beitrag wurde</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> als Grundlage f√ºr die Erstellung dieser Klasse verwendet </font><font style="vertical-align: inherit;">, die Klasse ist jedoch sehr vereinfacht. Mein Rendering-Diagramm enth√§lt nur die wesentlichen Elemente f√ºr die Synchronisierung mit Vulkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit dem Rendering-Diagramm kann ich </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Knoten</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font><em><font style="vertical-align: inherit;">Kanten</font></em><font style="vertical-align: inherit;"> festlegen</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Knoten sind die von der GPU ausgef√ºhrten Arbeiten. Rippen sind Datenabh√§ngigkeiten zwischen Knoten. Jeder Knoten erh√§lt einen eigenen Befehlspuffer, in den er schreibt. Der Graph besch√§ftigt sich mit doppelten Pufferbefehlspuffern und synchronisiert diese mit vorherigen Frames. Kanten werden verwendet, um F√∂rderbarrieren automatisch vor und nach dem Schreiben eines Knotens in jeden Befehlspuffer einzuf√ºgen. Pipeline-Barrieren synchronisieren die Verwendung aller Ressourcen und √ºbertragen den Besitz zwischen Warteschlangen. Au√üerdem f√ºgen Kanten Semaphoren zwischen Knoten ein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Knoten und Kanten bilden einen </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gerichteten azyklischen Graphen</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Anschlie√üend f√ºhrt das Rendering-Diagramm eine </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">topologische Sortierung durch.</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Knoten, was zur Erstellung einer flachen Liste von Knoten f√ºhrt, die so sortiert sind, dass jeder Knoten nach allen Knoten sucht, von denen er abh√§ngt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Engine hat drei Arten von Knoten. </font></font><code>AcquireNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">empf√§ngt ein Bild von der Pufferkette (Swapchain), </font></font><code>TransferNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ºbertr√§gt Daten von der CPU zur GPU und </font></font><code>PresentNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">liefert ein Bild der </font><font style="vertical-align: inherit;">anzuzeigenden Pufferkette </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jeder Knoten kann implementieren </font></font><code>preRender</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>render</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>postRender</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die in jedem Frame ausgef√ºhrt. </font></font><code>AcquireNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erh√§lt ein Bild einer Pufferkette w√§hrend </font></font><code>preRender</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>PresentNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">liefert dieses Bild p√ºnktlich </font></font><code>postRender</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe den Dreiecks-Renderer so √ºberarbeitet, dass er ein Rendering-Diagrammsystem verwendet, anstatt alles selbst zu verarbeiten. Es gibt eine Kante zwischen </font></font><code>AcquireNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und</font></font><code>TriangleRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sowie zwischen </font></font><code>TriangleRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>PresentNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dies stellt sicher, dass das Bild der Pufferkette w√§hrend ihrer Verwendung w√§hrend des Rahmens korrekt synchronisiert wird.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/12b/d88/6ba/12bd886ba9b41891ae1e2d0ff47b9929.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich schw√∂re, der Motor hat sich ver√§ndert</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tag 4</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe eine Kamera und ein 3D-Rendering-System erstellt. Bisher erh√§lt die Kamera einen eigenen permanenten Puffer- und Deskriptorpool. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe mich an diesem Tag verlangsamt, weil ich versucht habe, die richtige Konfiguration f√ºr das 3D-Rendering mit Vulkan zu finden. Das meiste Online-Material konzentriert sich auf das Rendern mit OpenGL, das leicht andere Koordinatensysteme als Vulkan verwendet. In OpenGL wird die Z-Achse des Clip-Bereichs als angegeben </font></font><code>[-1, 1]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und der obere Rand des Bildschirms befindet sich bei </font></font><code>Y = 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. In Vulkan wird die Z-Achse als angegeben </font></font><code>[0, 1]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und der obere Rand des Bildschirms befindet sich bei </font></font><code>Y = -1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Aufgrund dieser kleinen Unterschiede funktionieren die Standard-GLM-Projektionsmatrizen nicht richtig, da sie f√ºr OpenGL ausgelegt sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GLM hat eine Option</font></font><code>GLM_FORCE_DEPTH_ZERO_TO_ONE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Danach kann das Problem mit der Y-Achse behoben werden, indem das Vorzeichen des </font></font><code>(1, 1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projektionsmatrixelements </font><font style="vertical-align: inherit;">einfach </font><font style="vertical-align: inherit;">ge√§ndert wird (GLM verwendet die Indizierung von 0). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir die Y-Achse umdrehen, m√ºssen wir die Scheitelpunktdaten umdrehen, da zuvor die negative Richtung der Y-Achse nach oben zeigte.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8d9/05d/464/8d905d4643a189400471c7e8d4fbd3f6.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jetzt in 3D!</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tag 5</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe Benutzereingaben und die M√∂glichkeit hinzugef√ºgt, die Kamera mit der Maus zu bewegen. </font><font style="vertical-align: inherit;">Das Eingabesystem ist zu ausgefeilt, beseitigt jedoch die Kuriosit√§ten der GLFW-Eingabe. </font><font style="vertical-align: inherit;">Insbesondere hatte ich das Problem, die Position der Maus beim Blockieren zu √§ndern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Tastatur- und Mauseingabe ist im Wesentlichen ein d√ºnner Wrapper √ºber GLFW, der √ºber Signalhandler ge√∂ffnet wird </font></font><code>entt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nur zum Vergleich - ungef√§hr das gleiche, was Hopson am ersten Tag seines Projekts getan hat.</font></font><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ihr Browser unterst√ºtzt kein HTML5-Video.</font></font><source src="https://vazgriz.com/wp-content/uploads/2020/01/voxels.webm" type="video/webm"></video></div></div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tag 6</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich fing an, Code hinzuzuf√ºgen, um Voxelbl√∂cke zu generieren und zu rendern. </font><font style="vertical-align: inherit;">Das Schreiben des Vernetzungscodes war einfach, da ich es zuvor getan hatte und Abstraktionen kannte, mit denen ich weniger Fehler machen konnte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine der Abstraktionen war eine Vorlagenklasse </font></font><code>ChunkData&lt;T, chunkSize&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die einen W√ºrfel vom Typ der </font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gr√∂√üe </font></font><code>chunkSize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jeder Seite definiert. </font><font style="vertical-align: inherit;">Diese Klasse speichert Daten in einem 1D-Array und verarbeitet Indizierungsdaten mit einer 3D-Koordinate. </font><font style="vertical-align: inherit;">Die Gr√∂√üe jedes Blocks betr√§gt 16 x 16 x 16, daher sind die internen Daten ein einfaches Array mit einer L√§nge von 4096. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine andere Abstraktion besteht darin, einen Iterator von Positionen zu erstellen, der Koordinaten von </font></font><code>(0, 0, 0)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bis </font><font style="vertical-align: inherit;">generiert</font></font><code>(15, 15, 15)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Diese beiden Klassen stellen sicher, dass Iterationen mit Blockdaten in einer linearen Reihenfolge ausgef√ºhrt werden, um die Cache-Lokalit√§t zu erh√∂hen. </font><font style="vertical-align: inherit;">Die 3D-Koordinate ist weiterhin f√ºr andere Operationen verf√ºgbar, die sie ben√∂tigen. </font><font style="vertical-align: inherit;">Zum Beispiel:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (glm::ivec3 pos : Chunk::Positions()) {
    <span class="hljs-keyword">auto</span>&amp; data = chunkData[pos];<font></font>
    glm::ivec3 offset = ...;<font></font>
    <span class="hljs-keyword">auto</span>&amp; neighborData = chunkData[pos + offset];<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe mehrere statische Arrays, die die Offsets angeben, die √ºblicherweise im Spiel verwendet werden. </font><font style="vertical-align: inherit;">Beispielsweise werden </font></font><code>Neighbors6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6 Nachbarn definiert, mit denen der W√ºrfel gemeinsame Fl√§chen hat.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">array</span>&lt;glm::ivec3, 6&gt; Neighbors6 = {<font></font>
        glm::ivec3(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>),    <span class="hljs-comment">//right</span>
        glm::ivec3(<span class="hljs-number">-1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>),   <span class="hljs-comment">//left</span>
        glm::ivec3(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),    <span class="hljs-comment">//top</span>
        glm::ivec3(<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">0</span>),   <span class="hljs-comment">//bottom</span>
        glm::ivec3(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>),    <span class="hljs-comment">//front</span>
        glm::ivec3(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-1</span>)    <span class="hljs-comment">//back</span>
    };</code></pre><br>
<code>Neighbors26</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Dies sind alles Nachbarn, mit denen der W√ºrfel eine gemeinsame Fl√§che, Kante oder einen gemeinsamen Scheitelpunkt hat. </font><font style="vertical-align: inherit;">Das hei√üt, es ist ein 3x3x3-Raster ohne zentralen W√ºrfel. </font><font style="vertical-align: inherit;">Es gibt auch √§hnliche Arrays f√ºr andere S√§tze von Nachbarn und f√ºr 2D-S√§tze von Nachbarn. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt ein Array, das die Daten definiert, die zum Erstellen einer Seite des Cubes erforderlich sind. </font><font style="vertical-align: inherit;">Die Richtungen jeder Fl√§che in diesem Array entsprechen den Richtungen in dem Array </font></font><code>Neighbors6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">array</span>&lt;FaceArray, 6&gt; NeighborFaces = {
    <span class="hljs-comment">//right face</span><font></font>
    FaceArray {<font></font>
        glm::ivec3(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<font></font>
        glm::ivec3(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),<font></font>
        glm::ivec3(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>),<font></font>
        glm::ivec3(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>),<font></font>
    },<font></font>
    ...<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dank dessen ist der Code zur Netzerstellung sehr einfach. Es umgeht einfach die Daten der Bl√∂cke und f√ºgt eine Fl√§che hinzu, wenn der Block fest ist, sein Nachbar jedoch nicht. Der Code √ºberpr√ºft einfach jede Seite jedes W√ºrfels in einem Block. Dies √§hnelt der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> beschriebenen "naiven" Methode </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (glm::ivec3 pos : Chunk::Positions()) {<font></font>
    Block block = chunk.blocks()[pos];<font></font>
    <span class="hljs-keyword">if</span> (block.type == <span class="hljs-number">0</span>) <span class="hljs-keyword">continue</span>;<font></font>
<font></font>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; Chunk::Neighbors6.size(); i++) {<font></font>
        glm::ivec3 offset = Chunk::Neighbors6[i];<font></font>
        glm::ivec3 neighborPos = pos + offset;<font></font>
<font></font>
        <span class="hljs-comment">//<span class="hljs-doctag">NOTE:</span> bounds checking omitted</span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> (chunk.blocks()[neighborPos].type == <span class="hljs-number">0</span>) {<font></font>
            Chunk::FaceArray&amp; faceArray = Chunk::NeighborFaces[i];<font></font>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> j = <span class="hljs-number">0</span>; j &lt; faceArray.size(); j++) {<font></font>
                m_vertexData.push_back(pos + faceArray[j]);<font></font>
                m_colorData.push_back(glm::i8vec4(pos.x * <span class="hljs-number">16</span>, pos.y * <span class="hljs-number">16</span>, pos.z * <span class="hljs-number">16</span>, <span class="hljs-number">0</span>));<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe ersetzt </font></font><code>TriangleRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">durch </font></font><code>ChunkRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ich habe auch einen Tiefenpuffer hinzugef√ºgt, damit das Blocknetz korrekt gerendert werden kann. Es war notwendig, dem Rendering-Diagramm zwischen </font></font><code>TransferNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font><font style="vertical-align: inherit;">eine weitere Kante hinzuzuf√ºgen </font></font><code>ChunkRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Diese Kante √ºbertr√§gt den Besitz der Ressourcen der Warteschlangenfamilie zwischen der √úbertragungswarteschlange und der Grafikwarteschlange. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann habe ich die Engine so ge√§ndert, dass Fensterwechselereignisse korrekt verarbeitet werden k√∂nnen. In OpenGL geschieht dies einfach, in Vulkan jedoch eher verwirrend. Da die Pufferkette explizit erstellt werden muss und eine konstante Gr√∂√üe hat, m√ºssen Sie das Fenster beim √Ñndern der Gr√∂√üe neu erstellen. Sie m√ºssen alle Ressourcen neu erstellen, die von der Pufferkette abh√§ngen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alle Befehle, die von der Pufferkette abh√§ngen (und jetzt sind dies alle Zeichenbefehle), m√ºssen die Ausf√ºhrung abschlie√üen, bevor die alte Pufferkette zerst√∂rt wird. </font><font style="vertical-align: inherit;">Dies bedeutet, dass die gesamte GPU inaktiv ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie m√ºssen die Grafikpipeline √§ndern, um ein dynamisches Ansichtsfenster bereitzustellen und die Gr√∂√üe zu √§ndern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine Pufferkette kann nicht erstellt werden, wenn die Fenstergr√∂√üe auf der X- oder Y-Achse 0 betr√§gt, auch wenn das Fenster minimiert ist. </font><font style="vertical-align: inherit;">Das hei√üt, wenn dies geschieht, wird das gesamte Spiel angehalten und nur fortgesetzt, wenn sich das Fenster √∂ffnet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt ist das Netz ein einfaches dreidimensionales Schachbrett. </font><font style="vertical-align: inherit;">Die RGB-Farben des Netzes werden entsprechend seiner XYZ-Position multipliziert mit 16 eingestellt.</font></font><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ihr Browser unterst√ºtzt kein HTML5-Video.</font></font><source src="https://vazgriz.com/wp-content/uploads/2020/01/voxels2.webm" type="video/webm"></video></div></div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tag 7</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe den Spielprozess nicht nur f√ºr einen, sondern f√ºr mehrere Bl√∂cke gleichzeitig durchgef√ºhrt. Mehrere Bl√∂cke und ihre Netze werden von der ECS-Bibliothek verwaltet </font></font><code>entt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Dann habe ich den Block-Renderer so √ºberarbeitet, dass alle Bl√∂cke in ECS gerendert wurden. Ich habe immer noch nur einen Block, aber ich </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k√∂nnte</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bei Bedarf neue hinzuf√ºgen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe das Netz √ºberarbeitet, damit seine Daten nach der Erstellung aktualisiert werden k√∂nnen. Auf diese Weise kann ich das Blocknetz in Zukunft aktualisieren, wenn ich die M√∂glichkeit zum Hinzuf√ºgen und Entfernen von Cubes hinzuf√ºge. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie einen W√ºrfel hinzuf√ºgen oder entfernen, kann die Anzahl der Scheitelpunkte im Netz m√∂glicherweise zunehmen oder abnehmen. Der zuvor ausgew√§hlte Scheitelpunktpuffer kann nur verwendet werden, wenn das neue Netz dieselbe Gr√∂√üe oder kleiner hat. Wenn das Netz jedoch gr√∂√üer ist, m√ºssen neue Scheitelpunktpuffer erstellt werden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der vorherige Scheitelpunktpuffer kann nicht sofort gel√∂scht werden. Es k√∂nnen Befehlspuffer aus vorherigen Frames ausgef√ºhrt werden, die f√ºr ein bestimmtes Objekt spezifisch sind </font></font><code>VkBuffer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Die Engine muss einen Puffer behalten, bis diese Befehlspuffer vollst√§ndig sind. Das hei√üt, wenn wir ein Netz in einem Frame zeichnen </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, kann die GPU diesen Puffer verwenden, bevor der Frame startet </font></font><code>i + 2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Der Puffer kann nicht aus der CPU entfernt werden, bis die GPU ihn nicht mehr verwendet. Deshalb habe ich das Rendering-Diagramm so ge√§ndert, dass es die Lebensdauer der Ressourcen verfolgt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn der Rendering-Diagrammknoten eine Ressource (Puffer oder Bild) verwenden m√∂chte, muss er die Methode </font></font><code>sync</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">innerhalb der Methode </font><font style="vertical-align: inherit;">aufrufen </font></font><code>preRender</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Diese Methode erh√§lt einen Zeiger </font></font><code>shared_ptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf eine Ressource. Diese</font></font><code>shared_ptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stellt sicher, dass die Ressource nicht gel√∂scht wird, w√§hrend Befehlspuffer ausgef√ºhrt werden. </font><font style="vertical-align: inherit;">(In Bezug auf die Leistung ist diese L√∂sung nicht sehr gut. Dazu sp√§ter mehr.) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt wird das Blocknetz in jedem Frame neu generiert.</font></font><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ihr Browser unterst√ºtzt kein HTML5-Video.</font></font><source src="https://vazgriz.com/wp-content/uploads/2020/01/voxels3.webm" type="video/webm"></video></div></div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das ist alles, was ich in einer Woche getan habe - ich habe die Grundlagen f√ºr das Rendern der Welt mit mehreren Voxelbl√∂cken vorbereitet und werde in der zweiten Woche weiterarbeiten.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de487812/index.html">Testen der polnischen LED-Spektrum-LED E27</a></li>
<li><a href="../de487814/index.html">Geschwindigkeit und Zuverl√§ssigkeit sind h√∂her und der Preis ist niedriger. Neue Kingston KC2000 Solid State Drives</a></li>
<li><a href="../de487822/index.html">AvitoTech On Tour: Android-Treffen in Nischni Nowgorod</a></li>
<li><a href="../de487824/index.html">√úbersicht der LED-Lampen Spectrum Led GU10 aus Europa</a></li>
<li><a href="../de487826/index.html">√úbersicht der LED-Lampen von Poland Spectrum Led E14</a></li>
<li><a href="../de487834/index.html">Sicherheitswoche 07: Sicherheitsanf√§lligkeit in Android Bluetooth Stack</a></li>
<li><a href="../de487836/index.html">Interaktives Hochladen von Dateien auf den Server mit RxJS</a></li>
<li><a href="../de487838/index.html">Datenvalidierung: Ein anderer Ansatz</a></li>
<li><a href="../de487842/index.html">2 SIM f√ºr einen L√§nderrouter - ist es viel oder wenig?</a></li>
<li><a href="../de487844/index.html">Der Geruch offenbart</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>