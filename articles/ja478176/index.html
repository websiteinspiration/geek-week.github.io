<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💣 🧔🏿 👨🏾‍🏫 投票率は失敗しました。AgentTeslaをきれいな水に持ち込みました。パート1 🙅🏼 🎠 👨‍👨‍👦‍👦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="最近、ヨーロッパの電気機器メーカーがGroup-IBに連絡しました-その従業員は、悪意のある添付ファイルが添付された不審なメールをメールで受信しました。CERT Group-IBマルウェア分析スペシャリストであるIlya Pomerantsevは、このファイルの詳細な分析を実行し、そこにAgentT...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>投票率は失敗しました。AgentTeslaをきれいな水に持ち込みました。パート1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/group-ib/blog/478176/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/vz/an/r5/vzanr5kxitvhd3zqrcdh1qhctjm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最近、ヨーロッパの電気機器メーカーがGroup-IBに連絡しました-その従業員は、悪意のある添付ファイルが添付された不審なメールをメールで受信しました。</font><font style="vertical-align: inherit;">CERT Group-IBマルウェア分析スペシャリストである</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ilya Pomerantsev</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、このファイルの詳細な分析を実行し、そこにAgentTeslaスパイウェアを発見し、そのようなマルウェアに何が期待できるか、およびそれがどれほど危険であるかを伝えました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この投稿では、このような潜在的に危険なファイルの分析方法に関する一連の記事を公開します。12月5日に、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「マルウェア分析：実際のケースの分析」</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">というトピックに関する無料のインタラクティブウェビナーを待ってい</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">詳細はすべてカットの下にあります。</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分配メカニズム</font></font><br>
</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マルウェアはフィッシングメールを介して被害者のマシンに侵入したことがわかっています。</font><font style="vertical-align: inherit;">手紙の受取人はおそらくブラインドコピーに入れられました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/cb/qj/sa/cbqjsaal0zmv_a1ged3_ocr3kpg.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ヘッダーを分析すると、手紙の差出人が改ざんされていることがわかります。</font><font style="vertical-align: inherit;">実際、この手紙は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vps56 [。] Oneworldhosting [。] Com</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から</font><b><font style="vertical-align: inherit;">削除さ</font></b><font style="vertical-align: inherit;">れ</font><b><font style="vertical-align: inherit;">ました</font></b><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/sd/xt/e-/sdxte-21bsjzr-vu4vlwdiyxzma.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
レターの添付ファイルには</font><font style="vertical-align: inherit;">、悪意のある実行可能ファイル</font><b><font style="vertical-align: inherit;">QOUTE_JPEG56A.exe</font></b><font style="vertical-align: inherit;">が含まれたWinRar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qoute_jpeg56a.r15</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アーカイブが含まれてい</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/5y/k6/7a/5yk67a4dwqqujs6nnymscwr26-w.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HPEエコシステム</font></font><br>
</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、調査中のマルウェアのエコシステムがどのように見えるかを見てみましょう。</font><font style="vertical-align: inherit;">以下の図は、その構造とコンポーネントの相互作用の方向を示しています。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/er/9d/nw/er9dnwfyfi60al-d9f7m-baquhm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、マルウェアの各コンポーネントをより詳細に検討します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ローダ</font></font><br>
</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ソースファイル</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QOUTE_JPEG56A.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、コンパイルされた</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoIt v3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qs/ab/l8/qsabl8h3dkqgshlrmzgewzivmti.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
元のスクリプトを難読化するために、同じ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PELock AutoIT-Obfuscator</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特性を</font><font style="vertical-align: inherit;">持つ難読化ツール</font><font style="vertical-align: inherit;">が使用されました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
解読は3つの段階で実行されます。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">難読化の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For-If</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
の</font><font style="vertical-align: inherit;">削除</font><font style="vertical-align: inherit;">最初のステップは、スクリプト制御フローを復元することです。</font><font style="vertical-align: inherit;">制御フローのフラット化は、アプリケーションのバイナリコードを分析から保護する最も一般的な方法の1つです。</font><font style="vertical-align: inherit;">混乱する変換は、アルゴリズムとデータ構造の分離と認識の複雑さを劇的に増大させます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/hq/d_/7x/hqd_7xi045crcr8uricahnyke5i.png"></div><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文字列の復元文字列</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
を暗号化するには、2つの関数が使用されます。</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gdorizabegkvfca-Base64のようなデコードを実行する</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ai/3z/ed/ai3zedm-utilwnwrxhan2pwlkve.png"></div></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xgacyukcyzxz-最初の行と2番目の長さの単純なバイトXOR</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/mc/mi/m6/mcmim6zvyn5qqtvsudsj2ddj5hy.png"></div><br>
</li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/mo/4e/33/mo4e33oeg-zhx-nkiqitjjr7nlm.png"></div><br>
</li>
<li><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">難読化BinaryToStringの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">削除</font><font style="vertical-align: inherit;">と</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実行</font></font></b><br>
 <br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qy/fq/zx/qyfqzxdgaqfk3mmc3qdmwox6mes.png"></div><br>
</li>
</ol><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メインロードは</font><font style="vertical-align: inherit;">、ファイルリソースセクションの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fonts</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディレクトリに分割形式で保存され</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/fy/2z/wv/fy2zwviixrr3ydjfefzy_mx6egs.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下を接着するための手順：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TIEQHCXWFG</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IME</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPDGUHIMPV</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KQJMWQQAQTKTFXTUOSW</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AOCHKRWWSKWO</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSHMSJPS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NHHWXJBMTTSPXVN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BFUTIFWWXVE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HWJHO</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVZOUMVFRDWFLWU</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
抽出されたデータを復号化するには、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptDecrypt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> WinAPI関数を使用</font><font style="vertical-align: inherit;">し、値</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fZgFiZlJDxvuWatFRgRXZqmNCIyQgMYcに</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基づいて生成されたセッションキーをキーとして使用します</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
復号化された実行可能ファイルは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RunPE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数に入力され、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProcessInject</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を実装</font><font style="vertical-align: inherit;">します。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">組み込みの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ShellCode</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RunPE ShellCodeと</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も呼ばれる</font><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">を使用する</font><b><font style="vertical-align: inherit;">RegAsm.exe </font></b><font style="vertical-align: inherit;">著者名は、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wardow</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">というニックネーム</font><font style="vertical-align: inherit;">のスペイン語フォーラム</font><b><font style="vertical-align: inherit;">indetectables [。] Net</font></b><font style="vertical-align: inherit;">のユーザーに属しています</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/-w/9v/8h/-w9v8hqygcur0zjvrlok6zz0puw.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/so/10/3i/so103ijljljvad0moazodumpbw0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、このフォーラムのブランチの1つで</font><font style="vertical-align: inherit;">、サンプルの分析中に特定された同様のプロパティ</font><font style="vertical-align: inherit;">を使用して</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoItの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">難読化ツール</font><b><font style="vertical-align: inherit;">が</font></b><font style="vertical-align: inherit;">議論されたことも注目に値し</font><font style="vertical-align: inherit;">ます。</font><b><font style="vertical-align: inherit;">ShellCode</font></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
自体</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非常にシンプルで、ハッカーグループAnunak \ Carbanakから借りただけの注目を集めています。</font><font style="vertical-align: inherit;">API呼び出しのハッシュ関数。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7t/rj/s4/7trjs4ewwspmnjjyiyfunnuawiu.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/yg/lt/z2/ygltz2j5yhznpute3zgur78gcjm.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各種バージョンの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フレンチシェルコードを</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
使用した事例も</font><b><font style="vertical-align: inherit;">ござい</font></b><font style="vertical-align: inherit;">ます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
説明した機能に加えて、非アクティブな機能も明らかにしました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タスクマネージャでプロセスの手動完了をブロックする</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/pi/lo/wz/pilowznac2anmd86fc6evhbukts.png"></div></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子プロセスが終了した場合の再起動</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/bn/yd/rq/bnydrqweveygh-7ijjkhe95r16k.png"></div></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UACバイパス</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ya/to/fm/yatofmi3btmiulx2-2fojqh6p4g.png"></div></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ペイロードをファイルに保存しています</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/dx/qq/bq/dxqqbqh5qmc8ss8js2pqqfhoiim.png"></div></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モーダルウィンドウのデモ</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/no/rb/zl/norbzlid8wuif16l0d0tmpq1lfy.png"></div></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保留中のマウスカーソルの位置</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/y7/nw/pd/y7nwpd0hdou7qtbw7hb-qcpmrdq.png"></div></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AntiVMおよびAntiSandbox</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gt/it/zo/gtitzosbkm1ly4k9hgxbw1fvsts.png"></div></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自己破壊</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/6h/la/1f/6hla1fqy4aihydzu-trd2dq22xq.png"></div></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワークからのペイロードのダウンロード</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/dr/lp/4j/drlp4j5zwf-9qjpwmtwheqnxvlg.png"></div></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのような機能は</font><font style="vertical-align: inherit;">、明らかに調査中のブートローダーである</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CypherIT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> treadの特徴であることはわかって</font><font style="vertical-align: inherit;">います。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/w-/6q/j5/w-6qj5tvrnzxqq2lkq-61k499-0.png"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPOコアモジュール</font></font><br>
</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、マルウェアのメインモジュールについて簡単に説明します。詳細については、2番目の記事で取り上げます。</font><font style="vertical-align: inherit;">この場合、それは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.NETアプリケーションです</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ai/_7/vz/ai_7vzhtgmvmr9ls9qew3kckpzw.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分析の結果、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConfuserEX</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">難読化ツールが</font><b><font style="vertical-align: inherit;">使用さ</font></b><font style="vertical-align: inherit;">れていることがわかりました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/za/ir/or/zairor-n4gu5n07o2h1vo1u_hjq.png"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IELibrary.dll</font></font><br>
</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ライブラリはメインモジュールのリソースとして保存され、</font><font style="vertical-align: inherit;">Internet ExplorerやEdgeブラウザからさまざまな情報を抽出する機能を提供する</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AgentTeslaの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">よく知られたプラグインです</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agent Teslaは、合法的なキーロガー製品を装ってサービスとしてマルウェアとして配布されるモジュール型スパイソフトウェアです。</font><font style="vertical-align: inherit;">エージェントテスラは、ユーザー資格情報を抽出してサーバー上のブラウザー、電子メールクライアント、FTPクライアントに送信し、クリップボードデータを登録して、デバイスの画面をキャプチャできます。</font><font style="vertical-align: inherit;">分析時には、開発者の公式ウェブサイトは利用できませんでした。</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エントリポイントは</font><font style="vertical-align: inherit;">、InternetExplorerクラスの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetSavedPasswords</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数</font><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/n3/aq/ew/n3aqew1u7g6u-1feuebla2l-ll8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、コードの実行は線形であり、分析に対する保護手段は含まれていません。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">望ましくない</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">唯一の</font><b><font style="vertical-align: inherit;">GetSavedCookies</font></b><font style="vertical-align: inherit;">関数</font><b><font style="vertical-align: inherit;">に注目してください</font></b><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">どうやら、プラグインの機能は拡張されるはずでしたが、これは決して行われませんでした。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/fv/7p/2r/fv7p2rozdp2nq-f2diripyzcl0c.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">システムでのブートローダーの保護</font></font><br>
</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システムでブートローダーがどのように修正されるかを調べます。</font><font style="vertical-align: inherit;">テスト標本は固定されませんが、同様のイベントでは、次のスキームに従って発生します。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C：\ Users \ Public</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォルダーに</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Visual Basic</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトが作成さ</font><font style="vertical-align: inherit;">れます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スクリプトの例：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/af/fz/gq/affzgqk0pc1srvaw3n41kqgprzo.png"></div></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブートローダーファイルの内容にはヌル文字が埋め込まれ、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％Temp％\ &lt;フォルダー名&gt; \ &lt;ファイル名&gt;フォルダーに保存されます</font></font></b><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自動実行キーは、</font><b><font style="vertical-align: inherit;">HKCU \ Software \ Microsoft \ Windows \ CurrentVersion \ Run \ &lt;script name&gt;スクリプトファイル</font></b><font style="vertical-align: inherit;">のレジストリに作成され</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></b><br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、分析の最初の部分の結果によると、調査したマルウェアのすべてのコンポーネントのファミリの名前を確立し、感染スキームを分析し、署名を書き込むためのオブジェクトを取得することもできました。</font><font style="vertical-align: inherit;">次の記事では、このオブジェクトの分析を続けます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">メインの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AgentTesla</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モジュールについて詳しく説明します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">お見逃しなく！</font></font><br>
<br>
<blockquote> , 5           «  :   »,    ,  CERT-GIB,  -      —        -  ,       .   ,       .     : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>.  !</blockquote><br>
<br>
<h2>Yara</h2><br>
<br>
<pre><code class="json hljs">rule AgentTesla_clean{<font></font>
meta:<font></font>
    author = <span class="hljs-string">"Group-IB"</span>
    file = <span class="hljs-string">"78566E3FC49C291CB117C3D955FA34B9A9F3EEFEFAE3DE3D0212432EB18D2EAD"</span>
    scoring = <span class="hljs-number">5</span>
    family = <span class="hljs-string">"AgentTesla"</span><font></font>
strings:<font></font>
    $string_format_AT = {74 00 79 00 70 00 65 00 3D 00 7B 00 30 00 7D 00 0D 00 0A 00 68 00 77 00 69 00 64 00 3D 00 7B 00 31 00 7D 00 0D 00 0A 00 74 00 69 00 6D 00 65 00 3D 00 7B 00 32 00 7D 00 0D 00 0A 00 70 00 63 00 6E 00 61 00 6D 00 65 00 3D 00 7B 00 33 00 7D 00 0D 00 0A 00 6C 00 6F 00 67 00 64 00 61 00 74 00 61 00 3D 00 7B 00 34 00 7D 00 0D 00 0A 00 73 00 63 00 72 00 65 00 65 00 6E 00 3D 00 7B 00 35 00 7D 00 0D 00 0A 00 69 00 70 00 61 00 64 00 64 00 3D 00 7B 00 36 00 7D 00 0D 00 0A 00 77 00 65 00 62 00 63 00 61 00 6D 00 5F 00 6C 00 69 00 6E 00 6B 00 3D 00 7B 00 37 00 7D 00 0D 00 0A 00 73 00 63 00 72 00 65 00 65 00 6E 00 5F 00 6C 00 69 00 6E 00 6B 00 3D 00 7B 00 38 00 7D 00 0D 00 0A 00 5B 00 70 00 61 00 73 00 73 00 77 00 6F 00 72 00 64 00 73 00 5D 00}<font></font>
    $web_panel_format_string = {63 00 6C 00 69 00 65 00 6E 00 74 00 5B 00 5D 00 3D 00 7B 00 30 00 7D 00 0D 00 0A 00 6C 00 69 00 6E 00 6B 00 5B 00 5D 00 3D 00 7B 00 31 00 7D 00 0D 00 0A 00 75 00 73 00 65 00 72 00 6E 00 61 00 6D 00 65 00 5B 00 5D 00 3D 00 7B 00 32 00 7D 00 0D 00 0A 00 70 00 61 00 73 00 73 00 77 00 6F 00 72 00 64 00 5B 00 5D 00 3D 00 7B 00 33 00 7D 00 00 15 55 00 52 00 4C 00 3A 00 20 00 20 00 20 00 20 00 20 00 20 00 00 15 55 00 73 00 65 00 72 00 6E 00 61 00 6D 00 65 00 3A 00 20 00 00 15 50 00 61 00 73 00 73 00 77 00 6F 00 72 00 64 00 3A 00}<font></font>
condition:<font></font>
     all of them<font></font>
}<font></font>
<font></font>
rule  AgentTesla_obfuscated {<font></font>
meta:<font></font>
    author = <span class="hljs-string">"Group-IB"</span>
    file = <span class="hljs-string">"41DC0D5459F25E2FDCF8797948A7B315D3CB075398D808D1772CACCC726AF6E9"</span>
    scoring = <span class="hljs-number">5</span>
    family = <span class="hljs-string">"AgentTesla"</span><font></font>
strings:<font></font>
    $first_names = {61 66 6B 00 61 66 6D 00 61 66 6F 00 61 66 76 00 61 66 79 00 61 66 78 00 61 66 77 00 61 67 6A 00 61 67 6B 00 61 67 6C 00 61 67 70 00 61 67 72 00 61 67 73 00 61 67 75 00}<font></font>
    $second_names = <span class="hljs-string">"IELibrary.resources"</span><font></font>
condition:<font></font>
     all of them<font></font>
}<font></font>
<font></font>
rule AgentTesla_module_for_IE{<font></font>
meta:<font></font>
    author = <span class="hljs-string">"Group-IB"</span>
    file = <span class="hljs-string">"D55800A825792F55999ABDAD199DFA54F3184417215A298910F2C12CD9CC31EE"</span>
    scoring = <span class="hljs-number">5</span>
    family = <span class="hljs-string">"AgentTesla_module_for_IE"</span><font></font>
strings:<font></font>
    $s0 = <span class="hljs-string">"ByteArrayToStructure"</span> 
    $s1 = <span class="hljs-string">"CryptAcquireContext"</span> 
    $s2 = <span class="hljs-string">"CryptCreateHash"</span> 
    $s3 = <span class="hljs-string">"CryptDestroyHash"</span> 
    $s4 = <span class="hljs-string">"CryptGetHashParam"</span> 
    $s5 = <span class="hljs-string">"CryptHashData"</span>
    $s6 = <span class="hljs-string">"CryptReleaseContext"</span> 
    $s7 = <span class="hljs-string">"DecryptIePassword"</span> 
    $s8 = <span class="hljs-string">"DoesURLMatchWithHash"</span> 
    $s9 = <span class="hljs-string">"GetSavedCookies"</span> 
    $s10 = <span class="hljs-string">"GetSavedPasswords"</span> 
    $s11 = <span class="hljs-string">"GetURLHashString"</span>  <font></font>
condition:<font></font>
     all of them<font></font>
}<font></font>
<font></font>
rule RunPE_shellcode {<font></font>
meta:<font></font>
    author = <span class="hljs-string">"Group-IB"</span>
    file = <span class="hljs-string">"37A1961361073BEA6C6EACE6A8601F646C5B6ECD9D625E049AD02075BA996918"</span>
    scoring = <span class="hljs-number">5</span>
    family = <span class="hljs-string">"RunPE_shellcode"</span><font></font>
strings:<font></font>
    $malcode = {<font></font>
      C7 [2-5] EE 38 83 0C <span class="hljs-comment">// mov     dword ptr [ebp-0A0h], 0C8338EEh</span>
      C7 [2-5] 57 64 E1 01 <span class="hljs-comment">// mov     dword ptr [ebp-9Ch], 1E16457h</span>
      C7 [2-5] 18 E4 CA 08 <span class="hljs-comment">// mov     dword ptr [ebp-98h], 8CAE418h</span>
      C7 [2-5] E3 CA D8 03 <span class="hljs-comment">// mov     dword ptr [ebp-94h], 3D8CAE3h</span>
      C7 [2-5] 99 B0 48 06 <span class="hljs-comment">// mov     dword ptr [ebp-90h], 648B099h</span>
      C7 [2-5] 93 BA 94 03 <span class="hljs-comment">// mov     dword ptr [ebp-8Ch], 394BA93h</span>
      C7 [2-5] E4 C7 B9 04 <span class="hljs-comment">// mov     dword ptr [ebp-88h], 4B9C7E4h</span>
      C7 [2-5] E4 87 B8 04 <span class="hljs-comment">// mov     dword ptr [ebp-84h], 4B887E4h</span>
      C7 [2-5] A9 2D D7 01 <span class="hljs-comment">// mov     dword ptr [ebp-80h], 1D72DA9h</span>
      C7 [2-5] 05 D1 3D 0B <span class="hljs-comment">// mov     dword ptr [ebp-7Ch], 0B3DD105h</span>
      C7 [2-5] 44 27 23 0F <span class="hljs-comment">// mov     dword ptr [ebp-78h], 0F232744h</span>
      C7 [2-5] E8 6F 18 0D <span class="hljs-comment">// mov     dword ptr [ebp-74h], 0D186FE8h</span><font></font>
      }<font></font>
condition:<font></font>
    $malcode <font></font>
}<font></font>
<font></font>
rule AgentTesla_AutoIT_module{<font></font>
meta:<font></font>
    author = <span class="hljs-string">"Group-IB"</span>
    file = <span class="hljs-string">"49F94293F2EBD8CEFF180EDDD58FA50B30DC0F08C05B5E3BD36FD52668D196AF"</span>
    scoring = <span class="hljs-number">5</span>
    family = <span class="hljs-string">"AgentTesla"</span><font></font>
strings:                                    <font></font>
    $packedexeau = {55 ED F5 9F 92 03 04 44 7E 16 6D 1F 8C D7 38 E6 29 E4 C8 CF DA 2C C4 E1 F3 65 48 25 B8 93 9D 66 A4 AD 3C 39 50 00 B9 60 66 19 8D FC 20 0A A0 56 52 8B 9F 15 D7 62 30 0D 5C C3 24 FE F8 FC 39 08 DF 87 2A B2 1C E9 F7 06 A8 53 B2 69 C3 3C D4 5E D4 74 91 6E 9D 9A A0 96 FD DB 1F 5E 09 D7 0F 25 FB 46 4E 74 15 BB AB DB 17 EE E7 64 33 D6 79 02 E4 85 79 14 6B 59 F9 43 3C 81 68 A8 B5 32 BC E6}<font></font>
condition:<font></font>
     all of them<font></font>
}<font></font>
</code></pre><br>
<br>
<h2>Hashes</h2><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<td> <strong>Name</strong></td>
<td> qoute_jpeg56a.r15</td>
</tr>
<tr>
<td> <strong>MD5</strong></td>
<td> 53BE8F9B978062D4411F71010F49209E</td>
</tr>
<tr>
<td> <strong>SHA1</strong></td>
<td> A8C2765B3D655BA23886D663D22BDD8EF6E8E894</td>
</tr>
<tr>
<td> <strong>SHA256</strong></td>
<td> 2641DAFB452562A0A92631C2849B8B9CE880F0F8F<br>
 <br>
890E643316E9276156EDC8A</td>
</tr>
<tr>
<td> <strong>Type</strong></td>
<td> Archive WinRAR</td>
</tr>
<tr>
<td> <strong>Size</strong></td>
<td> 823014</td>
</tr>
</tbody></table></div><br>
 <br>
<div class="scrollable-table"><table>
<tbody><tr>
<td> <strong>Name</strong></td>
<td> QOUTE_JPEG56A.exe</td>
</tr>
<tr>
<td> <strong>MD5</strong></td>
<td> 329F6769CF21B660D5C3F5048CE30F17</td>
</tr>
<tr>
<td> <strong>SHA1</strong></td>
<td> 8010CC2AF398F9F951555F7D481CE13DF60BBECF</td>
</tr>
<tr>
<td> <strong>SHA256</strong></td>
<td> 49F94293F2EBD8CEFF180EDDD58FA50B30DC0F08<br>
 <br>
C05B5E3BD36FD52668D196AF</td>
</tr>
<tr>
<td> <strong>Type</strong></td>
<td> PE (Compiled AutoIt Script)</td>
</tr>
<tr>
<td> <strong>Size</strong></td>
<td> 1327616</td>
</tr>
<tr>
<td> <strong>OrginalName</strong></td>
<td> Unknown</td>
</tr>
<tr>
<td> <strong>DateStamp</strong></td>
<td> 15.07.2019</td>
</tr>
<tr>
<td> <strong>Linker</strong></td>
<td> Microsoft Linker(12.0)[EXE32]</td>
</tr>
</tbody></table></div><br>
 <br>
<div class="scrollable-table"><table>
<tbody><tr>
<td> <strong>MD5</strong></td>
<td> C2743AEDDADACC012EF4A632598C00C0</td>
</tr>
<tr>
<td> <strong>SHA1</strong></td>
<td> 79B445DE923C92BF378B19D12A309C0E9C5851BF</td>
</tr>
<tr>
<td> <strong>SHA256</strong></td>
<td> 37A1961361073BEA6C6EACE6A8601F646C5B6ECD<br>
 <br>
9D625E049AD02075BA996918</td>
</tr>
<tr>
<td> <strong>Type</strong></td>
<td> ShellCode</td>
</tr>
<tr>
<td> <strong>Size</strong></td>
<td> 1474</td>
</tr>
</tbody></table></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja478158/index.html">プログラムでElseの使用を停止する</a></li>
<li><a href="../ja478162/index.html">学習と娯楽のためのホログラム</a></li>
<li><a href="../ja478164/index.html">マイクロソフトの研究者が量子コンピューティングへの貢献により、権威ある理論物理学賞を受賞</a></li>
<li><a href="../ja478168/index.html">Goでの計画：パートI-OSプランナー</a></li>
<li><a href="../ja478170/index.html">レールブレーキの真実：パート1</a></li>
<li><a href="../ja478178/index.html">Windows Terminal Preview 0.7がリリースされました</a></li>
<li><a href="../ja478182/index.html">Intel Myriad Xチップとニューラルネットワーク推論におけるスケーラビリティ</a></li>
<li><a href="../ja478184/index.html">マウスの代わりのKDE接続、または最初の接続の落とし穴</a></li>
<li><a href="../ja478186/index.html">既製のビジネスを合法的に失う方法の物語</a></li>
<li><a href="../ja478188/index.html">PowerShellを使用してインシデント情報を収集する</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>