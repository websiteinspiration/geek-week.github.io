<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚒 😵 👨🏼‍⚕️ Nous ajoutons une vérification de hachage de chasseur de rootkit dans le script quotidien 🦎 🖖🏿 🎶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="À cause de toute cette udalenka, il s'est avéré que l'ordinateur portable d'entraînement, à moitié vide auparavant, est devenu la principale machine d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Nous ajoutons une vérification de hachage de chasseur de rootkit dans le script quotidien</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496346/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">À cause de toute cette udalenka, il s'est avéré que l'ordinateur portable d'entraînement, à moitié vide auparavant, est devenu la principale machine de travail et cela vaut la peine de le protéger de manière plus réfléchie. Ce qui, en général, est clairement suggéré par les autorités. Sur l'ordinateur portable est maintenant Ubuntu 20.04 beta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout a commencé avec des paramètres BIOS clairs et un chiffrement complet du disque, sur lesquels je ne devrais probablement pas écrire. Mais j'ai alors décidé de comprendre ce que l'utilitaire </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rkhunter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> («rootkit, backdoor, sniffer et exploit scanner») </font><font style="vertical-align: inherit;">peut faire au niveau du fichier </font><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'attendais pas grand-chose du logiciel qui n'avait pas été mis à jour depuis quelques années. </font><font style="vertical-align: inherit;">Je dois dire tout de suite que je doute beaucoup de l'utilisation des signatures de février 2018 pour rechercher des rootkits, mais l'un des autres modes de fonctionnement - vérifier les hachages de fichiers, m'a intéressé. </font><font style="vertical-align: inherit;">Qui est intéressé par une telle expérience et ce qui s'est passé jusqu'à présent - bienvenue chez cat.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'idée est simple - mais ajoutons une vérification dans le script des choses utiles du matin pour voir si les hachages MD5 des fichiers pour lesquels ils ne devraient pas changer n'ont pas changé. </font><font style="vertical-align: inherit;">Au moins jusqu'à ce que les mises à jour de paquets devraient. </font><font style="vertical-align: inherit;">Une telle liste très légère, mais pas inutile, à mon avis. </font><font style="vertical-align: inherit;">La version actuelle capable de calculer et de vérifier les hachages de l'utilitaire est définie simplement par le gestionnaire de paquets:</font></font><br>
<br>
<pre><code class="bash hljs">apt search rkhunter<font></font>
rkhunter/focal,focal,now 1.4.6-8 all [installed]<font></font>
  rootkit, backdoor, sniffer and exploit scanner</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La configuration principale du chasseur se trouve dans /etc/rkhunter.conf et d'abord, pour résoudre mon problème, voici les paramètres que j'ai définis:</font></font><br>
<br>
<pre><code class="bash hljs">ENABLE_TESTS=hashes</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Car, à part les hashs, rien ne m'intéresse encore. </font><font style="vertical-align: inherit;">La liste des autres tests possibles peut être obtenue par la commande</font></font><br>
<br>
<pre><code class="bash hljs">sudo rkhunter --list <span class="hljs-built_in">test</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je considère toujours que la collision MD5-ok est liée aux mathématiques, mais pas à la pratique. </font><font style="vertical-align: inherit;">Je n'insiste pas sur cette opinion, mais presque tous les jours je regarde de bons logiciels malveillants et jusqu'à présent je n'ai pas rencontré de tels conflits dans la nature. </font><font style="vertical-align: inherit;">Donc pour l'instant dans la config ça me suffit.</font></font><br>
 <br>
<pre><code class="bash hljs">HASH_CMD=MD5</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puis il a indiqué son gestionnaire de paquets et, surtout, les répertoires, les hachages de fichiers qui m'intéressent. </font><font style="vertical-align: inherit;">Le chemin sera, par exemple, / bin et / usr / bin. </font><font style="vertical-align: inherit;">Concernant les fichiers apparus dans les répertoires, mais qui n'étaient pas là au moment du calcul, le chasseur donnera également des avertissements.</font></font><br>
 <br>
<pre><code class="bash hljs">PKGMGR=DPKG<font></font>
USER_FILEPROP_FILES_DIRS=/bin/*<font></font>
USER_FILEPROP_FILES_DIRS=/usr/bin/*</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un point important: avec mes paramètres, l'analyse n'est pas basée sur des packages, mais sur des répertoires. C'est probablement plus correct, car les packages contiennent beaucoup de fichiers non exécutables et ils doivent d'abord être filtrés, par exemple, via le fichier. Jusqu'à présent, j'ai choisi la voie pour augmenter la liste des répertoires et des exceptions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons maintenant terminé la configuration du scanner, il est maintenant temps de mettre à jour la base des hachages corrects dans /var/lib/rkhunter/db/rkhunter.dat avec les nouveaux paramètres. Pour ce faire, vous avez besoin d'une commande (elle prend également les noms des packages à ajouter à la base de données, si vous allez dans l'autre sens).</font></font><br>
<br>
<pre><code class="bash hljs">sudo rkhunter --propupd</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après cela, tous les fichiers qui vous intéressent et leurs hachages devraient apparaître dans rkhunter.dat. Dans mon cas, ce sont 2847 fichiers et l'indexeur a pris 9m 2117. C’est un peu beaucoup, par exemple, pour trois mille MD5, considérant md5sum pour / bin / ls pour 0,003s, mais il y en a vraiment. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voilà, nous sommes prêts à effectuer un contrôle. Pas encore en combat, il est peu probable que certains malwares aient déjà réussi à changer les hachages.</font></font><br>
<br>
<pre><code class="bash hljs">sudo rkhunter -c</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe une clé très utile ici - rwo (signaler uniquement les avertissements), qui ignorera toutes les comparaisons réussies et ne donnera que des avertissements. </font><font style="vertical-align: inherit;">Vous devez rechercher le résultat du travail dans /var/log/rkhunter.log. </font><font style="vertical-align: inherit;">Quant à la vitesse de la vérification, pour mes presque trois mille binaires c'était 10m 27,489s, comparable au temps d'indexation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons trié la vérification, mais la question reste de réindexer lors de la mise à jour des packages. </font><font style="vertical-align: inherit;">Ceux. </font><font style="vertical-align: inherit;">nous avons mis à jour apt et ne considérons plus tous les fichiers mis à jour comme des logiciels malveillants. </font><font style="vertical-align: inherit;">Le scanner a une autre configuration / etc / default / rkhunter pour automatiser les tâches. </font><font style="vertical-align: inherit;">Nous y définirons le paramètre.</font></font><br>
<br>
<pre><code class="bash hljs">APT_AUTOGEN=<span class="hljs-string">"yes"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et dans /etc/apt/apt.conf.d/90rkhunter se trouve un script qui est responsable de la post-réindexation:</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
 // Makes sure that rkhunter file properties database is updated after each remove or install only APT_AUTOGEN is enabled<font></font>
 DPkg::Post-Invoke { <span class="hljs-string">"if [ -x /usr/bin/rkhunter ] &amp;&amp; grep -qiE '^APT_AUTOGEN=.?(true|yes)' /etc/default/rkhunter; then /usr/share/rkhunter/scripts/rkhupd.sh; fi"</span>; };</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, tout le monde, tous les ajouts sont heureux d'accepter. </font><font style="vertical-align: inherit;">J'espère que cela a été utile.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr496336/index.html">À quoi servent les compteurs intelligents?</a></li>
<li><a href="../fr496338/index.html">Crise et c'est tout</a></li>
<li><a href="../fr496340/index.html">Nous formons un réseau compétitif génératif pour dessiner des images sur Azure ML</a></li>
<li><a href="../fr496342/index.html">Mise à jour du processus CI / CD: teamcity</a></li>
<li><a href="../fr496344/index.html">Les hackathons en ligne de quarantaine sont-ils le bon moment?</a></li>
<li><a href="../fr496348/index.html">Études de cas sur l'API de stockage Web</a></li>
<li><a href="../fr496350/index.html">Vous ne pouvez pas passer! - Les imprimantes 3D répondent au coronavirus</a></li>
<li><a href="../fr496354/index.html">Programmation informatique ternaire: jouer avec l'émulateur</a></li>
<li><a href="../fr496356/index.html">Création d'un navigateur à l'aide de technologies de réalité augmentée et de méthodes d'apprentissage automatique</a></li>
<li><a href="../fr496358/index.html">Se préparer à célébrer la Journée de la cosmonautique en ligne (la liste est en cours de mise à jour)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>