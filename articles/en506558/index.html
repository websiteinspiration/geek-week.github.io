<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî∏ üêÅ üßìüèø Apartment automation ü•¶ üçà üåö</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Background
 The old dream of apartment automation began its transformation into reality by buying an apartment in a new building. Already at the stage...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Apartment automation</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/506558/"><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Background</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The old dream of apartment automation began its transformation into reality by buying an apartment in a new building. </font><font style="vertical-align: inherit;">Already at the stage of repair planning, the main requirements for utility networks emerged:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flexible control of lighting, water supply, ventilation, heating and power loads;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the possibility of implementing scenarios;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">remote control and notification;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">centralized shutdown of all lighting;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">centralized shutdown of non-priority loads and water supply;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the future - the possibility of voice control.</font></font></li>
</ol><a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Electrician</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since for me the most reliable control option is a wired circuit, it was decided to start implementing the idea with a rework of the electrics. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
According to the developer‚Äôs project, all the loads were divided into 4 groups:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">boiler;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lighting;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kitchen and corridor outlets;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">all the rest.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All modular automation was located in the floor board, 4 cables entered the apartment - 2 3x2.5 mm2 and 2 3x1.5 mm2, which did not meet my needs. </font><font style="vertical-align: inherit;">It was decided to haul the cable from the floor board and transfer the switchboard directly to the apartment. </font><font style="vertical-align: inherit;">As a result, a counter and an introductory circuit breaker for 40A remained in the floor board, then a 3x6 mm2 cable to the apartment board. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When designing an apartment board, the following requirements were taken into account:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">surge protection;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">priority (non-disconnectable) load;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">non-priority (disconnected) load;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">differential protection on ‚Äúdangerous‚Äù groups (everything that is operated in humid rooms, everything connected with water and everything that children can reach).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, the following scheme emerged:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/aj/ho/ue/ajhoueqw41w1cblhjxspipmvilm.png" alt="image"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All loads were divided into disconnectable and non-disconnectable groups. </font><font style="vertical-align: inherit;">Non-disconnectable groups include: power supply for the refrigerator, boiler, low-current cabinet and controller. </font><font style="vertical-align: inherit;">The disconnected group, to which all other loads belong, is powered through a common circuit breaker and contactor, which will be controlled by signals from the controller, and we will also pick up the status signal from the contactor to the controller. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To accommodate all the necessary modular automation, a built-in shield for 72 modules was chosen (as it later turned out - there is not much space in the shield). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The process of completely remaking electricians inside the apartment has begun. </font><font style="vertical-align: inherit;">Of the features - cable routes from all light sources and switches were brought directly into the apartment panel.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Automation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Due to the fact that in my practice I had to deal with industrial automation, various options for PLC and PLR from Siemens, ABB, Schneider-Electric, Aries, etc. were considered as control devices. </font><font style="vertical-align: inherit;">As a result, the choice fell on the ONI PLR programmable logic relay (PLR-S-CPU-1004R-AC-BE, further, for brevity, the controller). </font><font style="vertical-align: inherit;">Why exactly so:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">built-in RS-485 bus with Modbus protocol support;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">discrete outputs implemented in the form of 3 and 10 ampere relays;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">power supply from 220V; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">compact sizes;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">form factor for mounting on a DIN rail;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the presence of a screen and controls directly on the case;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">price.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since 10 digital inputs and 4 relay outputs were not enough, in addition to the main unit, two expansion modules with 8 digital inputs, 4 relay outputs 3A, 4 relay outputs 10A were selected. </font><font style="vertical-align: inherit;">Development for this relay is carried out using the functional diagram language (FBD).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Water supply</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The builder sold the water supply to the apartment in such a way that there are 3 cold water risers in the apartment. </font><font style="vertical-align: inherit;">Because </font><font style="vertical-align: inherit;">Since hot water is prepared in a gas boiler, to completely turn off the water, for example in the bathroom, it is necessary to block both the riser in the bathroom and the riser in the kitchen, from which the boiler is powered. </font><font style="vertical-align: inherit;">On this basis, to control the water supply and as a system of protection against leaks, 3 sets of Hydro-locks (self-powered drives and sensors) were purchased, which have the ability to combine a centralized external control into a single system, as well as to receive a signal about the operation of leakage sensors. </font><font style="vertical-align: inherit;">An STP cable was connected to the installation location of each drive from the apartment panel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mounted ball valve with actuator:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/a1/ul/oc/a1ulocy0gp7iy1wpjhdzi_d4fag.png" alt="image"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Management software selection</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Because </font><font style="vertical-align: inherit;">I am a user of various Samsung gadgets, as a software platform for management I decided to stay on SmartThings software, which supports integration via a cloud connector. </font><font style="vertical-align: inherit;">To connect ONI PLR with SmartThings Cloud, you will need to develop an OPC server and CloudConnector. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the future, integration with the GSM modem is planned as a backup control channel, as well as for emergency notification of emergency situations. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, the following diagram of the interaction of system components emerged:</font></font><br>
 <br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/me/am/eg/meameg3yhqclqqe6m3glbkjuvkg.png" alt="image"></div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The biggest problem at this stage was the supply of components, as </font><font style="vertical-align: inherit;">the beginning of work coincided with the beginning of the period of self-isolation. </font><font style="vertical-align: inherit;">And since the time to repair the apartment was very limited, all the stuffing for the shield had to be collected by 5 suppliers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All the necessary cables were laid around the apartment, brought into the shield and marked accordingly. </font><font style="vertical-align: inherit;">The intermediate result can be seen in the photo below:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zi/23/en/zi23en4sgef8kzorqyyavsyfz38.png" alt="image"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To realize the possibility of habitual lighting control directly from the rooms, standard single-key and two-key switches with an unsecured position were used. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The connection of switches and loads to the controller was carried out according to the following scheme:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/bi/mr/on/bimrontj12po6p3cvftv2qtt1la.png" alt="image"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Switches</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gg/zj/yj/ggzjyjcktctegzkyknlgorzhilc.png" alt="image"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
During the controller commissioning and debugging, strange delays of 0.5 - 1 second were noticed when switching on / off the relay outputs located in the expansion modules. </font><font style="vertical-align: inherit;">The problem turned out to be very commonplace - inattentive study of manuals. </font><font style="vertical-align: inherit;">Before connecting, it was necessary to set the addresses for the expansion modules with DIP switches, as soon as this was done, the controller worked like a clock. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Currently, the assembled shield in the interior is as follows:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/z0/ms/e3/z0mse3wc4hbhqlylva1-7zhxnii.png" alt="image"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Currently implemented the following functions:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lighting control from switches, for a number of rooms - from several places;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simple scenarios with automatic activation of ventilation in rooms with high humidity (so far without appropriate sensors, only on the basis of typical behavioral scenarios, based on the time people were in the rooms);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">general shutdown of lighting (separate switch);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">forced shutdown of water supply;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shutdown of water supply when wet sensors.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the near future, implementation of interaction with the SmartThings ecosystem, implementation of more complex work scenarios. </font><font style="vertical-align: inherit;">At the moment, finishing work is being completed, the implementation of the program part of the project is planned after the move.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en506530/index.html">How to choose a UPS</a></li>
<li><a href="../en506532/index.html">Through thorns to the stars: make a device for pointing a laser pointer at any celestial object</a></li>
<li><a href="../en506538/index.html">How Wikipedia can reveal your personal data and how it actually uses it</a></li>
<li><a href="../en506542/index.html">DIY video recording to the cloud</a></li>
<li><a href="../en506548/index.html">Practical use of Kotlin in startups and enterprises</a></li>
<li><a href="../en506560/index.html">What to listen to on the weekend: 5 selected issues of the Russian-language podcast on audio technology</a></li>
<li><a href="../en506562/index.html">Why is it better to compile TS in JS in advance</a></li>
<li><a href="../en506568/index.html">Project Evaluation Levels and Moments</a></li>
<li><a href="../en506570/index.html">Functional FizzBuzz on Scala</a></li>
<li><a href="../en506572/index.html">Creating a prototype SPA online store on htmlix.js</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>