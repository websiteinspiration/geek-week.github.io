<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏻‍🔧 👌🏽 🧜 Quelques subtilités des collections d'injection au printemps 🍽️ 🔙 🧚🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour à tous! Je m'appelle Vladislav Rodin. J'enseigne actuellement des cours sur l'architecture logicielle et l'architecture logicielle à haute cha...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Quelques subtilités des collections d'injection au printemps</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/487750/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonjour à tous! </font><font style="vertical-align: inherit;">Je m'appelle Vladislav Rodin. </font><font style="vertical-align: inherit;">J'enseigne actuellement des cours sur l'architecture logicielle et l'architecture logicielle à haute charge sur le portail OTUS. </font><font style="vertical-align: inherit;">Maintenant, dans OTUS, il y a un ensemble ouvert pour le nouveau fil du cours de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">développeur sur Spring Framework</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En prévision du début du cours, j'ai décidé d'écrire un petit matériel de copyright que je veux partager avec vous.</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/z-/xc/bw/z-xcbwfaea9ckpi7rtggkasvdmq.png"><br>
<hr><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexte</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le printemps contient beaucoup de «magie» en lui-même, réalisant lui-même certaines choses non évidentes. </font><font style="vertical-align: inherit;">L'ignorance ou l'incompréhension de cela peut entraîner des effets secondaires que vous pouvez rencontrer lors de l'écriture de votre application à l'aide de ce cadre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'une de ces choses non évidentes est l'injection d'interfaces Java Collection Framework. </font><font style="vertical-align: inherit;">Après être monté de façon indépendante sur un rake lié à ce sujet, et après avoir entendu les prochaines questions de mes collègues, j'ai décidé de le trier et d'enregistrer les résultats de mes recherches sous la forme d'un article dans l'espoir que cela aiderait quelqu'un déjà au travail ou pendant le développement initial de Spring.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scénario</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinons un service qui fonctionnera avec les héros de cinéma. </font><font style="vertical-align: inherit;">Il y en aura 3: Rambo, Terminator et Gandalf. </font><font style="vertical-align: inherit;">Chacun d'eux représentera une classe distincte, et leur parent sera commun - Hero.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Hero</span> </span>{<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Rambo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Hero</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Rambo"</span>;<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Terminator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Hero</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Terminator"</span>;<font></font>
    }<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Gandalf</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Hero</span> </span>{
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Gandalf"</span>;<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liste d'injection</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supposons que nous voulons créer un service qui fonctionnera avec les héros des militants. </font><font style="vertical-align: inherit;">Vous devrez probablement y injecter une liste de ces héros. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aucun problème! </font><font style="vertical-align: inherit;">Créez un service et une configuration:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ActionHeroesService</span> </span>{
    <span class="hljs-meta">@Autowired</span><font></font>
    List&lt;Hero&gt; actionHeroes;<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HeroesConfig</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Hero&gt; <span class="hljs-title">action</span><span class="hljs-params">()</span> </span>{<font></font>
        List&lt;Hero&gt; result = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<font></font>
        result.add(<span class="hljs-keyword">new</span> Terminator());<font></font>
        result.add(<span class="hljs-keyword">new</span> Rambo());
        <span class="hljs-keyword">return</span> result;<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout va bien, mais lors de la vérification, il peut être constaté que Gandalf est sur la liste! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Spring, voyant qu'il était nécessaire d'injecter la List, a fait le tour des haricots situés dans le contexte, a trouvé parmi eux tous ceux qui correspondent au type générique, a collecté la List et l'a injectée, ignorant notre List. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment faire en sorte que Spring fasse ce que nous voulons?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option 1. Béquille</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Étant donné que le problème consiste précisément à injecter l'interface de Java Collection Framework, vous pouvez simplement remplacer List par ArrayList dans le service et, bien sûr, dans la configuration afin que Spring trouve une instance de la classe dont nous avons besoin. </font><font style="vertical-align: inherit;">Ensuite, tout fonctionnera comme prévu.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HeroesConfig</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ArrayList&lt;Hero&gt; <span class="hljs-title">action</span><span class="hljs-params">()</span> </span>{<font></font>
        ArrayList&lt;Hero&gt; result = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<font></font>
        result.add(<span class="hljs-keyword">new</span> Terminator());<font></font>
        result.add(<span class="hljs-keyword">new</span> Rambo());
        <span class="hljs-keyword">return</span> result;<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ActionHeroesService</span> </span>{
    <span class="hljs-meta">@Autowired</span><font></font>
    ArrayList&lt;Hero&gt; actionHeroes;<font></font>
}<font></font>
</code></pre> <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option 2. Plus correcte</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre façon de lier les mains de Spring est de lui demander d'injecter dans le service non pas n'importe quelle liste, mais un bean avec un nom spécial, en ajoutant Qualifier. </font><font style="vertical-align: inherit;">Ainsi, nous pourrons injecter notre bean.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ActionHeroesService</span> </span>{
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-meta">@Qualifier("action")</span><font></font>
    List&lt;Hero&gt; actionHeroes;<font></font>
}<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cartes d'injection</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si beaucoup de gens connaissent la nuance de l'injection de List, alors les choses sont généralement pires avec la carte. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Écrivons un service qui fonctionnera avec les personnages principaux des films. Une carte y sera injectée, contenant les noms des films par les touches, et par les valeurs des beans des personnages principaux:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainCharactersService</span> </span>{
    <span class="hljs-meta">@Autowired</span><font></font>
    Map&lt;String, Hero&gt; mainCharactersByFilmName;<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HeroesConfig</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Hero&gt; <span class="hljs-title">mainCharactersByFilmName</span><span class="hljs-params">()</span> </span>{<font></font>
        Map&lt;String, Hero&gt; result = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<font></font>
<font></font>
        result.put(<span class="hljs-string">"rambo"</span>, <span class="hljs-keyword">new</span> Rambo());<font></font>
        result.put(<span class="hljs-string">"terminator"</span>, <span class="hljs-keyword">new</span> Terminator());<font></font>
        result.put(<span class="hljs-string">"LOTR"</span>, <span class="hljs-keyword">new</span> Gandalf());<font></font>
<font></font>
        <span class="hljs-keyword">return</span> result;<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au démarrage, vous pouvez voir que la clé de Gandalf n'est pas LOTR, mais gandalf, dont nous pouvons conclure que ce n'est pas le nom du film qui a été écrit, mais le nom du bean, alors que dans le cas de Rimbaud et du terminateur, il était juste chanceux: les noms des personnages principaux coïncident avec titres de films. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, quand il est nécessaire d'injecter une Map, dont la clé est String, et la valeur des beans, Spring (comme dans le cas de la List) ignorera simplement la Map que nous avons proposée, parcourra le contexte et collectera tous les beans appropriés s, et créera une carte avec eux comme valeurs et avec leurs noms comme clés. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les solutions de contournement sont similaires à celles qui ont fonctionné pour la liste:</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option 1. Béquille</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Remplacez la carte par HashMap:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainCharactersService</span> </span>{
    <span class="hljs-meta">@Autowired</span><font></font>
    HashMap&lt;String, Hero&gt; mainCharactersByFilmName;<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HeroesConfig</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> HashMap&lt;String, Hero&gt; <span class="hljs-title">mainCharactersByFilmName</span><span class="hljs-params">()</span> </span>{<font></font>
        HashMap&lt;String, Hero&gt; result = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<font></font>
<font></font>
        result.put(<span class="hljs-string">"rambo"</span>, <span class="hljs-keyword">new</span> Rambo());<font></font>
        result.put(<span class="hljs-string">"terminator"</span>, <span class="hljs-keyword">new</span> Terminator());<font></font>
        result.put(<span class="hljs-string">"LOTR"</span>, <span class="hljs-keyword">new</span> Gandalf());<font></font>
<font></font>
        <span class="hljs-keyword">return</span> result;<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option 2. Plus correcte</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajouter un qualificatif:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainCharactersService</span> </span>{
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-meta">@Qualifier("mainCharactersByFilmName")</span><font></font>
    Map&lt;String, Hero&gt; mainCharactersByFilmName;<font></font>
}<font></font>
<font></font>
</code></pre></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr487740/index.html">Assemblage d'un magnétomètre portable</a></li>
<li><a href="../fr487742/index.html">Négociation d'arbitrage (algorithme Bellman-Ford)</a></li>
<li><a href="../fr487744/index.html">FARO présente le scanner laser laser FOCUS S 70</a></li>
<li><a href="../fr487746/index.html">Éternel</a></li>
<li><a href="../fr487748/index.html">Clé de chiffrement matériel à 3 $ - est-ce possible?</a></li>
<li><a href="../fr487752/index.html">Optimiser le stockage: un cas d'unification et de moindre coût de possession</a></li>
<li><a href="../fr487754/index.html">Organisation de l'intranet (automatisation de la production informatique). Partie 1 - Utilisateurs et courrier</a></li>
<li><a href="../fr487756/index.html">RIT, Maxim Lapshin (Erlyvideo): comment un programmeur pour faire croître une entreprise</a></li>
<li><a href="../fr487764/index.html">J'ai 14 ans et je combine l'école avec le travail en informatique</a></li>
<li><a href="../fr487768/index.html">Ouverture des ports 4321 et 9898 sur Xiaomi Gateway 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>