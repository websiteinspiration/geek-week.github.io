<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙇🏼 🏪 🥖 Gestion des packages avec les modules Go: un guide pragmatique 🤞🏼 😅 👦🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour à tous. En prévision du début du cours de développeur de Golang, nous avons préparé une autre traduction intéressante pour vous.
 
 
 Les modu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Gestion des packages avec les modules Go: un guide pragmatique</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/503918/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonjour à tous. </font><font style="vertical-align: inherit;">En prévision du début du cours de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">développeur de Golang, nous avons</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> préparé une autre traduction intéressante pour vous.</font></font></b></i><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les modules sont un moyen de gérer les dépendances dans Go. Initialement présentés comme une expérience, les modules sont censés être introduits sur le terrain en tant que nouveau standard de gestion des packages à partir de la version 1.13. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je trouve ce sujet assez inhabituel pour les débutants venant d'autres langues, et j'ai donc décidé de rassembler ici quelques réflexions et conseils pour aider d'autres comme moi à se faire une idée de la gestion des packages dans Go. Nous commencerons par une introduction générale, puis passerons à des aspects moins évidents, notamment l'utilisation du dossier du fournisseur, l'utilisation de modules avec Docker en développement, les dépendances des outils, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous êtes déjà familier avec les modules Go et connaissez le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wiki</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, comme le dos de votre main, cet article ne vous sera probablement pas très utile. </font><font style="vertical-align: inherit;">Mais pour le reste, cependant, cela peut économiser plusieurs heures d'essais et d'erreurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, si vous êtes en route, sautez et profitez de la balade.</font></font><a name="habracut"></a><br>
<br>
<img src="https://habrastorage.org/webt/tr/d9/eq/trd9eqcuki5uwi4w5b2gexcp8q4.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Démarrage rapide</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si le contrôle de version est déjà intégré dans votre projet, vous pouvez simplement exécuter</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> mod init</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou spécifiez le chemin d'accès au module manuellement. </font><font style="vertical-align: inherit;">C'est quelque chose comme un nom, une URL et un chemin d'importation pour votre package:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> mod init github.com/you/hello</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela créera un fichier </font></font><code>go.mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui définit également les exigences du projet et le lochit en fonction de leur version correcte (par analogie pour vous, c'est comme </font></font><code>package.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et </font></font><code>package-lock.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">combiné en un seul fichier):</font></font><br>
<br>
<pre><code class="go hljs">module github.com/you/hello
<span class="hljs-keyword">go</span> <span class="hljs-number">1.12</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exécutez </font></font><code>go get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour ajouter une nouvelle dépendance à votre projet: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">notez que bien que vous ne puissiez pas spécifier une plage de versions avec go get, ce que vous définissez ici n'est pas une version spécifique, mais une version minimale. </font><font style="vertical-align: inherit;">Comme nous le verrons plus tard, il existe un moyen de mettre à jour les dépendances avec élégance selon semver.</font></font></i><br>
<br>
<pre><code class="go hljs"># use Git tags
<span class="hljs-keyword">go</span> get github.com/<span class="hljs-keyword">go</span>-chi/chi@v4<span class="hljs-number">.0</span><span class="hljs-number">.1</span><font></font>
# or Git branch name<font></font>
<span class="hljs-keyword">go</span> get github.com/<span class="hljs-keyword">go</span>-chi/chi@master<font></font>
# or Git commit hash<font></font>
<span class="hljs-keyword">go</span> get github.com/<span class="hljs-keyword">go</span>-chi/chi@<span class="hljs-number">08</span>c92af</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, notre dossier est </font></font><code>go.mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le suivant:</font></font><br>
<br>
<pre><code class="go hljs">module github.com/you/hello
<span class="hljs-keyword">go</span> <span class="hljs-number">1.12</span>
require github.com/<span class="hljs-keyword">go</span>-chi/chi v4<span class="hljs-number">.0</span><span class="hljs-number">.2</span>+incompatible <span class="hljs-comment">// indirect</span></code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le suffixe est </font></font><code>+incompatible</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ajouté à tous les packages qui ne sont pas encore configurés pour les modules Go ou violent leurs règles de contrôle de version. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme nous n'avons importé ce package nulle part dans notre projet, il a été marqué comme </font></font><code>// indirect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nous pouvons ranger cela avec la commande suivante:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> mod tidy</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selon l'état actuel de votre référentiel, il supprimera un module inutilisé ou supprimera un commentaire </font></font><code>// indirect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si aucune dépendance en elle-même n'en a </font></font><code>go.mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(par exemple, elle n'est pas encore configurée pour les modules), alors toutes ses dépendances seront écrites dans le fichier parent </font></font><code>go.mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(en option, votre fichier </font></font><code>go.mod)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec un commentaire </font></font><code>// indirect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour indiquer qu'elles ne proviennent pas de l'importation directe Dans votre</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
plan global, l'objectif </font></font><code>go mod tidy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est également d'ajouter toutes les dépendances nécessaires pour d'autres combinaisons de systèmes d'exploitation, d'architectures et de balises de génération. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assurez-vous de l'exécuter avant chaque version.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Assurez-vous également qu'un fichier est créé après l'ajout de la dépendance</font></font><code>go.sum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Vous pourriez penser qu'il s'agit d'un fichier de verrouillage. </font><font style="vertical-align: inherit;">Mais en fait, il </font></font><code>go.mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fournit déjà suffisamment d'informations pour des versions 100% reproductibles. </font><font style="vertical-align: inherit;">Le fichier </font></font><code>go.sum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est créé à des fins de vérification: il contient les sommes de contrôle cryptographiques attendues du contenu des versions individuelles du module. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En partie parce qu'il </font></font><code>go.sum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne </font><font style="vertical-align: inherit;">s'agit </font><font style="vertical-align: inherit;">pas d'un fichier de verrouillage, il enregistre les sommes de contrôle écrites pour la version du module même après avoir cessé d'utiliser ce module. </font><font style="vertical-align: inherit;">Cela vous permet de vérifier les sommes de contrôle si vous recommencez à l'utiliser plus tard, ce qui offre une sécurité supplémentaire.</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/_5/j8/vi/_5j8vigrklvhkwaucssmy7zaf88.png"><br>
<blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mkcert vient de migrer vers les modules (avec le fournisseur / pour la compatibilité descendante) et tout s'est bien passé </font></font></i> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/FiloSottile/mkcert/commit/26ac5f35395fb9cba3805faf1a5a04d260271291</font></font></a><br>
<br>
<pre><code class="go hljs">$ GO111MODULE=on go1<span class="hljs-number">.11</span>rc1 mod init<font></font>
$ GO111MODULE=on go1<span class="hljs-number">.11</span>rc1 mod vendor<font></font>
$ git add <span class="hljs-keyword">go</span>.mod <span class="hljs-keyword">go</span>.sum vendor<font></font>
$ git rm Gopkg.lock Gopkg.toml Makefile</code></pre><br>
<img src="https://habrastorage.org/webt/kt/ch/ro/ktchrocah4xszqqrfkqtug3qzty.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FAQ: Dois-je m'engager </font></font><code>go.sum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans git? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
R: Certainement oui. </font><font style="vertical-align: inherit;">Avec lui, les propriétaires de vos sources n'ont pas besoin de faire confiance aux autres référentiels GitHub et aux propriétaires de chemins d'importation personnalisés. </font><font style="vertical-align: inherit;">Déjà en route pour nous, quelque chose de mieux, mais pour l'instant c'est le même modèle que les hachages dans les fichiers de verrouillage.</font></font></i></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les commandes </font></font><code>go build</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>go test</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chargeront automatiquement toutes les dépendances manquantes, bien que vous puissiez le faire explicitement à l'aide de </font></font><code>go mod download</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">préremplissage de caches locaux qui peuvent être utiles pour CI. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par défaut, tous nos packages de tous les projets sont chargés dans le répertoire </font></font><code>$GOPATH/pkg/mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nous en discuterons plus en détail ultérieurement.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mise à niveau des versions de package</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez utiliser </font></font><code>go get -u</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soit </font></font><code>go get -u=patch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour mettre à jour les dépendances vers la dernière version mineure ou le dernier correctif, respectivement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais vous ne pouvez pas passer à des versions majeures comme celle-ci. </font><font style="vertical-align: inherit;">Le code inclus dans les modules Go doit respecter techniquement les règles suivantes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Match semver (exemple de balise VCS v1.2.3).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si le module est la version v2 ou supérieure, la version principale du module doit être incluse </font></font><code>/vN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">à la fin du chemin du module utilisé dans le fichier </font></font><code>go.mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et dans le chemin d'importation du package:</font></font></li>
</ul><br>
<pre><code class="go hljs"><span class="hljs-keyword">import</span> <span class="hljs-string">"github.com/you/hello/v2"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apparemment, cela est fait pour que différentes versions de packages puissent être importées dans un même assemblage (voir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">problème de dépendance au diamant</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En un mot, Go s'attend à ce que vous soyez très prudent lors de l'introduction de versions majeures.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remplacement des modules importés</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez spécifier le module nécessaire pour votre propre fork ou même le chemin local vers le fichier en utilisant la directive </font></font><code>replace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> mod edit -replace github.com/<span class="hljs-keyword">go</span>-chi/chi=./packages/chi</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Résultat:</font></font><br>
<br>
<pre><code class="go hljs">module github.com/you/hello
<span class="hljs-keyword">go</span> <span class="hljs-number">1.12</span>
require github.com/<span class="hljs-keyword">go</span>-chi/chi v4<span class="hljs-number">.0</span><span class="hljs-number">.2</span>+incompatible<font></font>
replace github.com/<span class="hljs-keyword">go</span>-chi/chi =&gt; ./packages/chi</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez supprimer la ligne manuellement ou exécuter:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> mod edit -dropreplace github.com/<span class="hljs-keyword">go</span>-chi/chi</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gestion des dépendances du projet </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Historiquement, tout le code Go était stocké dans un seul référentiel géant, car c'est ainsi que Google organise sa base de code, et cela affecte la conception du langage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les modules Go sont un départ de cette approche. Vous n'avez plus besoin de conserver tous vos projets </font></font><code>$GOPATH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, techniquement, toutes vos dépendances téléchargées sont toujours placées </font></font><code>$GOPATH/pkg/mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Si vous utilisez des conteneurs Docker pour le développement local, cela peut être un problème, car les dépendances sont stockées en dehors du projet. Par défaut, ils ne sont tout simplement pas visibles dans votre IDE. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ye/2c/_o/ye2c_o9jcsodsrhdekb4djz7lve.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce n'est généralement pas un problème pour les autres langues, mais c'est ce que j'ai rencontré pour la première fois en travaillant avec la base de code Go. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heureusement, il existe plusieurs façons (non documentées) de résoudre ce problème.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option 1. Installez GOPATH dans votre répertoire de projet.</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À première vue, cela peut sembler contre-intuitif, mais </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si vous exécutez Go à partir d'un conteneur</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , vous pouvez remplacer GOPATH pour qu'il pointe vers le répertoire du projet afin que les packages soient accessibles depuis l'hôte:</font></font><br>
<br>
<pre><code class="go hljs">version: <span class="hljs-string">'3.7'</span><font></font>
<font></font>
services:<font></font>
  app:<font></font>
    command: tail -f /dev/null<font></font>
    image: golang:<span class="hljs-number">1.12</span><span class="hljs-number">.6</span>-stretch<font></font>
    environment:<font></font>
      #        - /code/.<span class="hljs-keyword">go</span>/pkg/mod<font></font>
      - GOPATH=/code/.<span class="hljs-keyword">go</span><font></font>
    ports:<font></font>
      - <span class="hljs-number">8000</span>:<span class="hljs-number">8000</span><font></font>
    volumes:<font></font>
      - ./:/code:cached<font></font>
    working_dir: /code</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les IDE populaires devraient pouvoir installer GOPATH au niveau du projet (espace de travail): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_t/jz/d_/_tjzd_trva2fekp6vmt5ewc_xke.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
le seul inconvénient de cette approche est le manque d'interaction avec le runtime Go sur l'ordinateur hôte. </font><font style="vertical-align: inherit;">Vous devez exécuter toutes les commandes Go à l'intérieur du conteneur.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option 2: vente de vos dépendances</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre façon consiste à copier les dépendances de votre projet dans un dossier </font></font><code>vendor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> mod vendor</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient de le noter tout de suite: nous </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n'autorisons PAS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Go à télécharger directement des documents dans le dossier du fournisseur: ce n'est pas possible avec les modules. </font><font style="vertical-align: inherit;">Nous copions simplement les packages déjà téléchargés. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, si vous détachez vos dépendances, comme dans l'exemple ci-dessus, désactivez </font></font><code>$GOPATH/pkg/mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puis essayez d'ajouter plusieurs nouvelles dépendances à votre projet, vous verrez ce qui suit:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Go reconstruira le cache de téléchargement pour tous les packages logiciels </font></font><code>$GOPATH/pkg/mod/cache</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tous les modules chargés seront copiés dans </font></font><code>$GOPATH/pkg/mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enfin, Go copiera ces modules dans un </font></font><code>vendor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dossier, supprimant les exemples, les tests et certains autres fichiers dont vous ne dépendez pas directement.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, il y a beaucoup de choses manquantes dans ce dossier de fournisseur nouvellement créé: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rj/w-/lt/rjw-ltm1y1s8jwia34bfars6ngw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un fichier Docker Compose typique ressemble à ceci (notez les liaisons de volume):</font></font><br>
<br>
<pre><code class="go hljs">version: <span class="hljs-string">'3.7'</span><font></font>
<font></font>
services:<font></font>
  app:<font></font>
    command: tail -f /dev/null<font></font>
    image: golang:<span class="hljs-number">1.12</span><span class="hljs-number">.6</span>-stretch<font></font>
    ports:<font></font>
      - <span class="hljs-number">8000</span>:<span class="hljs-number">8000</span><font></font>
    volumes:<font></font>
     #    <span class="hljs-keyword">go</span>,           <font></font>
      - modules:/<span class="hljs-keyword">go</span>/pkg/mod/cache<font></font>
      - ./:/code:cached<font></font>
    working_dir: /code <font></font>
<font></font>
volumes:<font></font>
  modules:<font></font>
    driver: local</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veuillez noter que je ne BD pas ce dossier de fournisseur dans le système de contrôle de version ou que je ne vais pas l'utiliser en production. </font><font style="vertical-align: inherit;">Il s'agit d'un script de développement strictement local, que l'on trouve généralement dans d'autres langues. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, lorsque j'ai lu les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commentaires de certains responsables de Go</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et certaines offres liées à la vente partielle (CHE?), J'ai l'impression que cette fonctionnalité n'était initialement pas destinée à ce cas d'utilisation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'un des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commentateurs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de reddit m'a aidé à faire la lumière sur ce point:</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Habituellement, les gens vendent leurs dépendances pour des raisons telles que le désir d'avoir des assemblages serrés sans accès au réseau, ainsi que la disponibilité d'une copie des dépendances prédéfinies en cas de défaillance du github ou de la disparition du référentiel, et la possibilité d'un audit plus facile des changements de dépendances à l'aide d'outils VCS standard, etc. .</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Oui, il ne ressemble pas à </font><font style="vertical-align: inherit;">quoi que </font><font style="vertical-align: inherit;">ce soit du fait que je pourrais être intéressé. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selon la commande Go, vous pouvez facilement activer la vente en définissant une variable d'environnement </font></font><code>GOFLAGS=-mod=vendor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Je ne recommande pas de faire cela. L'utilisation de drapeaux se brisera simplement </font></font><code>go get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sans fournir d'autres avantages à votre flux de travail quotidien: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/df/ul/uw/dfuluwbr13eacullfzphguhrbeo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, le seul endroit dont vous avez besoin pour activer la vente est votre IDE:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jv/x2/pz/jvx2pzgtrx5wcfmlum4s5hheorw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après quelques essais et erreurs, j'ai trouvé la procédure suivante pour ajouter des dépendances de fournisseur dans cette approche.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Étape 1. Exigence</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez exiger une dépendance avec </font></font><code>go get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> get github.com/rs/zerolog@v1<span class="hljs-number">.14</span><span class="hljs-number">.3</span></code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Étape 2. Importer</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Importez-le ensuite quelque part dans votre code:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">import</span> (<font></font>
   _ <span class="hljs-string">"github.com/rs/zerolog"</span>
)</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Étape 3. Vente</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enfin, rouvrez vos dépendances:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> mod vendor</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proposition en attente</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour autoriser le fournisseur de go mod à accepter certains modèles de module qui peuvent (ou non) résoudre certains des problèmes associés à ce flux de travail. </font></font><br>
<br>
<code>go mod vendor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requiert déjà automatiquement des importations manquées, donc l' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">étape 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est facultative dans ce flux de travail (si vous ne souhaitez pas spécifier de restrictions de version). Cependant, sans l'étape 2, il ne récupérera pas le package téléchargé. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette approche fonctionne mieux avec le système hôte, mais elle est plutôt déroutante lorsqu'il s'agit de modifier vos dépendances.</font></font><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Personnellement, je pense que redéfinir GOPATH est une approche plus propre car elle ne sacrifie pas la fonctionnalité </font></font><code>go get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Néanmoins, je voulais montrer les deux stratégies, car le dossier du fournisseur peut être plus familier aux personnes venant d'autres langues, telles que PHP, Ruby, Javascript, etc. Comme vous pouvez le voir d'après la fraude décrite dans cet article, cette pas un choix particulièrement bon pour Go.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dépendances des outils</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il se peut que nous devions installer certains outils basés sur Go qui ne sont pas importés, mais utilisés dans le cadre de l'environnement de développement de projet. </font><font style="vertical-align: inherit;">Un exemple simple d'un tel outil est </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CompileDaemon</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui peut surveiller votre code pour les modifications et redémarrer votre application. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> approche </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">officiellement recommandée</font></a><font style="vertical-align: inherit;"> consiste à ajouter un </font></font><code>tools.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fichier (le nom n'a pas d'importance) avec le contenu suivant:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// +build tools</span>
<span class="hljs-keyword">package</span> tools
<span class="hljs-keyword">import</span> (<font></font>
_ <span class="hljs-string">"github.com/githubnemo/CompileDaemon"</span>
)</code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette limitation </font></font><code>// +build tools</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">empêche vos assemblages standard d'importer réellement votre outil.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'expression d'importation permet aux commandes go d'écrire avec précision les informations de version de vos outils dans </font></font><code>go.mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">votre </font><font style="vertical-align: inherit;">fichier de </font><font style="vertical-align: inherit;">module.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voilà donc tout. </font><font style="vertical-align: inherit;">J'espère que vous ne serez pas aussi confus que moi quand j'ai commencé à utiliser les modules Go. </font><font style="vertical-align: inherit;">Vous pouvez visiter le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wiki Go Modules</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour plus de détails.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prenez le cap.</font></font></a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr503904/index.html">Le monde et n mondes, ou les mathématiques pour les sciences humaines</a></li>
<li><a href="../fr503906/index.html">LabVIEW NXG - Types de données simples et coercition de type</a></li>
<li><a href="../fr503908/index.html">Appeler les bibliothèques partagées de Similink</a></li>
<li><a href="../fr503910/index.html">Expériences sur des personnes qui sont allées à "udalenka"</a></li>
<li><a href="../fr503916/index.html">Apprendre à échanger sur l'échange. Première partie: configurer un environnement de test</a></li>
<li><a href="../fr503920/index.html">Comment nous testons les systèmes de microphones sur STM32: l'expérience des développeurs d'appareils Yandex</a></li>
<li><a href="../fr503922/index.html">Pourquoi l'UE éradique les murs de cookies</a></li>
<li><a href="../fr503924/index.html">Présentation du scanner intra-oral 3D Medit i500</a></li>
<li><a href="../fr503926/index.html">Qui est qui dans l'écosystème des paiements 2020. Partie 2</a></li>
<li><a href="../fr503928/index.html">Irrigation en aérosol VS: quel est le meilleur, et y a-t-il une différence?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>