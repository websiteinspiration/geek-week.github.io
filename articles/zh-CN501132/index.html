<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚊 🎍 ➕ 如何更好地使用Microsoft远程桌面 🔛 🚿 🚚</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="我想分享一些有关通过RDP设置到工作站的远程连接的技巧。我将告诉您如何将古老的RPC-HTTP升级到UDP，赞扬并责骂Windows 10和AVC，我将找出一些典型问题的解决方案。
 
 我们认为远程桌面网关（RDGW）用于连接，而工作站充当服务器。使用RDGW非常方便，因为网关成为所有客户端的通用...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>如何更好地使用Microsoft远程桌面</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501132/"><img src="https://habrastorage.org/webt/dx/s8/wi/dxs8wiugrbhaov1gzied15gldk8.png" align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我想分享一些有关通过RDP设置到工作站的远程连接的技巧。我将告诉您如何将古老的RPC-HTTP升级到UDP，赞扬并责骂Windows 10和AVC，我将找出一些典型问题的解决方案。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们认为远程桌面网关（RDGW）用于连接，而工作站充当服务器。使用RDGW非常方便，因为网关成为所有客户端的通用入口点。这样就可以更好地控制访问，保留连接及其持续时间的记录。即使VPN允许您直接连接到工作计算机，这也不是最佳选择。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RDGW快速，易于配置，并且让我们进行加密和win-acme即可使用受信任的证书轻松解决此问题。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
客户端可以通过三种传输协议连接到服务器：</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RPC-HTTP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><font color="red"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><font color="orange"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更好</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP + UDP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><font color="green"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优秀</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）对于</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
服务器，我们是指可以工作的计算机，即客户端-家庭。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先要把“坏”变成“优秀”。</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将RPC-HTTP升级到HTTP</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过连接条的外观很容易确定使用RPC-HTTP的会话连接。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7w/-0/aa/7w-0aativt247pvbumddqkf4epg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
没有连接质量图标（在下面有此图标），这意味着我们使用的是封装在TLS中的旧RPC-这非常慢。</font><font style="vertical-align: inherit;">当然，重点不仅在于包装器中-协议本身随OS的每个发行版，编解码器，图像打包算法的变化而变化。</font><font style="vertical-align: inherit;">协议越新鲜越好。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该怎么办？</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows XP或Vista</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在XP中，您可以将协议从5.1升级到</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7。Windowsxp-kb969084-x86.exe修复程序；</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
在Vista中，从6升级到</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7。Windows6.0-kb969084-x64.msu或Windows6.0-KB969084-x86文件</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有相同的编号。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">.msu</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
但是RDP 7不能通过HTTP和UDP运行。仅将客户端和服务器升级到Windows 7及更高版本会有所帮助。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 7</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
首先，您需要将协议升级到RDP 8.1，然后启用它。通过添加到单个下载程序包中的更新来添加支持：</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.microsoft.com/zh-cn/download/details.aspx?</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
id=40986 Windows6.1-KB2574819-v2-x64.msu </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
windows6.1-kb2592687-x64.msu </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windows6.1-KB2830477-x64.msu </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windows6.1-KB2857650-x64.msu </font></font><br>
<s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows6.1-KB2913751-x64.msu</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（由kb2923545取代）</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">windows6.1-kb2923545-x64.msu</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
因此，您同时获得了操作系统服务器端的最新mstsc.exe客户端和RDP 8.1支持。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
原来是：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yx/37/pl/yx37plxdymw73eubymzh1v0zgzm.png"><br>
<br>
<img src="https://habrastorage.org/webt/r1/kh/ip/r1khiphuyrmxmmodab_ecjiktiq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
后来：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rt/9v/dj/rt9vdjdnfmus27h9nyn7ctpyp7g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必须使用注册表项启用协议（为此，您可以使用Windows 7附带的adm模板）。</font></font><br>
<br>
<pre><code class="powershell hljs">[<span class="hljs-type">HKEY_LOCAL_MACHINE</span>\<span class="hljs-type">SOFTWARE</span>\<span class="hljs-type">Policies</span>\<span class="hljs-type">Microsoft</span>\<span class="hljs-type">Windows</span> <span class="hljs-type">NT</span>\<span class="hljs-type">Terminal</span> <span class="hljs-type">Services</span>]
<span class="hljs-string">"fServerEnableRDP8"</span>=dword:<span class="hljs-number">00000001</span><font></font>
 <font></font>
[<span class="hljs-type">HKEY_LOCAL_MACHINE</span>\<span class="hljs-type">SOFTWARE</span>\<span class="hljs-type">Wow6432Node</span>\<span class="hljs-type">Policies</span>\<span class="hljs-type">Microsoft</span>\<span class="hljs-type">Windows</span> <span class="hljs-type">NT</span>\<span class="hljs-type">Terminal</span> <span class="hljs-type">Services</span>]
<span class="hljs-string">"fServerEnableRDP8"</span>=dword:<span class="hljs-number">00000001</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在组策略中启用UDP传输支持。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bg/_t/ds/bg_tdse5uudrekmylffvhh_gqzq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们使用Windows 7重新启动服务器。在这种情况下，您可能需要重新启动两次-必须在打开RDP之前设置注册表中的值，然后再应用组策略。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果一切顺利，则当您在会话栏中连接到服务器时，将出现连接质量图标（例如在移动网络的电话中）：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8b/_0/ok/8b_0okltugyxpizhhcydchtsve8.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 8及更高版本该</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
协议即开即用。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将HTTP升级到HTTP + UDP</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您的网络不容易丢失数据包，则UDP（使用CAD可以大大降低）可以通过使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FEC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">减少重传，以及将数据包传递确认从TCP / IP系统堆栈切换到RDP-UDP协议级别来</font><font style="vertical-align: inherit;">显着提高服务器的响应速度</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
每个客户端都通过HTTP连接了一个主控制会话（此通道中还传输了键盘/鼠标），以及一个或多个UDP会话来传输图片或其他虚拟通道。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们只会碰到冰山一角。 RDP-UDP协议有3个不同的版本。另外，UDP本身可以以两种模式运行：UDP-R（可靠）和UDP-L（有损）。微软什么也没有发生。但是，由于这里没有任何内容取决于我们，因此请紧记-操作系统越新，本主题使用的协议越现代。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在外部，RDP-UDP包装在数据报传输层安全性（DTLS）RFC4347中，如打开Wireshark所见。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
文档中的更多详细信息：</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[MS-RDPEMT]：远程桌面协议：</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多传输</font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">扩展</font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">[MS-RDPEUDP]：远程桌面协议：UDP传输扩展</font></a></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[MS-RDPEUDP2]：远程桌面协议：UDP传输扩展版本2</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
在错误的地方，正确别客气。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您需要启用什么UDP？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从RDP 8开始支持RDP-UDP。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必须在客户端上打开udp / 3389端口。如果使用本地防火墙，交换机上的ACL或外部防火墙将其关闭，则必须打开该端口。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于将远程桌面网关服务器连接到tcp / 443端口，请打开udp / 3391。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可以更改端口，其配置方式如下：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o6/n0/w3/o6n0w3fmookrhmxaqomyx8wretk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于Windows 7，必须启用NLA（网络级身份验证）。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nt/kz/ny/ntkznyeqsvsh3msad2u59_rxcck.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可以在组策略中</font></font><br>
<br>
<img src="https://habrastorage.org/webt/my/hj/sw/myhjswie2h7znzjoamnhf6clzq4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
或通过注册表</font><font style="vertical-align: inherit;">启用</font></font><br>
<br>
<pre><code class="powershell hljs">[<span class="hljs-type">HKEY_LOCAL_MACHINE</span>\<span class="hljs-type">SYSTEM</span>\<span class="hljs-type">CurrentControlSet</span>\<span class="hljs-type">Control</span>\<span class="hljs-type">Terminal</span> <span class="hljs-type">Server</span>\<span class="hljs-type">WinStations</span>\<span class="hljs-type">RDP</span>-<span class="hljs-type">Tcp</span>]
<span class="hljs-string">"SecurityLayer"</span>=dword:<span class="hljs-number">00000001</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
什么是连接不清楚。但是，如果没有7-ke上的NLA不能正常工作，则在较新版本的NLA上不需要工作UDP。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过HTTP建立会话后，客户端和服务器</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">协商UDP连接。如果存在数据包丢失或延迟，则UDP会话将不会启动。确切的UDP协商失败算法尚未完全了解。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果一切都已配置，则在连接后，单击链接质量按钮。该窗口将指示已协商UDP。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d7/y4/jx/d7y4jx5ubs4i9zop5myyzg21oyo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在网关上，如下所示：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oc/ld/7n/ocld7nbslu8dt_fjahnvd-zqvso.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 10</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果服务器和客户端上都装有Windows 10，则这是最快，最无问题的选择。 Microsoft正在积极敲定RDP，在最新版本10中，您可以指望获得良好的速度。同事无法在AutoCAD速度中检测到Citrix和Windows 10 RDP之间的差异。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
关于Windows 10 </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程桌面协议（RDP）中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于AVC的RDP编解码器的演变，有一篇很好的文章</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Windows 10和Windows Server 2016 Technical Preview中对AVC / H.264的改进</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
可以在事件日志中看到与硬件编码匹配的AVC（更多信息请参见上面的文章） ）：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kf/4_/_n/kf4__nmejj4amr9nctpufhwfb6a.png"><br>
<br>
<img src="https://habrastorage.org/webt/ld/rn/ld/ldrnldvgbclldmcr2f8pxoztfxo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我只注意到即使使用h.264 4：4：4仍然存在失真问题。</font><font style="vertical-align: inherit;">如果您在PowerShell ISE中工作，它会立即引起您的注意-错误文本的显示形式令人不愉快。</font><font style="vertical-align: inherit;">此外，在屏幕截图和照片中一切都很好。</font><font style="vertical-align: inherit;">魔法。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AVC工作的间接标志是不时在角落出现绿色方块。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
全新版本中的AVC和硬件编码应该可以立即使用，但是组策略绝不是多余的：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pn/hc/uo/pnhcuobl3frw-p4pfodd9xr_tsa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
鉴于AVC是使用视频卡进行硬件编码的，因此更新视频驱动程序是一个好主意。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于问题</font></font></h1><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XP和Vista</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
如果在Windows XP或Vista上出现问题，请首先尝试将协议更新为版本7（在本文开头写道）。确保启用CredSSP支持。 Microsoft已经删除了该站点上的文章，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但Internet仍然记得</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果没有帮助，“医生先向太平间讲话，然后再向太平间讲话。”操作系统在过去15年中经历的最好不要去考虑它。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NLA</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
有时有助于禁用服务器上的NLA。原因没有解决，家用车都不同。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTLM</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
某些客户端尝试使用NTLMv1登录。原因不同，但是您可以像这样在客户端上修复它：</font></font><br>
<br>
<pre><code class="powershell hljs">[<span class="hljs-type">HKEY_LOCAL_MACHINE</span>\<span class="hljs-type">SYSTEM</span>\<span class="hljs-type">CurrentControlSet</span>\<span class="hljs-type">Control</span>\<span class="hljs-type">Lsa</span>]
<span class="hljs-string">"LmCompatibilityLevel"</span>=dword:<span class="hljs-number">00000003</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
需要重启。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">年轻而大胆地</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无所畏惧，那么还有一个更根本的解决方案- </font><font style="vertical-align: inherit;">在远程桌面网关上</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁用通道绑定</font></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="powershell hljs">HKLM\Software\Microsoft\Windows NT\CurrentVersion\TerminalServerGateway\Config\Core
<span class="hljs-built_in">Type</span>: REG_DWORD<font></font>
Name: EnforceChannelBinding<font></font>
Value: <span class="hljs-number">0</span> (Decimal)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您不必这样做。</font><font style="vertical-align: inherit;">但是我们做到了。</font><font style="vertical-align: inherit;">:-)对于坚持（没错，坚持）他需要的工作站上的NTLMv1的客户。</font><font style="vertical-align: inherit;">我不知道，也许NT4上没有SP的服务器仍在运行。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在Windows 10中禁用RDP 8+</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
如果所有其他方法都失败了，并且构想耗尽，则可以使用未记录的密钥将RDP协议降级到版本7。</font></font><br>
<br>
<pre><code class="powershell hljs">[<span class="hljs-type">HKEY_CURRENT_USER</span>\<span class="hljs-type">Software</span>\<span class="hljs-type">Microsoft</span>\<span class="hljs-type">Terminal</span> <span class="hljs-type">Server</span> <span class="hljs-type">Client</span>]
<span class="hljs-string">"RDGClientTransport"</span>=dword:<span class="hljs-number">00000001</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我自己没有做，也没有建议您。但是对于某人，他们写道这会有所帮助。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DrWeb</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dr.Web SpIDerGate组件可能禁止连接。在这种情况下，将返回错误：</font></font><br>
<img src="https://habrastorage.org/webt/fs/76/zj/fs76zj-otc0v-v_qxkkwa0gviwo.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dr.Web统计信息中将有一条记录</font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">Dr.Web </font></font><br>
<img src="https://habrastorage.org/webt/ik/fe/qy/ikfeqyljaepzhnieksw4qsomh6y.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
员工在本文的评论中与我联系，并且我们的问题在防病毒数据库的下一次更新中得以解决。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您有相同的错误，最好与支持人员联系。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作为临时解决方案，您可以将RDGW的URL添加到以下例外中：</font></font><br>
<img src="https://habrastorage.org/webt/7c/do/k-/7cdok-2f6-4f2jj-bhlmjwqd2tq.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
并且仅在它不能</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全禁用SpIDer Gate组件的情况下</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统代理我</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
遇到了一家公司退役的计算机，该公司已将本地TMG注册为系统代理，但与RDGW的连接不起作用。可以这样修复：</font></font><br>
<br>
<pre><code class="powershell hljs">netsh winhttp show proxy &amp;&amp; netsh winhttp reset proxy</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">切换键盘布局</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
有时会出现额外的布局。</font><font style="vertical-align: inherit;">您可以从客户端禁用布局转发</font></font><br>
<pre><code class="powershell hljs">[<span class="hljs-type">HKLM</span>\<span class="hljs-type">System</span>\<span class="hljs-type">CurrentControlSet</span>\<span class="hljs-type">Control</span>\<span class="hljs-type">Keyboard</span> <span class="hljs-type">Layout</span>]
<span class="hljs-string">"IgnoreRemoteKeyboardLayout"</span>=dword:<span class="hljs-number">00000001</span></code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DPI问题</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
缩放来自客户端计算机，如果家用笔记本电脑的价格为125％，则在工作计算机上也是如此。</font><font style="vertical-align: inherit;">在服务器上，可以将其关闭，但是在工作站上，我找不到方法。</font><font style="vertical-align: inherit;">但是Windows 10应用商店有一个</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“现代”客户端</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以在其中配置DPI：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ig/dz/sm/igdzsmxjjsxc7bsmrixgkbachpm.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何使用RDGW监视网关</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有一个性能计数器“ TS Gateway \ Current Connections”，如果没有连接或服务器很长时间没有重新启动，这将有点问题。它准确显示了连接数，但正如我们所记得的，对于HTTP + UDP，至少有两个，甚至可能更多。因此，这不是员工联系数量的完全客观指标。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有一个WMI类Win32_TSGatewayConnection。其内容与您在“远程桌面网关”的“监视”部分中看到的内容相对应。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用它，可以更精确地计算连接数：</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-class</span> <span class="hljs-string">"Win32_TSGatewayConnection"</span> <span class="hljs-literal">-namespace</span> <span class="hljs-string">"root\cimv2\TerminalServices"</span> 
|?{<span class="hljs-variable">$_</span>.transportprotocol <span class="hljs-operator">-ne</span> <span class="hljs-number">2</span>}|<span class="hljs-built_in">select</span> username,connectedresource|<span class="hljs-built_in">sort</span> username|<span class="hljs-built_in">Get-Unique</span> <span class="hljs-literal">-AsString</span>| <span class="hljs-built_in">measure</span>|<span class="hljs-built_in">select</span> <span class="hljs-literal">-ExpandProperty</span> count
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
只是为了好玩，有一个</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remote Display Analyzer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">免费版本没有向我显示任何有用的信息，但是突然之间，它将对您有用。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，如何进行微调，调整几十个会话参数呢？</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
帕累托原理在这里是适当的：20％的努力可以产生80％的结果。</font><font style="vertical-align: inherit;">如果您准备将时间投入到结果的其余20％中-很好。</font><font style="vertical-align: inherit;">请记住，当您阅读有关在Windows 7中设置协议的文章时，您不知道作者写的协议是-7、8或8.1。</font><font style="vertical-align: inherit;">当您在未指定发行版的情况下阅读Windows 10时，问题是相同的。</font><font style="vertical-align: inherit;">例如，他们写道，在Windows 10的全新版本中，AVC / h.264编解码器已更改为RDPGFX_CODECID_AVC444 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而在Windows Server 2016中，仍保留RDPGFX_CODECID_AVC444。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在所有这些技巧中，我们仅使用两个设置：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16位颜色，您可以在文章</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">MS RDP性能/带宽使用中</font></a><font style="vertical-align: inherit;">阅读有关它的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁用</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字体平滑字体平滑：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一篇文章中的</font><b><font style="vertical-align: inherit;">i：0</font></b><font style="vertical-align: inherit;">或</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性能调整远程桌面会话主机</font></font></a></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我怀疑它们是否会带来任何实际结果。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们到了本文的结尾。</font><font style="vertical-align: inherit;">我想变短一些，但结果还是一如既往。</font><font style="vertical-align: inherit;">如果这些提示可以帮助某人节省时间或改善其基础结构的配置，我将感到很高兴。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN501118/index.html">Hooray（Oh no）-达伦卡</a></li>
<li><a href="../zh-CN501120/index.html">什么是Google Ads数据中心</a></li>
<li><a href="../zh-CN501126/index.html">第38期：IT培训-当前问题和领先公司的挑战</a></li>
<li><a href="../zh-CN501128/index.html">为什么VR开发不适合您</a></li>
<li><a href="../zh-CN501130/index.html">暂停并着火-一个值得改编的团队</a></li>
<li><a href="../zh-CN501134/index.html">GitLab质量检查团队如何使用GitLab性能工具</a></li>
<li><a href="../zh-CN501138/index.html">您可以在5月2日参加10个在线活动</a></li>
<li><a href="../zh-CN501140/index.html">在iOS中提高服务器数据解析器的忠诚度</a></li>
<li><a href="../zh-CN501144/index.html">是否有可能通过声音干扰大脑</a></li>
<li><a href="../zh-CN501148/index.html">JavaScript工作场所名人堂</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>