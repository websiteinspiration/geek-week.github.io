<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñêüèø üÜë üê° Making our product ready to scale with Laravel queues üë©üèΩ‚Äç‚úàÔ∏è üèá üëãüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A translation of the article was prepared especially for students of the ‚ÄúFramework Laravel‚Äù course .
 
 
 
 Hi, I'm Valerio, a software engineer from...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Making our product ready to scale with Laravel queues</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/499508/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A translation of the article was prepared especially for students of the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúFramework Laravel‚Äù</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> course </font><font style="vertical-align: inherit;">.</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/ei/7u/aq/ei7uaq5c5omdkojxhmurjggkqw4.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hi, I'm Valerio, a software engineer from Italy. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This guide is intended for all PHP developers who already have online applications with real users, but who lack a deeper understanding of how to implement (or significantly improve) scalability in their system using Laravel queues. I first learned about Laravel at the end of 2013 at the start of the 5th version of the framework. Then I was not yet a developer involved in serious projects, and one of the aspects of modern frameworks, especially in Laravel, which seemed to me the most incomprehensible, were Queues.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reading the documentation, I guessed about the potential, but without real development experience, all this remained only at the level of theories in my head. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Today, I am the creator </font></font><code>Inspector.dev</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">realtime dashboard</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which performs thousands of tasks every hour, and I understand this architecture much better than before. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ey/rx/qu/eyrxquvk3yrmu5kldbmpuit5riu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article I am going to tell you how I discovered queues and tasks and what configurations helped me process large amounts of data in real time, while saving server resources.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introduction</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When a PHP application receives an incoming http request, our code is executed sequentially step by step until the request is completed and a response is returned to the client (for example, the user's browser). This synchronous behavior is truly intuitive, predictable, and easy to understand. I send an http request to the endpoint, the application extracts data from the database, converts it to the appropriate format, performs some additional tasks and sends them back. Everything happens linearly. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tasks and queues introduce asynchronous behavior that violates this line flow. That's why these features seemed a little strange to me at first.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But sometimes an incoming http request can trigger a cycle of time-consuming tasks, for example, sending email notifications to all team members. </font><font style="vertical-align: inherit;">This may mean sending six or ten emails, which may take four or five seconds. </font><font style="vertical-align: inherit;">Therefore, every time the user clicks on the corresponding button, he needs to wait five seconds before he can continue to use the application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The more the application grows, the worse this problem becomes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What is a task?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A job is a class that implements the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">handle</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">that contains the logic that we want to execute asynchronously.</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">ShouldQueue</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Foundation</span>\<span class="hljs-title">Bus</span>\<span class="hljs-title">Dispatchable</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">InteractsWithQueue</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Bus</span>\<span class="hljs-title">Queueable</span>;<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CallExternalAPI</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ShouldQueue</span>
</span>{
    <span class="hljs-keyword">use</span> <span class="hljs-title">Dispatchable</span>,
        <span class="hljs-title">InteractsWithQueue</span>,
        <span class="hljs-title">Queueable</span>;<font></font>
        <font></font>
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@var</span> string
     */</span>
    <span class="hljs-keyword">protected</span> $url;<font></font>
<font></font>
    <span class="hljs-comment">/**
     *    .
     *
     * <span class="hljs-doctag">@param</span> array $Data
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">$url</span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;url = $url;<font></font>
    }<font></font>
    <font></font>
<font></font>
    <span class="hljs-comment">/**
     *  ,   .
     *
     * <span class="hljs-doctag">@return</span> void
     * <span class="hljs-doctag">@throws</span> \Throwable
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span>(<span class="hljs-params"></span>)
    </span>{<font></font>
        file_get_contents(<span class="hljs-keyword">$this</span>-&gt;url);<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As mentioned above, the main reason for concluding a piece of code in Job is to complete a time-consuming task, without forcing the user to wait for it to complete.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What do we mean by ‚Äúlaborious tasks‚Äù?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is a natural question. </font><font style="vertical-align: inherit;">Sending emails is the most common example used in articles that talk about queues, but I want to tell you about the real experience of what I needed to do. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a product owner, it is very important for me to synchronize user travel information with our marketing and customer support tools. </font><font style="vertical-align: inherit;">Thus, based on user actions, we update user information in various external software via API (or external http calls) for service and marketing purposes.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One of the most commonly used endpoints in my application can send 10 emails and make 3 http calls to external services before completion. </font><font style="vertical-align: inherit;">No user will wait so much time - most likely, they all simply stop using my application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thanks to the queues, I can encapsulate all these tasks in the allocated classes, transfer the information necessary for the execution of their work to the constructor, and schedule them to be completed at a later date in the background so that my controller can immediately return the answer.</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProjectController</span> 
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">store</span>(<span class="hljs-params">Request $request</span>)
    </span>{<font></font>
        $project = Project::create($request-&gt;all());<font></font>
        <font></font>
        <span class="hljs-comment">//  NotifyMembers, TagUserActive, NotifyToProveSource </span>
        <span class="hljs-comment">//   ,     </span>
        Notification::queue(<span class="hljs-keyword">new</span> NotifyMembers($project-&gt;owners));
        <span class="hljs-keyword">$this</span>-&gt;dispatch(<span class="hljs-keyword">new</span> TagUserAsActive($project-&gt;owners));
        <span class="hljs-keyword">$this</span>-&gt;dispatch(<span class="hljs-keyword">new</span> NotifyToProveSource($project-&gt;owners));<font></font>
        <font></font>
        <span class="hljs-keyword">return</span> $project;<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I do not need to wait for the completion of all these processes before returning the answer; </font><font style="vertical-align: inherit;">on the contrary, the wait will be equal to the time required to publish them in the queue. </font><font style="vertical-align: inherit;">And that means the difference between 10 seconds and 10 milliseconds !!!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Who performs these tasks after sending them to the queue?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is the classic </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">publisher / consumer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> architecture </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">We have already published our tasks in the queue from the controller, now we are going to understand how the queue is used, and, finally, the tasks are performed. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pi/va/vr/pivavrbjasagc40trhmqpesyc2u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To use the queue, we need to run one of the most popular artisan commands:</font></font><br>
<br>
<pre><code class="php hljs">php artisan queue:work</code></pre><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As the documentation says: </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laravel includes a queue worker who processes new tasks when they are queued.</font></font></i></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Great! </font><font style="vertical-align: inherit;">Laravel provides a ready-made interface for queuing tasks and a ready-to-use command to retrieve tasks from the queue and execute their code in the background.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supervisor Role</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It was another ‚Äúweird thing‚Äù in the beginning. I think it's normal to discover new things. After this stage of training, I write these articles to help myself organize my skills, and at the same time help other developers expand their knowledge. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the task fails while throwing an exception, the team will </font></font><code>queue:work</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stop its work. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order for a process </font></font><code>queue:work</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to run continuously (consuming your queues), you must use a process monitor such as Supervisor to ensure that the command </font></font><code>queue:work</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">does not stop working even if the task throws an exception. </font><font style="vertical-align: inherit;">Supervisor </font><font style="vertical-align: inherit;">restarts the command after it crashes, starting again from the next task, setting aside the throwing exception.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tasks will run in the background on your server, no longer dependent on the HTTP request. </font><font style="vertical-align: inherit;">This introduces some changes that I had to consider when implementing the task code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here are the most important ones that I will pay attention to:</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How can I find out that the task code is not working?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When running in the background, you cannot immediately notice that your task is causing errors. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You will no longer have immediate feedback, such as when making an http request from your browser. </font><font style="vertical-align: inherit;">If the task fails, it will do it silently and no one will notice. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consider integrating a real-time monitoring tool such as the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inspector</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to surface every flaw.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You do not have an http request</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is no more HTTP request. </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Your code will be executed from cli. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you need query parameters to complete your tasks, you need to pass them to the task constructor for later use at runtime:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-comment">//   </span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TagUserJob</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ShouldQueue</span>
</span>{
    <span class="hljs-keyword">public</span> $data;<font></font>
    <font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> $data</span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;data = $data;<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//       </span><font></font>
<font></font>
<span class="hljs-keyword">$this</span>-&gt;dispatch(<span class="hljs-keyword">new</span> TagUserJob($request-&gt;all()));</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You don't know who logged in</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is no longer a session</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In the same way, you will not know the identity of the user who is logged in, so if you need information about the user to complete the task, you need to pass the user object to the task constructor:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TagUserJob</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ShouldQueue</span>
</span>{
    <span class="hljs-keyword">public</span> $user;<font></font>
    <font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">User $user</span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;user= $user;<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//       </span>
<span class="hljs-keyword">$this</span>-&gt;dispatch(<span class="hljs-keyword">new</span> TagUserJob($request-&gt;user()));</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Understand how to scale</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unfortunately, in many cases this is not enough. </font><font style="vertical-align: inherit;">Using one line and a consumer may soon become useless. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Queues are FIFO buffers (‚Äúfirst in, first out‚Äù). </font><font style="vertical-align: inherit;">If you have planned a lot of tasks, maybe even of different types, they need to wait for others to complete their tasks before completing. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are two ways to scale: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Several consumers per queue.</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/id/uu/0j/iduu0jzihjoqnm95edxdox7swim.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Thus, five tasks will be removed from the queue at a time, speeding up the queue processing. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Special-Purpose Queues</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
You can also create specific queues for each type of task to be launched with a dedicated consumer for each queue.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3r/0i/gv/3r0igvjwxthteiiqrx7p8exouz8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, each queue will be processed independently, without waiting for other types of tasks to complete.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Horizon</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Laravel Horizon is a queue manager that gives you full control over how many queues you want to set up, and the ability to organize consumers, allowing developers to combine these two strategies and implement the one that suits your scalability needs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The launch occurs through </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">php artisan horizon</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> instead of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">php artisan queue: work</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . This command scans your configuration file </font></font><code>horizon.php</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and starts a series of queue workers depending on the configuration:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-string">'production'</span> =&gt; [
    <span class="hljs-string">'supervisor-1'</span> =&gt; [
        <span class="hljs-string">'connection'</span> =&gt; <span class="hljs-string">"redis"</span>,
        <span class="hljs-string">'queue'</span> =&gt; [<span class="hljs-string">'adveritisement'</span>, <span class="hljs-string">'logs'</span>, <span class="hljs-string">'phones'</span>],
        <span class="hljs-string">'processes'</span> =&gt; <span class="hljs-number">9</span>,
        <span class="hljs-string">'tries'</span> =&gt; <span class="hljs-number">3</span>,
        <span class="hljs-string">'balance'</span> =&gt; <span class="hljs-string">'simple'</span>, <span class="hljs-comment">//   simple, auto  null</span><font></font>
<font></font>
    ]<font></font>
]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the above example, Horizon will start three queues with three processes assigned to process each queue. </font><font style="vertical-align: inherit;">As mentioned in the Laravel documentation, Horizon's code-driven approach allows my configuration to remain in a version control system where my team can collaborate. </font><font style="vertical-align: inherit;">This is the perfect solution using a CI tool. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To find out the meaning of configuration parameters in detail, read </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this wonderful article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">My own configuration</font></font></h3><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-string">'production'</span> =&gt; [
    <span class="hljs-string">'supervisor-1'</span> =&gt; [
        <span class="hljs-string">'connection'</span> =&gt; <span class="hljs-string">'redis'</span>,
        <span class="hljs-string">'queue'</span> =&gt; [<span class="hljs-string">'default'</span>, <span class="hljs-string">'ingest'</span>, <span class="hljs-string">'notifications'</span>],
        <span class="hljs-string">'balance'</span> =&gt; <span class="hljs-string">'auto'</span>,
        <span class="hljs-string">'processes'</span> =&gt; <span class="hljs-number">15</span>,
        <span class="hljs-string">'tries'</span> =&gt; <span class="hljs-number">3</span>,<font></font>
    ],<font></font>
]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inspector mainly uses three queues:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ingest for processes for analyzing data from external applications;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">notifications are used to immediately schedule notifications if an error is detected while receiving data;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">default is used for other tasks that I do not want to mix with </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ingest</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">notifications</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> processes.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Through the use of </font></font><code>balance=auto</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Horizon, he understands that the maximum number of activated processes is 15, which will be distributed dynamically depending on the loading of queues. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the queues are empty, Horizon supports one active process for each queue, which allows the consumer to immediately process the queue if a task is scheduled.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Concluding observations</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Concurrent background execution can cause many other unpredictable errors, such as MySQL "Lock timed out" and many other design problems. </font><font style="vertical-align: inherit;">Read more </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I hope this article has helped you use queues and tasks with more confidence. </font><font style="vertical-align: inherit;">If you want to know more about us, visit our website at </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.inspector.dev </font></font></a><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Previously published here </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.inspector.dev/what-worked-for-me-using-laravel-queues-from-the-basics-to -horizon</font></font></a></i><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get on the course and get a discount.</font></font><br>
</a><br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en499490/index.html">Random Algorithms</a></li>
<li><a href="../en499492/index.html">Is it possible for a developer in Silicon Valley to become a millionaire? Staff Engineer parsing at Lyft</a></li>
<li><a href="../en499502/index.html">Why OceanStor Dorado V6 is the fastest and most reliable storage</a></li>
<li><a href="../en499504/index.html">Apple & Google Bluetooth Contact Tracking Protocol</a></li>
<li><a href="../en499506/index.html">Payment hourly, for the result or salary?</a></li>
<li><a href="../en499512/index.html">AHK at the minimum. Binder</a></li>
<li><a href="../en499516/index.html">Beginning of beta testing of the plugin for Rider and PVS-Studio C # for Linux / macOS</a></li>
<li><a href="../en499518/index.html">Video conferencing is now a market and new technologies. Longrid, part one</a></li>
<li><a href="../en499522/index.html">–í—Å–µ –Ω–æ–≤–æ–≤–≤–µ–¥–µ–Ω–∏—è Windows 10 2004 (20H1)</a></li>
<li><a href="../en499524/index.html">Quarkus: application upgrades using the helloworld example from JBoss EAP Quickstart</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>