<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üì¨ üëµüèª üßëüèæ‚Äçü§ù‚ÄçüßëüèΩ Monitoreo de equipos de red a trav√©s de SNMPv3 en Zabbix üï∏Ô∏è ‚ù§Ô∏è üßõüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este art√≠culo analiza las caracter√≠sticas de monitorear equipos de red utilizando el protocolo SNMPv3. Hablaremos sobre SNMPv3, compartir√© mi experien...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Monitoreo de equipos de red a trav√©s de SNMPv3 en Zabbix</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/zabbix/blog/495704/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este art√≠culo analiza las caracter√≠sticas de monitorear equipos de red utilizando el protocolo SNMPv3. </font><font style="vertical-align: inherit;">Hablaremos sobre SNMPv3, compartir√© mi experiencia en la creaci√≥n de plantillas completas en Zabbix y mostrar√© lo que puede lograr al organizar alertas distribuidas en una red grande. </font><font style="vertical-align: inherit;">SNMP es el protocolo principal para monitorear equipos de red, y Zabbix es excelente para monitorear una gran cantidad de objetos y resumir vol√∫menes significativos de m√©tricas entrantes.</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algunas palabras sobre SNMPv3</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comencemos con el nombramiento de SNMPv3 y las caracter√≠sticas de su uso. </font><font style="vertical-align: inherit;">Las tareas SNMP son monitorear dispositivos de red y administraci√≥n elemental, envi√°ndoles comandos simples (por ejemplo, encender y apagar las interfaces de red o reiniciar el dispositivo). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La principal diferencia entre el protocolo SNMPv3 y sus versiones anteriores son las caracter√≠sticas de seguridad cl√°sicas [1-3], a saber:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autenticaci√≥n, que determina que la solicitud se recibe de una fuente confiable;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cifrado, para evitar la divulgaci√≥n de datos transmitidos cuando son interceptados por terceros;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Integridad, es decir, una garant√≠a de que el paquete no fue alterado durante la transmisi√≥n.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SNMPv3 implica el uso de un modelo de seguridad en el que se establece una estrategia de autenticaci√≥n para un usuario determinado y el grupo al que pertenece (en versiones anteriores de SNMP, en la solicitud del servidor al objeto de monitoreo, solo se compar√≥ "comunidad", una cadena de texto con una "contrase√±a" transmitida en forma clara (Texto sin formato)). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SNMPv3 presenta el concepto de niveles de seguridad: niveles de seguridad aceptables que determinan la configuraci√≥n del equipo y el comportamiento del agente SNMP del objeto de monitoreo. La combinaci√≥n del modelo de seguridad y el nivel de seguridad determina qu√© mecanismo de seguridad se utiliza al procesar el paquete SNMP [4]. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tabla describe combinaciones de modelos y niveles de seguridad SNMPv3 (decid√≠ dejar las tres primeras columnas como en el original):</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qu/5x/ac/qu5xacorpr-q2zreebuvsul87vw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En consecuencia, usaremos SNMPv3 en modo de autenticaci√≥n mediante cifrado.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurar SNMPv3 </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La supervisi√≥n del equipo de red implica la misma configuraci√≥n del protocolo SNMPv3 tanto en el servidor de supervisi√≥n como en el objeto supervisado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comencemos configurando un dispositivo de red Cisco, su configuraci√≥n m√≠nima necesaria es la siguiente (para la configuraci√≥n usamos CLI, simplifiqu√© los nombres y las contrase√±as para evitar confusiones):</font></font><br>
<br>
<pre><code class="plaintext hljs">snmp-server group snmpv3group v3 priv read snmpv3name <font></font>
snmp-server user snmpv3user snmpv3group v3 auth md5 md5v3v3v3 priv des des56v3v3v3<font></font>
snmp-server view snmpv3name iso included</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La primera l√≠nea del grupo snmp-server: define el grupo de usuarios SNMPv3 (snmpv3group), el modo de lectura (read) y el derecho de acceso del grupo snmpv3group para ver ciertas ramas del √°rbol MIB del objeto de monitoreo (snmpv3name en la configuraci√≥n a continuaci√≥n determina qu√© ramas del √°rbol MIB el grupo snmpv3group podr√° acceder).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El usuario del servidor snmp de segunda l√≠nea: define el usuario snmpv3user, su membres√≠a en snmpv3group, as√≠ como el uso de la autenticaci√≥n md5 (la contrase√±a para md5 es md5v3v3v3) y el cifrado des (la contrase√±a para des es des56v3v3v3). Por supuesto, en lugar de des, es mejor usar aes, aqu√≠ lo doy a modo de ejemplo. Adem√°s, al definir un usuario, puede agregar una lista de acceso (ACL) que regula las direcciones IP de los servidores de monitoreo que tienen el derecho de monitorear este dispositivo; esto tambi√©n es una buena pr√°ctica, pero no complicar√© nuestro ejemplo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tercera l√≠nea de la vista del servidor snmp define el nombre del c√≥digo que establece las ramas del √°rbol MIB snmpv3name para que el grupo de usuarios snmpv3group pueda solicitarlas. </font><font style="vertical-align: inherit;">ISO, en lugar de definir estrictamente una sola rama, permite que un grupo de usuarios snmpv3group acceda a todos los objetos del √°rbol MIB del objeto de supervisi√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una configuraci√≥n similar del equipo de Huawei (tambi√©n en la CLI) es la siguiente:</font></font><br>
<br>
<pre><code class="plaintext hljs">snmp-agent mib-view included snmpv3name iso<font></font>
snmp-agent group v3 snmpv3group privacy read-view snmpv3name<font></font>
snmp-agent usm-user v3 snmpv3user group snmpv3group<font></font>
snmp-agent usm-user v3 snmpv3user authentication-mode md5 <font></font>
            md5v3v3v3<font></font>
snmp-agent usm-user v3 snmpv3user privacy-mode des56<font></font>
            des56v3v3v3</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de configurar los dispositivos de red, debe verificar el acceso desde el servidor de monitoreo a trav√©s del protocolo SNMPv3, usar√© snmpwalk:</font></font><br>
<br>
<pre><code class="plaintext hljs">snmpwalk -v 3 -u snmpv3user -l authPriv -A md5v3v3v3 -a md5 -x des -X des56v3v3v3 10.10.10.252</code></pre><br>
<img src="https://habrastorage.org/webt/dj/zh/jt/djzhjtntle82d3erggwh-beglsq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una herramienta m√°s visual para solicitar objetos OID espec√≠ficos usando archivos MIB es snmpget: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/iz/6n/2v/iz6n2vstdjeaxgsw2fhjqlcra3u.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ahora pasemos a configurar un elemento de datos t√≠pico para SNMPv3, como parte de la plantilla Zabbix. Por simplicidad e independencia de la MIB, utilizo OID digitales: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/aw/ig/-h/awig-hyentp_3pgvn3urihj7fye.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
utilizo macros personalizadas en campos clave, porque ser√°n los mismos para todos los elementos de datos en la plantilla. Puede configurarlos como parte de la plantilla si todos los dispositivos de red en su red tienen los mismos par√°metros SNMPv3, o dentro del host si los par√°metros SNMPv3 para diferentes objetos de monitoreo son diferentes: </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/f7/ci/bp/f7cibpnkgslkyj7kq8spsekdi2k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenga en cuenta que el sistema de monitoreo solo tiene un nombre de usuario y contrase√±as para autenticaci√≥n y cifrado . El grupo de usuarios y el √°rea de objetos MIB a los que se permite el acceso se configuran en el objeto de supervisi√≥n.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora pasemos a completar la plantilla.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plantilla de encuesta Zabbix</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una regla simple al crear cualquier plantilla de encuesta es hacerla lo m√°s detallada posible: </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/fh/nc/am/fhncamsfgnhkd-h4dy8px17isq4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
presto mucha atenci√≥n al inventario para que sea m√°s conveniente trabajar con una red grande. </font><font style="vertical-align: inherit;">Acerca de esto un poco m√°s tarde, pero por ahora, desencadena:</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/g1/4g/mt/g14gmt7flcx9jhv8q8vgjnee4qe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para facilitar la visualizaci√≥n de los desencadenantes, sus nombres contienen macros del sistema {HOST.CONN}, de modo que no solo se muestran los nombres de los dispositivos, sino tambi√©n las direcciones IP en el tablero en la secci√≥n de alertas, aunque esto es m√°s una cuesti√≥n de conveniencia de lo necesario. Para determinar la indisponibilidad del dispositivo, adem√°s de la solicitud de eco habitual, utilizo la verificaci√≥n de indisponibilidad del host SNMP cuando el objeto es accesible a trav√©s de ICMP pero no responde a las solicitudes SNMP; esta situaci√≥n es posible, por ejemplo, al duplicar direcciones IP en diferentes dispositivos, debido a firewalls configurados incorrectamente o configuraciones SNMP incorrectas en objetos de monitoreo. Si usa el control de acceso de host solo a trav√©s de ICMP, en el momento de investigar incidentes en la red, es posible que no aparezcan los datos de monitoreo, por lo que su recepci√≥n debe controlarse.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pasemos a descubrir las interfaces de red: para los equipos de red, esta es la funci√≥n de monitoreo m√°s importante. </font><font style="vertical-align: inherit;">Como puede haber cientos de interfaces en un dispositivo de red, es necesario filtrar las innecesarias para no saturar la visualizaci√≥n y la base de datos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilizo la funci√≥n de detecci√≥n est√°ndar para SNMP, con una gran cantidad de par√°metros detectables, para un filtrado m√°s flexible:</font></font><br>
<br>
<pre><code class="plaintext hljs">discovery[{#IFDESCR},1.3.6.1.2.1.2.2.1.2,{#IFALIAS},1.3.6.1.2.1.31.1.1.1.18,{#IFADMINSTATUS},1.3.6.1.2.1.2.2.1.7]</code></pre><br>
<img src="https://habrastorage.org/webt/1m/vp/fu/1mvpfu0kalas5i-w-9uyb5-pk3s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con esta detecci√≥n, puede filtrar las interfaces de red por sus tipos, descripciones de usuario "descripci√≥n" y estados administrativos de los puertos. </font><font style="vertical-align: inherit;">Los filtros y las expresiones regulares para el filtrado en mi caso se ven de la siguiente manera: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/c1/z_/ym/c1z_ymi8yjcpt-cncmzdfdmynlq.png"><br>
 <br>
<img src="https://habrastorage.org/webt/et/wv/aj/etwvajeuy5h9jwx7bdwyocmhn1c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
al detectarlo, se excluir√°n las siguientes interfaces:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deshabilitado manualmente (adminstatus &lt;&gt; 1), gracias a IFADMINSTATUS;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no tener una descripci√≥n de texto, gracias a IFALIAS;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">teniendo * en la descripci√≥n del texto gracias a IFALIAS;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ser oficial o t√©cnico gracias a IFDESCR (en mi caso, en expresiones regulares IFALIAS e IFDESCR se verifican con una expresi√≥n regular de alias).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La plantilla de recopilaci√≥n de datos SNMPv3 est√° casi lista. </font><font style="vertical-align: inherit;">No nos detendremos en prototipos de elementos de datos para interfaces de red, pasaremos a los resultados.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resultados de monitoreo</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para empezar, un inventario de una red peque√±a: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bm/s0/h1/bms0h1txizz1lm_p9bdw3iwyvaa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
si prepara plantillas para cada serie de dispositivos de red, puede lograr un dise√±o conveniente para analizar los datos resumidos del software actual, los n√∫meros de serie y la notificaci√≥n de la llegada de una mujer de limpieza al servidor (debido al peque√±o tiempo de actividad). </font><font style="vertical-align: inherit;">A continuaci√≥n se muestra un extracto de mi lista de plantillas: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i8/ok/ju/i8okju-_mwfomxxj1quhf1eaifk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y ahora, el panel principal, con desencadenantes distribuidos por nivel de gravedad:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rs/cr/-t/rscr-tzx6tnsbpjqqnxwyfhu-qg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gracias a un enfoque integrado de las plantillas para cada modelo de dispositivos en la red, es posible lograr que, dentro del marco de un sistema de monitoreo, se organice una herramienta para predecir fallas y accidentes (si hay sensores y m√©tricas apropiadas). </font><font style="vertical-align: inherit;">Zabbix es muy adecuado para monitorear redes, servidores, infraestructuras de servicios, y la tarea de dar servicio a los equipos de red demuestra claramente sus capacidades.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lista de fuentes utilizadas:</font></font></b><div class="spoiler_text">1. Hucaby D. CCNP Routing and Switching SWITCH 300-115 Official Cert Guide. Cisco Press, 2014. pp. 325-329.<br>
2. RFC 3410. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tools.ietf.org/html/rfc3410</a><br>
3. RFC 3415. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tools.ietf.org/html/rfc3415</a><br>
4. SNMP Configuration Guide, Cisco IOS XE Release 3SE. Chapter: SNMP Version 3. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.cisco.com/c/en/us/td/docs/ios-xml/ios/snmp/configuration/xe-3se/3850/snmp-xe-3se-3850-book/nm-snmp-snmpv3.html</a><br>
</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es495694/index.html">Servicio de referencia de aplicaciones m√≥viles</a></li>
<li><a href="../es495696/index.html">C√≥mo Prince of Persia Creator supera los l√≠mites de memoria de Apple II</a></li>
<li><a href="../es495698/index.html">Arquitectura cliente-servidor en im√°genes</a></li>
<li><a href="../es495700/index.html">Doom Boy ESP32</a></li>
<li><a href="../es495702/index.html">Estudiamos el motor VoIP Mediastreamer2. Parte 1</a></li>
<li><a href="../es495706/index.html">Noticias del mundo de OpenStreetMap No. 505 (03.17.2020-23.03.2020)</a></li>
<li><a href="../es495708/index.html">Servidor VPN de emergencia Openconnect con autorizaci√≥n de dos factores en Centos 8</a></li>
<li><a href="../es495712/index.html">Establecemos objetivos de desarrollo (en una empresa sangrienta y no solo)</a></li>
<li><a href="../es495716/index.html">Mitos sobre el aprendizaje de lenguas extranjeras.</a></li>
<li><a href="../es495718/index.html">Master JetBrains e ITMO: seguimos estudiando intensamente y anunciamos una jornada de puertas abiertas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>