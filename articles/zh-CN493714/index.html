<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐉 🌞 👩🏻‍🏫 安全备忘单：Node.js 👨‍🏭 👴🏻 🏤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="关于NodeJS的流行已经有很多说法。应用程序数量的增加是显而易见的-NodeJS非常易于学习，拥有大量的库以及动态发展的生态系统。
 
 我们已基于OWASP备忘单为NodeJS开发人员准备了建议，以帮助您预测开发应用程序时的安全问题。
 
 NodeJS应用程序的安全建议可以分为以下几类：
 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>安全备忘单：Node.js</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/acribia/blog/493714/"><img src="https://habrastorage.org/webt/bs/ml/lo/bsmllozt2li3jmn_6ec8vy4krdq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
关于NodeJS的流行已经有很多说法。</font><font style="vertical-align: inherit;">应用程序数量的增加是显而易见的-NodeJS非常易于学习，拥有大量的库以及动态发展的生态系统。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们已</font><font style="vertical-align: inherit;">基于OWASP备忘单</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为NodeJS开发人员</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">准备了</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><b><font style="vertical-align: inherit;">建议，</font></b></a><font style="vertical-align: inherit;">以帮助您预测开发应用程序时的安全问题。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NodeJS应用程序的安全建议可以分为以下几类：</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序开发过程中的安全性；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器安全性；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平台安全；</font></font></li>
</ul><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用开发安全</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">避免</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
使用回调函数（回调）是NodeJS的最大优势之一，但是，在嵌套回调时，您很容易忘记在其中一个函数中处理错误。</font><font style="vertical-align: inherit;">避免回调地狱的一种方法是使用promise。</font><font style="vertical-align: inherit;">即使您使用的模块不支持使用Promise，也可以始终使用Promise.promisifyAll（）。</font><font style="vertical-align: inherit;">但是即使使用诺言，也要注意嵌套。</font><font style="vertical-align: inherit;">为了完全避免回调地狱错误，请遵循“平坦”的承诺链。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回调地狱示例：</font></font></i><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">function <span class="hljs-title">func1</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">500</span>);<font></font>
}<font></font>
<span class="hljs-function">function <span class="hljs-title">func2</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">100</span>);<font></font>
}<font></font>
<span class="hljs-function">function <span class="hljs-title">func3</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">900</span>);<font></font>
}<font></font>
<span class="hljs-function">function <span class="hljs-title">func4</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">3000</span>);<font></font>
}<font></font>
<font></font>
func1(<span class="hljs-string">"input1"</span>, function(err, result1){
   <span class="hljs-keyword">if</span>(err){
      <span class="hljs-comment">// error operations</span><font></font>
   }<font></font>
   <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">//some operations</span>
      func2(<span class="hljs-string">"input2"</span>, function(err, result2){
         <span class="hljs-keyword">if</span>(err){
            <span class="hljs-comment">//error operations</span><font></font>
         }<font></font>
         <span class="hljs-keyword">else</span>{
            <span class="hljs-comment">//some operations</span>
            func3(<span class="hljs-string">"input3"</span>, function(err, result3){
               <span class="hljs-keyword">if</span>(err){
                  <span class="hljs-comment">//error operations</span><font></font>
               }<font></font>
               <span class="hljs-keyword">else</span>{
                  <span class="hljs-comment">// some operations</span>
                  func4(<span class="hljs-string">"input 4"</span>, function(err, result4){
                     <span class="hljs-keyword">if</span>(err){
                        <span class="hljs-comment">// error operations</span><font></font>
                     }<font></font>
                     <span class="hljs-keyword">else</span> {
                        <span class="hljs-comment">// some operations</span><font></font>
                     }<font></font>
                  });<font></font>
               }<font></font>
            });<font></font>
         }<font></font>
      });<font></font>
   }<font></font>
});<font></font>
</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用平链承诺的相同代码：</font></font></i><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">function <span class="hljs-title">func1</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">500</span>);<font></font>
}<font></font>
<span class="hljs-function">function <span class="hljs-title">func2</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">100</span>);<font></font>
}<font></font>
<span class="hljs-function">function <span class="hljs-title">func3</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">900</span>);<font></font>
}<font></font>
<span class="hljs-function">function <span class="hljs-title">func4</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">3000</span>);<font></font>
}<font></font>
<font></font>
func1(<span class="hljs-string">"input1"</span>)<font></font>
   .then(function (result){<font></font>
      <span class="hljs-keyword">return</span> func2(<span class="hljs-string">"input2"</span>);<font></font>
   })<font></font>
   .then(function (result){<font></font>
      <span class="hljs-keyword">return</span> func3(<span class="hljs-string">"input3"</span>);<font></font>
   })<font></font>
   .then(function (result){<font></font>
      <span class="hljs-keyword">return</span> func4(<span class="hljs-string">"input4"</span>);<font></font>
   })<font></font>
   .<span class="hljs-keyword">catch</span>(function (error) {
      <span class="hljs-comment">// error operations</span><font></font>
   });<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制请求的大小</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
解析</font><b><font style="vertical-align: inherit;">请求</font></b><font style="vertical-align: inherit;">主体可能是一项非常耗费资源的操作。如果您不限制请求的大小，攻击者将能够发送足够大的请求，这些请求可以填满所有磁盘空间或耗尽所有服务器资源，但同时，在所有情况下限制请求大小可能是不正确的，因为存在请求，例如下载文件。因此，建议为不同类型的内容设置限制。例如，使用快速框架，可以按以下方式实现：</font></font><br>
<br>
<pre><code class="java hljs">app.use(express.urlencoded({ limit: <span class="hljs-string">"1kb"</span> }));<font></font>
app.use(express.json({ limit: <span class="hljs-string">"1kb"</span> }));<font></font>
app.use(express.multipart({ limit:<span class="hljs-string">"10mb"</span> }));
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 应当注意，攻击者可以更改请求内容的类型和规避限制，因此，有必要检查请求的内容是否与请求标头中指定的内容类型相匹配。</font><font style="vertical-align: inherit;">如果检查内容的类型会影响性能，则只能检查某些类型或大于特定大小的查询。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不要阻塞事件循环</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
语言的重要组成部分是事件循环，它仅允许您切换执行上下文，而无需等待操作完成。</font><font style="vertical-align: inherit;">但是，有些阻塞操作的NodeJS必须等待其完成才能继续执行代码。</font><font style="vertical-align: inherit;">例如，大多数同步方法正在阻塞：</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">const</span> fs = require(<span class="hljs-string">'fs'</span>);<font></font>
fs.unlinkSync(<span class="hljs-string">'/file.txt'</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
建议异步执行此类操作：</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">const</span> fs = require(<span class="hljs-string">'fs'</span>);<font></font>
fs.unlink(<span class="hljs-string">'/file.txt'</span>, (err) =&gt; {
    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 同时，不要忘记异步调用之后的代码将在不等待上一个操作完成的情况下执行。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例如，在下面的代码中，文件将在读取前被删除，这可能导致竞争。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">const</span> fs = require(<span class="hljs-string">'fs'</span>);<font></font>
fs.readFile(<span class="hljs-string">'/file.txt'</span>, (err, data) =&gt; {
  <span class="hljs-comment">// perform actions on file content</span><font></font>
});<font></font>
fs.unlinkSync(<span class="hljs-string">'/file.txt'</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 为了避免这种情况，您可以在非阻塞函数中编写所有操作：</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">const</span> fs = require(<span class="hljs-string">'fs'</span>);<font></font>
fs.readFile(<span class="hljs-string">'/file.txt'</span>, (err, data) =&gt; {
  <span class="hljs-comment">// perform actions on file content</span>
  fs.unlink(<span class="hljs-string">'/file.txt'</span>, (err) =&gt; {
    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<font></font>
  });<font></font>
});<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查输入字段</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
检查</font><b><font style="vertical-align: inherit;">输入</font></b><font style="vertical-align: inherit;">字段是任何应用程序安全性的重要组成部分。验证错误可能导致您的应用程序立即变得容易受到多种攻击：sql注入，xss，命令注入和其他攻击。为了简化表单验证，您可以使用mongo-express-sanitize验证程序包。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转义用户数据</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
可以保护您免受xss攻击的规则之一就是屏蔽用户数据。您可以为此使用escape-html或node-esapi库。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保留日志</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
此外，它将有助于调试错误，日志可用于响应事件。您可以</font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">在此处</font></a></b><font style="vertical-align: inherit;">阅读有关登录需求的更多信息</font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">最流行的NodeJS日志记录软件包之一是Winston和Bunyan。</font><font style="vertical-align: inherit;">下面的示例显示如何使用Winston将日志输出到控制台和文件：</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> logger = <span class="hljs-keyword">new</span> (Winston.Logger) ({<font></font>
    transports: [<font></font>
        <span class="hljs-keyword">new</span> (winston.transports.Console)(),
        <span class="hljs-keyword">new</span> (winston.transports.File)({ filename: <span class="hljs-string">'application.log'</span> })<font></font>
    ],<font></font>
    level: <span class="hljs-string">'verbose'</span><font></font>
});<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制事件的周期</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
如果您的服务器处于繁忙的网络流量中，则用户在使用服务时可能会遇到困难。</font><font style="vertical-align: inherit;">这本质上是DoS攻击。</font><font style="vertical-align: inherit;">在这种情况下，您可以跟踪响应时间，如果响应时间超过指定的时间，则将消息发送到503服务器太忙。</font><font style="vertical-align: inherit;">toobusy-js模块可以提供帮助。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用模块的示例：</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> toobusy = require(<span class="hljs-string">'toobusy-js'</span>);
<span class="hljs-keyword">var</span> express = require(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">var</span> app = express();<font></font>
app.use(function(req, res, next) {<font></font>
    <span class="hljs-keyword">if</span> (toobusy()) {
        <span class="hljs-comment">// log if you see necessary</span>
        res.send(<span class="hljs-number">503</span>, <span class="hljs-string">"Server Too Busy"</span>);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
    next();<font></font>
    }<font></font>
});<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">采取预防措施以防蛮力，</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
再次，模块开始救援。</font><font style="vertical-align: inherit;">例如，快速粗麻布或快速弹跳器。</font><font style="vertical-align: inherit;">用法示例：</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> bouncer = require(<span class="hljs-string">'express-bouncer'</span>);<font></font>
bouncer.whitelist.push(<span class="hljs-string">'127.0.0.1'</span>); <span class="hljs-comment">// whitelist an IP address</span>
<span class="hljs-comment">// give a custom error message</span><font></font>
bouncer.blocked = function (req, res, next, remaining) {<font></font>
    res.send(<span class="hljs-number">429</span>, <span class="hljs-string">"Too many requests have been made. Please wait "</span> + remaining/<span class="hljs-number">1000</span> + <span class="hljs-string">" seconds."</span>);<font></font>
};<font></font>
<span class="hljs-comment">// route to protect</span>
app.post(<span class="hljs-string">"/login"</span>, bouncer.block, function(req, res) {
    <span class="hljs-keyword">if</span> (LoginFailed){  }
    <span class="hljs-keyword">else</span> {<font></font>
        bouncer.reset( req );<font></font>
    }<font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用验证码是另一种常见的暴力对策。</font><font style="vertical-align: inherit;">svg-captcha是帮助实现验证码的常用模块。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用CSRF令牌</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
抵御CSRF攻击的最可靠方法之一是使用CSRF令牌。</font><font style="vertical-align: inherit;">令牌必须以高熵生成，必须经过严格检查并与用户会话绑定。</font><font style="vertical-align: inherit;">为了确保CSRF令牌的运行，可以使用csurf模块。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
用法示例：</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> csrf = require(<span class="hljs-string">'csurf'</span>);<font></font>
csrfProtection = csrf({ cookie: <span class="hljs-keyword">true</span> });<font></font>
app.get(<span class="hljs-string">'/form'</span>, csrfProtection, function(req, res) {<font></font>
    res.render(<span class="hljs-string">'send'</span>, { csrfToken: req.csrfToken() })<font></font>
})<font></font>
app.post(<span class="hljs-string">'/process'</span>, parseForm, csrfProtection, function(req, res) {<font></font>
    res.send(<span class="hljs-string">'data is being processed'</span>);<font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不要忘记将令牌添加到页面上的隐藏字段中：</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;input type="hidden" name="_csrf" value="{{ csrfToken }}"&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以在我们的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文章中</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阅读有关CSRF令牌的更多信息</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除不必要的路由</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Web应用程序不应包含用户未使用的页面，因为这会增加攻击面。因此，必须禁用所有未使用的API路由。如果使用Sails或Feathers框架，则应特别注意该问题，因为它们会自动生成API端点。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保护自己免受HPP（HTTP参数污染）的影响</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
默认情况下，express将请求中的所有参数添加到数组中。 OWASP建议使用hpp模块，该模块会忽略req.query和/或req.body中的所有参数值，而仅从重复的值中选择最后一个值。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> hpp = require(<span class="hljs-string">'hpp'</span>);<font></font>
app.use(hpp());<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">监视返回的值，</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
例如，用户表可以存储重要数据：密码，电子邮件地址，出生日期等。</font><font style="vertical-align: inherit;">因此，仅返回必要的数据很重要。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例如：</font></font><br>
<br>
<pre><code class="java hljs"> <span class="hljs-keyword">exports</span>.sanitizeUser = function(user) {
  <span class="hljs-keyword">return</span> {<font></font>
    id: user.id,<font></font>
    username: user.username,<font></font>
    fullName: user.fullName<font></font>
  };<font></font>
};<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用描述符：描述</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
符可用于描述各种操作的属性行为：可写-是否可以更改属性的值，可枚举-是否可以在for..in循环中使用属性，可配置-是否可以覆盖属性。</font><font style="vertical-align: inherit;">建议注意列出的属性，因为在定义对象的属性时，默认情况下所有这些属性都设置为true。</font><font style="vertical-align: inherit;">您可以按如下所示更改属性的值：</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> o = {};<font></font>
Object.defineProperty(o, <span class="hljs-string">"a"</span>, {<font></font>
    writable: <span class="hljs-keyword">true</span>,<font></font>
    enumerable: <span class="hljs-keyword">true</span>,<font></font>
    configurable: <span class="hljs-keyword">true</span>,<font></font>
    value: <span class="hljs-string">"A"</span><font></font>
});<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用ACL</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Acl可帮助根据角色区分数据访问。</font><font style="vertical-align: inherit;">例如，添加权限如下所示：</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-comment">// guest is allowed to view blogs</span>
acl.allow(<span class="hljs-string">'guest'</span>, <span class="hljs-string">'blogs'</span>, <span class="hljs-string">'view'</span>)
<span class="hljs-comment">// allow function accepts arrays as any parameter</span>
acl.allow(<span class="hljs-string">'member'</span>, <span class="hljs-string">'blogs'</span>, [<span class="hljs-string">'edit'</span>, <span class="hljs-string">'view'</span>, <span class="hljs-string">'delete'</span>])
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">捕获uncaughtException</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
默认情况下，如果发生未捕获的异常，NodeJS将抛出当前堆栈跟踪并终止执行线程。</font><font style="vertical-align: inherit;">但是，NodeJS允许您自定义此行为。</font><font style="vertical-align: inherit;">如果发生未捕获的异常，则会引发uncaughtException事件，可以使用流程对象捕获该事件：</font></font><br>
<br>
<pre><code class="java hljs">process.on(<span class="hljs-string">"uncaughtException"</span>, function(err) {
    <span class="hljs-comment">// clean up allocated resources</span>
    <span class="hljs-comment">// log necessary error details to log files</span>
    process.exit(); <span class="hljs-comment">// exit the process to avoid unknown state</span><font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
值得记住的是，当发生uncaughtException时，您必须在完成Z进程之前清除所有分配的资源（例如，文件描述符和处理程序），以避免无法预料的错误。</font><font style="vertical-align: inherit;">强烈建议如果发生uncaughtException，则程序将继续运行。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同样，在显示错误消息时，用户不应泄露详细的错误信息，例如堆栈跟踪。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器安全性</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在使用cookie时，设置标头的标志</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
有几种标志可以帮助防止xss和csrf等攻击：httpOnly，它可以防止通过javascript访问cookie；</font><font style="vertical-align: inherit;">安全-仅允许通过HTTPS和SameSite发送cookie，这决定了将cookie传输到第三方资源的能力。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
用法示例：</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> session = require(<span class="hljs-string">'express-session'</span>);<font></font>
app.use(session({<font></font>
    secret: <span class="hljs-string">'your-secret-key'</span>,<font></font>
    key: <span class="hljs-string">'cookieName'</span>,<font></font>
    cookie: { secure: <span class="hljs-keyword">true</span>, httpOnly: <span class="hljs-keyword">true</span>, path: <span class="hljs-string">'/user'</span>, sameSite: <span class="hljs-keyword">true</span>}<font></font>
}));<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置HTTP标头以提高安全性</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
以下是标头和如何连接它们的示例，以帮助您保护自己免受多种常见攻击。</font><font style="vertical-align: inherit;">标头使用头盔模块设置</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
•严格传输安全性：HTTP严格传输安全性（HSTS）告诉浏览器只能通过HTTPS访问该应用程序</font></font><br>
<br>
<pre><code class="java hljs">app.use(helmet.hsts()); <span class="hljs-comment">// default configuration</span>
app.use(helmet.hsts(<span class="hljs-string">"&lt;max-age&gt;"</span>, <span class="hljs-string">"&lt;includeSubdomains&gt;"</span>)); <span class="hljs-comment">// custom configuration</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
•X-Frame-Options：确定页面是否可以在框架，iframe，嵌入或对象中使用</font></font><br>
<br>
<pre><code class="java hljs">app.use(hemlet.xframe()); <span class="hljs-comment">// default behavior (DENY)</span>
helmet.xframe(<span class="hljs-string">'sameorigin'</span>); <span class="hljs-comment">// SAMEORIGIN</span>
helmet.xframe(<span class="hljs-string">'allow-from'</span>, <span class="hljs-string">'http://alloweduri.com'</span>); <span class="hljs-comment">//ALLOW-FROM uri</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
•X-XSS-Protection：如果浏览器检测到反射的XSS攻击，则允许浏览器停止加载页面。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> xssFilter = require(<span class="hljs-string">'x-xss-protection'</span>);<font></font>
app.use(xssFilter());<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
•X-Content-Type-Options：用于防止使用MIME类型的攻击</font></font><br>
<br>
<pre><code class="java hljs">app.use(helmet.noSniff());
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
•内容安全策略：防止诸如XSS和数据注入攻击之类的攻击</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">const</span> csp = require(<span class="hljs-string">'helmet-csp'</span>)<font></font>
app.use(csp({<font></font>
   directives: {<font></font>
       defaultSrc: [<span class="hljs-string">"'self'"</span>],  <span class="hljs-comment">// default value for all directives that are absent</span>
       scriptSrc: [<span class="hljs-string">"'self'"</span>],   <span class="hljs-comment">// helps prevent XSS attacks</span>
       frameAncestors: [<span class="hljs-string">"'none'"</span>],  <span class="hljs-comment">// helps prevent Clickjacking attacks</span>
       imgSrc: [<span class="hljs-string">"'self'"</span>, <span class="hljs-string">"'http://imgexample.com'"</span>],<font></font>
       styleSrc: [<span class="hljs-string">"'none'"</span>]<font></font>
    }<font></font>
}))<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
•Cache-Control和Pragma：对于管理缓存，尤其是此标头对于包含敏感数据的页面很有用。</font><font style="vertical-align: inherit;">但是，请记住，禁用所有页面上的缓存会影响性能。</font></font><br>
<br>
<pre><code class="java hljs">app.use(helmet.noCache());
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
•X-Download-Options：标头可防止Inter Explorer执行下载的文件</font></font><br>
<br>
<pre><code class="java hljs">app.use(helmet.ieNoOpen());
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
•Expect-CT：证书透明性-一种为解决SSL证书基础结构中的某些问题而创建的机制，此标头告知浏览器CT日志中需要其他证书验证</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> expectCt = require(<span class="hljs-string">'expect-ct'</span>);<font></font>
app.use(expectCt({ maxAge: <span class="hljs-number">123</span> }));<font></font>
app.use(expectCt({ enforce: <span class="hljs-keyword">true</span>, maxAge: <span class="hljs-number">123</span> }));<font></font>
app.use(expectCt({ enforce: <span class="hljs-keyword">true</span>, maxAge: <span class="hljs-number">123</span>, reportUri: <span class="hljs-string">'http://example.com'</span>}));
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
•X-Powered-By：可选标头，用于指示服务器上使用的技术。</font><font style="vertical-align: inherit;">您可以按以下方式隐藏此标题：</font></font><br>
<br>
<pre><code class="java hljs">app.use(helmet.hidePoweredBy());
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 此外，您可以更改该值以隐藏有关所使用技术的真实信息：</font></font><br>
<br>
<pre><code class="java hljs">app.use(helmet.hidePoweredBy({ setTo: <span class="hljs-string">'PHP 4.2.0'</span> }));
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平台安全</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新软件包</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
应用程序的安全性取决于您使用的软件包的安全性，因此使用软件包的最新版本非常重要。为确保您使用的软件包不包含已知漏洞，可以使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特殊的OWASP列表</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。您还可以使用检查程序包中是否存在已知漏洞Retire.js的库。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请勿使用不安全的功能。</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
建议尽可能删除一些功能。在这些函数中有eval（），它执行一个作为参数的字符串。与用户输入结合使用时，使用此函数可能会导致远程执行代码漏洞，因为出于类似的原因，使用child_process.exec也是不安全的，因为该函数会将接收到的参数传递给bin / sh。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此外，应谨慎使用许多模块。例如，用于文件的fs模块。如果以某种方式将生成的用户输入传递给函数，则您的应用程序可能会变得容易受到本地文件和目录遍历的影响。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
vm模块提供用于在V8虚拟机上编译和运行代码的API，仅应在沙箱中使用。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这里，</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以熟悉可能会使您的应用程序不安全的其他函数；</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用正则表达式时要小心；</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
可以编写正则表达式，以使表达式可以成指数增长，从而导致拒绝服务。这种攻击称为ReDoS。有几种工具可以检查正则表达式是否安全，其中之一就是vuln-regex-detector。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定期运行lint</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在开发过程中，很难牢记所有安全建议，而在团队开发方面，要使所有团队成员都遵守规则并不容易。为此，有一些用于静态安全分析的工具。此类工具无需执行代码即可在其中寻找漏洞。此外，lint允许您添加自定义规则，以在代码中查找可能易受攻击的位置。最常用的短绒是ESLint和JSHint。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用严格模式</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Javascript有许多不安全和过时的功能，不应使用。为了排除使用这些功能的可能性，还提供了严格模式。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">遵守一般安全原则</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
所描述的建议集中在NodeJS上，但不要忘记无论使用什么平台，都必须遵守的一般安全性原则。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN493702/index.html">大规模过渡到远程工作：技术问题和对安全的威胁</a></li>
<li><a href="../zh-CN493704/index.html">在JavaScript中使用TypeScript而不编写TypeScript</a></li>
<li><a href="../zh-CN493706/index.html">认识你的敌人：创建一个Node.js后门</a></li>
<li><a href="../zh-CN493708/index.html">我的家庭Kubernetes集群的剖析</a></li>
<li><a href="../zh-CN493712/index.html">新的TypeScript功能可增强可用性</a></li>
<li><a href="../zh-CN493716/index.html">使用as const构造和infer关键字使用TypeScript进行类型推断</a></li>
<li><a href="../zh-CN493718/index.html">讨论：很少使用且当前正在使用的标准UNIX实用程序</a></li>
<li><a href="../zh-CN493720/index.html">完美风暴：技术如何改变食品服务行业</a></li>
<li><a href="../zh-CN493724/index.html">RPA | 通过分析人员实现流程自动化</a></li>
<li><a href="../zh-CN493726/index.html">基于Intel NUC的照片或视频的吸烟检测综合体</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>