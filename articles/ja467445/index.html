<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😿 🕯️ ⏹️ インストールされているWindows更新のわかりにくいリスト 🧑 🚜 🌄</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="インストールされているWindows更新プログラムの一覧が生成される理由を疑問に思ったことはありませんか？そしてそれを取得するためにどのAPIを使用しますか？これらの質問やその他の新たな質問への回答を、私の小さな調査で提供するように努めます。
 
 
 
 背景またはすべての始まり。
 当社では毎年...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>インストールされているWindows更新のわかりにくいリスト</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/467445/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インストールされているWindows更新プログラムの一覧が生成される理由を疑問に思ったことはありませんか？</font><font style="vertical-align: inherit;">そしてそれを取得するためにどのAPIを使用しますか？</font><font style="vertical-align: inherit;">これらの質問やその他の新たな質問への回答を、私の小さな調査で提供するように努めます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bb/rl/zc/bbrlzcws8p-tumczrzauuvx2l7w.jpeg"><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景またはすべての始まり。</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当社で</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は毎年、若手専門家によるカンファレンスを開催</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">して</font></a><font style="vertical-align: inherit;">おり、各参加者が部門の問題を解決することができます（事前にトピック一覧を提案）。そして、SPAS（ソフトウェアとハ​​ードウェアのサポート）部門には次のタスクがあり、興味を持っただけでなく、再びプログラミングに戻ることができました（残念ながら、現時点では、この会社でNPPSの単純なオペレーターとして働いています）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前は、WSUSを使用するすべての「TO」について、リリースされたすべての更新がプルされ、すべてのマシンに配布されていました。 TSB（テクニカルサービス速報）も定期的に表示され、分離されたパッケージの形で必要な更新をインストールする必要があることを示していました。その結果、WSUSでは追跡できない更新プログラムが蓄積されますが、コントロールパネルからは[インストールされた更新プログラム]セクションでしか確認できません。</font></font><br>
<br>
<br>
<br>
<img src="https://habrastorage.org/webt/v6/9f/kb/v69fkb557stfaokhfjpoccmnuma.png" alt="ビジュアル更新スキーム"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ワークステーションまたはサーバーが「クラッシュ」し、しばらく前に作成されたイメージからそれを復元する必要がある場合があります。イメージから回復するとき、マシンがクラッシュする前にインストールされた必要な更新（分離されたパッケージの形で提供された）が失われる可能性があります。明確化はすでに企業秘密であるため、彼はできる限り詳細に説明した。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、この更新リストを（できれば</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リモートから</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ローカルネットワーク経由で）</font><font style="vertical-align: inherit;">抽出</font><font style="vertical-align: inherit;">し、ファイル/データベースに書き込み、現在のリストを特定のテンプレートと比較し、プロトコルの1つ（SNMP、OPC）を介してSCADAシステムにメッセージを送信</font><font style="vertical-align: inherit;">できるプログラムを作成するというアイデアが生まれました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事のタイトルからお察しのように、リストの取得方法を選択するのはすでに困難な作業でした。</font><font style="vertical-align: inherit;">いつものように、私は検索エンジンで適切なものを検索することに決め、専門リソースについて質問しました（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一度</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2回</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、何らかの理由で英語のスタックオーバーフローは私の質問が気に入らなかったため、削除する必要がありました）。</font><font style="vertical-align: inherit;">したがって、私はそれを自分で理解する必要がありました。これについては後で説明します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンソールコマンド</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
簡単なツールから始めて、サードパーティのツールを使用せずにWindowsが提供する機能を利用してみましょう。</font><font style="vertical-align: inherit;">これは、次のコマンドを使用して実行できます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wmic qfeリスト</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">システム情報</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dism / online / get-packages</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PowerShell経由：</font></font><br>
 <br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修正プログラムを入手する</font></font></b></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get-SilWindowsUpdate</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（サーバーエディションでのみ使用可能）</font></font></li>
<li><b>Get-WmiObject -Class win32_quickfixengineering</b> —    WMI  win32_quickfixengineering ( WMI  )</li>
</ul><br>
 </li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コントロールパネルの[プログラムの追加と削除]の標準アイテムを使用して、グラフィカルインターフェイスからリストを取得できますが、そこからは何もコピーできません。各コントロールパネルツールは、Windows \ Systemフォルダー内の.cplファイルで表されます。 Windowsシステムフォルダ内の.Cplファイルは、コントロールパネルの起動時に自動的にダウンロードされます。 Appwiz.cplファイルは、プログラム項目を担当します。彼の分析は何も導きませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンソールコマンドの出力をファイルにリダイレクトしてから解析することができますが、これは誤りで、プログラムの呼び出し（SBの規則による）があり、リストをリモートで受信することは問題ありません。したがって、コマンドを呼び出して、各リストの更新数をコントロールパネルのリストと比較し、さらに調査を続けることをお勧めします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
正式には、アップデートのリストを取得するすべての方法は、ローカルとネットワークの2つのグループに分けることができます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jw/jt/nf/jwjtnfe3m0dqr_cc9q9xybhf1ka.png" alt="情報を取得するためのローカルおよびネットワークの方法"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての方法は、更新が統合されたクリーンなシステムイメージ（Windows 7、8、Server 2012 R2）でテストされました。公式のMicrosoftサーバーから更新センターを介して各更新が行われた後、追加のチェックが実行されました。</font><font style="vertical-align: inherit;">それぞれについて詳しく見ていきましょう。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WUA</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WUApi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Windows Update Agent API）-Windows Update Agent APIを使用します。</font><font style="vertical-align: inherit;">最も明白なオプションは、その名前がそれ自体を物語っています。</font><font style="vertical-align: inherit;">これにはWuapi.dllライブラリを使用します。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：以下では、便宜上、すべての結果をリストに埋め込みます。</font><font style="vertical-align: inherit;">これは合理的ではないかもしれませんが、私には良い考えのように思えました。</font></font></blockquote><div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装例</font></font></b><div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword">using</span> WUApiLib;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;<span class="hljs-keyword">string</span>&gt; <span class="hljs-title">listUpdateHistory</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
	<span class="hljs-comment">//WUApi</span>
	List&lt;<span class="hljs-keyword">string</span>&gt; result = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;(<span class="hljs-number">200</span>);<font></font>
<font></font>
	<span class="hljs-keyword">try</span><font></font>
	{<font></font>
		UpdateSession uSession = <span class="hljs-keyword">new</span> UpdateSession();<font></font>
		IUpdateSearcher uSearcher = uSession.CreateUpdateSearcher();<font></font>
		uSearcher.Online = <span class="hljs-literal">false</span>;<font></font>
		ISearchResult sResult = uSearcher.Search(<span class="hljs-string">"IsInstalled=1 And IsHidden=0"</span>);<font></font>
<font></font>
		<span class="hljs-keyword">string</span> sw = <span class="hljs-string">"   WUApi: "</span> + sResult.Updates.Count;<font></font>
		result.Add(sw);<font></font>
		<span class="hljs-keyword">foreach</span> (WUApiLib.IUpdate update <span class="hljs-keyword">in</span> sResult.Updates)<font></font>
		{<font></font>
			result.Add(update.Title);<font></font>
		}<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">catch</span> (Exception ex)<font></font>
	{<font></font>
		result.Add(<span class="hljs-string">"-   : "</span> + ex.Message);<font></font>
	}<font></font>
	<font></font>
	<span class="hljs-keyword">return</span> result;<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この方法には2つ目のバリエーションがあり</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><b><font style="vertical-align: inherit;">更新セッション</font></b><font style="vertical-align: inherit;"> -Windows Updateエージェントの更新セッションに接続して情報を受信します（この場合、ライブラリを直接操作しません）。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装例</font></font></b><div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;<span class="hljs-keyword">string</span>&gt; <span class="hljs-title">Sessionlist</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> pc</span>)</span><font></font>
{<font></font>
	List&lt;<span class="hljs-keyword">string</span>&gt; result = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;(<span class="hljs-number">50</span>); <span class="hljs-comment">//   </span><font></font>
<font></font>
	<span class="hljs-keyword">object</span> sess = <span class="hljs-literal">null</span>;
	<span class="hljs-keyword">object</span> search = <span class="hljs-literal">null</span>;
	<span class="hljs-keyword">object</span> coll = <span class="hljs-literal">null</span>;<font></font>
<font></font>
	<span class="hljs-keyword">try</span><font></font>
	{<font></font>
		sess = Activator.CreateInstance(Type.GetTypeFromProgID(<span class="hljs-string">"Microsoft.Update.Session"</span>, pc));<font></font>
		search = (sess <span class="hljs-keyword">as</span> <span class="hljs-keyword">dynamic</span>).CreateUpdateSearcher();<font></font>
<font></font>
		<span class="hljs-keyword">int</span> n = (search <span class="hljs-keyword">as</span> <span class="hljs-keyword">dynamic</span>).GetTotalHistoryCount();
		<span class="hljs-keyword">int</span> kol = <span class="hljs-number">0</span>;
		<span class="hljs-comment">//coll = (search as dynamic).QueryHistory(1, n);</span>
		coll = (search <span class="hljs-keyword">as</span> <span class="hljs-keyword">dynamic</span>).QueryHistory(<span class="hljs-number">0</span>, n);<font></font>
<font></font>
		result.Add(<span class="hljs-string">"  Update.Session: "</span> + n);
		<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">dynamic</span> item <span class="hljs-keyword">in</span> coll <span class="hljs-keyword">as</span> <span class="hljs-keyword">dynamic</span>)<font></font>
		{<font></font>
			<span class="hljs-keyword">if</span> (item.Operation == <span class="hljs-number">1</span>) result.Add(item.Title);<font></font>
			kol++;<font></font>
			<span class="hljs-comment">//Console.WriteLine(": " + kol);</span><font></font>
		}<font></font>
		result.Add(<span class="hljs-string">"  : "</span> + kol);<font></font>
	}<font></font>
	<span class="hljs-keyword">catch</span> (Exception ex)<font></font>
	{<font></font>
		result.Add(<span class="hljs-string">"-   : "</span> + ex.Message);<font></font>
	}<font></font>
	<span class="hljs-keyword">finally</span><font></font>
	{<font></font>
		<span class="hljs-keyword">if</span> (sess != <span class="hljs-literal">null</span>) Marshal.ReleaseComObject(sess);
		<span class="hljs-keyword">if</span> (search != <span class="hljs-literal">null</span>) Marshal.ReleaseComObject(search);
		<span class="hljs-keyword">if</span> (coll != <span class="hljs-literal">null</span>) Marshal.ReleaseComObject(coll);<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">return</span> result;<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Microsoft </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、APIの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リモート</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">使用を</font></a><font style="vertical-align: inherit;">推奨し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ています</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの2つの方法の主な欠点は、Windows Updateを通じて配布されていないKB修正を見つけられないことです。</font><font style="vertical-align: inherit;">更新エージェント自体を通過したものだけを確認できます。つまり、このオプションは適していません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DISM</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
展開イメージのサービスと（のマネジメントシステム</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">展開イメージのサービスと管理</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">） - Windowsイメージをサービスするか、Windows PE（WindowsのPE）を調製するために使用できるコマンドラインツール。</font><font style="vertical-align: inherit;">これは、パッケージマネージャー（Pkgmgr.exe）、PEimg、およびIntlcfgに代わるものです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このユーティリティは、アップデート、サービスパックをシステムイメージに統合するために使用されます。</font><font style="vertical-align: inherit;">Windowsの更新プログラムは、いくつかの方法で提示できる個別のモジュールです。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.cabファイル（キャビネット）-アーカイブ。</font><font style="vertical-align: inherit;">自動モードでWindows Updateモジュールを使用して配布およびインストールするように設計されています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.msuファイル（Microsoft Updateスタンドアロンパッケージ）-実行可能ファイル。</font><font style="vertical-align: inherit;">Microsoft更新カタログを通じて、ユーザー自身が手動モードで配布およびインストールできるように設計されています。</font><font style="vertical-align: inherit;">実際、これらは.cab-、. xml、.txtファイルで構成されるパッケージセットです。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前述の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dism / online / get-packages</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンド</font><font style="vertical-align: inherit;">は、wimイメージ/現在のシステム内のすべてのパッケージに関する基本情報を表示します。</font><font style="vertical-align: inherit;">Microsoftが私たちの面倒を見てくれ</font><font style="vertical-align: inherit;">、APIを便利に使用できるように</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NuGetパッケージ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">提供し</font><font style="vertical-align: inherit;">ています。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装例</font></font></b><div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword">using</span> Microsoft.Dism;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;<span class="hljs-keyword">string</span>&gt; <span class="hljs-title">DISMlist</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
	List&lt;<span class="hljs-keyword">string</span>&gt; result = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;(<span class="hljs-number">220</span>);<font></font>
<font></font>
	<span class="hljs-keyword">try</span><font></font>
	{<font></font>
		DismApi.Initialize(DismLogLevel.LogErrors);<font></font>
		<span class="hljs-keyword">var</span> dismsession = DismApi.OpenOnlineSession();
		<span class="hljs-keyword">var</span> listupdate = DismApi.GetPackages(dismsession);<font></font>
<font></font>
		<span class="hljs-keyword">int</span> ab = listupdate.Count;
		<span class="hljs-comment">//Console.WriteLine("   DISM: " + ab);</span>
		<span class="hljs-keyword">string</span> sw = <span class="hljs-string">"   DISM: "</span> + ab;<font></font>
		result.Add(sw);<font></font>
<font></font>
		<span class="hljs-keyword">foreach</span> (DismPackage feature <span class="hljs-keyword">in</span> listupdate)<font></font>
		{<font></font>
			result.Add(feature.PackageName);<font></font>
			<span class="hljs-comment">//result.Add($"[ ] {feature.PackageName}");</span>
			<span class="hljs-comment">//result.Add($"[ ] {feature.InstallTime}");</span>
			<span class="hljs-comment">//result.Add($"[ ] {feature.ReleaseType}");</span><font></font>
		}<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">catch</span> (Exception ex)<font></font>
	{<font></font>
		result.Add(<span class="hljs-string">"-   : "</span> + ex.Message);<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">return</span> result;<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
更新の数は、コントロールパネルのリストにある数と、コントロールセンターを介した最初の更新まで一致しました。その後、更新の数は少なくなりました（214でしたが209になりました）が、論理的には増加しているはずです。</font><font style="vertical-align: inherit;">出力例</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新する前に</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新後</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これの理由は何だと思います。おそらく、いくつかの更新が以前の更新を置き換えたため、数が少なくなりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
少し後、中国語の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DISM ++</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">からユーティリティに出会いました</font><font style="vertical-align: inherit;">。これはDISM APIまたはDISM Core APIに基づいていませんが、必要なオープンメソッドがないライブラリがあるため、このアイデアを放棄してさらに検索を続けました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WSUS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windows Server Update Services（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WSUS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）は、オペレーティングシステムとマイクロソフト製品を更新するためのサーバーです。</font><font style="vertical-align: inherit;">更新サーバーはMicrosoft Webサイトと同期し、企業LAN内で配布できる更新をダウンロードします。</font><font style="vertical-align: inherit;">繰り返しになりますが、アップデートで動作するように設計された特別なツールです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windowsのサーバーエディションでのみ配布されるため、次のスタンドが導入されました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メインシステムはWindows Server 2016です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">また、Hyper-V仮想化システムを通じて、2つのクライアントOSが導入されました。 </font></font><br>
 <ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィンドウズ8.1</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 7</font></font></li>
</ul><br>
 </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのシステムは単一の仮想ローカルエリアネットワークに接続されてい</font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ますが、インターネットにはアクセスできません</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いくつかのヒント</font></font></b><div class="spoiler_text">           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">WinNTSetup</a>     VHD  — ,   Windows 7 ( Professional/Ultimate),       .          Hyper-V —    .        BCD   <b>bcdedit /export e:\bcd_backup.bcd</b>.<br>
<br>
 AD      ,         WSUS :<br>
<br>
<img src="https://habrastorage.org/webt/j6/7f/v0/j67fv0mdw8mr8l0m73fowtmm238.png" alt=" "><br>
<br>
    ,  -  (8350  8530)       ,     .         Windows 7  Windows 8 .<br>
<br>
    WSUS     —     .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして今、小さなコード</font></font></b><div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-comment">//      </span>
<span class="hljs-keyword">using</span> Microsoft.UpdateServices.Administration;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;<span class="hljs-keyword">string</span>&gt; <span class="hljs-title">GetWSUSlist</span>(<span class="hljs-params"><span class="hljs-keyword">params</span> <span class="hljs-keyword">string</span>[] list</span>)</span><font></font>
{<font></font>
	List&lt;<span class="hljs-keyword">string</span>&gt; result = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;(<span class="hljs-number">200</span>); <span class="hljs-comment">//   </span><font></font>
<font></font>
	<span class="hljs-keyword">string</span> namehost = list[<span class="hljs-number">0</span>]; <span class="hljs-comment">// ,     string  = "example1";</span>
	<span class="hljs-keyword">string</span> servername = list[<span class="hljs-number">1</span>]; <span class="hljs-comment">//  string  = "WIN-E1U41FA6E55"; </span>
	<span class="hljs-keyword">string</span> Username = list[<span class="hljs-number">2</span>];
	<span class="hljs-keyword">string</span> Password = list[<span class="hljs-number">3</span>];<font></font>
	<font></font>
	<span class="hljs-keyword">try</span><font></font>
	{<font></font>
		<font></font>
		ComputerTargetScope scope = <span class="hljs-keyword">new</span> ComputerTargetScope();<font></font>
		IUpdateServer server = AdminProxy.GetUpdateServer(servername, <span class="hljs-literal">false</span>, <span class="hljs-number">8530</span>);<font></font>
		ComputerTargetCollection targets = server.GetComputerTargets(scope);<font></font>
		<span class="hljs-comment">// Search</span><font></font>
		targets = server.SearchComputerTargets(namehost);<font></font>
<font></font>
		<span class="hljs-comment">// To get only on server FindTarget method</span><font></font>
		IComputerTarget target = FindTarget(targets, namehost);<font></font>
		result.Add(<span class="hljs-string">" : "</span> + target.FullDomainName);<font></font>
<font></font>
		IUpdateSummary summary = target.GetUpdateInstallationSummary();<font></font>
		UpdateScope _updateScope = <span class="hljs-keyword">new</span> UpdateScope();
		<span class="hljs-comment">// See in UpdateInstallationStates all other properties criteria</span><font></font>
<font></font>
		<span class="hljs-comment">//_updateScope.IncludedInstallationStates = UpdateInstallationStates.Downloaded;</span><font></font>
		UpdateInstallationInfoCollection updatesInfo = target.GetUpdateInstallationInfoPerUpdate(_updateScope);<font></font>
<font></font>
		<span class="hljs-keyword">int</span> updateCount = updatesInfo.Count;<font></font>
<font></font>
		result.Add(<span class="hljs-string">" -   - "</span> + updateCount);<font></font>
<font></font>
		<span class="hljs-keyword">foreach</span> (IUpdateInstallationInfo updateInfo <span class="hljs-keyword">in</span> updatesInfo)<font></font>
		{<font></font>
			result.Add(updateInfo.GetUpdate().Title);<font></font>
		}<font></font>
<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">catch</span> (Exception ex)<font></font>
	{<font></font>
		result.Add(<span class="hljs-string">"-   : "</span> + ex.Message);<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">return</span> result;<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IComputerTarget <span class="hljs-title">FindTarget</span>(<span class="hljs-params">ComputerTargetCollection coll, <span class="hljs-keyword">string</span> computername</span>)</span><font></font>
{<font></font>
	<span class="hljs-keyword">foreach</span> (IComputerTarget target <span class="hljs-keyword">in</span> coll)<font></font>
	{<font></font>
		<span class="hljs-keyword">if</span> (target.FullDomainName.Contains(computername.ToLower()))
			<span class="hljs-keyword">return</span> target;<font></font>
	}<font></font>
	<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インターネットがないため、次のスクリーンショットのように、更新の状況が表示されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/az/gc/le/azgclepy6kznsibmilm1psoewa8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
動作はWUApiに似ています-更新が行われなかった場合、そのことはわかりません。</font><font style="vertical-align: inherit;">したがって、このメソッドは再び機能しません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wmi</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リテラル翻訳の</font><font style="vertical-align: inherit;">
Windows Management Instrumentation（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WMI</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）は、Windows管理ツールキットです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WMIは、</font><font style="vertical-align: inherit;">Windowsプラットフォームを実行しているコンピューターインフラストラクチャのさまざまな部分を集中管理および監視するため</font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にインターネット</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><u><font style="vertical-align: inherit;">介して</font></u><font style="vertical-align: inherit;">企業を管理するためにMicrosoftが実装した標準</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">WMIは、その中で動作するオペレーティングシステム、デバイス、およびアプリケーションの任意のパラメーターにアクセスするための、インターフェースのオープンな統合システムです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この方法では、ローカルマシンから、およびローカルネットワーク内でリモートからデータを受信できます。</font><font style="vertical-align: inherit;">WMIオブジェクトにアクセスするには、SQLの一種である特定のWMIクエリ言語（WQL）を使用します。</font><font style="vertical-align: inherit;">WMIクラス</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">win32_quickfixengineeringを</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介してリストを</font><b><font style="vertical-align: inherit;">受け取り</font></b><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装例</font></font></b><div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.Management;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;<span class="hljs-keyword">string</span>&gt; <span class="hljs-title">GetWMIlist</span>(<span class="hljs-params"><span class="hljs-keyword">params</span> <span class="hljs-keyword">string</span>[] list</span>)</span><font></font>
{<font></font>
List&lt;<span class="hljs-keyword">string</span>&gt; result = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;(<span class="hljs-number">200</span>); <span class="hljs-comment">//   </span><font></font>
<font></font>
ManagementScope Scope;<font></font>
<font></font>
<span class="hljs-keyword">string</span> ComputerName = list[<span class="hljs-number">0</span>];
<span class="hljs-keyword">string</span> Username = list[<span class="hljs-number">1</span>];
<span class="hljs-keyword">string</span> Password = list[<span class="hljs-number">2</span>];<font></font>
<font></font>
<span class="hljs-keyword">int</span> kol = <span class="hljs-number">0</span>;<font></font>
<font></font>
<span class="hljs-keyword">if</span> (!ComputerName.Equals(<span class="hljs-string">"localhost"</span>, StringComparison.OrdinalIgnoreCase))<font></font>
{<font></font>
	<span class="hljs-comment">//        ,     </span>
	<span class="hljs-comment">//      .</span>
	ConnectionOptions Conn = <span class="hljs-keyword">new</span> ConnectionOptions();<font></font>
	Conn.Username = Username;<font></font>
	Conn.Password = Password;<font></font>
	<span class="hljs-comment">//      «NTLMDOMAIN:»  NTLM  ,       NTLM.</span>
	Conn.Authority = <span class="hljs-string">"ntlmdomain:DOMAIN"</span>;<font></font>
	Scope = <span class="hljs-keyword">new</span> ManagementScope(String.Format(<span class="hljs-string">"\\\\{0}\\root\\CIMV2"</span>, ComputerName), Conn);<font></font>
}<font></font>
<span class="hljs-keyword">else</span>
	Scope = <span class="hljs-keyword">new</span> ManagementScope(String.Format(<span class="hljs-string">"\\\\{0}\\root\\CIMV2"</span>, ComputerName), <span class="hljs-literal">null</span>);<font></font>
<font></font>
<span class="hljs-keyword">try</span><font></font>
{<font></font>
	Scope.Connect();<font></font>
	ObjectQuery Query = <span class="hljs-keyword">new</span> ObjectQuery(<span class="hljs-string">"SELECT * FROM Win32_QuickFixEngineering"</span>);<font></font>
	ManagementObjectSearcher Searcher = <span class="hljs-keyword">new</span> ManagementObjectSearcher(Scope, Query);<font></font>
<font></font>
	<span class="hljs-keyword">foreach</span> (ManagementObject WmiObject <span class="hljs-keyword">in</span> Searcher.Get())<font></font>
	{<font></font>
		result.Add(WmiObject[<span class="hljs-string">"HotFixID"</span>].ToString());
		<span class="hljs-comment">//Console.WriteLine("{0,-35} {1,-40}", "HotFixID", WmiObject["HotFixID"]);// String</span>
		<span class="hljs-comment">//result.Add();</span>
		<span class="hljs-comment">/*result.Add("{0,-17} {1}", " : ", WmiObject["Description"]);
		result.Add("{0,-17} {1}", ": ", WmiObject["Caption"]);
		result.Add("{0,-17} {1}", " : ", WmiObject["InstalledOn"]);*/</span><font></font>
		kol++;<font></font>
	}<font></font>
	result.Add(<span class="hljs-string">"  "</span> + kol);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">catch</span> (Exception ex)<font></font>
{<font></font>
	result.Add(<span class="hljs-string">"-   : "</span> + ex.Message);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">return</span> result;<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
量的には、すべてが一致しているため（更新後も）、この方法を使用することにしました。</font><font style="vertical-align: inherit;">WMI要求をプログラムで作成するには、次のユーティリティを使用することをお勧めします</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-WMI Delphi Code Creator</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">彼女のおかげで、コードを少し違った形で見て、このプログラムのブランクを使用することにしました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XML</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WMI法で得られたデータに止まらず、「表面リバースエンジニアリング」に決めました。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Sysinternals Suite</font></a><font style="vertical-align: inherit;">プログラムコレクション</font><font style="vertical-align: inherit;">の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Process Monitor</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーティリティを使用して、</font><font style="vertical-align: inherit;">上記のコンソールコマンドを呼び出し、コントロールパネルから[Installed Updates]項目にアクセスするときに使用されるファイルとレジストリブランチを識別します。</font><font style="vertical-align: inherit;">
C：\ Windows \ servicing \ Packages \フォルダーにあるwuindex.xmlファイルに注意が向けられました。</font><font style="vertical-align: inherit;">それを分析するために、次のプログラムが作成されました。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンソールアプリケーションの例</font></font></b><div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Collections.Generic;
<span class="hljs-keyword">using</span> System.Linq;
<span class="hljs-keyword">using</span> System.Text;
<span class="hljs-keyword">using</span> System.Threading.Tasks;
<span class="hljs-keyword">using</span> System.Xml;
<span class="hljs-keyword">using</span> System.Text.RegularExpressions;
<span class="hljs-keyword">using</span> System.IO;<font></font>
<font></font>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">XMLviewer</span><font></font>
{<font></font>
    <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span><font></font>
    {<font></font>
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-keyword">string</span>[] args</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">string</span> writePath = AppDomain.CurrentDomain.BaseDirectory + <span class="hljs-string">"XML  "</span> + Environment.MachineName + <span class="hljs-string">".txt"</span>;
            <span class="hljs-keyword">if</span> (!File.Exists(writePath))<font></font>
            {<font></font>
                Console.WriteLine(<span class="hljs-string">"  txt "</span>);<font></font>
            }<font></font>
            <span class="hljs-keyword">else</span><font></font>
            {<font></font>
                Console.WriteLine(<span class="hljs-string">" XML .txt ,   "</span>);<font></font>
                File.Delete(writePath);<font></font>
            }<font></font>
<font></font>
            <span class="hljs-comment">//      KB</span>
            Regex regex = <span class="hljs-keyword">new</span> Regex(<span class="hljs-string">@"KB[0-9]{6,7}"</span>);
            <span class="hljs-comment">//Regex(@"(\w{2}\d{6,7}) ?");</span><font></font>
<font></font>
            <span class="hljs-comment">//SortedSet    ,     ""    </span>
            SortedSet&lt;<span class="hljs-keyword">string</span>&gt; spisok = <span class="hljs-keyword">new</span> SortedSet&lt;<span class="hljs-keyword">string</span>&gt;();<font></font>
<font></font>
            XmlDocument xDoc = <span class="hljs-keyword">new</span> XmlDocument();
            <span class="hljs-keyword">string</span> path = <span class="hljs-string">"C:\\Windows\\servicing\\Packages\\wuindex.xml"</span>; <span class="hljs-comment">//   xml</span><font></font>
            xDoc.Load(path);<font></font>
<font></font>
            <span class="hljs-keyword">int</span> kol = <span class="hljs-number">0</span>; <span class="hljs-comment">//- </span>
            <span class="hljs-keyword">int</span> total = <span class="hljs-number">0</span>; <span class="hljs-comment">//-    xml</span>
            <span class="hljs-keyword">int</span> total2 = <span class="hljs-number">0</span>; <span class="hljs-comment">//-  </span><font></font>
<font></font>
            XmlNodeList name = xDoc.GetElementsByTagName(<span class="hljs-string">"Mappings"</span>);
            <span class="hljs-keyword">foreach</span> (XmlNode xnode <span class="hljs-keyword">in</span> name)<font></font>
            {<font></font>
                <span class="hljs-comment">//Console.WriteLine(xnode.Name);</span><font></font>
                kol++;<font></font>
                XmlNode attr = xnode.Attributes.GetNamedItem(<span class="hljs-string">"UpdateId"</span>);
                <span class="hljs-comment">//Console.WriteLine(attr.Value);</span><font></font>
<font></font>
                <span class="hljs-keyword">foreach</span> (XmlNode childnode <span class="hljs-keyword">in</span> xnode.ChildNodes)<font></font>
                {<font></font>
                    XmlNode childattr = childnode.Attributes.GetNamedItem(<span class="hljs-string">"Package"</span>);<font></font>
                    total++;<font></font>
                    <span class="hljs-comment">//Console.WriteLine(childattr.Value);</span><font></font>
<font></font>
                    MatchCollection matches = regex.Matches(childattr.Value);<font></font>
                    <span class="hljs-keyword">if</span> (matches.Count &gt; <span class="hljs-number">0</span>)<font></font>
                    {<font></font>
                        <span class="hljs-keyword">foreach</span> (Match match <span class="hljs-keyword">in</span> matches)
                            <span class="hljs-comment">//Console.WriteLine(match.Value);</span><font></font>
                            spisok.Add(match.Value);<font></font>
                    }<font></font>
                    <span class="hljs-keyword">else</span><font></font>
                    {<font></font>
                        <span class="hljs-comment">//Console.WriteLine("  ");</span><font></font>
                    }<font></font>
                }<font></font>
<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">try</span><font></font>
            {<font></font>
                StreamWriter sw = <span class="hljs-keyword">new</span> StreamWriter(writePath);
                <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">string</span> element <span class="hljs-keyword">in</span> spisok)<font></font>
                {<font></font>
                    <span class="hljs-comment">//Console.WriteLine(element);</span><font></font>
                    sw.WriteLine(element);<font></font>
                    total2++;<font></font>
                }<font></font>
                sw.Close();<font></font>
            }<font></font>
            <span class="hljs-keyword">catch</span> (Exception ex)<font></font>
            {<font></font>
                Console.WriteLine(<span class="hljs-string">": "</span> + ex.Message);<font></font>
            }<font></font>
<font></font>
            <span class="hljs-comment">//Console.WriteLine("\n");</span>
            Console.WriteLine(<span class="hljs-string">" : "</span> +kol);<font></font>
<font></font>
            Console.WriteLine(<span class="hljs-string">"    xml: "</span> + total);<font></font>
<font></font>
            Console.WriteLine(<span class="hljs-string">" KB : "</span> + total2);<font></font>
<font></font>
            Console.WriteLine(<span class="hljs-string">"    ."</span>);<font></font>
            Console.Read();<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、このファイルはすべてのシステムで見つかるわけではなく、その生成と更新の原則は私にとって謎のままです。</font><font style="vertical-align: inherit;">したがって、この方法も適していません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cbs</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、これらすべてのメソッドが関連付けられているものに行きます。プロセスモニターのログの分析を続けると、次のフォルダーとファイルが見つかりました。</font><b><font style="vertical-align: inherit;">C：\ Windows \ SoftwareDistribution \ DataStoreフォルダーに</font></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
あるDataStore.edbファイル</font><font style="vertical-align: inherit;">。これは、インストールされているバージョンのWindowsへのすべての更新の履歴を含むデータベースです。</font><font style="vertical-align: inherit;">
DataStore.edb </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ESEDatabaseView</font></a><font style="vertical-align: inherit;">ファイルの分析にプログラムが使用されました</font><font style="vertical-align: inherit;">。データベースにtbUpdatesテーブルがあり、その内容を解釈することが困難です。</font><font style="vertical-align: inherit;">コントロールパネルでアイテムを開くたびに呼び出される</font><b><font style="vertical-align: inherit;">TiWorker.exe</font></b><font style="vertical-align: inherit;"> 
プロセス</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">注意が向けられた後</font><font style="vertical-align: inherit;">。彼は多くのフォルダーを「歩いて」、そのうちの1つが私を正しい道に導きました。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/n4/1v/b0/n41vb0kmc5axymvp2gd3qax5bek.png" alt="ESEDatabaseViewのTbUpdatesテーブル"><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C：\ Windows \ SoftwareDistribution</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、Windows Updateが更新をコンピューターにダウンロードしてインストールするために使用するフォルダーです。以前にインストールされたすべての更新に関する情報も格納されます。</font><b><font style="vertical-align: inherit;">C：\ Windows \ winsxsに</font></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
あるWinSxSフォルダー</font><font style="vertical-align: inherit;">。これは、以前にインストールされたバージョンのシステムコンポーネントを格納するために使用されるWindowsオペレーティングシステムのサービスフォルダです。その存在により、必要に応じてアップデートの古いバージョンにロールバックすることが可能です。</font><b><font style="vertical-align: inherit;">C：\ Windows \ servicing-</font></b><font style="vertical-align: inherit;">システム全体の主要コンポーネントで、その名前は</font><b><font style="vertical-align: inherit;">Component-Based Servicing（CBS）</font></b><font style="vertical-align: inherit;">です。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CBSは、Windowsの一部であり、Windows Updateと統合されているコンポーネントベースのサービスです。</font><font style="vertical-align: inherit;">ファイルがシステムディレクトリで直接更新さ</font><font style="vertical-align: inherit;">れる</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルベースのサービス（FBS）サービス</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Windows Vistaより前のオペレーティングシステム用</font><b><font style="vertical-align: inherit;">）</font></b><font style="vertical-align: inherit;">とは対照的に</font><font style="vertical-align: inherit;">、CBSはディレクトリの階層全体とモジュール/サービスライブラリのファミリ全体（スタック）を導入しました。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CbsApi.dll</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はメインのCBSテクノロジーサポートライブラリです。オープンメソッドがないため、直接使用できませんでした。 Microsoftは、TrustedInstaller.exeとTiWorker.exeを使用してこのライブラリのメソッドにアクセスし、これらのプロセスを介して必要なデータを表示しています。レコードは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C：\ Windows \ Logs \ CBS \ CBS.logに保持され</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムのプロトタイプの時点では（スクリーンショットに2019年5月が表示されています）、CBSに関するロシア語の情報はありませんでしたが、8月の終わりには非常に優れたブログ記事</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-http://datadump.ru/component-based-servicingがありました</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">私の経験を確認し、必要な情報を集めた非常に興味深い記事。</font><font style="vertical-align: inherit;">そして、トピックについて：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">http</font></a><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//www.outsidethebox.ms/17988/</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マイクロソフトは、更新プログラムのリストを取得するという簡単なタスクを複雑にしすぎており、このプロセスを完全に明白にしていない。</font><font style="vertical-align: inherit;">これはすべてセキュリティのために行われますが、使いやすさのためではありません。</font><font style="vertical-align: inherit;">私は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記事</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の著者に同意し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;"> -更新を受け取る際に予測可能性と透明性が欠如し始めました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
調査の結果、次の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プログラム</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が作成され</font><font style="vertical-align: inherit;">ました。このデモは、このビデオで見ることができます。</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/SNxReaN4EKY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
追加する計画：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要な更新のリストを受信した更新と比較します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SNMP / OPCを介して結果を送信します（経験者がいれば、コメントで共有してください）;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定されたフォルダから不足している「オフライン」アップデートのインストールを整理します。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アップデートだけでなく、追加コンポーネント（Adobe Flash、Acrobat Readerなど）のリストを取得する方法が他にもある場合や、その他の興味深い提案がある場合は、コメントまたはプライベートメッセージに記入してください-フィードバックをお待ちしております。</font><font style="vertical-align: inherit;">そして、この記事の調査に参加してください。そうすれば、ハブラハブの聴衆との私の経験が興味深いかどうかわかります。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja467429/index.html">Habrastatistics：サイトの最も訪問されたセクションと最も訪問されていないセクションの探索</a></li>
<li><a href="../ja467435/index.html">VeeamエージェントLinuxのレポートをメールまたはTelegramで送信します</a></li>
<li><a href="../ja467439/index.html">なぜレコード盤が戻ってきたのですか、ストリーミングサービスはこれにどのように関連していますか？</a></li>
<li><a href="../ja467441/index.html">Dockerはcnab-to-ociをCNABプロジェクトに渡します...そして一般的にCNABは何ですか？</a></li>
<li><a href="../ja467443/index.html">マルチメディアセンター「コディ」とヨクトプロジェクト</a></li>
<li><a href="../ja467449/index.html">脆弱性の検出と、スマートカードおよび暗号化プロセッサが組み込まれたハッカー攻撃に対する耐性の評価</a></li>
<li><a href="../ja467453/index.html">惑星スーパーコンピューターを使用して42番の問題を解決する</a></li>
<li><a href="../ja467455/index.html">Milanderコントローラーの例を使用してQtCreatorでマイクロコントローラーをプログラミングするためのQBSテンプレート</a></li>
<li><a href="../ja467457/index.html">手術からゲーム開発への道、またはUnityでのモバイル開発の最初の体験</a></li>
<li><a href="../ja467459/index.html">マイクロコントローラーが1.6 Gbpsでデータを読み取る方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>