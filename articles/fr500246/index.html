<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏿‍✈️ 🏴‍☠️ 🌻 Protection et piratage de la Xbox 360 (partie 3) 🌪️ 🎄 🧒🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En 2011, 6 ans après la sortie de la console de jeu Xbox 360, les chercheurs ont découvert un fait intéressant - si le signal «0» est envoyé à la sort...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Protection et piratage de la Xbox 360 (partie 3)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500246/"><img src="https://habrastorage.org/webt/ly/33/lc/ly33lcab4l10ezi7uwxcjouyzw8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En 2011, 6 ans après la sortie de la console de jeu Xbox 360, les chercheurs ont découvert un fait intéressant - si le signal «0» est envoyé à la sortie RESET du processeur central pendant très peu de temps, le processeur ne réinitialisera pas son état (comme il se doit), mais à la place changez votre comportement! </font><font style="vertical-align: inherit;">Sur la base de cette «fonctionnalité», </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reset Glitch Hack (RGH) a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> été développé </font><font style="vertical-align: inherit;">, avec l'aide duquel il a été possible de compromettre complètement la protection de la Xbox 360, d'exécuter du code non signé, ouvrant ainsi la voie au piratage du système lui-même et à la défaite des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lecteurs DG-16D5S</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> «incassables» </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinons de plus près comment RGH a fonctionné, comment les développeurs ont essayé de corriger un trou et comment ces correctifs ont pu se déplacer!</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'est-ce qu'une attaque glitch?</font></font></h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le processeur est assez stupide, quoi qu'en disent les spécialistes du marketing. </font><font style="vertical-align: inherit;">Tout le code de haut niveau écrit par les programmeurs est réduit à l'exécution de commandes simples - arithmétique avec des nombres, déplacement de données, sauts conditionnels et inconditionnels. </font><font style="vertical-align: inherit;">Il est supposé que le processeur exécute toujours ces commandes sans erreur et que le résultat correspond à la documentation.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ae/ae/ik/aeaeiktfaf_phbyprnjmqmwu0y4.png"></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En effet, la compilation du code</font></font><br>
<pre><code class="cpp hljs">i = i + <span class="hljs-number">2</span>;</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous comptez sur le fait que la valeur de la variable i augmentera exactement de 2, sans même savoir comment cela pourrait être autrement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les attaques Glitch violent cette confiance - leur objectif est de s'assurer que le processeur est «buggé» et se comporte mal. </font><font style="vertical-align: inherit;">Il y a plusieurs façons de "bégayer" le processeur, par exemple:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Réduisez la tension du processeur</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour donner une impulsion supplémentaire à la fréquence de référence du CPU</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Briller" sur le pourcentage de rayonnement</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe des dispositifs spéciaux pour effectuer de telles attaques - par exemple, ChipWhisperer offre une large gamme d'attaques en fréquence et en puissance:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/yc/uy/bu/ycuybuxustoyjxpu590edtbyjz0.jpeg" width="550"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le cas de la Xbox 360, un «pépin» se produit à la suite de l'exposition à la ligne RESET. </font><font style="vertical-align: inherit;">Le processeur commence la procédure de réinitialisation, mais en raison de la très courte durée du signal, il n'a pas le temps de le terminer et continue de fonctionner comme si de rien n'était. </font><font style="vertical-align: inherit;">Mais juste pour ce bref instant, alors que le signal RESET est actif, son comportement change!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Processeur Glitch</font></font></h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La protection de la Xbox 360 repose sur des chargeurs de démarrage se vérifiant les uns les autres dans une chaîne. En fin de compte, la vérification à chaque étape revient à appeler la fonction de comparaison de la somme de hachage avec le «modèle». C'est alors qu'ils ont appliqué l'attaque glitch, forçant le processeur à ignorer le décalage. Une impulsion vers la ligne RESET immédiatement après avoir appelé la procédure </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memcmp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> force le processeur à "parcourir" une autre branche et à continuer le chargement, même si la somme de hachage est incorrecte:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/e6/8a/i7/e68ai7t_wy0-har4u49gddcfwh4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le meilleur endroit pour attaquer a été trouvé dans le chargeur de démarrage de la deuxième étape, "CB". </font><font style="vertical-align: inherit;">Les étapes ultérieures sont plus difficiles à attaquer (et faciles à corriger), mais à la première étape du chargement ("1BL", ROM), l'attaque a échoué en raison d'une construction légèrement différente du code du programme. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela semble simple, mais en fait, lors de la tentative d'attaque, de nombreuses nuances ont été découvertes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Premièrement, afin de mener avec succès une attaque par pépin, il est nécessaire de déterminer très précisément le moment où une impulsion RESET doit être appliquée. </font><font style="vertical-align: inherit;">Si vous faites une erreur au moins pendant une microseconde, envoyez une impulsion trop courte ou trop longue, l'attaque ne fonctionne pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heureusement, sur Xbox 360, chaque étape de démarrage s'accompagne d'un changement de valeur sur le bus de débogage </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">POST_OUT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">De plus, la sortie de débogage est si souvent arrangée qu'une nouvelle valeur POST est définie immédiatement avant de comparer la somme de hachage:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/o_/pz/hn/o_pzhn6nqueomzmzvlv2vkkfazw.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, fermer l'emplacement de la sortie de débogage du site d'attaque était un déclencheur extrêmement pratique. </font><font style="vertical-align: inherit;">POST_OUT est un bus parallèle et est émis vers 8 sites de test sur la carte de circuit imprimé, chacun étant responsable d'un des bits de la valeur. </font><font style="vertical-align: inherit;">Il a même été possible de simplifier le schéma de connexion en utilisant un seul bit et en comptant le nombre de changements dans son état depuis le démarrage du système:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ci/zg/qm/cizgqmpbnxyy2jnhoy5fmqovkde.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'est également avéré qu'en raison de la fréquence élevée du processeur, il est presque impossible d'arriver au bon moment en termes de précision et de durée. </font><font style="vertical-align: inherit;">Le temps d'exposition doit être très court, de l'ordre du temps d'exécution d'une instruction par le processeur. </font><font style="vertical-align: inherit;">Mais plus le processeur tourne lentement, plus l'intervalle de temps nous convient. </font><font style="vertical-align: inherit;">Par conséquent, nous prenons et ralentissons le processeur! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur un PC ordinaire, la fréquence du CPU est définie comme le produit de la fréquence et du multiplicateur externe de référence:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/5h/vb/oo/5hvbooyj4elvow6nxit04kc4ypk.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, dans la Xbox 360, les lignes externes de la fréquence de référence conviennent au processeur, et à l'intérieur de cette fréquence est multipliée par </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PLL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Et sur les anciennes révisions «épaisses» du décodeur, le mécanisme PLL pouvait être désactivé, ce qui ralentissait le processeur jusqu'à 128 fois:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/sp/4w/yt/sp4wytmvkymnu5geqbdp0jwgtag.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur les versions «Slim», l'astuce PLL est impossible (la ligne n'est pas séparée sur la carte), et comme nous ne pouvons pas influencer le multiplicateur «Slim», nous allons réduire la fréquence «référence»! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est généré par la puce HANA et peut être configuré via le bus I2C:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/u0/mv/h3/u0mvh32w0mjhaeylbllspnsiwwc.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malheureusement, il n'a pas été possible de réduire beaucoup, «à basse vitesse», la fréquence finale du processeur a commencé à «nager» fortement, ce qui a réduit les chances de succès. </font><font style="vertical-align: inherit;">L'option la plus stable a été un ralentissement de 3,17 fois. </font><font style="vertical-align: inherit;">Pas 128 fois, mais au moins quelque chose. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout? </font><font style="vertical-align: inherit;">Non, pas tous. </font><font style="vertical-align: inherit;">C'est loin d'être un fait que l'attaque fonctionnera du premier coup (surtout sur Slim). </font><font style="vertical-align: inherit;">Et si le démarrage échoue, le préfixe redémarre et essaie de redémarrer. </font><font style="vertical-align: inherit;">Seulement 5 tentatives sont données pour démarrer, après quoi le préfixe s'arrête et commence à clignoter «l'anneau rouge de la mort». </font><font style="vertical-align: inherit;">Par conséquent, nous corrigeons également le micrologiciel du pont sud (SMC) afin qu'il ne souffre pas d'ordures et redémarre le préfixe jusqu'à ce qu'il devienne bleu:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/4s/em/3z/4sem3zqaipwaskszcy_nzntxdvu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, nous obtenons l'algorithme:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">patch SMC</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour cent de ralentissement (via PLL ou I2C)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en attente d'un déclencheur POST</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en attente de N microsecondes</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">envoyer une impulsion à RESET</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accélérer pour cent en arrière</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour une plus grande précision des calculs, nous prenons la fréquence du même HANA (48 MHz):</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/dq/cg/em/dqcgemuy43cr24pzdnor6sl2zpy.jpeg" width="550"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et nous obtenons une telle conception basée sur le CPLD Xilinx XC2C64A peu coûteux:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/yx/uf/5m/yxuf5mhm9uohsh7axeb_trevnue.jpeg" width="550"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N'oubliez pas de chamaniser avec la longueur et l'emplacement du câblage sur le RESET (faites attention à la "bobine" en bas de la photo) et en avant, j'espère que le lancement se fera en une minute. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais ce n'est que du côté matériel. </font><font style="vertical-align: inherit;">Comment patcher le chargeur de démarrage et remplir notre code?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chargeurs de patchs</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme je l'ai mentionné, le chargeur de démarrage de deuxième niveau, «CB», est attaqué. Ce chargeur de démarrage est chiffré avec une clé fixe, la même pour toutes les consoles, mais juste «CB» ne peut pas être modifié, nous l'attaquons seulement. Mais le suivant est déjà chiffré avec une clé CPU, unique pour chaque décodeur. Et pour la modifier, il faut connaître cette clé ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou pas? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les anciennes révisions «épaisses» de la Xbox 360, le mode dit «Zero-Pairing», qui était utilisé au stade de la production du décodeur, était pris en charge dans le chargeur de démarrage «CB». L'en-tête de chaque chargeur de démarrage à l'offset 0x10 contient un ensemble de données de couplage aléatoire qui est utilisé dans le cadre de la clé de déchiffrement. Et si cet ensemble de données était entièrement composé de zéros («Zero-Pairing»), la clé du processeur a été ignorée et une clé zéro fixe a été utilisée à la place!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/s6/yd/tc/s6ydtc65_pqwl6vqimx88x7j4ws.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec cette astuce, il a été possible d'assembler une image avec le "CB" d'origine, de crypter le chargeur de démarrage suivant, "CD" (avec son propre code) avec une clé zéro et de l'exécuter en utilisant RGH!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/s5/mg/9y/s5mg9ynt52prplbrelkmas-3hqg.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les consoles, «Slim» a encapsulé cette astuce, supprimant le mode «Zero-Pairing» et divisant le «CB» en deux parties. </font><font style="vertical-align: inherit;">Ici, "CB" était divisé en un "CB_A" très simple et petit et chiffré par la clé de processeur "CB_B":</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/io/kw/fr/iokwfrhtycw2bg8fd8qnuzq9c-c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais le chiffrement avec l'algorithme RC4 (à savoir, CB_B est chiffré avec cet algorithme) a une particularité. </font><font style="vertical-align: inherit;">Dans le processus de cryptage basé sur la clé, un flux de données pseudo-aléatoire est généré, qui est «additionné» binaire (opération «exclusif ou», «xor») avec les données source. </font><font style="vertical-align: inherit;">Lors du décryptage, en conséquence, la même chose se produit, l'ajout avec le même flux pseudo-aléatoire ramène les données à leur valeur d'origine:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/mw/_3/da/mw_3da2ixwvjpwa3wmxion8bjvk.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais l'opération d'addition binaire est commutative et associative, ce qui signifie que nous pouvons modifier les données cryptées sans connaître la clé, juste pour </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xor</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'et le code crypté avec le patch dont nous avons besoin!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/uc/hk/mr/uchkmrjc4tjpy5sepvgm_pv-jo4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conséquence, nous pouvons chiffrer "CB_A", patcher le "CB_B" chiffré (afin qu'il n'effectue pas du tout le déchiffrement) et mettre en clair "CD" avec son code!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/_q/g1/hg/_qg1hghntkm59bnmg1bv5xp4h_8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En bref, si vous l'assemblez, le lancement ressemble à ceci: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(XeLL est le chargeur de démarrage de homebrew, Linux, et il affiche également les clés du processeur)</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/JOiPjlWDA1A" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft riposte</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, Microsoft a essayé de tout rafistoler. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la nouvelle mise à jour du système, toutes les anciennes consoles ont été transférées vers un démarrage «séparé» de «CB_A» et «CB_B», fermant ainsi définitivement le mode «Zero-Paired». </font><font style="vertical-align: inherit;">Sur Slim, les chargeurs de démarrage ont également été mis à jour. </font><font style="vertical-align: inherit;">Les nouveaux bootloaders ont été sérieusement modifiés pour se protéger contre RGH, avec le plus grand accent mis sur la protection de CB_A:</font></font><br>
 <br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sortie de débogage complètement supprimée dans POST</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La vérification du hachage a été refaite et dupliquée pour plus de fiabilité</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout au long du code, sleep () a été défini pour une durée aléatoire (en fonction de la clé CPU !!)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajout de la vérification de fusion CBLDV pour révoquer CB_A</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ro/zh/ak/rozhaks1oyb4q0ck6f_2mbzmwmi.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La liste des innovations ne laisse aucune chance à RGH. </font><font style="vertical-align: inherit;">Mais attention au dernier élément de la liste - avant cela, il n'y avait pas de contrôle de fusion dans CB_A! </font><font style="vertical-align: inherit;">Erreur fatale. </font><font style="vertical-align: inherit;">De plus, comme nous le rappelons, la clé processeur n'est pas impliquée dans le décodage "CB_A". </font><font style="vertical-align: inherit;">Cela signifie que le chargeur CB_A vulnérable à RGH peut être lancé sur n'importe quelle console, et cela ne peut pas être interdit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais pour commencer quelque chose avec l'aide de ce "CB_A" vulnérable, vous devez esquiver un peu. </font><font style="vertical-align: inherit;">Si nous ne connaissons pas la clé CPU, il ne nous reste plus qu'à patcher le «CB_B» existant. </font><font style="vertical-align: inherit;">Mais que se passe-t-il si, au lieu de modifier des sections individuelles, nous remplaçons complètement le chargeur de démarrage entier? </font><font style="vertical-align: inherit;">Et pour cette raison, "écrire" l'ancien chargeur de démarrage, que nous savons déjà patcher, pour remplacer le nouveau? </font><font style="vertical-align: inherit;">Ils ont donc fait:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous chiffrons le CB_A vulnérable de la même manière que dans l'image d'origine</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XOR notre CB_B avec le nouveau, obtenant la «différence»</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous l'avons mis sur le "CB_B" crypté!</font></font></li>
</ol><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rt/4t/7c/rt4t7ct5vu1vfnvexya_4yjp_oc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout, encore une fois, sans connaître la clé, nous avons réussi à remplacer le contenu crypté et à mettre le chargeur de démarrage vulnérable. </font><font style="vertical-align: inherit;">Les consoles piratent, Microsoft est surpris. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les développeurs ont travaillé dur, et dans la prochaine mise à jour du système ... ont légèrement modifié la méthode de cryptage "CB_B", maintenant la clé de cryptage est également devenue dépendante de la version de "CB_A":</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/2_/zy/kq/2_zykqm27pplqsop8gquppheo4g.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, lors de la tentative de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xor</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'et de transfert des données vers le "CB_A" vulnérable de l'ancienne version, le chargeur a déchiffré les ordures en raison de différences de clés. </font><font style="vertical-align: inherit;">Et le nouveau chargeur de démarrage ne peut pas être piraté, il est bien protégé contre les attaques glich. </font><font style="vertical-align: inherit;">Jusqu'à présent, victoire pour Microsoft!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Corona pose des problèmes</font></font></h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pendant ce temps, une nouvelle révision de la Xbox 360, Corona, est entrée sur le marché, et elle a posé des problèmes aux moddeurs:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/fs/zj/b1/fszjb1roudnv3rix_uf3usnwml4.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pas assez de jetons sur la carte, pouvez-vous le trouver? </font><font style="vertical-align: inherit;">C'est vrai, la puce HANA était "cachée" dans le pont sud. </font><font style="vertical-align: inherit;">Il n'y a nulle part ailleurs pour prendre la fréquence de 48 MHz pour la puce mod, les précédentes commandes de ralentissement I2C ne fonctionnent pas. </font><font style="vertical-align: inherit;">Qu'est-ce que c'est, le flash NAND de 16 Mo, qui a servi de stockage système Xbox 360 toutes ces années, a été perfidement remplacé par une puce de 4 Go avec une interface eMMC! </font><font style="vertical-align: inherit;">(Vrai, seulement dans la version moins chère de la console, mais quand même):</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ho/pv/dl/hopvdl-wilvzq4pzvndoogihru4.jpeg" width="550"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais rien, tout a été réglé. </font><font style="vertical-align: inherit;">Nous avons compris comment lire / écrire la mémoire flash via un lecteur de carte:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/oo/sz/pj/ooszpjupnf_mgzwpkc-vry0ovou.jpeg" width="550"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trouvé de nouvelles commandes de ralentissement I2C, un oscillateur à cristal externe de 48 MHz a remplacé HANA:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/88/lm/ic/88lmicizuembheqjiod-uff7jau.jpeg" width="550"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Scripts de construction terminés, prise en charge supplémentaire de 4 Go de NAND ...</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qm/7a/tk/qm7atka28kaj3anjmoq2cgoalz0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais Microsoft a continué de mettre des bâtons dans les roues. </font><font style="vertical-align: inherit;">Par exemple, sur les nouvelles cartes, certaines résistances ont disparu, sans lesquelles la puce de mod a cessé de fonctionner:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/kv/ji/wg/kvjiwggxf9dncmv8rehaqhpzuy4.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Certes, cela a été résolu en installant des cavaliers avec un fer à souder:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ku/7x/sv/ku7xsv8rpu2fov8upv6g-osgfm8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les choses sont devenues plus sérieuses lorsque les pistes POST_OUT ont disparu du plateau:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/lu/lo/0m/lulo0m01ihmy34glpcoeriz4ojo.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais ici, Microsoft n'a pas eu de chance, les «boules» de CPU nécessaires pour RGH étaient à l'extrême:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/hc/nk/e2/hcnke2-7eh_xgrz0bmpf2ewtzro.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et, bien sûr, ils ont pu se connecter avec eux. </font><font style="vertical-align: inherit;">Tout d'abord, les plus douces, forant légèrement le bord du processeur et soudant directement à la balle avec le câblage:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gk/-t/k_/gk-tk_mzrvo5suirxpk_d_kknru.jpeg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/dw/ue/ai/dwueaifiz18-tfgrylfhdgkpats.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et puis les Chinois ont sorti un cadre avec une aiguille à ressort, reposant exactement sur la balle, et le problème a été résolu pour tout le monde:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/k7/sd/xj/k7sdxjysbtq9ofcadfby2jpdf-i.jpeg"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La dernière frontière</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir vaincu la «couronne», il y a eu un problème - les nouvelles versions du système n'ont pas cédé au piratage. Pour démarrer RGH, vous devez connaître la clé CPU et pour connaître la clé CPU, vous devez exécuter RGH au moins une fois. Le problème du poulet et des œufs en général. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et puis une pensée a surgi - et vérifions non seulement l'authentification «glitch», mais nous allons également sauter le décryptage! Si cela fonctionne, alors nous n'avons pas besoin de connaître la clé, mettez "CB_B" en clair, c'est tout. Cette idée a formé la base de Double Glitch Hack (DGX):</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/28/h2/yh/28h2yheods_vx8jptciovob9yby.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette puce a «bogué» deux fois le pourcentage, la première impulsion a sauté la phase de décryptage du chargeur de démarrage et la deuxième impulsion a sauté l'authentification. </font><font style="vertical-align: inherit;">Cela a fonctionné beaucoup moins stable, car au moins un lancement réussi a été nécessaire - nous obtenons ensuite la clé CPU et procédons comme auparavant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DGX n'a ​​pas été pertinent pendant longtemps, après 3 mois, les Chinois ont lancé la sortie de "DGX RIP" avec des images qui s'exécutent sur n'importe quel décodeur, fonctionnaient avec RGH standard et, bien sûr, ont commencé beaucoup plus stable:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ig/yv/fy/igyvfysfq1qsiyyefeqsknjiz1e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces images contenaient une version spéciale du chargeur de démarrage CB_A utilisé dans la production Xbox 360 et, en fait, est un analogue complet du bon vieux mode «Zero-Pairing». </font><font style="vertical-align: inherit;">Au lieu de la clé du processeur, ce "CB_A_mfg" a déchiffré "CB_B" avec une clé nulle fixe:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/_2/3k/n1/_23kn1nx7eydggdpskbzkudinv4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et voici Microsoft. </font><font style="vertical-align: inherit;">Dans cette version «service» de «CB_A», il n'y avait pas non plus de contrôle de fusion et il était impossible de l'interdire. </font><font style="vertical-align: inherit;">Il suffisait d'enregistrer l'image selon la révision de la Xbox 360, de souder la puce - et tout fonctionnait.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/fa/_9/hd/fa_9hdfa5kgwphr69k6xpdnyaia.jpeg" width="550"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Winchester!</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RGH a été entièrement corrigé uniquement dans la nouvelle révision de la console, appelée Winchester. </font><font style="vertical-align: inherit;">Pour la première fois, processeurs CPU et GPU réunis en une seule puce, la carte a été simplifiée au maximum:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/of/ps/1g/ofps1gt_gevcpmlz39aj97ukquc.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les pistes POST_OUT n'ont pas seulement été supprimées. </font><font style="vertical-align: inherit;">Même si vous soudez à la plate-forme sous le processeur:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ha/vg/c6/havgc6afvvs4nt5pn8lihldlspq.jpeg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nz/si/lc/nzsilch-pq6gun98tbugnx89owi.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et même si vous soudez le processeur à une version spéciale de la carte pour les développeurs, XDK, où ces pistes sont toujours là:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/m2/di/n4/m2din48-hbqpbs2aw_if-uorx0g.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur POST_OUT, une seule impulsion est visible au démarrage de la console. </font><font style="vertical-align: inherit;">Bus verrouillé:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/kq/6q/5c/kq6q5cngontmkypyxrsfbke-atw.png" width="550"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, il n'est bloqué qu'au stade de la production. </font><font style="vertical-align: inherit;">Si vous prenez un processeur «propre» dans une usine où vous n'avez pas encore brûlé de fusibles, POST_OUT fonctionne dessus!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/p0/ke/au/p0keau_qpxnl61bmosmxcv5unya.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais RGH dessus ne fonctionne plus. </font><font style="vertical-align: inherit;">Peu importe comment vous essayez de donner une impulsion de réinitialisation, le processeur effectue correctement une réinitialisation ou ignore votre signal en raison de sa durée trop courte. </font><font style="vertical-align: inherit;">Apparemment, un module logique spécial a été ajouté au processeur, filtrant la ligne RESET et a finalement corrigé l'erreur matérielle.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Post Scriptum</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'avère que la dernière révision de la Xbox 360 est impossible à pirater? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oui et non. </font><font style="vertical-align: inherit;">Pour le moment, il n'y a qu'une seule façon connue d'exécuter un système modifié sur les révisions de Winchester. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le kit de développement logiciel (XDK) contient diverses clés privées pour signer le code compilé. </font><font style="vertical-align: inherit;">Et il s'est avéré que parmi eux, la clé de signature «shadowboot», un chargeur de démarrage de troisième niveau pour les systèmes XDK, était encombrée. </font><font style="vertical-align: inherit;">Et avec lui, vous pouvez collecter une image signée légitime avec un firmware modifié. </font><font style="vertical-align: inherit;">Il suffit de travailler sur des consoles ordinaires "en magasin", il ne le fera pas. </font><font style="vertical-align: inherit;">Nous avons besoin d'un processeur avec la version XDK de la console, ou d'un CPU «propre» avec des fusibles non fusionnés (vous pouvez le voir sur Aliexpress):</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rr/sl/fz/rrslfzrmohmrxuagyadwvojnpvq.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et alors seulement vous aurez l'occasion d'envisager une telle inscription dans les "informations système" du shell personnalisé:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gg/te/g7/ggteg7iezt2c-hw-h_mczs132fe.jpeg" width="450"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et c'est tout! </font><font style="vertical-align: inherit;">Comme d'habitude, je suis prêt à répondre à vos questions dans les commentaires :) </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protection et piratage </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Xbox 360 </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">, partie 1 </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">Protection et piratage </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">Xbox 360 </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">, partie 2 </font></a></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protection et piratage Xbox 360, partie 3</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr500228/index.html">Comment Gatsby a contourné Next.js</a></li>
<li><a href="../fr500232/index.html">Apprendre Akka.NET: serveur d'un jeu en ligne simple</a></li>
<li><a href="../fr500234/index.html">Pourquoi j'ai fait un projet de comptabilité des dépenses personnelles pour Git + JS</a></li>
<li><a href="../fr500238/index.html">Dis moi ce qui te tracasse</a></li>
<li><a href="../fr500244/index.html">En dehors du tableau</a></li>
<li><a href="../fr500248/index.html">FOSS News n ° 14 - une revue des nouvelles gratuites et open source du 27 avril au 3 mai 2020</a></li>
<li><a href="../fr500250/index.html">Nouvelles du monde d'OpenStreetMap n ° 509 (04.14.2020-20.04.2020)</a></li>
<li><a href="../fr500252/index.html">Kaspersky Security Center - Nouveau niveau</a></li>
<li><a href="../fr500254/index.html">Nous écrivons front-end qui fonctionne. Ou comment devenir ingénieur d'un développeur. Partie 2</a></li>
<li><a href="../fr500256/index.html">Dmitry Lebedev: «Il y a quelques années, j'ai clairement compris qu'un peu plus et OpenStreetMap coulerait»</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>