<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçüé§ üë®üèª‚Äçüåæ üë®üèæ‚Äçüåæ Traiter des millions d'√©v√©nements par jour avec des files d'attente en cascade üéÖüèø üòÖ üëºüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Des centaines, des milliers et, dans certains services, des millions de files d'attente, √† travers lesquelles une √©norme quantit√© de donn√©es passe, to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Traiter des millions d'√©v√©nements par jour avec des files d'attente en cascade</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/manychat/blog/492964/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des centaines, des milliers et, dans certains services, des millions de files d'attente, √† travers lesquelles une √©norme quantit√© de donn√©es passe, tournent sous le capot de notre produit. </font><font style="vertical-align: inherit;">Tout cela doit √™tre trait√© d'une mani√®re magique et ne pas √™tre abattu. </font><font style="vertical-align: inherit;">Dans cet article, je vous dirai quelles approches architecturales nous utilisons √† la maison, ayant une pile technologique assez modeste et n'ayant pas un petit centre de donn√©es dans notre ¬´garde-manger¬ª.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/iq/-o/dc/iq-odcaikfzjfsiwqgpx2phk5us.png"><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'avons-nous?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, d'une part, nous avons une pile technologique bien connue: Nginx, PHP, PostgreSQL, Redis. </font><font style="vertical-align: inherit;">D'un autre c√¥t√©, des dizaines de milliers d'√©v√©nements se produisent dans notre syst√®me chaque minute et, au pic, il peut atteindre des centaines de milliers d'√©v√©nements. </font><font style="vertical-align: inherit;">Afin de clarifier ce que sont ces √©v√©nements et comment nous devons y r√©pondre, je ferai une petite digression sur le produit, apr√®s quoi je vous dirai comment nous avons d√©velopp√© le syst√®me d'automatisation bas√© sur les √©v√©nements.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ManyChat est une plateforme d'automatisation marketing. Le propri√©taire de la page Facebook peut la connecter √† notre plateforme et configurer l'automatisation de l'interaction avec ses abonn√©s (en d'autres termes, cr√©er un chat bot). L'automatisation consiste g√©n√©ralement en de nombreuses cha√Ænes d'interactions qui peuvent ne pas √™tre interconnect√©es. Au sein de ces cha√Ænes d'automatisation, certaines actions peuvent se produire avec l'abonn√©, par exemple, en attribuant une √©tiquette sp√©cifique dans le syst√®me ou en affectant / modifiant la valeur d'un champ dans la carte d'un abonn√©. Ces donn√©es vous permettent en outre de segmenter l'audience et de cr√©er une interaction plus pertinente avec les abonn√©s de la page.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos clients souhaitaient vraiment une automatisation bas√©e sur les √©v√©nements - la possibilit√© de personnaliser l'ex√©cution d'une action lorsqu'un √©v√©nement sp√©cifique est d√©clench√© au sein de l'abonn√© (par exemple, le balisage). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puisqu'un √©v√©nement d√©clencheur peut fonctionner √† partir de diff√©rentes cha√Ænes d'automatisation, il est important qu'il y ait un seul point de configuration pour toutes les actions bas√©es sur les √©v√©nements du c√¥t√© client, et de notre c√¥t√© traitement, il devrait y avoir un seul bus qui traite le changement dans le contexte de l'abonn√© √† partir de diff√©rents points d'automatisation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans notre syst√®me, il existe un bus commun par lequel passent tous les √©v√©nements survenant avec les abonn√©s. C'est plus de 500 millions d'√©v√©nements par jour. Leur traitement est assez d√©licat - il s'agit d'un enregistrement dans l'entrep√¥t de donn√©es, de sorte que le propri√©taire de la page a la possibilit√© de voir historiquement tout ce qui est arriv√© √† ses abonn√©s.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il semblerait que pour mettre en ≈ìuvre un syst√®me bas√© sur les √©v√©nements, nous ayons d√©j√† tout, et il nous suffit d'int√©grer notre logique m√©tier dans le traitement d'un bus d'√©v√©nements commun. </font><font style="vertical-align: inherit;">Mais nous avons certaines exigences pour notre nouveau syst√®me:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous ne voulons pas obtenir des performances d√©grad√©es dans le traitement du bus d'√©v√©nements principal</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est important pour nous de maintenir l'ordre de traitement des messages dans le nouveau syst√®me, car cela peut √™tre li√© √† la logique m√©tier du client qui configure l'automatisation</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âvitez l'effet des voisins bruyants lorsque des pages actives avec un grand nombre d'abonn√©s obstruent la file d'attente et bloquent le traitement des √©v√©nements des "petites" pages</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si nous int√©grons le traitement de notre logique dans le traitement d'un bus d'√©v√©nements commun, nous obtiendrons une d√©gradation s√©rieuse des performances, car nous devrons v√©rifier la conformit√© de chaque √©v√©nement avec l'automatisation configur√©e. </font><font style="vertical-align: inherit;">Dans le cadre de la configuration de l'automatisation, certains filtres peuvent √™tre appliqu√©s (par exemple, d√©marrer l'automatisation lorsqu'un √©v√©nement est d√©clench√© uniquement pour les clientes de plus de 30 ans). </font><font style="vertical-align: inherit;">Autrement dit, lors du traitement des √©v√©nements dans le bus principal, une √©norme quantit√© de demandes suppl√©mentaires √† la base de donn√©es sera trait√©e, et une logique plut√¥t lourde commencera √©galement √† comparer le contexte actuel de l'abonn√© avec les param√®tres d'automatisation. </font><font style="vertical-align: inherit;">Cette option ne nous convient pas, nous sommes donc all√©s plus loin.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xt/rq/in/xtrqingjirs1ne1ljopat1z-nti.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organisation d'une cascade de files d'attente</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtant donn√© que notre logique m√©tier associ√©e au syst√®me bas√© sur les √©v√©nements est tr√®s bien s√©parable de la logique de traitement des √©v√©nements du bus principal, nous d√©cidons de placer les types d'√©v√©nements dont nous avons besoin depuis le bus partag√© dans une file d'attente distincte pour un traitement ult√©rieur dans un flux de donn√©es s√©par√©. Ainsi, nous supprimons le probl√®me associ√© √† la d√©gradation des performances dans le traitement du bus d'√©v√©nements principal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au m√™me stade, nous d√©cidons de ce qu'il serait cool de transf√©rer des √©v√©nements vers la prochaine file d'attente en cascade pour placer ces √©v√©nements dans des files d'attente distinctes pour chaque bot. Ainsi, isoler l'activit√© de chaque bot dans le cadre de son tour, ce qui nous permet de r√©soudre le probl√®me li√© √† l'effet des voisins bruyants. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre diagramme de flux de donn√©es ressemble maintenant √† ceci:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/he/nz/2c/henz2cmwi9i5ii7pmzew-hokd3g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, pour que ce sch√©ma fonctionne, nous devons r√©soudre le probl√®me du traitement de nouvelles files d'attente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a plus de 1 million de pages connect√©es (bots) sur notre plate-forme, ce qui signifie que nous pouvons potentiellement obtenir ~ 1 million de files d'attente dans notre sch√©ma, uniquement au niveau de la couche bas√©e sur les √©v√©nements. </font><font style="vertical-align: inherit;">D'un point de vue technique, cela ne nous fait pas peur. </font><font style="vertical-align: inherit;">En tant que serveur de file d'attente, nous utilisons Redis avec ses types de donn√©es standard, tels que LIST, SORTED SET et autres. </font><font style="vertical-align: inherit;">Cela signifie qui chaque file d'attente est la structure de donn√©es standard pour Redis en RAM, qui peut √™tre cr√©√©e ou supprim√©e √† la vol√©e, ce qui nous permet de g√©rer facilement et de mani√®re flexible le grand nombre de files d'attente dans notre syst√®me. </font><font style="vertical-align: inherit;">Je parlerai plus en d√©tail de l'utilisation de Redis comme serveur de files d'attente avec des d√©tails techniques dans un article s√©par√©, mais pour l'instant, revenons √† notre architecture.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est clair que chaque bot a une activit√© diff√©rente et que la probabilit√© d'obtenir 1 million de files d'attente dans l'√©tat ¬´besoin de traiter maintenant¬ª est extr√™mement faible. </font><font style="vertical-align: inherit;">Mais √† un moment donn√©, il est tout √† fait possible que nous ayons quelques dizaines de milliers de files d'attente actives qui n√©cessitent un traitement. </font><font style="vertical-align: inherit;">Le nombre de ces files d'attente est en constante √©volution. </font><font style="vertical-align: inherit;">Ces files d'attente elles-m√™mes changent √©galement, certaines sont compl√®tement soustraites et supprim√©es, certaines sont cr√©√©es dynamiquement et remplies d'√©v√©nements pour le traitement. </font><font style="vertical-align: inherit;">En cons√©quence, nous devons trouver un moyen efficace de les g√©rer.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Traitement d'un √©norme pool de files d'attente</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons donc un tas de files d'attente. √Ä chaque instant, il peut y avoir un montant al√©atoire. Une condition importante pour le traitement de chaque file d'attente, qui a √©t√© mentionn√©e au d√©but de son article, est que les √©v√©nements de chaque page doivent √™tre trait√©s de mani√®re strictement s√©quentielle. Cela signifie qu'√† un moment donn√©, chaque file d'attente ne peut pas √™tre trait√©e par plusieurs travailleurs afin d'√©viter des probl√®mes de concurrence.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais faire le rapport des files d'attente aux gestionnaires 1: 1 est une t√¢che douteuse. Le nombre de files d'attente change constamment, √† la fois vers le haut et vers le bas. Le nombre de gestionnaires en cours d'ex√©cution n'est pas non plus infini, au moins nous avons une limitation de la part du syst√®me d'exploitation et du mat√©riel, et nous ne voudrions pas que les travailleurs restent inactifs dans les files d'attente vides. Pour r√©soudre le probl√®me d'interaction entre les gestionnaires et les files d'attente, nous avons impl√©ment√© un syst√®me √† tour de r√¥le pour traiter notre pool de files d'attente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et ici, la ligne de contr√¥le est venue √† notre secours.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wg/rx/yp/wgrxypigmbunxgzyc_hkgqfodjq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque l'√©v√©nement est transf√©r√© du bus partag√© vers la file d'attente bas√©e sur les √©v√©nements d'un bot particulier, nous mettons √©galement l'identifiant de cette file d'attente de bot dans la file d'attente de contr√¥le. La file d'attente de contr√¥le stocke uniquement les identificateurs des files d'attente qui se trouvent dans le pool et doivent √™tre trait√©es. Seules des valeurs uniques sont stock√©es dans la file d'attente de contr√¥le, c'est-√†-dire que le m√™me identifiant de file d'attente de robots ne sera stock√© qu'une seule fois dans la file d'attente de contr√¥le, quel que soit le nombre de fois qu'il y est √©crit. Sur Redis, cela est impl√©ment√© √† l'aide de la structure de donn√©es SORTED SET.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, nous pouvons distinguer un certain nombre de travailleurs, dont chacun recevra de la file d'attente de contr√¥le son identifiant de la file d'attente de robots pour traitement. Ainsi, chaque travailleur traitera ind√©pendamment le bloc de la file d'attente qui lui est assign√©, apr√®s avoir trait√© le bloc, retourner l'identifiant de la file d'attente trait√©e au contr√¥le, le renvoyant ainsi √† notre round robin. L'essentiel est de ne pas oublier de fournir le tout avec des verrous, afin que deux travailleurs ne puissent pas traiter la m√™me file d'attente de robots en parall√®le. Cette situation est possible si l'identifiant du bot entre dans la file d'attente de contr√¥le alors qu'il est d√©j√† en cours de traitement par le travailleur. Pour les verrous, nous utilisons √©galement Redis comme cl√©: magasin de valeurs avec TTL.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque nous prenons une t√¢che avec un identifiant de file d'attente de bot de la file d'attente de contr√¥le, nous mettons un verrou TTL sur la file d'attente prise et commen√ßons √† la traiter. </font><font style="vertical-align: inherit;">Si l'autre consommateur prend la t√¢che avec la file d'attente qui est d√©j√† en cours de traitement √† partir de la file d'attente de contr√¥le, il ne pourra pas se verrouiller, retourner la t√¢che dans la file d'attente de contr√¥le et recevoir la t√¢che suivante. </font><font style="vertical-align: inherit;">Apr√®s avoir trait√© la file d'attente des robots par le consommateur, il supprime le verrou et passe √† la file d'attente de contr√¥le pour la t√¢che suivante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le sch√©ma final est le suivant: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/it/jh/bl/itjhblg3hv1urwu_8gx3fhuj8wq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cons√©quence, avec le sch√©ma actuel, nous avons r√©solu les principaux probl√®mes identifi√©s:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©gradation des performances dans le bus d'√©v√©nements principal</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Violation de gestion des √©v√©nements</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'effet des voisins bruyants</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment g√©rer la charge dynamique?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le sch√©ma fonctionne, mais nous y avons un nombre fixe de consommateurs pour un nombre dynamique de files d'attente. Evidemment, avec cette approche, on va s'affaisser dans le traitement des files d'attente √† chaque fois que leur nombre augmente fortement. Il semble que ce serait bien que nos travailleurs d√©marrent ou s'√©teignent dynamiquement en cas de besoin. Ce serait √©galement bien si cela ne compliquait pas consid√©rablement le processus de d√©ploiement du nouveau code. √Ä de tels moments, les mains sont tr√®s pressantes d'aller √©crire √† votre gestionnaire de processus. √Ä l'avenir, nous l'avons fait, mais cette histoire est diff√©rente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En pensant, nous avons d√©cid√©, pourquoi ne pas utiliser √† nouveau tous les outils familiers et familiers. Nous avons donc obtenu notre API interne, qui fonctionnait sur un ensemble standard de NGINX + PHP-FPM. En cons√©quence, nous pouvons remplacer notre pool fixe de travailleurs par des API, et laisser NGINX + PHP-FPM r√©soudre et g√©rer les travailleurs nous-m√™mes, et il nous suffit d'avoir entre la file d'attente de contr√¥le et notre API interne un seul consommateur de contr√¥le, qui enverra des identificateurs de file d'attente √† notre API √† traitement, et la file d'attente elle-m√™me sera trait√©e dans le travailleur g√©n√©r√© par PHP-FPM. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le nouveau sch√©ma √©tait le suivant:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-l/a9/7p/-la97p-usddzj76y4c8grd8gbxa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est beau, mais notre consommateur de contr√¥le fonctionne dans un seul thread et notre API fonctionne de mani√®re synchrone. </font><font style="vertical-align: inherit;">Cela signifie que le consommateur se bloque √† chaque fois pendant que PHP-FPM broie une file d'attente. </font><font style="vertical-align: inherit;">Cela ne nous convient pas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rendre notre API asynchrone</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais que se passe-t-il si nous pouvions envoyer une t√¢che √† notre API et la laisser y mettre √† jour la logique m√©tier, et notre consommateur de contr√¥le suivra la t√¢che suivante dans la file d'attente de contr√¥le, apr√®s quoi elle sera ramen√©e dans l'API, etc. </font><font style="vertical-align: inherit;">√Ä peine dit que c'√©tait fait. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'impl√©mentation prend quelques lignes de code, et la preuve de concept ressemble √† ceci:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Api</span> </span>{
    	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionDoSomething</span>(<span class="hljs-params"></span>)
    	</span>{<font></font>
    		$data = $_POST;<font></font>
    		<span class="hljs-keyword">$this</span>-&gt;dropFPMSession();
    		<span class="hljs-comment">// ,        , &nbsp;   </span>
    		<span class="hljs-comment">//     </span><font></font>
    	}<font></font>
    <font></font>
    <font></font>
    	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dropFPMSession</span>(<span class="hljs-params"></span>)
    	</span>{<font></font>
    		ignore_user_abort(<span class="hljs-literal">true</span>); 
    		<span class="hljs-comment">//          </span>
    		ob_end_flush(); <span class="hljs-comment">//  </span>
    		flush(); <span class="hljs-comment">//  </span>
    		@session_write_close(); <span class="hljs-comment">// </span><font></font>
    	<font></font>
    		fastcgi_finish_request(); <font></font>
    		<span class="hljs-comment">//          </span><font></font>
    	}<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la m√©thode dropFPMSession (), nous rompons la connexion avec le client, lui donnant une r√©ponse de 200, apr√®s quoi nous pouvons effectuer toute logique lourde en post-traitement. </font><font style="vertical-align: inherit;">Le client dans notre cas est le consommateur de contr√¥le. </font><font style="vertical-align: inherit;">Il est important pour lui de disperser rapidement les t√¢ches de la file d'attente de contr√¥le dans le traitement sur l'API et de savoir que la t√¢che a atteint l'API. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En utilisant cette approche, nous avons d√©coll√© un tas de maux de t√™te associ√©s au contr√¥le dynamique des consommateurs et √† leur mise √† l'√©chelle automatique.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plus √©volutif</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cons√©quence, l'architecture de notre sous-syst√®me a commenc√© √† se composer de trois couches: couche de donn√©es, processus et API interne. Dans le m√™me temps, les informations transitent par tous les flux de donn√©es concernant le bot auquel l'√©v√©nement / la t√¢che trait√© appartient. De toute √©vidence, nous pouvons utiliser notre identifiant de cl√© / bot pour le partage, tout en continuant de faire √©voluer notre syst√®me horizontalement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si nous imaginons notre architecture comme une unit√© solide, cela ressemblera √† ceci: apr√®s </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bb/mw/en/bbmwendsu4hnp_xymwqnulblwvc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
avoir augment√© le nombre de ces unit√©s, nous pouvons placer un √©quilibreur mince devant elles, qui dispersera nos √©v√©nements / t√¢ches dans les unit√©s n√©cessaires, en fonction de la cl√© de partitionnement. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wf/1g/sk/wf1gsktxy1iqdp_jhqougdnfkuw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, nous obtenons une grande marge pour la mise √† l'√©chelle horizontale de notre syst√®me.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors de la mise en ≈ìuvre de la logique m√©tier, vous ne devez pas oublier le concept de s√©curit√© des threads, sinon vous pouvez obtenir des r√©sultats inattendus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un tel sch√©ma avec des cascades de files d'attente et la suppression de la logique m√©tier lourde dans le traitement asynchrone est utilis√© dans plusieurs parties du syst√®me depuis plus de deux ans. </font><font style="vertical-align: inherit;">La charge pendant cette p√©riode pour chacun des sous-syst√®mes a augment√© des dizaines de fois, et la mise en ≈ìuvre propos√©e nous permet d'√©voluer facilement et rapidement. </font><font style="vertical-align: inherit;">Dans le m√™me temps, nous continuons √† travailler sur notre pile principale, sans l'√©largir avec de nouveaux outils / langages et sans augmenter, surchargeant ainsi l'introduction et le support de nouveaux outils.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr492948/index.html">Rencontrez defer</a></li>
<li><a href="../fr492952/index.html">Retour vers le futur avec le Java Developer Course</a></li>
<li><a href="../fr492956/index.html">Les joueurs ne sont jamais ex. Bons souvenirs et plaisirs interdits - dans une enqu√™te de DataArt</a></li>
<li><a href="../fr492958/index.html">Informatique r√©cursive automatis√©e</a></li>
<li><a href="../fr492962/index.html">Ma trousse de survie autonome en quarantaine</a></li>
<li><a href="../fr492966/index.html">Pour la premi√®re fois, un photon a √©t√© t√©l√©port√© d'une puce √† une autre</a></li>
<li><a href="../fr492968/index.html">En m√©moire de Freeman Dyson, le g√©nie des math√©matiques, transform√© en visionnaire technologique</a></li>
<li><a href="../fr492970/index.html">Comment TeamViewer stocke les mots de passe</a></li>
<li><a href="../fr492972/index.html">Comment la peau est hydrat√©e et que se passe-t-il lorsque vous vous lavez les mains avec de l'alcool avec COVID-19</a></li>
<li><a href="../fr492978/index.html">Comment commander une vid√©o de produit informatique externalis√© et obtenir ce dont vous avez besoin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>