<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•® üë≤üèº ü§æüèΩ Comment capturer rapidement le monde ou g√©rer un r√©seau d'ordinateurs Windows √† l'aide d'OPSI üëèüèª üåà üòê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Avertissement: 
 L'auteur aime les b√©quilles courtes et droites, et adore √©galement doucement les logiciels ouverts gratuits pour la flexibilit√© et l'...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Comment capturer rapidement le monde ou g√©rer un r√©seau d'ordinateurs Windows √† l'aide d'OPSI</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497826/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'auteur aime les b√©quilles courtes et droites, et adore √©galement doucement les logiciels ouverts gratuits pour la flexibilit√© et l'√©volutivit√© qu'il donne. </font><font style="vertical-align: inherit;">Le but de cet article est le d√©sir de promouvoir, ainsi que de parler du syst√®me de gestion du logiciel OPSI (Open PC Server Integration), √† juste titre inconnu sur Internet russe.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'√©tais assis dans le bureau et je buvais du caf√© quand Ilon Mask m'a appel√© et en pur russe m'a dit qu'il suffisait d√©j√† de le supporter, il est temps de rassembler les meilleurs esprits pour combattre un certain virus, et pour le moment, cinq minutes plus tard, je suis dans le bureau apportera 100 ordinateurs, dont j'ai besoin de toute urgence pour d√©ployer Windows 10, et demain matin, des scientifiques du monde entier viendront au bureau pour commencer √† travailler sur l'antivirus. </font><font style="vertical-align: inherit;">Eh bien, n'est-ce pas ce que j'ai attendu toute ma vie? </font><font style="vertical-align: inherit;">Un d√©fi digne pour un bon outil.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour mettre en ≈ìuvre le plan, j'utiliserai le syst√®me OPSI - Open PC Server Integration. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OPSI est √©crit en python en Allemagne et, apparemment, les b√©quilles, gratuites et √©volutives l'appr√©cient √©galement beaucoup. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Caract√©ristiques du syst√®me de base:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©ploiement automatique du logiciel </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela fonctionne comme ceci: vous analysez le programme d'installation et en faites le package opsi, qui installe le programme de la bonne mani√®re. </font><font style="vertical-align: inherit;">Il fonctionne mieux avec les packages msi, il conna√Æt quelques autres formats avec lesquels il fait √©galement face. </font><font style="vertical-align: inherit;">Il peut ex√©cuter un fichier bat ou un script powershell, mais en principe, n'importe quel interpr√®te. </font><font style="vertical-align: inherit;">Il existe des syst√®mes de registre int√©gr√©s, en g√©n√©ral, un remplissage complet, probablement la meilleure partie du syst√®me.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installation automatique des syst√®mes d'exploitation </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'utilise uniquement l'installation √† partir d'une image, comme la plus rapide, mais il existe des options avec l'installation hors ligne du syst√®me √† partir de z√©ro.</font></font></li>
<li>   <br>
<br>
         ,          ,       ,      ,      windows.  ,   ,    windows,    ,          . </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plusieurs interfaces de gestion pratiques avec des options d'int√©gration flexibles </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a un programme avec une interface graphique, il y a une interface http √† laquelle vous pouvez envoyer des commandes, vous pouvez contr√¥ler OPSI √† partir de la console du serveur, int√©grer des commandes dans vos scripts, vous pouvez acc√©der au backend √† partir de python, mais moi, malheureusement, je , alors que je ne poss√®de pas une telle magie.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prise en charge de plusieurs serveurs de d√©p√¥t (serveurs contenant directement le logiciel √† partir duquel le d√©ploiement est en cours). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez ajouter de nombreux serveurs √† chaque sous-r√©seau ou groupe d'ordinateurs, chacun desservant son propre r√©seau.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fonctionnalit√©s du syst√®me impl√©ment√©es par les modules (il existe des modules gratuits et payants):</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connecteur LDAP (payant) Un </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
connecteur connectant un domaine et opsi en un seul ensemble</font></font></li>
<li>  ()<br>
<br>
     : , ...</li>
<li>MySQL  () <br>
<br>
  OPSI  mysql   ,  300 </li>
<li>Nagios  ()<br>
<br>
 </li>
<li>   ()<br>
<br>
 , opsi      ,   ,      .</li>
<li>    ()<br>
<br>
    .</li>
<li>  ()<br>
<br>
  ,   ,      ,  . ,    ansible  puppet,    .    linux  windows      .</li>
<li>WAN  ()<br>
<br>
        ,   . </li>
<li>   ()<br>
<br>
 </li>
<li>OTRS::ITSM  ()<br>
<br>
  </li>
<li>   ()<br>
<br>
 ,      ,            ,   ¬´   ¬ª,  ,  . </li>
</ol><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez en apprendre plus en d√©tail ici. Le</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
mod√®le de mon√©tisation dont ils disposent est le suivant: ils vendent des modules jusqu'√† ce qu'ils collectent le montant pour les rendre gratuits. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant que les ordinateurs sont amen√©s dans mon bureau et assembl√©s, j'installe le serveur AD sur le serveur Windows, y monte le domaine domain.local, ainsi que DNS et DHCP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez installer OPSI dans le groupe de travail et dans le domaine, nous installerons dans le domaine, mais sans liaison avec l'AD (connecteur LDAP).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons d√©ployer Windows 10 sur un r√©seau d'ordinateurs selon le sch√©ma suivant: nous allons pr√©parer une image Windows 10 d√©ployable avec tous les programmes, d√©marrer sur le r√©seau via opsi, utiliser clonezilla pour l'enregistrer automatiquement dans un fichier, puis configurer tous les ordinateurs pour qu'ils s'installent automatiquement via opsi, d√©marrer sur le r√©seau et automatiquement nous renverserons ce fichier sur tous les ordinateurs du segment de r√©seau de diffusion via tftp. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ce faire, dans la zone du serveur DHCP, d√©finissez le param√®tre 66 dans l'IP de notre futur serveur opsi 192.168.1.229 </font></font><br>
<br>
<img src="https://habrastorage.org/webt/at/sl/hj/atslhjfu6ebadvwdih0bcdzzg2q.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et d√©finissez le param√®tre 67 sur linux / pxelinux.0. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans DNS, ajoutez opsiserver.domain.local sous son adresse statique 192.168.1.229</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous cr√©erons une machine virtuelle pour notre serveur opsi sur fer, qui r√©sistera √† vos charges et vous conviendra en termes de vitesse. Ssd et plusieurs cartes r√©seau sont les bienvenus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Opsi ne prend pas en charge tous les syst√®mes; la liste de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">compatibilit√© se trouve ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous installons imm√©diatement dans les param√®tres r√©gionaux anglais, je vous d√©conseille fortement d'utiliser l'alphabet cyrillique n'importe o√π sur ce serveur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ma distribution Debian 10 pr√©f√©r√©e que j'installe dans une configuration minimale avec le nom opsiserver. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s l'installation et le red√©marrage, au cas o√π, nous configurons les param√®tres r√©gionaux:</font></font><br>
<br>
<pre><code class="bash hljs">dpkg-reconfigure locales</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je s√©lectionne tout o√π il y a de_ en_ et ru_ syst√®me laisser en_US.UTF8. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une installation ult√©rieure est une nouvelle version de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ce tutoriel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adapt√© √† la t√¢che </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Modifiez le nom du serveur s'il est diff√©rent de ce dont nous avons besoin:</font></font><br>
<br>
<pre><code class="bash hljs">hostname opsiserver.domain.local</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V√©rification:</font></font><br>
<br>
<pre><code class="bash hljs">hostname -f</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apportons / etc / hosts sous la forme suivante:</font></font><br>
<br>
<pre><code class="plaintext hljs">127.0.0.1 localhost<font></font>
127.1.1.1 localhost.localdomain<font></font>
192.168.1.229 opsiserver.domain.local opsiserver</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et nous oublierons son existence pour toujours, car opsi est exigeant sur le contenu de ce fichier, et quand il est modifi√©, il commence parfois √† se rebeller et √† parsemer d'erreurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installez les packages requis:</font></font><br>
<br>
<pre><code class="bash hljs">apt install wget host pigz mc -y</code></pre> <br>
<pre><code class="bash hljs">apt install samba samba-common smbclient cifs-utils -y </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous installons le serveur mysql par d√©faut, maria-db se l√®ve pour moi, √ßa marchera aussi.</font></font><br>
<br>
<pre><code class="bash hljs">apt install default-mysql-server -y</code></pre><br>
<pre><code class="bash hljs">sudo mysql_secure_installation</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous r√©pondons aux questions par l'affirmative, en changeant le mot de passe root et en nous en souvenant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajoutez des r√©f√©rentiels OPSI au syst√®me:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">echo</span> <span class="hljs-string">"deb http://download.opensuse.org/repositories/home:/uibmz:/opsi:/4.1:/stable/Debian_10/ /"</span> &gt; /etc/apt/sources.list.d/opsi.list</code></pre><br>
<pre><code class="bash hljs">wget -nv https://download.opensuse.org/repositories/home:uibmz:opsi:4.1:stable/Debian_10/Release.key -O Release.key<font></font>
apt-key add - &lt; Release.key</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mise √† jour:</font></font><br>
<br>
<pre><code class="bash hljs">apt update</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous supprimons tftpd s'il l'est, car OPSI entrera en conflit avec lui:</font></font><br>
<br>
<pre><code class="bash hljs">apt remove tftpd</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous supprimons le support tftp de inetd, car si c'est le cas, OPSI entrera en conflit avec lui:</font></font><br>
<br>
<pre><code class="bash hljs">update-inetd --remove tftp<font></font>
apt install opsi-tftpd-hpa</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et installez directement le serveur opsi:</font></font><br>
<br>
<pre><code class="bash hljs">apt install opsi-server</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dans le processus, ils demanderont les donn√©es n√©cessaires pour cr√©er un certificat auto-sign√©, qui √† son tour est n√©cessaire pour la connexion crypt√©e des clients avec le serveur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installer le support Windows:</font></font><br>
<br>
<pre><code class="bash hljs">apt install opsi-windows-support</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
configurer le backend mysql:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-setup --configure-mysql</code></pre><br>
<img src="https://habrastorage.org/webt/b0/7g/zh/b07gzhpoteem9-pgzopqghvkmga.png" width="600" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous d√©finissons l'adresse du serveur (localhost), l'utilisateur √† partir duquel nous agissons (root), le mot de passe root dans mysql (dont nous nous sommes souvenus plus t√¥t), le nom de la base de donn√©es pour opsi (opsi), le nom de l'utilisateur qui travaillera dans cette base de donn√©es (opsi), le mot de passe pour cet utilisateur (nous inventons Nouveau). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, pour debian 10, vous devez ajouter / usr / sbin √† PATH:</font></font><br>
<br>
<pre><code class="bash hljs">PATH=<span class="hljs-variable">$PATH</span>:/usr/sbin</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et la m√™me ligne doit √™tre ajout√©e √† .bashrc dans votre r√©pertoire personnel. </font><font style="vertical-align: inherit;">Si cela n'est pas fait, √† l'√©tape suivante, vous obtiendrez l'erreur "chpasswd not found". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous initialisons le syst√®me et d√©finissons les droits n√©cessaires sur les fichiers et r√©pertoires du syst√®me:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-setup --init-current-config<font></font>
opsi-set-rights</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Red√©marrage du service:</font></font><br>
<br>
<pre><code class="bash hljs">systemctl restart opsiconfd.service<font></font>
systemctl restart opsipxeconfd.service</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Configurer samba:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-setup --auto-configure-samba</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les clients OPSI se connectent au serveur principal via https sur le port 4447, et si vous devez appeler une sorte d'installation, les clients monteront la boule de samba √† partir du serveur opsi et installeront le logiciel √† partir de celui-ci. </font><font style="vertical-align: inherit;">Pour rendre cela possible, nous permettons √† OPSI de reconfigurer la samba. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Red√©marrage de Samba:</font></font><br>
<br>
<pre><code class="bash hljs">systemctl restart smbd.service<font></font>
systemctl restart nmbd.service</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√©finissez le mot de passe administrateur pour l'utilisateur du syst√®me pcpatch: </font></font><br>
<br>
<pre><code class="bash hljs">opsi-admin -d task setPcpatchPassword</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cr√©ez maintenant un utilisateur pour administrer le syst√®me:</font></font><br>
<br>
<pre><code class="bash hljs">useradd -m -s /bin/bash adminuser</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cr√©ez un mot de passe pour lui:</font></font><br>
<br>
<pre><code class="bash hljs">passwd adminuser</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, le mot de passe pour samba, je cr√©e le m√™me que dans le syst√®me:</font></font><br>
<br>
<pre><code class="bash hljs">smbpasswd -a adminuser</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajouter au groupe:</font></font><br>
<br>
<pre><code class="bash hljs">usermod -aG pcpatch adminuser</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si nous allons faire quelque chose avec OPSI sous la racine, alors nous devons ajouter la racine au groupe:</font></font><br>
<br>
<pre><code class="bash hljs">usermod -aG pcpatch root</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelques b√©quilles de plus:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-setup --patch-sudoers-file</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez maintenant t√©l√©charger des packages sur le syst√®me et, pendant le chargement, boire du caf√©.</font></font><br>
<br>
<pre><code class="bash hljs">opsi-package-updater -v install</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par la suite, les packages peuvent √™tre mis √† jour avec la commande:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-package-updater -v update</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Allez maintenant sur </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://download.uib.de/opsi4.1/misc/helper/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , t√©l√©chargez et installez l'interface de gestion opsi-configed √† partir de l√† pour </font></font><br>
<br>
<code>opsi-configed-setup.exe</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
entrer dans le serveur, entrez l'adresse du serveur, notre utilisateur adminuser et son mot de passe, </font></font><br>
<br>
<code>https://opsiserver.domain.local:4447/</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et nous sommes dans le syst√®me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä ce stade, le serveur est install√©! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a-/yg/ft/a-ygftvat-_6wioezy6v7rmuszq.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1 - tous les clients connect√©s √† ce serveur, ils peuvent √™tre d√©sassembl√©s en groupes, y compris ceux imbriqu√©s, appliquer l'affectation √† l'ensemble du groupe √† la fois. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 - un onglet avec les clients, c'est une liste des ordinateurs contr√¥l√©s par opsi </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3 - les clients sont une liste, ici vous pouvez les s√©lectionner dans n'importe quel ordre pour appliquer le but </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4 - "configuration du produit" - une victime de la traduction. En fait, il existe des packages qui peuvent √™tre install√©s dans Windows, dans la terminologie opsi - produits localboot</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5 - Produits Netboot - c'est tout ce qui est t√©l√©charg√© sur le r√©seau </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6 - opsi-mac-address - le pavot de l'ordinateur est ce qu'il est d√©termin√© lors du d√©marrage du r√©seau </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7 - opsiHostKey est le ¬´mot de passe¬ª du client dans le syst√®me opsi si vous le supprimez de ordinateur client opsi, puis r√©installez-le, cela ne fonctionnera pas, car le mot de passe restera ancien et ne conviendra pas. C'est √† la fois un bug et une fonctionnalit√©. Et comment feriez-vous? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, nous allons pr√©parer une image Windows 10 que nous renverserons. Clonezilla, que nous utiliserons, n'est pas aussi bon que l'acronis, mais il sait toujours comment renverser l'image d'un disque plus petit vers le m√™me ou plus grand. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons mis dans le syst√®me tous les programmes dont nous avons besoin, ainsi que les outils d'administration de serveur distant pour Windows 10. J'ai Windows 10 1903, j'ai install√© pour 1803 et tout ce qui doit √™tre d√©marr√©. Vous pouvez le t√©l√©charger √† partir d'ici:</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.microsoft.com/en-us/download/details.aspx?id=45520</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nous en avons besoin pour l'utilitaire netdom, qui vous permet d'entrer automatiquement l'ordinateur dans le domaine. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ce faire, nous t√©l√©chargeons les fichiers d'ici </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/valmont2k/renamejoin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le r√©pertoire c: \ renamejoin. Nous cr√©ons un administrateur de domaine sur le contr√¥leur de domaine avec la possibilit√© d'entrer uniquement des ordinateurs dans le domaine avec la connexion Joinadmin avec le mot de passe password1234QWE. Si un attaquant intercepte ce mot de passe, il ne peut introduire que des ordinateurs dans notre domaine. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ex√©cutez la ligne de createtesk.txt dans la console d'administration de Windows enti√®rement pr√©par√©, qui cr√©era une t√¢che √† d√©marrer au d√©marrage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'ensemble du programme fonctionnera comme suit:</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque nous avons divis√© l'image dans tous les ordinateurs, au premier d√©marrage, Windows va lancer une t√¢che </font></font><code>C:\renamejoin\step1.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui renomme l'ordinateur </font></font><code>win-%random%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, red√©marrez l'ordinateur, la </font><font style="vertical-align: inherit;">suppression </font></font><code>C:\renamejoin\step1.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et le </font><font style="vertical-align: inherit;">renommage </font></font><code>C:\renamejoin\step2.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† </font></font><code>C:\renamejoin\step1.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Au prochain d√©marrage, Windows d√©marrera </font></font><code>C:\renamejoin\step1.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui entrera cet ordinateur dans le domaine, le red√©marrera et le supprimera </font></font><code>C:\renamejoin\step1.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Nous pouvons supprimer la t√¢che potentiellement dangereuse des ordinateurs du domaine ult√©rieurement. Gr√¢ce √† OPSI bien s√ªr! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ft/58/nn/ft58nnalinh1dzsqyx2clhilaym.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est temps de convertir les fen√™tres pr√©par√©es en image.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gr√¢ce √† l'ic√¥ne d'ordinateur avec un signe plus, ajoutez notre ordinateur √† l'interface de gestion opsi opsi-config, d√©finissez son adresse de pavot. </font><font style="vertical-align: inherit;">Sauver. </font><font style="vertical-align: inherit;">Nous passons aux produits Netboot, en face de clonezilla nous mettons "setup". </font><font style="vertical-align: inherit;">Dans la configuration du client, nous exposons tout comme dans la capture d'√©cran: le nom du fichier et la commande par laquelle nous remplissons le disque entier dans l'image. </font><font style="vertical-align: inherit;">Dans le BIOS de l'ordinateur avec Windows, nous d√©finissons le t√©l√©chargement √† partir du r√©seau. </font><font style="vertical-align: inherit;">Red√©marrez la maquette. </font><font style="vertical-align: inherit;">Si vous avez tout fait correctement, vous verrez comment Windows se d√©verse dans l'image sans l'aide des mains. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wu/zi/e6/wuzie6bgshbkngnutgpsqw9lfz0.png" width="500" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant ce temps, les ordinateurs sont assembl√©s, mais ils doivent √™tre ajout√©s en tant que clients en opsi avec leurs adresses de pavot, les ajouter avec des stylos n'est pas du tout une affaire de boyard, non? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La solution est:</font></font><br>
<br>
<pre><code class="bash hljs">apt install tcpdump</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ex√©cutez sur opsiserver:</font></font><br>
<br>
<pre><code class="bash hljs">tcpdump -n udp -vvvvv -e port 69 &gt; /var/<span class="hljs-built_in">log</span>/tftp</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et, en d√©finissant les param√®tres du BIOS pour que tous les ordinateurs d√©marrent sur le r√©seau (et en m√™me temps se r√©veillent des p√©riph√©riques PCI-E, sur le r√©seau, vous comprendrez pourquoi plus tard), chargez-les. Si la fen√™tre bleue du menu de d√©marrage opsi appara√Æt pendant le d√©marrage, </font></font><br>
<br>
<img src="https://habrastorage.org/webt/po/7c/h7/po7ch7eco5daftbhmaqr3fspcjs.png" width="500" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
vous faites tout correctement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au d√©marrage, les ordinateurs acc√®dent √† notre serveur, tcpdump √©crit leurs adresses de pavot dans un fichier </font></font><code>/var/log/tftp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et utilise un script </font></font><code>https://github.com/valmont2k/opsi-hosts-importer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de d√©p√¥t pour s'ex√©cuter sur opsiserver une fois que tous les ordinateurs sont marqu√©s dans opsi et y laissent leurs adresses de pavot. Ce script utilise l'API opsi d'ici </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://download.uib.de/opsi4.1/experimental/documentation/html/opsi-api-documentation/opsi_API.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et un peu de magie. Apr√®s l'avoir d√©marr√©, vous aurez des clients sur opsiserver de la forme win% random32% .domain.local</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'√©tape suivante consiste √† caster l'image Windows (ce qui aurait d√©j√† d√ª √™tre fait) sur tous les ordinateurs. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yn/6g/ik/yn6gikht6l5aizhym_t839uk7mo.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ce faire, s√©lectionnez tous les ordinateurs sur lesquels vous devez installer Windows et en face de clonezilla, nous d√©finissons les valeurs comme dans la capture d'√©cran. Vous √©teignez les ordinateurs, puis allumez plusieurs d'entre eux √† tour de r√¥le et regardez comment Windows se d√©place automatiquement sur eux, ils sont eux-m√™mes renomm√©s et entr√©s dans le domaine. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous souhaitez √©galement automatiser cela, mettez etherwake et √©crivez un script qui, avec un d√©lai sp√©cifi√©, prend les adresses mac du fichier / tmp / newmacs et r√©veille leurs h√¥tes afin qu'ils tournent √† tour de r√¥le Windows. Voir la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mise √† jour 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai fait un geste de Ronaldo √† partir d'une publicit√© pour le shampoing et j'√©tais d√©j√† en train de pr√©parer du caf√© quand Ilon Mask a de nouveau appel√© sur mon t√©l√©phone et a ajout√©:</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Oui, j'ai oubli√© de dire, il faut que la </font></font><code>%program%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">derni√®re version soit </font><font style="vertical-align: inherit;">sur tous les ordinateurs demain </font><font style="vertical-align: inherit;">, pouvez-vous la g√©rer? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Bien s√ªr, tout sera demain! </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne peux pas bouleverser l'idole des technocrates, vous devez donc remettre votre cerveau entre vos mains. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce serait bien si au d√©marrage les ordinateurs se d√©finissaient un client opsi appel√© opsi-client-agent. Cela peut √™tre fait via des strat√©gies de groupe de domaine. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour que cela se produise sans entrer de mot de passe lors de l'installation, vous devez </font><font style="vertical-align: inherit;">
ajouter le mot de passe de votre utilisateur </font><font style="vertical-align: inherit;">dans le </font><font style="vertical-align: inherit;">fichier </font></font><br>
<code>/var/lib/opsi/depot/opsi-client-agent/files/opsi/cfg/config.ini</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur opsiserver </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comme valeur de service_hidden_password</font></font><code>adminuser</code><font style="vertical-align: inherit;"></font><code>base64</code><br>
<br>
<pre><code class="plaintext hljs">[installation]<font></font>
service_user=adminuser<font></font>
service_password=none<font></font>
service_hidden_password=base64HERE</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, ajoutez la strat√©gie de groupe dans le domaine setupOPSI et r√©cup√©rez le script √† partir d'ici. </font></font><code>https://github.com/valmont2k/opsi-install-opsi-client-agent-over-active-directory-domain-policy</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N'oubliez pas d'ins√©rer vos valeurs dans le script. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pi/bq/gr/pibqgrvntzwy6vlhvkwljjs4fki.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous avez tout fait correctement, lors du premier red√©marrage du domaine, les clients s'installeront </font></font><code>opsi-client-agent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, red√©marreront et appara√Ætront sous leurs noms </font></font><code>win-%random%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans l'interface de gestion OPSI. </font><font style="vertical-align: inherit;">Les anciens clients avec les m√™mes adresses de pavot peuvent √™tre supprim√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez maintenant proc√©der √† l'installation </font></font><code>%program%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons ici </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://forum.opsi.org/viewtopic.php?f=22&amp;t=7573</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et trouvons un lien vers le package </font></font><code>*.opsi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec le nom </font></font><code>packagebuilder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, quelque chose comme </font></font><code>"opsi PackageBuilder Windows (opsi Paket)"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
T√©l√©chargez le package dans le r√©pertoire </font></font><code>/var/lib/opsi/workbench</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur opsiserver</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> /var/lib/opsi/workbench</code></pre><br>
<pre><code class="bash hljs">wget https://opsipackagebuilder.s3.amazonaws.com/opsiPackageBuilder/python/opsipackagebuilder_8.4.4-1.opsi </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et installez-le:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-package-manager -d ALL -i opsipackagebuilder_8.4.4-1.opsi</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, dans l'interface de gestion opsi, cliquez sur le bouton de mise √† jour et voyez que nous avons de nouveaux packages </font></font><code>opsipackagebuilder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>opsi-setup-detector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous les avons mis √† travers l'interface de contr√¥le sur une machine de test sous Windows. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque le programme </font></font><code>opsipackagebuilder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>opsi-setup-detector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©tabli, ex√©cutez-le </font></font><code>opsi-setup-detector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et jouez-le sur le programme d'installation </font></font><code>windirstat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, t√©l√©charg√© √† partir du pr√©-programme du site officiel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant l'installation, vous devez configurer les param√®tres du programme. Nous montons la balle sur la machine de test \\ opsiserver.domain.local \ opsi_workbench en tant que lecteur z: nous √©crivons notre nom et notre courrier dans les champs sp√©cifi√©s: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a3/zx/gz/a3zxgzhluvq6-vb6utpdveqfoqi.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OPSI peut cr√©er un package en utilisant 32 et 64 installateurs en m√™me temps et en les d√©finissant en fonction de la capacit√© du syst√®me, nous avons 64 bits partout, alors cliquez sur "Analyser un seul fichier ...":</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n-/ev/s9/n-evs94sic7qrqsafbish6zhjno.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous voyons que le d√©tecteur n'a pas compris le r√©pertoire d'installation, nous pouvons le d√©couvrir par nous-m√™mes en essayant d'installer le programme via le programme d'installation. Mais il a d√©tect√© le type d'installation, la version du programme, la taille de l'application sous forme assembl√©e et d√©ploy√©e, la cl√© d'installation hors ligne, la cl√© de suppression hors ligne et le nom du programme de d√©sinstallation. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vh/u7/ys/vhu7ysu1f6hjlkxbvuetosk2xcu.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous entrons nous-m√™mes dans le r√©pertoire d'installation et cliquez sur √âtape suivante: </font></font><br>
<img src="https://habrastorage.org/webt/wl/lx/nf/wllxnfx3gtvrhtdspigvxznyply.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ici, vous pouvez ajouter le nom du produit, son ID, sa description et d√©finir la version du package, c'est-√†-dire mettre dans la tentative que nous faisons pour assembler le package (dans notre cas, la premi√®re tentative): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ip/_g/fa/ip_gfarn7c49hwtnvhdy0cnxesm.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
vous pouvez ajouter des d√©pendances, ceci signifie que pour installer le package actuel, les packages qui sont indiqu√©s dans les exigences pour le n√¥tre seront mis en place pour l'installation: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/be/mn/os/bemnosq2zhjnugxp5ywu8ahysqi.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cr√©er un package OPSI: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vd/s8/-2/vds8-2ho3zriw5pt7l4dtjouhpq.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons cr√©√© le package, maintenant nous devons aller √† opsiserver dans</font></font><code>/var/lib/opsi/workbench/windirstat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Collecter le paquet:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-makepackage</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installez-le:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-package-manager -d ALL -i windirstat-1.1.2-1.opsi</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si tout s'est bien pass√©, alors dans l'interface de gestion configur√©e par opsi, cliquez sur le bouton ¬´mettre √† jour¬ª et voyez que nous avons un nouveau package </font></font><code>windirstat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui peut √™tre install√© sur les ordinateurs s√©lectionn√©s de notre r√©seau. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bingo! </font><font style="vertical-align: inherit;">Le premier paquet est assembl√©! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour compliquer notre t√¢che, en utilisant PowerShell, nous allons cr√©er une r√®gle dans le pare-feu Windows qui donne acc√®s au client aux ports 4441 et 4447 et rendre cette application autocharg√©e pour l'utilisateur via le r√©glage du registre, comme s'il s'agissait, par exemple, d'un messager. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ouvrir le constructeur de packages opsi: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ry/35/br/ry35brmfbx9wcefpvejn45ofq1i.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
choisissez d'ouvrir le package et ouvrez notre package avec windirstat:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7q/fi/tb/7qfitbgjqlx1kceksjhko2qokc0.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OPSI agit par d√©faut comme suit: lorsque vous supprimez un programme de uninstall.opsiscript, delsub.opsiscript est appel√©, ce qui supprime le programme. Lors de l'installation d'un programme √† partir de setup.opsiscript, delsub.opsiscript est appel√©, ce qui supprime le programme, puis setup.opsiscript l'installe. Par cons√©quent, nous apportons des modifications pour cr√©er quelque chose dans setup.opsiscript et des modifications pour supprimer quelque chose dans delsub.opsiscript. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toute la magie de ces scripts se refl√®te dans la documentation </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://download.uib.de/opsi4.1/documentation/html/en/opsi-winst-manual/opsi-winst-manual.html</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
setup.opsiscript peut √™tre ouvert via l'ic√¥ne de crayon, et delsub.opsiscript via l'arbre de script. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bk/_s/y_/bk_sy_fdgjsl6x4lbokjcrtjhc0.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici le menu fichier complet. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o9/wc/lb/o9wclbi4d3hob_bx9mdrlibnxwi.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chaque tentative de construction d'un package doit √™tre augment√©e d'une unit√©.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/km/8n/ry/km8nrypi8ie323expcio-ms0kum.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous ajoutons le programme au chargement automatique via opsi, pour cela, ins√©rez les lignes dans setup.opsiscript:</font></font><br>
<br>
<pre><code class="plaintext hljs">Registry_changes  /AllNTUserdats /64bit<font></font>
[Registry_changes]<font></font>
OpenKey [Software\Microsoft\Windows\CurrentVersion\Run]<font></font>
Set "WinDirStat" = "C:\Program Files (x86)\WinDirStat\windirstat.exe"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et dans delsub.opsiscript, ins√©rez les lignes:</font></font><br>
<br>
<pre><code class="plaintext hljs">Registry_changes  /AllNTUserdats /64bit<font></font>
[Registry_changes]<font></font>
OpenKey [HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run]<font></font>
;Set "WinDirStat" = "C:\Program Files (x86)\WinDirStat\windirstat.exe"<font></font>
DeleteVar "WinDirStat"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous ajoutons la r√®gle au pare-feu en ex√©cutant le script powershell, pour cela, ins√©rez les lignes dans setup.opsiscript:</font></font><br>
<br>
<pre><code class="plaintext hljs">DosInAnIcon_PowerShell_ExecutionPolicy<font></font>
ExecWith_PowerShell_NichtPDCAktionen powershell.exe winst /sysnative<font></font>
[DosInAnIcon_PowerShell_ExecutionPolicy]<font></font>
echo "powershell set-executionpolicy RemoteSigned ..."<font></font>
powershell.exe set-executionpolicy RemoteSigned<font></font>
exit %ERRORLEVEL%<font></font>
<font></font>
[ExecWith_PowerShell_NichtPDCAktionen]<font></font>
; hier Dein PS-Code<font></font>
<font></font>
New-NetFirewallRule -DisplayName 'OPSI-Inbound' -Profile @('Domain', 'Private', 'Public') -Direction Inbound -Action Allow -Protocol TCP -LocalPort @('4441', '4447')</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et dans delsub.opsiscript, ins√©rez les lignes:</font></font><br>
<br>
<pre><code class="plaintext hljs">DosInAnIcon_PowerShell_ExecutionPolicy<font></font>
ExecWith_PowerShell_NichtPDCAktionen powershell.exe winst /sysnative<font></font>
[DosInAnIcon_PowerShell_ExecutionPolicy]<font></font>
echo "powershell set-executionpolicy RemoteSigned ..."<font></font>
powershell.exe set-executionpolicy RemoteSigned<font></font>
exit %ERRORLEVEL%<font></font>
<font></font>
[ExecWith_PowerShell_NichtPDCAktionen]<font></font>
; hier Dein PS-Code<font></font>
Remove-NetFirewallRule -DisplayName 'OPSI-Inbound'</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code complet peut √™tre consult√© ici: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/valmont2k/WinDirStatOpsiPackageTest</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Je me suis d√©j√† d√©tendu, en regardant opsi d√©ployer la </font></font><code>%program%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">derni√®re version sur l'ensemble du r√©seau, alors qu'Ilon interrompait √† nouveau mes pens√©es en haut. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - La semaine prochaine, 500 autres personnes viendront, des bureaux ont d√©j√† √©t√© lou√©s, des ordinateurs sont import√©s, il y a un r√©seauteur, vous devez d√©ployer un r√©seau Windows dans six succursales de la ville, pouvez-vous le g√©rer? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Eh bien, bien s√ªr, ce n'est pas sorcier - plaisantai-je avec lassitude en r√©ponse. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous clonons notre serveur opsiserver √† l'aide de l'hyperviseur et le d√©ployons dans la branche. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous supposons que le central est connect√© aux succursales via un VPN avec une vitesse d'au moins 10 Mbps.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons maintenant cr√©er un serveur de d√©p√¥t, c'est-√†-dire un serveur pour stocker les packages dans la branche. </font><font style="vertical-align: inherit;">Les clients de la succursale vont frapper https sur le serveur principal, et si vous avez besoin d'installer un logiciel, ils monteront le serveur de d√©p√¥t dans votre succursale et seront install√©s √† partir de celle-ci, ceci est notamment fait pour sauvegarder le canal Internet entre le bureau et la succursale. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous configurons sur le serveur de branche opsiserver-2 une adresse statique du r√©seau local en changeant le fichier en </font></font><code>/etc/network/interfaces</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonction du nouveau r√©seau. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Modifier le nom d'h√¥te et les h√¥tes:</font></font><br>
<br>
<pre><code class="bash hljs">sed -i <span class="hljs-string">'s/opsiserver/opsiserver-2/'</span> /etc/hostname<font></font>
sed -i <span class="hljs-string">'s/opsiserver/opsiserver-2/g'</span> /etc/hosts</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dans / etc / hosts, nous mettons √† jour les donn√©es en introduisant une nouvelle adresse IP </font></font><br>
<br>
<pre><code class="bash hljs">reboot</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Renommez le serveur opsi en utilisant opsi:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-admin --no-depot -d method host_renameOpsiDepotserver opsiserver.domain.local opsiserver-2.domain.local</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Du serveur opsiserver-2.domain.local nous le connectons √† opsiserver.domain.local en tant que d√©p√¥t:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-setup --register-depot</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sp√©cifiez le nom du serveur principal, auquel nous connectons le nouveau d√©p√¥t, l'administrateur et le mot de passe: vous </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yx/02/y_/yx02y_bcvpikxgkubku2-fl8try.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
n'avez rien √† changer ici </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">vous </font></font><br>
<br>
<img src="https://habrastorage.org/webt/n2/1j/_l/n21j_lmeiwlsn3ghmkcxr4yadgg.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pouvez v√©rifier que tout est fait correctement dans opsi-configed: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6u/s9/nu/6us9nurw4d3rsetl0nemcy_x_re.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
vous devez ensuite configurer le syst√®me afin que les clients choisissent le serveur de d√©p√¥t pour eux-m√™mes. Nous s√©lectionnons tous les clients et les mettons en d√©p√¥t dynamique. Par d√©faut, le client regarde son adresse IP et s√©lectionne le d√©p√¥t de son r√©seau. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vp/4v/mg/vp4vmg0czhi2vmkwobeddecf1dc.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, nous configurons que tous les futurs clients choisissent imm√©diatement le d√©p√¥t de mani√®re dynamique: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h7/-j/c4/h7-jc4kpf-5vyavsz_mckjp44-a.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
c'est tout, la configuration du nouveau serveur de d√©p√¥t est termin√©e, vous pouvez installer opsi-client-agent pour les ordinateurs du r√©seau local avec le m√™me script que nous avons install√© pr√©c√©demment dans le bureau principal, pas oubliant de changer l'adresse IP √† l'int√©rieur du script.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans chaque branche, nous d√©finissons un contr√¥leur de domaine (vous pouvez en lecture seule), faisons notre propre adressage r√©seau, divisons le site par d√©faut √† l'int√©rieur du domaine Windows en sous-sites, chacun desquels nous cr√©ons notre sous-r√©seau, notre strat√©gie de groupe avec son script d'installation opsi-client-agent. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous r√©p√©tons dans la nouvelle branche. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai fini mon caf√© et je suis rentr√© chez moi, et la LED sur la carte r√©seau a signal√© que de nouveaux et nouveaux syst√®mes se d√©ployaient au bruit des refroidisseurs ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mise √† jour 1: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme il s'est av√©r√©, il n'est pas n√©cessaire de script, opsi-configed permet √† la souris de cliquer sur le r√©veil des clients via le sheduler.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr497814/index.html">Cinq √©tapes pour accepter l'in√©vitable, ou comment nous avons d√©velopp√© un programme de profilage automatis√©</a></li>
<li><a href="../fr497816/index.html">Les chemins de fer russes m'envoient les billets de quelqu'un d'autre</a></li>
<li><a href="../fr497818/index.html">Acc√®s √† distance aux machines virtuelles avec GPU √† l'aide de Citrix</a></li>
<li><a href="../fr497820/index.html">R√©gularisation statistique de probl√®mes inverses incorrects. Turchin (partie 1)</a></li>
<li><a href="../fr497822/index.html">Homme dans une bouteille</a></li>
<li><a href="../fr497828/index.html">2 en 1: chiffrement avec protection de s√©curit√©</a></li>
<li><a href="../fr497830/index.html">Enregistrements OWASP Moscou 2020/1</a></li>
<li><a href="../fr497832/index.html">Ce qui se cache derri√®re VestaCP</a></li>
<li><a href="../fr497834/index.html">Syst√®me avanc√© d'autorisation des ressources √† Laravel. Partie 2. Passerelles, politiques</a></li>
<li><a href="../fr497836/index.html">Comparaison de la vitesse des langages de programmation √† l'aide de l'exemple de r√©solution du probl√®me de l'entra√Ænement d'un r√©seau neuronal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>