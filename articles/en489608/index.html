<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äç‚öïÔ∏è ü§∂üèΩ ü§¥üèæ Interaction with NIDD via SCEF using the Postman utility. A brief tour of SCEF and its features üç∞ ‚òØÔ∏è üó®Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article will allow those who are just starting their development or already applying NB-IoT technology to get an idea of ‚Äã‚Äãhow to remotely intera...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Interaction with NIDD via SCEF using the Postman utility. A brief tour of SCEF and its features</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489608/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This article will allow those who are just starting their development or already applying NB-IoT technology to get an idea of ‚Äã‚Äãhow to remotely interact with the NB-IoT device.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hj/ax/eq/hjaxeqtz5llcdmfzbwcv6zosici.png" alt="image"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Short review</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NB-IoT easily steps on the heels of 2G and has established itself as an energy-efficient standard for cellular communications, which in the foreseeable future will be able to squeeze out 2G, which has strengthened its position. The reason for this is the ability to flexibly approach the issue of energy consumption of one of the most consuming parts of the device - the radio transmitter. If you do not go deep into details, then along with NB-IoT, we have the opportunity to flexibly configure the device‚Äôs operating modes by setting the device‚Äôs communication schedule and the device‚Äôs interaction with servers on the Internet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In parallel with this, the number of subscriber devices simultaneously connected to one cell is significantly increasing, as well as the costs of the mobile operator to maintain the operability of this communication itself.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is assumed that the reader has an approximate understanding of the NB-IoT technology and there is minimal interaction experience.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The article is regularly updated and updated.</font></font></blockquote><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Difficulties within the NB-IoT network</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Together with the ability to control the radio transmitter and high energy efficiency, the problem of sending data in the direction from the server to the module (device) has come. The reason is that it is possible to provide hundreds of thousands of devices with white IP addresses, but this entails a large amount of overhead and reduces the overall reliability of the network due to its complexity. The module receives the address for the NAT of the operator and it is difficult for the operator to translate it "out" due to the large number of devices. For example: 100 thousand devices is the same number of IP addresses and within the framework of IPv4 it simply does not seem possible to implement this. The transition to IPv6 can solve this problem, but you still have to pay for the ‚Äúwhite‚Äù address of the device on the network, which will significantly affect the pocket of corporate clients.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That is, in the general case, it turns out that the device can only work in one-way mode, transmitting data to the server without the possibility of receiving data from the server, because the server is practically not aware when the device first gets in touch. </font><font style="vertical-align: inherit;">Or, use on average no more than five minutes after the connection between the device and the server for transferring data from the server to the device is established.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NIDD (Non-IP Data Delivery) - why is this needed?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When working with the NB-IoT network, it is very difficult to turn to a device for transmitting a command or certain data. To solve this problem, a mechanism for optimizing the transfer of small amounts of data, Non-IP Data Delivery (NIDD), was invented. </font><font style="vertical-align: inherit;">The mechanism reduces the overall size of the transmitted message by reducing the headers. </font><font style="vertical-align: inherit;">This, in turn, positively affects the characteristics of the device: it reduces power consumption and increases autonomy (battery life). </font><font style="vertical-align: inherit;">As a result, the rejection of IP support leads to cheaper devices, reduced development time, increased competitiveness in the market of IoT devices, etc.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SCEF (Service Capability Exposure Function) - a gift for users</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SCEF is a functional network element that first appeared and 3GPP Release 13, deployed on the side of the mobile operator and providing a secure communication channel between the SCS / AS (Service Capability Server / Application Server) and the NB-IoT device. SCEF provides a communication channel when communicating with the device via NIDD and provides access to additional network capabilities / services of the NB-IoT network through a single application programming interface (from API T8 description). In 3GPP Release 13, only the SCEF mechanism for interfacing with cellular network interfaces was standardized. Thus, the network load is optimized, interaction with the device is simplified, the algorithm of the device itself is simplified.SCEF also fulfills high requirements for the security of data transmission and the fulfillment of requirements to confirm successful data transfer in both directions.</font></font><br>
<br>
<h3>    </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SCEF allows you to abstract from complex systems of interaction with the NB-IoT device, including when the latter is in eDRX or PSM mode and is not available for data transfer in the direction of the server-&gt; device. When the device has received registration and ‚Äúagreed‚Äù with the network operator‚Äôs network about the communication schedule, using a simple interface, you can transfer data to the device and receive data from it, manage the ‚Äúsubscription‚Äù of your device and AS to certain events, set and bind unique ones yourself Universal ID names and more. All this through the same interface - T8 API. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is important to note that a server (AS) can be not one, but several, and you can flexibly configure the distribution of information between servers for certain events or groups of devices.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How it works</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The most popular solution for organizing access of a device to a cellular network is the use of a cellular module, for example:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/f6/yn/xw/f6ynxwxpeypur3-lg6wabxhwyay.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When registering in a cellular network, such a module transmits to the operator some information, including the IMSI of a subscriber SIM card which the operator can associate with the subscriber account or the subscriber himself if he has access to the operator‚Äôs personal account. Behind the SCEF screen is hiding knowledge of the next communication session with the device. Registration of a non-IP device in the operator‚Äôs network is possible only if there is at least one subscription from SCS / AS to this device. No subscription - no one will communicate with this device via NIDD, and the device will not be registered on the network. Thus, SCEF, knowing about the next communication session, is able to transfer data from / to the device, in accordance with the specified delivery parameters and the lifetime of the transmitted message, without the need to organize additional monitoring of the status of data transfer and delivery control.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lightness</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encapsulating units of data bytes from the device into the TCP protocol and transferring it to the server is expensive in terms of hundreds of thousands of subscriber devices in the company's fleet. </font><font style="vertical-align: inherit;">SCEF allows you to abandon IP on the device and transfer only non-IP data, without IP headers through the signal channel, which contributes to a multiple reduction in the cost of the transmitted byte and provides additional benefits from the use of the service. </font><font style="vertical-align: inherit;">Moreover, SCEF does not make any changes to the transmitted data both to the device and from it, payload is transmitted transparently. </font><font style="vertical-align: inherit;">Therefore, using NIDD it is possible to transfer not only unstructured data, but also data ‚Äúwrapped‚Äù in an understandable standardized format, such as JSON, to simplify data processing on the AS side.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beginning of work</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The structure of the URI (Uniform Resource Identifier) ‚Äã‚Äãon the example of Postman</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First of all, you need to get access to your personal account from the operator (M2M-manager service). </font><font style="vertical-align: inherit;">For the commercial implementation of MTS, a single Personal Account interface is provided, where you can independently create APN, login / password access to the API and assign the names ScsAsID, extID for your devices. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Those. </font><font style="vertical-align: inherit;">we will at least need:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ScsAsID - Your AS ID</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APN - the one that is usually used to interact with the network will not work</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Login / Password - data for access to your personal account and interaction with SCEF</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URI ‚ÄìHTTP address and port on the network provided to you by SCEF </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externalID - ID of our device</font></font></li>
</ul><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's move on to practice</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The theory is over, let's move on to the most interesting part - the practice on the SIMCom Wireless Solutions production module - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SIM7020E</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ue/d6/_o/ued6_opqiacsy2l1axsi8zch1d0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First you need to configure the module itself to work with NIDD. </font><font style="vertical-align: inherit;">To do this, first put the module in CFUN = 0 mode and configure it:</font></font><br>
<br>
<pre><code class="plaintext hljs">AT+CFUN=0<font></font>
+CPIN: NOT READY<font></font>
<font></font>
OK<font></font>
AT+ENVDM=1,tel_conn_mgr,default_pdn_flag,1,30<font></font>
OK<font></font>
AT*MCGDEFCONT="Non-IP","&lt;APN&gt;"<font></font>
OK<font></font>
AT+CFUN=1<font></font>
OK<font></font>
<font></font>
+CPIN: READY<font></font>
AT+EGACT=1,4,"&lt;APN&gt;"<font></font>
+EGACT:1<font></font>
<font></font>
OK<font></font>
<font></font>
+EGACT:1,1,1,4</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Checking the registration of the module in the packet data network</font></font><br>
<br>
<pre><code class="plaintext hljs">AT+CGREG?<font></font>
+CGREG: 0,1<font></font>
<font></font>
OK</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And finish setting up NIDD</font></font><br>
<br>
<pre><code class="plaintext hljs">AT+NIDD=0,"&lt;APN&gt;","&lt;login&gt;","&lt;pass&gt;"<font></font>
+NIDD=0,0<font></font>
<font></font>
OK</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The response of the module will contain account_id here: + NIDD = 0, &lt;account_id&gt; - this will come in handy when activating NIDD on the module.</font></font><br>
<br>
<pre><code class="plaintext hljs">AT+NIDD=1,0<font></font>
+NIDD=1,0<font></font>
<font></font>
OK</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this case, account_id is 0. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Done. </font><font style="vertical-align: inherit;">At this stage, work with the module is completed. </font><font style="vertical-align: inherit;">Let's move on to setting up SCEF. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An important point: without a registered subscription in SCEF, the module will not receive registration on the network!</font></font></u><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SCEF</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API T8</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is a special document detailing the interaction with SCEF. </font><font style="vertical-align: inherit;">This API defines a set of data models, resources, and related procedures for transmitting non-IP data.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/yd/nm/zz/ydnmzzwqtgnhqbxt7gnrsdpow00.png"></div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Work with SCEF and service subscriptions - JSON (JavaScript Object Notation)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Data that includes SCEF configuration and is transmitted via HTTP / 1.1 to SCEF must be encoded in JSON format, and the body of the HTTP request itself in the Content-Type field must include the ‚Äúapplication / json‚Äù header. </font><font style="vertical-align: inherit;">At the same time, if the message was delivered to the recipient and the delivery confirmation was received - SCEF must delete the appropriate configuration, send the message via HTTP POST for AS with the status code ‚Äú200 OK‚Äù and turn on the report on the event.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Postman</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will not delve into how to work with this utility, on the Internet you can find a lot of reviews. </font><font style="vertical-align: inherit;">I can only say that it has some limitations in its free version, but we don‚Äôt need much, the functionality supplied for free is more than enough for our tasks. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After we downloaded it and opened it, the first tab will welcome us - Launchpad, where we will be offered to create our first request, we will not refuse.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/mf/ej/si/mfejsivr_jj6forivsfp0jhstbu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Immediately proceed to the configuration of our new device. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Initially, we have configured the GET method, switch it to POST (a little later it will become clear why this is necessary). </font><font style="vertical-align: inherit;">On the ‚ÄúAuthorization‚Äù tab, enter the ‚Äúcredentials‚Äù we have on hand:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/96/ci/zc/96cizcahk44iy5-rpfvcznue3jw.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now create our first request:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/kp/zj/rp/kpzjrpd26ykmyt5r6xtyyoizk1w.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the request body, we indicate:</font></font><br>
<br>
<pre><code class="json hljs">{
    <span class="hljs-attr">"externalId"</span>: <span class="hljs-string">"&lt;ID &gt;"</span>,
    <span class="hljs-attr">"reliableDataService"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">"pdnEstablishmentOption"</span>: <span class="hljs-string">"WAIT_FOR_UE"</span>,
    <span class="hljs-attr">"duration"</span>:<span class="hljs-string">"2020-12-31T23:59:59Z"</span>,
    <span class="hljs-attr">"notificationDestination"</span>: <span class="hljs-string">"http://&lt;IP &gt;:&lt;port&gt;"</span>
}</code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Important!</font></font></b>
                        <div class="spoiler_text">  :<br>
<ul>
<li>‚Äúduration‚Äù ‚Äì      duration     SLA SCEF    (SCSAS/ID)   , SCEF    ,    </li>
<li>‚ÄúmaximumPacketSize‚Äù ‚Äì       / </li>
</ul></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's immediately note that the following options are possible in ‚ÄúpdnEstablishmentOption‚Äù:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WAIT_FOR_UE - buffer if the device is unavailable (not registered on the network or in the PSM or in another state)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INDICATE_ERROR - immediately respond with an error if the device is unavailable</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SEND_TRIGGER - use Device Triggering service (alternative delivery channel via SMS). </font><font style="vertical-align: inherit;">This article is not considered.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We use the same parameter to send data to the device. </font><font style="vertical-align: inherit;">And when creating a subscription, we can immediately send data to the device, reducing the number of API requests. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All! </font><font style="vertical-align: inherit;">You can click the Send button and carefully examine what we get in response from SCEF:</font></font><br>
<br>
<pre><code class="json hljs">{
    <span class="hljs-attr">"externalId"</span>: <span class="hljs-string">"&lt;ID &gt;"</span>,
    <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"2020-12-31T23:59:59Z"</span>,
    <span class="hljs-attr">"notificationDestination"</span>: <span class="hljs-string">"http://&lt;IP &gt;:&lt;port&gt;"</span>,<font></font>
    ‚ÄúreliableDataService<span class="hljs-attr">": false,
    "</span>maximumPacketSize<span class="hljs-attr">": 500,
    "</span>self<span class="hljs-attr">": "</span>/3gpp-nidd/v1/&lt;ScsAsID&gt;/configurations/&lt;ID &gt;<span class="hljs-attr">",
    "</span>status<span class="hljs-attr">": "</span>ACTIVE<span class="hljs-attr">"
}</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the self line, we are primarily interested in the ID of the configuration we created, it is extremely undesirable to lose it, since most likely the operators will not support the request function of all created configurations. </font><font style="vertical-align: inherit;">When there are several thousand devices created within the framework of one ScsAsID, too much load will be created on SCEF servers to broadcast all device configurations. </font><font style="vertical-align: inherit;">We take it as a rule: one device = one subscription as part of the ScsAsID service. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, we can already receive data from the module on the server, the IP address and port of which we indicated above.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data transfer from module to AS</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's try to transfer data from the device to AS, return to the SIM7020E module and if we did not touch it from the previous chapter and did not turn it off, we will send the command to it:</font></font><br>
<br>
<pre><code class="plaintext hljs">AT+NIDD=3,&lt;account_id&gt;,"6162636465"<font></font>
OK</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Please note that our message is encoded in HEX and contains a simple sequence: ‚Äúabcde‚Äù. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Almost immediately on the server (AS), which is the host, we will see:</font></font><br>
<br>
<pre><code class="xml hljs">POST / HTTP/1.1<font></font>
OCSGHTTPProcessor: 147ff7c6-a43d-4fc9-b303-0ca50f497747<font></font>
X-callback-t8-type: 3<font></font>
X-callback-url: http://<span class="hljs-tag">&lt;<span class="hljs-name">IP</span> &gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">port</span>&gt;</span><font></font>
X-api-network-service-node: 0<font></font>
Content-Type: application/json<font></font>
Content-Length: 214<font></font>
Host: <span class="hljs-tag">&lt;<span class="hljs-name">IP</span> &gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">port</span>&gt;</span><font></font>
Connection: Keep-Alive<font></font>
User-Agent: Apache-HttpAsyncClient/4.1.3 (Java/1.8.0_181)<font></font>
<font></font>
{"externalId":"<span class="hljs-tag">&lt;<span class="hljs-name">ID</span> &gt;</span>","niddConfiguration":"/3gpp-nidd/v1/<span class="hljs-tag">&lt;<span class="hljs-name">ScsAsID</span>&gt;</span>/configurations/<span class="hljs-tag">&lt;<span class="hljs-name">ID</span> &gt;</span>","data":"YWJjZGU=","reliableDataService":false}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The message itself arrived in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Base64</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> encoding </font><font style="vertical-align: inherit;">and looks like this:</font></font><br>
<pre><code class="plaintext hljs">YWJjZGU=</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If we translate from Base64 encoding, we get our original message:</font></font><br>
<pre><code class="plaintext hljs">abcde</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Base64 encoding is used due to the fact that when using ASCII encoding, some data is sometimes lost and using Base64 makes transmission more reliable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It should also be noted that in this case the information transmitted from the module is not stored inside SCEF and is immediately transmitted to our server via HTTP.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data transfer from AS to module</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to send data in the direction from our AS to the module, let's go back to Postman and create a new request using the POST method and Base64 encoding. We will send 1234567890 (in Base64: MTIzNDU2Nzg5MA ==) to our module: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wz/mj/mc/wzmjmczcilbscfvrsjryyi5qfr8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Please note that an addendum has appeared in the "address" field, in which we indicated for which configuration we want to send the message. If several devices are included in our configuration, you can use the identifier ‚ÄúexternalGroupID‚Äù and then all of them will receive this data. Another important point is the lifetime of the sent message, indicated in seconds and has a fairly wide range.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By the way, if the device is not online at this moment, then our message will be buffered on SCEF, and the line ‚ÄúmaximumLatency‚Äù will tell us how many seconds are left until the message is destroyed if the device does not get in touch before the timer we set . </font><font style="vertical-align: inherit;">Below is what the requested current SCEF configuration will look like (using the GET mechanism, more on that below):</font></font><br>
<br>
<pre><code class="json hljs">{
    <span class="hljs-attr">"externalId"</span>: <span class="hljs-string">"&lt;ID &gt;"</span>,
    <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"2020-12-31T23:59:59Z"</span>,
    <span class="hljs-attr">"notificationDestination"</span>: <span class="hljs-string">"http://&lt;IP &gt;:&lt;port&gt;"</span>,
    <span class="hljs-attr">"reliableDataService"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">"status"</span>: <span class="hljs-string">"ACTIVE"</span>,
    <span class="hljs-attr">"niddDownlinkDataTransfers"</span>: [<font></font>
    {<font></font>
        <span class="hljs-attr">"externalId"</span>: <span class="hljs-string">"&lt;ID &gt;"</span>,
        <span class="hljs-attr">"reliableDataService"</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">"data"</span>: <span class="hljs-string">"MDEyMzQ1Njc4OTA="</span>,
        <span class="hljs-attr">"maximumLatency"</span>: <span class="hljs-number">96</span>,
        <span class="hljs-attr">"priority"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">"self"</span>: <span class="hljs-string">"/3gpp-nidd/v1/&lt;ScsAsID&gt;/configurations/&lt;ID &gt;/downlink-data-deliveries/1"</span><font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If, after the timer expires, the device still has not contacted, SCEF will notify your server (AS) that the message was not delivered due to the timer expiration and the message will be deleted:</font></font><br>
<br>
<pre><code class="xml hljs">POST / HTTP/1.1<font></font>
OCSGHTTPProcessor: 14c8cab8-ecce-4868-a59e-1f784224518b<font></font>
X-callback-t8-type: 4<font></font>
X-callback-url: http://<span class="hljs-tag">&lt;<span class="hljs-name">IP</span> &gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">port</span>&gt;</span><font></font>
X-api-network-service-node: 0<font></font>
Content-Type: application/json<font></font>
Content-Length: 139<font></font>
Host: <span class="hljs-tag">&lt;<span class="hljs-name">IP</span> &gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">port</span>&gt;</span><font></font>
Connection: Keep-Alive<font></font>
User-Agent: Apache-HttpAsyncClient/4.1.3 (Java/1.8.0_181)<font></font>
<font></font>
{"niddDownlinkDataTransfer":"/3gpp-nidd/v1/<span class="hljs-tag">&lt;<span class="hljs-name">ScsAsID</span>&gt;</span>/configurations/<span class="hljs-tag">&lt;<span class="hljs-name">ID</span> &gt;</span>/downlink-data-deliveries/1","status":"FAILURE"}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If successful, SCEF will immediately respond:</font></font><br>
<br>
<pre><code class="json hljs">{
    <span class="hljs-attr">"externalId"</span>: <span class="hljs-string">"&lt;ID &gt;"</span>,
    <span class="hljs-attr">"reliableDataService"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">"status"</span>: <span class="hljs-string">"SUCCESS"</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can add the ability to prioritize messages in case they are buffered. </font><font style="vertical-align: inherit;">It is regulated by the ‚Äúpriority‚Äù parameter. </font><font style="vertical-align: inherit;">When a new message is sent to the device and if the delivery buffer is exceeded by SCEF, the message will be replaced with a message with a lower priority, otherwise the message will not be accepted for delivery. </font><font style="vertical-align: inherit;">It is also possible to delete a message from the buffer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the message cannot be delivered, and it is buffered, you will receive the following:</font></font><br>
<br>
<pre><code class="json hljs">{
    <span class="hljs-attr">"externalId"</span>: <span class="hljs-string">"&lt;ID &gt;"</span>,
    <span class="hljs-attr">"reliableDataService"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">"self"</span>: <span class="hljs-string">"/3gpp-nidd/v1/&lt;ScsAsID&gt;/configurations/&lt;ID &gt;/downlink-data-deliveries/2"</span>,
   <span class="hljs-attr">"status"</span>: <span class="hljs-string">"BUFFERING"</span>
}</code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Important!</font></font></b>
                        <div class="spoiler_text">  :<br>
/&lt;ID &gt;/downlink-data-deliveries/<b>1</b><br>
 ‚Äì      SCEF.  ,    .         .</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Upon receipt of the message, the module will report the following URC:</font></font><br>
<br>
<pre><code class="plaintext hljs">+NIDD=4,0,11,0,"3031323334353637383930"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Which in translation from HEX to ASCII will be our message:</font></font><br>
<br>
<pre><code class="plaintext hljs">1234567890</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Just leave it here. </font><font style="vertical-align: inherit;">Notification of delivery of a "buffered" message:</font></font><br>
<br>
<pre><code class="json hljs">{
<span class="hljs-attr">"niddDownlinkDataTransfer"</span>:<span class="hljs-string">"3gpp-nidd/v1/&lt;ScsAsID&gt;/configurations/&lt;ID &gt;/downlink-data-deliveries/1"</span>,
<span class="hljs-attr">"status"</span>:<span class="hljs-string">"SUCCESS"</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Monitoring the status of the device status is possible through another SCEF service called ‚ÄúMonitoring Event (MONTE)‚Äù. </font><font style="vertical-align: inherit;">Within MONTE, it is possible to receive notifications about events and time (for example, when the device becomes available), using a similar subscription system. </font><font style="vertical-align: inherit;">But let's talk about this another time.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Getting configuration from SCEF</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You probably noticed that you can get the current configuration from SCEF. </font><font style="vertical-align: inherit;">Let's do that. </font><font style="vertical-align: inherit;">We take the Postman we have already loved and create the following request using the GET method:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/i_/jp/j6/i_jpj6tfbbgoxt0u5sf6gl9obnk.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Those. </font><font style="vertical-align: inherit;">we leave the body of the message itself empty, and in the address bar we just need to specify the ID of the configuration created for us in order to receive its current state in response:</font></font><br>
<br>
<pre><code class="json hljs">{
    <span class="hljs-attr">"externalId"</span>: <span class="hljs-string">"&lt;ID &gt;"</span>,
    <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"2020-12-31T23:59:59Z"</span>,
    <span class="hljs-attr">"notificationDestination"</span>: <span class="hljs-string">" http://&lt;IP &gt;:&lt;port&gt;"</span>,
    <span class="hljs-attr">"reliableDataService"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">"status"</span>: <span class="hljs-string">"ACTIVE"</span>,
    <span class="hljs-attr">"niddDownlinkDataTransfers"</span>: []<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deleting a configuration on SCEF</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well and the last - we will delete the configuration created by us. </font><font style="vertical-align: inherit;">To do this, use the same address bar as in the current configuration, but change it to DELETE:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/w_/bt/n5/w_btn5pki3qerymozmgnub-f4ug.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In response, we will receive:</font></font><br>
<br>
<pre><code class="json hljs">{
    <span class="hljs-attr">"externalId"</span>: <span class="hljs-string">" &lt;ID &gt;"</span>,
    <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"2020-12-31T23:59:59Z"</span>,
    <span class="hljs-attr">" notificationDestination"</span>: <span class="hljs-string">" http://&lt;IP &gt;:&lt;port&gt;"</span>,
    <span class="hljs-attr">"reliableDataService"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">"status"</span>: <span class="hljs-string">"TERMINATED"</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Where in the line ‚Äústatus‚Äù we will see that the configuration created by us is deleted.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
More than one dissertation can be written on the topic of using SCEF, the topic is extensive and will soon become extremely relevant for many M2M devices in all areas, and especially for the Internet of things. </font><font style="vertical-align: inherit;">The main thing I wanted to convey to you was how to start working with NIDD and SCEF out of the box so that you can figure it out on your own. </font><font style="vertical-align: inherit;">But also I am always happy to help you: support@simcom.com (marked for RUS Team), in the letter you must indicate your contact details and a few words about your project. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the following articles we will carefully analyze other aspects of working with cellular modules, and you write in the comments which topic will be of interest to you. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I want to say special thanks to Sergey Novikov, the senior expert of converged solutions and multimedia services.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sanov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) from MTS for invaluable assistance in preparing the article.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sources used</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NB-IoT: how does it work? </font><font style="vertical-align: inherit;">Part 3: SCEF - a single window of access to the services of the operator </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ETSI TS 129 122</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en489594/index.html">Framework vs Platform: what's the difference?</a></li>
<li><a href="../en489596/index.html">The digest of interesting materials for the mobile # 334 developer (on February 17 - 23)</a></li>
<li><a href="../en489600/index.html">GDC-2020: what to expect from one of the largest gaming development exhibitions</a></li>
<li><a href="../en489602/index.html">Prerender on canvas 2D</a></li>
<li><a href="../en489604/index.html">How do I, team leader, evaluate projects</a></li>
<li><a href="../en489610/index.html">Full home automation in a new building</a></li>
<li><a href="../en489612/index.html">DEFCON 27 Conference. Duplication of mechanical keys with limited access. Part 2</a></li>
<li><a href="../en489614/index.html">Marking of shoe residues in 1C. Solving the problem of scanning and uploading to Honest Sign</a></li>
<li><a href="../en489618/index.html">Do we need such a format? .. and some statistics</a></li>
<li><a href="../en489620/index.html">9 Windows Terminal Tips by Scott Hanselman</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>