<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüë©‚Äçüë¶‚Äçüë¶ üéÜ üçÑ Iron or optimization? Badoo, Avito and Mamba - about PHP performance üç∞ üòô üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The PHP performance issue for Badoo is one of the most important. The quality of the PHP backend directly depends on the amount of resources we spend ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Iron or optimization? Badoo, Avito and Mamba - about PHP performance</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/487234/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The PHP performance issue for Badoo is one of the most important. The quality of the PHP backend directly depends on the amount of resources we spend on development and operation, the speed of the service and the impression it makes on users. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, the topic of the third meeting of the community of PHP developers in our office we made backend performance and invited colleagues from Avito and Mamba to discuss. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t-/p7/se/t-p7sef1pbww8vboigkup6ditzu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Read under the cutscene transcript of the discussion, in which I was lucky to be a moderator: how the infrastructure of the three companies is arranged, how we measure productivity and what metrics we focus on, what tools we use, how we make a choice between hardware and optimization. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And on February 15, come to the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">next Badoo PHP Meetup</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : discuss Legacy.</font></font><br>
<a name="habracut"></a><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/kWBm0C9A8oo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe> <br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We have deciphered only the part of the discussion, which seemed to us the most interesting. </font><font style="vertical-align: inherit;">The full version is available on video. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Experts:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Head of Development Unit at Core Services Avito</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pmurzakov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, PHP Timlid in Badoo </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mipxtx</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, IT Director of Mamba</font></font></li>
</ul><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tell a story about optimization from your practice: grand success or grand failure is something that is interesting to share. </font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I have a parable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
About once every six months we look at the metrics and look for what slows down, does not work well, what needs to be optimized. </font><font style="vertical-align: inherit;">Once we noticed our symfony dependency container, which grew to 52,000 lines. </font><font style="vertical-align: inherit;">We decided that he, the scoundrel, was to blame for everything: 20 ms of overhead for each request. </font><font style="vertical-align: inherit;">We sawed it. </font><font style="vertical-align: inherit;">We reduced it. </font><font style="vertical-align: inherit;">We somehow tried to separate it, but nothing helped. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And then it turned out that we have anti-spam that needs to go to 20 databases in order to fulfill all the necessary requests. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The solutions that come first are not always the right ones. </font><font style="vertical-align: inherit;">Look better at the traces, logs and benchmarks of your requests, and do not break directly. </font><font style="vertical-align: inherit;">Here is a story.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We have a fairly large ecosystem in PHP, so we periodically do optimization. </font><font style="vertical-align: inherit;">We are growing, we are reaching some level in CPU, we understand that we need to either buy hardware or optimize. </font><font style="vertical-align: inherit;">Weigh the arguments for and against each option and decide. </font><font style="vertical-align: inherit;">Most often - in favor of optimization, because iron needs a lot. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At one of these points, we identified a whole group that was engaged in looking for various non-optimal things in PHP scripts and optimizing it. </font><font style="vertical-align: inherit;">This happened literally ‚Äúdrop by drop‚Äù: here they found a percentage, there they found a percentage - several people found a percentage within a month. </font><font style="vertical-align: inherit;">At some point, our sishnik was nearby</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einstein_man</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">He decided to see what he could do: he went in the evening, launched Perf, found a couple of problems in PHP extensions - and accelerated everything in a couple of evenings by 13%!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I have two stories. One about the file, the other about the super developer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
About the Fail. We have many microservices, including PHP. Everyone works at Kubernetes. I worked on one of these microservices. There was a significant CPU utilization: they spent a week optimizing and finding problems. It turned out that one of the developers added Xdebug to the base images for calculating code coverage tests in his (other) service, after which all microservices in production worked with Xdebug turned on for a whole quarter! After a quarter, we discovered this, fixed basic images - and began to catch unexpected gifts: I re-rolled my service, and it began to work faster. At each deployment, our service image is rebuilt, and now without Xdebug.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
History of success. We have many microservices, and they became more and more. In this situation, the number of RPC calls becomes a problem. For example, on an announcement card - and this is one of the most frequent pages in Avito - about 30 microservices are involved in rendering a page. Moreover, all this was not done very explicitly: it seems like you are calling some kind of abstraction, and under it five RPC calls to other services are sequentially performed.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Over the years, the announcement card has been greatly degraded. </font><font style="vertical-align: inherit;">One strong developer fought for a quarter, optimized, and brought all RPC calls out. </font><font style="vertical-align: inherit;">When he was able to do this, he parallelized them through Guzzle multi request - and instead of 30 consecutive synchronous requests, he received the same 30 requests, but parallel ones, which greatly accelerated the work. </font><font style="vertical-align: inherit;">After this refactoring, the response time of the card is equal to the maximum response time of any of the services. </font><font style="vertical-align: inherit;">But he needed a whole quarter to optimize / rewrite the display code of the announcement card.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tell us, what is your PHP cluster size, how is it configured - at least PHP-FPM, or maybe somewhere Apache has gotten into trouble?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We have about 15,000 RPS. </font><font style="vertical-align: inherit;">A cluster of 80 FPM servers purchased several years ago. </font><font style="vertical-align: inherit;">On each cluster, FPM (up to 50 childs maximum) is launched into statics. </font><font style="vertical-align: inherit;">It loaded about ten at peak in prime time. </font><font style="vertical-align: inherit;">The average response time is 100 ms, and we try to hold it (when it exceeds 100 ms, we begin the search for braking pieces). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We have our own performance monitoring system. </font><font style="vertical-align: inherit;">We scattered a lot of counters in the code, about 120 per request. </font><font style="vertical-align: inherit;">We monitor a lot of events that occur inside the code in PHP.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything is standard with us: nginx, PHP-FPM. Approximately 600 servers with FPM. If to speak about PHP at all, then, probably, there are about 300 more servers for various purposes, such as script, back-office and others. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of the configuration features, there are two. Firstly, we have a BMA proxy - this is a proxy for mobile. That is, before a request arrives in nginx, it gets to a special proxy that holds a persistent connection and sends requests to nginx. The second feature - sometimes you need to turn off the CLI opcache (we have it turned on on scripting machines). Once we did not turn it off and lost 30% of the CPU on this. After they realized their mistake, they were surprised how much you can save with one setting. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We have PHP patches, but they are almost not related to performance.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is a point with the competitive APCu lock - when you need to write a lot to the same key. </font><font style="vertical-align: inherit;">The internal architecture of APCu is built in such a way that there is a global key lock, and during intensive recording, brakes begin. </font><font style="vertical-align: inherit;">Therefore, we have a custom extension there that solves this problem. </font><font style="vertical-align: inherit;">This only partly relates to performance, as it affects response time, but not CPU consumption.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We have about 2 million requests per minute (~ 33 kRPS). </font><font style="vertical-align: inherit;">A monolithic application written in PHP has been written for over 11 years. </font><font style="vertical-align: inherit;">It is in a phase of rapid growth. </font><font style="vertical-align: inherit;">When the company started, there were 65 LXCs on 65 physical servers. </font><font style="vertical-align: inherit;">On each container with the application, PHP-FPM, nginx and auxiliary software for metrics and logging are running. </font><font style="vertical-align: inherit;">Nothing special. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Over the years, we have never added iron for a monolith. </font><font style="vertical-align: inherit;">We are increasing attendance, the number of ads, the number of user transactions, and we are constantly optimizing, improving the code, optimizing software. </font><font style="vertical-align: inherit;">CPU and memory consumption has been falling over the past years: 65 containers for a monolith are now enough for us.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How do you measure performance? </font><font style="vertical-align: inherit;">What tool do you measure the response time of the client?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We have a log collection system. </font><font style="vertical-align: inherit;">It logs two indicators - the time from the start of FPM to the shutdown function and until the end of the script. </font><font style="vertical-align: inherit;">The second metric is needed to see what happens after the shutdown function. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We measure JS. </font><font style="vertical-align: inherit;">This, in fact, is a so-so metric; network channels are very often violated. </font><font style="vertical-align: inherit;">As a result, loading somewhere in the Russian outback begins to blunt. </font><font style="vertical-align: inherit;">Therefore, we look like this: "Oh, jumped - it means that somewhere something fell off." </font><font style="vertical-align: inherit;">Plus third-party advertising very much distorts the metric. </font><font style="vertical-align: inherit;">And, most importantly, spammers come, and this is generally some kind of randomness.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By the way, we used to use </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pinba</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> from Badoo </font><font style="vertical-align: inherit;">very actively </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">I like her now. </font><font style="vertical-align: inherit;">Most of the metrics were collected by it, but then switched to the StatsD protocol. </font><font style="vertical-align: inherit;">Now we are taking measurements from different points: from the front, from the servers in front of the application, from nginx and from the PHP application itself. </font><font style="vertical-align: inherit;">We have a dedicated performance team. </font><font style="vertical-align: inherit;">She started with the performance of the front, but then switched to backing. </font><font style="vertical-align: inherit;">From the front, it collects not only JS, CSS and other statics, but at the same time also the server response time. </font><font style="vertical-align: inherit;">First of all, we focus on the response time of the application.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything is similar to what the guys told us. </font><font style="vertical-align: inherit;">Using the classic Pinba for PHP, we measure the running time of a PHP script in terms of PHP. </font><font style="vertical-align: inherit;">But we also have, for example, Pinba for nginx, which measures the response time from the point of view of nginx. </font><font style="vertical-align: inherit;">We also collect metrics on the client. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What are we looking at? </font><font style="vertical-align: inherit;">On the one hand, the response time. </font><font style="vertical-align: inherit;">It is not related to resource planning. </font><font style="vertical-align: inherit;">If it is bad, it needs to be improved, because it is, in fact, the quality of service. </font><font style="vertical-align: inherit;">Another thing is that you need to somehow plan the iron. </font><font style="vertical-align: inherit;">Our ITOps and monitoring teams monitor all the hardware. </font><font style="vertical-align: inherit;">There are some bars on the network, on the disk. </font><font style="vertical-align: inherit;">There are some values ‚Äã‚Äãafter which the alert occurs - and we are doing something. </font><font style="vertical-align: inherit;">As practice has shown, we usually optimize for the CPU: we run into it.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At us the PHP application measures itself and in register_shutdown_function () throws out metrics. </font><font style="vertical-align: inherit;">Each LXC has a StatsD server, which collects these metrics and sends them through the collectors to the Graphite cluster (including ClickHouse), where the data is stored. </font><font style="vertical-align: inherit;">This is a self-diagnosis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also on each container is nginx, i.e. nginx + PHP-FPM. </font><font style="vertical-align: inherit;">With nginx, we collect external metrics related to the running time of a PHP application. </font><font style="vertical-align: inherit;">They are also facing separate servers (we call them avi-http) nginx, which performs basic routing, which also collects higher-level metrics, such as response time, the number of 500 response codes, and others.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What tools do you have for a performance track? </font><font style="vertical-align: inherit;">What do you use most often?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We wrote our own tool. When Pinba just came out - in 2012, a very long time ago - it was a module for MySQL that received something like this over UDP. It was difficult to take out the graphics; it was not very optimized for performance. And we didn‚Äôt come up with anything better than writing our own thing called Better Than Pinba. It is just a counter server that accepts them from a PHP client. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We scattered a lot of timers in the code: every time we want to measure something, we set the start and stop of the timer in the code. The module itself will calculate the counter runtime, aggregate the accumulated counters into a packet, and send them to the daemon. The interface itself will extract everything you need and build connected graphs on the desired counter.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One of Pinba's problems was the lack of its own interface - it was necessary to transfer data to RRD (then there was such darkness). </font><font style="vertical-align: inherit;">Therefore, we wrote our own interface. </font><font style="vertical-align: inherit;">Every time we see what jumped, we can install the script. </font><font style="vertical-align: inherit;">In the script all aggregated counters are sent to us, which are sent to us. </font><font style="vertical-align: inherit;">We can see where which counter has grown, or the response time at the counter has increased, or the number of counters has increased. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It can be seen when performance drops. </font><font style="vertical-align: inherit;">We are starting to dig this way. </font><font style="vertical-align: inherit;">Before PHP 7, we used XHProf, then it stopped building with us. </font><font style="vertical-align: inherit;">Therefore, we switched to Xdebug. </font><font style="vertical-align: inherit;">Xdebug we poke only when the problem is visible.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is a common belief that XHProf is not going to be built in PHP 7. </font><font style="vertical-align: inherit;">This is true, but only in part. </font><font style="vertical-align: inherit;">If you take XHProf from the wizard, it really will not. </font><font style="vertical-align: inherit;">But if on GitHub you switch to a branch called Experimental (or something like that), then everything works fine for PHP 7, production ready. </font><font style="vertical-align: inherit;">Checked.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba</font></font></h3> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No, I switched. </font><font style="vertical-align: inherit;">It didn‚Äôt work for me.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I want to add about Pinba. </font><font style="vertical-align: inherit;">You have become prophets to some extent. </font><font style="vertical-align: inherit;">We, too, at some point lost productivity. </font><font style="vertical-align: inherit;">We made </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pinba2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which is very fast. </font><font style="vertical-align: inherit;">It can be used as a replacement for Pinba.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything is modest with us. </font><font style="vertical-align: inherit;">We just took the direction of the performance into the work: we collect metrics, such as response time. </font><font style="vertical-align: inherit;">We use StatsD. </font><font style="vertical-align: inherit;">We do not use any profilers on a regular basis yet, but I know for sure that some teams use them in their microservices written in PHP. </font><font style="vertical-align: inherit;">In my opinion, even someone relays New Relic. </font><font style="vertical-align: inherit;">But in the context of the main monolithic application, so far we are only approaching this.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Iron history is monitored in Grafana, Zabbix. </font><font style="vertical-align: inherit;">As for the PHP part, we have Pinba, we have a bunch of timers; </font><font style="vertical-align: inherit;">We build convenient graphics on them. </font><font style="vertical-align: inherit;">We use XHProf, on production we drive it for a part of requests. </font><font style="vertical-align: inherit;">We always have fresh XHProf profiles available. </font><font style="vertical-align: inherit;">We have liveprof: this is our tool, you can read about it, including </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in my article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">It all happens automatically, you just have to watch. </font><font style="vertical-align: inherit;">We use phpspy. </font><font style="vertical-align: inherit;">It is not always started with us: when someone wants to see something, he enters the car, takes off his profile. </font><font style="vertical-align: inherit;">In principle, as is the case with Perf.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
XHProf has the same story. </font><font style="vertical-align: inherit;">We once used it a long time ago: it was a personal initiative of a couple of developers, and, in fact, did not take off. </font><font style="vertical-align: inherit;">He stopped collecting. </font><font style="vertical-align: inherit;">We collect a bunch of metrics from calls of routers, controllers, various models. </font><font style="vertical-align: inherit;">About 60‚Äì70% of the internal network of the data center is occupied by UDP packets with metrics. </font><font style="vertical-align: inherit;">At the moment, this is enough for us. </font><font style="vertical-align: inherit;">Now we will look for new places for optimization.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since we have reached the point of iron: is someone systematically engaged in capacity planning in your company? </font><font style="vertical-align: inherit;">How is this process built?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A monolithic application runs at least 65 LXC for at least five years. </font><font style="vertical-align: inherit;">We optimize the code, improve it: it has enough resources. </font><font style="vertical-align: inherit;">Our main capacity planning goes to Kubernetes, where about 400 more or less living microservices are written in PHP / Go. </font><font style="vertical-align: inherit;">We are slowly cutting pieces from the monolith, but it is still growing. </font><font style="vertical-align: inherit;">We cannot stop him. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, PHP is a cool language. </font><font style="vertical-align: inherit;">It quickly implements business logic.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First of all, ITOps and monitoring teams make sure that there are enough resources. </font><font style="vertical-align: inherit;">If we begin to approach the threshold value, colleagues notice this. </font><font style="vertical-align: inherit;">They are probably primarily responsible for global capacity planning. </font><font style="vertical-align: inherit;">The PHP part has the main CPU resource, so we follow it ourselves. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We set ourselves the bar: we should not "eat" more than 60% of the cluster. </font><font style="vertical-align: inherit;">60%, and not 95%, because we have hypertreading, which additionally squeezes out more from the processor than you can squeeze out without it. </font><font style="vertical-align: inherit;">For this, we pay by the fact that after 50% of our CPU consumption we can grow in an unpredictable way, because hyper -reading kernels are not entirely honest.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We make a deployment and see that something has failed with us - such capacity planning. </font><font style="vertical-align: inherit;">By eye! </font><font style="vertical-align: inherit;">We have a certain margin of productivity that allows us to do this. </font><font style="vertical-align: inherit;">We try to stick to it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, we do post factum optimization. </font><font style="vertical-align: inherit;">When we see that something has fallen off, we roll back if everything is completely bad. </font><font style="vertical-align: inherit;">But this practically does not happen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Or we just see that "here is not optimal, now we will quickly fix everything and everything will work as it should." </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We don‚Äôt particularly bother: it is very difficult, and the exhaust will not be very large.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You are talking about microservices. </font><font style="vertical-align: inherit;">How do they interact? </font><font style="vertical-align: inherit;">Is it REST or are you using binary protocols?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kafka is used to send events between services, JSON-RPC is used to ensure interaction between services, but not full, but its simplified version, which we cannot get rid of. </font><font style="vertical-align: inherit;">There are faster implementations: the same protobuf, gRPC. </font><font style="vertical-align: inherit;">This is in our plans, but certainly not a priority. </font><font style="vertical-align: inherit;">With over 400 microservices, it‚Äôs hard to port them all to the new protocol. </font><font style="vertical-align: inherit;">There are tons of other places to optimize. </font><font style="vertical-align: inherit;">We are definitely not up to it now.</font></font><br>
 <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We as such have no microservices. </font><font style="vertical-align: inherit;">There are services, there is also Kafka, its own protocol on top of Google protobuf. </font><font style="vertical-align: inherit;">Probably, we would use gRPC, because it is cool, it has support for all languages, the ability to very easily bind different pieces. </font><font style="vertical-align: inherit;">But when we needed it, gRPC was not there yet. </font><font style="vertical-align: inherit;">But there was a protobuf, and we took it. </font><font style="vertical-align: inherit;">On top of it, different things were added so that it was not just serialization, but a complete protocol.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba</font></font></h3> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We also do not have microservices. </font><font style="vertical-align: inherit;">There are services mainly written in C. We use JSON-RPC because it is convenient. </font><font style="vertical-align: inherit;">You just opened the socket when you debug your code, and quickly wrote what you wanted. </font><font style="vertical-align: inherit;">Something has returned to you. </font><font style="vertical-align: inherit;">Protobuf is more difficult because you need to use some additional tools. </font><font style="vertical-align: inherit;">There is a small overhead, but we believe that you need to pay for convenience, and this is not a big price.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You have huge databases. </font><font style="vertical-align: inherit;">When you need to change the circuit in one of them, how do you do it? </font><font style="vertical-align: inherit;">Some kind of migrations? </font><font style="vertical-align: inherit;">If these migrations take several days, how does this affect performance?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We have large tables, monolithic. </font><font style="vertical-align: inherit;">There is a shard. </font><font style="vertical-align: inherit;">The shard alters quite quickly, because there are many parallel alters at once. </font><font style="vertical-align: inherit;">A large table with profiles altered about three hours. </font><font style="vertical-align: inherit;">We use Perkonovskie tools that do not have it read and write. </font><font style="vertical-align: inherit;">In addition, we deploy to alter so that the code supports both states. </font><font style="vertical-align: inherit;">After alter, we also deploy: deploying is faster than applying any schemes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We have the largest storage (we call it "spots") - this is a huge sharded database. </font><font style="vertical-align: inherit;">If we take the ‚ÄúUser‚Äù table, then she has a lot of shards. </font><font style="vertical-align: inherit;">I won‚Äôt tell you exactly how many tables will be on one server: the idea is that there are many small ones. </font><font style="vertical-align: inherit;">When we change the circuit, in fact, we just do an alter. </font><font style="vertical-align: inherit;">On every small table, it happens quickly. </font><font style="vertical-align: inherit;">There are other repositories - there are already other approaches. </font><font style="vertical-align: inherit;">If there is one huge base, there are Perconian tools. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, we use different things according to needs. </font><font style="vertical-align: inherit;">The most frequent change is a change in this huge sharded spot base, in which we already have a process built. </font><font style="vertical-align: inherit;">It all works very simply.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The same monolithic application that serves most of the traffic is deployed five to six times a day. </font><font style="vertical-align: inherit;">Almost every two hours. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In terms of working with the database, this is a separate issue. </font><font style="vertical-align: inherit;">There are migrations, they roll automatically. </font><font style="vertical-align: inherit;">This is a DBA review. </font><font style="vertical-align: inherit;">There is an option to skip migration and manually roll. </font><font style="vertical-align: inherit;">Migration will automatically roll into staging when testing code. </font><font style="vertical-align: inherit;">But on production, if there is some kind of dubious migration that utilizes a bunch of resources, then the DBA will start it manually.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The code should be such that it works with the old and new database structures. </font><font style="vertical-align: inherit;">We often do multiple trips for deploying features. </font><font style="vertical-align: inherit;">For two or three roll-outs, it is possible to obtain the desired state. </font><font style="vertical-align: inherit;">Likewise, there are huge databases, sharded databases. </font><font style="vertical-align: inherit;">If we count for all microservices, then there are definitely 100-150 deployments per day.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I would like to know what is the standard backend response time for you that you are following? </font><font style="vertical-align: inherit;">When do you understand what you need to optimize further, or what is the time to finish? </font><font style="vertical-align: inherit;">Is there a ‚Äúhospital average‚Äù value?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No. </font><font style="vertical-align: inherit;">Depends on endpoint. </font><font style="vertical-align: inherit;">We look at everything separately. </font><font style="vertical-align: inherit;">Trying to understand how critical this is. </font><font style="vertical-align: inherit;">Some endpoints are generally requested in the background. </font><font style="vertical-align: inherit;">This does not affect the user in any way, even if the response time is 20 s. </font><font style="vertical-align: inherit;">This will happen in the background, there is no difference. </font><font style="vertical-align: inherit;">The main thing is that some important things be done quickly. </font><font style="vertical-align: inherit;">Perhaps 200 ms is still ok, but a small increase already matters.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We are switching from HTML rendering to API requests. </font><font style="vertical-align: inherit;">Here, in fact, the API responds much faster than the large, heavy HTML response. </font><font style="vertical-align: inherit;">Therefore, it is difficult to distinguish, for example, a value of 100 ms. </font><font style="vertical-align: inherit;">We focused on 200 ms. </font><font style="vertical-align: inherit;">Then happened PHP 7 - and we began to focus on 100 ms. </font><font style="vertical-align: inherit;">This is the "average for the hospital." </font><font style="vertical-align: inherit;">This is a very vague metric, which suggests that it is time to at least look there. </font><font style="vertical-align: inherit;">And so we rather focus on the deployment and jumped response time after it.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We did a sketch of one of the performance teams. Colleagues measured how much more a company earns by speeding up page loading under various scenarios. We calculated how much more buyers, transactions, calls, transitions, and so on are going on. According to these data, it can be understood that at some point, acceleration ceases to make sense. For example, if the response time of one of the pages from 90 ms was accelerated to 70 ms, this gave + 2% of buyers. And if you accelerate from 70 ms to 60 ms, then there is already plus 0.1% of buyers, which is generally included in the error. Just like with the guys, everything depends a lot on the page we are working with. In general, Avito 75th percentile - about 75 ms. In my opinion, this is slow. We are now looking for places to optimize. Before the transition to microservices, everything happened much faster for us, and we are trying to optimize performance.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5j/tw/ig/5jtwigxel1bcp3pbmmvhdxdslhu.jpeg"><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And the eternal question: iron or optimization? </font><font style="vertical-align: inherit;">How to understand whether it is worth buying hardware or is it better to invest in optimization? </font><font style="vertical-align: inherit;">Where is the border?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
My opinion: a real programmer is optimization. </font><font style="vertical-align: inherit;">It seems to me that in large companies such as Badoo, mine, Yandex, there are many developers of different levels. </font><font style="vertical-align: inherit;">There are both junior developers / interns and leading developers. </font><font style="vertical-align: inherit;">It seems to me that the number of places for optimization / revision is always added there. </font><font style="vertical-align: inherit;">Iron is the last step. </font><font style="vertical-align: inherit;">For a monolith on 65 LXC, we have not added iron for a very long time. </font><font style="vertical-align: inherit;">CPU utilization - 20%. </font><font style="vertical-align: inherit;">We are already thinking of transferring them to the Kubernetes cluster.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I really like the position of Semyon. But I have a completely opposite point of view. First of all, I would look at the iron. Is it possible to drop iron and will it be cheaper? If so, then it is easier to solve the problem with iron. The developer can do something else, useful at this time. Developer time costs money. Iron also costs money, so you need to compare. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Which of these is more important is unclear. If both of them cost the same, then the hardware wins, because the developer will be able to do something at this time. Specifically, in terms of the PHP backend, we cannot do this. Optimization costs us much cheaper than buying iron.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
About to stop. </font><font style="vertical-align: inherit;">In terms of planning, we have some kind of bar. </font><font style="vertical-align: inherit;">If we reduce CPU consumption below it, then we stop. </font><font style="vertical-align: inherit;">On the other hand, there is also the quality of service. </font><font style="vertical-align: inherit;">If we see that the response time does not suit us somewhere, then we need to optimize.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It seems to me that everything depends on the size of the team and the project. </font><font style="vertical-align: inherit;">The smaller the project, the easier it is to buy hardware, because the developer's salary is constant, and the code that works, the users who work with it, are very different. </font><font style="vertical-align: inherit;">If there are few users, then it‚Äôs easier to buy hardware and entrust the developer with work to develop the project. </font><font style="vertical-align: inherit;">If there are a lot of users, then one developer can compensate for most of the cost of servers.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything really depends on the scale. </font><font style="vertical-align: inherit;">If you have a thousand servers and optimization leads to the fact that you do not need another thousand servers, then it is clearly better to optimize. </font><font style="vertical-align: inherit;">If you have one server, then you can safely buy two or three more servers and score on optimization. </font><font style="vertical-align: inherit;">If the command is small, then start the servers are purchased. </font><font style="vertical-align: inherit;">If the team is large and you have two or three data centers, then buying six data centers is already not so cheap, not so fast.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since we have a PHP mitap, this phrase should sound: why do we need PHP, since we have such problems all the time? </font><font style="vertical-align: inherit;">Let's rewrite Go, C, C #, Rust, Node.js! </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Do you think the rewriting approach is generally justified? </font><font style="vertical-align: inherit;">Are there any problems for the solution of which it is worth doing this and investing at this time?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, PHP is a very good language. It really allows you to solve business problems. He is fast enough. All performance problems are problems of errors, bugs, legacy code (some under-cut code, non-optimal things that would have shot in another language in the same way). By porting them raw to Golang, Java, Python, you get the same performance. The whole problem is that there is a lot of legacy.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Introducing a new language, in my opinion, makes sense in order to expand the stack and employment opportunities. Now it‚Äôs hard enough to find good PHP developers. If we introduce Golang into the techradar, then we can hire gophers. There are few PHP shniks and few gophers on the market, and together there are already a lot of them. For example, we had one experiment. We took C # developers who are ready to learn new languages ‚Äã‚Äã- we simply expanded the hiring stack. If we tell people that we will teach them how to write in PHP, they say that it‚Äôs better not to. And if we offer them to learn to write in PHP, Go and still promise the opportunity to write in Python, then people are more willing to respond. For me, this is an extension of employment opportunities. In other languages, there are some things that are really missing in PHP. But in general, PHP is super sufficient for solving business problems and implementing large projects.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I probably completely agree with Semyon. </font><font style="vertical-align: inherit;">Rewriting just does not make sense. </font><font style="vertical-align: inherit;">PHP is a fairly productive language. </font><font style="vertical-align: inherit;">If you compare it with other scripted non-compiled languages, then it will probably be almost the fastest. </font><font style="vertical-align: inherit;">Rewrite into some languages ‚Äã‚Äãlike Go and others? </font><font style="vertical-align: inherit;">These are other languages, they have other problems. </font><font style="vertical-align: inherit;">It‚Äôs still more difficult to write on them: not so fast and there are a lot of nuances.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nevertheless, there are things that are either difficult or inconvenient to write in PHP. </font><font style="vertical-align: inherit;">Some multi-process, multi-threaded things are better to write in another language. </font><font style="vertical-align: inherit;">An example of a task where the non-use of PHP is justified is, in principle, any storage. </font><font style="vertical-align: inherit;">If this is a service that stores a lot in memory, then PHP is probably not the best language, because it has a very large memory overhead due to dynamic typing. </font><font style="vertical-align: inherit;">It turns out that you save a 4-byte int, and 50 bytes are consumed. </font><font style="vertical-align: inherit;">Of course, I exaggerate, but still this overhead is very large. </font><font style="vertical-align: inherit;">If you have some kind of storage, then it is better to write it in another compiled language with static typing. </font><font style="vertical-align: inherit;">Just like some things that require multi-threaded execution.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Why is PHP considered not very fast? Because it is dynamic. Go translation is a solution to the problem of translating code from dynamic typing to static. Due to this, everything is happening faster. Specifically for Go, in my plan there are tasks of a specific data stream. For example, if there is some kind of data stream that needs to be converted into more convenient formats, this is an ideal thing. Raised by a daemon, it receives one data stream at the input, it issues another. Little memory eats. PHP eats a lot of memory in this case: you need to carefully ensure that it is cleaned.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Transfer to Go is a transfer to microservices, because you won‚Äôt cut out the whole code. </font><font style="vertical-align: inherit;">You won‚Äôt take and rewrite it in its entirety. </font><font style="vertical-align: inherit;">Translation to microservices is a deeper task than translation from one language to another. </font><font style="vertical-align: inherit;">It is necessary to solve it first, and then think about what language to write. </font><font style="vertical-align: inherit;">The hardest part is learning how to microservices.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is not necessary to use Go in microservices. Many services are written in PHP and have an acceptable response time. The team that supports them decided for themselves that they needed to write business logic very quickly and introduce features. They actually sometimes do faster than gophers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We have a tendency to hire gophers, translate to Go. But we still have most of the code written in PHP, and so it will be for at least a few more years. There is no real race, we did not decide that Go is better or worse. Six releases are rolled out into the monolith daily. Our chat ‚ÄúAvito Deploy‚Äù has a list of tasks that are deployed. At least 20 tasks are rolled out per day in each release: at least five or six releases per day, approximately 80 tasks that people have done on these tasks. All this is done in PHP.</font></font><br>
<br>
<blockquote>      ?       -,    ?</blockquote><br>
<h3> , </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is very difficult. There is a psychological moment: I launched a new feature - you're done. Launched a gigantic new feature - you're super-young! When a manager or developer says that he removed a feature (decommissioned), he does not receive such recognition. His work is not visible. For example, a team may receive a bonus for the successful implementation of new features, but I have not seen any awards for dead or experimental functionality. And the result from this can be really colossal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A bunch of legacy features that no one is already using really slows down development. There are hundreds of cases when a new person enters a company and refactores a dead code that is never called because he does not know that it is a dead code.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We are trying to somehow negotiate with managers, find out by golog what kind of feature it was, with analysts we consider how much money it brings, who needs it, and only after that we try to cut it. </font><font style="vertical-align: inherit;">This is a complicated process.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We cut dead code when we get to it. </font><font style="vertical-align: inherit;">And it is far from always possible to cut it quickly. </font><font style="vertical-align: inherit;">First you write one code, then another, on top a third, and then underneath it all turns out that this feature is not needed. </font><font style="vertical-align: inherit;">She pulls a wild number of dependencies, which also need to be fixed. </font><font style="vertical-align: inherit;">This is not always possible, and managers need to report it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The manager sets the task, you evaluate it. </font><font style="vertical-align: inherit;">You say: ‚ÄúYou know, man, I‚Äôll do this for six months. </font><font style="vertical-align: inherit;">Are you ready to tolerate half a year? ‚Äù </font><font style="vertical-align: inherit;">He says: ‚ÄúNo, let‚Äôs think what needs to be cut, what can be left. </font><font style="vertical-align: inherit;">What is fundamentally necessary and what is needed to play around. ‚Äù </font><font style="vertical-align: inherit;">That's how it goes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When a developer receives a feature, he evaluates how difficult it is in terms of development, how difficult it is in terms of performance. If he sees that either one or the other, he clarifies with the product manager whether this is really necessary, whether we can remove something somewhere. Sometimes it happens that changes are not critical, and managers quickly make concessions when they find out that this thing is complicated or is eating resources. It just happens: you say ‚ÄúLet's remove it‚Äù - and that‚Äôs it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It happens that a feature leaves, and after that we notice that it will not perform as well as we would like. And then, again, you can talk with the manager. Often it all ends successfully.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is no built-in process to remove features. This is done sporadically. We see that there is some feature, we come up and offer to turn it off. We turn it off, watch what it gives, and cut it out. Another thing is dead code. We have a special extension, even a whole infrastructure, for dead code detection. We see this dead code. We are trying to cut it off slowly. Another question is if it is really dead and the request never enters it, then it does not affect performance in any way. It affects supportability. People constantly read it, although they might not read it. There is no particular connection with performance.</font></font><br>
<br>
<blockquote><i>15      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Badoo PHP Meetup</a>. ,      : SuperJob, ManyChat, , Badoo  FunCorp    . <br>
<br>
,   ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">YouTube-</a>. ,       - .<br>
<br>
   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> </a>,     .</i><br>
</blockquote></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/en487234/">https://habr.com/ru/post/en487234/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en487224/index.html">How long can a long-term construction, which is destined to become a masterpiece</a></li>
<li><a href="../en487226/index.html">Make your badge: Shitty Add-On doesn't mind OFFZONE</a></li>
<li><a href="../en487228/index.html">Frontend mitap Facebook and AvitoTech</a></li>
<li><a href="../en487230/index.html">USA Life Notes</a></li>
<li><a href="../en487232/index.html">Immune imprinting in childhood: the origin of virus protection</a></li>
<li><a href="../en487238/index.html">How to design power grid protection equipment</a></li>
<li><a href="../en487242/index.html">February IT Events Digest</a></li>
<li><a href="../en487246/index.html">Tensor Certification Authority may compromise customer private keys</a></li>
<li><a href="../en487248/index.html">A little more about improper testing</a></li>
<li><a href="../en487250/index.html">Delayed Alpha blending</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>