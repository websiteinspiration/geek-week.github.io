<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöî üêò ü•ã Secure access to a smart home in the absence of a public IP (part 2) ‚å®Ô∏è üôáüèº üëèüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction
 In the first part I wrote about the statement of the problem and how Wishlist were transformed. In the end, I decided to use OpenVPN, bu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Secure access to a smart home in the absence of a public IP (part 2)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/505412/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introduction</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the first part</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> I wrote about the statement of the problem and how Wishlist were transformed. </font><font style="vertical-align: inherit;">In the end, I decided to use OpenVPN, but, due to the fact that I decided to run everything in Docker containers, it turned out to be not so simple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I must say right away that later I redid everything again, as a result I refused the external VPS. </font><font style="vertical-align: inherit;">However, since everything is in containers, in the process I came across a number of interesting features, which will be discussed.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will describe only key points.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ioBroker</font></font></h3><br>
<pre><code class="plaintext hljs">docker run -d --name iobhost  --net=host -v /opt/iobroker/:/opt/iobroker/ --device=/dev/ttyACM0 --env-file /opt/ioBroker_env.list --restart=always buanet/iobroker:latest
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since I have a MiHome Gateway, sensors are connected to it, even several scenarios are set up, which I do not want to break yet, I connected ioBroker to it. He saw the sensors, he did not have to re-bind them to the Zigbee stick (although there are also, and some buttons are connected to it). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here, in order for ioBroker to contact MiHome Gateway, and to start it with the --net = host parameter. Those. it uses the host interface; you do not need to specify which ports to forward to the container. Without this, he could not see the gateway, because he works through multicast.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The parameter --device = / dev / ttyACM0 is needed to forward the Zigbee USB stick to the container. </font><font style="vertical-align: inherit;">Also in /opt/ioBroker_env.list I had to add the line USBDEVICES = "/ dev / ttyACM0". </font><font style="vertical-align: inherit;">It is important that this line should be present at the time of the first start of the container, when it sees an empty directory and begins its initial configuration. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can configure it later, of course, but you will have to do additional body movements.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MQTT server</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On an external VPS, it launched eclipse mosquito. </font><font style="vertical-align: inherit;">First I set up TLS for him by issuing a Let's encrypt certificate. </font><font style="vertical-align: inherit;">Then he decided that the clients must present the certificate, and only then the name and password (protection from bruteforce). </font><font style="vertical-align: inherit;">So I redid it to self-signed, so that clients write out certificates.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Openvpn</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Used popular images with the Docker Hub. </font><font style="vertical-align: inherit;">For server (VPS) kylemanna / openvpn. </font><font style="vertical-align: inherit;">For the client (the home server where ioBroker is installed) - ekristen / openvpn-client.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Customization</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here I had to tinker. </font><font style="vertical-align: inherit;">In the process, I felt the network aspects of the docker well, working with iptables, discovered a new one, including </font><font style="vertical-align: inherit;">netplan with which I had no business before. </font><font style="vertical-align: inherit;">Actually, therefore, I decided to write this article.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS Server</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With the installation of OpenVPN and configuration, everything is standard, as </font><font style="vertical-align: inherit;">it is written </font><font style="vertical-align: inherit;">on </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://hub.docker.com/r/kylemanna/openvpn</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What I did additionally was to raise additional loopbacks on the VPS and the home server. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/netplan/01-netcfg.yaml</font></font></i><br>
<br>
<pre><code class="plaintext hljs">	# This file describes the network interfaces available on your system<font></font>
	# For more information, see netplan(5).<font></font>
	network:<font></font>
	  version: 2<font></font>
	  renderer: networkd<font></font>
	  &lt;b&gt;ethernets:<font></font>
	    lo:<font></font>
	      renderer: networkd<font></font>
	      match:<font></font>
	        name: lo<font></font>
	      addresses:<font></font>
        - 192.168.16.1/32&lt;/b&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bold highlighted the "additive." Spaces do not seem to be displayed, although they are very important. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The addresses in the examples will use 192.168.6.0 for the home network and 192.168.16.0 for loopback. I will try not to make a mistake anywhere. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openvpn.conf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> added</font></font><br>
<br>
<pre><code class="plaintext hljs">server 192.168.16.192 255.255.255.192<font></font>
push "dhcp-option DNS 192.168.16.6"<font></font>
push "route 192.168.16.0 255.255.255.128"<font></font>
client-to-client<font></font>
client-config-dir       /etc/openvpn/ccd/</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I specially made a loopback from 192.168.16.0/25, and I give out addresses to clients from 192.168.16.128/25, so that subsequently the resolving rules in iptables can be configured with a single grid 192.168.16.0/24 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, VPS has a loopback of 192.168.16.1, it has mqtt on it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The home server has 192.168.16.6. There is iobroker, aka dns for home clients and redefines a number of domain names for connecting from the home network or through a VPN. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There was an idea everywhere to register his "real" IP from the network. Type in ccd / iobroker to specify </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
iroute 192.168.6.6 255.255.255.255</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But, apparently from the fact that this is an address from the network on the WiFi interface of the home laptop, and in many cases it is the default gateway, there were glitches. Including with a smartphone. And I wanted the home network to work both with an active client and without him. And I did not have to frantically disconnect the client, coming home to gain access to other resources. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, I configured this server and its containers to always interact with loopback, regardless of whether the VPN is active. And the same address was being addressed. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ccd / iobroker</font></font></i><br>
<br>
<pre><code class="plaintext hljs">iroute 192.168.16.6 255.255.255.255</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, all VPN clients know that the 192.168.16.0/24 network is accessible through a VPN. If they send packets to 192.168.16.1 (loopback VPS), the packet is encrypted, gets into the openvpn container, decrypted, the default route goes to 172.17.0.1 (default gateway in the default containers), it gets to the host, everything is fine. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But how can I ‚Äúping‚Äù the VPN client from the VPS host or access the home server with the address 192.168.16.6 (and not its temporary IP on the VPN tunnel inside the OpenVPN container)? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviously, the mesh 192.168.16.0 must be routed to the OpenVPN container. Of course, I can see that it is 172.17.0.3. But one day it may change.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If OpenVPN were deployed directly on the server, and not in the container, everything would work by itself. </font><font style="vertical-align: inherit;">And then I had to do it cunningly. </font><font style="vertical-align: inherit;">I create a script that is worked out by the latest in the system, and put it into it:</font></font><br>
<br>
<pre><code class="plaintext hljs">ipaddr=$(docker inspect -f '{{.NetworkSettings.IPAddress}}' vpn-client)<font></font>
route add -net 192.168.16.0/24 gw $ipaddr</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Those. </font><font style="vertical-align: inherit;">through docker inspect, I find out the IP address of the running container, and then I route the grid to it in the usual way. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unlike the usual rc.local, I had to google it, but how, in fact, to make a script that runs last. </font><font style="vertical-align: inherit;">Here is a brief instruction: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Create the file </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/system/custom.target</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="plaintext hljs">[Unit] <font></font>
Description=My Custom Target<font></font>
Requires=multi-user.target<font></font>
After=multi-user.target<font></font>
AllowIsolate=yes<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Create file </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/system/last_command.service</font></font></i> <br>
<br>
<pre><code class="plaintext hljs">[Unit]<font></font>
Description=My custom command<font></font>
After=multi-user.target<font></font>
[Service]<font></font>
Type=simple<font></font>
ExecStart=/usr/local/bin/my_last_command.sh<font></font>
[Install]<font></font>
WantedBy=custom.target<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Create the directory </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/system/custom.target.wants</font></font></i><br>
<br>
<pre><code class="plaintext hljs">ln -s /etc/systemd/system/last_command.service \   /etc/systemd/system/custom.target.wants/last_command.service<font></font>
systemctl daemon-reload<font></font>
systemctl set-default custom.target</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you want to start immediately, without waiting for a reboot: systemctl isolate custom.target </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now, after the reboot </font><font style="vertical-align: inherit;">, the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/local/bin/my_last_command.sh</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">described in ExecStart </font><font style="vertical-align: inherit;">will be the last to be launched </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iptables</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On the mqtt server, I have 2 ports raised: 8883 with TLS and authentication, accessible from the Internet for remote sensors. Yes, and I myself can somehow connect MQTT Explorer and check what and how. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1883 already without TLS, requires only a username and password. Needed for home Sonoff rfBridge, which TLS does not know how. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is not scary, because traffic from home will go to the server with iobroker, which is the default gateway for 192.168.16.0, it will forward the packet to a container with OpenVPN, etc. However, you must allow access to port 1883 only from the inside. Those. iptables. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The standard approach is to deny access to this port from anywhere, then follow the rule that allows access from internal networks.</font></font><br>
<br>
<pre><code class="plaintext hljs">iptables -I INPUT -p tcp -m tcp --dport 1883 -j DROP<font></font>
iptables -I INPUT -s 172.17.0.0/24 -p tcp -m tcp --dport 1883 -j ACCEPT</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The grid is indicated here 172.17.0.0, because from OpenVPN to the ‚Äúneighbors‚Äù I end up going as hide NAT (which is an iobroker container that rfBridge is from a WiFi network), and not from the original ones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And so it works. </font><font style="vertical-align: inherit;">But there is a nuance. </font><font style="vertical-align: inherit;">My port 1883 is forwarded to the mqtt container. </font><font style="vertical-align: inherit;">And, as it turned out, iptables first fulfills the DOCKER-USER chain. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That is, with this rule, access to port 1883 was allowed _to_ the blocking rule. </font><font style="vertical-align: inherit;">And from the Internet, you could also easily connect to it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A blocking rule must be created in the DOCKER-USER chain!</font></font><br>
<br>
<pre><code class="plaintext hljs">iptables -I DOCKR-USER -p tcp -m tcp --dport 1883 -j DROP<font></font>
iptables -I INPUT -s 172.17.0.0/24 -p tcp -m tcp --dport 1883 -j ACCEPT</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But the lower one, allowing access from internal networks, for some reason requires INPUT.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Home server</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main part is the same. </font><font style="vertical-align: inherit;">However, although he was a client, he had to route traffic from a WiFi network (rfBridge) to mqtt on VPS. </font><font style="vertical-align: inherit;">Those. </font><font style="vertical-align: inherit;">traffic movement: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
rfBridge (192.168.6.8) -&gt; iobroker host (192.168.6.6) -&gt; vpn-client container (172.17.0.?) -&gt; opevpn container on VPS -&gt; loopback VPS (192.168.16.1) -&gt; mqtt container (port 1883) We </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
allow "forward" packets for the grid with clients and loopbacks:</font></font><br>
<br>
<pre><code class="plaintext hljs">iptables -A FORWARD -d 192.168.16.0/24 -j ACCEPT</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
and move on to container specifics.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Task 1</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As you remember, the interaction between the subsystems I have configured through loopback. </font><font style="vertical-align: inherit;">Those. </font><font style="vertical-align: inherit;">it is necessary that packets on 192.168.16.6 from vpn-client go to the host (172.17.0.1), and not to the VPN tunnel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you run this command in a running container, everything will work. </font><font style="vertical-align: inherit;">After the reboot, this will be forgotten, but you can specify in the iobroker.ovpn configuration file </font></font><br>
<code>route 192.168.16.6 255.255.255.255 172.17.0.1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And openvpn will install this route when the container starts. </font><font style="vertical-align: inherit;">This is solved easily in a standard way.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Task 2</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Packets from the home network 192.168.6.0 (for example, from rfBridge) go to the iobroker host and are forwarded to the vpn-client container. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, I intentionally do not include the 192.168.6.0 network in the encryption domain, the OpenVPN container on the VPS does not know what to do with this network. The obvious solution is to make NAT inside vpn-client so that the packet on the VPS comes from its address. But there is a nuance. How to save the required iptables commands after restarting the container? Iptables-persistent isn‚Äôt so easy to put there. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can, of course, assemble a new container with additives. But I do not want to, because the upgrade procedure will become more complicated. Instead of ‚Äúkilled and launched latest, and he pulled up the configuration from the mounted folder‚Äù, it will be necessary to start the assembly ... Not for that I am communicating with containers.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, I decided "after the start of the container, forcibly execute commands in it that tell iptables to do NAT." </font><font style="vertical-align: inherit;">I used the team for this </font></font><br>
<code>docker events --filter "container=vpn-client" --filter "event=start"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
She hangs and waits for the event specified in the filters. </font><font style="vertical-align: inherit;">In my case, start the container. </font><font style="vertical-align: inherit;">After that, through docker exec, I execute the required commands from the host in it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To do this, by analogy with VPS, I configure </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/local/bin/my_last_command.sh</font></font></i><br>
<br>
<pre><code class="plaintext hljs">#!/bin/bash<font></font>
cont="vpn-client"<font></font>
ipaddr=$(docker inspect -f '{{.NetworkSettings.IPAddress}}' $cont)<font></font>
route add -net 192.168.16.0/24 gw $ipaddr<font></font>
for (( ; ; ))<font></font>
do<font></font>
  docker events --filter "container=$cont" --filter "event=start"<font></font>
  docker exec -it $cont iptables -t nat -I POSTROUTING -s 192.168.16.0/255.255.255.0 -j MASQUERADE<font></font>
  docker exec -it $cont iptables -t nat -I POSTROUTING -s 192.168.6.0/255.255.255.0 -j MASQUERADE<font></font>
done<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are examples in which the output of docker events is passed to the awk input, which executes the commands. </font><font style="vertical-align: inherit;">But it seemed easier to me to ‚Äúhang‚Äù before the event, execute commands, and again wait for the event.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Honestly, I did not want to write this post. I gained an interesting experience, but it turned out ‚Äúnot beautiful‚Äù, it‚Äôs too difficult, I don‚Äôt like it so much. So again I redid everything, refused VPS in general. But since I promised the second part ... In addition, I was impressed by the approach with docker events, I wanted to share it. I think it will come in handy. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the end, I decided so. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since I was not able to publish vis through the reverse proxy, and I can easily take mqtt from the outside as a service, I do not need VPS for this task. I can upload firmware for OTA updates to hosting, too, there is a benefit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mqtt took on wqtt.ru. </font><font style="vertical-align: inherit;">TLS is (passwords are sent in a secure form). </font><font style="vertical-align: inherit;">The speed is excellent (10ms versus 80ms for mymqtthub). </font><font style="vertical-align: inherit;">Topics to rewrite to '$ device / &lt;crazy ID&gt; / events' (like Yandex) is not required. </font><font style="vertical-align: inherit;">Those. </font><font style="vertical-align: inherit;">in which case you can jump somewhere easily. </font><font style="vertical-align: inherit;">The price is cheap (300 rubles per year). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I post the firmware for OTA on the existing one for hosting. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Access to vis is still through Zerotier. </font><font style="vertical-align: inherit;">It is very simple and convenient. </font><font style="vertical-align: inherit;">And even if they are broken, it is unlikely to see the CO2 level in my house for the sake of. </font><font style="vertical-align: inherit;">And even if this happens, it will soon become famous than if they break me personally. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything is beautiful, it works without failures, it is easy to make changes if necessary, there are no unnecessary servers that need maintenance, I am satisfied.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en505394/index.html">Antiquities: Nokia E90, the latest communicator</a></li>
<li><a href="../en505398/index.html">The dark and light sides of work at Yandex</a></li>
<li><a href="../en505400/index.html">What should the models look like?</a></li>
<li><a href="../en505402/index.html">Superimposing a 2d texture on a 3d object using p5.js (part 2 - applying a pattern to a cube)</a></li>
<li><a href="../en505404/index.html">The easiest way to learn English with TED videos</a></li>
<li><a href="../en505416/index.html">MikroTik in repeater mode - just like One-Two-Three</a></li>
<li><a href="../en505418/index.html">[Question] Have you seen people who use mobile content subscriptions?</a></li>
<li><a href="../es486176/index.html">Memo de correspondencia de correo electr√≥nico corporativo</a></li>
<li><a href="../es486178/index.html">FOSS News No. 1 - revisi√≥n de noticias gratuitas y de c√≥digo abierto del 27 de enero al 2 de febrero de 2020</a></li>
<li><a href="../es486180/index.html">Consejos y fuentes para crear aplicaciones sin servidor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>