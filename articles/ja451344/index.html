<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍✈️ 👅 🏇🏾 オプティマイザーで非表示にしてシークします。ゲームオーバー、これはCTE PostgreSQL 12です 🚢 🧖 🖨️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="この記事はPostgreSQL 12の新機能の続きです。SQL/ JSON（JSONPathパッチ）については、記事「機能凍結2019でフリーズしたもの。パートI. JSONPath」ですでに分析しました。CTEの番です。
 
 Cte
 CTEは共通テーブル式-共通テーブル式であり、WITHを使用...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>オプティマイザーで非表示にしてシークします。ゲームオーバー、これはCTE PostgreSQL 12です</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/postgrespro/blog/451344/"><img src="https://habrastorage.org/webt/lx/r3/ps/lxr3psy9oebq4i01moowesbn_mq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事はPostgreSQL 12の新機能の続きです。SQL/ JSON（JSONPathパッチ）については、記事</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「機能凍結2019でフリーズしたもの。パートI. JSONPath」</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">すでに分析</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">しました。CTE</font></a><font style="vertical-align: inherit;">の番です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cte</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CTEは共通テーブル式-共通テーブル式であり、WITHを使用した構成とも呼ばれます。実際、これは一時テーブルの作成ですが、セッションではなく1つのクエリに対してのみ存在します。このリクエスト内でアクセスできます。このようなリクエストはよく読まれ、理解でき、必要に応じて簡単に変更できます。これは非常に人気のあるもので、長い間PostgreSQLに存在しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、アメニティは高価になる可能性があります。問題は、WITH ... AS（）構文内のASの後の式の具体化に関連しています。これは内部式とも呼ばれ、残りの計算を開始する前に計算されます。最上位のクエリに埋め込むことはできません（インライン化なし）。この式の計画では、残りのクエリは考慮されません。この動作は、最適化の障壁またはフェンシングと呼ばれます。さらに、具体化自体にはwork_memが必要です。そして、サンプルが大きい場合、問題が始まります（たとえば、</font><font style="vertical-align: inherit;">PGConf 2019でのIvan Frolkov </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">によるレポート</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">があり</font><font style="vertical-align: inherit;">ます）。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下で説明するオプティマイザで非表示にしてシークすることは、一般的なバグではなく、機能です。</font><font style="vertical-align: inherit;">もちろん、式の一部を事前に計算することで、たとえば再帰クエリで不要な繰り返し操作を排除できる場合があります。</font><font style="vertical-align: inherit;">一方、多くの開発者はバリアを考慮せずにビューとしてCTEを使用しました。その結果、CTEからのリクエストは、サブクエリを使用する同等の（より高度な）リクエストよりも実行速度が遅いだけでなく、桁違いに低速でした。</font><font style="vertical-align: inherit;">コミュニティは長所と短所を比較検討した後、決定的な一歩を踏み出しました。デフォルトの動作を変更しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのようなプレートでのCTEの作業を観察します。</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> xytable <span class="hljs-keyword">AS</span> <span class="hljs-keyword">SELECT</span> x, x <span class="hljs-keyword">AS</span> y <span class="hljs-keyword">FROM</span> generate_series(<span class="hljs-number">1</span>,<span class="hljs-number">10000000</span>) <span class="hljs-keyword">AS</span> x;
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> <span class="hljs-keyword">ON</span> xytable(x,y);</code></pre><br>
<pre><code class="plaintext hljs">Table "public.xytable"<font></font>
    Column    |  Type   |     Collation    |    Nullable    | Default<font></font>
--------------+---------+------------------+----------------+---------<font></font>
x             | integer |                  |                |<font></font>
y             | integer |                  |                |<font></font>
<font></font>
Indexes:<font></font>
"xytable_x_y_idx" btree (x, y)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
簡単なリクエストから始めましょう：</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> xytable <span class="hljs-keyword">WHERE</span> x=<span class="hljs-number">2</span> <span class="hljs-keyword">AND</span> y&gt;<span class="hljs-number">1</span>;<font></font>
                                                          QUERY PLAN                                                          <font></font>
<span class="hljs-comment">-----------------------------------------------------------------------------</span><font></font>
 Index Only Scan using xytable_x_y_idx on xytable  (cost=0.43..8.46 rows=1 width=8) (actual time=0.016..0.017 rows=1 loops=1)<font></font>
      Index Cond: ((x = 2) AND (y &gt; 1))<font></font>
      Heap Fetches: 1<font></font>
 Planning Time: 0.075 ms<font></font>
 Execution Time: 0.035 ms<font></font>
(5 rows)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが即座に考慮され、インデックスのみが使用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じように計算するサブクエリを使用したクエリですが、構文はもう少し複雑です。</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span>
    (<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> xytable <span class="hljs-keyword">WHERE</span> y&gt;<span class="hljs-number">1</span>) <span class="hljs-keyword">AS</span> t <span class="hljs-keyword">WHERE</span> x=<span class="hljs-number">2</span>;<font></font>
                                                          QUERY PLAN                                                          <font></font>
<span class="hljs-comment">---------------------------------------------------------------------------------</span><font></font>
 Index Only Scan using xytable_x_y_idx on xytable  (cost=0.43..8.46 rows=1 width=8) (actual time=0.016..0.016 rows=1 loops=1)<font></font>
   Index Cond: ((x = 2) AND (y &gt; 1))<font></font>
   Heap Fetches: 1<font></font>
 Planning Time: 0.062 ms<font></font>
 Execution Time: 0.029 ms<font></font>
(5 rows)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが順調で、非常に高速なインデックス計算。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、論理的に同等なもう1つの要求ですが、CTEを使用します。</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> yy <span class="hljs-keyword">AS</span> (
     <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> xytable <span class="hljs-keyword">WHERE</span> y&gt;<span class="hljs-number">1</span>)
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> yy <span class="hljs-keyword">WHERE</span> x=<span class="hljs-number">2</span>;<font></font>
QUERY PLAN<font></font>
<span class="hljs-comment">------------------------------------------</span><font></font>
CTE Scan on yy (actual time=0.099..3672.842 rows=1 loops=1)<font></font>
   Filter: (x = 2)<font></font>
   Rows Removed by Filter: 9999998<font></font>
   CTE yy<font></font>
      -&gt; Seq Scan on cte (actual time=0.097..1355.367 rows=9999999 loops=1)<font></font>
          Filter: (y &gt; 1)<font></font>
          Rows Removed by Filter: 1<font></font>
 Planning Time: 0.088 ms<font></font>
 Execution Time: 3735.986 ms<font></font>
(9 rows)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような遅れはすでに肉眼で確認できます。</font><font style="vertical-align: inherit;">コーヒーは飲みませんが、郵便物を調べる十分な時間があります（11番目のバージョン以前の場合）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、これが起こったことです。サブクエリの場合、オプティマイザは、条件x = 2およびy&gt; 1を1つのフィルタに結合し、インデックスで検索できることをすぐに認識しました。</font><font style="vertical-align: inherit;">CTEの場合、オプティマイザは選択の余地がありません。最初にWITH ... AS構造内の条件を処理し、結果を具体化して、次に作業する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで重要なのは、マテリアライズにリソースが必要ということではありません。条件がy &lt;3の場合、数百万のレコードをマテリアライズする必要はありませんが、2つだけです。単純なクエリの膨大な時間がシーケンシャル検索に費やされ、オプティマイザはインデックス検索を使用できません。そのため、複合インデックスはxで構築され、その後yでのみ構築されます。彼は内部でCTE条件を満たすまで、条件x = 2のクエリについて何も知りません。それは障壁を超えています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、PostgreSQL 12以前は、デフォルトが実体化でしたが、現在は存在しません。新しいバージョンに基づいて同じリクエストを起動します。バリアがなくなり、オプティマイザはリクエスト全体を即座に確認します。</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> yy <span class="hljs-keyword">AS</span> (
     <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> xytable <span class="hljs-keyword">WHERE</span> y&gt;<span class="hljs-number">1</span>)
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> yy
<span class="hljs-keyword">WHERE</span> x=<span class="hljs-number">2</span>;</code></pre><br>
<pre><code class="plaintext hljs">QUERY PLAN<font></font>
------------------------------------------<font></font>
Index Only Scan using xytable_x_y_idx1 on xytable  (cost=0.43..8.46 rows=1 width=8) (actual time=0.015..0.016 rows=1 loops=1)<font></font>
       Index Cond: ((x = 2) AND (y &gt; 1))<font></font>
       Heap Fetches: 1<font></font>
 Planning Time: 0.067 ms<font></font>
 Execution Time: 0.029 ms<font></font>
(5 rows)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オプティマイザは、サブクエリの場合と同様に、条件を最適な順序で組み合わせることを即座に学習しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、デフォルトはデフォルトであり、現在の状況を完全に所有するために、バージョン12ではCTEの制御された制御された実体化があります。</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> cte_name
<span class="hljs-keyword">AS</span> [<span class="hljs-keyword">NOT</span>] <span class="hljs-keyword">MATERIALIZED</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実現しましょう：</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">EXPLAIN</span> <span class="hljs-keyword">ANALYZE</span>  <span class="hljs-keyword">WITH</span> yy <span class="hljs-keyword">AS</span> <span class="hljs-keyword">MATERIALIZED</span> (
     <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> xytable <span class="hljs-keyword">WHERE</span> y&gt;<span class="hljs-number">1</span>)
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> yy <span class="hljs-keyword">WHERE</span> x=<span class="hljs-number">2</span>;</code></pre><br>
<pre><code class="plaintext hljs">QUERY PLAN<font></font>
---------------------------<font></font>
 CTE Scan on yy  (cost=356423.68..581401.19 rows=49995 width=8) (actual time=661.038..3603.292 rows=1 loops=1)<font></font>
   Filter: (x = 2)<font></font>
   Rows Removed by Filter: 9999998<font></font>
   CTE yy<font></font>
     -&gt;  Bitmap Heap Scan on cte  (cost=187188.18..356423.68 rows=9999000 width=8) (actual time=661.032..2102.040 rows=9999999 loops=1)<font></font>
           Recheck Cond: (y &gt; 1)<font></font>
           Heap Blocks: exact=44248<font></font>
           -&gt;  Bitmap Index Scan on xytable_x_y_idx1  (cost=0.00..184688.43 rows=9999000 width=0) (actual time=655.519..655.519 rows=9999999 loops=1)<font></font>
                 Index Cond: (y &gt; 1)<font></font>
 Planning Time: 0.086 ms<font></font>
 Execution Time: 3612.840 ms<font></font>
(11 rows)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが11のようで、その前に、クエリ結果のスタンバイモードでメールを見ることができます。</font><font style="vertical-align: inherit;">私たちは具体化を禁止し、障壁を取り除きます：</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">EXPLAIN</span> <span class="hljs-keyword">ANALYZE</span>  <span class="hljs-keyword">WITH</span> yy <span class="hljs-keyword">AS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">MATERIALIZED</span> (
     <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> xytable <span class="hljs-keyword">WHERE</span> y&gt;<span class="hljs-number">1</span>)
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> yy <span class="hljs-keyword">WHERE</span> x=<span class="hljs-number">2</span>;<font></font>
QUERY PLAN<font></font>
<span class="hljs-comment">---------------------------</span><font></font>
 Index Only Scan using xytable_x_y_idx1 on xytable  (cost=0.43..8.46 rows=1 width=8) (actual time=0.070..0.072 rows=1 loops=1)<font></font>
   Index Cond: ((x = 2) AND (y &gt; 1))<font></font>
   Heap Fetches: 1<font></font>
 Planning Time: 0.182 ms<font></font>
 Execution Time: 0.108 ms<font></font>
(5 rows)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
繰り返しになりますが、一時停止はありません。即座にカウントされます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残りのニュアンス。</font><font style="vertical-align: inherit;">しかし重要なニュアンス。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CTEは、複数回アクセスされると、デフォルトで実体化します。</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一見すると、そのような場合の具体化は合理的な決定です。なぜ同じものを2回計算するのですか。</font><font style="vertical-align: inherit;">実際には、これはしばしば私たちが上で観察したことにつながります。</font><font style="vertical-align: inherit;">マテリアライズの拒否を強制するには、オプティマイザを明示的に注文する必要があります：NOT MATERIALIZED。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NOT MATERIALIZEDリクエストなしでダブルWHEREを実行します。</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> yy <span class="hljs-keyword">AS</span> ( 
     <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> xytable <span class="hljs-keyword">WHERE</span> y &gt; <span class="hljs-number">1</span>)
<span class="hljs-keyword">SELECT</span> (
     <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">FROM</span> yy <span class="hljs-keyword">WHERE</span> x=<span class="hljs-number">2</span>), (
     <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">FROM</span> yy <span class="hljs-keyword">WHERE</span> x=<span class="hljs-number">2</span>);</code></pre><br>
<pre><code class="plaintext hljs">QUERY PLAN<font></font>
---------------------------------------------------------------------------<font></font>
Result (actual time=3922.274..3922.275 rows=1 loops=1)<font></font>
   CTE yy<font></font>
      -&gt; Seq Scan on xytable (actual time=0.023..1295.262 rows=9999999 loops=1)<font></font>
          Filter: (y &gt; 1)<font></font>
          Rows Removed by Filter: 1<font></font>
   InitPlan 2 (returns $1)<font></font>
      -&gt; Aggregate (actual time=3109.687..3109.687 rows=1 loops=1)<font></font>
          -&gt; CTE Scan on yy (actual time=0.027..3109.682 rows=1 loops=1)<font></font>
              Filter: (x = 2)<font></font>
              Rows Removed by Filter: 9999998<font></font>
   InitPlan 3 (returns $2)<font></font>
      -&gt; Aggregate (actual time=812.580..812.580 rows=1 loops=1)<font></font>
          -&gt; CTE Scan on yy yy_1 (actual time=0.016..812.575 rows=1 loops=1)<font></font>
               Filter: (x = 2)<font></font>
               Rows Removed by Filter: 9999998<font></font>
   Planning Time: 0.136 ms<font></font>
   Execution Time: 3939.848 ms<font></font>
(17 rows)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして今、具体化の禁止を明示的に書きます：</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> yy <span class="hljs-keyword">AS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">MATERIALIZED</span> (
     <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> xytable <span class="hljs-keyword">WHERE</span> y &gt; <span class="hljs-number">1</span>)
<span class="hljs-keyword">SELECT</span> (
     <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">FROM</span> yy <span class="hljs-keyword">WHERE</span> x=<span class="hljs-number">2</span>), (
     <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">FROM</span> yy <span class="hljs-keyword">WHERE</span> x=<span class="hljs-number">2</span>);</code></pre><br>
<pre><code class="plaintext hljs">QUERY PLAN<font></font>
---------------------------------------------------------------------------<font></font>
Result (actual time=0.035..0.035 rows=1 loops=1)<font></font>
   InitPlan 1 (returns $0)<font></font>
     -&gt; Aggregate (actual time=0.024..0.024 rows=1 loops=1)<font></font>
         -&gt; Index Only Scan using xytable_x_y_idx on xytable (actual time=0.019..0.020 rows=1 loops=1)<font></font>
             Index Cond: ((x = 2) AND (y &gt; 1))<font></font>
             Heap Fetches: 1<font></font>
   InitPlan 2 (returns $1)<font></font>
     -&gt; Aggregate (actual time=0.006..0.006 rows=1 loops=1)<font></font>
        -&gt; Index Only Scan using xytable_x_y_idx on xytable cte_1 (actual time=0.004..0.005 rows=1 loops=1)<font></font>
            Index Cond: ((x = 2) AND (y &gt; 1))<font></font>
            Heap Fetches: 1<font></font>
   Planning Time: 0.253 ms<font></font>
   Execution Time: 0.075 ms<font></font>
(13 rows)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CTEの書き込みは常に実行され、参照されないCTEは決して実行されません。</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは計画から見ることができます：not_executedはその中にありません。</font><font style="vertical-align: inherit;">これは以前のバージョンにも当てはまりますが、覚えておく必要があります。（NOT）MATERIALIZED構文は、バージョン12の実行可能式に適用されます。</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">EXPLAIN</span> (COSTS <span class="hljs-keyword">OFF</span>) <span class="hljs-keyword">WITH</span> yy <span class="hljs-keyword">AS</span> (
     <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> xytable <span class="hljs-keyword">WHERE</span> y &gt; <span class="hljs-number">1</span>),<font></font>
not_executed <span class="hljs-keyword">AS</span> (
     <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> xytable),<font></font>
always_executed <span class="hljs-keyword">AS</span> (
     <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> xytable <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">RETURNING</span> *)
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">FROM</span> yy <span class="hljs-keyword">WHERE</span> x=<span class="hljs-number">2</span>;</code></pre><br>
<pre><code class="plaintext hljs">QUERY PLAN<font></font>
-----------------------------<font></font>
CTE Scan on yy<font></font>
   Filter: (x = 2)<font></font>
   CTE yy<font></font>
      -&gt; Seq Scan on cte<font></font>
            Filter: (y &gt; 1)<font></font>
   CTE always_executed<font></font>
      -&gt; Insert on cte cte_1<font></font>
            -&gt; Result<font></font>
(5 rows)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてもう一つのルール：</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WITHを使用した再帰クエリは常にマテリアライズされます。</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは常にあり、デフォルトではありません。</font><font style="vertical-align: inherit;">オプティマイザを注文した場合：NOT MATERIALIZED、エラーは発生せず、マテリアライズは引き続き行われます。</font><font style="vertical-align: inherit;">これはコミュニティを意識した決定です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
宿題の実例を検討します。</font><font style="vertical-align: inherit;">それが今日のすべてです。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CTEの新機能を取り上げたレビューのこの部分では、Oleg Bartunovが</font><font style="vertical-align: inherit;">今年4月9日にサンクトペテルブルクで</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開催さ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">れた</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Saint Highload ++</font></a><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">読んだレポート「Postgres 12 in Etudes」の例とフラグメントを使用し</font><font style="vertical-align: inherit;">ます。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のエピソードは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KNN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja451326/index.html">3CX V16 Update 1 Beta-プログラムで通話を管理するための新しいチャットおよび通話フローサービス機能</a></li>
<li><a href="../ja451330/index.html">何が放送されているのですか？パート3、ハムラジオ/ハムラジオ</a></li>
<li><a href="../ja451332/index.html">C型肝炎：「愛情深いキラー」</a></li>
<li><a href="../ja451338/index.html">人気のあるLinuxディストリビューションの開発者は、上場IPOを行い、クラウドソリューションを扱う予定です。</a></li>
<li><a href="../ja451340/index.html">GitHub Package Registryが提供</a></li>
<li><a href="../ja451346/index.html">NeoBook：プログラマーでない人のためのプログラミング環境</a></li>
<li><a href="../ja451354/index.html">何が重要で何が緊急ですか？</a></li>
<li><a href="../ja451356/index.html">オブジェクト指向メモリアーキテクチャでの圧縮の仕組み</a></li>
<li><a href="../ja451358/index.html">Scalaの暗黙的なパラメーターと変換</a></li>
<li><a href="../ja451360/index.html">隠されたSMSの脅威：モバイルオペレーターが知りすぎている</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>