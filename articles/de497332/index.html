<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüè´ üë©üèº‚Äçüîß üå¨Ô∏è Houston, wir haben ein Problem. Systemdesignfehler üèæ üâë üïó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1970 starteten amerikanische Ingenieure das Raumschiff Apollo 13 zum Mond. An Bord befinden sich drei Batterien mit Brennstoffzellen, es gibt keinen G...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Houston, wir haben ein Problem. Systemdesignfehler</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/497332/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1970 starteten amerikanische Ingenieure das Raumschiff Apollo 13 zum Mond. An Bord befinden sich drei Batterien mit Brennstoffzellen, es gibt keinen Grund zur Sorge, alles wird zuverl√§ssig und wiederholt dupliziert. Aber niemand h√§tte sich vorstellen k√∂nnen, dass die Explosion einer Sauerstoffflasche zwei der drei Batterien deaktivieren w√ºrde. Trag√∂die! Die Astronauten kehrten nach Hause zur√ºck, es wurde ein Spielfilm √ºber das Ereignis mit Tom Hanks gedreht und der Satz des Astronauten Jack Swigert: ‚ÄûHouston, wir haben ein Problem!‚Äú, Ging in die Geschichte ein. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/iu/oj/oi/iuojoilj6ikne43fxjqm5q6bjm4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Geschichte von Apollo 13 ist ein weiterer Beweis f√ºr die bekannte Tatsache, dass Sie sich nicht auf alle m√∂glichen Probleme vorbereiten k√∂nnen. Dies ist eine nat√ºrliche Eigenschaft der Welt: Eisen bricht regelm√§√üig, Code st√ºrzt ab und Menschen machen Fehler. Es ist unm√∂glich, dies vollst√§ndig zu beseitigen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei gro√üen verteilten Systemen ist dieses Verhalten normal und eine Folge von Skaleneffekten und Statistiken. </font><font style="vertical-align: inherit;">Aus diesem Grund ist Design for Failure (AWS) das grundlegende Entwurfsprinzip f√ºr AWS Cloud Services. </font><font style="vertical-align: inherit;">Die Systeme sind zun√§chst so aufgebaut, dass der Vollzeitbetrieb so schnell wie m√∂glich wiederhergestellt und Sch√§den durch bekannte und noch unbekannte Fehler minimiert werden. </font><font style="vertical-align: inherit;">Bei </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HighLoad ++ zeigte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vasily Pantyukhin am Beispiel realer Probleme mit Kampfdiensten Entwurfsmuster f√ºr verteilte Systeme, die von AWS-Entwicklern verwendet werden.</font></font><br>
<a name="habracut"></a><br>
 <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vasily Pantyukhin</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Henne</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) Ist der Architekt von Amazon Web Services in Europa, dem Nahen Osten und Afrika. Er begann als Unix-Administrator, arbeitete 6 Jahre bei Sun Microsystem, unterrichtete technische Kurse und 11 Jahre unterrichtete er die weltweite Datenzentrierung bei EMC. In einem internationalen Team entwarf und realisierte er Projekte von Kapstadt bis Oslo. Jetzt hilft es gro√üen und kleinen Unternehmen, in √∂ffentlichen Clouds zu arbeiten.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/RxWVxr4uUpI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1949 wurde ein Flugzeugunfall auf einem Luftwaffenst√ºtzpunkt in Kalifornien untersucht. </font><font style="vertical-align: inherit;">Einer der Ingenieure, die dies taten, war Edward Murphy. </font><font style="vertical-align: inherit;">Er beschrieb die Arbeit lokaler Techniker wie folgt: ‚ÄûWenn es zwei M√∂glichkeiten gibt, etwas zu tun, und eine davon zu einer Katastrophe f√ºhrt, wird jemand diese Methode w√§hlen.‚Äú </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dank Arthur Bloch ging die Aussage sp√§ter als eines von Murphys Gesetzen in die Geschichte ein. </font><font style="vertical-align: inherit;">Auf Russisch - das Gesetz der Gemeinheit. </font><font style="vertical-align: inherit;">Sein Kern ist, dass es nicht m√∂glich sein wird, Zusammenbr√ºche und menschliche Fehler zu vermeiden, und irgendwie damit leben muss. </font><font style="vertical-align: inherit;">Deshalb setzen wir beim Entwerfen sofort Fehler und Ausf√§lle einzelner Komponenten in unsere Systeme ein.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fehlerdesign</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim Design for Failure versuchen wir drei Eigenschaften zu verbessern:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zug√§nglichkeit (dieselben "Neunen");</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zuverl√§ssigkeit - die Eigenschaft des Systems, das erforderliche Serviceniveau bereitzustellen;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fehlertoleranz - eine Eigenschaft des Systems, um das Auftreten von Problemen zu verhindern und diese schnell zu beheben.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuverl√§ssigkeit hat die Eigenschaft ‚Äû </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bekannter</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Unbekannter‚Äú. </font><font style="vertical-align: inherit;">Wir sch√ºtzen uns vor bekannten Problemen, wissen aber nicht, wann sie auftreten werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Äû </font></font><em><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bekannt Unbekannte‚Äú</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> werden </font><font style="vertical-align: inherit;">hinzugef√ºgt Toleranz zu bem√§ngeln </font><font style="vertical-align: inherit;">- diese √úberraschung Probleme sind , </font><font style="vertical-align: inherit;">dass wir nichts wissen. </font><font style="vertical-align: inherit;">Viele dieser Probleme in der Cloud h√§ngen mit Skaleneffekten zusammen: Das System w√§chst auf die Gr√∂√üe, wenn neue, erstaunliche und unerwartete Effekte auftreten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Ausfall ist normalerweise kein bin√§res Ph√§nomen. </font><font style="vertical-align: inherit;">Seine Haupteigenschaft ist der </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Explosionsradius"</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder der Grad der Verschlechterung des Dienstes, der Radius der Zerst√∂rung. </font><font style="vertical-align: inherit;">Unsere Aufgabe ist es, den "Explosionsradius" von Systemen zu reduzieren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir erkennen, dass Probleme nicht vermieden werden k√∂nnen, m√ºssen wir uns proaktiv darauf vorbereiten. </font><font style="vertical-align: inherit;">Dies bedeutet, dass wir Services so gestalten, dass wir im Falle von Problemen (dies wird sicherlich der Fall sein) Probleme kontrollieren und nicht umgekehrt.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn wir auf ein Problem reagieren, kontrolliert es uns.</font></font></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datenebene und Steuerebene</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sicherlich haben Sie zu Hause eine Elektronik, die √ºber eine Fernbedienung wie einen Fernseher gesteuert wird. </font><font style="vertical-align: inherit;">Der Fernsehbildschirm ist Teil der Datenebene, die die Funktion direkt ausf√ºhrt. </font><font style="vertical-align: inherit;">Die Fernbedienung ist die Benutzeroberfl√§che - Steuerebene. </font><font style="vertical-align: inherit;">Es wird zum Verwalten und Konfigurieren des Dienstes verwendet. </font><font style="vertical-align: inherit;">In der Cloud versuchen wir, die Datenebene und die Steuerebene zum Testen und Entwickeln zu trennen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Benutzer sehen die Komplexit√§t der Steuerebene meistens nicht. </font><font style="vertical-align: inherit;">Fehler in Design und Implementierung sind jedoch die h√§ufigsten Ursachen f√ºr Massenversagen. </font><font style="vertical-align: inherit;">Deshalb konzentriert sich mein Rat auf die Kontrollebene - manchmal explizit, manchmal nicht.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Geschichte eines Problems</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Juli 2012 kam es in Nord-Virginia zu einem schweren Sturm. Das Rechenzentrum verf√ºgt √ºber Schutz, Dieselgeneratoren und mehr. In einem der Rechenzentren einer der Verf√ºgbarkeitszonen (Availability Zone, AZ) der Region North Virginia ging jedoch Strom aus. Die Stromversorgung wurde schnell wiederhergestellt, aber die Wiederherstellung der Dienste zog sich stundenlang hin. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ig/ev/yd/igevydk5zuise0toukfgy9gdxsw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde Ihnen am Beispiel eines der Basisdienste - CLB (Classic Load Balancer) - die Gr√ºnde erl√§utern. Es funktioniert einfach: Wenn Sie in jeder Verf√ºgbarkeitszone einen neuen Balancer starten, werden separate Instanzen erstellt, deren IP den DNS aufl√∂st. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gw/al/l0/gwall0xgawp614yocrkqtoz87dk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn eine der Instanzen fehlschl√§gt, wird eine entsprechende Nachricht an eine spezielle Datenbank gesendet. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sk/ts/bj/sktsbjffpcebdnovro-u6dyr0pu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Reaktion darauf beginnen die Prozeduren: L√∂schen von Eintr√§gen aus DNS, Starten einer neuen Instanz und Hinzuf√ºgen einer neuen IP zu DNS.</font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hinweis: So hat das System in der Vergangenheit funktioniert, jetzt ist alles grundlegend anders.</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Alles ist einfach - es gibt nichts zu brechen. W√§hrend eines Massenfehlers, wenn Tausende von Instanzen gleichzeitig zusammenbrechen, wird </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in der Datenbank</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ein </font><strong><font style="vertical-align: inherit;">riesiger R√ºckstand</font></strong><font style="vertical-align: inherit;"> von Nachrichten zur Verarbeitung </font><strong><font style="vertical-align: inherit;">angezeigt</font></strong><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r2/--/nw/r2--nw4kqcrocoysqgptvysranu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber es wurde schlimmer. Die Steuerebene ist ein verteiltes System. Aufgrund eines Fehlers haben wir Duplikate erhalten und Tausende von Datens√§tzen in der Datenbank sind auf Hunderttausende angewachsen. Es wurde sehr schwierig, damit zu arbeiten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn in einer der Instanzen ein Fehler auftritt, wird der gesamte Datenverkehr fast sofort auf die √ºberlebenden Maschinen umgeschaltet, und die </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Last verdoppelt sich</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (im Beispiel gibt es der Einfachheit halber nur zwei Zugriffszonen). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uz/jl/ox/uzjloxrf6wvv5hrju2-votyb-o4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es sind nicht gen√ºgend Ressourcen vorhanden. Eine Live-Instanz wird automatisch </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">skaliert</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Der Vorgang dauert relativ lange. Alles geschieht zu Spitzenzeiten und gleichzeitig mit einer gro√üen Anzahl von Instanzen - die freien Ressourcen der Verf√ºgbarkeitszone gehen zur Neige. Der "Kampf" um Ressourcen beginnt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Nord-Virginia konnte die Automatisierung den massiven Fehler nicht bew√§ltigen, und die Ingenieure stellten die Dienste manuell (mithilfe von Skripten) wieder her. Solche Probleme sind selten. W√§hrend der Nachbesprechung stellten sich Fragen zu den Ursachen des Fehlers, sie entschieden, dass die Situation nicht mehr wiederholt und der gesamte Service ge√§ndert werden sollte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die acht Muster, die ich behandeln werde, sind Antworten auf einige der Fragen. </font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hinweis. Dies ist unsere Erfahrung im Service-Design, keine universelle Weisheit f√ºr den weit verbreiteten Einsatz. Muster werden in bestimmten Situationen verwendet.</font></font></em><br>
<br>
<em>      ‚Äî  .   AWS           .    ‚Äî ,  .    .     ‚Äî     .     !</em><br>
<br>
<h2>  </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Auswirkungen von Fehlern zu minimieren, gibt es viele Ans√§tze. Eine davon ist die Beantwortung der Frage: "Wie kann ich sicherstellen, dass Benutzer, die kein Problem kennen, w√§hrend eines Fehlers und w√§hrend der Wiederherstellung nichts dar√ºber wissen?" </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unser riesiges Backlog erh√§lt nicht nur Absturzmeldungen, sondern auch andere, zum Beispiel √ºber Skalierung oder dass jemand einen neuen Balancer startet. Solche Nachrichten m√ºssen voneinander isoliert und funktional gruppiert werden: Eine separate Gruppe von Wiederherstellungsnachrichten nach einem Fehler, die einen neuen Balancer separat starten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Angenommen, zehn Benutzer haben ein Problem bemerkt - einer der Knoten ihrer Balancer ist gefallen. Services arbeiten irgendwie an den verbleibenden Ressourcen, aber das Problem ist zu sp√ºren.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3c/wu/3a/3cwu3agcfwjtemyacuneqwtmrfm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben zehn frustrierte Benutzer. </font><font style="vertical-align: inherit;">Der elfte erscheint - er wei√ü nichts √ºber das Problem, sondern will einfach einen neuen Balancer. </font><font style="vertical-align: inherit;">Wenn er die Warteschlange zur Verarbeitung ablegen m√∂chte, wird er h√∂chstwahrscheinlich nicht warten. </font><font style="vertical-align: inherit;">W√§hrend andere Verarbeitungsvorg√§nge abgeschlossen sind, endet die Anforderungszeit. </font><font style="vertical-align: inherit;">Anstelle von zehn frustrierten Benutzern werden wir elf haben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dies zu verhindern, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">priorisieren</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wir </font><strong><font style="vertical-align: inherit;">einige Anforderungen</font></strong><font style="vertical-align: inherit;"> - wir stellen die Warteschlangen ganz oben, z. B. Anforderungen f√ºr neue Ressourcen. </font><font style="vertical-align: inherit;">Bei einem Massenausfall wirkt sich eine relativ geringe Anzahl solcher Anforderungen nicht auf die Wiederherstellungszeit der Ressourcen anderer Kunden aus. </font><font style="vertical-align: inherit;">W√§hrend des Wiederherstellungsprozesses werden wir jedoch die Anzahl der an dem Problem beteiligten Benutzer einschr√§nken.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vollzeitstelle</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Antwort auf Problemberichte ist der Start von Wiederherstellungsverfahren, insbesondere die Arbeit mit DNS. Massenausf√§lle sind enorme Spitzenlasten auf der Steuerebene. Das zweite Muster hilft der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Steuerebene,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in einer solchen Situation </font><b><font style="vertical-align: inherit;">stabiler und vorhersagbarer</font></b><font style="vertical-align: inherit;"> zu sein. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fg/dv/zm/fgdvzmrez2rrlgfsc4ztmxmkaxu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir verwenden einen Ansatz namens </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konstante Arbeit - Dauerarbeit</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ri/pa/ee/ripaeenvgoadihywoj90c7vvopa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beispielsweise kann DNS etwas intelligenter gestaltet werden: Es √ºberpr√ºft st√§ndig die Instanzen des Balancers, ob sie aktiv sind oder nicht. Das Ergebnis ist jedes Mal eine Bitmap: Die Instanz antwortet - 1, tot - 0. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DNS √ºberpr√ºft die Instanzen alle paar Sekunden, unabh√§ngig davon, ob das System nach einem Massenausfall wiederhergestellt wird oder normal funktioniert. Er macht den gleichen Job - keine Spitzen, alles ist vorhersehbar und stabil.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein weiteres vereinfachtes Beispiel: Wir m√∂chten die Konfiguration einer gro√üen Flotte √§ndern. </font><font style="vertical-align: inherit;">In unserer Terminologie ist eine </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flotte eine Gruppe virtueller Maschinen</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , die zusammen einige Arbeiten ausf√ºhren. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nb/wq/go/nbwqgolicpqizt1bkehgk4ney9c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir platzieren die Konfigurations√§nderungen im S3-Bucket und √ºbertragen diese Konfiguration beispielsweise alle 10 Sekunden auf unsere Flotte virtueller Maschinen. </font><font style="vertical-align: inherit;">Zwei wichtige Punkte.</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir machen das regelm√§√üig</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und brechen nie die Regel. </font><font style="vertical-align: inherit;">Wenn Sie ein Segment von 10 Sekunden w√§hlen, dr√ºcken Sie unabh√§ngig von der Situation nur auf diese Weise.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir geben immer die gesamte Konfiguration an</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , unabh√§ngig davon, ob sie sich ge√§ndert hat oder nicht. </font><font style="vertical-align: inherit;">Die Datenebene (virtuelle Maschinen) selbst entscheiden, was damit zu tun ist. </font><font style="vertical-align: inherit;">Wir schieben das Delta nicht. </font><font style="vertical-align: inherit;">Es kann bei massiven St√∂rungen oder Ver√§nderungen sehr gro√ü werden. </font><font style="vertical-align: inherit;">Dies kann m√∂glicherweise zu Instabilit√§t und Unvorhersehbarkeit f√ºhren.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir eine dauerhafte Arbeit verrichten, zahlen wir mehr daf√ºr. Beispielsweise fordern 100 virtuelle Maschinen jede Sekunde eine Konfiguration an. Es kostet ungef√§hr 1200 Dollar pro Jahr. Dieser Betrag ist wesentlich geringer als das Gehalt eines Programmierers, dem wir die Entwicklung einer Steuerebene mit einem klassischen Ansatz anvertrauen k√∂nnen - eine Reaktion auf einen Fehler und die Verteilung nur von Konfigurations√§nderungen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie die Konfiguration wie im Beispiel alle paar Sekunden √§ndern, ist dies langsam. In vielen F√§llen dauert eine Konfigurations√§nderung oder der Start von Diensten jedoch Minuten - einige Sekunden l√∂sen nichts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekunden sind wichtig f√ºr Dienste, bei denen sich die Konfiguration sofort √§ndern muss, z. B. beim √Ñndern der VPC-Einstellungen. Hier gilt "Dauerarbeit" nicht. Dies ist nur ein Muster, keine Regel. Wenn dies in Ihrem Fall nicht funktioniert, verwenden Sie es nicht.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vorl√§ufige Skalierung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In unserem Beispiel erh√§lt die zweite √ºberlebende Instanz beim Absturz der Balancer-Instanz die Verdoppelung der Last fast sofort und beginnt zu skalieren. </font><font style="vertical-align: inherit;">Bei einem massiven Ausfall verbraucht es eine gro√üe Menge an Ressourcen. </font><font style="vertical-align: inherit;">Das dritte Muster hilft, diesen Prozess zu steuern - </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">im Voraus</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zu </font><strong><font style="vertical-align: inherit;">skalieren</font></strong><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei zwei Verf√ºgbarkeitszonen skalieren wir, wenn weniger als 50% entsorgt werden. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ch/wy/n4/chwyn4ffipap4mcwshur7bikoj4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn alles im Voraus erledigt ist, sind die √ºberlebenden Instanzen des Balancers im Falle eines Fehlers bereit, doppelten Datenverkehr zu akzeptieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bisher haben wir nur mit hoher Auslastung skaliert, z. B. 80% und jetzt mit 45%. </font><font style="vertical-align: inherit;">Das System ist die meiste Zeit im Leerlauf und wird teurer. </font><font style="vertical-align: inherit;">Aber wir sind bereit, dies zu ertragen und das Muster aktiv zu nutzen, denn dies </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist eine Versicherung</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Sie m√ºssen f√ºr die Versicherung bezahlen, aber bei ernsthaften Problemen deckt der Gewinn alle Kosten. </font><font style="vertical-align: inherit;">Wenn Sie sich f√ºr das Muster entscheiden, berechnen Sie alle Risiken und den Preis im Voraus.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zellul√§re Architektur</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt zwei M√∂glichkeiten, Dienste zu erstellen und zu skalieren: </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">den Monolithen</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und die </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wabenstruktur</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (zellbasiert). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nc/y7/ab/ncy7abk8fzjvr8lsez7wwcjuc70.png"><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Monolith</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> entwickelt sich und w√§chst als ein einziger gro√üer Beh√§lter. </font><font style="vertical-align: inherit;">Wir f√ºgen Ressourcen hinzu, das System schwillt an, wir sto√üen an unterschiedliche Grenzen, lineare Eigenschaften werden nichtlinear und ges√§ttigt und der ‚ÄûExplosionsradius‚Äú des Systems - das gesamte System.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn der Monolith schlecht getestet wird, erh√∂ht sich die Wahrscheinlichkeit von √úberraschungen - ‚Äûunbekannten Unbekannten‚Äú. Ein gro√üer Monolith kann jedoch nicht vollst√§ndig getestet werden. Manchmal m√ºssen Sie daf√ºr eine separate Zugriffszone erstellen, z. B. f√ºr einen beliebten Dienst, der als Monolith innerhalb der Zugriffszone erstellt wird (dies sind viele Rechenzentren). Dies schafft nicht nur eine enorme Testlast, die der Gegenwart √§hnelt, sondern ist auch aus finanzieller Sicht unm√∂glich. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher verwenden wir in den meisten F√§llen eine </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zellulare Architektur</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - eine Konfiguration, bei der ein System aus Zellen fester Gr√∂√üe aufgebaut wird. Durch Hinzuf√ºgen von Zellen skalieren wir es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zellul√§re Architektur ist in der AWS-Cloud beliebt. Es hilft, St√∂rungen zu isolieren und </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">den Explosionsradius zu verringern.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zu einer oder mehreren Zellen. Wir k√∂nnen mittelgro√üe Zellen vollst√§ndig testen, was die Risiken erheblich reduziert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein √§hnlicher Ansatz wird im Schiffbau angewendet: Der Rumpf eines Schiffes oder Schiffes ist durch Trennw√§nde in Abteile unterteilt. Im Falle eines Lochs werden ein oder mehrere Abteile √ºberflutet, aber das Schiff sinkt nicht. Ja, es hat der Titanic nicht geholfen, aber wir sto√üen selten auf Eisbergprobleme. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde die Anwendung des Mesh-Ansatzes am Beispiel des Simple Shapes Service veranschaulichen. Dies ist kein AWS-Service, ich habe ihn mir selbst ausgedacht. Dies ist eine Reihe einfacher APIs zum Arbeiten mit einfachen geometrischen Formen. Sie k√∂nnen eine Instanz einer geometrischen Form erstellen, den Typ einer Form anhand ihrer ID anfordern oder alle Instanzen eines bestimmten Typs z√§hlen. Beispielsweise </font></font><code>put(triangle)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wird </font><font style="vertical-align: inherit;">bei einer Anforderung </font><font style="vertical-align: inherit;">ein "Dreieck" -Objekt mit einer ID erstellt.</font></font><code>getShape(id)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gibt den Typ "Dreieck", "Kreis" oder "Raute" zur√ºck. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7t/z6/dv/7tz6dv0w3f9laswjhuwtbpedggs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um einen Dienst tr√ºbe zu machen, muss er von verschiedenen Benutzern gleichzeitig verwendet werden. </font><font style="vertical-align: inherit;">Machen wir es mandantenf√§hig. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/64/hk/pq/64hkpq9niokkw8w-w9rsu7m-w04.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als n√§chstes m√ºssen Sie einen Weg finden, um die Figuren in Zellen zu unterteilen. </font><font style="vertical-align: inherit;">Es gibt verschiedene M√∂glichkeiten, einen Partitionsschl√ºssel auszuw√§hlen. </font><font style="vertical-align: inherit;">Die einfachste ist </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die geometrische Form</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : alle Rauten in der ersten Zelle, Kreise in der zweiten, Dreiecke in der dritten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Methode hat Vor- und Nachteile.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn es deutlich weniger Kreise als andere Figuren gibt, bleibt die entsprechende Zelle nicht ausgelastet (ungleichm√§√üige Verteilung).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einige API-Anforderungen sind einfach zu implementieren. </font><font style="vertical-align: inherit;">Wenn wir beispielsweise alle Objekte in der zweiten Zelle z√§hlen, ermitteln wir die Anzahl der Kreise im System.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Andere Abfragen sind komplizierter. </font><font style="vertical-align: inherit;">Um beispielsweise eine geometrische Form anhand der ID zu finden, m√ºssen Sie alle Zellen durchgehen.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die zweite M√∂glichkeit besteht darin, die </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID von Objekten nach Bereichen zu verwenden</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : die ersten tausend Objekte in der ersten Zelle, die zweiten in der zweiten. </font><font style="vertical-align: inherit;">Die Verteilung ist also gleichm√§√üiger, aber es gibt andere Schwierigkeiten. </font><font style="vertical-align: inherit;">Um beispielsweise alle Dreiecke zu z√§hlen, m√ºssen Sie die folgende Methode verwenden </font></font><code>scatter/gather</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Wir verteilen die Anforderungen in jede Zelle, z√§hlen die Dreiecke in sich selbst, sammeln dann die Antworten, fassen zusammen und erstellen das Ergebnis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der dritte Weg - </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mieterdivision</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(zu Benutzern). Hier stehen wir vor einem klassischen Problem. In der Cloud gibt es normalerweise viele ‚Äûkleine‚Äú Benutzer, die etwas ausprobieren und den Dienst praktisch nicht laden. Es gibt Mastodon-Benutzer. Es gibt nur wenige, aber sie verbrauchen eine Menge Ressourcen. Solche Benutzer passen niemals in eine Zelle. Sie m√ºssen sich knifflige Wege einfallen lassen, um sie auf viele Zellen zu verteilen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wp/1i/3c/wp1i3c0ac5bjnvnxividrzrq6fk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt keinen idealen Weg, jeder Service ist individuell. Die gute Nachricht ist, dass hier weltliche Weisheit funktioniert - Brennholz zu hacken ist entlang der Fasern bequemer, als sie zu hacken. In vielen Diensten sind diese ‚ÄûFasern‚Äú mehr oder weniger offensichtlich. Dann k√∂nnen Sie experimentieren und den optimalen Partitionsschl√ºssel finden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zellen sind miteinander verbunden (wenn auch schwach). Daher muss eine Verbindungsebene vorhanden sein. Oft wird es als Routing- oder Mapping-Schicht bezeichnet. Es ist erforderlich zu verstehen, an welche Zellen bestimmte Anforderungen gesendet werden sollen. Diese Stufe sollte so einfach wie m√∂glich sein. Versuchen Sie, keine Gesch√§ftslogik hineinzulegen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mg/os/ox/mgosox1qloxyngz5k1fd4wwy_ws.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es stellt sich die Frage nach der Gr√∂√üe der Zellen: klein - schlecht, gro√ü - auch schlecht. Es gibt keinen universellen Rat - entscheiden Sie je nach Situation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der AWS-Cloud verwenden wir logische und physische Zellen unterschiedlicher Gr√∂√üe. Es gibt regionale Dienste mit einer gro√üen Zellengr√∂√üe, es gibt Zonendienste, bei denen die Zellen kleiner sind. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z9/s8/k-/z9s8k-8v60dwwojzqv86ozp7s7k.png"><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hinweis. Ich habe Anfang April dieses Jahres bei Saint Highload ++ Online √ºber Mikrozellen gesprochen. Dort habe ich ein Beispiel f√ºr die spezifische Verwendung dieses Musters in unserem Amazon EBS-Kerndienst ausf√ºhrlich besprochen.</font></font></em><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mandantenf√§hig</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn ein Benutzer einen neuen Balancer startet, erh√§lt er Instanzen in jeder Verf√ºgbarkeitszone. </font><font style="vertical-align: inherit;">Unabh√§ngig davon, ob Ressourcen verwendet werden oder nicht, werden sie zugewiesen und geh√∂ren ausschlie√ülich diesem Mandanten der Cloud. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr AWS ist dieser Ansatz ineffizient, da die Auslastung der Serviceressourcen im Durchschnitt sehr gering ist. </font><font style="vertical-align: inherit;">Dies wirkt sich auf die Kosten aus. </font><font style="vertical-align: inherit;">F√ºr Cloud-Benutzer ist dies keine flexible L√∂sung. </font><font style="vertical-align: inherit;">Es kann sich nicht an sich schnell √§ndernde Bedingungen anpassen, um beispielsweise Ressourcen in k√ºrzester Zeit mit einer unerwartet erh√∂hten Last zu versorgen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fk/52/xg/fk52xgzaaqhgq09uw_zlhbhxpfc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CLB war der erste Balancer in der Amazon Cloud. </font><font style="vertical-align: inherit;">Services verwenden heute einen mandantenf√§higen Ansatz, z. B. NLB (Network Load Balancer). </font><font style="vertical-align: inherit;">Die Basis, die "Engine" solcher Netzwerkdienste, ist </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HyperPlane</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dies ist eine interne, f√ºr Endbenutzer unsichtbare, riesige Flotte virtueller Maschinen (Knoten). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-b/65/3a/-b653as3g91ombi9itfq5wwqjxg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vorteile des </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mandantenf√§higen Ansatzes</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder des f√ºnften Musters.</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Fehlertoleranz ist grunds√§tzlich h√∂her</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In HyperPlane wird bereits eine gro√üe Anzahl von Knoten ausgef√ºhrt und wartet auf das Laden. </font><font style="vertical-align: inherit;">Knoten kennen den Status voneinander - wenn einige Ressourcen ausfallen, wird die Last sofort auf die verbleibenden verteilt. </font><font style="vertical-align: inherit;">Benutzer bemerken nicht einmal Massenabst√ºrze.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spitzenlastschutz</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mieter leben ihr eigenes Leben und ihre Belastungen korrelieren normalerweise nicht miteinander. </font><font style="vertical-align: inherit;">Die durchschnittliche Gesamtlast von HyperPlane ist recht gleichm√§√üig.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Nutzung solcher Dienste ist grunds√§tzlich besser</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Daher sind sie f√ºr eine bessere Leistung billiger.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das klingt cool! Der Multitenant-Ansatz weist jedoch Nachteile auf. In der Abbildung die HyperPlane-Flotte mit drei Mandanten (Rauten, Kreise und Dreiecke), die </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf alle Knoten verteilt sind</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kv/by/dg/kvbydgnlm6a8plns-cewltag1e8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies wirft das klassische Problem mit lauten Nachbarn auf: Die zerst√∂rerische Aktion des Mandanten, die extrem hohen oder schlechten Datenverkehr erzeugt, wirkt sich m√∂glicherweise auf alle Benutzer aus. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3f/b9/v4/3fb9v4-hnl27k0sgihgjybo_x70.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Explosionsradius" in einem solchen System sind alle Mieter. Die Wahrscheinlichkeit eines zerst√∂rerischen ‚Äûlauten Nachbarn‚Äú in der realen AWS-Verf√ºgbarkeitszone ist nicht hoch. Aber wir m√ºssen immer auf das Schlimmste vorbereitet sein. Wir verteidigen uns mit einem Mesh-Ansatz - wir w√§hlen Gruppen von Knoten als Zellen aus. In diesem Zusammenhang nennen wir sie Scherben. Zellen, Scherben, Trennw√§nde - hier ist es ein und dasselbe.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d1/7z/yy/d17zyyesjijnpsqpllrwhlthqn4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Beispiel betrifft eine Raute als "lauter Nachbar" nur einen Mandanten - ein Dreieck. </font><font style="vertical-align: inherit;">Aber das Dreieck wird sehr schmerzhaft sein. </font><font style="vertical-align: inherit;">Um den Effekt auszugleichen, wenden Sie das sechste Muster an - das Mischen von Scherben.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sharding mischen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir verteilen Mandanten zuf√§llig auf Knoten. </font><font style="vertical-align: inherit;">Zum Beispiel landet eine Raute auf 1, 3 und 6 Knoten und ein Dreieck auf 2, 6 und 8. Wir haben 8 Knoten und einen Splitter der Gr√∂√üe 3. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ft/6n/-w/ft6n-wgdpnlw1g5_t6thpanrtdm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier funktioniert einfache Kombinatorik. </font><font style="vertical-align: inherit;">Mit einer Wahrscheinlichkeit von 54% gibt es nur einen Schnittpunkt zwischen den Mietern. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cg/uu/jq/cguujqg-8xjmp-cktarugsfdd6c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Lauter Nachbar" betrifft nur einen Mieter und nicht die gesamte Last, sondern nur 30 Prozent. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stellen Sie sich eine Konfiguration nahe real - 100 Knoten mit Shard-Gr√∂√üe 5 vor. Mit einer Wahrscheinlichkeit von 77% gibt es √ºberhaupt keine Schnittpunkte. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/14/tj/dr/14tjdrziuvtturqjld0comvzycy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Shuffle Sharding kann den "Explosionsradius" erheblich reduzieren. </font><font style="vertical-align: inherit;">Dieser Ansatz wird in vielen AWS-Diensten verwendet.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Eine kleine Flotte verursacht eine gro√üe Flotte und nicht umgekehrt"</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der Wiederherstellung nach einem Massenfehler aktualisieren wir die Konfiguration vieler Komponenten. Eine typische Frage in diesem Fall ist, eine ge√§nderte Konfiguration zu pushen oder aufzuschreiben. Wer ist der Initiator der √Ñnderungen: die Quelle mit den Konfigurations√§nderungen oder deren Verbraucher? Aber diese Fragen sind falsch. Die richtige Frage ist, welche Flotte gr√∂√üer ist? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stellen Sie sich eine einfache Situation vor: eine gro√üe Flotte virtueller Front-End-Maschinen und eine bestimmte Anzahl von Back-Ends. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vg/av/er/vgaverdwdhgvag5w_pbichyvro0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir verwenden einen Mesh-Ansatz - Gruppen von Front-End-Instanzen funktionieren mit bestimmten Backends. Bestimmen Sie dazu das Routing - Mapping von Backends und Frontends, die mit ihnen arbeiten. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bx/_a/_a/bx_a_ayxwrvjrvh9uwmaj5ifsru.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Statisches Routing ist nicht geeignet. Hash-Algorithmen funktionieren bei Massenfehlern nicht gut, wenn Sie die meisten Routen schnell √§ndern m√ºssen. Daher ist es besser zu verwenden</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dynamisches Routing</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Neben den gro√üen Flotten von Front-End- und Back-End-Instanzen stellen wir einen kleinen Dienst bereit, der sich nur mit Routing befasst. Er wird jederzeit ein Backend- und Frontend-Mapping kennen und zuweisen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ji/o3/kl/jio3kl9vxu3hx5p9b1uvfgxsih8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Angenommen, wir hatten einen gro√üen Absturz, viele Front-End-Instanzen sind gefallen. Sie beginnen sich massiv zu erholen und fordern fast gleichzeitig eine Mapping-Konfiguration vom Routing-Service an. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nd/qv/fz/ndqvfzx9d_2qn6nfnu8bpmmjrqc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein kleiner Routing-Service wird mit einer Vielzahl von Anfragen bombardiert. Er wird mit der Last nicht fertig werden, im besten Fall wird sie sich verschlechtern und im schlimmsten Fall wird er sterben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher ist es richtig, keine Konfigurations√§nderungen von einem kleinen Dienst anzufordern, sondern Ihr System so aufzubauen, dass das ‚ÄûBaby‚Äú selbst</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">initiierte Konfigurations√§nderungen f√ºr eine gro√üe Flotte von Instanzen</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ua/hf/gq/uahfgqlyxt-yn190bzu-q8on_rw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir verwenden das Muster der st√§ndigen Arbeit. </font><font style="vertical-align: inherit;">Ein kleiner Routing-Dienst sendet alle paar Sekunden eine Konfiguration an alle Front-End-Flotteninstanzen. </font><font style="vertical-align: inherit;">Er wird niemals in der Lage sein, einen gro√üartigen Service zu √ºberlasten. </font><font style="vertical-align: inherit;">Das siebte Muster tr√§gt zur Verbesserung der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stabilit√§t und Elastizit√§t bei</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die ersten sieben Muster verbessern das System. </font><font style="vertical-align: inherit;">Das letztere Muster funktioniert anders.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Last fallen lassen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unten sehen Sie ein klassisches Diagramm der Verz√∂gerung gegen√ºber der Last. </font><font style="vertical-align: inherit;">Auf der rechten Seite des Diagramms befindet sich das ‚ÄûKnie‚Äú, wenn bei extrem hohen Belastungen bereits eine geringe Erh√∂hung zu einer signifikanten Erh√∂hung der Latenz f√ºhrt.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/sb/fw/vq/sbfwvqhbni-3lzbd0gjlnorzzqi.png" width="450"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im normalen Modus nehmen wir unsere Dienste niemals auf die rechte Seite des Zeitplans. Eine einfache M√∂glichkeit, dies zu steuern, besteht darin, Ressourcen rechtzeitig hinzuzuf√ºgen. Aber wir bereiten uns auf Probleme vor. Zum Beispiel k√∂nnen wir uns auf die rechte Seite des Diagramms bewegen, um uns von einem Massenversagen zu erholen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir setzen das Client-Timeout auf das Diagramm. Jeder kann ein Kunde sein, zum Beispiel eine andere Komponente in unserem Service. Der Einfachheit halber zeichnen wir einen Verz√∂gerungsgraphen von 50 Perzentilen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/g5/sj/vw/g5sjvwfpnmekcg2mu-kiynw1p6k.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier stehen wir vor einer Situation namens </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Brownout</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . M√∂glicherweise kennen Sie den Begriff </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stromausfall,</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wenn in der Stadt der Strom abgeschaltet wird. Brownout ist, wenn etwas funktioniert, aber so schlecht und langsam ist, dass es √ºberhaupt nicht funktioniert.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns den Brownout in der braunen Zone an. Der Dienst hat eine Anfrage vom Client erhalten, diese verarbeitet und das Ergebnis zur√ºckgegeben. In der H√§lfte der F√§lle haben die Kunden jedoch bereits eine Zeit√ºberschreitung und niemand wartet auf das Ergebnis. In der anderen H√§lfte kehrt das Ergebnis schneller als das Timeout zur√ºck, in einem langsamen System dauert es jedoch zu lange. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir hatten ein doppeltes Problem: Wir sind bereits √ºberlastet und stehen auf der rechten Seite des Zeitplans, aber gleichzeitig ‚Äûerw√§rmen‚Äú wir immer noch die Luft und erledigen eine Menge nutzloser Arbeit. Wie vermeide ich das? </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finden Sie das "Knie"</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - den Wendepunkt auf der Karte </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wir messen oder sch√§tzen theoretisch. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lassen Sie den Verkehr fallen</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , der uns zwingt, rechts vom Wendepunkt zu fahren </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></strong><br>
<br>
<img src="https://habrastorage.org/webt/nz/2e/t7/nz2et7zg-cebdkle6rzusm0f0ts.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir sollten einfach einen Teil der Anfragen ignorieren. </font><font style="vertical-align: inherit;">Wir versuchen nicht einmal, sie zu verarbeiten, sondern senden sofort einen Fehler an den Kunden zur√ºck. </font><font style="vertical-align: inherit;">Selbst bei √úberlastung k√∂nnen wir uns diese Operation leisten - sie ist ‚Äûbillig‚Äú. </font><font style="vertical-align: inherit;">Anfragen werden nicht erf√ºllt, die Gesamtverf√ºgbarkeit des Dienstes wird reduziert. </font><font style="vertical-align: inherit;">Obwohl die abgelehnten Anfragen fr√ºher oder sp√§ter nach einem oder mehreren erneuten Versuchen der Clients verarbeitet werden. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bz/4n/xk/bz4nxkpmofmaqg-deszxrwhra5m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gleichzeitig wird ein anderer Teil der Anforderungen mit einer garantierten geringen Latenz verarbeitet. </font><font style="vertical-align: inherit;">Infolgedessen leisten wir keine nutzlose Arbeit, und was wir tun, tun wir gut.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kurzes Zusammendr√ºcken von Mustern beim Entwerfen von Systemen f√ºr Fehler</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isolierung und Regulierung</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Manchmal ist es sinnvoll, bestimmte Arten von Abfragen zu priorisieren. Beispielsweise k√∂nnen bei einer relativ geringen Anzahl von Anforderungen zum Erstellen neuer Ressourcen diese ganz oben in die Warteschlange gestellt werden. Es ist wichtig, dass dies andere Benutzer nicht verletzt. Bei einem massiven Ausfall werden Benutzer, die auf die Wiederherstellung ihrer Ressourcen warten, keinen signifikanten Unterschied sp√ºren. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vollzeitjob</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Reduzieren oder eliminieren Sie das Umschalten der Servicemodi. Ein Modus, der unabh√§ngig von Notf√§llen oder Arbeitssituationen stabil und konstant funktioniert, verbessert die Stabilit√§t und Vorhersagbarkeit der Steuerebene grundlegend. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vorl√§ufige Skalierung</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Mit niedrigeren Entsorgungswerten im Voraus skalieren. Sie m√ºssen etwas mehr daf√ºr bezahlen, aber dies ist eine Versicherung, die sich bei schwerwiegenden Systemausf√§llen auszahlt. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zellul√§re Architektur</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Viele lose gekoppelte Zellen sind einem Monolithen vorzuziehen. Der Mesh-Ansatz reduziert den ‚ÄûExplosionsradius‚Äú und die Wahrscheinlichkeit von √úberraschungsfehlern. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Multitenant-Ansatz</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verbessert die Auslastung des Dienstes erheblich, reduziert seine Kosten und verringert den "Explosionsradius". </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sharding mischen</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dies ist ein Ansatz, der f√ºr mandantenf√§hige Dienste gilt. Au√üerdem k√∂nnen Sie den "Explosionsradius" steuern. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Eine kleine Flotte verursacht eine gro√üe Flotte und nicht umgekehrt"</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Wir versuchen, Services so zu erstellen, dass kleine Services √Ñnderungen an gro√üen Konfigurationen initiieren. Wir verwenden es oft in Verbindung mit einem konstanten Lastmuster. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Last fallen lassen</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . In Notsituationen versuchen wir, nur n√ºtzliche Arbeit zu leisten und sie gut zu machen. Dazu verwerfen wir einen Teil der Last, den wir immer noch nicht verarbeiten k√∂nnen.</font></font><br>
<br>
<blockquote>  ‚Äî    ,    Saint HighLoad++ Online.  --  , Q&amp;A-,  ,    .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> -</a>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a>. ,   -   . <br>
<br>
  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>  telegram- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@HighLoadChannel</a> ‚Äî         ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>.</blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de497322/index.html">Objektives Testen des Qualit√§tsfaktors mit Customer Journey Map</a></li>
<li><a href="../de497324/index.html">"Wie der Apfel eines Auges ..." oder wir stellen ein einfaches Sicherheitssystem her, das auf einem Mikrocontroller (Canny oder Arduino) und Raspberry PI basiert</a></li>
<li><a href="../de497326/index.html">Sicherere SSH-Konnektivit√§t mit DNSSEC</a></li>
<li><a href="../de497328/index.html">Einfache M√∂glichkeit, eine Sprache zu lernen (beliebig)</a></li>
<li><a href="../de497330/index.html">Chrome Remote Desktop. Ferngesteuerte Hilfe</a></li>
<li><a href="../de497334/index.html">Die ber√ºchtigten Fehler und wie man sie am Beispiel von ClickHouse vermeidet</a></li>
<li><a href="../de497336/index.html">Computermarken der 90er Jahre, Teil 3, endg√ºltig</a></li>
<li><a href="../de497338/index.html">Was letzte Woche mit dem Transport passiert ist - die Krise entwickelt sich</a></li>
<li><a href="../de497340/index.html">COVID-19: So h√∂ren Sie auf, Nachrichten zu lesen und Daten zu analysieren</a></li>
<li><a href="../de497342/index.html">Browser zur √úberwachung von API-Anforderungen: Aufbau einer sicheren Kommunikation zwischen dem Front-End und dem Back-End</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>