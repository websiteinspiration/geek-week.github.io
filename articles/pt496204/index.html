<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äç‚öñÔ∏è üï• üå¥ Atualiza√ß√£o do processo de CI / CD: prepara√ß√£o e planejamento üòÆ üë≤üèæ ü§ûüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Em 2020, provavelmente √© bastante dif√≠cil encontrar um projeto em uma descri√ß√£o de pilha que n√£o tenha uma das seguintes palavras: IaC, microsservi√ßos...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Atualiza√ß√£o do processo de CI / CD: prepara√ß√£o e planejamento</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496204/"><img src="https://habrastorage.org/webt/vl/jg/11/vljg11dfzemfbyfy8oexvw73eyq.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em 2020, provavelmente √© bastante dif√≠cil encontrar um projeto em uma descri√ß√£o de pilha que n√£o tenha uma das seguintes palavras: IaC, microsservi√ßos, kubernetes, docker, aws / azure / gcloud, blockchain, ML, VR e assim por diante. </font><font style="vertical-align: inherit;">E isso √© √≥timo! </font><font style="vertical-align: inherit;">O progresso n√£o p√°ra. </font><font style="vertical-align: inherit;">Estamos crescendo, nossos projetos est√£o crescendo conosco, aparecem ferramentas mais convenientes e funcionais que resolvem os problemas modernos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ol√°. Ent√£o, eu queria come√ßar este artigo. Mas ent√£o revi algumas coisas, conversei com meus colegas e percebi que estaria errado. Ainda existem projetos com mais de 15 anos de idade, com gerentes e participantes que s√£o crentes antigos, e, portanto, esses projetos t√™m uma pilha de tecnologia antiga que √© bastante dif√≠cil de manter em um zool√≥gico existente. E, por alguma raz√£o, este projeto n√£o pode ser atualizado globalmente (o cliente √© iniciante, n√£o h√° atualiza√ß√£o, o projeto √© muito grande e a migra√ß√£o est√° atrasada ou todos est√£o satisfeitos com tudo), e voc√™ precisa apoi√°-lo. Ainda mais desagrad√°vel quando um projeto semelhante ainda est√° sendo desenvolvido ativamente. √â como uma bola de neve. O cliente e o p√∫blico exigem recursos, o c√≥digo exige entrega, os servidores exigem aten√ß√£o e cuidado ... Mas o bitpack - ent√£o, em geral, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deixou de suportar merc√∫rio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Apenas esse caso √© proposto para considera√ß√£o.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que ser√° considerado: a convers√£o de mercurial-git, a mudan√ßa do CI do CruiseControl.NET para o TeamCity, da implanta√ß√£o do git para o Octopus, com uma </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pequena</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> descri√ß√£o de todo o processo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O texto saiu muito, ent√£o ser√° dividido em partes separadas para facilitar a percep√ß√£o. </font><font style="vertical-align: inherit;">Haver√° um √≠ndice. </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 1: o que √©, por que n√£o √©, como planejar, um pouco de festa. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu chamaria essa parte de quase t√©cnica. </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 2: cidade da equipe. </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 3: implanta√ß√£o do polvo. </font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parte 4: nos bastidores. </font><font style="vertical-align: inherit;">Momentos desagrad√°veis, planos para o futuro, possivelmente FAQ. </font><font style="vertical-align: inherit;">Provavelmente, tamb√©m pode ser chamado de quase t√©cnico.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu n√£o chamaria isso de guia para repeti√ß√£o por muitas raz√µes: imers√£o insuficiente nos processos do projeto devido √† falta de tempo, pr√°tica insuficiente de tais coisas, um enorme mon√≥lito no qual todos os subprojetos est√£o intimamente entrela√ßados e um monte de outras nuances que o fazem queimar, admirar, aturar eles , mas em nenhum caso n√£o, por favor. </font><font style="vertical-align: inherit;">E tamb√©m, devido aos recursos do projeto (√© √∫nico), algumas etapas ser√£o personalizadas exclusivamente para este caso.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introdu√ß√£o cl√°ssica</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
T√≠nhamos um reposit√≥rio mercurial, mais de 300 Brunches (open!), Ccnet, outro ccnet + git (para implanta√ß√µes) e um host inteiro de m√≥dulos de projeto com nossas pr√≥prias configura√ß√µes e clientes individuais, quatro ambientes e um host inteiro de pools no IIS, al√©m de cmd scripts, SQL, mais de quinhentos dom√≠nios, duas d√∫zias de compila√ß√µes e desenvolvimento ativo al√©m disso. N√£o que tudo isso fosse necess√°rio, mas funcionou, e foi inconveniente e longo. A √∫nica coisa que me preocupou foi a presen√ßa de outros projetos que exigem minha aten√ß√£o. Nada no processo de trabalhar com tarefas dessa magnitude √© mais perigoso do que a falta de concentra√ß√£o e interrup√ß√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu sabia que, mais cedo ou mais tarde, teria que prestar aten√ß√£o a outras tarefas, e √© por isso que gastei muito tempo estudando a infraestrutura existente para que, pelo menos posteriormente, n√£o houvesse problemas n√£o resolvidos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infelizmente, n√£o posso fornecer uma descri√ß√£o completa do projeto, devido √† NDA, portanto, pontos t√©cnicos gerais ser√£o considerados. Todos os nomes relacionados ao projeto tamb√©m ser√£o pintados. Pe√ßo desculpas pela mancha preta nas capturas de tela.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dos principais recursos do projeto √© que ele possui v√°rios m√≥dulos que possuem um n√∫cleo, mas diferem em suas configura√ß√µes. Existem tamb√©m m√≥dulos com uma abordagem "especial", projetada para revendedores e clientes especialmente grandes. Um m√≥dulo pode servir mais de um cliente. Um cliente deve ser entendido como uma organiza√ß√£o ou grupo de pessoas separado que obt√©m acesso a um m√≥dulo espec√≠fico. Cada cliente obt√©m acesso em seu pr√≥prio dom√≠nio, tem seu pr√≥prio design e suas pr√≥prias configura√ß√µes padr√£o exclusivas. O cliente √© identificado pelo dom√≠nio que ele usa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O esquema geral desta parte do projeto pode ser representado da seguinte forma:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ft/1p/jp/ft1pjp-5mnyfk2fu07salwryrew.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ pode ver, o n√∫cleo √© usado da mesma maneira em todos os lugares, e isso pode ser usado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Raz√µes pelas quais surgiu a tarefa de revisar e atualizar os processos de CI / CD:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O CruiseControl.NET foi usado como um sistema de compila√ß√£o. </font><font style="vertical-align: inherit;">Trabalhar com ele √© um prazer duvidoso em princ√≠pio. </font><font style="vertical-align: inherit;">Configura√ß√µes XML em v√°rias telas, um monte de depend√™ncias e configura√ß√µes de vincula√ß√£o entre si, falta de solu√ß√µes modernas para problemas modernos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alguns desenvolvedores (principalmente l√≠deres) no projeto devem ter acesso para criar servidores e, √†s vezes, gostam de alterar as configura√ß√µes da ccnet que n√£o devem ser alteradas. </font><font style="vertical-align: inherit;">Adivinha o que acontece a seguir. </font><font style="vertical-align: inherit;">Voc√™ precisa ter um gerenciamento simples e conveniente de direitos no sistema de IC, sem tirar o acesso dos desenvolvedores ao servidor. </font><font style="vertical-align: inherit;">Simplificando, n√£o h√° configura√ß√£o de texto - n√£o h√° para onde escalar com m√£os divertidas.</font></font></li>
<li>  - ‚Ä¶  CCNET,        git.         (. ).</li>
<li> ,      .     ,      .&nbsp;</li>
<li>-       ,        ‚Äî         (   )       .</li>
<li>   .        ?   ?     ?            .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uso sub√≥timo de recursos e um processo desatualizado de constru√ß√£o e entrega de c√≥digo.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figura ao par√°grafo 3:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/hc/yk/kv/hcykkvp6zijbax7ykugimj3qwkq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No est√°gio de planejamento, foi decidido usar o Teamcity como um sistema de constru√ß√£o e o Octopus como um sistema de implanta√ß√£o. </font><font style="vertical-align: inherit;">A infraestrutura "de ferro" do cliente permaneceu inalterada: servidores dedicados separados para desenvolvimento, teste, preparo e produ√ß√£o, bem como servidores de revenda (principalmente ambientes de produ√ß√£o). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Cliente recebeu a Prova de Conceito no exemplo de um dos m√≥dulos, foi elaborado um plano de a√ß√£o, realizado trabalho preparat√≥rio (instala√ß√£o, configura√ß√£o, etc.). </font><font style="vertical-align: inherit;">Provavelmente n√£o h√° sentido em descrever isso. </font><font style="vertical-align: inherit;">Como instalar a equipe da cidade pode ser lido no site oficial. </font><font style="vertical-align: inherit;">Vou abordar separadamente alguns requisitos formulados para o novo sistema:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manuten√ß√£o f√°cil com todas as consequ√™ncias (backups, atualiza√ß√µes, resolu√ß√£o de problemas, se houver).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Universalidade. </font><font style="vertical-align: inherit;">Idealmente, desenvolva um esquema geral segundo o qual todos os m√≥dulos sejam montados e entregues e use-o como modelo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minimize o tempo para adicionar novas configura√ß√µes e manuten√ß√£o de compila√ß√£o. </font><font style="vertical-align: inherit;">Clientes s√£o adicionados / removidos. </font><font style="vertical-align: inherit;">√Äs vezes, torna-se necess√°rio fazer novas configura√ß√µes. </font><font style="vertical-align: inherit;">√â necess√°rio que, ao criar um novo m√≥dulo, n√£o haja atraso na configura√ß√£o de sua entrega.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse ponto, lembramos da descontinua√ß√£o do suporte a reposit√≥rios mercuriais com um bitbucket e o requisito foi adicionado para transferir o reposit√≥rio para o git, preservando as ramifica√ß√µes e o hist√≥rico de confirma√ß√µes.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prepara√ß√£o: convers√£o de reposit√≥rio</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que algu√©m claramente resolveu esse problema diante de n√≥s e n√£o de n√≥s. </font><font style="vertical-align: inherit;">Voc√™ s√≥ precisa encontrar uma solu√ß√£o de trabalho pronta. </font><font style="vertical-align: inherit;">A exporta√ß√£o r√°pida acabou n√£o sendo t√£o r√°pida. </font><font style="vertical-align: inherit;">Al√©m disso, n√£o funcionou. </font><font style="vertical-align: inherit;">Infelizmente, n√£o h√° registros e capturas de tela restantes. </font><font style="vertical-align: inherit;">O fato √© que ele n√£o podia. </font><font style="vertical-align: inherit;">O Bitbucket n√£o fornece seu pr√≥prio conversor (mas poderia). </font><font style="vertical-align: inherit;">Mais alguns m√©todos pesquisados, e tamb√©m por. </font><font style="vertical-align: inherit;">Decidi escrever meus pr√≥prios scripts, de qualquer forma, este n√£o √© o √∫nico reposit√≥rio mercurial, ser√° √∫til no futuro. </font><font style="vertical-align: inherit;">Os desenvolvimentos iniciais ser√£o apresentados aqui (porque ainda permanecem na mesma forma). </font><font style="vertical-align: inherit;">A l√≥gica do trabalho √© mais ou menos assim:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tomamos a extens√£o mercurial hggit como base.&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temos uma lista de todos os ramos do reposit√≥rio mercurial.&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Convertemos nomes de ramifica√ß√µes (gra√ßas ao mercurial e aos desenvolvedores pelos espa√ßos nos nomes das ramifica√ß√µes, agradecimentos especiais aos tremas e outros caracteres que d√£o alegria √† vida).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crie marcadores (marcador hg) e empurre para o reposit√≥rio intermedi√°rio. </font><font style="vertical-align: inherit;">Pelo que? </font><font style="vertical-align: inherit;">Porque bitbucket e porque voc√™ n√£o pode criar um marcador com o mesmo nome que o nome da ramifica√ß√£o (por exemplo, armazenamento tempor√°rio).&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No novo reposit√≥rio (j√° git), remova o postfix do nome da filial e migre hgignore para gitignore.&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envie para o reposit√≥rio principal. </font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listando comandos de acordo com os pontos:</font></font><br>
<br>
<ol>
<li><pre><code class="bash hljs">$ <span class="hljs-built_in">cd</span> /path/to/hg/repo<font></font>
$ cat &lt;&lt; EOF &gt;&gt; ./.hg/hgrc<font></font>
[extensions]<font></font>
hggit=<font></font>
EOF<font></font>
</code></pre></li>
<li><pre><code class="bash hljs">$ hg branches &gt; ../branches
</code></pre></li>
<li><pre><code class="bash hljs"><span class="hljs-meta">#!/usr/bin/env bash</span>
hgBranchList=<span class="hljs-string">"./branches"</span>
sed -i <span class="hljs-string">'s/:.*//g'</span> <span class="hljs-variable">${hgBranchList}</span>
symbolsToDelete=$(awk <span class="hljs-string">'{print $NF}'</span> FS=<span class="hljs-string">" "</span> <span class="hljs-variable">${hgBranchList}</span> &gt; sym_to_del.tmp)<font></font>
 <font></font>
i=0<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> hgBranch; <span class="hljs-keyword">do</span>
  hgBranches[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${hgBranch}</span>
  i=$((i+<span class="hljs-number">1</span>))
<span class="hljs-keyword">done</span> &lt;<span class="hljs-variable">${hgBranchList}</span><font></font>
 <font></font>
i=0<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> str; <span class="hljs-keyword">do</span>
  strToDel[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${str}</span>
  i=$((i+<span class="hljs-number">1</span>))
<span class="hljs-keyword">done</span> &lt; ./sym_to_del.tmp<font></font>
 <font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">${!strToDel[@]}</span>
<span class="hljs-keyword">do</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-variable">${hgBranches[$i]}</span> | sed <span class="hljs-string">"s/<span class="hljs-variable">${strToDel[$i]}</span>//"</span> &gt;&gt; result.tmp
<span class="hljs-keyword">done</span><font></font>
 <font></font>
sed -i <span class="hljs-string">'s/[ \t]*$//'</span> result.tmp<font></font>
sed <span class="hljs-string">'s/^/"/g'</span> result.tmp &gt; branches_hg<font></font>
sed -i <span class="hljs-string">'s/$/"/g'</span> branches_hg<font></font>
sed <span class="hljs-string">'s/ /-/g'</span> result.tmp &gt; branches_git<font></font>
sed -i <span class="hljs-string">'s/-\/-/\//g'</span> branches_git<font></font>
sed -i <span class="hljs-string">'s/-\//\//g'</span> branches_git<font></font>
sed -i <span class="hljs-string">'s/\/-/\//g'</span> branches_git<font></font>
sed -i <span class="hljs-string">'s/---/-/g'</span> branches_git<font></font>
sed -i <span class="hljs-string">'s/--/-/g'</span> branches_git<font></font>
rm sym_to_del.tmp<font></font>
rm result.tmp<font></font>
</code></pre></li>
<li><pre><code class="bash hljs"><span class="hljs-meta">#!/usr/bin/env bash</span>
gitBranchList=<span class="hljs-string">"./branches_git"</span>
hgBranchList=<span class="hljs-string">"./branches_hg"</span>
hgRepo=<span class="hljs-string">"/repos/reponame"</span><font></font>
 <font></font>
i=0<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> hgBranch; <span class="hljs-keyword">do</span>
  hgBranches[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${hgBranch}</span>
  i=$((i+<span class="hljs-number">1</span>))
<span class="hljs-keyword">done</span> &lt;<span class="hljs-variable">${hgBranchList}</span><font></font>
 <font></font>
i=0<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> gitBranch; <span class="hljs-keyword">do</span>
  gitBranches[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${gitBranch}</span>
  i=$((i+<span class="hljs-number">1</span>))
<span class="hljs-keyword">done</span> &lt;<span class="hljs-variable">${gitBranchList}</span><font></font>
 <font></font>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">${hgRepo}</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">${!gitBranches[@]}</span>
<span class="hljs-keyword">do</span>
  hg bookmark -r <span class="hljs-string">"<span class="hljs-variable">${hgBranches[$i]}</span>"</span> <span class="hljs-string">"<span class="hljs-variable">${gitBranches[$i]}</span>-cnv"</span>
<span class="hljs-keyword">done</span><font></font>
 <font></font>
hg push git+ssh://git@bitbucket.org:username/reponame-temp.git<font></font>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Done."</span>
</code></pre></li>
<li><pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># clone repo, run git branch -a, delete remotes/origin words to leave only branch names, delete -cnv postfix, delete default branch string because we can't delete it</span>
repo=<span class="hljs-string">"/repos/repo"</span>
gitBranchList=<span class="hljs-string">"./branches_git"</span>
defaultBranch=<span class="hljs-string">"default-cnv"</span>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> gitBranch; <span class="hljs-keyword">do</span>   gitBranches[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${gitBranch}</span>;   i=$((i+<span class="hljs-number">1</span>)); <span class="hljs-keyword">done</span> &lt; <span class="hljs-variable">$gitBranchList</span>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">$repo</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">${!gitBranches[@]}</span>; <span class="hljs-keyword">do</span> git checkout <span class="hljs-variable">${gitBranches[$i]}</span>-cnv; <span class="hljs-keyword">done</span>
git checkout <span class="hljs-variable">$defaultBranch</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">${!gitBranches[@]}</span>; <span class="hljs-keyword">do</span>
    git branch -m <span class="hljs-variable">${gitBranches[$i]}</span>-cnv <span class="hljs-variable">${gitBranches[$i]}</span>
    git push origin :<span class="hljs-variable">${gitBranches[$i]}</span>-cnv <span class="hljs-variable">${gitBranches[$i]}</span>
    git push origin -u <span class="hljs-variable">${gitBranches[$i]}</span>
<span class="hljs-keyword">done</span>
</code></pre></li>
<li><pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># clone repo, run git branch -a, delete remotes/origin words to leave only branch names, delete -cnv postfix, delete default branch string because we can't delete it</span>
repo=<span class="hljs-string">"/repos/repo"</span>
gitBranchList=<span class="hljs-string">"./branches_git"</span>
defaultBranch=<span class="hljs-string">"default"</span>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> gitBranch; <span class="hljs-keyword">do</span>   gitBranches[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${gitBranch}</span>;   i=$((i+<span class="hljs-number">1</span>)); <span class="hljs-keyword">done</span> &lt; <span class="hljs-variable">$gitBranchList</span>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">$repo</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">${!gitBranches[@]}</span>; <span class="hljs-keyword">do</span>
    git checkout <span class="hljs-variable">${gitBranches[$i]}</span>
    sed -i <span class="hljs-string">'1d'</span> .hgignore<font></font>
    mv .hgignore .gitignore<font></font>
    git add .<font></font>
    git commit -m <span class="hljs-string">"Migrated ignore file"</span>
<span class="hljs-keyword">done</span>
</code></pre></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vou tentar explicar o significado de algumas a√ß√µes, a saber, o uso de um reposit√≥rio intermedi√°rio. Inicialmente, no reposit√≥rio ap√≥s a convers√£o, os nomes das ramifica√ß√µes cont√™m o postfix "-cnv". Isso se deve ao recurso de marcador hg. Voc√™ precisa remover esse postfix e tamb√©m criar arquivos gitignore em vez de hgignore. Tudo isso adiciona hist√≥rico e, portanto, aumenta o tamanho do reposit√≥rio (e de maneira irracional). Como outro exemplo, posso citar o seguinte: tente criar um reposit√≥rio e envie o primeiro commit para 300M com o c√≥digo nele. Em seguida, adicione-o ao gitignore e empurre-o sem ele. Ele permanecer√° na hist√≥ria. Agora tente remov√™-lo do hist√≥rico (git filter-branch). Com um certo n√∫mero de confirma√ß√µes, o tamanho do reposit√≥rio resultante n√£o diminui, mas aumenta. Isso √© resolvido pela otimiza√ß√£o, mas n√£o pode ser iniciado no bitbucket.Isso √© realizado apenas ao importar o reposit√≥rio. Portanto, todas as opera√ß√µes brutas s√£o realizadas com um intermedi√°rio e, em seguida, a importa√ß√£o para uma nova √© feita. O tamanho do reposit√≥rio intermedi√°rio na final foi de 1,15G e o tamanho dos 350M resultantes.&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo o processo de migra√ß√£o foi dividido em v√°rias etapas, a saber:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prepara√ß√£o (demonstra√ß√£o para o cliente usando um exemplo de uma compila√ß√£o, instala√ß√£o de software, convers√£o de reposit√≥rio, atualiza√ß√£o de configura√ß√µes existentes da ccnet);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configura√ß√£o de CI / CD para o ambiente de desenvolvimento e seus testes (o sistema antigo permanece funcionando em paralelo);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configura√ß√µes de CI / CD para os ambientes restantes (em paralelo com o "bom" existente) e testes;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desenvolvedor de migra√ß√£o, teste e teste;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Migrando dom√≠nios de produ√ß√£o e transfer√™ncia de inst√¢ncias antigas do IIS para novas.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A descri√ß√£o da fase preparat√≥ria conclu√≠da com √™xito est√° sendo conclu√≠da. </font><font style="vertical-align: inherit;">Algum sucesso grandioso n√£o foi alcan√ßado aqui, exceto que o sistema existente n√£o quebrou e o reposit√≥rio mercurial no git foi migrado. </font><font style="vertical-align: inherit;">No entanto, sem uma descri√ß√£o desses processos, n√£o haver√° contexto para partes mais t√©cnicas. </font><font style="vertical-align: inherit;">A pr√≥xima parte descrever√° o processo de configura√ß√£o de um sistema de IC com base na cidade da equipe.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt496186/index.html">Algoritmo de propaga√ß√£o de erro de volta usando o Word2Vec como exemplo</a></li>
<li><a href="../pt496188/index.html">Como parar de assistir compulsivamente a programas de TV e come√ßar a viver</a></li>
<li><a href="../pt496190/index.html">Sobre Phrasal Verbs-2</a></li>
<li><a href="../pt496192/index.html">Fun√ß√µes de chamada Rust da Go</a></li>
<li><a href="../pt496194/index.html">Na binariza√ß√£o de imagens tomogr√°ficas de estrutura fina</a></li>
<li><a href="../pt496206/index.html">Um bilh√£o de opera√ß√µes no banco de dados em 0,3 segundos. N√£o compare o OLTP com o OLAP, mas o QuestDB com o PostgreSQL</a></li>
<li><a href="../pt496208/index.html">Como o JIT destaca nosso c√≥digo C # (heur√≠stica)</a></li>
<li><a href="../pt496210/index.html">A biodiversidade pode ter evolu√≠do do princ√≠pio de jogar pedra-papel-tesoura</a></li>
<li><a href="../pt496212/index.html"># 04 - E um byte inteiro n√£o √© suficiente ... | Tome BK pelos chifres</a></li>
<li><a href="../pt496214/index.html">AdColony: 89% dos editores de aplicativos e jogos para celular usam v√≠deos promocionais</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>