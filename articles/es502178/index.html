<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚮 👩🏿‍🤝‍👨🏽 🌛 oVirt en 2 horas. Parte 3. Configuraciones avanzadas 🎟️ 🐳 👐🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En este artículo, veremos una serie de configuraciones opcionales pero útiles:
 
 

- uso de nombres adicionales para el gerente ;
- autenticación de ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>oVirt en 2 horas. Parte 3. Configuraciones avanzadas</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502178/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En este artículo, veremos una serie de configuraciones opcionales pero útiles:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uso de nombres adicionales para el gerente</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">autenticación de conexión a través del Directorio Activo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mutlipathing</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gestión de energía</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reemplazo del certificado SSL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">archivar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interfaz de gestión de host (cabina)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">las VLAN</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">específico para HPE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este artículo es una secuela, comience a ver oVirt en 2 horas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artículos</font></font></h2><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introducción</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instalación del gestor (ovirt-engine) e hipervisores (hosts) </font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuración avanzada: estamos aquí</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Operaciones básicas</font></font></a></li>
</ol><a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuraciones de administrador adicionales</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para mayor comodidad, suministraremos paquetes adicionales:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo yum install bash-completion vim</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para habilitar el autocompletado, los comandos bash-complete deben cambiarse a bash.</font></font><br>
<br>
<a name="add-fqdn"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agregar nombres DNS adicionales</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto es necesario cuando necesita conectarse al administrador con un nombre alternativo (CNAME, alias o simplemente un nombre corto sin sufijo de dominio). </font><font style="vertical-align: inherit;">Por razones de seguridad, el administrador solo permite conexiones usando la lista de nombres permitidos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Crea un archivo de configuración:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo vim /etc/ovirt-engine/engine.conf.d/99-custom-sso-setup.conf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
el siguiente contenido:</font></font><br>
<br>
<pre><code class="cmake hljs">SSO_ALTERNATE_ENGINE_FQDNS=<span class="hljs-string">"ovirt.example.com some.alias.example.com ovirt"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
y reinicie el administrador:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo systemctl restart ovirt-engine</code></pre><br>
<a name="ad-auth"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurar la autenticación a través de AD</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
oVirt tiene una base de usuarios integrada, pero también se admiten proveedores externos de LDAP, que incluyen </font><font style="vertical-align: inherit;">ANUNCIO. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La forma más sencilla para una configuración típica es iniciar el asistente y reiniciar el administrador:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo yum install ovirt-engine-extension-aaa-ldap-setup<font></font>
$ sudo ovirt-engine-extension-aaa-ldap-setup<font></font>
$ sudo systemctl restart ovirt-engine</code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo de mago</font></font></b>
                        <div class="spoiler_text">$ <b>sudo ovirt-engine-extension-aaa-ldap-setup</b><br>
Available LDAP implementations:<br>
…<br>
 3 — Active Directory<br>
…<br>
 Please select: <b>3</b><br>
 Please enter Active Directory Forest name: <b>example.com<br>
</b><br>
 Please select protocol to use (startTLS, ldaps, plain) <b>[startTLS]</b>: <br>
 Please select method to obtain PEM encoded CA certificate (File, URL, Inline, System, Insecure): <b>URL</b><br>
 URL: <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">wwwca.example.com/myRootCA.pem</a></b><br>
 Enter search user DN (for example uid=username,dc=example,dc=com or leave empty for anonymous): <b>CN=oVirt-Engine,CN=Users,DC=example,DC=com</b><br>
 Enter search user password: <b>*password*</b><br>
[ INFO ] Attempting to bind using 'CN=oVirt-Engine,CN=Users,DC=example,DC=com'<br>
 Are you going to use Single Sign-On for Virtual Machines (Yes, No) <b>[Yes]</b>: <br>
 Please specify profile name that will be visible to users <b>[example.com]</b>: <br>
 Please provide credentials to test login flow:<br>
 Enter user name: <b>someAnyUser</b><br>
 Enter user password: <br>
…<br>
[ INFO ] Login sequence executed successfully<br>
…<br>
 Select test sequence to execute (Done, Abort, Login, Search) <b>[Done]</b>: <br>
[ INFO ] Stage: Transaction setup<br>
…<br>
 CONFIGURATION SUMMARY<br>
…<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usar el asistente es adecuado para la mayoría de los casos. </font><font style="vertical-align: inherit;">Para configuraciones complejas, las configuraciones son manuales. </font><font style="vertical-align: inherit;">Lea más en la documentación de oVirt, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usuarios y Roles</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Después de conectar con éxito Engine a AD, aparecerá un perfil adicional en la ventana de conexión y en la pestaña </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permisos</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para objetos del sistema: la capacidad de emitir permisos a usuarios y grupos de AD. </font><font style="vertical-align: inherit;">Cabe señalar que el directorio externo de usuarios y grupos puede ser no solo AD, sino también IPA, eDirectory, etc.</font></font><br>
<br>
<a name="mpath"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Múltiples rutas</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En un entorno de producción, el sistema de almacenamiento debe estar conectado al host mediante varias rutas de E / S múltiples independientes. </font><font style="vertical-align: inherit;">Como regla, en CentOS (y, por lo tanto, oVirt) no hay problemas con la construcción de múltiples rutas de dispositivos (find_multipaths yes). </font><font style="vertical-align: inherit;">Las configuraciones adicionales para FCoE se describen en la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vale la pena prestar atención a la recomendación del fabricante de los sistemas de almacenamiento: muchos recomiendan usar la política de turnos, de forma predeterminada, el servicio Linux se usa en Enterprise Linux 7.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por ejemplo, 3PAR</font></font></b>
                        <div class="spoiler_text">   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">HPE 3PAR Red Hat Enterprise Linux, CentOS Linux, Oracle Linux, and OracleVM Server Implementation Guide</a> EL   Host  Generic-ALUA Persona 2,     /etc/multipath.conf   :<br>
<br>
<pre><code class="plaintext hljs">defaults {<font></font>
           polling_interval      10<font></font>
           user_friendly_names   no<font></font>
           find_multipaths       yes<font></font>
          }<font></font>
devices {<font></font>
          device {<font></font>
                   vendor                   "3PARdata"<font></font>
                   product                  "VV"<font></font>
                   path_grouping_policy     group_by_prio<font></font>
                   path_selector            "round-robin 0"<font></font>
                   path_checker             tur<font></font>
                   features                 "0"<font></font>
                   hardware_handler         "1 alua"<font></font>
                   prio                     alua<font></font>
                   failback                 immediate<font></font>
                   rr_weight                uniform<font></font>
                   no_path_retry            18<font></font>
                   rr_min_io_rq             1<font></font>
                   detect_prio              yes<font></font>
                   fast_io_fail_tmo         10<font></font>
                   dev_loss_tmo             "infinity"<font></font>
                 }<font></font>
}</code></pre><br>
     :<br>
<br>
<pre><code class="bash hljs">systemctl restart multipathd</code></pre><br>
<img src="https://habrastorage.org/webt/ez/1c/fs/ez1cfs3-mar5uivpfekvtgomway.png"><br>
<i>. 1 —   -  .</i><br>
<br>
<img src="https://habrastorage.org/webt/j_/6r/ll/j_6rll3gmnpqzwhwz_uffranfgo.png"><br>
<i>. 2 —   -   .</i><br>
</div>
                    </div><br>
<a name="pwr-mgmt"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuración de administración de energía</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le permite realizar, por ejemplo, un reinicio de hardware de la máquina, si el motor no puede recibir una respuesta del host durante mucho tiempo. </font><font style="vertical-align: inherit;">Implementado a través del Fence Agent. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compute -&gt; Hosts -&gt; </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HOST</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Edit -&gt; Power Management, luego habilite "Enable Power Management" y agregue el agente - "Add Fence Agent" -&gt; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Indicamos el tipo (por ejemplo, ilo4 debe especificarse para iLO5), el nombre / dirección de la interfaz ipmi, así como el nombre de usuario / contraseña. </font><font style="vertical-align: inherit;">Se recomienda que cree un usuario separado (por ejemplo, oVirt-PM) y, en el caso de iLO, le otorgue privilegios:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iniciar sesión</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consola remota</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Potencia virtual y reinicio</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medios virtuales</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configure los ajustes de iLO</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Administrar cuentas de usuario</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No pregunte por qué, se elige empíricamente. </font><font style="vertical-align: inherit;">El agente de protección de consola requiere un conjunto de derechos más pequeño. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al configurar listas de control de acceso, debe tenerse en cuenta que el agente no se ejecuta en el motor, sino en el host "vecino" (el denominado Proxy de administración de energía), es decir, si solo hay un nodo en el clúster, la administración de energía </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> funcionará </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<a name="ssl-cert"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuración SSL</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las instrucciones oficiales completas se encuentran en la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentación</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Apéndice D: oVirt y SSL - Reemplazar el Certificado SSL / TLS de oVirt Engine. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El certificado puede ser de nuestra CA corporativa o de una autoridad de certificación comercial externa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota importante: el certificado está diseñado para conectarse con el administrador, no afectará la interacción entre Engine y los nodos; utilizarán certificados autofirmados emitidos por Engine. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Requisitos:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">certificado de la CA emisora ​​en formato PEM, con toda la cadena a la CA raíz (desde el emisor subordinado al principio hasta la raíz al final);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Certificado de Apache emitido por la CA emisora ​​(también complementado por toda la cadena de certificados de CA)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clave privada para Apache, sin contraseña.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supongamos que nuestra autoridad de certificación de publicación ejecuta CentOS, llamada subca.example.com, y las solicitudes, claves y certificados se encuentran en el directorio / etc / pki / tls /. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Realizamos copias de seguridad y creamos un directorio temporal:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo cp /etc/pki/ovirt-engine/keys/apache.key.nopass /etc/pki/ovirt-engine/keys/apache.key.nopass.`date +%F`<font></font>
$ sudo cp /etc/pki/ovirt-engine/certs/apache.cer /etc/pki/ovirt-engine/certs/apache.cer.`date +%F`<font></font>
$ sudo mkdir /opt/certs<font></font>
$ sudo chown mgmt.mgmt /opt/certs</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descargue certificados, ejecútelos desde nuestra estación de trabajo o transfiéralos de otra manera conveniente:</font></font><br>
<br>
<pre><code class="bash hljs">[myuser@mydesktop] $ scp -3 causer@subca.example.com:/etc/pki/tls/cachain.pem mgmt@ovirt.example.com:/opt/certs<font></font>
[myuser@mydesktop] $ scp -3 causer@subca.example.com:/etc/pki/tls/private/ovirt.key mgmt@ovirt.example.com:/opt/certs<font></font>
[myuser@mydesktop] $ scp -3 causer@subca.example.com/etc/pki/tls/certs/ovirt.crt mgmt@ovirt.example.com:/opt/certs</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, debería ver los 3 archivos:</font></font><br>
<br>
<pre><code class="bash hljs">$ ls /opt/certs<font></font>
cachain.pem  ovirt.crt  ovirt.key</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instalación de certificado</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Copiamos archivos y actualizamos listas de confianza:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo cp /opt/certs/cachain.pem /etc/pki/ca-trust/<span class="hljs-built_in">source</span>/anchors<font></font>
$ sudo update-ca-trust<font></font>
$ sudo rm /etc/pki/ovirt-engine/apache-ca.pem<font></font>
$ sudo cp /opt/certs/cachain.pem /etc/pki/ovirt-engine/apache-ca.pem<font></font>
$ sudo cp /opt/certs/ovirt03.key /etc/pki/ovirt-engine/keys/apache.key.nopass<font></font>
$ sudo cp /opt/certs/ovirt03.crt /etc/pki/ovirt-engine/certs/apache.cer<font></font>
$ sudo systemctl restart httpd.service</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregar / actualizar archivos de configuración:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo vim /etc/ovirt-engine/engine.conf.d/99-custom-truststore.conf</code></pre><br>
<pre><code class="plaintext hljs">ENGINE_HTTPS_PKI_TRUST_STORE="/etc/pki/java/cacerts"<font></font>
ENGINE_HTTPS_PKI_TRUST_STORE_PASSWORD=""</code></pre><br>
<pre><code class="bash hljs">$ sudo vim /etc/ovirt-engine/ovirt-websocket-proxy.conf.d/10-setup.conf</code></pre><br>
<pre><code class="plaintext hljs">SSL_CERTIFICATE=/etc/pki/ovirt-engine/certs/apache.cer<font></font>
SSL_KEY=/etc/pki/ovirt-engine/keys/apache.key.nopass</code></pre><br>
<pre><code class="bash hljs">$ sudo vim /etc/ovirt-imageio-proxy/ovirt-imageio-proxy.conf</code></pre><br>
<pre><code class="plaintext hljs"># Key file for SSL connections<font></font>
ssl_key_file = /etc/pki/ovirt-engine/keys/apache.key.nopass<font></font>
# Certificate file for SSL connections<font></font>
ssl_cert_file = /etc/pki/ovirt-engine/certs/apache.cer</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuación, reiniciamos todos los servicios afectados:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo systemctl restart ovirt-provider-ovn.service<font></font>
$ sudo systemctl restart ovirt-imageio-proxy<font></font>
$ sudo systemctl restart ovirt-websocket-proxy<font></font>
$ sudo systemctl restart ovirt-engine.service</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¡Hecho! </font><font style="vertical-align: inherit;">Es hora de conectarse con el administrador y verificar que la conexión esté protegida por un certificado SSL firmado.</font></font><br>
<br>
<a name="backup-mgr"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Archivado</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donde sin ella! </font><font style="vertical-align: inherit;">En esta sección, discutiremos el archivado del administrador; el archivado de VM es un tema aparte. </font><font style="vertical-align: inherit;">Haremos copias de archivo una vez al día y lo pondremos en NFS, por ejemplo, en el mismo sistema donde colocamos las imágenes ISO: mynfs01.example.com:/exports/ovirt-backup. </font><font style="vertical-align: inherit;">No se recomienda almacenar archivos en la misma máquina donde se está ejecutando Engine. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instalar y habilitar autofs:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo yum install autofs<font></font>
$ sudo systemctl <span class="hljs-built_in">enable</span> autofs<font></font>
$ sudo systemctl start autofs</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Crea un script:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo vim /etc/cron.daily/make.oVirt.backup.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
el siguiente contenido:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash
</span>
datetime=`date +<span class="hljs-string">"%F.%R"</span>`<font></font>
backupdir=<span class="hljs-string">"/net/mynfs01.example.com/exports/ovirt-backup"</span>
filename=<span class="hljs-string">"<span class="hljs-variable">$backupdir</span>/`hostname --short`.`date +"</span>%F.%R<span class="hljs-string">"`"</span>
engine-backup --mode=backup --scope=all --file=<span class="hljs-variable">$filename</span>.data --<span class="hljs-built_in">log</span>=<span class="hljs-variable">$filename</span>.<span class="hljs-built_in">log</span>
<span class="hljs-comment">#uncomment next line for autodelete files older 30 days </span>
<span class="hljs-comment">#find $backupdir -type f -mtime +30 -exec rm -f {} \;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hacemos que el archivo sea ejecutable:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo chmod a+x /etc/cron.daily/make.oVirt.backup.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora cada noche recibiremos el archivo de configuración del administrador.</font></font><br>
<br>
<a name="cockpit"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interfaz de administración de host</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cockpit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es una interfaz administrativa moderna para sistemas Linux. </font><font style="vertical-align: inherit;">En este caso, juega un papel cercano a la interfaz web de ESXi. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/587/d56/5c8/587d565c8e0250045773c2772b3fb112.png" alt="imagen"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. </font><font style="vertical-align: inherit;">3 - apariencia del panel. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se instala de manera muy simple, necesita paquetes de cabina y el complemento cockpit-ovirt-dashboard:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo yum install cockpit cockpit-ovirt-dashboard -y</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encendido de la cabina:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo systemctl <span class="hljs-built_in">enable</span> --now cockpit.socket</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Configuración del cortafuegos:</font></font><br>
<br>
<pre><code class="bash hljs">sudo firewall-cmd --add-service=cockpit<font></font>
sudo firewall-cmd --add-service=cockpit --permanent</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora puede conectarse al host: https: // [Host IP o FQDN]: 9090</font></font><br>
<br>
<a name="vlans"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VLAN</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lea más sobre redes en la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentación</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Hay muchas posibilidades, aquí describimos la conexión de redes virtuales. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para conectar otras subredes, primero deben describirse en la configuración: Red -&gt; Redes -&gt; Nuevo, aquí solo el nombre es un campo obligatorio; la casilla de verificación VM Network, que permite que las máquinas usen esta red, está activada y para conectar la etiqueta, habilitar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Habilitar etiquetado de VLAN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ingrese el número de VLAN y haga clic en Aceptar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora debe ir a Compute -&gt; Hosts -&gt; kvmNN -&gt; Network Interfaces -&gt; Setup Host Networks hosts. Arrastre la red agregada desde el lado derecho de Redes lógicas no asignadas hacia la izquierda en Redes lógicas asignadas: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wq/kn/wn/wqknwnvkf13ojuxjidpxuc6s9fq.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 4 - antes de agregar una red. </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/2j/ei/gc/2jeigcdyhds6kfqqrvs-2gtt4zk.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 5 - después de agregar una red.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para conectar varias redes al host de forma masiva, es conveniente asignarles una etiqueta (s) al crear redes y agregar redes por etiquetas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una vez creada la red, los hosts pasarán al estado No operativo hasta que la red se agregue a todos los nodos del clúster. </font><font style="vertical-align: inherit;">Este comportamiento se debe al indicador Requerir todo en la pestaña Clúster al crear una nueva red. </font><font style="vertical-align: inherit;">En el caso de que la red no sea necesaria en todos los nodos del clúster, este síntoma se puede deshabilitar, luego la red cuando se agregue al host estará a la derecha en la sección No requerida y usted puede elegir si conectarla a un host específico. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zr/10/ey/zr10eyeksh3-j_kqd1ezkcgytnw.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. </font><font style="vertical-align: inherit;">6 - selección de un signo de un requisito de red.</font></font></i><br>
<br>
<a name="hpe"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HPE específico</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Casi todos los fabricantes tienen herramientas que aumentan la usabilidad de sus productos. </font><font style="vertical-align: inherit;">Usando el ejemplo de HPE, son útiles AMS (Servicio de administración sin agente, amsd para iLO5, hp-ams para iLO4) y SSA (Administrador de almacenamiento inteligente, trabajando con un controlador de disco), etc.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conecte el repositorio HPE</font></font></b>
                        <div class="spoiler_text">     HPE:<br>
<br>
<pre><code class="bash hljs">$ sudo rpm --import https://downloads.linux.hpe.com/SDR/hpePublicKey2048_key1.pub<font></font>
$ sudo vim /etc/yum.repos.d/mcp.repo</code></pre><br>
 :<br>
<br>
<pre><code class="plaintext hljs">[mcp]<font></font>
name=Management Component Pack<font></font>
baseurl=http://downloads.linux.hpe.com/repo/mcp/centos/$releasever/$basearch/current/<font></font>
enabled=1<font></font>
gpgkey=file:///etc/pki/rpm-gpg/GPG-KEY-mcp<font></font>
<font></font>
[spp]<font></font>
name=Service Pack for ProLiant<font></font>
baseurl=http://downloads.linux.hpe.com/SDR/repo/spp/RHEL/$releasever/$basearch/current/<font></font>
enabled=1<font></font>
gpgkey=file:///etc/pki/rpm-gpg/GPG-KEY-mcp</code></pre><br>
       ():<br>
<br>
<pre><code class="bash hljs">$ sudo yum --disablerepo=<span class="hljs-string">"*"</span> --enablerepo=<span class="hljs-string">"mcp"</span> list available<font></font>
$ yum info amsd</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instalación y lanzamiento:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo yum install amsd ssacli<font></font>
$ sudo systemctl start amsd</code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un ejemplo de una utilidad de controlador de disco</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/6_/bh/qw/6_bhqwnjgtqbx7eugqzur06mxxo.png"><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eso es todo por ahora. </font><font style="vertical-align: inherit;">En los siguientes artículos planeo contar algunas operaciones y aplicaciones básicas. </font><font style="vertical-align: inherit;">Por ejemplo, cómo hacer VDI en oVirt.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es502156/index.html">Caso Rambler v. NGINX: Mesa de Riesgos Criminales de Digitalización 16 de mayo</a></li>
<li><a href="../es502158/index.html">Cómo organizar las pruebas para acelerar y estabilizar los lanzamientos de productos. Parte 2</a></li>
<li><a href="../es502160/index.html">El desarrollo de aplicaciones móviles personalizadas es económico: realidad o ilusión</a></li>
<li><a href="../es502166/index.html">Fantasmas Windows 3.1</a></li>
<li><a href="../es502176/index.html">Ir: deserialización JSON con tipeo incorrecto, o cómo evitar errores de desarrollador de API</a></li>
<li><a href="../es502180/index.html">El día que desapareció el perímetro. Soluciones de seguridad de Microsoft y socios</a></li>
<li><a href="../es502182/index.html">De nuevo sobre MikroTik o el tan esperado SOCKS5</a></li>
<li><a href="../es502186/index.html">Seminario web Seguridad de la información: SOC en cuarentena</a></li>
<li><a href="../es502196/index.html">В подходе к математике столетней давности найдены новые ключи к разгадке природы времени</a></li>
<li><a href="../es502200/index.html">Entropía: cómo los árboles de decisión toman decisiones</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>