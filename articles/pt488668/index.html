<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔸 🏂🏼 🙅 Encadeamento de CI / CD e automação de Docker 🧑🏾‍🤝‍🧑🏻 ⏳ 🚔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eu escrevi meus primeiros sites no final dos anos 90. Então trazê-los à condição de trabalho era muito simples. Havia um servidor Apache em alguma hos...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Encadeamento de CI / CD e automação de Docker</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/488668/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu escrevi meus primeiros sites no final dos anos 90. Então trazê-los à condição de trabalho era muito simples. Havia um servidor Apache em alguma hospedagem compartilhada; era possível fazer login nesse servidor via FTP, escrevendo algo assim na linha do navegador </font></font><code>ftp://ftp.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Em seguida, foi necessário digitar um nome e senha e fazer upload de arquivos para o servidor. Houve outros momentos, tudo ficou mais fácil do que agora. </font><font style="vertical-align: inherit;">
Nas últimas duas décadas, tudo mudou muito. Os sites se tornaram mais complexos, devem ser montados antes de serem lançados em produção. Um único servidor tornou-se uma pluralidade de servidores trabalhando atrás de balanceadores de carga; o uso de sistemas de controle de versão tornou-se comum.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/cg/bv/ch/cgbvchdac53hqrfbqadsqimp0oa.jpeg"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para o meu projeto pessoal, eu tinha uma configuração especial. E sabia que precisava implantar um site em produção, executando apenas uma ação: gravar código em uma filial </font></font><code>master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no GitHub. Além disso, eu sabia que, para garantir a operação do meu pequeno aplicativo da Web, não queria gerenciar um grande cluster Kubernetes, nem usar a tecnologia Docker Swarm, nem manter um parque de servidores com pods, agentes e todos os tipos de outras dificuldades. Para atingir o objetivo de simplificar o trabalho o máximo possível, eu precisava me familiarizar com o CI / CD.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você tem um projeto pequeno (no nosso caso, estamos falando de um projeto Node.js.) e gostaria de aprender sobre como automatizar a implantação desse projeto, assegurando que o que está armazenado no repositório corresponda exatamente o que funciona na produção, acho que você pode estar interessado neste artigo.</font></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pré-requisitos</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Espera-se que o leitor deste artigo tenha conhecimentos básicos da área de linha de comando e escreva scripts Bash. </font><font style="vertical-align: inherit;">Além disso, ele precisará de contas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travis CI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker Hub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metas</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Não direi que este artigo possa ser incondicionalmente chamado de "manual de treinamento". </font><font style="vertical-align: inherit;">É um documento no qual falo sobre o que aprendi e descrevo o processo de teste e implantação de código na produção que me convém, executada em uma passagem automatizada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Foi assim que meu fluxo de trabalho terminou. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exceto pelo código enviado para qualquer ramificação do repositório, as </font></font><code>master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seguintes ações são executadas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crie o projeto no Travis CI.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todos os testes de unidade, integração e ponta a ponta são realizados.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Somente para o código que entra nas </font></font><code>master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seguintes retenções:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tudo o que foi dito acima, mais ...</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crie a imagem do Docker com base no código, configurações e ambiente atuais.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Colocando uma imagem no Docker Hub.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conexão com o servidor de produção.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carregando a imagem do Docker Hub para o servidor.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pare o contêiner atual e inicie um novo com base na nova imagem.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você não sabe absolutamente nada sobre o Docker, sobre imagens e contêineres - não se preocupe. </font><font style="vertical-align: inherit;">Vou lhe contar tudo sobre isso.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que é um CI / CD?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A abreviatura CI / CD significa "integração contínua / implantação contínua" - "integração contínua / implantação contínua".</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Integration Integração contínua</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A integração contínua é um processo durante o qual os desenvolvedores se comprometem com o repositório principal do código-fonte do projeto (geralmente em uma filial </font></font><code>master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Ao mesmo tempo, a qualidade do código é garantida através da realização de testes automatizados.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deployment Implantação contínua</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A implantação contínua é a implantação automatizada frequente de código na produção. </font><font style="vertical-align: inherit;">A segunda parte da abreviatura CI / CD às vezes é divulgada como "entrega contínua" ("entrega contínua"). </font><font style="vertical-align: inherit;">Geralmente, é o mesmo que "implantação contínua", mas "entrega contínua" implica a necessidade de confirmação manual de alterações antes de iniciar o processo de implantação do projeto.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Início do trabalho</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O aplicativo no qual eu dominei tudo é chamado </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TakeNote</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Este é o projeto da Web em que estou trabalhando, projetado para fazer anotações. No começo, tentei criar um </font><font style="vertical-align: inherit;">projeto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JAMStack</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ou apenas um aplicativo front-end sem servidor, para aproveitar os recursos padrão de hospedagem e implantação oferecidos pelo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Netlify</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . À medida que a complexidade do aplicativo aumentava, eu precisava criar sua parte do servidor, o que significava que teria que formar minha própria estratégia para integração automatizada e implantação automatizada do projeto.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No meu caso, o aplicativo é um servidor Express em execução no ambiente Node.js., atende a um aplicativo React de página única e suporta uma API de servidor seguro. </font><font style="vertical-align: inherit;">Essa arquitetura segue a estratégia encontrada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">neste</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> guia de autenticação de pilha cheia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consultei um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">amigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que é especialista em automação e perguntei o que eu precisava fazer para que funcionasse da maneira que eu precisava. </font><font style="vertical-align: inherit;">Ele me deu uma idéia de como deveria ser um fluxo de trabalho automatizado, descrito na seção Metas deste artigo. </font><font style="vertical-align: inherit;">O fato de eu ter definido essas metas significava que precisava descobrir como usar o Docker.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Docker é uma ferramenta que, graças à tecnologia de contêiner, facilita a distribuição de aplicativos, além de implantá-los e iniciá-los no mesmo ambiente, mesmo que a própria plataforma do Docker funcione em diferentes ambientes. Para iniciantes, eu precisava ter as ferramentas de linha de comando do Docker (CLI) à minha disposição. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As instruções</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para instalar o Docker não podem ser consideradas muito claras e compreensíveis, mas você pode aprender com isso que, para dar o primeiro passo da instalação, é necessário fazer o download do Docker Desktop (para Mac ou Windows). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Docker Hub é quase o mesmo que o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para repositórios git ou o registro </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">npm</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para pacotes JavaScript. </font><font style="vertical-align: inherit;">Este é um repositório online para imagens do Docker. </font><font style="vertical-align: inherit;">Ele se conecta ao Docker Desktop. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, para começar com o Docker, você precisa fazer duas coisas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instale o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker Desktop</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inscreva-se no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker Hub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois disso, você pode verificar se a CLI do Docker está funcionando executando o seguinte comando para verificar a versão do Docker:</font></font><br>
<br>
<pre><code class="plaintext hljs">docker -v</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, efetue login no Docker Hub digitando, quando solicitado, seu nome de usuário e senha:</font></font><br>
<br>
<pre><code class="plaintext hljs">docker login</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para usar o Docker, você deve entender os conceitos de imagens e contêineres.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Imagens</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma imagem é algo como um plano que contém instruções para a construção de um contêiner. </font><font style="vertical-align: inherit;">Este é um instantâneo imutável do sistema de arquivos e das configurações do aplicativo. </font><font style="vertical-align: inherit;">Os desenvolvedores podem compartilhar imagens facilmente.</font></font><br>
<br>
<pre><code class="plaintext hljs">#     <font></font>
docker images</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este comando exibirá uma tabela com o seguinte cabeçalho:</font></font><br>
<br>
<pre><code class="plaintext hljs">REPOSITORY &nbsp; &nbsp; TAG     IMAGE ID &nbsp; &nbsp; CREATED     SIZE<font></font>
---</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A seguir, consideraremos alguns exemplos de comandos no mesmo formato - primeiro vem um comando com um comentário e, em seguida, um exemplo do que ele pode gerar.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Contêineres</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um contêiner é um pacote executável que contém tudo o que você precisa para executar um aplicativo. </font><font style="vertical-align: inherit;">Um aplicativo com essa abordagem sempre funcionará da mesma maneira, independentemente da infraestrutura: em um ambiente isolado e no mesmo ambiente. </font><font style="vertical-align: inherit;">O ponto é que em ambientes diferentes, instâncias da mesma imagem são iniciadas.</font></font><br>
<br>
<pre><code class="plaintext hljs">#   <font></font>
docker ps -a<font></font>
CONTAINER ID &nbsp; &nbsp; IMAGE     COMMAND &nbsp; &nbsp; CREATED     STATUS     PORTS &nbsp; &nbsp; NAMES<font></font>
---</code></pre><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Tags</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma tag é uma indicação de uma versão específica de uma imagem.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Summary Resumo do comando do Docker</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui está uma visão geral de alguns comandos do Docker usados ​​com freqüência.</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Equipe</font></font><br>
</th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto</font></font><br>
</th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aja</font></font><br>
</th>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">construção do docker</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formato</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Montando uma imagem do Dockerfile</font></font><br>
</td>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tag docker</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formato</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Marcação de imagem</font></font><br>
</td>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagens do docker</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formato</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listando imagens</font></font><br>
</td>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docker run</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recipiente</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lançamento de contêiner baseado em imagem</font></font><br>
</td>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pusher docker</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formato</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enviando uma imagem para o registro</font></font><br>
</td>
</tr>
<tr>
<td><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tração docker</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formato</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Baixar imagem do registro</font></font><br>
</td>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docker ps</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recipiente</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contêiner de lista</font></font><br>
</td>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">poda do sistema docker</font></font></a><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imagem / Container</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remoção de contêineres e imagens não utilizados</font></font><br>
</td>
</tr>
</tbody></table></div><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Dockerfile</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu sei como executar um aplicativo de produção localmente. </font><font style="vertical-align: inherit;">Eu tenho uma configuração Webpack projetada para criar um aplicativo React pronto. </font><font style="vertical-align: inherit;">Em seguida, tenho um comando que inicia um servidor baseado em Node.js. na porta </font></font><code>5000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Se parece com isso:</font></font><br>
<br>
<pre><code class="plaintext hljs">npm i &nbsp; &nbsp; &nbsp; &nbsp; #  <font></font>
npm run build #  React-<font></font>
npm run start #  Node-</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note-se que não tenho um exemplo de aplicação para este material. </font><font style="vertical-align: inherit;">Mas aqui, para experimentos, qualquer aplicativo Node simples é adequado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para usar o contêiner, você precisa dar instruções ao Docker. </font><font style="vertical-align: inherit;">Isso é feito através de um arquivo chamado </font></font><code>Dockerfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localizado no diretório raiz do projeto. </font><font style="vertical-align: inherit;">Este arquivo, a princípio, parece bastante obscuro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas o que ele contém descreve apenas, com comandos especiais, algo semelhante à configuração de um ambiente de trabalho. </font><font style="vertical-align: inherit;">Aqui estão alguns destes comandos:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Este comando inicia um arquivo. </font><font style="vertical-align: inherit;">Indica a imagem básica com base na qual o contêiner é construído.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COPY</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Copia arquivos de uma fonte local para um contêiner.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WORKDIR</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Definindo o diretório de trabalho para os seguintes comandos.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXECUTAR</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Executar comandos.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPOSIÇÃO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Configurações da porta.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ENTRYPOINT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Especifica o comando a ser executado.</font></font></li>
</ul><br>
<code>Dockerfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pode ser algo como isto:</font></font><br>
<br>
<pre><code class="plaintext hljs">#   <font></font>
FROM node:12-alpine<font></font>
<font></font>
#        app/<font></font>
COPY . app/<font></font>
<font></font>
#  app/    <font></font>
WORKDIR app/<font></font>
<font></font>
#   ( npm ci  npm i,     )<font></font>
RUN npm ci --only-production<font></font>
<font></font>
#   React-  <font></font>
RUN npm run build<font></font>
<font></font>
#   <font></font>
EXPOSE 5000<font></font>
<font></font>
#  Node-<font></font>
ENTRYPOINT npm run start</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dependendo da imagem base selecionada, pode ser necessário instalar dependências adicionais. </font><font style="vertical-align: inherit;">O fato é que algumas imagens básicas (como o Node Alpine Linux) foram projetadas para torná-las o mais compactas possível. </font><font style="vertical-align: inherit;">Como resultado, eles podem não ter alguns dos programas com que você está contando.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Construir, marcar e lançar contêiner</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A montagem local e o lançamento do contêiner são, depois que temos </font></font><code>Dockerfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, as tarefas são bastante simples. </font><font style="vertical-align: inherit;">Antes de enviar uma imagem para o Docker Hub, você precisa testá-la localmente.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Montagem</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, você precisa coletar a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagem</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> especificando um nome e, opcionalmente, uma tag (se a tag não for especificada, o sistema atribuirá automaticamente uma tag à imagem </font></font><code>latest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br>
<br>
<pre><code class="plaintext hljs">#  <font></font>
docker build -t &lt;image&gt;:&lt;tag&gt; .</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Após executar este comando, você pode observar como o Docker cria a imagem.</font></font><br>
<br>
<pre><code class="plaintext hljs">Sending build context to Docker daemon &nbsp; 2.88MB<font></font>
Step 1/9 : FROM node:12-alpine<font></font>
&nbsp;---&gt; ...  ...<font></font>
Successfully built 123456789123<font></font>
Successfully tagged &lt;image&gt;:&lt;tag&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A montagem pode demorar alguns minutos - tudo depende de quantas dependências você possui. </font><font style="vertical-align: inherit;">Após a montagem, você pode executar o comando </font></font><code>docker images</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e dar uma olhada na descrição da sua nova imagem.</font></font><br>
<br>
<pre><code class="plaintext hljs">REPOSITORY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TAG               IMAGE ID&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CREATED              SIZE<font></font>
&lt;image&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; latest            123456789123&nbsp; &nbsp; &nbsp; &nbsp; About a minute ago   x.xxGB</code></pre><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Iniciar</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A imagem é criada. </font><font style="vertical-align: inherit;">E isso significa que, com base nisso, é possível lançar um contêiner. </font><font style="vertical-align: inherit;">Como quero poder acessar o aplicativo em execução no contêiner no endereço </font></font><code>localhost:5000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que </font></font><code>5000:5000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instalei </font><font style="vertical-align: inherit;">no lado esquerdo do par </font><font style="vertical-align: inherit;">no próximo comando </font></font><code>5000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">No lado direito é a porta do contêiner.</font></font><br>
<br>
<pre><code class="plaintext hljs">#      5000    5000<font></font>
docker run -p 5000:5000 &lt;image&gt;:&lt;tag&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora que o contêiner foi criado e iniciado, você pode usar o comando </font></font><code>docker ps</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para examinar as informações sobre esse contêiner (ou pode usar o comando </font></font><code>docker ps -a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que exibe informações sobre todos os contêineres, não apenas sobre os que estão funcionando).</font></font><br>
<br>
<pre><code class="plaintext hljs">CONTAINER ID&nbsp; &nbsp; &nbsp; &nbsp; IMAGE               COMMAND&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CREATED              STATUS                  &nbsp; &nbsp; PORTS                    NAMES<font></font>
987654321234&nbsp; &nbsp; &nbsp; &nbsp; &lt;image&gt;             "/bin/sh -c 'npm run…" &nbsp; 6 seconds ago        Up 6 seconds            &nbsp; &nbsp; 0.0.0.0:5000-&gt;5000/tcp   stoic_darwin</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você for para o endereço agora </font></font><code>localhost:5000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, poderá ver a página do aplicativo em funcionamento, que parece exatamente igual à página do aplicativo em funcionamento no ambiente de produção.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Atribuição e publicação de tags</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para usar uma das imagens criadas no servidor de produção, precisamos fazer o download dessa imagem no Docker Hub. </font><font style="vertical-align: inherit;">Isso significa que você deve primeiro criar um repositório para o projeto no Docker Hub. </font><font style="vertical-align: inherit;">Depois disso, teremos à nossa disposição um local onde você poderá consertar a imagem. </font><font style="vertical-align: inherit;">A imagem deve ser renomeada para que seu nome comece com o nosso nome de usuário no Docker Hub. </font><font style="vertical-align: inherit;">Depois disso, deve ser o nome do repositório. </font><font style="vertical-align: inherit;">No final do nome pode haver qualquer tag. </font><font style="vertical-align: inherit;">A seguir, é apresentado um exemplo de nomeação de imagens usando esse esquema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora você pode coletar a imagem com um novo nome e executar o comando </font></font><code>docker push</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para enviá-la ao repositório do Docker Hub.</font></font><br>
<br>
<pre><code class="plaintext hljs">docker build -t &lt;username&gt;/&lt;repository&gt;:&lt;tag&gt; .<font></font>
docker tag &lt;username&gt;/&lt;repository&gt;:&lt;tag&gt; &lt;username&gt;/&lt;repository&gt;:latest<font></font>
docker push &lt;username&gt;/&lt;repository&gt;:&lt;tag&gt;<font></font>
<font></font>
#     , , :<font></font>
docker build -t user/app:v1.0.0 .<font></font>
docker tag user/app:v1.0.0 user/app:latest<font></font>
docker push user/app:v1.0.0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se tudo correr bem, a imagem estará disponível no Docker Hub e poderá ser facilmente baixada no servidor ou transferida para outros desenvolvedores.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Próximos passos</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Até o momento, garantimos que o aplicativo, na forma de um contêiner do Docker, funcione localmente. </font><font style="vertical-align: inherit;">Carregamos o contêiner no Docker Hub. </font><font style="vertical-align: inherit;">Tudo isso significa que já fizemos um progresso muito bom em direção à meta. </font><font style="vertical-align: inherit;">Agora precisamos resolver mais duas perguntas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurando uma ferramenta de IC para testar e implantar código.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurando o servidor de produção para que ele possa carregar e executar nosso código.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No nosso caso, o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travis CI é</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usado como uma solução de CI / CD </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Como servidor - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DitigalOcean</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note-se que aqui você pode usar outra combinação de serviços. </font><font style="vertical-align: inherit;">Por exemplo, em vez do Travis CI, você pode usar as ações CircleCI ou Github. </font><font style="vertical-align: inherit;">E em vez de DigitalOcean - AWS ou Linode. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decidimos trabalhar com o Travis CI e, neste serviço, já tenho algo configurado. </font><font style="vertical-align: inherit;">Portanto, agora vou falar brevemente sobre como prepará-lo para o trabalho.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travis ci</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Travis CI é uma ferramenta para testar e implantar código. Eu não gostaria de abordar os meandros da criação do Travis CI, já que cada projeto é único e isso não trará muitos benefícios. Mas vou falar sobre o básico que permitirá que você comece se você decidir usar o Travis CI. O que você escolher - Travis CI, CircleCI, Jenkins ou qualquer outra coisa, métodos de configuração semelhantes serão usados ​​em qualquer lugar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para começar a trabalhar com o Travis CI, acesse </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o site do projeto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e crie uma conta. </font><font style="vertical-align: inherit;">Em seguida, integre o Travis CI à sua conta do GitHub. </font><font style="vertical-align: inherit;">Durante a configuração do sistema, você precisará especificar o repositório com o qual deseja automatizar e habilitar o acesso a ele. </font><font style="vertical-align: inherit;">(Eu uso o GitHub, mas tenho certeza de que o Travis CI pode se integrar ao BitBucket, GitLab e outros serviços similares). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada vez que o Travis CI é levado para o trabalho, é iniciado um servidor que executa os comandos especificados no arquivo de configuração, incluindo a implantação das ramificações do repositório correspondentes.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Ciclo de vida da tarefa</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O arquivo de configuração do Travis CI, chamado </font></font><code>.travis.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e armazenado no diretório raiz do projeto, suporta o conceito </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eventos do </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">ciclo de vida do</font></a><font style="vertical-align: inherit;"> trabalho. </font><font style="vertical-align: inherit;">Esses eventos são listados na ordem em que ocorrem:</font></font><br>
<br>
<ul>
<li><code>apt addons</code></li>
<li><code>cache components</code></li>
<li><code>before_install</code></li>
<li><code>install</code></li>
<li><code>before_script</code></li>
<li><code>script</code></li>
<li><code>before_cache</code></li>
<li><code>after_success  after_failure</code></li>
<li><code>before_deploy</code></li>
<li><code>deploy</code></li>
<li><code>after_deploy</code></li>
<li><code>after_script</code></li>
</ul><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Testes</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No arquivo de configuração, vou configurar o servidor Travis CI local. Como idioma, escolhi o Nó 12 e disse ao sistema para instalar as dependências necessárias para usar o Docker. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo o que estiver listado </font></font><code>.travis.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">será executado quando todas as solicitações pull para todas as ramificações do repositório forem executadas, a menos que especificado de outra forma. Esse é um recurso útil, pois significa que podemos testar todo o código que entra no repositório. Isso permite que você saiba se o código está pronto para ser gravado na ramificação </font></font><code>master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e se isso interromperá o processo de criação do projeto. Nesta configuração global, instalo tudo localmente, inicio o servidor do desenvolvedor Webpack em segundo plano (esse é um recurso do meu fluxo de trabalho) e executo os testes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você deseja exibir ícones em seu repositório com informações sobre cobertura de código por testes, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> você pode encontrar breves instruções sobre o uso de Jest, Travis CI e Coveralls para coletar e exibir essas informações. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Então, aqui está o conteúdo do arquivo </font></font><code>.travis.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">#  <font></font>
language: node_js<font></font>
<font></font>
#   Node.js<font></font>
node_js:<font></font>
&nbsp;&nbsp;- '12'<font></font>
<font></font>
services:<font></font>
&nbsp;&nbsp;#    Docker<font></font>
&nbsp;&nbsp;- docker<font></font>
<font></font>
install:<font></font>
&nbsp;&nbsp;#    <font></font>
&nbsp;&nbsp;- npm ci<font></font>
<font></font>
before_script:<font></font>
&nbsp;&nbsp;#      <font></font>
&nbsp;&nbsp;- npm run dev &amp;<font></font>
<font></font>
script:<font></font>
&nbsp;&nbsp;#  <font></font>
&nbsp;&nbsp;- npm run test</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, as ações que são executadas para todas as ramificações do repositório e para solicitações pull terminam.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Implantação</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com base no pressuposto de que todos os testes automatizados foram concluídos com êxito, opcionalmente, podemos implantar o código no servidor de produção. </font><font style="vertical-align: inherit;">Como queremos fazer isso apenas para o código de uma ramificação </font></font><code>master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, fornecemos ao sistema instruções apropriadas nas configurações de implantação. </font><font style="vertical-align: inherit;">Antes de tentar usar o código em seu projeto, que consideraremos posteriormente, gostaria de avisar que você deve ter um script real chamado para implantação.</font></font><br>
<br>
<pre><code class="plaintext hljs">deploy:<font></font>
&nbsp;&nbsp;#  Docker-     Docker Hub<font></font>
&nbsp;&nbsp;provider: script<font></font>
&nbsp;&nbsp;script: bash deploy.sh<font></font>
&nbsp;&nbsp;on:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;branch: master</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O script de implantação resolve dois problemas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crie, identifique e envie a imagem ao Docker Hub usando a ferramenta CI (no nosso caso, é Travis CI).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carregando a imagem no servidor, parando o contêiner antigo e iniciando o novo (no nosso caso, o servidor é executado na plataforma DigitalOcean).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, você precisa configurar o processo automático de montagem, marcação e envio da imagem para o Docker Hub. Tudo isso é muito semelhante ao que já fizemos manualmente, exceto que aqui precisamos de uma estratégia para atribuir tags exclusivas às imagens e automatizar o login. Eu tive dificuldades com alguns detalhes do script de implantação, como uma estratégia de marcação, login, codificação de chaves SSH, estabelecimento de uma conexão SSH. Mas, felizmente, meu namorado lida com o bash muito bem, assim como muitas outras coisas. Ele me ajudou a escrever esse script.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, a primeira parte do script está enviando a imagem para o Docker Hub. Isso é bem simples. O esquema de marcação que usei envolve a combinação de um hash git e uma tag git, se houver. Isso permite a criação de uma tag exclusiva e simplifica a identificação da montagem na qual ela se baseia. </font></font><code>DOCKER_USERNAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>DOCKER_PASSWORD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">são variáveis ​​de ambiente do usuário que podem ser definidas usando a interface do IC do Travis. O Travis CI processa automaticamente dados confidenciais para que não caiam nas mãos erradas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui está a primeira parte do script </font></font><code>deploy.sh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="plaintext hljs">#!/bin/sh<font></font>
set -e #     <font></font>
<font></font>
IMAGE="&lt;username&gt;/&lt;repository&gt;" &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #  Docker<font></font>
GIT_VERSION=$(git describe --always --abbrev --tags --long) # Git-  <font></font>
<font></font>
#    <font></font>
docker build -t ${IMAGE}:${GIT_VERSION} .<font></font>
docker tag ${IMAGE}:${GIT_VERSION} ${IMAGE}:latest<font></font>
<font></font>
#   Docker Hub   <font></font>
echo "${DOCKER_PASSWORD}" | docker login -u "${DOCKER_USERNAME}" --password-stdin<font></font>
docker push ${IMAGE}:${GIT_VERSION}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que a segunda parte do script será completamente depende de qual host você está usando e como a conexão com ele está organizada. No meu caso, como uso o Digital Ocean, os comandos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doctl</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> são usados ​​para conectar-se ao servidor </font><font style="vertical-align: inherit;">. Ao trabalhar com o Aws, um utilitário será usado </font></font><code>aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e assim por diante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A configuração do servidor não foi particularmente difícil. Então, configurei uma gota com base na imagem base. Deve-se observar que o sistema que eu selecionei requer uma instalação manual única do Docker e um lançamento manual único do Docker. Eu usei o Ubuntu 18.04 para instalar o Docker, portanto, se você também usa o Ubuntu para fazer o mesmo, basta seguir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">este</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> guia simples.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Não estou falando aqui de comandos específicos para o serviço, pois esse aspecto pode variar bastante em diferentes casos. </font><font style="vertical-align: inherit;">Darei apenas um plano de ação geral que será executado após a conexão via SSH ao servidor no qual o projeto será implantado:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Você precisa encontrar o contêiner que está em execução no momento e pará-lo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em segundo plano, você precisa iniciar um novo contêiner.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Você precisará definir a porta do servidor local como um valor </font></font><code>80</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- isso permitirá que você insira o site no endereço do formulário </font></font><code>example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, sem especificar a porta, e não use o endereço como </font></font><code>example.com:5000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E, finalmente, você precisa remover todos os contêineres e imagens antigos.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui está a continuação do script.</font></font><br>
<br>
<pre><code class="plaintext hljs">#  ID  <font></font>
CONTAINER_ID=$(docker ps | grep takenote | cut -d" " -f1)<font></font>
<font></font>
#   ,  ,  <font></font>
docker stop ${CONTAINER_ID}<font></font>
docker run --restart unless-stopped -d -p 80:5000 ${IMAGE}:${GIT_VERSION}<font></font>
docker system prune -a -f</code></pre><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algumas coisas a considerar</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Talvez quando você se conectar ao servidor via SSH do Travis CI, você verá um aviso que não permitirá que a instalação continue, pois o sistema aguardará a resposta do usuário.</font></font><br>
<br>
<pre><code class="plaintext hljs">The authenticity of host '&lt;hostname&gt; (&lt;IP address&gt;)' can't be established.<font></font>
RSA key fingerprint is &lt;key fingerprint&gt;.<font></font>
Are you sure you want to continue connecting (yes/no)?</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aprendi que a chave de cadeia pode ser codificada em base64 para salvá-la de uma forma em que será conveniente e confiável trabalhar com ela. </font><font style="vertical-align: inherit;">No estágio de instalação, você pode decodificar a chave pública e gravá-la em um arquivo </font></font><code>known_hosts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para se livrar do erro acima.</font></font><br>
<br>
<pre><code class="plaintext hljs">echo &lt;public key&gt; | base64 #  &lt; ,   base64&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na prática, este comando pode ser assim:</font></font><br>
<br>
<pre><code class="plaintext hljs">echo "123.45.67.89 ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAklOUpkDHrfHY17SbrmTIpNLTGK9Tjom/BWDSU<font></font>
GPl+nafzlHDTYW7hdI4yZ5ew18JH4JW9jbhUFrviQzM7xlELEVf4h9lFX5QVkbPppSwg0cda3<font></font>
Pbv7kOdJ/MTyBlWXFCR+HAo3FXRitBqxiX1nKhXpHAZsMciLq8V6RjsNAQwdsdMFvSlVK/7XA<font></font>
t3FaoJoAsncM1Q9x5+3V0Ww68/eIFmb1zuUFljQJKprrX88XypNDvjYNby6vw/Pb0rwert/En<font></font>
mZ+AW4OZPnTPI89ZPmVMLuayrD2cE86Z/il8b+gw3r3+1nKatmIkjn2so1d01QraTlMqVSsbx<font></font>
NrRFi9wrf+M7Q== you@example.com" | base64</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E aqui está o que ele fornece - uma string codificada em base64:</font></font><br>
<br>
<pre><code class="plaintext hljs">MTIzLjQ1LjY3Ljg5IHNzaC1yc2EgQUFBQUIzTnphQzF5YzJFQUFBQUJJd0FBQVFFQWtsT1Vwa0RIcmZIWTE3U2JybVRJcE5MVEdLOVRqb20vQldEU1UKR1BsK25hZnpsSERUWVc3aGRJNHlaNWV3MThKSDRKVzlqYmhVRnJ2aVF6TTd4bEVMRVZmNGg5bEZYNVFWa2JQcHBTd2cwY2RhMwpQYnY3a09kSi9NVHlCbFdYRkNSK0hBbzNGWFJpdEJxeGlYMW5LaFhwSEFac01jaUxxOFY2UmpzTkFRd2RzZE1GdlNsVksvN1hBCnQzRmFvSm9Bc25jTTFROXg1KzNWMFd3NjgvZUlGbWIxenVVRmxqUUpLcHJyWDg4WHlwTkR2allOYnk2dncvUGIwcndlcnQvRW4KbVorQVc0T1pQblRQSTg5WlBtVk1MdWF5ckQyY0U4NlovaWw4YitndzNyMysxbkthdG1Ja2puMnNvMWQwMVFyYVRsTXFWU3NieApOclJGaTl3cmYrTTdRPT0geW91QGV4YW1wbGUuY29tCg==</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui está a equipe mencionada acima</font></font><br>
<br>
<pre><code class="plaintext hljs">install:<font></font>
&nbsp;&nbsp;- echo &lt;  ,   base64&gt; | base64 -d &gt;&gt; $HOME/.ssh/known_hosts</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A mesma abordagem pode ser usada com uma chave privada ao estabelecer uma conexão, pois você pode precisar de uma chave privada para acessar o servidor. </font><font style="vertical-align: inherit;">Ao trabalhar com uma chave, você só precisa garantir seu armazenamento seguro na variável de ambiente Travis CI e para que ela não seja exibida em nenhum lugar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outra coisa que você deve prestar atenção é que pode ser necessário executar o script de implantação inteiro, apresentado como uma única linha, por exemplo, usando </font></font><code>doctl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Isso pode exigir algum esforço adicional.</font></font><br>
<br>
<pre><code class="plaintext hljs">doctl compute ssh &lt;droplet&gt; --ssh-command "    &amp;&amp; "</code></pre><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TLS / SSL e balanceamento de carga</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de fazer tudo o que foi discutido acima, o último problema que surgiu diante de mim foi que o servidor não tinha SSL. Como eu uso o servidor Node.js., para fazer com que os </font><font style="vertical-align: inherit;">proxies reversos Nginx e Let's Encrypt </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funcionem</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , preciso mexer muito.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu realmente não estava com vontade de fazer todas essas configurações de SSL manualmente, então criei um balanceador de carga e registrei informações sobre ele no DNS. No caso do DigitalOcean, por exemplo, a criação de um certificado autoassinado com renovação automática em um balanceador de carga é um procedimento simples, gratuito e rápido. Essa abordagem possui uma vantagem adicional, que, se necessário, facilita a configuração do SSL em vários servidores executando um balanceador de carga. Isso permite que os próprios servidores não “pensem” no SSL, mas usem a porta como de costume </font></font><code>80</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Portanto, a configuração do SSL em um balanceador de carga é muito mais simples e mais conveniente do que os métodos alternativos de configuração do SSL.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora você pode fechar no servidor todas as portas que aceitam conexões de entrada - exceto a porta </font></font><code>80</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usada para comunicação com o balanceador de carga e a porta </font></font><code>22</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para SSH. </font><font style="vertical-align: inherit;">Como resultado, uma tentativa de acessar diretamente o servidor em qualquer porta, com exceção dessas duas, falhará.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sumário</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de fazer tudo o que foi descrito neste material, não tive mais medo da plataforma Docker ou do conceito de cadeias automatizadas de CI / CD. Consegui configurar uma cadeia de integração contínua durante a qual o código é testado antes de entrar em produção e o código é implantado automaticamente no servidor. Tudo isso para mim ainda é relativamente novo e tenho certeza de que existem maneiras de melhorar meu fluxo de trabalho automatizado e torná-lo mais eficiente. Portanto, se você tiver alguma idéia sobre esse assunto, </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">me</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avise. Espero que este artigo tenha ajudado você em seus assuntos. Quero acreditar que, depois de ler, você aprendeu tanto quanto eu, enquanto descobri tudo o que contei. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Existe </font><font style="vertical-align: inherit;">uma imagem </font><font style="vertical-align: inherit;">em nosso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mercado</font></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que é instalado em um clique. </font><font style="vertical-align: inherit;">Você pode verificar a operação de contêineres no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Todos os novos clientes recebem 3 dias gratuitamente para testes. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Queridos leitores! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Você usa tecnologias de CI / CD em seus projetos?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt488658/index.html">Usando faiss para pesquisar espaços multidimensionais</a></li>
<li><a href="../pt488660/index.html">É hora de esquecer o React e atualizar para o Svelte?</a></li>
<li><a href="../pt488662/index.html">Extensões de navegador exigidas por todo desenvolvedor web</a></li>
<li><a href="../pt488664/index.html">Encontrando o Kit de Ferramentas Perfeito: Analisando Modelos de Projeto Python Populares</a></li>
<li><a href="../pt488666/index.html">10 Reagir componentes para todas as ocasiões</a></li>
<li><a href="../pt488674/index.html">Infográfico com Excel e PowerPoint</a></li>
<li><a href="../pt488678/index.html">Grandes apetites para pequenos amortecedores no Node.js</a></li>
<li><a href="../pt488682/index.html">Como testar as habilidades de programação Python? Tarefas do Yandex</a></li>
<li><a href="../pt488686/index.html">Usando redes Flowmon para monitorar o desempenho de aplicativos e bancos de dados distribuídos</a></li>
<li><a href="../pt488690/index.html">Levenshtein menos reconhecimento de caracteres à distância</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>