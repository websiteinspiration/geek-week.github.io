<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐒 🧕 👨🏻‍🔧 CAPTCHA, caso especial: rompemos una red neuronal con treinta líneas de código 🛡️ 🥃 ⚪️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No recuerdo cómo me encontré con el artículo habr.com/en/post/464337 , pero se hundió en mi cerebro y no dio descanso hasta el último día. Varias vece...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>CAPTCHA, caso especial: rompemos una red neuronal con treinta líneas de código</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488018/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;&nbsp;No recuerdo cómo me encontré con el artículo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr.com/en/post/464337</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pero se hundió en mi cerebro y no dio descanso hasta el último día. </font><font style="vertical-align: inherit;">Varias veces intenté entender lo que estaba sucediendo, un par de veces intenté que funcionara, pero fue en vano: no entiendo nada en redes neuronales e incluso programo como un programador real.</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/4z/eb/8b/4zeb8bn8i97b4662ssgxu8x_rgk.jpeg" alt="feliz captcha"></div><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;&nbsp;&nbsp;Finalmente, hace unos días, superé el lanzamiento de la pitón y decidí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">por qué no</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> todo eso. Habiendo olvidado todo lo que leí en el artículo mencionado, seguí mi propio camino. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;&nbsp;&nbsp;Recordando la miríada de captchas resueltas, sugerí que puedes resolverlas mediante una comparación banal con la máscara, que luego se confirmó. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;&nbsp;&nbsp;Primero, ensambló manualmente el captcha de prueba (83 piezas) y les dio nombres obvios. El guión los convirtió en mapas de bits.</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ps/kq/ku/pskqkuzoyxdkyh8d4d8ty_pkq_m.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;&nbsp;&nbsp;Los números en el captcha son de dos tamaños de altura con una diferencia de 1 píxel y tres a cuatro caras de ancho. </font><font style="vertical-align: inherit;">La línea base de todos los personajes en todos los captcha es la misma. </font><font style="vertical-align: inherit;">Resultó que toda esta diversidad tiene una cierta máscara común, una comparación con la que identifica de forma única una figura. </font><font style="vertical-align: inherit;">Corté varios (al principio - 5, luego agregué otros 1-2; con "4" tardó más que el resto) de los mismos números de diferentes captchas. </font><font style="vertical-align: inherit;">En paint.net, los puse uno encima del otro y obtuve una máscara que es común a todas las caras de cada dígito.</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gp/9_/tg/gp9_tggrvacz2jncx6eesiffz7c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;&nbsp;&nbsp;Descubrí el único problema más tarde, ya durante el procesamiento en masa, pero lo evité con éxito</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">con una muleta</font></font></b>
                        <div class="spoiler_text">&nbsp;&nbsp;&nbsp;,     —      «1»,  «2»  ..  «9». ,    ,        «4»,      «4»,  «1». , -,      «123456789»  «423156789»  -,    «4»    ,    «1». <br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;&nbsp;&nbsp;Además de este pequeño malentendido, el ruido no interfiere en absoluto. </font><font style="vertical-align: inherit;">El resultado de esta etapa fue un conjunto de 9 máscaras. </font><font style="vertical-align: inherit;">¡Dos bucles anidados y listo! </font><font style="vertical-align: inherit;">- ¡Todas mis 83 captchas son reconocidas con una explosión! </font></font><br>
<img src="https://habrastorage.org/webt/dc/we/3f/dcwe3fms8fxijery7_mg-s_isfa.png"><br>
&nbsp;&nbsp;&nbsp;<br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;&nbsp;&nbsp;Entonces surgió la pregunta: dónde obtener un gran conjunto de captcha para la verificación. </font><font style="vertical-align: inherit;">Y descargué "29,000 captcha" del artículo mencionado.</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, esto resultó ser una pérdida de tiempo.</font></font></b>
                        <div class="spoiler_text">&nbsp;&nbsp;&nbsp;- (, -, ..    ),    :         : 6503 , 5420 , 760  .. – ..    14882, , ,  .<br>
-,     – -, –    .      PNG,    – JPG,    ,   .  ,       –     «”” ».<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;&nbsp;&nbsp;Así que tuve que descubrir Google y extraer el captcha perfecto por mi cuenta: se acumularon 3224 archivos por noche, incluidos 49 completamente vacíos, como resultó más tarde. Gracias Ganesha por el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">código</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;&nbsp;&nbsp;En realidad, el reconocimiento de captcha se ajusta a 26 líneas de código aburrido de Python. De los módulos externos solo se necesita PIL. La velocidad es de aproximadamente 1000 captcha por minuto (mil captcha por minuto) en el antiguo Core 2 "cuatro núcleos cuatro conciertos". En un i5 de ocho transmisiones más decente es notablemente más rápido, aunque el asunto, por supuesto, no está en los hilos. Reconocimiento del 100% o muy cercano a eso: la verificación al azar no mostró errores.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;&nbsp;&nbsp;Por supuesto, todo esto no es interesante en el sentido de las redes neuronales y otras cadenas de bloques, pero tiene una ventaja muy clara sobre la opción propuesta anteriormente: velocidad y precisión. </font><font style="vertical-align: inherit;">También es cierto que cualquier cambio en los parámetros del captcha - auriculares o tamaño de fuente, tipo de ruido, etc. </font><font style="vertical-align: inherit;">- conducirá a la inoperancia completa de mi decisión. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descargue el archivo con captcha de Yandex.Disk (14MB).</font></font><br>
</a><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fuente</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image, ImageTk<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">recognize</span>(<span class="hljs-params">filepath</span>):</span>
  Zlist = [] <span class="hljs-comment"># [(x1, z1), (x2, z2), (x3, z3), etc.] - position and digit</span>
  captcha = <span class="hljs-string">""</span>
  originalimage = Image.open(filepath).convert(<span class="hljs-string">'L'</span>).point(<span class="hljs-keyword">lambda</span> x : <span class="hljs-number">255</span> <span class="hljs-keyword">if</span> x &gt; <span class="hljs-number">20</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>, mode=<span class="hljs-string">'1'</span>).convert(<span class="hljs-string">'1'</span>).convert(<span class="hljs-string">'RGBA'</span>)
  <span class="hljs-keyword">if</span> originalimage.getextrema() == ((<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">255</span>, <span class="hljs-number">255</span>)):
    <span class="hljs-keyword">return</span>(<span class="hljs-string">"empty image"</span>)
  <span class="hljs-keyword">for</span> z <span class="hljs-keyword">in</span> [<span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>]: <span class="hljs-comment"># reorder to exclude false 1 on 4</span>
    mask = Image.open(<span class="hljs-string">'mask'</span> + str(z) + <span class="hljs-string">'.png'</span>).convert(<span class="hljs-string">'RGBA'</span>)<font></font>
    previ = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">15</span>, <span class="hljs-number">120</span>): <span class="hljs-comment"># no digit in left part</span>
      resultimage = Image.alpha_composite(originalimage.crop((i, <span class="hljs-number">0</span>, i + <span class="hljs-number">30</span>, <span class="hljs-number">0</span> + <span class="hljs-number">50</span>)), mask)
      <span class="hljs-keyword">if</span> resultimage.getextrema() == ((<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">255</span>, <span class="hljs-number">255</span>)):
        <span class="hljs-keyword">if</span> z == <span class="hljs-number">4</span>: <span class="hljs-comment"># delete 4 to exclude false 1 on 4</span>
          maskx = Image.open(<span class="hljs-string">'mask4x.png'</span>).convert(<span class="hljs-string">'RGBA'</span>) <font></font>
          originalimage.paste(Image.alpha_composite(originalimage.crop((i, <span class="hljs-number">0</span>, i + <span class="hljs-number">30</span>, <span class="hljs-number">0</span> + <span class="hljs-number">50</span>)), maskx), (i, <span class="hljs-number">0</span>))
        <span class="hljs-keyword">if</span> previ == <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> i &gt; previ + <span class="hljs-number">15</span>: <span class="hljs-comment">#no digit closer then 15 px</span><font></font>
          Zlist.append((i, z))<font></font>
          <span class="hljs-keyword">if</span> len(Zlist) == <span class="hljs-number">5</span>:<font></font>
              Zlist.sort()<font></font>
              <span class="hljs-keyword">for</span> z <span class="hljs-keyword">in</span> Zlist:<font></font>
                captcha = captcha + str(z[<span class="hljs-number">1</span>])
              <span class="hljs-keyword">return</span>(captcha)<font></font>
          previ = i<font></font>
          i = i + <span class="hljs-number">15</span> <span class="hljs-comment">#skip a little</span><font></font>
  Zlist.sort()<font></font>
  <span class="hljs-keyword">return</span>(str(Zlist)) <span class="hljs-comment">#if less then 5 digits recognized</span><font></font>
	<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><font></font>
  captcha = recognize(entry.path)<font></font>
<span class="hljs-comment">#----------------------------------------------#</span>
<span class="hljs-comment">#          #</span>
<span class="hljs-comment">#----------------------------------------------#</span><font></font>
<font></font>
main()<font></font>
</code></pre><br>
<br>
</div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Actualización a partir del 13 de febrero de 2020. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;&nbsp;&nbsp;¿De qué se trataba todo esto? ¿No por el reconocimiento deportivo de las imágenes guardadas? No, todo esto fue puramente para fines pragmáticos. </font></font><br>
&nbsp;&nbsp;&nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solución lista para el trabajo.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Servidor de reconocimiento http local más extensión para Chrome. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;&nbsp;&nbsp;Hasta ahora, lo único que puede hacerlo (espero que pueda) es insertar automáticamente el captcha en el lugar correcto. Los planes: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp; - limpiar la interfaz del sitio, dejando el mínimo necesario; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp; - automatizar la actualización de captcha al ver información, como Un captcha permite abrir solo 4 objetos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp; - Descargue todas las declaraciones preparadas a la vez, y no una a la vez. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Actualización a partir del 5 de marzo de 2020. </font></font><br>
&nbsp;&nbsp;&nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solución lista para el trabajo.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Servidor de reconocimiento http local más extensión para Chrome. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;&nbsp;&nbsp;Se actualizó la extensión para Chrome. </font><font style="vertical-align: inherit;">Ahora es capaz, además de la sustitución automática de captcha, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;1. al abrir páginas con información sobre objetos inmobiliarios, ampliar información sobre derechos; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;2. Recopile información de estas páginas para su posterior procesamiento. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;&nbsp;&nbsp;Captura de pantalla en el comentario </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr.com/post/488018/#comment_21360646</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Actualización a partir del 17 de abril de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">2020</font></a><font style="vertical-align: inherit;"> . </font></font><br>
&nbsp;&nbsp;&nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bot para ordenar declaraciones de la lista</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , debido a la restricción en la frecuencia de las declaraciones de pedidos: 1 declaración en 5 minutos. </font><font style="vertical-align: inherit;">Captura de pantalla en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comentario</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es488006/index.html">En Moscow Python Conf ++, ven a hablar con los desarrolladores del lenguaje</a></li>
<li><a href="../es488008/index.html">Domar a la bestia: código heredado, pruebas y tú</a></li>
<li><a href="../es488010/index.html">Herramientas de diseño controladas por dominio</a></li>
<li><a href="../es488012/index.html">Estacionamiento para sus contras</a></li>
<li><a href="../es488014/index.html">9. Fortinet Getting Started v6.0. Registro e informes</a></li>
<li><a href="../es488020/index.html">Vivaldi 2.11 - One Touch Beauty</a></li>
<li><a href="../es488024/index.html">Fantásticas cerraduras de asesoramiento y dónde viven</a></li>
<li><a href="../es488026/index.html">Joyería, impresora 3D Formlabs y cuidado del medio ambiente</a></li>
<li><a href="../es488028/index.html">Cómo comenzar a hacer un juego en UE4</a></li>
<li><a href="../es488030/index.html">Cómo organizar skins en Symfony</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>