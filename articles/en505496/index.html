<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üà∑Ô∏è üõ£Ô∏è üî° Flutter Dev Podcast with CTO Meduza Boris Goryachev: the main thing about the Meduz application and media development üíÉ ‚öΩÔ∏è ü§¥üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not every day there is a chance to discuss a Flutter project with more than 100 thousand DAUs in the application. The new Meduza app is just such a pr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Flutter Dev Podcast with CTO Meduza Boris Goryachev: the main thing about the Meduz application and media development</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/surfstudio/blog/505496/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Not every day there is a chance to discuss a Flutter project with more than 100 thousand DAUs in the application. The new Meduza app is just such a project. At the moment, this is the most popular and discussed Flutter application in Russian stores. We invited Boris Goryachev to </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flutter Dev Podcast</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to find out why the team decided to leave the native to the cross platform and chose Flutter. Below we have collected the most interesting: attempts to make friends with the native web, the first experience of cross-platform, features of media development, font games and the difficulties of working with WebView / Backend Driven UI.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rc/-0/ub/rc-0ub1iuwx3vtwozistgp0qbow.png"><br>
<a name="habracut"></a><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúIdea, site, two applications</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><b><font style="vertical-align: inherit;">‚Äù</font></b><font style="vertical-align: inherit;"> Initially, at the launch of Meduza in 2014, the team relied on a convenient mobile application, the site was as simple as possible. As it turned out later, the audience at that moment was not yet ready to give up news on the web. The application gained its audience, but in absolute numbers was inferior to the web (both to the mobile site and the desktop). Therefore, it was decided to improve the technical equipment of the site. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Audience Meduza</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><b><font style="vertical-align: inherit;">"</font></b><font style="vertical-align: inherit;"> In the internal metrics, Meduza clearly distinguishes between mobile and desktop users of the site, as well as users of the application. The latter are the least, but their activity is significantly higher than in all other categories. This is the core of the Meduza audience. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
" </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What was the first version of the application?"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Meduza started in just a couple of months. The bet was on beautiful content that was downloaded from the browser. The principle of creating media applications is the same for everyone: natively, the main and other distributing pages are done. When a person taps on the material, a WebView opens, in which various HTML, CSS and other modules are displayed. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúHas the development approach changed over time?‚Äù</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. No, the mechanics have remained the same: first the native view, then the user ‚Äúfails‚Äù in the WebView, in which the content from the browser will be scrolled. This approach has its drawbacks. When the content is controlled by the browser, you have to pay a lot of attention to the communication between the native code and the web form. For example, to draw some kind of native component that will appear with a beautiful effect and follow the user. On this team filled a lot of cones. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"What were the problems in interacting web with native"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Web developers and native developers speak different languages. During development, there were problems with serialization, deserialization, Java crashed, because some wrong object came, the wrong structure, etc. There were also difficulties with embedding elements depending on the scroll position. For example, there is a WebView limited in height, which should integrate with a piece of native. You have to make a composition from an element that will scroll by itself, then it intercepts another scroll and so on.</font></font><br>
<blockquote>         ,    .   : ,  ,   - ,      ,        . ,    -       Java, Kotlin  ..           </blockquote><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúRendering Meduza content natively is like repeating the browser so that it works. Not an easy task</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><b><font style="vertical-align: inherit;">‚Äù</font></b><font style="vertical-align: inherit;"> The team managed to transfer some of the materials to native rendering. For example, in the ‚ÄúOnline‚Äù category, the material is filled in by the editor in real-time: after sending the information is immediately rendered on the reader‚Äôs screen. We did it all on the native. For example, a client receives dynamic data in a different format. The client must process them correctly and not fall. There were a lot of problems with the coordination of all the nuances - it was necessary to decide how to move on.</font></font><br>
<blockquote>  , ,     ‚Äî    .   ,      .  : ¬´,     ¬ª.   2-       ,           .</blockquote><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"The first cross-platform experience - React Native</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><b><font style="vertical-align: inherit;">"</font></b><font style="vertical-align: inherit;"> Meduza has its entire frontend written in React. Boris wrote his first mobile prototype on React Native in a couple of weeks. The prototype worked fine: showed, rendered, imposed styles, etc. When the full development of the application on React Native began, new problems got out. For example, JavaScript on Android does not work as it does on iOS. There is valid JavaScript, it does not swear, but you open and see the void, and the problem is in JSX. There were also problems with tags that map into containers or text, but close somehow in a tricky way. At first, it seemed like there was a chance to fix all the bugs after the fact. But the farther, the more development stumbled on trifles.</font></font><br>
<blockquote> ,      2 ,   ,      .   ,      . 2    ‚Äî   .</blockquote><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúThey learned about Flutter on Google I / O in 2018, but decided to hold off</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><b><font style="vertical-align: inherit;">‚Äù </font></b><font style="vertical-align: inherit;">We talked with Andrew Brogdan (Flutter). </font><font style="vertical-align: inherit;">Meduza needed a backend driven architecture for the API to dictate what would happen in the UI. </font><font style="vertical-align: inherit;">The key point is having a WebView that integrates into the widget tree. </font><font style="vertical-align: inherit;">The media application needs to show the user the video from the social. </font><font style="vertical-align: inherit;">networks and YouTube. </font><font style="vertical-align: inherit;">Unfortunately, at that time, Flutter did not have WebView support, and the cross-platform was put on hold. </font><font style="vertical-align: inherit;">Native applications have lived without support for almost 2 years. </font><font style="vertical-align: inherit;">During this time, there were many different edits on the backend side, but the applications worked more or less stable.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello, I‚Äôm the technical director: ‚ÄúDo we have two applications that people use? </font><font style="vertical-align: inherit;">Well, they will be without support. ‚Äù </font><font style="vertical-align: inherit;">And in the end, they lived without support for almost 2 years, but used them.</font></font></blockquote><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúIn December 2018, Google added the WebView library to Flutter and the development of the new Meduza application began</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><b><font style="vertical-align: inherit;">‚Äù</font></b><font style="vertical-align: inherit;"> It took almost a year only because the team several times invented the entire application anew. Screens, concept changed, experiments were conducted. Flutter allows you to quickly make interfaces, and thanks to hot reload, designers could quickly comment on changes and make edits, many edits. In total, the application code and the backend took no more than 6 months. At the same time, Boris was not completely focused on Flutter, but was distracted by the development and launch of other projects.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Media is a type of human activity where everything constantly goes wrong. </font><font style="vertical-align: inherit;">Something is constantly happening in the world: the journalist is being held up by the authorities, the regime is changing, the COVID-19 pandemic is starting, etc. </font><font style="vertical-align: inherit;">Because of this, the development of services is hindered, meetings are postponed, and creative suffers.</font></font></blockquote><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Features of the development of media applications in Russia</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><b><font style="vertical-align: inherit;">" </font></b><font style="vertical-align: inherit;">In our country, there are very few media developers, there are practically no colleagues in the workshop who could learn from and borrow the best practices. </font><font style="vertical-align: inherit;">Programmers in this area think differently. </font><font style="vertical-align: inherit;">Where an ordinary specialist sees plain text, media programmers notice paragraphs without typography, a short minus instead of a long dash, quotation marks ‚Äúpaws‚Äù instead of ‚ÄúChristmas trees,‚Äù and so on. </font><font style="vertical-align: inherit;">Such details distinguish a serious publication from a random site on the Internet.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">People in the media are constantly "tired of the agenda." </font><font style="vertical-align: inherit;">Probably, plus or minus all people in Meduza suffer from this. </font><font style="vertical-align: inherit;">Every day you are immersed in the agenda, which is usually not very pleasant. </font><font style="vertical-align: inherit;">And under these conditions, various technical problems occur. </font><font style="vertical-align: inherit;">Then Google changed something in the indexes, the Facebook or VKontakte API refused, and they wrote about it in Change Log.</font></font></blockquote><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúThe ability to fine-tune fonts in Flutter came in very handy for Meduza</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><b><font style="vertical-align: inherit;">‚Äù </font></b><font style="vertical-align: inherit;">The publication has long used the same pair of fonts (Proxima Nova and PF Regal), but designers often make small changes to them, which were very difficult to support at home. </font><font style="vertical-align: inherit;">The developers did not want to touch the default components, did not see the changes on a number of devices and so on.</font></font><br>
<blockquote>.     .      .  ,           .      ,   CSS     .        ,    .   ,   .</blockquote><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúAre there plans to scale a team or one Flutter developer enough to write media applications</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><b><font style="vertical-align: inherit;">‚Äù</font></b><font style="vertical-align: inherit;"> The framework really allows you to write a project in solo. In the case of Meduza, the "block API" is used, i.e. the backend dictates the UI what to show. The bottom line is that any Meduza material is an array of typed blocks. As a constructor, from which you can assemble paragraphs, but inside there will be a media player or something else. Plus or minus any block can be displayed in any configuration. The whole application is built on this. At one point, you can take and replace something at any point in the application: send other text, indents, colors, etc. through the backend. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúApplication development plans: optimization and support of new formats before they appear in production‚Äù</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. In the near future, optimization of performance and podcasts for older devices. In the future - to support the launch of new formats exclusively by the backend. That is, so that you can make any changes and features without changes on the Flutter side.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this case, formats mean types of publications: news, cards, long-reads, etc. All of them are actively used by the editors. The main pain since the native was the support of new formats in the application. In the old Webview was used, and there were always situations when the editors came up with a cool format, it was supported on the web, but was not supported by the application. I had to wait until users were updated, and only after that new materials began to be displayed to users on a smartphone. To avoid this, the application should go ahead of the product plan and support features that are not yet in production. So people will have time to update and everything will be realized plus or minus at the same time. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúAt Flutter, it was possible to make the process of launching new features as painless as possible‚Äù</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. In Meduza, the process is as follows. The backend programmer writes the API, opens the application on the phone / simulator. Then he checks that everything matches, and goes on to make the application. No need to write and customize new widgets. Such a scheme has trade-off for performance and trade-off for readability of the code. When the logic of one component or block becomes serious enough, they simply make a widget out of it and the block becomes a new entity. For example, a podcast player was implemented that way. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúWhich part of the application is rendered on Flutter, and which part through WebView‚Äù</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Most elements are rendered on Flutter: containers, texts, typography. The exceptions are embed elements (Twitter, YouTube, Facebook, TikTok) and games that are fully made through WebView. For example, tests for Meduza or custom games with cars, etc. All of them are done from scratch. It is important to know that the WebView in Android on some phones crashes if the WebView is higher in height than the ViewPort device. In the future, get away from WebView in favor of something more ‚ÄúFlutter-native‚Äù, render the same Twitter using data from JSON. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúWhat are your plans for podcasts, how are you planning to improve‚Äù</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Initially, the audioplayers plugin was used, but then it was decided to switch to a bunch of just_audio and audio_service. The player had no problems with the processes, and the second library supported the notifications needed for podcasts. For example, you turn on something to play, and a module comes out on top where you can tap on stop or seek audio, etc. The most difficult thing was to synchronize the UI with something that happens in a separate thread, and also to realize the moment with a curtain and swipe. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúAn application in terms of architecture or why we stopped at Provider‚Äù</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. To maintain the work of such a structure, fewer actions are required: no infinite constants and functions that mutate global states and so on. Of the options considered, the provider logic approached Meduza the most. There are 8 of them in the application. For example, one is responsible for the user's bookmarks, the other is for synchronizing the reading history and podcasts. With its help, they remember the position at which the listener stopped. So he can return on another device and listen to the podcast there. Another provider is responsible for the topics, substitutes where necessary colors are needed or gives them where necessary in the UI. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúBecause of what, the application shows different performance and rendering of the UI on Android and iOS‚Äù</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. The first problem was in the initial data fetching, which was implemented through the Provider, but was not involved in Compute. There are quite a few operations: go for the data in the API, pick up a fairly large JSON, process it, convert it to data and push the result into the model. Because of what, at the start of the application, we observe a drawdown of FPS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another problem is the integration of ads, from which the FPS drawdown occurs on iOS. On Android, there is simply no advertising. When choosing libraries for the application, we stopped at the official AdMob. But, as it turned out, you can‚Äôt integrate a banner into the widget tree there. The developers do not want to use banners on top of the widget tree or fullscreen advertising, as this will greatly affect readers' loyalty.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Meduza team turned to Google and hit the beta test, where the desired ad format on iOS is already being tested. </font><font style="vertical-align: inherit;">In the current version, when the transition is animated, AdMob ads are loaded. </font><font style="vertical-align: inherit;">The benchmark shows that there is a performance drawdown, but not everywhere and not always. </font><font style="vertical-align: inherit;">We are waiting for a fix from the Flutter team. </font><font style="vertical-align: inherit;">The moral is simple: if something needs to be removed from Main Isolate, use Compute. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, despite all the difficulties, Flutter fully met the expectations of the Meduza team. </font><font style="vertical-align: inherit;">Look for the full version of the podcast </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and ask questions in the comments!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en505472/index.html">Useful post: Install OpenShift, learn Kafka, use Ansible on Google Cloud Platform</a></li>
<li><a href="../en505476/index.html">CRUD API on Deno and PostegreSQL: working with a dinosaur</a></li>
<li><a href="../en505478/index.html">Replacing a CRM system with a CRM system</a></li>
<li><a href="../en505488/index.html">12 tips for implementing TypeScript in React applications</a></li>
<li><a href="../en505494/index.html">Developer Framing</a></li>
<li><a href="../en505498/index.html">How we solve the problem of uninitialized stack memory in Windows</a></li>
<li><a href="../en505502/index.html">Omnichannel in customer service: what to look for and how to do everything right?</a></li>
<li><a href="../en505506/index.html">He does not bite: how to make industrial robots safe for workers</a></li>
<li><a href="../en505508/index.html">Not only unmanned technology: the future of the automotive industry</a></li>
<li><a href="../en505510/index.html">Streamlining the Check Point API with the Python SDK</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>