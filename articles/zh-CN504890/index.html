<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ ğŸ¤²ğŸ» ğŸ¤® ä»Powershell invoke-commandè¿”å›å€¼åˆ°SQL-Server Agent ğŸŒ ğŸ”Ÿ ğŸŸ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨è®¸å¤šMS-SQLæœåŠ¡å™¨ä¸Šåˆ›å»ºè‡ªå·±çš„å¤‡ä»½ç®¡ç†æ–¹æ³•æ—¶ï¼Œæˆ‘èŠ±äº†å¾ˆå¤šæ—¶é—´ç ”ç©¶å°†å€¼ä¼ è¾“åˆ°Powershellä»¥è¿›è¡Œè¿œç¨‹è°ƒç”¨çš„æœºåˆ¶ï¼Œæ‰€ä»¥æˆ‘ç»™è‡ªå·±å†™äº†ä¸€ä»½å¤‡å¿˜å½•ï¼Œçªç„¶é—´å®ƒå°†å¯¹å…¶ä»–äººæ´¾ä¸Šç”¨åœºã€‚
 
 å› æ­¤ï¼Œè®©æˆ‘ä»¬ä»¥ä¸€ä¸ªç®€å•çš„è„šæœ¬å¼€å§‹å¹¶åœ¨æœ¬åœ°è¿è¡Œå®ƒï¼š
 
 

$exitcode = $args[0] Write-...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ä»Powershell invoke-commandè¿”å›å€¼åˆ°SQL-Server Agent</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/504890/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è®¸å¤šMS-SQLæœåŠ¡å™¨ä¸Šåˆ›å»ºè‡ªå·±çš„å¤‡ä»½ç®¡ç†æ–¹æ³•æ—¶ï¼Œæˆ‘èŠ±äº†å¾ˆå¤šæ—¶é—´ç ”ç©¶å°†å€¼ä¼ è¾“åˆ°Powershellä»¥è¿›è¡Œè¿œç¨‹è°ƒç”¨çš„æœºåˆ¶ï¼Œæ‰€ä»¥æˆ‘ç»™è‡ªå·±å†™äº†ä¸€ä»½å¤‡å¿˜å½•ï¼Œçªç„¶é—´å®ƒå°†å¯¹å…¶ä»–äººæ´¾ä¸Šç”¨åœºã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å› æ­¤ï¼Œè®©æˆ‘ä»¬ä»¥ä¸€ä¸ªç®€å•çš„è„šæœ¬å¼€å§‹å¹¶åœ¨æœ¬åœ°è¿è¡Œå®ƒï¼š</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$exitcode</span> = <span class="hljs-variable">$args</span>[<span class="hljs-number">0</span>]
<span class="hljs-built_in">Write-Host</span> <span class="hljs-string">'Out to host.'</span>
<span class="hljs-built_in">Write-Output</span> <span class="hljs-string">'Out to output.'</span>
<span class="hljs-built_in">Write-Host</span> (<span class="hljs-string">'ExitCode: '</span> + <span class="hljs-variable">$exitcode</span>)
<span class="hljs-built_in">Write-Output</span> <span class="hljs-variable">$exitcode</span>
<span class="hljs-variable">$host</span>.SetShouldExit(<span class="hljs-variable">$exitcode</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¦è¿è¡Œè„šæœ¬ï¼Œæˆ‘å°†ä½¿ç”¨ä»¥ä¸‹CMDæ–‡ä»¶ï¼Œæˆ‘ä¸ä¼šæ¯æ¬¡éƒ½ç»™å®ƒï¼š</font></font><br>
<br>
<pre><code class="dos hljs">@<span class="hljs-built_in">Echo</span> OFF<font></font>
PowerShell .\TestOutput1.ps1 <span class="hljs-number">1</span>
<span class="hljs-built_in">ECHO</span> <span class="hljs-keyword">ERRORLEVEL</span>=<span class="hljs-variable">%ERRORLEVEL%</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨å±å¹•ä¸Šï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">Out to host.<font></font>
Out to output.<font></font>
ExitCode: 1<font></font>
1<font></font>
ERRORLEVEL=1</code></pre><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œé€šè¿‡WSMANï¼ˆè¿œç¨‹ï¼‰è¿è¡Œç›¸åŒçš„è„šæœ¬ï¼š</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-ComputerName</span> . <span class="hljs-literal">-ScriptBlock</span> { &amp;<span class="hljs-string">'D:\sqlagent\TestOutput1.ps1'</span> <span class="hljs-variable">$args</span>[<span class="hljs-number">0</span>] } <span class="hljs-literal">-ArgumentList</span> <span class="hljs-variable">$args</span>[<span class="hljs-number">0</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç»“æœå¦‚ä¸‹ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">Out to host.<font></font>
Out to output.<font></font>
ExitCode: 2<font></font>
2<font></font>
ERRORLEVEL=0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¥å¥‡çš„æ˜¯ï¼ŒErrorlevelæ¶ˆå¤±åœ¨æŸä¸ªåœ°æ–¹ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦ä»è„šæœ¬ä¸­è·å–å€¼ï¼</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°è¯•ä»¥ä¸‹æ„é€ ï¼š</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$res</span>=<span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-ComputerName</span> . <span class="hljs-literal">-ScriptBlock</span> { &amp;<span class="hljs-string">'D:\sqlagent\TestOutput1.ps1'</span> <span class="hljs-variable">$args</span>[<span class="hljs-number">0</span>] } <span class="hljs-literal">-ArgumentList</span> <span class="hljs-variable">$args</span>[<span class="hljs-number">0</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ›´åŠ æœ‰è¶£ã€‚</font><font style="vertical-align: inherit;">è¾“å‡ºä¸­çš„æ¶ˆæ¯è¾“å‡ºåœ¨æŸå¤„æ¶ˆå¤±äº†ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">Out to host.<font></font>
ExitCode: 2<font></font>
ERRORLEVEL=0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œä½œä¸ºæŠ’æƒ…çš„é¢˜å¤–è¯ï¼Œæˆ‘æ³¨æ„åˆ°ï¼Œå¦‚æœæ‚¨ç¼–å†™Write-Outputæˆ–ä»…å°†è¡¨è¾¾å¼èµ‹ç»™Powershellå‡½æ•°ä¸­çš„ä»»ä½•å˜é‡ï¼ˆè¿™éšå«åœ°æš—ç¤ºäº†è¾“å‡ºåˆ°Outputé€šé“ï¼‰ï¼Œå³ä½¿æ‚¨åœ¨æœ¬åœ°è¿è¡Œå®ƒï¼Œä¹Ÿä¸ä¼šæ˜¾ç¤ºä»»ä½•å†…å®¹ï¼</font><font style="vertical-align: inherit;">è¿™æ˜¯Powershellæµæ°´çº¿ä½“ç³»ç»“æ„çš„ç»“æœ-æ¯ä¸ªå‡½æ•°éƒ½æœ‰å…¶è‡ªå·±çš„è¾“å‡ºæµæ°´çº¿ï¼Œä¸ºå…¶åˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œè¿›å…¥å…¶ä¸­çš„æ‰€æœ‰å†…å®¹å‡è¢«è§†ä¸ºè¯¥å‡½æ•°çš„ç»“æœï¼ŒReturnè¯­å¥å°†è¿”å›å€¼æ·»åŠ åˆ°ä¸æœ€åä¸€ä¸ªå…ƒç´ ç›¸åŒçš„æµæ°´çº¿ä¸­ï¼Œå¹¶å°†æ§åˆ¶æƒè½¬ç§»ç»™è°ƒç”¨å‡½æ•°ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†è¯´æ˜ï¼Œè¯·åœ¨æœ¬åœ°æ‰§è¡Œä»¥ä¸‹è„šæœ¬ï¼š</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-function"><span class="hljs-keyword">Function</span> <span class="hljs-title">Write-Log</span></span> {
  <span class="hljs-keyword">Param</span>( [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span>=<span class="hljs-variable">$false</span>, <span class="hljs-type">ValueFromPipeline</span>=<span class="hljs-variable">$true</span>)] [<span class="hljs-built_in">String</span>[]] <span class="hljs-variable">$OutString</span> = <span class="hljs-string">"`r`n"</span> )
  <span class="hljs-built_in">Write-Output</span> (<span class="hljs-string">"Function: "</span>+<span class="hljs-variable">$OutString</span>)
  <span class="hljs-keyword">Return</span> <span class="hljs-string">"ReturnValue"</span><font></font>
}<font></font>
<span class="hljs-built_in">Write-Output</span> (<span class="hljs-string">"Main: "</span>+<span class="hljs-string">"ParameterValue"</span>)
<span class="hljs-variable">$res</span> = <span class="hljs-built_in">Write-Log</span> <span class="hljs-string">"ParameterValue"</span>
<span class="hljs-variable">$res</span>.GetType()
<span class="hljs-variable">$res</span>.Length
<span class="hljs-variable">$res</span> | <span class="hljs-built_in">Foreach-Object</span> { <span class="hljs-built_in">Write-Host</span> (<span class="hljs-string">"Main: "</span>+<span class="hljs-variable">$_</span>) }
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯ä»–çš„ç»“æœï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">Main: ParameterValue<font></font>
<font></font>
IsPublic IsSerial Name                                     BaseType<font></font>
-------- -------- ----                                     --------<font></font>
True     True     Object[]                                 System.Array<font></font>
2<font></font>
Main: Function: ParameterValue<font></font>
Main: ReturnValue</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸»è¦åŠŸèƒ½ï¼ˆè„šæœ¬ä¸»ä½“ï¼‰ä¹Ÿæœ‰è‡ªå·±çš„è¾“å‡ºç®¡é“ï¼Œå¦‚æœæˆ‘ä»¬ä»CMDè¿è¡Œç¬¬ä¸€ä¸ªè„šæœ¬ï¼Œåˆ™å°†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ï¼Œ </font></font><br>
<br>
<pre><code class="dos hljs">PowerShell .\TestOutput1.ps1 <span class="hljs-number">1</span> &gt; TestOutput1.txt
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç„¶ååœ¨å±å¹•ä¸Šï¼Œæˆ‘ä»¬å°†çœ‹åˆ° </font></font><br>
<br>
<pre><code class="plaintext hljs">ERRORLEVEL=1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¹¶åœ¨æ–‡ä»¶ä¸­ </font></font><br>
<pre><code class="plaintext hljs">Out to host.<font></font>
Out to output.<font></font>
ExitCode: 1<font></font>
1<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœæˆ‘ä»¬ä»Powershellæ‹¨æ‰“ç±»ä¼¼ç”µè¯ </font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">PS</span> D:\sqlagent&gt; .\TestOutput1.ps1 <span class="hljs-number">1</span> &gt; TestOutput1.txt</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é‚£ä¹ˆå±å¹•å°†æ˜¯ </font></font><br>
<br>
<pre><code class="plaintext hljs">Out to host.<font></font>
ExitCode: 1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¹¶åœ¨æ–‡ä»¶ä¸­ </font></font><br>
<br>
<pre><code class="plaintext hljs">Out to output.<font></font>
1</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯å› ä¸ºCMDå¯åŠ¨äº†powershellï¼Œåœ¨æ²¡æœ‰å…¶ä»–æŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œå®ƒæ··â€‹â€‹åˆäº†ä¸¤ä¸ªæµï¼ˆä¸»æœºå’Œè¾“å‡ºï¼‰å¹¶å°†å®ƒä»¬æä¾›ç»™CMDï¼Œåè€…å°†æ¥æ”¶åˆ°çš„æ‰€æœ‰å†…å®¹å‘é€åˆ°æ–‡ä»¶ï¼Œå¦‚æœä»powershellå¯åŠ¨ï¼Œåˆ™è¿™ä¸¤ä¸ªæµåˆ†åˆ«å­˜åœ¨ï¼Œå¹¶ä¸”ç¬¦å·é‡å®šå‘ä»…å½±å“è¾“å‡ºã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å›åˆ°ä¸»é¢˜ï¼Œæˆ‘ä»¬å›æƒ³èµ·Powershellä¸­çš„.NETå¯¹è±¡æ¨¡å‹å®Œå…¨å­˜åœ¨äºä¸€å°è®¡ç®—æœºï¼ˆå•ä¸ªOSï¼‰çš„æ¡†æ¶ä¸­ï¼Œå½“é€šè¿‡WSMANè¿è¡Œè¿œç¨‹ä»£ç æ—¶ï¼Œå¯¹è±¡é€šè¿‡XMLåºåˆ—åŒ–è¿›è¡Œä¼ è¾“ï¼Œè¿™ç»™æˆ‘ä»¬çš„ç ”ç©¶å¸¦æ¥äº†å¾ˆå¤šé¢å¤–çš„å…´è¶£ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬é€šè¿‡è¿è¡Œä»¥ä¸‹ä»£ç æ¥ç»§ç»­å®éªŒï¼š</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$res</span>=<span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-ComputerName</span> . <span class="hljs-literal">-ScriptBlock</span> { &amp;<span class="hljs-string">'D:\sqlagent\TestOutput1.ps1'</span> <span class="hljs-variable">$args</span>[<span class="hljs-number">0</span>] } <span class="hljs-literal">-ArgumentList</span> <span class="hljs-variable">$args</span>[<span class="hljs-number">0</span>]
<span class="hljs-variable">$res</span>.GetType()
<span class="hljs-variable">$host</span>.SetShouldExit(<span class="hljs-variable">$res</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯å±å¹•ä¸Šæ˜¾ç¤ºçš„å†…å®¹ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">Out to host.<font></font>
<font></font>
ExitCode: 3<font></font>
<font></font>
IsPublic IsSerial Name                                     BaseType<font></font>
-------- -------- ----                                     --------<font></font>
True     True     Object[]                                 System.Array<font></font>
    "exitCode",  : "System.Object[]",  "SetShouldExit"   "System.Int32": "    "System.Object[]"  "System.Object[]"   "System<font></font>
.Int32"."<font></font>
D:\sqlagent\TestOutput3.ps1:3 :1<font></font>
+ $host.SetShouldExit($res)<font></font>
+ ~~~~~~~~~~~~~~~~~~~~~~~~~<font></font>
    + CategoryInfo          : NotSpecified: (:) [], MethodException<font></font>
    + FullyQualifiedErrorId : MethodArgumentConversionInvalidCastArgument<font></font>
<font></font>
ERRORLEVEL=0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¥½ç»“æœï¼</font><font style="vertical-align: inherit;">è¿™æ„å‘³ç€è°ƒç”¨Invoke-Commandæ—¶ï¼Œç®¡é“åˆ†ä¸ºä¸¤ä¸ªæµï¼ˆä¸»æœºå’Œè¾“å‡ºï¼‰ï¼Œè¿™ç»™äº†æˆ‘ä»¬æˆåŠŸçš„å¸Œæœ›ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å°è¯•åœ¨Outputæµä¸­ä»…ä¿ç•™ä¸€ä¸ªå€¼ï¼Œä¸ºæ­¤æˆ‘ä»¬æ›´æ”¹äº†è¿œç¨‹è¿è¡Œçš„ç¬¬ä¸€ä¸ªè„šæœ¬ï¼š</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$exitcode</span> = <span class="hljs-variable">$args</span>[<span class="hljs-number">0</span>]
<span class="hljs-built_in">Write-Host</span> <span class="hljs-string">'Out to host.'</span>
<span class="hljs-comment">#Write-Output 'Out to output.'</span>
<span class="hljs-built_in">Write-Host</span> (<span class="hljs-string">'ExitCode: '</span> + <span class="hljs-variable">$exitcode</span>)
<span class="hljs-built_in">Write-Output</span> <span class="hljs-variable">$exitcode</span>
<span class="hljs-variable">$host</span>.SetShouldExit(<span class="hljs-variable">$exitcode</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åƒè¿™æ ·è¿è¡Œå®ƒï¼š</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$res</span>=<span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-ComputerName</span> . <span class="hljs-literal">-ScriptBlock</span> { &amp;<span class="hljs-string">'D:\sqlagent\TestOutput1.ps1'</span> <span class="hljs-variable">$args</span>[<span class="hljs-number">0</span>] } <span class="hljs-literal">-ArgumentList</span> <span class="hljs-variable">$args</span>[<span class="hljs-number">0</span>]
<span class="hljs-variable">$host</span>.SetShouldExit(<span class="hljs-variable">$res</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ˜¯çš„ï¼Œè¿™ä¼¼ä¹æ˜¯èƒœåˆ©ï¼</font></font><br>
<br>
<pre><code class="plaintext hljs">Out to host.<font></font>
ExitCode: 4<font></font>
<font></font>
IsPublic IsSerial Name                                     BaseType<font></font>
-------- -------- ----                                     --------<font></font>
True     True     Int32                                    System.ValueType<font></font>
<font></font>
<font></font>
ERRORLEVEL=4</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬å°è¯•å¼„æ¸…æ¥šæˆ‘ä»¬å‘ç”Ÿäº†ä»€ä¹ˆã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬åœ¨æœ¬åœ°è°ƒç”¨äº†powershellï¼Œç„¶ååˆåœ¨è¿œç¨‹è®¡ç®—æœºä¸Šè°ƒç”¨äº†powershellå¹¶åœ¨é‚£é‡Œæ‰§è¡Œäº†è„šæœ¬ã€‚</font><font style="vertical-align: inherit;">æ¥è‡ªè¿œç¨‹æœºå™¨çš„ä¸¤ä¸ªæµï¼ˆä¸»æœºå’Œè¾“å‡ºï¼‰è¢«åºåˆ—åŒ–å¹¶ä¼ è¾“å›å»ï¼Œå¦‚æœè¾“å‡ºæµä¸­æœ‰ä¸€ä¸ªæ•°å­—å€¼ï¼Œåˆ™å°†å…¶è½¬æ¢ä¸ºInt32ç±»å‹å¹¶ä»¥è¿™ç§å½¢å¼å‘é€åˆ°æ¥æ”¶ç«¯ï¼Œæ¥æ”¶ç«¯å°†å…¶ç”¨ä½œè°ƒç”¨é€€å‡ºä»£ç ç”µæºå¤–å£³ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€åï¼Œæˆ‘ä»¬å°†åœ¨SQL Serverä¸Šåˆ›å»ºä¸€ä¸ªç±»å‹ä¸ºâ€œæ“ä½œç³»ç»Ÿï¼ˆcmdexecï¼‰â€çš„å•æ­¥ä»»åŠ¡ï¼Œå¹¶å¸¦æœ‰ä»¥ä¸‹æ–‡æœ¬ï¼š</font></font><br>
<br>
<pre><code class="dos hljs">PowerShell -NonInteractive -NoProfile "$res=Invoke-Command -ComputerName BACKUPSERVER -ConfigurationName SQLAgent -ScriptBlock {&amp;'D:\sqlagent\TestOutput1.ps1' <span class="hljs-number">6</span>}; $host.SetShouldExit($res)"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å“‡ï¼</font><font style="vertical-align: inherit;">ä»»åŠ¡å¤±è´¥ï¼Œæ—¥å¿—ä¸­çš„æ–‡æœ¬ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">   : DOMAIN\agentuser. Out to host. ExitCode: 6.     6.     .
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘ç°ï¼š</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¿å…ä½¿ç”¨Write-Outputå¹¶æŒ‡å®šæœªåˆ†é…çš„è¡¨è¾¾å¼ã€‚</font><font style="vertical-align: inherit;">è¯·è®°ä½ï¼Œå°†æ­¤ä»£ç ç§»åˆ°è„šæœ¬ä¸­çš„å…¶ä»–ä½ç½®å¯èƒ½ä¼šå¯¼è‡´æ„å¤–ç»“æœã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ä¸æ˜¯ç”¨äºæ‰‹åŠ¨å¯åŠ¨çš„è„šæœ¬ä¸­ï¼Œè€Œæ˜¯åœ¨è‡ªåŠ¨åŒ–æœºåˆ¶ä¸­ä½¿ç”¨çš„è„šæœ¬ï¼ˆå°¤å…¶æ˜¯ç”¨äºé€šè¿‡WINRMè¿›è¡Œçš„è¿œç¨‹è°ƒç”¨ï¼‰ä¸­ï¼Œè¯·é€šè¿‡Try / Catchè¿›è¡Œæ‰‹åŠ¨é”™è¯¯å¤„ç†ï¼Œå¹¶ç¡®ä¿æ­¤è„šæœ¬å‘äº‹ä»¶æµçš„ä»»ä½•å‘é€éƒ½å‡†ç¡®åœ°å‘é€åˆ°OutputæµåŸºæœ¬ç±»å‹å€¼ã€‚</font><font style="vertical-align: inherit;">å¦‚æœè¦è·å–ç»å…¸çš„Errorlevelï¼Œåˆ™æ­¤å€¼å¿…é¡»ä¸ºæ•°å­—ã€‚</font></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN504878/index.html">109é¡¹æ•°æ®ç§‘å­¦å…è´¹è¯¾ç¨‹</a></li>
<li><a href="../zh-CN504880/index.html">åœ¨Unityä¸Šå¼€å‘ï¼Œä¼˜åŒ–å’Œå‘å¸ƒåˆæˆæ¸¸æˆ</a></li>
<li><a href="../zh-CN504884/index.html">å±é™©å¤–å›´è®¾å¤‡ï¼šäº†è§£Thunderspy</a></li>
<li><a href="../zh-CN504886/index.html">Selenium WebDriverä¸ºå¼€å‘äººå‘˜æœåŠ¡</a></li>
<li><a href="../zh-CN504888/index.html">â€œå†·é™ï¼Œåªæœ‰å†·é™ï¼â€ æˆ–æ›´å°‘çš„æ‹…å¿ƒ</a></li>
<li><a href="../zh-CN504894/index.html">ä¿„è¯­çš„GUIæˆ–VKSç»ˆç«¯æœºè‡ªå·±åš</a></li>
<li><a href="../zh-CN504902/index.html">2020å¹´è‡ªåŠ¨åŒ–æµ‹è¯•çš„9å¤§è¶‹åŠ¿</a></li>
<li><a href="../zh-CN504906/index.html">PHP-è¯­è¨€çš„åˆ©åŸºæ˜¯ä»€ä¹ˆï¼ŒPHP8å°†å¸®åŠ©è§£å†³ç´§è¿«çš„é—®é¢˜ï¼ˆç ´åè€…ï¼šæ•æˆ‘ç›´è¨€ï¼‰</a></li>
<li><a href="../zh-CN504908/index.html">PyTrace-ç”¨äºPythonçš„æ—¶é—´æ—…è¡Œè°ƒè¯•å™¨</a></li>
<li><a href="../zh-CN504912/index.html">HackTheBoxæ®‹å±€ã€‚é€šè¿‡å®éªŒå®¤çš„ä¸“ä¸šè¿›æ”»è¡ŒåŠ¨ã€‚Pentestæ´»åŠ¨ç›®å½•</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>