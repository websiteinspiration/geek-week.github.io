<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥈 ⛰️ 😺 RxDart：マジックストリーム変換 👼🏻 👩🏿‍🔬 👂🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ようこそ-これは、Flutterアーキテクチャに関する一連の記事の第3部です。
 

- 前書き 
- Dart Streamsの基本
- RxDart：スレッドの魔法の変換（この投稿）
- RxVMSの基本：RxCommandとGetIt
- RxVMS：サービスとマネージャー
- RxVMS：自...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>RxDart：マジックストリーム変換</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451292/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ようこそ-これは、Flutterアーキテクチャに関する一連の記事の第3部です。</font></font></p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き </font></font></a> </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dart Streamsの基本</font></font></a></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RxDart：スレッドの魔法の変換（この投稿）</font></font></strong></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RxVMSの基本：RxCommandとGetIt</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RxVMS：サービスとマネージャー</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RxVMS：自己完結型ウィジェット</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RxVMSによるユーザー認証</font></font></li>
</ul><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今回は、リアクティブ拡張（Rx）の魔法の領域に少し飛び込みます。</font><font style="vertical-align: inherit;">最もよく使用されるRx関数に焦点を当て、それらのアプリケーションについて説明します。</font><font style="vertical-align: inherit;">以前の投稿を読んでいない場合は、先に進む前に今がその機会です。</font></font></p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RxDart</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、Dart言語のRxコンセプトの実装です</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。FrankPepermans</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Brian Eganの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">おかげです</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以前に他の言語でRxを使用したことがある場合は、多くの関数の名前の違いに気付くでしょうが、これが問題を引き起こすことはほとんどありません。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テスト用のコードは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちら</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font></p><br>
<p>                 ,      .     ,  Rx   Streams.</p><a name="habracut"></a><br>
<h2 id="sozdanie-observables"> Observables</h2><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>, Observables —  Rx-    .      :</p><br>
<h3 id="iz-potoka"> </h3><br>
<p> Stream     Observable     :</p><br>
<pre><code class="cpp hljs">var controller = <span class="hljs-keyword">new</span> StreamController&lt;String&gt;();<font></font>
<font></font>
var streamObservable = <span class="hljs-keyword">new</span> Observable(controller.stream);<font></font>
<font></font>
streamObservable.listen(print);</code></pre><br>
<h3 id="povtoryayuschiesya-sobytiya"> </h3><br>
<pre><code class="cpp hljs">var timerObservable = Observable.periodic(Duration(seconds: <span class="hljs-number">1</span>), (x) =&gt; x.toString() );<font></font>
<font></font>
timerObservable.listen(print);</code></pre><br>
<p>    Observable,     .    .</p><br>
<h3 id="iz-odinochnogo-znacheniya">  </h3><br>
<p> API  Stream/Observable ,     .    Observable  .</p><br>
<pre><code class="cpp hljs">var justObservable = Observable&lt;<span class="hljs-keyword">int</span>&gt;.just(<span class="hljs-number">42</span>);<font></font>
<font></font>
justObservable.listen(print);<font></font>
<font></font>
<span class="hljs-comment">//   : 42</span></code></pre><br>
<h3 id="iz-future"> Future</h3><br>
<pre><code class="cpp hljs">  <span class="hljs-function">Future&lt;String&gt; <span class="hljs-title">asyncFunction</span><span class="hljs-params">()</span> async </span>{
    <span class="hljs-keyword">return</span> Future.delayed(<span class="hljs-keyword">const</span> Duration(seconds: <span class="hljs-number">1</span>), () =&gt; <span class="hljs-string">"AsyncRsult"</span>);<font></font>
  }<font></font>
<font></font>
  test(<span class="hljs-string">'Create Observable from Future'</span>, () async {<font></font>
    print(<span class="hljs-string">'start'</span>);<font></font>
<font></font>
    var fromFutureObservable = Observable.fromFuture(asyncFunction());<font></font>
<font></font>
    fromFutureObservable.listen(print);</code></pre><br>
<p> <code>Observable</code>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Future</a>    Future       <code>null</code>,    .       Future —   <code>toStream()</code>   Future.</p><br>
<p>   ,    Future  Observable/Stream  ,    .  ,   ,        ,   " ".</p><br>
<h3 id="subjects">Subjects</h3><br>
<p><code>Subjects</code>   <code>StreamController</code>  RxDart,       -   .</p><br>
<p>       StreamControllers:</p><br>
<ul>
<li>   <code>listen()</code>   Subject,     Stream</li>
<li>   ,          </li>
<li>   Subjects,     :</li>
</ul><br>
<h4 id="publishsubjects">PublishSubjects</h4><br>
<p><code>PublishSubjects</code>    <code>StreamControllers</code>,     :</p><br>
<pre><code class="cpp hljs">var subject = <span class="hljs-keyword">new</span> PublishSubject&lt;String&gt;();<font></font>
<font></font>
subject.listen((item) =&gt; print(item)); <font></font>
<font></font>
subject.add(<span class="hljs-string">"Item1"</span>);<font></font>
<font></font>
<span class="hljs-comment">//   </span><font></font>
subject.listen((item) =&gt; print(item.toUpperCase())); <font></font>
<font></font>
subject.add(<span class="hljs-string">"Item2"</span>);<font></font>
subject.add(<span class="hljs-string">"Item3"</span>);<font></font>
<font></font>
<span class="hljs-comment">//        </span>
await Future.delayed(Duration(seconds: <span class="hljs-number">5</span>));<font></font>
<font></font>
<span class="hljs-comment">//   </span>
subject.close;</code></pre><br>
<p>     :</p><br>
<pre><code class="cpp hljs">Item1<font></font>
ITEM2<font></font>
Item2<font></font>
ITEM3<font></font>
Item3</code></pre><br>
<p>,   ,    (     ),   .   ,   <code>BehaviourSubject</code></p><br>
<h4 id="behavioursubject">BehaviourSubject</h4><br>
<p> <code>BehaviourSubject</code>        :</p><br>
<pre><code class="cpp hljs">var subject = <span class="hljs-keyword">new</span> BehaviorSubject&lt;String&gt;();<font></font>
<font></font>
subject.listen((item) =&gt; print(item)); <font></font>
<font></font>
subject.add(<span class="hljs-string">"Item1"</span>);<font></font>
subject.add(<span class="hljs-string">"Item2"</span>);<font></font>
<font></font>
subject.listen((item) =&gt; print(item.toUpperCase())); <font></font>
<font></font>
subject.add(<span class="hljs-string">"Item3"</span>);</code></pre><br>
<p> </p><br>
<pre><code class="cpp hljs">Item1<font></font>
ITEM2<font></font>
ITEM3<font></font>
Item2<font></font>
Item3</code></pre><br>
<p>  ,  <code>Item1</code>    ,    <code>Item2</code>.     ,     <code>Item3</code>  ,     <code>Item2</code>.  ,      ,        . <code>BehaviourSubject</code>        .      ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">ReplaySubject</a>.      .</p><br>
<h2 id="manipulirovanie-dannymi-na-letu">   </h2><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/ea5/dfe/1c6/ea5dfe1c65f93367e3207e2a0fe68908.gif"> </p><br>
<p>  Rx   ,          .   Rx-       (  ), ,         ,    Rx   .</p><br>
<h3 id="map">Map</h3><br>
<p>  -  Stream,       ,   <code>map()</code>.   <code>map()</code>,   ,             ,       .  :</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/8e0/05a/ecc/8e005aecc11e119b7c856a4cadec9b11.gif"> </p><br>
<pre><code class="cpp hljs">var subject = <span class="hljs-keyword">new</span> PublishSubject&lt;String&gt;();<font></font>
<font></font>
subject.<span class="hljs-built_in">map</span>((item) =&gt; item.toUpperCase()).listen(print);<font></font>
<font></font>
subject.add(<span class="hljs-string">"Item1"</span>);<font></font>
subject.add(<span class="hljs-string">"Item2"</span>);<font></font>
subject.add(<span class="hljs-string">"Item3"</span>);</code></pre><br>
<p>:</p><br>
<pre><code class="cpp hljs">ITEM1<font></font>
ITEM2<font></font>
ITEM3</code></pre><br>
<p> <code>map</code>       ,      .        .      :</p><br>
<pre><code class="cpp hljs">var subject = <span class="hljs-keyword">new</span> PublishSubject&lt;<span class="hljs-keyword">int</span>&gt;();<font></font>
<font></font>
subject.<span class="hljs-built_in">map</span>((intValue) =&gt; intValue.toString())<font></font>
    .<span class="hljs-built_in">map</span>((item) =&gt; item.toUpperCase())<font></font>
    .listen(print);<font></font>
<font></font>
subject.add(<span class="hljs-number">1</span>);<font></font>
subject.add(<span class="hljs-number">2</span>);<font></font>
subject.add(<span class="hljs-number">3</span>);</code></pre><br>
<p> -  :</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/0bb/73f/2a2/0bb73f2a2ccb82e6a920efbf2c395b0d.gif"> </p><br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataClass</span>{</span>}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WrapperClass</span> {</span>
  <span class="hljs-keyword">final</span> DataClass wrapped;<font></font>
<font></font>
  WrapperClass(<span class="hljs-keyword">this</span>.wrapped); <font></font>
}<font></font>
<font></font>
var subject = <span class="hljs-keyword">new</span> PublishSubject&lt;WrapperClass&gt;();<font></font>
<font></font>
subject.<span class="hljs-function"><span class="hljs-built_in">map</span>&lt;WrapperClass&gt;<span class="hljs-params">((a) =&gt; <span class="hljs-keyword">new</span> WrapperClass(a))</span></span>;</code></pre><br>
<p>     <code>.map</code> —          REST API      ,       :</p><br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> {</span>
  <span class="hljs-keyword">final</span> String name;
  <span class="hljs-keyword">final</span> String adress;
  <span class="hljs-keyword">final</span> String phoneNumber;
  <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> age;<font></font>
<font></font>
  <span class="hljs-comment">//       - </span>
  <span class="hljs-comment">//  </span><font></font>
  factory User.fromJson(String jsonString) {<font></font>
    var jsonMap = json.decode(jsonString);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> User(<font></font>
      jsonMap[<span class="hljs-string">'name'</span>],<font></font>
      jsonMap[<span class="hljs-string">'adress'</span>],<font></font>
      jsonMap[<span class="hljs-string">'phoneNumber'</span>],<font></font>
      jsonMap[<span class="hljs-string">'age'</span>],<font></font>
    );<font></font>
  }<font></font>
<font></font>
  User(<span class="hljs-keyword">this</span>.name, <span class="hljs-keyword">this</span>.adress, <span class="hljs-keyword">this</span>.phoneNumber, <span class="hljs-keyword">this</span>.age);<font></font>
<font></font>
  @<span class="hljs-function"><span class="hljs-keyword">override</span>
  String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">'$name - $adress - $phoneNumber - $age'</span>;<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<font></font>
  test(<span class="hljs-string">'Map'</span>, () {
    <span class="hljs-comment">// - </span><font></font>
    var jsonStrings = [<font></font>
      <span class="hljs-string">'{"name": "Jon Doe", "adress": "New York", "phoneNumber":"424242","age": 42 }'</span>,
      <span class="hljs-string">'{"name": "Stephen King", "adress": "Castle Rock", "phoneNumber":"123456","age": 71 }'</span>,
      <span class="hljs-string">'{"name": "Jon F. Kennedy", "adress": "Washington", "phoneNumber":"111111","age": 66 }'</span>,<font></font>
    ];<font></font>
<font></font>
    <span class="hljs-comment">//   json-,    API/DB.</span>
    var dataStreamFromAPI = <span class="hljs-keyword">new</span> PublishSubject&lt;String&gt;();<font></font>
<font></font>
    dataStreamFromAPI<font></font>
        .<span class="hljs-built_in">map</span>&lt;User&gt;((jsonString) =&gt; User.fromJson(jsonString)) <span class="hljs-comment">// json -&gt; User</span><font></font>
        .listen((user) =&gt; print(user.toString()));<font></font>
<font></font>
    <span class="hljs-comment">//   </span>
    dataStreamFromAPI.add(jsonStrings[<span class="hljs-number">0</span>]);<font></font>
    dataStreamFromAPI.add(jsonStrings[<span class="hljs-number">1</span>]);<font></font>
    dataStreamFromAPI.add(jsonStrings[<span class="hljs-number">2</span>]);<font></font>
  });</code></pre><br>
<p><em>,   Streams,    Iterable   <code>map</code>,        .</em></p><br>
<h3 id="where">Where</h3><br>
<p>     ,   ,     <code>.where()</code>    <code>if</code>   ,       :</p><br>
<pre><code class="cpp hljs">var subject = <span class="hljs-keyword">new</span> PublishSubject&lt;<span class="hljs-keyword">int</span>&gt;();<font></font>
<font></font>
subject.where((val) =&gt; val.isOdd)<font></font>
    .listen( (val) =&gt; print(<span class="hljs-string">'This only prints odd numbers: $val'</span>));<font></font>
<font></font>
subject.where((val) =&gt; val.isEven)<font></font>
.listen( (val) =&gt; print(<span class="hljs-string">'This only prints even numbers: $val'</span>));<font></font>
<font></font>
subject.add(<span class="hljs-number">1</span>);<font></font>
subject.add(<span class="hljs-number">2</span>);<font></font>
subject.add(<span class="hljs-number">3</span>);<font></font>
<font></font>
<span class="hljs-comment">//:</span>
This only prints odd numbers: <span class="hljs-number">1</span>
This only prints even numbers: <span class="hljs-number">2</span>
This only prints odd numbers: <span class="hljs-number">3</span></code></pre><br>
<h3 id="debounce">Debounce</h3><br>
<p>     Rx! ,      ,    API REST,    .   API      .  ,            .      <code>debounce()</code>,     ,      .</p><br>
<pre><code class="cpp hljs">var subject = <span class="hljs-keyword">new</span> PublishSubject&lt;String&gt;();<font></font>
<font></font>
subject.debounce(<span class="hljs-keyword">new</span> Duration(milliseconds: <span class="hljs-number">500</span>)).listen((s) =&gt; print(s));<font></font>
<font></font>
subject.add(<span class="hljs-string">'A'</span>);<font></font>
subject.add(<span class="hljs-string">'AB'</span>);<font></font>
<font></font>
await Future.delayed(Duration(milliseconds: <span class="hljs-number">200</span>));<font></font>
<font></font>
subject.add(<span class="hljs-string">"ABC"</span>);
<span class="hljs-comment">//   </span><font></font>
<font></font>
await Future.delayed(Duration(milliseconds: <span class="hljs-number">700</span>));<font></font>
<font></font>
<span class="hljs-comment">//       : 'ABC'</span></code></pre><br>
<p>,     <code>TextField.onChanged</code>  <code>Observable</code>,    .</p><br>
<h3 id="expand">Expand</h3><br>
<p>   Stream   ,       ,    <code>.expand</code>,    :</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/e8e/8d7/2b3/e8e8d72b36dddd0d3469107c6cdae2b1.gif" alt="画像"></p><br>
<p>     ,   FireStore.</p><br>
<h3 id="merge">Merge</h3><br>
<p>      ,       ,    <code>.mergeWith</code> (   Rx  <code>merge</code>),         .</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/a2f/9ba/82b/a2f9ba82b88b555841c21dc623c3d298.gif" alt="画像"></p><br>
<p><code>.mergeWith</code>    -      .     .</p><br>
<p>,      ,      ,   ,      ,       ():</p><br>
<pre><code class="cpp hljs">@<span class="hljs-function"><span class="hljs-keyword">override</span>
<span class="hljs-title">initState</span><span class="hljs-params">()</span> </span>{<font></font>
  super.initState();<font></font>
<font></font>
  component1.errors.mergeWith([component2.errors])<font></font>
    .listen( (error) async =&gt; await showDialog(error.message));<font></font>
}</code></pre><br>
<p>          ,     ():</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">final</span> observableTwitter = getTwitterStream().<span class="hljs-built_in">map</span>((data) =&gt; <span class="hljs-keyword">new</span> MyAppPost.fromTwitter(data));
<span class="hljs-keyword">final</span> observableFacebook = getFacebookStream().<span class="hljs-built_in">map</span>((data) =&gt; <span class="hljs-keyword">new</span> MyAppPost.fromFaceBook(data));
<span class="hljs-keyword">final</span> postStream = observableTwitter.mergeWith([observableFacebook]);</code></pre><br>
<h3 id="zipwith">ZipWith</h3><br>
<p><code>zipWith</code>      . ,    <code>.mergeWith</code>,    ,          .  ,        ,    ,   <code>zipper</code>-:</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/5ef/611/847/5ef611847db6bfa40237fb3622d93822.gif" alt="画像"></p><br>
<p> <code>zipWith</code>  ,     :</p><br>
<pre><code class="cpp hljs"><span class="hljs-comment">// R :   Stream/Observable</span>
<span class="hljs-comment">// S :   Stream/Observable</span>
<span class="hljs-comment">// zipper: -</span>
Observable&lt;R&gt; zipWith&lt;S, R&gt;(Stream&lt;S&gt; other, R zipper(T t, S s))</code></pre><br>
<p>  :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">new</span> Observable.just(<span class="hljs-number">1</span>) <span class="hljs-comment">// .just()  Observable,   </span>
    .zipWith(<span class="hljs-keyword">new</span> Observable.just(<span class="hljs-number">2</span>), (one, two) =&gt; one + two)<font></font>
    .listen(print); <span class="hljs-comment">//  3</span></code></pre><br>
<p>   —       ,   <code>Future</code>,     ,      .         REST API:   <code>User</code>,  — <code>Product</code>    JSON,      ,     <code>Invoice</code>.</p><br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Invoice</span> {</span>
  <span class="hljs-keyword">final</span> User user;
  <span class="hljs-keyword">final</span> Product product;<font></font>
<font></font>
  Invoice(<span class="hljs-keyword">this</span>.user, <span class="hljs-keyword">this</span>.product);<font></font>
<font></font>
  printInvoice() {<font></font>
    print(user.toString());<font></font>
    print(product.toString());<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  HTTP ,  Product,  JSON</span>
<span class="hljs-function">Future&lt;String&gt; <span class="hljs-title">getProduct</span><span class="hljs-params">()</span> async </span>{<font></font>
  print(<span class="hljs-string">"Started getting product"</span>);<font></font>
  await Future.delayed(Duration(seconds: <span class="hljs-number">2</span>));<font></font>
  print(<span class="hljs-string">"Finished getting product"</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-string">'{"name": "Flux compensator", "price": 99999.99}'</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  HTTP ,  User,  JSON</span>
<span class="hljs-function">Future&lt;String&gt; <span class="hljs-title">getUser</span><span class="hljs-params">()</span> async </span>{<font></font>
  print(<span class="hljs-string">"Started getting User"</span>);<font></font>
  await Future.delayed(Duration(seconds: <span class="hljs-number">4</span>));<font></font>
  print(<span class="hljs-string">"Finished getting User"</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-string">'{"name": "Jon Doe", "adress": "New York", "phoneNumber":"424242","age": 42 }'</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<font></font>
  test(<span class="hljs-string">'zipWith'</span>, () async {<font></font>
    var userObservable =<font></font>
        Observable.fromFuture(getUser()).<span class="hljs-built_in">map</span>&lt;User&gt;((jsonString) =&gt; User.fromJson(jsonString));<font></font>
<font></font>
    var productObservable = Observable.fromFuture(getProduct())<font></font>
        .<span class="hljs-built_in">map</span>&lt;Product&gt;((jsonString) =&gt; Product.fromJson(jsonString));<font></font>
<font></font>
    Observable&lt;Invoice&gt; invoiceObservable = userObservable.zipWith&lt;Product, Invoice&gt;(<font></font>
        productObservable, (user, product) =&gt; Invoice(user, product));<font></font>
<font></font>
    print(<span class="hljs-string">"Start listening for invoices"</span>);<font></font>
    invoiceObservable.listen((invoice) =&gt; invoice.printInvoice());<font></font>
<font></font>
    <span class="hljs-comment">//       </span>
    await Future.delayed(Duration(seconds: <span class="hljs-number">5</span>));<font></font>
  });<font></font>
}</code></pre><br>
<p>  ,   ,    </p><br>
<pre><code class="cpp hljs">Started getting User<font></font>
Started getting product<font></font>
Start listening <span class="hljs-keyword">for</span> invoices<font></font>
Finished getting product<font></font>
Finished getting User<font></font>
Jon Doe - New York - <span class="hljs-number">424242</span> - <span class="hljs-number">42</span>
Flux compensator - <span class="hljs-number">99999.99</span></code></pre><br>
<h3 id="combinelatest">CombineLatest</h3><br>
<p><code>combineLatest</code>    ,   -,  <code>merge</code>  <code>zip</code>.           ,        .  ,       ,         .     :</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/633/acb/bee/633acbbee01158bb7a6ad0450d39f712.gif" alt="画像"></p><br>
<p> ,  <code>combineLates</code>    ,           .</p><br>
<p>   ,   , <code>combineLatest</code> —  .  ,  Dart    ,   <code>combLastest</code>      : <strong>combineLatest2...combineLatest9</strong></p><br>
<p>  <code>combineLatest</code>, ,      <code>Observable&lt;bool&gt;</code>,    ,      ,      "",     .      ():</p><br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Model</span> {</span>
  Observable&lt;<span class="hljs-keyword">bool</span>&gt; get isBusy =&gt; <font></font>
    Observable.combineLatest2(isBusyOne,isBusyTwo, (b1, b2) =&gt; b1 || b2);<font></font>
<font></font>
  PublishSubject&lt;<span class="hljs-keyword">bool</span>&gt; isBusyOne;<font></font>
  PublishSubject&lt;<span class="hljs-keyword">bool</span>&gt; isBusyTwo;<font></font>
}</code></pre><br>
<p>  UI    <code>isBusy</code>  <code>StreamBuilder</code>   <code>Spinner</code>,    .</p><br>
<p><code>combineLatest</code>        <strong>FireStore snapshots</strong>.</p><br>
<p>,     ,        .            FireStore.   .        StreamBuilder.  <code>combineLatest</code>  :</p><br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WeatherForecast</span> {</span>
  <span class="hljs-keyword">final</span> String forecastText;
  <span class="hljs-keyword">final</span> GeoPoint location;<font></font>
<font></font>
  factory WeatherForecast.fromMap(Map&lt;String, dynamic&gt; <span class="hljs-built_in">map</span>) {
    <span class="hljs-keyword">return</span> WeatherForecast(<span class="hljs-built_in">map</span>[<span class="hljs-string">'forecastText'</span>], <span class="hljs-built_in">map</span>[<span class="hljs-string">'location'</span>]);<font></font>
  }<font></font>
<font></font>
  WeatherForecast(<span class="hljs-keyword">this</span>.forecastText, <span class="hljs-keyword">this</span>.location);<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NewsMessage</span> {</span>
  <span class="hljs-keyword">final</span> String newsText;
  <span class="hljs-keyword">final</span> GeoPoint location;<font></font>
<font></font>
  factory NewsMessage.fromMap(Map&lt;String, dynamic&gt; <span class="hljs-built_in">map</span>) {
    <span class="hljs-keyword">return</span> NewsMessage(<span class="hljs-built_in">map</span>[<span class="hljs-string">'newsText'</span>], <span class="hljs-built_in">map</span>[<span class="hljs-string">'location'</span>]);<font></font>
  }<font></font>
<font></font>
  NewsMessage(<span class="hljs-keyword">this</span>.newsText, <span class="hljs-keyword">this</span>.location);<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CombinedMessage</span> {</span>
  <span class="hljs-keyword">final</span> WeatherForecast forecast;
  <span class="hljs-keyword">final</span> NewsMessage newsMessage;<font></font>
<font></font>
  CombinedMessage(<span class="hljs-keyword">this</span>.forecast, <span class="hljs-keyword">this</span>.newsMessage);<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Model</span> {</span><font></font>
  CollectionReference weatherCollection;<font></font>
  CollectionReference newsCollection;<font></font>
<font></font>
  Model() {<font></font>
    weatherCollection = Firestore.instance.collection(<span class="hljs-string">'weather'</span>);<font></font>
    newsCollection = Firestore.instance.collection(<span class="hljs-string">'news'</span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function">Observable&lt;CombinedMessage&gt; <span class="hljs-title">getCombinedMessages</span><span class="hljs-params">()</span> </span>{<font></font>
    Observable&lt;WeatherForecast&gt; weatherForecasts = weatherCollection<font></font>
        .snapshots()<font></font>
        .expand((snapShot) =&gt; snapShot.documents)<font></font>
        .<span class="hljs-built_in">map</span>&lt;WeatherForecast&gt;((document) =&gt; WeatherForecast.fromMap(document.data));<font></font>
<font></font>
    Observable&lt;NewsMessage&gt; news = newsCollection<font></font>
        .snapshots()<font></font>
        .expand((snapShot) =&gt; snapShot.documents)<font></font>
        .<span class="hljs-built_in">map</span>&lt;NewsMessage&gt;((document) =&gt; NewsMessage.fromMap(document.data));<font></font>
<font></font>
    <span class="hljs-keyword">return</span> Observable.combineLatest2(<font></font>
        weatherForecasts, news, (weather, news) =&gt; CombinedMessage(weather, news));<font></font>
  }<font></font>
}</code></pre><br>
<p>  UI    - : <code>StreamBuilder&lt;CombinedMessage&gt;(stream: model.getCombinedMessages(),...).</code></p><br>
<h3 id="distinct">Distinct</h3><br>
<p>     ,  <strong>isBusyOne</strong>  <strong>isBusyTwo</strong>      ,          .   ,    <code>.distinct()</code>.  ,         ,       .  ,     :</p><br>
<pre><code class="cpp hljs">  Observable&lt;<span class="hljs-keyword">bool</span>&gt; isBusy =&gt; isBusyOne.mergeWith([isBusyTwo]).distinct();</code></pre><br>
<p>   ,           .</p><br>
<h3 id="asyncmap">AsyncMap</h3><br>
<p> <code>map()</code>    <code>asyncMap</code>,        map-.         FireStore.   <strong>WeatherForecast</strong>    <strong>NewsMessage</strong>        <strong>NewsMessage</strong>:</p><br>
<pre><code class="cpp hljs"><span class="hljs-function">Observable&lt;CombinedMessage&gt; <span class="hljs-title">getDependendMessages</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
  Observable&lt;NewsMessage&gt; news = newsCollection.snapshots().expand((snapShot) {<font></font>
    <span class="hljs-keyword">return</span> snapShot.documents;<font></font>
  }).<span class="hljs-built_in">map</span>&lt;NewsMessage&gt;((document) {
    <span class="hljs-keyword">return</span> NewsMessage.fromMap(document.data);<font></font>
  });<font></font>
<font></font>
  <span class="hljs-keyword">return</span> news.asyncMap((newsEntry) async {<font></font>
    var weatherDocuments =<font></font>
        await weatherCollection.where(<span class="hljs-string">'location'</span>, isEqualTo: newsEntry.location).getDocuments();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CombinedMessage(<font></font>
        WeatherForecast.fromMap(weatherDocuments.documents.first.data), newsEntry);<font></font>
  });<font></font>
}</code></pre><br>
<p>Observable,  getDependendMessages,    CombinedMessage  ,   newsCollection.</p><br>
<h2 id="otladka-observables"> Observables</h2><br>
<p>     Rx ,       :</p><br>
<pre><code class="cpp hljs">Observable&lt;NewsMessage&gt; news = newsCollection<font></font>
    .snapshots()<font></font>
    .expand((snapShot) =&gt; snapShot.documents)<font></font>
    .<span class="hljs-built_in">map</span>&lt;NewsMessage&gt;((document) =&gt; NewsMessage.fromMap(document.data));</code></pre><br>
<p>   ,  <code>=&gt;</code> —       .  <strong>Convert to block body</strong>,  :</p><br>
<pre><code class="cpp hljs">Observable&lt;NewsMessage&gt; news = newsCollection<font></font>
        .snapshots()<font></font>
        .expand((snapShot) {<font></font>
          <span class="hljs-keyword">return</span> snapShot.documents;<font></font>
        })<font></font>
        .<span class="hljs-built_in">map</span>&lt;NewsMessage&gt;((document) {
          <span class="hljs-keyword">return</span> NewsMessage.fromMap(document.data);<font></font>
        });</code></pre><br>
<p>               "".</p><br>
<h2 id="osteregaytes-pobochnyh-effektov">  </h2><br>
<p><strong>      Rx,      ,    ,  Rx —       "  ".     ,   - /   ,      .listen. </strong><br>
 ,   :</p><br>
<pre><code class="cpp hljs">Observable.fromFuture(getProduct())<font></font>
        .<span class="hljs-built_in">map</span>&lt;Product&gt;((jsonString) { <font></font>
     var product = Product.fromJson(jsonString);<font></font>
    database.save(product);<font></font>
    setState((){ _product =  product });<font></font>
    <span class="hljs-keyword">return</span> product;<font></font>
}).listen();</code></pre><br>
<p> :</p><br>
<pre><code class="cpp hljs">Observable.fromFuture(getProduct())<font></font>
        .<span class="hljs-built_in">map</span>&lt;Product&gt;((jsonString) =&gt; Product.fromJson(jsonString))<font></font>
        .listen( (product) {<font></font>
          database.save(product);  <font></font>
          setState((){ _product =  product });<font></font>
        });</code></pre><br>
<p> <code>map()</code> —    ,   !      - ,      ,   ,      .</p><br>
<h2 id="nekotorye-mysli-ob-osvobozhdenii-resursov">    </h2><br>
<p>   ,   <code>cancel()</code>  , <code>dispose()</code>  StreamControllers, <code>close()</code>  Subjects,       .</p><br>
<h2 id="zaklyuchenie"></h2><br>
<p>,        .       Rx,    ,      ,       <strong>RxVMS</strong>.</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja451274/index.html">完璧な武器、視点の戦争、そして天井に到達する人間</a></li>
<li><a href="../ja451278/index.html">ウェーブレット分析パート1</a></li>
<li><a href="../ja451280/index.html">最も興味深い金属</a></li>
<li><a href="../ja451282/index.html">Web分析のブラックホール：GAで失われるデータの量とその理由</a></li>
<li><a href="../ja451286/index.html">Роскомнадзор, который мы заслужили</a></li>
<li><a href="../ja451294/index.html">CANを介して車に機能を追加したので、プログラムできません</a></li>
<li><a href="../ja451296/index.html">ML.NET 1.0によって発表されました</a></li>
<li><a href="../ja451298/index.html">プリント基板を1枚注文してケース付きゲーム機を作る方法</a></li>
<li><a href="../ja451304/index.html">Yandexの「ヒント」：有料サブスクリプションで利益を最大化する方法</a></li>
<li><a href="../ja451306/index.html">QEMU.js：WASMで真剣に</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>