<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏻‍🏫 🤗 👩‍🏭 Wir stellen das einfachste ZigBee-Netzwerk zusammen, programmieren unter Mbed und kommunizieren über MQTT 🔮 👩 ⏮️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dieser Artikel ist ein großartiger Schulungsworkshop für Einsteiger zur Verwendung des XBee-Moduls in Verbindung mit einem Mikrocontroller mit integri...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Wir stellen das einfachste ZigBee-Netzwerk zusammen, programmieren unter Mbed und kommunizieren über MQTT</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/samsung/blog/497200/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dieser Artikel ist ein großartiger Schulungsworkshop für Einsteiger zur Verwendung des XBee-Moduls in Verbindung mit einem Mikrocontroller mit integriertem Mbed-Betriebssystem. ZigBee ist ein langer und fest verwurzelter Standard in Smart-Home-Systemen (zum Beispiel wird es zusammen mit Z-Wave im Samsung SmartThings-Hub verwendet, siehe unseren </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artikel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Es zeichnet sich durch geringen Stromverbrauch, Benutzerfreundlichkeit und vor allem durch die Fähigkeit zum Erstellen aus selbstkonfigurierende Mesh-Netzwerke. Sie werden aus dem Workshop sehen, dass dies tatsächlich so ist - wir werden die Struktur eines solchen Netzwerks durch ein praktisches Visualizer-Dienstprogramm untersuchen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es wird davon ausgegangen, dass Sie bereits wissen, was ZigBee ist und wofür es ist. </font><font style="vertical-align: inherit;">Jetzt möchten Sie Ihr erstes XBee-Modul anschließen und Ihre Probleme damit lösen, ohne das Modul selbst zu programmieren, sondern nur als Kommunikationsschnittstelle zu verwenden. </font><font style="vertical-align: inherit;">Am Ende werden wir alle Daten über ein provisorisches MQTT-Gateway überall hin senden, sogar an einen lokalen Server, sogar ins Internet. </font><font style="vertical-align: inherit;">Wir haben uns entschlossen, alles am Beispiel von Mbed als das einfachste und zugänglichste für Anfänger-RTOS zu zeigen. </font><font style="vertical-align: inherit;">Sie werden überzeugt sein, dass alles „out of the box“ funktioniert, und Sie können sofort mit der Erstellung Ihres Projekts beginnen, auch wenn Sie zuvor nur mit Arduino zu tun hatten.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bp/5i/ot/bp5iota_umzhimxdl5yhgnmflzg.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Handbuch besteht aus folgenden Teilen:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anschluss und Konfiguration des XBee-Moduls</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verbinden Sie die Module mit dem Netzwerk</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir konfigurieren das Modul, ohne es von der Abschirmung zu entfernen</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datenabruf</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daten senden</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen eines einfachen MQTT-Gateways</font></font><br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber zuerst eine Liste von Komponenten: Was ist wünschenswert, um all das zu tun?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erforderliche Komponenten</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zwei Mbed-kompatible Boards. </font><font style="vertical-align: inherit;">Wir empfehlen das STM32 Nucleo Training Board als relativ kostengünstig und beliebt für Bildungszwecke. </font><font style="vertical-align: inherit;">Der dortige Programmiervorgang wird maximal vereinfacht: Sammeln Sie das Programm in einer kostenlosen Online-IDE, laden Sie die zusammengestellte Firmware herunter und legen Sie sie auf der Karte ab, die im System als Flash-Laufwerk angezeigt wird. </font><font style="vertical-align: inherit;">Welches spezifische Modell zu nehmen ist, ist nicht wichtig, aber nehmen Sie nicht das älteste, achten Sie auf die Größe des Speichers. </font><font style="vertical-align: inherit;">Zum Beispiel F401RE - wir geben nur zur Bestimmtheit an, damit Sie nicht in ihrer Vielfalt und zunächst unverständlichen alphabetischen Codes von STM-Prozessoren verwirrt werden.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ec/y3/nx/ecy3nxhuys7vlrzai3mq4yfzhy8.png" width="350"> <img src="https://habrastorage.org/webt/ec/y3/nx/ecy3nxhuys7vlrzai3mq4yfzhy8.png" width="350"><br>
</li>
<li> XBee-.      Digi.  «» ,  ,  , MBee,  ,    ,     ,      . /        :      ,      .   /  Pro:      ,      ,   Pro   .<br>
<img src="https://habrastorage.org/webt/r2/ed/ew/r2edew1y1gkdpcw9soz-vunnu9q.png"><img src="https://habrastorage.org/webt/m6/-n/aq/m6-naqf0x0qqrjpj-soxa6aulj0.png"><img src="https://habrastorage.org/webt/t2/x5/ng/t2x5ng0wfuoehd4oujmvhf1spha.png" width="200"><br>
</li>
<li>  XBee Shield V2 ( SeeedStudio).      -     ,        RX  TX XBee-.<br>
<img src="https://habrastorage.org/webt/jk/sv/75/jksv75ger3mv3zfwzfji4tliub0.png"><img src="https://habrastorage.org/webt/jk/sv/75/jksv75ger3mv3zfwzfji4tliub0.png"><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein USB-UART-Konverter mit Anschluss für XBee. </font><font style="vertical-align: inherit;">Es wird für die Erstkonfiguration benötigt. </font><font style="vertical-align: inherit;">XBee-Module selbst sind nicht mit einer USB-Schnittstelle ausgestattet (sie haben nichts damit zu tun). </font><font style="vertical-align: inherit;">USB wird ausschließlich für die Kommunikation zwischen dem Modul und dem Computer benötigt und kann im Gerät mit einem viel einfacheren UART arbeiten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Schlitzabstand der XBee-Module beträgt 2,0 mm - für die Elektronik ist er im metrischen System nicht Standard (wir sind es normalerweise gewohnt, Schritt 2.54 nach amerikanischen Standards zu sehen). </font><font style="vertical-align: inherit;">Daher werden solche Module leider nicht in das Steckbrett eingesetzt und benötigen immer einen Adapter. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jeder Adapter ist hier geeignet, wir haben diesen von Waveshare genommen:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/04/md/y5/04mdy5mhmm6cfwuj-a21a5eqagy.png" width="300"></li>
</ul><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anschluss und Konfiguration des XBee-Moduls</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Einfachste, was Sie mit dem Modul tun können, ist, es direkt über USB an den Computer anzuschließen. </font><font style="vertical-align: inherit;">Wir erhalten sofort Zugriff auf die Konfigurationsparameter.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installieren Sie XCTU</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für die Arbeit mit XBee gibt es ein offizielles XCTU-Programm. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laden Sie</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">herunter</font></a><font style="vertical-align: inherit;"> und installieren Sie es. </font><font style="vertical-align: inherit;">In der Dokumentation heißt es, dass Sie in Ubuntu einen Benutzer zu einer Gruppe hinzufügen müssen, um </font></font><code>dialout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mit Ports zu arbeiten, die nicht von einem Superuser stammen. Tun Sie dies, wenn Sie dies noch nicht getan haben:</font></font><br>
<br>
<pre><code class="bash hljs">sudo usermod -a -G dialout &lt;username&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Laden Sie das Zip-Archiv über den Link herunter, es enthält eine Datei </font></font><code>.run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Es muss ausführbar gemacht werden (über </font></font><code>chmod +x _</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in der Konsole oder: rechte Maustaste - Eigenschaften - Berechtigungen) und ausgeführt werden </font></font><code>./40002881_V.run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist wichtig, die Installation nicht vom Root aus (ohne </font></font><code>sudo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">zu starten </font><font style="vertical-align: inherit;">, da sonst später Probleme auftreten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Setup sieht ungefähr so ​​aus:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/44/kg/iz/44kgizj3bjlvchzakcksvrh1i_u.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XCTU-Programm</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach der Installation können Sie das Programm starten, indem Sie die Datei </font></font><code>app</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in dem Verzeichnis </font><font style="vertical-align: inherit;">ausführen, </font><font style="vertical-align: inherit;">in dem Sie das Programm installiert haben (standardmäßig - </font></font><code>~/Digi/XCTU-NG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Erscheinungsbild </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qr/wz/y0/qrwzy0nbyhomwp8g-k26jrluio4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sieht </font><font style="vertical-align: inherit;">folgendermaßen aus: </font><font style="vertical-align: inherit;">In diesem Programm können Sie Ihr vorhandenes Modul über einen Adapter an den USB-Anschluss anschließen. Klicken Sie mit einer Lupe auf die Schaltfläche Entdecken. Es erscheint ein Fenster, in dem Sie aufgefordert werden, einen Port auszuwählen. Wie Sie sehen können, hat das Programm den Port im System korrekt erkannt. </font></font><code>/dev/ttyUSB0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies ist unser USB-UART-Adapter.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rs/qr/h1/rsqrh1y2if1z6nr_zl844kdba4o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Fenster schlägt vor, die Suche abzuhaken. </font><font style="vertical-align: inherit;">Natürlich besteht die Versuchung, alles auf einmal zu überprüfen, um Ihr Modul sicher zu finden. </font><font style="vertical-align: inherit;">Aber dann wird die Suche noch sehr lange dauern. </font><font style="vertical-align: inherit;">In der Praxis ist es sinnvoll, die Kontrollkästchen standardmäßig aktiviert zu lassen und die gängigsten Optionen für die Datenübertragungsraten auszuwählen, wie in der folgenden Abbildung dargestellt. </font><font style="vertical-align: inherit;">In der Regel sind neue Module standardmäßig 9600, und für Schulungszwecke ist dies mehr als ausreichend. Die Geschwindigkeit hier ist für uns nicht kritisch. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/l2/dj/ve/l2djvekjunxaxpxesaxo786q3le.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn alles erfolgreich ist, werden Sie aufgefordert, das gefundene Modul auszuwählen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4z/dq/le/4zdqledgifvp92zr4lvm6bat2km.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein kleiner Fehler wurde festgestellt: Manchmal hatte das Modul keine nicht standardmäßige Geschwindigkeit. Das manuelle Zurücksetzen des Moduls mit der Schaltfläche Zurücksetzen während der Suche und das Zurücksetzen der Baudrate auf Standard (9600) half.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modulparameter ändern</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Weiter beschäftigen wir uns mit der Modulkonfiguration. Es fallen eine Reihe von Parametern aus, von denen die meisten zunächst unverständlich sind. Glücklicherweise müssen nur einige von ihnen für einen schnellen Start geändert werden. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Netzwerk-ID - PAN-ID.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Als gemeinsamer Netzwerkschlüssel muss er für alle Geräte gleich sein, damit sie unabhängig mit dem Netzwerk verbunden sind. Geben Sie eine beliebige Zahl ein, in unserem Fall haben wir 42. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t7/dg/lk/t7dglkxhvbkban2romlxiu97qpi.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CE - Coordinator Enabled.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wenn es 1 gibt, fungiert dieses Modul als Koordinator. Wenn es 0 ist, fungiert das Modul als Router (Router) - es stellt lediglich sicher, dass Pakete das Netzwerk durch sich selbst passieren. Die meisten Hosts sind normalerweise Router. Wir brauchen einen Koordinator und zwei Router in unserem Netzwerk, also setzen Sie hier einen ein.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt auch die Rolle „Endgerät“ (Endgerät) - ein Modul, das keine Arbeit an der Übertragung von Paketen ausführt, sondern nur mit anderen Routern kommuniziert und seine nützlichen Funktionen ausführt. Normalerweise befindet er sich nur im Schlafmodus und wacht in festgelegten Intervallen auf und findet heraus, ob Nachrichten vorliegen. Ein solches Modul kann mit einer Batterie betrieben werden, während Router und Koordinator immer „online“ sein sollten und daher eine konstante Stromversorgung benötigen, um das gesamte Netzwerk aufrechtzuerhalten. Wir werden ein solches Beispiel jetzt nicht betrachten, da es für alle interessanter ist, die Rolle von Routern zuzuweisen und zu beobachten, wie das Netzwerk seine Konfiguration automatisch ändert. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0m/zp/e3/0mzpe3yptscx6la-wummlbiixks.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AP - API aktivieren.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arbeitsweise. XBee-Module können in zwei Modi betrieben werden: AT oder API. Der AT-Modus ist für Anfänger einfacher, er ist ein transparenter Austausch der seriellen Schnittstelle und die Arbeit mit dem Modul über AT-Befehle. Der API-Modus ist jedoch wesentlich funktionsreicher. Er ermöglicht die Remote-Konfiguration von Modulen, enthält die Absenderadresse, gibt den Paketzustellungsstatus zurück und vieles mehr. Darüber hinaus setzen Bibliotheken für die Interaktion mit XBee voraus, dass das Gerät im API-Modus verwendet wird. Ersetzen Sie es daher sofort durch den API-Modus. Setzen Sie dazu das Gerät in das entsprechende Feld ein. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ra/wv/ng/rawvngogy6biagddxsxxx08fhao.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Name des Moduls lautet Node Identifier.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eine praktische Option, um Ihrem Modul einen lesbaren Namen zu geben. Geben wir ihm einen solchen Namen - Koordinator. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xi/h2/fy/xih2fygnbxffyqcyhuwbvn8zhqc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach können Sie die Einstellungen in das Modul flashen, indem Sie die Taste mit einem Bleistift drücken:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pi/8g/xm/pi8gxmplnffs0qmxtckhrfmxrqe.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Verbinden Sie die Module mit dem Netzwerk</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt werden wir sehen, welche Art von Netzwerk wir erhalten, wenn wir drei Module konfigurieren. </font><font style="vertical-align: inherit;">Das XCTU-Programm hat einen ziemlich praktischen Netzwerk-Visualizer, wir werden die Topologie klar sehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden alle drei Module der Reihe nach mit den folgenden Parametern konfigurieren:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PAN ID - Gesamtzahl, zum Beispiel 42</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AP (API Enable) - auf 1 gesetzt (im API-Modus arbeiten)</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NI (Node Identifier) ​​- Geben Sie den Modulen verständliche Namen (Koordinator, Lampe und Schalter, wenn wir beispielsweise ein Modell des Smart Home-Systems verwenden).</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CE (Coordinator Enable) - Setzen Sie eines der Module auf 1, es wird der Koordinator sein.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schalten Sie dann alle Module ein. Positionieren Sie sie wie folgt: Der Koordinator befindet sich im USB-UART-Konverter, und die anderen beiden (Router) befinden sich auf den XBee Shield-Karten oben auf Nucleo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie alles sorgfältig gemacht haben, wird das Schöne passieren. Die Module stellen automatisch eine Verbindung zum Netzwerk her. Sie können über den Koordinator remote mit Routern kommunizieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es sieht aus wie das. Klicken Sie auf die Schaltfläche "Funkknoten im selben Netzwerk erkennen". </font></font><br>
<br>
<img src="https://habrastorage.org/webt/em/nf/mx/emnfmxivn4xxt3wtx0pe0f54m8q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie werden sehen, dass zwei Module automatisch erkannt und hinzugefügt wurden: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/j3/ev/gf/j3evgfx0nj0xowanzz3ovdctyks.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und Sie können ihre Parameter im laufenden Betrieb ändern!&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was immer noch großartig ist: Jetzt können Sie die Netzwerkkarte sehen, wenn Sie oben rechts in den Netzwerkarbeitsmodus wechseln.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sf/2v/ma/sf2vmarm8agrkfjtepgib28sxuq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem Sie die Netzwerkknoten mit der Maus verteilt haben, sehen Sie ein Dreieck. </font><font style="vertical-align: inherit;">Bitte beachten Sie, dass der Datenverkehr zum Modul ganz rechts auf zwei Arten erfolgen kann. </font><font style="vertical-align: inherit;">Und wenn Sie die Module im Raum verschieben, werden Sie feststellen, dass sich das Bild geändert hat, und jetzt wird möglicherweise ein anderes Modul „extrem“. </font><font style="vertical-align: inherit;">Dies ist die Essenz eines selbstkonfigurierenden Netzwerks.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Richten Sie das XBee-Modul ein, ohne es von der Abschirmung zu entfernen</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Natürlich wird es interessanter sein, mit dem XBee-Modul nicht über einen Computer zu arbeiten, sondern es mit einem Programm auf dem Mikrocontroller zu steuern. </font><font style="vertical-align: inherit;">Das heißt, es wird an die STM32Nucleo-Karte angeschlossen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns diskutieren, wie das XBee-Modul mit dem Mikrocontroller kommunizieren kann. </font><font style="vertical-align: inherit;">Beginnen wir mit einer kleinen Aufgabe: Wie konfiguriere ich ein Modul, ohne es vom Erweiterungsschild zu entfernen? </font><font style="vertical-align: inherit;">Sie müssen zugeben, dass das Hin- und Herbewegen des Moduls unpraktisch ist. Gleichzeitig möchten Sie mit den Parametern experimentieren. Es ist seltsam, warum Sie ein separates USB-UART-Modul benötigen, da sich theoretisch eines auf der STM32Nucleo-Karte befindet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Lösung ist einfach: Wir müssen die Nucleo-Karte in eine Brücke zwischen dem XBee-Modul und dem USB-Konverter auf der Karte verwandeln.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Allgemeine Beschreibung der Idee</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der von uns verwendete STM32-Mikrocontroller verfügt über mehrere integrierte UART-Schnittstellen. Jede solche Schnittstelle repräsentiert einen Kommunikationskanal. Einer von ihnen ist an den USB-UART-Konverter angeschlossen, damit wir über USB im Terminal mit dem Computer kommunizieren können. Zwei andere werden noch nicht verwendet. Wir werden das XBee-Modul mit einem von ihnen verbinden, das auch einen solchen Kommunikationskanal hat. Sie können einen beliebigen UART auswählen, den wir für die Bestimmtheit von UART1 ausgewählt haben.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Pinbelegung kann in MBed oben rechts angezeigt werden, indem Sie die Platinenauswahltaste und dann die Registerkarte Pinbelegung drücken. </font><font style="vertical-align: inherit;">Aus Gewohnheit kann es schwierig sein, dieses farbenfrohe Bild wahrzunehmen. </font><font style="vertical-align: inherit;">Hier gibt es viele Dinge, da die Karte viele Schnittstellen hat und es zwei Pin-Nummern gibt: relativ zum Mikrocontroller (PA_5, PA_6 - Pin-Nummerierung) und relativ zur Karte (D13, D12 - Beschriftungen auf der Nucleo-Karte, dieselben Nummern in der Nähe der Anschlüsse). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/97/dp/mq/97dpmqw9dmy9lcqtb1hf6i_gyz0.png"><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es stellt sich heraus, dass auf dem Mikrocontroller die UART1-Schnittstelle mit dem XBee-Modul und UART2 - wie zuvor - mit dem Computer kommuniziert. </font><font style="vertical-align: inherit;">Der interne Code leitet UART1 zu UART2 und umgekehrt um. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rp/vk/5w/rpvk5wsdsb8qnz5i_m7dk8q-wwc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei Verbindungen sieht es folgendermaßen aus:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tp/g7/cs/tpg7cslaiomjx-ogqje-su3q-7s.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aus einem Mikrocontroller eine „Brücke“ machen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In unserem Fall können wir Jumper auf dem Schild die Nummern einstellen, an die wir das ZigBee-Modul anschließen möchten. Das TX-Kommunikationsmodul wird an Pin 2 der Karte (PA_9 am Mikrocontroller) und RX an Pin 8 (auch bekannt als PA_10) angeschlossen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es wird so aussehen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oh/ce/3s/ohce3sq3y1_0_jewruer0dmn36a.png"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Code, den</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wir genommen haben, heißt Serial Bridge. Dies ist die „Brücke“ zwischen den beiden Kommunikationskanälen. Wir laden den Code in den Mikrocontroller, der alles, was vom Computer über UART2 zur Eingabe kommt, an UART1 weiterleitet und umgekehrt. Als hätten wir eine Pipe zwischen zwei Informationsquellen eingefügt (Linuxsoids wird es verstehen). Wir haben ein XBee-Modul an UART1 angeschlossen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Code ist sehr einfach. Sie müssen nur die PIN-Nummern ändern, an die das Gerät angeschlossen ist. Das heißt, machen Sie sie PA_9 und PA_10, wie oben angegeben.</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"mbed.h"</span></span>
<span class="hljs-comment">// Make a serial bridge from a serial I/O device on mbed to the PC</span>
<span class="hljs-function">Serial <span class="hljs-title">pc</span><span class="hljs-params">(USBTX, USBRX)</span></span>; <span class="hljs-comment">// tx, rx</span>
<span class="hljs-function">Serial <span class="hljs-title">device</span><span class="hljs-params">(PA_9, PA_10)</span></span>; <span class="hljs-comment">// tx, rx</span>
<span class="hljs-comment">// Defaults to 9600 baud on each device - use .baud(baudrate) to change</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<font></font>
&nbsp;pc.<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Hello!"</span>);
&nbsp;<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) {
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>(pc.readable()) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;device.putc(pc.getc());<font></font>
&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>(device.readable()) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pc.putc(device.getc());<font></font>
&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist wichtig, dass der Compiler Ihnen keinen Fehler meldet, wenn Sie die Reihenfolge der Schlussfolgerungen verwechseln - beispielsweise einen Fehler machen und PA_10, PA_9 anstelle von PA_9, PA_10 schreiben - und das Programm beim Neustart einen Fehler in der Konsole anzeigt:</font></font><br>
<pre><code class="plaintext hljs">pinmap not found for peripheral</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
und wird nicht weitergehen, das heißt, im Prinzip wird nichts funktionieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem Sie diesen Code heruntergeladen und die Steckbrücken auf dem Schild richtig eingestellt haben, können Sie vom Computer aus eine sichere Verbindung zum XBee-Modul herstellen, wie Sie es zuvor mit dem USB-UART-Adapter getan haben, ohne ihn vom Schild zu entfernen. </font><font style="vertical-align: inherit;">Es wird regelmäßig vom XCTU-Programm erkannt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auch wenn Sie diese Funktionalität nicht benötigen, überprüfen Sie dennoch, ob das Programm funktioniert, da wir im nächsten Beispiel vom Mikrocontroller aus mit dem XBee-Modul kommunizieren und die Verbindung über UART1 bereits hergestellt sein sollte (dh die Jumper sind korrekt gesetzt und die Pin-Nummern sind im Programm angegeben). .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Datenerfassung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns zwei einfache Beispiele an: Empfangen und Senden von Daten auf Mikrocontrollerebene unter Verwendung des XBee-Moduls als externe Kommunikationsschnittstelle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt eine offizielle </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bibliothek</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> von Herstellern - Digi-Unternehmen. </font><font style="vertical-align: inherit;">Es liegt im Mbed-Repository, es gibt nützliche Kommentare zur Verwendung und Logik des Codes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuerst lernen wir, wie man Daten erhält - es gibt ein einfacheres Beispiel. </font><font style="vertical-align: inherit;">Wir werden ein XBee-Modul an den USB-UART-Konverter anschließen, eine Begrüßung an die Nucleo-Karte senden und diese Begrüßung an die Konsole drucken. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zg/ic/u5/zgicu5mh8dvsy8y8aegzetdoew8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Öffnen Sie das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projekt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in dieser Bibliothek. </font><font style="vertical-align: inherit;">Importieren Sie es wie immer als Programm in den Online-Compiler.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fix Bibliotheken für S2C-Module</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beachten Sie, dass Sie bei Modulen der S2C-Serie </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hc/vr/kb/hcvrkbswx5s8hspbos6djkmxfko.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
anstelle der Standardbibliothek den Fix </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XBeeLib_Fixed verwenden müssen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Andernfalls funktionieren diese Programme nicht. </font><font style="vertical-align: inherit;">Es wird dem Projekt hinzugefügt, indem einfach die XBeeLib-Bibliothek von dort entfernt und in das XBeeLibFix-Projekt importiert wird. </font><font style="vertical-align: inherit;">Es muss nichts mehr geändert werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also: Importieren Sie diese Bibliothek in den Online-Compiler: Das </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ko/vq/e9/kovqe9zqdl7553_kivabf8bedv0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Projektimportfenster wird angezeigt. </font><font style="vertical-align: inherit;">Dort müssen Sie das Ziel auswählen - wo wir importieren: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bx/pt/vt/bxptvt2ctwcv87vl-b1qi5upi4s.png" width="500"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wählen Sie als Zielprojekt unser Beispiel XBeeZB_Receive_Data aus. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7q/lj/hg/7qljhgp7jx5yt9875cqijnfopcs.png" width="500"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach wird die Bibliothek in das Projekt importiert und dann mit einem fetten Zug die falsche Version von XBeeLib gelöscht.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/iw/hz/or/iwhzor7bqjopgpigyi4_lfiv43e.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispielzusammenstellung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie haben also das Beispiel importiert und bei Bedarf die Bibliothek darin ersetzt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen Sie sich den Beispielcode an, es ist ganz einfach. </font><font style="vertical-align: inherit;">Es definiert eine Rückruffunktion, die aufgerufen wird, wenn ein Paket empfangen wird. </font><font style="vertical-align: inherit;">Diese Funktion druckt den Inhalt des empfangenen Pakets an die Konsole. </font><font style="vertical-align: inherit;">Wenn wir ihr also einen Gruß schicken, wird sie ihn auch ausdrucken. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Damit das Beispiel kompiliert werden kann, müssen Sie in das Beispiel die Schlussfolgerungen schreiben, die wir für die Kommunikation mit dem XBee-Modul verantwortlich sind, da das Programm nicht weiß, mit welchen Schlussfolgerungen wir die Hardware verbunden haben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher gehen wir zur Datei config.h und den darin enthaltenen Zeilen:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//#define RADIO_TX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial TX pin connected to the XBee module DIN pin */</span>
<span class="hljs-comment">//#define RADIO_RX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial RX pin connected to the XBee module DOUT pin */</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kommentar aus, und anstelle von NC schreiben wir gemäß den Schlussfolgerungen, mit denen wir die Jumper verbunden haben:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RADIO_TX PA_9</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RADIO_RX PA_10</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ebenso ändern wir die Zeilen:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//#define DEBUG_TX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial TX for debugging */</span>
<span class="hljs-comment">//#define DEBUG_RX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial RX for debugging (optional) */</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir schreiben:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEBUG_TX USBTX</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEBUG_RX USBRX</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn beim Kompilieren ein Fehler </font></font><code>device.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auftritt </font><font style="vertical-align: inherit;">, den Sie nicht finden können </font><font style="vertical-align: inherit;">, aktualisieren </font><font style="vertical-align: inherit;">Sie </font><font style="vertical-align: inherit;">einfach die Mbed-Bibliothek in der Projektstruktur (klicken Sie mit der rechten Maustaste darauf -&gt; Aktualisieren). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach wird das Programm erfolgreich kompiliert und Sie können es auf die </font><font style="vertical-align: inherit;">Karte </font><font style="vertical-align: inherit;">herunterladen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laufendes Beispiel</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem Sie sich die Konsole angesehen haben, die das Nucleo-Board schreibt, sehen Sie Folgendes: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/as/mk/fb/asmkfbne30jznt7bzqvr2vjhl5e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie senden wir Daten? </font><font style="vertical-align: inherit;">Die einfachste Option: über die Konsole im XCTU-Programm. </font><font style="vertical-align: inherit;">Wählen Sie im Hauptmenü des Programms: Extras - Pakete senden. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ko/9b/7q/ko9b7qwhvwszyezghvzpbs1py74.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unten befindet sich ein Fenster mit den Worten Pakete senden. </font><font style="vertical-align: inherit;">Erstellen Sie ein neues Paket, indem Sie rechts auf das „Plus“ klicken. </font><font style="vertical-align: inherit;">Ein Fenster zum Erstellen eines neuen Pakets wird angezeigt. </font><font style="vertical-align: inherit;">Wählen Sie dort die Registerkarte HEX. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jc/cf/wz/jccfwz6aesmjic-ncukw8ot1ls8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Geben Sie dort eine solche Datenübertragung ein: </font></font><br>
<code>7E 00 19 10 01 00 00 00 00 00 00 FF FF FF FE 00 00 48 65 6C 6C 6F 20 58 42 65 65 21 5A</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(über die Schaltfläche "Ausgewähltes Paket senden" rechts neben der Paketliste) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Ergebnis wird in der Konsole des Abhörmoduls angezeigt:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/55/tg/mk/55tgmkipu_8dk33yhqdxxqa90du.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bitte beachten Sie, dass nur der letzte Teil des von Ihnen gesendeten Bytesatzes gedruckt wurde. </font><font style="vertical-align: inherit;">Dies ist die tatsächliche Nutzlast der Nachricht. </font><font style="vertical-align: inherit;">Beachten Sie auch, dass der Empfänger diese nicht ausgibt, wenn Sie "nur Bytes" (eine zufällige Kombination von Bytes) senden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie eine Reihe von Bytes </font></font><br>
<code>48 65 6C 6C 6F 20 58 42 65 65 21</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
einfügen </font><font style="vertical-align: inherit;">:&nbsp; </font><font style="vertical-align: inherit;">in einen HEX-ASCIII-Konverter (z. B. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), stellen Sie sicher, dass dies "Hallo XBee!" Bedeutet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine sehr einfache Aufgabe für die unabhängige Ausführung: Ändern Sie den Beispielcode so, dass der Nachrichtentext in ASCII und nicht in HEX angezeigt wird und Sie diesen Text im Terminal lesen können.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Daten senden</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Analogie zum vorherigen Beispiel betrachten wir nun das Senden von Daten. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bp/5i/ot/bp5iota_umzhimxdl5yhgnmflzg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles ist hier, wie im vorherigen Beispiel. </font><font style="vertical-align: inherit;">Nur mit dem Unterschied, dass wir jetzt das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> XBeeZB_Send_Data öffnen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispielzusammenstellung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist wichtig, dass Sie, wenn Sie ein S2C-Modul haben (es ist deutlich darauf geschrieben), </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hc/vr/kb/hcvrkbswx5s8hspbos6djkmxfko.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
die Bibliothek erneut mit einem Fix verbinden, da sonst nichts für Sie funktioniert. Wie das geht, wird im vorherigen Beispiel beschrieben.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Außerdem müssen Sie hier für eine erfolgreiche Kompilierung die verwendeten Controller-Pins angeben. Sie können sie einfach aus dem vorherigen Beispiel kopieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir betrachten den Beispielcode selbst. Es </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">werden verschiedene Methoden zum Senden von Daten verwendet. Wählen Sie die einfachste: Senden Sie Daten an den Koordinator. Wir müssen nicht einmal die Adresse des Koordinators registrieren, da er bereits im Netzwerk registriert ist. Ohne das Beispiel zu ändern, kommentieren wir daher alle Zeilen am Ende:</font></font><br>
<pre><code class="cpp hljs">send_data_to_coordinator(xbee);
<span class="hljs-comment">//send_broadcast_data(xbee);</span>
<span class="hljs-comment">//send_data_to_remote_node(xbee, remoteDevice);</span>
<span class="hljs-comment">//send_explicit_data_to_remote_node(xbee, remoteDevice);</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wenn Sie beginnen, sehen Sie Folgendes: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/su/pp/sj/suppsjbb95cdiavs1svsj1ixctm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Wenn Sie es nicht sehen, starten Sie einfach die Karte neu.) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie kann ich sicherstellen, dass die Daten den Koordinator erreichen? Beispielsweise verfügt XCTU über einen Netzwerkkonsolenmodus. Wird durch den Knopf oben rechts eingeschaltet. In diesem Modus sehen Sie alle Pakete im Netzwerk. Gleichzeitig sollten Sie natürlich eine serielle Verbindung mit dem Koordinator haben. Und vergessen Sie nicht, oben links auf die Schaltfläche Öffnen zu klicken, um sie grün zu machen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yz/st/vy/yzstvyfb4ed2rkbgvmgushy1gkg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können detaillierte Informationen zu jedem Paket im Netzwerk anzeigen, indem Sie sie in der Liste links auswählen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fl/2w/_f/fl2w_fotyjqzbmdpt9tp6fvyyba.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie zum Ende des Paketinhalts scrollen, wird eine Zeile mit dem Text "send_data_to_coordinator" angezeigt:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vm/da/ha/vmdahazkjgs7ttk_d-hg6osq7oi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können andere Methoden zum Senden von Daten ausprobieren, aber dort (zum Beispiel zum Senden an einen separaten ausgewählten Knoten) müssen Sie die Knotenadresse registrieren. </font><font style="vertical-align: inherit;">Sie können die Adressen aller Module im XCTU-Programm sehen. </font><font style="vertical-align: inherit;">Das Registrieren bestimmter Adressen wird im Beispiel ausführlich beschrieben.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Wir machen das MQTT-Gateway</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles ist großartig, aber jetzt möchte ich irgendwie mit diesen Daten außerhalb des XBee-Netzwerks arbeiten, zum Beispiel im Internet. </font><font style="vertical-align: inherit;">Eine Möglichkeit, dies zu tun, besteht darin, den Übersetzer von XBee in das beliebte MQTT-Protokoll einzufügen. </font><font style="vertical-align: inherit;">Dann können wir auf übliche Weise Ereignisbenachrichtigungen abonnieren und Befehle über die Benutzeroberfläche senden. Dieses Programm kann sich überall befinden (wenn Sie einen externen statt eines lokalen MQTT-Servers verwenden) und nicht nur auf unserem Computer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unten finden Sie eine Anleitung. </font><font style="vertical-align: inherit;">Kurz gesagt, das auf dem Computer gestartete Programm tauscht Daten vom Netzwerkkoordinator über eine USB-Verbindung aus. </font><font style="vertical-align: inherit;">Sie wird diese Daten an das MQTT-Protokoll übertragen.</font></font><br>
<img src="https://habrastorage.org/webt/t0/yo/dx/t0yodx2oqigqjepdzr0w8exjwaq.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installieren und konfigurieren Sie XBMQ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Programm, das wir als MQTT-Gateway verwenden werden, heißt XBMQ, es ist offen und kostenlos. </font><font style="vertical-align: inherit;">Existiert in zwei Versionen:</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NodeJS</font></font></a><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Java-Version wird berücksichtigt, obwohl dies nicht allzu grundlegend ist: Wir werden sie sowieso nicht programmieren, wir werden sie nur installieren und verwenden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Damit das Programm funktioniert, benötigen Sie die RXTX-Bibliothek. Sie kann einfach aus dem Repository installiert werden:</font></font><br>
<pre><code class="bash hljs">sudo apt-get install librxtx-java</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und natürlich benötigen Sie das JDK (Java Development Kit). </font><font style="vertical-align: inherit;">Es gibt zwei Versionen - von Oracle und OpenJDK wird die zweite empfohlen. </font><font style="vertical-align: inherit;">OpenJDK ist höchstwahrscheinlich bereits auf Ihrem System installiert. Wenn nicht, installieren Sie es erneut. </font><font style="vertical-align: inherit;">Java benötigt maximal 8, da </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">javax.xml.bind von Java 11 ausgeschlossen ist</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und Sie eine Alternative mit JDK-8 als Standardoption auswählen oder eine Konfiguration für diesen Fall erstellen müssen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Laden Sie das Repository des XBMQ-Programms herunter:</font></font><br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/angryelectron/xbmq-java</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach dem Herunterladen der Quellcodes sammeln wir die Binärdatei des Programms. </font><font style="vertical-align: inherit;">Mannschaft</font></font><br>
<pre><code class="bash hljs">ant dist</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
wird ein Projekt für alle wichtigen Betriebssysteme zusammenstellen. </font><font style="vertical-align: inherit;">Das endgültig kompilierte Programm befindet sich im Ordner </font></font><code>dist</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konfigurieren Sie nun dieses Programm. </font><font style="vertical-align: inherit;">Datei öffnen</font></font><pre><code class="plaintext hljs">dist/xbmq.properties</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 und dort sehen:</font></font><br>
<pre><code class="bash hljs"><span class="hljs-comment">#</span>
<span class="hljs-comment"># Xbmq Properties.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#port = /dev/ttyUSB0</span>
<span class="hljs-comment">#baud = 9600</span>
<span class="hljs-comment">#rootTopic = ab123</span>
<span class="hljs-comment">#broker = tcp://test.mosquitto.org:1883</span>
<span class="hljs-comment">#username = user</span>
<span class="hljs-comment">#password = password</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kommentieren Sie Ihre Parameter aus und ändern Sie sie. </font><font style="vertical-align: inherit;">Die Parameter lauten wie folgt: ZigBee-Koordinator-Verbindungsport, Geschwindigkeit, Stammthema (alle Daten fallen hinein), MQTT-Serveradresse, Benutzername und Kennwort (falls der Server dies erfordert). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Beispiel hat sich nur die Serveradresse geändert - auf den lokalen mqtt-Server (Standardmücke von Linux). </font><font style="vertical-align: inherit;">Alles andere wurde standardmäßig belassen:</font></font><br>
<pre><code class="bash hljs"><font></font>
port = /dev/ttyUSB0<font></font>
baud = 9600<font></font>
rootTopic = ab123<font></font>
broker = tcp://127.0.0.1:1883<font></font>
username = user<font></font>
password = password<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vor dem nächsten Schritt müssen Sie den lokalen Moskito-MQTT-Server installieren und ausführen:&nbsp;</font></font><br>
<pre><code class="bash hljs">sudo apt-get install mosquitto</code></pre><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XBMQ-Start</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schließlich kann das Programm gestartet werden. </font><font style="vertical-align: inherit;">Führen Sie das Programm aus, nachdem Sie den USB-UART-Konverter mit dem eingesetzten Koordinatormodul verbunden haben:</font></font><br>
<pre><code class="bash hljs">./dist/xbmq.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie das Skript ausführen, sehen wir die Zeile in der Konsole:</font></font><br>
<pre><code class="bash hljs">INFO - Starting XBMQ gateway ab123/0013A2004154EA46</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuletzt - das ist genau die Adresse unseres Koordinators. </font><font style="vertical-align: inherit;">Wenn Sie alle Themen mit einem externen MQTT-Client abonnieren, werden sofort zwei Meldungen angezeigt:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Thema </font></font><code>ab123/0013A2004154EA46/online</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- wird 1 sein, dies ist Last Will (ein gutes Beispiel dafür, wie diese "speziellen" Parameter im wirklichen Leben verwendet werden)</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Thema </font></font><code>ab123/0013A2004154EA46/log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enthält denselben Debugging-Satz "XBMQ-Gateway starten ...", den Sie bereits in der Konsole gesehen haben</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versuchen Sie nun, eine Nachricht von einem anderen externen XBee-Modul zu senden. Nehmen Sie beispielsweise ein Beispiel für das Senden von Daten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie im Programm MQTT.fx alle Themen abonnieren (#), wird </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hy/56/5l/hy565luregquqnizlxf7pejdn40.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Folgendes angezeigt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><i><font style="vertical-align: inherit;">Das Programmfenster</font></i><font style="vertical-align: inherit;"> MQTT.fx. Wenn Sie also </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
das zuvor untersuchte Beispiel mit dem Senden einer Nachricht an den Koordinator ausführen, wird dieser Text ("send_data_to_coordinator") als Teil angezeigt MQTT-Paket. Das für uns übliche übergeordnete Thema ist das in der Programmkonfiguration angegebene ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ab123</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Sie können es in Ihr eigenes ändern). Als nächstes kommt die Adresse des Koordinators und dann die Adresse des Moduls, von dem die Nachricht stammt. Schließlich heißt dieses Thema DataOut, da es sich um ausgehende Daten handelt.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Natürlich sehen Sie ein solches Bild in jedem anderen MQTT-Client, sei es MQTTLens oder auch nur</font></font><code>mosquitto_sub</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in der Konsole. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein paar abschließende Kommentare:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In guter Weise sollte dieses Programm im Daemon-Modus funktionieren. </font><font style="vertical-align: inherit;">Hierfür gibt es eine xbmqd-Datei, und README erklärt, wie man sie verwendet.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"></font><code>xbmq</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beachten Sie, dass wir dieses Programm nicht gleichzeitig mit XCTU ausführen können </font><font style="vertical-align: inherit;">, da es </font><font style="vertical-align: inherit;">den Port enthält.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt können Sie mit dem MQTT-Protokoll mit Ihrem System arbeiten und komplexe, interessante Programme schreiben! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/g8/kt/h0/g8kth04siprq-9s2uwlli2fp6ae.jpeg" align="left"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tatyana Volkova - Die Autorin des Schulungsprogramms im Internet der Dinge verfolgt „Samsung IT Academy“, eine Spezialistin für Corporate Social Responsibility-Programme im Samsung Research Center</font></font><br>
</i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de497178/index.html">"1C: ERP" und "1C: CRM": Funktionalität und vergleichende Analyse von Konfigurationen</a></li>
<li><a href="../de497184/index.html">Ein Blick auf die vielversprechenden Entwicklungsrichtungen geologischer, geophysikalischer und Felddatenmanagementsysteme</a></li>
<li><a href="../de497186/index.html">Wie ist die Suche nach einem Impfstoff gegen Coronavirus</a></li>
<li><a href="../de497192/index.html">So funktioniert IT aus der Ferne: Tipps zur Verwaltung verteilter Teams</a></li>
<li><a href="../de497194/index.html">Tinder weiß mehr über dein intimes Leben als deine Freunde</a></li>
<li><a href="../de497204/index.html">Digital 2020: Trends festlegen</a></li>
<li><a href="../de497206/index.html">Informationen zur objektorientierten Programmierung</a></li>
<li><a href="../de497212/index.html">[Anleitung] Verwenden von Google-Disk, Google-Site, Google-Form zum Erstellen einer Datenbank und von Feedbacksystemen</a></li>
<li><a href="../de497214/index.html">Data Engineer und Data Scientist: Was sie können und wie viel sie verdienen</a></li>
<li><a href="../de497216/index.html">Wir haben eine Coronavirus-Epidemie gemacht</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>