<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😳 🤱🏿 😇 Hojas de trucos de seguridad: Nodejs 🏇🏿 🌰 🕴🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ya se ha dicho mucho sobre la popularidad de NodeJS. El aumento en el número de aplicaciones es obvio: NodeJS es bastante fácil de aprender, tiene una...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Hojas de trucos de seguridad: Nodejs</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/acribia/blog/493714/"><img src="https://habrastorage.org/webt/bs/ml/lo/bsmllozt2li3jmn_6ec8vy4krdq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya se ha dicho mucho sobre la popularidad de NodeJS. </font><font style="vertical-align: inherit;">El aumento en el número de aplicaciones es obvio: NodeJS es bastante fácil de aprender, tiene una gran cantidad de bibliotecas y un ecosistema en desarrollo dinámico. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hemos preparado </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recomendaciones para desarrolladores de NodeJS</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> basadas en OWASP Cheat Sheets para ayudarlo a anticipar problemas de seguridad al desarrollar aplicaciones. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las recomendaciones de seguridad para las aplicaciones NodeJS se pueden dividir en las siguientes categorías:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seguridad durante el desarrollo de la aplicación;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seguridad del servidor;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seguridad de la plataforma;</font></font></li>
</ul><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seguridad de desarrollo de aplicaciones</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Evite el infierno de devolución de llamada El</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
uso de funciones de devolución de llamada (devoluciones de llamada) es una de las mayores fortalezas de NodeJS, sin embargo, al anidar devoluciones de llamada, puede olvidarse fácilmente de manejar el error en una de las funciones. </font><font style="vertical-align: inherit;">Una forma de evitar el infierno de devolución de llamada es usar promesas. </font><font style="vertical-align: inherit;">Incluso si el módulo que está utilizando no admite trabajar con promesas, siempre puede usar Promise.promisifyAll (). </font><font style="vertical-align: inherit;">Pero incluso usando promesas, vale la pena prestar atención a la anidación. </font><font style="vertical-align: inherit;">Para evitar completamente el error del infierno de devolución de llamada, adhiérase a una cadena de promesas "planas". </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo de infierno de devolución de llamada:</font></font></i><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">function <span class="hljs-title">func1</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">500</span>);<font></font>
}<font></font>
<span class="hljs-function">function <span class="hljs-title">func2</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">100</span>);<font></font>
}<font></font>
<span class="hljs-function">function <span class="hljs-title">func3</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">900</span>);<font></font>
}<font></font>
<span class="hljs-function">function <span class="hljs-title">func4</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">3000</span>);<font></font>
}<font></font>
<font></font>
func1(<span class="hljs-string">"input1"</span>, function(err, result1){
   <span class="hljs-keyword">if</span>(err){
      <span class="hljs-comment">// error operations</span><font></font>
   }<font></font>
   <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">//some operations</span>
      func2(<span class="hljs-string">"input2"</span>, function(err, result2){
         <span class="hljs-keyword">if</span>(err){
            <span class="hljs-comment">//error operations</span><font></font>
         }<font></font>
         <span class="hljs-keyword">else</span>{
            <span class="hljs-comment">//some operations</span>
            func3(<span class="hljs-string">"input3"</span>, function(err, result3){
               <span class="hljs-keyword">if</span>(err){
                  <span class="hljs-comment">//error operations</span><font></font>
               }<font></font>
               <span class="hljs-keyword">else</span>{
                  <span class="hljs-comment">// some operations</span>
                  func4(<span class="hljs-string">"input 4"</span>, function(err, result4){
                     <span class="hljs-keyword">if</span>(err){
                        <span class="hljs-comment">// error operations</span><font></font>
                     }<font></font>
                     <span class="hljs-keyword">else</span> {
                        <span class="hljs-comment">// some operations</span><font></font>
                     }<font></font>
                  });<font></font>
               }<font></font>
            });<font></font>
         }<font></font>
      });<font></font>
   }<font></font>
});<font></font>
</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mismo código usando promesas de cadena plana:</font></font></i><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">function <span class="hljs-title">func1</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">500</span>);<font></font>
}<font></font>
<span class="hljs-function">function <span class="hljs-title">func2</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">100</span>);<font></font>
}<font></font>
<span class="hljs-function">function <span class="hljs-title">func3</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">900</span>);<font></font>
}<font></font>
<span class="hljs-function">function <span class="hljs-title">func4</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">3000</span>);<font></font>
}<font></font>
<font></font>
func1(<span class="hljs-string">"input1"</span>)<font></font>
   .then(function (result){<font></font>
      <span class="hljs-keyword">return</span> func2(<span class="hljs-string">"input2"</span>);<font></font>
   })<font></font>
   .then(function (result){<font></font>
      <span class="hljs-keyword">return</span> func3(<span class="hljs-string">"input3"</span>);<font></font>
   })<font></font>
   .then(function (result){<font></font>
      <span class="hljs-keyword">return</span> func4(<span class="hljs-string">"input4"</span>);<font></font>
   })<font></font>
   .<span class="hljs-keyword">catch</span>(function (error) {
      <span class="hljs-comment">// error operations</span><font></font>
   });<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limite el tamaño de la solicitud.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Analizar el cuerpo de la </font><b><font style="vertical-align: inherit;">solicitud</font></b><font style="vertical-align: inherit;"> puede ser una operación que requiere muchos recursos. Si no limita el tamaño de la solicitud, los atacantes podrán enviar solicitudes lo suficientemente grandes que pueden llenar todo el espacio en disco o agotar todos los recursos del servidor, pero al mismo tiempo, limitar el tamaño de la solicitud para todos los casos puede ser incorrecto, porque hay solicitudes, como descargar un archivo. Por lo tanto, se recomienda establecer límites para diferentes tipos de contenido. Por ejemplo, usando el marco express, esto se puede implementar de la siguiente manera:</font></font><br>
<br>
<pre><code class="java hljs">app.use(express.urlencoded({ limit: <span class="hljs-string">"1kb"</span> }));<font></font>
app.use(express.json({ limit: <span class="hljs-string">"1kb"</span> }));<font></font>
app.use(express.multipart({ limit:<span class="hljs-string">"10mb"</span> }));
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Cabe señalar que un atacante puede cambiar el tipo de contenido de la solicitud y eludir las restricciones, por lo tanto, es necesario verificar si el contenido de la solicitud coincide con el tipo de contenido especificado en el encabezado de la solicitud. </font><font style="vertical-align: inherit;">Si verificar el tipo de contenido afecta el rendimiento, solo puede verificar ciertos tipos o consultas que son más grandes que un cierto tamaño. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No bloquee el bucle de eventos</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Un componente importante del lenguaje es el bucle de eventos, que solo le permite cambiar el contexto de ejecución sin esperar a que se complete la operación. </font><font style="vertical-align: inherit;">Sin embargo, hay operaciones de bloqueo cuya finalización NodeJS tiene que esperar antes de continuar con el código. </font><font style="vertical-align: inherit;">Por ejemplo, la mayoría de los métodos sincrónicos están bloqueando:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">const</span> fs = require(<span class="hljs-string">'fs'</span>);<font></font>
fs.unlinkSync(<span class="hljs-string">'/file.txt'</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se recomienda realizar tales operaciones de forma asincrónica:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">const</span> fs = require(<span class="hljs-string">'fs'</span>);<font></font>
fs.unlink(<span class="hljs-string">'/file.txt'</span>, (err) =&gt; {
    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Al mismo tiempo, no olvide que el código que se encuentra después de la llamada asincrónica se ejecutará sin esperar la finalización de la operación anterior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por ejemplo, en el siguiente código, el archivo se eliminará antes de leerlo, lo que puede provocar una condición de carrera.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">const</span> fs = require(<span class="hljs-string">'fs'</span>);<font></font>
fs.readFile(<span class="hljs-string">'/file.txt'</span>, (err, data) =&gt; {
  <span class="hljs-comment">// perform actions on file content</span><font></font>
});<font></font>
fs.unlinkSync(<span class="hljs-string">'/file.txt'</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Para evitar esto, puede escribir todas las operaciones en una función sin bloqueo:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">const</span> fs = require(<span class="hljs-string">'fs'</span>);<font></font>
fs.readFile(<span class="hljs-string">'/file.txt'</span>, (err, data) =&gt; {
  <span class="hljs-comment">// perform actions on file content</span>
  fs.unlink(<span class="hljs-string">'/file.txt'</span>, (err) =&gt; {
    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<font></font>
  });<font></font>
});<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verificar campos de entrada</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Verificar </font><b><font style="vertical-align: inherit;">los</font></b><font style="vertical-align: inherit;"> campos de </font><b><font style="vertical-align: inherit;">entrada</font></b><font style="vertical-align: inherit;"> es una parte importante de la seguridad de cualquier aplicación. Los errores de validación pueden hacer que su aplicación se vuelva vulnerable de inmediato a muchos tipos de ataques: inyección sql, xss, inyección de comandos y otros. Para simplificar la validación de formularios, puede usar paquetes de validación, mongo-express-sanitize. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escape de los datos del usuario</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Una de las reglas que lo ayudará a protegerse de los ataques xss es proteger los datos del usuario. Puede usar la biblioteca escape-html o node-esapi para esto. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mantener registros</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Además, ayudará en la depuración de errores, el registro se puede utilizar para responder a incidentes. Puede leer más sobre la necesidad de iniciar sesión </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aquí.</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Uno de los paquetes de registro de NodeJS más populares es Winston y Bunyan. </font><font style="vertical-align: inherit;">El siguiente ejemplo muestra cómo usar Winston para generar registros tanto en la consola como en el archivo:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> logger = <span class="hljs-keyword">new</span> (Winston.Logger) ({<font></font>
    transports: [<font></font>
        <span class="hljs-keyword">new</span> (winston.transports.Console)(),
        <span class="hljs-keyword">new</span> (winston.transports.File)({ filename: <span class="hljs-string">'application.log'</span> })<font></font>
    ],<font></font>
    level: <span class="hljs-string">'verbose'</span><font></font>
});<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Controle el ciclo de eventos</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Si su servidor se encuentra en condiciones de tráfico intenso de red, los usuarios pueden experimentar dificultades con la disponibilidad de su servicio. </font><font style="vertical-align: inherit;">Esto es esencialmente un ataque DoS. </font><font style="vertical-align: inherit;">En este caso, puede rastrear el tiempo de respuesta y, si excede el tiempo especificado, enviar un mensaje a 503 Server Too Busy. </font><font style="vertical-align: inherit;">El módulo toobusy-js puede ayudar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un ejemplo de uso del módulo:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> toobusy = require(<span class="hljs-string">'toobusy-js'</span>);
<span class="hljs-keyword">var</span> express = require(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">var</span> app = express();<font></font>
app.use(function(req, res, next) {<font></font>
    <span class="hljs-keyword">if</span> (toobusy()) {
        <span class="hljs-comment">// log if you see necessary</span>
        res.send(<span class="hljs-number">503</span>, <span class="hljs-string">"Server Too Busy"</span>);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
    next();<font></font>
    }<font></font>
});<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tome precauciones contra la fuerza bruta.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nuevamente, los módulos vienen al rescate. </font><font style="vertical-align: inherit;">Por ejemplo, express-brute o express-bouncer. </font><font style="vertical-align: inherit;">Ejemplo de uso:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> bouncer = require(<span class="hljs-string">'express-bouncer'</span>);<font></font>
bouncer.whitelist.push(<span class="hljs-string">'127.0.0.1'</span>); <span class="hljs-comment">// whitelist an IP address</span>
<span class="hljs-comment">// give a custom error message</span><font></font>
bouncer.blocked = function (req, res, next, remaining) {<font></font>
    res.send(<span class="hljs-number">429</span>, <span class="hljs-string">"Too many requests have been made. Please wait "</span> + remaining/<span class="hljs-number">1000</span> + <span class="hljs-string">" seconds."</span>);<font></font>
};<font></font>
<span class="hljs-comment">// route to protect</span>
app.post(<span class="hljs-string">"/login"</span>, bouncer.block, function(req, res) {
    <span class="hljs-keyword">if</span> (LoginFailed){  }
    <span class="hljs-keyword">else</span> {<font></font>
        bouncer.reset( req );<font></font>
    }<font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usar CAPTCHA es otra contramedida de fuerza bruta común. </font><font style="vertical-align: inherit;">Un módulo de uso frecuente para ayudar a implementar CAPTCHA es svg-captcha. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usar tokens CSRF</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Una de las formas más confiables para protegerse contra los ataques CSRF es usar un token CSRF. </font><font style="vertical-align: inherit;">El token debe ser generado con alta entropía, estrictamente verificado y estar vinculado a la sesión del usuario. </font><font style="vertical-align: inherit;">Para garantizar el funcionamiento del token CSRF, puede utilizar el módulo csurf. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejemplo de uso:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> csrf = require(<span class="hljs-string">'csurf'</span>);<font></font>
csrfProtection = csrf({ cookie: <span class="hljs-keyword">true</span> });<font></font>
app.get(<span class="hljs-string">'/form'</span>, csrfProtection, function(req, res) {<font></font>
    res.render(<span class="hljs-string">'send'</span>, { csrfToken: req.csrfToken() })<font></font>
})<font></font>
app.post(<span class="hljs-string">'/process'</span>, parseForm, csrfProtection, function(req, res) {<font></font>
    res.send(<span class="hljs-string">'data is being processed'</span>);<font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No olvide agregar el token al campo oculto en la página:</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;input type="hidden" name="_csrf" value="{{ csrfToken }}"&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede leer más sobre los tokens CSRF en nuestro </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artículo</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elimine rutas innecesarias. La</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
aplicación web no debe contener páginas que los usuarios no usen, ya que esto puede aumentar la superficie de ataque. Por lo tanto, todas las rutas API no utilizadas deben estar deshabilitadas. Debería prestar especial atención a esta pregunta si utiliza marcos de Sails o Feathers, ya que generan automáticamente puntos finales API. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protéjase de la HPP (contaminación de parámetros HTTP)</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
De forma predeterminada, express agrega todos los parámetros de la solicitud a una matriz. OWASP recomienda utilizar el módulo hpp, que ignora todos los valores de los parámetros de req.query y / o req.body y simplemente selecciona el último valor entre los duplicados.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> hpp = require(<span class="hljs-string">'hpp'</span>);<font></font>
app.use(hpp());<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supervise los valores devueltos.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Por ejemplo, la tabla de usuario puede almacenar datos importantes: contraseña, dirección de correo electrónico, fecha de nacimiento, etc. </font><font style="vertical-align: inherit;">Por lo tanto, es importante devolver solo los datos necesarios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por ejemplo:</font></font><br>
<br>
<pre><code class="java hljs"> <span class="hljs-keyword">exports</span>.sanitizeUser = function(user) {
  <span class="hljs-keyword">return</span> {<font></font>
    id: user.id,<font></font>
    username: user.username,<font></font>
    fullName: user.fullName<font></font>
  };<font></font>
};<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usar descriptores</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Use descriptores para describir el comportamiento de una propiedad para varias operaciones: de escritura, si es posible cambiar el valor de una propiedad, enumerable, si es posible usar una propiedad en un bucle for..in, configurable, si es posible sobrescribir una propiedad. </font><font style="vertical-align: inherit;">Se recomienda prestar atención a las propiedades enumeradas, ya que al definir la propiedad de un objeto, todos estos atributos se establecen en verdadero de forma predeterminada. </font><font style="vertical-align: inherit;">Puede cambiar el valor de las propiedades de la siguiente manera:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> o = {};<font></font>
Object.defineProperty(o, <span class="hljs-string">"a"</span>, {<font></font>
    writable: <span class="hljs-keyword">true</span>,<font></font>
    enumerable: <span class="hljs-keyword">true</span>,<font></font>
    configurable: <span class="hljs-keyword">true</span>,<font></font>
    value: <span class="hljs-string">"A"</span><font></font>
});<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilice ACL</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Acl puede ayudar a diferenciar el acceso a datos en función de los roles. </font><font style="vertical-align: inherit;">Por ejemplo, agregar permisos se ve así:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-comment">// guest is allowed to view blogs</span>
acl.allow(<span class="hljs-string">'guest'</span>, <span class="hljs-string">'blogs'</span>, <span class="hljs-string">'view'</span>)
<span class="hljs-comment">// allow function accepts arrays as any parameter</span>
acl.allow(<span class="hljs-string">'member'</span>, <span class="hljs-string">'blogs'</span>, [<span class="hljs-string">'edit'</span>, <span class="hljs-string">'view'</span>, <span class="hljs-string">'delete'</span>])
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coger uncaughtException</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Por defecto, en el caso de una excepción no capturada, NodeJS tirarán el seguimiento de pila actual y terminar el hilo de ejecución. </font><font style="vertical-align: inherit;">Sin embargo, NodeJS le permite personalizar este comportamiento. </font><font style="vertical-align: inherit;">En el caso de una excepción no detectada, se genera un evento uncaughtException, que se puede detectar utilizando el objeto de proceso:</font></font><br>
<br>
<pre><code class="java hljs">process.on(<span class="hljs-string">"uncaughtException"</span>, function(err) {
    <span class="hljs-comment">// clean up allocated resources</span>
    <span class="hljs-comment">// log necessary error details to log files</span>
    process.exit(); <span class="hljs-comment">// exit the process to avoid unknown state</span><font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vale la pena recordar que cuando se produce una excepción no capturada, es necesario borrar todos los recursos asignados (por ejemplo, descriptores de archivo y controladores) antes de completar el proceso Z para evitar errores imprevistos. </font><font style="vertical-align: inherit;">Se desaconseja encarecidamente que el programa continúe ejecutándose si se produce una excepción no capturada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Además, al mostrar mensajes de error, el usuario no debe revelar información de error detallada, como el seguimiento de la pila.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seguridad del servidor</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Establezca indicadores para los encabezados cuando trabaje con cookies.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Existen varios indicadores que pueden ayudar a proteger contra ataques como xss y csrf: httpOnly, que impide el acceso a las cookies a través de javascript; </font><font style="vertical-align: inherit;">Seguro: permite enviar cookies solo a través de HTTPS y SameSite, lo que determina la capacidad de transferir cookies a un recurso de terceros. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejemplo de uso:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> session = require(<span class="hljs-string">'express-session'</span>);<font></font>
app.use(session({<font></font>
    secret: <span class="hljs-string">'your-secret-key'</span>,<font></font>
    key: <span class="hljs-string">'cookieName'</span>,<font></font>
    cookie: { secure: <span class="hljs-keyword">true</span>, httpOnly: <span class="hljs-keyword">true</span>, path: <span class="hljs-string">'/user'</span>, sameSite: <span class="hljs-keyword">true</span>}<font></font>
}));<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Establecer encabezados HTTP para seguridad</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Los siguientes son encabezados y ejemplos de cómo conectarlos para ayudarlo a protegerse de una serie de ataques comunes. </font><font style="vertical-align: inherit;">Los encabezados se configuran utilizando el módulo de casco </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
• Strict-Transport-Security: HTTP Strict Transport Security (HSTS) le dice al navegador que solo se puede acceder a la aplicación a través de HTTPS</font></font><br>
<br>
<pre><code class="java hljs">app.use(helmet.hsts()); <span class="hljs-comment">// default configuration</span>
app.use(helmet.hsts(<span class="hljs-string">"&lt;max-age&gt;"</span>, <span class="hljs-string">"&lt;includeSubdomains&gt;"</span>)); <span class="hljs-comment">// custom configuration</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
• Opciones de marco X: determina si la página se puede usar en marco, marco flotante, incrustación u objeto</font></font><br>
<br>
<pre><code class="java hljs">app.use(hemlet.xframe()); <span class="hljs-comment">// default behavior (DENY)</span>
helmet.xframe(<span class="hljs-string">'sameorigin'</span>); <span class="hljs-comment">// SAMEORIGIN</span>
helmet.xframe(<span class="hljs-string">'allow-from'</span>, <span class="hljs-string">'http://alloweduri.com'</span>); <span class="hljs-comment">//ALLOW-FROM uri</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
• Protección X-XSS: permite que el navegador deje de cargar la página si detecta un ataque XSS reflejado.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> xssFilter = require(<span class="hljs-string">'x-xss-protection'</span>);<font></font>
app.use(xssFilter());<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
• Opciones de tipo de contenido X: se utilizan para evitar ataques con tipos MIME</font></font><br>
<br>
<pre><code class="java hljs">app.use(helmet.noSniff());
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
• Política de seguridad de contenido: evita ataques como XSS y ataques de inyección de datos</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">const</span> csp = require(<span class="hljs-string">'helmet-csp'</span>)<font></font>
app.use(csp({<font></font>
   directives: {<font></font>
       defaultSrc: [<span class="hljs-string">"'self'"</span>],  <span class="hljs-comment">// default value for all directives that are absent</span>
       scriptSrc: [<span class="hljs-string">"'self'"</span>],   <span class="hljs-comment">// helps prevent XSS attacks</span>
       frameAncestors: [<span class="hljs-string">"'none'"</span>],  <span class="hljs-comment">// helps prevent Clickjacking attacks</span>
       imgSrc: [<span class="hljs-string">"'self'"</span>, <span class="hljs-string">"'http://imgexample.com'"</span>],<font></font>
       styleSrc: [<span class="hljs-string">"'none'"</span>]<font></font>
    }<font></font>
}))<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
• Cache-Control y Pragma: para administrar el almacenamiento en caché, especialmente este encabezado puede ser útil para páginas que contienen datos confidenciales. </font><font style="vertical-align: inherit;">Sin embargo, recuerde que deshabilitar el almacenamiento en caché en todas las páginas puede afectar el rendimiento.</font></font><br>
<br>
<pre><code class="java hljs">app.use(helmet.noCache());
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
• X-Download-Options: el encabezado evita que Inter Explorer ejecute archivos descargados</font></font><br>
<br>
<pre><code class="java hljs">app.use(helmet.ieNoOpen());
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
• Expect-CT: Transparencia de certificados: un mecanismo creado para resolver algunos problemas con la infraestructura de certificados SSL, este encabezado le dice al navegador la necesidad de una verificación de certificado adicional en los registros de CT</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> expectCt = require(<span class="hljs-string">'expect-ct'</span>);<font></font>
app.use(expectCt({ maxAge: <span class="hljs-number">123</span> }));<font></font>
app.use(expectCt({ enforce: <span class="hljs-keyword">true</span>, maxAge: <span class="hljs-number">123</span> }));<font></font>
app.use(expectCt({ enforce: <span class="hljs-keyword">true</span>, maxAge: <span class="hljs-number">123</span>, reportUri: <span class="hljs-string">'http://example.com'</span>}));
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
• X-Powered-By: un encabezado opcional que se utiliza para indicar la tecnología utilizada en el servidor. </font><font style="vertical-align: inherit;">Puede ocultar este encabezado de la siguiente manera:</font></font><br>
<br>
<pre><code class="java hljs">app.use(helmet.hidePoweredBy());
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Además, puede cambiar el valor para ocultar información real sobre las tecnologías que utiliza:</font></font><br>
<br>
<pre><code class="java hljs">app.use(helmet.hidePoweredBy({ setTo: <span class="hljs-string">'PHP 4.2.0'</span> }));
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seguridad de la plataforma</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Actualice sus paquetes La</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
seguridad de su aplicación depende de la seguridad de los paquetes que utiliza, por lo que es importante utilizar la última versión del paquete. Para asegurarse de que el paquete que está utilizando no contenga vulnerabilidades conocidas, puede usar la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lista especial OWASP</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . También puede usar la biblioteca que comprueba los paquetes en busca de vulnerabilidades conocidas Retire.js. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No use funciones inseguras.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay funciones que se recomienda descartar siempre que sea posible. Entre estas funciones está eval (), que ejecuta una cadena tomada como argumento. En combinación con la entrada del usuario, el uso de esta función puede generar vulnerabilidades en la ejecución remota de código, ya que por razones similares, el uso de child_process.exec tampoco es seguro, porque la función pasa los argumentos recibidos a bin / sh. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Además, hay una serie de módulos que debe usar con precaución. Por ejemplo, el módulo fs para trabajar con archivos. Si de alguna manera la entrada del usuario generada se pasa a una función, entonces su aplicación puede volverse vulnerable a incluir un archivo local y un recorrido de directorio.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El módulo vm, que proporciona una API para compilar y ejecutar código en una máquina virtual V8, solo debe usarse en el entorno limitado. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aquí</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> puede familiarizarse con otras funciones que pueden hacer que su aplicación sea insegura. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tenga cuidado al usar expresiones regulares.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Se puede escribir una expresión regular para que pueda lograr una situación en la que la expresión crezca exponencialmente, lo que puede conducir a una denegación de servicio. Tales ataques se llaman ReDoS. Hay varias herramientas para verificar si las expresiones regulares son seguras, una de las cuales es vuln-regex-detector. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejecute linter periódicamente</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante el desarrollo, es difícil tener en cuenta todas las recomendaciones para garantizar la seguridad, y si se trata del desarrollo del equipo, no es fácil lograr el cumplimiento de las reglas por parte de todos los miembros del equipo. Para tales fines, existen herramientas para el análisis de seguridad estático. Dichas herramientas, sin ejecutar su código, buscan vulnerabilidades en él. Además, las listas le permiten agregar reglas personalizadas para encontrar lugares en el código que pueden ser vulnerables. Las linters más utilizadas son ESLint y JSHint. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilice el modo estricto.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Javascript tiene una serie de funciones inseguras y obsoletas que no deben utilizarse. Para excluir la posibilidad de usar estas funciones, también se proporciona el modo estricto. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adherirse a los principios generales de seguridad.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las recomendaciones descritas se centran en NodeJS, pero no se olvide de los principios generales de seguridad que deben observarse independientemente de la plataforma utilizada.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es493702/index.html">Transición masiva al trabajo remoto: problemas técnicos y amenazas a la seguridad.</a></li>
<li><a href="../es493704/index.html">Usar TypeScript en JavaScript sin escribir TypeScript</a></li>
<li><a href="../es493706/index.html">Conoce a tu enemigo: crea una puerta trasera Node.js</a></li>
<li><a href="../es493708/index.html">Anatomía de mi hogar Kubernetes cluster</a></li>
<li><a href="../es493712/index.html">Nuevas características de TypeScript para una usabilidad mejorada</a></li>
<li><a href="../es493716/index.html">Escriba inferencia con TypeScript utilizando la construcción as const y la palabra clave inferir</a></li>
<li><a href="../es493718/index.html">Discusión: utilidades estándar de UNIX que pocos han usado y están usando actualmente</a></li>
<li><a href="../es493720/index.html">La tormenta perfecta: cómo la tecnología está cambiando la industria del servicio de alimentos</a></li>
<li><a href="../es493724/index.html">RPA | Robotización de procesos a través de los ojos de un analista</a></li>
<li><a href="../es493726/index.html">Complejo de detección de fumar por foto o video basado en Intel NUC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>