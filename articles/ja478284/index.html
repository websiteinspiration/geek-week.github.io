<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✊🏿 👩🏿‍💻 🍭 Huaweiが最近オープンしたArkコンパイラコードの確認 🈺 🤲🏽 ✍🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Huaweiは、2019年の夏のプレゼンテーション中に、Ark Compilerテクノロジーを発表しました。同社の代表によると、このオープンソースプロジェクトは、Androidおよびサードパーティアプリケーションのスムーズさと応答性を大幅に向上させることができます。伝統的に、新しい興味深いオープンソ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Huaweiが最近オープンしたArkコンパイラコードの確認</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/478284/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e03/5c8/f22/e035c8f22108a3bbe00865f9307244fe.png" alt="写真1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Huaweiは、2019年の夏のプレゼンテーション中に、Ark Compilerテクノロジーを発表しました。</font><font style="vertical-align: inherit;">同社の代表によると、このオープンソースプロジェクトは、Androidおよびサードパーティアプリケーションのスムーズさと応答性を大幅に向上させることができます。</font><font style="vertical-align: inherit;">伝統的に、新しい興味深いオープンソースプロジェクトは、PVS-Studioを使用したコード品質管理に合格する必要があります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Huawei Arkコンパイラは、Huawei P30およびP30 Proスマートフォンの発売とともに初めて導入されました。</font><font style="vertical-align: inherit;">Huaweiによると、ArkコンパイラーはAndroidの滑らかさを24％、応答速度を44％改善しました。</font><font style="vertical-align: inherit;">同時に、Arkを使用して再コンパイルした後、サードパーティのAndroidアプリケーションは60％高速に実行できます。</font><font style="vertical-align: inherit;">開いているプロジェクトは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenArkCompiler</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そのソースコードは、GitHubサイトの対応する中国語版（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gitee</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）から入手できます</font><font style="vertical-align: inherit;">。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクトをテストするために、静的コードアナライザー</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-PVS-Studio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、C、C ++、C＃、およびJavaで記述されたプログラムのソースコードのエラーおよび潜在的な脆弱性を検出するためのツールです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーは、50K行のコードでプロジェクトにすばやく対応しました。</font><font style="vertical-align: inherit;">小規模なプロジェクトの場合、分析の結果は控えめです。記事には、39個中11個の警告（高レベルと中レベル）が含まれていました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コード欠陥の概要</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告1 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V502</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">おそらく「？：」演算子は、予期されたものとは異なる方法で動作します。</font><font style="vertical-align: inherit;">「？：」演算子の優先順位は「==」演算子よりも低くなっています。</font><font style="vertical-align: inherit;">mir_parser.cpp 884</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">enum</span> Opcode : uint8 {<font></font>
  kOpUndef,<font></font>
  ....<font></font>
  OP_intrinsiccall,<font></font>
  OP_intrinsiccallassigned,<font></font>
  ....<font></font>
  kOpLast,<font></font>
};<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">MIRParser::ParseStmtIntrinsiccall</span><span class="hljs-params">(StmtNodePtr &amp;stmt, <span class="hljs-keyword">bool</span> isAssigned)</span> </span>{<font></font>
  Opcode o = !isAssigned ? (....)<font></font>
                         : (....);<font></font>
  <span class="hljs-keyword">auto</span> *intrnCallNode = mod.CurFuncCodeMemPool()-&gt;New&lt;IntrinsiccallNode&gt;(....);<font></font>
  lexer.NextToken();<font></font>
  <span class="hljs-keyword">if</span> (o == !isAssigned ? OP_intrinsiccall : OP_intrinsiccallassigned) {<font></font>
    intrnCallNode-&gt;SetIntrinsic(GetIntrinsicID(lexer.GetTokenKind()));<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    intrnCallNode-&gt;SetIntrinsic(<span class="hljs-keyword">static_cast</span>&lt;MIRIntrinsicID&gt;(....));<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードの次の部分に関心があります。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">if</span> (o == !isAssigned ? OP_intrinsiccall : OP_intrinsiccallassigned) {<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
演算子 '=='は、三項演算子（？:)よりも優先されます。</font><font style="vertical-align: inherit;">したがって、条件式は正しく計算されません。</font><font style="vertical-align: inherit;">書かれたコードは次のものと同等です：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">if</span> ((o == !isAssigned) ? OP_intrinsiccall : OP_intrinsiccallassigned) {<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、定数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OP_intrinsiccall</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OP_intrinsiccallassignedの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値がゼロ以外で</font><font style="vertical-align: inherit;">あることを考慮する</font><font style="vertical-align: inherit;">と</font><font style="vertical-align: inherit;">、この条件は常に真の値を返します。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">else</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブランチの本体</font><font style="vertical-align: inherit;">が到達できないコードです。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告2 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V570</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'theDoubleVal'変数がそれ自体に割り当てられています。</font><font style="vertical-align: inherit;">lexer.cpp 283</font></font><br>
<br>
<pre><code class="cpp hljs">int64 theIntVal = <span class="hljs-number">0</span>;
<span class="hljs-keyword">float</span> theFloatVal = <span class="hljs-number">0.0</span>;
<span class="hljs-keyword">double</span> theDoubleVal = <span class="hljs-number">0.0</span>;<font></font>
<font></font>
TokenKind MIRLexer<font></font>
::GetFloatConst(uint32 valStart, uint32 startIdx, <span class="hljs-keyword">bool</span> negative) {<font></font>
  ....<font></font>
  theIntVal = <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(theFloatVal);<font></font>
  theDoubleVal = <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">double</span>&gt;(theDoubleVal); <span class="hljs-comment">// &lt;=</span>
  <span class="hljs-keyword">if</span> (theFloatVal == <span class="hljs-number">-0</span>) {<font></font>
    theDoubleVal = -theDoubleVal;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DoubleVal</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
変数</font><i><font style="vertical-align: inherit;">は</font></i><font style="vertical-align: inherit;">それ自体に割り当てられ</font><font style="vertical-align: inherit;">ます</font><i><font style="vertical-align: inherit;">が</font></i><font style="vertical-align: inherit;">、まったく変更されません。</font><font style="vertical-align: inherit;">ほとんどの場合、彼らは結果を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">theFloatVal</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数に書きたかったのです</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">条件で使用されるのはこの変数です。</font><font style="vertical-align: inherit;">この場合、型変換は</font><i><font style="vertical-align: inherit;">double</font></i><font style="vertical-align: inherit;">ではなく、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">floatに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変換する必要があります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">コードを次のようにすることを提案します。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs">theFloatVal = <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">float</span>&gt;(theDoubleVal);
<span class="hljs-keyword">if</span> (theFloatVal == <span class="hljs-number">-0</span>) {<font></font>
  theDoubleVal = -theDoubleVal;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
または、単に条件で変数を混同した場合でも、</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">if</span> (theDoubleVal == <span class="hljs-number">-0</span>) {<font></font>
  theDoubleVal = -theDoubleVal;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
でも、多分私は間違っているし、すべてが違うはずだ。</font><font style="vertical-align: inherit;">このコードは、私のようなサードパーティのプログラマーには非常に理解しにくいように見えます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告3-5 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V524</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「-」関数の本体が「+」関数の本体と完全に同等であるのは奇妙です。</font><font style="vertical-align: inherit;">mpl_number.h 158</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">typename</span> Tag&gt;
<span class="hljs-keyword">inline</span> Number&lt;T, Tag&gt; <span class="hljs-keyword">operator</span>+(<span class="hljs-keyword">const</span> Number&lt;T, Tag&gt; &amp;lhs,
                                <span class="hljs-keyword">const</span> Number&lt;T, Tag&gt; &amp;rhs) {
  <span class="hljs-keyword">return</span> Number&lt;T, Tag&gt;(lhs.get() + rhs.get());<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">typename</span> Tag&gt;
<span class="hljs-keyword">inline</span> Number&lt;T, Tag&gt; <span class="hljs-keyword">operator</span>-(<span class="hljs-keyword">const</span> Number&lt;T, Tag&gt; &amp;lhs,
                                <span class="hljs-keyword">const</span> Number&lt;T, Tag&gt; &amp;rhs) {
  <span class="hljs-keyword">return</span> Number&lt;T, Tag&gt;(lhs.get() + rhs.get());<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ヘッダーファイル</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mpl_number.hで</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、マイナーな変更を加えた多くのコード</font><i><font style="vertical-align: inherit;">を</font></i><font style="vertical-align: inherit;">複製しました。</font><font style="vertical-align: inherit;">そしてもちろん、彼らは間違いを犯した。</font><font style="vertical-align: inherit;">この例では、加算演算子と減算演算子は同じように実装されています。</font><font style="vertical-align: inherit;">減算演算子の本体で、演算の符号を変更するのを忘れていました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらにいくつかの例を示します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V524「-」関数の本体が「+」関数の本体と完全に同等であるのは奇妙です。</font><font style="vertical-align: inherit;">mpl_number.h 233</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V524「-」関数の本体が「+」関数の本体と完全に同等であるのは奇妙です。</font><font style="vertical-align: inherit;">mpl_number.h 238</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告6 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V560</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件式の一部は常にfalseです：！FirstImport。</font><font style="vertical-align: inherit;">parser.cpp 2633</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">MIRParser::ParseMIRForImport</span><span class="hljs-params">()</span> </span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (paramIsIPA &amp;&amp; firstImport) {<font></font>
    BinaryMplt *binMplt = <span class="hljs-keyword">new</span> BinaryMplt(mod);<font></font>
    mod.SetBinMplt(binMplt);<font></font>
    <span class="hljs-keyword">if</span> (!(*binMplt).Import(...., paramIsIPA &amp;&amp; !firstImport, paramIsComb)) {<font></font>
      ....<font></font>
    }<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の条件式の本体では、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">firstImport</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数</font><i><font style="vertical-align: inherit;">は</font></i><font style="vertical-align: inherit;">常に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">この場合、式</font></font><br>
<br>
<pre><code class="cpp hljs">paramIsIPA &amp;&amp; !firstImport</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
常に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falseに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このコードには論理エラーが含まれているか、定数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Import</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数に</font><font style="vertical-align: inherit;">渡すことで簡略化できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告7 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V547</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式 'idx&gt; = 0'は常に真です。</font><font style="vertical-align: inherit;">符号なしの型の値は常に&gt; = 0です。lexer.h 129</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">char</span> <span class="hljs-title">GetCharAtWithLowerCheck</span><span class="hljs-params">(uint32 idx)</span> <span class="hljs-keyword">const</span> </span>{
  <span class="hljs-keyword">return</span> idx &gt;= <span class="hljs-number">0</span> ? line[idx] : <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この方法（&gt; = 0）で</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
インデックス変数をチェックする</font><font style="vertical-align: inherit;">ことは、符号なしの型であるため意味がありません。</font><font style="vertical-align: inherit;">おそらくここでは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配列</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">別のアクセス境界のチェックを追加するか、</font><font style="vertical-align: inherit;">この無意味なチェックを削除するだけの</font><font style="vertical-align: inherit;">価値があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告8 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V728</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">過剰チェックは簡略化できます。</font><font style="vertical-align: inherit;">'||' </font><font style="vertical-align: inherit;">演算子は、反対の式 'c！=' \ "''および 'c ==' \" ''で囲まれています。</font><font style="vertical-align: inherit;">lexer.cpp 400</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">TokenKind <span class="hljs-title">MIRLexer::GetTokenWithPrefixDoubleQuotation</span><span class="hljs-params">()</span> </span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">char</span> c = GetCurrentCharWithUpperCheck();
  <span class="hljs-keyword">while</span> ((c != <span class="hljs-number">0</span>) &amp;&amp;<font></font>
         (c != <span class="hljs-string">'\"'</span> || (c == <span class="hljs-string">'\"'</span> &amp;&amp; GetCharAtWithLowerCheck(....) == <span class="hljs-string">'\\'</span>))) {<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーは、簡略化できるコードパターンを「キャッチ」しました。</font><font style="vertical-align: inherit;">パターンは次のようになります。</font></font><br>
<br>
<pre><code class="cpp hljs">A || (!A &amp;&amp; smth)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
式</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">！A</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は常に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trueに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次に、最初の例を次のように簡略化できます。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">while</span> ((c != <span class="hljs-number">0</span>) &amp;&amp; (c != <span class="hljs-string">'\"'</span> || (GetCharAtWithLowerCheck(....) == <span class="hljs-string">'\\'</span>))) {<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告9-10 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V728</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">過度のチェックは簡略化できます。</font><font style="vertical-align: inherit;">'（A &amp;&amp;！B）|| </font><font style="vertical-align: inherit;">（！A &amp;&amp; B） '式は、' bool（A）！= Bool（B） '式と同等です。</font><font style="vertical-align: inherit;">mir_nodes.cpp 1552</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">BinaryNode::Verify</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> ((IsAddress(GetBOpnd(<span class="hljs-number">0</span>)-&gt;GetPrimType()) &amp;&amp;<font></font>
      !IsAddress(GetBOpnd(<span class="hljs-number">1</span>)-&gt;GetPrimType()))<font></font>
    ||<font></font>
     (!IsAddress(GetBOpnd(<span class="hljs-number">0</span>)-&gt;GetPrimType()) &amp;&amp;<font></font>
       IsAddress(GetBOpnd(<span class="hljs-number">1</span>)-&gt;GetPrimType()))) {<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リファクタリングできるコードの別の例。</font><font style="vertical-align: inherit;">例自体は、便宜上、いくつかの行に分かれています。</font><font style="vertical-align: inherit;">原文では、条件式が長い2行で記述されているため、読みやすさが大幅に低下しています。</font><font style="vertical-align: inherit;">このコードは、より簡単かつ明確に記述できます。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">if</span> (IsAddress(GetBOpnd(<span class="hljs-number">0</span>)-&gt;GetPrimType()) !=<font></font>
    IsAddress(GetBOpnd(<span class="hljs-number">1</span>)-&gt;GetPrimType()))<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同様のリファクタリングを実行できる別の場所：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V728過剰チェックを簡略化できます。</font><font style="vertical-align: inherit;">'（A &amp;&amp; B）|| </font><font style="vertical-align: inherit;">（！A &amp;&amp;！B） '式は、' bool（A）== bool（B） '式と同等です。</font><font style="vertical-align: inherit;">bin_mpl_import.cpp 702</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告11 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V1048</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'floatSpec-&gt; floatStr'変数に同じ値が割り当てられました。</font><font style="vertical-align: inherit;">input.inl 1356</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SecInitFloatSpec</span><span class="hljs-params">(SecFloatSpec *floatSpec)</span>
</span>{<font></font>
  floatSpec-&gt;floatStr = floatSpec-&gt;buffer;<font></font>
  floatSpec-&gt;allocatedFloatStr = <span class="hljs-literal">NULL</span>;<font></font>
  floatSpec-&gt;floatStrSize = <span class="hljs-keyword">sizeof</span>(floatSpec-&gt;buffer) /
                            <span class="hljs-keyword">sizeof</span>(floatSpec-&gt;buffer[<span class="hljs-number">0</span>]);<font></font>
  floatSpec-&gt;floatStr = floatSpec-&gt;buffer;<font></font>
  floatSpec-&gt;floatStrUsedLen = <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーは、変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">floatSpec-&gt; floatStrの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2つの同一の初期化行を検出し</font><i><font style="vertical-align: inherit;">ました</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ほとんどの場合、余分な行を削除できます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最近では、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Huawei Cloud DIS SDK</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードを確認しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">Huaweiは、コードを積極的に公開し始めました。これは、開発者コミュニティにとって朗報です。</font><font style="vertical-align: inherit;">Ark CompilerやHarmony OSなどのプロジェクトが登場したばかりで、まだ普及していません。</font><font style="vertical-align: inherit;">この段階でプロジェクトコードの品質管理に投資することは、潜在的な脆弱性やユーザーの批判を回避できるため、非常に有益です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイトリンク</font></font></h2><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2011年のLLVM検証</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2012年のLLVMの検証</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2016年のGCCチェック</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2016年のLLVM検証</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2017年のPascalABC.NETの確認</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2019年のRoslyn（.NETコンパイラプラットフォーム）の確認</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2019年のLLVMの検証</font></font></a></li>
</ol><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事を英語を話す視聴者と共有したい場合は、翻訳へのリンクを使用してください：Svyatoslav Razmyslov。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Huaweiが最近オープンソースにしたArkコンパイラーの確認</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja478268/index.html">優れた技術リーダーになるための10のヒント</a></li>
<li><a href="../ja478270/index.html">先週のフロントエンドの世界からの新鮮な食材のダイジェストNo.391（11月25日-2019年12月1日）</a></li>
<li><a href="../ja478274/index.html">12月2〜8日のサンクトペテルブルクでのデジタルイベント</a></li>
<li><a href="../ja478276/index.html">12月2〜8日のモスクワでのデジタルイベント</a></li>
<li><a href="../ja478280/index.html">なぜ石油化学のデジタルが倍増するのですか？</a></li>
<li><a href="../ja478286/index.html">ランダムフォレスト、ニューラルオートエンコーダ、分離フォレストアルゴリズムを使用した不正検出</a></li>
<li><a href="../ja478288/index.html">Android用のシンプルなMagiskモジュールの作成</a></li>
<li><a href="../ja478290/index.html">スタートアップを開発し、海外市場に参入するための投資家を見つける方法</a></li>
<li><a href="../ja478292/index.html">サイズが重要</a></li>
<li><a href="../ja478294/index.html">11月の機械学習と人工知能のニュースダイジェスト</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>