<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎚️ 👨🏿‍🎓 🤞 Glasses of twilight vision. Android Camera2 API from the Maker Part 5 Flash 🧐 ✊🏾 🏴‍☠️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Living in an era of technological breakthroughs and accomplishments, looking at how the Mask and Bezos rockets rush into the sky, we, ordinary people ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Glasses of twilight vision. Android Camera2 API from the Maker Part 5 Flash</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493922/"><img src="https://habrastorage.org/webt/tx/oq/s6/txoqs60bhzv_4rncgu5ptr9ucw8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Living in an era of technological breakthroughs and accomplishments, looking at how the Mask and Bezos rockets rush into the sky, we, ordinary people with a higher technical education, often do not notice the possibility of making a breakthrough not there, far in space, but here next to us, literally not getting up </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from the sofa</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> from the table. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Judge for yourself what discovery can lead to reading a regular article about modern smartphones. I will not give the source, so as not to share future income.</font></font><br>
<blockquote>   , ,   .    « »   Google Pixel.   IT      RAW, HDR-,  «»,   .       Pixel 4  «Night Sight»     .      : <b>   ,     </b>.    ,               .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another thing is that walking at night and scrubbing at the screen of a mobile phone is somehow uncomfortable, even in night mode. And then my eyes accidentally fell on a VR-headset for a smartphone, lying on a shelf. The breakthrough has come true! It remains only, using it and the knowledge accumulated over four posts about the Android Camera2 API, to direct the image from "Night Sight" directly into the eye. At the same time, hands will be free to catch a black cat in a dark room. Without light, of course, it will not work, photons, at least a little, but it is necessary. But at least we must reach (or even surpass) the level of Kotan’s peepers in the dark.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, to learn how to see in the dark, we need: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1: a virtual reality headset for a smartphone, (the cheapest one possible) </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/np/k-/ez/npk-ezks0qloiospgbwwpsvykdi.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2: a smartphone with support for modern guglofich for a camera (well, it definitely won’t be the cheapest) </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/pv/vd/-o/pvvd-oddmidov1bssl0xi4hgziu.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3: knowledge of the basics of Android Camera2 API (we already have it) </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">part one </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">part two </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">part three </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">part four</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
We open a new project in Android Studio and start sculpting the code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first thing to do is to assemble the actual VR surface that will shine in the headset.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Layout</font></font></b><div class="spoiler_text"><pre><code class="java hljs">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;<font></font>
&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
    xmlns:app=<span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span>
    xmlns:tools=<span class="hljs-string">"http://schemas.android.com/tools"</span>
    android:layout_width=<span class="hljs-string">"match_parent"</span>
    android:layout_height=<span class="hljs-string">"match_parent"</span>
    android:background=<span class="hljs-string">"#03061B"</span>
    tools:context=<span class="hljs-string">".MainActivity"</span>&gt;<font></font>
<font></font>
    &lt;TextureView<font></font>
        android:id=<span class="hljs-string">"@+id/textureView"</span>
        android:layout_width=<span class="hljs-string">"240dp"</span>
        android:layout_height=<span class="hljs-string">"320dp"</span>
        android:layout_marginTop=<span class="hljs-string">"28dp"</span>
        app:layout_constraintEnd_toEndOf=<span class="hljs-string">"parent"</span>
        app:layout_constraintHorizontal_bias=<span class="hljs-string">"0.497"</span>
        app:layout_constraintStart_toStartOf=<span class="hljs-string">"parent"</span>
        app:layout_constraintTop_toTopOf=<span class="hljs-string">"parent"</span> /&gt;<font></font>
<font></font>
    &lt;TextureView<font></font>
        android:id=<span class="hljs-string">"@+id/textureView3"</span>
        android:layout_width=<span class="hljs-string">"240dp"</span>
        android:layout_height=<span class="hljs-string">"320dp"</span>
        android:layout_marginTop=<span class="hljs-string">"16dp"</span>
        app:layout_constraintEnd_toEndOf=<span class="hljs-string">"parent"</span>
        app:layout_constraintStart_toStartOf=<span class="hljs-string">"parent"</span>
        app:layout_constraintTop_toBottomOf=<span class="hljs-string">"@+id/textureView"</span> /&gt;<font></font>
<font></font>
    &lt;LinearLayout<font></font>
        android:layout_width=<span class="hljs-string">"165dp"</span>
        android:layout_height=<span class="hljs-string">"40dp"</span>
        app:layout_constraintBottom_toBottomOf=<span class="hljs-string">"parent"</span>
        app:layout_constraintEnd_toEndOf=<span class="hljs-string">"parent"</span>
        app:layout_constraintStart_toStartOf=<span class="hljs-string">"parent"</span>
        app:layout_constraintTop_toBottomOf=<span class="hljs-string">"@+id/textureView3"</span>
        app:layout_constraintVertical_bias=<span class="hljs-string">"0.838"</span>&gt;<font></font>
<font></font>
        &lt;Button<font></font>
            android:id=<span class="hljs-string">"@+id/button1"</span>
            android:layout_width=<span class="hljs-string">"wrap_content"</span>
            android:layout_height=<span class="hljs-string">"36dp"</span>
            android:backgroundTint=<span class="hljs-string">"#3F51B5"</span>
            android:text=<span class="hljs-string">""</span>
            android:textColor=<span class="hljs-string">"#1A87DD"</span> /&gt;<font></font>
<font></font>
        &lt;Button<font></font>
            android:id=<span class="hljs-string">"@+id/button3"</span>
            android:layout_width=<span class="hljs-string">"wrap_content"</span>
            android:layout_height=<span class="hljs-string">"37dp"</span>
            android:backgroundTint=<span class="hljs-string">"#3F51B5"</span>
            android:text=<span class="hljs-string">""</span>
            android:textColor=<span class="hljs-string">"#2196F3"</span> /&gt;<font></font>
    &lt;/LinearLayout&gt;<font></font>
<font></font>
<font></font>
&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;<font></font>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The output should have something like this: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hr/jg/2q/hrjg2qobc-qqy0spe_bgge_hx9k.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As you can see, the textures turned out to be rectangular, while in any VR toy for a smartphone, developers somehow manage to make them round. </font><font style="vertical-align: inherit;">But we will not dwell on this. </font><font style="vertical-align: inherit;">Further experience will still show that it will do. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For this, in fact, we write a modest Activity, in which everything is already familiar to us from previous articles.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> com.example.twovideosurfaces;
<span class="hljs-keyword">import</span> androidx.annotation.RequiresApi;
<span class="hljs-keyword">import</span> androidx.appcompat.app.AppCompatActivity;
<span class="hljs-keyword">import</span> androidx.core.content.ContextCompat;
<span class="hljs-keyword">import</span> android.Manifest;
<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.content.pm.ActivityInfo;
<span class="hljs-keyword">import</span> android.content.pm.PackageManager;
<span class="hljs-keyword">import</span> android.graphics.SurfaceTexture;
<span class="hljs-keyword">import</span> android.hardware.camera2.CameraAccessException;
<span class="hljs-keyword">import</span> android.hardware.camera2.CameraCaptureSession;
<span class="hljs-keyword">import</span> android.hardware.camera2.CameraDevice;
<span class="hljs-keyword">import</span> android.hardware.camera2.CameraManager;
<span class="hljs-keyword">import</span> android.hardware.camera2.CaptureRequest;
<span class="hljs-keyword">import</span> android.os.Build;
<span class="hljs-keyword">import</span> android.os.Bundle;
<span class="hljs-keyword">import</span> android.os.Handler;
<span class="hljs-keyword">import</span> android.os.HandlerThread;
<span class="hljs-keyword">import</span> android.os.StrictMode;
<span class="hljs-keyword">import</span> android.util.Log;
<span class="hljs-keyword">import</span> android.view.Surface;
<span class="hljs-keyword">import</span> android.view.TextureView;
<span class="hljs-keyword">import</span> android.view.View;
<span class="hljs-keyword">import</span> android.widget.Button;
<span class="hljs-keyword">import</span> java.util.Arrays;
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppCompatActivity</span>  </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String LOG_TAG = <span class="hljs-string">"myLogs"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Surface surface1 = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Surface surface2 = <span class="hljs-keyword">null</span>;<font></font>
    CameraService[] myCameras = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> CameraManager mCameraManager = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> CAMERA1 = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> Button mOn = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> Button mOff = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> TextureView mImageViewUp = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> TextureView mImageViewDown = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> HandlerThread mBackgroundThread;
    <span class="hljs-keyword">private</span> Handler mBackgroundHandler = <span class="hljs-keyword">null</span>;
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startBackgroundThread</span><span class="hljs-params">()</span> </span>{<font></font>
        mBackgroundThread = <span class="hljs-keyword">new</span> HandlerThread(<span class="hljs-string">"CameraBackground"</span>);<font></font>
        mBackgroundThread.start();<font></font>
        mBackgroundHandler = <span class="hljs-keyword">new</span> Handler(mBackgroundThread.getLooper());<font></font>
    }<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stopBackgroundThread</span><span class="hljs-params">()</span> </span>{<font></font>
        mBackgroundThread.quitSafely();<font></font>
        <span class="hljs-keyword">try</span> {<font></font>
            mBackgroundThread.join();<font></font>
            mBackgroundThread = <span class="hljs-keyword">null</span>;<font></font>
            mBackgroundHandler = <span class="hljs-keyword">null</span>;<font></font>
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {<font></font>
            e.printStackTrace();<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-meta">@RequiresApi(api = Build.VERSION_CODES.M)</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> </span>{
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);<font></font>
        StrictMode.ThreadPolicy policy = <span class="hljs-keyword">new</span> StrictMode.ThreadPolicy.Builder().permitAll().build();<font></font>
        StrictMode.setThreadPolicy(policy);<font></font>
        setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_PORTRAIT);<font></font>
        setContentView(R.layout.activity_main);<font></font>
        Log.d(LOG_TAG, <span class="hljs-string">" "</span>);
        <span class="hljs-keyword">if</span> (checkSelfPermission(Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED<font></font>
                ||<font></font>
                (ContextCompat.checkSelfPermission(MainActivity.<span class="hljs-keyword">this</span>, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED)<font></font>
        ) {<font></font>
            requestPermissions(<span class="hljs-keyword">new</span> String[]{Manifest.permission.CAMERA, Manifest.permission.WRITE_EXTERNAL_STORAGE}, <span class="hljs-number">1</span>);<font></font>
        }<font></font>
        mOn = findViewById(R.id.button1);<font></font>
        mOff = findViewById(R.id.button3);<font></font>
        mImageViewUp = findViewById(R.id.textureView);<font></font>
        mImageViewDown = findViewById(R.id.textureView3);<font></font>
        mOn.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View v)</span> </span>{
                <span class="hljs-keyword">if</span> (myCameras[CAMERA1] != <span class="hljs-keyword">null</span>) {<span class="hljs-comment">//  </span>
                    <span class="hljs-keyword">if</span> (!myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].openCamera();<font></font>
                }<font></font>
            }<font></font>
        });<font></font>
        mOff.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View v)</span> </span>{<font></font>
            }<font></font>
        });<font></font>
        mCameraManager = (CameraManager) getSystemService(Context.CAMERA_SERVICE);<font></font>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">//     </span>
            myCameras = <span class="hljs-keyword">new</span> CameraService[mCameraManager.getCameraIdList().length];
            <span class="hljs-keyword">for</span> (String cameraID : mCameraManager.getCameraIdList()) {<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"cameraID: "</span> + cameraID);
                <span class="hljs-keyword">int</span> id = Integer.parseInt(cameraID);
                <span class="hljs-comment">//    </span>
                myCameras[id] = <span class="hljs-keyword">new</span> CameraService(mCameraManager, cameraID);<font></font>
            }<font></font>
        } <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
            Log.e(LOG_TAG, e.getMessage());<font></font>
            e.printStackTrace();<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CameraService</span> </span>{
        <span class="hljs-keyword">private</span> String mCameraID;
        <span class="hljs-keyword">private</span> CameraDevice mCameraDevice = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">private</span> CameraCaptureSession mSession;
        <span class="hljs-keyword">private</span> CaptureRequest.Builder mPreviewBuilder;
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CameraService</span><span class="hljs-params">(CameraManager cameraManager, String cameraID)</span> </span>{<font></font>
            mCameraManager = cameraManager;<font></font>
            mCameraID = cameraID;<font></font>
        }<font></font>
        <span class="hljs-keyword">private</span> CameraDevice.StateCallback mCameraCallback = <span class="hljs-keyword">new</span> CameraDevice.StateCallback() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onOpened</span><span class="hljs-params">(CameraDevice camera)</span> </span>{<font></font>
                mCameraDevice = camera;<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"Open camera  with id:"</span> + mCameraDevice.getId());<font></font>
                startCameraPreviewSession();<font></font>
            }<font></font>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDisconnected</span><span class="hljs-params">(CameraDevice camera)</span> </span>{<font></font>
                mCameraDevice.close();<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"disconnect camera  with id:"</span> + mCameraDevice.getId());<font></font>
                mCameraDevice = <span class="hljs-keyword">null</span>;<font></font>
            }<font></font>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onError</span><span class="hljs-params">(CameraDevice camera, <span class="hljs-keyword">int</span> error)</span> </span>{<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"error! camera id:"</span> + camera.getId() + <span class="hljs-string">" error:"</span> + error);<font></font>
            }<font></font>
        };<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startCameraPreviewSession</span><span class="hljs-params">()</span> </span>{<font></font>
            SurfaceTexture texture = mImageViewUp.getSurfaceTexture();<font></font>
            texture.setDefaultBufferSize(<span class="hljs-number">1280</span>, <span class="hljs-number">1024</span>);<font></font>
            surface1 = <span class="hljs-keyword">new</span> Surface(texture);<font></font>
            SurfaceTexture texture2 = mImageViewDown.getSurfaceTexture();<font></font>
            surface2 = <span class="hljs-keyword">new</span> Surface(texture2);<font></font>
            texture2.setDefaultBufferSize(<span class="hljs-number">1280</span>, <span class="hljs-number">1024</span>);
            <span class="hljs-keyword">try</span> {<font></font>
                mPreviewBuilder = mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_RECORD);<font></font>
                mPreviewBuilder.addTarget(surface1);<font></font>
                mPreviewBuilder.addTarget(surface2);<font></font>
                mCameraDevice.createCaptureSession(Arrays.asList(surface1,surface2),<font></font>
                        <span class="hljs-keyword">new</span> CameraCaptureSession.StateCallback() {
                            <span class="hljs-meta">@Override</span>
                            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onConfigured</span><span class="hljs-params">(CameraCaptureSession session)</span> </span>{<font></font>
                                mSession = session;<font></font>
<font></font>
                                <span class="hljs-keyword">try</span> {<font></font>
                                    mSession.setRepeatingRequest(mPreviewBuilder.build(), <span class="hljs-keyword">null</span>, mBackgroundHandler);<font></font>
                                } <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
                                    e.printStackTrace();<font></font>
                                }<font></font>
                            }<font></font>
                            <span class="hljs-meta">@Override</span>
                            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onConfigureFailed</span><span class="hljs-params">(CameraCaptureSession session)</span> </span>{<font></font>
                            }<font></font>
                        }, mBackgroundHandler);<font></font>
            } <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
                e.printStackTrace();<font></font>
            }<font></font>
        }<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isOpen</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">if</span> (mCameraDevice == <span class="hljs-keyword">null</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<font></font>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<font></font>
            }<font></font>
        }<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">openCamera</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">if</span> (checkSelfPermission(Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED) {<font></font>
                    mCameraManager.openCamera(mCameraID, mCameraCallback, mBackgroundHandler);<font></font>
                }<font></font>
            } <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
                Log.i(LOG_TAG, e.getMessage());<font></font>
            }<font></font>
        }<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">closeCamera</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">if</span> (mCameraDevice != <span class="hljs-keyword">null</span>) {<font></font>
                mCameraDevice.close();<font></font>
                mCameraDevice = <span class="hljs-keyword">null</span>;<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onPause</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (myCameras[CAMERA1].isOpen()) {<font></font>
            myCameras[CAMERA1].closeCamera();<font></font>
        }<font></font>
        stopBackgroundThread();<font></font>
        <span class="hljs-keyword">super</span>.onPause();<font></font>
    }<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResume</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">super</span>.onResume();<font></font>
        startBackgroundThread();<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yes, and do not forget about </font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manifesto</font></font></b><div class="spoiler_text"><pre><code class="java hljs">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;<font></font>
&lt;manifest xmlns:android=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-keyword">package</span>=<span class="hljs-string">"com.example.twovideosurfaces"</span>&gt;<font></font>
    &lt;uses-permission android:name=<span class="hljs-string">"android.permission.CAMERA"</span> /&gt;<font></font>
    &lt;uses-permission android:name=<span class="hljs-string">"android.permission.WRITE_EXTERNAL_STORAGE"</span> /&gt;<font></font>
    &lt;uses-permission android:name=<span class="hljs-string">"android.permission.INTERNET"</span>/&gt;<font></font>
    &lt;application<font></font>
        android:allowBackup=<span class="hljs-string">"true"</span>
        android:icon=<span class="hljs-string">"@mipmap/ic_launcher"</span>
        android:label=<span class="hljs-string">"@string/app_name"</span>
        android:roundIcon=<span class="hljs-string">"@mipmap/ic_launcher_round"</span>
        android:supportsRtl=<span class="hljs-string">"true"</span>
        android:theme=<span class="hljs-string">"@style/Theme.AppCompat.NoActionBar"</span><font></font>
        &gt;<font></font>
        &lt;activity android:name=<span class="hljs-string">".MainActivity"</span>&gt;<font></font>
            &lt;intent-filter&gt;<font></font>
                &lt;action android:name=<span class="hljs-string">"android.intent.action.MAIN"</span> /&gt;<font></font>
                &lt;category android:name=<span class="hljs-string">"android.intent.category.LAUNCHER"</span> /&gt;<font></font>
            &lt;/intent-filter&gt;<font></font>
        &lt;/activity&gt;<font></font>
    &lt;/application&gt;<font></font>
&lt;/manifest&gt;<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we push the smartphone into the VR headset and walk around the house, enjoying the cyborg's vision with a resolution of 1280 x 1024 for each eye. </font><font style="vertical-align: inherit;">The sensations are, of course, strange, with a loss of depth of vision, but still cool. </font><font style="vertical-align: inherit;">The only thing is that it looks a bit dark, but this is because the front translucent headset panel interferes. </font><font style="vertical-align: inherit;">Therefore, it is necessary to make a hole in it in front of the smartphone’s camera. </font><font style="vertical-align: inherit;">But again, on the most budgetary VR models, such a panel may not even exist at all, and it is likely that you will not have to defile yourself with manual labor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All that is left now is to convince the Google camera API that we have complete darkness, and it would be nice to use the Night Vision mode, and with it all these RAW, HDR-stacking and </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scene recognition by neural networks</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To do this, just write in the session:</font></font><br>
<br>
<pre><code class="java hljs">mPreviewBuilder.set(CaptureRequest.CONTROL_SCENE_MODE,<font></font>
                                            CaptureRequest.CONTROL_SCENE_MODE_NIGHT);<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
and unscrew the exposure and photosensitivity to the maximum</font></font><br>
<br>
<pre><code class="java hljs"> mPreviewBuilder.set(CaptureRequest.CONTROL_AE_MODE,<font></font>
        CaptureRequest.CONTROL_AE_MODE_OFF);<font></font>
mPreviewBuilder.set(CaptureRequest.SENSOR_EXPOSURE_TIME,Long.valueOf(<span class="hljs-string">"100000000"</span>));<font></font>
 mPreviewBuilder.set(CaptureRequest.SENSOR_SENSITIVITY, <span class="hljs-number">30000</span>);
</code></pre><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oh, I'm blind! </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/ua/o1/ys/uao1ysbhaojz55mqjwuevrqwu1c.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is what the cat turns out to see when he is thrown out of the bedroom, where he prevents people from having sex in the living room. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But of course, this is enumeration and parameters (and there are a lot of them in the API, and here are just a couple) you need to tweak it later by experience. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we can only wait for the night. </font><font style="vertical-align: inherit;">Not moonless, of course, with dense cloud cover somewhere in the taiga, but an ordinary such night with random flying photons. </font><font style="vertical-align: inherit;">And here’s what’s going to happen ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Although it would seem that with normal shooting, almost nothing is visible.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/dBDfXKoMe5Q" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But modern cameras work wonders and still find a black cat ...</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/WVkyLheyA8s" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now you can walk at night, because during the day you can not because of quarantine. </font><font style="vertical-align: inherit;">In theory, it’s also impossible at night, but who will see you, stalking in the darkness of night with VR headsets on their heads ...</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en493904/index.html">How to lose confidence in AI, or how I bullied with Gradient Photo Editor</a></li>
<li><a href="../en493906/index.html">Toxic Windows shortcuts: an old artifact not forgotten by hackers, but partially forgotten by forensics</a></li>
<li><a href="../en493914/index.html">Web2Text: deep structured extraction of web page content</a></li>
<li><a href="../en493918/index.html">How the pandemic affected VPN providers</a></li>
<li><a href="../en493920/index.html">About one vulnerability in ...</a></li>
<li><a href="../en493924/index.html">Stop the conveyor! You give Epson XGA projectors at the price of SVGA</a></li>
<li><a href="../en493926/index.html">Tricks to Test Laravel Web Applications Using Model Factories</a></li>
<li><a href="../en493928/index.html">Review and testing Huawei Dorado 5000V6</a></li>
<li><a href="../en493932/index.html">Overview of Google Surveys. Why it is not suitable for serious research</a></li>
<li><a href="../en493934/index.html">Who, how and on what explored the world's oceans - we analyze the NOAA bases</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>