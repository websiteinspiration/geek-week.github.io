<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🗿 🛥️ 🌬️ 暗号化をハッキングして保護するLUKS ⛵️ 👨🏼‍🤝‍👨🏻 🧜🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ディスク暗号化は、コンピュータ上のデータを不正な物理アクセスから保護するように設計されています。ディスク暗号化がこのタスクに本当に対処するという一般的な誤解、およびこれがそれほどエキゾチックで非現実的ではないように見えるシナリオがあります。この記事では、暗号化されたLUKSボリュームのマスターキーを...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>暗号化をハッキングして保護するLUKS</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457542/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/uh/iv/cn/uhivcnz6kt37qsazxa18qmvw5am.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ディスク暗号化は、コンピュータ上のデータを不正な物理アクセスから保護するように設計されています。</font><font style="vertical-align: inherit;">ディスク暗号化がこのタスクに本当に対処するという一般的な誤解、およびこれがそれほどエキゾチックで非現実的ではないように見えるシナリオがあります。</font><font style="vertical-align: inherit;">この記事では、暗号化された</font></font><abbr title="Linux Unified Key Setup、実際には標準のLinuxディスク暗号化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LUKS</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボリュームのマスターキーを抽出すること</font><font style="vertical-align: inherit;">は実際に</font><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">容易に実現できる</font><font style="vertical-align: inherit;">ことを示して</font><font style="vertical-align: inherit;">おり、（昔から新しい）保護方法が提案されています。</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題の本質</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、ディスク暗号化の目的についても検討する必要があります。実際、物理的なアクセスが不可能で、実行中のシステムがデータを所有している場合、問題はありません。システム自体のセキュリティに問題があるかもしれませんが、ディスクの暗号化はここでは役に立ちません。たとえば、ディスクをシステムに物理的に接続したり、検査対象のコンピューターにOSをロードしたりするなど、好奇心の強い当事者がシステムを経由せずにディスクにアクセスする機会がある場合、ディスク暗号化はデータを保護する必要があります。</font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物理アクセスシナリオは、ディスク暗号化が意味をなす唯一のシナリオです。</font></font></u><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
問題は、攻撃者がOSのブートチェーンに静かに介入し、システムが次に起動したときに暗号化キーを受け取ったらすぐに強制的に暗号化キーを発行することです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような攻撃では、コンピュータへのアクセス操作が1つだけ必要です。ディスクからのデータは、ブート回路の代替と一緒にコピーされ、キーが表示されるまで暗号化されます。</font><font style="vertical-align: inherit;">暗号化されていないディスクと比較すると、唯一の不便な点は、キーの送信方法に注意し、キーが開始するのを待つ必要があることです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、そのような手法を実際に示すことに移ります。</font><font style="vertical-align: inherit;">その実装のために、攻撃者はシステム所有者がディスクのロック解除（たとえばリモートで）のエキゾチックな方法のいくつかをセットアップするのに費やしたよりも少ない労力で済みます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実用的なデモ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システムのインストール中にディスク暗号化が有効にされたDebian 9を使用した仮想マシンの例でデモを行います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
暗号化してDebian 9をインストールすると、ブートパーティションと暗号化されたLVMのパーティションが作成されます。</font><font style="vertical-align: inherit;">明確にするために復号化パスワードを要求するインストール済みシステムのスクリーンショット：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/m5/j-/rx/m5j-rx32dzl9uwbvq9x28_8e8da.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべて準備ができているので、続行できます。</font><font style="vertical-align: inherit;">車の電源を切り、ディスクをコピーします。</font><font style="vertical-align: inherit;">私の場合、それは次のようになります：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ルート@ dt1〜]＃virshはdebian9-boothackを破壊します </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
debian9-boothackドメインが破壊された</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[ルート@ dt1〜]＃cp -v /var/lib/libvirt/images/debian9-boothack.qcow2〜</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
'/var/lib/libvirt/images/debian9-boothack.qcow2'-&gt; '/root/debian9-boothack.qcow2'</font></font><font></font>
</pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マシンのドライブをマウントし、initramdriveを抽出します。</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ルート@ dt1〜]＃mkdir /ゲスト</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[ルート@ dt1〜]＃guestmount -a /var/lib/libvirt/images/debian9-boothack.qcow2 -m / dev / sda1 / guest</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[ルート@ dt1〜]＃cp -v /guest/initrd.img-4.9.0-9-amd64〜ユーザー/ tmp</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
'/guest/initrd.img-4.9.0-9-amd64'-&gt; '/home/user/tmp/initrd.img-4.9.0-9-amd64'</font></font><font></font>
</pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
initramdriveを解凍します。</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[user @ dt1 tmp] $ mkdir unpacked</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[user @ dt1 tmp] $ cd unpacked /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[ユーザー@ dt1解凍] $ zcat ../initrd.img-4.9.0-9-amd64 | </font><font style="vertical-align: inherit;">cpio -idm</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[ユーザー@ dt1解凍] $ ls</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bin conf etc init lib lib64 sbinスクリプトを実行</font></font><font></font>
</pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
完了したら、initramdriveを編集できます。</font><font style="vertical-align: inherit;">マシンに永続的なネットワーク接続があることを知っているので、ディスクを開いた後、マスターキーの暗号化された送信を整理します。</font><font style="vertical-align: inherit;">これを行うには、次のものが必要です。</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワークを介した暗号化送信用ユーティリティ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">に追加</font></font><code>/sbin</code></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キーの抽出および送信用のシェルスクリプト</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">に送信</font></font><code>/scripts/local-top</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">され、リスト</font></font><code>/scripts/local-top/ORDER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">追加されまし</font><font style="vertical-align: inherit;">た</font></font><code>cryptoroot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">    udhcpc</a>,       ,   .     <code>/etc/udhcpc/default.script</code></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
secsend実行可能ファイルは、ライブラリへの依存を排除​​するために静的にコンパイルされます。通常の状態では、アセンブリは2.7 MBのサイズの出力ファイルを生成します。これは、ramdriveのサイズ（解凍された形式で62メガバイト、圧縮された形式で20メガバイト）と比べて非常に顕著です。ただし、すべてのライブラリと最小限のmusl libcを使用して実行可能ファイルをビルドする場合、出力ファイルのサイズは約250 KBで、UPX圧縮後は120 KBです。 Secsend自体は単純に標準入力を読み取り、指定された公開キーCurve25519を使用してlibsodiumの暗号ボックスで暗号化し、TCP経由で指定されたアドレスにデータを送信します。デモンストレーションの主な目的での使用は原則にとらわれず、攻撃者が本質的に無制限であることを示しています。攻撃者が望んでいること、および攻撃者が望んでいることを実行するコードを実行できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これら3つのファイルを追加して別のファイルを編集した後、すべてを元に戻し、変更したファイルを元の場所に戻すことができます。</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ユーザー@ dt1解凍] $検索。</font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">cpio -o -c | </font><font style="vertical-align: inherit;">gzip -9&gt; ../initrd.img-4.9.0-9-amd64</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
125736ブロック</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[user @ dt1 unpacked] $ sudo cp -v ../initrd.img-4.9.0-9-amd64 / guest</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
'../initrd.img-4.9.0-9-amd64'-&gt; '/guest/initrd.img-4.9.0-9-amd64'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[user @ dt1 unpacked] $ sudo guestunmount / guest</font></font><font></font>
</pre><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Python 3.5.3+）</font><font style="vertical-align: inherit;">
などの暗号化されたマスターキーを受信するには、サーバーが必要</font><font style="vertical-align: inherit;">です。キーペアの秘密の部分を使用して実行すると、条件付きの被害者がコンピューター</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wh/xw/9w/whxw9wbsdwttyxc1r-updulgwvi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
をオンにする</font><font style="vertical-align: inherit;">まで待機します。</font><font style="vertical-align: inherit;">暗号化されたディスクを使用して仮想マシンをオンにすると、通常どおりすべてが正常に見え、何も変更されていません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xv/uj/wa/xvujwaegiz6gfxzgjq5bjeoy81g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、接続リスナー側では、秘密のマスターキーが表示されました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/58/ah/3_/58ah3_xgbux8-46m1dbwsy5ovg0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この時点から、データを含む仮想マシンと、暗号化パスワードを知っているそのユーザーは、攻撃者にとってもはや興味の対象ではありません。</font><font style="vertical-align: inherit;">パスフレーズを変更しても、ボリューム全体を暗号化するマスターキーは変更されないことを強調します。</font><font style="vertical-align: inherit;">コピーを作成してからキーを送信するまでの間にパスフレーズの変更が何らかの形で関与していても、これは障害にはなりません。</font><font style="vertical-align: inherit;">マスターキーを使用してボリュームを開きます。</font><font style="vertical-align: inherit;">これを行うには、16進数のログエントリをバイナリファイルに変換します。</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[root @ dt1〜]＃echo 'fa0c53 *********** 4bd8c' | </font><font style="vertical-align: inherit;">xxd -r -p&gt; master.key
</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コピーでディスクをマウントします。</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ルート@ dt1〜]＃modprobe nbd max_part = 8</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[ルート@ dt1〜]＃qemu-nbd --connect = / dev / nbd0 /root/debian9-boothack.qcow2 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[ルート@ dt1〜]＃ls / dev / nbd0 *</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
/ dev / nbd0 / dev / nbd0p1 / dev / nbd0p2 / dev / nbd0p5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[ルート@ dt1〜]＃ファイル-s / dev / nbd0p5</font></font><font></font>
/dev/nbd0p5: LUKS encrypted file, ver 1 [aes, xts-plain64, sha256] UUID: fb732477-ef98-40b5-86a2-8526c349f031<font></font>
[root@dt1 ~]# cryptsetup --master-key-file=master.key luksOpen /dev/nbd0p5 crackeddisk<font></font>
[root@dt1 ~]# pvs<font></font>
  PV                      VG                  Fmt  Attr PSize    PFree<font></font>
  /dev/mapper/crackeddisk debian9-boothack-vg lvm2 a--    19,75g    0 <font></font>
  /dev/sda3               dt1                 lvm2 a--  &lt;215,01g 8,00m<font></font>
[root@dt1 ~]# lvs<font></font>
  LV     VG                  Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert<font></font>
  root   debian9-boothack-vg -wi-a-----  18,75g                                                    <font></font>
  swap_1 debian9-boothack-vg -wi-a-----   1,00g                                                    <font></font>
  root   dt1                 -wi-ao---- 215,00g                                                    <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[ルート@ dt1〜]＃mkdir / hackedroot</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[root @ dt1〜]＃mount / dev / mapper / debian9-boothack-vg-root / hackedroot /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[ルート@ dt1〜]＃ls / hackedroot /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bin boot dev etc home initrd.img initrd.img.old lib lib64 lost + found media mnt opt proc root run sbin srv sys tmp usr var vmlinuz vmlinuz.old</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[root @ dt1〜]＃cat / hackedroot / etc /ホスト名 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
debian9-boothack</font></font><font></font>
</pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データが取得されます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保護対策</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結論として、問題の根本は信頼できないコードの起動にあります。</font><font style="vertical-align: inherit;">この問題のコンテキストで検討する必要のあるテクニックの概要を以下に示します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブートパーティションの暗号化</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一部のディストリビューションでは、インストール時にこの機能も提供されます（たとえば、OpenSuSE）。</font><font style="vertical-align: inherit;">この場合、ブートパーティションはブートローダーによって復号化され、カーネルとinitramdriveがそこからロードされます。</font><font style="vertical-align: inherit;">このアプローチは、次の理由であまり意味がありません。</font></font><br>
<br>
<ul>
<li>         .      .</li>
<li>      ,   .   LUKS    .       ,         .</li>
<li>  LUKS2    (dm-integrity)     ,        ,     . ,         ,         ,  .          (          -  ),         .</li>
</ul><br>
<h3> TPM         </h3><br>
<abbr title="トラステッドプラットフォームモジュール"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TPM</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は本質的に、システム内の安全なエンクレーブまたはスマートカードとして機能する暗号化プロセッサです。それを使用して暗号化された秘密データは、それを使用してその条件でのみ復号化できます- </font><font style="vertical-align: inherit;">システムの</font></font><abbr title="プラットフォーム構成レジスタ"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCR</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値が収束</font><font style="vertical-align: inherit;">したとき、プラットフォームの状態とその中で実行されるコードに依存します。このテクノロジーは非常に有望であり、キーを必要とせずにシステムに安全な暗号化を実装することができます（たとえば、暗号化に関連しない指紋または認証方法で入力することにより）。理想的には、UEFIセキュアブートと連携して動作し、構成が収束しない場合は復号化を禁止する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、Linuxでは、TPMサポートはまだ初期段階です。</font><font style="vertical-align: inherit;">TrustedGRUB2ブートローダー（TPMで動作するように構成されたブートローダー）はUEFIをサポートしていないため、アイデアの全体像が消えてしまいます。</font><font style="vertical-align: inherit;">さらに、動作中のTPM 2.0の存在がハードウェアに表示され始めており、BIOSの更新も頻繁に行われています。</font><font style="vertical-align: inherit;">ほとんどのマザーボードにはディスクリートTPMモジュールがありませんが、TPMはIntel </font></font><abbr title="管理エンジン"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ME</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内に実装されたソフトウェア</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">これらすべての理由から、私はそのような構成が機能していて広範囲に使用するのに適しているとはまだ考えていません。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UEFIセキュアブートを使用して、ブートチェーンを電子署名で完全にカバーする</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linuxでセキュアブートを使用できるようにするディストリビューション（Fedora、OpenSuSE）と単一のソリューションがあります。ただし、ボックス化されたソリューションは、多くの場合、ロードチェーンでコードの整合性を提供しません。これらは主に、セキュアブートが有効な場合にLinuxが簡単に起動するように設計されています。通常は、Microsoft証明書で署名されたEFIシムを使用するだけで、何でも起動します。したがって、外部認証を使用する場合、インストールされたシステムで直接生成されるディスク内ドライブの署名をカバーすることは不可能です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ハブには、</font><font style="vertical-align: inherit;">コードの署名に</font><font style="vertical-align: inherit;">独自の</font></font><abbr title="公開鍵インフラストラクチャ"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PKI</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">使用することを提案する記事があり</font><font style="vertical-align: inherit;">ます。これにより、必要なすべてのものを自分で署名できるため、UEFIチェーン全体→ブートローダー→カーネルお​​よびイントラドライブをカバーできます。</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UEFI SecureBootを使いこなす</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -このトピックに関するハブの最初の記事、非常に詳細。</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linuxではセキュアブートを最大限に使用しています。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここでは、Microsoft証明書がインストールされたセキュアブートが存在しないことと同等である理由が特によく書かれています。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必要な結果は2番目の記事で得られます。</font><font style="vertical-align: inherit;">ローダーを使用せずにラムドライブとカーネルを1つのEFIアプリケーションにマージすることで、mdrive内の署名が達成され、UEFIは署名を直接一括で直接チェックします。</font><font style="vertical-align: inherit;">どちらのマニュアルも、保護された各システムで多くの手動作業が必要です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手頃なソリューション</font></font></h2><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セキュアブートの完全な実装へのアプローチ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を思いつきました。これは</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">、一般に受け入れられているブートスキーム</font></a><font style="vertical-align: inherit;">と</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">互換性があり</font></a><font style="vertical-align: inherit;">、システムへの深刻な介入を必要としません。個別のブートローダー、個別のRAMドライブ、個別のカーネルです。 UEFIはGRUB2ブートローダーの署名のみを検証します。ブートローダーには、署名と管理者パスワードを検証するためのキーを備えた有線構成があり、カーネルとRAMドライブをチェックします。署名済みのブートローダーは古いものと並行してインストールされ、必要に応じて、セキュアブートを無効にすることで通常の方法で起動することができます。もちろん、この機能はUEFI設定メニューの管理者パスワードで閉じる必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は自分のPKIを使用してセキュアブート展開プロセスを自動化し、それを可能な限りシンプルでディストリビューションに依存しないようにすることを決定しました。</font><font style="vertical-align: inherit;">結果は、Makefileレシピとユーティリティからのこのセット</font><font style="vertical-align: inherit;">です</font><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">//github.com/Snawoot/linux-secureboot-kit</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">debian、ubuntu、fedora、centosの場合、プロセス全体で必要なコマンドはわずかです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
具体的には、Debian 9の例を使用すると、インストールは次のようになります（UEFIがすでにセットアップモードであると想定）。</font></font><br>
<br>
<pre><code class="bash hljs">apt update &amp;&amp; apt install -y unzip make sbsigntool<font></font>
wget https://gist.github.com/Snawoot/1937d5bc76d7b0a29f2039aa679c0449/raw/74a63c99be07ec93cfc1df47d2e98e54920c97b7/efitools-1.9.2-static.tar.xz &amp;&amp; \<font></font>
tar xpJf efitools-1.9.2-static.tar.xz -C /<font></font>
wget https://github.com/Snawoot/linux-secureboot-kit/archive/master.zip<font></font>
unzip master.zip<font></font>
<span class="hljs-built_in">cd</span> linux-secureboot-kit-master/<font></font>
make debian9-install<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、すべてのコマンドはスーパーユーザーに代わって入力されます。</font><font style="vertical-align: inherit;">その結果、BIOSメニューでセキュアブートが有効になっていることを確認し、管理者パスワードでBIOS設定を保護するだけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、これはそのようなインストールでramdriveを置き換える試みです：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0x/e5/gy/0xe5gyuh68ohcjwwjr4mfd2ijuc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブートローダーの変更（外観はプラットフォームによって異なります）：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pg/mb/_u/pgmb_uuuwo-acrteotkjoasaepm.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">合計</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ディスクの暗号化だけでは、データのプライバシーを確​​保するには不十分です。</font><font style="vertical-align: inherit;">UEFIセキュアブートとGPGを使用してブートチェーン全体に署名すると、コンピューターオペレーターがシステムボードのリセットやスプーフィング、さらにはコンピューター全体を認識できる場合に、実行可能コードのスプーフィングに対する優れたレベルの保護を実現できます。</font><font style="vertical-align: inherit;">そうしないと、ユーザーがパスワードを入力する準備ができている場合や、誤ってテーブルやサーバールームに置かれてしまうマシンにキーを転送する場合に、適切な保護方法を提供することは非常に困難です。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja457524/index.html">深度カメラ-サイレント革命（ロボットが見るとき）パート1</a></li>
<li><a href="../ja457526/index.html">バザーとしてのテクニカルメディア</a></li>
<li><a href="../ja457534/index.html">認定バージョン-私たちが選択したレーキ</a></li>
<li><a href="../ja457538/index.html">中断されたYandex.Cloud仮想マシンを使用して、大規模な問題を解決する方法</a></li>
<li><a href="../ja457540/index.html">Intel Optane DC Persistent Memory、1年後</a></li>
<li><a href="../ja457546/index.html">デモ日：なぜこれがすべてであり、それを行う方法UPD + Broadcast</a></li>
<li><a href="../ja457548/index.html">TMS320F28027での多相PWM信号の生成</a></li>
<li><a href="../ja457550/index.html">デジタル業界を保護する必要があるもの</a></li>
<li><a href="../ja457552/index.html">ザファサディのクライマー。ラフタセンタータワーのプロマルプの仕組み</a></li>
<li><a href="../ja457558/index.html">EvilParcelの脆弱性分析</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>