<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👶🏼 🤱🏽 🛕 Beginnend mit Kerndaten! In einfachen Worten schwierig [Teil 2] 👩🏻‍🏭 👨🏿‍🍳 👩🏼‍💻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Artikel möchte ich die Funktionen von Core Data näher erläutern. Dieser Artikel ist eine Fortsetzung . Ich hoffe wirklich, dass ich auf die ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Beginnend mit Kerndaten! In einfachen Worten schwierig [Teil 2]</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495602/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In diesem Artikel möchte ich die Funktionen von Core Data näher erläutern. </font><font style="vertical-align: inherit;">Dieser Artikel ist eine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fortsetzung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ich hoffe wirklich, dass ich auf die Idee kommen kann, dass Core Data keine der vielen relationalen Datenbanken ist, sondern ein sehr leistungsfähiges Werkzeug, das zu einer integralen Waffe im Arsenal eines jeden sich selbst respektierenden IOS-Entwicklers werden kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, fangen wir an!</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heute schauen wir uns die Arbeit mit zwei NSManageObjectContext und NSFetchedResultsController an. </font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zwei NSManageObjectContext und warum wird das benötigt?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Ihre Anwendung aktiv eine API verwendet, über die sie Daten empfängt, und Sie diese Daten irgendwo speichern möchten, ist Core Data eine ausgezeichnete Wahl. Welche Probleme könnten Sie damit haben? Das erste und offensichtlichste: Die Datenmenge ist so groß, dass unsere Anwendung beim Versuch, sie zu speichern, für einige Zeit einfriert, was sich auf die Benutzererfahrung auswirkt. Auf eine normale GCD kann nicht verzichtet werden, da sie unabhängig ist. Unser </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erwähnter Core Data Stack </font><font style="vertical-align: inherit;">funktioniert synchron und für jeden Zugriff auf unseren NSManageObjectContext müssen wir bis zum Ende der Schleife warten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber hier kommt der private NSManageObjectContext, der im Hintergrund-Thread funktioniert, zur Rettung. Um es aufzurufen, müssen Sie sich zuerst an unseren NSPersistentContainer wenden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Initialisierung sieht folgendermaßen aus:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-built_in">lazy</span> <span class="hljs-keyword">var</span> persistentContainer: <span class="hljs-type">NSPersistentContainer</span> = {
    <span class="hljs-keyword">let</span> container = <span class="hljs-type">NSPersistentContainer</span>(name: <span class="hljs-string">"Preset"</span>)<font></font>
    container.loadPersistentStores { (persistent, error) <span class="hljs-keyword">in</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> error = error {
            <span class="hljs-built_in">fatalError</span>(<span class="hljs-string">"Error: "</span> + error.localizedDescription)<font></font>
        }<font></font>
    }<font></font>
    container.viewContext.mergePolicy = <span class="hljs-type">NSMergeByPropertyStoreTrumpMergePolicy</span>
    container.viewContext.shouldDeleteInaccessibleFaults = <span class="hljs-literal">true</span>
    container.viewContext.automaticallyMergesChangesFromParent = <span class="hljs-literal">true</span>
    <span class="hljs-keyword">return</span> container<font></font>
}()<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mergepolicy</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier geben Sie die Zusammenführungsrichtlinie unseres NSManageObjectContext an. </font><font style="vertical-align: inherit;">Hier geben wir explizit an, wie sich Core Data im Falle eines Datenkonflikts verhalten soll. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MergePolicy-Optionen:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSRollbackMergePolicy - Im Falle eines Konflikts werden alle Änderungen verworfen, bis sie auftreten </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSOverwriteMergePolicy - Speichert neue Werte unabhängig von Daten </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSMergeByPropertyStoreTrumpMergePolicy - Speichert geänderte Objekte Eigenschaft für Eigenschaft. In diesem Fall haben gespeicherte Daten Vorrang</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSMergeByPropertyObjectTrumpMergePolicy - Speichert geänderte Objekte Eigenschaft für Eigenschaft. In diesem Fall haben neue Daten Vorrang </font></font></li>
</ol><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutomaticallyMergesChangesFromParent</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Gibt an, ob unser Kontext Daten automatisch zusammenführt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen Sie dann einen neuen Kontext:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">let</span> context = persistentContainer.viewContext
<span class="hljs-keyword">let</span> context = persistentContainer.newBackgroundContext()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt haben wir zwei NSManageObjectContext. </font><font style="vertical-align: inherit;">Der erste dient zum Arbeiten mit der Benutzeroberfläche und wird auf dem Hauptthread ausgeführt, und der zweite verfügt über privateQueueConcurrencyType zum Arbeiten im Hintergrund. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden es verwenden, um Daten herunterzuladen.</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">let</span> object = <span class="hljs-type">NSEntityDescription</span>.insertNewObject(forEntityName: <span class="hljs-string">"Name"</span>, into: context)<font></font>
saveChanges(with: context)<font></font>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier erstellen wir unsere Entität und können ihr dann die erforderlichen Eigenschaften zuweisen. Danach rufen wir die Speichermethode auf. Sie sieht folgendermaßen aus: </font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">saveChanges</span><span class="hljs-params">(with context: NSManagedObjectContext)</span></span> {<font></font>
        context.performAndWait {<font></font>
            <span class="hljs-keyword">if</span> context.hasChanges {
                <span class="hljs-keyword">do</span> {
                    <span class="hljs-keyword">try</span> context.save()<font></font>
                } <span class="hljs-keyword">catch</span> {<font></font>
                    context.rollback()<font></font>
                }<font></font>
            }<font></font>
            context.reset()<font></font>
        }<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es stehen 2 Methoden zur Auswahl:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performAndWait - führt Aktionen für den Kontext-Thread synchron aus</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perform - Führt asynchron Aktionen für den Kontextstrom aus</font></font></li>
</ul><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSFetchedResultsController</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NSFetchedResultsController - Ein Controller, der bestimmte Anforderungen ausführt und dem Benutzer die erforderlichen Daten anzeigt.</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-built_in">lazy</span> <span class="hljs-keyword">var</span> fetchedResultsController: <span class="hljs-type">NSFetchedResultsController</span>&lt;<span class="hljs-type">Pack</span>&gt; = {
        <span class="hljs-keyword">let</span> fetchRequest = <span class="hljs-type">NSFetchRequest</span>&lt;<span class="hljs-type">Pack</span>&gt;(entityName:<span class="hljs-string">"Pack"</span>)<font></font>
        fetchRequest.fetchBatchSize = <span class="hljs-number">20</span>
        fetchRequest.sortDescriptors = [<span class="hljs-type">NSSortDescriptor</span>(key: <span class="hljs-string">"name"</span>, ascending:<span class="hljs-literal">true</span>)]
        <span class="hljs-keyword">let</span> controller = <span class="hljs-type">NSFetchedResultsController</span>(fetchRequest: fetchRequest, managedObjectContext: context, sectionNameKeyPath: <span class="hljs-literal">nil</span>, cacheName: <span class="hljs-literal">nil</span>)<font></font>
<font></font>
        controller.delegate = <span class="hljs-keyword">self</span>
        <span class="hljs-keyword">do</span> {
            <span class="hljs-keyword">try</span> controller.performFetch()<font></font>
        } <span class="hljs-keyword">catch</span> {
            <span class="hljs-built_in">print</span>(error.localizedDescription)<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> controller<font></font>
    }()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NSFetchedResultsController hat eine sehr große Anzahl von Konfigurationen, wir werden einige davon analysieren:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fetchlimit</font></font></b><div class="spoiler_text">FetchLimit —      <br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sketchoffset</font></font></b><div class="spoiler_text">FetchOffset —  .    2,       .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FetchbatchSize</font></font></b><div class="spoiler_text">FetchBatchSize —        .      Table/CollectionView        5 ,        7   ,          .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FetchbatchSize</font></font></b><div class="spoiler_text">FetchBatchSize —                .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SortDescriptor</font></font></b><div class="spoiler_text">SortDescriptor —       ,       .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReturnsObjectsAsFaults</font></font></b><div class="spoiler_text">ReturnsObjectsAsFaults — ,      ,      ,      PersistentStore         RawCache<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Moment haben wir einen NSFetchedResultsController, der unsere Daten in einer Tabelle anzeigen soll. </font><font style="vertical-align: inherit;">Um die Daten zu aktualisieren, müssen Sie die Delegate-Methode aufrufen:</font></font><br>
 <br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ViewController</span>: <span class="hljs-title">NSFetchedResultsControllerDelegate</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">controller</span><span class="hljs-params">(<span class="hljs-number">_</span> controller: NSFetchedResultsController&lt;NSFetchRequestResult&gt;, didChange anObject: <span class="hljs-keyword">Any</span>, at indexPath: IndexPath?, <span class="hljs-keyword">for</span> type: NSFetchedResultsChangeType, newIndexPath: IndexPath?)</span></span> {<font></font>
       collectionView.reloadData()<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Delegate-Methode funktioniert, wenn sich in unserem Kontext Änderungen ergeben. </font><font style="vertical-align: inherit;">In dieser Implementierung geschieht dies, nachdem wir die Daten in einem privaten Kontext gespeichert haben. </font><font style="vertical-align: inherit;">In diesem Moment wird die Delegatmethode ausgelöst und die Daten werden aktualisiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nur ein paar Aktionen und Kerndaten aus einer regulären Datenbank werden zu einer mächtigen Waffe eines jeden iOS-Entwicklers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Viel Spaß beim Codieren!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de495580/index.html">Gurke JVM - nicht nur BDD</a></li>
<li><a href="../de495588/index.html">Roguelike in Unity von Grund auf neu erstellen: Dungeon-Generator</a></li>
<li><a href="../de495592/index.html">Verwendung von Wörterbüchern (und nicht nur)</a></li>
<li><a href="../de495594/index.html">Verdienen Sie Geld mit Software: Erstellen Sie ein Mini-Digital-Geschäft</a></li>
<li><a href="../de495596/index.html">Fernarbeit im Büro. RDP, Port Knocking, Mikrotik: einfach und sicher</a></li>
<li><a href="../de495604/index.html">Temporäre Lokalisierung auf Symfony 4 + Twig</a></li>
<li><a href="../de495606/index.html">"Soziale Überwachung." Ergebnis 1: 0 zu unseren Gunsten</a></li>
<li><a href="../de495608/index.html">[Infografik] Visualisierung von Pandemien in der Geschichte der Menschheit</a></li>
<li><a href="../de495610/index.html">Warum die Zukunft nicht für Python ist</a></li>
<li><a href="../de495612/index.html">Wird Airbnb das Coronavirus überleben? [Spoiler: ja]</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>