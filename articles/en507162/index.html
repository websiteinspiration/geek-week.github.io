<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëêüèΩ üëÉüèª üë† Game Code Command & Conquer: bugs from the 90s. Volume One üè® üëèüèø üîä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The American company Electronic Arts Inc (EA) has posted the open source code for the games Command & Conquer: Tiberian Dawn and Command & Conquer: Re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Game Code Command & Conquer: bugs from the 90s. Volume One</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/507162/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/45c/686/581/45c686581b6cddb3473e6f0f7912deec.png" alt="image1.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The American company Electronic Arts Inc (EA) has posted the open source code for the games Command &amp; Conquer: Tiberian Dawn and Command &amp; Conquer: Red Alert. </font><font style="vertical-align: inherit;">This code should help gaming communities develop mods and maps, create custom units, and customize gameplay logic. </font><font style="vertical-align: inherit;">We all have a unique opportunity to plunge into the history of development, which is very different from the modern one. </font><font style="vertical-align: inherit;">Then there was no StackOverflow site, convenient code editors and powerful compilers. </font><font style="vertical-align: inherit;">And then there were no static analyzers, and the first thing the community will encounter is hundreds of errors in the code. </font><font style="vertical-align: inherit;">But the PVS-Studio team will help with this, pointing out the places of these errors.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introduction</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Command &amp; Conquer - a series of computer games in the genre of real-time strategy. </font><font style="vertical-align: inherit;">The first game in the series was released in 1995. </font><font style="vertical-align: inherit;">Electronic Arts acquired the development studio for this game only in 1998. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since then, several games and many mods have been released. </font><font style="vertical-align: inherit;">The source code for the games was </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">published</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with the release of the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Command &amp; Conquer Remastered</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> collection </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To find errors in the code, the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> analyzer was used </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">This is a tool for detecting errors and potential vulnerabilities in the source code of programs written in C, C ++, C # and Java. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Due to the large volume of problems found in the code, all examples of errors will be given in a cycle of two articles.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Typos and copy-paste</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V501 There are identical sub-expressions to the left and to the right of the '||' </font><font style="vertical-align: inherit;">operator: dest == 0 || </font><font style="vertical-align: inherit;">dest == 0 CONQUER.CPP 5576</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">List_Copy</span><span class="hljs-params">(<span class="hljs-keyword">short</span> <span class="hljs-keyword">const</span> * source, <span class="hljs-keyword">int</span> len, <span class="hljs-keyword">short</span> * dest)</span>
</span>{
  <span class="hljs-keyword">if</span> (dest == <span class="hljs-literal">NULL</span> || dest == <span class="hljs-literal">NULL</span>) {
    <span class="hljs-keyword">return</span>;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I want to start the review with the eternal copy-paste. </font><font style="vertical-align: inherit;">In the function for copying lists, they never checked the source pointer and checked the destination pointer 2 times, because they copied the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dest == NULL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> check </font><font style="vertical-align: inherit;">and forgot to replace the variable name. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V584 The 'Current' value is present on both sides of the '! =' Operator. </font><font style="vertical-align: inherit;">The expression is incorrect or it can be simplified. </font><font style="vertical-align: inherit;">CREDITS.CPP 173</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">CreditClass::AI</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> forced, HouseClass *player_ptr, <span class="hljs-keyword">bool</span> logic_only)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">long</span> adder = Credits - Current;<font></font>
  adder = ABS(adder);<font></font>
  adder &gt;&gt;= <span class="hljs-number">5</span>;<font></font>
  adder = Bound(adder, <span class="hljs-number">1L</span>, <span class="hljs-number">71</span>+<span class="hljs-number">72</span>);
  <span class="hljs-keyword">if</span> (Current &gt; Credits) adder = -adder;<font></font>
  Current += adder;<font></font>
  Countdown = <span class="hljs-number">1</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (Current-adder != Current) {        <span class="hljs-comment">// &lt;=</span>
    IsAudible = <span class="hljs-literal">true</span>;<font></font>
    IsUp = (adder &gt; <span class="hljs-number">0</span>);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The analyzer found a meaningless comparison. </font><font style="vertical-align: inherit;">I suppose there should have been something like:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">if</span> (Current-adder != Credits)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
but inattention won. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exactly the same code fragment is copied to another function:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V584 The 'Current' value is present on both sides of the '! =' Operator. </font><font style="vertical-align: inherit;">The expression is incorrect or it can be simplified. </font><font style="vertical-align: inherit;">CREDITS.CPP 246</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V524 It is odd that the body of 'Mono_Y' function is fully equivalent to the body of 'Mono_X' function. </font><font style="vertical-align: inherit;">MONOC.CPP 753</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MonoClass</span> {</span><font></font>
  ....<font></font>
  <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Get_X</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> <span class="hljs-keyword">const</span> </span>{<span class="hljs-keyword">return</span> X;};
  <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Get_Y</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> <span class="hljs-keyword">const</span> </span>{<span class="hljs-keyword">return</span> Y;};<font></font>
  ....<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Mono_X</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{
  <span class="hljs-keyword">if</span> (MonoClass::Is_Enabled()) {<font></font>
    MonoClass *mono = MonoClass::Get_Current();<font></font>
    <span class="hljs-keyword">if</span> (!mono) {<font></font>
      mono = <span class="hljs-keyword">new</span> MonoClass();<font></font>
      mono-&gt;View();<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span>(<span class="hljs-keyword">short</span>)mono-&gt;Get_X();                  <span class="hljs-comment">// &lt;=</span><font></font>
  }<font></font>
  <span class="hljs-keyword">return</span>(<span class="hljs-number">0</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Mono_Y</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{
  <span class="hljs-keyword">if</span> (MonoClass::Is_Enabled()) {<font></font>
    MonoClass *mono = MonoClass::Get_Current();<font></font>
    <span class="hljs-keyword">if</span> (!mono) {<font></font>
      mono = <span class="hljs-keyword">new</span> MonoClass();<font></font>
      mono-&gt;View();<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span>(<span class="hljs-keyword">short</span>)mono-&gt;Get_X();                  <span class="hljs-comment">// &lt;= Get_Y() ?</span><font></font>
  }<font></font>
  <span class="hljs-keyword">return</span>(<span class="hljs-number">0</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A more voluminous piece of code that was copied with the consequences. </font><font style="vertical-align: inherit;">Agree, except with the analyzer, then you will not notice that the function </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mono_Y</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> called function </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get_X</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , instead </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get_Y</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MonoClass</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> class </font><font style="vertical-align: inherit;">really has 2 functions that differ by one character. </font><font style="vertical-align: inherit;">Most likely, we found a real mistake. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And below the file there was an identical code fragment:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V524 It is odd that the body of 'Mono_Y' function is fully equivalent to the body of 'Mono_X' function. </font><font style="vertical-align: inherit;">MONOC.CPP 1083</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Errors with arrays</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V557 Array overrun is possible. </font><font style="vertical-align: inherit;">The '9' index is pointing beyond array bound. </font><font style="vertical-align: inherit;">FOOT.CPP 232</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span>  CONQUER_PATH_MAX 9 <span class="hljs-comment">// Number of cells to look ahead for movement.</span></span><font></font>
<font></font>
FacingType Path[CONQUER_PATH_MAX];<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">FootClass::Debug_Dump</span><span class="hljs-params">(MonoClass *mono)</span> <span class="hljs-keyword">const</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (What_Am_I() != RTTI_AIRCRAFT) {<font></font>
    mono-&gt;Set_Cursor(<span class="hljs-number">50</span>, <span class="hljs-number">3</span>);<font></font>
    mono-&gt;Printf(<span class="hljs-string">"%s%s%s%s%s%s%s%s%s%s%s%s"</span>,<font></font>
      Path_To_String(Path[<span class="hljs-number">0</span>]),<font></font>
      Path_To_String(Path[<span class="hljs-number">1</span>]),<font></font>
      Path_To_String(Path[<span class="hljs-number">2</span>]),<font></font>
      Path_To_String(Path[<span class="hljs-number">3</span>]),<font></font>
      Path_To_String(Path[<span class="hljs-number">4</span>]),<font></font>
      Path_To_String(Path[<span class="hljs-number">5</span>]),<font></font>
      Path_To_String(Path[<span class="hljs-number">6</span>]),<font></font>
      Path_To_String(Path[<span class="hljs-number">7</span>]),<font></font>
      Path_To_String(Path[<span class="hljs-number">8</span>]),<font></font>
      Path_To_String(Path[<span class="hljs-number">9</span>]),<font></font>
      Path_To_String(Path[<span class="hljs-number">10</span>]),<font></font>
      Path_To_String(Path[<span class="hljs-number">11</span>]),<font></font>
      Path_To_String(Path[<span class="hljs-number">12</span>]));<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This seems to be a debugging method, but how much harm he could do to the psyche of the developer, the story is silent. </font><font style="vertical-align: inherit;">Here, the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Path</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> array </font><font style="vertical-align: inherit;">consists of </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> elements, and all </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are printed </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Total 4 memory accesses abroad array:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V557 Array overrun is possible. </font><font style="vertical-align: inherit;">The '9' index is pointing beyond array bound. </font><font style="vertical-align: inherit;">FOOT.CPP 232</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V557 Array overrun is possible. </font><font style="vertical-align: inherit;">The '10' index is pointing beyond array bound. </font><font style="vertical-align: inherit;">FOOT.CPP 233</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V557 Array overrun is possible. </font><font style="vertical-align: inherit;">The '11' index is pointing beyond array bound. </font><font style="vertical-align: inherit;">FOOT.CPP 234</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V557 Array overrun is possible. </font><font style="vertical-align: inherit;">The '12' index is pointing beyond array bound. </font><font style="vertical-align: inherit;">FOOT.CPP 235</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V557 Array underrun is possible. </font><font style="vertical-align: inherit;">The value of '_SpillTable [index]' index could reach -1. </font><font style="vertical-align: inherit;">COORD.CPP 149</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">enum</span> FacingType : <span class="hljs-keyword">char</span> {<font></font>
  ....<font></font>
  FACING_COUNT,  <span class="hljs-comment">// 8</span>
  FACING_FIRST=<span class="hljs-number">0</span><font></font>
} FacingType;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">short</span> <span class="hljs-keyword">const</span> * <span class="hljs-title">Coord_Spillage_List</span><span class="hljs-params">(COORDINATE coord, <span class="hljs-keyword">int</span> maxsize)</span>
</span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">short</span> <span class="hljs-keyword">const</span> _MoveSpillage[(<span class="hljs-keyword">int</span>)FACING_COUNT+<span class="hljs-number">1</span>][<span class="hljs-number">5</span>] = {<font></font>
    ....<font></font>
  };<font></font>
<font></font>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">char</span> <span class="hljs-keyword">const</span> _SpillTable[<span class="hljs-number">16</span>] = {<span class="hljs-number">8</span>,<span class="hljs-number">6</span>,<span class="hljs-number">2</span>,<span class="hljs-number">-1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">7</span>,<span class="hljs-number">1</span>,<span class="hljs-number">-1</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">3</span>,<span class="hljs-number">-1</span>,<span class="hljs-number">-1</span>,<span class="hljs-number">-1</span>,<span class="hljs-number">-1</span>,<span class="hljs-number">-1</span>};<font></font>
<font></font>
  ....<font></font>
  <span class="hljs-keyword">return</span>(&amp;_MoveSpillage[_SpillTable[index]][<span class="hljs-number">0</span>]);<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At first glance, the example is complex, but it is easy to figure it out after a little analysis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The two-dimensional </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_MoveSpillage</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> array </font><i><font style="vertical-align: inherit;">is</font></i><font style="vertical-align: inherit;"> accessed by the index taken from the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_SpillTable</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> array </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">And it suddenly contains negative values. </font><font style="vertical-align: inherit;">Perhaps access to data is organized according to a special formula, and this is what the developer intended. </font><font style="vertical-align: inherit;">But I'm not so sure about that. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V512 A call of the 'sprintf' function will lead to overflow of the buffer '(char *) ptr'. </font><font style="vertical-align: inherit;">SOUNDDLG.CPP 250</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SoundControlsClass::Process</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">void</span> * ptr = <span class="hljs-keyword">new</span> <span class="hljs-keyword">char</span> [<span class="hljs-keyword">sizeof</span>(<span class="hljs-number">100</span>)];                                <span class="hljs-comment">// &lt;=</span><font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ptr) {
    <span class="hljs-built_in">sprintf</span>((<span class="hljs-keyword">char</span> *)ptr, <span class="hljs-string">"%cTrack %d\t%d:%02d\t%s"</span>,                   <span class="hljs-comment">// &lt;=</span>
      index, listbox.Count()+<span class="hljs-number">1</span>, length / <span class="hljs-number">60</span>, length % <span class="hljs-number">60</span>, fullname);<font></font>
    listbox.Add_Item((<span class="hljs-keyword">char</span> <span class="hljs-keyword">const</span> *)ptr);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An attentive reader will wonder why such a long line is stored in a buffer of 4 bytes? </font><font style="vertical-align: inherit;">But because the programmer thought that </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sizeof (100)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> would return something more (at least </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">But the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sizeof</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> operator </font><font style="vertical-align: inherit;">returns the size of the type and never even counts any expressions. </font><font style="vertical-align: inherit;">You just had to write the constant </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and even better, use named constants, or another type for strings or pointer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V512 A call of the 'memset' function will lead to underflow of the buffer 'Buffer'. </font><font style="vertical-align: inherit;">KEYBOARD.CPP 96</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">short</span> Buffer[<span class="hljs-number">256</span>];<font></font>
<font></font>
WWKeyboardClass::WWKeyboardClass(<span class="hljs-keyword">void</span>)<font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-built_in">memset</span>(Buffer, <span class="hljs-number">0</span>, <span class="hljs-number">256</span>);<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Some buffer is cleared for 256 bytes, although the full size of the original buffer is </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">256 * sizeof (unsigned short)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mistake </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can still fix this:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-built_in">memset</span>(Buffer, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(Buffer));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V557 Array overrun is possible. The 'QuantityB' function processes value '[0..86]'. Inspect the first argument. Check lines: 'HOUSE.H: 928', 'CELL.CPP: 2337'. HOUSE.H 928</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">enum</span> StructType : <span class="hljs-keyword">char</span> {<font></font>
  STRUCT_NONE=<span class="hljs-number">-1</span>,<font></font>
  ....<font></font>
  STRUCT_COUNT,                                       <span class="hljs-comment">// &lt;= 87</span>
  STRUCT_FIRST=<span class="hljs-number">0</span><font></font>
} StructType;<font></font>
<font></font>
<span class="hljs-keyword">int</span> BQuantity[STRUCT_COUNT<span class="hljs-number">-3</span>];                        <span class="hljs-comment">// &lt;= [0..83]</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">QuantityB</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span>{<span class="hljs-keyword">return</span>(BQuantity[index]);}  <span class="hljs-comment">// &lt;= [0..86]</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">CellClass::Goodie_Check</span><span class="hljs-params">(FootClass * object)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">int</span> bcount = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span>( j=<span class="hljs-number">0</span>; j &lt; STRUCT_COUNT; j++) {<font></font>
    bcount += hptr-&gt;QuantityB(j);                     <span class="hljs-comment">// &lt;= [0..86]</span><font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are a lot of global variables in the code and it is obvious that they are easily confused. The analyzer warning about leaving the array boundary is issued at the place of accessing the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BQuantity</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> array </font><font style="vertical-align: inherit;">by index. The size of the array is 84 elements. The data flow analysis algorithms in the analyzer helped to establish that the index value comes from another function - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Goodie_Check</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . There a loop is executed with a final value of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">86</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Therefore, in this place, 12 bytes of ‚Äúalien‚Äù memory are constantly read (3 elements of type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V575 The 'memset' function processes '0' elements. Inspect the third argument. DLLInterface.cpp 1103</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span>* __cdecl <span class="hljs-title">memset</span><span class="hljs-params">(
  _Out_writes_bytes_all_(_Size) <span class="hljs-keyword">void</span>*  _Dst,
  _In_                          <span class="hljs-keyword">int</span>    _Val,
  _In_                          <span class="hljs-keyword">size_t</span> _Size
)</span></span>;<font></font>
<font></font>
<span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> __declspec(dllexport) <span class="hljs-function"><span class="hljs-keyword">bool</span> __cdecl <span class="hljs-title">CNC_Read_INI</span><span class="hljs-params">(....)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-built_in">memset</span>(ini_buffer, _ini_buffer_size, <span class="hljs-number">0</span>);<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In my opinion, I have repeatedly seen this error in modern projects. </font><font style="vertical-align: inherit;">Programmers are still confusing the 2nd and 3rd arguments to the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memset</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another such place:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V575 The 'memset' function processes '0' elements. </font><font style="vertical-align: inherit;">Inspect the third argument. </font><font style="vertical-align: inherit;">DLLInterface.cpp 1404</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">About null pointers</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V522 Dereferencing of the null pointer 'list' might take place. </font><font style="vertical-align: inherit;">DISPLAY.CPP 1062</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">DisplayClass::Get_Occupy_Dimensions</span><span class="hljs-params">(<span class="hljs-keyword">int</span> &amp; w, <span class="hljs-keyword">int</span> &amp; h, <span class="hljs-keyword">short</span> <span class="hljs-keyword">const</span> *<span class="hljs-built_in">list</span>)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">list</span>) {
    <span class="hljs-comment">/*
    ** Loop through all cell offsets, accumulating max &amp; min x- &amp; y-coords
    */</span>
    <span class="hljs-keyword">while</span> (*<span class="hljs-built_in">list</span> != REFRESH_EOL) {<font></font>
      ....<font></font>
    }<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The explicit reference to the null pointer looks very strange. </font><font style="vertical-align: inherit;">This place looks like a typo and there are some more places worth checking:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V522 Dereferencing of the null pointer 'list' might take place. </font><font style="vertical-align: inherit;">DISPLAY.CPP 951</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V522 Dereferencing of the null pointer 'unitsptr' might take place. </font><font style="vertical-align: inherit;">QUEUE.CPP 2362</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V522 Dereferencing of the null pointer 'unitsptr' might take place. </font><font style="vertical-align: inherit;">QUEUE.CPP 2699</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V595 The 'enemy' pointer was utilized before it was verified against nullptr. </font><font style="vertical-align: inherit;">Check lines: 3689, 3695. TECHNO.CPP 3689</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">TechnoClass::Base_Is_Attacked</span><span class="hljs-params">(TechnoClass <span class="hljs-keyword">const</span> *enemy)</span>
</span>{<font></font>
  FootClass *defender[<span class="hljs-number">6</span>];
  <span class="hljs-keyword">int</span> value[<span class="hljs-number">6</span>];
  <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">int</span> weakest = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">int</span> desired = enemy-&gt;Risk() * <span class="hljs-number">2</span>;
  <span class="hljs-keyword">int</span> risktotal = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-comment">/*
  ** Humans have to deal with their own base is attacked problems.
  */</span>
  <span class="hljs-keyword">if</span> (!enemy || House-&gt;Is_Ally(enemy) || House-&gt;IsHuman) {
    <span class="hljs-keyword">return</span>;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enemy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pointer is </font><font style="vertical-align: inherit;">dereferenced, and then checked that it is non-zero. </font><font style="vertical-align: inherit;">There is still an urgent problem, I‚Äôm not afraid of the word, of every open source project. </font><font style="vertical-align: inherit;">I am sure that in closed-source projects, the situation is about the same, unless, of course, PVS-Studio is used ;-)</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wrong Castes</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V551 The code under this 'case' label is unreachable. </font><font style="vertical-align: inherit;">The '4109' value of the 'char' type is not in the range [-128; </font><font style="vertical-align: inherit;">127]. </font><font style="vertical-align: inherit;">WINDOWS.CPP 547</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> VK_RETURN 0x0D</span><font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">enum</span> {<font></font>
  ....<font></font>
  WWKEY_VK_BIT = <span class="hljs-number">0x1000</span>,<font></font>
  ....<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">enum</span> {<font></font>
  ....<font></font>
  KA_RETURN = VK_RETURN | WWKEY_VK_BIT,<font></font>
  ....<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">void</span> Window_Print(<span class="hljs-keyword">char</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span>[], ...)<font></font>
{<font></font>
  <span class="hljs-keyword">char</span> c; <span class="hljs-comment">// Current character.</span><font></font>
  ....<font></font>
  <span class="hljs-keyword">switch</span>(c) {<font></font>
    ....<font></font>
    <span class="hljs-keyword">case</span> KA_FORMFEED: <span class="hljs-comment">// &lt;= 12</span><font></font>
        New_Window();<font></font>
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> KA_RETURN:   <span class="hljs-comment">// &lt;= 4109</span><font></font>
      Flush_Line();<font></font>
      ScrollCounter++;<font></font>
      WinCx = <span class="hljs-number">0</span>;<font></font>
      WinCy++;<font></font>
      <span class="hljs-keyword">break</span>;<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This function processes input characters. </font><font style="vertical-align: inherit;">As you know, a </font><font style="vertical-align: inherit;">1-byte value is placed </font><font style="vertical-align: inherit;">in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> type </font><font style="vertical-align: inherit;">, and the number </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4109</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will never be there. </font><font style="vertical-align: inherit;">So, this </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">switch statement</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> simply contains an unreachable code branch. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There were several such places:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V551 The code under this 'case' label is unreachable. </font><font style="vertical-align: inherit;">The '4105' value of the 'char' type is not in the range [-128; </font><font style="vertical-align: inherit;">127]. </font><font style="vertical-align: inherit;">WINDOWS.CPP 584</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V551 The code under this 'case' label is unreachable. </font><font style="vertical-align: inherit;">The '4123' value of the 'char' type is not in the range [-128; </font><font style="vertical-align: inherit;">127]. </font><font style="vertical-align: inherit;">WINDOWS.CPP 628</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V552 A bool type variable is being incremented: printedtext ++. </font><font style="vertical-align: inherit;">Perhaps another variable should be incremented instead. </font><font style="vertical-align: inherit;">ENDING.CPP 170</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Nod_Ending</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">bool</span> printedtext = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">while</span> (!done) {
    <span class="hljs-keyword">if</span> (!printedtext &amp;&amp; !Is_Sample_Playing(kanefinl)) {<font></font>
      printedtext++;<font></font>
      Alloc_Object(....);<font></font>
      mouseshown = <span class="hljs-literal">true</span>;<font></font>
      Show_Mouse();<font></font>
    }<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this code snippet, the analyzer found the application of the increment operation to a variable of type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bool</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">This is the correct code in terms of language, but it looks very strange now. </font><font style="vertical-align: inherit;">Also, such an operation is marked as deprecated, starting with the C ++ 17 standard. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Only 2 such places were identified:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V552 A bool type variable is being incremented: done ++. </font><font style="vertical-align: inherit;">Perhaps another variable should be incremented instead. </font><font style="vertical-align: inherit;">ENDING.CPP 187</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V556 The values ‚Äã‚Äãof different enum types are compared. </font><font style="vertical-align: inherit;">Types: ImpactType, ResultType. </font><font style="vertical-align: inherit;">AIRCRAFT.CPP 742</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">ImpactType <span class="hljs-title">FlyClass::Physics</span><span class="hljs-params">(COORDINATE &amp; coord, DirType facing)</span></span>;<font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">enum</span> ImpactType : <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> {             <span class="hljs-comment">// &lt;=</span><font></font>
  IMPACT_NONE,<font></font>
  IMPACT_NORMAL,<font></font>
  IMPACT_EDGE<font></font>
} ImpactType;<font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">enum</span> ResultType : <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> {             <span class="hljs-comment">// &lt;=</span><font></font>
  RESULT_NONE,<font></font>
  ....<font></font>
} ResultType;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">AircraftClass::AI</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (Physics(Coord, PrimaryFacing) != RESULT_NONE) { <span class="hljs-comment">// &lt;=</span><font></font>
    Mark();<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The programmer tied some logic to comparing the values ‚Äã‚Äãof different enumerations. </font><font style="vertical-align: inherit;">Technically, this works because </font><font style="vertical-align: inherit;">numerical representations are compared. </font><font style="vertical-align: inherit;">But such code often leads to logical errors. </font><font style="vertical-align: inherit;">It‚Äôs worth correcting the code (if this project is still supported, of course). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The entire list of warnings for this diagnostic looks like this:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V556 The values ‚Äã‚Äãof different enum types are compared: SoundEffectName [voc] .Where == IN_JUV. </font><font style="vertical-align: inherit;">DLLInterface.cpp 402</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V556 The values ‚Äã‚Äãof different enum types are compared: SoundEffectName [voc] .Where == IN_VAR. </font><font style="vertical-align: inherit;">DLLInterface.cpp 405</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V556 The values ‚Äã‚Äãof different enum types are compared: Map.Theater == CNC_THEATER_DESERT. </font><font style="vertical-align: inherit;">Types: TheaterType, CnCTheaterType. </font><font style="vertical-align: inherit;">DLLInterface.cpp 2805</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V556 The values ‚Äã‚Äãof different enum types are compared. </font><font style="vertical-align: inherit;">Types: ImpactType, ResultType. </font><font style="vertical-align: inherit;">AIRCRAFT.CPP 4269</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V556 The values ‚Äã‚Äãof different enum types are compared: SoundEffectName [voc] .Where == IN_VAR. </font><font style="vertical-align: inherit;">DLLInterface.cpp 429</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V716 Suspicious type conversion in assign expression: 'HRESULT = BOOL'. </font><font style="vertical-align: inherit;">GBUFFER.H 780</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">BOOL __cdecl <span class="hljs-title">Linear_Blit_To_Linear</span><span class="hljs-params">(...)</span></span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">inline</span> HRESULT <span class="hljs-title">GraphicViewPortClass::Blit</span><span class="hljs-params">(....)</span>
</span>{<font></font>
  HRESULT return_code=<span class="hljs-number">0</span>;<font></font>
  ....<font></font>
  return_code=(Linear_Blit_To_Linear(<span class="hljs-keyword">this</span>, &amp;dest, x_pixel, y_pixel<font></font>
                      , dx_pixel, dy_pixel<font></font>
                      , pixel_width, pixel_height, trans));<font></font>
  ....<font></font>
<font></font>
  <span class="hljs-keyword">return</span> ( return_code );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also a very old problem, relevant today. </font><font style="vertical-align: inherit;">There are special macros for working with the HRESULT type, and casts to BOOL and vice versa are not used. </font><font style="vertical-align: inherit;">These two types of data are extremely similar to each other in terms of language, but are logically incompatible. </font><font style="vertical-align: inherit;">The operation of implicit type conversion existing in the code is meaningless. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This and a few more places would be worth refactoring:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V716 Suspicious type conversion in assign expression: 'HRESULT = BOOL'. </font><font style="vertical-align: inherit;">GBUFFER.H 817</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V716 Suspicious type conversion in assign expression: 'HRESULT = BOOL'. </font><font style="vertical-align: inherit;">GBUFFER.H 857</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V716 Suspicious type conversion in assign expression: 'HRESULT = BOOL'. </font><font style="vertical-align: inherit;">GBUFFER.H 773</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V716 Suspicious type conversion in assign expression: 'HRESULT = BOOL'. </font><font style="vertical-align: inherit;">GBUFFER.H 810</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V716 Suspicious type conversion in assign expression: 'HRESULT = BOOL'. </font><font style="vertical-align: inherit;">GBUFFER.H 850</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V610 Undefined behavior. </font><font style="vertical-align: inherit;">Check the shift operator '&lt;&lt;'. </font><font style="vertical-align: inherit;">The left operand '(~ 0)' is negative. </font><font style="vertical-align: inherit;">MP.CPP 2410</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">XMP_Randomize</span><span class="hljs-params">(digit * result, Straw &amp; rng, <span class="hljs-keyword">int</span> total_bits, <span class="hljs-keyword">int</span> precision)</span>
</span>{<font></font>
  ....<font></font>
  ((<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> *)result)[nbytes<span class="hljs-number">-1</span>] &amp;=<font></font>
    (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>)(~((~<span class="hljs-number">0</span>) &lt;&lt; (total_bits % <span class="hljs-number">8</span>)));<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here a negative number shifts to the left, which is an undefined behavior. A negative number is obtained from zero when applying the inversion operator. Because the result of the operation is placed in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> type </font><font style="vertical-align: inherit;">, the compiler uses it to store the value, and it is signed. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In 2020, the compiler also found such an error: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warning C26453: Arithmetic overflow: Left shift of a negative signed number is undefined behavior.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
But compilers are not full-fledged static analyzers, as solve other problems. Therefore, here is another example of undefined behavior that is detected only using PVS-Studio:</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V610 Undefined behavior. </font><font style="vertical-align: inherit;">Check the shift operator '&lt;&lt;'. </font><font style="vertical-align: inherit;">The right operand ('(32 - bits_to_shift)' = [1..32]) is greater than or equal to the length in bits of the promoted left operand. </font><font style="vertical-align: inherit;">MP.CPP 659</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> UNITSIZE 32</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">XMP_Shift_Right_Bits</span><span class="hljs-params">(digit * number, <span class="hljs-keyword">int</span> bits, <span class="hljs-keyword">int</span> precision)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">int</span> digits_to_shift = bits / UNITSIZE;
  <span class="hljs-keyword">int</span> bits_to_shift = bits % UNITSIZE;<font></font>
<font></font>
  <span class="hljs-keyword">int</span> index;
  <span class="hljs-keyword">for</span> (index = digits_to_shift; index &lt; (precision<span class="hljs-number">-1</span>); index++) {<font></font>
    *number = (*(number + digits_to_shift) &gt;&gt; bits_to_shift) |<font></font>
      (*(number + (digits_to_shift + <span class="hljs-number">1</span>)) &lt;&lt; (UNITSIZE - bits_to_shift));<font></font>
    number++;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The analyzer detected a situation where a 32-bit number shift to the right by a larger number of bits is potentially possible. </font><font style="vertical-align: inherit;">Here's how it goes:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">int</span> bits_to_shift = bits % UNITSIZE;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNITSIZE constant</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> has a value of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">int</span> bits_to_shift = bits % <span class="hljs-number">32</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, the value of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bits_to_shift</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> variable </font><font style="vertical-align: inherit;">will be zero for all </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bits</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> values </font><font style="vertical-align: inherit;">that are multiples of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, in this piece of code:</font></font><br>
<br>
<pre><code class="cpp hljs">.... &lt;&lt; (UNITSIZE - bits_to_shift) ....</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
a 32-bit shift will occur if </font><i><font style="vertical-align: inherit;">0</font></i><font style="vertical-align: inherit;"> is subtracted </font><font style="vertical-align: inherit;">from the constant </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">
List of all warnings from PVS-Studio about shifts with undefined behavior:</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V610 Undefined behavior. </font><font style="vertical-align: inherit;">Check the shift operator '&lt;&lt;'. </font><font style="vertical-align: inherit;">The left operand '(~ 0)' is negative. </font><font style="vertical-align: inherit;">TARGET.H 66</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V610 Undefined behavior. </font><font style="vertical-align: inherit;">Check the shift operator '&lt;&lt;'. </font><font style="vertical-align: inherit;">The left operand '((((- 24) * 256) / 24)' is negative. </font><font style="vertical-align: inherit;">ANIM.CPP 160</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V610 Undefined behavior. </font><font style="vertical-align: inherit;">Check the shift operator '&lt;&lt;'. </font><font style="vertical-align: inherit;">The left operand '((((- 12) * 256) / 24)' is negative. </font><font style="vertical-align: inherit;">BUILDING.CPP 4037</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V610 Undefined behavior. </font><font style="vertical-align: inherit;">Check the shift operator '&lt;&lt;'. </font><font style="vertical-align: inherit;">The left operand '(((- - 21) * 256) / 24)' is negative. </font><font style="vertical-align: inherit;">DRIVE.CPP 2160</font></font></li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(((- 21) * 256) / 24)' is negative. DRIVE.CPP 2161</li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(((- 20) * 256) / 24)' is negative. DRIVE.CPP 2162</li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(((- 20) * 256) / 24)' is negative. DRIVE.CPP 2163</li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(((- 18) * 256) / 24)' is negative. DRIVE.CPP 2164</li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(((- 18) * 256) / 24)' is negative. DRIVE.CPP 2165</li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(((- 17) * 256) / 24)' is negative. DRIVE.CPP 2166</li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(((- 16) * 256) / 24)' is negative. DRIVE.CPP 2167</li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(((- 15) * 256) / 24)' is negative. DRIVE.CPP 2168</li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(((- 14) * 256) / 24)' is negative. DRIVE.CPP 2169</li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(((- 13) * 256) / 24)' is negative. DRIVE.CPP 2170</li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(((- 12) * 256) / 24)' is negative. DRIVE.CPP 2171</li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(((- 11) * 256) / 24)' is negative. DRIVE.CPP 2172</li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(((- 10) * 256) / 24)' is negative. DRIVE.CPP 2173</li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(((- 9) * 256) / 24)' is negative. DRIVE.CPP 2174</li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(((- 8) * 256) / 24)' is negative. DRIVE.CPP 2175</li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(((- 7) * 256) / 24)' is negative. DRIVE.CPP 2176</li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(((- 6) * 256) / 24)' is negative. DRIVE.CPP 2177</li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(((- 5) * 256) / 24)' is negative. DRIVE.CPP 2178</li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(((- 4) * 256) / 24)' is negative. DRIVE.CPP 2179</li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(((- 3) * 256) / 24)' is negative. DRIVE.CPP 2180</li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(((- 2) * 256) / 24)' is negative. DRIVE.CPP 2181</li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(((- 1) * 256) / 24)' is negative. DRIVE.CPP 2182</li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(((- 5) * 256) / 24)' is negative. INFANTRY.CPP 2730</li>
<li>V610 Undefined behavior. Check the shift operator '&gt;&gt;'. The right operand ('(32 ‚Äî bits_to_shift)' = [1..32]) is greater than or equal to the length in bits of the promoted left operand. MP.CPP 743</li>
<li>V610 Undefined behavior. Check the shift operator '&lt;&lt;'. The left operand '(~0)' is negative. RANDOM.CPP 102</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V610 Undefined behavior. </font><font style="vertical-align: inherit;">Check the shift operator '&lt;&lt;'. </font><font style="vertical-align: inherit;">The left operand '(~ 0L)' is negative. </font><font style="vertical-align: inherit;">RANDOM.CPP 164</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's hope that the contemporary Electronic Arts projects are of higher quality. </font><font style="vertical-align: inherit;">If not, then we invite you to </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">download</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and try PVS-Studio on all projects </font><font style="vertical-align: inherit;">on our website </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Someone may object that cool quality games were made with such quality before, and partly we can agree with that. </font><font style="vertical-align: inherit;">But do not forget that competition in the development of programs and games has grown many times over so many years. </font><font style="vertical-align: inherit;">The costs of development, support and advertising also increased. </font><font style="vertical-align: inherit;">Therefore, the correction of errors in the later stages of development entails significant financial and reputational losses. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Follow our blog to not miss the 2nd part of the review for this series of games.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eb2/f9c/3bb/eb2f9c3bb5f32f39239298d36431961c.png"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you want to share this article with an English-speaking audience, then please use the link to the translation: Svyatoslav Razmyslov. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Code of the Command &amp; Conquer Game: Bugs From the 90's. </font><font style="vertical-align: inherit;">Volume one</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en507148/index.html">Send magic links using Node.js</a></li>
<li><a href="../en507150/index.html">We draw an interference picture in JavaScript</a></li>
<li><a href="../en507156/index.html">Tetris on bitboards: old songs in a new way</a></li>
<li><a href="../en507158/index.html">Antiquities: Decade of Apple iPad</a></li>
<li><a href="../en507160/index.html">About the ‚Äúmost‚Äù ‚Äúrealistic‚Äù ‚Äúinterpretation‚Äù of quantum mechanics</a></li>
<li><a href="../en507166/index.html">Experience in using Rutoken technology for registering and authorizing users in the system (part 3)</a></li>
<li><a href="../en507170/index.html">Are fourteen people viewing this product for sure?</a></li>
<li><a href="../en507172/index.html">What they do at the faculty of low-temperature energy at ITMO University</a></li>
<li><a href="../en507174/index.html">Does the Armed Forces of Russia and other structures of the Ministry of Defense of the Russian Federation need a standard for describing algorithms?</a></li>
<li><a href="../en507176/index.html">MMS system in the data center: how we automated maintenance management</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>