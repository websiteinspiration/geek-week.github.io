<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👵🏽 🎃 🤴🏿 Project Loom: Java virtual threads sudah dekat 💚 🥛 👨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Beberapa hari yang lalu, Ron Pressler melahirkan sebuah artikel di State of Loom , yang hanya tidak bisa ditemukan oleh javist yang paling malas. Arti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Project Loom: Java virtual threads sudah dekat</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/503412/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beberapa hari yang lalu, Ron Pressler melahirkan sebuah artikel di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">State of Loom</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang hanya tidak bisa ditemukan oleh javist yang paling malas. </font><font style="vertical-align: inherit;">Artikel ini benar-benar bagus, ada banyak metafora menarik di dalamnya, yang akan saya gunakan sekarang dengan tidak hati-hati tanpa referensi ke sumbernya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk bagian saya, saya secara tidak sengaja mengizinkan saya untuk mengekspresikan beberapa skeptisisme, tetapi ketika dengan Proyek Loom ini akhirnya dapat benar-benar dikerjakan. </font><font style="vertical-align: inherit;">Secara harfiah satu jam kemudian, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">balasan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> datang </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">dari Ron sendiri - “dan kamu coba!” </font></a><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Yah, aku harus mencobanya.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang diperlukan untuk percobaan:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JDK15 termasuk Project Loom</font></font></a> </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terminal, karena IntelliJ dan Gradle dengan tegas menolak untuk bekerja dengan game tersebut</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mulai dengan, saya memutuskan untuk melihat seperti apa </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contoh klasik dengan aliran dari dokumentasi untuk Kotlin Coroutine</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan terlihat seperti </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Contohnya ditulis di Kotlin, tetapi menulis ulang di Jawa tidak sulit:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        <span class="hljs-keyword">var</span> c = <span class="hljs-keyword">new</span> AtomicLong();
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1_000_000</span>; i++) {
            <span class="hljs-keyword">new</span> Thread(() -&gt; {<font></font>
                c.incrementAndGet();<font></font>
            }).start();<font></font>
        }<font></font>
<font></font>
        System.out.println(c.get());<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami mulai dan memastikan bahwa contoh masih hang, seperti sebelumnya:</font></font><br>
<br>
<pre><code class="bash hljs">javac Main.java &amp;&amp; java Main
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang tulis ulang contoh menggunakan utas virtual yang disediakan Project Loom kepada kami:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1_000_000</span>; i++) {<font></font>
    Thread.startVirtualThread(() -&gt; {<font></font>
        c.incrementAndGet();<font></font>
    });<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasilnya tidak lama datang:</font></font><br>
<br>
<pre><code class="bash hljs">1000000
</code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Berapa lama?</font></font></b>
                        <div class="spoiler_text">     ,    . <br>
-,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">Gil Tene,   —    </a>. <br>
-,       Project Loom,     . ,     —  .<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi dalam dirinya sendiri itu tidak membuat saya terkesan terlalu banyak. </font><font style="vertical-align: inherit;">Pada akhirnya, dengan coroutine di Kotlin, hasil yang sama mudah dicapai. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ron dalam artikelnya dengan benar mengamati bahwa Kotlin harus memperkenalkan fungsi delay (), yang memungkinkan coroutine untuk “tertidur”, karena Thread.sleep () tidak mengirim coroutine saat ini untuk tidur, tetapi thread scheduler saat ini, yang tidak banyak, biasanya berdasarkan kuantitas CPU </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagaimana dengan Project Loom?</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1_000_000</span>; i++) {<font></font>
  Thread.startVirtualThread(() -&gt; {<font></font>
    c.incrementAndGet();<font></font>
    <span class="hljs-keyword">try</span> {<font></font>
        Thread.sleep(<span class="hljs-number">1_000</span>);<font></font>
    } <span class="hljs-keyword">catch</span> (InterruptedException e) {<font></font>
        e.printStackTrace();<font></font>
    }<font></font>
  });<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasil:</font></font><br>
<br>
<pre><code class="bash hljs">- 400K
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi ini sudah menarik! </font><font style="vertical-align: inherit;">Dengan Project Loom, panggilan ke Thread.sleep () dapat membedakan apakah itu dalam utas biasa atau dalam utas virtual, dan kerjanya berbeda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini sendiri sangat keren. </font><font style="vertical-align: inherit;">Tapi mari kita gali lebih dalam:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> threads = <span class="hljs-keyword">new</span> ArrayList&lt;Thread&gt;();
<span class="hljs-keyword">var</span> cores = <span class="hljs-number">10</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; cores; i++) {
    <span class="hljs-keyword">var</span> t = Thread.startVirtualThread(() -&gt; {
        <span class="hljs-keyword">var</span> bestUUID = <span class="hljs-string">""</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">1_000_000</span>; j++) {
            <span class="hljs-keyword">var</span> currentUUID = UUID.randomUUID().toString();
            <span class="hljs-keyword">if</span> (currentUUID.compareTo(bestUUID) &gt; <span class="hljs-number">0</span>) {<font></font>
                bestUUID = currentUUID;<font></font>
            }<font></font>
        }<font></font>
        System.out.println(<span class="hljs-string">"Best slow UUID is "</span> + bestUUID);<font></font>
    });<font></font>
    threads.add(t);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; cores; i++) {
    <span class="hljs-keyword">var</span> t = Thread.startVirtualThread(() -&gt; {
        <span class="hljs-keyword">var</span> bestUUID = UUID.randomUUID().toString();<font></font>
        System.out.println(<span class="hljs-string">"Best fast UUID is "</span> + bestUUID);<font></font>
    });<font></font>
    threads.add(t);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">for</span> (Thread t : threads) {<font></font>
    t.join();<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini kita menjalankan 10 tugas lambat dan 10 tugas cepat. Tugas cepat lebih cepat daripada yang lambat satu juta kali, jadi akan logis untuk menganggap bahwa mereka menyelesaikan lebih awal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi itu tidak ada di sana:</font></font><br>
<br>
<pre><code class="bash hljs">Best slow UUID is fffffde4-8c70-4ce6-97af-6a1779c206e1<font></font>
Best slow UUID is ffffe33b-f884-4206-8e00-75bd78f6d3bd<font></font>
Best slow UUID is fffffeb8-e972-4d2e-a1f8-6ff8aa640b70<font></font>
Best fast UUID is e13a226a-d335-4d4d-81f5-55ddde69e554<font></font>
Best fast UUID is ec99ed73-23b8-4ab7-b2ff-7942442a13a9<font></font>
Best fast UUID is c0cbc46d-4a50-433c-95e7-84876a338212<font></font>
Best fast UUID is c7672507-351f-4968-8cd2-2f74c754485c<font></font>
Best fast UUID is d5ae642c-51ce-4b47-95db-abb6965d21c2<font></font>
Best fast UUID is f2f942e3-f475-42b9-8f38-93d89f978578<font></font>
Best fast UUID is 469691ee-da9c-4886-b26e-dd009c8753b8<font></font>
Best fast UUID is 0ceb9554-a7e1-4e37-b477-064c1362c76e<font></font>
Best fast UUID is 1924119e-1b30-4be9-8093-d5302b0eec5f<font></font>
Best fast UUID is 94fe1afc-60aa-43ce-a294-f70f3011a424<font></font>
Best slow UUID is fffffc24-28c5-49ac-8e30-091f1f9b2caf<font></font>
Best slow UUID is fffff303-8ec1-4767-8643-44051b8276ca<font></font>
Best slow UUID is ffffefcb-614f-48e0-827d-5e7d4dea1467<font></font>
Best slow UUID is fffffed1-4348-456c-bc1d-b83e37d953df<font></font>
Best slow UUID is fffff6d6-6250-4dfd-8d8d-10425640cc5a<font></font>
Best slow UUID is ffffef57-c3c3-46f5-8ac0-6fad83f9d4d6<font></font>
Best slow UUID is fffff79f-63a6-4cfa-9381-ee8959a8323d<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intuisi hanya berfungsi selama jumlah tugas lambat kurang dari jumlah inti CPU Anda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alasannya sederhana - saat ini Project Loom menggunakan ForkJoinPool biasa. Akibatnya, terlepas dari kenyataan bahwa dokumentasi dan gagasan menunjukkan bahwa utas virtual "preemtive", saat ini mereka berperilaku "kooperatif". Seperti coroutine di Kotlin, sebenarnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perlu dicatat bahwa dalam artikel yang disebutkan di atas, Ron menyebutkan bahwa dia juga merefleksikan perilaku preemtion paksa, seperti pada utas normal. Tetapi sejauh ini ini belum dilaksanakan, karena tidak sepenuhnya jelas bagaimana perilaku seperti itu berguna ketika bisa ada puluhan ribu utas. Namun, dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Go 1.14, preemtion paksa diperkenalkan secara diam-diam</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Panggilan fungsi, tidak seperti Go, tidak menghasilkan saklar konteks. </font><font style="vertical-align: inherit;">Penangguhan, seperti di Kotlin, juga tidak dikirimkan. </font><font style="vertical-align: inherit;">Tetapi Anda dapat melakukannya dengan Thread.yield (), atau dengan memanggil fungsi Java IO apa saja: System.out.println (""), misalnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perhitungannya sederhana - sebagian besar program nyata menggunakan pemblokiran IO cukup sering. </font><font style="vertical-align: inherit;">Dan itu adalah penggunaan Project Loom yang berusaha untuk memecahkan di tempat pertama.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beberapa kesimpulan:</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya harus mengakui bahwa terlepas dari skeptisisme awal saya, Project Loom mengesankan saya secara positif. </font><font style="vertical-align: inherit;">Untuk pengguna Java biasa, ini menjanjikan multithreading ringan tanpa perlu beralih ke bahasa lain, menggunakan perpustakaan atau kerangka kerja. </font><font style="vertical-align: inherit;">Yang sudah terdengar bagus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi revolusi utama, seperti yang saya perkirakan, proyek ini akan dibuat di antara pengembang perpustakaan yang masih harus memecahkan masalah konkurensi lagi, dan lagi, dan lagi. </font><font style="vertical-align: inherit;">Sekarang, dengan distribusi JDK15, masalah ini dapat ditransfer ke JVM, karena mereka digunakan untuk mentransfer memori (GC) dan optimasi kode (JIT) ke JVM. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tautan ke artikel asli saya</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> jika Anda lebih suka membaca dalam bahasa Inggris.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id503402/index.html">Bagaimana cara mengingat semua orang secara langsung, atau pencarian wajah yang efektif dalam database besar</a></li>
<li><a href="../id503404/index.html">Sistem Digital Semantik</a></li>
<li><a href="../id503406/index.html">Semantik dan aktivitas</a></li>
<li><a href="../id503408/index.html">Toko Online Sisi Klien Blazor: Bagian 7 - Diperbarui untuk merilis versi 3.2.0 dan tampilan gambar yang ditambahkan</a></li>
<li><a href="../id503410/index.html">Poligon Dunia Lain: Sega Genesis</a></li>
<li><a href="../id503414/index.html">Retas Kotak. Walkthrough Rope. PWN. Memformat string dan ROP menggunakan pwntools</a></li>
<li><a href="../id503420/index.html">Lemmatize lebih cepat (PyMorphy2, PyMystem3 dan beberapa sihir)</a></li>
<li><a href="../id503426/index.html">44,2 Tb / s lebih dari serat - bagaimana cara kerjanya?</a></li>
<li><a href="../id503428/index.html">Cara Meningkatkan Bahasa Inggris Tertulis untuk Komunikasi di Luar Negeri: Proyek Bisnis Linguix</a></li>
<li><a href="../id503430/index.html">Gateway MS Desktop Jarak Jauh, menebak HAProxy dan kata sandi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>