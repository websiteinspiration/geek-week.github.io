<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üóæ üë©üèΩ‚Äçüé® üåê Recognition of the Russian alphabet: from collecting a dataset to creating a GUI üôçüèø ‚è™ üî∂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, Habr! In this article I would like to tell how I made a recognition of Russian letters and screwed a small graphical interface to this.
 

Spoi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Recognition of the Russian alphabet: from collecting a dataset to creating a GUI</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/505616/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello, Habr! </font><font style="vertical-align: inherit;">In this article I would like to tell how I made a recognition of Russian letters and screwed a small graphical interface to this.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spoiler: the result should be like this:</font></font></p><br>
<p><img src="https://habrastorage.org/webt/48/yi/o7/48yio7wezfllzycg_bwpu3s7rje.png" alt="image"></p><a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Download dataset</font></font></h2><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, let's begin! </font><font style="vertical-align: inherit;">The first thing we need is a dataset. </font><font style="vertical-align: inherit;">As a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dataset,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> I chose </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">CoMNIST</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Download the data set, unpack and delete the folder with the name I, since this letter is not included in the Russian alphabet.</font></font></p><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data processing</font></font></h2><br>
<p>   ,     .   ‚Äî -,        :</p><br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_background</span>():</span>
    image=<span class="hljs-string">' '</span>
    file_without_extension = image.split(<span class="hljs-string">'.'</span>)[<span class="hljs-number">0</span>]<font></font>
    image = cv2.imread(image, cv2.IMREAD_UNCHANGED)<font></font>
    trans_mask = image[:, :, <span class="hljs-number">3</span>] == <span class="hljs-number">0</span>
    image[trans_mask] = [<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>]<font></font>
    new_img = cv2.cvtColor(image, cv2.COLOR_BGRA2BGR)<font></font>
    cv2.imwrite(file_without_extension + <span class="hljs-string">'.jpeg'</span>, new_img)</code></pre><br>
<p>       ,   ,      ,   :<br>
<img src="https://habrastorage.org/webt/8s/d9/dv/8sd9dv7amigjsir1kriuqu0sm6c.png" alt="image"></p><br>
<p>C,    ,  ,      ( 350 ‚Äî 450   ). ,   ¬´¬ª  .       : ,        -  /  /  ,  ,      -  . </p><br>
<p><strong></strong></p><br>
<p><img src="https://habrastorage.org/webt/8e/bf/9b/8ebf9bpmzgngpbjbvrdnedr0zoo.png" alt="image"></p><br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shift</span>():</span>
            image = <span class="hljs-string">''</span><font></font>
            img = cv2.imread(image)<font></font>
            file_without_extension = image.split(<span class="hljs-string">'.'</span>)[<span class="hljs-number">0</span>]<font></font>
            arr_translation = [[<span class="hljs-number">15</span>, <span class="hljs-number">-15</span>], [<span class="hljs-number">-15</span>, <span class="hljs-number">15</span>], [<span class="hljs-number">-15</span>, <span class="hljs-number">-15</span>],<font></font>
                               [<span class="hljs-number">15</span>, <span class="hljs-number">15</span>]]<font></font>
            arr_caption=[<span class="hljs-string">'15-15'</span>,<span class="hljs-string">'-1515'</span>,<span class="hljs-string">'-15-15'</span>,<span class="hljs-string">'1515'</span>]
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">4</span>):<font></font>
                transform = AffineTransform(<font></font>
                    translation=tuple(arr_translation[i]))<font></font>
                warp_image = warp(img, transform, mode=<span class="hljs-string">"wrap"</span>)<font></font>
                img_convert = cv2.convertScaleAbs(warp_image,<font></font>
                                                  alpha=(<span class="hljs-number">255.0</span>))<font></font>
                cv2.imwrite(file_without_extension +<font></font>
                         arr_caption[i] + <span class="hljs-string">'.jpeg'</span>, img_convert)</code></pre><br>
<p><strong></strong></p><br>
<p><img src="https://habrastorage.org/webt/by/76/3j/by763j-6rkibrhxhawpwk0ehpmc.png" alt="image"></p><br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rotate</span>():</span>
    image = <span class="hljs-string">''</span><font></font>
    img = Image.open(image)<font></font>
    file_without_extension = image.split(<span class="hljs-string">'.'</span>)[<span class="hljs-number">0</span>]<font></font>
    angles = np.ndarray((<span class="hljs-number">2</span>,),<font></font>
        buffer=np.array([<span class="hljs-number">-13</span>, <span class="hljs-number">13</span>]), dtype=int)
    <span class="hljs-keyword">for</span> angle <span class="hljs-keyword">in</span> angles:<font></font>
        transformed_image = transform.rotate(np.array(img),<font></font>
        angle, cval=<span class="hljs-number">255</span>, preserve_range=<span class="hljs-literal">True</span>).astype(np.uint8)<font></font>
        cv2.imwrite(file_without_extension +<font></font>
                    str(angle) + <span class="hljs-string">'.jpeg'</span>, transformed_image)</code></pre><br>
<p><strong> </strong></p><br>
<p>   ,   ,    , ,      .</p><br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">balancing</span>():</span><font></font>
    arr_len_files = []<font></font>
    <span class="hljs-keyword">for</span> path <span class="hljs-keyword">in</span> root_path:<font></font>
        name_path = name_root_path+path+<span class="hljs-string">'/'</span><font></font>
        files=os.listdir(name_path)<font></font>
        arr_len_files.append(len(files))<font></font>
<font></font>
    min_value=min(arr_len_files)<font></font>
    <span class="hljs-keyword">for</span> path <span class="hljs-keyword">in</span> root_path:<font></font>
        folder = name_root_path+path<font></font>
        arr = []<font></font>
        <span class="hljs-keyword">for</span> the_file <span class="hljs-keyword">in</span> os.listdir(folder):<font></font>
            arr.append(folder + <span class="hljs-string">'/'</span> + the_file)<font></font>
        d = <span class="hljs-number">0</span><font></font>
        k = len(arr)<font></font>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> arr:<font></font>
            os.remove(i)<font></font>
            d += <span class="hljs-number">1</span>
            <span class="hljs-keyword">if</span> d == k - min_value:
                <span class="hljs-keyword">break</span></code></pre><br>
<p>  ,        .       ,       70%, 20%  10% .</p><br>
<h2>  </h2><br>
<p>     ‚Äî  .       CNN,       .     2-2,5      94%,   .      .</p><br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<font></font>
ImageDataGenerator = tf.keras.preprocessing.image.ImageDataGenerator<font></font>
TRAINING_DIR = <span class="hljs-string">"path/to/train/dataset"</span>
train_datagen = ImageDataGenerator(rescale=<span class="hljs-number">1.0</span> / <span class="hljs-number">255.</span>)<font></font>
train_generator = train_datagen.flow_from_directory(TRAINING_DIR,<font></font>
                              batch_size=<span class="hljs-number">40</span>,<font></font>
                              class_mode=<span class="hljs-string">'binary'</span>,<font></font>
                              target_size=(<span class="hljs-number">278</span>,<span class="hljs-number">278</span>))<font></font>
<font></font>
VALIDATION_DIR = <span class="hljs-string">"path/to/test/dataset"</span>
validation_datagen = ImageDataGenerator(rescale=<span class="hljs-number">1.0</span> / <span class="hljs-number">255.</span>)<font></font>
validation_generator = validation_datagen.flow_from_directory(VALIDATION_DIR,<font></font>
                                      batch_size=<span class="hljs-number">40</span>,<font></font>
                                      class_mode=<span class="hljs-string">'binary'</span>,<font></font>
                                      target_size=(<span class="hljs-number">278</span>,<span class="hljs-number">278</span>))<font></font>
<font></font>
model = tf.keras.models.Sequential([<font></font>
    tf.keras.layers.Conv2D(<span class="hljs-number">16</span>, (<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), activation=<span class="hljs-string">'relu'</span>, <font></font>
                           input_shape=(<span class="hljs-number">278</span>,<span class="hljs-number">278</span>, <span class="hljs-number">3</span>)),<font></font>
    tf.keras.layers.MaxPooling2D(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>),<font></font>
    tf.keras.layers.Conv2D(<span class="hljs-number">32</span>, (<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), activation=<span class="hljs-string">'relu'</span>),<font></font>
    tf.keras.layers.MaxPooling2D(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>),<font></font>
    tf.keras.layers.Conv2D(<span class="hljs-number">64</span>, (<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), activation=<span class="hljs-string">'relu'</span>),<font></font>
    tf.keras.layers.MaxPooling2D(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>),<font></font>
    tf.keras.layers.Flatten(),<font></font>
    tf.keras.layers.Dense(<span class="hljs-number">512</span>, activation=<span class="hljs-string">'relu'</span>),<font></font>
    tf.keras.layers.Dense(<span class="hljs-number">33</span>, activation=<span class="hljs-string">'softmax'</span>)<font></font>
])<font></font>
model.compile(optimizer=<span class="hljs-string">'adam'</span>, <font></font>
loss=<span class="hljs-string">'sparse_categorical_crossentropy'</span>, metrics=[<span class="hljs-string">'accuracy'</span>])<font></font>
model.summary()<font></font>
history = model.fit_generator(train_generator,<font></font>
                           epochs=<span class="hljs-number">2</span>,<font></font>
                           verbose=<span class="hljs-number">1</span>,<font></font>
                           validation_data=validation_generator)<font></font>
<font></font>
model.save(<span class="hljs-string">'model.h5'</span>)</code></pre><br>
<p>        ,  ,  ,       :</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">prediction.py</b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_letter</span>(<span class="hljs-params">result</span>):</span>
    <span class="hljs-keyword">if</span> result == <span class="hljs-number">1</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">2</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">3</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">4</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">5</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">6</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">7</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">8</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">9</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">10</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">11</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">12</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result ==<span class="hljs-number">13</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">14</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">15</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">16</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">17</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">18</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">19</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">20</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">21</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">22</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">23</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">24</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">25</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">26</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">27</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">28</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">29</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">30</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">31</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">elif</span> result == <span class="hljs-number">32</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
    <span class="hljs-keyword">else</span>:<font></font>
        print(<span class="hljs-string">'ERROR!'</span>)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">predicting</span>(<span class="hljs-params">path_to_image</span>):</span><font></font>
    image = keras.preprocessing.image<font></font>
    model = keras.models.load_model(<span class="hljs-string">'path/to/model'</span>)<font></font>
<font></font>
    img = image.load_img(path_to_image, target_size=(<span class="hljs-number">278</span>, <span class="hljs-number">278</span>))<font></font>
    x = image.img_to_array(img)<font></font>
    x = np.expand_dims(x, axis=<span class="hljs-number">0</span>)<font></font>
    images = np.vstack([x])<font></font>
    classes = model.predict(images, batch_size=<span class="hljs-number">1</span>)<font></font>
    result = int(np.argmax(classes))<font></font>
    result = print_letter(result)<font></font>
    print(result)</code></pre></div>
                    </div><br>
<h2> GUI</h2><br>
<p> ,           : ,      , ,     ,    ,    ,         .</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">app.py</b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> PyQt5.QtWidgets <span class="hljs-keyword">import</span> QMainWindow, QApplication, QMenu, QMenuBar, QAction, QFileDialog, QPushButton, QTextBrowser
<span class="hljs-keyword">from</span> PyQt5.QtGui <span class="hljs-keyword">import</span> QIcon, QImage, QPainter, QPen, QBrush
<span class="hljs-keyword">from</span> PyQt5.QtCore <span class="hljs-keyword">import</span> Qt, QPoint
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">from</span> PyQt5.QtWidgets <span class="hljs-keyword">import</span> QMainWindow, QTextEdit, QAction, QApplication
<span class="hljs-keyword">from</span> PyQt5.QtWidgets <span class="hljs-keyword">import</span> (QWidget, QLabel, QLineEdit, QTextEdit, QGridLayout, QApplication)
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">from</span> tensorflow <span class="hljs-keyword">import</span> keras<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Window</span>(<span class="hljs-params">QMainWindow</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><font></font>
        super().__init__()<font></font>
<font></font>
        title = <span class="hljs-string">"recognition cyrillic letter"</span>
        top = <span class="hljs-number">200</span>
        left = <span class="hljs-number">200</span>
        width = <span class="hljs-number">540</span>
        height = <span class="hljs-number">340</span><font></font>
<font></font>
        self.drawing = <span class="hljs-literal">False</span>
        self.brushSize = <span class="hljs-number">8</span><font></font>
        self.brushColor = Qt.black<font></font>
        self.lastPoint = QPoint()<font></font>
<font></font>
        self.image = QImage(<span class="hljs-number">278</span>, <span class="hljs-number">278</span>, QImage.Format_RGB32)<font></font>
        self.image.fill(Qt.white)<font></font>
<font></font>
        self.nameLabel = QLabel(self)<font></font>
        self.nameLabel.setText(<span class="hljs-string">'RES:'</span>)<font></font>
        self.line = QLineEdit(self)<font></font>
<font></font>
        self.line.move(<span class="hljs-number">360</span>, <span class="hljs-number">168</span>)<font></font>
        self.line.resize(<span class="hljs-number">80</span>, <span class="hljs-number">33</span>)<font></font>
        self.nameLabel.move(<span class="hljs-number">290</span>, <span class="hljs-number">170</span>)<font></font>
<font></font>
        prediction_button = QPushButton(<span class="hljs-string">'RECOGNITION'</span>, self)<font></font>
        prediction_button.move(<span class="hljs-number">290</span>, <span class="hljs-number">30</span>)<font></font>
        prediction_button.resize(<span class="hljs-number">230</span>, <span class="hljs-number">33</span>)<font></font>
        prediction_button.clicked.connect(self.save)<font></font>
        prediction_button.clicked.connect(self.predicting)<font></font>
<font></font>
        clean_button = QPushButton(<span class="hljs-string">'CLEAN'</span>, self)<font></font>
        clean_button.move(<span class="hljs-number">290</span>, <span class="hljs-number">100</span>)<font></font>
        clean_button.resize(<span class="hljs-number">230</span>, <span class="hljs-number">33</span>)<font></font>
        clean_button.clicked.connect(self.clear)<font></font>
<font></font>
        self.setWindowTitle(title)<font></font>
        self.setGeometry(top, left, width, height)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_letter</span>(<span class="hljs-params">self, result</span>):</span>
        <span class="hljs-keyword">if</span> result == <span class="hljs-number">1</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">2</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">3</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">4</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">5</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">6</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">7</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">0</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">8</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">9</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">10</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">11</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">12</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">13</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">14</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">15</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">16</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">17</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">18</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">19</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">20</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">21</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">22</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">23</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">24</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">25</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">26</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">27</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">28</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">29</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">30</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">31</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">elif</span> result == <span class="hljs-number">32</span>:<font></font>
            self.line.setText(<span class="hljs-string">''</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><font></font>
<font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            print(<span class="hljs-string">'ERROR!'</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">predicting</span>(<span class="hljs-params">self</span>):</span><font></font>
        image = keras.preprocessing.image<font></font>
        model = keras.models.load_model(<span class="hljs-string">'model/cyrillic_model.h5'</span>)<font></font>
        img = image.load_img(<span class="hljs-string">'res.jpeg'</span>, target_size=(<span class="hljs-number">278</span>, <span class="hljs-number">278</span>))<font></font>
        x = image.img_to_array(img)<font></font>
        x = np.expand_dims(x, axis=<span class="hljs-number">0</span>)<font></font>
        images = np.vstack([x])<font></font>
        classes = model.predict(images, batch_size=<span class="hljs-number">1</span>)<font></font>
        result = int(np.argmax(classes))<font></font>
        self.print_letter(result)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mousePressEvent</span>(<span class="hljs-params">self, event</span>):</span>
        <span class="hljs-keyword">if</span> event.button() == Qt.LeftButton:<font></font>
            self.drawing = <span class="hljs-literal">True</span><font></font>
            self.lastPoint = event.pos()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mouseMoveEvent</span>(<span class="hljs-params">self, event</span>):</span>
        <span class="hljs-keyword">if</span> (event.buttons() &amp; Qt.LeftButton) &amp; self.drawing:<font></font>
            painter = QPainter(self.image)<font></font>
            painter.setPen(QPen(self.brushColor, self.brushSize, Qt.SolidLine, Qt.RoundCap, Qt.RoundJoin))<font></font>
            painter.drawLine(self.lastPoint, event.pos())<font></font>
            self.lastPoint = event.pos()<font></font>
            self.update()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mouseReleaseEvent</span>(<span class="hljs-params">self, event</span>):</span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> event.button() == Qt.LeftButton:<font></font>
            self.drawing = <span class="hljs-literal">False</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">paintEvent</span>(<span class="hljs-params">self, event</span>):</span><font></font>
        canvasPainter = QPainter(self)<font></font>
        canvasPainter.drawImage(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, self.image)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save</span>(<span class="hljs-params">self</span>):</span>
        self.image.save(<span class="hljs-string">'res.jpeg'</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">clear</span>(<span class="hljs-params">self</span>):</span><font></font>
        self.image.fill(Qt.white)<font></font>
        self.update()<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:<font></font>
    app = QApplication(sys.argv)<font></font>
    window = Window()<font></font>
    window.show()<font></font>
    app.exec()<font></font>
</code></pre></div>
                    </div><br>
<h2></h2><br>
<p>  ,   - ¬´¬ª,       .</p><br>
<p> Python  ,    ,  Windows, Linux  OSX.      Ubuntu 18.04.    ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">GitHub</a>.</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en505594/index.html">How to turn a site visitor into a client: a guide on creating lead forms</a></li>
<li><a href="../en505604/index.html">Addiction vulnerability</a></li>
<li><a href="../en505608/index.html">Vuex - solve an old dispute with new methods</a></li>
<li><a href="../en505612/index.html">MK-61: history, emulation, device</a></li>
<li><a href="../en505614/index.html">–°—Ç–∞–≤–∫–∏ –≤–∫–ª–∞–¥–æ–≤ –∫—Ä—É–ø–Ω–µ–π—à–∏—Ö –±–∞–Ω–∫–æ–≤ —Å–Ω–∏–∑–∏–ª–∏—Å—å –¥–æ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –º–∏–Ω–∏–º—É–º–∞: –∫–∞–∫ —ç—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ —ç–∫–æ–Ω–æ–º–∏–∫—É, –∏ –ø—Ä–∏—á–µ–º –∑–¥–µ—Å—å –±–∏—Ä–∂–∞</a></li>
<li><a href="../en505618/index.html">GRASP Templates: Creator</a></li>
<li><a href="../en505620/index.html">HackTheBox. Walkthrough Nest. NTFS streams, reverse C # and SMB walker</a></li>
<li><a href="../en505624/index.html">How to process a data frame with billions of records in seconds?</a></li>
<li><a href="../en505632/index.html">Memory allocators</a></li>
<li><a href="../en505634/index.html">Proxy Settings for WSL (Ubuntu)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>