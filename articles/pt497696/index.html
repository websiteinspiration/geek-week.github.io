<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôéüèª üé± üèáüèΩ Como o Ryuk ransomware que ataca empresas üë©üèæ‚Äçüíª ü•í ü§¶üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O Ryuk √© uma das op√ß√µes de ransomware mais conhecidas nos √∫ltimos anos. Desde que ele apareceu pela primeira vez no ver√£o de 2018, ele compilou uma li...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Como o Ryuk ransomware que ataca empresas</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497696/"><img src="https://habrastorage.org/webt/wc/6r/b3/wc6rb3xxu-e_aw_mg1pxcy_23yq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Ryuk √© uma das op√ß√µes de ransomware mais conhecidas nos √∫ltimos anos. </font><font style="vertical-align: inherit;">Desde que ele apareceu pela primeira vez no ver√£o de 2018, ele compilou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uma lista impressionante de v√≠timas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , especialmente no ambiente de neg√≥cios, que √© o principal alvo de seus ataques.</font></font><a name="habracut"></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Informa√ß√µes Gerais</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este documento cont√©m uma an√°lise da op√ß√£o Ryuk ransomware, bem como do gerenciador de inicializa√ß√£o respons√°vel por baixar o malware no sistema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Ryuk ransomware apareceu pela primeira vez no ver√£o de 2018. Uma das diferen√ßas entre o Ryuk e outro ransomware √© que ele visa atacar ambientes corporativos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em meados de 2019, grupos de crimes cibern√©ticos atacaram um grande n√∫mero de empresas espanholas com a ajuda desse cripto. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x5/ax/et/x5axetxacru5kb7h6er1vagmdqy.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. </font></font><br>
</i><br>
<img src="https://habrastorage.org/webt/oc/kn/ee/ockneevf4elmwczdwsmimtsvnuk.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura </font></font><br>
</i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">1: Trecho do El Confidencial referente ao ataque do Ryuk ransomware [1] </font></i><i><font style="vertical-align: inherit;">2: Trecho do El Pa√≠s sobre um ataque do Ryuk ransomware [2]</font></i></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Este ano, o Ryuk atacou um grande n√∫mero de empresas em diferentes pa√≠ses. Como voc√™ pode ver nas figuras abaixo, Alemanha, China, Arg√©lia e √çndia foram as que mais sofreram.</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comparando o n√∫mero de ataques cibern√©ticos, podemos ver que milh√µes de usu√°rios foram afetados pelo Ryuk e a enorme quantidade de dados foi comprometida, resultando em s√©rios danos econ√¥micos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-p/4u/y-/-p4uy-fnectlv0mqwtvupfa--vc.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 3: Ilustra√ß√£o da atividade global de Ryuk. </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/sq/oe/hm/sqoehmto6enrwgz6kjt4_sdpgz0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 4: 16 pa√≠ses mais afetados por Ryuk </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/qj/1_/d2/qj1_d2eze5bigcd0gqvvrwiw9ns.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 5: O n√∫mero de usu√°rios atacados pelo Ryuk ransomware (em milh√µes)</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
De acordo com o princ√≠pio usual da opera√ß√£o de tais amea√ßas, este ransomware ap√≥s criptografia mostra √† v√≠tima uma notifica√ß√£o de resgate que deve ser paga em bitcoins no endere√ßo especificado para restaurar o acesso aos arquivos criptografados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este malware mudou desde que apareceu pela primeira vez.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma variante dessa amea√ßa analisada neste documento foi descoberta durante uma tentativa de lan√ßar um ataque em janeiro de 2020. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Devido √† sua complexidade, esse malware √© frequentemente atribu√≠do a cibercriminosos organizados, tamb√©m conhecidos como grupos APT. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parte do c√≥digo Ryuk tem uma not√°vel semelhan√ßa com o c√≥digo e a estrutura de outro conhecido cript√≥grafo Hermes, com o qual eles t√™m v√°rias fun√ß√µes id√™nticas. √â por isso que Ryuk foi inicialmente associado ao grupo norte-coreano Lazarus, que na √©poca era suspeito de estar por tr√°s do ransomware Hermes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Posteriormente, o Falcon X da CrowdStrike observou que Ryuk foi realmente criado por WIZARD SPIDER [4].</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° alguma evid√™ncia para apoiar essa suposi√ß√£o. Em primeiro lugar, esse ransomware foi anunciado no site exploit.in, que √© um mercado de malware russo bem conhecido e anteriormente estava associado a alguns grupos russos de APT. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este fato exclui a teoria de que Ryuk poderia ser desenvolvido pelo grupo Lazarus APT, como isso n√£o corresponde √† maneira como o grupo age.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, Ryuk foi apontado como um criptografador que n√£o funcionar√° nos sistemas russo, ucraniano e bielorrusso. Esse comportamento √© determinado pela fun√ß√£o encontrada em algumas vers√µes do Ryuk, onde verifica o idioma do sistema em que esse criptografador est√° sendo executado e interrompe sua opera√ß√£o se o sistema tiver russo, ucraniano ou bielorrusso. Finalmente, ao realizar uma an√°lise especializada de uma m√°quina que foi invadida pelo grupo WIZARD SPIDER, foram descobertos v√°rios ‚Äúartefatos‚Äù que supostamente eram usados ‚Äã‚Äãno desenvolvimento do Ryuk como uma variante do ransomware Hermes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por outro lado, as especialistas Gabriela Nicolao e Luciano Martins sugeriram que o criptografador poderia ter sido desenvolvido pela equipe do CryptoTech APT [5].</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso decorre do fato de que alguns meses antes do surgimento do Ryuk, esse grupo postou informa√ß√µes no f√≥rum do mesmo site em que eles haviam desenvolvido uma nova vers√£o do ransomware Hermes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V√°rios usu√°rios do f√≥rum se perguntaram se a CryptoTech realmente criou o Ryuk. </font><font style="vertical-align: inherit;">Depois disso, esse grupo se defendeu e afirmou ter evid√™ncias de que havia desenvolvido 100% desse criptografador.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Caracter√≠sticas</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Come√ßamos com o gerenciador de inicializa√ß√£o, cuja tarefa √© identificar o sistema em que est√° localizado, para que voc√™ possa executar a vers√£o "correta" do criptografador Ryuk. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O hash do carregador de inicializa√ß√£o √© o seguinte: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MD5 A73130B0E379A989CBA3D695A157A495 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SHA256 EF231EE1A2481B7E627921468E79BB4369CCFAEB19A575748DD2B664ABC4F469 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dos recursos deste carregador de inicializa√ß√£o n√£o √© esse: os criadores deste malware n√£o inclu√≠ram nenhuma informa√ß√£o nele.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Äs vezes, eles incluem dados incorretos para fazer o usu√°rio pensar que ele est√° supostamente iniciando um aplicativo leg√≠timo. </font><font style="vertical-align: inherit;">No entanto, como veremos mais adiante, no caso de a infec√ß√£o n√£o envolver intera√ß√£o com o usu√°rio (como √© o caso deste criptografador), os invasores n√£o consideram necess√°rio o uso de metadados. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rj/zx/yu/rjzxyuaec1nfxajxzwufks4hb0w.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. </font><font style="vertical-align: inherit;">6:</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Amostra de </font><i><font style="vertical-align: inherit;">metadados A amostra</font></i><font style="vertical-align: inherit;"> foi compilada no formato de 32 bits para que possa ser executada em sistemas de 32 e 64 bits.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Vetor de penetra√ß√£o</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A amostra que baixa e inicia o Ryuk entrou em nosso sistema por uma conex√£o remota e os par√¢metros de acesso foram obtidos gra√ßas a um ataque RDP preliminar. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pt/jd/bj/ptjdbj8ce7mgfuy8vowq8gogitm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 7: Registro de ataque Um</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
invasor conseguiu fazer logon remotamente. Depois disso, ele criou um arquivo execut√°vel com nossa amostra. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este arquivo execut√°vel foi bloqueado por uma solu√ß√£o antiv√≠rus antes do lan√ßamento. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ez/gj/gq/ezgjgq4iagc2lep3pebhom5cox0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 8: Bloqueio da amostra </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/tg/zv/-k/tgzv-keet96r81465eywpeahn8a.jpeg"><br>
<img src="https://habrastorage.org/webt/c_/0j/wz/c_0jwzu0madpx1t-pmfdznt-xny.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 9: Bloqueio de amostra</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Quando um arquivo malicioso foi bloqueado, o invasor tentou baixar uma vers√£o criptografada do arquivo execut√°vel, que tamb√©m foi bloqueada. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/za/f8/mh/zaf8mhwwbu4rr9u_elmazc9cmns.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 10: Um conjunto de amostras que um invasor tentou executar</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Finalmente, ele tentou baixar outro arquivo malicioso atrav√©s de um console criptografado</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PowerShell para ignorar a prote√ß√£o antiv√≠rus. </font><font style="vertical-align: inherit;">Mas ele tamb√©m foi bloqueado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lw/4b/mj/lw4bmjqpqtkf1zrqhhe0zb-4rzm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. </font><font style="vertical-align: inherit;">11: PowerShell com o conte√∫do malicioso bloqueado </font></font><br>
</i><br>
<img src="https://habrastorage.org/webt/eu/dj/he/eudjheox40zpaop3cphprkuc-5c.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. </font><font style="vertical-align: inherit;">12: PowerShell com conte√∫do malicioso bloqueado</font></font><br>
 </i><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Carregador de Inicializa√ß√£o</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando √© executado, ele grava o arquivo Leia-me na pasta </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% temp%</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , t√≠pica do Ryuk. Este arquivo - uma demanda de resgate, contendo o dom√≠nio protonmail do endere√ßo de email, bastante comum nessa fam√≠lia de malware: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msifelabem1981@protonmail.com </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/qt/pg/zm/qtpgzmcdohk4siulk9nuayvwhqm.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/bk/wa/u9/bkwau9on8kixa8bsmiikectemqu.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 13: Requisito de resgate</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
No tempo de execu√ß√£o, o gerenciador de inicializa√ß√£o pode ver que ele executa v√°rios arquivos execut√°veis ‚Äã‚Äãcom nomes aleat√≥rios. Eles s√£o armazenados em uma pasta </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PUBLIC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oculta </font><font style="vertical-align: inherit;">, mas se a op√ß√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Mostrar arquivos e pastas ocultos"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o </font><b><font style="vertical-align: inherit;">estiver</font></b><font style="vertical-align: inherit;"> ativa no sistema operacional </font><font style="vertical-align: inherit;">, eles permanecer√£o ocultos. Al√©m disso, esses arquivos s√£o de 64 bits, diferentemente do arquivo pai, que √© de 32 bits.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8b/ko/z3/8bkoz3_hgnilr-2i7sytnv5g2ik.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/fe/fb/z-/fefbz-5_yiuoiftotqmnei2hrvq.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 14: Arquivos execut√°veis ‚Äã‚Äãiniciados pelo exemplo</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Como voc√™ pode ver na figura acima, o Ryuk lan√ßa o icacls.exe, que ser√° usado para modificar todas as ACLs (lista de controle de acesso), garantindo assim o acesso e a altera√ß√£o dos sinalizadores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ele obt√©m acesso total em todos os usu√°rios a todos os arquivos no dispositivo (/ T), independentemente de erros (/ C) e sem mostrar nenhuma mensagem (/ Q). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mf/bt/nc/mfbtnclxe4usjepbuizjzknslmu.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. Figura 15: Op√ß√µes de execu√ß√£o do icacls.exe iniciadas pelo exemplo.√â</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
importante observar que o Ryuk verifica qual vers√£o do Windows est√° sendo executada. Para fazer isso, ele </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
verifica a vers√£o usando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetVersionExW</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , na qual verifica o valor do sinalizador </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lpVersionInformation</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mostrando se a vers√£o atual do Windows √© posterior ao </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows XP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lc/iv/yv/lcivyvqvjmm8jximv35wbo_v8ps.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/g8/t_/da/g8t_dabeoemyz2v0u93a8ivfilk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dependendo de voc√™ estar executando uma vers√£o posterior ao Windows XP, o carregador de inicializa√ß√£o gravar√° na pasta do usu√°rio local - nesse caso, na pasta </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Public%</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gg/gr/at/gggrateobojjggmubdykjordzy4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 17: Verificando a vers√£o do sistema operacional O</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
arquivo gravado √© Ryuk. Em seguida, lan√ßa-o, passando seu pr√≥prio endere√ßo como par√¢metro. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hh/0f/ct/hh0fctenv0yqswmtw9rhmhjjwv0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 18: Executando o Ryuk atrav√©s do ShellExecute</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
A primeira coisa que o Ryuk faz √© obter os par√¢metros de entrada. Desta vez, existem dois par√¢metros de entrada (o pr√≥prio arquivo execut√°vel e o endere√ßo do conta-gotas), que s√£o usados ‚Äã‚Äãpara remover seus pr√≥prios rastreamentos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1r/wu/vo/1rwuvoxtlg3lmusyoiem1v-e3da.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/op/wf/f7/opwff7lstsb0iq-nbvfqipywy6y.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 19: Criando um processo</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ tamb√©m pode ver que, assim que ele lan√ßa seus arquivos execut√°veis, ele se exclui, deixando assim nenhum vest√≠gio de sua presen√ßa na pasta em que foi executado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tp/ui/af/tpuiafv8uy2rmzsuememmnkaxxa.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. </font><font style="vertical-align: inherit;">20: exclus√£o de arquivo</font></font></i><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. RYUK</font></font></h4><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Presen√ßa 5.1 O</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ryuk, como outros malwares, tenta permanecer no sistema pelo maior tempo poss√≠vel. Como mostrado acima, uma maneira de atingir esse objetivo √© criar e executar secretamente arquivos execut√°veis. Para isso, a pr√°tica mais comum √© modificar a chave do Registro </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CurrentVersion \ Run</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse caso, voc√™ pode ver que, para esse fim, o primeiro arquivo execut√°vel </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VWjRF.exe</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
(o nome do arquivo √© gerado aleatoriamente) inicia o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sd/8b/g2/sd8bg232guhntext0cy-exeh3be.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/nn/og/fo/nnogfoscybmwjhn9xnwd0gw7118.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 21: Executando o arquivo VWjRF.exe</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Em seguida, um comando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RUN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© inserido </font><font style="vertical-align: inherit;">com o nome " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">svchos</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Assim, se voc√™ quiser verificar as chaves do registro a qualquer momento, n√£o poder√° notar facilmente essa altera√ß√£o, dada a semelhan√ßa desse nome com o svchost. Gra√ßas a essa chave, o Ryuk garante sua presen√ßa no sistema. Se o sistema ainda n√£o foi infectado quando voc√™ reiniciar o sistema, o execut√°vel tentar√° novamente </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ta/my/42/tamy42jg8mihxlgmxgzfjzqvfui.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 22: O exemplo garante a presen√ßa da chave do registro</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Tamb√©m podemos ver que esse execut√°vel interrompe os dois servi√ßos: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
" </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audioendpointbuilder</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", que, como o pr√≥prio nome indica, corresponde ao sistema √°udio, </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h-/28/g8/h-28g8z69elv6rzdsjo2xuvrok4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 23: Amostra p√°ra de √°udio do sistema</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servi√ßo SamSs</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que √© um servi√ßo de gerenciamento de contas. A interrup√ß√£o desses dois servi√ßos √© uma caracter√≠stica do Ryuk. Nesse caso, se o sistema estiver conectado ao sistema SIEM, o criptografador tentar√° parar de enviar </font><font style="vertical-align: inherit;">qualquer aviso </font><font style="vertical-align: inherit;">ao </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SIEM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Assim, ele defende seus pr√≥ximos passos, j√° que alguns servi√ßos de SAM n√£o poder√£o iniciar seu trabalho corretamente ap√≥s a execu√ß√£o do Ryuk. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wj/fn/l1/wjfnl14it7llrkny9xpfvrs30di.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 24: A amostra interrompe o servi√ßo Samss </font></font></i><br>
 <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2 Privil√©gios</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Em geral, o Ryuk come√ßa com o movimento horizontal na rede ou √© iniciado por outro programa malicioso, como o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Emotet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trickbot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que, em caso de escalonamento de privil√©gios, transfere esses direitos elevados para o criptografador.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com anteced√™ncia, como um prel√∫dio ao processo de implementa√ß√£o, vemos que ele executa o processo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImpersonateSelf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o que significa que o conte√∫do de seguran√ßa do token de acesso ser√° transferido para o fluxo, onde ser√° recebido imediatamente usando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetCurrentThread</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9y/nm/ut/9ynmutmaqq2wovbdswheiipajcc.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 25: Chamando ImpersonateSelf</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Em seguida, vemos que ele associar√° o token de acesso ao fluxo. Tamb√©m vemos que um dos sinalizadores √© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DesiredAccess</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que pode ser usado para controlar o acesso que o fluxo ter√°. Nesse caso, o valor que a edx receber√° deve ser </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TOKEN_ALL_ACESS,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TOKEN_WRITE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ui/vc/a_/uivca_yeyyvr5m-hwyolmei6k3u.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/tm/gy/yg/tmgyygvshjspnungxwqitl_jqm0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 26: Criando um token de fluxo</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Em seguida, ele usar√°</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O SeDebugPrivilege</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> far√° uma chamada para obter direitos de depura√ß√£o de depura√ß√£o com rela√ß√£o ao fluxo, como resultado, especificando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PROCESS_ALL_ACCESS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ele poder√° acessar qualquer processo necess√°rio. Agora, considerando que o criptografador j√° possui um fluxo preparado, resta apenas prosseguir para o est√°gio final. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0m/lf/ki/0mlfkifvdv7hk7rizfyus_7oco4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 27: Chamando SeDebugPrivilege e a fun√ß√£o de escalar direitos</font></font><br>
 </i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Por um lado, temos LookupPrivilegeValueW, que fornece as informa√ß√µes necess√°rias sobre os privil√©gios que queremos aumentar. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ts/wd/db/tswddbwi0jyghyqjpniu6rphmpe.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 28: Solicitando informa√ß√µes sobre privil√©gios para sua escala√ß√£o</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Por outro lado, temos o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AdjustTokenPrivileges</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que nos permite obter os direitos necess√°rios ao nosso fluxo. Nesse caso, o mais importante √© o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewState.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cuja bandeira conceder√° privil√©gios. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ki/sx/pa/kisxpam9ymp6ivk8remgfwfx4aq.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/9m/0s/sa/9m0ssakqkkjd4wzm4wqfav-mn7g.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. Figura 29: Definindo direitos para o token </font></font></i><br>
 <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3 Implanta√ß√£o</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nesta se√ß√£o, mostraremos como a amostra executa o processo de implanta√ß√£o mencionado anteriormente neste relat√≥rio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O principal objetivo do processo de implementa√ß√£o, bem como a escala√ß√£o, √© obter acesso a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥pias de sombra</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Para fazer isso, ele precisa trabalhar com o fluxo com direitos mais altos que os do usu√°rio local. Assim que obtiver esses direitos mais altos, ele excluir√° as c√≥pias e far√° altera√ß√µes em outros processos para tornar imposs√≠vel retornar a um ponto de restaura√ß√£o anterior no sistema operacional. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como geralmente ocorre com esse tipo de malware, ele usa o </font><b><font style="vertical-align: inherit;">CreateToolHelp32Snapshot</font></b><font style="vertical-align: inherit;"> para concluir a implementa√ß√£o</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, para obter uma captura instant√¢nea dos processos em execu√ß√£o no momento e tentar acessar esses processos usando o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenProcess</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Assim que ele obt√©m acesso ao processo, ele tamb√©m abre um token com suas informa√ß√µes para obter os par√¢metros do processo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dc/do/xz/dcdoxzczq1ti1kf5fu_5y_rikc8.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Figura </font><i><font style="vertical-align: inherit;">30: Recebendo processos de um computador</font></i><font style="vertical-align: inherit;"> Podemos ver dinamicamente como ele recebe uma lista de processos em execu√ß√£o na rotina 140002D9C usando CreateToolhelp32Snapshot. Depois de receb√™-los, ele percorre a lista, tentando abrir processos um por um usando o OpenProcess at√© que ele possa faz√™-lo. Nesse caso, o primeiro processo que ele conseguiu abrir foi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"taskhost.exe"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/k0/24/og/k024ogcd6ioxwnjbfuhjuefrce4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 31: Execu√ß√£o din√¢mica de um procedimento para obter um processo</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Podemos ver que ele posteriormente l√™ o token do processo, por isso √© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenProcessToken</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com o " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20008</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8j/zl/kn/8jzlkngsiwxlyol93ozqx8ebjrm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 32: Lendo informa√ß√µes do token do processo</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Tamb√©m verifica se o processo no qual ele ser√° incorporado n√£o √© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">csrss.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">explorer.exe, lsaas.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou se possui um conjunto de permiss√µes de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">autoridade</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do </font><b><font style="vertical-align: inherit;">NT</font></b><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hr/xr/9k/hrxr9kefgjfbtsex5awxtlqmjcm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. Figura 33: Processos exclu√≠dos.Podemos</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ver dinamicamente como ele primeiro verifica usando as informa√ß√µes do token do processo em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">140002D9C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para descobrir se a conta cujos direitos s√£o usados ‚Äã‚Äãpara executar o processo √© uma conta </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT AUTHORITY</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4v/_v/-c/4v_v-cloz4ndee9gs0qbihghn9k.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 34: Verificando a AUTORIDADE NT</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
E, posteriormente, fora do procedimento, verifica se n√£o √© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">csrss.exe, explorer.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lsaas.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wa/uy/gg/wauyggzhisvonm1cyqr3cahfdc0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 35: Verificando a AUTORIDADE do NT</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Depois que ele tirou um instant√¢neo dos processos, abriu os processos e verificou que nenhum deles foi exclu√≠do, ele est√° pronto para anotar os processos que ser√£o implementados na mem√≥ria. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para fazer isso, ele primeiro reserva uma regi√£o na mem√≥ria ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VirtualAllocEx</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), grava nela ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WriteProcessmemory</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) e cria um fluxo ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateRemoteThread</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Para trabalhar com essas fun√ß√µes, ele usa os PIDs dos processos selecionados, que ele obteve anteriormente usando o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateToolhelp32Snapshot</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/s7/zp/pl/s7zpplpua6q4w1mgpurwvgtzyxy.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 36: C√≥digo incorporado</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Aqui podemos observar dinamicamente como ele usa o PID do processo para chamar a fun√ß√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VirtualAllocEx. </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/7n/k1/j-/7nk1j-saztq--oxfo2xwzyiowgk.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. Figura 37: Invocando a </font></font></i><br>
 <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">criptografia do </font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">VirtualAllocEx </font></i><b><font style="vertical-align: inherit;">5.4</font></b></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nesta se√ß√£o, veremos parte deste exemplo relacionado √† criptografia. Na figura a seguir, voc√™ pode ver duas rotinas chamadas " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LoadLibrary_EncodeString</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " e " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encode_Func</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", respons√°veis ‚Äã‚Äãpela execu√ß√£o do procedimento de criptografia. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o5/iu/1r/o5iu1rimo3qfnbgpnl4mvwcpwug.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 38: Procedimentos de criptografia</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Inicialmente, podemos ver como ela carrega uma string que posteriormente ser√° usada para ocultar tudo o que √© necess√°rio: importa√ß√µes, DLLs, comandos, arquivos e CSPs. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/du/x6/te/dux6tehj_i7jcqkupvfdb3hlcfw.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 39: Cadeia de desofusca√ß√£o</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A figura a seguir mostra a primeira importa√ß√£o desofuscada no registro R4, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LoadLibrary</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Isso ser√° usado posteriormente para carregar as DLLs necess√°rias. Tamb√©m podemos ver outra linha no registro R12, que √© usado junto com a linha anterior para realizar a desofusca√ß√£o. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/la/oo/to/laootohjrpgt3fa-yeetqz6rxzo.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 40: Desofusca√ß√£o din√¢mica:</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ele continua </font><i><font style="vertical-align: inherit;">carregando</font></i><font style="vertical-align: inherit;"> comandos que ser√£o executados posteriormente para desativar backups, pontos de restaura√ß√£o e modos de inicializa√ß√£o segura. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ce/qt/le/ceqtleaezfngmfgtrlhpgxl-vbw.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 41: Download de comandos</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Em seguida, ele carrega o local onde ir√° soltar 3 arquivos: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows.bat, run.sct</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">start.bat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ef/wj/9f/efwj9fcrtd5vai-3jjp6kblwsu0.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/jx/sg/sa/jxsgsaqyu0omqswv0-eseu5aeok.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/yq/g4/ur/yqg4urwb1wqlo52wgoocuccbi00.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/i2/fc/2t/i2fc2t2mcj6qrwau7gikqb4ohf4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 42: Locais dos Arquivos</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esses 3 arquivos s√£o usados ‚Äã‚Äãpara verificar os privil√©gios que cada local possui. Se os privil√©gios necess√°rios n√£o estiverem dispon√≠veis, o Ryuk interrompe a execu√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ele continua carregando linhas correspondentes a tr√™s arquivos. O primeiro, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DECRYPT_INFORMATION.html</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cont√©m as informa√ß√µes necess√°rias para restaurar arquivos. O segundo, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PUBLIC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cont√©m a chave p√∫blica RSA. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vf/w1/do/vfw1doq6ayau0i8pkniuc-rd5mk.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 43: String DECRYPT INFORMATION.html</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Terceiro, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNIQUE_ID_DO_NOT_REMOVE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cont√©m a chave criptografada que ser√° usada na pr√≥xima rotina para executar a criptografia. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/u_/1l/s1/u_1ls1stszk23gkrsh2mwonnvgi.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 44: ID √öNICO N√ÉO REMOVE String</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Finalmente, ele carrega as bibliotecas necess√°rias junto com as importa√ß√µes e o CSP necess√°rios ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Enhanced RSA</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">provedor criptogr√°fico da AES</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7d/b9/q1/7db9q1wjr1k_y1bfsefiewsc-6g.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 45: Fazendo download de bibliotecas</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Depois que toda a desofusca√ß√£o estiver conclu√≠da, ele executa as a√ß√µes necess√°rias para a criptografia: repita todas as unidades l√≥gicas, execute o que foi carregado na sub-rotina anterior, reforce a presen√ßa no sistema, descarte o arquivo RyukReadMe.html, criptografe, enumere todas as unidades de rede, alternando para dispositivos descobertos e sua criptografia. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo come√ßa com o download de " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " e a grava√ß√£o da chave p√∫blica RSA. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_n/me/r-/_nmer-jvdpleozaujmoemqo7u9s.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 46: Preparando a criptografia</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Em seguida, recupera todas as unidades l√≥gicas usando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetLogicalDrives</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e desativa todos os backups, pontos de recupera√ß√£o e modos de inicializa√ß√£o segura.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fa/ov/f8/faovf8myihdrkrtulhzcu_50e8q.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 47: Desativando ferramentas de recupera√ß√£o</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Depois disso, ele refor√ßa sua presen√ßa no sistema, como vimos acima, e grava o primeiro arquivo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RyukReadMe.html</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TEMP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x8/7u/at/x87uatt-xtzmrn0un3-jqt5o0hw.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Figura </font><i><font style="vertical-align: inherit;">48: Publicando uma notifica√ß√£o de recompra</font></i><font style="vertical-align: inherit;"> Na figura a seguir, voc√™ pode ver como ele cria um arquivo, baixa o conte√∫do e o grava: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vu/5o/2n/vu5o2nliyrqgsmugbe9jpx0-1mc.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura. Figura 49: Baixando e gravando o conte√∫do de um arquivo</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Para poder executar as mesmas a√ß√µes em todos os dispositivos, ele usa </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
" </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">icacls.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", como mostramos acima. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bd/6a/qb/bd6aqbnkrrba-polrck91kh53w0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 50: Usando o icalcls.exe</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, finalmente, ele come√ßa a criptografar arquivos, com exce√ß√£o dos arquivos "* .exe", "* .dll", arquivos do sistema e outros locais especificados como uma lista branca criptografada. </font><font style="vertical-align: inherit;">Para isso, ele usa importa√ß√µes: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptAcquireContextW</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (onde o uso de AES e RSA √© indicado), </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptDeriveKey, CryptGenKey</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptDestroyKey</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , etc. </font><font style="vertical-align: inherit;">Tamb√©m est√° sendo feita uma tentativa de expandir seu efeito nos dispositivos de rede detectados usando WNetEnumResourceW e depois criptograf√°-los. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9j/yn/mj/9jynmjtzu26dwvfg3ugrthcxo0o.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. </font><font style="vertical-align: inherit;">51: Criptografia de arquivo do sistema</font></font></i><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Importa√ß√µes e sinalizadores relacionados</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A seguir, √© apresentada uma tabela que lista as importa√ß√µes e sinalizadores mais relevantes usados ‚Äã‚Äãpela amostra:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ri/bn/he/ribnhe9istspdndifpecxgnzljc.jpeg"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. COI</font></font></h4><br>
<img src="https://habrastorage.org/webt/bf/gu/cr/bfgucrrkqw-l2jurn09ovgljhas.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Refer√™ncias</font></font></b><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">users \ Public \ run.sct</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menu Iniciar \ Programas \ Inicializa√ß√£o \ start.bat AppData \ Roaming \ Microsoft \ Windows \ Start</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menu \ ProgramasStartup \ start.bat</font></font></li>
</ul><br>
<br>
<img src="https://habrastorage.org/webt/ld/od/e2/ldode2_iiqa4jqw4ol46ch5dov4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Relat√≥rio t√©cnico do Ryuk ransomware compilado por especialistas em laborat√≥rio de antiv√≠rus da PandaLabs.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8. Refer√™ncias</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. ‚ÄúA R√°dio Everis e Prisa oferece um ciberataque grave que protege seus sistemas.‚Äù Https: // www. elconfidencial.com/tecnologia/2019-11-04/ everis-la-ser-ciberataque-ransomware-15_2312019 /, Publicada em 11/04/2019. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. ‚ÄúUm v√≠rus de origem russa ataca importantes empresas espanholas.‚Äù Https: //elpais.com/ tecnologia / 2019/11/04 / actualidad / 1572897654_ 251312.html, Publicada em 11/04/2019. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. ‚ÄúArtigo do VB2019: a vingan√ßa de Shinigami: a longa cauda do malware Ryuk.‚Äù Https://securelist.com/ hist√≥ria do ano-2019-cidades-sob-ransomware-cerco / 95456 /, Publicada el 11 / </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
12/2019 4. ‚ÄúGrande ca√ßa ao Ryuk: outro ransomware baseado em lucro‚Äù. Https: // www. crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/, Publicada em 01/10/2019.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5. ‚ÄúArtigo do VB2019: a vingan√ßa de Shinigami: a longa cauda do malware Ryuk.‚Äù Https: // www. </font><font style="vertical-align: inherit;">virusbulletin.com/virusbulletin/2019/10/ vb2019-paper-shinigamis-revenge-long-tail-r</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt497680/index.html">Seu telegrama parece estar fluindo</a></li>
<li><a href="../pt497682/index.html">Pavel Klemenkov, NVIDIA: Estamos tentando diminuir a dist√¢ncia entre o que um cientista de dados pode fazer e o que ele precisa ser capaz de fazer.</a></li>
<li><a href="../pt497684/index.html">Curva de hype: quais s√£o as tecnologias de TI no auge e qual permanecer√° a demanda est√°vel</a></li>
<li><a href="../pt497686/index.html">Material de implante que mata bact√©rias</a></li>
<li><a href="../pt497688/index.html">Como funciona a escola noturna de Kubernetes</a></li>
<li><a href="../pt497700/index.html">Mitaps online semanais sobre suporte e DevOps, seguran√ßa e rob√¥s a partir de 17 de abril</a></li>
<li><a href="../pt497702/index.html">Cinco tend√™ncias em armazenamento de dados que voc√™ deve prestar aten√ß√£o em 2020</a></li>
<li><a href="../pt497708/index.html">Convidamos voc√™ a uma s√©rie de semin√°rios on-line da Fujitsu em abril e maio</a></li>
<li><a href="../pt497714/index.html">Como proteger processos e extens√µes de kernel no macOS</a></li>
<li><a href="../pt497724/index.html">Preparando um servidor para publicar um aplicativo Web em Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>