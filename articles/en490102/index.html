<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëø üíΩ üåï wc to D: 712 characters without a single branch üßóüèº üè∫ ü•©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After reading ‚Äú Beat With an 80-Line Program on Haskell,‚Äù which I found on Hacker News , I decided that D might be better. And I wrote wc in D. 
 
 No...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>wc to D: 712 characters without a single branch</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490102/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After reading ‚Äú </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beat With an 80-Line Program on Haskell,‚Äù</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> which I found on </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacker News</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , I decided that D might be better. </font><font style="vertical-align: inherit;">And I wrote wc in D. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note.per. </font><font style="vertical-align: inherit;">I suggested translate the above article</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xd34df00d</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but he preferred to make based on his </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúWinning With Twenty Lines of Haskell: Writing Your Wc‚Äù</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">And now the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">articles </font></font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">are multiplying</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> like rehashings "minted coin."</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Program</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consists of one file - 34 lines and 712 characters.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Source code</font></font></b><div class="spoiler_text"><pre><code class="swift hljs"><span class="hljs-keyword">import</span> std.stdio : writefln, File;
<span class="hljs-keyword">import</span> std.algorithm : map, fold, splitter;
<span class="hljs-keyword">import</span> std.range : walkLength;
<span class="hljs-keyword">import</span> std.typecons : Yes;
<span class="hljs-keyword">import</span> std.uni : byCodePoint;<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Line</span> </span>{<font></font>
	size_t chars;<font></font>
	size_t words;<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Output</span> </span>{<font></font>
	size_t lines;<font></font>
	size_t words;<font></font>
	size_t chars;<font></font>
}<font></font>
<font></font>
<span class="hljs-type">Output</span> combine(<span class="hljs-type">Output</span> a, <span class="hljs-type">Line</span> b) pure nothrow {
	<span class="hljs-keyword">return</span> <span class="hljs-type">Output</span>(a.lines + <span class="hljs-number">1</span>, a.words + b.words, a.chars + b.chars);<font></font>
}<font></font>
<font></font>
<span class="hljs-type">Line</span> toLine(char[] l) pure {
	<span class="hljs-keyword">return</span> <span class="hljs-type">Line</span>(l.byCodePoint.walkLength, l.splitter.walkLength);<font></font>
}<font></font>
<font></font>
void main(string[] args) {<font></font>
	auto f = <span class="hljs-type">File</span>(args[<span class="hljs-number">1</span>]);
	<span class="hljs-type">Output</span> o = f<font></font>
		.byLine(<span class="hljs-type">Yes</span>.keepTerminator)<font></font>
		.<span class="hljs-built_in">map</span>!(l =&gt; toLine(l))<font></font>
		.fold!(combine)(<span class="hljs-type">Output</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>));<font></font>
<font></font>
	writefln!<span class="hljs-string">"%u %u %u %s"</span>(o.lines, o.words, o.chars, args[<span class="hljs-number">1</span>]);<font></font>
}</code></pre><br>
</div></div><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, he uses </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phobos, the D standard library</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but why not? </font><font style="vertical-align: inherit;">Phobos is beautiful, and comes with every D compiler. The program itself does not contain any if statements. </font><font style="vertical-align: inherit;">And in the wc implementation on Haskell, several if are used. </font><font style="vertical-align: inherit;">The D program, in addition to the main one, contains three more tiny functions. </font><font style="vertical-align: inherit;">I could easily put all the functionality in one range chain, but then it would probably exceed 80 characters per line. </font><font style="vertical-align: inherit;">This is the basic principle of code style.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performance</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Is wc on D faster than coreutils wc? </font><font style="vertical-align: inherit;">No, but it took me 15 minutes to write my version (I had to look for walkLength because I forgot the name of the function).</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data file</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lines</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">byte</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coreutils</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">haskell</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">app.d</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">46</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">906</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.5 ms ¬± 1.9 ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">39.6 ms ¬± 7.8 ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.9 ms ¬± 2.1 ms</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">big.txt</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">862</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64k</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.7 ms ¬± 2.0 ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">39.6 ms ¬± 7.8 ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.8 ms ¬± 2.1 ms</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vbig.txt</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.7M</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">96M</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">658.6ms ¬± 24.5ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">226.4 ms ¬± 29.5 ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.102 s ¬± 0.022 s</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vbig2.txt</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.1M</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">671M</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4 s ¬± 0.058 s</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1 s ¬± 0.039 s</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4 s ¬± 0.085 s</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Memory:</font></font><div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data file</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coreutils</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">haskell</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">app.d</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2052K</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7228K</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7708K</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">big.txt</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2112K</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7512K</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7616K</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vbig.txt</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2288K</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">42620K</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7712K</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vbig2.txt</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2360K</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50860K</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7736K</font></font></td>
</tr>
</tbody></table></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wc on Haskell faster? </font><font style="vertical-align: inherit;">For large files, certainly, but it uses multithreading. </font><font style="vertical-align: inherit;">For small files, GNU coreutils still wins. </font><font style="vertical-align: inherit;">At this stage, my version is most likely limited by IO, and in any case, it is quite fast. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will not argue that one language is faster than another. </font><font style="vertical-align: inherit;">If you spend time optimizing the micro benchmark, you will most likely win. </font><font style="vertical-align: inherit;">But not in real life. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But I will argue that functional programming in D almost catches up with the FP in Haskell.</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A bit about range in D</font></font></h3><br>
<img src="https://habrastorage.org/webt/gp/qe/oo/gpqeookkvehf2hdsowdegomcqai.png" align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">range is an abstraction that can be iterated without touching the underlying collection (if any). </font><font style="vertical-align: inherit;">Technically, range can be a structure or class that implements one or more Range interfaces. </font><font style="vertical-align: inherit;">The simplest form, InputRange, requires a function</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">popFront</span><span class="hljs-params">()</span></span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
and two members or properties </font></font><br>
<br>
<pre><code class="cpp hljs">T front;
<span class="hljs-keyword">bool</span> empty;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
T is a generic type of element that range iterates over. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D ranges are specific types. </font><font style="vertical-align: inherit;">When range falls into the foreach statement, the compiler performs a small modification.</font></font><br>
<br>
<pre><code class="cpp hljs">foreach (e; range) { ... }</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
turns into </font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> __r = range; !__r.empty; __r.popFront()) {
    <span class="hljs-keyword">auto</span> e = __r.front;<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
auto e = computes the type and is equivalent to T e =. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With this in mind, it's easy to create a range that can be used by foreach.</font></font><br>
<br>
<pre><code class="java hljs">struct Iota {
	<span class="hljs-keyword">int</span> front;
	<span class="hljs-keyword">int</span> end;<font></font>
<font></font>
	<span class="hljs-meta">@property</span> <span class="hljs-function">bool <span class="hljs-title">empty</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.front == <span class="hljs-keyword">this</span>.end;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">popFront</span><span class="hljs-params">()</span> </span>{<font></font>
		++<span class="hljs-keyword">this</span>.front;<font></font>
	}<font></font>
}<font></font>
<font></font>
unittest {<font></font>
	<span class="hljs-keyword">import</span> std.stdio;<font></font>
	foreach(it; Iota(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>)) {<font></font>
		writeln(it);<font></font>
	}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Iota is a very simple example of range. </font><font style="vertical-align: inherit;">It functions as a generator, without having the underlying collection. </font><font style="vertical-align: inherit;">It iterates through integers from start to finish in increments of one. </font><font style="vertical-align: inherit;">This snippet reveals a bit of D syntax.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@property</span> <span class="hljs-function">bool <span class="hljs-title">empty</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ property</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> attribute </font><font style="vertical-align: inherit;">allows you to use the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">empty</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">in the same way as a member variable (calling a function without parentheses). The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> attribute </font><font style="vertical-align: inherit;">at the end means that we are not modifying the instance data for which we call </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">empty</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . The built-in unit test prints numbers from 0 to 10. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another small feature is the lack of an explicit constructor. The Iota structure has two int member variables. In the foreach statement in the test, we create an Iota instance as if it has a constructor that accepts two ints. This is a structural literal. When the compiler D sees this, but the structure does not have a corresponding constructor, then in accordance with the order of declaration of variables - members of the structure will be assigned int.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The relationship between the three members is simple. </font><font style="vertical-align: inherit;">If empty is false, front is guaranteed to return a new element following the iteration after calling popFront. </font><font style="vertical-align: inherit;">After calling popFront, the empty value could change. </font><font style="vertical-align: inherit;">If this is true, it means that there are no more elements to iterate and further calls to front are invalid. </font><font style="vertical-align: inherit;">According </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to InputRange documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">front can be correctly calculated if and only if empty returns or would return false.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">front can be computed several times without calling popFront or otherwise mutating range or underlying data, and it gives the same result for each calculation.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using foreach expressions, or loops, is not very functional. </font><font style="vertical-align: inherit;">Suppose we want to filter out all the odd numbers for Iota. </font><font style="vertical-align: inherit;">We could put an if inside a foreach block, but that would only make it worse. </font><font style="vertical-align: inherit;">It would be better if we had a range that takes a range and a predicate that decides whether an element is suitable or not.</font></font><br>
<br>
<pre><code class="java hljs">struct Filter {<font></font>
	Iota input;<font></font>
	<span class="hljs-function">bool <span class="hljs-title">function</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span> predicate</span>;<font></font>
<font></font>
	<span class="hljs-keyword">this</span>(Iota input, <span class="hljs-function">bool <span class="hljs-title">function</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span> predicate) </span>{
		<span class="hljs-keyword">this</span>.input = input;
		<span class="hljs-keyword">this</span>.predicate = predicate;
		<span class="hljs-keyword">this</span>.testAndIterate();<font></font>
	}<font></font>
<font></font>
	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testAndIterate</span><span class="hljs-params">()</span> </span>{
		<span class="hljs-keyword">while</span>(!<span class="hljs-keyword">this</span>.input.empty<font></font>
				&amp;&amp; !<span class="hljs-keyword">this</span>.predicate(<span class="hljs-keyword">this</span>.input.front))<font></font>
		{<font></font>
			<span class="hljs-keyword">this</span>.input.popFront();<font></font>
		}<font></font>
	}<font></font>
<font></font>
	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">popFront</span><span class="hljs-params">()</span> </span>{
		<span class="hljs-keyword">this</span>.input.popFront();
		<span class="hljs-keyword">this</span>.testAndIterate();<font></font>
	}<font></font>
<font></font>
	<span class="hljs-meta">@property</span> <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">front</span><span class="hljs-params">()</span> </span>{
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.input.front;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-meta">@property</span> <span class="hljs-function">bool <span class="hljs-title">empty</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.input.empty;<font></font>
	}<font></font>
}<font></font>
<font></font>
<span class="hljs-function">bool <span class="hljs-title">isEven</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a)</span> </span>{
	<span class="hljs-keyword">return</span> a % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
unittest {<font></font>
	foreach(it; Filter(Iota(<span class="hljs-number">0</span>,<span class="hljs-number">10</span>), &amp;isEven)) {<font></font>
		writeln(it);<font></font>
	}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Filter is again very simple: Iota and a function pointer are needed. </font><font style="vertical-align: inherit;">When constructing the Filter, we call testAndIterate, which takes elements from Iota until it is empty or the predicate returns false. </font><font style="vertical-align: inherit;">The idea is that the predicate decides what to filter and what to leave. </font><font style="vertical-align: inherit;">The front and empty properties are simply translated to Iota. </font><font style="vertical-align: inherit;">The only thing that actually does the job is popFront. </font><font style="vertical-align: inherit;">It returns the current item and calls testAndIterate. </font><font style="vertical-align: inherit;">That's all. </font><font style="vertical-align: inherit;">This is a filter implementation.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, testAndIterate has a while loop, but rewriting it using recursion, in my opinion, is just plain stupid. What makes D great is that you can use the appropriate method for each task. Functional programming is good, and often flaunts, but sometimes it is not. If a little inline assembler is needed or more enjoyable, use.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Calling Filter still doesn't look very good. </font><font style="vertical-align: inherit;">Assuming you're used to reading from left to right, Filter appears before Iota, even if it runs after Iota. </font><font style="vertical-align: inherit;">D does not provide a pipe statement, but uses the Unified Function Call Syntax (UFCS). </font><font style="vertical-align: inherit;">If an expression can be implicitly converted to the first parameter of a function, then the function can be called just as if it were a member function of this expression. </font><font style="vertical-align: inherit;">This is quite complicated, I understand. </font><font style="vertical-align: inherit;">An example will help:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">foo</span><span class="hljs-params">(<span class="hljs-built_in">string</span> a)</span> </span>{
	<span class="hljs-keyword">return</span> a ~ <span class="hljs-string">"World"</span>;<font></font>
}<font></font>
<font></font>
unittest {<font></font>
	<span class="hljs-built_in">string</span> a = foo(<span class="hljs-string">"Hello "</span>);
	<span class="hljs-built_in">string</span> b = <span class="hljs-string">"Hello "</span>.foo();<font></font>
	assert(a == b);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The above example shows two calls to the foo function. </font><font style="vertical-align: inherit;">As assert implies, both calls are equivalent. </font><font style="vertical-align: inherit;">What does this mean for our Iota Filter example? </font><font style="vertical-align: inherit;">UFCS allows us to rewrite the unit test like this:</font></font><br>
<br>
<pre><code class="swift hljs">unittest {<font></font>
	foreach(it; <span class="hljs-type">Iota</span>(<span class="hljs-number">1</span>,<span class="hljs-number">10</span>).<span class="hljs-type">Filter</span>(&amp;isEven)) {<font></font>
		writeln(it);<font></font>
	}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The map / transform implementation for range should now be accessible to every reader. </font><font style="vertical-align: inherit;">Of course, a filter can be made more abstract using templates, but these are just details, nothing conceptually new. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, there are different types of range, for example, bidirectional. </font><font style="vertical-align: inherit;">Guess what opportunities this gives you. </font><font style="vertical-align: inherit;">A quick tip: there are two new primitives in the bidirectional range called back and popBack. </font><font style="vertical-align: inherit;">There are other types of range, but after you understand the input range shown above twice, you almost all recognize them. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS Just for clarity, do not implement your own filter, map or fold; </font><font style="vertical-align: inherit;">the Phobos D standard library has everything you need. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Take a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> look at </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">std.algorithm</font></a><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std.range</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">about the author</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Robert Schadeck earned a master's degree in computer science from the University of Oldenburg. </font><font style="vertical-align: inherit;">His master's thesis was entitled "DMCD - Distributed Multithreaded D Compiler with Caching", where he worked on creating a D-compiler from scratch. </font><font style="vertical-align: inherit;">He was a graduate student in computer science in 2012-2018. </font><font style="vertical-align: inherit;">at the University of Oldenburg. </font><font style="vertical-align: inherit;">His doctoral dissertation focuses on quorum systems in conjunction with graphs. </font><font style="vertical-align: inherit;">Since 2018, he has been pleased to use D in his daily work, working for Symmetry Investments.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">About Symmetry Investments</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Symmetry Investments is a global investment company with offices in Hong Kong, Singapore and London. </font><font style="vertical-align: inherit;">We have been doing business since 2014 after successfully separating from a major New York hedge fund.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At Symmetry, we strive to reasonably take risks to create value for our customers, partners, and employees. We benefit from our ability to generate win-win contracts - in the broadest sense of the word. Win-Win is our fundamental ethical and strategic principle. By generating win-win options, we can create unique solutions that combine perspectives that are usually perceived as incompatible or opposite, and covering all the best that each of the parties can offer. We are re-integrating fixed income arbitration with global macro strategies. We invent and develop a technology that focuses on the potential of human-machine integration. We create systems in which machines do what they do best, supporting people inso that they do what they do best. We are creating a meritocracy based on collaboration: a culture in which individual contribution serves both personal and collective goals - and is rewarded accordingly. We value both a sense of ownership and a team spirit of cooperation, self-realization and community.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Symmetry Investments people have been active members of Community D since 2014. </font><font style="vertical-align: inherit;">We sponsored the development of excel-d, dpp, autowrap, libmir and other projects. </font><font style="vertical-align: inherit;">We launched Symmetry Autumn of Code in 2018 and hosted DConf 2019 in London. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Approx. </font><font style="vertical-align: inherit;">Since the translator, as usual, was drunk, I cannot vouch for the accuracy of some human terms, and I don‚Äôt understand anything in the last section. </font><font style="vertical-align: inherit;">So send corrections in personal communications.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en490088/index.html">How to continue to create a map in UE4</a></li>
<li><a href="../en490092/index.html">Andrei Zaretsky, Alexander Trukhanov: ‚ÄúThe fee was enough to drink coffee‚Äù</a></li>
<li><a href="../en490094/index.html">Back to the roots: we drive a computer directly from the MBR</a></li>
<li><a href="../en490096/index.html">Easy way to make a tiny USB hub for Raspberry Pi</a></li>
<li><a href="../en490100/index.html">Develop software for decentralized scooter rental. Who said it would be easy?</a></li>
<li><a href="../en490104/index.html">Smart sun visor from Bosch. Prototype test</a></li>
<li><a href="../en490110/index.html">From developer to managers and vice versa</a></li>
<li><a href="../en490112/index.html">Monads as a code reuse pattern</a></li>
<li><a href="../en490114/index.html">Yandex.Practicum - Data Analyst. Graduation</a></li>
<li><a href="../en490118/index.html">10 most important facts about SERM</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>