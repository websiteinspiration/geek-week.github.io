<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â­ï¸ ğŸŒ† â› SSO pada arsitektur layanan mikro. Kami menggunakan Keycloak. Bagian nomor 1 ğŸ¤ŸğŸ½ â–«ï¸ ğŸ‘©ğŸ¼â€ğŸ¤â€ğŸ‘¨ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Di perusahaan besar mana pun, Grup Ritel X5 tidak terkecuali, karena jumlah proyek yang memerlukan otentikasi pengguna meningkat seiring dengan mening...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>SSO pada arsitektur layanan mikro. Kami menggunakan Keycloak. Bagian nomor 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/X5RetailGroup/blog/486778/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Di perusahaan besar mana pun, Grup Ritel X5 tidak terkecuali, karena jumlah proyek yang memerlukan otentikasi pengguna meningkat seiring dengan meningkatnya jumlah proyek. Seiring waktu, diperlukan transisi pengguna yang mulus dari satu aplikasi ke aplikasi lain dan kemudian ada kebutuhan untuk menggunakan server tunggal Single-Sing-On (SSO). Tetapi bagaimana dengan ketika penyedia identitas seperti AD atau orang lain yang tidak memiliki atribut tambahan sudah digunakan dalam berbagai proyek. Kelas sistem yang disebut "broker identitas" akan datang untuk menyelamatkan. Yang paling fungsional adalah perwakilannya, seperti Keycloak, manajemen Gravitee Access, dll. Paling sering, skenario penggunaan bisa berbeda: interaksi mesin, partisipasi pengguna, dll. Solusi harus mendukung fungsi yang fleksibel dan dapat diskalakan,mampu menggabungkan semua persyaratan dalam satu, dan solusi seperti itu di perusahaan kami sekarang adalah broker indikator - Keycloak.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hm/bi/eh/hmbiehmxsfcq_cfltz8xj0mhrgc.jpeg"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Keycloak adalah produk open source untuk otentikasi dan kontrol akses yang didukung oleh RedHat. </font><font style="vertical-align: inherit;">Ini adalah dasar untuk produk perusahaan menggunakan SSO - RH-SSO.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konsep dasar </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebelum Anda mulai berurusan dengan keputusan dan pendekatan, Anda harus menentukan syarat dan urutan proses: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mm/j1/c2/mmj1c2uynwb23y5j4me13zzcrb4.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Identifikasi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah proses mengenali subjek dengan pengidentifikasi (dengan kata lain, itu menentukan nama, login atau nomor). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otentikasi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah prosedur otentikasi (pengguna diperiksa dengan kata sandi, email diverifikasi oleh tanda tangan elektronik, dll.) </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otorisasi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah penyediaan akses ke beberapa sumber daya (misalnya, email).</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Broker Identitas Keycloak</font></font></h4><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keycloak</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah identitas sumber terbuka dan solusi manajemen akses yang dirancang untuk digunakan dalam IC di mana pola arsitektur layanan mikro dapat digunakan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Keycloak menawarkan fitur-fitur seperti sistem masuk tunggal (SSO), identifikasi pialang dan login sosial, federasi pengguna, adaptor klien, konsol administrator, dan konsol manajemen akun. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsionalitas dasar yang didukung di Keycloak:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Single-Sign On dan Single-Sign Out untuk aplikasi berbasis browser.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dukungan untuk OpenID / OAuth 2.0 / SAML.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perantara Identitas - Otentikasi menggunakan penyedia OpenID Connect atau SAML identitas eksternal.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Login Sosial - dukungan untuk Google, GitHub, Facebook, Twitter untuk identifikasi pengguna.</font></font></li>
<li>User Federation â€“    LDAP  Active Directory     .</li>
<li>Kerberos bridge â€“  Kerberos     .</li>
<li>Admin Console â€”         Web.</li>
<li>Account Management Console â€“     .</li>
<li>      .</li>
<li>2FA Authentication â€“  TOTP/HOTP   Google Authenticator  FreeOTP.</li>
<li>Login Flows â€“   ,      .</li>
<li>Session Management â€“        .</li>
<li>Token Mappers â€“   ,       .</li>
<li>    realm, application  .</li>
<li>CORS Support â€“      CORS.</li>
<li>Service Provider Interfaces (SPI) â€“   SPI,      :  ,  ,     .</li>
<li>   JavaScript applications, WildFly, JBoss EAP, Fuse, Tomcat, Jetty, Spring.</li>
<li>    ,  OpenID Connect Relying Party library  SAML 2.0 Service Provider Library.</li>
<li>    plugins.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk proses CI / CD, serta otomatisasi proses manajemen di Keycloak, REST API / JAVA API dapat digunakan. </font><font style="vertical-align: inherit;">Dokumentasi tersedia dalam bentuk elektronik: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
REST API </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.keycloak.org/docs-api/8.0/rest-api/index.html</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
API JAVA </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.keycloak.org/docs-api/8.0/javadocs /index.html</font></font></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penyedia Identitas Perusahaan (Di Lokasi)</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemampuan untuk mengotentikasi pengguna melalui layanan Federasi Pengguna. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8j/s9/cl/8js9cl3cx9whnsshxcel0xynpqs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otentikasi pass-through juga dapat digunakan - jika pengguna mengotentikasi di workstation dengan Kerberos (LDAP atau AD), maka mereka dapat diautentikasi secara otomatis pada Keycloak tanpa harus memberikan nama pengguna dan kata sandi mereka lagi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk otentikasi dan otorisasi lebih lanjut dari pengguna, dimungkinkan untuk menggunakan DBMS relasional, yang paling berlaku untuk lingkungan pengembangan, karena tidak memerlukan pengaturan jangka panjang dan integrasi dalam tahap awal proyek. Secara default, Keycloak menggunakan DBMS bawaan untuk menyimpan pengaturan dan data pengguna.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daftar DBMS yang didukung sangat luas dan mencakup: MS SQL, Oracle, PostgreSQL, MariaDB, Oracle, dan lainnya. </font><font style="vertical-align: inherit;">Yang paling diuji saat ini adalah Oracle 12C Release1 RAC dan cluster Galera 3.12 untuk MariaDB 10.1.19.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penyedia Identitas - login sosial </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dimungkinkan untuk menggunakan login dari jejaring sosial. </font><font style="vertical-align: inherit;">Untuk mengaktifkan kemampuan untuk mengotentikasi pengguna, konsol admin Keycloack digunakan. </font><font style="vertical-align: inherit;">Perubahan dalam kode aplikasi tidak diperlukan dan fungsi ini tersedia "di luar kotak" dan dapat diaktifkan pada setiap tahap proyek. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bs/rj/vp/bsrjvpxnw7eojom-_bv816iwoxk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengotentikasi pengguna, dimungkinkan untuk menggunakan penyedia Identitas OpenID / SAML.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skenario Otorisasi Khas Menggunakan OAuth2 di Keycloak</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alur Kode Otorisasi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - digunakan dengan aplikasi sisi server. Salah satu jenis izin otorisasi yang paling umum, karena sangat cocok untuk aplikasi server di mana kode sumber aplikasi dan data klien tidak dapat diakses oleh orang luar. Proses dalam hal ini didasarkan pada pengalihan. Aplikasi harus dapat berinteraksi dengan agen pengguna (agen-pengguna), seperti browser web - untuk menerima kode otorisasi API yang dialihkan melalui agen pengguna. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implisit Flow</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - digunakan oleh aplikasi seluler atau web (aplikasi yang berjalan di perangkat pengguna).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jenis izin otorisasi implisit digunakan oleh aplikasi seluler dan web di mana privasi klien tidak dapat dijamin. </font><font style="vertical-align: inherit;">Jenis izin implisit juga menggunakan pengalihan agen pengguna, dan token akses diteruskan ke agen pengguna untuk digunakan lebih lanjut dalam aplikasi. </font><font style="vertical-align: inherit;">Ini membuat token tersedia untuk pengguna dan aplikasi lain di perangkat pengguna. </font><font style="vertical-align: inherit;">Dengan jenis izin otorisasi ini, aplikasi tidak diautentikasi, dan prosesnya sendiri bergantung pada URL pengalihan (sebelumnya terdaftar dalam layanan).</font></font><br>
<br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aliran Tersirat tidak mendukung token penyegaran.
</font></font></oembed><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alur Hibah Kredensial Klien</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - digunakan ketika aplikasi mengakses API. </font><font style="vertical-align: inherit;">Jenis izin otorisasi ini biasanya digunakan untuk interaksi server-ke-server yang harus berjalan di latar belakang tanpa interaksi pengguna langsung. </font><font style="vertical-align: inherit;">Alur kredensial klien memungkinkan layanan web (klien rahasia) untuk menggunakan kredensial sendiri alih-alih menyamar sebagai pengguna untuk otentikasi ketika memanggil layanan web lain. </font><font style="vertical-align: inherit;">Untuk tingkat keamanan yang lebih tinggi, dimungkinkan bagi layanan panggilan untuk menggunakan sertifikat (alih-alih rahasia bersama) sebagai kredensial. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Spesifikasi OAuth2 dijelaskan dalam </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC-6749 </font></font></a> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC-8252 </font></font></a> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC-6819</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Token JWT dan kelebihannya</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JWT (JSON Web Token) adalah standar terbuka ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://tools.ietf.org/html/rfc7519</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) yang mendefinisikan metode yang ringkas dan mandiri untuk mentransfer informasi antara pihak-pihak dengan aman sebagai objek JSON. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menurut standar, token terdiri dari tiga bagian dalam format basis-64, dipisahkan oleh titik-titik. </font><font style="vertical-align: inherit;">Bagian pertama disebut header, yang berisi jenis token dan nama algoritma hash untuk mendapatkan tanda tangan digital. </font><font style="vertical-align: inherit;">Bagian kedua menyimpan informasi dasar (pengguna, atribut, dll.). </font><font style="vertical-align: inherit;">Bagian ketiga adalah tanda tangan digital.</font></font><br>
<br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;header yang disandikan&gt;. &lt;payload yang disandikan&gt;. &lt;signature&gt;</font></font></oembed><br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jangan pernah menyimpan token di basis data Anda. </font><font style="vertical-align: inherit;">Karena token yang valid setara dengan kata sandi, menyimpan token sama seperti menyimpan kata sandi dalam teks yang jelas.</font></font></oembed><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Token akses</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah token yang memberikan pemiliknya akses ke sumber daya server yang dilindungi. </font><font style="vertical-align: inherit;">Biasanya memiliki umur yang pendek dan dapat membawa informasi tambahan, seperti alamat IP pihak yang meminta token ini. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Token penyegaran</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah token yang memungkinkan klien untuk meminta token akses baru setelah masa pakainya berakhir. </font><font style="vertical-align: inherit;">Token ini biasanya dikeluarkan untuk waktu yang lama. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Keuntungan utama aplikasi dalam arsitektur layanan mikro:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kemampuan untuk mengakses berbagai aplikasi dan layanan melalui otentikasi satu kali.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dengan tidak adanya sejumlah atribut yang diperlukan dalam profil pengguna, dimungkinkan untuk memperkaya dengan data yang dapat ditambahkan ke muatan, termasuk otomatis dan on-the-fly.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tidak perlu menyimpan informasi tentang sesi aktif, aplikasi server hanya harus memverifikasi tanda tangan.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kontrol akses yang lebih fleksibel dengan atribut tambahan dalam payload.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menggunakan tanda tangan token untuk header dan payload meningkatkan keamanan solusi secara keseluruhan.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Token JWT - Komposisi</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Header</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - secara default, header hanya berisi jenis token dan algoritma yang digunakan untuk enkripsi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jenis token disimpan di kunci "ketik". </font><font style="vertical-align: inherit;">Kunci "ketik" diabaikan di JWT. </font><font style="vertical-align: inherit;">Jika tombol ketik ada, nilainya harus JWT untuk menunjukkan bahwa objek ini adalah Token Web JSON. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kunci alg kedua mendefinisikan algoritma yang digunakan untuk mengenkripsi token. </font><font style="vertical-align: inherit;">Secara default, ini harus diatur ke HS256. </font><font style="vertical-align: inherit;">Header dikodekan dalam base64.</font></font><br>
<br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{"alg": "HS256", "typ": "JWT"}</font></font></oembed><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Payload (konten)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - payload menyimpan informasi apa pun yang perlu diverifikasi. </font><font style="vertical-align: inherit;">Setiap kunci dalam muatan dikenal sebagai "pernyataan". </font><font style="vertical-align: inherit;">Misalnya, aplikasi hanya dapat dimasukkan melalui undangan (promo tertutup). </font><font style="vertical-align: inherit;">Ketika kami ingin mengundang seseorang untuk berpartisipasi, kami mengiriminya surat undangan. </font><font style="vertical-align: inherit;">Penting untuk memverifikasi bahwa alamat email itu milik orang yang menerima undangan, jadi kami akan memasukkan alamat ini dalam payload, untuk ini kami akan menyimpannya di kunci â€œe-mailâ€</font></font><br>
<br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{"email": "example@x5.ru"}
</font></font></oembed><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kunci dalam payload bisa sewenang-wenang. </font><font style="vertical-align: inherit;">Namun, ada beberapa yang dipesan:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iss (Issuer) - mendefinisikan aplikasi dari mana token dikirim.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sub (Subjek) - mendefinisikan topik token.</font></font></li>
<li>aud (Audience) â€“       URI,     .     JWT   ,        â€”   .</li>
<li>exp (Expiration Time) â€” ,     .  JWT ,           . Exp       unix .</li>
<li>nbf (Not Before) â€”    unix ,  ,    .</li>
<li>iat (Issued At) â€”     ,            JWT. iat       unix .</li>
<li>Jti (JWT ID) â€” ,      c  .</li>
</ul><br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penting untuk dipahami bahwa muatan tidak ditransmisikan dalam bentuk terenkripsi (meskipun token dapat disematkan dan kemudian dimungkinkan untuk mengirimkan data terenkripsi). </font><font style="vertical-align: inherit;">Karena itu, tidak mungkin menyimpan informasi rahasia di dalamnya. </font><font style="vertical-align: inherit;">Seperti tajuk, payload dikodekan dalam base64.</font></font></oembed><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tanda tangan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - saat kami memiliki tajuk dan muatan, kami dapat menghitung tanda tangan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Base64 disandikan: header dan payload diambil, mereka digabungkan menjadi garis melalui titik. </font><font style="vertical-align: inherit;">Kemudian baris ini dan kunci rahasia dikirim ke input dari algoritma enkripsi yang ditentukan dalam header (kunci "alg"). </font><font style="vertical-align: inherit;">Kuncinya bisa berupa string apa saja. </font><font style="vertical-align: inherit;">String yang lebih panjang akan lebih disukai, karena akan membutuhkan lebih banyak waktu untuk mencocokkan.</font></font><br>
<br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{"alg": "RSA1_5", "payload": "A128CBC-HS256"}</font></font></oembed><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arsitektur Cluster Keailloak Failover</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat menggunakan satu kluster untuk semua proyek, ada peningkatan persyaratan untuk solusi untuk SSO. Ketika jumlah proyek kecil, persyaratan ini tidak begitu terlihat untuk semua proyek, tetapi dengan peningkatan jumlah pengguna dan integrasi, persyaratan untuk ketersediaan dan peningkatan produktivitas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meningkatkan risiko kegagalan SSO tunggal meningkatkan persyaratan untuk arsitektur solusi dan metode yang digunakan untuk redundansi komponen dan mengarah ke SLA yang sangat ketat. Dalam hal ini, lebih sering ketika mengembangkan atau pada tahap awal implementasi solusi, proyek memiliki infrastruktur sendiri yang tahan terhadap kesalahan. Saat Anda berkembang, Anda perlu meletakkan kemungkinan pengembangan dan penskalaan. Yang paling fleksibel adalah membangun kluster failover menggunakan virtualisasi wadah atau pendekatan hibrida.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk bekerja dalam kluster Aktif / Aktif dan Aktif / Pasif, diperlukan untuk memastikan konsistensi data dalam basis data relasional - kedua simpul basis data harus direplikasi secara serempak antara berbagai pusat data yang didistribusikan secara geografis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Contoh paling sederhana dari instalasi gagal-aman. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xo/tw/7w/xotw7wkifwb3h6nnclvnjbbe72c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa manfaat menggunakan satu kluster:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ketersediaan dan kinerja tinggi.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dukungan untuk mode operasi: Aktif / Aktif, Aktif / Pasif.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kemampuan untuk secara dinamis mengukur - saat menggunakan virtualisasi wadah.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kemungkinan manajemen dan pemantauan terpusat.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pendekatan terpadu untuk identifikasi / otentikasi / otorisasi pengguna dalam proyek.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interaksi yang lebih transparan antara berbagai proyek tanpa partisipasi pengguna.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kemampuan untuk menggunakan kembali token JWT di berbagai proyek.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Satu titik kepercayaan.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peluncuran proyek yang lebih cepat menggunakan microservices / virtualisasi wadah (tidak perlu menaikkan dan mengkonfigurasi komponen tambahan).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mungkin perolehan dukungan komersial dari vendor. </font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hal-hal yang perlu dipertimbangkan ketika merencanakan sebuah cluster</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBMS</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Keycloak menggunakan sistem manajemen DBMS untuk menyimpan: ranah, klien, pengguna, dll </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
. Berbagai DBMS didukung: MS SQL, Oracle, MySQL, PostgreSQL. </font><font style="vertical-align: inherit;">Keycloak dilengkapi dengan basis data relasional bawaan. </font><font style="vertical-align: inherit;">Dianjurkan untuk menggunakan lingkungan yang tidak dimuat seperti lingkungan pengembangan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk beroperasi dalam kluster Aktif / Aktif dan Aktif / Pasif, diperlukan untuk memastikan konsistensi data dalam basis data relasional, dan kedua node dari kluster basis data direplikasi secara serempak antara pusat data.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cache Terdistribusi (Infinspan)</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agar kluster berfungsi dengan benar, diperlukan sinkronisasi tambahan dari tipe cache berikut menggunakan JBoss Data Grid: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sesi otentikasi - digunakan untuk menyimpan data selama autentikasi pengguna tertentu. </font><font style="vertical-align: inherit;">Permintaan dari cache ini biasanya hanya menyertakan browser dan server Keycloak, bukan aplikasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Token tindakan - digunakan untuk skenario saat pengguna perlu mengonfirmasi tindakan secara tidak sinkron (melalui email). </font><font style="vertical-align: inherit;">Misalnya, selama aliran lupa kata sandi, cache Infinispan actionTokens digunakan untuk melacak metadata tentang penanda tindakan terkait yang telah digunakan, sehingga tidak dapat digunakan kembali.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Caching dan pembatalan data persisten - digunakan untuk men-cache data persisten untuk menghindari permintaan basis data yang tidak perlu. </font><font style="vertical-align: inherit;">Ketika server Keycloak memperbarui data, semua server Keycloak lainnya di semua pusat data harus mengetahui hal ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bekerja - digunakan hanya untuk mengirim pesan yang tidak valid antara node cluster dan pusat data. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sesi pengguna - digunakan untuk menyimpan data tentang sesi pengguna yang valid untuk sesi browser pengguna. </font><font style="vertical-align: inherit;">Cache harus menangani permintaan HTTP dari pengguna akhir dan aplikasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Brute force protection - digunakan untuk melacak data login yang gagal.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penyeimbang beban</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Load balancer adalah titik masuk tunggal keycloak dan harus mendukung sesi lengket. </font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Server aplikasi</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mereka digunakan untuk mengontrol interaksi komponen di antara mereka sendiri dan dapat divirtualisasi atau kemas menggunakan alat otomasi yang ada dan secara dinamis meningkatkan alat otomasi infrastruktur. </font><font style="vertical-align: inherit;">Skenario penyebaran yang paling umum di OpenShift, Kubernetes, Rancher. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentang ini, bagian pertama - teoretis - telah berakhir. </font><font style="vertical-align: inherit;">Dalam seri artikel berikut, contoh integrasi dengan berbagai penyedia identifikasi dan contoh konfigurasi akan dibahas.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id486764/index.html">Do-it-yourself Schema.org: menyesuaikan tata letak mikro tanpa pemrogram</a></li>
<li><a href="../id486766/index.html">Bagaimana cara mentransfer semua transaksi online di pasar anjak kuno? Pengalaman Anberbank Anjak</a></li>
<li><a href="../id486768/index.html">Revisi panel admin Webasyst</a></li>
<li><a href="../id486772/index.html">Bakar, tapi jangan terbakar - bakar untuk bersinar</a></li>
<li><a href="../id486776/index.html">Penyelesaian kode dan ketikkan boto3</a></li>
<li><a href="../id486780/index.html">Pengembangan frontend di perusahaan: apa itu dan bagaimana membuatnya efektif</a></li>
<li><a href="../id486782/index.html">UI / UX - desain. Tren dan perkiraan untuk tahun 2020</a></li>
<li><a href="../id486784/index.html">Lumiere bersaudara tidak pernah bermimpi</a></li>
<li><a href="../id486788/index.html">Webinar â€œPemantauan jarak jauh dan diagnostik peralatan. Studi Kasus Solusi Winnum CNC Â»</a></li>
<li><a href="../id486790/index.html">Dan lagi Qbot - strain baru Trojan perbankan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>