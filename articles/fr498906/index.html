<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õπüèø ‚òùüèø üíØ Comment nous avons aid√© les √©coles √† passer √† l'enseignement √† distance et √† faire face √† la charge üë®üèª‚Äç‚öñÔ∏è ‚ôàÔ∏è ‚õîÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr! Je m‚Äôappelle Alexey Vakhov, je suis le directeur technique d‚ÄôUchi.ru. √Ä la mi-mars, lorsque les √©coles ont commenc√© √† passer √† l'enseig...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Comment nous avons aid√© les √©coles √† passer √† l'enseignement √† distance et √† faire face √† la charge</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/uchi_ru/blog/498906/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonjour, Habr! Je m‚Äôappelle Alexey Vakhov, je suis le directeur technique d‚ÄôUchi.ru. √Ä la mi-mars, lorsque les √©coles ont commenc√© √† passer √† l'enseignement √† distance, nous avons fourni aux enseignants et aux √©l√®ves plusieurs services pour les cours en ligne. Selon nos calculs, nous avions une marge de s√©curit√© pour supporter un maximum de 1,5 √† 2 fois la charge. √Ä la mi-avril, notre trafic a augment√© 8 fois. J'ai d√ª faire beaucoup pour rester √† flot. Peut-√™tre que quelqu'un aura besoin de notre exp√©rience pour survivre √† cette crise ou √† une crise future.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous ne nous attendions pas √† de telles surprises et nous n'√©tions pas pr√™ts pour elles, probablement pas une seule entreprise en Russie, ni dans le monde, n'√©tait pr√™te pour cela. Habituellement, en mars, l'activit√© sur Uchi.ru est plus faible par rapport √† l'automne en raison du printemps et des vacances d'√©t√© √† venir, p√©riode √† laquelle nous nous pr√©parons d√©j√† pour septembre: nous scions des √©l√©ments, faisons du refactoring, effectuons des changements architecturaux √† grande √©chelle et faisons une autre routine agr√©able. Mais cette fois, c'√©tait diff√©rent. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le nombre maximal d'utilisateurs uniques sur le site a atteint √† la fois 240 000, nous avons enregistr√© le maximum pr√©c√©dent de l'ann√©e scolaire en cours sur 30 000 personnes. √Ä ce stade, la charge a augment√© chaque jour et nous avons travaill√© sans rel√¢che pour stabiliser le site.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsqu'une telle charge tombe sur le site, en r√®gle g√©n√©rale, les applications, les services, les √©quilibreurs, les bases, le Web, les canaux sont form√©s. </font><font style="vertical-align: inherit;">Tous les ¬´goulots d'√©tranglement¬ª de l'infrastructure sont expos√©s. </font><font style="vertical-align: inherit;">Dans de telles conditions, il est difficile de diagnostiquer les probl√®mes - symptomatiquement, tout est bugg√©. </font><font style="vertical-align: inherit;">Il est facile √† r√©parer lorsque le trafic augmente en douceur et qu'une chose tombe en panne. </font><font style="vertical-align: inherit;">Lorsque la charge passe en rafale, l'un des gros probl√®mes est de comprendre les causes des pannes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La strat√©gie pour travailler dans de telles conditions est d'√©liminer ce qui frappe le plus le site, puis de trouver le prochain point le plus douloureux, en m√™me temps de rechercher les probl√®mes potentiels et de les r√©soudre, etc. </font><font style="vertical-align: inherit;">Voici quelques-unes des choses les plus notables que nous avons faites pour stabiliser la plate-forme.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comptez sur vous-m√™me</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors d'une crise avant la circulation, vous en tant qu'√©quipe devenez un. Cela d√©pendra de vos employ√©s, que vous trouviez des solutions, que vous affrontiez la crise ou non. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y a personne dans l'industrie qui viendrait, examinerait votre syst√®me complexe, ferait imm√©diatement quelque chose et tout irait bien. Bien s√ªr, dans le monde, il y a suffisamment de sp√©cialistes qui pourront faire face √† la t√¢che si le temps le permet. Mais lorsqu'une solution fondamentale est n√©cessaire d√®s maintenant, vous ne pouvez compter que sur votre √©quipe, qui conna√Æt le syst√®me et ses sp√©cificit√©s. Le r√©sultat et la responsabilit√© de l'entreprise incombent √† l'√©quipe. Un examen externe est conseill√© pour se connecter en point.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La coordination op√©rationnelle de l'√©quipe anti-crise dans une conversation sp√©ciale √† Slack nous a aid√©s √† naviguer rapidement et √† construire du travail - tous les probl√®mes ont √©t√© r√©solus ici et maintenant. </font><font style="vertical-align: inherit;">Nous avons divis√© les domaines de responsabilit√© entre les employ√©s afin qu'il n'y ait pas d'intersections et que les gars ne fassent pas un double travail. </font><font style="vertical-align: inherit;">Les jours les plus difficiles, je devais √™tre en contact litt√©ralement 24 heures sur 24.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloud √©tendu</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous ne pouvez pas vous assurer contre toutes les crises, mais il est important d'√™tre flexible. </font><font style="vertical-align: inherit;">La pile de nuages ‚Äã‚Äãnous a donn√© une telle plasticit√© et une chance de rester √† flot m√™me avec une augmentation aussi spectaculaire de la charge. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au d√©part, nous avons augment√© les ressources sous la charge accrue, mais √† un moment donn√©, nous avons rencontr√© les quotas de la r√©gion de notre fournisseur de cloud. </font><font style="vertical-align: inherit;">Des probl√®mes se sont pos√©s √† son niveau: nos serveurs virtuels ont √©t√© affect√©s par des voisins, sur lesquels le trafic a √©galement augment√©, ce qui a provoqu√© des d√©faillances dans le fonctionnement de nos applications. </font><font style="vertical-align: inherit;">Cela √©tait attendu: nous d√©pendons du fournisseur et de son infrastructure, qui √† son tour a √©galement connu une charge √©lev√©e. </font><font style="vertical-align: inherit;">Nous avons publi√© certaines ressources provenant de machines virtuelles non prioritaires pour le site principal. </font><font style="vertical-align: inherit;">Avec le fournisseur, nous nous sommes mis d'accord sur une ressource d√©di√©e.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outils de surveillance am√©lior√©s</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant la crise, alert n'a pas r√©ellement rempli sa fonction. </font><font style="vertical-align: inherit;">Tous les membres de l'√©quipe surveillaient d√©j√† tous les syst√®mes 24 heures sur 24 et la gestion des incidents a √©t√© r√©duite √† un travail constant sur tous les fronts. </font><font style="vertical-align: inherit;">Pour diagnostiquer pleinement les probl√®mes que nous avons rencontr√©s, nous avions trop peu de donn√©es. </font><font style="vertical-align: inherit;">Par exemple, pour surveiller les machines virtuelles, nous utilisons l'exportateur de n≈ìuds standard pour Prometheus. </font><font style="vertical-align: inherit;">Il est bon de voir la situation dans son ensemble, pour regarder de plus pr√®s une seule machine virtuelle a commenc√© √† utiliser NetData.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stockage de cache optimis√©</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un probl√®me s'est √©galement pos√© avec les magasins de valeurs-cl√©s. </font><font style="vertical-align: inherit;">Dans l'une des applications, Redis ne pouvait pas faire face - en une seule copie, il ne pouvait fonctionner que sur un seul c≈ìur. </font><font style="vertical-align: inherit;">Par cons√©quent, ils ont utilis√© un fork Redis appel√© KeyDB, qui peut fonctionner dans plusieurs threads. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour augmenter la bande passante dans une autre application, nous avons lev√© 10 Redis'ov ind√©pendants. </font><font style="vertical-align: inherit;">Ils sont mandat√©s par notre Service Mesh, qui partage √©galement des cl√©s. </font><font style="vertical-align: inherit;">M√™me si un ou deux Redis plantent, cela ne causera pas de probl√®mes en raison d'un hachage coh√©rent. </font><font style="vertical-align: inherit;">De plus, ils n'ont pratiquement pas besoin d'√™tre administr√©s.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extension du r√©seau</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous le savez, 640 Ko suffisent √† tout le monde. </font><font style="vertical-align: inherit;">Nous avons toujours utilis√© des sous-r√©seaux priv√©s / 24, mais dans le contexte de la quarantaine, nous avons d√ª nous √©tendre d'urgence √† / 22. </font><font style="vertical-align: inherit;">Maintenant que le r√©seau h√©berge quatre fois plus de serveurs, nous esp√©rons que cela suffira √† coup s√ªr.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PgBouncer r√©alis√© s√©par√©ment</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En tant que base de donn√©es relationnelle, nous utilisons PostgreSQL partout, quelque part dans de petites instances virtuelles et quelque part - l'installation de plusieurs grands serveurs d√©di√©s pour le ma√Ætre et les r√©pliques. Le goulot d'√©tranglement √©vident de cette architecture est le ma√Ætre qui, dans le cas id√©al, n'est utilis√© que pour l'enregistrement et n'est pas mis √† l'√©chelle horizontalement. Avec la croissance du trafic, nous avons commenc√© √† nous reposer sur le CPU.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le m√™me temps, nous utilisons PgBouncer, qui a √©t√© install√© sur l'assistant et sur chaque r√©plique, pour g√©rer les connexions. </font><font style="vertical-align: inherit;">Sur un port, il ne peut pas utiliser plus d'un c≈ìur de processeur, donc sur chaque serveur, nous avions plusieurs videurs. </font><font style="vertical-align: inherit;">√Ä un moment donn√©, il est devenu clair que PgBouncer lui-m√™me a retir√© la partie tangible du CPU de la base, et √† la charge maximale, nous avons connu une augmentation rapide de la moyenne de charge et une baisse des performances du syst√®me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons d√©plac√© les videurs vers un serveur distinct, ce qui nous a permis d'√©conomiser 20 √† 25% du processeur sur chaque serveur de base de donn√©es.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Face aux surprises</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un seul outil n'est pas fiable, surtout en temps de crise. Au contraire, la redondance des outils est utile, car elle permet de voir une image plus objective. Les outils familiers commencent √† √©chouer pour diverses raisons. Par exemple, g√©n√©ralement pour estimer le nombre de personnes sur un site, nous utilisons g√©n√©ralement un rapport Google Analytics en temps r√©el, il s'agit d'une mesure sensible et pr√©cise. Mais parfois, c'est bugg√© et cette fois, nous avons d√ª examiner des mesures internes comme le nombre d'√©v√©nements de consultation de page et le nombre de demandes par seconde.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour la journalisation centralis√©e, nous utilisons ELK. </font><font style="vertical-align: inherit;">Notre pipeline de livraison de journaux est bas√© sur Apache Kafka et Elastic Filebeat. </font><font style="vertical-align: inherit;">Sous une charge √©lev√©e, le convoyeur de livraison de journaux a cess√© de fonctionner, les journaux ont commenc√© √† se perdre ou √† prendre du retard. </font><font style="vertical-align: inherit;">Nous avons augment√© la vitesse de transfert des journaux et l'indexation du stockage en manipulant les index Elasticsearch, en augmentant le nombre de partitions dans Kafka et Filebeat et en optimisant la compression √† toutes les √©tapes. </font><font style="vertical-align: inherit;">√âtant donn√© que le pipeline de collecte des journaux est distinct de la production, les probl√®mes li√©s √† l'augmentation du trafic vers les journaux n'ont eu aucun effet sur le fonctionnement du site.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accept√© les r√®gles du jeu</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est impossible de se pr√©parer √† l'avance √† chaque crise, mais vous pouvez d'abord essayer de construire un syst√®me flexible. </font><font style="vertical-align: inherit;">Startups ou entreprises qui cessent progressivement d'√™tre des startups, dans un temps calme, il n'est pas toujours rationnel de se pr√©parer √† une croissance anormale du trafic: les ressources de l'√©quipe sont limit√©es. </font><font style="vertical-align: inherit;">Si nous mettons de c√¥t√© leur pr√©paration pour quelque chose qui ne se produira peut-√™tre jamais, il n'y aura plus de force pour le produit principal. </font><font style="vertical-align: inherit;">Il est beaucoup plus important de r√©agir correctement sur le moment et de ne pas avoir peur des d√©cisions audacieuses. </font><font style="vertical-align: inherit;">En r√®gle g√©n√©rale, la sortie de leur crise est une sortie vers un niveau qualitativement nouveau. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un printemps si amusant cette ann√©e. </font><font style="vertical-align: inherit;">Quand il semble que tout a √©t√© fait, il s'av√®re parfois que ce n'est que le d√©but.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr498892/index.html">La derni√®re r√©vision de l'API Renga</a></li>
<li><a href="../fr498894/index.html">Vol normal</a></li>
<li><a href="../fr498898/index.html">R√©seaux de neurones pour enfants: expliquez le plus simplement possible</a></li>
<li><a href="../fr498900/index.html">Rosbank Java-school - r√©sultats d'apprentissage</a></li>
<li><a href="../fr498904/index.html">Ajout de l'informatique parall√®le aux pandas</a></li>
<li><a href="../fr498910/index.html">Astronautique commerciale - mythes et r√©alit√©</a></li>
<li><a href="../fr498912/index.html">Section anti-crise de Habr</a></li>
<li><a href="../fr498914/index.html">Croissance de l'IA - Algorithmes g√©n√©tiques: une introduction</a></li>
<li><a href="../fr498918/index.html">Votre d√©claration est 100% correcte, ne manque que le point</a></li>
<li><a href="../fr498920/index.html">Syst√®mes de paiement. Comp√©tition d'armure et d'obus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>