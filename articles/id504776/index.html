<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘— ğŸ¦ ğŸï¸ Menulis mesin gim di tahun pertama Anda: mudah! (Hampir) ğŸ˜· ğŸ™ï¸ â™ˆï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo! Nama saya Gleb Maryin, tahun pertama saya sarjana "Matematika Terapan dan Ilmu Komputer" di St. Petersburg HSE. Pada semester kedua, semua mahas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Menulis mesin gim di tahun pertama Anda: mudah! (Hampir)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/hsespb/blog/504776/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo! </font><font style="vertical-align: inherit;">Nama saya Gleb Maryin, tahun pertama saya sarjana "Matematika Terapan dan Ilmu Komputer" di St. Petersburg HSE. </font><font style="vertical-align: inherit;">Pada semester kedua, semua mahasiswa baru di program kami membuat proyek tim dalam C ++. </font><font style="vertical-align: inherit;">Rekan satu tim saya dan saya memutuskan untuk menulis mesin permainan.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baca apa yang kita dapat di bawah kucing.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/10e/b22/0c4/10eb220c409aac5feac61a2164b42886.gif"></div><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada tiga dari kita di tim: saya, Alexei Luchinin dan Ilya Onofriychuk. </font><font style="vertical-align: inherit;">Tidak ada dari kita yang ahli dalam pengembangan game, apalagi dalam menciptakan mesin game. </font><font style="vertical-align: inherit;">Ini adalah proyek besar pertama bagi kami: sebelum itu, kami hanya mengerjakan pekerjaan rumah dan laboratorium, jadi tidak mungkin para profesional di bidang komputer grafis akan menemukan informasi baru untuk diri mereka sendiri di sini. </font><font style="vertical-align: inherit;">Kami akan senang jika ide-ide kami membantu mereka yang juga ingin membuat mesin mereka sendiri. </font><font style="vertical-align: inherit;">Tetapi topik ini kompleks dan beragam, dan artikel ini sama sekali tidak mengklaim sebagai literatur khusus yang lengkap. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua orang yang tertarik mempelajari implementasi kami - selamat membaca!</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seni grafis</font></font></h1><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jendela pertama, mouse dan keyboard</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk membuat windows, menangani input mouse dan keyboard, kami memilih perpustakaan SDL2. </font><font style="vertical-align: inherit;">Itu pilihan acak, tapi sejauh ini kami belum menyesalinya.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penting pada tahap pertama untuk menulis pembungkus yang nyaman di atas perpustakaan sehingga Anda dapat membuat jendela dengan beberapa baris, melakukan manipulasi dengannya seperti menggerakkan kursor dan memasuki mode layar penuh dan menangani acara: penekanan tombol, gerakan kursor. </font><font style="vertical-align: inherit;">Tugasnya tidak sulit: kami dengan cepat membuat program yang tahu cara menutup dan membuka jendela, dan ketika Anda mengklik PCM, tampilkan "Halo, Dunia!".&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemudian siklus permainan utama muncul:</font></font><br>
<br>
<pre><code class="cpp hljs">Event ev;
<span class="hljs-keyword">bool</span> running = <span class="hljs-literal">true</span>;
<span class="hljs-keyword">while</span> (running):<font></font>
	ev = pullEvent();<font></font>
	<span class="hljs-keyword">for</span> handler in handlers[ev.type]:<font></font>
		handler.handleEvent(ev);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap pengendali acara terlampir - </font></font><code>handlers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mis </font></font><code>handlers[QUIT] = {QuitHandler()}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Tugas mereka adalah menangani acara terkait. </font></font><code>QuitHandler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam contoh, itu akan mengekspos </font></font><code>running = false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, sehingga menghentikan permainan.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo Dunia</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menggambar di mesin kami gunakan </font></font><code>OpenGL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Yang pertama </font></font><code>Hello World</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, seperti yang saya pikirkan, dalam banyak proyek, adalah kotak putih dengan latar belakang hitam:&nbsp;</font></font><br>
<br>
<pre><code class="cpp hljs">glBegin(GL_QUADS);<font></font>
glVertex2f(<span class="hljs-number">-1.0f</span>, <span class="hljs-number">1.0f</span>);<font></font>
glVertex2f(<span class="hljs-number">1.0f</span>, <span class="hljs-number">1.0f</span>);<font></font>
glVertex2f(<span class="hljs-number">1.0f</span>, <span class="hljs-number">-1.0f</span>);<font></font>
glVertex2f(<span class="hljs-number">-1.0f</span>, <span class="hljs-number">-1.0f</span>);<font></font>
glEnd();</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/612/ed8/fbe/612ed8fbe433abd35b12b59e72aac0c7.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemudian kami belajar cara menggambar poligon dua dimensi dan melakukan angka-angka dalam kelas yang terpisah </font></font><code>GraphicalObject2d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, yang dapat berputar dengan </font></font><code>glRotate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, bergerak dengan </font></font><code>glTranslate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan meregangkan </font></font><code>glScale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Kami mengatur warna dalam empat saluran menggunakan </font></font><code>glColor4f(r, g, b, a)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan fungsi ini, Anda sudah dapat membuat air mancur kotak yang indah. </font><font style="vertical-align: inherit;">Buat kelas </font></font><code>ParticleSystem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang memiliki array objek. </font><font style="vertical-align: inherit;">Setiap iterasi dari loop utama, sistem partikel memperbarui kuadrat lama dan mengumpulkan beberapa yang baru yang dimulai dalam arah acak:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/10e/b22/0c4/10eb220c409aac5feac61a2164b42886.gif"></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kamera</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Langkah selanjutnya adalah menulis kamera yang bisa bergerak dan melihat ke arah yang berbeda. </font><font style="vertical-align: inherit;">Untuk memahami bagaimana mengatasi masalah ini, kami membutuhkan pengetahuan dari aljabar linier. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika ini tidak terlalu menarik bagi Anda, Anda dapat melewati bagian ini, lihat gif, dan baca terus</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami ingin menggambar titik pada koordinat layar, mengetahui koordinatnya relatif terhadap pusat objek yang dimilikinya.</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pertama, kita perlu menemukan koordinatnya relatif terhadap pusat dunia tempat objek itu berada.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kemudian, mengetahui koordinat dan lokasi kamera, cari posisi titik di dasar kamera.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kemudian proyeksikan verteks ke bidang layar.&nbsp;</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang Anda lihat, ada tiga tahap. </font><font style="vertical-align: inherit;">Perkalian dengan tiga matriks sesuai dengan mereka. </font><font style="vertical-align: inherit;">Kami menyebut matriks ini </font></font><code>Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan </font></font><code>Projection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita mulai dengan mendapatkan koordinat objek di dasar dunia. </font><font style="vertical-align: inherit;">Tiga transformasi dapat dilakukan dengan objek: skala, memutar, dan bergerak. </font><font style="vertical-align: inherit;">Semua operasi ini ditentukan dengan mengalikan vektor asli (koordinat dalam dasar objek) dengan matriks yang sesuai. </font><font style="vertical-align: inherit;">Maka matriks </font></font><code>Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">akan terlihat seperti ini:&nbsp;</font></font><br>
<br>
<pre><code class="cpp hljs">Model = Translate * Scale * Rotate. 
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, mengetahui posisi kamera, kami ingin menentukan koordinat dalam dasarnya: kalikan koordinat yang sebelumnya diperoleh dengan matriks </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Di C ++, ini mudah dihitung menggunakan fungsi:</font></font><br>
<br>
<pre><code class="cpp hljs">
glm::mat4 View = glm::lookAt(cameraPosition, objectPosition, up);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara harfiah: lihat </font></font><code>objectPosition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dari suatu posisi </font></font><code>cameraPosition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dan arah ke atas adalah "ke atas". Mengapa arahan ini perlu? Bayangkan memotret teko. Anda mengarahkan kamera kepadanya dan menempatkan ketel di bingkai. Pada titik ini, Anda dapat mengatakan dengan tepat di mana bingkai berada di bagian atas (kemungkinan besar di mana ketel memiliki penutup). Program tidak dapat menemukan bagi kita bagaimana mengatur frame, dan itulah sebabnya vektor "atas" harus ditentukan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami mendapat koordinat di dasar kamera, masih memproyeksikan koordinat yang diperoleh di bidang kamera. Matriks terlibat dalam hal ini </font></font><code>Projection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, yang menciptakan efek mengurangi objek ketika dihapus dari kita.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mendapatkan koordinat titik pada layar, Anda perlu mengalikan vektor dengan matriks setidaknya lima kali. </font><font style="vertical-align: inherit;">Semua matriks memiliki ukuran 4 oleh 4, jadi Anda harus melakukan beberapa operasi multiplikasi. </font><font style="vertical-align: inherit;">Kami tidak ingin memuat inti prosesor dengan banyak tugas sederhana. </font><font style="vertical-align: inherit;">Untuk ini, kartu video yang memiliki sumber daya yang diperlukan lebih baik. </font><font style="vertical-align: inherit;">Jadi, Anda perlu menulis shader: instruksi kecil untuk kartu video. </font><font style="vertical-align: inherit;">OpenGL memiliki bahasa shader GLSL khusus, mirip dengan C, yang akan membantu kami melakukan ini. </font><font style="vertical-align: inherit;">Mari kita tidak membahas detail penulisan shader, lebih baik akhirnya melihat apa yang terjadi:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6c0/9f3/3cd/6c09f33cd1fb76ea4446b1c4a79f056a.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penjelasan: Ada sepuluh kotak yang berjarak pendek di belakang satu sama lain. </font><font style="vertical-align: inherit;">Di sisi kanan mereka adalah pemain yang memutar dan menggerakkan kamera.&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fisika</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa itu permainan tanpa fisika? Untuk menangani interaksi fisik, kami memutuskan untuk menggunakan pustaka Box2d dan membuat kelas </font></font><code>WorldObject2d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang diwarisi </font><font style="vertical-align: inherit;">darinya </font></font><code>GraphicalObject2d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Sayangnya, Box2d tidak bekerja di luar kotak, sehingga Ilya yang pemberani menulis bungkus untuk b2Body dan semua koneksi fisik yang ada di perpustakaan ini.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1fa/68a/807/1fa68a80750c650cb3d3f947a6f58d54.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sampai saat itu, kami berpikir untuk membuat grafik di mesin benar-benar dua dimensi, dan untuk penerangan, jika kami memutuskan untuk menambahkannya, gunakan teknik raycasting. </font><font style="vertical-align: inherit;">Tapi kami punya kamera indah yang bisa menampilkan objek dalam ketiga dimensi. </font><font style="vertical-align: inherit;">Karena itu, kami menambahkan ketebalan pada semua objek dua dimensi - mengapa tidak? </font><font style="vertical-align: inherit;">Selain itu, di masa depan, ini akan memungkinkan Anda untuk membuat pencahayaan yang cukup indah yang akan meninggalkan bayangan dari benda tebal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pencahayaan muncul di antara kasus-kasus. </font><font style="vertical-align: inherit;">Untuk membuatnya, perlu untuk menulis instruksi yang sesuai untuk menggambar setiap piksel - shader fragmen.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/460/faf/f88/460faff88bbc07d7b466c0c9d7a12f4b.gif"></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tekstur</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menggunakan perpustakaan DevIL untuk mengunggah gambar. </font><font style="vertical-align: inherit;">Masing - masing </font></font><code>GraphicalObject2d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menjadi sesuai satu contoh kelas </font></font><code>GraphicalPolygon</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- bagian depan objek - dan </font></font><code>GraphicalEdge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- sisi. </font><font style="vertical-align: inherit;">Pada masing-masing Anda dapat meregangkan tekstur Anda. </font><font style="vertical-align: inherit;">Hasil pertama:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8db/847/a6f/8db847a6fddf768afc0cd175a7368b98.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua yang diperlukan dari grafik sudah siap: menggambar, satu sumber cahaya dan tekstur. </font><font style="vertical-align: inherit;">Grafik - itu saja untuk saat ini.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mesin negara, mengatur perilaku objek</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap objek, apa pun itu - keadaan dalam mesin negara, grafik atau fisik - harus "berdetak", yaitu, setiap iterasi dari loop game diperbarui. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Objek yang dapat memperbarui diwarisi dari kelas Perilaku yang kami buat. Ini memiliki fungsi </font></font><code>onStart, onActive, onStop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang memungkinkan Anda untuk menimpa perilaku pewaris saat startup, selama hidup dan pada akhir aktivitasnya. Sekarang kita perlu membuat objek tertinggi </font></font><code>Activity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang memanggil fungsi-fungsi ini dari semua objek. Fungsi loop yang melakukan ini adalah sebagai berikut:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>:
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-title">onAwake</span><span class="hljs-params">()</span></span>;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;awake = <span class="hljs-literal">true</span>;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">while</span> (awake):<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onStart();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;running = <span class="hljs-literal">true</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">while</span> (running):<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onActive();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onStop();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;onDestroy();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk saat ini </font></font><code>running == true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, seseorang dapat memanggil fungsi </font></font><code>pause()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang </font><font style="vertical-align: inherit;">berfungsi </font></font><code>running = false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Jika seseorang memanggil </font></font><code>kill()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, lalu </font></font><code>awake</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dan </font></font><code>running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beralih ke </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dan aktivitas berhenti total. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kami ingin menjeda sekelompok objek, misalnya, sistem partikel dan partikel di dalamnya. Dalam kondisi saat ini, Anda perlu memanggil secara manual </font></font><code>onPause</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk setiap objek, yang sangat tidak nyaman. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solusi:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> setiap orang </font></font><code>Behavior</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">akan memiliki larik </font></font><code>subBehaviors</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang akan diperbarui, yaitu:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onStart</span><span class="hljs-params">()</span>:
	<span class="hljs-title">onStart</span><span class="hljs-params">()</span> 		<span class="hljs-comment">//     </span>
	<span class="hljs-keyword">for</span> sb in subBehaviors:
		sb.<span class="hljs-title">onStart</span><span class="hljs-params">()</span>	<span class="hljs-comment">//       Behavior</span>
<span class="hljs-keyword">void</span> <span class="hljs-title">onActive</span><span class="hljs-params">()</span>:
	<span class="hljs-title">onActive</span><span class="hljs-params">()</span>
	<span class="hljs-keyword">for</span> sb in subBehaviors:
		sb.<span class="hljs-title">onActive</span><span class="hljs-params">()</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan seterusnya, untuk setiap fungsi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi tidak setiap perilaku dapat diatur dengan cara ini. Misalnya, jika seorang musuh berjalan di peron, musuh, maka kemungkinan besar dia memiliki kondisi yang berbeda: dia berdiri </font></font><code>idle_stay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dia berjalan di peron tanpa memperhatikan kita </font></font><code>idle_walk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dan kapan saja dia bisa melihat kita dan masuk ke keadaan menyerang </font></font><code>attack</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Saya juga ingin mengatur kondisi untuk transisi antar negara, misalnya:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">isTransitionActivated</span><span class="hljs-params">()</span>: 		<span class="hljs-comment">//  idle_walk-&gt;attack</span>
	<span class="hljs-keyword">return</span> <span class="hljs-title">canSee</span><span class="hljs-params">(enemy)</span></span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pola yang diinginkan adalah mesin negara. </font><font style="vertical-align: inherit;">Kami juga menjadikannya pewaris </font></font><code>Behavior</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, karena pada setiap centang perlu untuk memeriksa apakah saatnya telah tiba untuk beralih negara. </font><font style="vertical-align: inherit;">Ini berguna tidak hanya untuk objek dalam game. </font><font style="vertical-align: inherit;">Sebagai contoh, </font></font><code>Level</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ini adalah keadaan </font></font><code>Level Switcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dan transisi di dalam mesin pengontrol adalah kondisi untuk beralih level dalam permainan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Negara memiliki tiga tahap: telah dimulai, terus berdetak, telah berhenti. </font><font style="vertical-align: inherit;">Anda dapat menambahkan beberapa tindakan ke setiap tahap, misalnya, melampirkan tekstur ke objek, menerapkan impuls padanya, mengatur kecepatan, dan sebagainya.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konservasi</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Membuat level dalam editor, saya ingin dapat menyimpannya, dan game itu sendiri harus dapat memuat level dari data yang disimpan. Oleh karena itu, semua objek yang perlu diselamatkan diwariskan dari kelas </font></font><code>NamedStoredObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ini menyimpan string dengan nama, nama kelas dan memiliki fungsi </font></font><code>dump()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang membuang data tentang suatu objek menjadi string.&nbsp;&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk melakukan save, tetap hanya menimpa </font></font><code>dump()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk setiap objek. Memuat adalah konstruktor dari string yang berisi semua informasi tentang objek. Pengunduhan selesai saat konstruktor dibuat untuk setiap objek.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Faktanya, gim dan editor hampir kelas yang sama, hanya di gamenya level dimuat dalam mode baca, dan di editor dalam mode rekam. Mesin menggunakan perpustakaan quickjson untuk menulis dan membaca objek dari json.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GUI</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada titik tertentu, muncul pertanyaan di hadapan kita: biarkan gambar, mesin negara, dan sisanya ditulis. </font><font style="vertical-align: inherit;">Bagaimana cara pengguna menulis game menggunakan ini?&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam versi asli, ia harus mewarisi dari </font></font><code>Game2d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan menimpa </font></font><code>onActive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dan membuat objek di bidang kelas. </font><font style="vertical-align: inherit;">Tetapi selama penciptaan, ia tidak dapat melihat apa yang ia ciptakan, dan ia juga perlu mengkompilasi programnya dan tautan ke perpustakaan kami. </font><font style="vertical-align: inherit;">Kengerian! </font><font style="vertical-align: inherit;">Akan ada nilai tambah - orang dapat menanyakan perilaku rumit yang bisa dibayangkan: misalnya, pindahkan blok tanah sebanyak nyawa pemain, dan lakukan asalkan Uranus berada di konstelasi Taurus dan euro tidak melebihi 40 rubel. </font><font style="vertical-align: inherit;">Namun, kami masih memutuskan untuk membuat antarmuka grafis.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam antarmuka grafis, jumlah tindakan yang dapat dilakukan dengan suatu objek akan terbatas: membolak-balik slide animasi, menerapkan kekuatan, mengatur kecepatan tertentu, dan sebagainya. Situasi yang sama dengan transisi di mesin negara. Dalam mesin besar, masalah sejumlah tindakan diselesaikan dengan menghubungkan program saat ini dengan yang lain - misalnya, Unity dan Godot menggunakan ikatan dengan C #. Sudah dari skrip ini Anda dapat melakukan apa saja: dan lihat di konstelasi Uranus, dan apa nilai tukar euro saat ini. Kami tidak memiliki fungsi seperti itu saat ini, tetapi rencana kami termasuk menghubungkan mesin dengan Python 3.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengimplementasikan antarmuka grafis, kami memutuskan untuk menggunakan Dear ImGui, karena sangat kecil (dibandingkan dengan Qt yang terkenal) dan menulis di atasnya sangat sederhana. </font><font style="vertical-align: inherit;">ImGui - paradigma menciptakan antarmuka grafis. </font><font style="vertical-align: inherit;">Di dalamnya, setiap iterasi dari loop utama, semua widget dan jendela digambar ulang hanya jika perlu. </font><font style="vertical-align: inherit;">Di satu sisi, ini mengurangi jumlah memori yang dikonsumsi, tetapi di sisi lain, kemungkinan besar membutuhkan waktu lebih lama dari satu pelaksanaan fungsi kompleks untuk membuat dan menyimpan informasi yang diperlukan untuk gambar berikutnya. </font><font style="vertical-align: inherit;">Tetap hanya untuk mengimplementasikan antarmuka untuk membuat dan mengedit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inilah tampilan antarmuka grafis pada saat rilis artikel:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/09a/e87/f8e/09ae87f8eea964d382f07b411991d6d4.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Editor level</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/93b/b2e/1bd/93bb2e1bd41ab656341a78fd3dd04102.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Editor Mesin Negara</font></font></i><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami hanya menciptakan dasar untuk menggantung sesuatu yang lebih menarik. Dengan kata lain, ada ruang untuk tumbuh: Anda dapat menerapkan rendering bayangan, kemampuan untuk membuat lebih dari satu sumber cahaya, Anda dapat menghubungkan mesin dengan interpreter Python 3 untuk menulis skrip untuk permainan. Saya ingin memperhalus antarmuka: membuatnya lebih cantik, menambahkan lebih banyak objek berbeda, mendukung hot key ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masih ada banyak pekerjaan, tetapi kami senang dengan apa yang kami miliki saat ini.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selama pembuatan proyek, kami mendapat banyak pengalaman beragam: bekerja dengan grafik, membuat antarmuka grafis, bekerja dengan file json, membungkus berbagai perpustakaan C. Dan juga pengalaman menulis proyek besar pertama dalam sebuah tim. Kami berharap bahwa kami dapat menceritakan tentang hal itu semenarik itu menarik untuk mengatasinya :)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tautan ke proyek </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">gihab</font></a><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/Glebanister/ample</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id504766/index.html">Bagaimana kami mengunjungi pabrik metalurgi di Asha</a></li>
<li><a href="../id504768/index.html">Analis magang di Yandex: analisis tugas tes</a></li>
<li><a href="../id504770/index.html">Distribusi Gaming Linux</a></li>
<li><a href="../id504772/index.html">Acara digital di Moskow dari tanggal 1 hingga 7 Juni</a></li>
<li><a href="../id504774/index.html">Survei eksekutif TI tentang perubahan kebutuhan layanan TI</a></li>
<li><a href="../id504780/index.html">NSA, Ghidra, dan Unicorn</a></li>
<li><a href="../id504784/index.html">Sertifikat root AddTrust Sectigo kedaluwarsa pada 30 Mei 2020, yang menyebabkan masalah pada klien OpenSSL 1.0.x dan GnuTLS</a></li>
<li><a href="../id504786/index.html">Semua yang perlu Anda ketahui tentang caching</a></li>
<li><a href="../id504790/index.html">Pilihan artikel tentang pembelajaran mesin: kasus, panduan dan studi untuk Mei 2020</a></li>
<li><a href="../id504792/index.html">Rumah kos tugas. Bagaimana NSPK menyelamatkan ruang tugasnya dari coronavirus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>