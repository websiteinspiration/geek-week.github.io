<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéûÔ∏è ‚ùì üóëÔ∏è PVS-Studio analyzer RunUO check ‚õ≤Ô∏è ü§ôüèº üë©üèª‚Äçü§ù‚Äçüë®üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is devoted to checking the RunUO project using the PVS-Studio static analyzer. RunUO is a server software emulator for Ultima Online, a g...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>PVS-Studio analyzer RunUO check</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/487106/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/pk/vz/nb/pkvznbl6d22oijuluuu2xfoztcs.png" alt="Picture 1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This article is devoted to checking the RunUO project using the PVS-Studio static analyzer. </font><font style="vertical-align: inherit;">RunUO is a server software emulator for Ultima Online, a game that once won the hearts of many MMORPG fans.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introduction</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RunUO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is a server software emulator for MMORPG Ultima Online. The goal of this project is to create stable software that will be able to compete with the official servers of EA Games. RunUO was created back in 2002, but it does not lose relevance and is actively used to this day. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The purpose of the project verification is to popularize the topic of static analysis. We check various projects - games ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), libraries ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), messengers ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), browsers ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) and much more ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) to attract the attention of a diverse audience. With these articles, we are trying to draw attention to the importance of using static analysis in development. Static analysis makes the code more reliable and safer. Also, with its regular use, you can find and eliminate errors at the earliest stages. This saves developers time and effort, because no one wants to spend </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50 hours</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> searching for the error that the analyzer can find.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We also help the open-source community. </font><font style="vertical-align: inherit;">Through articles with errors found, we contribute to the development of open-source. </font><font style="vertical-align: inherit;">However, in the articles we do not analyze all warnings. </font><font style="vertical-align: inherit;">Some warnings seemed too boring for us to get into the article, some turned out to be false positives, etc. </font><font style="vertical-align: inherit;">Therefore, we are ready to provide a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">free license</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for open source projects. </font><font style="vertical-align: inherit;">Moreover, what seemed to us boring for the article may seem quite interesting for the developers of the project being tested, because the developers of the project are still more aware of which problems are most critical.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pieces of code that caught attention when examining the analyzer report</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3010 The return value of function 'Intern' is required to be utilized. </font><font style="vertical-align: inherit;">BasePaintedMask.cs 49</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> <span class="hljs-title">Intern</span>(<span class="hljs-params"> <span class="hljs-keyword">string</span> str </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( str == <span class="hljs-literal">null</span> )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( str.Length == <span class="hljs-number">0</span> )
    <span class="hljs-keyword">return</span> String.Empty;<font></font>
<font></font>
  <span class="hljs-keyword">return</span> String.Intern( str );<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">BasePaintedMask</span>(<span class="hljs-params"> <span class="hljs-keyword">string</span> staffer, <span class="hljs-keyword">int</span> itemid </span>)
                            : <span class="hljs-title">base</span>(<span class="hljs-params"> itemid + Utility.Random( <span class="hljs-number">2</span> </span>) )</span><font></font>
{<font></font>
  m_Staffer = staffer;<font></font>
<font></font>
  Utility.Intern( m_Staffer );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The return value of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intern ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method is </font><font style="vertical-align: inherit;">not taken into account anywhere, as indicated by the analyzer. </font><font style="vertical-align: inherit;">Perhaps this is a bug or redundant code. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3017 A pattern was detected: (item is BasePotion) || </font><font style="vertical-align: inherit;">((item is BasePotion) &amp;&amp; ...). </font><font style="vertical-align: inherit;">The expression is excessive or contains a logical error. </font><font style="vertical-align: inherit;">Cleanup.cs 137</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">IsBuggable</span>(<span class="hljs-params"> Item item </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( item <span class="hljs-keyword">is</span> Fists )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( item <span class="hljs-keyword">is</span> ICommodity || item <span class="hljs-keyword">is</span> Multis.BaseBoat<font></font>
    || item <span class="hljs-keyword">is</span> Fish || item <span class="hljs-keyword">is</span> BigFish<font></font>
    || item <span class="hljs-keyword">is</span> BasePotion || item <span class="hljs-keyword">is</span> Food || item <span class="hljs-keyword">is</span> CookableFood<font></font>
    || item <span class="hljs-keyword">is</span> SpecialFishingNet || item <span class="hljs-keyword">is</span> BaseMagicFish<font></font>
    || item <span class="hljs-keyword">is</span> Shoes || item <span class="hljs-keyword">is</span> Sandals<font></font>
    || item <span class="hljs-keyword">is</span> Boots || item <span class="hljs-keyword">is</span> ThighBoots<font></font>
    || item <span class="hljs-keyword">is</span> TreasureMap || item <span class="hljs-keyword">is</span> MessageInABottle<font></font>
    || item <span class="hljs-keyword">is</span> BaseArmor || item <span class="hljs-keyword">is</span> BaseWeapon<font></font>
    || item <span class="hljs-keyword">is</span> BaseClothing<font></font>
    || ( item <span class="hljs-keyword">is</span> BaseJewel &amp;&amp; Core.AOS )<font></font>
    || ( item <span class="hljs-keyword">is</span> BasePotion &amp;&amp; Core.ML )<font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are subexpressions that can be simplified. </font><font style="vertical-align: inherit;">I will write them out so that it is more clear:</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (item <span class="hljs-keyword">is</span> BasePotion || ( item <span class="hljs-keyword">is</span> BasePotion &amp;&amp; Core.ML ))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suppose, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item is BasePotion = to true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , then the condition is true, despite the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Core.ML</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">If the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item is BasePotion = to false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , then the condition is false, again regardless of the value </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Core.ML</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Such code is most often simply redundant, however, there are worse situations when the programmer made a mistake and wrote the wrong variable in the second subexpression. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3031 An excessive check can be simplified. </font><font style="vertical-align: inherit;">The '||' </font><font style="vertical-align: inherit;">operator is surrounded by opposite expressions 'bPlayerOnly' and '! bPlayerOnly'. </font><font style="vertical-align: inherit;">BaseCreature.cs 3005</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">double</span> <span class="hljs-title">GetFightModeRanking</span>(<span class="hljs-params"> Mobile m,
                                           FightMode acqType,
                                           <span class="hljs-keyword">bool</span> bPlayerOnly </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( ( bPlayerOnly &amp;&amp; m.Player ) ||  !bPlayerOnly )<font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This code is either redundant or erroneous. </font><font style="vertical-align: inherit;">His problem is that on both sides of '||' </font><font style="vertical-align: inherit;">are different in the sense of subexpression. </font><font style="vertical-align: inherit;">If we cut it like this:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> ( m.Player || !bPlayerOnly )</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
then nothing will change. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3001 There are identical sub-expressions 'deed is SmallBrickHouseDeed' to the left and to the right of the '||' </font><font style="vertical-align: inherit;">operator. </font><font style="vertical-align: inherit;">RealEstateBroker.cs 132</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">ComputePriceFor</span>(<span class="hljs-params"> HouseDeed deed </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">int</span> price = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( deed <span class="hljs-keyword">is</span> SmallBrickHouseDeed ||    <span class="hljs-comment">// &lt;=</span>
       deed <span class="hljs-keyword">is</span> StonePlasterHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> FieldStoneHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> SmallBrickHouseDeed ||    <span class="hljs-comment">// &lt;=</span>
       deed <span class="hljs-keyword">is</span> WoodHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> WoodPlasterHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> ThatchedRoofCottageDeed )<font></font>
      ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I think it‚Äôs not worthwhile to explain anything here, the next or wrong, or redundant code. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3067 It is possible that 'else' block was forgotten or commented out, thus altering the program's operation logics. </font><font style="vertical-align: inherit;">BaseHouse.cs 1558</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SetLockdown</span>(<span class="hljs-params"> Item i, <span class="hljs-keyword">bool</span> locked, <span class="hljs-keyword">bool</span> checkContains </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( m_LockDowns == <span class="hljs-literal">null</span> )
    <span class="hljs-keyword">return</span>;<font></font>
<font></font>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">region</span> Mondain's Legacy</span>
  <span class="hljs-keyword">if</span> ( i <span class="hljs-keyword">is</span> BaseAddonContainer )<font></font>
    i.Movable = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">else</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">endregion</span></span><font></font>
<font></font>
  i.Movable = !locked;<font></font>
  i.IsLockedDown = locked;<font></font>
<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quite a rare warning. </font><font style="vertical-align: inherit;">The analyzer found the code formatting suspicious after the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#endregion</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> directive to be </font><i><font style="vertical-align: inherit;">suspicious. </font></i><font style="vertical-align: inherit;">If you don‚Äôt read the code, it looks like a line</font></font><br>
<br>
<pre><code class="cs hljs">i.Movable = !locked;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
will be executed in any case, regardless of the variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Perhaps curly braces were forgotten here ... In general, developers should check this code. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3043 The code's operational logic does not correspond with its formatting. </font><font style="vertical-align: inherit;">The statement is indented to the right, but it is always executed. </font><font style="vertical-align: inherit;">It is possible that curly brackets are missing. </font><font style="vertical-align: inherit;">Earthquake.cs 57</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnCast</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( Core.AOS )<font></font>
  {<font></font>
    damage = m.Hits / <span class="hljs-number">2</span>;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> ( !m.Player )<font></font>
      damage = Math.Max( Math.Min( damage, <span class="hljs-number">100</span> ), <span class="hljs-number">15</span> );<font></font>
      damage += Utility.RandomMinMax( <span class="hljs-number">0</span>, <span class="hljs-number">15</span> );            <span class="hljs-comment">// &lt;=</span><font></font>
<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Curly braces may be missing in this code. </font><font style="vertical-align: inherit;">This conclusion can be made due to the strange formatting of the code in the body of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if (! M.Player)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3083 Unsafe invocation of event 'ServerStarted', NullReferenceException is possible. </font><font style="vertical-align: inherit;">Consider assigning event to a local variable before invoking it. </font><font style="vertical-align: inherit;">EventSink.cs 921</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InvokeServerStarted</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( ServerStarted != <span class="hljs-literal">null</span> )<font></font>
    ServerStarted();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This method uses a potentially unsafe call to the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RefreshStarted</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> event </font><i><font style="vertical-align: inherit;">handler</font></i><font style="vertical-align: inherit;"> , as the analyzer indicates. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Why is it dangerous? Imagine this situation. The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerStarted</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> event </font><font style="vertical-align: inherit;">has only one subscriber. And at the moment between checking for null and directly calling the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerStarted ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> event handler </font><font style="vertical-align: inherit;">in another thread, an unsubscription was made from this event. This will throw a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The easiest way to prevent this situation is to provide a safe event call using the '?.' Operator:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InvokeServerStarted</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ServerStarted?.Invoke();<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3054 Potentially unsafe double-checked locking. Use volatile variable (s) or synchronization primitives to avoid this. Item.cs 1624</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> Packet m_RemovePacket;<font></font>
....<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">object</span> _rpl = <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>();
<span class="hljs-keyword">public</span> Packet RemovePacket<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">lock</span> (_rpl)<font></font>
      {<font></font>
        <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
          m_RemovePacket = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
          m_RemovePacket.SetStatic();<font></font>
        }<font></font>
      }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> m_RemovePacket;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The analyzer warning is associated with the unsafe use of the double checked locking pattern. As you can see from the code above, a double-check lock was applied to implement the generative pattern - Loners. When we try to get an instance of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Packet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> class by </font><font style="vertical-align: inherit;">accessing the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> property </font><font style="vertical-align: inherit;">, the getter checks the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> field </font><font style="vertical-align: inherit;">for equality to zero. If the check passes, then we get into the body of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> statement </font><font style="vertical-align: inherit;">, where the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> field is </font><i><font style="vertical-align: inherit;">initialized</font></i><font style="vertical-align: inherit;"> . An interesting situation arises at the moment when the main thread has already initialized the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> variable </font><font style="vertical-align: inherit;">through the constructor, but has not yet called the method</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SetStatic ().</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Theoretically, another thread can access the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> property </font><font style="vertical-align: inherit;">at the very inconvenient moment. Checking </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for equality to zero will no longer fail, and the calling thread will receive a link to an object that is not ready to use. To solve this problem, </font><font style="vertical-align: inherit;">you can create an intermediate variable of the </font><i><font style="vertical-align: inherit;">Packet</font></i><font style="vertical-align: inherit;"> class </font><font style="vertical-align: inherit;">in the body of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> statement </font><font style="vertical-align: inherit;">, initialize it through a constructor call and the </font><i><font style="vertical-align: inherit;">SetStatic ()</font></i><font style="vertical-align: inherit;"> method </font><i><font style="vertical-align: inherit;">,</font></i><font style="vertical-align: inherit;"> and then assign it to the </font><i><font style="vertical-align: inherit;">m_RemovePacket</font></i><font style="vertical-align: inherit;"> variable </font><font style="vertical-align: inherit;">. In this case, the body of the </font><i><font style="vertical-align: inherit;">lock</font></i><font style="vertical-align: inherit;"> statement </font><font style="vertical-align: inherit;">might look like this:</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">lock</span> (_rpl)<font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    Packet instance = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
    instance.SetStatic();<font></font>
    m_RemovePacket = instance;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The problem seems to be fixed and the code will work as expected. But this is not so. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is one more point: the analyzer does not just suggest using the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">volatile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> keyword </font><font style="vertical-align: inherit;">. In the release version of the program, the compiler can optimize and reorder the lines of the call to the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SetStatic ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">and assign the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instance</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> variable </font><font style="vertical-align: inherit;">to the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> field </font><font style="vertical-align: inherit;">(from the point of view of the compiler, the semantics of the program will not be violated). And we again return to the same point where we started - the possibility of obtaining the un-initialized variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. It is impossible to say exactly when this reordering can occur, and whether it will happen at all: it can be affected by the CLR version, the architecture of the processor used, etc. It‚Äôs still worth protecting from such a scenario, and one of the solutions (however, not the most productive) will be to use the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">volatile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> keyword </font><font style="vertical-align: inherit;">. A variable that will be declared with the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">volatile modifier</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will not be subject to permutations during optimization by the compiler. A finally fixed code may look like this:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> Packet m_RemovePacket;<font></font>
....<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">object</span> _rpl = <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>();
<span class="hljs-keyword">public</span> Packet RemovePacket<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">lock</span> (_rpl)<font></font>
      {<font></font>
        <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
          Packet instance = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
          instance.SetStatic();<font></font>
          m_RemovePacket = instance;<font></font>
        }<font></font>
      }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> m_RemovePacket;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sometimes using a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">volatile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> field may be undesirable due to the overhead of accessing such a field. We will not dwell on this topic in detail, simply noting that in the example under consideration, an atomic field record is needed only once (when the property is first accessed), however, declaring the field as </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">volatile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will cause the compiler to do its atomic reading and writing that may not be optimal in terms of performance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, another approach to correcting this analyzer warning to avoid additional overhead from declaring a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">volatile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> field is to use the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy &lt;T&gt; type</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for backing the </font><i><font style="vertical-align: inherit;">m_RemovePacket</font></i><font style="vertical-align: inherit;"> field</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instead of double check locking. </font><font style="vertical-align: inherit;">In this case, the getter body can be replaced by the initializer method, which will be passed to the constructor of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy &lt;T&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> instance </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> Lazy&lt;Packet&gt; m_RemovePacket = <span class="hljs-keyword">new</span> Lazy&lt;Packet&gt;(() =&gt;<font></font>
  {<font></font>
    Packet instance = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
    instance.SetStatic();<font></font>
    <span class="hljs-keyword">return</span> instance;<font></font>
  }, LazyThreadSafetyMode.ExecutionAndPublication);<font></font>
<font></font>
....<font></font>
<span class="hljs-keyword">public</span> Packet RemovePacket<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> m_RemovePacket.Value;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The initializer method will be called once, when the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> type is accessed for the first time, </font><font style="vertical-align: inherit;">and streaming security in case of accessing the property from several threads at the same time will be guaranteed by the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy &lt;T&gt; type</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (the thread safety mode is controlled by the second parameter of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> constructor </font><font style="vertical-align: inherit;">). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3131 The expression 'targeted' is checked for compatibility with the type 'IAxe', but is casted to the 'Item' type. </font><font style="vertical-align: inherit;">HarvestTarget.cs 61</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnTarget</span>(<span class="hljs-params"> Mobile <span class="hljs-keyword">from</span>, <span class="hljs-keyword">object</span> targeted </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( m_System <span class="hljs-keyword">is</span> Lumberjacking &amp;&amp;<font></font>
            targeted <span class="hljs-keyword">is</span> IAxe &amp;&amp; m_Tool <span class="hljs-keyword">is</span> BaseAxe )<font></font>
  {<font></font>
    IAxe obj = (IAxe)targeted;<font></font>
    Item item = (Item)targeted;<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">targeted</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> variable </font><font style="vertical-align: inherit;">was checked for belonging to type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IAxe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but </font><font style="vertical-align: inherit;">no one checked </font><font style="vertical-align: inherit;">for belonging to </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Item</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , as the analyzer reports. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3070 Uninitialized variable 'Zero' is used when initializing the 'm_LastMobile' variable. Serial.cs 29</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> Serial : IComparable, IComparable&lt;Serial&gt;<font></font>
{<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> m_Serial;<font></font>
<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Serial m_LastMobile = Zero;                <span class="hljs-comment">// &lt;=</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Serial m_LastItem = <span class="hljs-number">0x40000000</span>;<font></font>
<font></font>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Serial LastMobile { .... }
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Serial LastItem { .... }<font></font>
<font></font>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> Serial MinusOne = <span class="hljs-keyword">new</span> Serial( <span class="hljs-number">-1</span> );
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> Serial Zero = <span class="hljs-keyword">new</span> Serial( <span class="hljs-number">0</span> );     <span class="hljs-comment">// &lt;=</span><font></font>
  ....<font></font>
  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Serial</span>(<span class="hljs-params"> <span class="hljs-keyword">int</span> serial </span>)</span><font></font>
  {<font></font>
    m_Serial = serial;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As such, there is no mistake here, however, writing this is not very good. Due to the assignment of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_LastMobile to the</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> value of an uninitialized </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zero</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a structure with the default constructor </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serial ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will be created </font><font style="vertical-align: inherit;">, which will lead to the initialization of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_Serial = 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . And this, in turn, is equivalent to calling </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">new Serial (0)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . In fact, the developers are lucky that </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">serial</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> should be equal to </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , if there should have been any other value, this would lead to an error. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3063 A part of conditional expression is always true if it is evaluated: m_Serial &lt;= 0x7FFFFFFF. Serial.cs 83</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> IsItem<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> ( m_Serial &gt;= <span class="hljs-number">0x40000000</span> &amp;&amp; m_Serial &lt;= <span class="hljs-number">0x7FFFFFFF</span> );<font></font>
  }<font></font>
}</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x7FFFFFFF</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is the maximum possible value that </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int32</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> can contain </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Therefore, whatever value the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_Serial</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> variable </font><i><font style="vertical-align: inherit;">has</font></i><font style="vertical-align: inherit;"> , it will in any case be less than or equal to </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x7FFFFFFF</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3004 The 'then' statement is equivalent to the 'else' statement. </font><font style="vertical-align: inherit;">Serialization.cs 1571</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteDeltaTime</span>(<span class="hljs-params"> DateTime <span class="hljs-keyword">value</span> </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">try</span> <font></font>
  { <font></font>
    d = <span class="hljs-keyword">new</span> TimeSpan( ticks-now ); <font></font>
  }<font></font>
  <span class="hljs-keyword">catch</span> <font></font>
  {<font></font>
    <span class="hljs-keyword">if</span>( ticks &lt; now ) <font></font>
      d = TimeSpan.MaxValue; <font></font>
    <span class="hljs-keyword">else</span> <font></font>
      d = TimeSpan.MaxValue;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The analyzer warns about a suspicious piece of code in which the true and false branches of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if statement</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> completely coincide. </font><font style="vertical-align: inherit;">Perhaps one of the branches should have </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TimeSpan.MinValue. </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The same code was found in several places: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V3004 The 'then' statement is equivalent to the 'else' statement. </font><font style="vertical-align: inherit;">Item.cs 2103</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Serialize</span>(<span class="hljs-params"> GenericWriter writer </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>( ticks &lt; now ) <font></font>
    d = TimeSpan.MaxValue; <font></font>
  <span class="hljs-keyword">else</span> <font></font>
    d = TimeSpan.MaxValue;<font></font>
  <font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V3004 The 'then' statement is equivalent to the 'else' statement. </font><font style="vertical-align: inherit;">Serialization.cs 383</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteDeltaTime</span>(<span class="hljs-params"> DateTime <span class="hljs-keyword">value</span> </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>( ticks &lt; now ) <font></font>
    d = TimeSpan.MaxValue; <font></font>
  <span class="hljs-keyword">else</span> <font></font>
    d = TimeSpan.MaxValue;<font></font>
  <font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I used ‚ÄúThis‚Äù for a reason, it is very likely that, among other things, it could not do without copy-paste, these code fragments look very painful. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warning PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3051 An excessive type cast. </font><font style="vertical-align: inherit;">The object is already of the 'Item' type. </font><font style="vertical-align: inherit;">Mobile.cs 11237</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> Item Talisman<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> FindItemOnLayer( Layer.Talisman ) <span class="hljs-keyword">as</span> Item;<font></font>
  }<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> Item <span class="hljs-title">FindItemOnLayer</span>(<span class="hljs-params"> Layer layer </span>)</span><font></font>
{<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This analyzer warning can be obtained if there is excessive use of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> operator </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">There is no error in this section of the code, but it also makes no sense to cast the object to its own type. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> warning </font><b><font style="vertical-align: inherit;">:</font></b><font style="vertical-align: inherit;"> V3148 Casting potential 'null' value of 'toSet' to a value type can lead to NullReferenceException. </font><font style="vertical-align: inherit;">Properties.cs 502</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ConstructFromString</span>(<span class="hljs-params"> .... </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">object</span> toSet;
  <span class="hljs-keyword">bool</span> isSerial = IsSerial( type );<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( isSerial ) <span class="hljs-comment">// mutate into int32</span>
    type = m_NumericTypes[<span class="hljs-number">4</span>];<font></font>
<font></font>
  ....<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">value</span> == <span class="hljs-literal">null</span> )<font></font>
  {<font></font>
    toSet = <span class="hljs-literal">null</span>;<font></font>
  }<font></font>
  ....<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( isSerial ) <span class="hljs-comment">// mutate back</span><font></font>
    toSet = (Serial)((Int32)toSet);<font></font>
<font></font>
  constructed = toSet;<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this section of code, we are interested in the case when the variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">value</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Then the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toSet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> variable </font><i><font style="vertical-align: inherit;">is</font></i><font style="vertical-align: inherit;"> also </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Further, if the variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isSerial == true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , then </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toSet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is </font><i><font style="vertical-align: inherit;">cast</font></i><font style="vertical-align: inherit;"> to </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int32</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which will lead to </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NRE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can fix this code by adding, for example, 0 by default:</font></font><br>
<br>
<pre><code class="cs hljs">toSet = (Serial)((Int32)(toSet ?? <span class="hljs-number">0</span>));</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3031 An excessive check can be simplified. </font><font style="vertical-align: inherit;">The '||' </font><font style="vertical-align: inherit;">operator is surrounded by opposite expressions 'pack == null' and 'pack! = null'. </font><font style="vertical-align: inherit;">BODBuyGump.cs 64</font></font><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnResponse</span>(<span class="hljs-params">Server.Network.NetState sender, RelayInfo info</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> ( (pack == <span class="hljs-literal">null</span>) ||<font></font>
       ((pack != <span class="hljs-literal">null</span>) &amp;&amp;<font></font>
        (!pack.CheckHold(<font></font>
                m_From,<font></font>
                item,<font></font>
                <span class="hljs-literal">true</span>,
                <span class="hljs-literal">true</span>,
                <span class="hljs-number">0</span>,<font></font>
                item.PileWeight + item.TotalWeight)) ) )<font></font>
  {<font></font>
    pv.SayTo(m_From, <span class="hljs-number">503204</span>);<font></font>
    m_From.SendGump(<span class="hljs-keyword">new</span> BOBGump(m_From, m_Book, m_Page, <span class="hljs-literal">null</span>));<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This code can be simplified, as the analyzer reports: </font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> ((pack == <span class="hljs-literal">null</span>) || ((pack != <span class="hljs-literal">null</span>) &amp;&amp; (!pack.CheckHold(....))))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To the left and right of the operator '||' </font><font style="vertical-align: inherit;">there are opposite in meaning expressions. </font><font style="vertical-align: inherit;">Here the check </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pack! = Null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is redundant, because before that the opposite condition </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pack == null is</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> checked </font><font style="vertical-align: inherit;">, and these expressions are separated by the operator '||'. </font><font style="vertical-align: inherit;">This line can be shortened as follows:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (pack == <span class="hljs-literal">null</span> || !pack.CheckHold(....))</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3080 Possible null dereference. </font><font style="vertical-align: inherit;">Consider inspecting 'winner'. </font><font style="vertical-align: inherit;">CTF.cs 1302</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Finish_Callback</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ....<font></font>
  CTFTeamInfo winner = ( teams.Count &gt; <span class="hljs-number">0</span> ? teams[<span class="hljs-number">0</span>] : <span class="hljs-literal">null</span> );<font></font>
<font></font>
  .... <font></font>
<font></font>
  m_Context.Finish( m_Context.Participants[winner.TeamID] <span class="hljs-keyword">as</span> Participant );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lets</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
say </font><i><font style="vertical-align: inherit;">teams.Count</font></i><font style="vertical-align: inherit;"> is </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Then </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">winner = null.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And further in the code, the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">winner.TeamID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> property is </font><i><font style="vertical-align: inherit;">accessed</font></i><font style="vertical-align: inherit;"> without checking for </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which will result in access by a null reference. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3041 The expression was implicitly cast from 'int' type to 'double' type. Consider utilizing an explicit type cast to avoid the loss of a fractional part. An example: double A = (double) (X) / Y ;. StormsEye.cs 87</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Gain</span>(<span class="hljs-params"> Mobile <span class="hljs-keyword">from</span>, Skill skill </span>)</span> <font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">from</span>.Player &amp;&amp; <font></font>
     ( skills.Total / skills.Cap ) &gt;= Utility.RandomDouble())<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This code fragment contains the operation of dividing the variables </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">skills.Total</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">skills.Cap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which are of type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and the result is then implicitly converted to type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">double</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , as the analyzer reports. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3085 The name of 'typeofObject' field in a nested type is ambiguous. The outer type contains static field with identical name. PropsGump.cs 744</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Type typeofObject = <span class="hljs-keyword">typeof</span>( <span class="hljs-keyword">object</span> );<font></font>
....<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GroupComparer</span> : <span class="hljs-title">IComparer</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Type typeofObject = <span class="hljs-keyword">typeof</span>( Object );<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typeofObject</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> was created in this section of code in a nested class </font><font style="vertical-align: inherit;">. Its problem is that in the outer class there is a variable with the same name, and errors can occur due to this. It is better not to allow this in order to reduce the likelihood of such errors due to inattention. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3140 Property accessors use different backing fields. WallBanner.cs 77</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> m_IsRewardItem;<font></font>
<font></font>
[<span class="hljs-meta">CommandProperty( AccessLevel.GameMaster )</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> IsRewardItem<font></font>
{<font></font>
  <span class="hljs-keyword">get</span>{ <span class="hljs-keyword">return</span> m_IsRewardItem; }
  <span class="hljs-keyword">set</span>{ m_IsRewardItem = <span class="hljs-keyword">value</span>; InvalidateProperties(); }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> m_East;<font></font>
<font></font>
[<span class="hljs-meta">CommandProperty( AccessLevel.GameMaster )</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> East<font></font>
{<font></font>
  <span class="hljs-keyword">get</span>{ <span class="hljs-keyword">return</span> m_East; }
  <span class="hljs-keyword">set</span>{ m_IsRewardItem = <span class="hljs-keyword">value</span>; InvalidateProperties(); }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And here there is a mistake that appeared due to copy-paste. The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> accessor of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">East</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> property </font><font style="vertical-align: inherit;">was to assign a value for </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_East</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , not </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_IsRewardItem</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio</font></font></b> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Warnings </font><b><font style="vertical-align: inherit;">:</font></b><font style="vertical-align: inherit;"> V3012 The '?:' Operator, regardless of its conditional expression, always returns one and the same value: 0xe7f. TreasureChestLevel2.cs 52 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V3012 The '?:' Operator, regardless of its conditional expression, always returns one and the same value: 0xe77. TreasureChestLevel2.cs 57</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SetChestAppearance</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">bool</span> UseFirstItemId = Utility.RandomBool();<font></font>
<font></font>
  <span class="hljs-keyword">switch</span>( Utility.RandomList( <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span> ) )<font></font>
  {<font></font>
    ....<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:<span class="hljs-comment">// Keg</span>
      <span class="hljs-keyword">this</span>.ItemID = ( UseFirstItemId ? <span class="hljs-number">0xe7f</span> : <span class="hljs-number">0xe7f</span> );
      <span class="hljs-keyword">this</span>.GumpID = <span class="hljs-number">0x3e</span>;
      <span class="hljs-keyword">break</span>;<font></font>
<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:<span class="hljs-comment">// Barrel</span>
      <span class="hljs-keyword">this</span>.ItemID = ( UseFirstItemId ? <span class="hljs-number">0xe77</span> : <span class="hljs-number">0xe77</span> );
      <span class="hljs-keyword">this</span>.GumpID = <span class="hljs-number">0x3e</span>;
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Some kind of illusion of choice :) Regardless of the value of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UseFirstItemId</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this.ItemID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will be either </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xe7f</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the first case, or </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xe77</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the second. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warning PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3066 Possible incorrect order of arguments passed to 'OnSwing' method: 'defender' and 'attacker'. </font><font style="vertical-align: inherit;">BaseWeapon.cs 1188</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">AbsorbDamageAOS</span>(<span class="hljs-params"> Mobile attacker,
                                    Mobile defender,
                                    <span class="hljs-keyword">int</span> damage </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> ( weapon != <span class="hljs-literal">null</span> )<font></font>
  {<font></font>
    defender.FixedParticles(<span class="hljs-number">0x3779</span>,
                            <span class="hljs-number">1</span>,
                            <span class="hljs-number">15</span>,
                            <span class="hljs-number">0x158B</span>,
                            <span class="hljs-number">0x0</span>,
                            <span class="hljs-number">0x3</span>,<font></font>
                            EffectLayer.Waist);<font></font>
    weapon.OnSwing( defender, attacker );<font></font>
  }<font></font>
  ....<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> TimeSpan <span class="hljs-title">OnSwing</span>(<span class="hljs-params"> Mobile attacker, Mobile defender </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">return</span> OnSwing( attacker, defender, <span class="hljs-number">1.0</span> );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It seemed suspicious to the analyzer that the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OnSwing ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method was </font><font style="vertical-align: inherit;">passed arguments in the reverse order. </font><font style="vertical-align: inherit;">Perhaps this is due to an error. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3092 Range intersections are possible within conditional expressions. </font><font style="vertical-align: inherit;">Example: if (A&gt; 0 &amp;&amp; A &lt;5) {...} else if (A&gt; 3 &amp;&amp; A &lt;9) {...}. </font><font style="vertical-align: inherit;">HouseFoundation.cs 1883</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">IsFixture</span>(<span class="hljs-params"> <span class="hljs-keyword">int</span> itemID </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID &gt;= <span class="hljs-number">0x319C</span> &amp;&amp; itemID &lt; <span class="hljs-number">0x31B0</span> ) 
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-comment">// ML doors</span>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID == <span class="hljs-number">0x2D46</span> ||<font></font>
           itemID == <span class="hljs-number">0x2D48</span> ||<font></font>
           itemID == <span class="hljs-number">0x2FE2</span> ||<font></font>
           itemID == <span class="hljs-number">0x2FE4</span> )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID &gt;= <span class="hljs-number">0x2D63</span> &amp;&amp; itemID &lt; <span class="hljs-number">0x2D70</span> )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID &gt;= <span class="hljs-number">0x319C</span> &amp;&amp; itemID &lt; <span class="hljs-number">0x31AF</span> ) 
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ranges tested under conditions intersect. </font><font style="vertical-align: inherit;">This seemed suspicious to the analyzer. </font><font style="vertical-align: inherit;">Even if this piece of code works correctly, it‚Äôs still worth fixing it. </font><font style="vertical-align: inherit;">Imagine a situation where we needed to rewrite the body of the last </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> so that, if the condition is true, the method returns </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">If </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemID is</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> equal to, say, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x319C</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the method will still return </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">This, in turn, will entail the loss of time to search for errors.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RunUO was created a long time ago, a lot of work has been done, but with the example of this project you can see the benefits of using static analysis on projects with a history. </font><font style="vertical-align: inherit;">The analyzer for 543 thousand lines of project code issued about 500 warnings (not counting </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Low </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><u><font style="vertical-align: inherit;">level</font></u></a><font style="vertical-align: inherit;"> ), most of which were not included in the article because of their uniformity. </font><font style="vertical-align: inherit;">To get acquainted with the result of the analysis in more detail, I suggest using a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">free license for open source projects</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you want to share this article with an English-speaking audience, then please use the link to the translation: Ekaterina Nikiforova. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RunUO Check by the PVS-Studio Analyzer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/en487106/">https://habr.com/ru/post/en487106/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en487092/index.html">Modeling business processes as part of an ERP system implementation project</a></li>
<li><a href="../en487094/index.html">Reprocessing events received from Kafka</a></li>
<li><a href="../en487096/index.html">Snippets. How to make the process of working with documentation easier</a></li>
<li><a href="../en487098/index.html">Draw with ants: procedural images using ant colony optimization algorithms</a></li>
<li><a href="../en487100/index.html">State-of-the-art immutable data structures</a></li>
<li><a href="../en487108/index.html">Mobile Gamer Profile: MyTracker Research</a></li>
<li><a href="../en487110/index.html">Slurm SRE. A complete experiment with experts from Booking.com and Google.com</a></li>
<li><a href="../en487112/index.html">Edge of Madness: The Basic Circle</a></li>
<li><a href="../en487116/index.html">Why Discord Migrates from Go to Rust</a></li>
<li><a href="../en487118/index.html">Loki - collecting logs using the Prometheus approach</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>