<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêõ ‚õµÔ∏è üï° Acc√©l√©rez votre recherche dans Have I Been Pwned √† 49 microsecondes (C ++) üßìüèæ üë©üèø‚Äçüè´ üíó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je connais depuis longtemps le site Have I Been Pwned (HIBP) . Certes, jusqu'√† r√©cemment, il n'y √©tait jamais all√©. J'ai toujours eu deux mots de pass...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Acc√©l√©rez votre recherche dans Have I Been Pwned √† 49 microsecondes (C ++)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490920/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/fu/rg/hn/furghncw9u08teobuskqawx2y7u.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je connais depuis longtemps le site </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Have I Been Pwned (HIBP)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Certes, jusqu'√† r√©cemment, il n'y √©tait jamais all√©. J'ai toujours eu deux mots de passe. L'un d'eux a √©t√© utilis√© √† plusieurs reprises pour le courrier poubelle et quelques comptes sur des sites √©tranges. Mais j'ai d√ª refuser, car le courrier a √©t√© pirat√©. Et pour √™tre honn√™te, je suis reconnaissant au pirate informatique parce que cet √©v√©nement m'a fait revoir mes mots de passe - la fa√ßon dont je les utilise et les stocke. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien s√ªr, j'ai chang√© de mot de passe sur tous les comptes o√π il y avait un mot de passe compromis. Ensuite, je me suis demand√© si le mot de passe divulgu√© se trouvait dans la base de donn√©es HIBP. Je ne voulais pas entrer le mot de passe sur le site, j'ai donc t√©l√©charg√© la base de donn√©es (</font></font><code>pwned-passwords-sha1-ordered-by-count-v5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">La base est tr√®s impressionnante. </font><font style="vertical-align: inherit;">Il s'agit d'un fichier texte de 22,8 Go avec un ensemble de hachages SHA-1, un dans chaque ligne avec un compteur, combien de fois le mot de passe avec ce hachage s'est produit dans les fuites. </font><font style="vertical-align: inherit;">J'ai trouv√© le SHA-1 de mon mot de passe fissur√© et j'ai essay√© de le trouver.</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenu</font></font></h1><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[G] repr√©sentant</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Structure de Trie</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recherche binaire</font></font></a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tri</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi revenir en arri√®re?</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parall√©lisme</font></font></a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ne sois pas un salaud √©go√Øste</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B3</font></font></a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tri par insertion</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S√©par√© ou non?</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Propri√©t√©s de l'arborescence HIBP</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fichier de sortie</font></font></a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rep√®res</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">okon - biblioth√®que et CLI</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liens et discussion</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Merci d'avoir lu</font></font></a></li>
</ul><br>
<a name="1"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[G] repr√©sentant</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons un fichier texte avec un hachage dans chaque ligne. </font><font style="vertical-align: inherit;">Le meilleur endroit o√π aller est probablement grep. </font></font><br>
<br>
<code>grep -m 1 '^XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX' pwned-passwords-sha1-ordered-by-count-v5.txt</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mon mot de passe √©tait en haut de la liste avec une fr√©quence de plus de 1500 fois, donc √ßa craint vraiment. </font><font style="vertical-align: inherit;">En cons√©quence, les r√©sultats de la recherche sont revenus presque instantan√©ment. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais tout le monde n'a pas des mots de passe faibles. </font><font style="vertical-align: inherit;">Je voulais v√©rifier combien de temps il faudrait pour trouver le pire des cas - le dernier hachage du fichier: </font></font><br>
<br>
<code>time grep -m 1 '^4541A1E4605EEBF3F4C166329C18502DF75D348A' pwned-passwords-sha1-ordered-by-count-v5.txt</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
R√©sultat: </font></font><code>33,35s user 23,39s system 41% cpu 2:15,35 total</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
c'est triste. </font><font style="vertical-align: inherit;">Apr√®s tout, comme mon courrier a √©t√© pirat√©, je voulais v√©rifier la pr√©sence de tous mes anciens et nouveaux mots de passe dans la base de donn√©es. </font><font style="vertical-align: inherit;">Mais un grep de deux minutes ne vous permet tout simplement pas de le faire confortablement. </font><font style="vertical-align: inherit;">Bien s√ªr, je pourrais √©crire un script, l'ex√©cuter et faire une promenade, mais ce n'est pas une option. </font><font style="vertical-align: inherit;">Je voulais trouver une meilleure solution et apprendre quelque chose.</font></font><br>
<br>
<a name="2"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Structure de Trie</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La premi√®re id√©e √©tait d'utiliser une structure de donn√©es trie. La structure semble id√©ale pour stocker les hachages SHA-1. L'alphabet est petit, donc les n≈ìuds seront √©galement petits, tout comme le fichier r√©sultant. Peut-√™tre qu'il tient m√™me dans la RAM? La recherche de cl√©s doit √™tre tr√®s rapide. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai donc mis en place cette structure. Il a ensuite pris les 1 000 000 premiers hachages de la base de donn√©es source pour cr√©er le fichier r√©sultant et v√©rifier si tout se trouve dans le fichier cr√©√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oui, je pouvais tout trouver dans le fichier, donc la structure fonctionnait bien. Le probl√®me √©tait diff√©rent.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le fichier r√©sultant a √©t√© publi√© au format 2283686592B (2,2 Go). Ce n'est pas bien. Comptons et voyons ce qui se passe. Un n≈ìud est une structure simple de seize valeurs 32 bits. Les valeurs sont des "pointeurs" vers les n≈ìuds suivants avec le symbole de hachage SHA-1 sp√©cifi√©. Ainsi, un n≈ìud prend 16 * 4 octets = 64 octets. √áa semble un peu? Mais si vous y r√©fl√©chissez, un n≈ìud repr√©sente un caract√®re dans un hachage. Ainsi, dans le pire des cas, le hachage SHA-1 prendra 40 * 64 octets = 2560 octets. C'est bien pire, par exemple, une repr√©sentation textuelle d'un hachage qui ne prend que 40 octets. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La structure trie a l'avantage de r√©utiliser les n≈ìuds. Si vous avez deux mots </font></font><code>aaa</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>abb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, le n≈ìud des premiers caract√®res est r√©utilis√©, car les caract√®res sont les m√™mes - </font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Revenons √† notre probl√®me. </font><font style="vertical-align: inherit;">Calculons le nombre de n≈ìuds stock√©s dans le fichier r√©sultant: </font></font><code>file_size / node_size = 2283686592 / 64 = 35682603</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons maintenant combien de n≈ìuds seront cr√©√©s dans le pire des cas √† partir d'un million de hachages: </font></font><code>1000000 * 40 = 40000000</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, la structure du trie ne r√©utilise que des </font></font><code>40000000 - 35682603 = 4317397</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n≈ìuds, ce qui repr√©sente 10,8% du pire des sc√©narios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec de tels indicateurs, le fichier r√©sultant pour l'ensemble de la base de donn√©es HIBP prendrait 1421513361920 octets (1,02 To). </font><font style="vertical-align: inherit;">Je n'ai m√™me pas assez de disque dur pour v√©rifier la vitesse de recherche des cl√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce jour-l√†, j'ai d√©couvert que la structure du trie ne convient pas aux donn√©es relativement al√©atoires. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cherchons une autre solution.</font></font><br>
<br>
<a name="3"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recherche binaire</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les hachages SHA-1 ont deux fonctionnalit√©s int√©ressantes: ils sont comparables les uns aux autres et ils sont tous de la m√™me taille. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gr√¢ce √† cela, nous pouvons traiter la base de donn√©es HIBP d'origine et cr√©er un fichier √† partir des valeurs SHA-1 tri√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais comment trier un fichier de 22 Go? </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Question. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi trier le fichier source? </font><font style="vertical-align: inherit;">HIBP renvoie un fichier avec des cha√Ænes d√©j√† tri√©es par hachage. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©ponse. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je n'y ai tout simplement pas pens√©. </font><font style="vertical-align: inherit;">√Ä ce moment, je ne connaissais pas le fichier tri√©.</font></font></i> <br>
<br>
<a name="4"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tri</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trier tous les hachages en RAM n'est pas une option, je n'ai pas beaucoup de RAM. </font><font style="vertical-align: inherit;">La solution √©tait la suivante:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Divisez un gros fichier en plus petits qui tiennent dans la RAM.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T√©l√©chargez des donn√©es √† partir de petits fichiers, triez-les en RAM et r√©√©crivez-les dans des fichiers.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combinez tous les petits fichiers tri√©s en un seul grand.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec un gros fichier tri√©, vous pouvez rechercher notre hachage en utilisant une recherche binaire. </font><font style="vertical-align: inherit;">L'acc√®s au disque dur est important. </font><font style="vertical-align: inherit;">Calculons le nombre de hits n√©cessaires dans une recherche binaire: </font></font><code>log2(555278657) = 29.0486367039</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30 hits. </font><font style="vertical-align: inherit;">Pas si mal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au premier stade, l'optimisation peut √™tre effectu√©e. </font><font style="vertical-align: inherit;">Convertissez les hachages de texte en donn√©es binaires. </font><font style="vertical-align: inherit;">Cela r√©duira de moiti√© la taille des donn√©es obtenues: de 22 √† 11 Go. </font><font style="vertical-align: inherit;">Bien.</font></font><br>
<br>
<a name="5"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi revenir en arri√®re?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä ce moment, j'ai r√©alis√© que vous pouvez faire plus intelligemment. </font><font style="vertical-align: inherit;">Que faire si vous ne combinez pas de petits fichiers en un seul grand, mais effectuez une recherche binaire dans de petits fichiers tri√©s en RAM? </font><font style="vertical-align: inherit;">Le probl√®me est de savoir comment trouver le fichier souhait√© dans lequel rechercher la cl√©. </font><font style="vertical-align: inherit;">La solution est tr√®s simple. </font><font style="vertical-align: inherit;">Nouvelle approche:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr√©ez 256 fichiers avec les noms "00" ... "FF".</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque vous lisez des hachages √† partir d'un fichier volumineux, √©crivez des hachages commen√ßant par ¬´00 ..¬ª dans un fichier appel√© ¬´00¬ª, des hachages commen√ßant par ¬´01 ..¬ª - dans un fichier ¬´01¬ª et ainsi de suite.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T√©l√©chargez des donn√©es √† partir de petits fichiers, triez-les en RAM et r√©√©crivez-les dans des fichiers.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout est tr√®s simple. </font><font style="vertical-align: inherit;">De plus, une autre option d'optimisation appara√Æt. </font><font style="vertical-align: inherit;">Si le hachage est stock√© dans le fichier "00", alors nous savons qu'il commence par "00". </font><font style="vertical-align: inherit;">Si le hachage est stock√© dans le fichier "F2", il commence par "F2". </font><font style="vertical-align: inherit;">Ainsi, lors de l'√©criture de hachages dans de petits fichiers, nous pouvons omettre le premier octet de chaque hachage! </font><font style="vertical-align: inherit;">Cela repr√©sente 5% de toutes les donn√©es. </font><font style="vertical-align: inherit;">555 Mo sont enregistr√©s au total.</font></font><br>
<br>
<a name="6"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parall√©lisme</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La s√©paration en fichiers plus petits offre une autre opportunit√© d'optimisation. </font><font style="vertical-align: inherit;">Les fichiers sont ind√©pendants les uns des autres, nous pouvons donc les trier en parall√®le. </font><font style="vertical-align: inherit;">Nous nous souvenons que tous vos processeurs aiment transpirer en m√™me temps;)</font></font><br>
<br>
<a name="7"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ne sois pas un salaud √©go√Øste</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque j'ai impl√©ment√© la solution ci-dessus, j'ai r√©alis√© que d'autres personnes avaient probablement un probl√®me similaire. Beaucoup d'autres t√©l√©chargent et recherchent √©galement la base de donn√©es HIBP. J'ai donc d√©cid√© de partager mon travail. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant cela, j'ai √† nouveau r√©vis√© mon approche et trouv√© quelques probl√®mes que je voudrais r√©soudre avant de publier le code et les outils sur Github. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Premi√®rement, en tant qu'utilisateur final, je ne voudrais pas utiliser un outil qui cr√©e beaucoup de fichiers √©tranges avec des noms √©tranges, dans lesquels on ne sait pas ce qui est stock√©, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, cela peut √™tre r√©solu en combinant les fichiers "00" .. "FF" dans un gros fichier.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malheureusement, avoir un seul gros fichier pour le tri pose un nouveau probl√®me. </font><font style="vertical-align: inherit;">Et si je veux ins√©rer un hachage dans ce fichier? </font><font style="vertical-align: inherit;">Un seul hachage. </font><font style="vertical-align: inherit;">Ce n'est que 20 octets. </font><font style="vertical-align: inherit;">Oh, le hachage commence par "000000000 ..". </font><font style="vertical-align: inherit;">D'accord. </font><font style="vertical-align: inherit;">Lib√©rons de l'espace pour cela en d√©pla√ßant 11 Go d'autres hachages ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous comprenez quel est le probl√®me. </font><font style="vertical-align: inherit;">L'insertion de donn√©es au milieu d'un fichier n'est pas l'op√©ration la plus rapide. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un autre inconv√©nient de cette approche est que vous devez √† nouveau stocker les premiers octets - il s'agit de 555 Mo de donn√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enfin, la recherche binaire sur les donn√©es stock√©es sur votre disque dur est beaucoup plus lente que l'acc√®s √† la RAM. </font><font style="vertical-align: inherit;">Je veux dire, c'est 30 lectures de disque contre 0 lecture de disque.</font></font><br>
<br>
<a name="8"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B3</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encore. </font><font style="vertical-align: inherit;">Ce que nous avons et ce que nous voulons r√©aliser. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons 11 Go de valeurs binaires. </font><font style="vertical-align: inherit;">Toutes les valeurs sont comparables et ont la m√™me taille. </font><font style="vertical-align: inherit;">Nous voulons savoir si une cl√© particuli√®re est pr√©sente dans les donn√©es stock√©es, et voulons √©galement changer la base de donn√©es. </font><font style="vertical-align: inherit;">Et pour que tout fonctionne rapidement. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/18c/851/d23/18c851d23c6bbe290fcccb763c6f09eb.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
B-arbre? </font><font style="vertical-align: inherit;">Droite </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'arbre B vous permet de minimiser l'acc√®s au disque lors de la recherche, de la modification, etc. Il a beaucoup plus de fonctionnalit√©s, mais nous avons besoin de ces deux.</font></font><br>
<br>
<a name="9"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tri par insertion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La premi√®re √©tape consiste √† convertir les donn√©es du fichier source HIBP en B-tree. Cela signifie que vous devez extraire tous les hachages tour √† tour et les ins√©rer dans la structure. L'algorithme d'insertion habituel convient pour cela. Mais dans notre cas, vous pouvez faire mieux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'insertion d'un grand nombre de donn√©es brutes dans un arbre B est un sc√©nario bien connu. Les sages ont invent√© une meilleure approche pour cela que l'insert habituel. Tout d'abord, vous devez trier les donn√©es. Cela peut √™tre fait comme d√©crit ci-dessus (divisez le fichier en plus petits et triez-les dans la RAM). Ins√©rez ensuite les donn√©es dans l'arborescence.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'algorithme habituel, si vous trouvez le n≈ìud feuille o√π vous souhaitez ins√©rer la valeur et qu'il est rempli, vous cr√©ez un nouveau n≈ìud (√† droite) et r√©partissez uniform√©ment les valeurs entre les deux n≈ìuds, √† gauche et √† droite (plus une valeur va au n≈ìud parent mais ce n'est pas important ici). En bref, les valeurs du n≈ìud gauche sont toujours inf√©rieures aux valeurs de droite. Le fait est que lorsque vous ins√©rez les donn√©es tri√©es, vous savez que les petites valeurs ne seront plus ins√©r√©es dans l'arborescence, donc plus aucune valeur n'ira au n≈ìud de gauche. Le n≈ìud gauche reste √† moiti√© vide tout le temps. De plus, si vous ins√©rez suffisamment de valeurs, vous pouvez constater que le n≈ìud droit est plein, vous devez donc d√©placer la moiti√© des valeurs vers le nouveau n≈ìud droit. Le n≈ìud divis√© reste √† moiti√© vide, comme dans le cas pr√©c√©dent. Etc‚Ä¶</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cons√©quence, apr√®s toutes les insertions, vous obtenez un arbre dans lequel presque tous les n≈ìuds sont √† moiti√© vides. </font><font style="vertical-align: inherit;">Ce n'est pas une utilisation tr√®s efficace de l'espace. </font><font style="vertical-align: inherit;">On peut faire mieux.</font></font><br>
<br>
<a name="10"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S√©par√© ou non?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le cas de l'insertion de donn√©es tri√©es, vous pouvez apporter une petite modification √† l'algorithme d'insertion. </font><font style="vertical-align: inherit;">Si le n≈ìud dans lequel vous souhaitez coller la valeur est plein, ne le cassez pas. </font><font style="vertical-align: inherit;">Cr√©ez simplement un nouveau n≈ìud vide et collez la valeur dans le n≈ìud parent. </font><font style="vertical-align: inherit;">Ensuite, lorsque vous ins√©rez les valeurs suivantes (qui sont plus grandes que les pr√©c√©dentes), vous les ins√©rez dans un nouveau n≈ìud vide. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour conserver les propri√©t√©s de l'arbre B, apr√®s toutes les insertions, il est n√©cessaire de trier les n≈ìuds les plus √† droite de chaque couche de l'arbre (sauf la racine) et de diviser uniform√©ment les valeurs de ce n≈ìud extr√™me et de son voisin gauche. </font><font style="vertical-align: inherit;">Vous obtenez donc le plus petit arbre possible.</font></font><br>
<br>
<a name="11"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Propri√©t√©s de l'arborescence HIBP</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors de la conception d'un arbre B, vous devez s√©lectionner son ordre. </font><font style="vertical-align: inherit;">Il montre combien de valeurs peuvent √™tre stock√©es dans un n≈ìud, ainsi que le nombre d'enfants que le n≈ìud peut avoir. </font><font style="vertical-align: inherit;">En manipulant ce param√®tre, nous pouvons manipuler la hauteur de l'arbre, la taille binaire du n≈ìud, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans HIBP, nous avons des </font></font><code>555278657</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hachages. </font><font style="vertical-align: inherit;">Supposons que nous voulons un arbre de trois hauteurs (nous n'avons donc pas besoin de plus de trois op√©rations de lecture pour v√©rifier la pr√©sence d'un hachage). </font><font style="vertical-align: inherit;">Nous devons trouver une valeur de M telle que </font></font><code>logM(555278657) &lt; 3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">J'ai choisi 1024. Ce n'est pas la plus petite valeur possible, mais cela permet d'ins√©rer plus de hachages et de conserver la hauteur de l'arbre.</font></font><br>
<br>
<a name="12"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fichier de sortie</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le fichier source HIBP a une taille de 22,8 Go. </font><font style="vertical-align: inherit;">Le fichier de sortie avec l'arborescence B est de 12,4 Go. </font><font style="vertical-align: inherit;">Il faut environ 11 minutes pour le cr√©er sur ma machine (Intel Core i7-6700, 3,4 GHz, 16 Go de RAM), disque dur (pas SSD).</font></font><br>
<br>
<a name="13"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rep√®res</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'option B-tree montre un assez bon r√©sultat:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">temps [Œºs] | </font><font style="vertical-align: inherit;">% |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| -----------------: | ------------: | ------------: |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">okon | </font><font style="vertical-align: inherit;">49 | </font><font style="vertical-align: inherit;">100 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">grep '^ hash' | </font><font style="vertical-align: inherit;">135'350'000 | </font><font style="vertical-align: inherit;">276'224'489 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">grep | </font><font style="vertical-align: inherit;">135'480'000 | </font><font style="vertical-align: inherit;">276'489'795 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">C ++ ligne par ligne | </font><font style="vertical-align: inherit;">135'720'201 | </font><font style="vertical-align: inherit;">276'980'002 |</font></font></pre><br>
<a name="14"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">okon - biblioth√®que et CLI</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme je l'ai dit, je voulais partager mon travail avec le monde. J'ai impl√©ment√© une biblioth√®que et une interface de ligne de commande pour traiter la base de donn√©es HIBP et rechercher rapidement les hachages. La recherche est si rapide qu'elle peut, par exemple, √™tre int√©gr√©e dans un gestionnaire de mots de passe et donner un retour √† l'utilisateur √† chaque pression sur une touche. Il existe de nombreuses utilisations possibles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La biblioth√®que a une interface C, elle peut donc √™tre utilis√©e presque partout. CLI est une CLI. Vous pouvez simplement construire et ex√©cuter (: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code est dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mon r√©f√©rentiel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avertissement: okon ne fournit pas encore d'interface pour ins√©rer des valeurs dans l'arbre B cr√©√©. </font><font style="vertical-align: inherit;">Il ne peut traiter que le fichier HIBP, cr√©er un arbre B et le rechercher. </font><font style="vertical-align: inherit;">Ces fonctions fonctionnent assez bien, j'ai donc d√©cid√© de partager le code et de continuer √† travailler sur l'insertion et d'autres fonctions possibles.</font></font><br>
<br>
<a name="15"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liens et discussion</font></font></h1><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Structure de Trie</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arbre B</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Site Web ai-je √©t√© pwned</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©p√¥t de code</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r / cpp</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r / s√©curit√©</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nouvelles des hackers</font></font></a></li>
</ul><br>
<a name="16"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Merci d'avoir lu</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(:</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr490906/index.html">Yandex a d√©ploy√© une version b√™ta d'un Aura - aura.top ind√©pendant. C'est top?</a></li>
<li><a href="../fr490908/index.html">Stockage des donn√©es de zone</a></li>
<li><a href="../fr490912/index.html">Comment nous, chez Sportmaster, avons choisi un syst√®me de mise en cache. Partie 1</a></li>
<li><a href="../fr490916/index.html">Probl√®mes d'interaction avec des √©quipes externes sur de grands projets</a></li>
<li><a href="../fr490918/index.html">Andrei Zaretsky, Alexander Trukhanov (suite): "Nous n'avions pas de nom, mais il y avait de l'arrogance"</a></li>
<li><a href="../fr490924/index.html">Qu'est-ce que Windows PowerShell et que mange-t-il? Partie 2: Introduction au langage de programmation</a></li>
<li><a href="../fr490926/index.html">Trajectoire Unity Ball 2D pour les d√©butants</a></li>
<li><a href="../fr490932/index.html">[Pr√©vision] Motornet - un r√©seau d'√©change de donn√©es pour les v√©hicules robotis√©s</a></li>
<li><a href="../fr490936/index.html">Cr√©er ML sur iOS</a></li>
<li><a href="../fr490938/index.html">Nous √©crivons des milliers de fichiers journaux √† la fois</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>