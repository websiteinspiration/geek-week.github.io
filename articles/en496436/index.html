<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ôåÔ∏è ü§∂üèª üå≠ IPFS on the server. Host sites from a laptop üèÇüèø üë®üèæ‚Äç‚öïÔ∏è ü§§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I often need to publish a static page or website, a demo with a web form or layout. Pouring somewhere like Jsfiddle every time is not always convenien...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>IPFS on the server. Host sites from a laptop</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/496436/"><img src="https://habrastorage.org/webt/h3/z3/5k/h3z35k4o7jwppvlkpbzqg46lcog.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I often need to publish a static page or website, a demo with a web form or layout. </font><font style="vertical-align: inherit;">Pouring somewhere like Jsfiddle every time is not always convenient, and editing statics in a localhost is much faster and more pleasant. </font><font style="vertical-align: inherit;">Problems begin when I need someone to show my work, or just open the same page from the phone. </font><font style="vertical-align: inherit;">We have to host all these endless working options and sketches, for each upload files again, screw vhosts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using IPFS, you can host sites on the Internet directly from your laptop, all updates of local files will be immediately applied on the Internet, and they do not need to be uploaded somewhere. </font><font style="vertical-align: inherit;">When the laptop is disconnected from the network, the site will still be available. </font><font style="vertical-align: inherit;">IPFS is like Bittorrent, just for the web. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the article, we will deploy the IPFS node on the server and try this technology in practice.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What is IPFS?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IPFS is a large, decentralized p2p network that is used as a file sharing service, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">web archive</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bittorrent replacement</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . All the cool examples of using IPFS in real projects can be found in the hall of fame on the official </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">awesome.ipfs.io</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> website </font><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Briefly, it works like this: stored files get their multicash and are divided into blocks that are scattered across all the interested nodes. </font><font style="vertical-align: inherit;">DHT is synchronized on the nodes; when a file is downloaded, blocks are collected from different (in theory, the nearest) nodes. </font><font style="vertical-align: inherit;">Moreover, to access the file or directory you do not need to raise your node, they are all accessible from the browser, which leads us to the popular feature: you can host sites on IPFS for free. </font><font style="vertical-align: inherit;">But only statics, updating any data more than once every few minutes is inconvenient because of the same hashes that form a link and change every time the file is changed (there is a permanent IPNS name system, but it is slow). </font><font style="vertical-align: inherit;">However, this did not stop the dudes from Orbitdb from flashing </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the database to IPFS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but there are some nuances. </font><font style="vertical-align: inherit;">Read more about the network device </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2>  </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suppose I have a node with which I distribute static sites for free, I go to them myself and sometimes bring my colleagues to look. The total amount of data is limited only by the size of my disk, and the download speed by the home Internet, what could be better? But there are a number of problems. Firstly, IPFS itself needs quite a bit of Internet and a solid piece of the processor, and even without traffic, it always takes some of the resources for DHT synchronization. Secondly, I mainly work with a laptop and keep all the files on it, and therefore it‚Äôs far from always that I have a homemade half-gigabyte fiber at hand. Short breaks for IPFS is not a problem, it keeps the cache in DHT for several hours, but it costs somewhere to leave for a couple of days, and now all your projects are happily spilling out of the network. You can stomp (‚Äúremember‚Äù) files on the desktop, but this will at least double the traffic,which is also not comme il faut. What to do? I tried to raise the node on the server to unload the laptop, but I still had to upload the files manually, like on a regular hosting. As a result, I smoked docks and APIs and wrote a simple utility to synchronize my local statics with the server.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4x/5l/xg/4x5lxggev2ibpeaonvsaglapaeg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IPFS has two separate implementations: go-ipfs and js-ipfs. </font><font style="vertical-align: inherit;">JS is closer to me, so I wrote on it. </font><font style="vertical-align: inherit;">I wanted the utility to be able to pick up folders with my sites, and regularly upload them to the network while I work. </font><font style="vertical-align: inherit;">The server side should catch the hashes of the folders and kick them so that the files are not lost.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installation and launch</font></font></h3><br>
<pre><code class="bash hljs">npm install ipfs -g</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Js-ipfs has a pretty detailed </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tutorial with examples</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , so:</font></font><br>
<br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/ipfs/js-ipfs.git
<span class="hljs-built_in">cd</span> js-ipfs<font></font>
npm install<font></font>
npm run build</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The node runs in several lines:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> IPFS = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ipfs'</span>)
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">const</span> node = <span class="hljs-keyword">await</span> IPFS.create()<font></font>
}<font></font>
main()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Configs and seeds for it are registered right there, but this is enough to start.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We write functionality</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, you need to transfer the files to the node and upload them to IPFS. To do this, use </font></font><code>node.add</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with the option </font></font><code>{ recursive: true }</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for folders. The address can be passed in arguments at startup, and saved by command. It is important to record only the last hash - it is from the root folder: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zt/6z/ne/zt6znegn7ek9vtqs_qudycx3rzq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The entire folder has successfully gone to the network. The site will be opened via the link, and the folder itself can be checked on the IPFS webmord: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ka/gu/g9/kagug9rmdcsgfhyb_d-rh21s4sc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, to make the saving process convenient, I added the saving with the version number and publication in IPNS via</font></font><code>node.name.publish</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. But saving manually is boring! I want to be able to watch the updated site as quickly as I see changes in the localhost, which means that the update should happen automatically. And if I suddenly forget to save something, turn off the laptop and go home, the current version will be saved not only in the editor, but also on the network. We will make auto-saves by default once every 10 minutes, with the ability to change the interval for different rates of work. By the way, if the files have not changed since the last save, the hash will not change either. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0a/yw/qp/0aywqpsnhwustcwcvvoxjyjnvky.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cool, but so far we are distributing all the files from the local machine. It's time to connect the server node! We take the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">experimental pubsub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , get the topic from the arguments at startup and try to deliver the save hash: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/u9/bp/ne/u9bpnezt7fddmxpo3oworszo7rw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hurray! The small thing is to make the server store all received hashes and kick them (</font></font><code>node.pin.add</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), and teach the client to cut down his node when it is not needed ( </font></font><code>node.stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/63/2e/t_/632et_yscta-mwwbzhj5a9mac9y.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is the list of downloads on the server node</font></font><br>
</i><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What is the result?</font></font></h2><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When I sit down to write code, it is automatically saved in IPFS</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All versions are always available via personal links / ipfs / Qm ...</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I can publish the site in IPNS so as not to send a bunch of links to the client</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The local node wakes up only to upload files and contact the server, then it falls asleep back</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Locally, I have only one copy of the site, the traffic to single downloads of new versions is much less than the background traffic of the IPFS node</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I can finally work in a localhost without a headache with versioning</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All this happiness costs me the price of the cheapest VPS, there are still enough resources and should be enough somewhere else for a year ahead, after which it will be possible to buy another server or archive the old one. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, using IPFS, you can do much more interesting things. </font><font style="vertical-align: inherit;">I definitely want to bring this utility to mind and write a new one, with gooey. </font><font style="vertical-align: inherit;">In the meantime, keep the site that we wrote and hosted all this time: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://ipfs.slipner.ru/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - with the domain </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://ipfs.io/ipfs/QmeV7MVFSiWJr8u4dhXzEAoJgbVJsHvSUqjsbQyNL4WrD2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - IPFS </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ://gt </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">/ ipns / QmTjKBMJS8owPUXQFSMjoR4kqFNXXVKB7DqNGgyqibxuff /</font></a><font style="vertical-align: inherit;"> - IPNS via the official gate</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opera browser with IPFS support</font></font></h2><br>
<img src="https://habrastorage.org/webt/ta/4v/ga/ta4vganttbqfbcoaahcp6e3cd8w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Just a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">few days ago,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Opera Software rolled out the first browser with native IPFS support. </font><font style="vertical-align: inherit;">So far, however, only in the mobile version for Android. </font><font style="vertical-align: inherit;">This means that it can directly access the IPFS network without web gateways! </font><font style="vertical-align: inherit;">We are waiting for the support to be added to the desktop version.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/9fa/cf4/a34/9facf4a348ef01048b4eb5e16ae66daa.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en496422/index.html">How to get to work in an international game dev: a tutorial from a 3D-modeler from Ulyanovsk, who became a co-owner of the studio</a></li>
<li><a href="../en496424/index.html">Show me a solution because of which the developers will not argue, and I will put you a beer</a></li>
<li><a href="../en496426/index.html">CRM implementation in a crisis: help business or a dead issue?</a></li>
<li><a href="../en496428/index.html">How to save the market for language courses during a pandemic?</a></li>
<li><a href="../en496434/index.html">Antiquities: the second life of the cassette portable</a></li>
<li><a href="../en496438/index.html">The obvious difference between a leader and a manager</a></li>
<li><a href="../en496442/index.html">Queue in the backend: what are we standing for and where to start our journey?</a></li>
<li><a href="../en496444/index.html">Microsoft Azure Virtual Training Day: Artificial Intelligence for Developers</a></li>
<li><a href="../en496446/index.html">Kanban Method Perception Evolution</a></li>
<li><a href="../en496448/index.html">Realistic combat AI for 2D game</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>