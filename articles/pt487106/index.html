<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöñ üè´ üëó Verificador RunUO do analisador PVS-Studio üëü üçÜ üé∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este artigo √© dedicado √† verifica√ß√£o do projeto RunUO usando o analisador est√°tico PVS-Studio. RunUO √© um emulador de software de servidor para Ultima...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Verificador RunUO do analisador PVS-Studio</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/487106/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/pk/vz/nb/pkvznbl6d22oijuluuu2xfoztcs.png" alt="Imagem 1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este artigo √© dedicado √† verifica√ß√£o do projeto RunUO usando o analisador est√°tico PVS-Studio. </font><font style="vertical-align: inherit;">RunUO √© um emulador de software de servidor para Ultima Online, um jogo que conquistou os cora√ß√µes de muitos f√£s de MMORPG.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introdu√ß√£o</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RunUO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© um emulador de software para servidor para o MMORPG Ultima Online. O objetivo deste projeto √© criar software est√°vel que possa competir com os servidores oficiais da EA Games. O RunUO foi criado em 2002, mas n√£o perde relev√¢ncia e √© usado ativamente at√© hoje. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O objetivo da verifica√ß√£o do projeto √© popularizar o t√≥pico da an√°lise est√°tica. Verificamos v√°rios projetos - jogos ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), bibliotecas ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), mensageiros ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), navegadores ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) e muito mais ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemplo)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) para atrair a aten√ß√£o de um p√∫blico diversificado. Com esses artigos, estamos tentando chamar a aten√ß√£o para a import√¢ncia do uso da an√°lise est√°tica no desenvolvimento. A an√°lise est√°tica torna o c√≥digo mais confi√°vel e seguro. Al√©m disso, com seu uso regular, voc√™ pode encontrar e eliminar erros nos est√°gios iniciais. Isso economiza tempo e esfor√ßo aos desenvolvedores, porque ningu√©m deseja gastar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50 horas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pesquisando o erro que o analisador pode encontrar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m ajudamos a comunidade de c√≥digo aberto. </font><font style="vertical-align: inherit;">Atrav√©s de artigos com erros encontrados, contribu√≠mos para o desenvolvimento de c√≥digo aberto. </font><font style="vertical-align: inherit;">No entanto, nos artigos n√£o analisamos todos os avisos. </font><font style="vertical-align: inherit;">Alguns avisos pareciam muito chatos para entrarmos no artigo, outros eram falsos positivos etc. </font><font style="vertical-align: inherit;">Portanto, estamos prontos para fornecer uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">licen√ßa gratuita</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para projetos de c√≥digo aberto. </font><font style="vertical-align: inherit;">Al√©m disso, o que nos pareceu entediante para o artigo pode parecer bastante interessante para os desenvolvedores do projeto que est√° sendo testado, porque os desenvolvedores do projeto ainda est√£o mais conscientes dos problemas mais cr√≠ticos.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peda√ßos de c√≥digo que chamaram a aten√ß√£o ao examinar o relat√≥rio do analisador</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3010 √â necess√°rio que o valor de retorno da fun√ß√£o 'Intern' seja utilizado. </font><font style="vertical-align: inherit;">BasePaintedMask.cs 49</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> <span class="hljs-title">Intern</span>(<span class="hljs-params"> <span class="hljs-keyword">string</span> str </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( str == <span class="hljs-literal">null</span> )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( str.Length == <span class="hljs-number">0</span> )
    <span class="hljs-keyword">return</span> String.Empty;<font></font>
<font></font>
  <span class="hljs-keyword">return</span> String.Intern( str );<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">BasePaintedMask</span>(<span class="hljs-params"> <span class="hljs-keyword">string</span> staffer, <span class="hljs-keyword">int</span> itemid </span>)
                            : <span class="hljs-title">base</span>(<span class="hljs-params"> itemid + Utility.Random( <span class="hljs-number">2</span> </span>) )</span><font></font>
{<font></font>
  m_Staffer = staffer;<font></font>
<font></font>
  Utility.Intern( m_Staffer );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O valor de retorno do m√©todo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intern ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o </font><font style="vertical-align: inherit;">√© </font><font style="vertical-align: inherit;">levado em considera√ß√£o em nenhum lugar, conforme indicado pelo analisador. </font><font style="vertical-align: inherit;">Talvez seja um bug ou c√≥digo redundante. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3017 Um padr√£o foi detectado: (o item √© BasePotion) || </font><font style="vertical-align: inherit;">((o item √© BasePotion) &amp;&amp; ...). </font><font style="vertical-align: inherit;">A express√£o √© excessiva ou cont√©m um erro l√≥gico. </font><font style="vertical-align: inherit;">Cleanup.cs 137</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">IsBuggable</span>(<span class="hljs-params"> Item item </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( item <span class="hljs-keyword">is</span> Fists )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( item <span class="hljs-keyword">is</span> ICommodity || item <span class="hljs-keyword">is</span> Multis.BaseBoat<font></font>
    || item <span class="hljs-keyword">is</span> Fish || item <span class="hljs-keyword">is</span> BigFish<font></font>
    || item <span class="hljs-keyword">is</span> BasePotion || item <span class="hljs-keyword">is</span> Food || item <span class="hljs-keyword">is</span> CookableFood<font></font>
    || item <span class="hljs-keyword">is</span> SpecialFishingNet || item <span class="hljs-keyword">is</span> BaseMagicFish<font></font>
    || item <span class="hljs-keyword">is</span> Shoes || item <span class="hljs-keyword">is</span> Sandals<font></font>
    || item <span class="hljs-keyword">is</span> Boots || item <span class="hljs-keyword">is</span> ThighBoots<font></font>
    || item <span class="hljs-keyword">is</span> TreasureMap || item <span class="hljs-keyword">is</span> MessageInABottle<font></font>
    || item <span class="hljs-keyword">is</span> BaseArmor || item <span class="hljs-keyword">is</span> BaseWeapon<font></font>
    || item <span class="hljs-keyword">is</span> BaseClothing<font></font>
    || ( item <span class="hljs-keyword">is</span> BaseJewel &amp;&amp; Core.AOS )<font></font>
    || ( item <span class="hljs-keyword">is</span> BasePotion &amp;&amp; Core.ML )<font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem subexpress√µes que podem ser simplificadas. </font><font style="vertical-align: inherit;">Vou escrev√™-los para que fique mais claro:</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (item <span class="hljs-keyword">is</span> BasePotion || ( item <span class="hljs-keyword">is</span> BasePotion &amp;&amp; Core.ML ))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suponha, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artigo √© BasePotion = a verdade</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ent√£o a condi√ß√£o √© verdadeira, apesar da </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Core.ML</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Se o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item for BasePotion = false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , em seguida, a condi√ß√£o √© falsa, mais uma vez, independentemente do valor </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Core.ML</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Geralmente, esse c√≥digo √© simplesmente redundante; no entanto, existem situa√ß√µes piores em que o programador cometeu um erro e escreveu a vari√°vel errada na segunda subexpress√£o. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3031 Uma verifica√ß√£o excessiva pode ser simplificada. </font><font style="vertical-align: inherit;">O '||' </font><font style="vertical-align: inherit;">O operador est√° cercado pelas express√µes opostas 'bPlayerOnly' e '! bPlayerOnly'. </font><font style="vertical-align: inherit;">BaseCreature.cs 3005</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">double</span> <span class="hljs-title">GetFightModeRanking</span>(<span class="hljs-params"> Mobile m,
                                           FightMode acqType,
                                           <span class="hljs-keyword">bool</span> bPlayerOnly </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( ( bPlayerOnly &amp;&amp; m.Player ) ||  !bPlayerOnly )<font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este c√≥digo √© redundante ou incorreto. </font><font style="vertical-align: inherit;">O problema dele √© que nos dois lados de '||' </font><font style="vertical-align: inherit;">s√£o diferentes no sentido de subexpress√£o. </font><font style="vertical-align: inherit;">Se cortarmos assim:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> ( m.Player || !bPlayerOnly )</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ent√£o nada vai mudar. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3001 Existem sub-express√µes id√™nticas 'a√ß√£o √© SmallBrickHouseDeed' √† esquerda e √† direita da '||' </font><font style="vertical-align: inherit;">operador. </font><font style="vertical-align: inherit;">RealEstateBroker.cs 132</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">ComputePriceFor</span>(<span class="hljs-params"> HouseDeed deed </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">int</span> price = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( deed <span class="hljs-keyword">is</span> SmallBrickHouseDeed ||    <span class="hljs-comment">// &lt;=</span>
       deed <span class="hljs-keyword">is</span> StonePlasterHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> FieldStoneHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> SmallBrickHouseDeed ||    <span class="hljs-comment">// &lt;=</span>
       deed <span class="hljs-keyword">is</span> WoodHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> WoodPlasterHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> ThatchedRoofCottageDeed )<font></font>
      ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acho que n√£o vale a pena explicar nada aqui, o pr√≥ximo c√≥digo ou o c√≥digo errado ou redundante. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3067 √â poss√≠vel que o bloco 'else' tenha sido esquecido ou comentado, alterando a l√≥gica de opera√ß√£o do programa. </font><font style="vertical-align: inherit;">BaseHouse.cs 1558</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SetLockdown</span>(<span class="hljs-params"> Item i, <span class="hljs-keyword">bool</span> locked, <span class="hljs-keyword">bool</span> checkContains </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( m_LockDowns == <span class="hljs-literal">null</span> )
    <span class="hljs-keyword">return</span>;<font></font>
<font></font>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">region</span> Mondain's Legacy</span>
  <span class="hljs-keyword">if</span> ( i <span class="hljs-keyword">is</span> BaseAddonContainer )<font></font>
    i.Movable = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">else</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">endregion</span></span><font></font>
<font></font>
  i.Movable = !locked;<font></font>
  i.IsLockedDown = locked;<font></font>
<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um aviso raro. </font><font style="vertical-align: inherit;">O analisador considerou suspeito a formata√ß√£o do c√≥digo ap√≥s a diretiva </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#endregion. </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ n√£o l√™ o c√≥digo, parece uma linha</font></font><br>
<br>
<pre><code class="cs hljs">i.Movable = !locked;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ser√° executado em qualquer caso, independentemente da vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Talvez chaves aqui tenham sido esquecidas ... Em geral, os desenvolvedores devem verificar esse c√≥digo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3043 A l√≥gica operacional do c√≥digo n√£o corresponde √† sua formata√ß√£o. </font><font style="vertical-align: inherit;">A instru√ß√£o √© recuada √† direita, mas √© sempre executada. </font><font style="vertical-align: inherit;">√â poss√≠vel que estejam faltando colchetes. </font><font style="vertical-align: inherit;">Terremoto.cs 57</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnCast</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( Core.AOS )<font></font>
  {<font></font>
    damage = m.Hits / <span class="hljs-number">2</span>;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> ( !m.Player )<font></font>
      damage = Math.Max( Math.Min( damage, <span class="hljs-number">100</span> ), <span class="hljs-number">15</span> );<font></font>
      damage += Utility.RandomMinMax( <span class="hljs-number">0</span>, <span class="hljs-number">15</span> );            <span class="hljs-comment">// &lt;=</span><font></font>
<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aparelhos cacheados podem estar ausentes neste c√≥digo. </font><font style="vertical-align: inherit;">Esta conclus√£o pode ser feita devido √† formata√ß√£o estranha do c√≥digo no corpo de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if (! M.Player)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3083 Chamada n√£o segura do evento 'ServerStarted', NullReferenceException √© poss√≠vel. </font><font style="vertical-align: inherit;">Considere atribuir um evento a uma vari√°vel local antes de invoc√°-lo. </font><font style="vertical-align: inherit;">EventSink.cs 921</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InvokeServerStarted</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( ServerStarted != <span class="hljs-literal">null</span> )<font></font>
    ServerStarted();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse m√©todo usa uma chamada potencialmente insegura para o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">manipulador de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eventos </font><i><font style="vertical-align: inherit;">RefreshStarted</font></i><font style="vertical-align: inherit;"> , como indica o analisador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por que isso √© perigoso? Imagine essa situa√ß√£o. O evento </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerStarted</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> possui apenas um assinante. E, no momento entre a verifica√ß√£o de nulo e a chamada direta do manipulador de eventos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerStarted ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em outro encadeamento, foi cancelada a inscri√ß√£o deste evento. Isso lan√ßar√° uma </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A maneira mais f√°cil de evitar essa situa√ß√£o √© fornecer uma chamada de evento segura usando o operador '?.':</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InvokeServerStarted</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ServerStarted?.Invoke();<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3054 Bloqueio potencialmente perigoso verificado duas vezes. Use vari√°veis ‚Äã‚Äãvol√°teis ou primitivas de sincroniza√ß√£o para evitar isso. Item.cs 1624</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> Packet m_RemovePacket;<font></font>
....<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">object</span> _rpl = <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>();
<span class="hljs-keyword">public</span> Packet RemovePacket<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">lock</span> (_rpl)<font></font>
      {<font></font>
        <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
          m_RemovePacket = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
          m_RemovePacket.SetStatic();<font></font>
        }<font></font>
      }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> m_RemovePacket;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O aviso do analisador est√° associado ao uso inseguro do padr√£o de bloqueio verificado duas vezes. Como voc√™ pode ver no c√≥digo acima, um bloqueio de verifica√ß√£o dupla foi aplicado para implementar o padr√£o generativo - Loners. Quando tentamos obter uma inst√¢ncia da classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Packet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> acessando a propriedade </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o getter verifica o campo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para que a igualdade seja zero. Se a verifica√ß√£o for aprovada, entraremos no corpo da instru√ß√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , onde o campo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© </font><i><font style="vertical-align: inherit;">inicializado</font></i><font style="vertical-align: inherit;"> . Uma situa√ß√£o interessante surge no momento em que o encadeamento principal j√° inicializou a vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> por meio do construtor, mas ainda n√£o chamou o m√©todo</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SetStatic ().</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Teoricamente, outro encadeamento pode acessar a propriedade </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no momento muito inconveniente. A verifica√ß√£o </font><font style="vertical-align: inherit;">de igualdade de zero em </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o falhar√° mais, e o encadeamento de chamada receber√° um link para um objeto incompletamente pronto para uso. Para resolver esse problema, </font><font style="vertical-align: inherit;">voc√™ pode criar uma vari√°vel intermedi√°ria da classe </font><i><font style="vertical-align: inherit;">Packet</font></i><font style="vertical-align: inherit;"> no corpo da instru√ß√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , inicializ√°-la por meio de uma chamada de construtor e do m√©todo </font><i><font style="vertical-align: inherit;">SetStatic ()</font></i><font style="vertical-align: inherit;"> e atribu√≠-la √† vari√°vel </font><i><font style="vertical-align: inherit;">m_RemovePacket</font></i><font style="vertical-align: inherit;"> . Nesse caso, o corpo da instru√ß√£o </font><i><font style="vertical-align: inherit;">lock</font></i><font style="vertical-align: inherit;"> pode ser assim:</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">lock</span> (_rpl)<font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    Packet instance = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
    instance.SetStatic();<font></font>
    m_RemovePacket = instance;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O problema parece estar corrigido e o c√≥digo funcionar√° conforme o esperado. Mas isso n√£o √© verdade. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° mais um ponto: o analisador n√£o sugere apenas o uso da palavra-chave </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vol√°til</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Na vers√£o do programa, o compilador pode executar a otimiza√ß√£o e reordenar as linhas da chamada para o m√©todo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SetStatic ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e atribuir a vari√°vel de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inst√¢ncia</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ao campo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (do ponto de vista do compilador, a sem√¢ntica do programa n√£o ser√° violada). E voltamos novamente ao mesmo ponto em que come√ßamos - a possibilidade de obter a vari√°vel n√£o inicializada </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. √â imposs√≠vel dizer exatamente quando essa reordena√ß√£o pode ocorrer e se ocorrer√°: pode ser afetada pela vers√£o do CLR, pela arquitetura do processador usado etc. Ainda vale a pena proteger desse cen√°rio, e uma das solu√ß√µes (no entanto, n√£o a mais produtiva) ser√° usar a palavra-chave </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vol√°til</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Uma vari√°vel que ser√° declarada com o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modificador vol√°til</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o estar√° sujeita a permuta√ß√µes durante a otimiza√ß√£o pelo compilador. Um c√≥digo finalmente corrigido pode ser assim:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> Packet m_RemovePacket;<font></font>
....<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">object</span> _rpl = <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>();
<span class="hljs-keyword">public</span> Packet RemovePacket<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">lock</span> (_rpl)<font></font>
      {<font></font>
        <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
          Packet instance = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
          instance.SetStatic();<font></font>
          m_RemovePacket = instance;<font></font>
        }<font></font>
      }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> m_RemovePacket;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Äs vezes, o uso de um </font><font style="vertical-align: inherit;">campo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vol√°til</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pode ser indesej√°vel devido √† sobrecarga de acessar esse campo. N√£o vamos nos aprofundar neste t√≥pico em detalhes, simplesmente observando que no exemplo em considera√ß√£o, um registro de campo at√¥mico √© necess√°rio apenas uma vez (quando a propriedade √© acessada pela primeira vez); no entanto, declarar o campo como </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vol√°til</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> far√° com que o compilador fa√ßa sua leitura e grava√ß√£o at√¥mica isso pode n√£o ser o ideal em termos de desempenho. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, outra abordagem para corrigir esse aviso do analisador para evitar sobrecarga adicional ao declarar um </font><font style="vertical-align: inherit;">campo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vol√°til</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© usar o tipo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy &lt;T&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para fazer backup do campo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em vez de verificar novamente o bloqueio. </font><font style="vertical-align: inherit;">Nesse caso, o corpo do getter pode ser substitu√≠do pelo m√©todo inicializador, que ser√° passado ao construtor da inst√¢ncia </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy &lt;T&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> Lazy&lt;Packet&gt; m_RemovePacket = <span class="hljs-keyword">new</span> Lazy&lt;Packet&gt;(() =&gt;<font></font>
  {<font></font>
    Packet instance = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
    instance.SetStatic();<font></font>
    <span class="hljs-keyword">return</span> instance;<font></font>
  }, LazyThreadSafetyMode.ExecutionAndPublication);<font></font>
<font></font>
....<font></font>
<span class="hljs-keyword">public</span> Packet RemovePacket<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> m_RemovePacket.Value;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O m√©todo inicializador ser√° chamado uma vez, quando o tipo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for acessado pela primeira vez, </font><font style="vertical-align: inherit;">e a seguran√ßa de streaming no caso de acessar a propriedade de v√°rios threads ao mesmo tempo ser√° garantida pelo tipo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy &lt;T&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (o modo de seguran√ßa do thread √© controlado pelo segundo par√¢metro do construtor </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3131 A express√£o 'target' √© verificada quanto √† compatibilidade com o tipo 'IAxe', mas √© convertida no tipo 'Item'. </font><font style="vertical-align: inherit;">HarvestTarget.cs 61</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnTarget</span>(<span class="hljs-params"> Mobile <span class="hljs-keyword">from</span>, <span class="hljs-keyword">object</span> targeted </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( m_System <span class="hljs-keyword">is</span> Lumberjacking &amp;&amp;<font></font>
            targeted <span class="hljs-keyword">is</span> IAxe &amp;&amp; m_Tool <span class="hljs-keyword">is</span> BaseAxe )<font></font>
  {<font></font>
    IAxe obj = (IAxe)targeted;<font></font>
    Item item = (Item)targeted;<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alvo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vari√°vel </font><font style="vertical-align: inherit;">foi verificada por pertencer a digitar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iAXE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas </font><font style="vertical-align: inherit;">ningu√©m verificou </font><font style="vertical-align: inherit;">por pertencer a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , como os relat√≥rios de an√°lise. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3070 A vari√°vel n√£o inicializada 'Zero' √© usada ao inicializar a vari√°vel 'm_LastMobile'. Serial.cs 29</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> Serial : IComparable, IComparable&lt;Serial&gt;<font></font>
{<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> m_Serial;<font></font>
<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Serial m_LastMobile = Zero;                <span class="hljs-comment">// &lt;=</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Serial m_LastItem = <span class="hljs-number">0x40000000</span>;<font></font>
<font></font>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Serial LastMobile { .... }
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Serial LastItem { .... }<font></font>
<font></font>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> Serial MinusOne = <span class="hljs-keyword">new</span> Serial( <span class="hljs-number">-1</span> );
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> Serial Zero = <span class="hljs-keyword">new</span> Serial( <span class="hljs-number">0</span> );     <span class="hljs-comment">// &lt;=</span><font></font>
  ....<font></font>
  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Serial</span>(<span class="hljs-params"> <span class="hljs-keyword">int</span> serial </span>)</span><font></font>
  {<font></font>
    m_Serial = serial;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como tal, n√£o h√° erro aqui, no entanto, escrever isso n√£o √© muito bom. Devido √† atribui√ß√£o de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_LastMobile ao</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> valor de um </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zero</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o inicializado </font><font style="vertical-align: inherit;">, uma estrutura ser√° criada com o construtor padr√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serial ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o que levar√° √† inicializa√ß√£o de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_Serial = 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . E isso, por sua vez, √© equivalente a chamar o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">novo Serial (0)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . De fato, os desenvolvedores t√™m sorte de que o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√∫mero de s√©rie</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> seja igual a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , se houvesse algum outro valor, isso levaria a um erro. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3063 Uma parte da express√£o condicional sempre √© verdadeira se for avaliada: m_Serial &lt;= 0x7FFFFFFF. Serial.cs 83</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> IsItem<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> ( m_Serial &gt;= <span class="hljs-number">0x40000000</span> &amp;&amp; m_Serial &lt;= <span class="hljs-number">0x7FFFFFFF</span> );<font></font>
  }<font></font>
}</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x7FFFFFFF</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© o valor m√°ximo poss√≠vel que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int32</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pode conter </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Portanto, qualquer que seja o valor da vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_Serial</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ela ser√° menor ou igual a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x7FFFFFFF</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3004 A instru√ß√£o 'then' √© equivalente √† instru√ß√£o 'else'. </font><font style="vertical-align: inherit;">Serialization.cs 1571</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteDeltaTime</span>(<span class="hljs-params"> DateTime <span class="hljs-keyword">value</span> </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">try</span> <font></font>
  { <font></font>
    d = <span class="hljs-keyword">new</span> TimeSpan( ticks-now ); <font></font>
  }<font></font>
  <span class="hljs-keyword">catch</span> <font></font>
  {<font></font>
    <span class="hljs-keyword">if</span>( ticks &lt; now ) <font></font>
      d = TimeSpan.MaxValue; <font></font>
    <span class="hljs-keyword">else</span> <font></font>
      d = TimeSpan.MaxValue;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O analisador avisa sobre um c√≥digo suspeito no qual as ramifica√ß√µes verdadeira e falsa da </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instru√ß√£o if</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> coincidem completamente. </font><font style="vertical-align: inherit;">Talvez um dos ramos deva ter </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TimeSpan.MinValue. </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O mesmo c√≥digo foi encontrado em v√°rios locais: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V3004 A instru√ß√£o 'then' √© equivalente √† instru√ß√£o 'else'. </font><font style="vertical-align: inherit;">Item.cs 2103</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Serialize</span>(<span class="hljs-params"> GenericWriter writer </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>( ticks &lt; now ) <font></font>
    d = TimeSpan.MaxValue; <font></font>
  <span class="hljs-keyword">else</span> <font></font>
    d = TimeSpan.MaxValue;<font></font>
  <font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V3004 A instru√ß√£o 'then' √© equivalente √† instru√ß√£o 'else'. </font><font style="vertical-align: inherit;">Serialization.cs 383</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteDeltaTime</span>(<span class="hljs-params"> DateTime <span class="hljs-keyword">value</span> </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>( ticks &lt; now ) <font></font>
    d = TimeSpan.MaxValue; <font></font>
  <span class="hljs-keyword">else</span> <font></font>
    d = TimeSpan.MaxValue;<font></font>
  <font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu usei ‚ÄúThis‚Äù por um motivo, √© muito prov√°vel que, entre outras coisas, isso n√£o ocorra sem copiar e colar, esses fragmentos de c√≥digo parecem muito dolorosos. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3051 Uma convers√£o de tipo excessiva. </font><font style="vertical-align: inherit;">O objeto j√° √© do tipo 'Item'. </font><font style="vertical-align: inherit;">Mobile.cs 11237</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> Item Talisman<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> FindItemOnLayer( Layer.Talisman ) <span class="hljs-keyword">as</span> Item;<font></font>
  }<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> Item <span class="hljs-title">FindItemOnLayer</span>(<span class="hljs-params"> Layer layer </span>)</span><font></font>
{<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este aviso analisador pode ser obtido se houver uso excessivo do </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> operador </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">N√£o h√° erro nesta se√ß√£o do c√≥digo, mas tamb√©m n√£o faz sentido converter o objeto em seu pr√≥prio tipo. </font><font style="vertical-align: inherit;">Aviso do </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3148 O valor potencial 'nulo' da convers√£o de 'toSet' para um tipo de valor pode levar a NullReferenceException. </font><font style="vertical-align: inherit;">Properties.cs 502</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ConstructFromString</span>(<span class="hljs-params"> .... </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">object</span> toSet;
  <span class="hljs-keyword">bool</span> isSerial = IsSerial( type );<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( isSerial ) <span class="hljs-comment">// mutate into int32</span>
    type = m_NumericTypes[<span class="hljs-number">4</span>];<font></font>
<font></font>
  ....<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">value</span> == <span class="hljs-literal">null</span> )<font></font>
  {<font></font>
    toSet = <span class="hljs-literal">null</span>;<font></font>
  }<font></font>
  ....<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( isSerial ) <span class="hljs-comment">// mutate back</span><font></font>
    toSet = (Serial)((Int32)toSet);<font></font>
<font></font>
  constructed = toSet;<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesta se√ß√£o do c√≥digo, estamos interessados ‚Äã‚Äãno caso em que o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da vari√°vel </font><font style="vertical-align: inherit;">√© </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Em seguida, a vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toSet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tamb√©m </font><i><font style="vertical-align: inherit;">√© </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nula</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Al√©m disso, se a vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isSerial == true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toSet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© </font><i><font style="vertical-align: inherit;">convertido</font></i><font style="vertical-align: inherit;"> em </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int32</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o que levar√° a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NRE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode corrigir esse c√≥digo adicionando, por exemplo, 0 por padr√£o:</font></font><br>
<br>
<pre><code class="cs hljs">toSet = (Serial)((Int32)(toSet ?? <span class="hljs-number">0</span>));</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3031 Uma verifica√ß√£o excessiva pode ser simplificada. </font><font style="vertical-align: inherit;">O '||' </font><font style="vertical-align: inherit;">O operador est√° cercado pelas express√µes opostas 'pack == null' e 'pack! = null'. </font><font style="vertical-align: inherit;">BODBuyGump.cs 64</font></font><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnResponse</span>(<span class="hljs-params">Server.Network.NetState sender, RelayInfo info</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> ( (pack == <span class="hljs-literal">null</span>) ||<font></font>
       ((pack != <span class="hljs-literal">null</span>) &amp;&amp;<font></font>
        (!pack.CheckHold(<font></font>
                m_From,<font></font>
                item,<font></font>
                <span class="hljs-literal">true</span>,
                <span class="hljs-literal">true</span>,
                <span class="hljs-number">0</span>,<font></font>
                item.PileWeight + item.TotalWeight)) ) )<font></font>
  {<font></font>
    pv.SayTo(m_From, <span class="hljs-number">503204</span>);<font></font>
    m_From.SendGump(<span class="hljs-keyword">new</span> BOBGump(m_From, m_Book, m_Page, <span class="hljs-literal">null</span>));<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este c√≥digo pode ser simplificado, como o analisador relata: </font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> ((pack == <span class="hljs-literal">null</span>) || ((pack != <span class="hljs-literal">null</span>) &amp;&amp; (!pack.CheckHold(....))))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä esquerda e √† direita do operador '||' </font><font style="vertical-align: inherit;">s√£o o oposto no significado da express√£o. </font><font style="vertical-align: inherit;">Aqui, o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pacote de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verifica√ß√£o </font><i><font style="vertical-align: inherit;">! = Null</font></i><font style="vertical-align: inherit;"> √© redundante, porque antes disso o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pacote de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> condi√ß√µes opostas </font><i><font style="vertical-align: inherit;">== null √©</font></i><font style="vertical-align: inherit;"> verificado </font><font style="vertical-align: inherit;">e essas express√µes s√£o separadas pelo operador '||'. </font><font style="vertical-align: inherit;">Esta linha pode ser reduzida da seguinte forma:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (pack == <span class="hljs-literal">null</span> || !pack.CheckHold(....))</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3080 Poss√≠vel desrefer√™ncia nula. </font><font style="vertical-align: inherit;">Considere inspecionar 'vencedor'. </font><font style="vertical-align: inherit;">CTF.cs 1302</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Finish_Callback</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ....<font></font>
  CTFTeamInfo winner = ( teams.Count &gt; <span class="hljs-number">0</span> ? teams[<span class="hljs-number">0</span>] : <span class="hljs-literal">null</span> );<font></font>
<font></font>
  .... <font></font>
<font></font>
  m_Context.Finish( m_Context.Participants[winner.TeamID] <span class="hljs-keyword">as</span> Participant );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
dizer </font><i><font style="vertical-align: inherit;">times.Count</font></i><font style="vertical-align: inherit;"> √© </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ent√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vencedor = nulo.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Al√©m disso, no c√≥digo, a propriedade </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">winner.TeamID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© </font><i><font style="vertical-align: inherit;">acessada</font></i><font style="vertical-align: inherit;"> sem verificar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o que resultar√° no acesso por uma refer√™ncia nula. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3041 A express√£o foi implicitamente convertida do tipo 'int' para o tipo 'double'. Considere utilizar uma convers√£o de tipo expl√≠cita para evitar a perda de uma parte fracion√°ria. Um exemplo: double A = (double) (X) / Y; StormsEye.cs 87</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Gain</span>(<span class="hljs-params"> Mobile <span class="hljs-keyword">from</span>, Skill skill </span>)</span> <font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">from</span>.Player &amp;&amp; <font></font>
     ( skills.Total / skills.Cap ) &gt;= Utility.RandomDouble())<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este fragmento cont√©m o c√≥digo de opera√ß√£o de dividir as vari√°veis </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">skills.Total</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">skills.Cap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que s√£o do tipo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , e o resultado √© depois convertido implicitamente para digitar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">duplo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , como os relat√≥rios do analisador. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3085 O nome do campo 'typeofObject' em um tipo aninhado √© amb√≠guo. O tipo externo cont√©m campo est√°tico com nome id√™ntico. PropsGump.cs 744</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Type typeofObject = <span class="hljs-keyword">typeof</span>( <span class="hljs-keyword">object</span> );<font></font>
....<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GroupComparer</span> : <span class="hljs-title">IComparer</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Type typeofObject = <span class="hljs-keyword">typeof</span>( Object );<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typeofObject</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> foi criada nesta se√ß√£o do c√≥digo em uma classe aninhada </font><font style="vertical-align: inherit;">. Seu problema √© que na classe externa existe uma vari√°vel com o mesmo nome e podem ocorrer erros devido a isso. √â melhor n√£o permitir isso, a fim de reduzir a probabilidade de tais erros devido √† desaten√ß√£o. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3140 Os acessadores de propriedades usam diferentes campos de apoio. WallBanner.cs 77</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> m_IsRewardItem;<font></font>
<font></font>
[<span class="hljs-meta">CommandProperty( AccessLevel.GameMaster )</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> IsRewardItem<font></font>
{<font></font>
  <span class="hljs-keyword">get</span>{ <span class="hljs-keyword">return</span> m_IsRewardItem; }
  <span class="hljs-keyword">set</span>{ m_IsRewardItem = <span class="hljs-keyword">value</span>; InvalidateProperties(); }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> m_East;<font></font>
<font></font>
[<span class="hljs-meta">CommandProperty( AccessLevel.GameMaster )</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> East<font></font>
{<font></font>
  <span class="hljs-keyword">get</span>{ <span class="hljs-keyword">return</span> m_East; }
  <span class="hljs-keyword">set</span>{ m_IsRewardItem = <span class="hljs-keyword">value</span>; InvalidateProperties(); }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E aqui h√° um erro que apareceu devido a copiar e colar. O m√©todo de acesso </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definido</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da </font><font style="vertical-align: inherit;">propriedade </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">East</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> foi atribuir um valor para </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_East</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , n√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_IsRewardItem</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">
Avisos do </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio:</font></font></b> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3012 O operador '?:', Independentemente de sua express√£o condicional, sempre retorna um e o mesmo valor: 0xe7f. TreasureChestLevel2.cs 52 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V3012 O operador '?:', Independentemente de sua express√£o condicional, sempre retorna um e o mesmo valor: 0xe77. TreasureChestLevel2.cs 57</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SetChestAppearance</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">bool</span> UseFirstItemId = Utility.RandomBool();<font></font>
<font></font>
  <span class="hljs-keyword">switch</span>( Utility.RandomList( <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span> ) )<font></font>
  {<font></font>
    ....<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:<span class="hljs-comment">// Keg</span>
      <span class="hljs-keyword">this</span>.ItemID = ( UseFirstItemId ? <span class="hljs-number">0xe7f</span> : <span class="hljs-number">0xe7f</span> );
      <span class="hljs-keyword">this</span>.GumpID = <span class="hljs-number">0x3e</span>;
      <span class="hljs-keyword">break</span>;<font></font>
<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:<span class="hljs-comment">// Barrel</span>
      <span class="hljs-keyword">this</span>.ItemID = ( UseFirstItemId ? <span class="hljs-number">0xe77</span> : <span class="hljs-number">0xe77</span> );
      <span class="hljs-keyword">this</span>.GumpID = <span class="hljs-number">0x3e</span>;
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algum tipo de ilus√£o de escolha :) Independentemente do valor de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UseFirstItemId</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this.ItemID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ser√° </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xe7f</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no primeiro caso ou </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xe77</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no segundo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3066 Poss√≠vel ordem incorreta de argumentos passada para o m√©todo 'OnSwing': 'defender' e 'atacante'. </font><font style="vertical-align: inherit;">BaseWeapon.cs 1188</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">AbsorbDamageAOS</span>(<span class="hljs-params"> Mobile attacker,
                                    Mobile defender,
                                    <span class="hljs-keyword">int</span> damage </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> ( weapon != <span class="hljs-literal">null</span> )<font></font>
  {<font></font>
    defender.FixedParticles(<span class="hljs-number">0x3779</span>,
                            <span class="hljs-number">1</span>,
                            <span class="hljs-number">15</span>,
                            <span class="hljs-number">0x158B</span>,
                            <span class="hljs-number">0x0</span>,
                            <span class="hljs-number">0x3</span>,<font></font>
                            EffectLayer.Waist);<font></font>
    weapon.OnSwing( defender, attacker );<font></font>
  }<font></font>
  ....<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> TimeSpan <span class="hljs-title">OnSwing</span>(<span class="hljs-params"> Mobile attacker, Mobile defender </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">return</span> OnSwing( attacker, defender, <span class="hljs-number">1.0</span> );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parecia suspeito para o analisador que o m√©todo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OnSwing () recebesse</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> argumentos na ordem inversa. </font><font style="vertical-align: inherit;">Talvez isso seja devido a um erro. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3092 Interse√ß√µes de faixa s√£o poss√≠veis dentro de express√µes condicionais. </font><font style="vertical-align: inherit;">Exemplo: if (A&gt; 0 &amp;&amp; A &lt;5) {...} else if (A&gt; 3 &amp;&amp; A &lt;9) {...}. </font><font style="vertical-align: inherit;">HouseFoundation.cs 1883</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">IsFixture</span>(<span class="hljs-params"> <span class="hljs-keyword">int</span> itemID </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID &gt;= <span class="hljs-number">0x319C</span> &amp;&amp; itemID &lt; <span class="hljs-number">0x31B0</span> ) 
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-comment">// ML doors</span>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID == <span class="hljs-number">0x2D46</span> ||<font></font>
           itemID == <span class="hljs-number">0x2D48</span> ||<font></font>
           itemID == <span class="hljs-number">0x2FE2</span> ||<font></font>
           itemID == <span class="hljs-number">0x2FE4</span> )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID &gt;= <span class="hljs-number">0x2D63</span> &amp;&amp; itemID &lt; <span class="hljs-number">0x2D70</span> )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID &gt;= <span class="hljs-number">0x319C</span> &amp;&amp; itemID &lt; <span class="hljs-number">0x31AF</span> ) 
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As faixas testadas sob condi√ß√µes se cruzam. </font><font style="vertical-align: inherit;">Isso pareceu suspeito para o analisador. </font><font style="vertical-align: inherit;">Mesmo que esse trecho de c√≥digo funcione corretamente, ainda vale a pena corrigi-lo. </font><font style="vertical-align: inherit;">Imagine uma situa√ß√£o em que precis√°ssemos reescrever o corpo do √∫ltimo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">caso,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para que, se a condi√ß√£o for verdadeira, o m√©todo retorne </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falso</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Se </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemID for</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> igual a, digamos, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x319C</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o m√©todo ainda retornar√° </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Por sua vez, isso acarreta a perda de tempo para procurar erros.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O RunUO foi criado h√° muito tempo, muito trabalho foi feito, no entanto, usando o exemplo deste projeto, voc√™ pode ver os benef√≠cios do uso de an√°lise est√°tica em projetos com hist√≥rico. </font><font style="vertical-align: inherit;">O analisador de 543 mil linhas de c√≥digo de projeto emitiu cerca de 500 avisos (sem contar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o n√≠vel</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Baixo), a maioria dos quais n√£o apareceu no artigo devido √† sua uniformidade. </font><font style="vertical-align: inherit;">Para se familiarizar com o resultado da an√°lise em mais detalhes, sugiro o uso de uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">licen√ßa gratuita para projetos de c√≥digo aberto</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ deseja compartilhar este artigo com um p√∫blico que fala ingl√™s, use o link para a tradu√ß√£o: Ekaterina Nikiforova. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verifique o RunUO pelo PVS-Studio Analyzer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt487092/index.html">Modelando processos de neg√≥cios como parte de um projeto de implementa√ß√£o de sistema ERP</a></li>
<li><a href="../pt487094/index.html">Reprocessando eventos recebidos de Kafka</a></li>
<li><a href="../pt487096/index.html">Trechos. Como facilitar o processo de trabalhar com a documenta√ß√£o</a></li>
<li><a href="../pt487098/index.html">Desenhar com formigas: imagens procedurais usando algoritmos de otimiza√ß√£o de col√¥nias de formigas</a></li>
<li><a href="../pt487100/index.html">Estruturas de dados imut√°veis ‚Äã‚Äãde √∫ltima gera√ß√£o</a></li>
<li><a href="../pt487108/index.html">Perfil de jogador para celular: MyTracker Research</a></li>
<li><a href="../pt487110/index.html">Slurm SRE. Uma experi√™ncia completa com especialistas da Booking.com e do Google.com</a></li>
<li><a href="../pt487112/index.html">Edge of Madness: O c√≠rculo b√°sico</a></li>
<li><a href="../pt487116/index.html">Por que a disc√≥rdia migra de Go para Rust</a></li>
<li><a href="../pt487118/index.html">Loki - coletando logs usando a abordagem Prometheus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>