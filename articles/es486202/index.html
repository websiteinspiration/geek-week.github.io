<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>游꼞 游녿 游꺁 Alpine recoge las construcciones de Docker bajo Python 50 veces m치s lento, y las im치genes son 2 veces m치s pesadas 游뱛游낗 游꼾 游빈</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Alpine Linux a menudo se recomienda como imagen base para Docker. Le dicen que usar Alpine har치 que sus compilaciones sean m치s peque침as y que el proce...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Alpine recoge las construcciones de Docker bajo Python 50 veces m치s lento, y las im치genes son 2 veces m치s pesadas</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486202/"><img src="https://habrastorage.org/webt/hg/51/dn/hg51dne-v3zvjg--xoybqzk67fa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alpine Linux a menudo se recomienda como imagen base para Docker. </font><font style="vertical-align: inherit;">Le dicen que usar Alpine har치 que sus compilaciones sean m치s peque침as y que el proceso de compilaci칩n sea m치s r치pido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero si usa Alpine Linux para aplicaciones Python, entonces:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hace que tus construcciones sean mucho m치s lentas</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hace que tu apariencia sea m치s grande</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perdiendo tu tiempo</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y al final, puede causar errores de tiempo de ejecuci칩n</font></font></li>
</ul><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Echemos un vistazo a por qu칠 Alpine lo recomienda, pero por qu칠 no debe usarlo en un lugar con Python.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">쯇or qu칠 la gente recomienda Alpine?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supongamos que necesitamos gcc como parte de nuestra imagen y queremos comparar Alpine Linux vs Ubuntu 18.04 en t칠rminos de velocidad de construcci칩n y tama침o de imagen final. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para comenzar, descargue dos im치genes y compare su tama침o:</font></font><br>
<br>
<pre><code class="bash hljs">$ docker pull --quiet ubuntu:18.04<font></font>
docker.io/library/ubuntu:18.04<font></font>
$ docker pull --quiet alpine<font></font>
docker.io/library/alpine:latest<font></font>
$ docker image ls ubuntu:18.04<font></font>
REPOSITORY          TAG        IMAGE ID         SIZE<font></font>
ubuntu              18.04      ccc6e87d482b     64.2MB<font></font>
$ docker image ls alpine<font></font>
REPOSITORY          TAG        IMAGE ID         SIZE<font></font>
alpine              latest     e7d92cdc71fe     5.59MB<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver, la imagen base de Alpine es mucho m치s peque침a. </font><font style="vertical-align: inherit;">Ahora intentemos instalar gcc y comencemos con Ubuntu:</font></font><br>
<br>
<pre><code class="bash hljs">FROM ubuntu:18.04<font></font>
RUN apt-get update &amp;&amp; \<font></font>
    apt-get install --no-install-recommends -y gcc &amp;&amp; \<font></font>
    apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*<font></font>
</code></pre><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escribir el Dockerfile perfecto est치 m치s all치 del alcance de este art칤culo.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Midamos la velocidad de construcci칩n:</font></font><br>
<br>
<pre><code class="bash hljs">$ time docker build -t ubuntu-gcc -f Dockerfile.ubuntu --quiet .<font></font>
sha256:b6a3ee33acb83148cd273b0098f4c7eed01a82f47eeb8f5bec775c26d4fe4aae<font></font>
<font></font>
real    0m29.251s<font></font>
user    0m0.032s<font></font>
sys     0m0.026s<font></font>
$ docker image ls ubuntu-gcc<font></font>
REPOSITORY   TAG      IMAGE ID      CREATED         SIZE<font></font>
ubuntu-gcc   latest   b6a3ee33acb8  9 seconds ago   150MB<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Repita lo mismo para Alpine (Dockerfile):</font></font><br>
<br>
<pre><code class="bash hljs">FROM alpine<font></font>
RUN apk add --update gcc<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensamblamos, miramos el tiempo y el tama침o del ensamblaje:</font></font><br>
<br>
<pre><code class="bash hljs">$ time docker build -t alpine-gcc -f Dockerfile.alpine --quiet .<font></font>
sha256:efd626923c1478ccde67db28911ef90799710e5b8125cf4ebb2b2ca200ae1ac3<font></font>
<font></font>
real    0m15.461s<font></font>
user    0m0.026s<font></font>
sys     0m0.024s<font></font>
$ docker image ls alpine-gcc<font></font>
REPOSITORY   TAG      IMAGE ID       CREATED         SIZE<font></font>
alpine-gcc   latest   efd626923c14   7 seconds ago   105MB<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como se prometi칩, las im치genes basadas en Alpine se ensamblan m치s r치pido y menos por s칤 mismas: 15 segundos en lugar de 30 y un tama침o de imagen de 105 MB frente a 150 MB. </font><font style="vertical-align: inherit;">춰Esto es bastante bueno! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero si cambiamos a construir una aplicaci칩n Python, entonces no todo es tan color de rosa.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imagen de Python</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las aplicaciones de Python a menudo usan pandas y matplotlib. </font><font style="vertical-align: inherit;">Por lo tanto, una de las opciones es tomar una imagen oficial basada en Debian usando este Dockerfile:</font></font><br>
<br>
<pre><code class="bash hljs">FROM python:3.8-slim<font></font>
RUN pip install --no-cache-dir matplotlib pandas<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo recogemos:</font></font><br>
<br>
<pre><code class="bash hljs">$ docker build -f Dockerfile.slim -t python-matpan.<font></font>
Sending build context to Docker daemon  3.072kB<font></font>
Step 1/2 : FROM python:3.8-slim<font></font>
 ---&gt; 036ea1506a85<font></font>
Step 2/2 : RUN pip install --no-cache-dir matplotlib pandas<font></font>
 ---&gt; Running <span class="hljs-keyword">in</span> 13739b2a0917<font></font>
Collecting matplotlib<font></font>
  Downloading matplotlib-3.1.2-cp38-cp38-manylinux1_x86_64.whl (13.1 MB)<font></font>
Collecting pandas<font></font>
  Downloading pandas-0.25.3-cp38-cp38-manylinux1_x86_64.whl (10.4 MB)<font></font>
...<font></font>
Successfully built b98b5dc06690<font></font>
Successfully tagged python-matpan:latest<font></font>
<font></font>
real    0m30.297s<font></font>
user    0m0.043s<font></font>
sys     0m0.020s<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obtenemos una imagen de 363 MB de tama침o. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
쯄ejoraremos con Alpine? </font><font style="vertical-align: inherit;">Intentemos:</font></font><br>
<br>
<pre><code class="bash hljs">FROM python:3.8-alpine<font></font>
RUN pip install --no-cache-dir matplotlib pandas<font></font>
</code></pre><br>
<pre><code class="bash hljs">$ docker build -t python-matpan-alpine -f Dockerfile.alpine .                                 <font></font>
Sending build context to Docker daemon  3.072kB                                               <font></font>
Step 1/2 : FROM python:3.8-alpine                                                             <font></font>
 ---&gt; a0ee0c90a0db                                                                            <font></font>
Step 2/2 : RUN pip install --no-cache-dir matplotlib pandas                                                  <font></font>
 ---&gt; Running <span class="hljs-keyword">in</span> 6740adad3729                                                                 <font></font>
Collecting matplotlib                                                                         <font></font>
  Downloading matplotlib-3.1.2.tar.gz (40.9 MB)                                               <font></font>
    ERROR: Command errored out with <span class="hljs-built_in">exit</span> status 1:                                            
     <span class="hljs-built_in">command</span>: /usr/<span class="hljs-built_in">local</span>/bin/python -c <span class="hljs-string">'import sys, setuptools, tokenize; sys.argv[0] = '</span><span class="hljs-string">"'"</span><span class="hljs-string">'/
tmp/pip-install-a3olrixa/matplotlib/setup.py'</span><span class="hljs-string">"'"</span><span class="hljs-string">'; __file__='</span><span class="hljs-string">"'"</span><span class="hljs-string">'/tmp/pip-install-a3olrixa/matplotlib/setup.py'</span><span class="hljs-string">"'"</span><span class="hljs-string">';f=getattr(tokenize, '</span><span class="hljs-string">"'"</span><span class="hljs-string">'open'</span><span class="hljs-string">"'"</span><span class="hljs-string">', open)(__file__);code=f.read().replace('</span><span class="hljs-string">"'"</span><span class="hljs-string">'\r\n'</span><span class="hljs-string">"'"</span><span class="hljs-string">', '</span><span class="hljs-string">"'"</span><span class="hljs-string">'\n'</span><span class="hljs-string">"'"</span><span class="hljs-string">');f.close();exec(compile(code, __file__, '</span><span class="hljs-string">"'"</span><span class="hljs-string">'exec'</span><span class="hljs-string">"'"</span><span class="hljs-string">'))'</span> egg_info --egg-base /tmp/pip-install-a3olrixa/matplotlib/pip-egg-info                              <font></font>
<font></font>
...<font></font>
ERROR: Command errored out with <span class="hljs-built_in">exit</span> status 1: python setup.py egg_info Check the logs <span class="hljs-keyword">for</span> full <span class="hljs-built_in">command</span> output.<font></font>
The <span class="hljs-built_in">command</span> <span class="hljs-string">'/bin/sh -c pip install matplotlib pandas'</span> returned a non-zero code: 1
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
쯈u칠 esta pasando?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alpine no soporta ruedas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si observa la compilaci칩n, que se basa en Debian, ver치 que descarga matplotlib-3.1.2-cp38-cp38-manylinux1_x86_64. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whl</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este es el binario para la rueda. Alpine descarga las fuentes de `matplotlib-3.1.2.tar. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gz</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> `, ya que no admite </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ruedas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est치ndar </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
쯇or qu칠? La mayor칤a de las distribuciones de Linux usan la versi칩n GNU (glibc) de la biblioteca est치ndar de C, que de hecho es requerida por cada programa de C, incluido Python. Pero Alpine usa `musl`, y dado que esos binarios son para` glibc`, simplemente no son una opci칩n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, si usa Alpine, debe compilar todo el c칩digo escrito en C en cada paquete de Python.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ah, s칤, una lista de todas esas dependencias que deben compilarse deber치 buscarse nosotros mismos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este caso, obtenemos esto:</font></font><br>
<br>
<pre><code class="bash hljs">FROM python:3.8-alpine<font></font>
RUN apk --update add gcc build-base freetype-dev libpng-dev openblas-dev<font></font>
RUN pip install --no-cache-dir matplotlib pandas<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y el tiempo de construcci칩n lleva ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... 춰25 minutos y 57 segundos! </font><font style="vertical-align: inherit;">Y el tama침o de la imagen es 851MB. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las im치genes basadas en alpinos tardan mucho m치s, son m치s grandes y a칰n debe buscar todas las dependencias. </font><font style="vertical-align: inherit;">Por supuesto, puede reducir el tama침o de la compilaci칩n utilizando compilaciones de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">varias etapas,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pero eso significa que se necesita m치s trabajo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
춰Eso no es todo!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alpine puede causar errores inesperados de tiempo de ejecuci칩n</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En teor칤a, musl es compatible con glibc, pero en la pr치ctica, las diferencias pueden causar muchos problemas. </font><font style="vertical-align: inherit;">Y si lo son, entonces ciertamente desagradable. </font><font style="vertical-align: inherit;">Aqu칤 hay algunos problemas que pueden surgir:</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alpine tiene una pila de flujo m치s peque침a por defecto, lo que puede provocar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">errores en Python</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algunos usuarios han descubierto que las </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aplicaciones de Python son m치s lentas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> debido a c칩mo musl asigna memoria (diferente de glibc).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un usuario </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">encontr칩 un error al formatear la fecha</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seguramente estos errores ya se han solucionado, pero qui칠n sabe cu치ntos m치s.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No use im치genes alpinas para Python</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si no desea molestarse con compilaciones grandes y largas, b칰squedas de dependencia y posibles errores, no use Alpine Linux como imagen base. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elegir una buena imagen base</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es486202/">https://habr.com/ru/post/es486202/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es486190/index.html">Nuestra experiencia en el desarrollo de un controlador CSI en Kubernetes para Yandex.Cloud</a></li>
<li><a href="../es486192/index.html">Los estafadores cibern칠ticos piratean a los operadores m칩viles para obtener n칰meros de tel칠fono de suscriptores</a></li>
<li><a href="../es486194/index.html">Acerca de las copias de seguridad en Proxmox VE</a></li>
<li><a href="../es486198/index.html">Hablar es dif칤cil. Ensayos sobre comunicaci칩n con no programadores</a></li>
<li><a href="../es486200/index.html">Consejos de Docker: limpie su m치quina de basura</a></li>
<li><a href="../es486204/index.html">Profesi칩n: Administrador del sistema</a></li>
<li><a href="../es486206/index.html">쯈u칠 tipos de fraude he encontrado en freelance y outsourcing?</a></li>
<li><a href="../es486210/index.html">2020: tendencias y pron칩sticos</a></li>
<li><a href="../es486212/index.html">Delegaci칩n del derecho de firmar documentos a un robot</a></li>
<li><a href="../es486216/index.html">쯇or qu칠 se est치 construyendo Internet cu치ntica en el espacio y qui칠n ya est치 implementando tales proyectos?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>