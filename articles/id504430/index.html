<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧚🏾 💮 🖋️ Pusat Operasi Keamanan Tinkoff Kehidupan Sehari-hari: Analisis Bootloader Tunggal 🐩 🕵🏿 🏈</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! 
 
 Di Pusat Operasi Keamanan Tinkoff kami, kami secara teratur menganalisis teknik yang digunakan dalam malware dan serangan, dan baru-ba...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Pusat Operasi Keamanan Tinkoff Kehidupan Sehari-hari: Analisis Bootloader Tunggal</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/504430/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo, Habr! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di Pusat Operasi Keamanan Tinkoff kami, kami secara teratur menganalisis teknik yang digunakan dalam malware dan serangan, dan baru-baru ini kami menemukan satu file menarik yang ingin kami bicarakan.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wj/u9/yk/wju9ykf2tcl0k7ab3xohfmoilge.png" alt="gambar"><br>
<a name="habracut"></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Teknik yang digunakan untuk membuat karya besar ini telah dikenal selama lebih dari 20 tahun, tetapi bahkan beberapa dekade kemudian tetap relevan, karena panggilan beberapa cek di makro tidak mencurigakan dan dapat digunakan dalam dokumen yang sah. </font><font style="vertical-align: inherit;">Ini adalah pengunduh malware yang ditulis dalam makro Excel 4.0.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alat</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai bagian dari analisis, kami akan menggunakan alat pihak ketiga seminimal mungkin dan bertahan dengan seperangkat program standar:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Office Suite</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pengarsip;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">editor teks;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sebagai alat untuk menganalisis tindakan perangkat lunak, kami akan menggunakan Sysmon;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sebagai lingkungan untuk analisis, kami akan menggunakan VM dengan Windows 7 on board</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mnogabukaf</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dokumen yang akan kami uraikan adalah buku kerja Excel dalam format xls. </font><font style="vertical-align: inherit;">Malware dikirim dalam email phising, ketika dokumen dimulai, makro membongkar cabang registri, mengunduh informasi tentang pembaruan Office dari situs web Microsoft, dan juga mengunduh dan meluncurkan .dll berbahaya. </font><font style="vertical-align: inherit;">Setelah langkah-langkah ini, buku ditutup tanpa menyimpan perubahan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perbedaan utama dari loader jenis ini adalah tidak menggunakan macro VBA.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analisis statis</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut ini adalah contoh email yang berisi dokumen jahat. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pn/sf/hl/pnsfhllpvob_d_b7sop7ljyv7jq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Buka lampiran di mesin virtual kami. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda harus segera memperhatikan: gambar memperingatkan bahwa dokumen itu "dilindungi" dan layak membukanya secara lokal dan mengklik "aktifkan konten": </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sg/mj/eu/sgmjeuardcvtcxqdvuf-wpk5ul0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebuah peringatan keamanan mengisyaratkan bahwa Anda perlu melihat proyek-proyek di Visual Basic Editor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami beralih ke pengembang - manajemen makro (vbs), tetapi kami tidak melihat ada vbs atau makro vba: </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/te/jj/pn/tejjpn888lj2jfeoyj9snzxugos.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inilah saatnya untuk mengingat apa itu dokumen kantor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap dokumen Microsoft Office adalah arsip yang dapat dibuka ritsleting menggunakan pengarsipan apa pun, mengekstraksi konten dokumen:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kf/nj/hg/kfnjhgg1rmz7xffqsfm5w0plojk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah membongkar, kita melihat bahwa di dalam dokumen tidak ada file xml yang biasa kita lihat, masalahnya ada dalam format dokumen yang lebih lama - xls. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam ekstensi xls, konten tidak disimpan dalam format Office Open XML, tetapi dalam format biner BIFF8. Dokumen ini menggunakan Excel 4.0 makro, di mana makro dapat dieksekusi dalam sel dokumen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perlu dicatat bahwa lembar dengan makro tidak disembunyikan, tetapi lembar tersebut memiliki banyak sel kosong, yang membuat analisis menjadi sulit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada alat untuk menganalisis file BIFF8, ​​misalnya BiffViewer, dan untuk menganalisis konten ada alat yang hebat - oletools. Tetapi kami akan mencoba melakukannya tanpa menggunakan utilitas pihak ketiga. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Excel juga memiliki format berbasis </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xml</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xlsm</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Anda dapat menyimpan kode makro VBA dan lembar makro Excel 4.0 di dalamnya, yang akan kami lakukan. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daftar lengkap format yang tersedia untuk Excel adalah </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">format excel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menyimpan dokumen kami, unzip: </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/yg/yu/8b/ygyu8bzhfi2qwajfjmekp3i5_ek.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita lihat apa yang ada di file, mulai dengan direktori macrosheets di folder xl dan temukan file dengan semua data di lembar makro: </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/rt/9l/tw/rt9ltwvg6gyr0wipyuse7cootpe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, kita mendapatkan semua nilai dalam sel di lembar makro. </font><font style="vertical-align: inherit;">Makro itu sendiri dikaburkan, sel-sel hanya berisi nilai numerik dan rumus yang mengubah nilai-nilai ini dan menulis hasilnya menjadi sel-sel baru. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Misalnya, dalam rumus ini, nilai numerik dikonversi ke karakter, digabungkan, dan ditulis ke sel FK17653.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formula dalam excel</font></font></b>
                        <div class="spoiler_text">FORMULA.FILL(CHAR(CV63675+HE4018)&amp;CHAR(DG27830+HE26544)&amp;CHAR(IA33205-EW25294)&amp;CHAR(X1216+BA26751)&amp;CHAR(X1216*ER27642)&amp;CHAR(EC50683*IA4491)&amp;CHAR(CV63675*CQ12674)&amp;CHAR(CV63675-IP35389)&amp;CHAR(DL61540+AP31398)&amp;CHAR(GB59870-IB5677)&amp;CHAR(X1216+DS45768)&amp;CHAR(GB59870+FV60781)&amp;CHAR(AA45534*S4000)&amp;CHAR(CV63675*FK10514)&amp;CHAR(EC50683/GD6905)&amp;CHAR(GB59870+EM58732)&amp;CHAR(HQ31358-GI51882)&amp;CHAR(X1216+FX24913)&amp;CHAR(DL61540*EC63501)&amp;CHAR(HQ31358-IC62223)&amp;CHAR(X1216*BY50777)&amp;CHAR(X1216*FY64649)&amp;CHAR(G64471+DW7092)&amp;CHAR(HQ31358-B26139)&amp;CHAR(HQ31358/I494)&amp;CHAR(G64471*DG37241)&amp;CHAR(DL61540-ES39934)&amp;CHAR(X1216+BX48975),FK17653)</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai hasil dari rumus, kita mendapatkan baris berikut: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rq/ve/xn/rqvexng052dssxefthigngmj9nq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap perintah makro berikutnya "dikumpulkan" dengan formula yang sama, ditulis ke sel, dan kemudian dieksekusi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agar makro berjalan secara otomatis ketika dokumen dibuka, sel dari mana skrip harus diluncurkan harus disebut Auto_Open. </font><font style="vertical-align: inherit;">Pertimbangkan file workbook.xml:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">workbook.xml</font></font></b>
                        <div class="spoiler_text">&lt;?xml version=«1.0» encoding=«UTF-8» standalone=«yes»?&gt;<br>
&lt;workbook xmlns=«<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">schemas.openxmlformats.org/spreadsheetml/2006/main</a>» xmlns:r=«<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">schemas.openxmlformats.org/officeDocument/2006/relationships</a>» xmlns:mc=«<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">schemas.openxmlformats.org/markup-compatibility/2006</a>» mc:Ignorable=«x15» xmlns:x15=«<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">schemas.microsoft.com/office/spreadsheetml/2010/11/main</a>»&gt; appName=«xl» lastEdited=«6» lowestEdited=«6» rupBuild=«14420»/&gt;&lt;workbookPr/&gt;&lt;mc:AlternateContent xmlns:mc=«<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">schemas.openxmlformats.org/markup-compatibility/2006</a>»&gt; Requires=«x15»&gt;&lt;x15ac:absPath url=«C:\Users\User\Desktop\malware\» xmlns:x15ac=«<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">schemas.microsoft.com/office/spreadsheetml/2010/11/ac</a>»/&gt;&lt;/mc:Choice&gt;&lt;/mc:AlternateContent&gt;/&gt;&lt;sheet name=«Sheet1» sheetId=«1» r:id=«rId1»/&gt;&lt;sheet name=«Sheet2» sheetId=«2» r:id=«rId2»/&gt;Sheet2!$IE$65406/&gt;/&gt;/&gt;</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di dalam file kita menemukan nama baris = "_ xlnm.Auto_OpenT8nee" hidden = "1"&gt; Sheet2! $ IE $ 65406 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini berarti bahwa sel yang menjalankan makro, IE65406, disembunyikan. </font><font style="vertical-align: inherit;">Sekarang kita tahu titik masuk ke makro.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analisis dinamis</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jangan pernah menjalankan file yang mencurigakan di mesin Anda. </font><font style="vertical-align: inherit;">Untuk mempelajari tindakan perangkat lunak yang mencurigakan, perlu untuk menggunakan lingkungan yang disiapkan khusus: berbagai kotak pasir atau mesin terisolasi yang disiapkan khusus - virtual atau besi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Buka dokumen dan jalankan konten. </font><font style="vertical-align: inherit;">Jendela prompt perintah berkedip dan buku ditutup. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita lihat log Sysmon. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sysmon memiliki acara pembuatan proses (id 1), lebih lanjut tentang Sysmon dapat ditemukan di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan log, kita melihat bahwa makro membuat file di direktori c: \ users \ public </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut ini adalah pesan sysmon, yang menunjukkan bahwa cabang registri diturunkan dan hasilnya ditulis ke file:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sysmon Event ID acara 1</font></font></b>
                        <div class="spoiler_text">sysmon event id 1 <br>
Process Create:<br>
RuleName: technique_id=T1112,technique_name=Modify Registry<br>
ProcessGuid: {2a62482c-b244-5ecf-3a00-000000002700}<br>
ProcessId: 3268<br>
Image: C:\Windows\System32\reg.exe<br>
FileVersion: 6.1.7600.16385 (win7_rtm.090713-1255)<br>
Description: Registry Console Tool<br>
Product: Microsoft Windows Operating System<br>
Company: Microsoft Corporation<br>
OriginalFileName: reg.exe<br>
CommandLine: «C:\Windows\system32\reg.exe» EXPORT HKCU\Software\Microsoft\Office\16.0\Excel\Security C:\Users\Public\IcItdXw.reg /y"<br>
CurrentDirectory: C:\Users\user\Documents\<br>
User: user<br>
LogonGuid: {2a62482c-b1d8-5ecf-3284-010000000000}<br>
LogonId: 0x18432<br>
TerminalSessionId: 1<br>
IntegrityLevel: High<br>
Hashes: SHA1=8BD131B03D6BA865B228CA8EE3239D2EF2B90B74,MD5=D69A9ABBB0D795F21995C2F48C1EB560,SHA256=36414C7E57AFA6136D77FD47F4C55102E35F2475FBCD719728DA7D14B1590E2A,IMPHASH=BC564726CFF18A49EBC14784593A51CA<br>
ParentProcessGuid: {2a62482c-b23f-5ecf-3900-000000002700}<br>
ParentProcessId: 3164<br>
ParentImage: C:\Program Files\Microsoft Office\Office16\EXCEL.EXE<br>
ParentCommandLine: «C:\Program Files\Microsoft Office\Office16\EXCEL.EXE»</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah selesai, makro menghapus file yang dibuat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk melarang penghapusan file, ubah izin pada folder, tinggalkan izin baca dan tulis, dan hapus penghapusan: </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/lf/1a/go/lf1agokzzhrg21juvd4ptxlv1os.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jalankan kembali dokumen, kami akan menerima kesalahan selama eksekusi makro, yang akan memungkinkan kami untuk debug itu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini dimungkinkan karena tidak ada pengecualian dalam menangani beberapa panggilan. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0t/ul/u-/0tulu-lqdvaiqqwvif3qgy7syjg.png"><br>
 <br>
<img src="https://habrastorage.org/webt/rf/jo/em/rfjoem_yjobjgq4qnakt80zglke.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita jalankan langkah demi langkah makro, selama debug, kita menemukan panggilan fungsi dari perpustakaan dll, seperti </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ShellExecute</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URLDownloadToFile</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Setelah menyelesaikan makro, file-file berikut akan berada di folder pengguna bersama:</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/dc/aw/bd/dcawbdyabmgyj-qzjxcrvzqhpqi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena kita tahu sel tempat eksekusi dimulai, kita bisa mengisi semua sel di lembar makro. </font><font style="vertical-align: inherit;">Mari kita pergi makro ke fungsi tutup (salah), di mana kita akan menghentikan eksekusi dengan mengklik tombol "Jeda".</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sel periksa lingkungan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Melihat melalui sel-sel yang diisi oleh makro, kita menemukan beberapa fungsi get.window () dan get.workspace ()</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fungsi get.window () mengembalikan informasi tentang jendela saat ini: status, status jendela, namanya, opsi tampilan, dll.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fungsi get.workspace () memungkinkan Anda untuk mencari tahu informasi tentang lingkungan di mana dokumen berjalan.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daftar lengkap panggilan yang tersedia untuk Excel 4.0 dapat ditemukan di tautan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini kita perlu membahas lebih detail: kolega saya dan saya menyarankan bahwa sebagian besar panggilan ini terkait dengan upaya untuk mem-bypass kotak pasir:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get.winow (7) - memeriksa apakah jendela saat ini disembunyikan. </font><font style="vertical-align: inherit;">Mengembalikan nilai true atau false.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get.windows (20) - mengembalikan true jika jendela dimaksimalkan.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get.windows (23) - dapat mengembalikan nilai 1, 2 dan 3.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/getpro/habr/post_images/d54/afe/028/d54afe0281d24b5e34040af0122cd3d7.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1 - dipulihkan </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 - diminimalkan </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3 - dimaksimalkan </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan demikian, ia memeriksa untuk melihat apakah jendela saat ini terbuka: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
get.workspace (31) - memeriksa untuk melihat apakah makro sedang di-debug dalam beberapa langkah. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
get.workspace (13) - periksa lebar ruang kerja dalam piksel: jika kurang dari 770, buku ditutup </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/dh/zz/w3/dhzzw3m9vx-krc6nxgje-ken6x4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
get.workspace (14) - periksa ketinggian ruang kerja dalam piksel: jika kurang dari 390, buku ditutup </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4b/m5/8l/4bm58lswcaq-yi9xfjjinjc9ng0.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
get.workspace (19) - centang kehadiran mouse. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
get.workspace (1) - mengembalikan sistem operasi yang menjalankan dokumen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kasus false, di setiap cek ada transisi ke sel penutup buku tanpa menyimpan hasilnya.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Panggilan Perpustakaan Eksternal</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah memeriksa lingkungan, kami beralih ke fungsi utama. Mari kita lihat bagaimana fungsi WinAPI dipanggil dari makro: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Panggilan reg.exe, yang kita lihat di log Sysmon. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/gy/vz/lv/gyvzlv4tfc9o4q0pmkplr9ea3eq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk memanggil utilitas, fungsi ShellExecute dari pustaka shell32.dll digunakan, parameter untuk fungsi tersebut tersebar di sel lain. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sel BN16631: </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/ug/af/vn/ugafvnkenyfwp2iv2mqvml0kfl8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sel A46097: </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/qa/wy/f7/qawyf7w4clfqocrpp4ixokeyzyc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam sel GN47559, perintah untuk mengekspor cabang registri yang diperlukan dikirim, Get.workspace (2) mengembalikan versi Excel. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/s7/_g/w5/s7_gw5jjgmgw32b9vxugtqxnxkw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sel DX48821 berisi jalur tempat hasilnya ditulis. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/wt/i9/-m/wti9-myhidza4-8nm7xd_s3rkmg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lebih lanjut dalam makro ada pemeriksaan untuk keberadaan file IcltdXw.reg yang dibuat dan penghapusannya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Memanggil fungsi URLDownloadToFile. Fungsi ini menyimpan hasil permintaan dapatkan ke file. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Panggilannya adalah sebagai berikut:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bu/vn/ye/buvnyevcolwz4oofwcxygw1zbam.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Panggilan ini membawa kita ke situs web Microsoft, ke halaman dengan informasi tentang pembaruan Office. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parameter fungsi: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sel BR6547 </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/yc/s9/ws/ycs9wsggtysuw-zxwt_o0dt4r94.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sel IN49847 </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/i2/an/lg/i2anlg2ev8fwcc40tb-z9f2mzmi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah menjalankan instruksi, diperiksa apakah file dibuat, dan juga pembacaan karakter dengan offset dalam file: </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/ei/by/lc/eibylc7t9nfpt1o9fpqqri2myzm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemungkinan besar, tindakan ini ditujukan untuk memeriksa apakah lingkungan tempat dokumen berjalan memiliki akses Internet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam rumus, fungsi FILES diteruskan ke iserror dan argumennya adalah nama file di mana hasil dari fungsi URLDownloadToFile harus ditulis: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_u/rh/x1/_urhx1xm6fnl5wiaca1r1zojjba.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cell FM27223 akan memberikan kontrol ke fungsi penutupan buku: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f2/fj/ka/f2fjkalfq8wvjhotj8xyb8td5-g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah berhasil menerima file dari Microsoft, sel-sel diisi untuk mempersiapkan panggilan kedua ke urlmon dll.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pemuatan muatan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan ini adalah panggilan kedua, tetapi ke domain dehabadi [.] Ir, dari mana beban berbahaya harus dimuat: </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/3f/jx/db/3fjxdb9mshlwdu0y6xgnp0j_ena.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasilnya ditulis ke file dalam folder yang sama dengan ekstensi html: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dh/py/vd/dhpyvdog5thduid5qvxiuclpa6s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, kita menemukan cabang dalam kode makro jika, pada upaya pertama untuk mengunduh payload, gagal, upaya kedua akan dilakukan, tetapi dari alamat yang berbeda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika unduhan berhasil, sembulan peringatan akan muncul dan pustaka yang dimuat akan dipanggil. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/uo/dn/gv/uodngvrubmpjcf-zkckbqj5wm-e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Panggilan penuh adalah sebagai berikut:</font></font><br>
<br>
<pre><code class="plaintext hljs">=CALL("shell32","ShellExecuteA","JJCCJJ",0,"open","c:\windows\systemc32\rundll32.exe","c:\users\public\4hcFC.html,DllRegisterServer",0,5) </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam panggilan penuh, fungsi ShellExecuteA dipanggil dari pustaka Shell32 dengan parameter untuk meluncurkan rundll32, yang dengannya fungsi yang diekspor dari pustaka jahat yang diunduh dipanggil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini melengkapi fungsi makro, payload sudah habis dan berjalan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang dikatakan, teknologinya cukup lama ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Excel 4.0 untuk Windows 3.0 dan 3.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), tetapi sepenuhnya menyediakan fungsionalitas yang diperlukan malware untuk mencapai tujuannya. Dan tujuan dari file ini adalah diam-diam meletakkan perangkat lunak berbahaya dalam sistem yang dapat menyebabkan kerusakan serius, mulai dari pencurian data pribadi, data otorisasi untuk sistem, berakhir dengan korupsi data / enkripsi pada komputer dan kemampuan untuk mengeksekusi kode dari jarak jauh. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menganalisis dokumen semacam itu, sama sekali tidak perlu menggunakan utilitas dan perangkat lunak khusus apa pun, namun perlu disebutkan satu set skrip </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oletools - Anda dapat melihat detail lebih lanjut di sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Kami akan berakhir di sini, di bawah ini adalah indikator-indikator kompromi yang diidentifikasi sebagai hasil analisis. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menerima IOC:</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
evans [.] williamdmon [@] wp [.] pl </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
eleventalents [.] com </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dehabadi [.] ir </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
hxxps: //eleventalents.com/wp-keys.php </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
hxxps: //dehabadi.ir/wp-keys.php </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
de88d3774ae006d96121d9b45efbf1ee </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
a73d1214740330013773cd733b0daf206eae2e03 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ba4adb640f777ad9b0881919e9bd1e171e64025d97a37fd585295ab611653419 </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daftar lengkap indikator kompromi. </font></font></a><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Referensi:</font></font></b><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Referensi Makro 4.0 </font></font></a> </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bekerja pada analisis: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frolov Ilya </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kolenchuk Alexey</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id504402/index.html">29 Mei Java Digest</a></li>
<li><a href="../id504408/index.html">Templat kerangka kerja pengujian yang sederhana dan nyaman pada selenide untuk autotest UI</a></li>
<li><a href="../id504412/index.html">Kejuaraan pemrograman online "Open Finals of Moscow Training"</a></li>
<li><a href="../id504414/index.html">Bagaimana Microsoft Membunuh AppGet</a></li>
<li><a href="../id504420/index.html">Menulis arena PvP berbasis giliran dengan gerakan simultan</a></li>
<li><a href="../id504434/index.html">Program pendidikan untuk orang tua: cara melindungi anak-anak dari bahaya di Internet</a></li>
<li><a href="../id504438/index.html">30 mitaps per minggu. Kami membuka musim panas 2020</a></li>
<li><a href="../id504442/index.html">Sedikit tentang relokasi di kernel Linux</a></li>
<li><a href="../id504444/index.html">Menggunakan docker multi-stage untuk membangun gambar windows</a></li>
<li><a href="../id504448/index.html">Gamer Generasi II</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>