<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå± üéà üó£Ô∏è Raspberry Pi, Python and watering indoor plants üÖ±Ô∏è üñºÔ∏è üö´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I have no relationship with indoor plants. The fact is that I forget to water them. Knowing this, I began to reflect on the fact that someone, for sur...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Raspberry Pi, Python and watering indoor plants</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/495996/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I have no relationship with indoor plants. </font><font style="vertical-align: inherit;">The fact is that I forget to water them. </font><font style="vertical-align: inherit;">Knowing this, I began to reflect on the fact that someone, for sure, had already found a way to automate irrigation. </font><font style="vertical-align: inherit;">As it turned out, there are a lot of ways. </font><font style="vertical-align: inherit;">Namely, we are talking about solutions based on Arduino or Raspberry Pi. </font><font style="vertical-align: inherit;">In this article I want to talk about how I created a system based on Raspberry Pi and Python, designed to automate watering plants.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/yl/yf/f3/ylyff31evrdtianmwk_5stnbgf4.jpeg"></a><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Components and Useful Resources</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I would immediately like to note that I am not at all an expert in electronics. </font><font style="vertical-align: inherit;">If they ask me to draw an electrical diagram, or to tell in detail about how any electronic component works, I can‚Äôt draw anything sensible or tell. </font><font style="vertical-align: inherit;">In fact, I did this project with only basic knowledge of electricity and just experimenting with components. </font><font style="vertical-align: inherit;">I ask you to be very careful about working with electricity. </font><font style="vertical-align: inherit;">And, if you feel a lack of knowledge in this area, I suggest at least a little understanding of this. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here is a list of components that I used in my project.</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry Pi 3 Starter Kit</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Water Pump, 12V</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Power supply, 12V</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Relay, 5V</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connecting cables</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cables with crocodile connectors</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Silicone tubes</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I participate in the Amazon affiliate program, so the links above are provided. </font><font style="vertical-align: inherit;">If you go through them and buy something, I will earn a little. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After I got all the components I need, it's time to do some research. </font><font style="vertical-align: inherit;">The following is a list of resources that helped me correctly connect electronic components and understand the main points regarding their functioning:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How electricity works</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How to use a relay</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry Pi Relay Power Supply</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connecting a 12V power supply to a relay</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here's a diagram of the Raspberry Pi's GPIO ports.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e1e/0bf/981/e1e0bf981b31d01f59837b4885bc31ba.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry Pi GPIO Port Diagram</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connect a relay to the Raspberry Pi</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I started by connecting a relay to the Raspberry Pi. </font><font style="vertical-align: inherit;">Here is how it looks.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ec3/cf5/763/ec3cf5763b5451d4a4bf9b6da4fc4a95.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connecting the relay to the Raspberry Pi The</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
red wire (Female-Female) goes from the pin of the JD_VCC relay board to the 5V pin (pin No. 2) of the Raspberry Pi. </font><font style="vertical-align: inherit;">An orange wire (Female-Female) leads from the pin of the VCC relay board to the 3.3V pin (pin No. 1) of the Raspberry Pi.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4a6/17c/868/4a617c868ef4a058c20f714a1c7b6fad.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pins JD_VCC and VCC of the relay board</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Using these wires, we supply power to the relay board. </font><font style="vertical-align: inherit;">In order to be able to control individual relays, you need to connect the relay board and the Raspberry Pi with two more wires that connect to the GND and IN1 pins of the relay board.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/071/ec9/94e/071ec994e83748306c3a9d35e8dc0791.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The GND pins and IN1 of the relay board The</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Female (Female) Female wire is the ground cable that connects the GND pin of the relay board and the ground terminal on the Raspberry Pi (I connected it to pin No. 34). </font><font style="vertical-align: inherit;">A white wire (Female-Female) leads from pin IN1 of the relay board to pin No. 12 of the Raspberry Pi. </font><font style="vertical-align: inherit;">It is this white wire that allows us to programmatically control the relay, turning on and off the individual relays located on the board.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/226/d5c/d14/226d5cd14bb1dd4ad3f31ae02bace405.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Black and white wires connected to the Raspberry Pi</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
If you decide to reproduce my project, you can arrange the relay and Raspberry Pi to communicate using any suitable pins. </font><font style="vertical-align: inherit;">But keep in mind that if the connection diagram of the components of your project is different from the connection diagram of the components of my project, you will have to make the appropriate changes to my code.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connecting the power supply to the relay</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After I connected the relay board to the Raspberry Pi, I connected the power supply to one of the relays. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Do not plug the power supply into a power outlet until you have completed all of the system component collection operations. </font><font style="vertical-align: inherit;">Be aware of the risk of electric shock.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4b3/95a/d58/4b395ad58f4d7384efeb067ede209486.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connecting the power supply to one of the relays The</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
12V power supply used by me comes with an adapter to which it is convenient to connect the connecting wires. </font><font style="vertical-align: inherit;">I connected the red wire (Male-Male) to the adapter ‚Äú+‚Äù connector, and the brown cable (Male-Male) to the adapter ‚Äú-‚Äù connector. </font><font style="vertical-align: inherit;">Then I connected the cable with the ‚ÄúCrocodile‚Äù (Female-Male) connector to the brown wire.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0fc/faf/f7f/0fcfaff7f05b281f5cc23e73bf66fcc6.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adapter that comes with the power supply</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
The relay board has four separate relays. </font><font style="vertical-align: inherit;">Each of them has three pins to which cables can be connected. </font><font style="vertical-align: inherit;">In the center of each relay is a connector to which the positive output of an external power source is connected. </font><font style="vertical-align: inherit;">On the left is the connector to which the positive input of the device to which power is to be connected is connected.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c64/ecd/dca/c64ecddca0322384223dc85d0e397526.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connecting a separate relay</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
I connected a red cable from the power supply (positive terminal) to the central contact of the relay. </font><font style="vertical-align: inherit;">Then I connected the orange cable (Male-Male) to the left connector of the relay and connected the cable with the ‚Äúcrocodile‚Äù (Female-Male) to this cable.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3f7/7ee/a36/3f77eea36c73477d3e50dbfcb4148c21.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Red and orange cables</font></font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ff3/9e3/6b9/ff39e36b9e57544b8167c24d5d2d773f.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Power supply and adapter</font></font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/98d/38d/875/98d38d875d52addfa9d57b245b61ce2c.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Relay and Raspberry Pi</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connecting a water pump to a relay</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now it remains only to connect the connectors ‚Äúcrocodiles‚Äù to the water pump. </font><font style="vertical-align: inherit;">The order of their connection determines the direction of the water flow. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, I needed water to enter the left channel of the pump and exit the right channel. </font><font style="vertical-align: inherit;">Therefore, I connected the ‚Äúcrocodile‚Äù connector of the black wire to the pump terminal, near which there is a red dot, and the other ‚Äúcrocodile‚Äù to the other pump terminal. </font><font style="vertical-align: inherit;">If I connected the ‚Äúcrocodiles‚Äù in a different order - the water would go in the opposite direction - from the right channel to the left.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/059/a2f/bc0/059a2fbc0b0267b29ec9800fc13405f2.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connecting a water pump to a relay</font></font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/84b/755/96b/84b75596b0b1ad9d0277e58e2ddd06fa.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Complete irrigation system: water enters the pump through the left channel, leaves the right and goes to the plant</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The code</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So we got to what I'm really good at. We got to the code. In order to get software working with the GPIO ports of the Raspberry Pi, I used the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gpiozero</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> library </font><font style="vertical-align: inherit;">. It is easy to use, it hides a lot of low-level mechanisms from the programmer, which you usually need to understand for someone who wants to work with GPIO pins. The library is well documented. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Before writing code, you need to connect a monitor, mouse, and keyboard to your Raspberry Pi. Or you need to connect to the Raspberry Pi via </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSH</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After you enter Raspberry Pi, go to the folder </font></font><code>Desktop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and create a folder there </font></font><code>run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Create a folder in this folder </font></font><code>classes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. And in the folder, </font></font><code>classes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create a file </font></font><code>Hardware.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. It should have the following code:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> gpiozero <span class="hljs-keyword">import</span> OutputDevice<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Relay</span>(<span class="hljs-params">OutputDevice</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, pin, active_high</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(Relay, self).__init__(pin, active_high)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this file, I just declared a new class </font></font><code>Relay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which is the descendant of the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OutputDevice</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> class </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, in the folder, </font></font><code>classes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I created a new file </font></font><code>TimeKeeper.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> datetime<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TimeKeeper</span>:</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, current_time</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.current_time = current_time<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.time_last_watered = <span class="hljs-literal">None</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">set_current_time</span>(<span class="hljs-params">self, updated_time</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.current_time = updated_time<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">set_time_last_watered</span>(<span class="hljs-params">self, updated_time</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.time_last_watered = updated_time<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;@staticmethod<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_current_time</span>():</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;now = datetime.datetime.now()<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> now.strftime(<span class="hljs-string">"%I:%M:%S %p"</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The purpose of this class is to track the current time and the moment when the last time watering was carried out. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, the files </font></font><code>Hardware.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>TimeKeeper.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">are in the folder </font></font><code>classes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Now, outside of this folder, I create a file </font></font><code>water_plant.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> classes <span class="hljs-keyword">import</span> Hardware
<span class="hljs-keyword">from</span> classes <span class="hljs-keyword">import</span> TimeKeeper <span class="hljs-keyword">as</span> TK
<span class="hljs-keyword">import</span> schedule
<span class="hljs-keyword">import</span> smtplib
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> ssl<font></font>
<font></font>
<span class="hljs-comment"># WATERING_TIME must be in "00:00:00 PM" format</span>
WATERING_TIME = <span class="hljs-string">'11:59:50 AM'</span>
SECONDS_TO_WATER = <span class="hljs-number">10</span>
RELAY = Hardware.Relay(<span class="hljs-number">12</span>, <span class="hljs-literal">False</span>)<font></font>
EMAIL_MESSAGES = {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'last_watered'</span>: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'subject'</span>: <span class="hljs-string">'Raspberry Pi: Plant Watering Time'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'message'</span>: <span class="hljs-string">'Your plant was last watered at'</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'check_water_level'</span>: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'subject'</span>: <span class="hljs-string">'Raspberry Pi: Check Water Level'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'message'</span>: <span class="hljs-string">'Check your water level!'</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_email</span>(<span class="hljs-params">time_last_watered, subject, message</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;port = <span class="hljs-number">465</span>
&nbsp;&nbsp;&nbsp;&nbsp;smtp_server = <span class="hljs-string">"smtp.gmail.com"</span>
&nbsp;&nbsp;&nbsp;&nbsp;FROM = TO = <span class="hljs-string">"YOUR_EMAIL@gmail.com"</span>
&nbsp;&nbsp;&nbsp;&nbsp;password = <span class="hljs-string">"YOUR_PASSWORD"</span><font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;complete_message = <span class="hljs-string">''</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> time_last_watered == <span class="hljs-literal">False</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;complete_message = <span class="hljs-string">"Subject: {}\n\n{}"</span>.format(subject, message)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">else</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;complete_message = <span class="hljs-string">"Subject: {}\n\n{} {}"</span>.format(subject, message, time_last_watered)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;context = ssl.create_default_context()<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">with</span> smtplib.SMTP_SSL(smtp_server, port, context=context) <span class="hljs-keyword">as</span> server:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.login(FROM, password)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.sendmail(FROM, TO, complete_message)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_last_watered_email</span>(<span class="hljs-params">time_last_watered</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;message = EMAIL_MESSAGES[<span class="hljs-string">'last_watered'</span>][<span class="hljs-string">'message'</span>]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;subject = EMAIL_MESSAGES[<span class="hljs-string">'last_watered'</span>][<span class="hljs-string">'subject'</span>]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;send_email(time_last_watered, subject, message)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_check_water_level_email</span>():</span>
&nbsp;&nbsp;&nbsp;&nbsp;message = EMAIL_MESSAGES[<span class="hljs-string">'check_water_level'</span>][<span class="hljs-string">'message'</span>]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;subject = EMAIL_MESSAGES[<span class="hljs-string">'check_water_level'</span>][<span class="hljs-string">'subject'</span>]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;send_email(<span class="hljs-literal">False</span>, subject, message)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">water_plant</span>(<span class="hljs-params">relay, seconds</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;relay.on()<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;print(<span class="hljs-string">"Plant is being watered!"</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;time.sleep(seconds)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;print(<span class="hljs-string">"Watering is finished!"</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;relay.off()<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;time_keeper = TK.TimeKeeper(TK.TimeKeeper.get_current_time())<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>(time_keeper.current_time == WATERING_TIME):<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;water_plant(RELAY, SECONDS_TO_WATER)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time_keeper.set_time_last_watered(TK.TimeKeeper.get_current_time())<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(<span class="hljs-string">"\nPlant was last watered at {}"</span>.format(time_keeper.time_last_watered))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment"># send_last_watered_email(time_keeper.time_last_watered)</span><font></font>
<font></font>
<span class="hljs-comment"># schedule.every().friday.at("12:00").do(send_check_water_level_email)</span><font></font>
<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment"># schedule.run_pending()</span>
&nbsp;&nbsp;&nbsp;&nbsp;time.sleep(<span class="hljs-number">1</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;main()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here you can change the values ‚Äã‚Äãof variables </font></font><code>WATERING_TIME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>SECONDS_TO_WATER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">those that seem suitable for you. The first variable determines what time to water the plants. The second sets the duration of watering. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, I created here a mechanism for sending notifications and reminders by e-mail. Thanks to this mechanism, the owner of the irrigation system receives an email every time the system is turned on and water the plants. In addition, every Friday he receives a letter reminding him that he needs to check the supplies of irrigation water. In the code, the call of the corresponding methods is commented out, as a result, the program can work normally without settings relating to e-mail. If you want to enable these reminders, do the following:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You must enter in the line </font></font><code>FROM = TO = ¬´YOUR_EMAIL@gmail.com¬ª</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>password = ¬´YOUR_PASSWORD¬ª</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">your Gmail email address and password.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uncomment the following lines: </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;# send_last_watered_email (time_keeper.time_last_watered)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># schedule.every (). friday.at ("12:00"). do (send_check_water_level_email)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># schedule.run_pending ()</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You need to go </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , log in to your Gmail account and turn on the switch on this page. </font><font style="vertical-align: inherit;">Otherwise, when you try to send an email using Gmail, you will receive an error message.&nbsp;</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, it‚Äôs important to note that my reminder system only works with Gmail accounts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now that everything is ready for work, you should get the following structure of files and folders:</font></font><br>
<br>
<pre><code class="bash hljs">run<font></font>
‚îú‚îÄ‚îÄ classes<font></font>
‚îÇ ‚îú‚îÄ‚îÄ Hardware.py<font></font>
‚îÇ ‚îî‚îÄ‚îÄ TimeKeeper.py<font></font>
‚îî‚îÄ‚îÄ water_plant.py<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A folder </font></font><code>run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">can actually be placed anywhere. </font><font style="vertical-align: inherit;">I decided to leave it in the folder </font></font><code>Desktop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I was not attracted by the prospect of connecting to the Raspberry Pi every time I had to start it </font></font><code>water_plant.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">I would like this script to run automatically when Raspberry Pi is turned on. </font><font style="vertical-align: inherit;">This, for example, would make it easy to turn off the system, move it to another place, turn it on, and not have to worry about anything. </font><font style="vertical-align: inherit;">In order to implement this attractive scenario, we need a team </font></font><code>crontab</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Open the terminal window on the Raspberry Pi and enter the following command:</font></font><br>
<br>
<pre><code class="bash hljs">sudo crontab -e
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In response to it, the system should output something resembling that shown in the following figure.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ca0/3cd/f45/ca03cdf45a0400ea64b5e163357e9079.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuring cron tasks</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Add the following line to this file:</font></font><br>
<br>
<pre><code class="bash hljs">@reboot python3 /home/pi/Desktop/run/water_plant.py
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then this file must be saved using the key combination </font></font><code>Ctrl+X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">by entering </font></font><code>Y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and pressing </font></font><code>Enter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the above line, we give the Raspberry Pi the following instructions: "Every time you reboot, run the file </font></font><code>water_plant.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">located in the folder </font></font><code>run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that is in the folder </font></font><code>Desktop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">." </font><font style="vertical-align: inherit;">If your folder </font></font><code>run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is located in a different way, edit this command accordingly.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Summary</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
View the project code </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">If you want, you can immediately clone your repository with this command:</font></font><br>
<br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/AlanConstantino/rpi-plant-project.git
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That's all! </font><font style="vertical-align: inherit;">Now you know how to create an automated irrigation system for indoor plants based on the Raspberry Pi. </font><font style="vertical-align: inherit;">She knows how to water plants every 24 hours and can send her owner email notifications and reminders. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dear readers! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How would you go about developing a home automated plant watering system?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/iq/fi/b4/iqfib45pgphfrxv--zfemt0qnmw.jpeg"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en495982/index.html">We study the Mediastreamer2 VoIP engine. Part 4</a></li>
<li><a href="../en495984/index.html">React, performance and -500 milliseconds at launch - the history of our optimizations in numbers</a></li>
<li><a href="../en495986/index.html">Analysis of international documents on information security risk management. Part 2</a></li>
<li><a href="../en495990/index.html">Disclosure of telephone number and geolocation through vulnerability in Telegram</a></li>
<li><a href="../en495994/index.html">Beginning of the academic quarter or how I became the coordinator of distance learning</a></li>
<li><a href="../en495998/index.html">Creating a Dark Theme for Stack Overflow</a></li>
<li><a href="../en496004/index.html">New models of data search and analysis. WSDM 2020 through the eyes of the Yandex.Tolki team</a></li>
<li><a href="../en496006/index.html">Outgrowing reverse proxy - technology for remote protection and site optimization without changing DNS A-records</a></li>
<li><a href="../en496010/index.html">What happens to transport during the crisis (first week of April)</a></li>
<li><a href="../en496014/index.html">IBM Weekly Seminars - April 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>