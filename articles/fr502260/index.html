<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòä ü§ûüèø üë©üèº‚Äçüç≥ ESP-NOW est un protocole de communication alternatif pour ESP8266 et ESP32. Concepts de base üó®Ô∏è üßú ü§ûüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ESP-NOW est un protocole WiFi simplifi√© pour le transfert de paquets courts entre des paires d'appareils coupl√©s, d√©velopp√© et publi√© par Espressif en...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ESP-NOW est un protocole de communication alternatif pour ESP8266 et ESP32. Concepts de base</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502260/"><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP-NOW est un protocole WiFi simplifi√© pour le transfert de paquets courts entre des paires d'appareils coupl√©s, d√©velopp√© et publi√© par </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espressif</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en 2016.07 pour les microcontr√¥leurs ESP8266 et ESP32. </font><font style="vertical-align: inherit;">Dans le m√™me temps, les proc√©dures suppl√©mentaires li√©es √† la prise en charge du protocole WiFi ne sont pas utilis√©es, ce qui acc√©l√®re le processus d'√©change de paquets. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP-NOW peut √™tre utilis√© sur l'Internet des objets pour contr√¥ler des sources lumineuses intelligentes, des relais, des prises, d'autres dispositifs de t√©l√©commande, recevoir des informations de capteurs et d'autres applications.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP-NOW prend en charge les fonctionnalit√©s suivantes</font></font></h4><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Communication crypt√©e et non crypt√©e entre les appareils coupl√©s.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Communication mixte crypt√©e et non crypt√©e entre les appareils coupl√©s. </font></font><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transf√©rez jusqu'√† 250 octets d'informations utiles.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mise en place d'une fonction de rappel pour informer la couche application, notamment, du succ√®s ou de l'√©chec de la transmission.</font></font></li>
</ul><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP-NOW pr√©sente √©galement les fonctionnalit√©s et limitations suivantes.</font></font></h4><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vitesse de transmission - pas plus de 1 Mbps √† une fr√©quence de 2,4 GHz, c'est-√†-dire </font><font style="vertical-align: inherit;">ESP-NOW fonctionne sur la m√™me fr√©quence et les m√™mes canaux que votre routeur WiFi.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protocole WiFi non utilis√©</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Similaire au protocole basse consommation utilis√© dans une souris sans fil 2,4 GHz.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seul le couplage initial est requis.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s le couplage, la connexion ne se rompt pas.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La diffusion n'est pas prise en charge - seule la distribution multiple aux paires d'appareils coupl√©s.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un maximum de 20 paires, y compris celles crypt√©es, sont prises en charge sur un seul appareil, y compris les paires crypt√©es.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un maximum de 10 paires chiffr√©es sont prises en charge en mode Station.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maximum 6 en mode SoftAP ou SoftAP + Station.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le chiffrement multidiffusion n'est pas pris en charge.</font></font></li>
</ul><br>
<u><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s√©curit√©</font></font></h2></u><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP-NOW adopte la technologie de trame IEEE802.11 Action Vendor avec la fonction IE d√©velopp√©e par Espressif et la technologie de cryptage CCMP, fournissant une solution de communication s√©curis√©e et sans connexion. </font><font style="vertical-align: inherit;">Un appareil Wi-Fi prend en charge une cl√© principale principale (PMK) et plusieurs cl√©s principales locales (LMK)</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PMK est</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilis√© pour chiffrer LMK √† l'aide de l'algorithme AES-128.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le p√©riph√©rique</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> coupl√© </font><b><font style="vertical-align: inherit;">LMK</font></b><font style="vertical-align: inherit;"> est utilis√© pour crypter les informations utilisateur √† l'aide de CCMP. </font><font style="vertical-align: inherit;">Le nombre maximal de LMK diff√©rents est de 6. Si aucun LMK n'est d√©fini pour le p√©riph√©rique coupl√©, les donn√©es utilisateur ne seront pas crypt√©es.</font></font></li>
</ul><br>
<u><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un niveau de base de</font></font></h2></u><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au niveau inf√©rieur du protocole ESP_NOW, une liste li√©e est conserv√©e contenant des informations sur le p√©riph√©rique local et le p√©riph√©rique coupl√©, y compris les adresses MAC et les cl√©s. </font><font style="vertical-align: inherit;">ESP-NOW stocke √©galement les donn√©es fr√©quemment utilis√©es pour la couche application pour √©viter les frais g√©n√©raux de retraitement de la liste li√©e. </font><font style="vertical-align: inherit;">Les informations sur les appareils sont utilis√©es pour envoyer et recevoir des donn√©es et incluent des </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">informations sur l'appareil local:</font></font></u> <br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PMK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 16 octets - la cl√© principale principale utilis√©e pour chiffrer la cl√© sur le p√©riph√©rique connect√© (KOK dans l'API) ESP_NOW prend en charge PMK par d√©faut, donc aucune configuration n'est requise. </font><font style="vertical-align: inherit;">Si n√©cessaire, vous pouvez v√©rifier que la valeur PMK correspond au p√©riph√©rique local.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mode</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 1 octet - le mode d'appareil local qui d√©finit l'interface WiFi de transmission (SoftAP ou STA) ESP-NOW. </font><font style="vertical-align: inherit;">Le mode d'appareil coupl√© n'affecte aucune fonction, mais enregistre uniquement les informations de mode pour la couche application. </font><font style="vertical-align: inherit;">En mode WiFi STA, seule Station est applicable et SoftAP WiFi n'est que SoftAP.</font></font><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modes de fonctionnement de l'appareil local ESP_NOW</font></font></b>
                        <div class="spoiler_text"><blockquote><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th></th>
<th> WiFi</th>
</tr>
<tr>
<td><b>IDLE</b></td>
<td> </td>
<td>   </td>
</tr>
<tr>
<td><b>CONTROLLER</b></td>
<td></td>
<td>STA</td>
</tr>
<tr>
<td><b>SLAVE</b></td>
<td></td>
<td>SoftAP‚Ä®</td>
</tr>
<tr>
<td><b>COMBO</b></td>
<td>&amp;</td>
<td>SoftAP</td>
</tr>
</tbody></table></div></blockquote><br>
</div>
                    </div></li>
</ul><br>
<u><font style="vertical-align: inherit;"></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Informations sur l' </font><u><font style="vertical-align: inherit;">appareil coupl√©</font></u><font style="vertical-align: inherit;"> (y compris les informations fr√©quemment utilis√©es et d'autres informations sur l'utilisateur):</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LMK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 16 octets - une cl√© principale locale qui est utilis√©e pour crypter la cl√© des informations utiles lors de la communication dans cette paire.</font></font></li>
<li><b>MAC-</b>: 6  ‚Äî   ,    . ,     Station, MAC-     Station.</li>
<li><b></b>: 1  ‚Äî       (SoftAP  STA) ESP-NOW.</li>
<li><b></b>: 1  ‚Äî ,     ,   .   0..255.       ,         .    . , 0 ,    ; 1 ~ 14   ;       ,    .</li>
</ul><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espressif</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne recommande pas l'utilisation d'op√©rations longues dans les fonctions de rappel lors de l'envoi / l'envoi de paquets, ce qui est vraisemblablement li√© √† la mise en ≈ìuvre d'algorithmes utilisant le m√©canisme d'interruption. </font><font style="vertical-align: inherit;">Cette hypoth√®se est √©galement soutenue par les probl√®mes associ√©s √† l'allocation dynamique de m√©moire dans les fonctions de rappel, qui sont r√©solus par l'utilisation pr√©f√©r√©e de variables statiques, ainsi que par l'ambigu√Øt√© de l'utilisation du </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©canisme d'</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> exception </font><i><font style="vertical-align: inherit;">MicroPython</font></i><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'impl√©mentation de l'asynchronie des processus de d√©but / fin, appariement, r√©ception / transmission de paquets </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espressif</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n'est </font><font style="vertical-align: inherit;">pas d√©crite, ce qui ne facilite pas non plus l'application de l'id√©ologie </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asyncio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MicroPython</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Format de package ESP-NOW</font></font></h4><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><b><font style="vertical-align: inherit;">t√™te MAC</font></b><font style="vertical-align: inherit;"> : 24 octets.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cat√©gorie</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 1 octet indiquant la cat√©gorie du cr√©ateur du package. </font><font style="vertical-align: inherit;">La valeur est d√©finie (127).</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID d'organisation</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 3 octets, contient un identifiant unique, qui est les trois premiers octets de l'adresse MAC utilis√©e par Espressif. </font><font style="vertical-align: inherit;">D√©finir la valeur (0x18fe34)</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valeur al√©atoire</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 4 octets, utilis√©e pour prot√©ger les donn√©es.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Donn√©es du cr√©ateur du package</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 7-255 octets</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les donn√©es du cr√©ateur de package contiennent les champs suivants:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 1 octet, r√©gl√© sur (221).</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Longueur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 1 octet, longueur totale de l'ID de l'organisation, type, version et donn√©es utilisateur.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID d'organisation</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 3 octets, contient un identifiant unique, qui est les trois premiers octets de l'adresse MAC utilis√©e par Espressif. </font><font style="vertical-align: inherit;">D√©finir la valeur (0x18fe34)</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 1 octet, protocole ESP-NOW. </font><font style="vertical-align: inherit;">Valeur de consigne (4)</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Version</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 1 octet, version actuelle d'ESP-NOW. </font><font style="vertical-align: inherit;">Install√© (1)</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenu</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 0-250 octets de donn√©es utilisateur.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FCS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 4 octets, somme de contr√¥le</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtant donn√© que ESP-NOW n'utilise pas le WiFi, l'en-t√™te MAC est l√©g√®rement diff√©rent de l'en-t√™te de paquet standard. </font><font style="vertical-align: inherit;">Les bits FromDS et ToDS du champ FrameControl sont 0. L'adresse de destination est sp√©cifi√©e dans le premier champ d'adresse. </font><font style="vertical-align: inherit;">Le deuxi√®me champ d'adresse affiche l'adresse source. </font><font style="vertical-align: inherit;">Le troisi√®me champ d'adresse est d√©fini comme adresse de diffusion (0xff: 0xff: 0xff: 0xff: 0xff: 0xff).</font></font><br>
<br>
<u><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algorithme d'application de base</font></font></h2></u><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©but et fin</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant d'utiliser ESP-NOW, il est recommand√© de r√©gler l'interface Wi-Fi dans le mode souhait√©. </font><font style="vertical-align: inherit;">En r√®gle g√©n√©rale, l'interface Station est d√©finie pour </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CONTROLLER</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , l'interface SoftAP pour </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SLAVE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COMBO</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il est √©galement conseill√© d'arr√™ter le Wi-Fi apr√®s avoir utilis√© ESP-NOW. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour d√©marrer ESP-NOW, appelez </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_init ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_deinit ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour terminer. </font><font style="vertical-align: inherit;">Lorsque </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_deinit ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est appel√© </font><font style="vertical-align: inherit;">, toutes les informations sur les appareils coupl√©s sont supprim√©es.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fonctions de rappel de liaison</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonction de traitement d'appel lors de l'envoi du paquet </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_register_send_cb ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> peut √™tre utilis√©e pour informer le niveau d'application de l'exp√©diteur dans une paire du succ√®s ou de l'√©chec de la transmission, par exemple, si les informations sur la sous-couche MAC sont transmises avec succ√®s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous utilisez </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_register_send_cb ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><i><font style="vertical-align: inherit;">tenez</font></i><font style="vertical-align: inherit;"> compte des √©l√©ments suivants: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans une paire li√©e:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la couche application n'a pas re√ßu le paquet, mais que la fonction de rappel a renvoy√© "succ√®s", la raison pourrait √™tre: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - les attaques d'un appareil frauduleux </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - les erreurs d'installation de cl√© crypt√©e </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - la perte de paquet au niveau de l'application Espressif</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la couche application a re√ßu le paquet, mais que la fonction de rappel renvoie une erreur, la cause peut √™tre: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Le canal est occup√© et l'ACK n'est pas re√ßu.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec plusieurs communications avec toutes les paires de l'appareil local:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si le rappel renvoie ¬´succ√®s¬ª, cela signifie que le paquet a √©t√© envoy√© avec succ√®s.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la fonction de rappel renvoie une erreur, cela signifie que le paquet n'a pas √©t√© envoy√© avec succ√®s.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonction de traitement des appels lors de la r√©ception du paquet </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_register_receive_cb ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> renvoie des informations comprenant l'adresse MAC du p√©riph√©rique </font><i><font style="vertical-align: inherit;">√©metteur</font></i><font style="vertical-align: inherit;"> dans une paire et des informations utiles. </font><font style="vertical-align: inherit;">Il peut √©galement √™tre utilis√© pour informer la couche application du p√©riph√©rique √©metteur associ√© au r√©cepteur que le paquet a √©t√© re√ßu avec succ√®s.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajout d'une paire d'appareils coupl√©s</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant d'envoyer des donn√©es, vous devez ajouter le p√©riph√©rique √† la liste des paires de p√©riph√©riques coupl√©s en appelant </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_add_peer ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Avant d'envoyer des donn√©es √† un groupe de paires √©tablies, vous devez ajouter un p√©riph√©rique avec une adresse MAC de multidiffusion. </font><font style="vertical-align: inherit;">La plage de canaux des appareils coupl√©s va de 0 √† 14. Si le canal est r√©gl√© sur 0, les donn√©es seront envoy√©es sur le canal actuel. </font><font style="vertical-align: inherit;">Sinon, le canal doit √™tre d√©fini comme le canal sur lequel se trouve le p√©riph√©rique local.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s√©curit√©</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si la cl√© doit √™tre chiffr√©e, vous pouvez appeler </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_set_pmk ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour la configurer </font><font style="vertical-align: inherit;">pour d√©finir PMK. </font><font style="vertical-align: inherit;">Si PMK n'est pas install√©, PMK sera utilis√© par d√©faut et s√©lectionnera la m√™me cl√© pour tous les appareils. </font><font style="vertical-align: inherit;">D√©finissez √©galement LMK pour les paires s√©lectionn√©es.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envoi de donn√©es avec les packages ESP-NOW</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilisez </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_send ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour envoyer des donn√©es ESP-NOW </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dans le m√™me temps, la fonction d√©finie pr√©c√©demment dans </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_register_send_cb ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> renverra </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP_NOW_SEND_SUCCESS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lors de l'envoi d'une fonction de rappel si les donn√©es ont √©t√© re√ßues avec succ√®s au niveau MAC. </font><font style="vertical-align: inherit;">Sinon, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP_NOW_SEND_FAIL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> reviendra </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Plusieurs raisons peuvent emp√™cher ESP-NOW d'envoyer des donn√©es. </font><font style="vertical-align: inherit;">En particulier,</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le p√©riph√©rique cible n'existe pas;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les canaux de l'appareil ne correspondent pas;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les donn√©es sont perdues pendant la transmission.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'est pas garanti que la couche application accepte n√©cessairement les donn√©es. Si n√©cessaire, vous pouvez envoyer une confirmation lorsque vous recevez des donn√©es ESP-NOW. Si un d√©lai de confirmation se produit, la transmission des donn√©es ESP-NOW doit √™tre r√©p√©t√©e. Un num√©ro de s√©quence peut √©galement √™tre attribu√© aux donn√©es ESP-NOW pour supprimer les donn√©es en double. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors de l'envoi de donn√©es ESP-NOW via </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_send (),</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> veuillez noter que pas plus de 250 octets d'informations peuvent √™tre envoy√©s √† la fois.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ATTENTION! Un intervalle trop court entre l'envoi de deux paquets ESP-NOW peut entra√Æner des erreurs dans l'ex√©cution de la fonction de rappel, il est donc recommand√© d'envoyer le prochain paquet de donn√©es ESP-NOW une fois que la fonction de rappel a termin√© avec succ√®s le traitement de l'envoi pr√©c√©dent. La fonction de rappel est envoy√©e √† partir d'une t√¢che Wi-Fi de haute priorit√©. Par cons√©quent, il n'est pas recommand√© d'effectuer de longues op√©rations dans la fonction de rappel. Au lieu de cela, vous pouvez placer les donn√©es n√©cessaires dans une file d'attente statique et les traiter √† partir d'un processus avec une priorit√© inf√©rieure.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si la fonction d'envoi renvoie une adresse MAC, celle-ci sera envoy√©e √† l'appareil avec cette adresse MAC. </font><font style="vertical-align: inherit;">Si la fonction d'envoi retourne NULL, le paquet sera envoy√© √† tous les p√©riph√©riques attach√©s √† celui d'envoi, ce qui peut entra√Æner une d√©faillance ou un retard de transmission en raison de l'encombrement du r√©seau.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP-NOW Recevoir des donn√©es</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonction de rappel d√©marre √©galement √† partir d'une t√¢che Wi-Fi. </font><font style="vertical-align: inherit;">Par cons√©quent, il n'est pas recommand√© d'effectuer de longues op√©rations dans la fonction de rappel. </font><font style="vertical-align: inherit;">Au lieu de cela, vous pouvez placer les donn√©es n√©cessaires dans une file d'attente statique et les traiter avec un processus de priorit√© inf√©rieure.</font></font><br>
<br>
<u><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En conclusion, ce qui pr√©c√®de</font></font></h2></u><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mon exp√©rience dans la construction de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espressif IDE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MicroPython</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec ESP-NOW, d√©crivant les erreurs que j'ai rencontr√©es lors de l'assemblage et allant les corriger apr√®s avoir obtenu un r√©sultat stable. Ensuite, je ferai une description de la biblioth√®que ESP-NOW sur MicroPython avec les erreurs d√©tect√©es et les moyens de les r√©soudre. Malheureusement, √©tant donn√© que le code source d'ESP-NOW est ferm√© et distribu√© uniquement sous forme binaire, la compr√©hension des algorithmes du protocole ESP-NOW est empirique et il existe un certain nombre de probl√®mes qui ont d√©j√† √©t√© identifi√©s, pour lesquels il n'y a pas toujours des options pour les surmonter logiquement, mais en g√©n√©ral ESP -NOW a √©t√© appliqu√© avec succ√®s dans la communaut√© des utilisateurs C et des pythonistes sur la base de plus de 300 applications pr√©sent√©es sur GitHub. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description de la biblioth√®que ESP-NOW C par </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espressif</font></font></i></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">Description de MicroPython</font></i><font style="vertical-align: inherit;"> ESP-NOW et sources ouvertes</font></font><i><font style="vertical-align: inherit;"></font></i></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr502248/index.html">Un nouveau GOST pour les ressources num√©riques est entr√© en vigueur: toutes les plateformes doivent √™tre accessibles aux personnes handicap√©es</a></li>
<li><a href="../fr502250/index.html">L'aviation civile aujourd'hui: aspects et d√©fis importants de la formation</a></li>
<li><a href="../fr502252/index.html">T√©l√©commande et drones</a></li>
<li><a href="../fr502254/index.html">PostgreSQL: programmation c√¥t√© serveur en langage humain (PL / Perl, PL / Python, PL / v8)</a></li>
<li><a href="../fr502256/index.html">Comment visualiser un graphique d'int√©gration Spring √† l'aide de Neo4j?</a></li>
<li><a href="../fr502262/index.html">Pourquoi les AIOps et la surveillance parapluie pour la banque, ou sur quoi se construisent les relations avec la client√®le</a></li>
<li><a href="../fr502264/index.html">Infrastructure √† cl√© publique. D√©livrance de certificats dans des conditions d'auto-isolement</a></li>
<li><a href="../fr502266/index.html">Aurora sur la plate-forme Intel. L'aube de l'√®re des exaflops</a></li>
<li><a href="../fr502268/index.html">HackTheBox. Adoption de brevets. XXE via des fichiers DOCX, LFI √† RCE, GIT et ROP</a></li>
<li><a href="../fr502272/index.html">Ne dites pas ¬´je me sens¬ª et les autres r√®gles anglaises qui conduisent √† la stupeur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>