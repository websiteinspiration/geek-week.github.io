<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>  そ Incruste las notas breves del programador: duplicaci贸n de secci贸n en la memoria del microcontrolador   </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Condiciones iniciales
 Hay un dispositivo basado en un microcontrolador (por ejemplo, se tomar谩 stm32f405rgt6). Cuando se enciende, ajusta sus perif茅r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Incruste las notas breves del programador: duplicaci贸n de secci贸n en la memoria del microcontrolador</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487604/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Condiciones iniciales</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay un dispositivo basado en un microcontrolador (por ejemplo, se tomar谩 stm32f405rgt6). </font><font style="vertical-align: inherit;">Cuando se enciende, ajusta sus perif茅ricos seg煤n las preferencias del usuario o la configuraci贸n predeterminada. </font><font style="vertical-align: inherit;">El usuario puede cambiar la configuraci贸n durante la operaci贸n del dispositivo (por regla general, solo durante la integraci贸n en el complejo) a trav茅s de una de las interfaces posibles (men煤 CLI o utilidad para configurar los par谩metros de operaci贸n que funcionan a trav茅s del protocolo binario). </font><font style="vertical-align: inherit;">Despu茅s de configurar los par谩metros, el usuario guarda la configuraci贸n con un comando especial (tambi茅n a trav茅s de una de las posibles interfaces).</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarea</font></font></h2><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para reducir el tiempo que lleva acceder a las variables de configuraci贸n del dispositivo durante la operaci贸n, debe mantener los valores actuales en la RAM (por lo general, la cantidad de dichos datos var铆a de una docena de variables a 3 kilobytes, seg煤n el dispositivo).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es necesario almacenar la configuraci贸n del usuario por duplicado en el flash del microcontrolador.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada instancia de configuraci贸n del usuario debe terminar con CRC32 inmediatamente despu茅s de la carga 煤til.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para cada instancia de configuraci贸n del usuario, se utiliza una p谩gina separada en la memoria flash (incluso si los datos 煤tiles son 2 kb, y las p谩ginas se dividen por 128 kb, entonces toda la p谩gina se da en un bloque)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El c贸digo del software del microcontrolador debe almacenar la configuraci贸n predeterminada, que debe ser el bloque de configuraci贸n del usuario si ambos tienen datos corruptos.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intentos de resolver</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GCC (al momento de escribir este art铆culo) no tiene una bandera para obtener una copia de la secci贸n. </font><font style="vertical-align: inherit;">Complementar el script LD con &lt;&lt; l铆neas m谩gicas &gt;&gt; tambi茅n falla. </font><font style="vertical-align: inherit;">Se podr铆a trabajar con objcopy, pero este enfoque es muy impl铆cito y conduce a errores sutiles.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisi贸n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La soluci贸n es crear copias impl铆citas de la entidad deseada (variable, estructura, matriz, etc.) en el c贸digo del usuario, seguido de su ubicaci贸n en la memoria.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crear una macro para la copia oculta de estructuras</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creemos una macro con la que reservaremos un lugar para la estructura en RAM, 2 instancias de memoria flash en p谩ginas separadas y en el c贸digo de usuario (para valores iniciales).</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> USER_CFG_DATA_STRUCT(TYPE,NAME,...) \
    __attribute__((aligned(4), section (<span class="hljs-meta-string">".user_cfg_data_ram_page"</span>))) \
    TYPE NAME = __VA_ARGS__; \
    __attribute__((aligned(4), section (<span class="hljs-meta-string">".user_cfg_data_flash_default_page"</span>))) \
    TYPE flash_default_page_##NAME = __VA_ARGS__; \
    __attribute__((aligned(4), section (<span class="hljs-meta-string">".user_cfg_data_flash_page_1"</span>))) \
    TYPE flash_page_1_##NAME = __VA_ARGS__; \
    __attribute__((aligned(4), section (<span class="hljs-meta-string">".user_cfg_data_flash_page_2"</span>))) \
    TYPE flash_page_2_##NAME = __VA_ARGS__;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usando una macro, se crear谩n 4 instancias de la estructura con diferentes nombres. </font><font style="vertical-align: inherit;">En el c贸digo del proyecto (con la excepci贸n del sistema para trabajar con p谩ginas de memoria de configuraci贸n del usuario), todos los m贸dulos deben usar una estructura sin prefijo (el nombre especificado en la macro) que estar谩 en la RAM (ser谩 posible cambiar los m贸dulos que son responsables de la interacci贸n del usuario. El resto solo debe leer de ella). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un ejemplo de uso de una macro en el c贸digo de usuario:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">test_st</span> {</span>
    <span class="hljs-keyword">uint32_t</span> a1;
    <span class="hljs-keyword">uint32_t</span> a2;<font></font>
} <span class="hljs-keyword">test_st_t</span>;<font></font>
<font></font>
USER_CFG_DATA_STRUCT(<span class="hljs-keyword">test_st_t</span>, name_st, {<font></font>
    .a1 = <span class="hljs-number">1</span>,<font></font>
    .a2 = <span class="hljs-number">2</span>
})</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu茅s de la instancia de la estructura name_st est谩 disponible desde el c贸digo del proyecto.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crear macros para la copia oculta de otras entidades.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para crear una variable, solo necesita hacer la macro sustituci贸n para crear estructuras. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para matrices, agregue el n煤mero de elementos.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> USER_CFG_DATA_VAR USER_CFG_DATA_STRCUT</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> USER_CFG_DATA_ARRAY(TYPE,NAME,SIZE,...) \
    __attribute__((aligned(4), section (<span class="hljs-meta-string">".user_cfg_data_ram_page"</span>))) \
    TYPE NAME[SIZE] = __VA_ARGS__; \
    __attribute__((aligned(4), section (<span class="hljs-meta-string">".user_cfg_data_flash_default_page"</span>))) \
    TYPE flash_default_page_##NAME[SIZE] = __VA_ARGS__; \
    __attribute__((aligned(4), section (<span class="hljs-meta-string">".user_cfg_data_flash_page_1"</span>))) \
    TYPE flash_page_1_##NAME[SIZE] = __VA_ARGS__; \
    __attribute__((aligned(4), section (<span class="hljs-meta-string">".user_cfg_data_flash_page_2"</span>))) \
    TYPE flash_page_2_##NAME[SIZE] = __VA_ARGS__;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El principio de uso es similar al uso de la estructura.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finalizaci贸n del script LD</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al crear copias de entidades, se indic贸 en qu茅 secciones se encuentran. </font><font style="vertical-align: inherit;">Ahora debe crear estas secciones en el script LD. </font><font style="vertical-align: inherit;">Para F4, el script LD aumentado de ST se ver谩 as铆:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secuencia de comandos LD</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs">MEMORY<font></font>
{<font></font>
    FLASH (rx) : ORIGIN = <span class="hljs-number">0x08000000</span>, LENGTH = <span class="hljs-number">1024</span>K - <span class="hljs-number">256</span>K <span class="hljs-comment">/* 256   user_cfg */</span>
   USER_CFG_PAGE_1 (rx) : ORIGIN = <span class="hljs-number">0x080C0000</span>, LENGTH = <span class="hljs-number">128</span>K - <span class="hljs-number">4</span>     <span class="hljs-comment">/* 4  CRC32 */</span>
    USER_CFG_PAGE_2 (rx) : ORIGIN = <span class="hljs-number">0x080E0000</span>, LENGTH = <span class="hljs-number">128</span>K - <span class="hljs-number">4</span>     <span class="hljs-comment">/* 4  CRC32 */</span>
    CCM (xrw) : ORIGIN = <span class="hljs-number">0x10000000</span>, LENGTH = <span class="hljs-number">64</span>K<font></font>
    RAM (xrw) : ORIGIN = <span class="hljs-number">0x20000000</span>, LENGTH = <span class="hljs-number">128</span>K<font></font>
}<font></font>
</code></pre><br>
<pre><code class="cpp hljs"><span class="hljs-comment">/*       CRC32.
       .      - . */</span>
user_cfg_data_flash_page_1_size = LENGTH(user_cfg_PAGE_1) + <span class="hljs-number">4</span>;<font></font>
user_cfg_data_flash_page_2_size = LENGTH(user_cfg_PAGE_2) + <span class="hljs-number">4</span>;<font></font>
user_cfg_data_flash_page_size = user_cfg_data_flash_page_1_size;<font></font>
<font></font>
<span class="hljs-comment">/*
 * The '__stack' definition is required by crt0, do not remove it.
 */</span><font></font>
__stack = ORIGIN(RAM) + LENGTH(RAM);<font></font>
<font></font>
_estack = __stack;     <span class="hljs-comment">/* STM specific definition */</span><font></font>
<font></font>
<span class="hljs-comment">/*
 * Default stack sizes.
 * These are used by the startup in order to allocate stacks
 * for the different modes.
 */</span><font></font>
<font></font>
__Main_Stack_Size = <span class="hljs-number">1024</span> ;<font></font>
<font></font>
PROVIDE ( _Main_Stack_Size = __Main_Stack_Size ) ;<font></font>
<font></font>
__Main_Stack_Limit = __stack  - __Main_Stack_Size ;<font></font>
<font></font>
<span class="hljs-comment">/*"PROVIDE" allows to easily override these values from an object file or the command line. */</span><font></font>
PROVIDE ( _Main_Stack_Limit = __Main_Stack_Limit ) ;<font></font>
<font></font>
<span class="hljs-comment">/*
 * There will be a link error if there is not this amount of
 * RAM free at the end.
 */</span>
_Minimum_Stack_Size = <span class="hljs-number">512</span> ;<font></font>
<font></font>
<span class="hljs-comment">/*
 * Default heap definitions.
 * The heap start immediately after the last statically allocated
 * .sbss/.noinit section, and extends up to the main stack limit.
 */</span><font></font>
PROVIDE ( _Heap_Begin = _end_noinit ) ;<font></font>
PROVIDE ( _Heap_Limit = __stack - __Main_Stack_Size ) ;<font></font>
<font></font>
SECTIONS<font></font>
{<font></font>
    .isr_vector :<font></font>
    {<font></font>
        KEEP(*(.isr_vector))         <span class="hljs-comment">/* Interrupt vectors */</span>
        KEEP(*(.cfmconfig))            <span class="hljs-comment">/* Freescale configuration words */</span>
        *(.after_vectors .after_vectors.*)    <span class="hljs-comment">/* Startup code and ISR */</span>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
    } &gt;FLASH<font></font>
<font></font>
    .inits :<font></font>
    {<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
<font></font>
        <span class="hljs-comment">/*
         * These are the old initialisation sections, intended to contain
         * naked code, with the prologue/epilogue added by crti.o/crtn.o
         * when linking with startup files. The standalone startup code
         * currently does not run these, better use the init arrays below.
         */</span><font></font>
        KEEP(*(.init))<font></font>
        KEEP(*(.fini))<font></font>
<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
<font></font>
        <span class="hljs-comment">/*
         * The preinit code, i.e. an array of pointers to initialisation
         * functions to be performed before constructors.
         */</span><font></font>
        PROVIDE_HIDDEN (__preinit_array_start = .);<font></font>
<font></font>
        <span class="hljs-comment">/*
         * Used to run the SystemInit() before anything else.
         */</span><font></font>
        KEEP(*(.preinit_array_sysinit .preinit_array_sysinit.*))<font></font>
<font></font>
        <span class="hljs-comment">/*
         * Used for other platform inits.
         */</span><font></font>
        KEEP(*(.preinit_array_platform .preinit_array_platform.*))<font></font>
<font></font>
        <span class="hljs-comment">/*
         * The application inits. If you need to enforce some order in
         * execution, create new sections, as before.
         */</span><font></font>
        KEEP(*(.preinit_array .preinit_array.*))<font></font>
<font></font>
        PROVIDE_HIDDEN (__preinit_array_end = .);<font></font>
<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
<font></font>
        <span class="hljs-comment">/*
         * The init code, i.e. an array of pointers to static constructors.
         */</span><font></font>
        PROVIDE_HIDDEN (__init_array_start = .);<font></font>
        KEEP(*(SORT(.init_array.*)))<font></font>
        KEEP(*(.init_array))<font></font>
        PROVIDE_HIDDEN (__init_array_end = .);<font></font>
<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
<font></font>
        <span class="hljs-comment">/*
         * The fini code, i.e. an array of pointers to static destructors.
         */</span><font></font>
        PROVIDE_HIDDEN (__fini_array_start = .);<font></font>
        KEEP(*(SORT(.fini_array.*)))<font></font>
        KEEP(*(.fini_array))<font></font>
        PROVIDE_HIDDEN (__fini_array_end = .);<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
<font></font>
    } &gt;FLASH<font></font>
<font></font>
    <span class="hljs-comment">/*
     * For some STRx devices, the beginning of the startup code
     * is stored in the .flashtext section, which goes to FLASH.
     */</span><font></font>
    .flashtext :<font></font>
    {<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        *(.flashtext .flashtext.*)    <span class="hljs-comment">/* Startup code */</span>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
    } &gt;FLASH<font></font>
<font></font>
<font></font>
    <span class="hljs-comment">/*
     * The program code is stored in the .text section,
     * which goes to FLASH.
     */</span><font></font>
    .text :<font></font>
    {<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
<font></font>
        *(.text .text.*)            <span class="hljs-comment">/* all remaining code */</span><font></font>
<font></font>
        *(.rodata .rodata.*)         <span class="hljs-comment">/* read-only data (constants) */</span><font></font>
<font></font>
        *(vtable)                    <span class="hljs-comment">/* C++ virtual tables */</span><font></font>
<font></font>
        KEEP(*(.eh_frame*))<font></font>
<font></font>
        <span class="hljs-comment">/*
         * Stub sections generated by the linker, to glue together
         * ARM and Thumb code. .glue_7 is used for ARM code calling
         * Thumb code, and .glue_7t is used for Thumb code calling
         * ARM code. Apparently always generated by the linker, for some
         * architectures, so better leave them here.
         */</span><font></font>
        *(.glue_7)<font></font>
        *(.glue_7t)<font></font>
    } &gt;FLASH<font></font>
<font></font>
    .user_cfg_data_flash_default_page :<font></font>
    {<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        user_cfg_data_flash_default_page_start = .;<font></font>
        KEEP(*(.user_cfg_data_flash_default_page .user_cfg_data_flash_default_page.*))<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        user_cfg_data_flash_default_page_stop = .;<font></font>
    } &gt;FLASH<font></font>
<font></font>
    <span class="hljs-comment">/* ARM magic sections */</span><font></font>
    .ARM.extab :<font></font>
       {<font></font>
       *(.ARM.extab* .gnu.linkonce.armextab.*)<font></font>
       } &gt; FLASH<font></font>
<font></font>
       __exidx_start = .;<font></font>
       .ARM.exidx :<font></font>
       {<font></font>
       *(.ARM.exidx* .gnu.linkonce.armexidx.*)<font></font>
       } &gt; FLASH<font></font>
       __exidx_end = .;<font></font>
<font></font>
    . = ALIGN(<span class="hljs-number">4</span>);<font></font>
    _etext = .;<font></font>
    __etext = .;<font></font>
<font></font>
    <span class="hljs-comment">/*
     * This address is used by the startup code to
     * initialise the .data section.
     */</span><font></font>
    _sidata = _etext;<font></font>
<font></font>
    <span class="hljs-comment">/* MEMORY_ARRAY */</span>
    <span class="hljs-comment">/*
    .ROarraySection :
    {
         *(.ROarraySection .ROarraySection.*)
    } &gt;MEMORY_ARRAY
    */</span><font></font>
<font></font>
    <span class="hljs-comment">/*
     * The initialised data section.
     * The program executes knowing that the data is in the RAM
     * but the loader puts the initial values in the FLASH (inidata).
     * It is one task of the startup to copy the initial values from
     * FLASH to RAM.
     */</span><font></font>
    .data  : AT ( _sidata )<font></font>
    {<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
<font></font>
        <span class="hljs-comment">/* This is used by the startup code to initialise the .data section */</span>
        _sdata = . ;            <span class="hljs-comment">/* STM specific definition */</span><font></font>
        __data_start__ = . ;<font></font>
        *(.data_begin .data_begin.*)<font></font>
<font></font>
        *(.data .data.*)<font></font>
<font></font>
        *(.data_end .data_end.*)<font></font>
<font></font>
        *(.ramfunc*)<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
<font></font>
        <span class="hljs-comment">/* This is used by the startup code to initialise the .data section */</span>
        _edata = . ;            <span class="hljs-comment">/* STM specific definition */</span><font></font>
        __data_end__ = . ;<font></font>
<font></font>
    } &gt;RAM<font></font>
<font></font>
<font></font>
    <span class="hljs-comment">/*
     * The uninitialised data section. NOLOAD is used to avoid
     * the "section `.bss' type changed to PROGBITS" warning
     */</span><font></font>
    .bss (NOLOAD) :<font></font>
    {<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        __bss_start__ = .;         <span class="hljs-comment">/* standard newlib definition */</span>
        _sbss = .;              <span class="hljs-comment">/* STM specific definition */</span><font></font>
        *(.bss_begin .bss_begin.*)<font></font>
<font></font>
        *(.bss .bss.*)<font></font>
        *(COMMON)<font></font>
<font></font>
        *(.bss_end .bss_end.*)<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        __bss_end__ = .;        <span class="hljs-comment">/* standard newlib definition */</span>
        _ebss = . ;             <span class="hljs-comment">/* STM specific definition */</span><font></font>
    } &gt;RAM<font></font>
<font></font>
    .user_cfg_data_ram_page :<font></font>
    {<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        user_cfg_data_ram_page_start = .;<font></font>
        KEEP(*(.user_cfg_data_ram_page .user_cfg_data_ram_page.*))<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        user_cfg_data_ram_page_stop = .;<font></font>
    } &gt; CCM<font></font>
<font></font>
    user_cfg_data_ram_page_size = user_cfg_data_ram_page_stop - user_cfg_data_ram_page_start;<font></font>
<font></font>
    .user_cfg_data_page_1 :<font></font>
    {<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        user_cfg_data_flash_page_1_start = .;<font></font>
         KEEP(*(.user_cfg_data_flash_page_1 .user_cfg_data_flash_page_1.*))<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        user_cfg_data_flash_page_1_stop = .;<font></font>
    } &gt; user_cfg_PAGE_1<font></font>
<font></font>
    .user_cfg_data_page_2 :<font></font>
    {<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        user_cfg_data_flash_page_2_start = .;<font></font>
         KEEP(*(.user_cfg_data_flash_page_2 .user_cfg_data_flash_page_2.*))<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        user_cfg_data_flash_page_2_stop = .;<font></font>
    } &gt; user_cfg_PAGE_2<font></font>
<font></font>
    .noinit (NOLOAD) :<font></font>
    {<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        _noinit = .;<font></font>
<font></font>
        *(.noinit .noinit.*)<font></font>
<font></font>
         . = ALIGN(<span class="hljs-number">4</span>) ;<font></font>
        _end_noinit = .;<font></font>
    } &gt; RAM<font></font>
<font></font>
    <span class="hljs-comment">/* Mandatory to be word aligned, _sbrk assumes this */</span>
    PROVIDE ( end = _end_noinit ); <span class="hljs-comment">/* was _ebss */</span><font></font>
    PROVIDE ( _end = _end_noinit );<font></font>
    PROVIDE ( __end = _end_noinit );<font></font>
    PROVIDE ( __end__ = _end_noinit );<font></font>
<font></font>
    <span class="hljs-comment">/*
     * Used for validation only, do not allocate anything here!
     *
     * This is just to check that there is enough RAM left for the Main
     * stack. It should generate an error if it's full.
     */</span><font></font>
    ._check_stack :<font></font>
    {<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
        . = . + _Minimum_Stack_Size ;<font></font>
        . = ALIGN(<span class="hljs-number">4</span>);<font></font>
    } &gt;RAM<font></font>
<font></font>
<font></font>
    <span class="hljs-comment">/* After that there are only debugging sections. */</span><font></font>
<font></font>
    <span class="hljs-comment">/* This can remove the debugging information from the standard libraries */</span>
    <span class="hljs-comment">/*
    DISCARD :
    {
     libc.a ( * )
     libm.a ( * )
     libgcc.a ( * )
     }
     */</span><font></font>
<font></font>
    <span class="hljs-comment">/* Stabs debugging sections.  */</span>
    .stab          <span class="hljs-number">0</span> : { *(.stab) }<font></font>
    .stabstr       <span class="hljs-number">0</span> : { *(.stabstr) }<font></font>
    .stab.excl     <span class="hljs-number">0</span> : { *(.stab.excl) }<font></font>
    .stab.exclstr  <span class="hljs-number">0</span> : { *(.stab.exclstr) }<font></font>
    .stab.index    <span class="hljs-number">0</span> : { *(.stab.index) }<font></font>
    .stab.indexstr <span class="hljs-number">0</span> : { *(.stab.indexstr) }<font></font>
    .comment       <span class="hljs-number">0</span> : { *(.comment) }
    <span class="hljs-comment">/*
     * DWARF debug sections.
     * Symbols in the DWARF debugging sections are relative to the beginning
     * of the section so we begin them at 0.
     */</span>
    <span class="hljs-comment">/* DWARF 1 */</span>
    .debug          <span class="hljs-number">0</span> : { *(.debug) }<font></font>
    .line           <span class="hljs-number">0</span> : { *(.line) }
    <span class="hljs-comment">/* GNU DWARF 1 extensions */</span>
    .debug_srcinfo  <span class="hljs-number">0</span> : { *(.debug_srcinfo) }<font></font>
    .debug_sfnames  <span class="hljs-number">0</span> : { *(.debug_sfnames) }
    <span class="hljs-comment">/* DWARF 1.1 and DWARF 2 */</span>
    .debug_aranges  <span class="hljs-number">0</span> : { *(.debug_aranges) }<font></font>
    .debug_pubnames <span class="hljs-number">0</span> : { *(.debug_pubnames) }
    <span class="hljs-comment">/* DWARF 2 */</span>
    .debug_info     <span class="hljs-number">0</span> : { *(.debug_info .gnu.linkonce.wi.*) }<font></font>
    .debug_abbrev   <span class="hljs-number">0</span> : { *(.debug_abbrev) }<font></font>
    .debug_line     <span class="hljs-number">0</span> : { *(.debug_line) }<font></font>
    .debug_frame    <span class="hljs-number">0</span> : { *(.debug_frame) }<font></font>
    .debug_str      <span class="hljs-number">0</span> : { *(.debug_str) }<font></font>
    .debug_loc      <span class="hljs-number">0</span> : { *(.debug_loc) }<font></font>
    .debug_macinfo  <span class="hljs-number">0</span> : { *(.debug_macinfo) }
    <span class="hljs-comment">/* SGI/MIPS DWARF 2 extensions */</span>
    .debug_weaknames <span class="hljs-number">0</span> : { *(.debug_weaknames) }<font></font>
    .debug_funcnames <span class="hljs-number">0</span> : { *(.debug_funcnames) }<font></font>
    .debug_typenames <span class="hljs-number">0</span> : { *(.debug_typenames) }<font></font>
    .debug_varnames  <span class="hljs-number">0</span> : { *(.debug_varnames) }<font></font>
}<font></font>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este ejemplo, la estructura de configuraci贸n no se encuentra en el 谩rea de RAM, sino en CCMRAM, para mejorar el rendimiento. </font><font style="vertical-align: inherit;">Tambi茅n noto que los bloques de datos de configuraci贸n del usuario son las 煤ltimas 2 p谩ginas flash, cada una de las cuales tiene 128 kb.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicializaci贸n y control de copias.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El cuidado de lo que se encuentra en la RAM recae en el programador. Antes de utilizar datos de esta 谩rea por primera vez, debe inicializar el 谩rea. En flash, al cargar el programa en el microcontrolador, los datos se grabar谩n previamente con los valores iniciales especificados en el c贸digo del programa. Esto har谩 copias no v谩lidas de los bloques de configuraci贸n del usuario en p谩ginas separadas si terminan en CRC32 (ya que no se realiza ning煤n c谩lculo de CRC32. Su c贸digo puede hacerlo. Tambi茅n hasta el primer uso de los par谩metros de configuraci贸n). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para escribir un m贸dulo para trabajar con bloques de configuraci贸n, necesitar谩 usar las variables del script LD. Se requerir谩 lo siguiente:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">uint32_t</span> user_cfg_data_flash_default_page_start;
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">uint32_t</span> user_cfg_data_flash_page_1_start;
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">uint32_t</span> user_cfg_data_flash_page_2_start;
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">uint32_t</span> user_cfg_data_ram_page_start;<font></font>
<font></font>
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">uint32_t</span> user_cfg_data_flash_page_size;
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">uint32_t</span> user_cfg_data_ram_page_size;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem谩s, no olvide que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user_cfg_data_flash_page_size</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user_cfg_data_ram_page_size</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se pueden asignar como valores normales. </font><font style="vertical-align: inherit;">Pero </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user_cfg_data_flash_page_1_start</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y otras variables que almacenan la direcci贸n deben especificarse mediante &amp;.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es487584/index.html">Githabificaci贸n de la seguridad de la informaci贸n</a></li>
<li><a href="../es487588/index.html">Quarkus: veterinario subat贸mico supers贸nico</a></li>
<li><a href="../es487592/index.html">VMware vSAN 6.7 - Y el trueno golpe贸</a></li>
<li><a href="../es487594/index.html">Entretenida mnemotecnia: recolectamos memoria auditiva de visual</a></li>
<li><a href="../es487596/index.html">Eugene Varavva, desarrollador de Google. C贸mo describir Google en 5 palabras</a></li>
<li><a href="../es487606/index.html">Visualizaci贸n de l铆neas de tensi贸n y movimientos de cargas electrost谩ticas, simulaci贸n del movimiento planetario del sistema solar.</a></li>
<li><a href="../es487610/index.html">RealWorld: aiohttp, Tortoise ORM</a></li>
<li><a href="../es487612/index.html">Agregue, elimine y renombre f谩cilmente archivos y objetivos en proyectos CMake</a></li>
<li><a href="../es487616/index.html">Crear un elemento personalizado con una tabla de ejemplo en C # para Windows Form</a></li>
<li><a href="../es487620/index.html">Resoluci贸n de problemas con pwnable.kr 27 - tiny_easy. Entendiendo la pulverizaci贸n de pilas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>