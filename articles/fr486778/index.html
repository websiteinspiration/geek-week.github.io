<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòà üë®üèΩ‚Äçüé§ ‚úäüèø SSO sur l'architecture de microservice. Nous utilisons Keycloak. Num√©ro de pi√®ce 1 üôèüèæ üßìüèº üßëüèæ‚Äçü§ù‚ÄçüßëüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans toute grande entreprise, le X5 Retail Group ne fait pas exception, car le nombre de projets n√©cessitant une authentification des utilisateurs aug...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>SSO sur l'architecture de microservice. Nous utilisons Keycloak. Num√©ro de pi√®ce 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/X5RetailGroup/blog/486778/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans toute grande entreprise, le X5 Retail Group ne fait pas exception, car le nombre de projets n√©cessitant une authentification des utilisateurs augmente √† mesure que le nombre de projets augmente. Au fil du temps, une transition transparente des utilisateurs d'une application √† une autre est n√©cessaire, puis il est n√©cessaire d'utiliser un seul serveur Single-Sing-On (SSO). Mais qu'en est-il lorsque des fournisseurs d'identit√© tels que AD ou d'autres qui n'ont pas d'attributs suppl√©mentaires sont d√©j√† utilis√©s dans divers projets. Une classe de syst√®mes appel√©s ¬´courtiers d'identit√©¬ª viendra √† la rescousse. Les plus fonctionnels sont ses repr√©sentants, tels que Keycloak, Gravitee Access management, etc. Le plus souvent, les sc√©narios d'utilisation peuvent √™tre diff√©rents: interaction machine, participation des utilisateurs, etc. La solution doit supporter des fonctionnalit√©s flexibles et √©volutives,capable de combiner toutes les exigences en une seule, et une telle solution dans notre entreprise est maintenant un courtier indicateur - Keycloak.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hm/bi/eh/hmbiehmxsfcq_cfltz8xj0mhrgc.jpeg"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Keycloak est un produit open source pour l'authentification et le contr√¥le d'acc√®s pris en charge par RedHat. </font><font style="vertical-align: inherit;">C'est la base des produits de l'entreprise utilisant SSO - RH-SSO.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Concepts de base </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant de commencer √† traiter des d√©cisions et des approches, vous devez d√©terminer les termes et la s√©quence des processus: L' </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mm/j1/c2/mmj1c2uynwb23y5j4me13zzcrb4.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">identification</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est le processus de reconnaissance d'un sujet par son identifiant (en d'autres termes, il d√©termine un nom, un identifiant ou un num√©ro). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'authentification</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est une proc√©dure d'authentification (un utilisateur est v√©rifi√© avec un mot de passe, une lettre est v√©rifi√©e par signature √©lectronique, etc.) L' </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">autorisation</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est la fourniture d'acc√®s √† une ressource (par exemple, un courrier √©lectronique).</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Courtier d'identit√© Keycloak</font></font></h4><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keycloak</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est une solution open source de gestion des identit√©s et des acc√®s con√ßue pour √™tre utilis√©e dans les circuits int√©gr√©s o√π des mod√®les d'architecture de microservices peuvent √™tre utilis√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Keycloak offre des fonctionnalit√©s telles que l'authentification unique (SSO), l'identification du courtier et la connexion sociale, la f√©d√©ration des utilisateurs, les adaptateurs client, une console d'administrateur et une console de gestion de compte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fonctionnalit√© de base prise en charge dans Keycloak:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Authentification unique et d√©connexion unique pour les applications bas√©es sur un navigateur.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prise en charge d'OpenID / OAuth 2.0 / SAML.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Courtage d'identit√© - Authentification √† l'aide de fournisseurs d'identit√© OpenID Connect externes ou SAML.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connexion sociale - prise en charge de Google, GitHub, Facebook, Twitter pour l'identification des utilisateurs.</font></font></li>
<li>User Federation ‚Äì    LDAP  Active Directory     .</li>
<li>Kerberos bridge ‚Äì  Kerberos     .</li>
<li>Admin Console ‚Äî         Web.</li>
<li>Account Management Console ‚Äì     .</li>
<li>      .</li>
<li>2FA Authentication ‚Äì  TOTP/HOTP   Google Authenticator  FreeOTP.</li>
<li>Login Flows ‚Äì   ,      .</li>
<li>Session Management ‚Äì        .</li>
<li>Token Mappers ‚Äì   ,       .</li>
<li>    realm, application  .</li>
<li>CORS Support ‚Äì      CORS.</li>
<li>Service Provider Interfaces (SPI) ‚Äì   SPI,      :  ,  ,     .</li>
<li>   JavaScript applications, WildFly, JBoss EAP, Fuse, Tomcat, Jetty, Spring.</li>
<li>    ,  OpenID Connect Relying Party library  SAML 2.0 Service Provider Library.</li>
<li>    plugins.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour les processus CI / CD, ainsi que l'automatisation des processus de gestion dans Keycloak, l'API REST / API JAVA peut √™tre utilis√©e. </font><font style="vertical-align: inherit;">La documentation est disponible sous forme √©lectronique: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
API REST </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.keycloak.org/docs-api/8.0/rest-api/index.html</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
API JAVA </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.keycloak.org/docs-api/8.0/javadocs /index.html</font></font></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fournisseurs d'identit√© d'entreprise (sur site)</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La possibilit√© d'authentifier les utilisateurs via les services de f√©d√©ration d'utilisateurs. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8j/s9/cl/8js9cl3cx9whnsshxcel0xynpqs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'authentification directe peut √©galement √™tre utilis√©e - si les utilisateurs s'authentifient sur les postes de travail avec Kerberos (LDAP ou AD), ils peuvent √™tre automatiquement authentifi√©s avec Keycloak sans avoir √† ressaisir leur nom d'utilisateur et leur mot de passe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour l'authentification et l'autorisation suppl√©mentaire des utilisateurs, il est possible d'utiliser un SGBD relationnel, qui est le plus applicable aux environnements de d√©veloppement, car il n'implique pas de param√®tres et d'int√©grations √† long terme dans les premi√®res √©tapes des projets. Par d√©faut, Keycloak utilise un SGBD int√©gr√© pour stocker les param√®tres et les donn√©es utilisateur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La liste des SGBD pris en charge est longue et comprend: MS SQL, Oracle, PostgreSQL, MariaDB, Oracle et autres. </font><font style="vertical-align: inherit;">Les plus test√©s actuellement sont Oracle 12C Release1 RAC et le cluster Galera 3.12 pour MariaDB 10.1.19.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fournisseurs d'identit√© - connexion sociale </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est possible d'utiliser une connexion depuis les r√©seaux sociaux. </font><font style="vertical-align: inherit;">Pour activer la possibilit√© d'authentifier les utilisateurs, la console d'administration Keycloack est utilis√©e. </font><font style="vertical-align: inherit;">Il n'est pas n√©cessaire de modifier le code de l'application et cette fonctionnalit√© est disponible ¬´pr√™te √† l'emploi¬ª et peut √™tre activ√©e √† n'importe quelle √©tape du projet. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bs/rj/vp/bsrjvpxnw7eojom-_bv816iwoxk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour authentifier les utilisateurs, il est possible d'utiliser des fournisseurs d'identit√©s OpenID / SAML.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sc√©narios d'autorisation typiques utilisant OAuth2 dans Keycloak</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flux de code d'autorisation</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - utilis√© avec les applications c√¥t√© serveur. L'un des types d'autorisation les plus courants, car il convient bien aux applications serveur dans lesquelles le code source de l'application et les donn√©es client ne sont pas accessibles aux √©trangers. Dans ce cas, le processus est bas√© sur la redirection. L'application doit pouvoir interagir avec l'agent utilisateur (user-agent), tel qu'un navigateur Web, pour recevoir des codes d'autorisation API redirig√©s via l'agent utilisateur. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flux implicite</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - utilis√© par les applications mobiles ou Web (applications s'ex√©cutant sur l'appareil de l'utilisateur).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un type implicite d'autorisation d'autorisation est utilis√© par les applications mobiles et Web o√π la confidentialit√© des clients ne peut pas √™tre garantie. </font><font style="vertical-align: inherit;">Le type d'autorisation implicite utilise √©galement la redirection de l'agent utilisateur et le jeton d'acc√®s est transmis √† l'agent utilisateur pour une utilisation ult√©rieure dans l'application. </font><font style="vertical-align: inherit;">Cela rend le jeton disponible pour l'utilisateur et d'autres applications sur l'appareil de l'utilisateur. </font><font style="vertical-align: inherit;">Avec ce type d'autorisation, l'application n'est pas authentifi√©e et le processus lui-m√™me repose sur une URL de redirection (pr√©c√©demment enregistr√©e dans le service).</font></font><br>
<br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le flux implicite ne prend pas en charge les jetons d'actualisation.
</font></font></oembed><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flux d'octroi des informations d'identification client</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - utilis√© lorsque l'application acc√®de √† l'API. </font><font style="vertical-align: inherit;">Ce type d'autorisation est g√©n√©ralement utilis√© pour les interactions de serveur √† serveur qui doivent s'ex√©cuter en arri√®re-plan sans interaction imm√©diate avec l'utilisateur. </font><font style="vertical-align: inherit;">Le flux d'informations d'identification du client permet au service Web (le client confidentiel) d'utiliser ses propres informations d'identification au lieu d'usurper l'identit√© de l'utilisateur pour l'authentification lors de l'appel d'un autre service Web. </font><font style="vertical-align: inherit;">Pour un niveau de s√©curit√© plus √©lev√©, il est possible que le service appelant utilise un certificat (au lieu d'un secret partag√©) comme informations d'identification. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La sp√©cification OAuth2 est d√©crite dans la </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC-6749 </font></font></a> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC-8252 </font></font></a> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC-6819</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jeton JWT et ses avantages</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JWT (JSON Web Token) est un standard ouvert ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://tools.ietf.org/html/rfc7519</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) qui d√©finit une m√©thode compacte et autonome pour transf√©rer en toute s√©curit√© des informations entre les parties en tant qu'objet JSON. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selon la norme, le jeton se compose de trois parties au format base 64, s√©par√©es par des points. </font><font style="vertical-align: inherit;">La premi√®re partie est appel√©e en-t√™te, qui contient le type de jeton et le nom de l'algorithme de hachage pour obtenir une signature num√©rique. </font><font style="vertical-align: inherit;">La deuxi√®me partie stocke les informations de base (utilisateur, attributs, etc.). </font><font style="vertical-align: inherit;">La troisi√®me partie est une signature num√©rique.</font></font><br>
<br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;en-t√™te cod√©&gt;. &lt;charge utile cod√©e&gt;. &lt;signature&gt;</font></font></oembed><br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N'enregistrez jamais de jeton dans votre base de donn√©es. </font><font style="vertical-align: inherit;">√âtant donn√© qu'un jeton valide est √©quivalent √† un mot de passe, le stockage d'un jeton revient √† stocker un mot de passe en texte clair.</font></font></oembed><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un jeton d'acc√®s</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un jeton qui donne √† son propri√©taire un acc√®s aux ressources prot√©g√©es du serveur. </font><font style="vertical-align: inherit;">Habituellement, il a une courte dur√©e de vie et peut contenir des informations suppl√©mentaires, telles que l'adresse IP de la partie demandant ce jeton. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un jeton d'actualisation</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un jeton qui permet aux clients de demander de nouveaux jetons d'acc√®s apr√®s l'expiration de leur dur√©e de vie. </font><font style="vertical-align: inherit;">Ces jetons sont g√©n√©ralement √©mis pour une longue p√©riode. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Principaux avantages de l'application en architecture de microservices:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La possibilit√© d'acc√©der √† diverses applications et services via une authentification unique.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En l'absence d'un certain nombre d'attributs requis dans le profil utilisateur, il est possible d'enrichir avec des donn√©es qui peuvent √™tre ajout√©es √† la charge utile, y compris automatis√©es et √† la vol√©e.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il n'est pas n√©cessaire de stocker des informations sur les sessions actives, l'application serveur doit uniquement v√©rifier la signature.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contr√¥le d'acc√®s plus flexible avec des attributs suppl√©mentaires dans la charge utile.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'utilisation d'une signature de jeton pour l'en-t√™te et la charge utile augmente la s√©curit√© de la solution dans son ensemble.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jeton JWT - Composition</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><b><font style="vertical-align: inherit;">t√™te</font></b><font style="vertical-align: inherit;"> - par d√©faut, l'en-t√™te contient uniquement le type de jeton et l'algorithme utilis√© pour le chiffrement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le type de jeton est stock√© dans la cl√© "typ". </font><font style="vertical-align: inherit;">La cl√© "typ" est ignor√©e dans le JWT. </font><font style="vertical-align: inherit;">Si la cl√© typ est pr√©sente, sa valeur doit √™tre JWT pour indiquer que cet objet est un jeton Web JSON. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La deuxi√®me cl√© alg d√©finit l'algorithme utilis√© pour chiffrer le jeton. </font><font style="vertical-align: inherit;">Par d√©faut, il doit √™tre d√©fini sur HS256. </font><font style="vertical-align: inherit;">L'en-t√™te est cod√© en base64.</font></font><br>
<br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{"alg": "HS256", "typ": "JWT"}</font></font></oembed><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Charge utile (contenu)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - la charge utile stocke toutes les informations qui doivent √™tre v√©rifi√©es. </font><font style="vertical-align: inherit;">Chaque cl√© de la charge utile est appel√©e ¬´instruction¬ª. </font><font style="vertical-align: inherit;">Par exemple, la candidature ne peut √™tre saisie que sur invitation (promo ferm√©e). </font><font style="vertical-align: inherit;">Lorsque nous voulons inviter quelqu'un √† participer, nous lui envoyons une lettre d'invitation. </font><font style="vertical-align: inherit;">Il est important de v√©rifier que l'adresse e-mail appartient √† la personne qui accepte l'invitation, nous inclurons donc cette adresse dans la charge utile, pour cela nous l'enregistrerons dans la cl√© ¬´e-mail¬ª</font></font><br>
<br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{"email": "example@x5.ru"}
</font></font></oembed><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les cl√©s de la charge utile peuvent √™tre arbitraires. </font><font style="vertical-align: inherit;">Cependant, il y en a quelques-uns r√©serv√©s:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iss (Issuer) - d√©finit l'application √† partir de laquelle le jeton est envoy√©.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sub (Subject) - d√©finit le sujet du jeton.</font></font></li>
<li>aud (Audience) ‚Äì       URI,     .     JWT   ,        ‚Äî   .</li>
<li>exp (Expiration Time) ‚Äî ,     .  JWT ,           . Exp       unix .</li>
<li>nbf (Not Before) ‚Äî    unix ,  ,    .</li>
<li>iat (Issued At) ‚Äî     ,            JWT. iat       unix .</li>
<li>Jti (JWT ID) ‚Äî ,      c  .</li>
</ul><br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est important de comprendre que la charge utile n'est pas transmise sous forme crypt√©e (bien que les jetons puissent √™tre int√©gr√©s et qu'il soit alors possible de transmettre des donn√©es crypt√©es). </font><font style="vertical-align: inherit;">Par cons√©quent, il est impossible d'y stocker des informations secr√®tes. </font><font style="vertical-align: inherit;">Comme l'en-t√™te, la charge utile est cod√©e en base64.</font></font></oembed><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Signature</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - lorsque nous avons un en-t√™te et une charge utile, nous pouvons calculer la signature. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encod√© en Base64: l'en-t√™te et la charge utile sont pris, ils sont combin√©s en une ligne par un point. </font><font style="vertical-align: inherit;">Ensuite, cette ligne et la cl√© secr√®te sont envoy√©es √† l'entr√©e de l'algorithme de chiffrement sp√©cifi√© dans l'en-t√™te (cl√© "alg"). </font><font style="vertical-align: inherit;">La cl√© peut √™tre n'importe quelle cha√Æne. </font><font style="vertical-align: inherit;">Des cordes plus longues seront pr√©f√©rables, car cela prendra plus de temps pour correspondre.</font></font><br>
<br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{"alg": "RSA1_5", "charge utile": "A128CBC-HS256"}</font></font></oembed><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Architecture du cluster de basculement Keycloak</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous utilisez un seul cluster pour tous les projets, il existe des exigences accrues pour une solution d'authentification unique. Lorsque le nombre de projets est faible, ces exigences ne sont pas si perceptibles pour tous les projets, mais avec une augmentation du nombre d'utilisateurs et d'int√©grations, les exigences d'accessibilit√© et de productivit√© augmentent. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'augmentation du risque de d√©faillance d'un SSO unique augmente les exigences pour l'architecture de la solution et les m√©thodes utilis√©es pour la redondance des composants et conduit √† un SLA tr√®s serr√©. √Ä cet √©gard, plus souvent lors du d√©veloppement ou dans les premiers stades de la mise en ≈ìuvre de solutions, les projets ont leur propre infrastructure non tol√©rante aux pannes. Au fur et √† mesure de votre d√©veloppement, vous devez pr√©voir la possibilit√© de d√©veloppement et de mise √† l'√©chelle. Le plus flexible est de cr√©er un cluster de basculement √† l'aide de la virtualisation de conteneurs ou d'une approche hybride.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour travailler dans des clusters actifs / actifs et actifs / passifs, il est n√©cessaire d'assurer la coh√©rence des donn√©es dans une base de donn√©es relationnelle - les deux n≈ìuds de base de donn√©es doivent √™tre r√©pliqu√©s de mani√®re synchrone entre diff√©rents centres de donn√©es g√©o-distribu√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'exemple le plus simple d'une installation √† s√©curit√© int√©gr√©e. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xo/tw/7w/xotw7wkifwb3h6nnclvnjbbe72c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quels sont les avantages d'utiliser un seul cluster:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Haute disponibilit√© et performances.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prise en charge des modes de fonctionnement: actif / actif, actif / passif.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La possibilit√© d'√©voluer dynamiquement - lors de l'utilisation de la virtualisation de conteneurs.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Possibilit√© de gestion et de surveillance centralis√©es.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Approche unifi√©e pour l'identification / l'authentification / l'autorisation des utilisateurs dans les projets.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interaction plus transparente entre diff√©rents projets sans participation des utilisateurs.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La possibilit√© de r√©utiliser le jeton JWT dans divers projets.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Point de confiance unique.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lancement plus rapide de projets utilisant la virtualisation de microservices / conteneurs (pas besoin de monter et configurer des composants suppl√©mentaires).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peut-√™tre l'acquisition d'un support commercial aupr√®s du vendeur. </font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âl√©ments √† prendre en compte lors de la planification d'un cluster</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SGBD</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Keycloak utilise un syst√®me de gestion de SGBD pour sauvegarder: domaines, clients, utilisateurs, etc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une large gamme de SGBD est prise en charge: MS SQL, Oracle, MySQL, PostgreSQL. </font><font style="vertical-align: inherit;">Keycloak est livr√© avec sa propre base de donn√©es relationnelle int√©gr√©e. </font><font style="vertical-align: inherit;">L'utilisation pour les environnements non charg√©s tels que les environnements de d√©veloppement est recommand√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour fonctionner dans des clusters actifs / actifs et actifs / passifs, il est n√©cessaire de garantir la coh√©rence des donn√©es dans une base de donn√©es relationnelle, et les deux n≈ìuds du cluster de base de donn√©es sont r√©pliqu√©s de mani√®re synchrone entre les centres de donn√©es.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cache distribu√© (Infinspan)</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour que le cluster fonctionne correctement, une synchronisation suppl√©mentaire des types de cache suivants √† l'aide de JBoss Data Grid est requise: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sessions d'authentification - utilis√©es pour enregistrer les donn√©es lors de l'authentification d'un utilisateur sp√©cifique. </font><font style="vertical-align: inherit;">Les demandes de ce cache incluent g√©n√©ralement uniquement le navigateur et le serveur Keycloak, pas l'application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetons d'action - utilis√©s pour les sc√©narios o√π l'utilisateur doit confirmer l'action de mani√®re asynchrone (par e-mail). </font><font style="vertical-align: inherit;">Par exemple, pendant le flux de mot de passe oubli√©, le cache actionTokens Infinispan est utilis√© pour suivre les m√©tadonn√©es sur les marqueurs d'action associ√©s qui ont d√©j√† √©t√© utilis√©s, il ne peut donc pas √™tre r√©utilis√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mise en cache et invalidation des donn√©es persistantes - utilis√© pour mettre en cache les donn√©es persistantes pour √©viter les requ√™tes de base de donn√©es inutiles. </font><font style="vertical-align: inherit;">Lorsqu'un serveur Keycloak met √† jour des donn√©es, tous les autres serveurs Keycloak de tous les centres de donn√©es doivent en √™tre conscients. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Travail - utilis√© uniquement pour envoyer des messages d'invalidation entre les n≈ìuds de cluster et les centres de donn√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sessions utilisateur - utilis√©es pour enregistrer des donn√©es sur les sessions utilisateur valides pour la session de navigation d'un utilisateur. </font><font style="vertical-align: inherit;">Le cache doit g√©rer les requ√™tes HTTP de l'utilisateur final et de l'application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Protection contre la force brute - utilis√©e pour suivre les donn√©es de connexion ayant √©chou√©.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'√©quilibrage de charge</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'√©quilibreur de charge est un point d'entr√©e unique dans keycloak et devrait prendre en charge les sessions persistantes. </font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serveur d'application</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ils sont utilis√©s pour contr√¥ler l'interaction des composants entre eux et peuvent √™tre virtualis√©s ou conteneuris√©s √† l'aide des outils d'automatisation existants et √† l'√©chelle dynamique des outils d'automatisation d'infrastructure. </font><font style="vertical-align: inherit;">Les sc√©narios de d√©ploiement les plus courants dans OpenShift, Kubernetes, Rancher. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur ce point, la premi√®re partie - th√©orique - est termin√©e. </font><font style="vertical-align: inherit;">Dans la s√©rie d'articles suivante, des exemples d'int√©gration avec divers fournisseurs d'identification et des exemples de configuration seront discut√©s.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr486778/">https://habr.com/ru/post/fr486778/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr486764/index.html">Bricolage Schema.org: personnalisation de la micro-mise en page sans programmeur</a></li>
<li><a href="../fr486766/index.html">Comment transf√©rer toutes les transactions en ligne sur le march√© de l'affacturage archa√Øque? Exp√©rience de l'affacturage Sberbank</a></li>
<li><a href="../fr486768/index.html">R√©vision du panneau d'administration Webasyst</a></li>
<li><a href="../fr486772/index.html">Br√ªlez, mais ne br√ªlez pas - br√ªlez pour briller</a></li>
<li><a href="../fr486776/index.html">Compl√©tion de code et v√©rification de type pour boto3</a></li>
<li><a href="../fr486780/index.html">D√©veloppement frontend dans l'entreprise: qu'est-ce que c'est et comment le rendre efficace</a></li>
<li><a href="../fr486782/index.html">UI / UX - conception. Tendances et pr√©visions pour 2020</a></li>
<li><a href="../fr486784/index.html">Les fr√®res Lumiere n'ont jamais r√™v√©</a></li>
<li><a href="../fr486788/index.html">Webinaire ¬´Surveillance √† distance et diagnostic des √©quipements. √âtudes de cas sur la solution CNC de Winnum ¬ª</a></li>
<li><a href="../fr486790/index.html">Et encore une fois Qbot - une nouvelle souche de cheval de Troie bancaire</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>