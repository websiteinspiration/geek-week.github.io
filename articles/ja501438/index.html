<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>◾️ 🧗🏽 🚴🏽 3Dゲームのレンダリングの仕組み：照明と影 🧑‍🤝‍🧑 👩‍🎤 🌼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="現代のゲームにおける視覚効果の大部分の実装は、照明と影の賢明な使用に依存しています。それらがなければ、ゲームは退屈で活気がないでしょう。3Dゲームのレンダリングの分析の4番目の部分では、頂点処理とテクスチャマッピングとともに、3Dの世界で起こっていることに焦点を当てます。ここでも、多くの数学と、光学...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>3Dゲームのレンダリングの仕組み：照明と影</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501438/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">現代のゲームにおける視覚効果の大部分の実装は、照明と影の賢明な使用に依存しています。</font><font style="vertical-align: inherit;">それらがなければ、ゲームは退屈で活気がないでしょう。</font><font style="vertical-align: inherit;">3Dゲームのレンダリングの分析の4番目の部分では、頂点処理とテクスチャマッピングとともに、3Dの世界で起こっていることに焦点を当てます。</font><font style="vertical-align: inherit;">ここでも、多くの数学と、光学の基本をしっかりと理解する必要があります。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート1：頂点処理</font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート2：ラスタライズとレイトレーシング</font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート3：テクスチャのテクスチャリングとフィルタリング</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">過去を思い出す</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前に、シーン内のオブジェクトの移動と処理の主要な側面、3次元空間からピクセルのフラットグリッドへの変換、およびこれらのオブジェクトにテクスチャをオーバーレイする方法について説明しました。長年にわたり、このような操作はレンダリングプロセスの重要な部分であり、1993年に戻ってid Software's Doomを起動することでこれを確認できます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2fe/056/d0c/2fe056d0c0f37ac3a2970bdc485b79a5.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現代の基準では、このゲームでの光と影の使用は非常に原始的でした。光源は考慮されておらず、頂点に基づく各サーフェスには、一般的なカラー値または</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アンビエントライトの</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値が与えられていました</font><font style="vertical-align: inherit;">。テクスチャの巧妙な使用と環境の色の選択のおかげで、影のすべての兆候が作成されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラマーの仕事ではなかったため、影はありませんでした。当時のPCは66 MHzプロセッサー（つまり、0.066 GHz！）、40 MBのハードドライブ、および最小3D機能を備えた512キロバイトのグラフィックスカードでした。早送り23：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シリーズの有名な再起動では</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、まったく異なるストーリーが見られます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b5/3ca/da0/3b53cada0530afabe788b4a70a0b7319.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このフレームのレンダリングに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は多くの技術が</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用され</font><font style="vertical-align: inherit;">、画面空間のアンビエントオクルージョン、パス前のデプスマッピング、ボケぼかしフィルター、トーン補正オペレーターなどのステージを誇っています。</font><font style="vertical-align: inherit;">各サーフェスのライティングとシェーディングの計算は動的に実行されます。これらは、環境条件やプレーヤーのアクションに応じて常に変化しています。</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての3Dレンダリング操作には数学（大量の計算！）が必要なので、現代のゲームの舞台裏で何が起こるかから始めるのがよいでしょう。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数学の照明</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてを正しく実装するには、さまざまな表面と相互作用するときの光の動作を正確にシミュレートする必要があります。この問題が、18世紀にヨハンハインリッヒランバートという名前の男によって初めて解決され始めたのは興味深いことです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1760年、スイスの科学者が</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Photometria</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">という本をリリースしました</font><font style="vertical-align: inherit;">。その中で、彼は光の振る舞いの基本的なルールを概説しました。それらのうち最も注目すべきものは次のとおりです。表面は、（反射によって、または光源として）光を放出し、放出された光の明るさは、通常の表面と観察者の間の角度の余弦に応じて変化します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/262/6a2/f0c/2626a2f0c2f80f30bf5208decab2493c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この単純なルールが、いわゆる</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拡散</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">照明の</font><font style="vertical-align: inherit;">基礎を築きました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、表面の色を計算するために使用される数学モデルであり、その物理的特性（たとえば、色と光の反射の程度）と光源の場所に依存します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3Dレンダリングでは、これには多くの情報が必要です。これは、そのようなスキームの形で想像するのが最も簡単です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/918/d57/386/918d573864315b11e91405d8e692c59f.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
画像には多数の矢印が表示されます。これら</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はベクトル</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">であり、色を計算するには次のベクトルが必要です。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">頂点位置、光源、シーンを見ているカメラの3つのベクトル</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">頂点の視点からの光源とカメラの方向の2つのベクトル</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1つの法線ベクトル</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1つの半ベクトル（常に照明とカメラの方向ベクトルの真ん中にあります）</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それらは、レンダリングプロセスの頂点を処理する段階で計算され、それらすべてを結合する方程式（ランバートモデルと呼ばれます）の形式は次のとおりです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/267/ba6/279/267ba627905209780406c2148469a7ef.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、拡散照明の下での頂点の色は、表面の色、光源の色</font><font style="vertical-align: inherit;">、頂点の法線ベクトルと光​​の方向の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スカラー積</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に減衰および投影照明係数を</font><font style="vertical-align: inherit;">乗算して計算され</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">この操作はシーン内の光源ごとに実行されるため、方程式の最初の合計記号になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この方程式のベクトル（および以下に表示されるものすべて）は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正規化</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">されます（各ベクトルの上のアイコンで示されています）。</font><font style="vertical-align: inherit;">正規化されたベクトルは元の方向を保持し、その長さは単位値（つまり、1計測単位に等しい）まで減少します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
表面と光源のカラー値は、標準のRGBA番号（赤、緑、青、アルファ透明度）です。それらは整数（たとえば、各カラーチャネルのINT8）にすることができますが、ほとんどの場合、浮動小数点数（たとえば、FP32）です。減衰係数は、光源から遠ざかったときに照明のレベルがどのように減少するかを決定し、別の方程式によって計算されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6ac/17e/a22/6ac17ea2263bf82f6a2e2571bd88e0b0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、A </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、およびA </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、距離が照明レベルにどのように影響するかを表す異なる係数（定数、線形、2次）です。これらはすべて、レンダリングエンジンの作成時にプログラマーが設定します。各グラフィカルAPIでは、これは独自の方法で実装されますが、光源のタイプをエンコードするときに係数が導入されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後の係数（投光照明）を検討する前に、3Dレンダリングでは、スポット、指向性、投光という3つのタイプの光源があることに注意してください。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/349/2be/9ce/3492be9ce1ccf5526a05bb0702f84c35.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
点光源はすべての方向に均一に光を放射し、指向性光源は一方向にのみ光を放射します（数学の観点から、これは点光源であり、無限の距離にあります）。スポットライトは、円錐の形で光を放出するため、複雑な指向性光源です。コーンのボディでのライトの変化の仕方が、コーンの内側と外側の部分のサイズを決定します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、はい、サーチライト係数には、別の方程式があります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/06a/b47/d9c/06ab47d9c2a0f7d85519d5de77cb299b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーチライト係数の値は、1（つまり、光源が</font><font style="vertical-align: inherit;">サーチライトで</font><font style="vertical-align: inherit;">は</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ない</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、または0（頂点がコーン方向の外側にある場合）、または2つの間の計算値のいずれかです。角度</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">φ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（ファイ）と</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">θ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（シータ）は、スポットライトのコーンの内側/外側の寸法を指定します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dcs</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とL </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dir</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（カメラ方向とスポットライト方向の逆）の</font><font style="vertical-align: inherit;">2つのベクトル</font><font style="vertical-align: inherit;">を使用して、頂点の円錐が接触しているかどうかを判断します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、拡散照明の値を計算するにはこれらすべてが必要であり、これらすべての操作を</font><em><font style="vertical-align: inherit;">それぞれ</font></em><font style="vertical-align: inherit;">に対して実行する必要があることを覚えておく必要があります</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シーン内の光源、または少なくともプログラマが検討したい光源ごと。これらの方程式の多くはグラフィカルAPIによって実行されますが、エンコーダーが画像をさらに制御する必要がある場合は、手動で実行することもできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、実際には、</font><font style="vertical-align: inherit;">光源の数は</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">無数</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にあり</font><font style="vertical-align: inherit;">ます。各サーフェスは照明を反射するため、シーンの照明全体に影響を与えます。夜であっても、それが星や惑星であろうと、大気中に散乱される光であろうと、背景照明があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これをシミュレートするために、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アンビエント</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライティングという</font><font style="vertical-align: inherit;">別のライティング値が計算されます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/944/73b/e8e/94473be8edd6d85ce822d059f021d9a7.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
方向が必要ないため、この方程式は拡散照明よりも簡単です。</font><font style="vertical-align: inherit;">ここでは、さまざまな係数の単純な乗算が実行されます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SA-</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表面照明色</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GA-</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グローバル3Dシーンの色を強調表示</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LA-</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シーン内のすべての光源の照明の色</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての光源の合計と同様に、減衰とプロジェクター係数が再び使用されることは注目に値します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、背景照明があり、3Dワールドのさまざまな表面からの光源の拡散照明を考慮しました。ただし、ランバートモデルは、その表面からの照明を全方向に反射するマテリアルに対してのみ機能します。ガラスまたは金属でできたオブジェクトは、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">鏡面</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反射と呼ばれる別のタイプの反射を作成します</font><font style="vertical-align: inherit;">。当然、彼にも方程式があります！</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d6b/a60/a49/d6ba60a49dae7eb88da90c7ef26936bf.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この式の個々の部分はすでにおなじみのはずです。ミラーカラーには2つの値（1つは表面-C </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、もう</font><font style="vertical-align: inherit;">1つ</font><font style="vertical-align: inherit;">は光-C </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LS</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）と、通常の減衰およびフラッド係数があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
鏡面反射は非常に集中して方向付けられるため、鏡面照明の明るさを決定するために、頂点法線と半ベクトルの2つのベクトルが使用されます。係数</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">鏡面反射</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><em><font style="vertical-align: inherit;">パワー</font></em><font style="vertical-align: inherit;">と呼ばれます</font><font style="vertical-align: inherit;">。これは、表面マテリアルのプロパティに応じて反射の明るさを決定する数値です。 pが増加すると、ミラー効果は明るくなりますが、より焦点が絞られ、小さくなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
考慮される最後の要素は、単なる数値であるため、最も単純です。</font><font style="vertical-align: inherit;">これは</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エミッシブ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライティング</font><font style="vertical-align: inherit;">と呼ばれ</font><font style="vertical-align: inherit;">、直接照明の光源であるオブジェクト、つまり炎、懐中電灯、または太陽に適用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、背景の照明（環境）だけでなく、さまざまな光源間の相互作用と表面のマテリアルのプロパティ（拡散と鏡面反射）を考慮して、表面の頂点の色を計算するための方程式が1つと3つのセットになっています。</font><font style="vertical-align: inherit;">プログラマーは、1つだけを選択するか、4つすべてを組み合わせて、単に折りたたむことができます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/679/5d4/fc3/6795d4fc38199eed97d7e1fb875556d5.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
視覚的には、組み合わせは次のようになります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/158/be2/f53/158be2f5318b5cbb2a142e166d1299ad.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちが検討した方程式は、標準関数を使用してグラフィックAPI（Direct3DやOpenGLなど）によって適用されますが、照明のタイプごとに代替アルゴリズムがあります。</font><font style="vertical-align: inherit;">たとえば、拡散照明は</font><font style="vertical-align: inherit;">、ランバートモデルよりも非常に粗い表面に適し</font><font style="vertical-align: inherit;">て</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いるOren-Nayyarモデル</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">て</font></a><font style="vertical-align: inherit;">実装できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ミラー反射方程式は、ガラスや金属のような非常に滑らかな表面がまだ粗いが、微視的なレベルであるという事実を考慮したモデルで置き換えることができます。</font><font style="vertical-align: inherit;">数学的複雑さを犠牲にして、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マイクロファセットアルゴリズム</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれるそのようなモデルは、</font><font style="vertical-align: inherit;">より現実的な画像を提供します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どのモデルを使用しても、3Dシーンへの適用頻度を増やすことで、すべてが大幅に改善されます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">頂点またはピクセル単位の計算</font></font></h2><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">頂点処理</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ラスタライゼーション</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を調べたところ</font><font style="vertical-align: inherit;">、各頂点に対して実行されたすべてのトリッキーライティング計算の結果は、頂点間のサーフェス上に補間される必要があることがわかりました。</font><font style="vertical-align: inherit;">これは、サーフェスマテリアルに関連付けられたプロパティが頂点の内部に格納されているためです。</font><font style="vertical-align: inherit;">3Dワールドが2Dピクセルグリッドに圧縮されると、ピクセルは頂点があった場所にのみ残ります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/129/bc3/e90/129bc3e90652de62263813f5274dea2c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残りのピクセルは、頂点の色に関する情報を送信して、表面で色が正しく混ざるようにする必要があります。 1971年、</font><font style="vertical-align: inherit;">当時ユタ大学の大学院生であった</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アンリグーローは</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、現在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グーローシェーディング</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれる方法を提案しました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼の方法は計算速度が速く、長年にわたり</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事実上の</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">標準に</font><font style="vertical-align: inherit;">なりました</font><font style="vertical-align: inherit;">が、問題も抱えていました。彼はミラーライティングを正しく補間できず、オブジェクトが少数のプリミティブで構成されている場合、プリミティブ間のミキシングは誤っているように見えました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この問題の解決策は、1973年にユタ大学でも働いていたBui Tyong Fongによって提案されました。 Fongは彼の研究記事で、ラスタライズされたサーフェス上の頂点の法線を補間する手法を示しました。これは、散乱および鏡面反射モデルが各ピクセルで正しく機能することを意味し、</font><font style="vertical-align: inherit;">David Eckの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オンライン</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンピュータグラフィックスおよびWebGL </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">チュートリアルで</font></a><font style="vertical-align: inherit;">これを明確に見ることができ</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下に示す炭素球は同じ照明モデルで色分けされていますが、左手計算の場合は垂直方向に実行され、続いてグーローシェーディングが表面全体を補間します。右側の球の場合、計算はピクセルごとに行われ、違いは明らかです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/10a/5b1/329/10a5b13292d99d5250cfbfba7c737a6a.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
静止画像は</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Phongのシェーディング</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">によってもたらされたすべての改善を伝えるわけではありません</font><font style="vertical-align: inherit;">が</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ek </font><font style="vertical-align: inherit;">の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">オンラインデモを</font></a><font style="vertical-align: inherit;">個別に実行し</font><font style="vertical-align: inherit;">てアニメーションを見る</font><font style="vertical-align: inherit;">ことができます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、Fongはそこで止まらず、数年後、アンビエント、拡散、鏡面反射の個別の計算を1つの簡単な方程式で実行する方法を示す別の研究記事を発表しました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0c0/cf9/613/0c0cf9613d8d536c4cdb16750bbca092.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで真剣に理解する必要があります！文字</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kで</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示される値は</font><font style="vertical-align: inherit;">、周囲反射、拡散反射、鏡面反射の反射定数です。それらのそれぞれは、入射光の大きさからの対応するタイプの反射光の一部です。</font><font style="vertical-align: inherit;">上記の方程式で見た</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値</font><font style="vertical-align: inherit;">（各タイプの照明の表面素材の色値）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ベクトル</font></font><strong><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></em></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は「完全反射」ベクトルです。表面が完全に滑らかな場合に反射光が移動する方向です。表面法線と入射光ベクトルを使用して計算されます。ベクトル</font></font><strong><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></em></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はカメラの方向ベクトルです。そして</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cは</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正規化。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、方程式の最後の定数があります</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。α</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の値は</font><font style="vertical-align: inherit;">、表面の光沢の度合いを決定します。材質が滑らかであるほど（ガラスや金属に似ているほど）、数値は大きくなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この方程式は通常</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、フォン反射モデル</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれ</font><font style="vertical-align: inherit;">ます。彼の研究当時、このような提案は根本的なものでした。それは、深刻なコンピューティングリソースを必要としたためです。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jim Blinn</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がモデルの簡略版を作成し</font><font style="vertical-align: inherit;">、式の一部を</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（半距離ベクトルと表面法線）</font><font style="vertical-align: inherit;">に置き換えました</font><font style="vertical-align: inherit;">。</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の値は、</font><font style="vertical-align: inherit;">光源ごと、およびフレーム内のピクセルごとに計算する必要があります。</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hは</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、各ソースおよびシーン全体に対して1回計算するのに十分です。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blinn-Fong反射モデル</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は現在、標準の照明システムであり、Direct3D、OpenGL、Vulkanなどでデフォルトで使用されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
他の多くの数学モデルがあり、特にGPUが長く複雑なシェーダーでピクセルを処理できるようになったためです。このような式をまとめて、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">双方向反射/透過分布関数</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（BRDF / BTFD）</font><font style="vertical-align: inherit;">と呼び</font><font style="vertical-align: inherit;">ます。これらは、最新の3Dゲームをプレイするときに、モニターのすべてのピクセルに色を付けるための基盤です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、これまでは</font><font style="vertical-align: inherit;">光を</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反射</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">する</font><font style="vertical-align: inherit;">表面のみを考慮してきました</font><font style="vertical-align: inherit;">。半透明の材料は光を透過し、光線は</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">屈折します。</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そしていくつかの表面。</font><font style="vertical-align: inherit;">たとえば、水は光を反射してさまざまな程度に透過します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちは照明を新しいレベルに引き上げます</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2018年の</font><font style="vertical-align: inherit;">Ubisoft </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assassin's Creed：Odyssey</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲームを</font><font style="vertical-align: inherit;">見てみましょう。</font><font style="vertical-align: inherit;">このゲームでは、浅い川と深い海の両方で水上をセーリングすることがよくあります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/032/29d/358/03229d3582d6b574b0089a5480cfc08b.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">塗装された木、金属、ロープ、布地、水-これらはすべて</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
、一連の</font><i><font style="vertical-align: inherit;">計算を使用して光を反射および屈折させます。</font></i><font style="vertical-align: inherit;">ゲームの十分な速度を維持しながら、水の最もリアルなレンダリングのために、Ubisoftプログラマーはすべてのトリックを使用しました。水の表面は、おなじみの周囲光、拡散光、および鏡面反射光のトリオによって照らされますが、興味深い特徴によって補完されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの最初のものは、水の反射特性を生成するためによく使用され</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -これらは</font><em><font style="vertical-align: inherit;">スクリーン空間反射</font></em><font style="vertical-align: inherit;">（SSR）です。この手法はシーンをレンダリングしますが、ピクセルの色</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各ピクセルの</font><em><font style="vertical-align: inherit;">深度に</font></em><font style="vertical-align: inherit;">依存します</font><font style="vertical-align: inherit;">。彼の距離からカメラまで。深度は、いわゆる</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><em><font style="vertical-align: inherit;">深度バッファーに</font></em></a><font style="vertical-align: inherit;">格納されます。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><em><font style="vertical-align: inherit;"></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。次に、フレームは通常のすべてのライティングとテクスチャリングを使用して再度レンダリングされますが、シーンは</font></font><em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レンダリングテクスチャ</font></font></a></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">として保存</font><font style="vertical-align: inherit;">され、モニターに送信されるレディバッファーとして</font><font style="vertical-align: inherit;">は保存され</font><font style="vertical-align: inherit;">ません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レイマーチング</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を行い</font><font style="vertical-align: inherit;">ます。これを行うには、光線をカメラから放出し、距離をビームのコースに沿って設定します。コードは、深度バッファー内のピクセルを基準にしてビームの深度をチェックします。それらが同じ値を持つ場合、コードは通常のピクセルをチェックして、それがカメラに向けられているかどうかを確認し、そうであれば、エンジンはレンダーテクスチャから対応するピクセルを探します。次に、さらに命令セットがピクセルの位置を反転させ、シーンに正しく反映されるようにします。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/645/58b/1d1/64558b1d13b6bc349bd728278ec9686a.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EAのFrostbiteエンジンで使用されるSSRオーダー。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
さらに、光は材料内で移動中に散乱します。水や革などの材料の場合、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サブサーフェススキャタリング</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（SSS）</font><font style="vertical-align: inherit;">と呼ばれるもう1つのトリック</font><font style="vertical-align: inherit;">が使用されます。詳細については説明しませんが</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、2014年のNvidiaプレゼンテーション</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でこのような素晴らしい結果を生み出すためにどのように使用されているかを読むことができます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/23c/0e1/598/23c0e15983c2cfe6b17ba3d0aab97dc5.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nvidiaの2013 FaceWorksデモ（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リンク</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
アサシンクリードウォーターに戻りましょう</font><i><font style="vertical-align: inherit;">。SSSの</font></i><font style="vertical-align: inherit;">実装はここではほとんど目立ちません。速度の考慮により、あまり積極的に使用されていません。 ACシリーズの以前のゲームでは、Ubisoft </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は偽のSSSを使用して</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いましたが、最後のゲームではその使用はより複雑ですが、Nvidiaデモで見たほど大きくはありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
水面のライティング値を変更するために、海岸までの距離に応じて透明度が変化することによる深度の影響を正しくシミュレートする追加の手順が実行されます。そして、カメラが海岸近くの水を見るとき、コースティックスと屈折を考慮するためにさらに多くのアルゴリズムが使用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果は印象的です：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cb2/486/f56/cb2486f5697db7c578797127371af936.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assassin's Creed：Odyssey-栄光の水を演出します。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
水を見ましたが、空中の光の動きはどうですか？ほこりの粒子、水分、その他の要素も光の散乱につながります。その結果、光線は</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボリュームを</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受け取り</font><font style="vertical-align: inherit;">、直接光線のセットだけではなくなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ボリュームライティングのトピックは12の記事に拡張できるため、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rise of the Tomb Raiderが</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どのように対処するかについて説明します</font><font style="vertical-align: inherit;">。下のビデオでは、照明の主な光源は1つしかありません。建物の開口部から輝く太陽です。</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/3w9rHXIYjI4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ライトのボリュームを作成するために、ゲームエンジンはカメラの可視性ピラミッド（以下を参照）を取得し、指数的に64の部分に分解します。次に、各スライスが160 x 94要素のサイズのグリッドにラスタライズされ、このすべてのデータがFP32形式の3次元レンダリングテクスチャに保存されます。テクスチャは通常2次元であるため、ピラミッドのボリュームの「ピクセル」は</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボクセル</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれ</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b1/857/5cf/3b18575cfb0114e1b8ba8c152c4c4bd1.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4 x 4 x 4ボクセルブロックの場合、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">計算シェーダー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はこのアクティブな光源がこのボリュームに影響を与えるかどうかを判断し、この情報を別の3次元レンダリングテクスチャに書き込みます。次に、ボクセルブロック内の光の総「密度」を推定するために、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://web.archive.org/web/20141102063940/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヘンジーグリーンスタイン散乱関数</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれる複雑な式</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://web.archive.org/web/20141102063940/" rel="nofollow"><font style="vertical-align: inherit;">が使用され</font></a><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、エンジンはさらにいくつかのシェーダーを実行してデータを調整します。その後、光線密度の値の累積とともにピラミッドのスライスに沿って光線の行進が実行されます。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eidos-Montréalは</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Xbox Oneではこれらすべての操作に約0.8ミリ秒かかる</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">と主張</font></a><font style="vertical-align: inherit;">しています！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この手法はすべてのゲームで使用されているわけではありませんが、プレーヤーは、今日リリースされたほとんどすべての人気のある3Dゲーム、特にファーストパーソンシューティングゲームやアクションアドベンチャーゲームで容積測定カバレッジを期待しています。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/064/e06/b34/064e06b347c8e5cafe892fbdde2d14de.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2018 Rise of the Tomb Raiderの続編で使用されているボリューム照明。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
当初、この照明技術は「神の光線」または科学的に</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「黄昏光線」</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれていました</font><font style="vertical-align: inherit;">。それが使用された最初のゲームの1つは、</font><font style="vertical-align: inherit;">2007年にリリースされたCrytekの</font><font style="vertical-align: inherit;">最初の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crysis</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、これは真のボリュームライティングではありませんでした。このプロセスには、マスクとして使用される深度バッファーの形式でのシーンの最初のレンダリングが含まれていました。別のバッファーでは、ピクセルの色がカメラに近づくほど暗くなりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このマスクバッファーは数回サンプリングされ、シェーダーがサンプルを取り、ぼかして混合しました。この操作の結果は、完成したシーンと混合されました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5d9/f9b/891/5d9f9b891a670f005d77704953040215.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
過去12年間のグラフィックスカードの進歩は目覚しいものがあります。</font><font style="vertical-align: inherit;">Crysisのリリース時点で最も強力なGPUは、Nvidia </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GeForce 8800 Ultra</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でした。</font><font style="vertical-align: inherit;">最新の最速GPU- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GeForce RTX 2080 Ti</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、30倍以上の計算能力、14倍のメモリ、6倍の帯域幅を備えています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このすべての計算能力により、最新のゲームは、レンダリングの複雑さが増しているにもかかわらず、グラフィックの正確さと全体的な速度を大幅に向上させることができます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d73/9bf/541/d739bf54169f0900929280cee0d4553b.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UbisoftのThe Division 2の「Divine Rays」</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
しかし、実際には、この効果は、視覚的な正確性のために正しい照明が重要であるにもかかわらず、実際に</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">光</font><font style="vertical-align: inherit;">が</font><em><font style="vertical-align: inherit;">ないことが</font></em><font style="vertical-align: inherit;">さらに重要であることを示してい</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">影の本質</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ゲームの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シャドウオブザトゥームレイダー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で、記事の新しいセクションから始めましょう</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">下の画像では、影に関連するすべてのグラフィックオプションが無効になっています。</font><font style="vertical-align: inherit;">右側に含まれています。</font><font style="vertical-align: inherit;">違いは大きいですよね？</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/399/6db/855/3996db855ea5a727cc8b8c8e565227d8.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
影は現実の世界で自然に形成されるため、影が正しく実装されていないゲームは正しく見えません。</font><font style="vertical-align: inherit;">私たちの脳は、相対的な深さ、場所、動きの感覚を生み出す視覚的サポートとして影を使用することに慣れています。</font><font style="vertical-align: inherit;">しかし、3Dゲームでそれを行うのは驚くほど難しい、または少なくとも正しく行うのが難しい。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アヒルから始めましょう。</font><font style="vertical-align: inherit;">ここで彼女は野原を動き回っていて、太陽光線が彼女に届き、正しく遮られています。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f3f/2ad/1d8/f3f2ad1d84f865217d5e28cfaab98604.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シーンにシャドウを実装する最初の方法の1つは、モデルの下にシャドウの「スポット」を追加することでした。シャドウの形状が、シャドウを投影するオブジェクトの形状と一致しないため、これは完全に非現実的です。ただし、この方法はすばやく簡単に作成できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の3Dゲーム、たとえば</font><font style="vertical-align: inherit;">1996年の</font><font style="vertical-align: inherit;">最初の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トゥームレイダー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、当時のハードウェア（セガサターンやソニープレイステーションなど）がこれ以上優れたものを提供できなかったため、この方法を使用しました。このメソッドは、モデルが移動するサーフェスのすぐ上にプリミティブの単純なセットをペイントし、次にそれらをシェーディングしました。シンプルなテクスチャの下部に描画することも使用されました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ad/1b8/735/3ad1b8735674a430a18559fc87a28baa.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の方法のもう1つは、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">影</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><em><font style="vertical-align: inherit;">投影</font></em><font style="vertical-align: inherit;">することでした</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この場合、影を放出するプリミティブは、床を含む平面に投影されました。</font><font style="vertical-align: inherit;">これに必要な数学的計算の一部は、80年代後半にジムブリンによって作成されました。</font><font style="vertical-align: inherit;">現代の標準では、これは単純なプロセスであり、単純な静的オブジェクトに最適です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/130/ced/f47/130cedf47748e034cd6c87d98da9e487.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、最適化のおかげで、シャドウプロジェクションは、たとえば1999年のゲーム</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kingpin：Life of Crime</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> by Interplayで</font><font style="vertical-align: inherit;">、ダイナミックシャドウの最初の価値ある例を作成しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">下の画像にあるように、アニメーションキャラクター（ネズミでさえ！）だけが影を持っていますが、これは単純なスポットよりも優れています。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ea/dc7/5a1/2eadc75a107ec0eec8a3c0bc37497b64.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプローチの最も深刻な問題は、（a）影の完全な不透明度、および（b）投影メソッドが1つの平面（たとえば、地面）に影を放出することです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの問題は、投影されたプリミティブを着色し、各キャラクターにいくつかの投影を実行するときに透明度の共有を適用することで解決できますが、90年代後半のPCハードウェア機能は追加のレンダリングに対応できませんでした。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シャドウを作成するための最新テクノロジー</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シャドウを実装するためのより正確な方法は、すでに1977年にずっと以前に提案されました。オースティン大学（テキサス州）で働いている間、フランクリンクロウは</font><font style="vertical-align: inherit;">シャドウ</font><em><font style="vertical-align: inherit;">ボリューム</font></em><font style="vertical-align: inherit;">を使用していくつかのテクニックを提案し</font><font style="vertical-align: inherit;">た</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">研究記事</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">書きました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
一般的に、それらは次のように説明できます。プロセスは、どのプリミティブが光源に向けられるかを決定します。それらの肋骨は平面に引き伸ばされます。これは影の投影によく似ていますが、重要な違いは、作成された影のボリュームを使用して、ピクセルがボリュームの内側/外側にあるかどうかを確認することです。この情報のおかげで、影は地面だけでなくすべての表面に放出されます。</font><font style="vertical-align: inherit;">
この手法は、1991年に作業を行ったTim Heidmannによって改良されました。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シリコングラフィックス</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mark Kilgard</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は1999年</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">さらなる開発に従事し、</font><font style="vertical-align: inherit;">検討する方法は2000年</font><font style="vertical-align: inherit;">にid Softwareの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">John Carmack</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">によって作成されました</font><font style="vertical-align: inherit;">（Carmackの方法は2年前にCreative Labsの</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">BilodoとSonga</font></a><font style="vertical-align: inherit;">によって</font><font style="vertical-align: inherit;">独立してオープンされました。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カーマックは彼のコードを変更することを余儀なくされた</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）法的な問題を避けるために。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプローチには、複数のフレームレンダリング（</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マルチパス</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レンダリング</font><font style="vertical-align: inherit;">と呼ばれる</font><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">今日の至るところで使用されている90年代初頭の</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非常に</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コストのかかるプロセス）と</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステンシルバッファー</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれる概念が必要</font><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フレームバッファーと深度とは異なり、3Dシーン自体では作成されません。このバッファーは</font><font style="vertical-align: inherit;">、ラスターの形式で</font><font style="vertical-align: inherit;">すべての次元（つまり、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yの</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解像度</font><font style="vertical-align: inherit;">）で</font><font style="vertical-align: inherit;">等しい値の配列です</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そこに格納されている値は、フレームバッファー内の各ピクセルをどうするかをレンダリングエンジンに指示するために使用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このバッファを使用する最も簡単な例は、マスクとして使用することです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b99/dfa/f1c/b99dfaf1c876fb4ed736c5947460efbd.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シャドウのボリュームを使用するメソッドは、おおよそ次のように実行されます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シーンをフレームバッファーにレンダリングしますが、アンビエントライティングのみを使用します（ピクセルに光源が含まれている場合は、そこにすべての放出値も含めます）</font></font></li>
<li>  ,    ,    (  <em>   (back-face culling)</em>).        (,  )         .   <em></em>   (..     «»)    -     .</li>
<li>  ,       (front-face culling)    -,     .</li>
<li>   ,        ,       -.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのステンシルバッファーとシャドウボリューム（一般にステンシルシャドウと呼ばれます）は、2004 </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Doom 3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> id Softwareゲームで使用されました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/501/015/720/5010157201afaff6066d609748a40eae.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キャラクターが歩いている表面が影を通してまだ見えていることに注意してください。これは、影の投影に対する最初の利点です。さらに、このアプローチでは、光源からの距離を考慮に入れ（その結果、弱い影が得られます）、任意の表面（キャラクター自体を含む）に影を落とします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、この手法には重大な欠点があり、最も顕著なのは、影のエッジが、影を落とすオブジェクトの作成に使用されるプリミティブの数に完全に依存していることです。さらに、マルチパスはローカルメモリへの多くの読み取り/書き込み操作に関連付けられているため、ステンシルシャドウの使用はパフォーマンスの点で非常にコストがかかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、すべてのグラフィックAPIがかなり少ない数のビット（通常は8）を割り当てるため、ステンシルバッファーを使用して確認できるシャドウボリュームの数には制限があります。ただし、ステンシルシャドウの計算コストのため、この問題は通常発生しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別の問題があります-影自体は現実的ではありません。どうして？すべての光源-ランプ、裸火、ランタン、太陽-は、空間内の単一の点ではありません。彼らはいくつかの地域の光を放ちます。以下に示す最も単純なケースであっても、実際の影にはシャープなエッジがほとんどありません。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b7c/6b4/52b/b7c6b452bacb558d508a751c5bdebdb1.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
影の最も暗い領域は、完全な影（アンブラ）と呼ばれます。</font><font style="vertical-align: inherit;">半影は常に明るい影であり、2つの間の境界はしばしばぼやけています（通常、多くの光源があるため）。</font><font style="vertical-align: inherit;">作成されたシャドウは処理できるように間違った形式で保存されるため、ステンシルバッファーとボリュームを使用してこれをモデル化することは困難です。</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シャドウマッピング</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が役立ち</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本的な手順</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は1978年に</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ランスウィリアムス</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">によって開発されました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">とてもシンプルです：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各光源について、この光源の視点からシーンをレンダリングし、深度の特別なテクスチャを作成します（つまり、色、照明、テクスチャリングなどはありません）。</font><font style="vertical-align: inherit;">このバッファの解像度は、完成したフレームのサイズと同じである必要はありませんが、高いほど良いです。</font></font></li>
<li>      ,        (  x,y  z) ,        .</li>
<li>          :   ,           .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
明らかに、これは別のマルチパス手順ですが、最後の手順はピクセルシェーダーを使用して実行できるため、深度チェックと後続のライティング計算が1つのパスで結合されます。また、シャドウを作成するプロセス全体は、使用されるプリミティブの数に依存しないため、ステンシルバッファーとシャドウのボリュームを使用するよりもはるかに高速です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、上記の基本的な手法では、あらゆる種類の視覚的なアーティファクト（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パースペクティブエイリアシング</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「シャドウアクネ」</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、「ピーターパニング」など）が生成されます。これらのほとんどは、深度テクスチャの解像度とビットサイズに関連しています。すべてのGPUとグラフィックAPIにはテクスチャと同様の制限があるため、これらの問題を解決するために、追加のテクニックのセット全体が作成されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テクスチャを深度情報に使用することの利点の1つは、GPUが非常に迅速にさまざまな方法でテクスチャをサンプリングおよびフィルタリングできることです。 2005年、Nvidiaは、標準のシャドウイングによって引き起こされる視覚的な問題のいくつかを解決できるテクスチャサンプリング手法を実証しました。さらに、彼はシャドウのエッジにある程度の滑らかさを提供しました。この手法は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パーセンテージクローザーフィルタリング</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://" rel="nofollow"><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4c0/5bf/c31/4c05bfc31232887519a64eb7995e7d7d.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じ時期に、Futuremark </font><font style="vertical-align: inherit;">は</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">3DMark06</font></a><font style="vertical-align: inherit;">での</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カスケードシャドウマップ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（CSM）の</font><font style="vertical-align: inherit;">使用を示しました</font><font style="vertical-align: inherit;">。これは、光源ごとに異なる解像度でいくつかの深度テクスチャを作成する手法です。高解像度テクスチャは、ソースの近くで使用され、ソースから離れた位置で使用されます。その結果、歪みのないスムーズなシーンのシャドウ遷移が実現します。</font><font style="vertical-align: inherit;">
この手法は、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">分散シャドウマッピング</font></a><font style="vertical-align: inherit;">（VSM）</font><font style="vertical-align: inherit;">手順で2006年にDonnellyとLoritzenによって改善さ</font><font style="vertical-align: inherit;">れ、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">サンプル分布アルゴリズム</font></a><font style="vertical-align: inherit;">（SDSM）</font><font style="vertical-align: inherit;">で2010年にIntel </font><font style="vertical-align: inherit;">によって改善されました</font><font style="vertical-align: inherit;">。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a2f/91a/0d8/a2f91a0d8f6c22ba64ab03aeccf50b00.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shadow of the Tomb RaiderでSDSMを使用</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
する画像を改善するために、ゲーム開発者は多くの場合、シェーディングテクニック全体を使用しますが、主なものはシャドウマッピングのままです。ただし、それを適用できるのは少数のアクティブな光源のみです。これは、光を反射または放出する各サーフェスに対してモデリングしようとすると、フレームレートが壊滅的に低下するためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
幸い、どんなオブジェクトでも機能する便利なテクニックがあります。それは、オブジェクトに到達する照明の明るさの低下の印象を与えます（彼または他のオブジェクトが光を少し遮るという事実による）。この機能は</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><em><font style="vertical-align: inherit;">アンビエントオクルージョン</font></em></a><font style="vertical-align: inherit;">と呼ばれ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして彼女は多くのバージョンを持っています。それらの一部はハードウェアメーカーによって特別に設計されています。たとえば、AMDがHDAO（</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高解像度アンビエントオクルージョン</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）を</font><font style="vertical-align: inherit;">作成し</font><font style="vertical-align: inherit;">、Nvidiaが</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HBAO +</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ホライズンベースのアンビエントオクルージョン</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）を備えています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どのバージョンを使用しても、シーンが完全にレンダリングされた後で適用されるため、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポストプロセッシング</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エフェクトとして分類されます</font><font style="vertical-align: inherit;">。実際、各ピクセルについて</font><font style="vertical-align: inherit;">、深度バッファーの対応するポイントでピクセル深度の値を周囲のピクセルと比較する</font><font style="vertical-align: inherit;">ことで、シーン内でこれをどれだけ見るか（これについては</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちら</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちら</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を参照）が計算されます</font><font style="vertical-align: inherit;">（これも、テクスチャとして保存されます）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デプスバッファーをサンプリングし、最終的なピクセルカラーを計算することは、アンビエントオクルージョンの品質を確保する上で重要な役割を果たします。</font><font style="vertical-align: inherit;">シャドウイングの場合と同様に、アンビエントオクルージョンのすべてのバージョンを適切に操作するには、プログラマーが状況に応じてコードを慎重に構成および調整する必要があります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f4e/865/e15/f4e865e159dfa5e83286e1245a5b46f9.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shadow of the Tomb Raider（AOなし（左）およびHBAO +（右）付き）</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ただし、適切に実装すると、この視覚効果は深い印象を残します。</font><font style="vertical-align: inherit;">上の画像では、人の手、パイナップル、バナナ、および周囲の草や植物に注意してください。</font><font style="vertical-align: inherit;">HBAO +ピクセルの色の変更はごくわずかですが、すべてのオブジェクトが環境に組み込まれた方が見栄えがよくなりました（左側では、人が地面にぶら下がっているように見えます）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事で説明した最後のゲームのいずれかを選択した場合、ライティングとシャドウを処理するときにそれらで使用されるレンダリング手法のリストは、記事自体の長さになります。また、すべての新しい3Dゲームがこれらのテクノロジーをすべて備えているわけではありませんが、Unrealなどのユニバーサルゲームエンジンでは、オプションでそれらを有効にでき、ツールキット（たとえば、Nvidia企業）は、ゲームに挿入できるコードを提供します。これは、それらが高度に専門化された超近代的な方法ではないことを証明しています-かつて最高のプログラマーの財産でしたが、今では誰でも利用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
光線追跡について言及せずに、照明と影に関するこの記事を完了することはできません。</font><font style="vertical-align: inherit;">この一連の記事で</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すでに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このプロセス</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">について話しました</font></a><font style="vertical-align: inherit;">が、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">現在の技術開発のレベル</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">低フレームレートと深刻な現金支出を我慢する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、このテクノロジは次世代のコンソールであるMicrosoftとSonyによってサポートされています。つまり、今後数年間で、その使用は、ゲームの視覚的品質の向上を求める世界中の開発者にとってもう1つの標準的なツールになるでしょう。</font><font style="vertical-align: inherit;">Remedyが彼女の最新の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Control</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲームで何を達成したかを見てみましょう</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/gJ7gdBGXODI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テクスチャの偽の影と単純なアンビエントライティングから遠く離れてきました！</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それがすべてではありません</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、3Dゲームで使用される基本的な数学的計算とテクニックについて話し、それらを可能な限り現実的なものにしました。</font><font style="vertical-align: inherit;">また、光とオブジェクトおよびマテリアルとの相互作用のモデリングの基礎となるテクノロジーについても検討しました。</font><font style="vertical-align: inherit;">しかし、これらすべてが氷山の一角にすぎませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、省エネルギー照明、レンズフレア、ブルーム、高度に動的なレンダリング、放射輝度転送、トーン補正、フォグ、色収差、フォトンマッピング、コースティクス、ラジオシティなどのトピックはスキップしました-このリストは続きます。</font><font style="vertical-align: inherit;">簡単な調査では、さらに3〜4件の記事が必要になります。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja501426/index.html">Unison：2つのサーバーでのディレクトリの双方向同期の設定と自動化</a></li>
<li><a href="../ja501430/index.html">ウェブサイトのコンテンツのデザインと計画への素晴らしいガイド</a></li>
<li><a href="../ja501432/index.html">JDBCに代わる2つの方法</a></li>
<li><a href="../ja501434/index.html">セキュリティウィーク20：Thunderboltを介したコンピューターのハッキング</a></li>
<li><a href="../ja501436/index.html">第2種のエラーの可能性が低い画像の番号認識アルゴリズム</a></li>
<li><a href="../ja501440/index.html">Zabbix 5.0をリリース</a></li>
<li><a href="../ja501442/index.html">初心者のための基本的なLinuxコマンド</a></li>
<li><a href="../ja501448/index.html">独自のアジャイルコースのプロファイリング方法</a></li>
<li><a href="../ja501450/index.html">iOS開発者が知っておくべき14のこと</a></li>
<li><a href="../ja501454/index.html">機能テストでPostgreSQLを使用するための6つのヒント</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>