<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍💼 👈🏼 💤 Compare el rendimiento de la restricción de verificación y la clave externa en SQL Server 🗼 👩🏼‍🤝‍👩🏻 👩🏾‍🏭</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La traducción del artículo fue preparada en la víspera del inicio del curso "MS SQL Server Developer" .
 
 
 Problema
 Al ajustar el rendimiento de SQ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Compare el rendimiento de la restricción de verificación y la clave externa en SQL Server</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/506370/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La traducción del artículo fue preparada en la víspera del inicio del curso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"MS SQL Server Developer"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></b></i><br>
<br>
<hr><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problema</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ajustar el rendimiento de SQL Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a menudo surge la pregunta de cómo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> restricción de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">clave externa</font></a><font style="vertical-align: inherit;"> afecta el rendimiento de la modificación de datos. </font><font style="vertical-align: inherit;">Todos entienden que las claves externas son necesarias para garantizar la integridad referencial, pero ¿tal vez hay alguna otra manera con un mejor rendimiento? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este artículo, veremos los pros y los contras del uso de la restricción CHECK para proporcionar integridad referencial en lugar de la clave foránea habitual.</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisión</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de profundizar en los detalles, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aquí</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> puede </font><font style="vertical-align: inherit;">recordar las diversas restricciones de integridad. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este ejemplo, utilizaremos una clave foránea simple de una tabla </font></font><code>main_fk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a una tabla </font></font><code>lookup_fk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y convertiremos esta clave foránea en una restricción CHECK en la tabla </font></font><code>main_cc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo de clave externa</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cree una relación típica de clave externa.</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> lookup_fk (
    <span class="hljs-keyword">id</span> <span class="hljs-built_in">int</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>, <font></font>
    description <span class="hljs-built_in">varchar</span>(<span class="hljs-number">10</span>));<font></font>
 <font></font>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> main_fk (
    <span class="hljs-keyword">id</span> <span class="hljs-built_in">int</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span> <span class="hljs-keyword">identity</span> (<span class="hljs-number">1</span>, <span class="hljs-number">1</span>), <font></font>
    lookupid <span class="hljs-built_in">int</span>,<font></font>
    col1 <span class="hljs-built_in">int</span>,<font></font>
    col2 <span class="hljs-built_in">int</span>,<font></font>
    col3 <span class="hljs-built_in">varchar</span>(<span class="hljs-number">100</span>));<font></font>
 <font></font>
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> lookup_fk 
<span class="hljs-keyword">add</span> <span class="hljs-keyword">constraint</span> pk_lookup primary <span class="hljs-keyword">key</span> clustered (<span class="hljs-keyword">id</span>);<font></font>
 <font></font>
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> main_fk 
<span class="hljs-keyword">add</span> <span class="hljs-keyword">constraint</span> pk_main primary <span class="hljs-keyword">key</span> clustered (<span class="hljs-keyword">id</span>);<font></font>
 <font></font>
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> main_fk 
<span class="hljs-keyword">add</span> <span class="hljs-keyword">constraint</span> fk_main_lookup <span class="hljs-keyword">foreign</span> <span class="hljs-keyword">key</span> 
    (lookupid) <span class="hljs-keyword">REFERENCES</span> lookup_fk (<span class="hljs-keyword">id</span>) <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-keyword">cascade</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">delete</span> <span class="hljs-keyword">cascade</span>;<font></font>
 <font></font>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">index</span> ix_main_fk_lookupid <span class="hljs-keyword">on</span> main_fk (lookupid);</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo con restricción CHECK</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La estructura de la tabla anterior se puede repetir utilizando la restricción CHECK en lugar de la clave externa. </font><font style="vertical-align: inherit;">Tenga en cuenta que para CHECK, debe especificar explícitamente una lista de valores que se incluyen en esta restricción. </font><font style="vertical-align: inherit;">Estos valores deben actualizarse sobre la marcha (como veremos más adelante), pero para nuestro experimento simplemente enumeraremos estos valores por adelantado.</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> lookup_cc (
    <span class="hljs-keyword">id</span> <span class="hljs-built_in">int</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>, <font></font>
    description <span class="hljs-built_in">varchar</span>(<span class="hljs-number">10</span>));<font></font>
 <font></font>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> main_cc (
    <span class="hljs-keyword">id</span> <span class="hljs-built_in">int</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>  <span class="hljs-keyword">identity</span> (<span class="hljs-number">1</span>, <span class="hljs-number">1</span>), <font></font>
    lookupid <span class="hljs-built_in">int</span>,<font></font>
    col1 <span class="hljs-built_in">int</span>,<font></font>
    col2 <span class="hljs-built_in">int</span>,<font></font>
    col3 <span class="hljs-built_in">varchar</span>(<span class="hljs-number">100</span>));<font></font>
 <font></font>
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> lookup_cc 
<span class="hljs-keyword">add</span> <span class="hljs-keyword">constraint</span> pk_lookup_cc primary <span class="hljs-keyword">key</span> clustered (<span class="hljs-keyword">id</span>);<font></font>
 <font></font>
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> main_cc 
<span class="hljs-keyword">add</span> <span class="hljs-keyword">constraint</span> pk_main_cc primary <span class="hljs-keyword">key</span> clustered (<span class="hljs-keyword">id</span>);<font></font>
 <font></font>
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> main_cc 
<span class="hljs-keyword">add</span> <span class="hljs-keyword">constraint</span> ck_main_cc_lookupid <span class="hljs-keyword">check</span> 
      ((lookupid <span class="hljs-keyword">IN</span> (<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">16</span>,<span class="hljs-number">17</span>,<span class="hljs-number">18</span>,<span class="hljs-number">19</span>)));<font></font>
 <font></font>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">index</span> ix_main_cc_lookupid <span class="hljs-keyword">on</span> main_cc (lookupid);</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Insertar datos en una tabla</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora que hemos creado las tablas, podemos cargar los datos de prueba en </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- y - </font></font><code>lookup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">las tablas.</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">declare</span> @cnt <span class="hljs-built_in">integer</span>
<span class="hljs-keyword">declare</span> @incnt <span class="hljs-built_in">integer</span>
<span class="hljs-keyword">select</span> @cnt=<span class="hljs-number">1</span><font></font>
 <font></font>
<span class="hljs-keyword">while</span> @cnt &lt; <span class="hljs-number">20</span>
<span class="hljs-keyword">begin</span>
    <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> lookup_fk
    <span class="hljs-keyword">values</span> (@cnt, <span class="hljs-string">'count '</span> + <span class="hljs-keyword">cast</span>(@cnt <span class="hljs-keyword">as</span> <span class="hljs-built_in">varchar</span>));<font></font>
    <font></font>
    <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> lookup_cc
    <span class="hljs-keyword">values</span> (@cnt, <span class="hljs-string">'count '</span> + <span class="hljs-keyword">cast</span>(@cnt <span class="hljs-keyword">as</span> <span class="hljs-built_in">varchar</span>));<font></font>
 <font></font>
    <span class="hljs-keyword">select</span> @incnt=<span class="hljs-number">1</span>
    <span class="hljs-keyword">while</span> @incnt &lt; <span class="hljs-number">100</span>
    <span class="hljs-keyword">begin</span>
        <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> main_fk (lookupid,col1,col2,col3)
        <span class="hljs-keyword">values</span> (@cnt, @cnt, @cnt, <span class="hljs-string">'dummydatadummydatadummydatadummydata'</span> + <span class="hljs-keyword">cast</span>(@cnt <span class="hljs-keyword">as</span> <span class="hljs-built_in">varchar</span>));
        <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> main_cc (lookupid,col1,col2,col3)
        <span class="hljs-keyword">values</span> (@cnt, @cnt, @cnt, <span class="hljs-string">'dummydatadummydatadummydatadummydata'</span> + <span class="hljs-keyword">cast</span>(@cnt <span class="hljs-keyword">as</span> <span class="hljs-built_in">varchar</span>));
        <span class="hljs-keyword">select</span> @incnt=@incnt+<span class="hljs-number">1</span>
    <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">select</span> @cnt=@cnt+<span class="hljs-number">1</span>
<span class="hljs-keyword">end</span></code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verificación de integridad referencial </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo primero que debemos hacer es asegurarnos de que la integridad referencial funcione. </font><font style="vertical-align: inherit;">El script anterior inserta </font></font><code>lookup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valores de </font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hasta 19 </font><font style="vertical-align: inherit;">en la </font><font style="vertical-align: inherit;">tabla </font><font style="vertical-align: inherit;">, así que intentemos insertar un </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor </font></font><code>lookupid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mayor que 19 </font><font style="vertical-align: inherit;">en la </font><font style="vertical-align: inherit;">tabla </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> main_fk (lookupid,col1,col2,col3) <span class="hljs-keyword">values</span> 
       (<span class="hljs-number">20</span>,<span class="hljs-number">15</span>,<span class="hljs-number">15</span>,<span class="hljs-string">'dummydatadummydatadummydatadummydata'</span> + <span class="hljs-keyword">cast</span>(<span class="hljs-number">15</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">varchar</span>));<font></font>
       <font></font>
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> main_cc (lookupid,col1,col2,col3) <span class="hljs-keyword">values</span> 
       (<span class="hljs-number">20</span>,<span class="hljs-number">15</span>,<span class="hljs-number">15</span>,<span class="hljs-string">'dummydatadummydatadummydatadummydata'</span> + <span class="hljs-keyword">cast</span>(<span class="hljs-number">15</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">varchar</span>));</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En ambos casos, recibimos mensajes de error similares.</font></font><br>
<br>
<pre><code class="sql hljs">Msg 547, Level 16, State 0, Line 40<font></font>
The <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">statement</span> conflicted <span class="hljs-keyword">with</span> the <span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">constraint</span> <span class="hljs-string">"fk_main_lookup"</span>. <font></font>
The conflict occurred <span class="hljs-keyword">in</span> <span class="hljs-keyword">database</span> <span class="hljs-string">"test"</span>, <span class="hljs-keyword">table</span> <span class="hljs-string">"dbo.lookup_fk"</span>, <span class="hljs-keyword">column</span> <span class="hljs-string">'id'</span>.<font></font>
<font></font>
Msg <span class="hljs-number">547</span>, <span class="hljs-keyword">Level</span> <span class="hljs-number">16</span>, State <span class="hljs-number">0</span>, Line <span class="hljs-number">41</span>
The <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">statement</span> conflicted <span class="hljs-keyword">with</span> the <span class="hljs-keyword">CHECK</span> <span class="hljs-keyword">constraint</span> <span class="hljs-string">"ck_main_cc_lookupid"</span>. <font></font>
The conflict occurred <span class="hljs-keyword">in</span> <span class="hljs-keyword">database</span> <span class="hljs-string">"test"</span>, <span class="hljs-keyword">table</span> <span class="hljs-string">"dbo.main_cc"</span>, <span class="hljs-keyword">column</span> <span class="hljs-string">'lookupid'</span>.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las entradas no se agregan a las tablas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prueba INSERTAR</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora que hemos verificado que la integridad referencial funciona, podemos probar el rendimiento. </font><font style="vertical-align: inherit;">Primero, comparemos INSERT.</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> main_fk (lookupid,col1,col2,col3) <span class="hljs-keyword">values</span> 
     (<span class="hljs-number">15</span>,<span class="hljs-number">15</span>,<span class="hljs-number">15</span>,<span class="hljs-string">'dummydatadummydatadummydatadummydata'</span> + <span class="hljs-keyword">cast</span>(<span class="hljs-number">15</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">varchar</span>));<font></font>
go<font></font>
 <font></font>
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> main_cc (lookupid,col1,col2,col3) <span class="hljs-keyword">values</span> 
     (<span class="hljs-number">15</span>,<span class="hljs-number">15</span>,<span class="hljs-number">15</span>,<span class="hljs-string">'dummydatadummydatadummydatadummydata'</span> + <span class="hljs-keyword">cast</span>(<span class="hljs-number">15</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">varchar</span>));<font></font>
go</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A través de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL Profiler,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> puede ver que la inserción en una tabla con CHECK se realiza con menos lecturas que en una tabla con una clave foránea, ya que no necesita realizar una consulta en la tabla </font></font><code>lookup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x4/sq/xd/x4sqxd7cqpcmzxlil5wd8uhwa84.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
También puede ver esta información al incluirla </font></font><code>set statistics io on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">antes de ejecutar la consulta. </font><font style="vertical-align: inherit;">Aquí puede ver que la segunda consulta se refiere solo a la </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tabla.</font></font><br>
<br>
<pre><code class="sql hljs">Table 'lookup_fk'. Scan count 0, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, <font></font>
      lob physical reads 0, lob read-ahead reads 0.<font></font>
Table 'main_fk'. Scan count 0, logical reads 4, physical reads 0, read-ahead reads 0, lob logical reads 0, <font></font>
      lob physical reads 0, lob read-ahead reads 0.<font></font>
<font></font>
Table 'main_cc'. Scan count 0, logical reads 4, physical reads 0, read-ahead reads 0, lob logical reads 0, <font></font>
      lob physical reads 0, lob read-ahead reads 0.</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACTUALIZACIÓN de prueba</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hagamos una prueba similar para ACTUALIZAR. </font><font style="vertical-align: inherit;">Cambie el valor </font></font><code>lookupid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de un registro en cada una de las </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tablas.</font></font><br>
<br>
<pre><code class="plaintext hljs">update main_fk set lookupid=10 where id=231;<font></font>
go<font></font>
 <font></font>
update main_cc set lookupid=10 where id=231;<font></font>
go</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ACTUALIZAR, al igual que INSERT, funciona un poco más rápido y realiza menos operaciones de lectura. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/aa/qg/lq/aaqglqmy4odbqckuq_1-jbkcrfy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usando la información obtenida a través de </font></font><code>set statistics io on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, se puede confirmar aún más que se gastan recursos adicionales en la lectura de una </font></font><code>lookup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tabla </font><font style="vertical-align: inherit;">extranjera </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="sql hljs">Table 'lookup_fk'. Scan count 0, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, <font></font>
      lob physical reads 0, lob read-ahead reads 0.<font></font>
Table 'main_fk'. Scan count 0, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, <font></font>
      lob physical reads 0, lob read-ahead reads 0.<font></font>
Table 'main_cc'. Scan count 0, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, <font></font>
      lob physical reads 0, lob read-ahead reads 0.</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prueba DELETE</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, realizar una eliminación utilizando nuestra nueva estructura con CHECK será más complicado que con una clave externa normal. </font><font style="vertical-align: inherit;">La clave externa en la tabla </font></font><code>main_fk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se creó usando </font></font><code>on delete cascade</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, por lo tanto, para eliminar un registro de </font></font><code>lookup_fk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(y luego de </font></font><code>main_fk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), solo necesitamos eliminarlo </font></font><code>lookup_fk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">begin</span> <span class="hljs-keyword">transaction</span>;
   <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> lookup_fk <span class="hljs-keyword">where</span> <span class="hljs-keyword">id</span>=<span class="hljs-number">19</span>;
<span class="hljs-keyword">commit</span> <span class="hljs-keyword">transaction</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con CHECK tendremos que jugar mucho más, porque los registros deben eliminarse de ambas tablas manualmente, y la restricción CHECK en la tabla </font></font><code>main_cc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe recrearse eliminando los valores correspondientes </font></font><code>lookupid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Los siguientes son DML y DDL para todos estos comandos.</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">begin</span> <span class="hljs-keyword">transaction</span>;
   <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> lookup_cc <span class="hljs-keyword">where</span> <span class="hljs-keyword">id</span>=<span class="hljs-number">19</span>;
   <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> main_cc <span class="hljs-keyword">where</span> lookupid=<span class="hljs-number">19</span>;
   <span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> main_cc <span class="hljs-keyword">drop</span> <span class="hljs-keyword">constraint</span> ck_main_cc_lookupid ;
   <span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> main_cc <span class="hljs-keyword">with</span> <span class="hljs-keyword">nocheck</span> <span class="hljs-keyword">add</span> <span class="hljs-keyword">constraint</span> ck_main_cc_lookupid 
         <span class="hljs-keyword">check</span> ((lookupid <span class="hljs-keyword">IN</span> (<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">16</span>,<span class="hljs-number">17</span>,<span class="hljs-number">18</span>)));
<span class="hljs-keyword">commit</span> <span class="hljs-keyword">transaction</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A través de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL Profiler,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vemos que a pesar de la mayor cantidad de lecturas en CHECK (aproximadamente 10%), se ejecuta el doble de rápido (duración) y usa menos CPU. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/64/0s/e-/640se-btj4mcnhcyjcjzqaizfsq.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: RowCount no incluye eliminaciones en cascada. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
También me gustaría señalar que agregar un valor a la tabla </font></font><code>lookup_cc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puede llevar a la misma situación que para DELETE, ya que en la tabla </font></font><code>main_cc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe eliminar y volver a crear la restricción CHECK.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vimos que, al menos para un caso tan simple, puede mejorar el rendimiento utilizando la restricción CHECK. </font><font style="vertical-align: inherit;">Sería interesante ver esto a mayor escala para ver si la imagen es la misma. </font><font style="vertical-align: inherit;">Sin embargo, creo que el uso de este método depende en última instancia de la frecuencia con la que agrega / elimina valores en la </font></font><code>lookup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tabla β en comparación con la cantidad de datos que se agregan a la </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tabla β, ya que los cambios frecuentes en los valores </font></font><code>lookupid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">realmente agregan complejidad.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usar Microsoft SQL Server en Linux</font></font></a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es506340/index.html">Cómo se ven las nuevas salvaguardas de Amazon</a></li>
<li><a href="../es506342/index.html">Cómo un sistema de automatización resuelve los problemas de un club deportivo</a></li>
<li><a href="../es506346/index.html">Millones en un mes: cómo lanzar una startup en Europa por tu cuenta</a></li>
<li><a href="../es506358/index.html">3 opciones para el comportamiento de la corte cuando reciben casos de bloqueos fiscales</a></li>
<li><a href="../es506362/index.html">Cómo hicimos un baile en línea</a></li>
<li><a href="../es506372/index.html">El instinto de reproducción se encuentra en la inteligencia artificial.</a></li>
<li><a href="../es506380/index.html">Software gratis o doméstico. Matrícula estándar o gratuita</a></li>
<li><a href="../es506384/index.html">Red neuronal: entrenamiento sin maestro. Método de gradiente de políticas</a></li>
<li><a href="../es506386/index.html">Cómo abandonar la escuela y transferir a un niño a un lugar remoto</a></li>
<li><a href="../es506392/index.html">Notificación de Roskomnadzor sobre el procesamiento de datos personales en 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>