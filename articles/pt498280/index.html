<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòÉ üë¥üèΩ ‚ö´Ô∏è A hist√≥ria do p√°ssaro Dodo do g√™nero Phoenix. A Grande Queda de Dodo √â üèß ü§¶üèΩ ü§¶üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Todos os anos, em 21 de abril, lembramos a hist√≥ria da Grande Queda do Dodo IS em 2018. O passado √© um professor cruel, mas justo. Vale lembrar, repet...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>A hist√≥ria do p√°ssaro Dodo do g√™nero Phoenix. A Grande Queda de Dodo √â</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dodopizzadev/blog/498280/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todos os anos, em 21 de abril, lembramos a hist√≥ria da Grande Queda do Dodo IS em 2018. </font><font style="vertical-align: inherit;">O passado √© um professor cruel, mas justo. </font><font style="vertical-align: inherit;">Vale lembrar, repetindo as li√ß√µes, transmitindo o conhecimento acumulado √†s novas gera√ß√µes e tratando com gratid√£o quem nos tornamos. </font><font style="vertical-align: inherit;">Sob o corte, queremos contar uma hist√≥ria sobre como foi e compartilhar conclus√µes. </font><font style="vertical-align: inherit;">Voc√™ n√£o pode sequer desejar tal situa√ß√£o ao inimigo.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sy/r0/jj/syr0jjrgnwuubuusucjvag6ot-o.png"><br>
<a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grande Hist√≥ria do Outono</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dia 1. O acidente que nos custou milh√µes de rublos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No s√°bado, 21 de abril de 2018, o sistema Dodo IS caiu. Caiu muito mal. Por v√°rias horas, nossos clientes n√£o puderam fazer um pedido pelo site ou pelo aplicativo m√≥vel. A linha de chamadas para o call center cresceu a tal ponto que a voz autom√°tica da secret√°ria eletr√¥nica diz: "Ligaremos em 4 horas". </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ek/ha/ac/ekhaac2m8owflsjdblpfmnksux8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Naquele dia, experimentamos uma das mais graves quedas do Dodo IS. O pior foi que, no dia anterior, lan√ßamos a primeira campanha publicit√°ria de TV federal com um or√ßamento de 100 milh√µes de rublos. Foi um grande evento para Dodo Pizza. A equipe de TI tamb√©m estava bem preparada para a campanha. Automatizamos e simplificamos a implanta√ß√£o - agora, com a ajuda de um √∫nico bot√£o no TeamCity, podemos implantar um mon√≥lito em 12 pa√≠ses. N√£o fizemos todo o poss√≠vel e, portanto, estragamos tudo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A campanha publicit√°ria foi incr√≠vel. Recebemos de 100 a 150 pedidos por minuto. Essa foi uma boa not√≠cia. A m√° not√≠cia: o Dodo IS n√£o suportou tal carga e morreu. Atingimos o limite de escala vertical e n√£o conseguimos mais processar pedidos. O sistema ficou inst√°vel por cerca de tr√™s horas, recuperando-se periodicamente, mas caiu imediatamente novamente. Cada minuto de inatividade nos custa dezenas de milhares de rublos, sem contar a perda de respeito de clientes irritados. A equipe de desenvolvimento decepcionou todo mundo: clientes, parceiros, funcion√°rios de pizzarias e um call center. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nu/te/kw/nutekwrugivxr0ns__zlnzxo74a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o tivemos escolha sen√£o arrega√ßar as mangas e sentar para corrigir a situa√ß√£o. Desde domingo (22 de abril), trabalhamos no modo dif√≠cil, n√£o temos o direito de cometer um erro.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A seguir, √© apresentado nosso resumo da experi√™ncia sobre como nos encontrar em uma situa√ß√£o dessas e como sair dela mais tarde. </font><font style="vertical-align: inherit;">Amigos, n√£o cometer nossos erros.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Duas falhas que lan√ßaram o efeito domin√≥</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vale a pena come√ßar com como tudo come√ßou e onde estragamos tudo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_h/qh/yy/_hqhyy80kusheiqap3xwfchwjvk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No s√°bado, 21/04/2018, por volta das 17:00, notamos que o n√∫mero de bloqueios no banco de dados come√ßou a crescer - um indicador de problemas. </font><font style="vertical-align: inherit;">T√≠nhamos um runbook pronto para resolver, pois entend√≠amos de onde vinham esses bloqueios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo deu errado depois que o runbook falhou duas vezes. </font><font style="vertical-align: inherit;">Por alguns minutos, a base voltou ao normal e novamente come√ßou a engasgar. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infelizmente, o banco de dados mestre rollback_on_timeout teve 600 segundos, motivo pelo qual todos os bloqueios estavam se acumulando. </font><font style="vertical-align: inherit;">Este √© o primeiro arquivo importante nesta hist√≥ria. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma configura√ß√£o simples pode salvar tudo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois, houve tentativas de trazer o sistema de volta √† vida de v√°rias maneiras, nenhuma das quais teve sucesso. </font><font style="vertical-align: inherit;">At√© que percebemos que h√° uma diferen√ßa no esquema de recebimento de pedidos no aplicativo m√≥vel e no novo site. </font><font style="vertical-align: inherit;">Ao reduzi-los, conseguimos entender onde est√£o os buracos no antigo esquema de tomada de pedidos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O sistema de aceita√ß√£o de pedidos foi escrito h√° muito tempo. </font><font style="vertical-align: inherit;">Naquele momento, ele j√° estava sendo processado e foi lan√ßado no novo site dodopizza.ru. </font><font style="vertical-align: inherit;">N√£o foi usado no aplicativo m√≥vel. </font><font style="vertical-align: inherit;">Inicialmente, os motivos para a cria√ß√£o de um novo esquema de pedidos estavam relacionados a regras puramente comerciais; os problemas de desempenho nem estavam na agenda. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este √© o segundo arquivo importante - n√£o conhec√≠amos os limites do nosso sistema.</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dia 2. Elimina√ß√£o de Acidentes </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A resposta da equipe foi muito reveladora. Nossa esta√ß√£o de servi√ßo escreveu um post no Slack e todos vieram no dia seguinte - em 22 de abril, o trabalho come√ßou √†s 8h30 da manh√£. Ningu√©m precisava ser persuadido ou convidado a sair no dia de folga. Todos entenderam tudo: o que precisa ser suportado, ajudado, com as m√£os, com a cabe√ßa, nos testes, otimiza√ß√£o de consultas, infraestrutura. Alguns chegaram at√© com toda a fam√≠lia! Os caras das equipes vizinhas, n√£o relacionados √† TI, chegaram ao escrit√≥rio com comida, e o call center trouxe for√ßas adicionais por precau√ß√£o. Todas as equipes unidas em um √∫nico objetivo - subir! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4u/sv/nt/4usvntb_mitqlbh7sya9rltxoqq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma nova recep√ß√£o da ordem foi o principal objetivo no domingo, 22 de abril. Entendemos que o pico de pedidos seria compar√°vel ao s√°bado. Tivemos o prazo mais severo - √†s 17 horas, uma nova enxurrada de pedidos cair√°.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste dia, agimos de acordo com o plano "para garantir que n√£o caia", que elaboramos na v√©spera do dia 21 no final da noite, quando j√° hav√≠amos levantado o sistema e entendido o que havia acontecido. </font><font style="vertical-align: inherit;">O plano foi dividido condicionalmente em 2 partes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementa√ß√£o do esquema com um novo pedido no aplicativo m√≥vel.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otimiza√ß√£o do processo de cria√ß√£o de pedidos.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao implementar essas coisas, podemos ter certeza de que o Dodo IS n√£o cair√°. </font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√≥s determinamos a frente do trabalho e trabalho</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A implementa√ß√£o do esquema com um novo pedido em um aplicativo m√≥vel foi a maior prioridade. N√£o t√≠nhamos n√∫meros exatos para todo o esquema, mas em algumas partes, o n√∫mero e a qualidade das consultas ao banco de dados, entendemos habilmente que isso daria um aumento na produtividade. Uma equipe de 15 pessoas trabalhou na tarefa dia ap√≥s dia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Embora, de fato, a introdu√ß√£o de um novo esquema de pedidos, come√ßamos antes do outono de 21/04/04, mas n√£o conclu√≠mos o neg√≥cio. Ainda havia bugs ativos e a tarefa pendia em um estado semi-ativo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A equipe dividiu a regress√£o em partes: regress√£o de duas plataformas m√≥veis, al√©m do gerenciamento de pizzarias. Passamos muito tempo manualmente para preparar pizzarias de teste, mas uma separa√ß√£o clara ajudou a paralelizar a regress√£o manual.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim que algumas mudan√ßas foram introduzidas, elas foram implantadas imediatamente no ambiente de pr√©-produ√ß√£o e testadas instantaneamente. A equipe estava sempre em contato, eles realmente sentavam em uma sala grande com hangouts. Os caras de Nizhny Novgorod e Syktyvkar tamb√©m estavam sempre em contato. Se houvesse um plugue, ele imediatamente decidiu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Normalmente, lan√ßamos novas funcionalidades gradualmente: 1 pizzaria, 5 pizzarias, 10 pizzarias, 20 pizzarias e assim por diante a toda a rede gradualmente. Naquela √©poca, precis√°vamos agir de forma mais decisiva. N√£o tivemos tempo - √†s 17h, um novo pico come√ßou. N√≥s simplesmente n√£o conseguimos deixar de peg√°-lo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por volta das 15:00, a atualiza√ß√£o foi lan√ßada para metade da rede (s√£o cerca de 200 pizzarias). √Äs 15:30, garantimos que tudo estava funcionando bem e ativamos toda a rede. Os recursos de altern√¢ncia, implanta√ß√µes r√°pidas, regress√£o dividida em partes e API fixa ajudaram a fazer tudo isso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O restante da equipe lidou com diferentes op√ß√µes de otimiza√ß√£o ao criar um pedido. O novo esquema n√£o era inteiramente novo, ainda usava a parte legada. Salvar endere√ßos, aplicar c√≥digos promocionais, gerar n√∫meros de pedidos - essas pe√ßas foram e permaneceram comuns. Sua otimiza√ß√£o foi reduzida para reescrever as consultas SQL, ou para se livrar delas no c√≥digo, ou para otimizar suas chamadas. Algo ocorreu no modo ass√≠ncrono, algo, como se viu, foi chamado v√°rias vezes em vez de uma.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A equipe de infraestrutura estava comprometida em alocar parte dos componentes para separar inst√¢ncias simplesmente para n√£o atravessar a carga. </font><font style="vertical-align: inherit;">Nosso principal componente de problema foi a fachada do Legacy, que foi para a base do Legacy. </font><font style="vertical-align: inherit;">Todo o trabalho foi dedicado a ele, incluindo a divis√£o de inst√¢ncias.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organize o processo</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De manh√£, tivemos a √∫nica sincroniza√ß√£o do dia, dividimos as equipes e sa√≠mos para trabalhar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No in√≠cio, mantivemos todo o log de altera√ß√µes e tarefas diretamente no Slack, porque no in√≠cio n√£o havia muitas tarefas. Mas o n√∫mero deles estava crescendo, ent√£o mudamos rapidamente para o Trello. A integra√ß√£o configurada entre Slack e Trello notificou qualquer altera√ß√£o de status no quebra-cabe√ßa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, era importante para n√≥s ver todo o registro de altera√ß√µes na produ√ß√£o. A vers√£o eletr√¥nica estava no Trello, a vers√£o de backup estava na placa de infraestrutura na forma de cart√µes. Caso algo desse errado, precis√°vamos descobrir rapidamente quais mudan√ßas reverteriam. A regress√£o completa foi apenas para o esquema com uma nova ordem; o restante das altera√ß√µes foi testado com mais lealdade.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As tarefas voavam para a produ√ß√£o na velocidade de bala. No total, atualizamos o sistema 15 vezes naquele dia. Os caras foram implantados em bancas de teste, uma por equipe. Desenvolvimento, verifica√ß√£o r√°pida, implanta√ß√£o na produ√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m do processo principal de CTO, Sasha Andronov constantemente se deparava com equipes com a pergunta "Como ajudar?". Isso ajudou a redistribuir esfor√ßos e a n√£o perder tempo com o fato de algu√©m n√£o ter pensado em pedir ajuda. Gerenciamento de desenvolvimento semi-manual, um m√≠nimo de distra√ß√µes e trabalho at√© o limite. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois daquele dia, foi necess√°rio sair com a sensa√ß√£o de que fizemos tudo o que pod√≠amos. E ainda mais. E n√≥s conseguimos! √Äs 15:30, um novo esquema para receber um pedido foi implementado para um aplicativo m√≥vel em toda a rede. Modo Hackathon, menos de 20 implanta√ß√µes por produ√ß√£o por dia!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A noite de 22 de abril foi calma e clara. </font><font style="vertical-align: inherit;">Nem cai, nem uma √∫nica dica √© que o sistema possa estar com defeito. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por volta das 22h, nos reunimos novamente e delineamos um plano de a√ß√£o semanal. </font><font style="vertical-align: inherit;">Limita√ß√£o, testes de desempenho, ordem ass√≠ncrona e muito mais. </font><font style="vertical-align: inherit;">Foi um longo dia, e havia longas semanas pela frente.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Renascimento</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A semana de 23 de abril foi infernal. </font><font style="vertical-align: inherit;">Depois disso, dissemos a n√≥s mesmos que t√≠nhamos feito o nosso melhor 200% e feito tudo o que pod√≠amos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tivemos que salvar o Dodo IS e decidimos aplicar alguma analogia m√©dica. </font><font style="vertical-align: inherit;">Em geral, este √© o primeiro caso real de usar uma met√°fora (como no XP original), o que realmente ajudou a entender o que estava acontecendo:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reanima√ß√£o - quando voc√™ precisa salvar um paciente que est√° morrendo. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tratamento - quando h√° sintomas, mas o paciente ainda est√° vivo.</font></font></li>
</ul><br>
<br>
<img src="https://habrastorage.org/webt/1a/jm/_r/1ajm_re5g-xgtcik_ykvtdlewmu.jpeg"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reanima√ß√£o</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O primeiro est√°gio da ressuscita√ß√£o √© o runbook padr√£o para restaurar o sistema em caso de falha, de acordo com alguns par√¢metros. </font><font style="vertical-align: inherit;">Uma coisa caiu - n√≥s estamos fazendo isso, que uma caiu - n√≥s estamos fazendo isso e assim por diante. </font><font style="vertical-align: inherit;">No caso de uma falha, encontramos rapidamente o runbook desejado, todos eles est√£o no GitHub e s√£o estruturados por problemas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo est√°gio da ressuscita√ß√£o √© a limita√ß√£o das ordens. </font><font style="vertical-align: inherit;">Adotamos essa pr√°tica em nossas pr√≥prias pizzarias. </font><font style="vertical-align: inherit;">Quando muitos pedidos s√£o descartados na pizzaria e eles entendem que n√£o podem cozinh√°-los rapidamente, eles ficam parados por 5 minutos. Apenas para limpar a linha do pedido. </font><font style="vertical-align: inherit;">Criamos um esquema semelhante para o Dodo IS. </font><font style="vertical-align: inherit;">Decidimos que, se ficar muito ruim, ativaremos o limite geral e informaremos aos clientes, por exemplo, pessoal, 5 minutos e faremos seu pedido. </font><font style="vertical-align: inherit;">Desenvolvemos essa medida apenas por precau√ß√£o, mas, como resultado, nunca a usamos. </font><font style="vertical-align: inherit;">Nao √© √∫til. </font><font style="vertical-align: inherit;">E agrad√°vel.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tratamento</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para iniciar o tratamento, √© necess√°rio fazer um diagn√≥stico, por isso nos concentramos em testes de desempenho. Parte da equipe foi coletar um perfil de carga real da produ√ß√£o usando o GoReplay, parte da equipe focada em testes sint√©ticos no palco. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os testes sint√©ticos n√£o refletiram o perfil de carga real, mas deram margem para melhorias, mostraram algumas fraquezas no sistema. Por exemplo, pouco antes disso, est√°vamos movendo o conector do MySQL da Oracle </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para um novo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Na vers√£o do conector, houve um erro nas sess√µes de pool, o que levou ao fato de que os servidores simplesmente subiram ao limite da CPU e pararam de atender √†s solicita√ß√µes. Reproduzimos isso com testes de est√°gio, concebidos e silenciosamente entramos em produ√ß√£o. Havia uma d√∫zia desses casos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao diagnosticar e identificar as causas dos problemas, eles s√£o corrigidos no sentido hor√°rio. </font><font style="vertical-align: inherit;">Compreendemos ainda que nosso caminho ideal √© a recep√ß√£o ass√≠ncrona de um pedido. </font><font style="vertical-align: inherit;">Come√ßamos a trabalhar na introdu√ß√£o em um aplicativo m√≥vel.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inferno semanas: organiza√ß√£o do processo</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma equipe de 40 pessoas trabalhou em um √∫nico grande objetivo - a estabiliza√ß√£o do sistema. Todas as equipes trabalharam juntas. N√£o sabe o que fazer? Ajude outras equipes. O foco em objetivos espec√≠ficos ajudou a n√£o ser borrifado e a n√£o se envolver em bobagens desnecess√°rias para n√≥s. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zu/3e/ik/zu3eikvdviql0uyvqabv3w18axi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tr√™s vezes por dia havia sincroniza√ß√£o, uma posi√ß√£o comum, como em um scrum cl√°ssico. Para 40 pessoas. Somente duas vezes em tr√™s semanas (por quase 90 sincroniza√ß√µes) n√£o encontramos 30 minutos. A sincroniza√ß√£o mais longa durou 57 minutos. Embora geralmente levassem 20 a 30 minutos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O objetivo das sincroniza√ß√µes: entender onde a ajuda √© necess√°ria e quando levaremos essas ou essas tarefas √† produ√ß√£o. Os caras unidos nas equipes de projeto, se precisavam da ajuda de infraestrutura, uma pessoa veio ali, todos os problemas foram resolvidos rapidamente, menos discuss√£o era mais um problema.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä noite, para apoiar os caras, nosso laborat√≥rio de P&amp;D preparava comida para os desenvolvedores √† noite. Receitas de pizza loucas, asas de frango, batatas! Isso foi irreal, legal! Esse apoio motivou os caras o m√°ximo poss√≠vel. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ms/pz/3f/mspz3f9matohgpx7z9sk9bf8pzu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trabalhar nesse modo ininterrupto foi muito dif√≠cil. Na quarta-feira, 25 de abril, por volta das 17 horas, Oleg Blokhin, um de nossos desenvolvedores, abordou o CTO, que esteve no s√°bado sem parar. Havia fadiga desumana em seus olhos: "Fui para casa, n√£o aguento mais". Ele dormiu bem e no dia seguinte foi caloroso. Ent√£o voc√™ pode descrever a condi√ß√£o geral de muitos caras.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No s√°bado seguinte, 28 de abril (era um s√°bado √∫til para todos na R√∫ssia), estava mais calmo. </font><font style="vertical-align: inherit;">N√£o pod√≠amos mudar nada, vimos o sistema, os caras descansaram um pouco do ritmo. </font><font style="vertical-align: inherit;">Tudo correu silenciosamente. </font><font style="vertical-align: inherit;">A carga n√£o era t√£o grande, mas era. </font><font style="vertical-align: inherit;">Eles sobreviveram sem problemas, e isso deu confian√ßa de que est√°vamos seguindo o caminho certo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A segunda e terceira semanas ap√≥s a queda j√° estavam em um modo mais calmo, o ritmo infernal at√© o final da noite se foi, mas o processo geral da lei marcial permaneceu.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dia seguinte X: Teste de for√ßa</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No dia seguinte, X foi no dia 9 de maio! </font><font style="vertical-align: inherit;">Algu√©m estava sentado em casa e monitorando o status do sistema. </font><font style="vertical-align: inherit;">Aqueles de n√≥s que foram passear levaram laptops para estarem totalmente armados se algo desse errado. </font><font style="vertical-align: inherit;">Sasha Andronov, nossa esta√ß√£o de servi√ßo, aproximou-se do pico da noite de uma das pizzarias para ver tudo pessoalmente em caso de problemas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Naquele dia, recebemos 91500 pedidos na R√∫ssia (na √©poca, o segundo resultado na hist√≥ria do Dodo). </font><font style="vertical-align: inherit;">N√£o havia sequer a menor sugest√£o de problema. </font><font style="vertical-align: inherit;">9 de maio confirmou que estamos no caminho certo! </font><font style="vertical-align: inherit;">Concentre-se em estabilidade, desempenho, qualidade. </font><font style="vertical-align: inherit;">A reestrutura√ß√£o do processo nos aguardava ainda mais, mas essa √© uma hist√≥ria completamente diferente.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grande outono retr√¥ e 6 pr√°ticas</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em situa√ß√µes cr√≠ticas, s√£o desenvolvidas boas pr√°ticas que podem e devem ser transferidas para um momento silencioso. Foco, ajuda entre equipes, r√°pida implanta√ß√£o na produ√ß√£o sem esperar por uma regress√£o completa. Come√ßamos com retro e, em seguida, desenvolvemos a estrutura do processo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wp/md/ty/wpmdtygdhvy93ufctatnfmxypms.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os dois primeiros dias se passaram em uma discuss√£o de pr√°ticas. N√£o estabelecemos o objetivo de "colocar uma retrospectiva √†s duas horas". Ap√≥s essa situa√ß√£o, est√°vamos prontos para dedicar algum tempo para elaborar nossas id√©ias e nosso novo processo em detalhes. Todos participaram. Todos os envolvidos na restaura√ß√£o trabalham de uma maneira ou de outra. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qf/52/qu/qf52qu_y6lojoqjjcxw3lrronny.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, havia seis pr√°ticas importantes sobre as quais gostaria de falar com mais detalhes.</font></font><br>
<br>
<ol>
<li><b>Top N .</b>   ,  .      Product Owners ,  ,     ,         .    .      ,   .        ,  ,  ,   .   ,         .   N         ‚Äì  Lead Time    . </li>
<li><b> .</b>    .     -,      ,        .         ,        ,  ,     .   . </li>
<li><b> .</b>    ,   ¬´    ¬ª    . ,        . ,     ,     .  ,         -   .       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">       Dodo IS.</a>         .</li>
<li><b> Pull Request.</b>      ,     Pull Request,      -   .    .   ,   ,   ,   ,  -   .            , . ,  .  15          .</li>
<li><b>Performance- ‚Äî  .</b>  performance-     .   ,   . Performance-    .   baseline   ,    PR   .       ,   . </li>
<li><b>Performance     .</b>     ‚Äî      .  , , -,  , ,       .         .        ,    . </li>
</ol><br>
<br>
<h2></h2><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">1.    </b>
                        <div class="spoiler_text"><h4><b>21.04.2018 ‚Äì    Dodo IS.     ? </b></h4><br>
<img src="https://habrastorage.org/webt/4l/3r/6-/4l3r6-lc2cgut1u8ec3gdawjdma.png" align="left" width="60"> <u><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> (Site Reliability Engineering)</b></u>:      .  ,    . <br>
<br>
<img src="https://habrastorage.org/webt/lj/ov/je/ljovjerpqe5mx5j5w9nsxer5xxq.png" align="right" width="60"> <u><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> (Site Reliability Engineering, Product Owner   Dodo IS)</b></u>:      . ,    ,   . <br>
<br>
     auth‚Äô,       .         .      ,        . <br>
<br>
   ,    ()   :<br>
<br>
<img src="https://habrastorage.org/webt/_h/qh/yy/_hqhyy80kusheiqap3xwfchwjvk.jpeg"><br>
<br>
        .     ,    . <br>
<br>
      .       ,      .       .     -.  ,         ,      . -  ,  ,    .     ,        -,    ,    . <br>
<br>
         .           redis,      .    .      - ,   .       .<br>
<br>
     Dodo IS   .        .      ,     . ,        , , ,   .     ,      ‚Äî     . <br>
<br>
     .                ¬´ ¬ª.  ¬´  ,   ¬ª    . <br>
<br>
<h4><b> -   ?</b></h4><br>
<img src="https://habrastorage.org/webt/4l/3r/6-/4l3r6-lc2cgut1u8ec3gdawjdma.png" align="left" width="60"> <u><b> </b></u>:<br>
<br>
   ‚Äì    .       .         . ,             .      .   .<br>
<br>
<img src="https://habrastorage.org/webt/lj/ov/je/ljovjerpqe5mx5j5w9nsxer5xxq.png" align="right" width="60"> <u><b> </b></u>:<br>
<br>
     .     ,       .   (  ), -       .   .<br>
<br>
       .  :<br>
<br>
<ol>
<li>      .</li>
<li>     .</li>
<li>       ,     . </li>
</ol><br>
<h4><b>      ?</b></h4><br>
<br>
<img src="https://habrastorage.org/webt/4l/3r/6-/4l3r6-lc2cgut1u8ec3gdawjdma.png" align="left" width="60"> <u><b> </b></u>:<br>
<br>
,        ,  ,      .<br>
<br>
<img src="https://habrastorage.org/webt/lj/ov/je/ljovjerpqe5mx5j5w9nsxer5xxq.png" align="right" width="60"> <u><b> </b></u>:<br>
<br>
 ,            ,    .     ,     .<br>
<br>
<h4><b>    ?               ?</b></h4><br>
<br>
<img src="https://habrastorage.org/webt/4l/3r/6-/4l3r6-lc2cgut1u8ec3gdawjdma.png" align="left" width="60"> <u><b> </b></u>:  ,      ‚Äì  . <br>
<br>
<img src="https://habrastorage.org/webt/lj/ov/je/ljovjerpqe5mx5j5w9nsxer5xxq.png" align="right" width="60"> <u><b> </b></u>:<br>
<br>
<ol>
<li> ‚Äî     . -     -   . <br>
<br>
          ,       .  2018       ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PerformanceLab</a>,      .</li>
<li>     ,          .      Less-. </li>
<li>         .   2018         -,     .      ,    .    - 2018   .</li>
<li>  async  . ,   21.04.2018     .    ,     .     async. </li>
<li> . ,    SaveOrder  async-await.   ,     .      :          ,       LF,         20   .       ,       .  ,         .    !<br>
<br>
    ,   ,           ,     . <br>
<br>
         ,    ,  .          ‚Äî -.       . </li>
<li>     .         ,   (, ).      ,        .  ¬´¬ª    .   nginx   ,    -  ,       . <br>
<br>
    : innodb_lock_wait_timeout = 5; innodb_rollback_on_timeout = ON.         .   ,     ,       ,    ,       . </li>
</ol><br>
<h4><b>   ,       ?</b></h4><br>
<img src="https://habrastorage.org/webt/4l/3r/6-/4l3r6-lc2cgut1u8ec3gdawjdma.png" align="left" width="60"> <u><b> </b></u>:<br>
<br>
<ol>
<li>   ,   ,     ,   .   ,     .</li>
<li>    ,     .</li>
<li>      ,   ,    ,    .         ‚Äì    .</li>
</ol><br>
<img src="https://habrastorage.org/webt/lj/ov/je/ljovjerpqe5mx5j5w9nsxer5xxq.png" align="right" width="60"> <u><b> </b></u>:<br>
<br>
<ol>
<li>   .</li>
<li>    .        , ,    -.          .</li>
<li>    .   ,   -    ,    .</li>
</ol><br>
<h4><b>   ,       ?</b></h4><br>
<img src="https://habrastorage.org/webt/4l/3r/6-/4l3r6-lc2cgut1u8ec3gdawjdma.png" align="left" width="60"> <u><b> </b></u>:<br>
<br>
  ¬´¬ª   ,   ¬´¬ª. ,      ,     .    . <br>
<br>
<img src="https://habrastorage.org/webt/lj/ov/je/ljovjerpqe5mx5j5w9nsxer5xxq.png" align="right" width="80"> <u><b> </b></u>:<br>
<br>
  ,      .   , ,     .     .<br>
</div>
                    </div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">2. ,        (Dodo IS Architect)</b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/ge/pg/qm/gepgqmcioq9qqndtdk9dbz8njjo.png" align="left" width="60">              ‚Äî ,     .       ,      ‚Äî             . <br>
<br>
        ,        ,           . ,         (, ,    )        .<br>
<br>
        IT-.       Dodo IS,         .              ‚Ä¶<br>
<br>
 X ,  .      . Dodo IS  ,         ,   ,        .      ,  , ,    .    .     146%,     .     ,    Dodo IS  ?<br>
<br>
    ,  .    ,    ,         .                  ,       .       ,      !<br>
<br>
     ,   .   ¬´ ¬ª: 11-  ,  ,  2 .  ¬´¬ª       .  3-4     ,          .          ,     .   .<br>
<br>
  , ,            .         . Dodo IS     ,   ¬´ ¬ª.     ! (    ). <br>
<br>
     ,     Dodo IS      ,      .   Dodo IS .       ¬´ ¬ª, ,    .             (   ),         loadtest,   ,   .<br>
</div>
                    </div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt498268/index.html">API Mosbirge gr√°tis nas f√≥rmulas do Microsoft Excel</a></li>
<li><a href="../pt498270/index.html">Quais profissionais de TI s√£o contratados durante a crise econ√¥mica e a pandemia?</a></li>
<li><a href="../pt498272/index.html">Economize tempo e esfor√ßo na implementa√ß√£o de padr√µes de desenvolvimento seguros com o OWASP SAMM</a></li>
<li><a href="../pt498276/index.html">Campeonato de Programa√ß√£o Esportiva Online RuCode</a></li>
<li><a href="../pt498278/index.html">Editora Peter. Venda de primavera</a></li>
<li><a href="../pt498282/index.html">[instru√ß√£o] Criando uma conta e um site na plataforma Google Site</a></li>
<li><a href="../pt498284/index.html">Como otimizar o aprendizado de ingl√™s</a></li>
<li><a href="../pt498288/index.html">Sua cidade precisa de um √¥nibus de metr√¥</a></li>
<li><a href="../pt498290/index.html">Hidrologia processual: simula√ß√£o din√¢mica de rios e lagos</a></li>
<li><a href="../pt498292/index.html">Economize muito dinheiro em grandes volumes no PostgreSQL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>