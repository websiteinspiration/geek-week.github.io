<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¥Š ğŸ“ ğŸ§— Karat. Meminjam pemeriksa melalui iterator ğŸ‘‰ğŸ» ğŸ‘©ğŸ¿â€ğŸ¤ ğŸ‘¨ğŸ»â€ğŸŒ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! 
 
 Saya telah belajar selama sekitar satu tahun dan, di waktu luang saya, saya menulis di masa lalu. Saya suka bagaimana penulisnya memec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Karat. Meminjam pemeriksa melalui iterator</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499108/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo, Habr! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya telah belajar selama sekitar satu tahun dan, di waktu luang saya, saya menulis di masa lalu. </font><font style="vertical-align: inherit;">Saya suka bagaimana penulisnya memecahkan masalah manajemen memori dan membuang pengumpul sampah - melalui konsep pinjaman. </font><font style="vertical-align: inherit;">Pada artikel ini saya akan mendekati ide ini melalui iterator. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akhir-akhir ini, scala adalah bahasa utama saya, jadi akan ada perbandingan dengan itu, tetapi tidak banyak dari mereka dan semuanya intuitif, tanpa sihir :) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artikel ini dirancang untuk mereka yang mendengar sesuatu tentang karat, tetapi tidak masuk ke rincian. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lu/ju/o1/lujuo1lkziqqcu6fpfxiuuuaquy.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
foto diambil </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dari sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dari sini</font></font></a><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kata pengantar</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam bahasa jvm, biasanya untuk menyembunyikan pekerjaan dengan tautan, yaitu, di sana kami hampir selalu bekerja dengan tipe data referensi, jadi kami memutuskan untuk menyembunyikan ampersand (&amp;). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam rasta terdapat tautan eksplisit, misalnya ke integer - `&amp; i32`, tautan tersebut dapat ditinjau ulang melalui` *`, juga ada tautan ke tautan tersebut dan kemudian perlu ditinjau ulang dua kali **.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iterator</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat menulis kode, sangat sering Anda perlu memfilter koleksi berdasarkan kondisi (predikat). </font><font style="vertical-align: inherit;">Di batu untuk mengambil elemen genap akan terlihat seperti ini:</font></font><br>
<br>
<pre><code class="scala hljs">    <span class="hljs-keyword">val</span> vec = <span class="hljs-type">Vector</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>)
    <span class="hljs-keyword">val</span> result = vec.filter(e =&gt; e % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita lihat jenisnya:</font></font><br>
<br>
<pre><code class="scala hljs">  <span class="hljs-keyword">private</span>[scala] <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">filterImpl</span></span>(p: <span class="hljs-type">A</span> =&gt; <span class="hljs-type">Boolean</span>, isFlipped: <span class="hljs-type">Boolean</span>): <span class="hljs-type">Repr</span> = {
    <span class="hljs-keyword">val</span> b = newBuilder
    <span class="hljs-keyword">for</span> (x &lt;- <span class="hljs-keyword">this</span>)
      <span class="hljs-keyword">if</span> (p(x) != isFlipped) b += x<font></font>
<font></font>
    b.result<font></font>
  }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tanpa masuk ke perincian `newBuilder`, jelaslah bahwa koleksi baru sedang dibuat, kami beralih ke yang lama dan jika predikat mengembalikan true, lalu tambahkan elemen. </font><font style="vertical-align: inherit;">Terlepas dari kenyataan bahwa koleksinya baru, unsur-unsurnya sebenarnya terkait dengan unsur-unsur dari koleksi pertama, dan jika, tiba-tiba, unsur-unsur ini dapat berubah, maka mengubahnya akan menjadi hal yang biasa di kedua koleksi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang mari kita coba melakukan hal yang sama di masa lalu. </font><font style="vertical-align: inherit;">Saya akan segera memberikan contoh kerja, dan kemudian saya akan mempertimbangkan perbedaannya.</font></font><br>
<br>
<pre><code class="rust hljs">    <span class="hljs-keyword">let</span> v: <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">i32</span>&gt; = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];
    <span class="hljs-keyword">let</span> result: <span class="hljs-built_in">Vec</span>&lt;&amp;<span class="hljs-built_in">i32</span>&gt; = v.iter().filter(|e| **e % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>).collect();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wow, wow apa? </font><font style="vertical-align: inherit;">Dereferensi pointer ganda? </font><font style="vertical-align: inherit;">Hanya untuk menyaring vektor? </font><font style="vertical-align: inherit;">Sulit :( Tapi ada alasan untuk ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita </font><font style="vertical-align: inherit;">cari </font><font style="vertical-align: inherit;">tahu bagaimana kode ini berbeda dari rock:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> secara eksplisit mendapatkan iterator pada vektor (`iter ()`) </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dalam fungsi predikat, untuk beberapa alasan, kami melakukan dereferensi pointer dua kali </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> panggil `collect ()` </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> itu juga menghasilkan vektor jenis referensi Vec &lt;&amp; i32&gt;, dan bukan ints biasa </font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pemeriksa pinjaman</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mengapa memanggil secara eksplisit `iter ()` di koleksi? </font><font style="vertical-align: inherit;">Jelas bagi rockman manapun bahwa jika Anda memanggil `.filter (...)` maka Anda perlu mengulangi koleksi tersebut. </font><font style="vertical-align: inherit;">Mengapa dalam suatu masa secara eksplisit menulis apa yang dapat dilakukan secara implisit? </font><font style="vertical-align: inherit;">Karena ada </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tiga</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> iterator berbeda! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6t/vw/-m/6tvw-mzsdc6ce1caxkzl-custrw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mencari tahu mengapa tiga? </font><font style="vertical-align: inherit;">perlu menyentuh </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peminjam </font></font></b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(pinjam, pinjam) </font></font></i> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pemeriksa</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'a. </font><font style="vertical-align: inherit;">Hal yang paling penting dimana rast bekerja tanpa GC dan tanpa alokasi / deallokasi memori eksplisit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mengapa itu dibutuhkan?</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk menghindari situasi ketika beberapa petunjuk menunjuk ke area memori yang sama, memungkinkan Anda untuk mengubahnya. </font><font style="vertical-align: inherit;">Itu adalah kondisi lomba.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agar tidak membatalkan memori yang sama beberapa kali.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagaimana ini dicapai? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena konsep kepemilikan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara umum, konsep kepemilikan itu sederhana - hanya satu yang bisa memiliki sesuatu (bahkan intuisi). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pemilik dapat berubah, tetapi dia selalu sendirian. Ketika kita menulis `let x: i32 = 25`, ini berarti bahwa ada alokasi memori untuk int 32bit dan pemilik tertentu` x` memilikinya. Gagasan kepemilikan hanya ada dalam pikiran penyusun, di pemeriksa pinjaman. Ketika pemilik, dalam hal ini, `x` meninggalkan ruang lingkup (keluar dari ruang lingkup), memori yang dimilikinya akan dihapus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut adalah kode yang tidak akan dilewatkan oleh pemeriksa pinjaman:</font></font><br>
<br>
<pre><code class="rust hljs">
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">X</span></span>; <span class="hljs-comment">// </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">test_borrow_checker</span> </span>() -&gt; X {
    <span class="hljs-keyword">let</span> first = X; <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">let</span> second = first; <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">let</span> third = first; <span class="hljs-comment">//   ,   first   </span>
<span class="hljs-comment">//    value used here after move</span><font></font>
<font></font>
    <span class="hljs-keyword">return</span> third;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
`struct X` adalah sesuatu seperti` case kelas X () `- struktur tanpa batas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perilaku ini sangat berlawanan dengan intuisi, saya pikir, untuk semua orang. </font><font style="vertical-align: inherit;">Saya tidak tahu bahasa lain di mana tidak mungkin untuk "menggunakan" "variabel" yang sama dua kali. </font><font style="vertical-align: inherit;">Penting untuk merasakan momen ini. </font><font style="vertical-align: inherit;">pertama sama sekali bukan referensi ke X, itu adalah </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pemiliknya</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mengubah pemilik, kami jenis membunuh yang sebelumnya, pemeriksa pinjaman tidak akan mengizinkan penggunaannya.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengapa Anda perlu membuat struktur sendiri, mengapa tidak menggunakan integer biasa?</font></font></b>
                        <div class="spoiler_text">    â€”       (`struct X`),  , ,   integer.   ,     ,     :<br>
<br>
<pre><code class="rust hljs">
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">test_borrow_checker</span> </span>() -&gt; <span class="hljs-built_in">i32</span> {
    <span class="hljs-keyword">let</span> first = <span class="hljs-number">32</span>;
    <span class="hljs-keyword">let</span> second = first; 
    <span class="hljs-keyword">let</span> third = first; <font></font>
<font></font>
    <span class="hljs-keyword">return</span> third;<font></font>
}<font></font>
</code></pre><br>
  ,   borrow checker,            ,   .     Copy,      .      `i32` second     ,   (   ), -  third   .   X     Copy,      .<br>
<br>
     .   ,              ,      Â«Â»            .        Clone,    ,     .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">copy</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">clone</a>.<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kembali ke iterators. </font><font style="vertical-align: inherit;">Konsep "capture" di antara mereka adalah </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IntoIter</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dia â€œmenelanâ€ koleksi itu, memberikan kepemilikan atas elemen-elemennya. </font><font style="vertical-align: inherit;">Dalam kode, ide ini akan tercermin seperti ini:</font></font><br>
<br>
<pre><code class="rust hljs">
<span class="hljs-keyword">let</span> coll_1 = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>];
<span class="hljs-keyword">let</span> coll_2: <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">i32</span>&gt; = coll_1.into_iter().collect();
<span class="hljs-comment">//coll_1 doesn't exists anymore</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan memanggil `into_iter ()` di coll_1 kami "mengubahnya" menjadi iterator, menyerap semua elemennya, seperti dalam contoh sebelumnya, `second` absorbed` first`. </font><font style="vertical-align: inherit;">Setelah itu, semua panggilan ke coll_1 akan dihukum oleh pemeriksa pinjaman selama kompilasi. </font><font style="vertical-align: inherit;">Kemudian kami mengumpulkan elemen-elemen ini dengan fungsi `collect`, membuat vektor baru. </font><font style="vertical-align: inherit;">Fungsi `collect` diperlukan untuk mengumpulkan koleksi dari iterator, untuk ini Anda harus secara eksplisit menentukan jenis apa yang ingin kami kumpulkan. </font><font style="vertical-align: inherit;">Oleh karena itu, coll_2 dengan jelas menunjukkan jenisnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oke, secara umum, yang dijelaskan di atas sudah cukup untuk bahasa pemrograman, tetapi tidak akan sangat efisien untuk menyalin / mengkloning struktur data setiap kali kami ingin mentransfernya, dan Anda juga harus dapat mengubah sesuatu. </font><font style="vertical-align: inherit;">Jadi kita pergi ke petunjuk.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pointer</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pemiliknya, seperti yang sudah kami ketahui, hanya bisa satu. </font><font style="vertical-align: inherit;">Tetapi Anda dapat memiliki sejumlah tautan.</font></font><br>
<br>
<pre><code class="rust hljs">
<span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Y</span></span>; <span class="hljs-comment">// </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">test_borrow_checker</span></span>() -&gt; Y {
    <span class="hljs-keyword">let</span> first = Y; <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">let</span> second: &amp;Y = &amp;first; <span class="hljs-comment">//   ,     </span>
    <span class="hljs-keyword">let</span> third = &amp;first; <span class="hljs-comment">//    </span><font></font>
<font></font>
<span class="hljs-comment">// </span>
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{:?}"</span>, second);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{:?}"</span>, third);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> first;<font></font>
}<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode ini sudah valid, karena pemiliknya masih satu. Semua logika kepemilikan diperiksa hanya pada tahap kompilasi, tanpa memengaruhi alokasi / pemindahan memori. Selain itu, Anda dapat melihat bahwa jenis detik telah berubah menjadi `&amp; Y`! Artinya, semantik kepemilikan dan tautan tercermin dalam jenisnya, yang memungkinkan Anda memeriksa selama kompilasi, misalnya, tidak adanya kondisi balapan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagaimana saya bisa melindungi dari kondisi balapan pada waktu kompilasi? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan menetapkan batas jumlah tautan yang bisa berubah-ubah! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tautan yang dapat berubah pada satu saat dapat menjadi satu dan hanya satu (tanpa berubah). Yaitu, salah satu / beberapa tidak berubah, atau satu bisa berubah. Kode ini terlihat seperti ini:</font></font><br>
<br>
<pre><code class="rust hljs">
<span class="hljs-comment">// </span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">X</span></span> {<font></font>
    x: <span class="hljs-built_in">i32</span>,<font></font>
} <font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">test_borrow_checker</span></span>() -&gt; X {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> first = X { x: <span class="hljs-number">20</span> }; <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">let</span> second: &amp;<span class="hljs-keyword">mut</span> X = &amp;<span class="hljs-keyword">mut</span> first; <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">let</span> third: &amp;<span class="hljs-keyword">mut</span> X = &amp;<span class="hljs-keyword">mut</span> first; <span class="hljs-comment">//    .        `second`        - .</span>
<span class="hljs-comment">//    second.x = 33;  //    ,             ,    </span>
    third.x = <span class="hljs-number">33</span>;<font></font>
<font></font>
    <span class="hljs-keyword">return</span> first;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita membahas perubahan dalam contoh relatif sebelumnya. Pertama, kami menambahkan satu bidang ke struktur sehingga ada sesuatu yang berubah, karena kami membutuhkan kemampuan berubah-ubah. Kedua, `mut` muncul dalam deklarasi variabel` let mut first = ...`, ini adalah penanda kompilator tentang mutabilitas, seperti `val` &amp;` var` di dalam rock. Ketiga, semua tautan telah mengubah tipenya dari `&amp; X` ke` &amp; mut X` (sepertinya, tentu saja, mengerikan. Dan ini tanpa masa pakai ...), sekarang kita dapat mengubah nilai yang disimpan oleh tautan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi saya mengatakan bahwa kita tidak dapat membuat beberapa tautan yang dapat berubah, mereka mengatakan peminjam tidak akan memberikan ini, tetapi saya membuat dua tautan sendiri! Ya, tetapi pemeriksaan di sana sangat rumit, itulah sebabnya terkadang tidak jelas mengapa kompiler bersumpah. Dia berusaha keras untuk memastikan bahwa program Anda dikompilasi dan jika sama sekali tidak ada opsi untuk memenuhi aturan, maka kesalahan, dan mungkin bukan yang Anda tunggu, tetapi yang melanggar upaya terakhirnya, yang paling putus asa dan tidak jelas bagi pemula: ) Sebagai contoh, Anda diberitahu bahwa struktur tidak menerapkan sifat Salin, meskipun Anda tidak menyebut salinan apa pun di mana pun. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam hal ini, keberadaan dua tautan yang dapat berubah diizinkan pada saat yang sama karena kami hanya menggunakan satu, yaitu, yang kedua dapat dibuang dan tidak ada yang akan berubah. Juga `detik` dapat digunakan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hingga</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buat `third` dan kemudian semuanya akan baik-baik saja. </font><font style="vertical-align: inherit;">Tetapi, jika Anda membatalkan komentar `second.x = 33;`, ternyata dua tautan yang bisa berubah ada secara bersamaan dan Anda tidak dapat keluar dari sini - kompilasi kesalahan waktu.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iterator</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, kami memiliki tiga jenis transmisi:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penyerapan, peminjaman, pemindahan</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tautan</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tautan yang dapat diubah</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap jenis membutuhkan iterator sendiri.</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IntoIter</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menyerap objek dari koleksi asli</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iter</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> berjalan pada tautan objek</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IterMut</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> berjalan pada referensi objek yang bisa diubah</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muncul pertanyaan - kapan harus menggunakan yang mana. </font><font style="vertical-align: inherit;">Tidak ada peluru perak - Anda perlu latihan, membaca kode orang lain, artikel. </font><font style="vertical-align: inherit;">Saya akan memberikan contoh yang menunjukkan ide tersebut. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Misalkan ada sekolah, ada kelas di dalamnya, dan siswa di kelas.</font></font><br>
<br>
<pre><code class="rust hljs">
<span class="hljs-meta">#[derive(PartialEq, Eq)]</span>
<span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Sex</span></span> {<font></font>
    Male,<font></font>
    Female<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Scholar</span></span> {<font></font>
    name: <span class="hljs-built_in">String</span>,<font></font>
    age: <span class="hljs-built_in">i32</span>,<font></font>
    sex: Sex<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">let</span> scholars: <span class="hljs-built_in">Vec</span>&lt;Scholar&gt; = ...;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami mengambil vektor anak sekolah dengan menanyakan database, misalnya. </font><font style="vertical-align: inherit;">Selanjutnya, saya perlu menghitung jumlah gadis di kelas. </font><font style="vertical-align: inherit;">Jika kita "menelan" vektor melalui `into_iter ()`, maka setelah menghitung kita tidak bisa lagi menggunakan koleksi ini untuk menghitung anak laki-laki:</font></font><br>
<br>
<pre><code class="rust hljs">
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">bad_idea</span></span>() {
    <span class="hljs-keyword">let</span> scholars: <span class="hljs-built_in">Vec</span>&lt;Scholar&gt; = <span class="hljs-built_in">Vec</span>::new();
    <span class="hljs-keyword">let</span> girls_c = scholars<font></font>
        .into_iter()<font></font>
        .filter(|s| (*s).sex == Sex::Female)<font></font>
        .count();<font></font>
<font></font>
    <span class="hljs-keyword">let</span> boys_c = scholars <font></font>
        .into_iter()<font></font>
        .filter(|s| (*s).sex == Sex::Male)<font></font>
        .count();<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akan ada kesalahan "nilai yang digunakan di sini setelah pindah" pada baris untuk menghitung anak laki-laki. </font><font style="vertical-align: inherit;">Juga jelas bahwa iterator yang dapat berubah tidak berguna bagi kita. </font><font style="vertical-align: inherit;">Itulah mengapa ini hanya `iter ()` dan bekerja dengan tautan ganda:</font></font><br>
<br>
<pre><code class="rust hljs">
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">good_idea</span></span>() {
    <span class="hljs-keyword">let</span> scholars: <span class="hljs-built_in">Vec</span>&lt;Scholar&gt; = <span class="hljs-built_in">Vec</span>::new();
    <span class="hljs-keyword">let</span> girls_c = scholars.iter().filter(|s| (**s).sex == Sex::Female).count();
    <span class="hljs-keyword">let</span> boys_c = scholars.iter().filter(|s| (**s).sex == Sex::Male).count();<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini, untuk meningkatkan jumlah calon potensial di negara ini, diperlukan iterator yang bisa berubah:</font></font><br>
<br>
<pre><code class="rust hljs">
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">very_good_idea</span></span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> scholars: <span class="hljs-built_in">Vec</span>&lt;Scholar&gt; = <span class="hljs-built_in">Vec</span>::new();<font></font>
    scholars.iter_mut().for_each(|s| (*s).sex = Sex::Male);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mengembangkan ide, kita dapat membuat tentara keluar dari "orang-orang" dan menunjukkan iterator "menyerap":</font></font><br>
<br>
<pre><code class="rust hljs">
<span class="hljs-keyword">impl</span> Scholar {
    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">to_soldier</span></span>(<span class="hljs-keyword">self</span>) -&gt; Soldier {<font></font>
        Soldier { forgotten_name: <span class="hljs-keyword">self</span>.name, number: some_random_number_generator() }<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Soldier</span></span> {<font></font>
    forgotten_name: <span class="hljs-built_in">String</span>,<font></font>
    number: <span class="hljs-built_in">i32</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">good_bright_future</span></span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> scholars: <span class="hljs-built_in">Vec</span>&lt;Scholar&gt; = <span class="hljs-built_in">Vec</span>::new();<font></font>
    scholars.iter_mut().for_each(|s| (*s).sex = Sex::Male);<font></font>
    <span class="hljs-keyword">let</span> soldiers: <span class="hljs-built_in">Vec</span>&lt;Soldier&gt; = scholars.into_iter().map(|s| s.to_soldier()).collect();
    <span class="hljs-comment">//   scholars,    </span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada catatan indah ini, mungkin itu saja. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertanyaan terakhir tetap - dari mana dereferencing ganda tautan di `filter` berasal. </font><font style="vertical-align: inherit;">Faktanya adalah bahwa predikat adalah fungsi yang mengambil referensi ke argumen (agar tidak menangkapnya):</font></font><br>
<br>
<pre><code class="rust hljs">
    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">filter</span></span>&lt;P&gt;(<span class="hljs-keyword">self</span>, predicate: P) -&gt; Filter&lt;<span class="hljs-keyword">Self</span>, P&gt; <span class="hljs-keyword">where</span>
        <span class="hljs-keyword">Self</span>: <span class="hljs-built_in">Sized</span>, P: <span class="hljs-built_in">FnMut</span>(&amp;Self::Item) -&gt; <span class="hljs-built_in">bool</span>,
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
predikatnya adalah FnMut (secara kasar berbicara fungsi), yang mengambil referensi ke item (mandiri) dan mengembalikan bool. </font><font style="vertical-align: inherit;">Karena kami sudah memiliki tautan dari iterator `.iter ()`, yang kedua muncul di filter. </font><font style="vertical-align: inherit;">Ketika diserap oleh iterator (`into_iter`), dereferencing ganda dari tautan berubah menjadi yang biasa.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kelanjutan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya tidak punya banyak pengalaman dalam menulis artikel, jadi saya akan senang mengkritik. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika tertarik, saya bisa melanjutkan. </font><font style="vertical-align: inherit;">Opsi untuk topik:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bagaimana dan kapan terjadi deallokasi memori </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tautan seumur hidup </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pemrograman asinkron </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menulis layanan web kecil, Anda bahkan dapat menawarkan api </font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tautan</font></font></h3><br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buku karat</font></font></a> </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Karena konsep kepemilikan, penerapan hal-hal dasar seperti, misalnya, daftar tertaut tidak lagi sepele. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Berikut adalah</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> beberapa cara bagaimana mengimplementasikannya.</font></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id499092/index.html">Model referensi BIAN. Apa yang baru dan berguna untuk arsitektur perusahaan bank yang ditawarkannya?</a></li>
<li><a href="../id499096/index.html">Logika fuzzy dalam gambar yang indah. Permukaan respons untuk berbagai fungsi keanggotaan</a></li>
<li><a href="../id499102/index.html">Kubernetes, Microservices, CI / CD dan Dockers untuk Retrogrades: Tips Belajar</a></li>
<li><a href="../id499104/index.html">IOT untuk luka Anda: mengapa Internet hal paling diterima di era coronavirus</a></li>
<li><a href="../id499106/index.html">HTML tingkat lanjut</a></li>
<li><a href="../id499110/index.html">Big Brother sedang berusaha untuk melayani yang baik. Bagaimana pengumpul data dan perusahaan program terlibat dalam perang melawan coronavirus</a></li>
<li><a href="../id499112/index.html">Sistem otorisasi sumber daya canggih di Laravel. Bagian 3. Atribut baca / tulis, model sendiri</a></li>
<li><a href="../id499114/index.html">Mengekspor Rencana Penomoran Badan Komunikasi Federal ke Database Relasional</a></li>
<li><a href="../id499118/index.html">Cara membuat video viral</a></li>
<li><a href="../id499120/index.html">[Bookmark] CSS: Menggunakan Indentasi dan Indentasi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>