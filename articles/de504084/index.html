<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥩 🚩 👩🏼‍🏭 Entdecken Sie den iOS-Fehler mit Hopper 👨🏿‍🤝‍👨🏾 🛑 🌅</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo! Mein Name ist Alexander Nikishin, ich entwickle iOS-Anwendungen bei Badoo. In dem Artikel werde ich darüber sprechen, wie wir einen Fehler in U...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Entdecken Sie den iOS-Fehler mit Hopper</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/504084/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo! Mein Name ist Alexander Nikishin, ich entwickle iOS-Anwendungen bei Badoo. In dem Artikel werde ich darüber sprechen, wie wir einen Fehler in UIKit untersucht haben, den Apple sechs Monate lang nicht beheben wollte. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tm/mh/ea/tmmheaww_pwtz36zltfmiyqgadu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles begann im August 2019 mit den ersten Beta-Versionen von iOS 13. Dann stießen wir zuerst auf ein Problem. In den Anwendungen Badoo und Bumble arbeiten wir ständig an der Verbesserung der Schnittstellen und versuchen beispielsweise, den langwierigen und ungeliebten Registrierungsprozess so weit wie möglich zu optimieren. Systematische prädiktive Tooltips über der Tastatur sind eine hervorragende Möglichkeit, die Anzahl der Benutzerklicks bei der Dateneingabe zu verringern. In der neuen Version von iOS waren wir jedoch überrascht, dass die Eingabeaufforderungen zur Eingabe der Telefonnummer weg waren.</font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/qh/qe/tp/qhqetpwinu9_mvbd5gms1dyrvu0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als die GM-Version herauskam, stellten wir fest, dass das Problem nicht behoben war. Es schien uns, dass solch ein offensichtlicher Fehler durch Regressionstests, die Apple wahrscheinlich in seinem Arsenal hatte, einfach nicht übersehen werden konnte, und wir begannen, auf eine Korrektur im ersten großen Update-Paket zu warten. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Andere Entwickler hofften</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> darauf </font><font style="vertical-align: inherit;">. Mit der Veröffentlichung von Version 13.1 hat sich jedoch nichts geändert, und wir hatten keine andere Wahl, als das Radar zu öffnen, was wir Anfang Oktober getan haben. Die Zeit verging, iOS 13.2 und 13.3 kamen heraus und der Fehler blieb immer noch unkorrigiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Februar hatte unser Registrierungsteam etwas Zeit, um am Rückstand zu arbeiten, und ich beschloss, dieses Problem etwas genauer zu untersuchen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bevor Sie anfangen zu graben, mussten Sie herausfinden, wie es geht. Da die Hinweise auf einigen Tastaturtypen weiterhin funktionierten, bestand der erste Gedanke darin, die Hierarchie der Ansichten in verschiedenen Versionen von iOS zu untersuchen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mv/sw/px/mvswpxpjqpsfjh2bqdcn1vlz8sk.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iOS 12 vs iOS 13</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Es wurde sofort klar, dass Apple in iOS 13 die Tastaturimplementierung überarbeitet und die Eingabeaufforderungen in einem separaten Controller hervorgehoben hat ( </font></font><code>UIPredictionViewController</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Offensichtlich hat auch der Trend zur Modularisierung und Zerlegung ihn erreicht ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artyom Loenko hat übrigens</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kürzlich über unsere Erfahrungen mit ihrer Anwendung gesprochen </font><font style="vertical-align: inherit;">). Aus diesem Grund gab es höchstwahrscheinlich eine Regression der Funktionalität. Der Suchkreis wurde enger.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich denke, die meisten iOS-Entwickler wissen, dass es einfach ist, Schnittstellen privater Systemklassen im öffentlichen Bereich zu finden: Geben Sie einfach eine Abfrage in die Suchmaschine ein. Bei der Untersuchung </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einer Klassenschnittstelle</font></font></a> <code>UIPredictionViewController</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> im Auge fällt eine ihrer Methoden auf: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ex/vt/ry/exvtrycfpe8qra7wrgux5khrqka.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es scheint einen Hinweis zu geben, der mit den guten alten Tool- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spoofing-Implementierungsfunktionen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Swizzling) </font><font style="vertical-align: inherit;">recht einfach zu überprüfen ist </font><font style="vertical-align: inherit;">. Wir werden es verwenden, damit eine Funktion, die "unter Verdacht" steht, immer den wahren Wert zurückgibt:</font></font><br>
<br>
<pre><code class="objectivec hljs">+(<span class="hljs-keyword">void</span>)swizzleIsVisibleForInputDelegate {<font></font>
    SEL targetSelector = sel_getUid(<span class="hljs-string">"isVisibleForInputDelegate:inputViews:"</span>);<font></font>
    Class targetClass = <span class="hljs-built_in">NSClassFromString</span>(@”<span class="hljs-built_in">UIPredictionViewController</span>”);
    <span class="hljs-keyword">if</span> (targetClass == <span class="hljs-literal">nil</span>) {
        <span class="hljs-keyword">return</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (![targetClass instancesRespondToSelector:targetSelector]) {
        <span class="hljs-keyword">return</span>;<font></font>
    }<font></font>
<font></font>
    Method method = class_getInstanceMethod(targetClass, targetSelector);<font></font>
    <span class="hljs-keyword">if</span> (method == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">return</span>;<font></font>
    }<font></font>
<font></font>
    IMP originalImplementation = method_getImplementation(method);<font></font>
    IMP newImp = imp_implementationWithBlock(^<span class="hljs-built_in">BOOL</span>(<span class="hljs-keyword">id</span> me, <span class="hljs-keyword">id</span> delegate, <span class="hljs-keyword">id</span> views) {
        <span class="hljs-comment">//   ,        . </span>
        <span class="hljs-built_in">BOOL</span> result = ((<span class="hljs-keyword">bool</span> (*)(<span class="hljs-keyword">id</span>,SEL,<span class="hljs-keyword">id</span>,<span class="hljs-keyword">id</span>))originalImplementation)(me, targetSelector, delegate, views);
        <span class="hljs-keyword">if</span> ([delegate isKindOfClass:[<span class="hljs-built_in">UITextField</span> <span class="hljs-keyword">class</span>]] &amp;&amp; [delegate keyboardType] == <span class="hljs-built_in">UIKeyboardTypePhonePad</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">YES</span>;<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> result;<font></font>
    });<font></font>
<font></font>
    method_setImplementation(method, newImp);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim Neustart des Testprojekts stellte ich fest, dass die Telefonansagen zu iOS 13 zurückkehrten und „im normalen Modus“ funktionieren. Dies könnte die Untersuchung beenden und diese gefährliche und verbotene Apple-Richtlinienlösung in der Release-Assembly möglicherweise sogar sehr sorgfältig verwenden und für einige Benutzer remote aktivieren / deaktivieren (für die Option der Remote-Funktionsverwaltung sehen Sie die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aufzeichnung des Berichts</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> meiner Kollegin Katerina Trofimenko). Trotzdem habe ich mich immer wieder gefragt, warum diese Funktion bei Verwendung der Telefontastatur false zurückgibt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Wahrheit herauszufinden, benötigen wir den Quellcode der Funktion. Offensichtlich verteilt Apple den iOS-Komponentencode nicht rechts und links, sodass es nicht möglich ist, ihn zu googeln. Es gibt nur noch einen Weg - Reverse Engineering zum Dekompilieren des Binärcodes. Früher hatte ich mehrmals von einem Produkt wie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hopper gehört</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und mehrere Artikel über seine Verwendung gelesen, um tiefer unter die Haube von Systembibliotheken zu graben, aber ich habe es selbst nie benutzt. Und sofort war ich angenehm überrascht: Es stellte sich heraus, dass es nicht einmal notwendig ist, die Vollversion zu kaufen, um herumzuspielen und die Werkzeuge zu lernen. Die Demoversion enthält endlose 30-minütige Arbeitssitzungen, ohne dass der Index gespeichert und Änderungen an Binärdateien vorgenommen werden können. Dies bedeutet, dass sie eine hervorragende Plattform zum Experimentieren ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles aus dem gleichen</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In der veröffentlichten</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> privaten Oberfläche können Sie herausfinden, was </font></font><code>UIPredictionViewController</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teil des UIKitCore-Frameworks ist. Sie müssen es nur noch finden und auf Hopper hochladen. Binäre Framework-Dateien befinden sich in den Tiefen von Xcode. Hier ist zum Beispiel der vollständige Pfad zum UIKitCore, den wir benötigen:</font></font><br>
<br>
<pre><code class="plaintext hljs">/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Library/Developer/CoreSimulator/Profiles/Runtimes/iOS.simruntime/Contents/Resources/RuntimeRoot/System/Library/PrivateFrameworks/UIKitCore.framework/UIKitCore</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir erstellen eine Drag-and-Drop-Datei in Hopper, bestätigen die Aktion im Systemdialog und warten, bis die Indizierung abgeschlossen ist (bei einem so großen Framework wie UIKit kann dies vier bis sechs Minuten dauern). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Oberfläche des Programms ist recht einfach, ich werde nur die Schlüsselelemente erwähnen, die für meine Forschung erforderlich waren. </font><font style="vertical-align: inherit;">Im linken Bereich der Benutzeroberfläche finden Sie die Suchzeile, durch die der Code navigiert wird. </font><font style="vertical-align: inherit;">Durch die Suche nach dem Namen der Klasse, an der wir interessiert sind, erhalten wir schnell die zu untersuchende Funktion. Der Assembler-Code wird im Hauptfenster geöffnet. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gi/qf/94/giqf94bvzg42e1zspxys3880gy4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der oberen Taskleiste befinden sich Schaltflächen zum Umschalten des Codeanzeigemodus. </font><font style="vertical-align: inherit;">Von links nach rechts:</font></font><br>
<br>
<img width="200" src="https://habrastorage.org/webt/ho/i-/ig/hoi-igmtwupaitvjpqolbwckmya.png"><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ASM-Modus - Assembler-Code;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CFG-Modus - Assembler-Code in Form eines Blockdiagramms (Baums), in dem die Codeteile zu Blöcken zusammengefasst und die Übergänge als Verzweigungen angezeigt werden.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pseudocode-Modus - der generierte Pseudocode (wir werden weiter unten mehr darüber sprechen);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Hex-Modus ist eine hexadezimale Darstellung einer Binärdatei oder Abrakadabra, was uns bei unserer Forschung nicht viel hilft.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt müssen Sie herausfinden, was innerhalb der Funktion passiert. </font><font style="vertical-align: inherit;">Ihr Körper ist ziemlich lang, so dass nur ASM-Gurus, die ich mich nicht nennen kann, die Logik verstehen können, indem sie sich den Assembler-Code ansehen. </font><font style="vertical-align: inherit;">Dazu hilft der Pseudocode-Modus, in dem Hopper die Montagevorgänge so weit wie möglich vereinfacht, wenn möglich echte Funktionsnamen ersetzt und Registernamen wie Variablen verwendet. </font><font style="vertical-align: inherit;">Es sieht so aus: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ph/0w/cy/ph0wcy7eq21kozwiapjtw3mihuu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es bleibt nur die Logik der Funktion durchzugehen und zu verstehen, in welchen ihrer Zweige wir fallen. </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Symbolische Haltepunkte</font></a><font style="vertical-align: inherit;"> haben mir dabei geholfen.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die bei Systemaufrufen installiert werden kann und gleichzeitig alle erforderlichen Variablen und die Ergebnisse von Funktionsaufrufen an die Xcode-Konsole druckt. Auf diese einfache Weise stellte ich fest, dass die Ausführung der Funktion durch ein vorzeitiges Beenden unterbrochen wird, da eine der Bedingungen im Beispielcodeblock nicht funktioniert. Lassen Sie uns herausfinden, was hier los ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein kleiner Kontext: Im rbx-Register befindet sich etwas höher im Code (den ich der Einfachheit halber weggelassen habe) eine Verknüpfung zu dem Objekt, das das Protokoll implementiert </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">UITextInputTraits_Private</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(dies ist eine erweiterte Version des öffentlichen Protokolls </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">UITextInputTraits</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die erste der Bedingungen besteht also darin, zu überprüfen, ob die Eingabeaufforderungen durch die Konfiguration des Eingabefelds nicht ausgeblendet werden. Im Debug können Sie sehen, dass es ausgeführt wird: Eigenschaft</font></font><code>hidePrediction</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gibt false zurück. Die zweite Bedingung besteht darin, zu überprüfen, ob sich die Tastatur nicht im Split-Modus befindet (ziehen Sie auf Ihrem iPad </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die untere rechte Taste nach oben</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nur 2-3% der Benutzer wissen davon). Das ist auch in Ordnung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mach weiter. In der nächsten Phase beginnen Manipulationen mit </font></font><code>keyboardType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die uns darauf hinweisen, dass die Wahrheit irgendwo in der Nähe ist. Es wird zuerst überprüft, ob der aktuelle </font></font><code>keyboardType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wert kleiner oder gleich 0xb ist (oder 11 im Dezimalformat). Wenn wir die Deklaration in Xcode öffnen </font></font><code>UIKeyboardType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, werden wir sehen, dass es 13 Arten von Tastaturen gibt, und eine davon (</font></font><code>UIKeyboardTypeAlphabet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) ist veraltet und wird als Referenz auf einen anderen Typ deklariert. Das heißt, es gibt 12 Typen in enum: Wenn Sie bei 0 beginnen, hat letzterer einen Wert von 11. Mit anderen Worten, der Code validiert den Wert in Form einer Überlaufprüfung und wird erneut erfolgreich bestanden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Außerdem sehen wir einen sehr seltsamen Zustand </font></font><code>if (!COND)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, und ich konnte lange Zeit nicht verstehen, was überprüft wurde, da die COND-Variable an keiner anderen Stelle im Code deklariert wurde. Darüber hinaus haben meine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">symbolischen Haltepunkte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gezeigt, dass gerade die Nichterfüllung dieser Bedingung zu einem vorzeitigen Verlassen der Funktion führt. Und hier haben wir keine andere Wahl, als in den ASM-Modus zurückzukehren und diesen Teil des Codes in Assembler-Form zu studieren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um diese Bedingung in der ASM-Liste zu finden, können Sie die Option „Keine Codeduplizierung“ verwenden, bei der Pseudocode nicht in Form von Quellcode mit if-else-Bedingungen angezeigt wird, sondern in Form von eindeutigen Codeblöcken und Übergängen in Form von goto. In diesem Fall sehen wir die Position des Anfangs dieser Blöcke in der Binärdatei und verwenden diesen Zeiger, um im ASM-Modus zu suchen. Also fand ich heraus, dass sich der Block, an dem wir interessiert sind, unter fe79f4 befindet: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yu/ev/wk/yuevwkuqmhpb5ht5ds2l3mgiz1w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir zum ASM-Modus zurückkehren, können wir diesen Block leicht finden: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/g1/0e/u4/g10eu4epacglmci1utx7gpue_ii.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir kommen zum schwierigsten Teil, wo wir die drei Zeilen des Assembler-Codes analysieren werden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich erkannte die erste Zeile aus meinem Gedächtnis (dank des Assembler-Unterrichts in meiner Heimat MIET ist endlich der Moment in meinem Leben gekommen, in dem die Hochschulbildung nützlich war!). Hier ist alles ganz einfach: Die Konstante 0x930 (100100110000 im Binärformat) wird in das ecx-Register gestellt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der zweiten Zeile sehen wir den Befehl bt, der in den Registern </font></font><code>exc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font><font style="vertical-align: inherit;">ausgeführt wird </font></font><code>eax</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Der Wert von einem, den wir bereits kennen, der Wert des zweiten ist im vorherigen Screenshot zu sehen: </font></font><code>rax = [rbx keyboardType]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Er enthält den aktuellen Tastaturtyp. </font></font><code>rax</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Dies ist das gesamte 64-Bit-Register. </font></font><code>eax</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Dies ist der 32-Bit-Teil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem die Daten festgelegt wurden, bleibt die Logik des Teams zu verstehen. Google führt uns zu </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dieser Beschreibung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<blockquote>Selects the bit in a bit string (specified with the first operand, called the bit base) at the bit-position designated by the bit offset operand (second operand) and stores the value of the bit in the CF flag.</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Befehl extrahiert ein Bit aus dem ersten Operanden (Konstante 0x930) an der durch den zweiten Operanden (Tastaturtyp) angegebenen Position und platziert es in CF ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Übertragsflag</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Das heißt, die CF enthält je nach Tastaturtyp 0 oder 1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir fahren mit der letzten Operation fort </font></font><code>jb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die die folgende </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beschreibung hat</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<code>Jump short if below (CF=1)</code> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist leicht zu erraten, dass es einen Übergang zur Funktion gibt (vorzeitiges Beenden), wenn CF 1 ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An diesem Punkt beginnt sich das Rätsel zu summieren. Wir haben eine Bitmaske 100100110000 (sie enthält 12 Bit entsprechend der Anzahl der verfügbaren Tastaturtypen) und bestimmt die Bedingung für ein vorzeitiges Beenden. Wenn wir nun die Verfügbarkeit von Hinweisen für alle Tastaturtypen in aufsteigender Reihenfolge überprüfen </font></font><code>rawValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ist alles vorhanden.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yj/gm/xw/yjgmxwjm7pes1dooauar9gksqxm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In iOS 12 werden wir keine solche Logik finden - die Hinweise dort funktionieren für jede Art von Tastatur. Ich vermute, dass Apple in iOS 13 beschlossen hat, Hinweise für digitale Tastaturen zu deaktivieren, was im Prinzip verständlich ist: Ich kann mir kein Szenario ausdenken, in dem das System Nummern auffordern muss. Anscheinend hat versehentlich auch eine „heiße Hand“ getroffen </font></font><code>UIKeyboardTypePhonePad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die einem normalen Ziffernblock sehr ähnlich ist. Gleichzeitig </font></font><code>UIKeyboardTypeNamePhonePad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zeigte er eine QWERTZ-Tastatur, um nach Telefonkontakten zu suchen, und genau dieselbe deaktivierte digitale Tastatur und zeigte weiterhin Eingabeaufforderungen an.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zu meiner Überraschung erwies sich die Arbeit mit Hopper als sehr angenehm und unterhaltsam. Lange Zeit bekam ich nicht so viele Fans. </font><font style="vertical-align: inherit;">Ich habe die Ergebnisse in meinem Fehlerbericht an die Apple-Ingenieure weitergegeben, und der Status wurde im Laufe der Zeit in "Potenzielle Fehlerbehebung - Für ein zukünftiges Betriebssystem-Update" geändert. </font><font style="vertical-align: inherit;">Ich hoffe, dass das Update Benutzer in zukünftigen Updates erreichen wird. </font><font style="vertical-align: inherit;">Gleichzeitig kann Hopper nicht nur zum Auffinden der Ursachen Ihrer oder Apple-Fehler verwendet werden, sondern auch zum Erkennen von Apple-Korrekturen für </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programme von Drittanbietern</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de504070/index.html">Der Doktorand hat vor einem halben Jahrhundert ein topologisches Problem gelöst</a></li>
<li><a href="../de504072/index.html">Die ideale Benutzervereinbarung: Wie können Risiken für Entwickler minimiert werden?</a></li>
<li><a href="../de504074/index.html">Glass Nightmare: Säuberung des nuklearen Erbes des Kalten Krieges in Hanford</a></li>
<li><a href="../de504080/index.html">Wie Apple- und Google-Mitarbeiter Gesundheitsbeamten dabei helfen, Coronavirus gemeinsam zu verfolgen</a></li>
<li><a href="../de504082/index.html">Was machen wir mit den zusätzlichen 1,2 GHz?</a></li>
<li><a href="../de504086/index.html">Computersystem-Simulatoren - sehen sie wie die Realität aus?</a></li>
<li><a href="../de504088/index.html">Erweiterte Windows-Protokollierung. Auf der Suche nach Mimikatz</a></li>
<li><a href="../de504092/index.html">Schauen Sie sich zunächst JavaScript-Datensätze und -Tupel an</a></li>
<li><a href="../de504096/index.html">Optimaler Newbie Way für C ++ / Qt</a></li>
<li><a href="../de504098/index.html">Dipfake Video ein Bild</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>