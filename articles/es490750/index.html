<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèà ‚õπüèø ü§® Mikhail Salosin. Golang Meetup. Usando Go en el backend de la aplicaci√≥n Watch + üë©üèΩ‚Äçü§ù‚Äçüë®üèø üìπ ‚è≤Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mikhail Salosin (en adelante - MS): - ¬°Hola a todos! Mi nombre es Michael. Trabajo como desarrollador de backend en MC2 Software, y hablar√© sobre el u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Mikhail Salosin. Golang Meetup. Usando Go en el backend de la aplicaci√≥n Watch +</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/490750/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Salosin (en adelante - MS):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬°Hola a todos! </font><font style="vertical-align: inherit;">Mi nombre es Michael. </font><font style="vertical-align: inherit;">Trabajo como desarrollador de backend en MC2 Software, y hablar√© sobre el uso de Go en el backend de la aplicaci√≥n m√≥vil Watch +. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tf/pc/yj/tfpcyjrufa8t1o-_ilgh2iqqb1w.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øAlguien presente como el hockey? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/td/g7/l_/tdg7l_zyrrg7vw1shoc3fdxywda.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces esta aplicaci√≥n es para ti. </font><font style="vertical-align: inherit;">Es para Android e iOS, se utiliza para ver transmisiones de varios eventos deportivos en l√≠nea y en grabaciones. </font><font style="vertical-align: inherit;">Tambi√©n en la aplicaci√≥n hay varias estad√≠sticas, transmisiones de texto, mesas para conferencias, torneos y otra informaci√≥n √∫til para los fan√°ticos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ps/cn/fa/pscnfash29d-yqq6ldluvigihoq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, en la aplicaci√≥n hay momentos de video, es decir, puedes ver los momentos agudos de los partidos (goles, peleas, tiroteos, etc.). </font><font style="vertical-align: inherit;">Si no desea ver la transmisi√≥n completa, puede ver solo las m√°s interesantes.</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© se us√≥ en el desarrollo?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El cuerpo principal fue escrito en Go. La API con la que se comunicaron los clientes m√≥viles se escribi√≥ en Go. Adem√°s, se escribi√≥ un servicio en Go para enviar notificaciones push a dispositivos m√≥viles. Tambi√©n tuvimos que escribir nuestro propio ORM, del que alg√∫n d√≠a podr√≠amos hablar. Bueno, algunos servicios peque√±os est√°n escritos en Go: cambio de tama√±o y carga de im√°genes para los editores ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilizamos Postgres (PostgreSQL) como base de datos. La interfaz para editores se escribi√≥ en Ruby on Rails utilizando la gema ActiveAdmin. La importaci√≥n de estad√≠sticas del proveedor de estad√≠sticas tambi√©n est√° escrita en Ruby.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para las pruebas de API del sistema, utilizamos el Python unittest (Python). </font><font style="vertical-align: inherit;">Memcached se utiliza para limitar las solicitudes de pago de la API, Chef para controlar la configuraci√≥n, Zabbix para recopilar y monitorear las estad√≠sticas internas del sistema. </font><font style="vertical-align: inherit;">Graylog2: para recopilar registros, Slate es una documentaci√≥n de API para clientes.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n5/v_/tc/n5v_tcwffefrpa-fxomv5jc_moc.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selecci√≥n de protocolo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El primer problema que encontramos: tuvimos que elegir un protocolo para la interacci√≥n del backend con clientes m√≥viles, basado en los siguientes puntos ...</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El requisito m√°s importante: los datos sobre los clientes deben actualizarse en tiempo real. </font><font style="vertical-align: inherit;">Es decir, todos los que actualmente est√°n viendo la transmisi√≥n deber√≠an recibir actualizaciones casi al instante.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para simplificar, aceptamos que los datos que se sincronizan con los clientes no se eliminan, sino que se ocultan mediante indicadores especiales.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las solicitudes GET ordinarias reciben todo tipo de solicitudes raras (como estad√≠sticas, alineaciones, estad√≠sticas de equipo).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adem√°s, se supon√≠a que el sistema resistir√≠a tranquilamente a 100 mil usuarios al mismo tiempo.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En base a esto, ten√≠amos dos opciones de protocolo:</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Websockets. </font><font style="vertical-align: inherit;">Pero no necesit√°bamos canales del cliente al servidor. </font><font style="vertical-align: inherit;">Solo necesit√°bamos enviar actualizaciones del servidor al cliente, por lo que un socket web es una opci√≥n redundante.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°Los eventos enviados por el servidor (SSE) surgieron a la perfecci√≥n! </font><font style="vertical-align: inherit;">Es bastante simple y b√°sicamente satisface todo lo que necesitamos.</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eventos enviados por el servidor</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algunas palabras sobre c√≥mo funciona esto ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Funciona encima de la conexi√≥n http. </font><font style="vertical-align: inherit;">El cliente env√≠a una solicitud, el servidor responde con Content-Type: text / event-stream y no cierra la conexi√≥n con el cliente, pero contin√∫a escribiendo datos en la conexi√≥n: los </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0s/qp/5j/0sqp5jdkevts9970rrbpwa0bm9i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
datos pueden enviarse en un formato acordado con los clientes. </font><font style="vertical-align: inherit;">En nuestro caso, enviamos la siguiente forma: en el campo del evento, se envi√≥ el nombre de la estructura modificada (persona, jugador) y en el campo de datos: JSON con campos nuevos y modificados para el jugador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora sobre c√≥mo funciona la interacci√≥n en s√≠.</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En primer lugar, el cliente determina cu√°ndo se realiz√≥ la √∫ltima sincronizaci√≥n con el servicio: mira su base de datos local y determina la fecha del √∫ltimo cambio registrado en √©l.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Env√≠a una solicitud con esta fecha.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En respuesta, le enviamos todas las actualizaciones que se han producido en esta fecha.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despu√©s de eso, se conecta al canal en vivo y no cierra hasta que necesita estas actualizaciones:</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/_v/t9/t1/_vt9t1r7nq_--sskm6vc_-0qydw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le enviamos una lista de cambios: si alguien marc√≥ un gol, cambiamos el puntaje del partido, nos lesionamos, tambi√©n lo enviamos en tiempo real. </font><font style="vertical-align: inherit;">Por lo tanto, en el flujo de eventos del partido, los clientes reciben instant√°neamente datos relevantes. </font><font style="vertical-align: inherit;">Peri√≥dicamente, para que el cliente comprenda que el servidor no ha muerto, que no le ha pasado nada, enviamos una marca de tiempo cada 15 segundos, para que sepa que todo est√° en orden y que no hay necesidad de volver a conectarse.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øC√≥mo se sirve la conexi√≥n en vivo?</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En primer lugar, creamos un canal en el que vendr√°n actualizaciones con un b√∫fer.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despu√©s de eso, suscribimos este canal para recibir actualizaciones.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Establezca el encabezado correcto para que el cliente sepa que todo est√° bien.</font></font></li>
<li>  ping.    timestamp .</li>
<li>         ,     .       timestamp,  ,       .</li>
</ul><br>
<img src="https://habrastorage.org/webt/rf/hl/s9/rfhls98e0zi4dogfbjpptkb-feg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El primer problema que encontramos fue el siguiente: para cada conexi√≥n abierta con el cliente, creamos un temporizador que marcaba una vez cada 15 segundos; resulta que si ten√≠amos 6,000 conexiones con una m√°quina (con un servidor API), Se crearon 6 mil temporizadores. </font><font style="vertical-align: inherit;">Esto llev√≥ al hecho de que la m√°quina no ten√≠a la carga necesaria. </font><font style="vertical-align: inherit;">El problema no era tan obvio para nosotros, pero nos ayudaron un poco y lo eliminamos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, ahora tenemos ping proveniente del mismo canal del que proviene la actualizaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En consecuencia, solo hay un temporizador que funciona una vez cada 15 segundos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estas son algunas funciones auxiliares: enviar el encabezado, el ping y la estructura misma. </font><font style="vertical-align: inherit;">Es decir, el nombre de la tabla (persona, partido, temporada) y la informaci√≥n sobre este registro se transmiten aqu√≠:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qu/g2/rh/qug2rhecowmxbnqmqz7zk5p-_7g.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mecanismo para enviar actualizaciones</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora un poco sobre de d√≥nde vienen los cambios. </font><font style="vertical-align: inherit;">Tenemos varias personas, editores, que ven la transmisi√≥n en tiempo real. </font><font style="vertical-align: inherit;">Crean todos los eventos: alguien fue eliminado, alguien result√≥ herido, alg√∫n tipo de reemplazo ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con la ayuda de CMS, los datos ingresan a la base de datos. </font><font style="vertical-align: inherit;">Despu√©s de eso, la base de datos que utiliza el mecanismo de Escuchar / Notificar notifica a los servidores API sobre esto. </font><font style="vertical-align: inherit;">Los servidores API ya est√°n enviando esta informaci√≥n a los clientes. </font><font style="vertical-align: inherit;">Por lo tanto, de hecho, solo tenemos unos pocos servidores conectados a la base de datos y no hay una carga especial en la base de datos, porque el cliente no interact√∫a directamente con la base de datos de ninguna manera:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/az/wp/ei/azwpei0ysoe2uspec2ybfe9mdag.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQL: escuchar / notificar</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El mecanismo de Escuchar / Notificar en Postgres le permite notificar a los suscriptores de eventos que alg√∫n evento ha cambiado; se ha creado alg√∫n tipo de registro en la base de datos. Para hacer esto, escribimos un desencadenador y una funci√≥n simples: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hj/i_/ms/hji_msz1f-kwrtijbes4flcctr0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
al insertar o cambiar un registro, llamamos a la funci√≥n de notificaci√≥n en el canal data_updates, transferimos el nombre de la tabla y el identificador del registro que fue cambiado o insertado all√≠. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para todas las tablas que deben sincronizarse con el cliente, definimos un activador que, despu√©s de cambiar / actualizar el registro, llama a la funci√≥n indicada en la diapositiva a continuaci√≥n. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo se suscribe la API a estos cambios? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se crea el mecanismo Fanout: env√≠a mensajes al cliente. Recopila todos los canales de los clientes y env√≠a las actualizaciones que recibi√≥ a trav√©s de estos canales:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kx/op/vl/kxopvlizual_4yyz48t79flo8w8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ la biblioteca pq est√°ndar, que se conecta a la base de datos y dice que quiere escuchar el canal (data_updates), verifica que la conexi√≥n est√© abierta y que todo est√© bien. </font><font style="vertical-align: inherit;">Omito la comprobaci√≥n de errores para ahorrar espacio (no marque cargada). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, configuramos el Ticker de forma asincr√≥nica, que enviar√° ping cada 15 segundos y comenzaremos a escuchar el canal al que nos suscribimos. </font><font style="vertical-align: inherit;">Si tenemos un ping, publicamos este ping. </font><font style="vertical-align: inherit;">Si recibimos un registro, lo publicamos a todos los suscriptores de este Fanout.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øC√≥mo funciona el despliegue?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En ruso, esto se traduce como un "divisor". Tenemos un objeto que registra a los suscriptores que desean recibir actualizaciones. Y tan pronto como llega una actualizaci√≥n de este objeto, difunde esta actualizaci√≥n a todos los suscriptores que tiene. Bastante simple: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/je/tw/76/jetw76q3dzqifpq22yo9dc3j4ha.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
c√≥mo se implementa en Go: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nz/gl/o8/nzglo8wnz5iwzrtjfc39zlqqxa8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
hay una estructura, se sincroniza mediante Mutexes. Tiene un campo que guarda el estado de la conexi√≥n de Fanout a la base de datos, es decir, en el momento en que escucha y recibir√° actualizaciones, as√≠ como una lista de todos los canales disponibles: mapa, cuya clave es el canal y la estructura en forma de valores (de hecho, no utilizado de ninguna manera).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dos m√©todos, Conectado y Desconectado, le permiten decirle a Fanout que tenemos una conexi√≥n a la base, que apareci√≥ y que la conexi√≥n a la base est√° desconectada. En el segundo caso, debe desconectar a todos los clientes y decirles que ya no pueden escuchar nada y que se vuelven a conectar, ya que la conexi√≥n con ellos se ha cerrado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n hay un m√©todo de suscripci√≥n que agrega un canal a los oyentes: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i1/hu/rh/i1hurht2d0x5mmdikeem_gpmm3i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
hay un m√©todo de cancelaci√≥n de suscripci√≥n que elimina un canal de los oyentes si el cliente se desconecta, as√≠ como un m√©todo de publicaci√≥n que le permite enviar un mensaje a todos los suscriptores. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pregunta:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬øQu√© se transmite a trav√©s de este canal? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Se transmite un modelo que ha cambiado o ping (esencialmente solo un n√∫mero, entero). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Puedes enviar cualquier cosa, publicar cualquier estructura, simplemente se convierte en JSON y eso es todo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Recibimos una notificaci√≥n de Postgres - contiene el nombre de la tabla y el identificador. </font><font style="vertical-align: inherit;">Por el nombre de la tabla que obtenemos y el identificador obtenemos el registro que necesitamos, y esta estructura ya se env√≠a para su publicaci√≥n.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infraestructura</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo se ve en t√©rminos de infraestructura? Tenemos 7 servidores de hierro: uno de ellos est√° completamente dedicado a la base, las computadoras virtuales est√°n girando sobre los seis restantes. Hay 6 copias de la API: cada m√°quina virtual con la API se ejecuta en un servidor de hierro por separado, esto es por fiabilidad. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hu/2_/4e/hu2_4eyv8ko_you4ygxuowle6m4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenemos dos interfaces en las que se instala Keepalived para mejorar la accesibilidad, de modo que en caso de que una interfaz pueda reemplazar a la otra. Otras dos copias del CMS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n hay un importador de estad√≠sticas. Hay un DB Slave desde el que se realizan copias de seguridad peri√≥dicamente. Est√° Pigeon Pusher, la aplicaci√≥n que env√≠a insultos a los clientes, as√≠ como cosas de infraestructura: Zabbix, Graylog2 y Chef.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, esta infraestructura es redundante, porque se pueden servir 100 mil con menos servidores. </font><font style="vertical-align: inherit;">Pero hab√≠a hierro, lo usamos (nos dijeron que es posible, por qu√© no).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pros de Go</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de trabajar en esta aplicaci√≥n, se revelaron ventajas obvias de Go.</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Genial biblioteca http. </font><font style="vertical-align: inherit;">Al usarlo, puede crear bastante ya fuera de la caja.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adem√°s, los canales que nos permitieron implementar muy f√°cilmente el mecanismo para enviar notificaciones a los clientes.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El maravilloso detector Race nos permiti√≥ eliminar varios errores cr√≠ticos (infraestructura de ensayo). </font><font style="vertical-align: inherit;">Todo lo que funciona en la puesta en escena se est√° ejecutando, compilado con la clave Race; </font><font style="vertical-align: inherit;">y, en consecuencia, podemos ver qu√© problemas potenciales tenemos en la infraestructura de preparaci√≥n.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minimalismo y simplicidad del lenguaje.</font></font></li>
</ul><br>
<br>
<img src="https://habrastorage.org/webt/eb/lc/mo/eblcmow1odoou6z22y2rady3n6k.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estamos buscando desarrolladores! </font><font style="vertical-align: inherit;">Si alguien quiere, por favor.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Preguntas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pregunta de la audiencia (en adelante - B): - Me parece que te perdiste un punto importante con respecto al Fan-out. Entiendo correctamente que cuando env√≠a una respuesta a un cliente, ¬øest√° bloqueado si el cliente no quiere leer? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - No, no estamos bloqueando. En primer lugar, lo tenemos todo detr√°s de nginx, es decir, no hay problemas con clientes lentos. En segundo lugar, el cliente tiene un canal con un b√∫fer; de hecho, podemos poner hasta cien actualizaciones all√≠ ... Si no podemos escribir en el canal, entonces lo elimina. Si vemos que el canal est√° bloqueado, simplemente lo cerramos, y eso es todo: el cliente se volver√° a conectar si hay alg√∫n problema. Por lo tanto, en principio, el bloqueo no ocurre aqu√≠. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬øPodr√≠a enviar inmediatamente a Listen / Notify un registro, no una tabla de identificaci√≥n? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Listen / Notify tiene un l√≠mite de 8 mil bytes por precarga, que env√≠a. En principio, ser√≠a posible enviar si estuvi√©ramos tratando con una peque√±a cantidad de datos, pero me parece que la forma [como lo hacemos] es simplemente m√°s confiable. Las limitaciones est√°n en el propio Postgres. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬øLos clientes reciben actualizaciones sobre los partidos que no les interesan? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- En general, si. Como regla, hay 2-3 partidos en paralelo, y luego muy raramente. Si el cliente est√° mirando algo, generalmente est√° viendo el partido que est√° sucediendo. Luego, en el cliente hay una base de datos local en la que se suman todas estas actualizaciones, e incluso sin una conexi√≥n a Internet, el cliente puede ver todas las coincidencias anteriores para las que tiene actualizaciones. De hecho, sincronizamos nuestra base de datos en el servidor con la base de datos local del cliente para que pueda funcionar sin conexi√≥n. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬øPor qu√© hiciste tu ORM? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexey (uno de los desarrolladores de "Watch +"):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- En ese momento (hace un a√±o), ORM era menor que ahora, cuando hay bastantes. De la mayor√≠a de los ORM existentes, lo que m√°s me disgusta es que la mayor√≠a de ellos trabajan en interfaces vac√≠as. Es decir, los m√©todos que en estos ORM est√°n listos para asumir cualquier cosa: estructura, puntero de estructura, n√∫mero, algo irrelevante ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nuestro ORM genera estructuras basadas en el modelo de datos. S√≠ mismo. Y por lo tanto, todos los m√©todos son concretos, no usan reflexi√≥n, etc. Aceptan estructuras y esperan usar las estructuras que vienen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬øCu√°ntas personas participaron? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - En la etapa inicial, participaron dos personas. En alg√∫n lugar en junio comenzamos, en agosto la parte principal estaba lista (primera versi√≥n). En septiembre hubo un lanzamiento. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Cuando describe SSE, no utiliza el tiempo de espera. ¬øPorqu√© es eso? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Para ser honesto, SSE sigue siendo un protocolo html5: el est√°ndar SSE est√° dise√±ado para comunicarse con los navegadores, seg√∫n tengo entendido. Tiene caracter√≠sticas adicionales para que los navegadores puedan volver a conectarse (y as√≠ sucesivamente), pero no las necesitamos, porque ten√≠amos clientes que pod√≠an implementar cualquier l√≥gica para conectarse y recibir informaci√≥n. Probablemente no hicimos SSE, sino algo similar a SSE. Este no es el protocolo en s√≠. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No hab√≠a necesidad. Por lo que yo entiendo, los clientes implementaron el mecanismo de conexi√≥n desde cero. En principio, no les importaba. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬øQu√© utilidades adicionales usaste? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Los m√°s activos utilizamos govet y golint, para que el estilo se unificara, adem√°s de gofmt. No usaron nada m√°s. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬øCon qu√© depuraste? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - En general, la depuraci√≥n se realiz√≥ mediante pruebas. Sin depurador, GOP que no usamos. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬øPuede devolver la diapositiva donde se implementa la funci√≥n Publicar? Los nombres de variables de una letra no te molestan? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - No. Tienen un alcance bastante "estrecho". No se usan en ning√∫n otro lugar (excepto aqu√≠) (excepto en el interior de esta clase), y es muy compacto: solo toma 7 l√≠neas. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - De alguna manera todav√≠a no es intuitivo ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- No, no, este es un c√≥digo real! No se trata de estilo. Es una clase muy utilitaria, muy peque√±a: solo hay 3 campos dentro de la clase ... </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yx/vb/a8/yxvba8lbupf_3aw2halepbbmlce.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - En general, todos los datos que se sincronizan con los clientes (partidos de temporada, jugadores) no cambian. En t√©rminos generales, si vamos a hacer otro tipo de deporte en el que ser√° necesario cambiar el partido, solo consideraremos todo en la nueva versi√≥n del cliente, y las versiones antiguas del cliente ser√°n prohibidas. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬øHay paquetes de terceros para la gesti√≥n de dependencias? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sol√≠amos ir a dep. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Hab√≠a algo sobre el video en el tema del informe, pero no sobre el video en el informe. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - No, no tengo nada en el tema sobre el video. Se llama "Look +": este es el nombre de la aplicaci√≥n. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ¬øDijiste que est√°s transmitiendo a los clientes? .. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - No hicimos streaming de video. </font><font style="vertical-align: inherit;">Esto fue hecho completamente por meg√°fono. </font><font style="vertical-align: inherit;">S√≠, no dije que la aplicaci√≥n sea meg√°fono. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ir - para enviar todos los datos - por puntuaci√≥n, por eventos del partido, estad√≠sticas ... Ir - este es todo el back-end de la aplicaci√≥n. </font><font style="vertical-align: inherit;">El cliente debe averiguar en alg√∫n lugar qu√© enlace utilizar para el jugador para que el usuario pueda ver el partido. </font><font style="vertical-align: inherit;">Tenemos enlaces a videos y transmisiones que est√°n preparados.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/Kq0cWRBd1MU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un poco de publicidad :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gracias por estar con nosotros. ¬øTe gustan nuestros art√≠culos? ¬øQuieres ver m√°s materiales interesantes? Ap√≥yenos haciendo un pedido o recomendando a sus amigos, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS en la nube para desarrolladores desde $ 4.99</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">an√°logo √∫nico de servidores de nivel b√°sico que inventamos para usted: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toda la verdad sobre VPS (KVM) E5-2697 v3 (6 n√∫cleos) 10GB DDR4 480GB SSD 1Gbps desde $ 19 o c√≥mo dividir el servidor?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (las opciones est√°n disponibles con RAID1 y RAID10, hasta 24 n√∫cleos y hasta 40GB DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 veces m√°s barato en el centro de datos Equinix Tier IV en Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Solo tenemos </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV desde $ 199</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en los Pa√≠ses Bajos.</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - ¬°desde $ 99! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lea sobre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C√≥mo construir un edificio de infraestructura. </font><font style="vertical-align: inherit;">clase c con servidores Dell R730xd E5-2650 v4 que cuestan 9,000 euros por un centavo?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es490738/index.html">Principio de sustituci√≥n de Lisk</a></li>
<li><a href="../es490740/index.html">Defectuoso *** s no es solo aleatorizaci√≥n</a></li>
<li><a href="../es490742/index.html">Una nueva era en rob√≥tica ha comenzado</a></li>
<li><a href="../es490746/index.html">Calificaci√≥n en Yandex.Taxi: una breve publicaci√≥n sobre un tema serio</a></li>
<li><a href="../es490748/index.html">La tarea para el desarrollador, o c√≥mo escaneamos esc√°neres manuales sin un proveedor</a></li>
<li><a href="../es490754/index.html">Visual Studio Code Code Editor. La gu√≠a m√°s detallada para configurar e instalar complementos para principiantes</a></li>
<li><a href="../es490756/index.html">Implementar Jenkins como c√≥digo</a></li>
<li><a href="../es490758/index.html">Los matem√°ticos han demostrado la ley universal de la turbulencia.</a></li>
<li><a href="../es490760/index.html">Ray Casting Visual Search (RCVS). Algoritmo simple y r√°pido para encontrar modelos 3D similares en geometr√≠a</a></li>
<li><a href="../es490762/index.html">¬øC√≥mo pronosticar el pasaje a√©reo?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>