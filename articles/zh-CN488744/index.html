<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💫 🐲 🍹 在C ++中使用OpenAL的指南。第1部分：播放声音 🐄 🐜 🧛</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="您的游戏需要声音！您可能已经使用OpenGL在屏幕上绘图。您已经弄清了它的API，因此您选择了OpenAL，因为该名称看起来很熟悉。
 
 好消息是，OpenAL也有一个非常熟悉的API。它最初旨在模拟OpenGL规范API。这就是为什么我在众多游戏声音系统中选择它的原因。另外，它是跨平台的。
 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>在C ++中使用OpenAL的指南。第1部分：播放声音</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488744/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的游戏需要声音！</font><font style="vertical-align: inherit;">您可能已经使用OpenGL在屏幕上绘图。</font><font style="vertical-align: inherit;">您已经弄清了它的API，因此您选择了</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenAL，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为该名称看起来很熟悉。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好消息是，OpenAL也有一个非常熟悉的API。</font><font style="vertical-align: inherit;">它最初旨在模拟OpenGL规范API。</font><font style="vertical-align: inherit;">这就是为什么我在众多游戏声音系统中选择它的原因。</font><font style="vertical-align: inherit;">另外，它是跨平台的。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在本文中，我将详细讨论在用C ++编写的游戏中使用OpenAL需要哪些代码。</font><font style="vertical-align: inherit;">我们将通过代码示例讨论3D空间中的声音，音乐和声音定位。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenAL的历史</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我会尽量简短。如上所述，它是故意设计为模仿OpenGL API的，这是有原因的。这是许多人都知道的便捷API，如果图形是游戏引擎的一侧，则声音应该有所不同。最初，OpenAL应该是开源的，但是后来发生了一些事情…… </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
人们对声音的兴趣不及图形，因此Creative最终将OpenAL赋予了它的财产，并且</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考实现</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在</font><em><font style="vertical-align: inherit;">是</font></em><font style="vertical-align: inherit;">专有的而不是免费的。但！</font><font style="vertical-align: inherit;">OpenAL </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规范</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仍然是“开放”标准，即已</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有时会修改规格，但数量不多。声音的变化速度不如图形变化快，因为没有特别的需要。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
开放规范允许其他人创建规范的开源实现。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenAL Soft</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就是这样一种实现</font><font style="vertical-align: inherit;">，坦率地说，寻找其他任何</font><font style="vertical-align: inherit;">实现都是</font><font style="vertical-align: inherit;">没有意义的。这是我将要使用的实现，并且我建议您也使用它。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
她是跨平台的。</font><font style="vertical-align: inherit;">它的实现非常奇怪-实际上，库内部使用系统中存在的其他声音API。</font><font style="vertical-align: inherit;">在Windows上，它使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DirectSound</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在Unix上，使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OSS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，她得以跨平台。</font><font style="vertical-align: inherit;">本质上，这是包装API的大名。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可能会担心此API的速度。</font><font style="vertical-align: inherit;">但是不用担心。</font><font style="vertical-align: inherit;">这是相同的声音，不会产生很大的负载，因此不需要图形API进行的大优化。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，有了足够的故事，让我们继续探讨技术。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您需要在OpenAL中编写什么代码？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您需要在您选择的工具链中构建OpenAL Soft。这是一个非常简单的过程，您可以按照</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“源代码安装”部分中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的说明进行操作</font><font style="vertical-align: inherit;">。我从来没有遇到任何问题，但是如果遇到任何困难，请在原始文章下写评论，或</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写到OpenAL Soft邮件列表</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，您将需要一些声音文件以及下载它们的方法。将音频数据加载到缓冲区中以及各种音频格式的细微细节不在本文的讨论范围之内，但是您可以阅读有关</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载和传输Ogg / Vorbis文件的信息</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。下载WAV文件非常简单，Internet上已经有数百篇关于此的文章。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查找音频文件的任务必须自己决定。</font><font style="vertical-align: inherit;">您可以下载Internet上的许多噪音和爆炸声。</font><font style="vertical-align: inherit;">如果有谣言，那么您可以尝试</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写自己的Chiptune音乐</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [ </font><font style="vertical-align: inherit;">Habré上的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">翻译</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
另外，请妥善保存</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">《 OpenALSoft程序员指南》</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该文档是具有“官方”专业知识的pdf更好的文档。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实际上，仅此而已。</font><font style="vertical-align: inherit;">我们将假定您已经知道如何编写代码，使用IDE和工具链。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenAL API概述</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
正如我多次说过的，它类似于OpenGL API。相似之处在于它基于状态，并且您与描述符/标识符交互，而不是直接与对象本身交互。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OpenGL和OpenAL中的API约定之间存在差异，但是它们并不重要。在OpenGL中，您需要进行特殊的OS调用以生成渲染上下文。这些挑战针对不同的操作系统而有所不同，</font><font style="vertical-align: inherit;">并且并不是OpenGL规范的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真正</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组成部分。在OpenAL中，一切都不同-上下文创建功能是规范的一部分，并且与操作系统无关，它们是相同的。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
与API进行交互时，可以与三种主要类型的对象进行交互。</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听众</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（“听众”）是3D空间中“耳朵”的位置（始终只有一个听众）。</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">源</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（“源”）是再次在3D空间中发出声音的“扬声器”。</font><font style="vertical-align: inherit;">侦听器和信号源可以在空间中移动，并且根据此情况，通过游戏中的扬声器所听到的声音也会发生变化。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最后的对象是</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它们存储声音的样本，这些声音将为听众播放。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
也有</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，该游戏的用途改变音频通过OpenAL的处理方式。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资料来源</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如上所述，这些对象是声音的来源。</font><font style="vertical-align: inherit;">可以设置它们的位置和方向，并将它们与回放音频数据的缓冲区关联。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听众</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
游戏中唯一的一组“耳朵”。</font><font style="vertical-align: inherit;">收听者听到的内容通过计算机的扬声器复制。</font><font style="vertical-align: inherit;">他也有职位。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲液</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在OpenGL中，等效项是Texture2D。</font><font style="vertical-align: inherit;">本质上，这是源再现的音频数据。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资料类型</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了能够支持跨平台代码，OpenAL执行一定的动作序列并定义一些数据类型。</font><font style="vertical-align: inherit;">实际上，它非常精确地遵循OpenGL，因此我们甚至可以直接将OpenAL类型转换为OpenGL类型。</font><font style="vertical-align: inherit;">下表列出了它们及其等效项。</font></font><br>
<br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入类型</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">键入openalc</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">键入opengl</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C ++ Typedef</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ALboolean</code></td>
<td><code>ALCboolean</code></td>
<td><code>GLboolean</code></td>
<td><code>std::int8_t</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8位布尔值</font></font></td>
</tr>
<tr>
<td><code>ALbyte</code></td>
<td><code>ALCbyte</code></td>
<td><code>GLbyte</code></td>
<td><code>std::int8_t</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带符号</font><font style="vertical-align: inherit;">的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附加代码的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8位整数值</font></font></td>
</tr>
<tr>
<td><code>ALubyte</code></td>
<td><code>ALCubyte</code></td>
<td><code>GLubyte</code></td>
<td><code>std::uint8_t</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8位无符号整数值</font></font></td>
</tr>
<tr>
<td><code>ALchar</code></td>
<td><code>ALCchar</code></td>
<td><code>GLchar</code></td>
<td><code>char</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">符号</font></font></td>
</tr>
<tr>
<td><code>ALshort</code></td>
<td><code>ALCshort</code></td>
<td><code>GLshort</code></td>
<td><code>std::int16_t</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16位有符号整数值</font></font></td>
</tr>
<tr>
<td><code>ALushort</code></td>
<td><code>ALCushort</code></td>
<td><code>GLushort</code></td>
<td><code>std::uint16_t</code></td>
<td>16-    </td>
</tr>
<tr>
<td><code>ALint</code></td>
<td><code>ALCint</code></td>
<td><code>GLint</code></td>
<td><code>std::int32_t</code></td>
<td>32-      </td>
</tr>
<tr>
<td><code>ALuint</code></td>
<td><code>ALCuint</code></td>
<td><code>GLuint</code></td>
<td><code>std::uint32_t</code></td>
<td>32-    </td>
</tr>
<tr>
<td><code>ALsizei</code></td>
<td><code>ALCsizei</code></td>
<td><code>GLsizei</code></td>
<td><code>std::int32_t</code></td>
<td> 32-   </td>
</tr>
<tr>
<td><code>ALenum</code></td>
<td><code>ALCenum</code></td>
<td><code>GLenum</code></td>
<td><code>std::uint32_t</code></td>
<td> 32- </td>
</tr>
<tr>
<td><code>ALfloat</code></td>
<td><code>ALCfloat</code></td>
<td><code>GLfloat</code></td>
<td><code>float</code></td>
<td>32-     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">IEEE 754</a></td>
</tr>
<tr>
<td><code>ALdouble</code></td>
<td><code>ALCdouble</code></td>
<td><code>GLdouble</code></td>
<td><code>double</code></td>
<td>64-     IEEE 754</td>
</tr>
<tr>
<td><code>ALvoid</code></td>
<td><code>ALCvoid</code></td>
<td><code>GLvoid</code></td>
<td><code>void</code></td>
<td> </td>
</tr>
</tbody>
</table></div><br>
<h2>  OpenAL</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有一篇有关如何</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简化OpenAL错误识别</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的文章</font><font style="vertical-align: inherit;">，但是出于完整性考虑，我将在这里重复。有两种</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的OpenAL API调用：常规和上下文。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以上下文开头的调用</font></font><code>alc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类似于OpenGL win32调用，以获取渲染上下文或在Linux上的对应上下文。声音对于所有操作系统都具有相同的调用来说已经足够简单了。普通电话以开头</font></font><code>al</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。要在上下文调用中出错，请致电</font></font><code>alcGetError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">；对于常规通话，我们致电</font></font><code>alGetError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。它们返回一个值</font></font><code>ALCenum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或一个</font></font><code>ALenum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简单列出可能的错误</font><font style="vertical-align: inherit;">的值</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，我们将只考虑一种情况，但在其他所有情况下，它们几乎都是相同的。</font><font style="vertical-align: inherit;">让我们来应对通常的挑战</font></font><code>al</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">首先，创建一个预处理器宏来完成传递细节的工作：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> alCall(function, ...) alCallImpl(__FILE__, __LINE__, function, __VA_ARGS__)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从理论上讲，你的编译器可能不支持</font></font><code>__FILE__</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任</font></font><code>__LINE__</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但是，说实话，我会感到惊讶，如果这被证明是如此。</font></font><code>__VA_ARGS__</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示可以传递给此宏的可变数量的参数。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，我们实现一个函数，该函数手动接收上次报告的错误并为标准错误流显示一个清晰的值。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">check_al_errors</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; filename, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line)</span>
</span>{<font></font>
    ALenum error = alGetError();<font></font>
    <span class="hljs-keyword">if</span>(error != AL_NO_ERROR)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"***ERROR*** ("</span> &lt;&lt; filename &lt;&lt; <span class="hljs-string">": "</span> &lt;&lt; line &lt;&lt; <span class="hljs-string">")\n"</span> ;
        <span class="hljs-keyword">switch</span>(error)<font></font>
        {<font></font>
        <span class="hljs-keyword">case</span> AL_INVALID_NAME:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"AL_INVALID_NAME: a bad name (ID) was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> AL_INVALID_ENUM:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"AL_INVALID_ENUM: an invalid enum value was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> AL_INVALID_VALUE:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"AL_INVALID_VALUE: an invalid value was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> AL_INVALID_OPERATION:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"AL_INVALID_OPERATION: the requested operation is not valid"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> AL_OUT_OF_MEMORY:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"AL_OUT_OF_MEMORY: the requested operation resulted in OpenAL running out of memory"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"UNKNOWN AL ERROR: "</span> &lt;&lt; error;<font></font>
        }<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
没有太多可能的错误。</font><font style="vertical-align: inherit;">我在代码中编写的解释是您将获得的有关这些错误的唯一信息，但是规范说明了为什么特定功能可能返回特定错误的原因。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后，我们实现两个不同的模板函数，这些函数将包装所有的OpenGL调用。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> alFunction, <span class="hljs-keyword">typename</span>... Params&gt;
<span class="hljs-keyword">auto</span> <span class="hljs-title">alCallImpl</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* filename, 
                <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line, 
                alFunction function, 
                Params... params)</span>
-&gt;<span class="hljs-keyword">typename</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">enable_if_t</span>&lt;!<span class="hljs-built_in">std</span>::is_same_v&lt;<span class="hljs-keyword">void</span>,<span class="hljs-title">decltype</span><span class="hljs-params">(function(params...))</span>&gt;,<span class="hljs-title">decltype</span><span class="hljs-params">(function(params...))</span>&gt;
</span>{
    <span class="hljs-keyword">auto</span> ret = function(<span class="hljs-built_in">std</span>::forward&lt;Params&gt;(params)...);<font></font>
    check_al_errors(filename,line);<font></font>
    <span class="hljs-keyword">return</span> ret;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> alcFunction, <span class="hljs-keyword">typename</span>... Params&gt;
<span class="hljs-keyword">auto</span> <span class="hljs-title">alcCallImpl</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* filename, 
                 <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line, 
                 alcFunction function, 
                 ALCdevice* device, 
                 Params... params)</span>
-&gt;<span class="hljs-keyword">typename</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">enable_if_t</span>&lt;<span class="hljs-built_in">std</span>::is_same_v&lt;<span class="hljs-keyword">void</span>,<span class="hljs-title">decltype</span><span class="hljs-params">(function(params...))</span>&gt;,<span class="hljs-keyword">bool</span>&gt;
</span>{<font></font>
    function(<span class="hljs-built_in">std</span>::forward&lt;Params&gt;(params)...);
    <span class="hljs-keyword">return</span> check_alc_errors(filename,line,device);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其中有两个，因为第一个用于返回的OpenAL函数，</font></font><code>void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二个用于该函数返回非空值。</font><font style="vertical-align: inherit;">如果您不太熟悉C ++中的元编程模板，那么请看一下c代码的各个部分</font></font><code>std::enable_if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它们确定编译器为每个函数调用实现这些模板函数中的哪个。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在通话也一样</font></font><code>alc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> alcCall(function, device, ...) alcCallImpl(__FILE__, __LINE__, function, device, __VA_ARGS__)</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">check_alc_errors</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; filename, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line, ALCdevice* device)</span>
</span>{<font></font>
    ALCenum error = alcGetError(device);<font></font>
    <span class="hljs-keyword">if</span>(error != ALC_NO_ERROR)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"***ERROR*** ("</span> &lt;&lt; filename &lt;&lt; <span class="hljs-string">": "</span> &lt;&lt; line &lt;&lt; <span class="hljs-string">")\n"</span> ;
        <span class="hljs-keyword">switch</span>(error)<font></font>
        {<font></font>
        <span class="hljs-keyword">case</span> ALC_INVALID_VALUE:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ALC_INVALID_VALUE: an invalid value was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> ALC_INVALID_DEVICE:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ALC_INVALID_DEVICE: a bad device was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> ALC_INVALID_CONTEXT:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ALC_INVALID_CONTEXT: a bad context was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> ALC_INVALID_ENUM:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ALC_INVALID_ENUM: an unknown enum value was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> ALC_OUT_OF_MEMORY:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ALC_OUT_OF_MEMORY: an unknown enum value was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"UNKNOWN ALC ERROR: "</span> &lt;&lt; error;<font></font>
        }<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> alcFunction, <span class="hljs-keyword">typename</span>... Params&gt;
<span class="hljs-keyword">auto</span> <span class="hljs-title">alcCallImpl</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* filename, 
                 <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line, 
                 alcFunction function, 
                 ALCdevice* device, 
                 Params... params)</span>
-&gt;<span class="hljs-keyword">typename</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">enable_if_t</span>&lt;<span class="hljs-built_in">std</span>::is_same_v&lt;<span class="hljs-keyword">void</span>,<span class="hljs-title">decltype</span><span class="hljs-params">(function(params...))</span>&gt;,<span class="hljs-keyword">bool</span>&gt;
</span>{<font></font>
    function(<span class="hljs-built_in">std</span>::forward&lt;Params&gt;(params)...);
    <span class="hljs-keyword">return</span> check_alc_errors(filename,line,device);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> alcFunction, <span class="hljs-keyword">typename</span> ReturnType, <span class="hljs-keyword">typename</span>... Params&gt;
<span class="hljs-keyword">auto</span> <span class="hljs-title">alcCallImpl</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* filename,
                 <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line,
                 alcFunction function,
                 ReturnType&amp; returnValue,
                 ALCdevice* device, 
                 Params... params)</span>
-&gt;<span class="hljs-keyword">typename</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">enable_if_t</span>&lt;!<span class="hljs-built_in">std</span>::is_same_v&lt;<span class="hljs-keyword">void</span>,<span class="hljs-title">decltype</span><span class="hljs-params">(function(params...))</span>&gt;,<span class="hljs-keyword">bool</span>&gt;
</span>{<font></font>
    returnValue = function(<span class="hljs-built_in">std</span>::forward&lt;Params&gt;(params)...);
    <span class="hljs-keyword">return</span> check_alc_errors(filename,line,device);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最大的变化是</font></font><code>device</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有调用都使用</font><font style="vertical-align: inherit;">的包含</font><font style="vertical-align: inherit;">，</font></font><code>alc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及样式错误</font></font><code>ALCenum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>ALC_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它们看起来非常相似，并且在很长一段时间内，从很小的更改</font></font><code>al</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到</font></font><code>alc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">严重破坏了我的代码和理解，因此我只是继续在它上面继续阅读</font></font><code>c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
就这样。</font><font style="vertical-align: inherit;">通常，C ++中的OpenAL调用看起来像以下选项之一：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* example #1 */</span>
alGenSources(<span class="hljs-number">1</span>, &amp;source);<font></font>
ALenum error = alGetError();<font></font>
<span class="hljs-keyword">if</span>(error != AL_NO_ERROR)<font></font>
{<font></font>
    <span class="hljs-comment">/* handle different possibilities */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #2 */</span><font></font>
alcCaptureStart(&amp;device);<font></font>
ALCenum error = alcGetError();<font></font>
<span class="hljs-keyword">if</span>(error != ALC_NO_ERROR)<font></font>
{<font></font>
    <span class="hljs-comment">/* handle different possibilities */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #3 */</span>
<span class="hljs-keyword">const</span> ALchar* sz = alGetString(param);<font></font>
ALenum error = alGetError();<font></font>
<span class="hljs-keyword">if</span>(error != AL_NO_ERROR)<font></font>
{<font></font>
    <span class="hljs-comment">/* handle different possibilities */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #4 */</span>
<span class="hljs-keyword">const</span> ALCchar* sz = alcGetString(&amp;device, param);<font></font>
ALCenum error = alcGetError();<font></font>
<span class="hljs-keyword">if</span>(error != ALC_NO_ERROR)<font></font>
{<font></font>
    <span class="hljs-comment">/* handle different possibilities */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是现在我们可以这样做：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* example #1 */</span>
<span class="hljs-keyword">if</span>(!alCall(alGenSources, <span class="hljs-number">1</span>, &amp;source))<font></font>
{<font></font>
    <span class="hljs-comment">/* error occurred */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #2 */</span>
<span class="hljs-keyword">if</span>(!alcCall(alcCaptureStart, &amp;device))<font></font>
{<font></font>
    <span class="hljs-comment">/* error occurred */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #3 */</span>
<span class="hljs-keyword">const</span> ALchar* sz;
<span class="hljs-keyword">if</span>(!alCall(alGetString, sz, param))<font></font>
{<font></font>
    <span class="hljs-comment">/* error occurred */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #4 */</span>
<span class="hljs-keyword">const</span> ALCchar* sz;
<span class="hljs-keyword">if</span>(!alcCall(alcGetString, sz, &amp;device, param))<font></font>
{<font></font>
    <span class="hljs-comment">/* error occurred */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这对您来说似乎很奇怪，但是对我来说更方便。</font><font style="vertical-align: inherit;">当然，您可以选择其他结构。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载.wav文件</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以自己下载它们，也可以使用库。</font><font style="vertical-align: inherit;">这是</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载.wav文件的开源实现</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我疯了，所以我自己做：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span> <span class="hljs-title">convert_to_int</span><span class="hljs-params">(<span class="hljs-keyword">char</span>* buffer, <span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> len)</span>
</span>{
    <span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span> a = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">std</span>::endian::native == <span class="hljs-built_in">std</span>::endian::little)
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">memcpy</span>(&amp;a, buffer, len);
    <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">for</span>(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; len; ++i)
            <span class="hljs-keyword">reinterpret_cast</span>&lt;<span class="hljs-keyword">char</span>*&gt;(&amp;a)[<span class="hljs-number">3</span> - i] = buffer[i];
    <span class="hljs-keyword">return</span> a;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">load_wav_file_header</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::ifstream&amp; file,
                          <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span>&amp; channels,
                          <span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span>&amp; sampleRate,
                          <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span>&amp; bitsPerSample,
                          ALsizei&amp; size)</span>
</span>{
    <span class="hljs-keyword">char</span> buffer[<span class="hljs-number">4</span>];
    <span class="hljs-keyword">if</span>(!file.is_open())
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
<font></font>
    <span class="hljs-comment">// the RIFF</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read RIFF"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">strncmp</span>(buffer, <span class="hljs-string">"RIFF"</span>, <span class="hljs-number">4</span>) != <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: file is not a valid WAVE file (header doesn't begin with RIFF)"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// the size of the file</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read size of file"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// the WAVE</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read WAVE"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">strncmp</span>(buffer, <span class="hljs-string">"WAVE"</span>, <span class="hljs-number">4</span>) != <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: file is not a valid WAVE file (header doesn't contain WAVE)"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// "fmt/0"</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read fmt/0"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// this is always 16, the size of the fmt data chunk</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read the 16"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// PCM should be 1?</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">2</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read PCM"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// the number of channels</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">2</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read number of channels"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    channels = convert_to_int(buffer, <span class="hljs-number">2</span>);<font></font>
<font></font>
    <span class="hljs-comment">// sample rate</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read sample rate"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    sampleRate = convert_to_int(buffer, <span class="hljs-number">4</span>);<font></font>
<font></font>
    <span class="hljs-comment">// (sampleRate * bitsPerSample * channels) / 8</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read (sampleRate * bitsPerSample * channels) / 8"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// ?? dafaq</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">2</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read dafaq"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// bitsPerSample</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">2</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read bits per sample"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    bitsPerSample = convert_to_int(buffer, <span class="hljs-number">2</span>);<font></font>
<font></font>
    <span class="hljs-comment">// data chunk header "data"</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read data chunk header"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">strncmp</span>(buffer, <span class="hljs-string">"data"</span>, <span class="hljs-number">4</span>) != <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: file is not a valid WAVE file (doesn't have 'data' tag)"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// size of data</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read data size"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    size = convert_to_int(buffer, <span class="hljs-number">4</span>);<font></font>
<font></font>
    <span class="hljs-comment">/* cannot be at the end of file */</span>
    <span class="hljs-keyword">if</span>(file.eof())<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: reached EOF on the file"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(file.fail())<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: fail state set on the file"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">load_wav</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; filename,
               <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span>&amp; channels,
               <span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span>&amp; sampleRate,
               <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span>&amp; bitsPerSample,
               ALsizei&amp; size)</span>
</span>{
    <span class="hljs-function"><span class="hljs-built_in">std</span>::ifstream <span class="hljs-title">in</span><span class="hljs-params">(filename, <span class="hljs-built_in">std</span>::ios::binary)</span></span>;
    <span class="hljs-keyword">if</span>(!in.is_open())<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not open \""</span> &lt;&lt; filename &lt;&lt; <span class="hljs-string">"\""</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(!load_wav_file_header(in, channels, sampleRate, bitsPerSample, size))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not load wav header of \""</span> &lt;&lt; filename &lt;&lt; <span class="hljs-string">"\""</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">char</span>* data = <span class="hljs-keyword">new</span> <span class="hljs-keyword">char</span>[size];<font></font>
<font></font>
    in.read(data, size);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> data;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我不会解释代码，因为这不完全是本文的主题。</font><font style="vertical-align: inherit;">但是如果与</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WAV文件</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">规范</font></a><font style="vertical-align: inherit;">并行阅读的话很明显</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化与销毁</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，我们需要初始化OpenAL，然后像任何优秀的程序员一样，在完成使用后完成它。</font><font style="vertical-align: inherit;">它初始化期间使用</font></font><code>ALCdevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（注意，这</font></font><code>ALC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是</font></font></i> <code>AL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），基本上代表了你的计算机上播放背景音乐，并用它的东西</font></font><code>ALCcontext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<code>ALCdevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类似于选择图形卡。</font><font style="vertical-align: inherit;">OpenGL游戏将在其上渲染。</font></font><code>ALCcontext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类似于您要为OpenGL创建（以操作系统唯一的方式）的渲染上下文。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alcdevice</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
无论声音是声卡还是芯片，OpenAL设备都是通过声音输出的，但是从理论上讲，它可以有很多不同的东西。与标准输出</font></font><code>iostream</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以是打印机而不是屏幕一样，设备可以是文件，甚至是数据流。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，对于编程游戏，它将是声音设备，通常我们希望它成为系统中的标准声音输出设备。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要获取系统中可用设备的列表，可以使用以下功能请求它们：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">get_available_devices</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;&amp; devicesVec, ALCdevice* device)</span>
</span>{
    <span class="hljs-keyword">const</span> ALCchar* devices;
    <span class="hljs-keyword">if</span>(!alcCall(alcGetString, devices, device, <span class="hljs-literal">nullptr</span>, ALC_DEVICE_SPECIFIER))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
<font></font>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* ptr = devices;<font></font>
<font></font>
    devicesVec.clear();<font></font>
<font></font>
    <span class="hljs-keyword">do</span><font></font>
    {<font></font>
        devicesVec.push_back(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>(ptr));<font></font>
        ptr += devicesVec.back().size() + <span class="hljs-number">1</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">while</span>(*(ptr + <span class="hljs-number">1</span>) != <span class="hljs-string">'\0'</span>);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实际上，这只是调用周围的包装器</font></font><code>alcGetString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。返回值是指向由一个值分隔</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并以两个值结尾</font><font style="vertical-align: inherit;">的字符串列表的指针</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。在这里，包装程序将其简单地转换为对我们方便的向量。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
幸运的是，我们不需要这样做！我怀疑在一般情况下，默认情况下，大多数游戏都可以简单地将声音输出到设备，无论它是什么。我很少看到用于更改要通过其输出声音的音频设备的选项。因此，要初始化OpenAL设备，我们使用call </font></font><code>alcOpenDevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。此调用与其他调用略有不同，因为它没有指定可通过获取的错误状态</font></font><code>alcGetError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此我们将其称为普通函数：</font></font><br>
<br>
<pre><code class="cpp hljs">ALCdevice* openALDevice = alcOpenDevice(<span class="hljs-literal">nullptr</span>);
<span class="hljs-keyword">if</span>(!openALDevice)<font></font>
{<font></font>
    <span class="hljs-comment">/* fail */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您已经列出了如上所示的设备，并且希望用户选择其中之一，则需要将其名称</font></font><code>alcOpenDevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改为</font></font><code>nullptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。发送</font></font><code>nullptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">订单</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以默认打开设备</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。返回值是相应的设备，或者</font></font><code>nullptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发生错误。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
根据您是否已完成枚举，错误可能会使程序停止运行。没有设备=没有OpenAL；没有OpenAL =没有声音；没有声音=没有游戏。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
关闭程序时，我们要做的最后一件事就是正确完成它。</font></font><br>
<br>
<pre><code class="cpp hljs">ALCboolean closed;
<span class="hljs-keyword">if</span>(!alcCall(alcCloseDevice, closed, openALDevice, openALDevice))<font></font>
{<font></font>
    <span class="hljs-comment">/* do we care? */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这个阶段，如果不可能完成，那么这对我们就不再重要。在关闭设备之前，我们必须关闭所有创建的上下文，但是根据我的经验，此调用也可以完成上下文。但是我们会做对的。如果您在拨打电话之前完成了所有操作</font></font><code>alcCloseDevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则应该没有错误，并且由于某种原因而出现了错误，那么您将无能为力。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可能已经注意到，来自的呼叫</font></font><code>alcCall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发送了该设备的两个副本。发生这种情况的原因是模板函数的工作方式-一种用于错误检查，另一种用作函数参数。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从理论上讲，我可以改进模板函数，以便它传递第一个参数以进行错误检查，并仍然将其发送给函数；</font><font style="vertical-align: inherit;">但我很懒。</font><font style="vertical-align: inherit;">我将把它留作功课。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的ALC上下文</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
初始化的第二部分是上下文。</font><font style="vertical-align: inherit;">和以前一样，它类似于OpenGL的渲染上下文。</font><font style="vertical-align: inherit;">一个程序中可以有多个上下文，我们可以在它们之间切换，但是我们不需要。</font><font style="vertical-align: inherit;">每个上下文都有自己的</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">侦听器</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">源</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且不能在上下文之间传递它们。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
也许这在声音处理软件中很有用。</font><font style="vertical-align: inherit;">但是，对于99.9％的游戏而言，仅一种情况就足够了。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建一个新的上下文非常简单：</font></font><br>
<br>
<pre><code class="cpp hljs">ALCcontext* openALContext;
<span class="hljs-keyword">if</span>(!alcCall(alcCreateContext, openALContext, openALDevice, openALDevice, <span class="hljs-literal">nullptr</span>) || !openALContext)<font></font>
{<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not create audio context"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    <span class="hljs-comment">/* probably exit program */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们需要</font></font><code>ALCdevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就想要创建上下文的</font><font style="vertical-align: inherit;">内容进行沟通</font><font style="vertical-align: inherit;">；</font><font style="vertical-align: inherit;">我们还可以传递一个可选的零尾键和值列表，这些键和值</font></font><code>ALCint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是应使用上下文创建的属性。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
老实说，我什至不知道在什么情况下属性传递会派上用场。</font><font style="vertical-align: inherit;">您的游戏将在具有常规声音功能的常规计算机上运行。</font><font style="vertical-align: inherit;">属性具有默认值，具体取决于计算机，因此这并不是特别重要。</font><font style="vertical-align: inherit;">但是如果您仍然需要它：</font></font><br>
<br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性名称</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ALC_FREQUENCY</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出缓冲器的混频，以Hz为单位</font></font></td>
</tr>
<tr>
<td><code>ALC_REFRESH</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新间隔，以Hz为单位</font></font></td>
</tr>
<tr>
<td><code>ALC_SYNC</code></td>
<td><code>0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指出它应该是同步还是异步上下文</font></font></td>
</tr>
<tr>
<td><code>ALC_MONO_SOURCES</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该值有助于告诉您将使用多少个源，这些源需要能够处理单声道音频数据。</font><font style="vertical-align: inherit;">它不限制最大数量，而只是让您在事先知道这一点时更加有效。</font></font></td>
</tr>
<tr>
<td><code>ALC_STEREO_SOURCES</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相同，但用于立体声数据。</font></font></td>
</tr>
</tbody>
</table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果收到错误，则很可能是因为所需的属性不可用，或者无法为受支持的设备创建其他上下文；这是因为错误。</font><font style="vertical-align: inherit;">这将导致错误</font></font><code>ALC_INVALID_VALUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您传递的设备无效，则会出现错误</font></font><code>ALC_INVALID_DEVICE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但是，当然，我们已经在检查此错误。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建上下文还不够。</font><font style="vertical-align: inherit;">我们仍然需要使其保持最新状态-看起来像Windows OpenGL渲染上下文，对吗？</font><font style="vertical-align: inherit;">这是相同的。</font></font><br>
<br>
<pre><code class="cpp hljs">ALCboolean contextMadeCurrent = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">if</span>(!alcCall(alcMakeContextCurrent, contextMadeCurrent, openALDevice, openALContext)<font></font>
   || contextMadeCurrent != ALC_TRUE)<font></font>
{<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not make audio context current"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    <span class="hljs-comment">/* probably exit or give up on having sound */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于上下文（或其中的源和侦听器）进行任何进一步的操作，都必须使上下文成为当前上下文。</font><font style="vertical-align: inherit;">该操作将返回</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下，发送的唯一可能的误差值</font></font><code>alcGetError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是，</font></font><code>ALC_INVALID_CONTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是从名称清楚。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
完成上下文，即 </font><font style="vertical-align: inherit;">退出程序时，有必要使上下文不再是最新的，然后销毁它。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">if</span>(!alcCall(alcMakeContextCurrent, contextMadeCurrent, openALDevice, <span class="hljs-literal">nullptr</span>))<font></font>
{<font></font>
    <span class="hljs-comment">/* what can you do? */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">if</span>(!alcCall(alcDestroyContext, openALDevice, openALContext))<font></font>
{<font></font>
    <span class="hljs-comment">/* not much you can do */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
from的唯一可能错误与</font><font style="vertical-align: inherit;">- </font></font><code>alcDestroyContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相同</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您做对了所有事情，那么您将一事无成，但如果您做得正确，那么将一事无成。</font></font><code>alcMakeContextCurrent</code><font style="vertical-align: inherit;"></font><code>ALC_INVALID_CONTEXT</code><font style="vertical-align: inherit;"></font><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为什么要检查无法解决的错误？</font></font></strong><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因为我希望有关它们的消息至少出现在错误流中（对我们来说确实如此），</font></font><code>alcCall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设它永远不会给我们带来错误，但是知道这样的错误发生在其他人的计算机上将很有用。</font><font style="vertical-align: inherit;">因此，我们可以研究问题，并有可能</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向OpenAL Soft开发人员报告错误</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">播放我们的第一个声音</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好了，所有这些就足够了，让我们播放声音。</font><font style="vertical-align: inherit;">首先，我们显然需要一个声音文件。</font><font style="vertical-align: inherit;">例如，这是</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我将永远完成</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">游戏</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div class="oembed"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://indiegamedev.net/wp-content/uploads/2020/02/iamtheprotectorofthissystem.wav</font></font></a></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我是这个系统的保护者！</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
因此，打开IDE并使用以下代码。切记插入OpenAL Soft并添加上面显示的文件上传代码和错误检查代码。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{<font></font>
    ALCdevice* openALDevice = alcOpenDevice(<span class="hljs-literal">nullptr</span>);
    <span class="hljs-keyword">if</span>(!openALDevice)
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
<font></font>
    ALCcontext* openALContext;<font></font>
    <span class="hljs-keyword">if</span>(!alcCall(alcCreateContext, openALContext, openALDevice, openALDevice, <span class="hljs-literal">nullptr</span>) || !openALContext)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not create audio context"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
    }<font></font>
    ALCboolean contextMadeCurrent = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span>(!alcCall(alcMakeContextCurrent, contextMadeCurrent, openALDevice, openALContext)<font></font>
       || contextMadeCurrent != ALC_TRUE)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not make audio context current"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span> channels;
    <span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span> sampleRate;
    <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span> bitsPerSample;
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">char</span>&gt; soundData;
    <span class="hljs-keyword">if</span>(!load_wav(<span class="hljs-string">"iamtheprotectorofthissystem.wav"</span>, channels, sampleRate, bitsPerSample, soundData))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not load wav"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
    }<font></font>
<font></font>
    ALuint buffer;<font></font>
    alCall(alGenBuffers, <span class="hljs-number">1</span>, &amp;buffer);<font></font>
<font></font>
    ALenum format;<font></font>
    <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">1</span> &amp;&amp; bitsPerSample == <span class="hljs-number">8</span>)<font></font>
        format = AL_FORMAT_MONO8;<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">1</span> &amp;&amp; bitsPerSample == <span class="hljs-number">16</span>)<font></font>
        format = AL_FORMAT_MONO16;<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">2</span> &amp;&amp; bitsPerSample == <span class="hljs-number">8</span>)<font></font>
        format = AL_FORMAT_STEREO8;<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">2</span> &amp;&amp; bitsPerSample == <span class="hljs-number">16</span>)<font></font>
        format = AL_FORMAT_STEREO16;<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span>
            &lt;&lt; <span class="hljs-string">"ERROR: unrecognised wave format: "</span>
            &lt;&lt; channels &lt;&lt; <span class="hljs-string">" channels, "</span>
            &lt;&lt; bitsPerSample &lt;&lt; <span class="hljs-string">" bps"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
    }<font></font>
<font></font>
    alCall(alBufferData, buffer, format, soundData.data(), soundData.size(), sampleRate);<font></font>
    soundData.clear(); <span class="hljs-comment">// erase the sound in RAM</span><font></font>
<font></font>
    ALuint source;<font></font>
    alCall(alGenSources, <span class="hljs-number">1</span>, &amp;source);<font></font>
    alCall(alSourcef, source, AL_PITCH, <span class="hljs-number">1</span>);<font></font>
    alCall(alSourcef, source, AL_GAIN, <span class="hljs-number">1.0f</span>);<font></font>
    alCall(alSource3f, source, AL_POSITION, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<font></font>
    alCall(alSource3f, source, AL_VELOCITY, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<font></font>
    alCall(alSourcei, source, AL_LOOPING, AL_FALSE);<font></font>
    alCall(alSourcei, source, AL_BUFFER, buffer);<font></font>
<font></font>
    alCall(alSourcePlay, source);<font></font>
<font></font>
    ALint state = AL_PLAYING;<font></font>
<font></font>
    <span class="hljs-keyword">while</span>(state == AL_PLAYING)<font></font>
    {<font></font>
        alCall(alGetSourcei, source, AL_SOURCE_STATE, &amp;state);<font></font>
    }<font></font>
<font></font>
    alCall(alDeleteSources, <span class="hljs-number">1</span>, &amp;source);<font></font>
    alCall(alDeleteBuffers, <span class="hljs-number">1</span>, &amp;buffer);<font></font>
<font></font>
    alcCall(alcMakeContextCurrent, contextMadeCurrent, openALDevice, <span class="hljs-literal">nullptr</span>);<font></font>
    alcCall(alcDestroyContext, openALDevice, openALContext);<font></font>
<font></font>
    ALCboolean closed;<font></font>
    alcCall(alcCloseDevice, closed, openALDevice, openALDevice);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
编译中！</font><font style="vertical-align: inherit;">我们组成！</font><font style="vertical-align: inherit;">发射！</font></font><em><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我是这个系统的负责人</font></font></strong></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果听不到声音，请再次检查所有内容。</font><font style="vertical-align: inherit;">如果在控制台窗口中写了一些内容，那么这应该是错误流的标准输出，这一点很重要。</font><font style="vertical-align: inherit;">我们的错误报告功能应该告诉我们产生错误的源代码行。</font><font style="vertical-align: inherit;">如果发现</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误，请阅读《</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序员指南》</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规范，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以了解函数可在何种条件下生成此错误。</font><font style="vertical-align: inherit;">这将帮助您解决问题。</font><font style="vertical-align: inherit;">如果未成功，请在原始文章下发表评论，我将尽力提供帮助。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载RIFF WAVE数据</font></font></h3><br>
<pre><code class="cpp hljs"><span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span> channels;
<span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span> sampleRate;
<span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span> bitsPerSample;
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">char</span>&gt; soundData;
<span class="hljs-keyword">if</span>(!load_wav(<span class="hljs-string">"iamtheprotectorofthissystem.wav"</span>, channels, sampleRate, bitsPerSample, soundData))<font></font>
{<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not load wav"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是指wave引导代码。</font><font style="vertical-align: inherit;">重要的是，我们以指针形式或以向量形式接收数据：通道数，采样率和每个样本的位数。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲液产生</font></font></h3><br>
<pre><code class="cpp hljs">ALuint buffer;<font></font>
alCall(alGenBuffers, <span class="hljs-number">1</span>, &amp;buffer);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您曾经在OpenGL中生成纹理数据缓冲区，则可能看起来很熟悉。本质上，我们生成一个缓冲区并假装它仅存在于声卡中。实际上，它很可能存储在普通RAM中，但是OpenAL规范抽象了所有这些操作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，该值</font></font><code>ALuint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font><font style="vertical-align: inherit;">缓冲区</font><font style="vertical-align: inherit;">的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">句柄</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。请记住，</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本质上是声卡内存中的声音数据。我们不再</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接访问</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此数据，因为我们从程序（从常规RAM）中</font><em><font style="vertical-align: inherit;">获取</font></em><font style="vertical-align: inherit;">了数据并将其移至声卡/芯片等。 OpenGL的工作原理类似，将纹理数据从RAM移到VRAM。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这个</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述符</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">产生</font></font><code>alGenBuffers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它有几个可能的错误值，其中最重要的是</font></font><code>AL_OUT_OF_MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这意味着我们不再可以向声卡添加声音数据。</font><font style="vertical-align: inherit;">例如，如果使用单个缓冲区，</font><font style="vertical-align: inherit;">则不会出现</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误，但是如果要</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建engine，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则需要考虑此错误</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定音频数据的格式</font></font></h3><br>
<pre><code class="cpp hljs">ALenum format;<font></font>
<font></font>
<span class="hljs-keyword">if</span>(channels == <span class="hljs-number">1</span> &amp;&amp; bitsPerSample == <span class="hljs-number">8</span>)<font></font>
    format = AL_FORMAT_MONO8;<font></font>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">1</span> &amp;&amp; bitsPerSample == <span class="hljs-number">16</span>)<font></font>
    format = AL_FORMAT_MONO16;<font></font>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">2</span> &amp;&amp; bitsPerSample == <span class="hljs-number">8</span>)<font></font>
    format = AL_FORMAT_STEREO8;<font></font>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">2</span> &amp;&amp; bitsPerSample == <span class="hljs-number">16</span>)<font></font>
    format = AL_FORMAT_STEREO16;<font></font>
<span class="hljs-keyword">else</span><font></font>
{<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span>
        &lt;&lt; <span class="hljs-string">"ERROR: unrecognised wave format: "</span>
        &lt;&lt; channels &lt;&lt; <span class="hljs-string">" channels, "</span>
        &lt;&lt; bitsPerSample &lt;&lt; <span class="hljs-string">" bps"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
声音数据的工作方式如下：有多个</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通道</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个样本</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都有一个</font><em><font style="vertical-align: inherit;">位</font></em><font style="vertical-align: inherit;">大小</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">数据由许多</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">样本</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组成</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了确定</font><font style="vertical-align: inherit;">音频数据中</font><font style="vertical-align: inherit;">的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">样本</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数量</font><font style="vertical-align: inherit;">，我们执行以下操作：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-built_in">std</span>::<span class="hljs-keyword">int_fast32_t</span> numberOfSamples = dataSize / (numberOfChannels * (bitsPerSample / <span class="hljs-number">8</span>));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
什么可以方便地转换为计算</font><font style="vertical-align: inherit;">音频数据</font><font style="vertical-align: inherit;">的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">持续时间</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> duration = numberOfSamples / sampleRate;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，尽管我们既不需要知道</font></font><code>numberOfSamples</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，也不</font><font style="vertical-align: inherit;">需要知道</font></font><code>duration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但是了解如何使用所有这些信息很重要。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
返回</font></font><code>format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-我们需要告诉OpenAL音频数据格式。这看起来很明显，对吧？类似于填充OpenGL纹理缓冲区的方式，即数据是按BGRA序列并由8位值组成的，我们需要在OpenAL中执行相同的操作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了告诉OpenAL如何解释我们稍后将传递的指针所指向的数据，我们需要定义数据格式。在</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式下</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它意味着OpenAL可以理解。只有四种可能的含义。声道数量有两个可能的值：一个代表单声道，两个代表立体声。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
除了通道数，我们还有每个样本的位数。</font><font style="vertical-align: inherit;">它等于或</font></font><code>8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>16</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，本质上是声音质量。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，使用波浪负载功能已告知我们的每个样本的通道和比特值，我们可以确定要</font></font><code>ALenum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">哪个</font><font style="vertical-align: inherit;">参数作为将来的参数</font></font><code>format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲液填充</font></font></h3><br>
<pre><code class="cpp hljs">alCall(alBufferData, buffer, format, soundData.data(), soundData.size(), sampleRate);<font></font>
soundData.clear(); <span class="hljs-comment">// erase the sound in RAM</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这样，一切都应该很简单。</font><font style="vertical-align: inherit;">我们加载到OpenAL缓冲区，</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述符</font></font></em> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指向该缓冲区</font></font><code>buffer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">；</font><font style="vertical-align: inherit;">由ptr指向的数据</font><font style="vertical-align: inherit;">的指定</font></font><code>soundData.data()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大小</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们还将通过参数将这些数据的格式告知OpenAL </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
最后，我们仅删除波加载程序接收到的数据。</font><font style="vertical-align: inherit;">为什么？</font><font style="vertical-align: inherit;">因为我们已经将它们复制到了声卡。</font><font style="vertical-align: inherit;">我们不需要将它们存储在两个地方并花费宝贵的资源。</font><font style="vertical-align: inherit;">如果声卡丢失了数据，那么我们只需再次从磁盘下载它，而无需将其复制到CPU或其他人。</font></font><code>size</code><font style="vertical-align: inherit;"></font><code>sampleRate</code><font style="vertical-align: inherit;"></font><code>format</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来源设定</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
回想一下，OpenAL本质上是一个</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">侦听器</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它侦听一个或多个</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">源</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发出的声音</font><font style="vertical-align: inherit;">。好了，现在是创建声源的时候了。</font></font><br>
<br>
<pre><code class="cpp hljs">ALuint source;<font></font>
alCall(alGenSources, <span class="hljs-number">1</span>, &amp;source);<font></font>
alCall(alSourcef, source, AL_PITCH, <span class="hljs-number">1</span>);<font></font>
alCall(alSourcef, source, AL_GAIN, <span class="hljs-number">1.0f</span>);<font></font>
alCall(alSource3f, source, AL_POSITION, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<font></font>
alCall(alSource3f, source, AL_VELOCITY, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<font></font>
alCall(alSourcei, source, AL_LOOPING, AL_FALSE);<font></font>
alCall(alSourcei, source, AL_BUFFER, buffer);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
老实说，由于这些默认值非常适合我们，因此无需设置其中一些参数。但这向我们展示了您可以尝试并查看其工作方式的某些方面（您甚至可以狡猾地采取行动，并随着时间的推移而改变它们）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，我们生成源代码-请记住，这也是</font><font style="vertical-align: inherit;">OpenAL API内部内容的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">句柄</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。我们将音调（音调）设置为不改变，使增益（音量）等于音频数据的原始值，并重置位置和速度；我们</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会循环播放</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声音，因为否则我们的程序将永远不会结束，并指示缓冲区。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
请记住，不同的源可以使用相同的缓冲区。</font><font style="vertical-align: inherit;">例如，从不同地方射击玩家的敌人可以播放相同的射击声音，因此我们不需要太多的声音数据副本，而只需要在3D空间中的几个地方即可产生声音。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">播放声音</font></font></h3><br>
<pre><code class="cpp hljs">alCall(alSourcePlay, source);<font></font>
<font></font>
ALint state = AL_PLAYING;<font></font>
<font></font>
<span class="hljs-keyword">while</span>(state == AL_PLAYING)<font></font>
{<font></font>
    alCall(alGetSourcei, source, AL_SOURCE_STATE, &amp;state);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，我们需要开始播放源代码。</font><font style="vertical-align: inherit;">只需致电</font></font><code>alSourcePlay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后，我们创建一个值来存储</font></font><code>AL_SOURCE_STATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">源</font><font style="vertical-align: inherit;">的当前状态</font><font style="vertical-align: inherit;">并不断更新它。</font><font style="vertical-align: inherit;">当它不再相等时，</font></font><code>AL_PLAYING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以继续。</font><font style="vertical-align: inherit;">您可以将状态更改为</font></font><code>AL_STOPPED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当它完成从缓冲区发出声音时（或发生错误时）。</font><font style="vertical-align: inherit;">如果您设置looping的值</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，声音将永远播放。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后，我们可以更改源缓冲区并播放另一种声音。</font><font style="vertical-align: inherit;">或重播相同的声音等。</font><font style="vertical-align: inherit;">只需设置缓冲区，使用</font></font><code>alSourcePlay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它，</font></font><code>alSourceStop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要时</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">它</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在以下文章中，我们将更详细地考虑这一点。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清洁用品</font></font></h3><br>
<pre><code class="cpp hljs">alCall(alDeleteSources, <span class="hljs-number">1</span>, &amp;source);<font></font>
alCall(alDeleteBuffers, <span class="hljs-number">1</span>, &amp;buffer);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
由于我们只播放一次音频数据然后退出，因此我们将删除先前创建的源和缓冲区。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其余代码无需解释即可理解。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来要去哪里？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
了解本文介绍的所有内容之后，您就可以创建一个小游戏！</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试创建Pong</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他经典游戏</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为不需要它们。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但要记住！</font><font style="vertical-align: inherit;">这些缓冲区仅适用于短声音，最有可能持续几秒钟。</font><font style="vertical-align: inherit;">如果您需要音乐或声音表演，则需要将音频流传输到OpenAL。</font><font style="vertical-align: inherit;">我们将在一系列教程的以下部分中讨论这一点。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN488730/index.html">俄罗斯关于物联网，智能制造和智能城市的新标准</a></li>
<li><a href="../zh-CN488732/index.html">有才华的西蒙先生：独特的能力和3D打印如何改变生产流程</a></li>
<li><a href="../zh-CN488736/index.html">远程工作正在蓬勃发展</a></li>
<li><a href="../zh-CN488740/index.html">Simo Ahava提供的Google跟踪代码管理器的自定义HTML跟踪代码指南</a></li>
<li><a href="../zh-CN488742/index.html">看到架构了吗？我看不到，但她是</a></li>
<li><a href="../zh-CN488748/index.html">使用Django创建Todo应用程序。第1部分</a></li>
<li><a href="../zh-CN488750/index.html">恐龙漫步：20世纪的两台大型计算机</a></li>
<li><a href="../zh-CN488752/index.html">Golang + Phaser3 = MMORPG-我们为无尽的世界奠定了基础</a></li>
<li><a href="../zh-CN488754/index.html">一次全部：自动检查包装袋尺寸</a></li>
<li><a href="../zh-CN488756/index.html">如何使用新的googlesheets4包在R中使用Google Sheets API（Google Sheets API v4）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>