<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’› ğŸ‘¸ ğŸ‘ŠğŸ» ä½¿ç”¨Spring Securityå’ŒMongoDBè¿›è¡ŒREST APIèº«ä»½éªŒè¯ ğŸ® ğŸ’µ ğŸ’¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¤§å®¶å¥½ï¼ç¦»å¼€å‘¨æœ«ï¼Œæˆ‘ä»¬å°†ä¸æ‚¨åˆ†äº«ä¸€ç¯‡æ–‡ç« ï¼Œè¯¥æ–‡ç« åœ¨â€œ Spring Frameworkå¼€å‘äººå‘˜ â€è¯¾ç¨‹å¼€å§‹ä¹‹å‰è¿›è¡Œäº†ç¿»è¯‘ã€‚
 
 
 
 
 åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†RESTfulç½‘ç»œæœåŠ¡ï¼Œç°åœ¨æˆ‘ä»¬å°†è®¨è®ºå®‰å…¨æ€§
 
 ä»‹ç»
 åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº†å¦‚ä½•ä½¿ç”¨Java Spring Bootå’ŒMo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨Spring Securityå’ŒMongoDBè¿›è¡ŒREST APIèº«ä»½éªŒè¯</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/488418/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤§å®¶å¥½ï¼</font><font style="vertical-align: inherit;">ç¦»å¼€å‘¨æœ«ï¼Œæˆ‘ä»¬å°†ä¸æ‚¨åˆ†äº«ä¸€ç¯‡æ–‡ç« ï¼Œè¯¥æ–‡ç« </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨â€œ Spring Frameworkå¼€å‘äººå‘˜</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> â€è¯¾ç¨‹å¼€å§‹ä¹‹å‰è¿›è¡Œäº†ç¿»è¯‘</font><font style="vertical-align: inherit;">ã€‚</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/gw/gb/2d/gwgb2dpgmnjnjyokarjzuleni3o.png"><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†RESTfulç½‘ç»œæœåŠ¡ï¼Œç°åœ¨æˆ‘ä»¬å°†è®¨è®ºå®‰å…¨æ€§</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»‹ç»</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº†å¦‚ä½•ä½¿ç”¨Java Spring Bootå’ŒMongoDBæ¡†æ¶åˆ›å»ºREST APIã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œè¯¥APIä¸éœ€è¦ä»»ä½•èº«ä»½éªŒè¯ï¼Œè¿™æ„å‘³ç€å®ƒå¯èƒ½ä»æœªå‡†å¤‡å¥½ä½¿ç”¨ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæœ¬æŒ‡å—å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨Springå†…ç½®çš„å®‰å…¨æ€§ç¯å¢ƒå‘æ­¤APIæ·»åŠ èº«ä»½éªŒè¯çº§åˆ«ã€‚</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„APIéœ€è¦èº«ä»½éªŒè¯ï¼Ÿ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™äº›APIæä¾›äº†ä¸€ä¸ªç”¨äºä¸å†…éƒ¨æ•°æ®è¿›è¡Œäº¤äº’çš„ç®€å•æ¥å£ï¼Œå› æ­¤æ‚¨ä¸å¸Œæœ›ä»»ä½•äººæœ‰æƒè®¿é—®æ­¤æ•°æ®å¹¶è¿›è¡Œæ›´æ”¹æ˜¯å¾ˆæœ‰æ„ä¹‰çš„ã€‚</font><font style="vertical-align: inherit;">èº«ä»½éªŒè¯å¯ç¡®ä¿åªæœ‰å¯ä¿¡èµ–çš„ç”¨æˆ·æ‰èƒ½è®¿é—®APIã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ€ä¹ˆè¿è¡Œçš„</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å°†ä½¿ç”¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŸºæœ¬çš„HTTP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èº«ä»½éªŒè¯ï¼Œè¯¥èº«ä»½éªŒè¯ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç ã€‚</font><font style="vertical-align: inherit;">ç”¨æˆ·åå’Œå¯†ç ä»¥å†’å·åˆ†éš”ï¼Œæ ¼å¼å¦‚ä¸‹</font></font><code>username:password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç„¶åä½¿ç”¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Base64</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¼–ç </font><font style="vertical-align: inherit;">å¯¹è¯¥è¡Œ</font></font><code>admin:p@55w0Rd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿›è¡Œ</font><font style="vertical-align: inherit;">ç¼–ç </font><font style="vertical-align: inherit;">ï¼Œå› æ­¤è¯¥è¡Œå°†</font><font style="vertical-align: inherit;">åœ¨ä¸‹ä¸€è¡Œè¿›è¡Œç¼–ç </font></font><code>YWRtaW46cEA1NXcwUmQ=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆå°½ç®¡æˆ‘å»ºè®®ä½¿ç”¨æ¯”â€œ p @ 55w0Rdâ€æ›´å¼ºçš„å¯†ç ï¼‰ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ æ ‡å¤´å°†æ­¤èº«ä»½éªŒè¯é™„åŠ åˆ°æˆ‘ä»¬çš„è¯·æ±‚</font></font><code>Authentication</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä¸Šä¸€ä¸ªç¤ºä¾‹çš„æ ‡é¢˜å¦‚ä¸‹æ‰€ç¤ºï¼ˆå…¶ä¸­â€œåŸºæœ¬â€è¡¨ç¤ºå¯†ç ä½¿ç”¨åŸºæœ¬çš„HTTPèº«ä»½éªŒè¯ï¼‰ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">Authentication: Basic YWRtaW46cEA1NXcwUmQ=</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Springå¦‚ä½•ç®¡ç†å®‰å…¨æ€§</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Springæä¾›äº†ä¸€ä¸ªåä¸º</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Security</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„åŠ è½½é¡¹ï¼Œè¯¥åŠ è½½é¡¹</font><font style="vertical-align: inherit;">ä½¿èº«ä»½éªŒè¯é«˜åº¦å¯å®šåˆ¶ä¸”éå¸¸ç®€å•ã€‚</font><font style="vertical-align: inherit;">è®¾ç½®æ—¶ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥ä½¿ç”¨åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­å­¦åˆ°çš„ä¸€äº›æŠ€èƒ½ï¼</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦ä»€ä¹ˆ</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MongoDBå®ä¾‹ä¸­çš„ä¸€ä¸ªæ–°é›†åˆç§°ä¸ºâ€œç”¨æˆ·â€</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”¨æˆ·é›†åˆä¸­çš„ä¸€ä¸ªæ–°æ–‡æ¡£ï¼Œå…·æœ‰ä»¥ä¸‹å­—æ®µï¼ˆä»»ä½•å…¶ä»–å­—æ®µéƒ½æ˜¯å¯é€‰çš„ï¼Œä½†éƒ½æ˜¯å¿…éœ€çš„ï¼‰ï¼šç”¨æˆ·åï¼Œå¯†ç ï¼ˆä½¿ç”¨BCryptç®—æ³•æ•£åˆ—ï¼Œç¨åå†ä»‹ç»ï¼‰</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸Šä¸€ç¯‡æ–‡ç« çš„æ¥æº</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BCryptç”¨äºå¯†ç å“ˆå¸Œ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ•£åˆ—æ˜¯ä¸€ç§å•å‘åŠ å¯†ç®—æ³•ã€‚</font><font style="vertical-align: inherit;">å®é™…ä¸Šï¼Œç»è¿‡å“ˆå¸Œå¤„ç†åï¼Œå‡ ä¹ä¸å¯èƒ½å‘ç°åŸå§‹æ•°æ®çš„æ ·å­ã€‚</font><font style="vertical-align: inherit;">BCryptå“ˆå¸Œç®—æ³•é¦–å…ˆå°†ä¸€æ®µæ–‡æœ¬åŠ ç›ï¼Œç„¶åå°†å…¶å“ˆå¸Œä¸º60ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ã€‚</font><font style="vertical-align: inherit;">Java BCryptç¼–ç å™¨æä¾›äº†ä¸€ç§</font></font><code>matches</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä¸å“ˆå¸ŒåŒ¹é…çš„æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œ</font></font><code>p@55w0Rd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”¨BCryptæ•£åˆ—</font><font style="vertical-align: inherit;">çš„å¯†ç </font><font style="vertical-align: inherit;">å¯èƒ½å…·æœ‰å«ä¹‰</font></font><code>$2b$10$Qrc6rGzIGaHpbgPM5kVXdeNZ9NiyRWC69Wk/17mttHKnDR2lW49KS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å½“è°ƒç”¨</font></font><code>matches</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BCrypt </font><font style="vertical-align: inherit;">æ–¹æ³•</font><font style="vertical-align: inherit;">ä»¥è·å–æœªåŠ å¯†å’Œæ•£åˆ—çš„å¯†ç æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªvalue </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å¯ä»¥ä½¿ç”¨Spring Securityå†…ç½®çš„BCryptç¼–ç å™¨ç”Ÿæˆè¿™äº›å“ˆå¸Œã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºä»€ä¹ˆè¦å¯¹å¯†ç è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Ÿ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬éƒ½å¬è¯´è¿‡æœ€è¿‘çš„ç½‘ç»œæ”»å‡»ï¼Œè¿™äº›æ”»å‡»å¯¼è‡´å¤§å…¬å¸çš„å¯†ç è¢«ç›—ã€‚</font><font style="vertical-align: inherit;">é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆåªå»ºè®®åœ¨é»‘å®¢å…¥ä¾µåæ›´æ”¹æˆ‘ä»¬çš„å¯†ç ï¼Ÿ</font><font style="vertical-align: inherit;">å› ä¸ºè¿™äº›å¤§å…¬å¸ç¡®ä¿å¯†ç å§‹ç»ˆåœ¨å…¶æ•°æ®åº“ä¸­æ•£åˆ—ï¼</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°½ç®¡åœ¨æ­¤ç±»æ•°æ®è¢«é»‘å®¢å…¥â€‹â€‹ä¾µåæ€»æ˜¯å€¼å¾—æ›´æ”¹å¯†ç ï¼Œä½†ç”±äºå¯†ç å“ˆå¸Œæ˜¯ä¸€ç§å•å‘ç®—æ³•ï¼Œå› æ­¤å¾ˆéš¾æ‰¾åˆ°ç”¨æˆ·çš„çœŸå®å¯†ç ã€‚</font><font style="vertical-align: inherit;">å®é™…ä¸Šï¼Œ</font><font style="vertical-align: inherit;">ç ´è§£æ•£åˆ—æ­£ç¡®çš„å¤æ‚å¯†ç </font><font style="vertical-align: inherit;">å¯èƒ½éœ€è¦æ•°</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹´æ—¶é—´</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¿™ä¸ºé˜²æ­¢å¯†ç è¢«ç›—æä¾›äº†æ›´é«˜çº§åˆ«çš„ä¿æŠ¤ã€‚</font><font style="vertical-align: inherit;">Spring Securityç®€åŒ–äº†å“ˆå¸Œå¤„ç†ï¼Œå› æ­¤çœŸæ­£çš„é—®é¢˜åº”è¯¥æ˜¯ï¼šâ€œä¸ºä»€ä¹ˆä¸å‘¢ï¼Ÿâ€</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘MongoDBæ·»åŠ ç”¨æˆ·</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘å°†æ·»åŠ é›†åˆæ‰€éœ€çš„æœ€å°‘å­—æ®µ</font></font><code>users</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆç”¨æˆ·ï¼‰ï¼Œå› æ­¤æ•°æ®åº“ä¸­åŒ…å«ç”¨æˆ·çš„æ–‡æ¡£å°†ä»…åŒ…å«</font></font><code>username</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆç”¨æˆ·åï¼‰å’Œå“ˆå¸ŒBCrypt </font></font><code>password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆå¯†ç ï¼‰ã€‚</font><font style="vertical-align: inherit;">åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘çš„ç”¨æˆ·åå°†ä¸º</font></font><code>admin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå¯†ç å°†ä¸º</font></font><code>welcome1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä½†æˆ‘å»ºè®®åœ¨ç”Ÿäº§çº§APIä¸­ä½¿ç”¨æ›´å¯é çš„ç”¨æˆ·åå’Œå¯†ç ã€‚</font></font><br>
<br>
<pre><code class="java hljs">db.users.insert({<font></font>
  â€œusernameâ€ : â€œadminâ€,<font></font>
  â€œpasswordâ€ : â€œ$<span class="hljs-number">2</span>a$<span class="hljs-number">10</span>$AjHGc4x3Nez/p4ZpvFDWeO6FGxee/cVqj5KHHnHfuLnIOzC5ag4fmâ€<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™äº›æ˜¯MongoDBä¸­æ‰€éœ€çš„æ‰€æœ‰è®¾ç½®ï¼</font><font style="vertical-align: inherit;">å…¶ä½™çš„é…ç½®å°†åœ¨æˆ‘ä»¬çš„Javaä»£ç ä¸­å®Œæˆã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·»åŠ ç”¨æˆ·æ¨¡å‹å’Œå­˜å‚¨åº“</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸Šä¸€ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»äº†Mongoçš„æ¨¡å‹å’Œå­˜å‚¨åº“ï¼Œå› æ­¤åœ¨è¿™é‡Œæˆ‘ä¸ä¼šè¯¦ç»†ä»‹ç»å®ƒä»¬çš„å·¥ä½œæ–¹å¼-å¦‚æœæ‚¨æƒ³åˆ·æ–°è‡ªå·±çš„çŸ¥è¯†ï¼Œè¯·éšæ—¶è®¿é—®æˆ‘çš„ä¸Šä¸€ç¯‡æ–‡ç« ï¼</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¼ºç‚¹æ˜¯Springéœ€è¦çŸ¥é“æ–‡æ¡£</font></font><code>user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆæ¨¡å‹ï¼‰çš„</font><font style="vertical-align: inherit;">å¤–è§‚</font><font style="vertical-align: inherit;">ä»¥åŠå¦‚ä½•è®¿é—®</font></font><code>user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ•°æ®åº“ï¼ˆå­˜å‚¨åº“ï¼‰ä¸­</font><font style="vertical-align: inherit;">çš„é›†åˆ</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥å°†è¿™äº›æ–‡ä»¶åˆ†åˆ«æ”¾åœ¨æ¨¡å‹å’Œå­˜å‚¨åº“çš„åŒä¸€æ–‡ä»¶å¤¹ä¸­ï¼Œå°±åƒåœ¨ä¸Šä¸€ä¸ªç»ƒä¹ ä¸­ä¸€æ ·ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¨¡å‹</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥æ¨¡å‹å°†æ˜¯JavaåŸºç¡€ç±»å®šåˆ¶</font></font><code>_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>username</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><code>password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¯¥æ–‡ä»¶å°†è¢«å‘½åä¸º</font></font><code>Users.java</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> com.example.gtommee.rest_tutorial.models;<font></font>
<font></font>
<span class="hljs-keyword">import</span> org.bson.types.ObjectId;
<span class="hljs-keyword">import</span> org.springframework.data.annotation.Id;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Users</span> </span>{
  <span class="hljs-meta">@Id</span>
  <span class="hljs-keyword">public</span> ObjectId _id;<font></font>
<font></font>
  <span class="hljs-keyword">public</span> String username;
  <span class="hljs-keyword">public</span> String password;<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Users</span><span class="hljs-params">()</span> </span>{}<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Users</span><span class="hljs-params">(ObjectId _id, String username, String password)</span> 
</span>{
    <span class="hljs-keyword">this</span>._id = _id;
    <span class="hljs-keyword">this</span>.username = username;
    <span class="hljs-keyword">this</span>.password = password;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">set_id</span><span class="hljs-params">(ObjectId _id)</span> </span>{ <span class="hljs-keyword">this</span>._id = _id; }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">get_id</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._id.toHexString(); }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPassword</span><span class="hljs-params">(String password)</span> </span>{ <span class="hljs-keyword">this</span>.password = password; }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPassword</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> password; }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUsername</span><span class="hljs-params">(String username)</span> </span>{ <span class="hljs-keyword">this</span>.username = username; }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUsername</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> username; }<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èµ„æ–™åº“</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç³»ç»Ÿå°†è°ƒç”¨å­˜å‚¨åº“ï¼Œå…¶</font></font><code>UsersRepository.java</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤–è§‚å°†å¦‚ä¸‹æ‰€ç¤º-è®°ä½ï¼Œæˆ‘ä»¬éœ€è¦æŒ‰ç”¨æˆ·æŸ¥æ‰¾ç”¨æˆ·</font></font><code>username</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦</font></font><code>findByUsername</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å­˜å‚¨åº“æ¥å£ä¸­</font><font style="vertical-align: inherit;">åŒ…å«æ–¹æ³•</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
 <br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> com.example.gtommee.rest_tutorial.repositories;<font></font>
<font></font>
<span class="hljs-keyword">import</span> com.example.gtommee.rest_tutorial.models.Users;
<span class="hljs-keyword">import</span> org.springframework.data.mongodb.repository.MongoRepository;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UsersRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MongoRepository</span>&lt;<span class="hljs-title">Users</span>, <span class="hljs-title">String</span>&gt; </span>{
  <span class="hljs-function">Users <span class="hljs-title">findByUsername</span><span class="hljs-params">(String username)</span></span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™å°±æ˜¯æ¨¡å‹å’Œå­˜å‚¨åº“ï¼</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·»åŠ å®‰å…¨ä¾èµ–æ€§</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¡¹ç›®çš„æ ¹ç›®å½•ä¸­åº”è¯¥æœ‰ä¸€ä¸ªå¸¦æœ‰åç§°çš„æ–‡ä»¶</font></font><code>pom.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°šæœªè§¦åŠè¯¥æ–‡ä»¶ï¼Œä½†æ˜¯pomæ–‡ä»¶åŒ…å«äº†æˆ‘ä»¬é¡¹ç›®çš„æ‰€æœ‰ä¾èµ–å…³ç³»ï¼Œæˆ‘ä»¬å°†æ·»åŠ å…¶ä¸­çš„å‡ ä¸ªä¾èµ–å…³ç³»ï¼Œå› æ­¤è®©æˆ‘ä»¬ä»æ‰“å¼€è¯¥æ–‡ä»¶å¹¶å‘ä¸‹æ»šåŠ¨åˆ°tagå¼€å§‹</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">
æˆ‘ä»¬éœ€è¦çš„å”¯ä¸€æ–°ä¾èµ–å…³ç³»æ˜¯</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">spring-starter-security</font></a><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">Springæœ‰ä¸€ä¸ªå†…ç½®çš„ç‰ˆæœ¬ç®¡ç†å™¨ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»æ·»åŠ åˆ°æ ‡ç­¾ä¸­çš„ä¾èµ–é¡¹</font><font style="vertical-align: inherit;">å¦‚ä¸‹ï¼š</font></font><code><code>&lt;</code>dependencies<code>&gt;</code></code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code><code>&lt;</code>dependencies<code>&gt;</code></code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="java hljs">&lt;dependency&gt;<font></font>
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<font></font>
  &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;<font></font>
&lt;/dependency&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è€Œä¸”Mavenå°†ä¸ºæˆ‘ä»¬ä¸‹è½½æºæ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬çš„ä¾èµ–é¡¹å¿…é¡»å‡†å¤‡å°±ç»ªï¼</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ›å»ºèº«ä»½éªŒè¯æœåŠ¡</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬éœ€è¦å‘Šè¯‰Springæˆ‘ä»¬çš„ç”¨æˆ·æ•°æ®åœ¨å“ªé‡Œä»¥åŠåœ¨å“ªé‡Œæ‰¾åˆ°èº«ä»½éªŒè¯æ‰€éœ€çš„ä¿¡æ¯ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªèº«ä»½éªŒè¯æœåŠ¡ï¼ˆAuthentication Serviceï¼‰ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä»åœ¨</font></font><code>src/main/resources/java/[package name]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§°ä¸ºservices </font><font style="vertical-align: inherit;">çš„æ–°æ–‡ä»¶å¤¹å¼€å§‹</font><font style="vertical-align: inherit;">ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥åœ¨è¯¥é…ç½®æ–‡ä»¶å¤¹ä¸­ä½¿ç”¨nameåˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶</font></font><code>MongoUserDetailsService.java</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MongoUserDetailsSâ€‹â€‹ervice.java</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥è¯¾ç¨‹æœ‰ä¸€ä¸ªä¸»è¦ç»„æˆéƒ¨åˆ†ï¼Œå› æ­¤æˆ‘å°†åœ¨æ­¤å¤„æä¾›æ•´ä¸ªè¯¾ç¨‹ï¼Œç„¶ååœ¨ä¸‹é¢è¿›è¡Œè§£é‡Šï¼š</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> com.example.gtommee.rest_tutorial.services;<font></font>
<font></font>
<span class="hljs-keyword">import</span> com.example.gtommee.rest_tutorial.models.Users;
<span class="hljs-keyword">import</span> com.example.gtommee.rest_tutorial.repositories.UsersRepository;<font></font>
<font></font>
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;
<span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.User;
<span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.UserDetails;
<span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;
<span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<font></font>
<font></font>
<span class="hljs-keyword">import</span> java.util.Arrays;
<span class="hljs-keyword">import</span> java.util.List;<font></font>
<font></font>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MongoUserDetailsService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDetailsService</span></span>{
  <span class="hljs-meta">@Autowired</span>
  <span class="hljs-keyword">private</span> UsersRepository repository;<font></font>
<font></font>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> UserDetails <span class="hljs-title">loadUserByUsername</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException </span>{<font></font>
    Users user = repository.findByUsername(username);<font></font>
<font></font>
    <span class="hljs-keyword">if</span>(user == <span class="hljs-keyword">null</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UsernameNotFoundException(â€œUser not foundâ€);<font></font>
    }<font></font>
<font></font>
    List&lt;SimpleGrantedAuthority&gt; authorities = Arrays.asList(<span class="hljs-keyword">new</span> SimpleGrantedAuthority(â€œuserâ€));<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> User(user.getUsername(), user.getPassword(), authorities);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ­¤ä»£ç æ®µä»æ–‡ä»¶ä¸­æ‰€éœ€çš„å¯¼å…¥å¼€å§‹ã€‚æ­¤å¤–ï¼Œè¯¥éƒ¨åˆ†</font></font><code>implements UserDetailsService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŒ‡ç¤ºè¯¥ç±»å°†åˆ›å»ºç”¨äºæœç´¢å’ŒéªŒè¯ç”¨æˆ·çš„æœåŠ¡ã€‚ç„¶åï¼Œæ³¨é‡Š</font></font><code>@Component</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŒ‡ç¤ºè¯¥ç±»å¯ä»¥åµŒå…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼ˆä¾‹å¦‚ï¼ŒSecurityConfigurationæ–‡ä»¶ï¼Œæˆ‘ä»¬å°†é€šè¿‡å‡ ä¸ªéƒ¨åˆ†è¿›è¡Œä»‹ç»ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ³¨é‡Š</font></font><code>@Autowired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»“æŸ</font></font><code>private UsersRepository repository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;æ˜¯å®ç°çš„ç¤ºä¾‹ï¼Œæ­¤å±æ€§ä¸ºæˆ‘ä»¬æä¾›äº†</font></font><code>UsersRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å·¥ä½œ</font><font style="vertical-align: inherit;">å®ä¾‹</font><font style="vertical-align: inherit;">ã€‚æ³¨é‡Š</font></font><code>@Override</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŒ‡ç¤ºå°†ä½¿ç”¨æ­¤æ–¹æ³•ä»£æ›¿é»˜è®¤çš„UserDetailsSâ€‹â€‹erviceæ–¹æ³•ã€‚é¦–å…ˆï¼Œæ­¤æ–¹æ³•</font></font><code>Users</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨</font></font><code>findByUsername</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬åœ¨ä¸­å£°æ˜</font><font style="vertical-align: inherit;">çš„æ–¹æ³•ä»MongoDBæ•°æ®æº</font><font style="vertical-align: inherit;">è·å–å¯¹è±¡</font></font><code>UsersRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç„¶åï¼Œè¯¥æ–¹æ³•æ£€æŸ¥æ˜¯å¦æ‰¾åˆ°äº†ç”¨æˆ·ã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œå‘ç”¨æˆ·æˆäºˆæƒé™/è§’è‰²ï¼ˆè¿™å¯ä»¥ä¸ºè®¿é—®çº§åˆ«æ·»åŠ å…¶ä»–èº«ä»½éªŒè¯çº§åˆ«ï¼Œä½†æ˜¯ä¸€ä¸ªè§’è‰²è¶³ä»¥å®Œæˆæœ¬è¯¾ç¨‹ï¼‰ã€‚</font><font style="vertical-align: inherit;">æœ€åï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªSpringå¯¹è±¡</font></font><code>User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰</font></font><code>username</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><code>role</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èº«ä»½éªŒè¯çš„ç”¨æˆ·ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ›å»ºå®‰å…¨é…ç½®</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å°†éœ€è¦é‡æ–°å®šä¹‰ä¸€äº›Springçš„å†…ç½®å®‰å…¨åè®®ä»¥ä½¿ç”¨æˆ‘ä»¬çš„æ•°æ®åº“å’Œå“ˆå¸Œç®—æ³•ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç‰¹æ®Šçš„é…ç½®æ–‡ä»¶ã€‚</font><font style="vertical-align: inherit;">è¦åˆ›å»ºå®ƒï¼Œæˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹</font></font><code>src/main/resources/java/[package name]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„åç§°</font></font><code>config</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨åä¸ºæ­¤é…ç½®æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶</font></font><code>SecurityConfiguration.java</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¯¥æ–‡ä»¶åŒ…å«å‡ ä¸ªé‡è¦éƒ¨åˆ†ï¼Œå› æ­¤è®©æˆ‘ä»¬ä»SecurityConfigurationåŸºç±»å¼€å§‹ï¼š</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SecurityConfiguration.java</font></font></h4><br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> com.example.gtommee.rest_tutorial.config;<font></font>
<font></font>
<span class="hljs-keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;<font></font>
<font></font>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableConfigurationProperties</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfiguration</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>{
 <span class="hljs-meta">@Autowired</span><font></font>
 MongoUserDetailsService userDetailsService;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å·²ç»æœ‰è¶³å¤Ÿçš„ä¸œè¥¿è¦å¤„ç†äº†ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä»ä¸Šé¢å¼€å§‹ã€‚</font><font style="vertical-align: inherit;">æ³¨é‡Š</font></font><code>@Configuration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŒ‡ç¤ºè¯¥ç±»å°†åŒ…å«Java Beanï¼Œåœ¨æ­¤è¿›è¡Œè¯¦ç»†æè¿°ã€‚</font><font style="vertical-align: inherit;">æ³¨é‡Š</font></font><code>@EnableConfigurationProperties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŒ‡ç¤ºè¯¥ç±»å°†åŒ…å«ä¸ºç‰¹æ®Šé…ç½®Beançš„å†…å®¹ã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œè¯¥æŒ‡ä»¤ä¼šå°†</font></font><code>extends WebSecurityConfigurerAdapter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çˆ¶ç±»æ˜ å°„</font></font><code>WebSecurityConfigurerAdapter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°æˆ‘ä»¬çš„</font><font style="vertical-align: inherit;">é…ç½®ç±»</font><font style="vertical-align: inherit;">ï¼Œä¸ºæˆ‘ä»¬çš„ç±»æä¾›ç¡®ä¿å…¶å®‰å…¨æ€§è§„åˆ™å¾—åˆ°éµå®ˆçš„ä¸€åˆ‡å¿…è¦æ¡ä»¶ã€‚</font><font style="vertical-align: inherit;">æœ€åï¼Œè¯¥ç±»å°†è‡ªåŠ¨æ³¨å…¥ä¸€ä¸ªå®ä¾‹ï¼ˆ</font></font><code>@Autowired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰</font></font><code>MongoUserDetailsService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œæˆ‘ä»¬ç¨åå¯ä»¥åœ¨è¯¥æ–‡ä»¶ä¸­ä½¿ç”¨å®ƒã€‚</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®¤è¯æ­¥éª¤</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰Spring Securityæˆ‘ä»¬è¦å¦‚ä½•å¤„ç†ç”¨æˆ·èº«ä»½éªŒè¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Securityå…·æœ‰é¢„å®šä¹‰çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSRFä¿æŠ¤</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¼šè¯ç®¡ç†</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›ç”¨æˆ·ä½¿ç”¨å…¶ç”¨æˆ·åå’Œå¯†ç æ¥è®¿é—®æ•°æ®åº“ã€‚å¦å¤–ï¼Œç”±äºå°†åœ¨æ¯æ¬¡è¯·æ±‚æ—¶éƒ½å¯¹ç”¨æˆ·è¿›è¡Œé‡æ–°èº«ä»½éªŒè¯ï¼Œè€Œä¸æ˜¯ç™»å½•ï¼Œå› æ­¤æˆ‘ä»¬ä¸éœ€è¦CSRFä¿æŠ¤å’Œä¼šè¯ç®¡ç†ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ·»åŠ åç§°</font></font><code>configure</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦†ç›–é»˜è®¤èº«ä»½éªŒè¯æ–¹æ¡ˆçš„æ–¹æ³•æ¥ç¡®åˆ‡åœ°å‘Šè¯‰Springã€‚æˆ‘ä»¬è¦å¤„ç†èº«ä»½éªŒè¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
 http<font></font>
   .csrf().disable()<font></font>
   .authorizeRequests().anyRequest().authenticated()<font></font>
   .and().httpBasic()<font></font>
   .and().sessionManagement().disable();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŒæ ·ï¼Œè¿™é‡Œå‘ç”Ÿäº†å¾ˆå¤šäº‹æƒ…ï¼Œå› æ­¤æˆ‘ä»¬å°†åˆ†é˜¶æ®µè¿›è¡Œæ•´ç†ã€‚</font><font style="vertical-align: inherit;">æ³¨é‡Š</font></font><code>@Override</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘Šè¯‰Spring Bootä½¿ç”¨è¯¥æ–¹æ³•</font></font><code>configure (HttpSecurity http)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»£æ›¿é»˜è®¤çš„Springé…ç½®ã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œæˆ‘ä»¬ä¸º</font></font><code>http</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®é™…é…ç½®å‘ç”Ÿ</font><font style="vertical-align: inherit;">çš„å¯¹è±¡è°ƒç”¨ä¸€ç³»åˆ—æ–¹æ³•</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¿™äº›æ–¹æ³•æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</font></font><br>
<br>
<ul>
<li><code>csrf().disable()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šç¦ç”¨CSRFä¿æŠ¤ï¼Œå› ä¸ºAPIä¸éœ€è¦å®ƒ</font></font></li>
<li><code>authorizeRequests().anyRequest().authenticated()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå£°æ˜å¯¹ä»»ä½•ç«¯ç‚¹çš„æ‰€æœ‰è¯·æ±‚éƒ½å¿…é¡»å¾—åˆ°æˆæƒï¼Œå¦åˆ™å¿…é¡»è¢«æ‹’ç»ã€‚</font></font></li>
<li><code>and().httpBasic():  Spring</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œå®ƒéœ€è¦åŸºæœ¬çš„HTTPèº«ä»½éªŒè¯ï¼ˆå¦‚ä¸Šæ‰€è¿°ï¼‰ã€‚</font></font></li>
<li><code>.and().sessionManagement().disable()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå‘Šè¯‰Springä¸è¦ä¸ºç”¨æˆ·å­˜å‚¨ä¼šè¯ä¿¡æ¯ï¼Œå› ä¸ºAPIä¸éœ€è¦è¿™æ ·åš</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·»åŠ ä¸€ä¸ªBcryptç¼–ç å™¨</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨æˆ‘ä»¬éœ€è¦å‘Šè¯‰Springä½¿ç”¨BCryptç¼–ç å™¨æ¥æ•£åˆ—å’Œæ¯”è¾ƒå¯†ç -è¿™å¬èµ·æ¥å¾ˆå›°éš¾ï¼Œä½†å®é™…ä¸Šéå¸¸ç®€å•ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡ç®€å•åœ°å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ°æˆ‘ä»¬çš„ç±»ä¸­æ¥æ·»åŠ æ­¤ç¼–ç å™¨</font></font><code>SecurityConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span> </span>{
   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å’Œæ‰€æœ‰çš„å·¥ä½œï¼</font><font style="vertical-align: inherit;">è¿™ä¸ªç®€å•çš„beanå‘Šè¯‰Springæˆ‘ä»¬è¦ä½¿ç”¨çš„PasswordEncoderæ˜¯Spring Boot </font></font><code>BCryptPasswordEncoder()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥ç¼–ç å’Œæ¯”è¾ƒå¯†ç å“ˆå¸Œã€‚</font><font style="vertical-align: inherit;">Spring Bootè¿˜åŒ…æ‹¬å…¶ä»–å‡ ç§å¯†ç ç¼–ç å™¨-å¦‚æœæ‚¨æƒ³å°è¯•çš„è¯ï¼Œå»ºè®®æ‚¨å°è¯•ä½¿ç”¨å®ƒä»¬ï¼</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŒ‡å®šèº«ä»½éªŒè¯ç®¡ç†å™¨</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€åï¼Œæˆ‘ä»¬å¿…é¡»åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­</font></font><code>SecurityConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŒ‡å‡ºæˆ‘ä»¬è¦ä½¿ç”¨</font></font><code>MongoUserDetailsService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆåœ¨ä¸Šä¸€èŠ‚ä¸­åˆ›å»ºçš„ï¼‰èº«ä»½éªŒè¯ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•åšåˆ°è¿™ä¸€ç‚¹ï¼š</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder builder)</span> 
<span class="hljs-keyword">throws</span> Exception </span>{<font></font>
  builder.userDetailsService(userDetailsService);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ­¤æ–¹æ³•ä»…è¦†ç›–é»˜è®¤é…ç½®</font></font><code>AuthenticationManagerBuilder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè€Œæ˜¯æ›¿æ¢æˆ‘ä»¬è‡ªå·±çš„è‡ªå®šä¹‰æ•°æ®ä¼ è¾“æœåŠ¡ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€ç»ˆçš„SecurityConfiguration.javaæ–‡ä»¶</font></font></h3><br>
<pre><code class="java hljs"><span class="hljs-keyword">import</span> com.example.gtommee.rest_tutorial.services.MongoUserDetailsService;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;
<span class="hljs-keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
<span class="hljs-keyword">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
<span class="hljs-keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;<font></font>
<font></font>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableConfigurationProperties</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfiguration</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>{
 <span class="hljs-meta">@Autowired</span><font></font>
 MongoUserDetailsService userDetailsService;<font></font>
<font></font>
 <span class="hljs-meta">@Override</span>
 <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
   http<font></font>
     .csrf().disable()<font></font>
     .authorizeRequests().anyRequest().authenticated()<font></font>
     .and().httpBasic()<font></font>
     .and().sessionManagement().disable();<font></font>
 }<font></font>
<font></font>
 <span class="hljs-meta">@Bean</span>
 <span class="hljs-function"><span class="hljs-keyword">public</span> PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span> </span>{
   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();<font></font>
 }<font></font>
<font></font>
 <span class="hljs-meta">@Override</span>
 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder builder)</span> 
<span class="hljs-keyword">throws</span> Exception </span>{<font></font>
   builder.userDetailsService(userDetailsService);<font></font>
 }<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éªŒè¯æ£€æŸ¥</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘å°†</font></font><code>GET</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨æœ‰æ•ˆå’Œé”™è¯¯çš„èº«ä»½éªŒè¯æ¥</font><font style="vertical-align: inherit;">æµ‹è¯•å¿«é€Ÿ</font><font style="vertical-align: inherit;">è¯·æ±‚ï¼Œä»¥ç¡®ä¿é…ç½®æŒ‰è®¡åˆ’è¿›è¡Œã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸æ­£ç¡®çš„ç”¨æˆ·å/å¯†ç </font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
URLï¼š</font></font><code>http://localhost:8080/pets/</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ–¹æ³•ï¼š</font></font><code>GET</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç™»å½•ï¼š</font></font><code>Basic YWRtaW46d2VsY29tZQ==</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å›å¤ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">401 Unauthorized</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰æ•ˆçš„ç”¨æˆ·å/å¯†ç </font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
URLï¼š</font></font><code>http://localhost:8080/pets/</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ–¹æ³•ï¼š</font></font><code>GET</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç™»å½•ï¼š</font></font><code>Basic YWRtaW46d2VsY29tZTE=</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å›å¤ï¼š</font></font><br>
<br>
<pre><code class="java hljs">[<font></font>
 {<font></font>
   â€œ_idâ€: â€œ<span class="hljs-number">5</span>aeccb0a18365ba07414356câ€,<font></font>
   â€œnameâ€: â€œSpotâ€,<font></font>
   â€œspeciesâ€: â€œdogâ€,<font></font>
   â€œbreedâ€: â€œpitbullâ€<font></font>
 },<font></font>
 {<font></font>
   â€œ_idâ€: â€œ<span class="hljs-number">5</span>aeccb0a18365ba07414356dâ€,<font></font>
   â€œnameâ€: â€œDaisyâ€,<font></font>
   â€œspeciesâ€: â€œcatâ€,<font></font>
   â€œbreedâ€: â€œcalicoâ€<font></font>
 },<font></font>
 {<font></font>
   â€œ_idâ€: â€œ<span class="hljs-number">5</span>aeccb0a18365ba07414356eâ€,<font></font>
   â€œnameâ€: â€œBellaâ€,<font></font>
   â€œspeciesâ€: â€œdogâ€,<font></font>
   â€œbreedâ€: â€œaustralian shepardâ€<font></font>
 }<font></font>
]</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»“è®º</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®ƒå¯ä»¥æ­£å¸¸å·¥ä½œï¼</font><font style="vertical-align: inherit;">Spring Boot APIçš„åŸºæœ¬HTTPèº«ä»½éªŒè¯å¯èƒ½å¾ˆæ£˜æ‰‹ï¼Œä½†æ˜¯å¸Œæœ›æœ¬æŒ‡å—å°†æœ‰åŠ©äºä½¿å…¶æ›´åŠ æ˜“æ‡‚ã€‚</font><font style="vertical-align: inherit;">åœ¨å½“ä»Šçš„ç½‘ç»œç¯å¢ƒä¸­ï¼Œèº«ä»½éªŒè¯æ˜¯å¿…é¡»çš„ï¼Œå› æ­¤è¯¸å¦‚Spring Securityä¹‹ç±»çš„å·¥å…·å¯¹äºç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œå®‰å…¨æ€§è‡³å…³é‡è¦ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°±è¿™æ ·ï¼</font><font style="vertical-align: inherit;">åœ¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯¾ç¨‹</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸Šä¸æˆ‘è§é¢</font><font style="vertical-align: inherit;">ã€‚</font></font></b></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN488406/index.html">IPv6-æ‚¨åšé”™äº†</a></li>
<li><a href="../zh-CN488408/index.html">STM32ä»¥å¤ªç½‘-RS485 IoTç½‘å…³</a></li>
<li><a href="../zh-CN488410/index.html">æˆ‘åœ¨åå¹´çš„å‘å±•ä¸­å­¦åˆ°çš„7è¯¾</a></li>
<li><a href="../zh-CN488412/index.html">åŸºäºdiscord.jsåˆ›å»ºDiscordæœºå™¨äºº</a></li>
<li><a href="../zh-CN488416/index.html">SLAE-å®‰å…¨æ€§Linuxç»„è£…ä¸“å®¶è€ƒè¯•</a></li>
<li><a href="../zh-CN488422/index.html">10è¡Œä»£ç å¯å‡è½»æ‚¨çš„Vueé¡¹ç›®çš„ç—›è‹¦</a></li>
<li><a href="../zh-CN488424/index.html">2020å¹´ITSMå°†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="../zh-CN488426/index.html">å¦‚ä½•è¿›è¡Œä»£ç å®¡æŸ¥ï¼Ÿç¬¬2éƒ¨åˆ†ï¼šæŸ¥çœ‹å¯¼èˆªï¼Œé€Ÿåº¦ï¼Œè¯„è®ºï¼Œå†²çª</a></li>
<li><a href="../zh-CN488428/index.html">æˆ‘ä»¬å¦‚ä½•é¢„æµ‹Yandexæœç´¢çš„æœªæ¥ï¼šä»é”™è¯¯ä¿®å¤åˆ°å‘ç°æŸ¥è¯¢</a></li>
<li><a href="../zh-CN488432/index.html">Snoop Projectæ˜¯Internetæƒ…æŠ¥ä¸å¯æ€è®®çš„å·¥å…·ï¼ŒRuNetç”¨æˆ·å·²ç»ç­‰å¾…äº†å¾ˆé•¿æ—¶é—´-å·²æä¾›</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>