<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⏱️ ⛰️ 📸 実際のSVG。Yandexレポート 👇🏼 👞 👨🏿‍🔬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは、私の名前はArtyomです。私はYandexのインターフェイス開発グループの1人の責任者です。 1週間前、Y。Subbotnikで、SVGを使用して内部カレンダーを作成する方法について話しました。これは私のレポートの筆記録であり、カレンダーウィジェットの実装からのいくつかの物語です：スケ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>実際のSVG。Yandexレポート</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/461571/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは、私の名前はArtyomです。私はYandexのインターフェイス開発グループの1人の責任者です。 1週間前、Y。Subbotnikで、SVGを使用して内部カレンダーを作成する方法について話しました。これは私のレポートの筆記録であり、カレンダーウィジェットの実装からのいくつかの物語です：スケーリング、パターンの塗りつぶし、マスク、シンボル、フォーマット機能。</font><font style="vertical-align: inherit;">
-Yandexでは、さまざまな都市、さまざまなタイムゾーンで働いている人がたくさんいます。同僚がいつ忙しいのか、いつ会って話し合うことができるのかを理解する必要があります。私たちは見つけ出すのに役立つカレンダーをデザインすることにしました。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/af/hj/b2/afhjb2fysygwu1kqxtxppwd181k.jpeg"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もちろん、レイアウトから始めました。それはこのように見えました：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sv/5u/y0/sv5uy0sn1jwdgsv06nnvxzs2nqu.jpeg"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それは、異なるフィリングの偶数と奇数のイベントを示しています。他のイベントとオーバーラップするイベント、つまり、2番目のレイヤー-別の塗りつぶし。一日中かかるイベントは一日中ペイントします。現在時刻が下に表示されます。それが目標でした。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/98/xk/b3/98xkb3ij0xigknbxr2cuh_ceazw.jpeg"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはそれをどうするかを選び始めました。いくつかの異なるプロトタイプを作りました。私たちはcanvasから始めましたが、多くのコードがあり、手動でスケーリングして記述しました。私たちは、カレンダーが必要なだけのスペースを占めるという考えを持っていました。異なるレイアウトでは、異なる形とサイズのものです。そして、キャンバスの場合は複雑でした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この全体像を線形グラデーションで生成したときはクールなプロトタイプがありましたが、スケーリングして網膜に移動すると、外に出ました。したがって、最終的にはSVGに移行しました。どうして？まず、ドキュメントから完全に独立した座標系があるため、すべてを内部に完全に配置でき、これが何に関係なく壊れることはありません。また、スケーリングによる通常の操作もあります。ブラウザでズームインした場合でも、網膜を開いたり、カレンダーを好きなように伸ばしたりすると、画像のようにサイズが変更され、通常のように見えます。レイアウトにはセルの塗りつぶしがあり、SVGにパターンの塗りつぶしがあるのは非常に良いことです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2k/fr/gg/2kfrgg1wo76nrglcb5porf-rx88.jpeg"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
カレンダーを描画するには、いくつかのデータが必要です。レイアウトに1日を描画するには、開始日（通常は現在の日付）を把握し、水平方向の日数、垂直方向に表示する時間数、カレンダーの1日の開始時間を把握する必要があります。どういうわけかイベントを取得する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはさまざまなタイムゾーンに多くのオフィスを持っているので、イベントは常にUTCで到着し、ユーザーのタイムゾーンと個人のタイムゾーンのカレンダーを確認する必要があるため、ユーザー用にすでにそれらを表示することにしました。誰のカレンダーを見ていますか-今が夜であり、約束をしない方がいいことを理解します。赤で強調表示されているものは後で使用されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ve/zu/lf/vezulfk7ebhp9tbicgmjrahsagc.jpeg"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
基本から始めましょう。 SVGは、ベクターグラフィックスを任意に配置できる巨大な座標平面です。同時に、私たちが見る領域の一部はviewBoxによって決定され、その境界の背後にあるのは、ステロイドに隠されたオーバーフローです。それが何であれ、それは表示されません。計算を簡単にするために、カレンダーの1ピクセルを1分とすることにしました。したがって、1時間は正確に60ピクセルを占有します。さらに簡単にするために、1日の幅も60ピクセルにすることを決定しました。これにより、軍のようにすべてが正方形になります。そして、彼らはタイプセットを始めました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Viewboxは4つのパラメータで設定されます。最初の2つは、座標系の左上のポイントで、そこからviewBoxが考慮されます。ここでは、0.0です。幅は日数で60 *、高さは時間数で60 *です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
独自の座標系を内部に持つSVG内に他のSVGドキュメントを挿入することは有効です。そして、その日のイベントを縦軸に沿ってのみ配置できるようにするために、各日ごとに個別のSVGを配置し、カレンダーのその日の位置まで60 *だけ水平にシフトすることを決定しました。そうすれば、すべてのイベントをY軸に垂直に設定でき、非常に便利です。そして、1日である各SVG内に、その日の塗りつぶしを表示する四角形を配置します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この長方形は、塗りつぶし色が指定されていないため、SVGから塗りつぶしプロパティを継承します。この場合、この日は稼働しており、週末は週に2日なので、光が溢れています。これはクラスによって決定されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/81/n0/nm/81n0nmbffb0doxecq1gvx7wcc5s.jpeg"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
空白があります。次に、グリッドを追加する必要があります。カレンダーのサイズを変更する必要があり、グリッド線は常に1ピクセルである必要があるため、vector-effect = non-scaling-stroke属性を使用しました。これにより、サイズ変更やズームに関係なく、常に1ピクセルのグリッドが存在することになります。適切な量​​の水平線と垂直線を追加するだけで十分であり、そのようなグリッドがあります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yw/ok/hg/ywokhgezdap7lon0dmcuisktia8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
基本がわかったので、終日のイベントに移りましょう。これはとてもトリッキーなことです。カレンダーにイベントがあり、「終日」チェックマークがあることに気付きました。これらのイベントは、どのタイムゾーンを見ているかに関係なく、1日中開催されるという点で異なります。したがって、アラスカのタイムゾーンのごく初期のどこかでイベントが早朝に始まり、地球の反対側の48時間のどこかでイベントが継続します。複雑に聞こえますが、実装するのが最も簡単です。日付を表示されている日の日付と比較するだけです。ヒットした場合、その日のイベントを意味します。終日の2つのイベントがその日に当てはまる場合は、後で開始したイベントが表示されます。したがって、fillは1日のイベントを示します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7m/rz/wv/7mrzwvwwi6clluc6jdh4gqkfyiu.jpeg"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
他のイベントでは少し難しいです。会議があるとしましょう。それは青で塗りつぶされ、すべてが簡単です。ただし、2つの会議が連続して開催される場合、レイアウトに従って、それらを異なる色で塗りつぶします。それらは偶数と奇数です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ある会議が別の会議と交差している場合、それが上にある場合は、どうにかして表示する必要があります。会議との交差がある場合、それらはセルに完全に別々に注がれます。また、私たちをさらに楽しくするために、会議だけでなく、欠席、会議なども行っています。これらすべてをレイアウトでハードコード化したくなかったので、CSSでの構成が多かれ少なかれブラウザ間でどのように便利であるかを理解することにしました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5g/tr/tk/5gtrtkzwlyddpnutc-pifopjssq.jpeg"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今、レポート全体から最も難しい例があり、辛抱強く見て、3つのステップがあれば、それはより簡単になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
順番に始めましょう。 SVGには&lt;defs&gt;タグがあり、その中に表示されない要素を宣言できますが、参照して参照することでそれらを使用できます。まず最初に、&lt;defs&gt;を宣言してパターンを作成します。 &lt;pattern&gt;は、特定の要素を特定のパターンで埋めるために使用できるパターンを宣言できるタグです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このパターンで細胞を作る必要があります。 60 x 60ピクセルで、セルは6 x 6である必要があるため、左の図のように、12 x 12のパターンを宣言し、その中に&lt;path&gt;を描画します。線の動きを正確に示す属性dを持っています。点0,0から始まり、座標は矢印の描き方を示します。白で塗りつぶすと、次のパターンが得られます。白で塗りつぶされていないものは、黒で塗りつぶされます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vg/sw/fu/vgswfu88zuzfiawxscejq7ral5o.jpeg"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のステップに進み、マスクを宣言します。 &lt;mask&gt;は、アルファチャネルを他の要素に追加できるSVGの要素です。マスクで、マスクが適用されている要素で黒で描かれているものは、非表示で透明です。白く塗られているものは不透明です。灰色は半透明です。黒と白のパターンがあり、マスクの内側に長方形を追加して、このパターンで塗りつぶします。これでマスクができました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のステップは&lt;symbol&gt;です。これはSVGのタグで、再利用可能なグラフィックを宣言できます。ほとんどの場合、記号はアイコンなどに使用されます。ここでは、2つの長方形を配置するシンボルを宣言しています。 1つは何も塗りつぶさないので、親SVGからfillプロパティを継承し、もう1つはcurrentColorで塗りつぶし、それにマスクを適用します。これで、2つの長方形が作成されます。1つは穴があり、currentColorで塗りつぶされ、もう1つは穴がなく、塗りつぶされます。そして、彼らは互いの上に横たわっています。これらの色を同じに設定すると、塗りつぶしになります。そして異なる場合-細胞。これはすべて行った。これで、CSSを使用し、クラスを介して、すべてのイベントに2色の任意の塗りつぶしを設定できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lj/pp/la/ljpplaevfwydccmgwqm3zs0bhmq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、特定の日にカレンダーに含めるイベントを正確に決定する必要があります。タイムゾーンは+3で、全員が座っています。9〜20時間のスケールがあります。条件付きのオレンブルクに座っている人もいます。彼は+5のタイムゾーンを持ち、彼のスケールは私たちと比較して2時間オフセットされています。 UTCで予測を行います。UTCでは、ユーザーがタイムゾーンを切り替えて、自分のカレンダーに入るイベントと見ている人のカレンダーの両方を確認できるように、上から下へのこの間隔を下に表示する必要があります。 。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UTCに到着するイベントを同じUTCに配置するのが最も簡単であるため、オフセットされたこれらの番号を覚えておいてください。これを行うには、SVGのグループを示す&lt;g&gt;タグを使用し、すべてのイベントをUTCで絶対に配置します。これまたはそのタイムゾーンを表示するために必要なピクセル数だけ&lt;g&gt;をシフトします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0l/yu/jk/0lyujkyfu18dmb5kpimya6fio2w.jpeg"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この調査を要約すると、参照するシンボルがあることがわかります。イベントタイプ、レベル、パリティがあり、UTCの1日の始まりから-120分、30分の期間があります。すべてのイベントを追加することで、このような画像が得られます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ov/bi/6s/ovbi6sas81myfk1z4f2s9xlxb-4.jpeg"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在の時間も単純に行われ、同じ非スケーリングストロークエフェクトを持つラインになるため、常に単一ピクセルになります。このように表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
時間は止まらず、矢が動く必要があります。私たちが思いついた最もクールな方法はアニメーションです。矢を一日に数分ずらすアニメーションを作って、それを一日にしてみることにしました。そして、それが常にゆっくりと移動しないように、つまり、1分間に1回カチカチ音をたてるように、ステップ（）を使用しました。そして、それを追加するとすぐ、時間が動き始めました。同時に、実際には、アニメーションは常に動くことを保証しないため、遅れているか、何か他のものです。しかし、カレンダーのイベントは時々更新され、2〜3分ごと、またはユーザーがタブを離れて戻ったときに、カレンダー全体が再描画されて時刻が更新されます。したがって、アニメーションが表示されるのは、座っていて、カチカチ動いているかどうかに関係なく熱心に見ているときだけです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ui/82/pq/ui82pqjamllc_ee-1ng6d0ujbh4.jpeg"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題が1つあります。ここでは、カレンダーをより広くして、生産中のカレンダーのように見せました。細胞がもはや正方形ではないことが明らかになりました。これは、縦横比が維持されないためです。縦横比を物理的にストレッチまたは変更すると、図のように変化します。これを回避するには、少しJSを書く必要があります。オリジナルのSVGにあったアスペクト比viewBoxと、レイアウトで使用される実際のアスペクト比があります。これらの比率の比率を見つけて、それをパターンの変換に入れると、セルは正方形になります。また、ここで取得したこの係数は、ユーザーがクリックした場所を理解したい場合に使用できます。元のSVGの1分間は1ピクセルであるため、クリックの座標にこの係数を掛けると理解できます。ユーザーが取得した時間。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/e2/oz/gh/e2ozghfj0zoqbzcfz57anw9ycba.jpeg"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上部に文字と数字があるようにHTMLを追加するために残ります。</font><font style="vertical-align: inherit;">カレンダーを取得します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pu/xh/o9/puxho9vkcjuawtkaa9mpf0kadzi.jpeg" width="350"> <img src="https://habrastorage.org/webt/sq/bl/cc/sqblcctralj1csyh_putsqfszh4.jpeg" width="394"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、これは、タイムゾーン+5に座っているユーザーの目を通して本番環境に見えます。</font><font style="vertical-align: inherit;">以下は私の同僚が押すトグルスイッチで、カレンダーはタイムゾーンで移動します。</font><font style="vertical-align: inherit;">次に、彼はイベントをクリックし、土曜日のタイムゾーン+5で、つまり現在、私のレポートがオンになっていることを確認します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jt/bz/x9/jtbzx9epd4it3m5fbys7yf0waew.jpeg"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらにいくつかの例。</font><font style="vertical-align: inherit;">こちらが開発者のカレンダーです。彼はスタンドアップ、いくつかの定例会議を行っています。</font><font style="vertical-align: inherit;">こちらがマネージャーのカレンダーです。</font><font style="vertical-align: inherit;">そして、こちらがデザイナーです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CSSを使用し、SVGを使用します。</font><font style="vertical-align: inherit;">感謝！</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja461561/index.html">Arduinoタイマー</a></li>
<li><a href="../ja461563/index.html">ライトセーバー自家製銅蒸気レーザー-パート3、最終</a></li>
<li><a href="../ja461565/index.html">TypeScript開発者の5つの戒め</a></li>
<li><a href="../ja461567/index.html">SQL 面白いパズル</a></li>
<li><a href="../ja461569/index.html">フロントエンドに関する注意：テスト前に確認すべきこと</a></li>
<li><a href="../ja461575/index.html">OpenStackと互換性のあるホスティングで3CXクラウドベースのPBXを作成する</a></li>
<li><a href="../ja461577/index.html">パート5/2ビル。1：RocketChip Avenueの交差点と滑りやすい計装トラック</a></li>
<li><a href="../ja461579/index.html">WebMoneyは新しいWMPウォレットを導入し、ゲームのルールを変更します</a></li>
<li><a href="../ja461583/index.html">構造製品のテストに役立つPython</a></li>
<li><a href="../ja461587/index.html">10ステップでのアプリケーションのローカリゼーション</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>