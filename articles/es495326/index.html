<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö∂üèæ üë∑üèº ‚õ∑Ô∏è ¬øC√≥mo hicimos el n√∫cleo del negocio de inversi√≥n de Alfa-Bank basado en Tarantool üè∫ ‚úåüèæ ü§∑üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Una foto de la pel√≠cula "Nuestro universo secreto: la vida oculta de la c√©lula"
 
 El negocio de inversiones es una de las √°reas m√°s dif√≠ciles en el m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>¬øC√≥mo hicimos el n√∫cleo del negocio de inversi√≥n de Alfa-Bank basado en Tarantool</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/495326/"><img src="https://habrastorage.org/webt/tc/or/26/tcor26cmqrsph9b0nioj_ic4cwa.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una foto de la pel√≠cula "Nuestro universo secreto: la vida oculta de la c√©lula"</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
El negocio de inversiones es una de las √°reas m√°s dif√≠ciles en el mundo bancario, porque no solo hay pr√©stamos, pr√©stamos y dep√≥sitos, sino tambi√©n valores, divisas, bienes, derivados y Todo tipo de dificultades en forma de productos estructurales.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recientemente, hemos visto un aumento en la educaci√≥n financiera de la poblaci√≥n. Cada vez m√°s personas participan en el comercio en los mercados de valores. Las cuentas de inversi√≥n individuales aparecieron no hace mucho tiempo. Le permiten operar en los mercados de valores y, al mismo tiempo, recibir deducciones fiscales o no pagar impuestos. Y todos los clientes que acuden a nosotros desean administrar su cartera y ver informes en tiempo real. Adem√°s, la mayor√≠a de las veces este portafolio es multiproducto, es decir, las personas son clientes de varias l√≠neas de negocios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, los requisitos de los reguladores, tanto rusos como extranjeros, est√°n creciendo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para satisfacer las necesidades actuales y sentar las bases para futuras actualizaciones, hemos desarrollado el n√∫cleo del negocio de inversi√≥n basado en Tarantool.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algunas estad√≠sticas. </font><font style="vertical-align: inherit;">El negocio de inversi√≥n de Alfa-Bank ofrece servicios de corretaje para individuos y entidades legales para brindar oportunidades de comercio en varios mercados de valores, servicios de custodia para el almacenamiento de valores, servicios de administraci√≥n de fideicomisos para individuos con capital privado y de gran capital, servicios de emisi√≥n de valores para otras compa√±√≠as. </font><font style="vertical-align: inherit;">El negocio de inversi√≥n de Alfa-Bank es de m√°s de 3 mil cotizaciones por segundo, que se descargan de varias plataformas de negociaci√≥n. </font><font style="vertical-align: inherit;">Durante la jornada laboral, se realizan m√°s de 300 mil transacciones en los mercados en nombre del banco o de sus clientes. </font><font style="vertical-align: inherit;">En plataformas externas e internas, se ejecutan hasta 5 mil √≥rdenes por segundo. </font><font style="vertical-align: inherit;">Al mismo tiempo, todos los clientes, tanto internos como externos, desean ver sus posiciones en tiempo real.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antecedentes</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En alg√∫n lugar desde principios de la d√©cada de 2000, nuestras √°reas de negocios de inversi√≥n se han desarrollado de manera independiente: negociaci√≥n de bolsa, servicios de corretaje, negociaci√≥n de divisas, negociaci√≥n de valores y otros derivados sin receta. Como resultado, ca√≠mos en la trampa de los pozos funcionales. ¬øLo que es? Cada l√≠nea de negocio tiene sus propios sistemas que duplican las funciones de cada uno. Cada sistema tiene su propio modelo de datos, aunque operan con los mismos conceptos: transacciones, instrumentos, contrapartes, cotizaciones y m√°s. Y como cada sistema se desarroll√≥ de forma independiente, surgi√≥ un zool√≥gico diverso de tecnolog√≠as. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, la base de c√≥digo de los sistemas ya est√° desactualizada, porque algunos productos se originaron a mediados de la d√©cada de 1990. Y en algunas √°reas, ralentiz√≥ el proceso de desarrollo, hubo problemas con la productividad.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nuevos requisitos de soluci√≥n</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las empresas se dieron cuenta de que el desarrollo tecnol√≥gico es vital para un mayor desarrollo. </font><font style="vertical-align: inherit;">Nos asignaron las tareas:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recopile todos los datos comerciales en un √∫nico almacenamiento r√°pido y en un solo modelo de datos. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No debemos perder ni modificar esta informaci√≥n. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es necesario versionar los datos, porque en cualquier momento el regulador puede solicitar estad√≠sticas de a√±os anteriores. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No solo debemos traer algunos DBMS nuevos y modernos, sino crear una plataforma para resolver problemas comerciales. </font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, nuestros arquitectos establecen sus condiciones: </font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La nueva soluci√≥n deber√≠a ser de clase empresarial, es decir, ya deber√≠a haber sido probada en algunas grandes empresas. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El modo de operaci√≥n de la soluci√≥n debe ser de misi√≥n cr√≠tica. </font><font style="vertical-align: inherit;">Esto significa que debemos estar presentes al mismo tiempo en varios centros de datos y experimentar con tranquilidad la desconexi√≥n de un centro de datos.</font></font></li>
<li>    .   ,        ,       -    .   ,         . </li>
<li>    ,     . </li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seguimos el camino est√°ndar: formulamos requisitos y contactamos al departamento de compras. De all√≠ obtuvimos una lista de compa√±√≠as que, en general, est√°n listas para que hagamos esto. Les contaron a todos sobre la tarea, y seis de ellos recibieron una evaluaci√≥n de las soluciones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el banco no creemos la palabra de nadie, nos encanta probar todo por nuestra cuenta. Por lo tanto, un requisito previo de nuestra licitaci√≥n era pasar las pruebas de estr√©s. Formulamos tareas de prueba para la carga, y ya tres de cada seis compa√±√≠as acordaron a su propio costo implementar un prototipo de la soluci√≥n basada en tecnolog√≠as en memoria para probarlo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No dir√© c√≥mo probamos todo y cu√°nto tiempo llev√≥, solo resumir√©: el prototipo de la soluci√≥n basada en Tarantool del equipo de desarrollo del Grupo Mail.ru mostr√≥ el mejor rendimiento en las pruebas de carga. </font><font style="vertical-align: inherit;">Firmamos un contrato y comenzamos el desarrollo. </font><font style="vertical-align: inherit;">Cuatro personas eran del Grupo Mail.ru, y de Alfa-Bank hab√≠a tres desarrolladores, tres analistas de sistemas, un arquitecto de soluciones, un propietario de productos y un maestro Scrum. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, hablar√© sobre c√≥mo creci√≥ nuestro sistema, c√≥mo evolucion√≥, qu√© hicimos y por qu√©.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desarrollo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En primer lugar, nos preguntamos c√≥mo obtener datos de nuestros sistemas actuales. Decidimos que HTTP es bastante adecuado para nosotros, porque todos los sistemas actuales se comunican entre s√≠, enviando XML o JSON a trav√©s de HTTP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilizamos el servidor HTTP incorporado de Tarantool, porque no necesitamos terminar las sesiones SSL, y su rendimiento es suficiente para nosotros.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como ya dije, tenemos todos los sistemas viviendo en diferentes modelos de datos, y en la entrada necesitamos llevar el objeto al modelo que describiremos en casa. Se necesitaba un lenguaje para transformar los datos. Elegimos el imperativo Lua. Ejecutamos todo el c√≥digo para la conversi√≥n de datos en el entorno limitado: este es un lugar seguro, m√°s all√° del cual el c√≥digo en ejecuci√≥n no va m√°s all√°. Para hacer esto, simplemente haga una cadena de carga del c√≥digo necesario, creando un entorno con funciones que no puedan bloquear nada o soltar algo.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4e3/04c/45f/4e304c45ff56974d624be577ebb8258d.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de la conversi√≥n, se debe verificar que los datos cumplan con el modelo que estamos creando. </font><font style="vertical-align: inherit;">Discutimos durante mucho tiempo qu√© modelo deber√≠a ser, qu√© lenguaje usar para describirlo. </font><font style="vertical-align: inherit;">Nos detuvimos en Apache Avro, porque el lenguaje es simple y tiene soporte de Tarantool. </font><font style="vertical-align: inherit;">Las nuevas versiones del modelo y el c√≥digo de usuario pueden ponerse en funcionamiento varias veces al d√≠a, incluso bajo carga, incluso sin, en cualquier momento del d√≠a, y adaptarse muy r√°pidamente a los cambios.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d28/172/bea/d28172beab19e37ef1fd30597d21d321.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de la verificaci√≥n, los datos deben guardarse. </font><font style="vertical-align: inherit;">Hacemos esto con vshard (tenemos r√©plicas geoespaciadas de fragmentos).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d5a/619/7b4/d5a6197b44b2d8f1f43b33004241f221.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, los detalles son tales que para la mayor√≠a de los sistemas que nos env√≠an datos, no importa si los recibimos o no. Por lo tanto, desde el principio implementamos la l√≠nea de reparaci√≥n. ¬øLo que es? Si por alguna raz√≥n el objeto no pas√≥ la transformaci√≥n o verificaci√≥n de datos, entonces todav√≠a confirmamos la recepci√≥n, pero al mismo tiempo guardamos el objeto en la cola de reparaci√≥n. Es coherente, ubicado en el repositorio principal con datos comerciales. Inmediatamente escribimos una interfaz de administrador para ello, varias m√©tricas y alertas. Como resultado, no perdemos datos. Incluso si algo ha cambiado en la fuente, si el modelo de datos ha cambiado, lo encontraremos inmediatamente y podremos adaptarlo.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7ad/2a7/c23/7ad2a7c235467068ccec89b9eb025b12.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora necesita aprender c√≥mo recuperar los datos almacenados. Analizamos cuidadosamente nuestros sistemas y vimos que en la pila cl√°sica de Java y Oracle siempre hay alg√∫n tipo de ORM que convierte los datos de una vista relacional a una de objeto. Entonces, ¬øpor qu√© no dar inmediatamente objetos a los sistemas en forma de gr√°fico? Por lo tanto, con mucho gusto tomamos GraphQL, que satisfizo todas nuestras necesidades. Le permite recibir datos en forma de gr√°ficos, para extraer solo lo que necesita en este momento. Incluso puede versionar la API con suficiente flexibilidad.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d90/636/a7a/d90636a7ac34c91eefd299a88d902d44.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Casi de inmediato, nos dimos cuenta de que los datos extra√≠dos no eran suficientes para nosotros. </font><font style="vertical-align: inherit;">Realizamos funciones que se pueden adjuntar a objetos en el modelo, de hecho, campos calculados. </font><font style="vertical-align: inherit;">Es decir, asignamos una determinada funci√≥n al campo, que, por ejemplo, considera el precio promedio de una cotizaci√≥n. </font><font style="vertical-align: inherit;">Y el consumidor externo que solicita los datos ni siquiera sabe que este campo est√° calculado.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f77/51f/ce9/f7751fce9a424fa80aba0c701cb9295e.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Implementado un sistema de autenticaci√≥n. </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/768/d24/2f7/768d242f7825460594a79ff0c3e07449.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego notaron que varios roles cristalizaron en nuestra soluci√≥n. </font><font style="vertical-align: inherit;">Un rol es un tipo de agregador de funciones. </font><font style="vertical-align: inherit;">Como regla, los roles tienen diferentes perfiles de uso de equipos:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T-Connect: maneja las conexiones entrantes, limitadas por el procesador, consume poca memoria, no almacena el estado.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IB-Core: transforma los datos que recibe a trav√©s del protocolo Tarantool, es decir, funciona con tabletas. </font><font style="vertical-align: inherit;">Tampoco almacena el estado y puede escalarse.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Almacenamiento: solo guarda datos, no utiliza ninguna l√≥gica. </font><font style="vertical-align: inherit;">Las interfaces m√°s simples se implementan en este rol. </font><font style="vertical-align: inherit;">Escalable gracias a vshard.</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/292/66e/613/29266e613da2a34c5df9463884873267.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es decir, con la ayuda de roles, nos desligamos unas de otras partes del cl√∫ster que se pueden escalar de forma independiente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, creamos un registro asincr√≥nico de un flujo de datos transaccionales y una cola de reparaci√≥n con una interfaz de administrador. </font><font style="vertical-align: inherit;">La grabaci√≥n es as√≠ncrona desde el punto de vista comercial: si tenemos la garant√≠a de registrar datos para nosotros mismos, sin importar d√≥nde, lo confirmaremos. </font><font style="vertical-align: inherit;">Si no se confirma, entonces algo sali√≥ mal, los datos deben enviarse. </font><font style="vertical-align: inherit;">Esta es una grabaci√≥n asincr√≥nica.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pruebas</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desde el comienzo del proyecto, se decidi√≥ que intentar√≠amos inculcar el desarrollo basado en pruebas. Escribimos pruebas unitarias en Lua usando el marco tarantool / tap, pruebas de integraci√≥n en Python usando el marco pytest. Al mismo tiempo, tanto los desarrolladores como los analistas participan en la redacci√≥n de pruebas de integraci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo aplicamos el desarrollo basado en pruebas? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si queremos alguna caracter√≠stica nueva, primero tratamos de escribir una prueba para ello. Despu√©s de descubrir el error, primero debemos escribir en la prueba, y solo luego corregirlo. Al principio, es dif√≠cil trabajar as√≠, hay un malentendido por parte de los empleados, incluso sabotaje: "Arreglemos r√°pidamente ahora, hagamos algo nuevo y luego cubramos con pruebas". Solo que este "posterior" casi nunca ocurre.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, primero debe obligarse a escribir pruebas, pedir a otros que lo hagan. Cr√©ame, el desarrollo basado en pruebas es beneficioso incluso a corto plazo. Sentir√°s que te ha resultado m√°s f√°cil vivir. Seg√∫n nuestros sentimientos, el 99% del c√≥digo est√° cubierto por pruebas ahora. Parece mucho, pero no tenemos problemas: las pruebas se ejecutan en cada confirmaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, sobre todo nos encantan las pruebas de estr√©s, lo consideramos el m√°s importante y lo realizamos regularmente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Te contar√© una breve historia sobre c√≥mo realizamos la primera etapa de prueba de carga de una de las primeras versiones. Pusimos el sistema en la computadora port√°til del desarrollador, encendimos la carga y recibimos 4 mil transacciones por segundo. Buen resultado para una computadora port√°til. Ponemos un soporte de carga virtual de cuatro servidores, m√°s d√©bil que en producci√≥n. Implementado al m√≠nimo. Lo iniciamos y obtenemos un resultado peor que en una computadora port√°til en un hilo. Contenido de choque. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Est√°bamos muy tristes. Observamos la carga del servidor y resultan inactivos.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a0b/eba/0fa/a0beba0fad0ba7e8f0cf333ef8366948.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Llamamos a los desarrolladores, y nos explican, personas que han venido del mundo de Java, que Tarantool es de un solo subproceso. </font><font style="vertical-align: inherit;">Puede ser utilizado efectivamente por un solo n√∫cleo de procesador bajo carga. </font><font style="vertical-align: inherit;">Luego, desplegamos el n√∫mero m√°ximo posible de instancias de Tarantool en cada servidor, encendimos la carga y recibimos ya 14.5 mil transacciones por segundo.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/67f/8ca/e14/67f8cae14bea588f5018d4406f99c23c.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo explicar√© nuevamente. </font><font style="vertical-align: inherit;">Debido a la divisi√≥n en roles que usan los recursos de manera diferente, nuestros roles que fueron responsables de procesar las conexiones y la transformaci√≥n de datos solo cargaron el procesador, y fue estrictamente proporcional a la carga.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9d1/822/cb3/9d1822cb3dcacd91f3f9fd7dbb7c9f7c.jpg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1f0/566/1b4/1f05661b4e5b7806867849b060dc23b7.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, la memoria se us√≥ solo para procesar conexiones entrantes y objetos temporales.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/16e/e79/f9f/16ee79f9fbfd6157c7df6edd66b90535.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por el contrario, en los servidores de almacenamiento, la carga del procesador creci√≥, pero mucho m√°s lentamente que en los servidores que manejan conexiones. </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/18b/0ad/d2d/18b0add2da6deda36388ca9b0f07594b.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y el consumo de memoria creci√≥ en proporci√≥n directa a la cantidad de datos cargados. </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e21/697/e05/e21697e0521f54530aa7c50227297af1.jpg"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servicios</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para desarrollar nuestro nuevo producto espec√≠ficamente como una plataforma de aplicaci√≥n, creamos un componente para implementar servicios y bibliotecas en √©l. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los servicios no son solo peque√±as piezas de c√≥digo que operan en algunos campos. </font><font style="vertical-align: inherit;">Pueden ser dise√±os bastante grandes y complejos que forman parte del cl√∫ster, verifican los datos de referencia, tuercen la l√≥gica empresarial y dan respuestas. </font><font style="vertical-align: inherit;">Tambi√©n exportamos el esquema de servicio a GraphQL, y el consumidor recibe un punto de acceso a datos universal, con introspecci√≥n en todo el modelo. </font><font style="vertical-align: inherit;">Es muy c√≥modo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que los servicios contienen muchas m√°s funciones, decidimos que deber√≠a haber bibliotecas en las que eliminaremos el c√≥digo utilizado con frecuencia. </font><font style="vertical-align: inherit;">Los agregamos a un entorno seguro, despu√©s de comprobar que esto no nos rompe nada. </font><font style="vertical-align: inherit;">Y ahora podemos establecer funciones para entornos adicionales en forma de bibliotecas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quer√≠amos que tuvi√©ramos una plataforma no solo para el almacenamiento, sino tambi√©n para la inform√°tica. </font><font style="vertical-align: inherit;">Y como ya ten√≠amos un mont√≥n de r√©plicas y fragmentos, implementamos una apariencia de computaci√≥n distribuida y la llamamos reducci√≥n de mapa, porque result√≥ ser como la reducci√≥n de mapa original.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sistemas antiguos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No todos nuestros sistemas antiguos pueden llamarnos a trav√©s de HTTP y usar GraphQL, aunque son compatibles con este protocolo. </font><font style="vertical-align: inherit;">Por lo tanto, creamos un mecanismo para replicar datos en estos sistemas.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f5d/6e5/e33/f5d6e5e33b10e605cf7c6c5befd4aa07.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si algo cambia para nosotros, los desencadenantes peculiares funcionan en el rol de Almacenamiento y el mensaje con los cambios cae en la cola de procesamiento. </font><font style="vertical-align: inherit;">Se env√≠a a un sistema externo utilizando un rol de replicador separado. </font><font style="vertical-align: inherit;">Este rol no almacena el estado.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nuevas mejoras</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como recordar√°, desde una perspectiva comercial, realizamos una grabaci√≥n asincr√≥nica. </font><font style="vertical-align: inherit;">Pero luego se dieron cuenta de que no ser√≠a suficiente, porque hay una clase de sistemas que necesitan recibir inmediatamente una respuesta sobre el estado de la operaci√≥n. </font><font style="vertical-align: inherit;">Por lo tanto, hemos expandido nuestro GraphQL y agregado mutaciones. </font><font style="vertical-align: inherit;">Se ajustan org√°nicamente al paradigma existente de trabajar con datos. </font><font style="vertical-align: inherit;">Tenemos un √∫nico punto de lectura y escritura para otra clase de sistemas.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/395/562/ef7/395562ef7191842f4dc9526dae8c0661.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n nos dimos cuenta de que los servicios por s√≠ solos no ser√≠an suficientes para nosotros, porque hay informes bastante pesados ‚Äã‚Äãque deben construirse una vez al d√≠a, una semana o un mes. Esto puede llevar mucho tiempo e incluso los informes pueden bloquear el bucle de eventos de Tarantool. Por lo tanto, hicimos roles separados: planificador y corredor. Los corredores no almacenan estado. Lanzan tareas dif√≠ciles, que no podemos contar sobre la marcha. Y la funci√≥n de planificador supervisa la planificaci√≥n para iniciar estas tareas, que se describe en la configuraci√≥n. Las tareas mismas se almacenan en el mismo lugar que los datos comerciales. Cuando llega el momento adecuado, el planificador toma la tarea, se la da a alg√∫n corredor, la considera y guarda el resultado.</font></font><br>
 <br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fb1/bbf/123/fb1bbf12343d40bab27a87b5f1021f0d.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No todas las tareas deben ejecutarse seg√∫n lo programado. </font><font style="vertical-align: inherit;">Algunos informes deben leerse a pedido. </font><font style="vertical-align: inherit;">Tan pronto como llega este requisito, se forma una tarea en el sandbox y se env√≠a al corredor para su ejecuci√≥n. </font><font style="vertical-align: inherit;">Despu√©s de un tiempo, el usuario recibe una respuesta asincr√≥nica de que todo se calcul√≥, el informe est√° listo.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/13f/27e/db0/13f27edb0711b735602d77c7c54c4d38.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inicialmente, nos adherimos al paradigma de guardar todos los datos, versionarlos y no eliminarlos. </font><font style="vertical-align: inherit;">Pero en la vida, de vez en cuando, todav√≠a tiene que eliminar algo, principalmente informaci√≥n cruda o intermedia. </font><font style="vertical-align: inherit;">Basado en el vencimiento, creamos un mecanismo para limpiar el almacenamiento de datos obsoletos.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4d9/1aa/e8d/4d91aae8daf9c27437ca9ed57574e349.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n entendemos que tarde o temprano se producir√° una situaci√≥n en la que no habr√° suficiente espacio para almacenar datos en la memoria, pero sin embargo, los datos deben almacenarse. </font><font style="vertical-align: inherit;">Para estos fines, pronto haremos almacenamiento en disco.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/13a/10e/7da/13a10e7da6c77907d88504ee20fbb62c.jpg"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusi√≥n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comenzamos con la tarea de cargar datos en un solo modelo, pasamos tres meses en su desarrollo. Ten√≠amos seis sistemas de proveedores de datos. El c√≥digo de transformaci√≥n completo en un solo modelo es de aproximadamente 30 mil l√≠neas en Lua. Y la mayor parte del trabajo est√° por venir. A veces hay una falta de motivaci√≥n para los equipos vecinos, lo que complica mucho el trabajo de las circunstancias. Si alguna vez enfrenta un problema similar, entonces el tiempo que cree que es normal para su implementaci√≥n, multiplique por tres, o incluso cuatro.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recuerde tambi√©n que los problemas existentes en los procesos comerciales no pueden resolverse con la ayuda de un nuevo DBMS, incluso si es muy productivo. ¬øLo que quiero decir? Al comienzo de nuestro proyecto, creamos una impresi√≥n entre los clientes de que ahora traeremos una nueva base de datos r√°pida y en vivo. Los procesos ir√°n m√°s r√°pido, todo estar√° bien. De hecho, la tecnolog√≠a no resuelve los problemas que existen en los procesos comerciales, porque los procesos comerciales son personas. Y necesita trabajar con personas, no con tecnolog√≠a. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El desarrollo a trav√©s de pruebas en las etapas iniciales puede ser doloroso y llevar mucho tiempo. Pero el efecto positivo ser√° notable incluso a corto plazo, cuando no necesite hacer nada para realizar pruebas de regresi√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es extremadamente importante realizar pruebas de carga en todas las etapas de desarrollo. Cuanto antes note alg√∫n tipo de falla en la arquitectura, m√°s f√°cil ser√° solucionarlo, esto le ahorrar√° mucho tiempo en el futuro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No hay nada malo con Lua. Cualquiera puede aprender a escribir en √©l: un desarrollador de Java, un desarrollador de JavaScript, un desarrollador de Python, un front-end o back-end. Incluso tenemos analistas que escriben sobre eso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando hablamos del hecho de que no tenemos SQL, esto aterroriza a las personas. "¬øC√≥mo se obtienen datos sin SQL?" ¬øEs eso posible? " Por supuesto. En un sistema de clase OLTP, no se necesita SQL. Existe una alternativa en forma de lenguaje que le devuelve una vista inmediatamente orientada a documentos. Por ejemplo, GraphQL. Y hay una alternativa en forma de computaci√≥n distribuida.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si comprende que necesitar√° escalar, entonces dise√±e su soluci√≥n en Tarantool, inmediatamente, de modo que pueda funcionar en paralelo en docenas de instancias de Tarantool. </font><font style="vertical-align: inherit;">Si no lo hace, ser√° dif√≠cil y doloroso, ya que Tarantool puede usar eficientemente solo un n√∫cleo de procesador.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es495304/index.html">Rejuvenecimiento de c√©lulas humanas debido a su reprogramaci√≥n</a></li>
<li><a href="../es495308/index.html">Rastrillo en el camino para mantenerse vivo</a></li>
<li><a href="../es495310/index.html">Recorrido electr√≥nico: biometr√≠a y multiformato</a></li>
<li><a href="../es495312/index.html">Seguridad perimetral: el futuro es ahora</a></li>
<li><a href="../es495314/index.html">¬øC√≥mo filtrar la informaci√≥n err√≥nea si proviene de fuentes oficiales?</a></li>
<li><a href="../es495330/index.html">Merecida popularidad en n√∫meros</a></li>
<li><a href="../es495332/index.html">Cuarteto 9: Allegro | Mecanografiado</a></li>
<li><a href="../es495336/index.html">Discord como mensajero corporativo y no solo</a></li>
<li><a href="../es495338/index.html">Mejores pr√°cticas y pautas para lanzar contenedores y Kubernetes en entornos de producci√≥n</a></li>
<li><a href="../es495340/index.html">C√≥mo cambiar el trabajo de un administrador en un restaurante por un buen trabajo en TI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>