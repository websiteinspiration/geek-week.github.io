<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📮 🐲 👩🏼‍🔧 ESP-NOW是ESP8266和ESP32的替代通信协议。基本概念 😸 🙌 🤾🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ESP-NOW是用于发送对配对的设备，开发和释放之间的短分组的简化WiFi协议Espressif为ESP8266和ESP32微控制器在2016.07。同时，不使用与WiFi协议支持有关的其他过程，从而加快了数据包交换的过程。
 
 ESP-NOW可以在物联网上用于控制智能光源，继电器，插座，其他远程...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ESP-NOW是ESP8266和ESP32的替代通信协议。基本概念</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502260/"><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP-NOW是用于发送对配对的设备，开发和释放之间的短分组的简化WiFi协议</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espressif</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为ESP8266和ESP32微控制器在2016.07。</font><font style="vertical-align: inherit;">同时，不使用与WiFi协议支持有关的其他过程，从而加快了数据包交换的过程。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP-NOW可以在物联网上用于控制智能光源，继电器，插座，其他远程控制设备，从传感器和其他应用程序接收信息。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP-NOW支持以下功能</font></font></h4><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配对设备之间的加密和未加密通信。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配对设备之间的加密和非加密混合通信。 </font></font><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最多传输250个字节的有用信息。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置回调函数以通知应用程序层，尤其是传输成功或失败的信息。</font></font></li>
</ul><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP-NOW还具有以下功能和限制。</font></font></h4><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传输速度-在2.4 GHz频率下不超过1 Mbps，即 </font><font style="vertical-align: inherit;">ESP-NOW在与WiFi路由器相同的频率和信道上运行。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未使用WiFi协议</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类似于2.4 GHz无线鼠标中使用的低功耗协议。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅需要初始配对。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配对后，连接不会中断。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不支持广播-仅向配对的设备对进行多次分发。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一台设备（包括加密对）最多支持20对（包括加密对）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作站模式下最多支持10个加密对。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在SoftAP或SoftAP + Station模式下最多6个。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不支持多播加密。</font></font></li>
</ul><br>
<u><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全</font></font></h2></u><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP-NOW使用具有Espressif开发的IE功能和CCMP加密技术的IEEE802.11 Action Vendor帧技术，可提供安全，无连接的通信解决方案。</font><font style="vertical-align: inherit;">Wi-Fi设备支持主主密钥（PMK）和多个本地主密钥（LMK）</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PMK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于使用AES-128算法对LMK进行加密。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LMK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配对设备用于使用CCMP加密用户信息。</font><font style="vertical-align: inherit;">不同LMK的最大数量为6。如果未为配对设备设置LMK，则不会对用户数据进行加密。</font></font></li>
</ul><br>
<u><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本水平</font></font></h2></u><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在ESP_NOW协议的较低级别，维护一个链表，其中包含有关本地设备和配对设备的信息，包括MAC地址和密钥。</font><font style="vertical-align: inherit;">ESP-NOW还为应用程序层存储常用数据，以避免重新处理链表的开销。</font><font style="vertical-align: inherit;">有关设备的信息用于发送和接收数据，其中包括</font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关本地设备的信息：</font></font></u> <br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PMK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：16个字节-用于加密所连接设备上的密钥的主主密钥（API中的KOK）ESP_NOW默认情况下支持PMK，因此不需要进行配置。</font><font style="vertical-align: inherit;">如有必要，您可以验证PMK值是否与本地设备匹配。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：1字节-本地设备模式，用于定义发送WiFi接口（SoftAP或STA）ESP-NOW。</font><font style="vertical-align: inherit;">配对的设备模式不会影响任何功能，而只会保存应用程序层的模式信息。</font><font style="vertical-align: inherit;">在STA WiFi模式下，仅Station适用，而SoftAP WiFi仅是SoftAP。</font></font><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地设备操作模式ESP_NOW</font></font></b>
                        <div class="spoiler_text"><blockquote><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th></th>
<th> WiFi</th>
</tr>
<tr>
<td><b>IDLE</b></td>
<td> </td>
<td>   </td>
</tr>
<tr>
<td><b>CONTROLLER</b></td>
<td></td>
<td>STA</td>
</tr>
<tr>
<td><b>SLAVE</b></td>
<td></td>
<td>SoftAP </td>
</tr>
<tr>
<td><b>COMBO</b></td>
<td>&amp;</td>
<td>SoftAP</td>
</tr>
</tbody></table></div></blockquote><br>
</div>
                    </div></li>
</ul><br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配对的设备</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息（包括常用信息和其他用户信息）：</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LMK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：16字节-本地主密钥，用于在此对通信期间对有用信息的密钥进行加密。</font></font></li>
<li><b>MAC-</b>: 6  —   ,    . ,     Station, MAC-     Station.</li>
<li><b></b>: 1  —       (SoftAP  STA) ESP-NOW.</li>
<li><b></b>: 1  — ,     ,   .   0..255.       ,         .    . , 0 ,    ; 1 ~ 14   ;       ,    .</li>
</ul><br>
<i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在发送/发送数据包时，</font><i><font style="vertical-align: inherit;">Espressif</font></i><font style="vertical-align: inherit;">不建议在回调函数中使用冗长的操作，这可能与使用中断机制实现算法有关。</font><font style="vertical-align: inherit;">回调函数中与动态内存分配相关的问题也支持此假设，可以通过优先使用静态变量以及使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MicroPython</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">异常</font><i><font style="vertical-align: inherit;">机制</font></i><font style="vertical-align: inherit;">的歧义来解决该</font><i><font style="vertical-align: inherit;">问题</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">没有描述</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
开始/结束过程，配对，接收/发送</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espressif</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据包异步的实现</font><font style="vertical-align: inherit;">，这也不利于</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">异步</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MicroPython</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">意识形态的应用</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP-NOW软件包格式</font></font></h4><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAC标头</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：24个字节。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类别</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：1个字节，指示包创建者的类别。</font><font style="vertical-align: inherit;">该值已设置（127）。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组织ID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：3个字节，包含一个唯一的标识符，它是Espressif使用的MAC地址的前三个字节。</font><font style="vertical-align: inherit;">设定值（0x18fe34）</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随机值</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：4个字节，用于保护数据。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">软件包创建者数据</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：7-255Bytes</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
程序包创建者数据包含以下字段：</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：1个字节，设置为（221）。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">长度</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：1个字节，组织ID，类型，版本和用户数据的总长度。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组织ID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：3个字节，包含一个唯一的标识符，它是Espressif使用的MAC地址的前三个字节。</font><font style="vertical-align: inherit;">设定值（0x18fe34）</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：1字节，ESP-NOW协议。</font><font style="vertical-align: inherit;">设定值（4）</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：1个字节，ESP-NOW的当前版本。</font><font style="vertical-align: inherit;">已安装（1）</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：0-250字节的用户数据。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FCS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：4个字节，校验和</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
由于ESP-NOW不使用WiFi协议，因此MAC标头与标准数据包标头略有不同。</font><font style="vertical-align: inherit;">FrameControl字段的FromDS和ToDS位为0。目标地址在第一个地址字段中指定。</font><font style="vertical-align: inherit;">第二个地址字段显示源地址。</font><font style="vertical-align: inherit;">第三个地址字段设置为广播地址（0xff：0xff：0xff：0xff：0xff：0xff）。</font></font><br>
<br>
<u><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本应用算法</font></font></h2></u><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始和结束</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在使用ESP-NOW之前，建议您将Wi-Fi接口设置为所需的模式。</font><font style="vertical-align: inherit;">通常，将Station界面设置为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CONTROLLER</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，将SoftAP界面设置为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SLAVE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COMBO</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">还建议在使用ESP-NOW后停止Wi-Fi。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要立即开始ESP，请调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_init（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_deinit（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成。</font><font style="vertical-align: inherit;">调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_deinit（）时</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，将删除有关已配对设备的所有信息。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绑定回调函数</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
发送数据包</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_register_send_cb（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时的呼叫处理功能</font><font style="vertical-align: inherit;">可用于告知发送方成对的应用级别传输成功或失败的信息，例如，是否成功传输了MAC子层的信息。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_register_send_cb（）时</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请考虑以下因素：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在链接对中：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果应用程序层未收到数据包，但回调函数返回“成功”，则原因可能是：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -来自欺诈设备的攻击</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -加密密钥安装错误</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -乐鑫应用程序级别的数据包丢失</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果应用程序层收到了数据包，但是回调函数返回了错误，则原因可能是：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -信道繁忙，并且未接收到ACK。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
与本地设备的所有对进行多次通信：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果回调返回“成功”，则表示数据包已成功发送。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果回调函数返回错误，则表示未成功发送数据包。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
收到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_register_receive_cb（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据包后，呼叫处理功能</font><font style="vertical-align: inherit;">将返回包括一对发送设备的MAC地址和有用信息的信息。</font><font style="vertical-align: inherit;">它也可以用于通知与接收器配对的发送设备的应用层成功接收到数据包。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加一对配对的设备</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
发送数据之前，必须通过调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_add_peer（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将设备添加到配对设备对列表中</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在将数据发送到一组已建立的对之前，必须添加具有多播MAC地址的设备。</font><font style="vertical-align: inherit;">配对设备的通道范围是0到14。如果通道设置为0，数据将在当前通道上发送。</font><font style="vertical-align: inherit;">否则，必须将通道设置为本地设备所在的通道。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果密钥需要加密，则可以调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_set_pmk（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将其配置</font><font style="vertical-align: inherit;">为设置PMK。</font><font style="vertical-align: inherit;">如果未安装PMK，则默认情况下将使用PMK，并为所有设备选择相同的密钥。</font><font style="vertical-align: inherit;">同时为选定对设置LMK。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用ESP-NOW软件包发送数据</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_send（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发送ESP-NOW数据</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">同时，</font><font style="vertical-align: inherit;">如果在MAC级别成功接收到数据，则在发送回调函数</font><font style="vertical-align: inherit;">时，先前在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_register_send_cb（）中</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置的函数</font><font style="vertical-align: inherit;">将返回</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP_NOW_SEND_SUCCESS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">否则，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP_NOW_SEND_FAIL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将返回</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有几种原因可能导致ESP-NOW无法发送数据。</font><font style="vertical-align: inherit;">特别是，</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标设备不存在；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设备通道不匹配；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传输期间数据丢失。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不能保证应用程序层一定会接受数据。如有必要，您可以在收到ESP-NOW数据后发送确认。如果发生确认超时，则应重复ESP-NOW数据传输。也可以将序列号分配给ESP-NOW数据以删除重复的数据。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_send（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发送ESP-NOW数据时</font><i><font style="vertical-align: inherit;">，</font></i><font style="vertical-align: inherit;">请注意一次发送的信息不能超过250字节。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意！发送两个ESP-NOW数据包之间的时间间隔太短会导致回调函数执行错误，因此建议在回调函数成功完成上一个发送的处理之后再发送下一个数据包ESP-NOW。回调功能是从高优先级的Wi-Fi任务发送的。因此，不建议在回调函数中执行冗长的操作。相反，您可以将必要的数据放在静态队列中，并从优先级较低的进程中进行处理。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果发送功能返回一个MAC地址，则它将使用该MAC地址发送到设备。</font><font style="vertical-align: inherit;">如果send函数返回NULL，则该数据包将被发送到连接到发送设备的所有设备，这可能导致传输失败或由于网络拥塞而造成的延迟。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP-NOW现在接收数据</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
回调功能还从Wi-Fi任务开始。</font><font style="vertical-align: inherit;">因此，不建议在回调函数中执行冗长的操作。</font><font style="vertical-align: inherit;">相反，您可以将必要的数据放在静态队列中，并以较低优先级的流程进行处理。</font></font><br>
<br>
<u><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总之，前述</font></font></h2></u><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我在</font><font style="vertical-align: inherit;">使用ESP-NOW </font><font style="vertical-align: inherit;">构建</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espressif IDE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MicroPython</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方面的经验</font><font style="vertical-align: inherit;">，描述了我在组装过程中遇到的错误，并在获得稳定的结果后将其修复。然后，我将对MicroPython上的ESP-NOW库进行描述，其中包含检测到的错误以及解决这些错误的方法。不幸的是，由于ESP-NOW的源代码是封闭的并且仅以二进制形式分发，因此对ESP-NOW协议的算法的理解是经验性的，并且已经发现了许多问题，对于这些问题，并非总是可以通过逻辑方式克服，而通常在ESP中-NOW已基于GitHub上提供的300多个应用程序成功地应用于C用户和Pythonist社区。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;">Espressif</font></i></a></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对ESP-NOW C库的描述</font></font><i><font style="vertical-align: inherit;"></font></i></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">MicroPython</font></i><font style="vertical-align: inherit;"> ESP-NOW描述和开源</font></font><i><font style="vertical-align: inherit;"></font></i></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN502248/index.html">新的数字资源GOST生效：残疾人应可使用所有平台</a></li>
<li><a href="../zh-CN502250/index.html">今日民航：培训的重要方面和挑战</a></li>
<li><a href="../zh-CN502252/index.html">遥控器和无人机</a></li>
<li><a href="../zh-CN502254/index.html">PostgreSQL：以人为语言（PL / Perl，PL / Python，PL / v8）进行服务器端编程</a></li>
<li><a href="../zh-CN502256/index.html">如何使用Neo4j可视化Spring Integration图？</a></li>
<li><a href="../zh-CN502262/index.html">为什么要对银行进行AIOps和总体监控，或建立在什么客户关系上</a></li>
<li><a href="../zh-CN502264/index.html">公钥基础结构。在自我隔离的情况下签发证书</a></li>
<li><a href="../zh-CN502266/index.html">英特尔平台上的Aurora。Exaflops时代的黎明</a></li>
<li><a href="../zh-CN502268/index.html">HackTheBox。正在通过专利。通过DOCX，LFI到RCE，GIT和ROP链文件进行XXE</a></li>
<li><a href="../zh-CN502272/index.html">不要说“我感到自己”和其他导致昏迷的英语规则</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>