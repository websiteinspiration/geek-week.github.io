<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õπÔ∏è üè∏ üë©üèº‚Äçü§ù‚Äçüë®üèª Implementierung des RAFT-Konsensalgorithmus f√ºr verteilten KV-Speicher in Java üëçüèª üåê ü§±üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo wieder. Vor einigen Tagen begann die Ausbildung in einer neuen Gruppe zum Kurs ‚ÄûSoftware Architect‚Äú . Heute m√∂chten wir einen Artikel teilen, de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Implementierung des RAFT-Konsensalgorithmus f√ºr verteilten KV-Speicher in Java</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/495356/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo wieder. Vor einigen Tagen begann die Ausbildung in einer neuen Gruppe zum Kurs </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄûSoftware Architect‚Äú</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Heute m√∂chten wir einen Artikel teilen, der von einem der Kursteilnehmer, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anton Pleshakov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Entwicklungsleiter bei Program Logistics und Mitbegr√ºnder bei Clusterra), verfasst wurde.</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/pb/5h/qq/pb5hqqeunfv8gkvyvspmegwuj4w.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Derzeit sind verteilte Microservice-Systeme nicht nur in der Unternehmenswelt zum Industriestandard geworden. Die Vorteile der Verwendung verteilter Systeme wurden mehr als einmal beschrieben und diskutiert. Die Vorteile von Microservices sind seit langem allen bekannt: Technologien f√ºr die Aufgabe, Kompositionsf√§higkeit, Skalierbarkeit, Entwicklungsskalierung, TTM-Reduzierung usw. Es ist offensichtlich, dass die Entwicklung verteilter Anwendungen mehr Optionen bietet, um rechtzeitig auf wachsende Gesch√§ftsanforderungen zu reagieren und alles zu digitalisieren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist auch wichtig anzumerken, dass derzeit ein sehr wichtiger Faktor f√ºr die Wahl einer Entwicklungsstrategie zugunsten von Microservices die Verf√ºgbarkeit aller Arten von vorgefertigten Infrastrukturl√∂sungen ist, die die L√∂sung von Problemen √ºbernehmen, die mit den zus√§tzlichen Kosten f√ºr den Betrieb eines verteilten Systems verbunden sind. Wir sprechen √ºber Container-Orchestrierungssysteme, Service-Mash, Mittel zur verteilten Ablaufverfolgung, √úberwachung, Protokollierung usw. Es kann mit Sicherheit festgestellt werden, dass die meisten Faktoren, die zuvor als Minuspunkte des heutigen Microservice-Ansatzes genannt wurden, nicht mehr so ‚Äã‚Äãviel Einfluss haben wie vor ein paar Jahren.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Basierend auf modernen Realit√§ten suchen die meisten Entwickler nach der ersten M√∂glichkeit, von einer monolithischen Struktur zu einer Microservice-Struktur zu wechseln. Einer der ersten Schritte, die unternommen werden k√∂nnen, ohne auf eine vollst√§ndige Umgestaltung und ernsthafte Zerlegung zur√ºckzugreifen, ist die Erzielung eines horizontalen Skalierbarkeitssystems. Das hei√üt, Sie verwandeln Ihre monolithische Anwendung in einen Cluster, der m√∂glicherweise sogar aus denselben Monolithen besteht, aber es Ihnen erm√∂glicht, deren Anzahl dynamisch zu variieren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim Versuch, eine horizontale Skalierbarkeit zu erreichen, stellt sich die Frage der Datensynchronisation innerhalb eines Clusters sehr schnell und sehr akut. Gl√ºcklicherweise unterst√ºtzen alle modernen DBMS die Datenreplikation zwischen Knoten auf die eine oder andere Weise. Der Entwickler muss nur das DBMS f√ºr die Aufgabe ausw√§hlen und entscheiden, welche Eigenschaften des Systems (gem√§√ü dem CAP-Theorem) er ben√∂tigt, CP oder AP, und das Problem ist behoben. In dem Fall, in dem CP erforderlich ist und die Anforderungen an die Konsistenz hoch sind, besteht eine der Methoden zur L√∂sung des Problems der Datensynchronisation darin, einen Cluster zu verwenden, der den RAFT-Konsensalgorithmus unterst√ºtzt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser ziemlich neue Algorithmus (wurde 2012 entwickelt) bietet eine hohe Konsistenzgarantie und ist sehr beliebt. Ich beschloss herauszufinden, wie es funktioniert, und schrieb meine Implementierung eines konsistenten Schl√ºsselwert-Repositorys in Java (Spring Boot).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ist es sinnvoll, einen verteilten Algorithmus selbst zu implementieren? Es ist klar, dass Sie eine vorgefertigte Implementierung eines verteilten Algorithmus durchf√ºhren k√∂nnen, und mit der h√∂chsten Wahrscheinlichkeit ist diese Implementierung besser als ein selbst hergestelltes ‚ÄûFahrrad‚Äú. Beispielsweise k√∂nnen Sie ein DBMS verwenden, das die erforderliche Konsistenzstufe beibeh√§lt. Oder Sie k√∂nnen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zookeeper</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bereitstellen </font><font style="vertical-align: inherit;">. Oder Sie finden einen Rahmen, der zu Ihrer Sprache passt. F√ºr Java gibt es </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atomix</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , das die Probleme der Synchronisierung verteilter Daten perfekt l√∂st.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber auf der anderen Seite. Wenn Sie eine schl√ºsselfertige L√∂sung w√§hlen, f√ºhrt die Verwendung einer externen Anwendung normalerweise zu einem zus√§tzlichen Fehlerpunkt f√ºr Ihr System. Und Frameworks k√∂nnen redundant oder schwierig zu bedienen und zu erlernen sein oder f√ºr Ihre Programmiersprache √ºberhaupt nicht vorhanden sein. Dar√ºber hinaus ist die unabh√§ngige Implementierung des Konsensalgorithmus eine √§u√üerst interessante technische Aufgabe, die Ihren Horizont erweitert und Ihnen ein Verst√§ndnis daf√ºr vermittelt, wie Sie die Probleme l√∂sen k√∂nnen, die auftreten, wenn Dienste in einem Cluster mit der optimaleren Methode interagieren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da die Spezifikation des Algorithmus eine Reihe von Ma√ünahmen zur Aufrechterhaltung der Datenintegrit√§t enth√§lt, k√∂nnen Sie das erworbene Wissen und sogar den Algorithmus in seiner Gesamtheit verwenden. Jeder Teil des Algorithmus kann im wirklichen Leben n√ºtzlich sein. Angenommen, Sie haben eine Reihe von Workern zum parallelen Parsen von Dateien. Arbeiter sind gleichwertig, aber Sie m√∂chten einen der Arbeiter als Koordinator bestimmen, und wenn der koordinierende Arbeiter f√§llt, weisen Sie einen anderen freien Arbeiter als Koordinator zu. Die erste H√§lfte des RAFT-Algorithmus, in der beschrieben wird, wie ein Leader unter √§quivalenten Knoten ausgew√§hlt wird, hilft Ihnen dabei. Wenn Sie beispielsweise nur zwei Knoten in Bezug auf Master-Slave haben, k√∂nnen Sie die in der RAFT-Spezifikation beschriebenen Replikationsregeln sehr gut verwenden, um den Datenaustausch in Ihrem einfacheren Fall zu organisieren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Artikel ist im Wesentlichen eine praktische Anleitung zur Implementierung von RAFT. </font><font style="vertical-align: inherit;">Der Algorithmus selbst und die theoretischen Aspekte seiner Arbeit werden nicht verstanden. </font><font style="vertical-align: inherit;">Sie k√∂nnen hier in diesem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ausgezeichneten Artikel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine kurze Beschreibung lesen </font><font style="vertical-align: inherit;">oder die vollst√§ndige Spezifikation </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> studieren </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dort finden Sie eine sehr √ºbersichtliche Visualisierung des Algorithmus.</font></font><br>
 <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Allgemeine L√∂sungsbeschreibung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Teil des Codes, der in direktem Zusammenhang mit der Implementierung des Algorithmus steht, wird im Artikel analysiert. </font><font style="vertical-align: inherit;">Am Ende des Artikels befindet sich ein Link zum Repository, in dem Sie den gesamten Code sehen k√∂nnen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Aufgabe war wie folgt. </font><font style="vertical-align: inherit;">Entwickeln Sie ein verteiltes System, mit dem Sie Daten in einer Schl√ºsselwertdatenbank speichern k√∂nnen. </font><font style="vertical-align: inherit;">Die Daten jedes Knotens m√ºssen konsistent sein, dh wenn die Daten in die Datenbank eines Knotens gelangt sind und die meisten Knoten best√§tigt haben, dass sie auch diese Daten empfangen haben, befinden sich diese Daten fr√ºher oder sp√§ter in der Datenbank jedes Knotens. </font><font style="vertical-align: inherit;">Wenn ein Teil des Clusters getrennt und wieder verbunden wird, m√ºssen die Knoten au√üerhalb des Clusters den Hauptcluster einholen und synchronisieren. </font><font style="vertical-align: inherit;">Jeder Knoten bietet eine REST-API zum Schreiben und Lesen von Datenbankdaten. </font><font style="vertical-align: inherit;">Das System besteht aus zwei Modulen f√ºr zwei Knotentypen: Client und Server. </font><font style="vertical-align: inherit;">Im Folgenden werden die Funktionen der Implementierung des Servers selbst betrachtet. </font><font style="vertical-align: inherit;">Der Client-Code befindet sich im Repository. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Serverknoten kann in drei Zust√§nden betrieben werden:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anh√§nger (Anh√§nger). </font><font style="vertical-align: inherit;">Akzeptiert Leseanforderungen vom Client. </font><font style="vertical-align: inherit;">Nimmt dem Anf√ºhrer einen Herzschlag ab</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kandidat (Kandidat). </font><font style="vertical-align: inherit;">Akzeptiert Leseanforderungen vom Client. </font><font style="vertical-align: inherit;">Sendet Abstimmungsanfragen an andere Knoten</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºhrer </font><font style="vertical-align: inherit;">Akzeptiert Lese- und Schreibanforderungen. </font><font style="vertical-align: inherit;">Sendet Heartbeat-Anforderungen an andere Knoten. </font><font style="vertical-align: inherit;">Sendet Daten zum Anh√§ngen von Anforderungen an andere Knoten.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Periode der ‚ÄûF√ºhrung‚Äú eines der Knoten wird als Runde (Term) bezeichnet. </font><font style="vertical-align: inherit;">Ein neuer Kandidat er√∂ffnet eine neue Runde.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datenspeicher</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jeder Knoten bietet Zugriff auf das Repository des Operationsprotokolls, in dem Operationen zum √Ñndern von Daten nacheinander aufgezeichnet werden.</font></font><br>
<br>
<code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/pleshakoff/raft/blob/master/server/src/main/java/com/raft/server/operations/OperationsLog.java<br>
</a></code><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">OperationsLog</span> </span>{
   <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">append</span><span class="hljs-params">(Operation operation)</span></span>;
   <span class="hljs-function">Operation <span class="hljs-title">get</span><span class="hljs-params">(Integer index)</span></span>;
   <span class="hljs-function">List&lt;Operation&gt; <span class="hljs-title">all</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
   <span class="hljs-function">Long <span class="hljs-title">getTerm</span><span class="hljs-params">(Integer index)</span></span>;
   <span class="hljs-function">Integer <span class="hljs-title">getLastIndex</span><span class="hljs-params">()</span></span>;
   <span class="hljs-function">Long <span class="hljs-title">getLastTerm</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
   <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">removeAllFromIndex</span><span class="hljs-params">(<span class="hljs-keyword">int</span> newOperationIndex)</span></span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jede Operation enth√§lt neben Daten und Typ (Einf√ºgen, √Ñndern, L√∂schen) die Nummer der Runde, in der sie erstellt wurde. Zus√§tzlich hat jede Operation einen Index, der sequentiell ansteigt. Es ist wichtig, dass alle Vorg√§nge in derselben Reihenfolge in die Protokolle der Follower eingef√ºgt werden, in der sie in das Protokoll des Anf√ºhrers eingef√ºgt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jeder Knoten hat Zugriff auf eine Datenbank, in der Daten direkt gespeichert werden.</font></font><br>
<br>
<code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/pleshakoff/raft/blob/master/server/src/main/java/com/raft/server/storage/Storage.java</a></code><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Storage</span> </span>{
   <span class="hljs-function">List&lt;Entry&gt; <span class="hljs-title">all</span><span class="hljs-params">()</span></span>;
   <span class="hljs-function">String <span class="hljs-title">get</span><span class="hljs-params">(Long key)</span></span>;
   <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(Long key, String val)</span></span>;
   <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(Long key, String val)</span></span>;
   <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(Long key)</span></span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der aktuellen Implementierung werden eingebettete In-Memory-L√∂sungen sowohl f√ºr das Protokoll als auch f√ºr die Datenbank verwendet (normale Wettbewerbsliste und Karte). Bei Bedarf k√∂nnen Sie einfach die entsprechende Schnittstelle implementieren, um andere Speichertypen zu unterst√ºtzen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Anwendung von Operationen aus dem Protokoll auf die Datenbank wird von einer verteilten Zustandsmaschine ausgef√ºhrt. Eine Zustandsmaschine ist ein solcher Mechanismus, der daf√ºr verantwortlich ist, den Status eines Clusters zu √§ndern und die Verwendung falscher √Ñnderungen einzuschr√§nken (Operationen au√üerhalb der Reihenfolge oder ein getrennter Knoten, der sich selbst als f√ºhrend betrachtet). Damit die √Ñnderungen als g√ºltig angesehen und auf die Datenbank angewendet werden k√∂nnen, m√ºssen sie eine Reihe von Pr√ºfungen bestehen und bestimmte Kriterien erf√ºllen, genau das bietet die Zustandsmaschine.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr einen Leiter wird eine Operation auf die Datenbank angewendet, wenn die meisten Knoten die Tatsache best√§tigt haben, dass die Operation auch in ihr Protokoll repliziert wird. </font><font style="vertical-align: inherit;">F√ºr einen Follower wird die Operation auf die Datenbank angewendet, wenn vom Leiter ein Signal empfangen wird, dass er in seine Datenbank gelangt ist.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Timer </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jeder Knoten bietet Datenaustausch mit anderen Knoten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es werden zwei Arten von Abfragen unterst√ºtzt:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abstimmung bei der Durchf√ºhrung einer Abstimmungsrunde</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anh√§ngen, auch bekannt als Heartbeat (falls ohne Daten), um Protokolldaten an Follower zu replizieren und den Beginn einer neuen Abstimmungsrunde zu verhindern.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Tatsache, dass ein Ereignis einsetzt, wird vom Timer bestimmt. </font><font style="vertical-align: inherit;">Auf dem Knoten werden zwei Arten von Timern gestartet:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abstimmung. </font><font style="vertical-align: inherit;">Eine Abstimmungsrunde starten. </font><font style="vertical-align: inherit;">Jeder Knoten hat ein eigenes Intervall, nach dem er versucht, eine neue Abstimmung zu starten. </font><font style="vertical-align: inherit;">Der Countdown beginnt von neuem, wenn der Anf√ºhrer einen Herzschlag erh√§lt.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Herzschlag. </font><font style="vertical-align: inherit;">Senden einer Anfrage an Follower durch den Anh√§ngef√ºhrer. </font><font style="vertical-align: inherit;">Wenn der Knoten keinen Herzschlag empf√§ngt und der Abstimmungszeitgeber abgelaufen ist, wird er ein Kandidat und leitet Wahlen ein, erh√∂ht die Anzahl der Abstimmungsrunden und sendet Abstimmungsanfragen an andere Knoten. </font><font style="vertical-align: inherit;">Wenn der Knoten die Mehrheit der Stimmen sammelt, wird er zum Anf√ºhrer und sendet einen Herzschlag aus.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der aktuelle Status des Knotens</font></font></h3> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jeder Knoten speichert Daten √ºber den aktuellen Status.</font></font><br>
<br>
<code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/pleshakoff/raft/blob/master/server/src/main/java/com/raft/server/context/Context.java</a></code><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Context</span> </span>{
   <span class="hljs-function">Integer <span class="hljs-title">getId</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">//    </span>
   <span class="hljs-function">State <span class="hljs-title">getState</span><span class="hljs-params">()</span></span>;<span class="hljs-comment">//: , ,  </span>
   <span class="hljs-function">Integer <span class="hljs-title">getVotedFor</span><span class="hljs-params">()</span></span>; 
               <span class="hljs-comment">//          </span>
   <span class="hljs-function">Long <span class="hljs-title">getCurrentTerm</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">//  </span>
   <span class="hljs-function">Integer <span class="hljs-title">getCommitIndex</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">//    </span>
   <span class="hljs-function">List&lt;Peer&gt; <span class="hljs-title">getPeers</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">//      </span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein F√ºhrungsknoten speichert auch Metadaten f√ºr die Knoten, auf die er Daten repliziert.</font></font><br>
<br>
<code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/pleshakoff/raft/blob/master/server/src/main/java/com/raft/server/node/peers/Peer.java</a></code><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Peer</span> </span>{
   <span class="hljs-function">Integer <span class="hljs-title">getId</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">//  </span>
   <span class="hljs-function">Integer <span class="hljs-title">getNextIndex</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">//  ,    </span>
   <span class="hljs-function">Integer <span class="hljs-title">getMatchIndex</span><span class="hljs-params">()</span></span>;<span class="hljs-comment">//   </span>
   <span class="hljs-function">Boolean <span class="hljs-title">getVoteGranted</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">//     </span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Knotenmetadaten werden vom Leiter aktualisiert, wenn Antworten von Followern empfangen werden. </font><font style="vertical-align: inherit;">Sie werden verwendet, um vom Leiter zu bestimmen, welche n√§chste Indexoperation der Follower akzeptieren m√∂chte und welche Operationen bereits zum Protokoll des Followers hinzugef√ºgt wurden.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W√§hlen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">ElectionService-</font></a><font style="vertical-align: inherit;"> Klasse ist f√ºr die Abstimmung verantwortlich</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ElectionService</span> </span>{
   <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">processElection</span><span class="hljs-params">()</span></span>;
   <span class="hljs-function">AnswerVoteDTO <span class="hljs-title">vote</span><span class="hljs-params">(RequestVoteDTO requestVoteDTO)</span></span>;<font></font>
} </code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Senden eines Antrags auf Abstimmung </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn der Knoten ein Follower ist und f√ºr den f√ºr die Wartezeit festgelegten Zeitraum keinen Herzschlag erh√§lt, erh√∂ht er seine aktuelle Runde, erkl√§rt sich selbst zum Kandidaten und beginnt, Abstimmungsanfragen an andere Knoten zu senden. </font><font style="vertical-align: inherit;">Wenn es ihm gelingt, ein Quorum zu erreichen und die meisten Knoten seine Stimme abgeben, wird er der neue F√ºhrer. </font><font style="vertical-align: inherit;">In RAFT-Begriffen ist das Quorum mehr als die H√§lfte aller Knoten (51%). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns die </font></font><code>processElection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klassenmethode </font><font style="vertical-align: inherit;">analysieren </font></font><code>ElectionServiceImpl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die vom Abstimmungs-Timer aufgerufen wird, wenn die Abstimmung abl√§uft, und den Knoten eine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anforderung zur Abstimmung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sendet </font><font style="vertical-align: inherit;">.</font></font><br>
 <br>
<pre><code class="java hljs"><span class="hljs-comment">//1</span><font></font>
context.setState(CANDIDATE); <font></font>
Long term = context.incCurrentTerm(); <font></font>
context.setVotedFor(context.getId()); <font></font>
<font></font>
List&lt;Integer&gt; peersIds = context.getPeers().stream().map(Peer::getId).collect(Collectors.toList());<font></font>
<span class="hljs-keyword">long</span> voteGrantedCount = <span class="hljs-number">1L</span>;
<span class="hljs-keyword">long</span> voteRevokedCount = <span class="hljs-number">0L</span>;<font></font>
<font></font>
<span class="hljs-comment">//2</span>
<span class="hljs-keyword">while</span> (checkCurrentElectionStatus(term)) {<font></font>
   List&lt;AnswerVoteDTO&gt; answers = getVoteFromAllPeers(term, peersIds);<font></font>
   peersIds = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
   <span class="hljs-keyword">for</span> (AnswerVoteDTO answer : answers) {
       <span class="hljs-comment">//3</span>
       <span class="hljs-keyword">if</span> (answer.getStatusCode().equals(OK)) {
           <span class="hljs-comment">//4</span>
           <span class="hljs-keyword">if</span> (answer.getTerm()&gt;context.getCurrentTerm()) {<font></font>
               context.setTermGreaterThenCurrent(answer.getTerm());<font></font>
               <span class="hljs-keyword">return</span>;<font></font>
           }<font></font>
           <span class="hljs-keyword">if</span> (answer.isVoteGranted()) {
               <span class="hljs-comment">//5 </span>
               context.getPeer(answer.getId()).setVoteGranted(<span class="hljs-keyword">true</span>);<font></font>
               voteGrantedCount++;<font></font>
           } <span class="hljs-keyword">else</span>
               <span class="hljs-comment">//6 </span><font></font>
               voteRevokedCount++;<font></font>
       } <span class="hljs-keyword">else</span> {<font></font>
          peersIds.add(answer.getId());<font></font>
       }<font></font>
   }<font></font>
  <span class="hljs-comment">//7</span>
  <span class="hljs-keyword">if</span> (voteGrantedCount &gt;= context.getQuorum()) {<font></font>
       winElection(term);<font></font>
       <span class="hljs-keyword">return</span>;<font></font>
   } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (voteRevokedCount &gt;= context.getQuorum()) {<font></font>
       loseElection(term);<font></font>
       <span class="hljs-keyword">return</span>;<font></font>
   } </code></pre><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stellen Sie den Status "Kandidat" ein. </font><font style="vertical-align: inherit;">Erh√∂hen Sie die runde Zahl und stimmen Sie f√ºr uns ab.</font></font></li>
<li>  ,       (    ).  -  ,        ,           heartbeat                 .</li>
<li> -  ,    .    ,      ,     -. </li>
<li>       ,                            .     ,      heartbeat     .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Knoten hat f√ºr uns gestimmt! </font><font style="vertical-align: inherit;">Wir erh√∂hen die Anzahl der Knoten, die Stimmen f√ºr uns abgeben, und korrigieren, dass dieser Knoten f√ºr uns gestimmt hat.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nicht f√ºr uns gew√§hlt, glauben wir auch.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn das Quorum gesammelt wird und der Knoten die Wahl gewonnen hat, legen wir den Status ‚ÄûLeader‚Äú fest. </font><font style="vertical-align: inherit;">Ansonsten werden wir Anh√§nger und warten.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es sollte auch beachtet werden, dass, wenn ein Knoten zum Leader wird, der n√§chste Index f√ºr jeden Knoten in der Liste der vom Leader gespeicherten Knoten festgelegt wird. Dies entspricht dem letzten Index im Leader-Protokoll plus 1. Ausgehend von diesem Index versucht der Leader, die Follower-Protokolle zu aktualisieren. </font><font style="vertical-align: inherit;">Tats√§chlich entspricht dieser vom Leader gespeicherte Index m√∂glicherweise nicht dem tats√§chlichen Index des Protokolls des Followers, und der tats√§chliche Wert wird nur beim Datenaustausch mit dem Follower ermittelt und angepasst. </font><font style="vertical-align: inherit;">Es ist jedoch ein </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ausgangspunkt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erforderlich </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="java hljs">  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">winElection</span><span class="hljs-params">(Long term)</span> </span>{<font></font>
       context.setState(LEADER);<font></font>
       context.getPeers().forEach(peer -&gt;<font></font>
               peer.setNextIndex(operationsLog.getLastIndex()+<span class="hljs-number">1</span>)<font></font>
<font></font>
       );<font></font>
   }</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bearbeitung von Abstimmungsanfragen </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der Abstimmung erh√§lt jeder Knoten vom Kandidaten eine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anfrage der</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folgenden </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Form</font></a><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RequestVoteDTO</span> </span>{
   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Long term; <span class="hljs-comment">//     </span>
   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Integer candidateId; <span class="hljs-comment">//  </span>
   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Integer lastLogIndex; <span class="hljs-comment">//     </span>
   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Long lastLogTerm; <span class="hljs-comment">//       </span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns nun das </font></font><code>vote</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klassenverfahren </font><font style="vertical-align: inherit;">an </font></font><code>ElectionServiceImpl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, es verarbeitet die Abstimmungsanfrage des Kandidaten und gibt eine Entscheidung bez√ºglich seiner Kandidatur f√ºr die Rolle des Leiters zur√ºck.</font></font><br>
<br>
<code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/pleshakoff/raft/blob/eba5ea1984e2623702f4c299cf1b0af7a6ba0d14/server/src/main/java/com/raft/server/election/ElectionServiceImpl.java#L178 <br>
</a></code><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> AnswerVoteDTO <span class="hljs-title">vote</span><span class="hljs-params">(RequestVoteDTO dto)</span> </span>{<font></font>
   <font></font>
       <span class="hljs-keyword">boolean</span> termCheck;
       <span class="hljs-comment">//1</span>
       <span class="hljs-keyword">if</span> (dto.getTerm() &lt; context.getCurrentTerm())
           <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AnswerVoteDTO(context.getId(),context.getCurrentTerm(),<span class="hljs-keyword">false</span>);
       <span class="hljs-keyword">else</span> <span class="hljs-comment">//2</span>
       <span class="hljs-keyword">if</span> (dto.getTerm().equals(context.getCurrentTerm())) {<font></font>
           termCheck = (context.getVotedFor() == <span class="hljs-keyword">null</span>||<font></font>
                          context.getVotedFor().equals(dto.getCandidateId()));<font></font>
       }<font></font>
       <span class="hljs-keyword">else</span>
       {   <span class="hljs-comment">//3</span>
           termCheck = <span class="hljs-keyword">true</span>;<font></font>
             context.setTermGreaterThenCurrent(dto.getTerm());<font></font>
       }<font></font>
<font></font>
       <span class="hljs-comment">//4  </span>
       <span class="hljs-keyword">boolean</span> logCheck = !((operationsLog.getLastTerm() &gt; dto.getLastLogTerm()) ||<font></font>
               ((operationsLog.getLastTerm().equals(dto.getLastLogTerm())) &amp;&amp;<font></font>
                       (operationsLog.getLastIndex() &gt; dto.getLastLogIndex())));<font></font>
<font></font>
<font></font>
       <span class="hljs-keyword">boolean</span> voteGranted = termCheck&amp;&amp;logCheck;<font></font>
<font></font>
       <span class="hljs-comment">//5</span>
       <span class="hljs-keyword">if</span> (voteGranted) {<font></font>
           context.setVotedFor(dto.getCandidateId());<font></font>
       }<font></font>
       <span class="hljs-comment">//6   </span>
       <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AnswerVoteDTO(context.getId(),context.getCurrentTerm(),voteGranted);<font></font>
   }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach Erhalt einer Anfrage von einem Kandidaten f√ºhrt der Knoten zwei √úberpr√ºfungen durch: √úberpr√ºft die Runde des Kandidaten und die L√§nge seines Protokolls. </font><font style="vertical-align: inherit;">Wenn die Runde des Kandidaten h√∂her ist und sein Protokoll l√§nger oder gleich ist, gibt der Knoten seinem Knoten eine Stimme f√ºr den Kandidaten</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn die aktuelle Runde des Knotens gr√∂√üer ist als die Runde des Kandidaten, lehnen wir ab, da dies eine Anfrage eines verz√∂gerten Knotens ist, der anscheinend einige Zeit au√üerhalb des Clusters lag und das Wahlverfahren gestartet hat, weil er den aktuellen F√ºhrer nicht gesehen hat. </font></font></li>
<li>   ,   , ,           ,        ,     ,       ;       .              ‚Äî    .</li>
<li>     ,     </li>
<li> .                   ,            ,  ,        ,     .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mit einem positiven Ergebnis korrigieren wir die Tatsache, dass der Knoten an den Wahlen teilgenommen hat, und geben eine Stimme f√ºr den Kandidaten ab.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Senden Sie das Ergebnis an den Kandidaten zur√ºck</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sicherlich h√§tten die Bedingungen etwas k√ºrzer und eleganter geschrieben werden k√∂nnen, aber ich habe eine so ‚Äûnaivere‚Äú Option gelassen, um mich nicht zu verwirren und niemanden zu verwirren. </font></font><br>
 <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reproduzieren </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Timer-Leader sendet Heartbeat-Follower an alle Knoten, um deren Abstimmungs-Timer zur√ºckzusetzen. Da der Leiter in seinen Metadatenindizes die letzten Operationen aller Follower speichert, kann er bewerten, ob das Senden der Operation an Knoten erforderlich ist. Wenn das Operationsprotokoll des Anf√ºhrers l√§nger wird als das Protokoll eines Nachfolgers, sendet er ihm zusammen mit dem Herzschlag nacheinander die fehlenden Operationen. Nennen Sie es Append-Anfrage. Wenn die meisten Knoten den Empfang neuer Operationen best√§tigen, wendet der Leiter diese Operationen auf seine Datenbank an und erh√∂ht den Index der zuletzt angewendeten Operation. Dieser Index wird zusammen mit einer Heartbeat-Anfrage auch an Follower gesendet. Und wenn der Leader-Index h√∂her als der Follower-Index ist, wendet der Follower auch Operationen auf seine Datenbank an, um die Indizes auszugleichen. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diese Art von Append-Anfrage sendet der Leader an den Follower</font></font></a><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RequestAppendDTO</span> </span>{
   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Long term; <span class="hljs-comment">//   </span>
   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Integer leaderId; <span class="hljs-comment">//   </span><font></font>
<font></font>
   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Integer prevLogIndex;<span class="hljs-comment">//   </span>
   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Long prevLogTerm;<span class="hljs-comment">//   </span>
   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Integer leaderCommit;<span class="hljs-comment">//      </span>
   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Operation operation; <span class="hljs-comment">//</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt Implementierungen, bei denen Vorg√§nge in Stapeln von mehreren pro Anforderung √ºbertragen werden. </font><font style="vertical-align: inherit;">In der aktuellen Implementierung kann nur eine Operation pro </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anforderung √ºbertragen werden. Die Klasse antwortet auf das Senden und Verarbeiten der Heartbeat-Append-Anforderung:</font></font><br>
<br>
<code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/pleshakoff/raft/blob/eba5ea1984e2623702f4c299cf1b0af7a6ba0d14/server/src/main/java/com/raft/server/replication/ReplicationService.java</a></code><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ReplicationService</span> </span>{
   <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">appendRequest</span><span class="hljs-params">()</span></span>;
   <span class="hljs-function">AnswerAppendDTO <span class="hljs-title">append</span><span class="hljs-params">(RequestAppendDTO requestAppendDTO)</span></span>;<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Senden Sie eine Daten√§nderungsanforderung </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stellen Sie sich ein Fragment einer </font></font><code>sendAppendForOnePeer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klassenmethode vor </font></font><code>ReplicationServiceImpl</code><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Die Methode ist daf√ºr verantwortlich, eine Anforderung an den Follower zu generieren und diese zu senden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> CompletableFuture&lt;AnswerAppendDTO&gt; <span class="hljs-title">sendAppendForOnePeer</span><span class="hljs-params">(Integer id)</span> </span>{
   <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; {
       <span class="hljs-keyword">try</span> {
           <span class="hljs-comment">//1</span><font></font>
           Peer peer = context.getPeer(id);<font></font>
<font></font>
           Operation operation;<font></font>
           Integer prevIndex;<font></font>
           <span class="hljs-comment">//2    </span>
           <span class="hljs-keyword">if</span> (peer.getNextIndex() &lt;= operationsLog.getLastIndex()) {<font></font>
               operation = operationsLog.get(peer.getNextIndex());<font></font>
               prevIndex = peer.getNextIndex() - <span class="hljs-number">1</span>;<font></font>
           } <span class="hljs-keyword">else</span> 
           <span class="hljs-comment">//3  </span><font></font>
           {<font></font>
               operation = <span class="hljs-keyword">null</span>;<font></font>
               prevIndex = operationsLog.getLastIndex();<font></font>
           }<font></font>
<font></font>
<font></font>
           RequestAppendDTO requestAppendDTO = <span class="hljs-keyword">new</span> RequestAppendDTO(<font></font>
                   context.getCurrentTerm(), <span class="hljs-comment">//   </span>
                   context.getId(), <span class="hljs-comment">//  </span>
                   prevIndex,<span class="hljs-comment">//      </span>
                   operationsLog.getTerm(prevIndex),<span class="hljs-comment">//  </span><font></font>
                   context.getCommitIndex(),<font></font>
                               <span class="hljs-comment">//      </span>
                   Operation <span class="hljs-comment">//</span><font></font>
           );<font></font>
<font></font>
...<font></font>
<span class="hljs-comment">/*   http     */</span>
}</code></pre><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Follower-Metadaten</font></font></li>
<li>   ,   .             (      ),          ,      ,  ,   .    ,       ,    ,   ,     </li>
<li>   ,    ,       ;        ,     ,       ,  </li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Betrachten Sie als N√§chstes die </font></font><code>appendRequest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klassenmethode </font></font><code>ReplicationServiceImpl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die f√ºr das Senden der Append-Anforderung und die Verarbeitung des Ergebnisses an alle Follower verantwortlich ist.</font></font><br>
<br>
<code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/pleshakoff/raft/blob/eba5ea1984e2623702f4c299cf1b0af7a6ba0d14/server/src/main/java/com/raft/server/replication/ReplicationServiceImpl.java#L109</a></code><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">appendRequest</span><span class="hljs-params">()</span> </span>{<font></font>
       List&lt;Integer&gt; peersIds = context.getPeers().stream().map(Peer::getId).collect(Collectors.toList());<font></font>
<font></font>
       <span class="hljs-comment">//1 </span>
       <span class="hljs-keyword">while</span> (peersIds.size() &gt; <span class="hljs-number">0</span>) {
           <span class="hljs-comment">//2 </span><font></font>
           List&lt;AnswerAppendDTO&gt; answers = sendAppendToAllPeers(peersIds);<font></font>
           peersIds = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
           <span class="hljs-keyword">for</span> (AnswerAppendDTO answer : answers) {
               <span class="hljs-comment">//3</span>
               <span class="hljs-keyword">if</span> (answer.getStatusCode().equals(OK)) {
                   <span class="hljs-comment">//4</span>
                   <span class="hljs-keyword">if</span> (answer.getTerm() &gt; context.getCurrentTerm()) {<font></font>
                        context.setTermGreaterThenCurrent(answer.getTerm());<font></font>
                       <span class="hljs-keyword">return</span>;<font></font>
                   }<font></font>
                   Peer peer = context.getPeer(answer.getId());<font></font>
                   <span class="hljs-comment">//5     </span>
                   <span class="hljs-keyword">if</span> (answer.getSuccess()) {                      <font></font>
                       peer.setNextIndex(answer.getMatchIndex() + <span class="hljs-number">1</span>);<font></font>
                       peer.setMatchIndex(answer.getMatchIndex());<font></font>
                       <span class="hljs-keyword">if</span> (peer.getNextIndex() &lt;= operationsLog.getLastIndex())<font></font>
                           peersIds.add(answer.getId());<font></font>
                   <span class="hljs-comment">//6      </span>
                   } <span class="hljs-keyword">else</span> {<font></font>
                       peer.decNextIndex();<font></font>
                       peersIds.add(answer.getId());<font></font>
                   }<font></font>
               }<font></font>
           }<font></font>
           <span class="hljs-comment">//7</span><font></font>
           tryToCommit();<font></font>
       }<font></font>
}<font></font>
</code></pre><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir wiederholen die Anfrage, bis wir von allen Followern eine Antwort erhalten, dass die Replikation erfolgreich war. </font><font style="vertical-align: inherit;">Da pro Anforderung eine Operation gesendet wird, kann es mehrere Iterationen dauern, um die Protokolle der Follower zu synchronisieren</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Senden Sie Anfragen an alle Follower und erhalten Sie eine Liste mit Antworten </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir ber√ºcksichtigen nur Antworten von verf√ºgbaren Followern</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn sich herausstellt, dass die Runde eines der Anh√§nger mehr ist als die Runde des Anf√ºhrers, stoppen wir alles und verwandeln uns in einen Anh√§nger </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn der Follower geantwortet hat, dass alles erfolgreich war, aktualisieren wir die Follower-Metadaten: Wir speichern den letzten Index des Follower-Protokolls und den Index der n√§chsten vom Follower erwarteten Operation. </font></font></li>
<li>  ,    ,  ,           ,           .  ,                  ,      .     ,         .    ,          .</li>
<li>        ,      .     . </li>
</ol><br>
<h3>     </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun wollen wir sehen, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wie genau der Follower die Append-Anfrage vom Leader verarbeitet. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klasse - </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Methode</font></font><code>append</code><font style="vertical-align: inherit;"></font><code>ReplicationServiceImpl</code><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> AnswerAppendDTO <span class="hljs-title">append</span><span class="hljs-params">(RequestAppendDTO dto)</span> </span>{<font></font>
     <font></font>
       <span class="hljs-comment">//1     </span>
       <span class="hljs-keyword">if</span> (dto.getTerm() &lt; context.getCurrentTerm()) {
           <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AnswerAppendDTO(context.getId(),context.getCurrentTerm(),<span class="hljs-keyword">false</span>, <span class="hljs-keyword">null</span>);<font></font>
       } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dto.getTerm() &gt; context.getCurrentTerm()) {
           <span class="hljs-comment">//2 </span><font></font>
           context.setCurrentTerm(dto.getTerm());<font></font>
           context.setVotedFor(<span class="hljs-keyword">null</span>);<font></font>
       }<font></font>
       <span class="hljs-comment">//3  </span>
       applicationEventPublisher.publishEvent(<span class="hljs-keyword">new</span> ResetElectionTimerEvent(<span class="hljs-keyword">this</span>));<font></font>
<font></font>
       <span class="hljs-keyword">if</span> (!context.getState().equals(FOLLOWER)) {<font></font>
           context.setState(FOLLOWER);<font></font>
       }<font></font>
        <font></font>
       <span class="hljs-comment">//4  </span>
       <span class="hljs-keyword">if</span> ((dto.getPrevLogIndex() &gt; operationsLog.getLastIndex()) ||                                                                                        !dto.getPrevLogTerm().equals(operationsLog.getTerm(dto.getPrevLogIndex()))) {
                      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AnswerAppendDTO(context.getId(), context.getCurrentTerm(), <span class="hljs-keyword">false</span>, <span class="hljs-keyword">null</span>);<font></font>
       }<font></font>
<font></font>
<font></font>
       Operation newOperation = dto.getOperation();<font></font>
       <span class="hljs-keyword">if</span> (newOperation != <span class="hljs-keyword">null</span>) {
           <span class="hljs-keyword">int</span> newOperationIndex = dto.getPrevLogIndex() + <span class="hljs-number">1</span>;<font></font>
           <font></font>
         <span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>) {
               <span class="hljs-comment">//5</span>
               <span class="hljs-keyword">if</span> ((newOperationIndex &lt;= operationsLog.getLastIndex()) &amp;&amp;<font></font>
                      (!newOperation.getTerm().equals(operationsLog.getTerm(newOperationIndex)))){<font></font>
                   operationsLog.removeAllFromIndex(newOperationIndex);<font></font>
               }<font></font>
               <span class="hljs-comment">//6</span>
               <span class="hljs-keyword">if</span> (newOperationIndex &lt;= operationsLog.getLastIndex())<font></font>
               {<font></font>
                 <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AnswerAppendDTO(context.getId(), context.getCurrentTerm(), <span class="hljs-keyword">true</span>,      operationsLog.getLastIndex());<font></font>
               }<font></font>
               <span class="hljs-comment">//7</span><font></font>
               operationsLog.append(newOperation);<font></font>
           }<font></font>
        }<font></font>
        <span class="hljs-comment">//8 </span>
        <span class="hljs-keyword">if</span> (dto.getLeaderCommit() &gt; context.getCommitIndex()) {<font></font>
           context.setCommitIndex(Math.min(dto.getLeaderCommit(), operationsLog.getLastIndex()));<font></font>
       }<font></font>
<font></font>
                 <font></font>
       <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AnswerAppendDTO(context.getId(), context.getCurrentTerm(), <span class="hljs-keyword">true</span>, operationsLog.getLastIndex());<font></font>
   }</code></pre><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn die Runde des Anf√ºhrers geringer ist als die Runde des Nachfolgers, senden wir unserem Anf√ºhrer eine Runde und ein Zeichen, dass seine Anfrage abgelehnt wurde. </font><font style="vertical-align: inherit;">Sobald der Anf√ºhrer eine Runde erh√§lt, die gr√∂√üer ist als seine Antwort, wird er zu einem Anh√§nger</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn die Runde des Anf√ºhrers gr√∂√üer ist als die Runde des Nachfolgers, setzen Sie diese Runde auf den Nachfolger.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Da die Anfrage vom Vorsitzenden eingegangen ist, setzen wir den Abstimmungszeitgeber zur√ºck, unabh√§ngig davon, ob Daten vorhanden sind oder nicht, und wenn wir kein Anh√§nger sind, werden wir es </font></font></li>
<li>   ,   ,            ,  ,   ,    ,   .        ,    ,      </li>
<li>              ,   .            .   ,     , - ,   ,      ,      ,      .             ,    .</li>
<li>  ,   .  ,    </li>
<li>  ,     </li>
<li>        ,   ,       ,    . </li>
</ol><br>
<h3>   </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es bleibt nur herauszufinden, wie der Leiter Operationen aus dem Protokoll auf die Datenbank anwendet. Beim Senden von Vorg√§ngen an Follower und Verarbeiten von Antworten von diesen aktualisiert der Leiter die Metadaten der Knoten. Sobald die Anzahl der Knoten, deren Index der letzten Operation im Protokoll gr√∂√üer ist als der Index der letzten Operation, die vom Leader auf die Datenbank angewendet wurde, dem Quorum entspricht, k√∂nnen wir angeben, dass die meisten Knoten die Operation empfangen haben, und sie auf die Leader-Datenbank anwenden. Mit anderen Worten, wenn ein Anf√ºhrer eine Operation an Follower gesendet hat und die meisten von ihnen sie in sein Protokoll eingef√ºgt und dem Anf√ºhrer geantwortet haben, k√∂nnen wir diese Operation auf die Datenbank des Anf√ºhrers anwenden und den Index der zuletzt angewendeten Operation erh√∂hen. Dieser Index mit der n√§chsten Append-Heartbeat-Anforderung fliegt zum Follower und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wendet die Operation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit demselben Index aus seinem Protokoll auf seine Datenbank an.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns die </font></font><code>tryToCommit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klassenmethode </font><font style="vertical-align: inherit;">analysieren</font></font><code>ReplicationServiceImpl</code><br>
<br>
<pre><code class="java hljs">  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">tryToCommit</span><span class="hljs-params">()</span> </span>{
       <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) {
           <span class="hljs-comment">//1</span>
           <span class="hljs-keyword">int</span> N = context.getCommitIndex() + <span class="hljs-number">1</span>;
           <span class="hljs-comment">//2</span><font></font>
           Supplier&lt;Long&gt; count = () -&gt;<font></font>
               context.getPeers().stream().map(Peer::getMatchIndex).<font></font>
                       filter(matchIndex -&gt; matchIndex &gt;= N).count() + <span class="hljs-number">1</span>;<font></font>
<font></font>
           <span class="hljs-comment">//3 </span>
           <span class="hljs-keyword">if</span> (operationsLog.getLastIndex() &gt;= N &amp;&amp;<font></font>
                   operationsLog.getTerm(N).equals(context.getCurrentTerm())&amp;&amp;<font></font>
                      count.get()&gt;=context.getQuorum()<font></font>
           )<font></font>
           {<font></font>
               context.setCommitIndex(N);<font></font>
           } <span class="hljs-keyword">else</span>
               <span class="hljs-keyword">return</span>;<font></font>
       }<font></font>
   }</code></pre><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir erhalten den folgenden Index der Operation, die auf die Datenbank angewendet wird</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir z√§hlen, wie viele Follower eine Operation mit einem solchen Index in ihren Protokollen haben, und vergessen nicht, einen Leader hinzuzuf√ºgen </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn die Anzahl solcher Follower beschlussf√§hig ist und sich die Operation mit einem solchen Index im Protokoll des Leiters befindet und die Runde dieser Operation der aktuellen entspricht, wendet der Leiter die Operation auf die Datenbank an und erh√∂ht den Index der zuletzt angewendeten Operation. </font><font style="vertical-align: inherit;">Operationen aus der vorherigen Runde k√∂nnen nicht angewendet werden, da ein anderer Anf√ºhrer f√ºr sie verantwortlich war und ein Konflikt entstehen k√∂nnte. </font><font style="vertical-align: inherit;">Jeder Anf√ºhrer wendet nur Operationen seiner aktuellen Runde an.</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jeder verteilte Algorithmus, dessen Vertreter RAFT ist, ist eine leistungsstarke integrierte L√∂sung, die das Erreichen des Ergebnisses unter Einhaltung aller in der Spezifikation beschriebenen Regeln garantiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt viele verteilte Algorithmen und sie sind unterschiedlich. Es gibt ZAB, das in Zookeeper implementiert ist und beispielsweise zum Synchronisieren von Daten in Kafka verwendet wird. Es gibt Algorithmen mit weniger strengen Anforderungen an die Konsistenz, beispielsweise die Masse der Implementierungen des Gossip-Protokolls, die in AP-Systemen verwendet werden. Es gibt Algorithmen, die den Prinzipien von RAFT folgen und gleichzeitig das Klatschprotokoll f√ºr den Austausch von Protokollen verwenden, z. B. MOKKA, das auch Verschl√ºsselung verwendet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich glaube, dass der Versuch, einen dieser Algorithmen herauszufinden, f√ºr jeden Entwickler √§u√üerst n√ºtzlich ist, und wie oben erw√§hnt, k√∂nnen L√∂sungen sowohl umfassend als auch in separaten Teilen interessant sein. </font><font style="vertical-align: inherit;">Und nat√ºrlich m√ºssen Sie auf jeden Fall in diese Richtung schauen, wenn sich die Aktivit√§ten auf die Entwicklung verteilter Systeme und die Datensynchronisation beziehen, auch wenn sie industrielle Standardl√∂sungen verwenden.</font></font><br>
 <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verweise</font></font></h3><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Repository</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spezifikation</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kurzbeschreibung</font></font></a></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir hoffen, dass das Material f√ºr Sie n√ºtzlich war. </font><font style="vertical-align: inherit;">Und wenn Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einen Kurs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> belegen m√∂chten </font><font style="vertical-align: inherit;">, k√∂nnen Sie dies jetzt tun.</font></font></b></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de495342/index.html">Abrechnung von Bankkarten im Handel - Erstellen eines offenen Datensatzes und einer Infografik in Google Data Studio</a></li>
<li><a href="../de495344/index.html">Vereinheitlichen Sie es: Wie Lamoda seine Go-Services konsistent macht</a></li>
<li><a href="../de495346/index.html">Vom Fehler zum Alarm mit Aktionen</a></li>
<li><a href="../de495350/index.html">Home-Webserver oder Ihr eigener Hosting-Anbieter</a></li>
<li><a href="../de495354/index.html">Wie kann man Produkte kontinuierlich in 20 Sprachen ver√∂ffentlichen und nicht sterben?</a></li>
<li><a href="../de495360/index.html">Wie wir die Portierung von Produkten von C # nach C ++ automatisiert haben</a></li>
<li><a href="../de495362/index.html">Selbstisolieren und programmieren: Wie man zu Hause nicht verr√ºckt wird und Zeit sinnvoll verbringt</a></li>
<li><a href="../de495364/index.html">API Style Guide, oder lassen Sie Benutzer nicht nachdenken</a></li>
<li><a href="../de495366/index.html">16 Arten von Programmierern oder Entwicklern sind nicht dieselben Roboter</a></li>
<li><a href="../de495368/index.html">Wir registrieren uns selbst f√ºr selbstlaufende Selbsthunde unter Bedingungen der Selbstisolation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>