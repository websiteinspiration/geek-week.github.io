<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙎🏿 👋🏿 🚓 Microsoft SQL ServerでRを使用してGoogleアナリティクスからデータを取得する方法 👒 🤚🏾 👁‍🗨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="この記事では、Microsoft SQL ServerでRを使用して、Googleアナリティクス（および一般に任意のAPI）からデータを取得する方法を詳しく説明します。
 

謝辞：
 

私はマーケティング担当者ではなかったので、専門家の助けが必要でした。テストルームとGoogle Analyti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Microsoft SQL ServerでRを使用してGoogleアナリティクスからデータを取得する方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466339/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事では、Microsoft SQL ServerでRを使用して、Googleアナリティクス（および一般に任意のAPI）からデータを取得する方法を詳しく説明します。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">謝辞：</font></font></p><br>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私はマーケティング担当者ではなかったので、専門家の助けが必要でした。</font><font style="vertical-align: inherit;">テストルームとGoogle Analytics（GA）へのアクセスは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexei Seleznev</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が主催し</font><font style="vertical-align: inherit;">、実用的なアドバイスも提供しました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼はマーケティングのプロのアナリストです。</font><font style="vertical-align: inherit;">そして、助けへの感謝として、</font><font style="vertical-align: inherit;">アレクセイ</font><font style="vertical-align: inherit;">の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">電報チャンネルが</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここ</font><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">言及され</font><font style="vertical-align: inherit;">、そこで彼は彼の活動を行っています。</font></font></em></p><br>
<h4 id="zadacha---u-nas-est-server-ms-sql-i-my-hotim-poluchat-dannye-v-dwh-po-api"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タスク-MS SQLサーバーがあり、APIによってDWHでデータを受信したい</font></font></h4><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Analytics（GA）に接続するには、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">googleAnalyticsR</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージを使用します</font><font style="vertical-align: inherit;">。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このパッケージは、例えば、その人気のために選択されました。</font><font style="vertical-align: inherit;">別のパッケージを使用できます（例：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RGoogleAnalytic）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題を解決する方法は同じです。</font></font></p><a name="habracut"></a><br>
<h4 id="ustanavlivaem-r-na-servere-ms-sql"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS SQL ServerにRをインストールする</font></font></h4><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これは、MS SQLコンポーネントをインストールするための標準インターフェースを介して行われます。</font></font></p><br>
<p><img src="https://habrastorage.org/webt/h1/b6/ls/h1b6ls8d_lgdpu902rrfe3v4qtq.png"></p><br>
<p><img src="https://habrastorage.org/webt/se/ld/n_/seldn_yx4cdfdqkus8-w54pk0k8.png"></p><br>
<p><img src="https://habrastorage.org/webt/gf/-g/zw/gf-gzwnjlnlgtuksv5-wmjxbb30.png"></p><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これは、SQL Serverが直接動作するRです（SQLクエリで呼び出されます）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RのクライアントコピーをRStudioから使用すると、データベースサーバーで何かが破壊される心配はありません。 </font></font></li>
</ol><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライセンスに同意し、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常のR</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はインストールされないことに注意してください</font><font style="vertical-align: inherit;">。ただし、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft R Open</font></font></a></p><br>
<p><img src="https://habrastorage.org/webt/ns/0o/gd/ns0ogdh5m3bfm8mjefxtdailvue.png"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">簡単に言えば、</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MicrosoftはR Openをパッケージで強化し、無料で配布しています。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、このバージョンのRのパッケージは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CRANでは</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なく</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MRAN</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でダウンロードできます</font><font style="vertical-align: inherit;">。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しかし、それだけではありません。</font><font style="vertical-align: inherit;">実際に、MS SQLをインストールすると、純粋なMRANではなく、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft ML Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が得られ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font></p><br>
<p>   ,     R     – <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">RevoScaleR</a>.</p><br>
<p>RevoScaleR ,            .</p><br>
<p>      ,          R.</p><br>
<p>         R  Microsoft.</p><br>
<p><img src="https://habrastorage.org/webt/sm/yl/an/smylanlw8kctrkylh_inrj_wrns.png"></p><br>
<p>       ,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">RStudio</a>.</p><br>
<h4 id="nastraivaem-sql-server-na-rabotu-s-r"> SQL server    R</h4><br>
<p> SSMS   :</p><br>
<p>  SQL   </p><br>
<pre><code class="sql hljs">sp_configure 'external scripts enabled', 1;<font></font>
RECONFIGURE <span class="hljs-keyword">WITH</span> OVERRIDE;  </code></pre><br>
<p> Server SQL<br>
<img src="https://habrastorage.org/webt/yu/qf/tn/yuqftnhqd9w3mlxtpazqtnmla2o.png"></p><br>
<p>,   R  </p><br>
<pre><code class="sql hljs"><span class="hljs-keyword">EXECUTE</span> sp_execute_external_script<font></font>
@<span class="hljs-keyword">language</span> =N<span class="hljs-string">'R'</span>,<font></font>
@script=N<span class="hljs-string">'print(version)'</span>;</code></pre><br>
<p>  R ,   SQL </p><br>
<pre><code class="sql hljs"><span class="hljs-keyword">declare</span> @Rscript <span class="hljs-keyword">nvarchar</span>(<span class="hljs-keyword">max</span>)<font></font>
<font></font>
<span class="hljs-keyword">set</span> @Rscript = N<span class="hljs-string">'
    InstaledLibrary &lt;- library()
    InstaledLibrary &lt;- as.data.frame(InstaledLibrary$results )
    OutputDataSet &lt;- InstaledLibrary
'</span><font></font>
<font></font>
<span class="hljs-keyword">EXECUTE</span> sp_execute_external_script<font></font>
    @<span class="hljs-keyword">language</span> = N<span class="hljs-string">'R'</span><font></font>
    , @script = @Rscript<font></font>
<span class="hljs-keyword">WITH</span> <span class="hljs-keyword">RESULT</span> <span class="hljs-keyword">SETS</span> (([<span class="hljs-keyword">Package</span>] <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<font></font>
[LibPath] <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<font></font>
[Title] <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>));</code></pre><br>
<p><img src="https://habrastorage.org/webt/ol/_y/oj/ol_yojqjdgdmv-nksxrfacxoxtm.png"> </p><br>
<p><em>     R  MS SQL:<br>
C:/Program Files/Microsoft SQL Server/MSSQL14.MSSQLSERVER/R_SERVICES/library<br>
</em></p><br>
<p> RStudio. </p><br>
<p> ,        R   ,      SQL .</p><br>
<p><img src="https://habrastorage.org/webt/zc/qy/b_/zcqyb_ovi7u699vrcuxcgasczqe.png"></p><br>
<p><img src="https://habrastorage.org/webt/l2/i9/oh/l2i9ohuqn5zkywadbiphg2e1doi.png"></p><br>
<p>    RStudio.</p><br>
<h4 id="ustanavlivaem-paket-googleanalyticsr">  googleAnalyticsR</h4><br>
<p> RStudio </p><br>
<pre><code class="python hljs">library()</code></pre><br>
<p>       R (   RStudio)</p><br>
<p><img src="https://habrastorage.org/webt/yq/pl/dx/yqpldxxzpmjf1flqqd9-oztsrn4.png"></p><br>
<p>    :<br>
C:/Program Files/Microsoft SQL Server/140/R_SERVER/library</p><br>
<p> RStudio   googleAnalyticsR</p><br>
<p><img src="https://habrastorage.org/webt/0z/ti/wq/0ztiwqcivhytf2u2rlyd8c1l-dq.png"></p><br>
<p><img src="https://habrastorage.org/webt/lx/cx/sn/lxcxsnitj9cw_zn37apqajbugbm.png"></p><br>
<p>    :<br>
     -     MS SQL.         ZIP .</p><br>
<p><img src="https://habrastorage.org/webt/4q/t5/ue/4qt5ueo_hzv0bv4qiwuu96g-0gs.png"></p><br>
<p>         .</p><br>
<p><img src="https://habrastorage.org/webt/kf/ge/9j/kfge9jhiz7ccurynbi3yr7amh2k.png"></p><br>
<p>       R Services (    MS SQL).</p><br>
<p><em>    <br>
C:/Program Files/Microsoft SQL Server/MSSQL14.MSSQLSERVER/R_SERVICES/library</em></p><br>
<p>         R (c   RStudio) </p><br>
<p><em>    <br>
C:/Program Files/Microsoft SQL Server/140/R_SERVER/library</em></p><br>
<p><u>(       )</u></p><br>
<p>    R Services     library,   ,           .</p><br>
<p>     .</p><br>
<p>      .<br>
    ,    .<br>
(   GA   ,       )</p><br>
<p> RStudio     </p><br>
<p><img src="https://habrastorage.org/webt/vi/w4/yq/viw4yqtkwn3f92tozbpgsm-lifm.png"></p><br>
<p>     .<br>
     ,      .</p><br>
<h4 id="proveryaem-dostup-ms-sql-v-internet">  MS SQL  </h4><br>
<pre><code class="sql hljs"><span class="hljs-keyword">declare</span> @Rscript <span class="hljs-keyword">nvarchar</span>(<span class="hljs-keyword">max</span>)<font></font>
<font></font>
<span class="hljs-keyword">set</span> @Rscript = N<span class="hljs-string">'
    library(httr)
    HEAD("https://www.yandex.ru", verbose())
    '</span><font></font>
<font></font>
<span class="hljs-keyword">EXECUTE</span> sp_execute_external_script<font></font>
    @<span class="hljs-keyword">language</span> = N<span class="hljs-string">'R'</span>
    , @script = @Rscript</code></pre><br>
<p> SQL Server       ,         . </p><br>
<p><img src="https://habrastorage.org/webt/ct/pz/os/ctpzos-kjpqtligr_cje3kg3xou.png"></p><br>
<p>     R   SQL.</p><br>
<p>SQL 2017</p><br>
<p><img src="https://habrastorage.org/webt/bj/lk/hl/bjlkhlu9qy4twf-arpu8dr2jgua.gif"></p><br>
<p>SQL2019</p><br>
<p><img src="https://habrastorage.org/webt/bn/pi/co/bnpicoaaii15qaqx-hu-xj2zq6u.gif"></p><br>
<p> SSMS</p><br>
<pre><code class="sql hljs"><span class="hljs-comment">--     </span>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span> Demo
<span class="hljs-keyword">go</span><font></font>
<font></font>
<span class="hljs-keyword">use</span> Demo
<span class="hljs-keyword">go</span><font></font>
<font></font>
<span class="hljs-comment">--  ,       Google Analytics  </span>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">schema</span> GA
<span class="hljs-keyword">go</span><font></font>
<font></font>
<span class="hljs-comment">--        GA</span>
<span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">exists</span> [GA].[token]<font></font>
<font></font>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> [GA].[token](<font></font>
[<span class="hljs-keyword">id</span>] <span class="hljs-built_in">varchar</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,<font></font>
[<span class="hljs-keyword">value</span>] varbinary(<span class="hljs-keyword">max</span>)
<span class="hljs-keyword">constraint</span> unique_id <span class="hljs-keyword">unique</span> (<span class="hljs-keyword">id</span>))</code></pre><br>
<h4 id="poluchaem-token-google-analytics">  Google Analytics</h4><br>
<p> RStudio   :<br>
        Google ,           Google Analytics.</p><br>
<pre><code class="python hljs"><span class="hljs-comment">#      </span>
Sys.setenv(TZ=<span class="hljs-string">"Europe/Berlin"</span>)<font></font>
<font></font>
library(googleAnalyticsR)<font></font>
<font></font>
<span class="hljs-comment">#  </span><font></font>
ga_auth()<font></font>
<font></font>
PathTokenFile &lt;- paste (  getwd(),<span class="hljs-string">"/"</span>, <span class="hljs-string">".httr-oauth"</span> , sep=<span class="hljs-string">""</span>)<font></font>
TokenFile &lt;- readBin(PathTokenFile, <span class="hljs-string">"raw"</span>, file.info(PathTokenFile)$size)<font></font>
<font></font>
<span class="hljs-comment">#    </span>
conStr &lt;- <span class="hljs-string">'Driver={SQL Server};Server=EC2AMAZ-68OQ7JV;Database=Demo;Uid=Sa;Pwd=SaSql123'</span>
ds &lt;- RxOdbcData(table=<span class="hljs-string">"ga.token"</span>, connectionString=conStr)<font></font>
<font></font>
<span class="hljs-comment">#    </span>
rxWriteObject(ds, <span class="hljs-string">"ga_TokenFile"</span>, TokenFile)</code></pre><br>
<p> SSMS     Google     </p><br>
<pre><code class="sql hljs"><span class="hljs-keyword">Select</span> * <span class="hljs-keyword">from</span> [GA].[token]</code></pre><br>
<h4 id="proveryaem-podklyuchenie-k-ga-cherez-rstudio">   GA  RStudio</h4><br>
<pre><code class="python hljs"><span class="hljs-comment">#    RStudio</span>
Sys.setenv(TZ=<span class="hljs-string">"Europe/Berlin"</span>)<font></font>
library(googleAnalyticsR)<font></font>
<font></font>
<span class="hljs-comment">#    </span>
conStr &lt;- <span class="hljs-string">'Driver={SQL Server};Server=EC2AMAZ-68OQ7JV;Database=Demo;Uid=Sa;Pwd=SaSql123'</span> <span class="hljs-comment">#     </span>
ds &lt;- RxOdbcData(table=<span class="hljs-string">"ga.token"</span>, connectionString=conStr)<font></font>
<font></font>
PathTokenFile &lt;- paste (  getwd(),<span class="hljs-string">"/"</span>, <span class="hljs-string">".httr-oauth"</span> , sep=<span class="hljs-string">""</span>)<font></font>
<font></font>
TokenFile &lt;- rxReadObject(ds, <span class="hljs-string">"ga_TokenFile"</span>)<font></font>
<font></font>
write.filename = file(PathTokenFile, <span class="hljs-string">"wb"</span>)<font></font>
writeBin(TokenFile, write.filename)<font></font>
<font></font>
close(write.filename)<font></font>
<font></font>
Sys.setenv(<span class="hljs-string">"GA_AUTH_FILE"</span> = PathTokenFile)<font></font>
<font></font>
<span class="hljs-comment">#  </span><font></font>
ga_auth()<font></font>
<font></font>
<span class="hljs-comment">#  ga_id</span><font></font>
account_list &lt;- ga_account_list()<font></font>
ga_id &lt;- account_list$viewId<font></font>
<font></font>
<span class="hljs-comment">#   </span><font></font>
OutputDataSet &lt;-google_analytics(ga_id,<font></font>
                                 start=<span class="hljs-string">"2019-01-01"</span>,<font></font>
                                 end=<span class="hljs-string">"2019-08-01"</span>,<font></font>
                                 metrics = <span class="hljs-string">"sessions"</span>,<font></font>
                                 dimensions = <span class="hljs-string">"date"</span>)<font></font>
<font></font>
OutputDataSet</code></pre><br>
<p>     R   SQL   .</p><br>
<pre><code class="sql hljs"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">exists</span> <span class="hljs-comment">#GA_session</span><font></font>
<font></font>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-comment">#GA_session</span><font></font>
(<font></font>
[<span class="hljs-built_in">date</span>] <span class="hljs-built_in">date</span>,<font></font>
[sessions] <span class="hljs-built_in">int</span><font></font>
)<font></font>
<font></font>
    <span class="hljs-keyword">declare</span> @Rscript <span class="hljs-keyword">nvarchar</span>(<span class="hljs-keyword">max</span>)<font></font>
<font></font>
    <span class="hljs-keyword">set</span> @Rscript = N<span class="hljs-string">'
#    RStudio
Sys.setenv(TZ="Europe/Berlin")
library(googleAnalyticsR)

#    
conStr &lt;- ''Driver={SQL Server};Server=EC2AMAZ-68OQ7JV;Database=Demo;Uid=Sa;Pwd=SaSql123'' #     
ds &lt;- RxOdbcData(table="ga.token", connectionString=conStr)

PathTokenFile &lt;- paste (  getwd(),"/", ".httr-oauth" , sep="")

TokenFile &lt;- rxReadObject(ds, "ga_TokenFile")

write.filename = file(PathTokenFile, "wb")
writeBin(TokenFile, write.filename)

close(write.filename)

Sys.setenv("GA_AUTH_FILE" = PathTokenFile)

#  
ga_auth()

#  ga_id
account_list &lt;- ga_account_list()
ga_id &lt;- account_list$viewId

#   
OutputDataSet &lt;-google_analytics(ga_id,
                                 start="2019-01-01",
                                 end="2019-08-01",
                                 metrics = "sessions",
                                 dimensions = "date")

OutputDataSet$date  &lt;- as.character(OutputDataSet$date)
'</span><font></font>
<font></font>
<span class="hljs-comment">-- print @Rscript</span><font></font>
<font></font>
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-comment">#GA_session ([date],[sessions])</span>
 <span class="hljs-keyword">EXECUTE</span> sp_execute_external_script <font></font>
    @<span class="hljs-keyword">language</span> = N<span class="hljs-string">'R'</span>,  <font></font>
    @script = @Rscript<font></font>
<font></font>
<span class="hljs-keyword">Select</span> * 
<span class="hljs-keyword">from</span> <span class="hljs-comment">#GA_session</span>
<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> [<span class="hljs-built_in">date</span>] <span class="hljs-keyword">asc</span></code></pre><br>
<p>         –    .<br>
      .</p><br>
<pre><code class="sql hljs">conStr &lt;- ''Driver={SQL Server};Server=EC2AMAZ-68OQ7JV;Database=Demo;Trusted_Connection=true'' <span class="hljs-comment">#   &lt;&lt;&lt;===     –     </span></code></pre><br>
<p>         R     .</p><br>
<p><img src="https://habrastorage.org/webt/kl/d4/kc/kld4kcpha_8hjpzvwjiuxeidpog.gif"></p><br>
<p>(,    ,      )</p><br>
<p> SQL    </p><br>
<pre><code class="sql hljs"><span class="hljs-keyword">Create</span> <span class="hljs-keyword">procedure</span> Ga.Get_session <font></font>
     @Date_start <span class="hljs-built_in">date</span> =<span class="hljs-string">'2019-01-01'</span>,<font></font>
     @Date_End <span class="hljs-built_in">date</span> =<span class="hljs-string">'2019-08-01'</span>
<span class="hljs-keyword">as</span><font></font>
<font></font>
<span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">exists</span> <span class="hljs-comment">#GA_session</span><font></font>
<font></font>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-comment">#GA_session</span><font></font>
(<font></font>
[<span class="hljs-built_in">date</span>] <span class="hljs-built_in">date</span>,<font></font>
[sessions] <span class="hljs-built_in">int</span><font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">declare</span> @Rscript <span class="hljs-keyword">nvarchar</span>(<span class="hljs-keyword">max</span>)<font></font>
<font></font>
<span class="hljs-keyword">set</span> @Rscript =<span class="hljs-keyword">CONCAT</span>( N<span class="hljs-string">'
#    RStudio
Sys.setenv(TZ="Europe/Berlin")
library(googleAnalyticsR)

#    
conStr &lt;- ''Driver={SQL Server};Server=EC2AMAZ-68OQ7JV;Database=Demo;Trusted_Connection=true'' #   &lt;&lt;&lt;===     -   
ds &lt;- RxOdbcData(table="ga.token", connectionString=conStr)

PathTokenFile &lt;- paste (  getwd(),"/", ".httr-oauth" , sep="")

TokenFile &lt;- rxReadObject(ds, "ga_TokenFile")

write.filename = file(PathTokenFile, "wb")
writeBin(TokenFile, write.filename)

close(write.filename)

Sys.setenv("GA_AUTH_FILE" = PathTokenFile)

#  
ga_auth()

#  ga_id
account_list &lt;- ga_account_list()
ga_id &lt;- account_list$viewId

#   
OutputDataSet &lt;-google_analytics(ga_id,
                                 start="'</span> , @Date_start ,N<span class="hljs-string">'",
                                 end="'</span> , @Date_End ,N<span class="hljs-string">'",
                                 metrics = "sessions",
                                 dimensions = "date")

OutputDataSet$date  &lt;- as.character(OutputDataSet$date)
'</span><font></font>
)<font></font>
<span class="hljs-comment">-- print @Rscript</span><font></font>
<font></font>
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-comment">#GA_session ([date],[sessions])</span>
 <span class="hljs-keyword">EXECUTE</span> sp_execute_external_script <font></font>
    @<span class="hljs-keyword">language</span> = N<span class="hljs-string">'R'</span>,  <font></font>
    @script = @Rscript<font></font>
<font></font>
<span class="hljs-keyword">Select</span> * 
<span class="hljs-keyword">from</span> <span class="hljs-comment">#GA_session</span>
<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> [<span class="hljs-built_in">date</span>] <span class="hljs-keyword">asc</span></code></pre><br>
<p>  </p><br>
<pre><code class="sql hljs"><span class="hljs-comment">--   </span><font></font>
exec  Ga.Get_session <font></font>
<font></font>
<span class="hljs-comment">--     </span><font></font>
exec  Ga.Get_session  <font></font>
    @Date_start  ='2019-08-01',<font></font>
    @Date_End  ='2019-09-01'</code></pre><br>
<p>R         R Studio.     SQL .<br>
     dimensions     landingPage  .</p><br>
<pre><code class="sql hljs"><span class="hljs-keyword">Create</span> <span class="hljs-keyword">procedure</span> [GA].[Get_landingPage_session] <font></font>
 @Date_start <span class="hljs-built_in">date</span> =<span class="hljs-string">'2019-01-01'</span>,<font></font>
 @Date_End <span class="hljs-built_in">date</span> =<span class="hljs-string">'2019-08-01'</span>
<span class="hljs-keyword">as</span><font></font>
<font></font>
<span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">exists</span> <span class="hljs-comment">#GA_session</span><font></font>
<font></font>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-comment">#GA_session</span><font></font>
(<font></font>
[<span class="hljs-built_in">date</span>] <span class="hljs-built_in">date</span>,<font></font>
landingPagePath <span class="hljs-keyword">nvarchar</span>(<span class="hljs-keyword">max</span>),<font></font>
[sessions] <span class="hljs-built_in">int</span><font></font>
)<font></font>
<font></font>
    <span class="hljs-keyword">declare</span> @Rscript <span class="hljs-keyword">nvarchar</span>(<span class="hljs-keyword">max</span>)<font></font>
<font></font>
    <span class="hljs-keyword">set</span> @Rscript =<span class="hljs-keyword">CONCAT</span>( N<span class="hljs-string">'
#    RStudio
Sys.setenv(TZ="Europe/Berlin")
library(googleAnalyticsR)

#    
conStr &lt;- ''Driver={SQL Server};Server=EC2AMAZ-68OQ7JV;Database=Demo;Trusted_Connection=true'' #   &lt;&lt;&lt;===     -   
ds &lt;- RxOdbcData(table="ga.token", connectionString=conStr)

PathTokenFile &lt;- paste (  getwd(),"/", ".httr-oauth" , sep="")

TokenFile &lt;- rxReadObject(ds, "ga_TokenFile")

write.filename = file(PathTokenFile, "wb")
writeBin(TokenFile, write.filename)

close(write.filename)

Sys.setenv("GA_AUTH_FILE" = PathTokenFile)

#  
ga_auth()

#  ga_id
account_list &lt;- ga_account_list()
ga_id &lt;- account_list$viewId

#   
OutputDataSet &lt;-google_analytics(ga_id,
                                 start="'</span> , @Date_start ,N<span class="hljs-string">'",
                                 end="'</span> , @Date_End ,N<span class="hljs-string">'",
                                 metrics = "sessions",
                                 dimensions = c("date" ,"landingPagePath"))

OutputDataSet$date  &lt;- as.character(OutputDataSet$date)

'</span><font></font>
)<font></font>
<span class="hljs-comment">-- print @Rscript</span><font></font>
<font></font>
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-comment">#GA_session ([date],landingPagePath,[sessions])</span>
 <span class="hljs-keyword">EXECUTE</span> sp_execute_external_script <font></font>
    @<span class="hljs-keyword">language</span> = N<span class="hljs-string">'R'</span>,  <font></font>
    @script = @Rscript<font></font>
<font></font>
<span class="hljs-keyword">Select</span> * 
<span class="hljs-keyword">from</span> <span class="hljs-comment">#GA_session</span>
<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> [<span class="hljs-built_in">date</span>] <span class="hljs-keyword">asc</span></code></pre><br>
<p> </p><br>
<pre><code class="sql hljs">exec [GA].[Get_landingPage_session]</code></pre><br>
<p>   .</p><br>
<p>  ,    R  SQL      API<br>
:    </p><br>
<pre><code class="sql hljs"><span class="hljs-comment">-- https://www.cbr-xml-daily.ru</span><font></font>
<font></font>
<span class="hljs-keyword">Declare</span> @script <span class="hljs-keyword">nvarchar</span>(<span class="hljs-keyword">max</span>) <font></font>
<font></font>
 <span class="hljs-keyword">set</span> @script = N<span class="hljs-string">'           
    encoding = "utf-8"
    Sys.setlocale("LC_CTYPE", "russian")
    Sys.setenv(TZ="Europe/Berlin")

    library(httr)
    url &lt;- "https://www.cbr-xml-daily.ru/daily_json.js"
    resp &lt;- GET(url)
    library(jsonlite)
    Response &lt;- fromJSON(content(resp, as = "text"))
    OutputDataSet &lt;- data.frame(matrix(unlist(Response$Valute$USD), nrow=1, byrow=T),stringsAsFactors=FALSE)
    OutputDataSet &lt;- rbind(OutputDataSet,data.frame(matrix(unlist(Response$Valute$EUR), nrow=1, byrow=T),stringsAsFactors=FALSE))
    '</span><font></font>
<font></font>
EXEC sp_execute_external_script <font></font>
@<span class="hljs-keyword">language</span> = N<span class="hljs-string">'R'</span> <font></font>
, @script = @script<font></font>
 <span class="hljs-keyword">with</span> <span class="hljs-keyword">result</span> <span class="hljs-keyword">SETS</span> UNDEFINED </code></pre><br>
<p>      API, -    …</p><br>
<pre><code class="sql hljs"><span class="hljs-comment">-- https://dev.socrata.com/</span><font></font>
<font></font>
<span class="hljs-keyword">Declare</span> @script <span class="hljs-keyword">nvarchar</span>(<span class="hljs-keyword">max</span>) <font></font>
<font></font>
 <span class="hljs-keyword">set</span> @script = N<span class="hljs-string">'
    library(httr)
    url &lt;- "https://data.ct.gov/resource/y6p2-px98.json?category=Fruit&amp;item=Peaches"
    resp &lt;- GET(url)
    library(jsonlite)
    Response &lt;- fromJSON(content(resp, as = "text"))
    OutputDataSet &lt;- as.data.frame(Response)

    OutputDataSet &lt;-  OutputDataSet [,
                                 c("category" ,
                                   "item" , 
                                   "farmer_id"  , 
                                   "zipcode" ,  
                                   "business" , 
                                   "l" ,     
                                   "location_1_location",
                                   "location_1_city"  ,
                                   "location_1_state" ,
                                   "farm_name",        
                                   "phone1" ,            
                                   "website",    
                                   "suite")]
'</span><font></font>
<font></font>
EXEC sp_execute_external_script <font></font>
@<span class="hljs-keyword">language</span> = N<span class="hljs-string">'R'</span> <font></font>
, @script = @script<font></font>
 <span class="hljs-keyword">with</span> <span class="hljs-keyword">result</span> <span class="hljs-keyword">SETS</span> UNDEFINED </code></pre><br>
<h4 id="itogo">:</h4><br>
<ul>
<li>    </li>
<li>      active directory</li>
<li>   </li>
<li>     ,     </li>
<li>           </li>
</ul><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのコードを含むMS SQL 2017データベースのバックアップは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちら</font></font></a><font style="vertical-align: inherit;"><em><font style="vertical-align: inherit;">から</font></em><font style="vertical-align: inherit;">入手でき</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a></font><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（プレイするには、パッケージをインストールし、権限を配布し、サーバーの名前を指定する必要があります）</font></font></em></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja466323/index.html">Cortex M0 +マイクロコントローラーでポータブルプラットフォームゲームを作成します</a></li>
<li><a href="../ja466329/index.html">ロシアのワイン造りの電子地図。デザインとコンテンツ</a></li>
<li><a href="../ja466333/index.html">自分で職場を整える方法</a></li>
<li><a href="../ja466335/index.html">8base機能を使用したSlackアプリケーションの作成</a></li>
<li><a href="../ja466337/index.html">あなたの機能は何色ですか？</a></li>
<li><a href="../ja466341/index.html">Cisco 200-125 CCNA v3.0のトレーニング。33日目。ICND1試験の準備</a></li>
<li><a href="../ja466345/index.html">配色を構築するウェーブ法</a></li>
<li><a href="../ja466347/index.html">Cisco 200-125 CCNA v3.0のトレーニング。34日目。高度なVLANの概念</a></li>
<li><a href="../ja466349/index.html">15,000のオフラインストアでA / Bテストを実施する方法</a></li>
<li><a href="../ja466355/index.html">ワニは飛ぶが、低低（感情のないエクラノプレーンについてですが、余談があります）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>