<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïµüèΩ üôÑ üë©üèΩ‚Äçü§ù‚Äçüë®üèª I released a word processor formatting the hard drive after every 1024th save üéç üß§ üê¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Telling beginner storytellers about how you once seriously screwed up is a good way to help them deal with impostor syndrome .
 
 It was probably 1984...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>I released a word processor formatting the hard drive after every 1024th save</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/504818/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telling beginner storytellers about how you once seriously screwed up is a good way to help them deal with </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">impostor syndrome</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
It was probably 1984-1985. Then I was a 25-year-old budding programmer with five years of experience. I and another programmer wrote and supported a set of applications similar to today's Office: spreadsheets, word processor, database, plotter, etc. We set up this whole system for three to four vertical markets [ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">highly specialized business clients / approx. perev.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I wrote most of the word processor myself. I wrote at </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fort</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and for various combinations of OSes and processors. Young people are not familiar, but in those days, new microcomputers with their own special OS and one of several processor options came out every few months. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fort used the exchange of block data with the disk. Each block had a length of 1 kb, and in order to save something more than 1 kb, it was necessary to work with the master block of the file, where the offsets of all blocks with data were stored - in fact, it was a couple of lists of occupied and unoccupied blocks.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To initialize this master block, it had to be filled with zeros. Well, it started. In short, I changed the application so that it supported files twice as large as before - and instead of 256 elements in the master block, 1024 appeared. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Each entry took up - attention - one word from 16 bits. Therefore, if 512 words still fit into my 1 kb master block, then 1024 words already required the use of two blocks. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, I changed the number of blocks filled with zeros, but I did not change the buffer size. And when you work with unprotected memory, and you write 2048 zeros in the space of 1024 bytes, the remaining bytes will overwrite any random garbage that they find in memory.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In my case, any random garbage turned out to be the master block of the OS disk. Yes ... And when I initialized a new file, which happened every 1024th time when writing a one-block file, I overwritten the master block of the disk, which deleted all files from it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And we, of course, released this version, which worked for 8-9 weeks. And you can imagine the number of calls from customers that we had to receive. In the end, we advised everyone to keep backups (which was done, by the way, using video tapes) every single day. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I spent many weeks just apologizing over the phone while running my program in the debugger again and again. And I didn‚Äôt succeed. Nothing.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And then one woman called and described in colorful terms - and she worked in freight transport, so I now actively use her examples from the field of profanity - that she made a backup copy, launched a word processor, and he immediately cleaned her disk. She downloaded the backup again, and the processor again immediately erased her disk. She was furious. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And, imagine, it took me two whole hours to understand how lucky I was. I told this story to my colleague at dinner, and then it dawned on me - stop. Stop. At once? Everytime?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I called her and promised all the earthly blessings, if only she would pack this cassette and send it to us. I promised her to pay the shipping costs and cancel the monthly payments for our services (my boss did not hesitate for a second: ‚ÄúYes, hell, we will cancel her payments‚Äù). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And finally, I was able to reproduce this error. And she did not cheat. That backup that she saved turned out to be at a critical point: 1023 backups at the time of creation. Download the backup, save the file, and the drive is guaranteed to be cleaned. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maybe I'm exaggerating, but, in my opinion, I found the problem the same morning when we got the film. It was so easy to find in the debugger.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I looked at a 2 kb block that was supposed to be written, and the last 1 kb was filled with some kind of garbage. </font><font style="vertical-align: inherit;">It seemed strange to me, and I began to understand. </font><font style="vertical-align: inherit;">And, of course, it was not garbage - it was 1024 bytes of the disk master block that the OS stored next to my file master block. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I got a backup copy of the ‚Äúbefore‚Äù the kernel - I did not have a core dump, but it gave me a guaranteed way to get to this defect. </font><font style="vertical-align: inherit;">If I were not lucky, I would not have found him. </font><font style="vertical-align: inherit;">I would simply not have guessed that I was writing not in my memory, but in the system. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, yes - your ‚Äúmaster‚Äù geek has released a word processor, which within eight to nine weeks has formatted the client‚Äôs hard drive after every 1024th save. </font><font style="vertical-align: inherit;">Because, well, I'm a craftsman.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can find a lot of morality in this story, but here are two main ones for any junior:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Never write numeric constants except 0, 1, and -1 in your code.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Do not be so hard on yourself. </font><font style="vertical-align: inherit;">All your wise seniors have similar stories, and some of them have many.</font></font></li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en504800/index.html">dracut + systemd + LUKS + usbflash = auto unlock</a></li>
<li><a href="../en504804/index.html">Something that integrates chicken leg and iPhone 11</a></li>
<li><a href="../en504806/index.html">We analyze the masterpieces of painting with the help of classic ML</a></li>
<li><a href="../en504808/index.html">Hammock Driven Development - Rich Hickey (with Russian translation)</a></li>
<li><a href="../en504812/index.html">Instacart Human Delivery Price</a></li>
<li><a href="../en504822/index.html">What is the difference between ‚Äúapproved by the FDA‚Äù and ‚Äúapproved by the FDA‚Äù</a></li>
<li><a href="../en504828/index.html">JUG Ru Group # 4 Online Stream Week</a></li>
<li><a href="../en504838/index.html">Amazon wants to buy unmanned Zoox robotsaxi for a billion</a></li>
<li><a href="../en504840/index.html">Security Week 23: LiveJournal password leak</a></li>
<li><a href="../en504842/index.html">Retrospective: how Elon Musk affects Tesla's stock price</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>