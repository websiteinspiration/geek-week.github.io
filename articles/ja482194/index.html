<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👸🏿 👈🏾 ⛎ Nornirによるネットワークデバイス構成要素の自動生成と入力 🕞 🏔️ 👟</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは、ハブル！ 
 

最近、MikrotikとLinuxによる記事がここに落ちました。同様の問題が化石の手段で解決されたルーチンと自動化。そして、その仕事は絶対に典型的ですが、ハブレにはそれについて同様のものが見つかりません。あえてバイクを評判の良いITコミュニティに提供します。
 

これ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Nornirによるネットワークデバイス構成要素の自動生成と入力</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482194/"><p><img src="https://habrastorage.org/webt/7z/bp/zt/7zbpztvjkn5yfvxwcxudhj7hrja.png"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは、ハブル！ </font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最近、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=http://" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MikrotikとLinux</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">による記事がここに落ちました</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=http://" rel="nofollow"><font style="vertical-align: inherit;">。</font></a><font style="vertical-align: inherit;">同様の問題が化石の手段で解決された</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=http://" rel="nofollow"><font style="vertical-align: inherit;">ルーチンと自動化</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そして、その仕事は絶対に典型的ですが、ハブレにはそれについて同様のものが見つかりません。</font><font style="vertical-align: inherit;">あえてバイクを評判の良いITコミュニティに提供します。</font></font></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これはこのタスクの最初のバイクではありません。最初のオプションは</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ansible</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バージョン1.x.xで</font><font style="vertical-align: inherit;">数年前に実装され</font><font style="vertical-align: inherit;">ました。自転車はめったに使用されなかったため、常に錆びていました。タスク自体は、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ansibleの</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新バージョンほど頻繁には発生しないという意味で</font><font style="vertical-align: inherit;">。そして、あなたが行く必要があるたびに、チェーンが落ち、ホイールが落ちます。ただし、最初の部分であるconfigの生成は、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jinja2の</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エンジンが長く確立さ</font><font style="vertical-align: inherit;">れ</font><font style="vertical-align: inherit;">ている</font><font style="vertical-align: inherit;">ため、常に非常に明確に機能し</font><font style="vertical-align: inherit;">ます。しかし2番目の部分-構成を展開することは、原則として驚きをもたらしました。また、構成をリモートで数百台のデバイスのフロアに展開する必要があるため、このツールを使用するのは少し面倒です。</font></font></p><br>
<p>  ,   ,        <em>ansible</em>,    .   , ,  . <em>ansible</em> —   ,        DSL (Domain Specific Language),      .    ,  <em>ansible</em>   ,       ,   .</p><br>
<p>        .     <em>python</em>,    ,   <em>python</em>   <em>python</em>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Nornir</a></p><br>
<p> — <em>Nornir</em>  ,   <em>python</em>   <em>python</em>    .        <em>ansible</em>,         ..     ,        DSL,        ,    [|].</p><br>
<p>        . </p><br>
<p>           .     WAN-,        .   — BGP. WAN-   : Cisco ISG  Juniper SRX.</p><br>
<p> :     WAN-          —     BGP —     .</p><br>
<p>     ,         Cisco  Juniper.             ..    inventory</p><br>
<p>   Cisco:</p><br>
<pre><code class="bash hljs">$ cat templates/ios/base.j2 <font></font>
class-map match-all VIDEO_SURV<font></font>
 match access-group 111<font></font>
<font></font>
policy-map VIDEO_SURV<font></font>
 class VIDEO_SURV<font></font>
    police 1500000 conform-action transmit  exceed-action drop<font></font>
<font></font>
interface {{ host.task_data.ifname }}<font></font>
  description VIDEOSURV<font></font>
  ip address 10.10.{{ host.task_data.ipsuffix }}.254 255.255.255.0<font></font>
  service-policy input VIDEO_SURV<font></font>
<font></font>
router bgp {{ host.task_data.asn }}<font></font>
  network 10.40.{{ host.task_data.ipsuffix }}.0 mask 255.255.255.0<font></font>
<font></font>
access-list 11 permit 10.10.{{ host.task_data.ipsuffix }}.0 0.0.0.255<font></font>
access-list 111 permit ip 10.10.{{ host.task_data.ipsuffix }}.0 0.0.0.255 any</code></pre><br>
<p>  Juniper:</p><br>
<pre><code class="bash hljs">$ cat templates/junos/base.j2 
<span class="hljs-built_in">set</span> interfaces {{ host.task_data.ifname }} unit 0 description <span class="hljs-string">"Video surveillance"</span>
<span class="hljs-built_in">set</span> interfaces {{ host.task_data.ifname }} unit 0 family inet filter input <span class="hljs-built_in">limit</span>-in
<span class="hljs-built_in">set</span> interfaces {{ host.task_data.ifname }} unit 0 family inet address 10.10.{{ host.task_data.ipsuffix }}.254/24
<span class="hljs-built_in">set</span> policy-options policy-statement export2bgp term 1 from route-filter 10.10.{{ host.task_data.ipsuffix }}.0/24 exact
<span class="hljs-built_in">set</span> security zones security-zone WAN interfaces {{ host.task_data.ifname }}
<span class="hljs-built_in">set</span> firewall policer policer-1m <span class="hljs-keyword">if</span>-exceeding bandwidth-limit 1m
<span class="hljs-built_in">set</span> firewall policer policer-1m <span class="hljs-keyword">if</span>-exceeding burst-size-limit 187k
<span class="hljs-built_in">set</span> firewall policer policer-1m <span class="hljs-keyword">then</span> discard
<span class="hljs-built_in">set</span> firewall policer policer-1.5m <span class="hljs-keyword">if</span>-exceeding bandwidth-limit 1500000
<span class="hljs-built_in">set</span> firewall policer policer-1.5m <span class="hljs-keyword">if</span>-exceeding burst-size-limit 280k
<span class="hljs-built_in">set</span> firewall policer policer-1.5m <span class="hljs-keyword">then</span> discard
<span class="hljs-built_in">set</span> firewall filter <span class="hljs-built_in">limit</span>-in term 1 <span class="hljs-keyword">then</span> policer policer-1.5m
<span class="hljs-built_in">set</span> firewall filter <span class="hljs-built_in">limit</span>-in term 1 <span class="hljs-keyword">then</span> count limiter</code></pre><br>
<p>, ,    .    diff-    -          .</p><br>
<p>    ,          Juniper  3   Cisco.  :</p><br>
<ul>
<li>ifname</li>
<li>ipsuffix</li>
<li>asn</li>
</ul><br>
<p>        , ..    <em>inventory</em>. </p><br>
<p> <em>inventory</em>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Initializing Nornir</a> </p><br>
<p>.     : </p><br>
<pre><code class="bash hljs">.<font></font>
├── config.yaml<font></font>
├── inventory<font></font>
│   ├── defaults.yaml<font></font>
│   ├── groups.yaml<font></font>
│   └── hosts.yaml</code></pre><br>
<p> config.yaml —    nornir</p><br>
<pre><code class="plaintext hljs">$ cat config.yaml <font></font>
---<font></font>
core:<font></font>
    num_workers: 10<font></font>
<font></font>
inventory:<font></font>
    plugin: nornir.plugins.inventory.simple.SimpleInventory<font></font>
    options:<font></font>
        host_file: "inventory/hosts.yaml"<font></font>
        group_file: "inventory/groups.yaml"<font></font>
        defaults_file: "inventory/defaults.yaml"</code></pre><br>
<p>      <em>hosts.yaml</em>,  (    /)  <em>groups.yaml</em>,   <em>defaults.yaml</em>    ,       — ,     <em>yaml</em>    . </p><br>
<p>   hosts.yaml:</p><br>
<pre><code class="plaintext hljs">---<font></font>
srx-test:<font></font>
    hostname: srx-test<font></font>
    groups: <font></font>
        - juniper<font></font>
    data:<font></font>
        task_data:<font></font>
            ifname: fe-0/0/2<font></font>
            ipsuffix: 111<font></font>
<font></font>
cisco-test:<font></font>
    hostname: cisco-test<font></font>
    groups: <font></font>
        - cisco<font></font>
    data:<font></font>
        task_data:<font></font>
            ifname: GigabitEthernet0/1/1<font></font>
            ipsuffix: 222<font></font>
            asn: 65111</code></pre><br>
<p>   groups.yaml:</p><br>
<pre><code class="plaintext hljs">---<font></font>
cisco:<font></font>
    platform: ios<font></font>
    username: admin1<font></font>
    password: cisco1<font></font>
<font></font>
juniper:<font></font>
    platform: junos<font></font>
    username: admin2<font></font>
    password: juniper2</code></pre><br>
<p>   <em>inventory</em>   .     inventory-     <strong>InventoryElement</strong>. </p><br>
<div class="spoiler"><b class="spoiler_title">    InventoryElement</b><div class="spoiler_text"><pre><code class="json hljs">print(json.dumps(InventoryElement.schema(), indent=<span class="hljs-number">4</span>))<font></font>
{<font></font>
    <span class="hljs-attr">"title"</span>: <span class="hljs-string">"InventoryElement"</span>,
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span>,
    <span class="hljs-attr">"properties"</span>: {
        <span class="hljs-attr">"hostname"</span>: {
            <span class="hljs-attr">"title"</span>: <span class="hljs-string">"Hostname"</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"string"</span><font></font>
        },<font></font>
        <span class="hljs-attr">"port"</span>: {
            <span class="hljs-attr">"title"</span>: <span class="hljs-string">"Port"</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"integer"</span><font></font>
        },<font></font>
        <span class="hljs-attr">"username"</span>: {
            <span class="hljs-attr">"title"</span>: <span class="hljs-string">"Username"</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"string"</span><font></font>
        },<font></font>
        <span class="hljs-attr">"password"</span>: {
            <span class="hljs-attr">"title"</span>: <span class="hljs-string">"Password"</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"string"</span><font></font>
        },<font></font>
        <span class="hljs-attr">"platform"</span>: {
            <span class="hljs-attr">"title"</span>: <span class="hljs-string">"Platform"</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"string"</span><font></font>
        },<font></font>
        <span class="hljs-attr">"groups"</span>: {
            <span class="hljs-attr">"title"</span>: <span class="hljs-string">"Groups"</span>,
            <span class="hljs-attr">"default"</span>: [],
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"array"</span>,
            <span class="hljs-attr">"items"</span>: {
                <span class="hljs-attr">"type"</span>: <span class="hljs-string">"string"</span><font></font>
            }<font></font>
        },<font></font>
        <span class="hljs-attr">"data"</span>: {
            <span class="hljs-attr">"title"</span>: <span class="hljs-string">"Data"</span>,
            <span class="hljs-attr">"default"</span>: {},
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span><font></font>
        },<font></font>
        <span class="hljs-attr">"connection_options"</span>: {
            <span class="hljs-attr">"title"</span>: <span class="hljs-string">"Connection_Options"</span>,
            <span class="hljs-attr">"default"</span>: {},
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span>,
            <span class="hljs-attr">"additionalProperties"</span>: {
                <span class="hljs-attr">"$ref"</span>: <span class="hljs-string">"#/definitions/ConnectionOptions"</span><font></font>
            }<font></font>
        }<font></font>
    },<font></font>
    <span class="hljs-attr">"definitions"</span>: {
        <span class="hljs-attr">"ConnectionOptions"</span>: {
            <span class="hljs-attr">"title"</span>: <span class="hljs-string">"ConnectionOptions"</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span>,
            <span class="hljs-attr">"properties"</span>: {
                <span class="hljs-attr">"hostname"</span>: {
                    <span class="hljs-attr">"title"</span>: <span class="hljs-string">"Hostname"</span>,
                    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"string"</span><font></font>
                },<font></font>
                <span class="hljs-attr">"port"</span>: {
                    <span class="hljs-attr">"title"</span>: <span class="hljs-string">"Port"</span>,
                    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"integer"</span><font></font>
                },<font></font>
                <span class="hljs-attr">"username"</span>: {
                    <span class="hljs-attr">"title"</span>: <span class="hljs-string">"Username"</span>,
                    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"string"</span><font></font>
                },<font></font>
                <span class="hljs-attr">"password"</span>: {
                    <span class="hljs-attr">"title"</span>: <span class="hljs-string">"Password"</span>,
                    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"string"</span><font></font>
                },<font></font>
                <span class="hljs-attr">"platform"</span>: {
                    <span class="hljs-attr">"title"</span>: <span class="hljs-string">"Platform"</span>,
                    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"string"</span><font></font>
                },<font></font>
                <span class="hljs-attr">"extras"</span>: {
                    <span class="hljs-attr">"title"</span>: <span class="hljs-string">"Extras"</span>,
                    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span><font></font>
                }<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
}</code></pre></div></div><br>
<p>     ,  .          <strong>ipython</strong>. </p><br>
<pre><code class="bash hljs"> $ ipython3<font></font>
Python 3.6.9 (default, Nov  7 2019, 10:44:02) <font></font>
Type <span class="hljs-string">'copyright'</span>, <span class="hljs-string">'credits'</span> or <span class="hljs-string">'license'</span> <span class="hljs-keyword">for</span> more information<font></font>
IPython 7.1.1 -- An enhanced Interactive Python. Type <span class="hljs-string">'?'</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>.<font></font>
<font></font>
In [1]: from nornir import InitNornir                                                                           <font></font>
<font></font>
In [2]: nr = InitNornir(config_file=<span class="hljs-string">"config.yaml"</span>, dry_run=True)                                                <font></font>
<font></font>
In [3]: nr.inventory.hosts                                                                                      <font></font>
Out[3]: <font></font>
{<span class="hljs-string">'srx-test'</span>: Host: srx-test, <span class="hljs-string">'cisco-test'</span>: Host: cisco-test}<font></font>
<font></font>
In [4]: nr.inventory.hosts[<span class="hljs-string">'srx-test'</span>].data                                                                                    <font></font>
Out[4]: {<span class="hljs-string">'task_data'</span>: {<span class="hljs-string">'ifname'</span>: <span class="hljs-string">'fe-0/0/2'</span>, <span class="hljs-string">'ipsuffix'</span>: 111}}<font></font>
<font></font>
In [5]: nr.inventory.hosts[<span class="hljs-string">'srx-test'</span>][<span class="hljs-string">'task_data'</span>]                                                     <font></font>
Out[5]: {<span class="hljs-string">'ifname'</span>: <span class="hljs-string">'fe-0/0/2'</span>, <span class="hljs-string">'ipsuffix'</span>: 111}<font></font>
<font></font>
In [6]: nr.inventory.hosts[<span class="hljs-string">'srx-test'</span>].platform                                                                                <font></font>
Out[6]: <span class="hljs-string">'junos'</span>
</code></pre><br>
<p>      .     .       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"></a>      .      :</p><br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> nornir <span class="hljs-keyword">import</span> InitNornir
<span class="hljs-keyword">from</span> nornir.plugins.tasks <span class="hljs-keyword">import</span> networking, text
<span class="hljs-keyword">from</span> nornir.plugins.functions.text <span class="hljs-keyword">import</span> print_title, print_result<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">config_and_deploy</span>(<span class="hljs-params">task</span>):</span>
    <span class="hljs-comment"># Transform inventory data to configuration via a template file</span><font></font>
    r = task.run(task=text.template_file,<font></font>
                 name=<span class="hljs-string">"Base Configuration"</span>,<font></font>
                 template=<span class="hljs-string">"base.j2"</span>,<font></font>
                 path=<span class="hljs-string">f"templates/<span class="hljs-subst">{task.host.platform}</span>"</span>)<font></font>
<font></font>
    <span class="hljs-comment"># Save the compiled configuration into a host variable</span>
    task.host[<span class="hljs-string">"config"</span>] = r.result<font></font>
<font></font>
    <span class="hljs-comment"># Save the compiled configuration into a file</span>
    <span class="hljs-keyword">with</span> open(<span class="hljs-string">f"configs/<span class="hljs-subst">{task.host.hostname}</span>"</span>, <span class="hljs-string">"w"</span>) <span class="hljs-keyword">as</span> f:<font></font>
        f.write(r.result)<font></font>
<font></font>
    <span class="hljs-comment"># Deploy that configuration to the device using NAPALM</span><font></font>
    task.run(task=networking.napalm_configure,<font></font>
             name=<span class="hljs-string">"Loading Configuration on the device"</span>,<font></font>
             replace=<span class="hljs-literal">False</span>,<font></font>
             configuration=task.host[<span class="hljs-string">"config"</span>])<font></font>
<font></font>
nr = InitNornir(config_file=<span class="hljs-string">"config.yaml"</span>, dry_run=<span class="hljs-literal">True</span>) <span class="hljs-comment"># set dry_run=False, cross your fingers and run again</span><font></font>
<font></font>
<span class="hljs-comment"># run tasks</span><font></font>
result = nr.run(task=config_and_deploy)<font></font>
print_result(result)</code></pre><br>
<p>    <em>dry_run=True</em>     <strong>nr</strong>.<br>
      <em>ansible</em>         ,    ,     (   ;         NAPALM),       .       <em>dry_run</em>      <em>False</em>. </p><br>
<p>   Nornir     . </p><br>
<div class="spoiler"><b class="spoiler_title">        :</b><div class="spoiler_text"><pre><code class="plaintext hljs">config_and_deploy***************************************************************<font></font>
* cisco-test ** changed : True *******************************************<font></font>
vvvv config_and_deploy ** changed : True vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv INFO<font></font>
---- Base Configuration ** changed : True ------------------------------------- INFO<font></font>
class-map match-all VIDEO_SURV<font></font>
 match access-group 111<font></font>
<font></font>
policy-map VIDEO_SURV<font></font>
 class VIDEO_SURV<font></font>
    police 1500000 conform-action transmit  exceed-action drop<font></font>
<font></font>
interface GigabitEthernet0/1/1<font></font>
  description VIDEOSURV<font></font>
  ip address 10.10.222.254 255.255.255.0<font></font>
  service-policy input VIDEO_SURV<font></font>
<font></font>
router bgp 65001<font></font>
  network 10.10.222.0 mask 255.255.255.0<font></font>
<font></font>
access-list 11 permit 10.10.222.0 0.0.0.255<font></font>
access-list 111 permit ip 10.10.222.0 0.0.0.255 any<font></font>
---- Loading Configuration on the device ** changed : True --------------------- INFO<font></font>
+class-map match-all VIDEO_SURV<font></font>
+ match access-group 111<font></font>
+policy-map VIDEO_SURV<font></font>
+ class VIDEO_SURV<font></font>
+interface GigabitEthernet0/1/1<font></font>
+  description VIDEOSURV<font></font>
+  ip address 10.10.222.254 255.255.255.0<font></font>
+  service-policy input VIDEO_SURV<font></font>
+router bgp 65001<font></font>
+  network 10.10.222.0 mask 255.255.255.0<font></font>
+access-list 11 permit 10.10.222.0 0.0.0.255<font></font>
+access-list 111 permit ip 10.10.222.0 0.0.0.255 any<font></font>
^^^^ END config_and_deploy ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<font></font>
* srx-test ** changed : True *******************************************<font></font>
vvvv config_and_deploy ** changed : True vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv INFO<font></font>
---- Base Configuration ** changed : True ------------------------------------- INFO<font></font>
set interfaces fe-0/0/2 unit 0 description "Video surveillance"<font></font>
set interfaces fe-0/0/2 unit 0 family inet filter input limit-in<font></font>
set interfaces fe-0/0/2 unit 0 family inet address 10.10.111.254/24<font></font>
set policy-options policy-statement export2bgp term 1 from route-filter 10.10.111.0/24 exact<font></font>
set security zones security-zone WAN interfaces fe-0/0/2<font></font>
set firewall policer policer-1m if-exceeding bandwidth-limit 1m<font></font>
set firewall policer policer-1m if-exceeding burst-size-limit 187k<font></font>
set firewall policer policer-1m then discard<font></font>
set firewall policer policer-1.5m if-exceeding bandwidth-limit 1500000<font></font>
set firewall policer policer-1.5m if-exceeding burst-size-limit 280k<font></font>
set firewall policer policer-1.5m then discard<font></font>
set firewall filter limit-in term 1 then policer policer-1.5m<font></font>
set firewall filter limit-in term 1 then count limiter<font></font>
---- Loading Configuration on the device ** changed : True --------------------- INFO<font></font>
[edit interfaces]<font></font>
+   fe-0/0/2 {<font></font>
+       unit 0 {<font></font>
+           description "Video surveillance";<font></font>
+           family inet {<font></font>
+               filter {<font></font>
+                   input limit-in;<font></font>
+               }<font></font>
+               address 10.10.111.254/24;<font></font>
+           }<font></font>
+       }<font></font>
+   }<font></font>
[edit]<font></font>
+  policy-options {<font></font>
+      policy-statement export2bgp {<font></font>
+          term 1 {<font></font>
+              from {<font></font>
+                  route-filter 10.10.111.0/24 exact;<font></font>
+              }<font></font>
+          }<font></font>
+      }<font></font>
+  }<font></font>
[edit security zones]<font></font>
     security-zone test-vpn { ... }<font></font>
+    security-zone WAN {<font></font>
+        interfaces {<font></font>
+            fe-0/0/2.0;<font></font>
+        }<font></font>
+    }<font></font>
[edit]<font></font>
+  firewall {<font></font>
+      policer policer-1m {<font></font>
+          if-exceeding {<font></font>
+              bandwidth-limit 1m;<font></font>
+              burst-size-limit 187k;<font></font>
+          }<font></font>
+          then discard;<font></font>
+      }<font></font>
+      policer policer-1.5m {<font></font>
+          if-exceeding {<font></font>
+              bandwidth-limit 1500000;<font></font>
+              burst-size-limit 280k;<font></font>
+          }<font></font>
+          then discard;<font></font>
+      }<font></font>
+      filter limit-in {<font></font>
+          term 1 {<font></font>
+              then {<font></font>
+                  policer policer-1.5m;<font></font>
+                  count limiter;<font></font>
+              }<font></font>
+          }<font></font>
+      }<font></font>
+  }<font></font>
^^^^ END config_and_deploy ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</code></pre></div></div><br>
<h3 id="pryachem-paroli-v-ansible_vault">   ansible_vault</h3><br>
<p>       <em>ansible</em>,      .     <strong>vault</strong> ,         .    ,     /           <em>groups.yaml</em>.   .       <strong>vault</strong>.</p><br>
<p>   groups.yaml  creds.yaml,    AES256 c 20- :</p><br>
<pre><code class="bash hljs">$ <span class="hljs-built_in">cd</span> inventory<font></font>
$ cat creds.yaml<font></font>
---<font></font>
cisco:<font></font>
    username: admin1<font></font>
    password: cisco1<font></font>
<font></font>
juniper:<font></font>
    username: admin2<font></font>
    password: juniper2<font></font>
<font></font>
$ pwgen 20 -N 1 &gt; vault.passwd<font></font>
ansible-vault encrypt creds.yaml --vault-password-file vault.passwd  <font></font>
Encryption successful<font></font>
$ cat creds.yaml <font></font>
<span class="hljs-variable">$ANSIBLE_VAULT</span>;1.1;AES256<font></font>
39656463353437333337356361633737383464383231366233386636333965306662323534626131<font></font>
3964396534396333363939373539393662623164373539620a346565373439646436356438653965<font></font>
39643266333639356564663961303535353364383163633232366138643132313530346661316533<font></font>
6236306435613132610a656163653065633866626639613537326233653765353661613337393839<font></font>
62376662303061353963383330323164633162386336643832376263343634356230613562643533<font></font>
30363436343465306638653932366166306562393061323636636163373164613630643965636361<font></font>
34343936323066393763323633336366366566393236613737326530346234393735306261363239<font></font>
35663430623934323632616161636330353134393435396632663530373932383532316161353963<font></font>
31393434653165613432326636616636383665316465623036376631313162646435</code></pre><br>
<p>  .    <em>Nornir</em>-     .<br>
        <em>nr = InitNornir(config_file=...</em>   :</p><br>
<pre><code class="python hljs">...<font></font>
nr = InitNornir(config_file=<span class="hljs-string">"config.yaml"</span>, dry_run=<span class="hljs-literal">True</span>) <span class="hljs-comment"># set dry_run=False, cross your fingers and run again</span><font></font>
<font></font>
<span class="hljs-comment"># enrich Inventory with the encrypted vault data</span>
<span class="hljs-keyword">from</span> ansible_vault <span class="hljs-keyword">import</span> Vault<font></font>
vault_password_file=<span class="hljs-string">"inventory/vault.passwd"</span>
vault_file=<span class="hljs-string">"inventory/creds.yaml"</span>
<span class="hljs-keyword">with</span> open(vault_password_file, <span class="hljs-string">"r"</span>) <span class="hljs-keyword">as</span> fp:<font></font>
    password = fp.readline().strip()   <font></font>
    vault = Vault(password)<font></font>
    vaultdata = vault.load(open(vault_file).read())<font></font>
<font></font>
<span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> nr.inventory.hosts.keys():<font></font>
    item = nr.inventory.hosts[a]<font></font>
    item.username = vaultdata[item.groups[<span class="hljs-number">0</span>]][<span class="hljs-string">'username'</span>]<font></font>
    item.password = vaultdata[item.groups[<span class="hljs-number">0</span>]][<span class="hljs-string">'password'</span>]
    <span class="hljs-comment">#print("hostname={}, username={}, password={}\n".format(item.hostname, item.username, item.password))</span><font></font>
<font></font>
<span class="hljs-comment"># run tasks</span>
...</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もちろん、私の例のようにvault.passwdをcreds.yamlの横に置くことはできません。</font><font style="vertical-align: inherit;">しかし、それをプレイすることで十分です。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それは今のところすべてです。</font><font style="vertical-align: inherit;">Cisco + Zabbixに関するいくつかの記事が近づいていますが、これは自動化については少しではありません。</font><font style="vertical-align: inherit;">そして、近い将来、CiscoでRESTCONFについて書く予定です。</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja482178/index.html">キューモニタリングシステムで大臣賞を受賞した韓国人学生の話</a></li>
<li><a href="../ja482182/index.html">ITでジェンダーバランスのために戦った場合、どのような問題が発生しますか？</a></li>
<li><a href="../ja482186/index.html">人生とIT、または最後の仕事を辞めた年</a></li>
<li><a href="../ja482188/index.html">更新に関する金曜日の投票</a></li>
<li><a href="../ja482190/index.html">中国のソーシャルネットワークでデュレックスのコンテンツはどのように見えますか</a></li>
<li><a href="../ja482196/index.html">生産モデリングとは何ですか、なぜそれが必要なのですか？</a></li>
<li><a href="../ja482198/index.html">クラスターのオートスケーラーを作成する方法</a></li>
<li><a href="../ja482200/index.html">サイバーセキュリティのブロックチェーン：期待と現実</a></li>
<li><a href="../ja482202/index.html">チェック・ポイント機器の暗号をGOST 2012に更新する方法</a></li>
<li><a href="../ja482206/index.html">航空機用部品の3D生産をより経済的にする方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>