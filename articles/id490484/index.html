<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👦 👨🏾‍🎓 🙇 Mengelola sensor rumah pintar dengan Google Assistant 👨🏻‍🎤 🤽🏿 🚭</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, kolega dalam panduan ini akan memberi tahu Anda cara mengontrol sensor rumah pintar menggunakan Google Assistant dan protokol mqtt, menggunakan ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Mengelola sensor rumah pintar dengan Google Assistant</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490484/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo, kolega dalam panduan ini akan memberi tahu Anda cara mengontrol sensor rumah pintar menggunakan Google Assistant dan protokol mqtt, menggunakan papan ESP8266 dan LED sebagai contoh. </font><font style="vertical-align: inherit;">Kami juga akan membuat aplikasi Asisten kami sendiri dengan skrip blackjack dan php. </font><font style="vertical-align: inherit;">Saya meminta kucing untuk semua orang.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk melakukan ini, kita memerlukan pengontrol ESP8266, atau pengontrol lain dengan koneksi Internet, serta server dengan sertifikat ssl yang valid (alih-alih ssl yang valid, Anda dapat menggunakan proxy terbalik yang sudah memiliki satu) dan server MQTT (broker). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk integrasi dengan asisten google, kami akan menggunakan layanan Tindakan Google dan Dialogflow. </font><font style="vertical-align: inherit;">Jadi, mari kita mulai.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7n/n4/so/7nn4sojacyuqznn0ngm2_az_tek.jpeg" alt="gambar"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Membuat dan mengatur proyek</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konsol tindakan Google</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, Anda harus masuk ke </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">layanan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan membuat proyek, pilih bahasa dan wilayah. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3c/8d/8p/3c8d8pr_uuzir7e6jizg3cx-xf4.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah itu Anda harus memilih ruang lingkup. </font><font style="vertical-align: inherit;">Saya memilih Kids &amp; Family. </font><font style="vertical-align: inherit;">Dari pengalaman orang lain, saya akan mengatakan bahwa kategori Rumah Cerdas yang bertanya secara logis hanya berfungsi dengan benar dengan perangkat dari Google, untuk proyek-proyek dengan sensor sendiri, lebih baik memilih kategori yang berbeda untuk operasi yang benar. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qr/jk/-x/qrjk-xl3cvbhcrpdocrfhyfiecm.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami membaca dan menerima perjanjian. </font><font style="vertical-align: inherit;">Di kategori Pengaturan cepat, buka Tentukan bagaimana Tindakan Anda dipanggil. </font><font style="vertical-align: inherit;">Kami datang dengan apa bot kami akan dipanggil dan pilih suara dari yang tersedia, simpan. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w1/oz/ue/w1ozueqhhrzh0y42i1xwfwk8330.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Buka tab Tindakan, tambahkan tindakan Maksud Khusus</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nt/sg/n4/ntsgn4ps4curjg5c0ociivilfma.png" alt="gambar"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dialogflow</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah mengklik tombol Bangun, kami dialihkan ke sumber daya Dialogflow, kami juga masuk dan melanjutkan ke pembuatan proyek:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pilih bahasa default dan zona waktu.</font></font></li>
<li>   Fulfillment   <abbr title="antarmuka antara dua program">Webhook</abbr>.       (     ,  )   Dialogflow   POST .<br>
<br>
<img src="https://habrastorage.org/webt/2e/tu/ij/2etuijbmkox37tup8de8t8sq694.png" alt="gambar"></li>
<li>3.    .<br>
<br>
 intets         .       .      +   Intents.       .</li>
</ol><br>
<img src="https://habrastorage.org/webt/ay/d4/zy/ayd4zyszkzl59pzklkt8ps34sh4.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Halaman itu sendiri dapat dibagi menjadi tiga kategori: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frase pelatihan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah kata-kata yang ditanggapi oleh asisten dengan tim. </font><font style="vertical-align: inherit;">Mereka bisa berbeda untuk satu tim. </font><font style="vertical-align: inherit;">Misalnya, menyinari kata-kata, memotong cahaya, menyalakan lampu, dll. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/du/v8/mm/duv8mm1gpmvibh2w6fd0u7x777w.png" alt="gambar"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aksi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - tindakan itu sendiri, atau kata yang akan dipahami sensor, itu satu dan konkret. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Respons</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah jawaban asisten setelah perintah dieksekusi. </font><font style="vertical-align: inherit;">Ini hanya bidang kreativitas.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yx/vj/hp/yxvjhpwsqueymkbo-4llo9jfvh8.png" alt="gambar"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Penyiapan hosting </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai server, saya membeli tetesan termurah ($ 5) dan menginstal Debian 10.2 di atasnya. </font><font style="vertical-align: inherit;">Hosting mana yang Anda pilih tidak masalah.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konfigurasikan proxy terbalik dan DNS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat melewati bagian ini jika memiliki hosting dengan sertifikat yang valid. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Layanan Cloudflare sendiri menawarkan banyak nama level yang lebih rendah, jadi jika Anda mengalami masalah dengan langkah 4, Anda mungkin perlu menentukan ip Anda alih-alih yang default di kolom konten dekat www ***, https // www *** (*** adalah domain Anda) . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk berinteraksi dengan Dialogflow, Anda memerlukan sertifikat SSL. </font><font style="vertical-align: inherit;">Saya tidak menginstalnya di server, sebaliknya saya menggunakan proksi DNS Cloudflare (gratis - dasar). </font><font style="vertical-align: inherit;">Untuk melakukan ini, ketika mengkonfigurasi Cloudflare, saya menambahkan nama domain saya yang sebelumnya dibeli dan menambahkan alamat IP server saya ke dalamnya (kolom Konten). </font><font style="vertical-align: inherit;">Juga menambahkan dua catatan A (dalam gambar itu Nilai) di pengaturan penyedia nama. </font><font style="vertical-align: inherit;">Perlu dicatat bahwa menambahkan catatan bukan masalah detik dan dapat memakan waktu hingga beberapa hari kerja.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yp/gz/qz/ypgzqzczh7qgdveopje4to1dtp8.png" alt="gambar"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instalasi perangkat lunak</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Hal pertama setelah memulai server untuk pertama kalinya, jangan lupa untuk memperbarui paket database</font></font><br>
<br>
<pre><code class="bash hljs">apt update</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dan kemudian perbarui paket yang diinstal </font></font><pre><code class="bash hljs">apt upgrade</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Setelah kami menginstal LAMP </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apache</font></font><br>
<br>
<pre><code class="bash hljs">apt install apache2 </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Php / mysql</font></font><br>
<br>
<pre><code class="bash hljs">apt-get install php libapache2-mod-php php-mcrypt php-mysql</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambahkan alamat server di apache2.conf. Ini dapat dilakukan dengan perintah nano /etc/apache2/apache2.conf, yang menunjukkan pada akhir file ServerName *** di akhir file Anda, di mana alih-alih tanda bintang Anda harus mengganti ip server. Periksa sintaks dan mulai ulang layanan Apach. Pelajari lebih lanjut di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah berhasil menyelesaikan langkah-langkah yang dijelaskan di atas saat memasukkan nama domain Anda di bilah browser, Anda akan menerima halaman selamat datang Apache2. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wu/3k/uw/wu3kuwqec_ykskpcqtqttzph6wm.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika ini tidak terjadi, periksa apakah perintah dieksekusi dengan benar, dan apakah halaman berfungsi dengan koneksi http yang tidak aman. Jika berhasil, server mungkin mendengarkan pada port 80, bukan port 443. Atau beberapa layanan sudah berjalan di atasnya. Lebih detail di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. Menginstal Perpustakaan Mosquitto untuk PHP</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perangkat IoT dapat menggunakan protokol yang berbeda untuk interoperabilitas. </font><font style="vertical-align: inherit;">Salah satu </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MQTT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> yang berfungsi atas dasar penerbit-pelanggan. </font><font style="vertical-align: inherit;">Dalam hal ini, pelanggan dapat menerima informasi dari banyak penerbit. </font><font style="vertical-align: inherit;">Tetapi karena protokol hanya memahami jenis-jenis pesan tertentu, itu memerlukan konverter (pialang). </font><font style="vertical-align: inherit;">Di sini kita mengaturnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5. Jika Anda belum menginstal PECL, instal</font></font><br>
<br>
<pre><code class="bash hljs">apt install pecl</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah kami menjadi broker </font></font><br>
<br>
<pre><code class="bash hljs">pecl install Mosquitto-alpha</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemudian tambahkan ekstensi = mosquitto.so ke php.ini Anda. </font><font style="vertical-align: inherit;">Dan jangan lupa klien</font></font><br>
<br>
<pre><code class="bash hljs">apt install mosquitto mosquitto-clients
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lebih detail di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menyiapkan skrip php, berlangganan ke topik</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebenarnya skrip itu sendiri. </font><font style="vertical-align: inherit;">Tujuannya adalah untuk menerima permintaan posting dari Dialogflow, mengisolasi tindakan dari itu dan mengirimkannya sebagai pesan ke broker dalam subjek, yang namanya ditunjukkan di akhir skrip. </font><font style="vertical-align: inherit;">Apa yang Anda sebut skrip tidak masalah. </font><font style="vertical-align: inherit;">Omong-omong, ini adalah skrip yang kami tunjukkan di tab Pemenuhan. </font><font style="vertical-align: inherit;">Tempatkan skrip di / var / www / html </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Topik dibuat oleh pelanggan. Untuk membuat topik, gunakan perintah:</font></font><br>
<br>
<pre><code class="bash hljs">mosquitto_sub -h localhost - t /<span class="hljs-built_in">test</span>/light</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alih-alih localhost, Anda dapat menentukan alamat atau domain lain, tempat Anda ingin membuat publisher (pub). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alih-alih / test / light, Anda dapat menentukan topik apa pun. </font><font style="vertical-align: inherit;">Dalam kasus kami, hal utama adalah hal itu ditunjukkan dalam naskah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pesan dibuat oleh penerbit. </font><font style="vertical-align: inherit;">Untuk membuat pesan, Anda dapat menggunakan perintah.</font></font><br>
<br>
<pre><code class="bash hljs">mosquitto_pub -h localhost - t /<span class="hljs-built_in">test</span>/light -m “light”</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi kami tidak akan membutuhkannya, karena penerbit kami akan menjadi aplikasi kami. </font><font style="vertical-align: inherit;">Skemanya adalah ini, ketika aplikasi kita menerima perintah, itu mengirimkan permintaan ke skrip kita. </font><font style="vertical-align: inherit;">Script untuk broker, dan broker untuk pelanggan (esp8266). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami akan memeriksa pengiriman pesan melalui tab Test Action Console.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lj/j0/ff/ljj0ffysayc5d3wfg8ui2rcc15w.png" alt="gambar"><br>
<br>
<img src="https://habrastorage.org/webt/j5/tf/xz/j5tfxzjm9gbh7toxf9wi6zah2zw.png" alt="gambar"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skrip php</font></font></b><div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<font></font>
<span class="hljs-comment">//Make sure that it is a POST request.</span>
<span class="hljs-keyword">if</span>(strcasecmp($_SERVER[<span class="hljs-string">'REQUEST_METHOD'</span>], <span class="hljs-string">'POST'</span>) != <span class="hljs-number">0</span>){
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">'Request method must be POST!'</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//Make sure that the content type of the POST request has been set to application/json</span>
$contentType = <span class="hljs-keyword">isset</span>($_SERVER[<span class="hljs-string">"CONTENT_TYPE"</span>]) ? trim($_SERVER[<span class="hljs-string">"CONTENT_TYPE"</span>])                                                                                                              : <span class="hljs-string">''</span>;
<span class="hljs-keyword">if</span>(strcasecmp($contentType, <span class="hljs-string">'application/json'</span>) != <span class="hljs-number">0</span>){
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">'Content type must be: application/json'</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//Receive the RAW post data.</span>
$content = trim(file_get_contents(<span class="hljs-string">"php://input"</span>));<font></font>
<font></font>
<span class="hljs-comment">//Attempt to decode the incoming RAW post data from JSON.</span><font></font>
$decoded = json_decode($content);<font></font>
<font></font>
<span class="hljs-comment">//file_put_contents($filename, $data);</span><font></font>
var_dump($decoded);<font></font>
<font></font>
<span class="hljs-keyword">echo</span> $decoded-&gt;queryResult-&gt;action;<font></font>
<font></font>
define(<span class="hljs-string">'BROKER'</span>, <span class="hljs-string">'localhost'</span>);<font></font>
define(<span class="hljs-string">'PORT'</span>, <span class="hljs-number">1883</span>);<font></font>
define(<span class="hljs-string">'CLIENT_ID'</span>,  getmypid());<font></font>
  <font></font>
$client = <span class="hljs-keyword">new</span> Mosquitto\Client(CLIENT_ID);<font></font>
$client-&gt;connect(BROKER, PORT, <span class="hljs-number">60</span>);<font></font>
<font></font>
        $message = $decoded-&gt;queryResult-&gt;action;<font></font>
        $client-&gt;publish(<span class="hljs-string">'/test/light'</span>, $message, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);<font></font>
        $client-&gt;loop();<font></font>
<span class="hljs-meta">?&gt;</span>
</code></pre><br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firmware ESP8266</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk firmware kita akan menggunakan Arduino IDE. </font><font style="vertical-align: inherit;">Jika seseorang akan menginstal IDE untuk pertama kalinya, jangan lupa tentang driver ch340. </font><font style="vertical-align: inherit;">Secara default, tidak ada pembayaran seperti itu di Arduino. </font><font style="vertical-align: inherit;">Dalam File &gt;&gt; Pengaturan Anda perlu menentukan alamat papan tambahan: arduino.esp8266.com/stable/package_esp8266com_index.json. </font><font style="vertical-align: inherit;">Di Tools &gt;&gt; board &gt;&gt; board manager Anda perlu menginstal paket esp8266. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam sketsa setelah const char * ssid, Anda harus menunjukkan nama jaringan wi-fi Anda. </font><font style="vertical-align: inherit;">Setelah kata sandi const *, kata sandinya. </font><font style="vertical-align: inherit;">Setelah const char * mqtt_server tentukan alamat ip server Anda.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sketsa Arduino IDE</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">#include &lt;ESP8266WiFi.h&gt;<font></font>
#include &lt;PubSubClient.h&gt;<font></font>
<font></font>
// Update these with values suitable for your network.<font></font>
<font></font>
const char* ssid = "***";<font></font>
const char* password = "********";<font></font>
const char* mqtt_server = "**.**.*.*";<font></font>
<font></font>
WiFiClient espClient;<font></font>
PubSubClient client(espClient);<font></font>
long lastMsg = 0;<font></font>
char msg[50];<font></font>
int value = 0;<font></font>
<font></font>
int led = D5;<font></font>
<font></font>
void setup_wifi() {<font></font>
<font></font>
  delay(10);<font></font>
  // We start by connecting to a WiFi network<font></font>
  Serial.println();<font></font>
  Serial.print("Connecting to ");<font></font>
  Serial.println(ssid);<font></font>
<font></font>
  WiFi.begin(ssid, password);<font></font>
<font></font>
  while (WiFi.status() != WL_CONNECTED) {<font></font>
    delay(500);<font></font>
    Serial.print(".");<font></font>
  }<font></font>
<font></font>
  randomSeed(micros());<font></font>
<font></font>
  Serial.println("");<font></font>
  Serial.println("WiFi connected");<font></font>
  Serial.println("IP address: ");<font></font>
  Serial.println(WiFi.localIP());<font></font>
}<font></font>
<font></font>
void callback(char* topic, byte* payload, unsigned int length) {<font></font>
  String msg="";<font></font>
  Serial.print("Message arrived [");<font></font>
  Serial.print(topic);<font></font>
  Serial.print("] ");<font></font>
  for (int i = 0; i &lt; length; i++) {<font></font>
    Serial.print((char)payload[i]);<font></font>
    msg+=(char)payload[i];<font></font>
  }<font></font>
  Serial.println();<font></font>
<font></font>
  // Switch on the LED if an 1 was received as first character<font></font>
//  if ((char)payload[0] == '1') {<font></font>
  if (msg == "light") {<font></font>
    digitalWrite(led, HIGH);   // Turn the LED on <font></font>
  } else {<font></font>
    digitalWrite(led, LOW);  // Turn the LED off <font></font>
  }<font></font>
<font></font>
}<font></font>
<font></font>
void reconnect() {<font></font>
  // Loop until we're reconnected<font></font>
  while (!client.connected()) {<font></font>
    Serial.print("Attempting MQTT connection...");<font></font>
    // Create a random client ID<font></font>
    String clientId = "ESP8266Client-";<font></font>
    clientId += String(random(0xffff), HEX);<font></font>
    // Attempt to connect<font></font>
    if (client.connect(clientId.c_str())) {<font></font>
      Serial.println("connected");<font></font>
      // ... and resubscribe<font></font>
      client.subscribe("/test/light");<font></font>
    } else {<font></font>
      Serial.print("failed, rc=");<font></font>
      Serial.print(client.state());<font></font>
      Serial.println(" try again in 5 seconds");<font></font>
      // Wait 5 seconds before retrying<font></font>
      delay(5000);<font></font>
    }<font></font>
  }<font></font>
}<font></font>
<font></font>
void setup() {<font></font>
  pinMode(led, OUTPUT);     // Initialize the led pin as an output<font></font>
  Serial.begin(115200);<font></font>
  setup_wifi();<font></font>
  client.setServer(mqtt_server, 1883);<font></font>
  client.setCallback(callback);<font></font>
}<font></font>
<font></font>
void loop() {<font></font>
<font></font>
  if (!client.connected()) {<font></font>
    reconnect();<font></font>
  }<font></font>
  client.loop();<font></font>
<font></font>
}<font></font>
</code></pre></div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hasil</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akibatnya, setelah menyusun sketsa, kami mendapatkan aplikasi yang terintegrasi ke dalam asisten google dan mengelola sensor. </font><font style="vertical-align: inherit;">Alih-alih smartphone, saya menggunakan aplikasi web, tetapi diuji pada Android - hasilnya sama. </font><font style="vertical-align: inherit;">Hal utama adalah jika Anda menguji dari smartphone jangan lupa untuk mengatakan: "Bicara dengan aplikasi ***".</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qf/vh/ug/qfvhugumopat-isohcimmyujd08.jpeg" alt="gambar"><br>
<br>
<img src="https://habrastorage.org/webt/eh/or/mv/ehormvyz41fgzhgogas1yrszpvs.jpeg" alt="gambar"><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/g-S82CdMIrY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id490472/index.html">Ketika saya menulis cryptocurrency semi-desentralisasi dalam PHP. (Bagian 1 - Mengoleksi Perpustakaan)</a></li>
<li><a href="../id490474/index.html">STM32 Bagian 1: Dasar-Dasar</a></li>
<li><a href="../id490476/index.html">Sensor nirkabel untuk membuka dan menutup dengan fungsionalitas canggih</a></li>
<li><a href="../id490478/index.html">DIY Stasiun Solder DIY v2</a></li>
<li><a href="../id490480/index.html">O Tiling-wm dalam 2 kata</a></li>
<li><a href="../id490490/index.html">Weekend Reading: 10 materi tentang efek suara pada kesehatan - dari "kebersihan kebisingan" hingga tidur nyenyak dan GTD</a></li>
<li><a href="../id490492/index.html">Robot gudang belajar untuk mengurutkan hal-hal yang tidak standar</a></li>
<li><a href="../id490494/index.html">Belanja tikus, Widiots, dan gamer: propaganda bahaya video game di tahun 80-an</a></li>
<li><a href="../id490496/index.html">Membuat Toko Online di Nuxt.js 2 Walkthrough Bagian 1</a></li>
<li><a href="../id490498/index.html">Ketika saya menulis cryptocurrency semi-desentralisasi dalam PHP. (Bagian 2 - Pengembangan)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>