<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩 💯 👩🏻‍💻 新しいOdnoklassnikiフロントエンド：ReactをJavaで起動します。パートI 🎅🏿 👩🏾‍💼 🕸️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="多くの人がGraalVMという名前を聞いたことがありますが、これまでのところ、誰もがこのテクノロジーを本番環境で試す機会があったわけではありません。 Odnoklassnikiにとって、このテクノロジーはすでに「聖杯」を変えるフロントエンドになっています。
 
 この記事では、JavaとJavaSc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>新しいOdnoklassnikiフロントエンド：ReactをJavaで起動します。パートI</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/odnoklassniki/blog/480808/"><img src="https://habrastorage.org/webt/-r/o9/iz/-ro9izrzg1xlvkkewuua1wqu3dg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くの人がGraalVMという名前を聞いたことがありますが、これまでのところ、誰もがこのテクノロジーを本番環境で試す機会があったわけではありません。 Odnoklassnikiにとって、このテクノロジーはすでに「聖杯」を変えるフロントエンドになっています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、JavaとJavaScriptをうまく活用して、多くのレガシーコードを備えた巨大なシステムへの移行を開始した方法についてお話ししたいと思います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事を書いている時点で、資料の全巻が従来のHABRサイズに収まらないことが判明しました。出版物全体を公開すると、読むのに数時間かかります。したがって、記事を2つのパートに分割することにしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の部分から、オドノクラシュニキのフロントエンドの歴史について学び、その歴史的特徴に精通し、プロジェクトの11年間で私たちに蓄積された問題の解決策を見つける道を進み、最後に、私たちが行った決定のサーバー実装の技術的機能に突入します。 </font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バックグラウンド</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Odnoklassnikiの最初のバージョンは13年前の2006年に登場しました。サイトは.NETで作成され、サイトにはJavaScriptがなく、すべてサーバーレンダリングで行われていました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dl/zv/ik/dlzvikklims5fo3osgeyr-4pbik.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1年後、Odnoklassnikiのユーザーは100万人を超えました。 2007年には、これらは信じられないほどの数であり、負荷に耐えることができないサイトが落ち始めました。開発者は、ラトビアの会社Forticomが作成したOne.lvプロジェクトの助けを借りて問題を解決しました。ForticomのコアコンピテンシーはJava開発にありました。したがって、Odnoklassniki、.NETからJavaに書き直すことが決定されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
時間の経過とともにプロジェクトが開発され、新しいクライアントソリューションの必要性が生じました。たとえば、サイトをナビゲートするときに完全に更新されるのではなく、特定の部分のみが更新されるようにします。または、送信時にフォーム全体のみではなく、フォームのみが更新されるようにします。同時に、サイトはJavaでのみ機能しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うために、彼らはサイトが名前付きブロックでマークアップされたシステムを思いつきました。</font><font style="vertical-align: inherit;">ナビゲートすると、サーバーにリクエストが送信され、このリンクを使用して何を変更するかが決定され、クライアントに必要な部分が提供されました。</font><font style="vertical-align: inherit;">クライアントエンジンは単に必要な部分を置き換えるだけなので、クライアントダイナミクスが実装されました。</font><font style="vertical-align: inherit;">すべてのビジネスロジックがサーバー上にあるため、非常に便利です。</font><font style="vertical-align: inherit;">小さなエンジンにより、同社は依然としてクライアントを管理するJavaコードを記述できました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、最小限のJavaScriptなしでは十分ではありませんでした。</font><font style="vertical-align: inherit;">ポップアップを作成するには、操作が必要です。たとえば、display：ブロックがdivのカーソルでハングしているか、display：noneを使用して非表示になっています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし同時に、ポップアップのコンテンツはサーバーから要求され、すべてのビジネスロジックがそこにあり、Javaでした。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/aj/0h/9i/aj0h9iklirl7jtnjfib1jwaowxo.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2018年</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
12年後、Odnoklassnikiはユーザー数が7,000万人を超える巨大なサービスに変わりました。</font><font style="vertical-align: inherit;">4つのデータセンターには7,000台以上のマシンがあり、OK.RUフロントエンドに送信されるリクエスト数は1秒あたり60万回だけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Odnoklassnikiのフロントサーバーは引き続きJavaで動作し、フロントのコードベースだけで200万行を超えています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ew/dg/zh/ewdgzh7z3n7pf40yqgaluttxkyk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クライアント側に実装されたテクノロジーもまた、止まらず、GWT、jQuery、DotJ、RequireJSなど、さまざまなライブラリを使用して多くのソリューションが登場しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当時、React、Angular、Vueなどの標準は一般的ではなく、各開発者は利用可能なすべてのツールを使用して最適なソリューションを見つけようとしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
非常に多くの問題が蓄積されているため、これとの生活は非常に難しいことが明らかになりました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多くの古い図書館</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">単一のフレームワークはありません</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同形性なし（バックエンドはJavaであるため、クライアントはJSです）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クライアントに単一の構造化アプリケーションはありません</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">応答性が悪い</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不十分なツール</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入場閾値が高い</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
世界はすでに2018年にあり、変える必要がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
技術的思考のすべての力を使用して、問題を解決するための4つの基本要件を熟考し、策定しました。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスメートには、UIの同型コードが必要です。</font><font style="vertical-align: inherit;">サーバーを常にJavaで作成することは不可能であり、何らかのダイナミクスを追加する必要がある場合は、クライアントで同じことを実行します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スムーズな移行が必要です。</font><font style="vertical-align: inherit;">Odnoklassnikiの2番目のバージョンをすばやく作成して切り替えることは不可能であるため</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要に応じてサーバーレンダリングが必要です（詳細は以下を参照）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同じ量の鉄に取り組んでいる新しいソリューションは、負荷の下でパフォーマンスとフォールトトレランスを損なわないはずです。</font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーサイドレンダリングを使用する理由</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Odnoklassnikiにはモスクワから遠く離れた場所に住んでいる多くのユーザーがいます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/55/k3/a-/55k3a-kmkkvhtrpyjsmbvtrg1j8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーバー側のレンダリングは、これらのユーザーがコンテンツをより速く取得するのに役立ちます。</font><font style="vertical-align: inherit;">画像が読み込まれている間、それらは何か</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ig/ga/ww/iggawwqkjpsknbpzdtddoj3lu3c.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
を</font><font style="vertical-align: inherit;">読み始めることができ</font><font style="vertical-align: inherit;">ます。ある期待（データ）（たとえば、テープ）がすでにクライアントに配信された場合に何が起こるかを理解しようとして、一連の実験を行いました。</font><font style="vertical-align: inherit;">その結果、これがユーザーアクティビティに悪影響を及ぼすことがわかりました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーの仕組み</font></font></h2> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブラウザはOKサイトにリクエストを送信し、Javaで完全に記述されたOK-WEBアプリケーションにアクセスします。</font><font style="vertical-align: inherit;">アプリケーションはAPIのデータに従います。</font><font style="vertical-align: inherit;">WEBとAPIの間に、Odnoklassnikiで開発されたone-nio高速バイナリトランスポートが実装されています。</font><font style="vertical-align: inherit;">リクエストは1ミリ秒未満で完了します。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">個別に</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ご覧いただけます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">One-nioを使用すると、遅延を気にすることなく、多くの問い合わせを安価に行うことができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
APIはデータを引き出し、ウェブに提供します。</font><font style="vertical-align: inherit;">WebはJavaエンジンを使用してHTMLページを生成し、それをブラウザーに提供します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これすべてにかかる時間は200ミリ秒未満です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/px/lt/tw/pxlttwxxg5fddebl4lumank7w2e.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解決策を探す</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に、ウィジェットに基づく移行の概念が開発されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションは小片でサイトに配信されます。</font><font style="vertical-align: inherit;">内部では、それらは新しいスタックに書き込まれます。</font><font style="vertical-align: inherit;">そして、サイトの残りの部分では、それはある種のカスタム動作を持つDOM要素になります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0a/7b/9j/0a7b9jtqv4vm1zsfpwdb93jlzpm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、&lt;video&gt;タグに似ています。属性、メソッド、およびイベントを持つカスタムDOM要素です。</font><font style="vertical-align: inherit;">結果として、DOM APIは外部に配置され、ウィジェット機能は新しいスタックの内部に実装されます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">選択するスタックは？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今やコンセプトを実装する必要があり、彼らはオプションを整理し始めました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コトリン</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のプロトタイプはKotlinで作成されました。</font><font style="vertical-align: inherit;">新しいコンポーネントについては、Kotlinでロジックを記述し、コンポーネントマークアップをXMLで記述します。</font><font style="vertical-align: inherit;">サーバーでは、既存のテンプレートエンジンを使用してすべてをJVMで実行でき、クライアントの場合はJavaScriptで置き換えることができます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/al/il/q6/alilq6rigfkuh5jz4yuerp8kvgk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kotlinは、入力しきい値が高い新しい言語を導入することに加えて、JavaScriptを操作するためのツールが十分に開発されておらず、さらに多くのものが独立して開発される必要があることがわかりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、残念なことに、この概念は放棄されなければなりませんでした。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Node.js</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別のオプションは、Node.jsまたは別のランタイム（Dartなど）を配置することです。</font><font style="vertical-align: inherit;">しかし、どうなりますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Node.jsを使用するには2つの方法があります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の方法は、Javaアプリケーションと同じサーバーで実行されているNode.js上のサーバーにコンポーネントのレンダリングを委任することです。</font><font style="vertical-align: inherit;">したがって、アプリケーションをJavaで保存し、HTMLのレンダリングプロセスの途中で、Node.jsでローカルに実行されているサービスを呼び出します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、このアプローチにはいくつかの問題があります。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Node.jsのリモート呼び出しには、入力のシリアル化/非シリアル化が含まれます。</font><font style="vertical-align: inherit;">たとえば、JSの新しいコンポーネントがJavaで実装された古いコンポーネントのラッパーである場合、このデータは非常に膨大になる可能性があります。</font></font></li>
<li> ,    ,    ,     .         ,    ,           . </li>
<li>      ,             Java     Node.js.      , : ,   ,  ,    .. </li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Node.jsを使用する2番目の方法は、JavaでWebサーバーの前に配置し、HTMLの後処理に使用することです。</font><font style="vertical-align: inherit;">つまり、HTMLを解析し、JSでコンポーネントを見つけて描画し、完成したHTMLをユーザーに返すのはプロキシです。</font><font style="vertical-align: inherit;">興味深いオプションですが、それは普遍的でかなり機能しているようです。</font><font style="vertical-align: inherit;">このアプローチの欠点は、インフラストラクチャ全体を徹底的に変更する必要があり、オーバーヘッドコストが大幅に増加し、重大なリスクを伴うことです。すべてのリクエストはNode.jsを経由する必要があります。つまり、完全に依存し始めます。</font><font style="vertical-align: inherit;">それは私たちの問題を解決するには高すぎる解決策のようです。</font></font><br>
<br>
<br>
<br>
<img src="https://habrastorage.org/webt/t_/yx/s4/t_yxs4aycowstwwyyhpptcv711y.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の理由により、Node.jsを使用できないことがわかりました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シリアライゼーション/デシリアライゼーションは追加の作業負荷と遅延です</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Node.jsはOdnoklassnikiの巨大な分散システムの別のコンポーネントです</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Javaを「調理する」方法を知っている専門家はすでにたくさんいるので、Node.jsを操作し、既存のインフラストラクチャに加えて別のインフラストラクチャを作成するスタッフを雇う必要があります。 </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JVMでのJavaScript</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、JVM内でJavaScriptを実行しようとするとどうなるでしょうか。 JavaとJavaScriptのコードは1つのプロセスで実行され、最小限のオーバーヘッドで相互作用することがわかりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これにより、現在のWEB内でJavaの部分がJavaScriptにスムーズに置き換えられます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JSコンポーネントはJavaからデータを受け取り、HTMLを生成します。それらはクライアントとサーバーの両方で同型的に動作することができます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しかし、JSをJVMで実行する方法は？</font></font></b> <font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Cloudflareの例に従って</font></a></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
V8を使用できます</font><font style="vertical-align: inherit;">。しかし、これはJavaのサードパーティであるバイナリコードです。したがって、JVMではV8内のエラーをキャッチすることはできません。 V8がクラッシュすると、プロセス全体が破壊されます。その結果、V8の使用は運用上のリスクを増大させるため、これは許可されるべきではありません。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JVMにはいくつかのJSランタイムがあります。2つのrhino、NashornおよびRhino（1つはOracle、もう1つはMozilla）と新しいGraalVMです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lh/q0/pz/lhq0pzsjpcd-d8c18ebae99flcu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JVMのJSランタイムの利点：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてがJVMで機能し、私たちはこれについて多くの専門知識を持っています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">無料のJavaとJavaScriptの相互作用</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全なランタイム</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GraalVMの場合のJavaコンパイラ</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、これらのランタイムの速度を比較することで十分でした。</font><font style="vertical-align: inherit;">GraalVMは誰よりもはるかに優れていることがわかりました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rw/tn/fa/rwtnfafh52ttkgbukp2fbfjdess.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GraalVMとは何ですか？</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GraalVM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、さまざまな言語のプログラムをサポートする高性能ランタイムです。</font><font style="vertical-align: inherit;">これは、JVM用の言語コンパイラを作成するためのフレームワークを備えています。</font><font style="vertical-align: inherit;">これにより、1つのJVM内でJava、Kotlin、JS、Python、その他の言語でのプログラムの実行がサポートされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GraalVM機能の詳細について</font><font style="vertical-align: inherit;">は、GralVMが開発されているOracle Labsに勤務している</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oleg Shelaevのレポートを参照</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">してください。</font><font style="vertical-align: inherit;">バックエンドとフロントエンドの視聴に推奨されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GraalVMを使用すると、JSを実行してサーバー上でUIをレンダリングできます。</font><font style="vertical-align: inherit;">ライブラリとして、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">React</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用します</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのようなバンドルの利点：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しい言語は追加されていません：まだJavaとJavaScript</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大きなコミュニティ：誰もがReactを知っている</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">低エントリーしきい値</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チーム内の同僚を簡単に検索</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作は複雑ではありません</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GraalVMでReactを実行する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GraalVM内で、コンテキスト（プログラムがゲスト言語で実行される分離されたコンテナー）を作成できます。</font><font style="vertical-align: inherit;">私たちの場合、ゲスト言語はJSです。</font></font><br>
<br>
<pre><code class="java hljs">Context context = Context.create(<span class="hljs-string">"js"</span>);<font></font>
<font></font>
<span class="hljs-comment">//  global  </span>
Value js = context.getBindings(<span class="hljs-string">"js"</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンテキストと対話するために、そのグローバルオブジェクトが使用されます。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-comment">//    global</span>
js.putMember(<span class="hljs-string">"serverProxy"</span>, serverProxy);<font></font>
<font></font>
<span class="hljs-comment">//    global</span>
Value app = js.getMember(<span class="hljs-string">"app"</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モジュールコードをコンテキストにロードできます。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-comment">//    </span>
Value load = js.getMember(<span class="hljs-string">"load"</span>);<font></font>
<font></font>
<span class="hljs-comment">//    </span><font></font>
load.execute(pathToModule);<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
または、「eval-it」のコードがあります。</font></font><br>
<br>
<pre><code class="java hljs">context.eval(<span class="hljs-string">"js"</span>, someCode);
</code></pre><br>
<img src="https://habrastorage.org/webt/nl/ku/w6/nlkuw6ihae8x0gjy2ciz3_rbbnw.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSサーバーのレンダリング：概念</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JVMでJavaScriptコンテキストを作成し、それにReactアプリケーションモジュールコードをロードします。</font><font style="vertical-align: inherit;">JavaからJSに必要な関数とメソッドを投入します。</font><font style="vertical-align: inherit;">次に、このコンテキストから、このモジュールのJS関数render（）へのリンクを抽出し、Javaから呼び出します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vx/_5/yx/vx_5yxc9yqy_4yzzuobsdo06cua.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーがページをリクエストすると、サーバーテンプレートエンジンが起動し、必要なデータを備えた必要なコンポーネントのrender（）関数を呼び出し、それらからHTMLコードを受け取り、ページ全体のHTMLとともにユーザーに渡します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bn/51/-l/bn51-lrlqnt2zl53ssv3h3rusgq.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSサーバーレンダリング：実装</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Odnoklassnikiのサーバーテンプレートエンジンでは、レイアウトはHTMLマークアップの形式で記述されます。</font><font style="vertical-align: inherit;">JSアプリケーションを通常のマークアップと区別するために、カスタムタグを使用します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テンプレートエンジンがカスタムタグを検出すると、対応するモジュールをレンダリングするタスクが作成されます。</font><font style="vertical-align: inherit;">スレッドのプールに送信され、それぞれに独自のJSコンテキストがあり、フリースレッドで実行され、コンポーネントをレンダリングして、クライアントに渡します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mf/yg/mc/mfygmcckcz8qga5fbr9stygigjw.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンテキストプールが必要な理由</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンポーネントは単一スレッドで同期的にレンダリングされます。</font><font style="vertical-align: inherit;">現在、JSレンダリングコンテキストはビジーです。</font><font style="vertical-align: inherit;">したがって、いくつかの独立したコンテキストを作成することにより、Javaマルチスレッド機能を使用してコンポーネントのレンダリングを並列化できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uq/oe/x6/uqoex6amlj9qbhrbjwx4pm1mpe4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Javaデータ取得関数は、各コンテキストへの参照によって渡されます。</font><font style="vertical-align: inherit;">その結果、単一のプロセス内にクールなマルチスレッドJavaScriptができました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しいフロントエンドのクライアント部分の実装がこのコンセプトに基づいて構築される方法については、次の記事で説明します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
継続：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr.com/ru/company/odnoklassniki/blog/486810</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja480798/index.html">C ++ロシアPiter 2019レポートレビュー</a></li>
<li><a href="../ja480800/index.html">ジョブテスターをお探しですか？開発者のスキルを示す準備をする</a></li>
<li><a href="../ja480802/index.html">カオスエンジニアリング、パート3：方法とツール</a></li>
<li><a href="../ja480804/index.html">完璧な3D設計システムの選択</a></li>
<li><a href="../ja480806/index.html">カスタムCSSプロパティが好きな5つの理由</a></li>
<li><a href="../ja480810/index.html">デジタルトランスフォーメーションの準備方法 事前にあなたのビジネスを破壊する</a></li>
<li><a href="../ja480812/index.html">Nvidia RTX-リアルタイムレイトレーシングテクノロジーがついにSOLIDWORKS Visualizeに登場</a></li>
<li><a href="../ja480814/index.html">NXアナリストのミートアップ＃1：「戦略分析。ノーと言うだけで、製品のクリエイターです。アイデアはどのようにして生まれますか？」</a></li>
<li><a href="../ja480816/index.html">LamodaでのDynamics 365とPower Platformのミートアップ-お知らせ</a></li>
<li><a href="../ja480820/index.html">経茎的固定の代替方法またはノギスとして、X線装置全体を置き換えることができます</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>