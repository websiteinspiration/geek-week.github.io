<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍👧‍👧 👨‍🚒 👩🏻‍🚀 コード再利用パターンとしてのモナド 🔋 🧗🏾 🤚🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="前回の記事では、関数型プログラミングがPRとまったく同じではない理由、およびOOPとまったく矛盾しない理由について説明しました。これにより、Fowlerでさえ、優れたOOPプログラム設計を生成する優れたFP設計（およびその逆）について記述しています。
 

ここで、モナドが実際に何であるか、それらが...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>コード再利用パターンとしてのモナド</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490112/"><p><img src="https://habrastorage.org/webt/e0/o5/67/e0o567enf-lqa86zlzf_fxfd3qi.png"></p><br>
<p><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前回の記事で</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、関数型プログラミングがPRとまったく</font><font style="vertical-align: inherit;">同じで</font><font style="vertical-align: inherit;">はない理由、およびOOPとまったく矛盾しない理由について説明しました。これにより、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fowler</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でさえ</font><font style="vertical-align: inherit;">、優れたOOPプログラム設計を生成する優れたFP設計（およびその逆）について</font><font style="vertical-align: inherit;">記述してい</font><font style="vertical-align: inherit;">ます。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここで</font><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">モナドが</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実際に</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何</font><font style="vertical-align: inherit;">であるか、それらが通常の練習用開発者にとってどのように役立つかを説明し</font><font style="vertical-align: inherit;">たいと思います</font><font style="vertical-align: inherit;">。また、一般的な言語でのサポートが不十分なために、コピーアンドペーストや信頼できないソリューションが発生する理由の例を示します。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しかし、インターネット上には文字通り何百ものFPとモナドに関する記事がインターネット上にあります。なぜ別のものを書くのですか？</font></font></p><br>
<p>  ,    (      )      :               ,     T      ,   T-    — .     ,   ,   —  ,    , ,         , , …       -   . </p><br>
<p>,     ,      ,        :     ,        .</p><br>
<p>      ,       ,    ,     : , , ,  , ,   .             .</p><a name="habracut"></a><br>
<h2 id="vstuplenie"></h2><br>
<p>,    ?         :     ,      ,     ,     .       ,   ,    ,      ,    ,       .</p><br>
<p>       ,   ,  .      C#. Scala   , Rust     ,        ,   Haskell   . </p><br>
<p>      ,        C# 10 (   ),   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"> Shapes</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"> HKT</a>.        (aka , aka ).      ,          ,     </p><br>
<pre><code class="cs">public shape JsonDeserialize&lt;T&gt;<font></font>
{<font></font>
    static T Deserialize(JObject input);<font></font>
}</code></pre><br>
<p>      <code>JsonSerializationException: Could not create an instance</code>    .                ,     .</p><br>
<p>     : -,      (  ),    ,  -,    . , <code>ICollection&lt;T&gt;</code>   <code>IReadOnlyCollection&lt;T&gt;</code>,        .   ,       .       .   -   -  <code>where T : Number</code>,    ,     ,    :     <code>Number</code>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">  </a>.</p><br>
<p>       -  . ,    :</p><br>
<pre><code class="cs">public static T&lt;int&gt; CreateSomethingOfInts&lt;T&gt;() where T : &lt;&gt;, new() <font></font>
{<font></font>
    return new T&lt;int&gt;();<font></font>
}</code></pre><br>
<p>,  ,      ,    :</p><br>
<pre><code class="cs">//         <font></font>
<font></font>
var list = CreateSomethingOfInts&lt;List&gt;();<font></font>
var hashSet = CreateSomethingOfInts&lt;HashSet&gt;();<font></font>
// …<font></font>
// Array&lt;T&gt;, Nullable&lt;T&gt;, LinkedList&lt;T&gt;, ... -     <font></font>
//    Array&lt;int&gt;, Nullable&lt;int&gt;, LinkedList&lt;int&gt;, ...</code></pre><br>
<p>             C# 8.     ,    ,          .       ,         .</p><br>
<p> ,    , .</p><br>
<h2 id="functor">Functor</h2><br>
<p>      —  . "  ,      !" —  . ,   —      ,     ,     .</p><br>
<p>,   ?           ,          ,  <em> —   ,   Functor</em>  :</p><br>
<pre><code class="cs">public shape Functor&lt;T&gt; where T : &lt;&gt;<font></font>
{<font></font>
    static T&lt;B&gt; Map&lt;A, B&gt;(T&lt;A&gt; source, Func&lt;A, B&gt; mapFunc);<font></font>
}</code></pre><br>
<p>,  .   ,       " ,   ".     ,      <code>Mappable</code>,   , ,    <code>Map</code>,     -,   <code>A</code>,    ,      <code>B</code>.</p><br>
<p>,        <code>ToString</code>,   .    ,      .     ,   ,   -.   —      ,    - .     <code>A =&gt; B</code>,         .     <code>Map</code>      ,  ,   <code>A</code>,      <code>B</code>. </p><br>
<p> <code>Map</code>   :   <code>mapFunc</code>  Identity-  <code>x =&gt; x</code>,     .  ,   "" ,         : </p><br>
<pre><code class="cs">Map(something, x =&gt; x) === something</code></pre><br>
<p>   , ,  , ,          ,            <code>mapFunc</code>.    ,  ,   ,     <code>Map</code>  .</p><br>
<p>         ?<br>
,  ,  :</p><br>
<pre><code class="cs">public extension EnumerableFunctor of IEnumerable : Functor&lt;IEnumerable&gt;<font></font>
{<font></font>
    public static IEnumerable&lt;B&gt; Map&lt;A, B&gt;(IEnumerable&lt;A&gt; source, Func&lt;A, B&gt; map) =&gt;<font></font>
        source.Select(map);<font></font>
}<font></font>
<font></font>
//   <font></font>
var range = Enumerable.Range(1, 10);<font></font>
Console.WriteLine(Map(range, x =&gt; x).SequenceEquals(x)) //  True</code></pre><br>
<p>      ,   ,      !     ,    IEnumerable —  ,   </p><br>
<p>       ?  ,        100   .</p><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><p>    Nullable.      :</p><br>
<pre><code class="cs">public extension NullableFunctor of Nullable : Functor&lt;Nullable&gt;<font></font>
{<font></font>
    public static B? Map&lt;A, B&gt;(A? source, Func&lt;A, B&gt; map) =&gt;<font></font>
        source is A notNullSource ? map(notNullSource) : default(B?);<font></font>
}<font></font>
<font></font>
//   <font></font>
int? nullableTen = 10;<font></font>
int? nullableNull = null;<font></font>
Console.WriteLine(Map(nullableTen, x =&gt; x) == nullableTen); //  True<font></font>
Console.WriteLine(Map(nullableNull, x =&gt; x) == nullableNull); //  True</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><em>  </em></a></p><br>
<p>   ,  Nullable —   .</p><br>
<p>   — <code>Task</code>,     <code>Map</code> .</p></div></div><br>
<hr><br>
<p>           ,     :     ,    .   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">" "</a>.    ,       ,      ,   .</p><br>
<p><img src="https://habrastorage.org/webt/e0/-s/he/e0-shev4g3jrl3isbyvof8g3rhy.png"><br>
<em>Map     ,     ,      </em></p><br>
<p>           —  !           ...</p><br>
<h2 id="applicative">Applicative</h2><br>
<p> !     ,   :</p><br>
<pre><code class="cs">public shape Applicative&lt;T&gt; where T : &lt;&gt;<font></font>
{<font></font>
    static T&lt;A&gt; Pure&lt;A&gt;(A a);<font></font>
    static T&lt;C&gt; LiftA2&lt;A, B, C&gt;(T&lt;A&gt; ta, T&lt;B&gt; tb, Func&lt;A,B,C&gt; map2);<font></font>
}</code></pre><br>
<p>   ?  ,   ,  :</p><br>
<ol>
<li>     .     <code>where T : new()</code>,   ,  <code>new()</code>   ,    .</li>
<li>   .   ,        <code>T&lt;A&gt;</code>  <code>T&lt;B&gt;</code>  ,    <code>A, B</code>  <code>C</code>,     <code>T&lt;C&gt;</code>.  <code>LiftA2</code>   ,     <strong>""</strong>   <strong></strong>   <code>A</code>  <code>B</code>    <strong></strong> <code>T&lt;A&gt;</code>  <code>T&lt;B&gt;</code> . </li>
</ol><br>
<p>?  .      - –   -  .    ,         , ,  - ?</p><br>
<p>"Talk is cheap, show me the code",          ,   ,     .      —      ,  ,      -    —    .    :</p><br>
<pre><code class="cs">public extension EnumerableApplicative of IEnumerable : Applicative&lt;IEnumerable&gt;<font></font>
{<font></font>
    static IEnumerable&lt;A&gt; Pure&lt;A&gt;(A a) =&gt; new[] { a };<font></font>
    static IEnumerable&lt;C&gt; LiftA2&lt;A, B, C&gt;(IEnumerable&lt;A&gt; ta, <font></font>
                                          IEnumerable&lt;B&gt; tb, <font></font>
                                          Func&lt;A, B, C&gt; map2) =&gt;<font></font>
            ta.SelectMany(a =&gt; tb.Select(b =&gt; map2(a, b)));<font></font>
}</code></pre><br>
<p>,     .   —       ,     <code>public extension</code>.     -      ,       ,     (       ).</p><br>
<p>   Nullable?   :</p><br>
<pre><code class="cs">public extension NullableApplicative of IEnumerable : Applicative&lt;Nullable&gt;<font></font>
{<font></font>
    static A? Pure&lt;A&gt;(A a) =&gt; a;<font></font>
    static C? LiftA2&lt;A, B, C&gt;(A? ta, B? tb, Func&lt;A, B, C&gt; map2) =&gt;<font></font>
        (ta, tb) switch {<font></font>
            (A a, B b) =&gt; map2(a, b), //    null -  <font></font>
            _ =&gt; default(C?)          // -  -  null<font></font>
        };<font></font>
}</code></pre><br>
<p>        "  ",     ,      "  ,   , ...".  ,             ,     ,      .       <code>ZipList</code>:</p><br>
<pre><code class="cs">public class ZipList&lt;T&gt; : IEnumerable&lt;T&gt;<font></font>
{<font></font>
    private IEnumerable&lt;T&gt; _inner;<font></font>
<font></font>
    // ..    IEnumerable&lt;T&gt;   <font></font>
}<font></font>
<font></font>
public extension ZipListApplicative of ZipList : Applicative&lt;IEnumerable&gt;<font></font>
{<font></font>
    static IEnumerable&lt;A&gt; Pure&lt;A&gt;(A a) =&gt;<font></font>
        //        'a'<font></font>
        Enumerable.Repeat(a, int.MaxValue); <font></font>
    static IEnumerable&lt;C&gt; LiftA2&lt;A, B, C&gt;(IEnumerable&lt;A&gt; ta, <font></font>
                                          IEnumerable&lt;B&gt; tb, <font></font>
                                          Func&lt;A, B, C&gt; map2) =&gt;<font></font>
        ta.Zip(tb, map2);<font></font>
}</code></pre><br>
<p>, ZipList     ,    .      Applicative    ,       Zip.</p><br>
<p> ,   ,  -   ?      ? ,        —  -     , -   ,       ,    - . ,   ,           ,  : <code>(F&lt;A&gt;, F&lt;B&gt;) -&gt; F&lt;(A, B)&gt;</code>.  :</p><br>
<pre><code class="cs">public static T&lt;(A, B)&gt; Combine(T&lt;A&gt; ta, T&lt;B&gt; tb) =&gt;<font></font>
    LiftA2(ta, tb, (a, b) =&gt; (a, b));<font></font>
<font></font>
var eta = Enumerable.Range(3, 2);<font></font>
var etb = Enumerable.Range(15, 4);<font></font>
<font></font>
int? nta = 10;<font></font>
int? ntb = null;<font></font>
<font></font>
Combine(eta, etb) // [(3, 15), (3, 16), (3, 17), (3, 18), (4, 15), (4, 16), (4, 17), (4, 18)]<font></font>
Combine(nta, nta) // (10, 10)<font></font>
Combine(nta, ntb) // Null<font></font>
Combine(new ZipList&lt;int&gt;(eta), new ZipList&lt;int&gt;(etb)) //  [(3, 15), (4, 16)]</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><em>  </em></a></p><br>
<p>  ,  ,    .    — ,      Combine,        ,         .        ,       ,      ,  null.  ZipList      ,          .  ,     <strong>   </strong> (   <code>(a, b) =&gt; (a, b)</code>)  <strong> </strong> ( <code>T&lt;&gt;</code>).  ,   ,    ,      ( /// ),    , ,    ,           .</p><br>
<p> ,     ,   ,    ,      .          ,  ,  ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">"  "</a>.        ,      .</p><br>
<p><img src="https://habrastorage.org/webt/j1/oa/im/j1oaimjis07hw_6i-qjyiuhnnvo.png"><br>
<em>pure    ,   </em></p><br>
<p><img src="https://habrastorage.org/webt/l_/wi/if/l_wiif07ubisactdwbk4danqk3e.png"><br>
<em>liftA2       ,   <br>
    ,  </em></p><br>
<p>,       ,   ,         " ".   ? ""            . ,      ,   .    <code>LiftA2</code>          . ,     ,        ,     null —   .           - . </p><br>
<p>  ?   <code>LiftA2</code>  <code>Pure</code>   <code>Map</code>:</p><br>
<pre><code class="cs">static T&lt;B&gt; MapAnyFunctor&lt;T, A, B&gt;(T&lt;A&gt; source, Func&lt;A, B&gt; map) where T : Applicative =&gt;<font></font>
    LiftA2(source, Pure(0), (a, _) =&gt; map(a));</code></pre><br>
<p>  ?   —         <code>Pure</code>     <code>T&lt;&gt;</code>.     <code>T&lt;A&gt;</code>  <code>T&lt;&gt;</code>,      <code>LiftA2</code>.     ,        ,  <code>map</code>     <code>T&lt;A&gt;</code>.     ,     .     :</p><br>
<pre><code class="cs">public shape Applicative&lt;T&gt; : Functor&lt;T&gt; where T : &lt;&gt;<font></font>
{<font></font>
    static T&lt;A&gt; Pure&lt;A&gt;(A a);<font></font>
    static T&lt;C&gt; LiftA2&lt;A, B, C&gt;(T&lt;A&gt; ta, T&lt;B&gt; tb, Func&lt;A,B,C&gt; map2);<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><em>  </em></a>.  ,    ,   .</p><br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><p>      <code>Task&lt;T&gt;</code>:</p><br>
<pre><code class="cs">public extension TaskApplicative of Task: Applicative&lt;Task&gt;<font></font>
{<font></font>
    public static Task&lt;A&gt; Pure&lt;A&gt;(A a) =&gt; Task.FromResult(a);<font></font>
<font></font>
    public static async Task&lt;C&gt; LiftA2&lt;A, B, C&gt;(Task&lt;A&gt; ta, Task&lt;B&gt; tb, Func&lt;A, B, C&gt; map2)<font></font>
    {<font></font>
        await Task.WhenAll(ta, tb);<font></font>
        return map2(ta.Result, tb.Result);<font></font>
    }<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><em>  </em></a></p></div></div><br>
<h2 id="monad">Monad</h2><br>
<p>  . ,      .   <br>
   ,      :</p><br>
<pre><code class="cs">public shape Monad&lt;T&gt; where T : &lt;&gt;<font></font>
{<font></font>
    static T&lt;A&gt; Pure&lt;A&gt;(A a);<font></font>
    static T&lt;B&gt; Bind&lt;A, B&gt;(T&lt;A&gt; ta, Func&lt;A, T&lt;B&gt;&gt; mapInner);<font></font>
}</code></pre><br>
<p>  -, :</p><br>
<blockquote> —      Pure  Bind,     <code>T&lt;A&gt;</code>  ,    <code>A</code>  <code>T&lt;B&gt;</code>,       <code>T&lt;B&gt;</code></blockquote><p>     , .     ,     :         <code></code>.        <code>A</code>    ,     <code>B</code>.  <code>Bind</code>  ""    ,    <code>(T&lt;A&gt;, A =&gt; T&lt;B&gt;)</code>  <code>T&lt;B&gt;</code>.</p><br>
<p>   —   ,       ,       :</p><br>
<pre><code class="cs">public extension EnumerableMonad of IEnumerable : Monad&lt;IEnumerable&gt;<font></font>
{<font></font>
    static IEnumerable&lt;B&gt; Bind&lt;A, B&gt;(IEnumerable&lt;A&gt; ta, Func&lt;A, IEnumerable&lt;B&gt;&gt; mapInner) =&gt;<font></font>
        ta.SelectMany(mapInner);<font></font>
    // Pure      <font></font>
}</code></pre><br>
<p> ,  <code>Nullable</code>   .    <code>ZipList</code>?   , ,  :        ,      ,        ,     (   ).<br>
     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"> </a>  ,    ,      .     ZipList     ,        .</p><br>
<p><img src="https://habrastorage.org/webt/pf/4v/hw/pf4vhwatfeubgnipglnsoslzgig.png"><br>
<em>                       </em></p><br>
<p>    ,   <code>Pure</code>   :      .   <code>LiftA2</code>,           <code>Pure</code>  <code>Bind</code>,    .</p><br>
<p> ,    ,     ,     . ,   ,         do-.     :</p><br>
<pre><code class="haskell">let foo = do<font></font>
  a &lt;- someA<font></font>
  b &lt;- someB<font></font>
  pure (doSomethingWith a b)</code></pre><br>
<p>    <code>Bind</code>     :</p><br>
<pre><code class="cs">var foo = Bind(someA, a =&gt; Bind(SomeB, b =&gt; Pure(DoSomethingWIth(a,b)))</code></pre><br>
<p>  .      <code>&lt;-</code>      <code>Bind</code>,<br>
,   —    ,     .<br>
.</p><br>
<p> ,    ,     . </p><br>
<p>     ?          . ,    ?</p><br>
<pre><code class="cs">var values = from x in new []{ 1, 2, 3 }<font></font>
             from y in new []{ 4, 5, 6 }<font></font>
             select x + y;</code></pre><br>
<p>   ,  do-    (    ):</p><br>
<pre><code class="haskell">let values = do <font></font>
    x &lt;- [1,2,3]<font></font>
    y &lt;- [4,5,6]<font></font>
    pure (x + y)</code></pre><br>
<p>     :</p><br>
<pre><code class="cs">var maybeA = GetMaybeA();<font></font>
var maybeB = maybeA?.GetB();<font></font>
var maybeC = maybeB?.GetC();<font></font>
var result = maybeC;</code></pre><br>
<p>  do-   Maybe (  Option,      — Nullable):</p><br>
<pre><code class="haskell">let result = do<font></font>
    maybeA &lt;- getMaybeA<font></font>
    maybeB &lt;- getB maybeA<font></font>
    maybeC &lt;- getC maybeB<font></font>
    pure maybeC</code></pre><br>
<p>    ?</p><br>
<pre><code class="cs">var valueA = await GetSomeA();<font></font>
var valueB = await GetSomeB(valueA);<font></font>
var result = valueB;</code></pre><br>
<p>  do-   IO (    , ,  ,    <code>Task</code>  ):</p><br>
<pre><code class="haskell">let result = do<font></font>
    valueA &lt;- getSomeA<font></font>
    valueB &lt;- getSomeB valueA<font></font>
    pure valueB</code></pre><br>
<p>        <em></em>    ,<br>
      :      <code>T&lt;&gt;</code>  <br>
 <code>A</code>  <code>T&lt;B&gt;</code>,  <code>T&lt;B&gt;</code>,   <code>A[]  A -&gt; B[]</code>,  <code>A?  A -&gt; B?</code>,<br>
 <code>Task&lt;A&gt;  A -&gt; Task&lt;B&gt;</code>,…      .</p><br>
<p>           ...</p><br>
<h2 id="zachem-nam-monady">  </h2><br>
<h3 id="uproschenie-sintaksisa-yazyka">  </h3><br>
<p> ,    ,    . ,    ,     " -,    - ".  -,  LINQ,  null propagation     .        .      nullable-? , -   , ,   -    .    ?    ,      . ,    ,   ,         -    LINQ- (,  <code>First</code>   ). </p><br>
<p>       ,     :    <code>MapAnyFunctor</code>      .     <code>async enumerable</code>,  -  (    ,          CancallationToken?),      ?  - ,   ?</p><br>
<p>         <em>    </em>,      : <code>List</code>  <code>IO</code>.</p><br>
<p>  ,      ,    :   .   Rust       ,   .  :  try-,  Try-,     -,  -. ,         <code>async enumerable</code>,     ,     ,      .</p><br>
<p>       do-,       ,   ,    ,        ,         .</p><br>
<p> <strong></strong>:      <em></em>,           -.  ,      ,         ,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"> </a>.    ,        (  ,        <code>Par</code>)? ,  ,  C# 15,  , ,  .     .</p><br>
<h3 id="uproschenie-standartnoy-biblioteki-yazyka">   </h3><br>
<p>     ,    " -,    -".    ,         Bind.   <code>ContinueWith</code>,  <code>SelectMany</code>,   .           ,   Rust    .  <code>Option</code>/<code>Result</code>/<code>Future</code>   <em></em> ,      ,          : <strong></strong>    <code>Monad</code>,       <code>MonadFail</code>/<code>Bifunctor</code>/...,      . </p><br>
<p>     ?   -   . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"></a>   1.29  flatten  ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"></a>      ,   .       ,   .</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"></a>    transpose  Option/Result   ,  ,  <code>transpose</code>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"></a>    0.8  <strong>2013 </strong>. <code>transpose</code>   (     IO   )    ,  7  ,   .</p><br>
<p>   ,    :    <code>Monad</code>  <strong></strong> ,    <code>transpose/flatten/...</code>       <strong></strong>. ,     -    ,      ,    .     ,     2015       . ,  ,        ,         . </p><br>
<p>     .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">System.Linq.Async</a>.        ,    LINQ  corefx,    async-await. ,   <em></em> ,    .     ,      .    ,   -  .        <code>filterM</code>/<code>mapM</code>/<code>whateverM</code>,           //… ,      (  <code>M</code>  ),          .</p><br>
<p>,     ,    </p><br>
<h3 id="storonnie-biblioteki"> </h3><br>
<p> ,   Monad (    )  ,      . , ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>,           .       ,    "" —        ,         ,        (     ),     ,    ,     ,      . </p><br>
<p>          ,  ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><em>  </em></a>     ,   Go .        Functor/Applicative/Monad/…     .    HKT —    ,    ,          ,          . ,     ,       ,   .      ,     ,        .</p><br>
<p>  , ,    . ,    ,   IEnumerable.     —     .   ORM     IQueryable,        ,        ORM      .       -  ,           ,         ?        ?</p><br>
<p>           ,       .            Haskell,       <code>My.Big.Corporation.Utils</code>,      ,       "      ".     ,    ,       ,     ,          -. </p><br>
<div class="spoiler"><b class="spoiler_title">  </b><div class="spoiler_text"><p> ,   —   ,   . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"> </a> —          ,      . ,    "   ",    ,         ,         .  —  ,   .</p></div></div><br>
<p>,  ,       ,       :     -  .         .     Akka,     .     ,     —         ,    ? , ,      -      ,      , ,       .        ,         ,   ,   ,  -   ,            ,   -   .       ,      ,    .  ,     ,      ,      ,            .</p><br>
<p><img src="https://habrastorage.org/webt/ym/vc/gc/ymvcgcyndroyfat4cmnrd2jnvck.png"></p><br>
<p>  ,      ,    ,    ,    —     .   , ,  -         ,      —   ,  - ,   ,       ,       .   —  ,   ,    —  ,        —  ,        .</p><br>
<h3 id="vyrazitelnost"></h3><br>
<p>        .  ,  ,      :         SOLID.  ?  ,  ,    ,   :</p><br>
<pre><code class="cs">public M&lt;Comment&gt; GetArticleComment&lt;M&gt;(int articleId) <font></font>
    where M : MonadWriter&lt;LogMessage[]&gt;, MonadReader&lt;Config&gt;, MonadHttp&lt;AllowedSite&gt;</code></pre><br>
<p> MonadWriter/MonadReader/MonadHttp —       SOLID ,        .       ,       (     <code>LogMessage</code>!),   (  <code>Config</code>!)    Http (   <code>AllowedSite</code>!),          . </p><br>
<p>,    ,       .     ,     ,     Task.   <code>return 10</code>,     <code>Task&lt;int&gt;</code>.</p><br>
<p>    ,   Task     <code>M</code>,    —  ,     . </p><br>
<p>,           SOLID,           —  .     Autofac/Windsor/Ninject/…     "  ",      <code>where</code>   ,      ,      .    ,     ,     ,    . </p><br>
<h3 id="testiruemost"></h3><br>
<p>    ,       ,    ,    .</p><br>
<p>  ,      ,     ,      .     : ,    ,     -   -  . </p><br>
<pre><code class="cs">class MyService <font></font>
{<font></font>
    async Task&lt;Comment&gt; SomeBusinessLogicAsync(int commentId) {<font></font>
        var comment = await this.remoteClient.GetAsync($"some/url/{commentId}");<font></font>
        // .. do stuff ..<font></font>
        return await DoOtherStuffAsync(comment);<font></font>
    }<font></font>
}</code></pre><br>
<p>     .      C#   ?<br>
,        ,   <code>MyService</code>  <code>remoteClient</code>    ,     . </p><br>
<p>    -  ,   <code>httpClient</code>,         (        ,  ),   act/assert  .</p><br>
<p>      ?    ,   (    )  Id,          :</p><br>
<pre><code class="cs">public class Id&lt;T&gt;<font></font>
{<font></font>
    public T Value { get; }<font></font>
<font></font>
    public Id(T value)<font></font>
    {<font></font>
        Value = value<font></font>
    }<font></font>
}<font></font>
<font></font>
public extension IdMonad of Id : Monad&lt;Id&gt;<font></font>
{<font></font>
    static IdMonad&lt;A&gt; Pure&lt;A&gt;(A a) =&gt; new Id&lt;A&gt;(a); //   <font></font>
    static IdMonad&lt;B&gt; Bind&lt;A, B&gt;(IdMonad&lt;A&gt; ta, Func&lt;A, IdMonad&lt;B&gt;&gt; mapInner)  =&gt;<font></font>
        mapInner(ta.Value); //      <font></font>
    //  map  liftA2  -<font></font>
}</code></pre><br>
<p>  :</p><br>
<pre><code class="cs">Task&lt;Comment&gt; SomeBusinessLogicAsync(int commentId);</code></pre><br>
<p> </p><br>
<pre><code class="cs">M&lt;Comment&gt; SomeBusinessLogicAsync&lt;M&gt;(int commentId) where M : Monad =&gt;<font></font>
    this.remoteClient.Get($"some/url/{commentId}").Bind(comment =&gt; <font></font>
        // .. do stuff ..<font></font>
        return DoOtherStuff(comment);<font></font>
    );</code></pre><br>
<p> do-    11,    .      :</p><br>
<pre><code class="cs">var comment = await myService.SomeBusinessLogicAsync&lt;Task&gt;(547);</code></pre><br>
<p>    :</p><br>
<pre><code class="cs">var comment = myService.SomeBusinessLogicAsync&lt;Id&gt;(547).Value;</code></pre><br>
<p>    !        ,    SOLID (       ).     ,      ,       ,      .  ,    .       ,       <em>- </em>.        ,        .    <strong></strong>      .             ,       . </p><br>
<p>  —      .    ,     <code>Task.FromResult</code> -    .     ,    ,    .       :        :   ,   .    "    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">    </a>",  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"> </a>.     ,     ,   .</p><br>
<p> ,    <code>M</code>   ,    <code>Task</code>  <code>Id</code>,     , , ,     (   <code>M</code>        ),     ( <code>M</code> — Option),     ( <code>M</code> — Result),   .     —       .       ,      , ,     —   ,      . :  — ,  — .</p><br>
<h2 id="zaklyuchenie"></h2><br>
<p><img src="https://habrastorage.org/webt/ai/qx/_m/aiqx_map8rpzdm85xgzslo0aqwg.png"></p><br>
<p> ,    ,     .       Traversable,  Foldable,         ,    ,        ,  .</p><br>
<p> ,          :</p><br>
<ul>
<li><p> (. Mappable)</p><br>
<p> :   ,   <code>Map</code>  ,      .</p><br>
<p>:       ,  <code>T&lt;A&gt;</code>  <code>T&lt;B&gt;</code>.</p><br>
<p>:        ;<br>
   </p><br>
</li>
<li><p>  (, . PairMappable) </p><br>
<p> :   ,    <code>Pure</code>  <code>LiftA2</code>,   <br>
   ( ,   ).   <br>
    "".</p><br>
<p>:        <code>T&lt;A&gt;</code>  <code>T&lt;B&gt;</code>   <code>T&lt;C&gt;</code>. </p><br>
<p>:    (, List, Option, ZipList, ..);<br>
   -  </p><br>
</li>
<li><p> (. NestedJoinMappable):</p><br>
<p> :   ,    <code>Pure</code>  <code>Bind</code> (  ).<br>
       "".</p><br>
<p>:    <em></em> ,  <code>T&lt;B&gt;</code>   <code>A</code>, <br>
         <code>T&lt;A&gt;</code></p><br>
<p>:    ,    ;    - </p><br>
</li>
</ul><br>
<p>,   ,   (     )   -  ,    , </p><br>
<ul>
<li>   (   )</li>
<li>    ,       </li>
</ul><br>
<p> ,         ,       ,   ,        .</p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モナドは、使用できるツールにすぎません。</font><font style="vertical-align: inherit;">それは多くの疑問の原因を破壊し、より多くの人生の1ヶ月よりも保存されます成功した投資である勉強「地獄はそれをない仕事を何、よく、私は</font><font style="vertical-align: inherit;">チェックし</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">て、すべての</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">つぼみに」。</font><font style="vertical-align: inherit;">そして、</font></font><abbr title="プログラミングの敗北：すべてのバグを削除する手法はないので、70年代に機能したものから始めましょう"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべての問題からあなたを救う</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プログラミング手法</font><abbr title="Programming Defeatism: No technique will remove all bugs, so let's go with what worked in the 70s"><font style="vertical-align: inherit;">はあり</font></abbr><font style="vertical-align: inherit;">ませんが、それらの重要な部分を解決するツールを使用しないのは罪です。</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja490096/index.html">Raspberry Pi用の小さなUSBハブを簡単に作成する方法</a></li>
<li><a href="../ja490100/index.html">分散型スクーターレンタル用のソフトウェアを開発します。それは簡単だと誰が言ったのですか？</a></li>
<li><a href="../ja490102/index.html">wcからD：単一の分岐のない712文字</a></li>
<li><a href="../ja490104/index.html">ボッシュのスマートサンバイザー。プロトタイプテスト</a></li>
<li><a href="../ja490110/index.html">開発者からマネージャー、そしてその逆</a></li>
<li><a href="../ja490114/index.html">Yandex.Practicum-データアナリスト。卒業</a></li>
<li><a href="../ja490118/index.html">SERMに関する最も重要な10の事実</a></li>
<li><a href="../ja490120/index.html">ビットトーンで学ぶ</a></li>
<li><a href="../ja490126/index.html">シンガポールの電子決済ライセンスの種類とその入手方法は？</a></li>
<li><a href="../ja490130/index.html">骨董品：オーディオファン形式としてのデジタルカセット</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>