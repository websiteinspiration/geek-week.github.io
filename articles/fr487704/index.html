<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõÅ ü§≤ üßöüèº Comment nous avons cr√©√© des rapports dynamiques au SSRS 2014 üíß üç¥ üéß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous avons d√©j√† expliqu√© comment nous avons aid√© une entreprise manufacturi√®re √† transformer les processus de formation en entreprise et de d√©veloppem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Comment nous avons cr√©√© des rapports dynamiques au SSRS 2014</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/true_engineering/blog/487704/"><img src="https://habrastorage.org/webt/_q/hb/qb/_qhbqb8irkmfwui-lrqaktkhe8q.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©j√† expliqu√©</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comment nous avons aid√© une entreprise manufacturi√®re √† transformer les processus de formation en entreprise et de d√©veloppement du personnel. </font><font style="vertical-align: inherit;">Les employ√©s du client, qui se noyaient dans des documents papier et des feuilles de calcul Excel, ont re√ßu une application iPad pratique et un portail Web. </font><font style="vertical-align: inherit;">L'une des fonctions les plus importantes de ce produit est la cr√©ation de rapports dynamiques par lesquels les managers jugent le travail des salari√©s ¬´sur le terrain¬ª. </font><font style="vertical-align: inherit;">Ce sont d'√©normes documents avec des dizaines de champs et des tailles moyennes de 3000 * 1600 pixels.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, nous expliquerons comment d√©ployer cette beaut√© bas√©e sur Microsoft SQL Server Reporting Services, pourquoi un tel backend peut √™tre de mauvais amis avec le portail Web et quelles astuces aideront √† √©tablir leur relation. </font><font style="vertical-align: inherit;">L'ensemble de la partie commerciale de la solution a d√©j√† √©t√© d√©crite dans l'article pr√©c√©dent, nous nous concentrons donc ici sur les probl√®mes techniques. </font><font style="vertical-align: inherit;">Commen√ßons!</font></font><br>
<br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formulation du probl√®me</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons un portail avec lequel plusieurs centaines d'utilisateurs travaillent. </font><font style="vertical-align: inherit;">Ils sont organis√©s dans une hi√©rarchie par √©tapes, o√π chaque utilisateur a un superviseur d'un rang sup√©rieur. </font><font style="vertical-align: inherit;">Cette diff√©renciation des droits est n√©cessaire pour que les utilisateurs puissent cr√©er des √©v√©nements avec n'importe quel employ√© subordonn√©. </font><font style="vertical-align: inherit;">Vous pouvez sauter des √©tapes, c.-√†-d. </font><font style="vertical-align: inherit;">l'utilisateur peut commencer une activit√© avec un employ√© de tout rang inf√©rieur √† lui. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quels √©v√©nements signifient ici? </font><font style="vertical-align: inherit;">Il peut s'agir de formation, de soutien ou de certification d'un employ√© d'une soci√©t√© commerciale, que le superviseur effectue dans un point de vente. </font><font style="vertical-align: inherit;">Le r√©sultat d'un tel √©v√©nement est un questionnaire rempli sur un iPad avec des notes des employ√©s pour les qualit√©s et comp√©tences professionnelles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selon les donn√©es du questionnaire, vous pouvez pr√©parer des statistiques, par exemple:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combien d'√©v√©nements avec ses subordonn√©s de ce genre Vasya Ivanov a-t-il cr√©√©s en un mois? </font><font style="vertical-align: inherit;">Combien d'entre eux sont termin√©s?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quel est le pourcentage de notes satisfaisantes? </font><font style="vertical-align: inherit;">√Ä quelles questions les marchandiseurs r√©pondent-ils le pire? </font><font style="vertical-align: inherit;">Quel manager est le pire √† passer des tests?</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces statistiques sont contenues dans des </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rapports</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui peuvent √™tre cr√©√©s via l'interface Web, aux formats XLS, PDF, DOCX et imprim√©s. </font><font style="vertical-align: inherit;">Toutes ces fonctions sont con√ßues pour les managers de diff√©rents niveaux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le contenu et la conception des rapports sont d√©finis dans les </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mod√®les</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , vous permettant de d√©finir les param√®tres n√©cessaires. </font><font style="vertical-align: inherit;">Si √† l'avenir les utilisateurs auront besoin de nouveaux types de rapports, le syst√®me a la possibilit√© de cr√©er des mod√®les, de sp√©cifier des param√®tres modifiables et d'ajouter un mod√®le au portail. </font><font style="vertical-align: inherit;">Tout cela - sans interf√©rer avec le code source et les processus de travail du produit.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sp√©cifications et limitations</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le portail fonctionne sur une architecture de microservices, la face avant est √©crite en angulaire 5. La ressource utilise l'autorisation JWT, prend en charge les navigateurs Google Chrome, Firefox, Microsoft Edge et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IE 11</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toutes les donn√©es sont stock√©es sur MS SQL Server 2014. SQL Server Reporting Services (SSRS) est install√© sur le serveur, le client l'utilise et ne va pas refuser. </font><font style="vertical-align: inherit;">D'o√π la limitation la plus importante: l'acc√®s √† SSRS est ferm√© de l'ext√©rieur, vous ne pouvez donc acc√©der √† l'interface Web et SOAP qu'√† partir du r√©seau local via l'autorisation NTLM.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelques mots sur SSRS</font></font></b><div class="spoiler_text"><b>SSRS </b>‚Äì    ,        ,     .     docs.microsoft.com,  SSRS        (API)    ( Report Server,  -    HTTP). <br>
</div></div><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attention, la question: comment r√©aliser la t√¢che sans m√©thodes manuelles, avec un minimum de ressources et un maximum d'avantages pour le client? </font></font></b></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtant donn√© que le client a SSRS sur un serveur d√©di√©, laissez SSRS faire tout le sale travail de g√©n√©ration et d'exportation de rapports. </font><font style="vertical-align: inherit;">Ensuite, nous n'avons pas √† r√©diger notre propre service de cr√©ation de rapports, √† exporter des modules vers XLS, PDF, DOCX, HTML et l'API correspondante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, la t√¢che √©tait de se lier d'amiti√© avec le portail SSRS et d'assurer le fonctionnement des fonctions sp√©cifi√©es dans la t√¢che. </font><font style="vertical-align: inherit;">Passons donc en revue la liste de ces sc√©narios - des subtilit√©s int√©ressantes ont √©t√© trouv√©es dans presque tous les points.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Structure de la solution</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme nous avons d√©j√† SSRS, il existe tous les outils pour g√©rer les mod√®les de rapport: </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Report Server - responsable de toute la logique de travail avec les rapports, leur stockage, leur g√©n√©ration, leur gestion et bien plus encore.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Report Manager - un service avec une interface Web pour g√©rer les rapports. </font><font style="vertical-align: inherit;">Ici, vous pouvez t√©l√©charger des mod√®les cr√©√©s dans SQL Server Data Tools sur le serveur, configurer les droits d'acc√®s, les sources de donn√©es et les param√®tres (y compris ceux qui peuvent √™tre modifi√©s lors du rapport des demandes). </font><font style="vertical-align: inherit;">Il est capable de g√©n√©rer des rapports sur les mod√®les t√©l√©charg√©s et de les t√©l√©charger dans diff√©rents formats, y compris XLS, PDF, DOCX et HTML.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous cr√©ons des mod√®les dans SQL Server Data Tools, avec l'aide de Report Manager, nous les remplissons sur Report Server, nous configurons - et il est pr√™t. </font><font style="vertical-align: inherit;">Nous pouvons g√©n√©rer des rapports, changer leurs param√®tres. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La question suivante: comment demander la g√©n√©ration de rapports sur des mod√®les sp√©cifiques via le portail et obtenir le r√©sultat √† l'avant pour la sortie vers l'interface utilisateur ou le t√©l√©charger dans le format souhait√©?</font></font></i></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rapports de SSRS au portail</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme nous l'avons dit ci-dessus, SSRS poss√®de sa propre API pour acc√©der aux rapports. Mais nous ne voulons pas donner ses fonctions pour des raisons de s√©curit√© et d'hygi√®ne num√©rique - nous avons seulement besoin de demander des donn√©es au SSRS sous la bonne forme et de transmettre le r√©sultat √† l'utilisateur. La gestion des rapports sera assur√©e par un personnel client sp√©cialement form√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtant donn√© que l'acc√®s √† SSRS se fait uniquement √† partir du r√©seau local, l'√©change de donn√©es entre le serveur et le portail s'effectue via un service proxy. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/kz/f5/9x/kzf59xp7_ltztohtag_orirmn5i.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âchange de donn√©es entre le portail et le serveur</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Voyons comment cela fonctionne et pourquoi ReportProxy est ici. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, du c√¥t√© du portail, nous avons un ReportService, auquel le portail acc√®de pour les rapports. Le service v√©rifie l'autorisation de l'utilisateur, le niveau de ses droits, convertit les donn√©es du SSRS sous la forme souhait√©e dans le cadre du contrat.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'API ReportService ne contient que 2 m√©thodes, ce qui nous suffit:</font></font><br>
<br>
<ol>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetReports</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - fournit les identifiants et les noms de tous les mod√®les que l'utilisateur actuel peut recevoir;</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetReportData (format, params)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - fournit des donn√©es de rapport export√©es pr√™tes √† l'emploi dans le format sp√©cifi√©, avec un ensemble de param√®tres donn√©.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous avez maintenant besoin de ces 2 m√©thodes pour pouvoir communiquer avec SSRS et en extraire les donn√©es n√©cessaires sous la bonne forme. </font><font style="vertical-align: inherit;">D'apr√®s la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentation,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous savons que nous pouvons acc√©der au serveur de rapports via HTTP √† l'aide de l'API SOAP. </font><font style="vertical-align: inherit;">Il semble que le puzzle se d√©veloppe ... Mais en fait, une surprise nous attend ici. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtant donn√© que SSRS est ferm√© au monde ext√©rieur et que vous ne pouvez y acc√©der que via l'authentification NTLM, il n'est pas disponible directement √† partir du portail SOAP. </font><font style="vertical-align: inherit;">Il y a aussi nos propres souhaits:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Donner acc√®s uniquement √† l'ensemble de fonctions requis et m√™me interdire le changement;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous devez passer √† un autre syst√®me de g√©n√©ration de rapports, les modifications dans ReportService doivent √™tre minimes et mieux ne pas √™tre requises du tout.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est l√† que ReportProxy nous aide, qui est situ√© sur la m√™me machine que SSRS et est responsable du proxy des demandes de ReportService √† SSRS. </font><font style="vertical-align: inherit;">Le traitement des demandes est le suivant:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le service re√ßoit une demande de ReportService, v√©rifie l'autorisation JWT;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conform√©ment √† la m√©thode API, le proxy passe par le protocole SOAP dans SSRS pour les donn√©es n√©cessaires, se connectant via NTLM en cours de route;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les donn√©es re√ßues de SSRS sont renvoy√©es √† ReportService en r√©ponse √† la demande.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, ReportProxy est un adaptateur entre SSRS et ReportService. </font></font><div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le contr√¥leur est le suivant:</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs">[BasicAuthentication]<font></font>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReportProxyController</span> : <span class="hljs-title">ApiController</span>
</span>{<font></font>
    [HttpGet()]<font></font>
    public List&lt;ReportItem&gt; Get(string rootPath)<font></font>
    {<font></font>
        <span class="hljs-comment">//  ...</span><font></font>
    }<font></font>
<font></font>
    public HttpResponseMessage Post([FromBody]ReportRequest request)<font></font>
    {<font></font>
        <span class="hljs-comment">//  ...</span><font></font>
    }<font></font>
}<font></font>
</code></pre><br>
  BasicAuthentication   :<br>
<br>
<pre><code class="javascript hljs">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BasicAuthenticationAttribute</span> : <span class="hljs-title">AuthorizationFilterAttribute</span>
</span>{<font></font>
    public override <span class="hljs-keyword">void</span> OnAuthorization(HttpActionContext actionContext)<font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> authHeader = actionContext.Request.Headers.Authorization;<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (authHeader != <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> authenticationToken = actionContext.Request.Headers.Authorization.Parameter;
            <span class="hljs-keyword">var</span> tokenFromBase64 = Convert.FromBase64String(authenticationToken);
            <span class="hljs-keyword">var</span> decodedAuthenticationToken = Encoding.UTF8.GetString(tokenFromBase64);
            <span class="hljs-keyword">var</span> usernamePasswordArray = decodedAuthenticationToken.Split(<span class="hljs-string">':'</span>);
            <span class="hljs-keyword">var</span> userName = usernamePasswordArray[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">var</span> password = usernamePasswordArray[<span class="hljs-number">1</span>];<font></font>
<font></font>
            <span class="hljs-keyword">var</span> isValid = userName == BasiAuthConf.Login &amp;&amp; password == BasiAuthConf.Password;<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (isValid)<font></font>
            {<font></font>
                <span class="hljs-keyword">var</span> principal = <span class="hljs-keyword">new</span> GenericPrincipal(<span class="hljs-keyword">new</span> GenericIdentity(userName), <span class="hljs-literal">null</span>);<font></font>
                Thread.CurrentPrincipal = principal;<font></font>
<font></font>
                <span class="hljs-keyword">return</span>;<font></font>
            }<font></font>
        }<font></font>
<font></font>
        HandleUnathorized(actionContext);<font></font>
    }<font></font>
<font></font>
    private <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> HandleUnathorized(HttpActionContext actionContext)<font></font>
    {<font></font>
        actionContext.Response = actionContext.Request.CreateResponse(<font></font>
            HttpStatusCode.Unauthorized<font></font>
        );<font></font>
<font></font>
        actionContext.Response.Headers.Add(<font></font>
            <span class="hljs-string">"WWW-Authenticate"</span>, <span class="hljs-string">"Basic Scheme='Data' location = 'http://localhost:"</span><font></font>
        );<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, le processus ressemble √† ceci:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le front envoie une requ√™te http √† ReportService;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReportService envoie une demande http √† ReportProxy;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReportProxy via l'interface SOAP re√ßoit les donn√©es de SSRS et envoie le r√©sultat √† ReportService;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReportService apporte le r√©sultat conform√©ment au contrat et le remet au client.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons un syst√®me de travail qui demande une liste des mod√®les disponibles, va au SSRS pour les rapports et les donne √† l'avant dans tous les formats pris en charge. </font><font style="vertical-align: inherit;">Vous devez maintenant afficher les rapports g√©n√©r√©s sur le devant conform√©ment aux param√®tres sp√©cifi√©s, donner la possibilit√© de les t√©l√©charger sur des fichiers XLS, PDF, DOCX et imprimer. </font><font style="vertical-align: inherit;">Commen√ßons par l'affichage.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisation des rapports SSRS dans le portail</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä premi√®re vue, c'est une affaire de tous les jours - le rapport est au format HTML, nous pouvons donc en faire ce que nous voulons! </font><font style="vertical-align: inherit;">Nous allons l'int√©grer dans la page, le colorer avec des styles de conception, et le truc est dans le chapeau. </font><font style="vertical-align: inherit;">En fait, il s'est av√©r√© qu'il y avait suffisamment d'√©cueils. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selon le concept de conception, la section des rapports sur le portail devrait comprendre deux pages: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) une liste de mod√®les o√π nous pouvons:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Afficher des statistiques sur les activit√©s pour l'ensemble du portail;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voir tous les mod√®les √† notre disposition;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cliquez sur le mod√®le souhait√© et acc√©dez au g√©n√©rateur de rapport correspondant.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/yx/tp/1h/yxtp1h3tvvpujymptptca2gcyew.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) un g√©n√©rateur de rapports qui nous permet de:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©finir des param√®tres de mod√®le et cr√©er un rapport √† leur sujet;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voir ce qui s'est pass√© en cons√©quence;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s√©lectionnez le format de fichier de sortie, t√©l√©chargez-le;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imprimer le rapport sous une forme pratique et visuelle.</font></font></li>
</ul><br>
 <img src="https://habrastorage.org/webt/au/ct/2f/auct2fiklpvvfad6vpbovv0xat0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y a pas eu de probl√®me particulier avec la premi√®re page, nous ne l'examinerons donc pas plus avant. </font><font style="vertical-align: inherit;">Et le g√©n√©rateur de rapports nous a forc√©s √† allumer l'ing√©nieur, afin qu'il soit pratique pour de vraies personnes d'utiliser toutes les fonctions sur TK.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Probl√®me num√©ro 1. </font><font style="vertical-align: inherit;">Tables g√©antes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selon le concept de conception, cette page devrait avoir une zone de visualisation afin que l'utilisateur puisse voir son rapport avant d'exporter. Si le rapport ne rentre pas dans la fen√™tre, vous pouvez faire d√©filer horizontalement et verticalement. Dans le m√™me temps, un rapport typique peut atteindre plusieurs tailles d'√©cran, ce qui signifie que nous avons besoin de coller des blocs avec les noms des lignes et des colonnes. Sans cela, les utilisateurs devront constamment revenir en haut du tableau pour se rappeler ce que signifie une cellule particuli√®re. Ou en g√©n√©ral, il sera plus facile d'imprimer un rapport et de garder constamment les feuilles n√©cessaires devant vos yeux, mais le tableau √† l'√©cran perd tout simplement son sens. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, les blocs collants ne peuvent pas √™tre √©vit√©s. Et SSRS 2014 ne sait pas comment r√©parer les lignes et les colonnes dans un document MHTML - uniquement dans sa propre interface Web.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, nous rappelons que les navigateurs modernes prennent en charge la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propri√©t√© collante CSS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui fournit simplement la fonction dont nous avons besoin. Nous mettons position: collant sur le bloc marqu√©, sp√©cifions le retrait √† gauche ou en haut (propri√©t√©s gauche, haut), et le bloc restera en place pendant le d√©filement horizontal et vertical. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous devez trouver un param√®tre auquel CSS peut acc√©der. Les valeurs de cellule personnalis√©es qui permettent √† SSRS 2014 de les capturer dans l'interface Web sont perdues lors de l'exportation au format HTML. OK, nous les marquerons nous-m√™mes - nous ne comprendrons que comment.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s plusieurs heures de lecture de documentation et de discussions avec des coll√®gues, il semblait qu'il n'y avait pas d'options. Et ici, selon toutes les lois de l'intrigue, le champ Info-bulle s'est affich√© pour nous, ce qui nous permet de sp√©cifier des info-bulles pour les cellules. Il s'est av√©r√© qu'il est jet√© dans le code HTML export√© dans l'attribut info-bulle - exactement sur la balise qui appartient √† la cellule personnalis√©e dans SQL Server Data Tools. Il n'y avait pas d'autre choix - nous n'avons pas trouv√© d'autre moyen de marquer les cellules pour la fixation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous devez donc cr√©er des r√®gles de marquage et des marqueurs de transfert en HTML via Info-bulle. Ensuite, en utilisant JS, nous modifions l'attribut info-bulle √† la classe CSS au marqueur sp√©cifi√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y a que deux fa√ßons de corriger les cellules: verticalement (colonne fixe) et horizontalement (ligne fixe). </font><font style="vertical-align: inherit;">Il est logique de placer un autre marqueur sur les cellules des coins, qui restent en place lors du d√©filement dans les deux directions - fixe-les deux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'√©tape suivante consiste √† faire l'interface utilisateur. </font><font style="vertical-align: inherit;">Lorsque vous recevez un document HTML, vous devez trouver tous les √©l√©ments HTML contenant des marqueurs, reconna√Ætre les valeurs, d√©finir la classe CSS appropri√©e et supprimer l'attribut info-bulle afin qu'il ne sorte pas lorsque vous survolez la souris. </font><font style="vertical-align: inherit;">Il convient de noter que le balisage r√©sultant est constitu√© de tables imbriqu√©es (balises de table).</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Afficher le code</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs">type FixationType = <span class="hljs-string">'row'</span> | <span class="hljs-string">'column'</span> | <span class="hljs-string">'both'</span>;<font></font>
<font></font>
init(reportHTML: HTMLElement) {<font></font>
    <span class="hljs-comment">//    </span><font></font>
<font></font>
    <span class="hljs-comment">// -  </span>
    <span class="hljs-keyword">const</span> rowsFixed: NodeList = reportHTML.querySelectorAll(<span class="hljs-string">'[title^="RowFixed"]'</span>);
    <span class="hljs-comment">// -  </span>
    <span class="hljs-keyword">const</span> columnFixed: NodeList = reportHTML.querySelectorAll(<span class="hljs-string">'[title^="ColumnFixed"]'</span>);
    <span class="hljs-comment">// -    </span>
    <span class="hljs-keyword">const</span> bothFixed: NodeList = reportHTML.querySelectorAll(<span class="hljs-string">'[title^="BothFixed"]'</span>);<font></font>
<font></font>
    <span class="hljs-keyword">this</span>.prepare(rowsFixed, <span class="hljs-string">'row'</span>);
    <span class="hljs-keyword">this</span>.prepare(columnFixed, <span class="hljs-string">'column'</span>);
    <span class="hljs-keyword">this</span>.prepare(bothFixed, <span class="hljs-string">'both'</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    </span>
prepare(nodeList: NodeList, <span class="hljs-attr">fixingType</span>: FixationType) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; nodeList.length; i++) {
        <span class="hljs-keyword">const</span> element: HTMLElement = nodeList[i];
        <span class="hljs-comment">//   -</span>
        element.classList.add(fixingType + <span class="hljs-string">'-fixed'</span>);<font></font>
<font></font>
        element.removeAttribute(<span class="hljs-string">'title'</span>);<font></font>
        element.removeAttribute(<span class="hljs-string">'alt'</span>); <span class="hljs-comment">//   SSRS</span><font></font>
<font></font>
        element.parentElement.classList.add(fixingType  + <span class="hljs-string">'-fixed-parent'</span>);<font></font>
<font></font>
        <span class="hljs-comment">//     ,     </span>
        element.style.width = element.getBoundingClientRect().width  + <span class="hljs-string">'px'</span>;
        <span class="hljs-comment">//     ,     </span>
        element.style.height = element.getBoundingClientRect().height  + <span class="hljs-string">'px'</span>;<font></font>
<font></font>
        <span class="hljs-comment">//  </span>
        <span class="hljs-keyword">this</span>.calculateCellCascadeParams(element, fixingType);<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et voici un nouveau probl√®me: avec le comportement en cascade, lorsque plusieurs blocs se d√©pla√ßant dans une direction sont fix√©s √† la fois dans le tableau, les cellules qui se succ√®dent seront superpos√©es. </font><font style="vertical-align: inherit;">En m√™me temps, il n'est pas clair combien chaque bloc suivant devrait reculer - les retraits devront √™tre calcul√©s via JavaScript en fonction de la hauteur du bloc devant lui. </font><font style="vertical-align: inherit;">Tout cela s'applique aux ancrages verticaux et horizontaux.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le script de correction a r√©solu le probl√®me.</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-comment">//      </span>
calculateCellCascadeParams(cell: HTMLElement, <span class="hljs-attr">fixationType</span>: FixationType) {
    <span class="hljs-keyword">const</span> currentTD: HTMLTableCellElement = cell.parentElement;
    <span class="hljs-keyword">const</span> currentCellIndex = currentTD.cellIndex;<font></font>
<font></font>
    <span class="hljs-comment">//   </span>
    currentTD.style.left = <span class="hljs-string">''</span>;<font></font>
    currentTD.style.top = <span class="hljs-string">''</span>;<font></font>
<font></font>
    <span class="hljs-keyword">const</span> currentTDStyles = getComputedStyle(currentTD);<font></font>
<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">if</span> (fixationType === <span class="hljs-string">'row'</span> || fixationType === <span class="hljs-string">'both'</span>) {
        <span class="hljs-keyword">const</span> parentRow: HTMLTableRowElement = currentTD.parentElement;<font></font>
<font></font>
        <span class="hljs-comment">//        </span>
        <span class="hljs-comment">//    .</span>
        <span class="hljs-comment">//   ,    .</span>
        <span class="hljs-keyword">let</span> previousRow: HTMLTableRowElement = parentRow;
        <span class="hljs-keyword">let</span> topOffset = <span class="hljs-number">0</span>;<font></font>
<font></font>
        <span class="hljs-keyword">while</span> (previousRow = previousRow.previousElementSibling) {
            <span class="hljs-keyword">let</span> previousCellIndex = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">let</span> cellIndexBulk = <span class="hljs-number">0</span>;<font></font>
<font></font>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; previousRow.cells.length; i++) {
                <span class="hljs-keyword">if</span> (previousRow.cells[i].colSpan &gt; <span class="hljs-number">1</span>) {<font></font>
                    cellIndexBulk += previousRow.cells[i].colSpan;<font></font>
                } <span class="hljs-keyword">else</span> {<font></font>
                    cellIndexBulk += <span class="hljs-number">1</span>;<font></font>
                }<font></font>
<font></font>
                <span class="hljs-keyword">if</span> ((cellIndexBulk - <span class="hljs-number">1</span>) &gt;= currentCellIndex) {<font></font>
                    previousCellIndex = i;<font></font>
                    <span class="hljs-keyword">break</span>;<font></font>
                }<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">const</span> previousCell = previousRow.cells[previousCellIndex];<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (previousCell.classList.contains(fixationType + <span class="hljs-string">'_fixed_parent'</span>)) {<font></font>
                topOffset += previousCell.getBoundingClientRect().height;<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (topOffset &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">if</span> (currentTDStyles.top) {<font></font>
                topOffset += &lt;any&gt;currentTDStyles.top.replace('px', '') - 0;<font></font>
            }<font></font>
<font></font>
            currentTD.style.top = topOffset + 'px';<font></font>
        }<font></font>
    }<font></font>
<font></font>
    //  <font></font>
    if (fixationType === 'column' || fixationType === 'both') {<font></font>
        //       <font></font>
        //     .<font></font>
        //   ,    .<font></font>
        let previousCell: HTMLTableCellElement = currentTD;<font></font>
        let leftOffset = 0;<font></font>
<font></font>
        while (previousCell = previousCell.previousElementSibling) {<font></font>
            if (previousCell.classList.contains(fixationType + '_fixed_parent')) {<font></font>
                leftOffset += previousCell.getBoundingClientRect().width;<font></font>
            }<font></font>
        }<font></font>
<font></font>
        if (leftOffset &gt; 0) {<font></font>
            if (currentTDStyles.left) {<font></font>
                leftOffset += &lt;any&gt;currentTDStyles.left.replace('px', '') - 0;<font></font>
            }<font></font>
<font></font>
            currentTD.style.left = leftOffset + 'px';<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code v√©rifie les balises des √©l√©ments marqu√©s et ajoute les param√®tres des cellules fixes √† la valeur de retrait. </font><font style="vertical-align: inherit;">Dans le cas de rang√©es adh√©rentes, leur hauteur s'additionne, pour les colonnes, leur largeur. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/vj/ix/bf/vjixbfnbewh6_pb3smfcogdpevc.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple de rapport avec une ligne sup√©rieure fixe.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Par cons√©quent, le processus ressemble √† ceci:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous obtenons le balisage de SSRS et le collons au bon endroit dans le DOM;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reconna√Ætre les marqueurs;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajustez les param√®tres du comportement en cascade.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtant donn√© que le comportement de collage est enti√®rement impl√©ment√© via CSS et que JS n'est impliqu√© que dans la pr√©paration du document entrant, la solution fonctionne assez rapidement et sans d√©calage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malheureusement, pour IE, les blocs collants devaient √™tre d√©sactiv√©s car </font><font style="vertical-align: inherit;">il ne supporte pas la position: propri√©t√© collante. </font><font style="vertical-align: inherit;">Le reste - Safari, Mozilla Firefox et Chrome - fait un excellent travail. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Passez.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Probl√®me num√©ro 2. </font><font style="vertical-align: inherit;">Exportation de rapport</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour extraire un rapport du syst√®me, vous devez (1) acc√©der au SSRS via ReportService pour un objet Blob, (2) obtenir un lien vers l'objet via l'interface √† l'aide de la m√©thode window.URL.createObjectURL, (3) mettre le lien dans la balise et simuler un clic pour t√©l√©chargement de fichiers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela fonctionne dans Firefox, Safari et dans toutes les versions de Chrome sauf Apple. Pour que IE, Edge et Chrome pour iOS prennent √©galement en charge la fonction, j'ai d√ª jeter mon cerveau.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans IE et Edge, l'√©v√©nement ne d√©clenchera tout simplement pas une demande de navigateur pour t√©l√©charger le fichier. Ces navigateurs ont une telle fonctionnalit√© que pour simuler un clic, une confirmation de l'utilisateur √† t√©l√©charger est requise, ainsi qu'une indication claire des actions futures. La solution a √©t√© trouv√©e dans la m√©thode window.navigator.msSaveOrOpenBlob (), qui est disponible dans IE et Edge. Il sait juste comment demander l'autorisation de l'utilisateur pour l'op√©ration et clarifier quoi faire ensuite. Ainsi, nous d√©terminons si la m√©thode window.navigator.msSaveOrOpenBlob existe et agissons sur la situation.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chrome sur iOS n'avait pas un tel hack, et au lieu d'un rapport, nous avons juste une page vierge. </font><font style="vertical-align: inherit;">En nous promenant sur le Web, nous avons trouv√© une histoire similaire, √† en juger par laquelle, dans iOS 13, ce bogue aurait d√ª √™tre corrig√©. </font><font style="vertical-align: inherit;">Malheureusement, nous avons √©crit l'application √† l'√©poque d'iOS 12, donc √† la fin nous avons d√©cid√© de ne plus perdre de temps et avons simplement d√©sactiv√© le bouton dans Chrome pour iOS. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, √† quoi ressemble le processus d'exportation final vers l'interface utilisateur. </font><font style="vertical-align: inherit;">Il y a un bouton dans le composant de rapport angulaire qui lance une cha√Æne d'√©tapes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† travers les param√®tres de l'√©v√©nement, le gestionnaire re√ßoit l'identifiant du format d'exportation (par exemple, ¬´PDF¬ª);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envoie une demande √† ReportService pour recevoir un objet Blob pour le format sp√©cifi√©;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v√©rifie si le navigateur est IE ou Edge;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lorsque la r√©ponse vient de ReportService:</font></font><br>
 <ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si c'est IE ou Edge, il appelle window.navigator.msSaveOrOpenBlob (fileStream, fileName);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sinon, il appelle la m√©thode this.exportDownload (fileStream, fileName), o√π fileStream est le Blob obtenu √† partir de la demande √† ReportService et fileName est le nom du fichier √† enregistrer. </font><font style="vertical-align: inherit;">La m√©thode cr√©e une balise cach√©e avec un lien vers window.URL.createObjectURL (fileStream), simule un clic et supprime la balise.</font></font></li>
</ul></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec cela r√©gl√©, la derni√®re aventure est rest√©e.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Probl√®me num√©ro 3. </font><font style="vertical-align: inherit;">Imprimer</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous pouvons maintenant voir le rapport sur le portail et l'exporter aux formats XLS, PDF, DOCX. </font><font style="vertical-align: inherit;">Il reste √† mettre en ≈ìuvre l'impression du document afin d'obtenir un rapport multipage pr√©cis. </font><font style="vertical-align: inherit;">Si le tableau s'av√©rait √™tre divis√© en pages, chacune d'entre elles devrait contenir des titres - les m√™mes blocs collants dont nous avons parl√© dans la section avant-dernier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'option la plus simple consiste √† prendre la page actuelle avec le rapport affich√©, √† masquer tout ce qui est superflu √† l'aide de CSS et √† l'envoyer √† l'impression √† l'aide de la m√©thode window.print (). </font><font style="vertical-align: inherit;">Cette m√©thode ne fonctionne pas imm√©diatement pour plusieurs raisons:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zone de visualisation non standard - le rapport lui-m√™me est contenu dans une zone de d√©filement s√©par√©e afin que la page ne s'√©tire pas √† des dimensions horizontales incroyables. </font><font style="vertical-align: inherit;">L'utilisation de window.print () ajuste le contenu qui ne correspond pas √† l'√©cran;</font></font></li>
<li>   ,      ;</li>
<li>     ,       .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout cela peut √™tre r√©solu en utilisant JS et CSS, mais nous avons d√©cid√© de faire gagner du temps aux d√©veloppeurs et de chercher une alternative √† window.print (). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSRS peut imm√©diatement nous donner un PDF pr√™t √† l'emploi avec une pagination pr√©sentable. Cela nous √©vite toutes les difficult√©s de la version pr√©c√©dente, la seule question est, pouvons-nous imprimer le PDF via un navigateur? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le PDF √©tant une norme tierce, les navigateurs le prennent en charge via divers plugins de visualisation. Pas de plug-in - pas de dessins anim√©s, nous avons donc encore besoin d'une option alternative. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et si vous mettez le PDF sur la page en tant qu'image et envoyez cette page √† imprimer? Il existe d√©j√† des biblioth√®ques et des composants pour Angular qui fournissent un tel rendu. Recherche, exp√©rimentation, mise en ≈ìuvre.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin de ne pas traiter les donn√©es que nous ne voulons pas imprimer, il a √©t√© d√©cid√© de transf√©rer le contenu rendu sur une nouvelle page, et l√† d√©j√† ex√©cuter window.print (). </font><font style="vertical-align: inherit;">En cons√©quence, l'ensemble du processus est le suivant:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demandez √† ReportService d'exporter le rapport au format PDF;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous obtenons l'objet Blob, le convertissons en URL (URL.createObjectURL (fileStream)), donnons l'URL √† la visionneuse PDF pour le rendu;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous prenons des images de la visionneuse PDF;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvrez une nouvelle page et ajoutez-y un petit balisage (titre, une petite indentation);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajoutez l'image de la visionneuse PDF au balisage, appelez window.print ().</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s plusieurs v√©rifications, un code JS est √©galement apparu sur la page, qui, avant l'impression, v√©rifie que toutes les images ont √©t√© charg√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, l'apparence enti√®re du document est d√©termin√©e par les param√®tres du mod√®le SSRS et l'interface utilisateur n'interf√®re pas avec ce processus. </font><font style="vertical-align: inherit;">Cela r√©duit le nombre de bogues possibles. </font><font style="vertical-align: inherit;">√âtant donn√© que les images sont transf√©r√©es pour impression, nous sommes assur√©s contre tout dommage ou d√©formation de la mise en page. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a aussi des inconv√©nients:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un rapport volumineux p√®sera beaucoup, ce qui affectera n√©gativement les plateformes mobiles;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la conception ne se met pas √† jour automatiquement - les couleurs, polices et autres √©l√©ments de conception doivent √™tre install√©s au niveau du mod√®le.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans notre cas, l'ajout fr√©quent de nouveaux mod√®les n'√©tait pas pr√©vu, la solution √©tait donc acceptable. </font><font style="vertical-align: inherit;">Les performances mobiles ont √©t√© prises pour acquises.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le dernier mot</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est ainsi qu'un projet r√©gulier nous fait √† nouveau rechercher des solutions simples pour des t√¢ches non triviales. </font><font style="vertical-align: inherit;">Le produit final r√©pond pleinement aux exigences de conception et est magnifique. </font><font style="vertical-align: inherit;">Et plus important encore, bien que nous n'ayons pas eu √† rechercher les m√©thodes de mise en ≈ìuvre les plus √©videntes, la t√¢che s'est termin√©e plus rapidement que si nous prenions le module de rapport d'origine avec toutes les cons√©quences. </font><font style="vertical-align: inherit;">Et √† la fin, nous avons pu nous concentrer sur les objectifs commerciaux du projet.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr487690/index.html">PHP Digest n ¬∞ 173 (27 janvier - 10 f√©vrier 2020)</a></li>
<li><a href="../fr487694/index.html">Comment Yandex.Cloud est h√©berg√© par Virtual Private Cloud et comment nos utilisateurs nous aident √† mettre en ≈ìuvre des fonctionnalit√©s utiles</a></li>
<li><a href="../fr487696/index.html">√âv√©nements num√©riques √† Moscou du 10 au 16 f√©vrier</a></li>
<li><a href="../fr487698/index.html">√âv√©nements num√©riques √† Saint-P√©tersbourg du 10 au 16 f√©vrier</a></li>
<li><a href="../fr487702/index.html">Une s√©lection d'articles sur l'apprentissage automatique: √©tudes de cas, guides et recherches pour janvier 2020</a></li>
<li><a href="../fr487706/index.html">D√©couverte de service dans les syst√®mes distribu√©s √† l'aide de l'exemple Consul. Alexander Sigachev</a></li>
<li><a href="../fr487716/index.html">Parfait SAST. Analyseur</a></li>
<li><a href="../fr487720/index.html">Sur le corutinisme concurrentiel (en utilisant la programmation r√©active comme exemple)</a></li>
<li><a href="../fr487724/index.html">BlazingPizza: application Blazor du d√©but √† la fin. Partie 2. Ajouter un composant</a></li>
<li><a href="../fr487728/index.html">@Pythonetc compilation, janvier 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>