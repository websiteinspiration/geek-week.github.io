<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🅿️ 👌🏼 🤞 PubSubはほぼ無料です：PostgreSQLのNOTIFY機能 🦇 🤵🏻 🎰</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="マイクロサービスがデータの保存に共通のPostgreSQLデータベースをすでに使用している場合、または同じサービスの複数のインスタンスが異なるサーバーでそれを使用している場合、Redis、RabbitMQクラスターのアーキテクチャに統合したりコードに埋め込んだりせずに、それらの間でメッセージ（Pub...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>PubSubはほぼ無料です：PostgreSQLのNOTIFY機能</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tensor/blog/484978/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マイクロサービスが</font><font style="vertical-align: inherit;">データの保存に</font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">共通のPostgreSQLデータベース</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><u><font style="vertical-align: inherit;">すでに使用している</font></u><font style="vertical-align: inherit;">場合、または同じサービスの複数のインスタンスが異なるサーバーでそれを使用している場合</font><font style="vertical-align: inherit;">、Redis、RabbitMQクラスターのアーキテクチャに統合したりコードに埋め込んだりせずに、それらの間で</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メッセージ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（PubSub）</font><b><font style="vertical-align: inherit;">を交換する機能を得る</font></b><font style="vertical-align: inherit;">ことは比較的</font><b><font style="vertical-align: inherit;">安価</font></b><font style="vertical-align: inherit;">です</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">別のMQシステムの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーション</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行う</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">には、データベーステーブルにメッセージを</font></a></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">書き込まないようにし</font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これにより、オーバーヘッドが大きくなり、最初に</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">送信された</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ものを</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">書き込み</font></a><font style="vertical-align: inherit;">、次に、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">既に読み取られたもの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">消去します</font></a><font style="vertical-align: inherit;">。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">NOTIFY</font></a><font style="vertical-align: inherit;"> / </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">LISTEN</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
メカニズムを使用してデータを送受信します</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Node.jsのモデル実装をまとめます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/er/e_/dv/ere_dvhj_y3sjkypbqeezzg_xn4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、この方法には、注意深く回避しなければならない熊手があります。</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロトコルの機能</font></font></h2><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">聴く</font></font></h4><br>
<pre><code class="sql hljs">LISTEN </code></pre><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libpqライブラリを使用するアプリケーションは、通常のSQLコマンドとしてLISTENコマンドを実行し、次に定期的にPQnotify関数を呼び出して新しい通知を確認する必要があります。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PGを操作するためのライブラリを作成していないが、すでに特定のアプリケーションを作成している場合は、ほとんどの場合、この関数の呼び出しにアクセスできません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非同期のリクエスト</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通知の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">処理に関する推奨事項に従ってそのようなライブラリがすでに作成されている場合</font><font style="vertical-align: inherit;">は、アプリケーションコードで自動的にメッセージを受け取ります。そうでない場合は、</font><font style="vertical-align: inherit;">接続</font><font style="vertical-align: inherit;">で</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定期的</font></font><code>SELECT 1</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><b><font style="vertical-align: inherit;">実行</font></b><font style="vertical-align: inherit;">するだけ</font><font style="vertical-align: inherit;">で、リクエストの結果とともに通知が送信されます。</font></font><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libpqの非常に古いリリースでは、NOTIFYコマンドからのメッセージをタイムリーに受信する方法は1つしかありませんでした。空のコマンドも含めてコマンドを常に送信し、各PQexec呼び出しの後にPQnotifyをチェックしました。</font><font style="vertical-align: inherit;">この方法はまだ機能しますが、プロセッサの非効率的な使用のため、時代遅れと見なされています。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">たとえば、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">psql</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に関しては、</font><font style="vertical-align: inherit;">次のようになります。</font></font><br>
<br>
<pre><code class="plaintext hljs">_tmp=# LISTEN test;<font></font>
LISTEN<font></font>
_tmp=# SELECT 1;<font></font>
 ?column?<font></font>
----------<font></font>
        1<font></font>
(1 row)<font></font>
<font></font>
Asynchronous notification "test" with payload "abc123" received from server process with PID 63991.<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
適用されたタスクの場合、そのような間隔で1秒以内にメッセージを配信する際の最大遅延に同意できる場合は、リクエストを実行します。</font><font style="vertical-align: inherit;">同時に、この方法は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接続の「活性」</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><b><font style="vertical-align: inherit;">監視するのに</font></b><font style="vertical-align: inherit;">役立ちます。これ</font><b><font style="vertical-align: inherit;">により、誰か</font></b><font style="vertical-align: inherit;">がサーバー側からを誤って切断したり、</font></font><code>pg_terminate_backend</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クライアント通知なしでPGが突然「クラッシュ」したりしないようにします。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通知する</font></font></h4><br>
<pre><code class="sql hljs">NOTIFY  [ ,  ]</code></pre><br>
<blockquote> NOTIFY        «»   ,         LISTEN     .<br>
…<br>
 «»,      ,…   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>.     <b>    8000 </b>.</blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">つまり、「メッセージ」に突然ASCIIとは非常に異なる何かが含まれている場合は、それ</font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をスクリーニングする必要があり</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、8,000バイト（文字ではない！）を超える場合は、</font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブロックに分割して接着し</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。同時に、そのようなブロックの転送を処理するためにチャネル帯域幅とサーバーリソースの両方を節約する必要があります。つまり、有用なコンテンツへのサービスの「バインド」をできるだけ少なくしますが、クライアントアプリケーションを「絞め込む」ことはせず、強制的にパックします。</font></font><code>gzip -9</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メカニズムの追加の利点の1つは、メッセージの「ソース」へのバインディングにも注目できます...</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シグナリングプロセス</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のPID（イベントデータで示される）</font><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">セッション自体のPIDと</font><font style="vertical-align: inherit;">一致するかどうかを確認することで、追加の作業を回避</font><font style="vertical-align: inherit;">できます（libpqに連絡することで見つけることができます）。</font><font style="vertical-align: inherit;">それらが一致する場合、セッションはそれ自体のアクションの通知を受信したため、無視できます。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...そして保証された配達順序：</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重複する通知の後続のインスタンスのフィルタリングとは別に、NOTIFYは、単一のトランザクションからの通知が、それらが送信されたのと同じ順序で常に到着することを保証します。</font><font style="vertical-align: inherit;">また</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、さまざまなトランザクションからのメッセージが、これらのトランザクションがコミットされた順序で到着する</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ことが保証されてい</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具体的には何も組み合わせないため、各リクエストは個別のトランザクションに対応します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、交換に使用される接続にアプリケーションアクティビティも存在する場合、NOTIFYが独自の自由意志のトランザクション内にない</font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能性がある</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ため、</font><u><font style="vertical-align: inherit;">副作用が発生する可能性がある</font></u><font style="vertical-align: inherit;">ことに注意してください</font><font style="vertical-align: inherit;">。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トランザクションはNOTIFYに大きな影響を与えます。</font><font style="vertical-align: inherit;">まず、トランザクション内でNOTIFYが実行された場合、トランザクションがコミットされた後、この場合にのみ、通知が受信者に配信されます。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トランザクションが中断された場合、NOTIFYを含め、トランザクション内のすべてのコマンドのアクションがキャンセルされるため、</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これは妥当</font><font style="vertical-align: inherit;">です。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">したがって、トランザクションや長いクエリがないことが明らかな接続を使用することをお勧めします。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベース0のクラス1262のオブジェクト0に対するAccessExclusiveLock</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
突然、NOTIFYが鈍くなり、そのようなロックの予想を記録し始めた場合でも、まだ「ショートパンツから成長」しているので、「大人の」MQについて考える時間です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結局のところ、通知キューはかなり大きい（標準ビルドでは8GB）が、まだ有限です。</font><font style="vertical-align: inherit;">よると</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トム・レーンの答え</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このロックは、トランザクションの通知メッセージを挿入している間保持され、その後トランザクションはコミットしてロックを解放します。</font></font></i></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">つまり、回避するオプションが多すぎません。</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">送信しますが、頻度</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
は</font><b><font style="vertical-align: inherit;">低く</font></b><font style="vertical-align: inherit;">なります。つまり、送信されたインジケーターがカウンターである場合は、より長い間隔で集約します。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">より小さなボリュームを送信する</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
たとえば、JSONから送信されたアプリケーションの観点から、主要なデフォルト値を削除します。</font></font></li>
<li><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンテンツなしで</font><b><font style="vertical-align: inherit;">信号のみを送信</font></b><font style="vertical-align: inherit;">します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オプションとして、複数のチャネルを起動します。それぞれの名前には、適用された意味がすでに含まれています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まだ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベースから出荷します</font></font></b></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">複雑なメッセージを送信する</font></font></h2><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボディエンコーディング</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的なケースでは、メッセージ内の許可された文字だけでなく、ロシア語の文字や「任意のバイナリ」も送信したい場合があります。そのため、</font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16進表現</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">への</font><u><font style="vertical-align: inherit;">変換を</font></u><font style="vertical-align: inherit;">使用し</font><font style="vertical-align: inherit;">て送信文字列を形成</font><font style="vertical-align: inherit;">すると便利</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">そして、はい、この方法は機能します：</font></font><br>
<br>
<pre><code class="sql hljs">NOTIFY test, E'\x20\x21'</code></pre><br>
<pre><code class="plaintext hljs">Asynchronous notification "test" with payload " !" received from server process with PID 63991.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、もう一度ドキュメントを見てみましょう。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この方法で作成したバイトシーケンス、特に8進および16進表記で、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーでエンコードされた有効な文字が</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">形成</font><b><font style="vertical-align: inherit;">される</font></b><font style="vertical-align: inherit;">ことを確認する必要があり</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">サーバーがこのようなバイトレコードの代わりにUTF-8エンコーディングで動作する場合は、4.1.2.3項で説明されているUnicode特殊シーケンスまたは代替Unicode構文を使用します。</font><font style="vertical-align: inherit;">（それ以外の場合は、UTF-8文字を手動でエンコードしてバイト単位で書き込む必要があり、非常に不便です。）</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">したがって、win1251のクォーテーションマークポーのありふれたシンボルを使用していても、パンを悲しんで取ります。</font></font><br>
<br>
<pre><code class="sql hljs">NOTIFY test, E'\x98'
<span class="hljs-comment">-- ERROR:  invalid byte sequence for encoding "UTF8": 0x98</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UTF-8文字を手動でエンコードしてバイト単位で書き込む</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」</font><font style="vertical-align: inherit;">ことは望まない</font><font style="vertical-align: inherit;">ため</font><font style="vertical-align: inherit;">、範囲外の文字が含まれている</font><font style="vertical-align: inherit;">場合、または必要に応じてセグメント化されている場合</font><font style="vertical-align: inherit;">は、メッセージ本文</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をbase64でパックし</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">て送信することに直ちに同意します</font></font><code>\x20-\x7E</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。一方では、このようなパッケージ化方法は冗長性をあまり増加させません（4：3係数）。他方では、それは任意の言語のシステムライブラリのレベルで実装され、追加の負荷を最小限に抑えます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、「奇妙な」文字がなく、メッセージが1つのセグメントに収まる場合でも</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、アポストロフィをエスケープする</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機能が1つ</font><b><font style="vertical-align: inherit;">あります</font></b><font style="vertical-align: inherit;">。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文字列にアポストロフィを含めるには、</font><font style="vertical-align: inherit;">たとえば 'Joan of Arc'の</font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ように</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">その</font><u><font style="vertical-align: inherit;">横に2つのアポストロフィ</font></u><font style="vertical-align: inherit;">を記述し</font><u><font style="vertical-align: inherit;">ます</font></u><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは二重引用符（ "）と同じではないことに注意してください。</font></font></blockquote><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セグメント識別</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のタスクは、メッセージの</font><font style="vertical-align: inherit;">サイズが突然この値を超えた場合に</font><font style="vertical-align: inherit;">、メッセージを</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7999バイトの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">送信</font><b><font style="vertical-align: inherit;">が</font></b><font style="vertical-align: inherit;">可能な</font><b><font style="vertical-align: inherit;">ブロック</font></b><font style="vertical-align: inherit;">に正しく「カット」すること</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">そして、受信者が注文を壊したり、「エイリアン」セグメントのチェーンに陥ることなく、それを収集できるようにします。</font><font style="vertical-align: inherit;">このため、それぞれを何らかの方法で識別する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、私たちはすでに2つの「座標」を知っています。これは</font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、送信プロセスのPIDと、</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各通知に含まれる</font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チャネル</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><u><font style="vertical-align: inherit;">名前です</font></u><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そして、セグメントの到着順序により、プロトコル自体が保証されます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネイバーを書く</font></font></b><div class="spoiler_text">    ,  <i>    </i> (       )   <i>        </i>. ,          —   «»  PubSub-   .<br>
</div></div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンテナ制限</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
複数のセグメントから一体型コンテナを組み立てるには、その完了の瞬間を知る必要があります。</font><font style="vertical-align: inherit;">これには2つの一般的な方法があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初のターゲットサイズ（バイトまたはセグメント）の転送</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それぞれの最後のセグメントの[ない]記号の送信</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結局、PubSubを作成するため、ほとんどのメッセージは短くなり、サイズ転送のために多くのバイトを予約することは不利益になります。</font><font style="vertical-align: inherit;">したがって、</font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セグメントデータの最初の文字を</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンテナーの継続/終了フラグとして</font><font style="vertical-align: inherit;">予約した2番目の方法を使用し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オブジェクト転送</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プレーンテキスト文字列とJSONオブジェクトの両方を「メッセージ」として送信するため</font><font style="vertical-align: inherit;">に、受信側で逆変換用の</font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シンボル記号</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><u><font style="vertical-align: inherit;">もう1つ</font></u><font style="vertical-align: inherit;">追加し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「非フォーマット」をbase64でエンコードすることを決定したため、フラグには、このセットに含まれていない許可された文字を使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
合計すると、送信されたセグメントには次のオプションがあります。</font></font><br>
<br>
<pre><code class="plaintext hljs">-- ""  <font></font>
!simple string<font></font>
-- "  " <font></font>
@{"a":1}<font></font>
--    base64<font></font>
#&lt;segment&gt;<font></font>
--    base64<font></font>
$&lt;segment&gt;<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、セグメントを受信するときに最初の文字のみを分析すると、セグメントで何を行う必要があるかを理解するのに十分です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PubSub実装の作成</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションはNode.js上にあるので、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node-postgresモジュール</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用してPostgreSQLで動作します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開始フレームを書きます</font></font></b><div class="spoiler_text">   PubSub   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">EventEmitter</a>,        ,     :<br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);
<span class="hljs-keyword">const</span> EventEmitter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'events'</span>).EventEmitter;<font></font>
<font></font>
<span class="hljs-keyword">const</span> PubSub = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">connection, interval, skipSelf</span>) </span>{
  <span class="hljs-comment">//    </span>
  <span class="hljs-keyword">this</span>.connection = connection;<font></font>
<font></font>
  <span class="hljs-comment">//       </span>
  <span class="hljs-keyword">this</span>.connection.on(<span class="hljs-string">'notification'</span>, p._onmessage.bind(<span class="hljs-keyword">this</span>));<font></font>
<font></font>
  <span class="hljs-comment">//        </span>
  <span class="hljs-keyword">this</span>.skipSelf = skipSelf;<font></font>
<font></font>
  <span class="hljs-comment">//  ""</span>
  setInterval(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-keyword">this</span>.connection.query(<span class="hljs-string">'SELECT 1'</span>);<font></font>
  }, interval);<font></font>
<font></font>
  <span class="hljs-comment">//     "" </span>
  <span class="hljs-keyword">this</span>.slices = {};<font></font>
};<font></font>
<font></font>
util.inherits(PubSub, EventEmitter);<font></font>
<font></font>
<span class="hljs-keyword">const</span> p = PubSub.prototype;
</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちはチャンネルと協力します</font></font></b><div class="spoiler_text"> LISTEN/UNLISTEN            ,      ,      .<br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//     - "",     </span>
<span class="hljs-comment">//     -       </span>
<span class="hljs-keyword">const</span> quot = <span class="hljs-function"><span class="hljs-params">str</span> =&gt;</span> <span class="hljs-regexp">/^[_a-z][0-9a-z_\$]*$/</span>.test(str) ? str : <span class="hljs-string">`"<span class="hljs-subst">${str}</span>"`</span>;<font></font>
<font></font>
p.subscribe = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">channel</span>) </span>{
  <span class="hljs-keyword">this</span>.connection.query(<span class="hljs-string">`LISTEN <span class="hljs-subst">${quot(channel)}</span>`</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<font></font>
};<font></font>
<font></font>
p.unsubscribe = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">channel</span>) </span>{
  <span class="hljs-keyword">this</span>.connection.query(<span class="hljs-string">`UNLISTEN <span class="hljs-subst">${quot(channel)}</span>`</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<font></font>
};<font></font>
</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メッセージの送受信</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword">const</span> PAYLOAD_LIMIT  = <span class="hljs-number">8000</span> - <span class="hljs-number">1</span>;
<span class="hljs-keyword">const</span> PAYLOAD_FL_STR = <span class="hljs-string">'!'</span>;
<span class="hljs-keyword">const</span> PAYLOAD_FL_OBJ = <span class="hljs-string">'@'</span>;
<span class="hljs-keyword">const</span> PAYLOAD_FL_SEQ = <span class="hljs-string">'#'</span>;
<span class="hljs-keyword">const</span> PAYLOAD_FL_FIN = <span class="hljs-string">'$'</span>;
<span class="hljs-keyword">const</span> PAYLOAD_SZ_HEAD = <span class="hljs-number">1</span>;
<span class="hljs-keyword">const</span> PAYLOAD_SZ_DATA = PAYLOAD_LIMIT - PAYLOAD_SZ_HEAD;<font></font>
<font></font>
<span class="hljs-comment">//  "" </span>
<span class="hljs-keyword">const</span> reASCII = <span class="hljs-regexp">/^[\x20-\x7E]*$/</span>;<font></font>
<font></font>
<span class="hljs-comment">// </span>
p.publish = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">channel, payload</span>) </span>{
  <span class="hljs-keyword">let</span> query = <span class="hljs-string">`NOTIFY <span class="hljs-subst">${quot(channel)}</span>`</span>;
  <span class="hljs-keyword">if</span> (payload !== <span class="hljs-literal">null</span> &amp;&amp; payload !== <span class="hljs-literal">undefined</span>) {
    <span class="hljs-comment">//    -   </span>
    <span class="hljs-keyword">let</span> str = <span class="hljs-keyword">typeof</span> payload == <span class="hljs-string">'string'</span><font></font>
      ? PAYLOAD_FL_STR + payload<font></font>
      : PAYLOAD_FL_OBJ + <span class="hljs-built_in">JSON</span>.stringify(payload);
    <span class="hljs-keyword">if</span> (str.length &gt; PAYLOAD_LIMIT || !reASCII.test(str)) {
      <span class="hljs-comment">//   base64-</span>
      <span class="hljs-keyword">const</span> b64 = Buffer.from(str).toString(<span class="hljs-string">'base64'</span>);
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> pos = <span class="hljs-number">0</span>, len = b64.length; pos &lt; len; pos += PAYLOAD_SZ_DATA) {
        <span class="hljs-keyword">let</span> fin = pos + PAYLOAD_SZ_DATA;
        <span class="hljs-keyword">let</span> seg = fin &gt;= len<font></font>
          ? PAYLOAD_FL_FIN + b64.slice(pos)<font></font>
          : PAYLOAD_FL_SEQ + b64.slice(pos, fin);<font></font>
        <span class="hljs-keyword">this</span>.connection.query(<span class="hljs-string">`<span class="hljs-subst">${query}</span>, '<span class="hljs-subst">${seg}</span>'`</span>);<font></font>
      }<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">//        ?</span>
      <span class="hljs-comment">//    </span>
      str = str.replace(<span class="hljs-regexp">/'/g</span>, <span class="hljs-string">"''"</span>);
      <span class="hljs-keyword">this</span>.connection.query(<span class="hljs-string">`<span class="hljs-subst">${query}</span>, '<span class="hljs-subst">${str}</span>'`</span>);<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">//      </span>
    <span class="hljs-keyword">this</span>.connection.query(query);<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<font></font>
};<font></font>
<font></font>
<span class="hljs-comment">//   </span>
p._onmessage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg</span>) </span>{
  <span class="hljs-keyword">const</span> {processId, channel, payload} = msg;<font></font>
<font></font>
  <span class="hljs-comment">//  ""</span>
  <span class="hljs-keyword">if</span> (processId == <span class="hljs-keyword">this</span>.connection.processID &amp;&amp; <span class="hljs-keyword">this</span>.skipSelf) {
    <span class="hljs-keyword">return</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// "" </span>
  <span class="hljs-keyword">const</span> id = <span class="hljs-string">`<span class="hljs-subst">${processId}</span>:<span class="hljs-subst">${channel}</span>`</span>;<font></font>
<font></font>
  <span class="hljs-keyword">let</span> rv;
  <span class="hljs-comment">//  </span>
  <span class="hljs-keyword">let</span> fl = payload.charAt(<span class="hljs-number">0</span>);<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (fl == PAYLOAD_FL_SEQ || fl == PAYLOAD_FL_FIN) {
    <span class="hljs-comment">// base64</span>
    <span class="hljs-keyword">const</span> str = payload.slice(PAYLOAD_SZ_HEAD);
    <span class="hljs-keyword">const</span> slices = <span class="hljs-keyword">this</span>.slices;<font></font>
<font></font>
    <span class="hljs-keyword">let</span> b64;
    <span class="hljs-keyword">if</span> (fl == PAYLOAD_FL_FIN) {
      <span class="hljs-comment">//  </span>
      <span class="hljs-keyword">if</span> (slices[id]) {<font></font>
        slices[id].push(str);<font></font>
        b64 = slices[id].join(<span class="hljs-string">''</span>);
        <span class="hljs-keyword">delete</span> slices[id];<font></font>
      }<font></font>
      <span class="hljs-keyword">else</span> {<font></font>
        b64 = str;<font></font>
      }<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">//    </span>
      <span class="hljs-keyword">if</span> (slices[id]) {<font></font>
        slices[id].push(str);<font></font>
      }<font></font>
      <span class="hljs-keyword">else</span> {<font></font>
        slices[id] = [str];<font></font>
      }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (b64) {<font></font>
      rv = Buffer.from(b64, <span class="hljs-string">'base64'</span>).toString();<font></font>
      fl = rv.charAt(<span class="hljs-number">0</span>);<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">//  /</span><font></font>
    rv = payload;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (rv !== <span class="hljs-literal">undefined</span>) { <span class="hljs-comment">//   ''</span>
    <span class="hljs-keyword">let</span> res = {<font></font>
      processId<font></font>
    , channel<font></font>
    };<font></font>
    <span class="hljs-keyword">if</span> (rv) {
      <span class="hljs-comment">//      </span>
      <span class="hljs-keyword">let</span> data = rv.slice(<span class="hljs-number">1</span>);<font></font>
      res.payload = fl == PAYLOAD_FL_OBJ ? <span class="hljs-built_in">JSON</span>.parse(data) : data;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">this</span>.emit(channel, res);<font></font>
  }<font></font>
};<font></font>
</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いくつかのテスト</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword">const</span> pg = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pg'</span>);<font></font>
<font></font>
<span class="hljs-keyword">const</span> pgsql = <span class="hljs-keyword">new</span> pg.Client({
  <span class="hljs-attr">host</span> : <span class="hljs-string">'example-db'</span>
, <span class="hljs-attr">port</span> : <span class="hljs-number">5432</span>
, <span class="hljs-attr">user</span> : <span class="hljs-string">'postgres'</span>
, <span class="hljs-attr">password</span> : <span class="hljs-string">'postgres'</span>
, <span class="hljs-attr">database</span> : <span class="hljs-string">'_tmp'</span><font></font>
});<font></font>
<font></font>
pgsql.connect(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
  <span class="hljs-keyword">let</span> psA = <span class="hljs-keyword">new</span> PubSub(pgsql, <span class="hljs-number">1000</span>);
  <span class="hljs-keyword">let</span> psB = <span class="hljs-keyword">new</span> PubSub(pgsql, <span class="hljs-number">1000</span>);<font></font>
<font></font>
  <span class="hljs-keyword">let</span> chA = <span class="hljs-string">'channel:A'</span>;
  <span class="hljs-keyword">let</span> chB = <span class="hljs-string">'channel:B'</span>;<font></font>
  psA.subscribe(chA);<font></font>
  psB.subscribe(chB);<font></font>
<font></font>
  psA.on(chA, (msg) =&gt; {<font></font>
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'A:rcv'</span>, msg);<font></font>
  });<font></font>
  psB.on(chB, (msg) =&gt; {<font></font>
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'B:rcv'</span>, msg);<font></font>
  });<font></font>
<font></font>
  psB.publish(chA);<font></font>
  psB.publish(chA, <span class="hljs-string">'simple string'</span>);<font></font>
  psB.publish(chA, <span class="hljs-string">'  '</span>);<font></font>
  psB.publish(chA, {<span class="hljs-attr">a</span> : <span class="hljs-number">1</span>});<font></font>
  psA.publish(chB, <span class="hljs-string">'   100  '</span>.repeat(<span class="hljs-number">100</span>));<font></font>
});<font></font>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが非常に単純なので、非同期通知を処理するための基礎を例として、プロジェクトで使用される他のPLに簡単に実装できます。</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パイソン</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行く</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perl</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エリクサー</font></font></a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja484964/index.html">InfoWatch Traffic Monitorでの負荷分散の構成</a></li>
<li><a href="../ja484966/index.html">Springを使用してテストするための既製のテンプレート</a></li>
<li><a href="../ja484968/index.html">WPF DataGrid。テンプレートのために戦う</a></li>
<li><a href="../ja484972/index.html">Wine 5.0がリリースされました</a></li>
<li><a href="../ja484974/index.html">チューリングマシンシミュレーション用のWang Tiles</a></li>
<li><a href="../ja484982/index.html">ITスペシャリストのためにビジネスを整理するのは簡単ですか</a></li>
<li><a href="../ja484984/index.html">Unityゲーム開発者。OTUSからの新しいコース</a></li>
<li><a href="../ja484990/index.html">Luxoft TechTalks-グローバルIT達人によるビデオポッドキャストなど</a></li>
<li><a href="../ja484992/index.html">大規模なプロジェクトでより美しく：セットアップに20分を費やし、フォーマットを永遠に忘れましょう</a></li>
<li><a href="../ja484996/index.html">仮想PBXビーライン。マネージャーが教えてくれないこと</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>