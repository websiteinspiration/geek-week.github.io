<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙆🏻 😒 🔑 Tarantoolでインデックスを書き込む方法 🔽 🌭 ◾️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tarantoolは、アプリケーションサーバーおよびデータベースです。サーバー部分はCで書かれており、ユーザーにはそれを操作するためのLuaインターフェースが提供されます。さらに、Tarantoolはオープンソース製品です。つまり、ソースコードはパブリックドメインにあり、Tarantoolに基づいて...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Tarantoolでインデックスを書き込む方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/505880/"><img src="https://habrastorage.org/webt/_w/oc/me/_wocmecfrb1lnc7gdoodtf3j3y4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tarantoolは、アプリケーションサーバーおよびデータベースです。</font><font style="vertical-align: inherit;">サーバー部分はCで書かれており、ユーザーにはそれを操作するためのLuaインターフェースが提供されます。</font><font style="vertical-align: inherit;">さらに、Tarantoolはオープンソース製品です。つまり、ソースコードはパブリックドメインにあり、Tarantoolに基づいてソフトウェアを自由に開発および配布できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、今日の話は少し異なります。実験について、検索用の独自のデータ構造（Zオーダーカーブ）を記述して、既存のTarantoolエコシステムに統合しようとすることについてです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はTarantool Solution Teamの開発者です。Tarantoolの開発に直接関わっていませんが、アクティブユーザーです。</font><font style="vertical-align: inherit;">したがって、私にとってこの実験は、Tarantoolが低レベルでどのように機能するかを理解する試みです。</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarantoolとは何ですか？データはどこに保存されますか？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tarantoolとは何ですか？データベースの世界では、インメモリテクノロジーとして位置付けられています。 memtxエンジンを使用すると、ACIDのすべての原則を満たしながら、すべてのデータをRAMに保存できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tarantoolのリレーショナルテーブルの類似物はスペースであり、タプル（タプル）を格納するように設計されています。リレーショナルテーブルとは異なり、スペース内のタプルは通常、任意の長さにすることができます。それらを保存するには、検索データ構造を作成する必要があります。検索キーは主キーであり、常に一意です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
追加の構造、つまりタプルへのポインターのみを格納するセカンダリインデックスを構築することもできます。</font><font style="vertical-align: inherit;">セカンダリインデックスは一意ではない場合がありますが、これはユーザーに表示される外部の動作にすぎません。</font><font style="vertical-align: inherit;">プライマリインデックスフィールドは、一意でないインデックスに暗黙的に追加されます。</font><font style="vertical-align: inherit;">これにより、インデックス内のタプルのソートの安定性が保証されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tarantoolは、さまざまなタイプのインデックスをサポートしています。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まず第一に、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bツリー</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（そして、絶対に正確であれば、B + *-ツリー）です。</font><font style="vertical-align: inherit;">[ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bツリー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]の</font><font style="vertical-align: inherit;">多くは、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Bツリー</font></a><font style="vertical-align: inherit;">の構造について書かれ</font><font style="vertical-align: inherit;">てい</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">データはソートされた形式で保存されることに注意します。さらに、インデックス付きキーのプレフィックスで検索できます。</font></font></li>
<li>   <strong>hash-</strong>. ,      .    .    B-,      ,  .    .</li>
<li><strong>R-Tree</strong>.      .    «» , ,  .       — .     ,       .        .   ,      ,    .</li>
<li><strong>Bitset</strong>. ,     .   ,            ,   .</li>
</ul><br>
<h3> Z-,   </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インデックスを作成するアイデアはどこから来たのですか、そして非常にエキゾチックですか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アマゾンの記事[ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1、2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]に</font><font style="vertical-align: inherit;">出くわす</font><font style="vertical-align: inherit;">と、Zオーダーカーブやモートンカーブなどの構造について話しました。これは、Bツリーにフィットするフラット構造（Zオーダーカーブ）内の「多次元」データの場所のレシピです。このようなアプローチは、継続的なデータスキャンを回避するのに役立ちます。一般に、特定の特性セットを持つオブジェクトに関する情報は、多次元データと見なすことができます。たとえば、身長、体重、足のサイズなど。人。ほとんどのデータベースは、この目的でRツリーを使用しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zオーダーカーブの構造について少し説明します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/363/a10/2c9/363a102c99adb088e19052945e6298fb.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モートン曲線とも呼ばれるZ次曲線は、空間内の点の座標のビットをインターリーブすることによって取得されます。</font><font style="vertical-align: inherit;">このようにして得られたZアドレスは、局所性の特性を持っています。</font><font style="vertical-align: inherit;">多次元空間内の近くにあるポイントは、フラットライン上に表示されると、近くにあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
概略的に類似したミキシングは次のようになります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6eb/04c/f2b/6eb04cf2b6ac3f0b26613a774c8f479d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使い方？</font><font style="vertical-align: inherit;">対角線上にある2つの点を使用して、空間の特定の領域、つまりハイパーキューブ（2次元空間には長方形があります）を制限します。これらの点は、線上の2点に表示されます。</font><font style="vertical-align: inherit;">そして、私たちは不愉快な副作用を得ます：ポイントのいくつかは境界ボックスを超えています：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/991/fd9/889/991fd9889fa6f3b4b30fd7adecfcd436.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、この曲線に沿って反復することはできません。しかし、特別なアルゴリズムを装備しているので、海外に行ってジャンプして検索エリアに戻ることができます。曲線の極値を超えると（upper_boundと呼びましょう）、検索は終了です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bツリーを使用する場合、一連の間隔があり、このクエリはBツリーの順次スキャンにつながり、大きなデータセットでは多くの時間がかかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の関心は、この曲線に関する他の出版物によって刺激されました。たとえば</font><font style="vertical-align: inherit;">、独自のデータベースである</font><font style="vertical-align: inherit;">TransBase [ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ] </font><font style="vertical-align: inherit;">にどのように統合されたか</font><font style="vertical-align: inherit;">。そして、残念ながら私自身は、この構造のオープンソース実装を見つけられませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
基になるBツリーカーブには、Rツリーよりもいくつかの利点があります。</font><font style="vertical-align: inherit;">たとえば、占有率とコンパクトさ。</font><font style="vertical-align: inherit;">短所：使用されるアルゴリズムのほとんどはプロセッサに制限されています。</font><font style="vertical-align: inherit;">比較のために、Tarantoolを使用することにしました。読み取り/挿入速度とメモリ消費量に興味がありました。</font><font style="vertical-align: inherit;">同様のトピックがHabréですでに提起されていることは言うまでもありませんが、小さな次元（2-3）とPostgreSQLディスクデータベース[ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZcurvePostgres</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ] </font><font style="vertical-align: inherit;">に関連しています</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarantoolに組み込むには何が必要ですか？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2〜3次元のこの構造の単純な実装を見つけましたが、パフォーマンスを既存のRツリーインデックスと比較したいので、小さな次元に限定したくありませんでした。私はRツリーと同じ次元を選択しました-20。これのために、いくつかのプリミティブ操作をサポートするビットマップが必要でした：ビットの抽出/変更、シフト、OR / AND論理操作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロトタイプについては、見つかったオープンソース実装を採用しましたが、汎用ビットマップは不要であるという結論にすぐに到達しました。キーの長さは常に64の倍数であるため、一部の操作は大幅に簡略化されています。私は自分の実装に基づいて独自の実装を作成しました。さらに、メモリを割り当てるためにシステム関数を使用する代わりに、Tarantool [</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく、インデックスの中心は、Zカーブを操作するためのアルゴリズムのセットです。</font><font style="vertical-align: inherit;">つまり、Zアドレスを計算し（特別なルックアップテーブルを使用）、Zアドレスが検索領域に属しているかどうかを確認し、指定されたポイントから開始して、検索領域で最初の発生を検出します。</font><font style="vertical-align: inherit;">ウェブをよく検索すれば、これらのアルゴリズムを説明する科学出版物を見つけることができるので、私がしなければならなかったのは、それらを実装し、デバッグし、可能であればそれらを最適化することだけでした。</font><font style="vertical-align: inherit;">TREEインデックスに使用される実装済みのBツリー内にZアドレスを格納することになっています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データ処理はどのように構成されていますか？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も一般的なケースでは、タプルが私たちのところにやって来ます。これは、メッセージパック形式のデータの配列です。そして理想的なケースでは、インデックス付きフィールドを分離し、それらのビットを混合し、Bツリー内のタプルへのポインターを使用してアドレスを挿入する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、符号なしの型のみを処理する場合、数値の並べ替えられたビット表現が自然表現の並べ替えられた数値に対応する場合、すべてが非常に単純になります。符号付き整数には独自の表示規則があり、浮動小数点数には独自の規則があります。そして、これは共通の特徴につながる必要がありました。 Zアドレスをデータ自体とは別に格納するという事実により、キーに対して任意の変換を実行できます。主なことは、ソート順を維持することです。これは、単純なビットごとの操作を使用して行うことができます。たとえば、符号付き整数の場合、上位バイトを単純に反転できます。他のタイプについては、少し複雑ですが、同様の変換があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての数値タイプは8バイトに収まるため、結果のキーはN * 8バイトのサイズになります。ここで、Nはスペースの次元です。文字列をどうするか</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
文字列を操作するときのかなり一般的な状況は、プレフィックス検索です。そして、サポートすることはかなり可能です。文字列の最初の8バイトはキーとして使用できます。文字列が短い場合は、ゼロで埋めることができます。文字列のサポートは、インデックスに基本的な制限を課します。一意性が失われます。行が9番目のバイトで異なる場合でも、システムの観点からは同じです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードを見てみましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インデックスAPIは、特定のメソッドセットで構成されています。それぞれ個別に検討するのではなく、最も基本的なもの、つまり検索と挿入の操作のみを実行します。</font></font><br>
<br>
<code>get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-フルキーでアイテムを検索します。一意のインデックスに対してのみ機能します。インデックスを一意にすることはできないため、関数は「サポートされていないインデックス機能」のエラーを返す特別な汎用バージョンに置き換えられます。</font></font><br>
<br>
<code>replace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-アイテムを挿入します。さらに詳しく考えてみましょう。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span>
<span class="hljs-title">memtx_zcurve_index_replace</span><span class="hljs-params">(struct index *base, struct tuple *old_tuple,
        struct tuple *new_tuple, <span class="hljs-keyword">enum</span> dup_replace_mode mode,
        struct tuple **result)</span>
</span>{<font></font>
    (<span class="hljs-keyword">void</span>)mode;
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">memtx_zcurve_index</span> *<span class="hljs-title">index</span> = (<span class="hljs-title">struct</span> <span class="hljs-title">memtx_zcurve_index</span> *)<span class="hljs-title">base</span>;</span>
    <span class="hljs-keyword">if</span> (new_tuple) {
        <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">memtx_zcurve_data</span> <span class="hljs-title">new_data</span>;</span><font></font>
        new_data.tuple = new_tuple;<font></font>
        new_data.z_address = extract_zaddress(new_tuple,<font></font>
                &amp;index-&gt;bit_array_pool, index);<font></font>
        <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">memtx_zcurve_data</span> <span class="hljs-title">dup_data</span>;</span>
        dup_data.tuple = <span class="hljs-literal">NULL</span>;<font></font>
        dup_data.z_address = <span class="hljs-literal">NULL</span>;<font></font>
<font></font>
        <span class="hljs-keyword">int</span> tree_res = memtx_zcurve_insert(&amp;index-&gt;tree, new_data,<font></font>
                &amp;dup_data);<font></font>
        <span class="hljs-keyword">if</span> (tree_res) {<font></font>
            diag_set(OutOfMemory, MEMTX_EXTENT_SIZE,<font></font>
                     <span class="hljs-string">"memtx_zcurve_index"</span>, <span class="hljs-string">"replace"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (dup_data.tuple != <span class="hljs-literal">NULL</span>) {<font></font>
            *result = dup_data.tuple;<font></font>
            z_value_free(&amp;index-&gt;bit_array_pool, dup_data.z_address);<font></font>
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (old_tuple) {
        <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">memtx_zcurve_data</span> <span class="hljs-title">old_data</span>, <span class="hljs-title">deleted_value</span>;</span><font></font>
        old_data.tuple = old_tuple;<font></font>
        old_data.z_address = extract_zaddress(old_tuple,<font></font>
                &amp;index-&gt;bit_array_pool, index);<font></font>
        memtx_zcurve_delete_value(&amp;index-&gt;tree, old_data, &amp;deleted_value);<font></font>
        z_value_free(&amp;index-&gt;bit_array_pool, old_data.z_address);<font></font>
        z_value_free(&amp;index-&gt;bit_array_pool, deleted_value.z_address);<font></font>
    }<font></font>
    *result = old_tuple;<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何に注意すべきですか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
指標の面で、そこには取引がなかった</font></font><code>update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>delete</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>insert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>replace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これらのロジックはすべて、このメソッドで実行されます。このメソッドは、古いタプルと新しいタプル、および</font></font><code>mode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インデックスが一意かどうかに関する情報</font><font style="vertical-align: inherit;">を受け取り</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">インデックスを一意にすることはできないため、追加のチェックは必要なく、タプルをすぐに挿入できます。</font></font><br>
<br>
<code>memtx_zcurve_insert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><code>memtx_zcurve_delete_value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-Bツリーメソッド。Tarantoolですでに実装されており、通常のTREEインデックスで使用されます。</font><font style="vertical-align: inherit;">それらについて個別に説明することはありません。</font><font style="vertical-align: inherit;">通常のツリーとは異なり、タプルだけでなくZアドレス（インデックス付き部分の混合ビット）も格納します。</font><font style="vertical-align: inherit;">関数がこれを担当します</font></font><code>extract_zadress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<code>create_iterator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-Luaから、</font></font><code>select</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'aおよび</font></font><code>pairs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'そして。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> struct iterator *
<span class="hljs-title">memtx_zcurve_index_create_iterator</span><span class="hljs-params">(struct index *base, <span class="hljs-keyword">enum</span> iterator_type type,
                                   <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *key, <span class="hljs-keyword">uint32_t</span> part_count)</span>
</span>{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">memtx_zcurve_index</span> *<span class="hljs-title">index</span> = (<span class="hljs-title">struct</span> <span class="hljs-title">memtx_zcurve_index</span> *)<span class="hljs-title">base</span>;</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">memtx_engine</span> *<span class="hljs-title">memtx</span> = (<span class="hljs-title">struct</span> <span class="hljs-title">memtx_engine</span> *)<span class="hljs-title">base</span>-&gt;<span class="hljs-title">engine</span>;</span><font></font>
<font></font>
    assert(part_count == <span class="hljs-number">0</span> || key != <span class="hljs-literal">NULL</span>);
    <span class="hljs-keyword">if</span> (type != ITER_EQ &amp;&amp; type != ITER_ALL &amp;&amp; type != ITER_GE) {<font></font>
        diag_set(UnsupportedIndexFeature, base-&gt;def,<font></font>
                 <span class="hljs-string">"requested iterator type"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">uint8_t</span> index_dim = base-&gt;def-&gt;key_def-&gt;part_count;
    <span class="hljs-keyword">if</span> (part_count == <span class="hljs-number">0</span>) {
        <span class="hljs-comment">/*
         * If no key is specified, downgrade equality
         * iterators to a full range.
         */</span><font></font>
        type = ITER_GE;<font></font>
        key = <span class="hljs-literal">NULL</span>;<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (index_dim * <span class="hljs-number">2</span> == part_count<font></font>
               &amp;&amp; type != ITER_ALL) {<font></font>
        <span class="hljs-comment">/*
         * If part_count is twice greater than key_def.part_count
         * set iterator to range query
         */</span><font></font>
        type = ITER_GE;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tree_iterator</span> *<span class="hljs-title">it</span> = <span class="hljs-title">mempool_alloc</span>(&amp;<span class="hljs-title">memtx</span>-&gt;<span class="hljs-title">zcurve_iterator_pool</span>);</span>
    <span class="hljs-keyword">if</span> (it == <span class="hljs-literal">NULL</span>) {<font></font>
        diag_set(OutOfMemory, <span class="hljs-keyword">sizeof</span>(struct tree_iterator),
                 <span class="hljs-string">"memtx_zcurve_index"</span>, <span class="hljs-string">"iterator"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<font></font>
    }<font></font>
<font></font>
    iterator_create(&amp;it-&gt;base, base);<font></font>
    it-&gt;pool = &amp;memtx-&gt;zcurve_iterator_pool;<font></font>
    it-&gt;base.next = tree_iterator_start;<font></font>
    it-&gt;base.<span class="hljs-built_in">free</span> = tree_iterator_free;<font></font>
    it-&gt;type = type;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (part_count == <span class="hljs-number">0</span> || type == ITER_ALL) {<font></font>
        it-&gt;lower_bound = zeros(&amp;index-&gt;bit_array_pool, index_dim);<font></font>
        it-&gt;upper_bound = ones(&amp;index-&gt;bit_array_pool, index_dim);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type == ITER_EQ) {<font></font>
        it-&gt;lower_bound = mp_decode_key(&amp;index-&gt;bit_array_pool,<font></font>
                key, index_dim, index);<font></font>
        it-&gt;upper_bound = <span class="hljs-literal">NULL</span>;<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (base-&gt;def-&gt;key_def-&gt;part_count == part_count) {<font></font>
        it-&gt;lower_bound = mp_decode_key(&amp;index-&gt;bit_array_pool,<font></font>
                key, index_dim, index);<font></font>
        it-&gt;upper_bound = ones(&amp;index-&gt;bit_array_pool, index_dim);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (base-&gt;def-&gt;key_def-&gt;part_count * <span class="hljs-number">2</span> == part_count) {<font></font>
        it-&gt;lower_bound  = z_value_create(&amp;index-&gt;bit_array_pool, index_dim);<font></font>
        it-&gt;upper_bound  = z_value_create(&amp;index-&gt;bit_array_pool, index_dim);<font></font>
        mp_decode_part(key, part_count, index, it-&gt;lower_bound, it-&gt;upper_bound);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        unreachable();<font></font>
    }<font></font>
    it-&gt;tree_iterator = memtx_zcurve_invalid_iterator();<font></font>
    it-&gt;current.tuple = <span class="hljs-literal">NULL</span>;<font></font>
    it-&gt;current.z_address = <span class="hljs-literal">NULL</span>;
    <span class="hljs-keyword">return</span> (struct iterator *)it;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
送信されたキーに応じて、リクエストの下限と上限を計算します。</font><font style="vertical-align: inherit;">ただし、これまでのところ、この反復子は何も指していません。</font><font style="vertical-align: inherit;">イテレータには全部でいくつかのタイプがあります。</font><font style="vertical-align: inherit;">私たちの場合、これはすべてです-すべての要素を取得します。</font><font style="vertical-align: inherit;">EQ-Zアドレスが送信されたものと一致する受信要素。</font><font style="vertical-align: inherit;">GEは、ハイパーキューブ内の要素の選択です。</font></font><br>
<br>
<code>destroy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-インデックスの削除。</font><font style="vertical-align: inherit;">セカンダリインデックスの場合、検索構造に割り当てられたメモリを解放するだけです。</font><font style="vertical-align: inherit;">そして、インデックスがプライマリの場合、格納されたタプルを物理的に削除します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのコードは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">//github.com/olegrok/tarantool/tree/z-order-curve-indexで</font></a><font style="vertical-align: inherit;">入手できます</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。何が起こったかを見て、要約してみましょう。</font></font><br>
<br>
<pre><code class="lua hljs">space = box.schema.space.<span class="hljs-built_in">create</span>(<span class="hljs-string">'myspace'</span>, { engine = <span class="hljs-string">'memtx'</span> })<font></font>
pk = space:create_index(<span class="hljs-string">'primary'</span>, { <span class="hljs-built_in">type</span> = <span class="hljs-string">'tree'</span>, parts = {{<span class="hljs-number">1</span>, <span class="hljs-string">'unsigned'</span>}}, unique = <span class="hljs-literal">true</span>})<font></font>
sk = space:create_index(<span class="hljs-string">'secondary'</span>, { <span class="hljs-built_in">type</span> = <span class="hljs-string">'zcurve'</span>, parts = {{<span class="hljs-number">2</span>, <span class="hljs-string">'unsigned'</span>}, {<span class="hljs-number">3</span>, <span class="hljs-string">'unsigned'</span>}}})
<span class="hljs-keyword">for</span> i=<span class="hljs-number">0</span>,<span class="hljs-number">5</span> <span class="hljs-keyword">do</span> <span class="hljs-keyword">for</span> j=<span class="hljs-number">0</span>,<span class="hljs-number">5</span> <span class="hljs-keyword">do</span> space:<span class="hljs-built_in">insert</span>{i * <span class="hljs-number">6</span> + j, i, j} <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span>
<span class="hljs-comment">-- returns all tuples</span>
pk:<span class="hljs-built_in">select</span>{}
<span class="hljs-comment">-- (2 &lt;= x &lt;= 3) and (3 &lt;= y &lt;= 5)</span>
sk:<span class="hljs-built_in">select</span>{<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>}
<span class="hljs-comment">---</span>
- — [<span class="hljs-number">15</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<font></font>
  - [<span class="hljs-number">21</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>]<font></font>
  - [<span class="hljs-number">16</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>]<font></font>
  - [<span class="hljs-number">22</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]<font></font>
  - [<span class="hljs-number">17</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>]<font></font>
  - [<span class="hljs-number">23</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>]<font></font>
…<font></font>
<span class="hljs-comment">-- (x == 2) and (y == 3)</span>
sk:<span class="hljs-built_in">select</span>{<span class="hljs-number">2</span>, <span class="hljs-number">3</span>}
<span class="hljs-comment">---</span>
- — [<span class="hljs-number">15</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]
<span class="hljs-comment">-- (2 &lt;= x &lt;= 3)</span>
sk:<span class="hljs-built_in">select</span>({<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, box.NULL, box.NULL})
<span class="hljs-comment">---</span>
- — [<span class="hljs-number">12</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>]<font></font>
  - [<span class="hljs-number">18</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>]<font></font>
  - [<span class="hljs-number">13</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>]<font></font>
  - [<span class="hljs-number">19</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>]<font></font>
  - [<span class="hljs-number">14</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>]<font></font>
  - [<span class="hljs-number">20</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]<font></font>
  - [<span class="hljs-number">15</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<font></font>
  - [<span class="hljs-number">21</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>]<font></font>
  - [<span class="hljs-number">16</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>]<font></font>
  - [<span class="hljs-number">22</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]<font></font>
  - [<span class="hljs-number">17</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>]<font></font>
  - [<span class="hljs-number">23</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>]<font></font>
...<font></font>
<span class="hljs-comment">-- (x &gt;= 2) and (y &gt;= 3)</span>
sk:<span class="hljs-built_in">select</span>({<span class="hljs-number">2</span>, box.NULL, <span class="hljs-number">3</span>, box.NULL})
<span class="hljs-comment">---</span>
- — [<span class="hljs-number">15</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<font></font>
  - [<span class="hljs-number">21</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>]<font></font>
  - [<span class="hljs-number">27</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>]<font></font>
  - [<span class="hljs-number">33</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>]<font></font>
  - [<span class="hljs-number">16</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>]<font></font>
  - [<span class="hljs-number">22</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]<font></font>
  - [<span class="hljs-number">17</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>]<font></font>
  - [<span class="hljs-number">23</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>]<font></font>
  - [<span class="hljs-number">28</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>]<font></font>
  - [<span class="hljs-number">34</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>]<font></font>
  - [<span class="hljs-number">29</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]<font></font>
  - [<span class="hljs-number">35</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>]<font></font>
...</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パフォーマンスはどうですか？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが私が説明したほどバラ色ではないことがわかりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ある時点から、データアクセス速度の点でZオーダーカーブが大幅に低下し始めます。 perf topは、ほとんどの時間は、ポイントが検索領域に属していることを確認し、ジャンプする必要がある次のポイントを計算することに費やされていることを示しました。どちらの操作も、キーの長さに応じて複雑さが線形になります。次元が増えると、長さも長くなります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/70e/338/fd1/70e338fd15af8701c3a5696ebfb3ea2a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
快適-メモリ消費量が2〜3倍少なく、挿入はRツリーよりもわずかに高速です。</font><font style="vertical-align: inherit;">WALをオフにして測定を行ったため、これは特に関係ありません。</font><font style="vertical-align: inherit;">まず、本番環境では、障害が発生した場合、WALを無効にするとデータが失われる可能性があります。</font><font style="vertical-align: inherit;">第2に、WALへの書き込みはバッチアプローチを使用しているという事実にもかかわらず、RAMでの作業よりも数千倍遅いディスクへの書き込みです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ee/e73/e29/9eee73e29d809963c069a9f7414f524a.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2c0/8b9/159/2c08b91598dbefe2855ede4d05a593ca.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bツリーと比較することも興味深いです。</font><font style="vertical-align: inherit;">ここでは、予想どおり、カーブはフルスキャンよりも速く、特定の領域に属しているかどうか各ポイントをチェックします。</font><font style="vertical-align: inherit;">チェックは、すべてがビットごとの比較に帰着するZオーダーカーブの場合よりも軽量です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グラフの数値は、Rツリーとは順番が異なります。テストは少し変更されています。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/140/ae5/44d/140ae544d6ba527bffe6bc4d814f609d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストでは、一連のポイントを生成し、Zカーブと従来のスキャンを使用してクエリの期間を比較しました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要約する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インメモリの世界では、この構造は最善の方法ではないことが証明されていますが、それでも利点があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">省スペース。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R-Tree（Tarantoolにのみ関連）とは異なり、型付き。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bツリーのみがあり、多次元クエリを実行する必要がある場合は、詳細に検討する価値があります（Tarantoolには関係ありません）。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
面白い実験でした。</font><font style="vertical-align: inherit;">私が提案したソリューションがTarantoolの一部になる可能性はほとんどありません。</font><font style="vertical-align: inherit;">ただし、実験することを恐れないでください。</font><font style="vertical-align: inherit;">また、提案や解決策がある場合は、恐れずに共有してください。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出典</font></font></h2><br>
<a name="B-Tree"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[Bツリー]：</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQLのインデックス-4 / Postgres Professionalブログ/ Habr </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bツリー/ Habr </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bツリーデータ構造/ OTUSブログ。</font><font style="vertical-align: inherit;">オンライン教育/オタク誌</font></font></a><br>
<br>
<a name="ZcurvePostgres"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ZcurvePostgres]：</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZオーダーとRツリーについて/オタクマガジン</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zオーダーvs Rツリー、続き/オタクマガジン</font></font></a><br>
<br>
<a name="1"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[1] </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazon DynamoDBでの多面的クエリのZオーダーインデックス作成：パート1 | </font><font style="vertical-align: inherit;">AWSデータベースブログ</font></font></a><br>
<br>
<a name="1"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[2] </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazon DynamoDBでの多面的なクエリのZオーダーのインデックス作成：パート2 | </font><font style="vertical-align: inherit;">AWSデータベースブログ</font></font></a><br>
<br>
<a name="3"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[3] </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UBツリーをデータベースシステムカーネルに統合する</font></font></a><br>
<br>
<a name="4"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[4] </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/tarantool/small</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja505850/index.html">製品コードのC ++概念ベースのポリモーフィズム：LLVMのPassManager</a></li>
<li><a href="../ja505856/index.html">ブルートフォースからプライバシーの試みへ-SaaSプロバイダーが直面するもの</a></li>
<li><a href="../ja505860/index.html">初心者向けのSpring Boot、Hibernate、Kotlinの手順</a></li>
<li><a href="../ja505870/index.html">日本、韓国、中国でのモバイルゲームとアプリケーションの宣伝方法</a></li>
<li><a href="../ja505872/index.html">無人車両の歴史</a></li>
<li><a href="../ja505884/index.html">スピアフィッシング：フィッシングメール用の条件付きで悪意のある実行可能ファイルの作成経験</a></li>
<li><a href="../ja505888/index.html">アップロードされたデータを含む、YouTube APIなしのYouTubeの解析</a></li>
<li><a href="../ja505896/index.html">Security Week 24：Zoom and Braveブラウザーのプライバシー</a></li>
<li><a href="../ja505898/index.html">クロードシャノン：すべての取引のジャック、ジョーカー、情報理論の父</a></li>
<li><a href="../ja505900/index.html">個人的な依存症：フルサイズの40 mm、ワイヤーなし、72時間8000ルーブル</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>