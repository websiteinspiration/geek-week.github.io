<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👹 👆🏼 👸🏻 Yandex.Maps：私はカードコントローラに行きました-私はすぐにユーザーの位置を取得しました（大丈夫、今は真剣に） 👕 🗝️ 👨🏼‍✈️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="再びご挨拶！
 
 最近、私は文字通りYandex.Mapsへの愛情に満ちた記事を公開しました。ポエム。おで ここで、実際には、彼女はhabr.com/en/post/479102です。
 
 プログラマーの間で詩の愛好家がほとんどいないことを確認したにもかかわらず、私はそれでも「KhABRのスタイ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Yandex.Maps：私はカードコントローラに行きました-私はすぐにユーザーの位置を取得しました（大丈夫、今は真剣に）</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479432/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再びご挨拶！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最近、私は文字通りYandex.Mapsへの愛情に満ちた記事を公開しました。</font><font style="vertical-align: inherit;">ポエム。</font><font style="vertical-align: inherit;">おで </font><font style="vertical-align: inherit;">ここで、実際には、彼女は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr.com/en/post/479102です。</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
プログラマーの間で詩の愛好家がほとんどいないことを確認したにもかかわらず、私はそれでも「KhABRのスタイルで」状況をさらに詳しく説明することにしました。</font><font style="vertical-align: inherit;">たくさんのコード、考え、スクリーンショットをキャッチしてください。</font><font style="vertical-align: inherit;">行け。</font></font><br>
 <br>
<img src="https://habrastorage.org/getpro/habr/post_images/c36/cfb/219/c36cfb21967c60f0ee4a932e7e60dc43.jpg" alt="画像"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初からやり直してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タスクは簡単です。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カードを使用してコントローラーに入ると、すぐにユーザーのポイントまで「ズームアウト」する必要があります（ボーナス：利用可能なすべての帰納とともに、読み取り可能な形式でアドレスを取得する必要もあります）。</font></font></b><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナリストは「分割して征服する」と断言しました。</font></font></u><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
この目標を達成するには、次のような技術的およびビジネス上のいくつかの問題を解決する必要があり</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. IWGS </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 1.1 IWGS </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 1.2を</font><font style="vertical-align: inherit;">実装するIWGS </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 1.2.1を</font><font style="vertical-align: inherit;">起動</font><font style="vertical-align: inherit;">するユーザーの座標を取得する</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 1.2.2 </font><font style="vertical-align: inherit;">ユーザーを</font><font style="vertical-align: inherit;">確認する</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 *。読み取り可能な形式で位置アドレスを取得します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コントローラーへの切り替え（VIPER + Configurator）</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">AddPresenter</span>: <span class="hljs-title">AddPresentationLogic</span> </span>{
    <span class="hljs-comment">// ...</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">openMap</span><span class="hljs-params">(<span class="hljs-number">_</span> delegate: YandexMapSetPointViewControllerProtocol?)</span></span> { <font></font>
          router.routeTo(target: .addPlace(delegate)) <font></font>
    }<font></font>
    <span class="hljs-comment">// ...</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デリゲートには関数が1つしかないため、目的のポイントを指定すると、プロトコルを介して、カードを使用してコントローラーを呼び出すコントローラーに返すことができます。</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">YandexMapSetPointViewControllerProtocol</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">didSelectPoint</span><span class="hljs-params">(<span class="hljs-number">_</span> place: Place)</span></span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デリゲートに、呼び出しコードの制御部分を送信します。ここではすべてが明確です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、簡単な方法でコントローラーに切り替えます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zx/7v/yu/zx7vyupurluv41qjgddrpsseehk.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
中央</font><font style="vertical-align: inherit;">の</font><font style="vertical-align: inherit;">十字線は、コントローラーの中央とUIViewカードの中央に正確に配置されています。マップ内のズームがデフォルトでウィンドウの中央で機能するとの想定。そして、それは判明しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
左と十字線のすぐ下-UILabel。そこに判読可能な住所を表示する予定です。 UIActivityIndi​​catorがある右ボタン。ポイントは、ユーザーの座標に到達するまで「回転」し、ボタンが暗くなって無効になることです。受け取ったユーザーの座標のボタンをクリックすると、十字線がユーザーに返されます。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これは、ユーザーの位置から始まる位置の指標です。</font></font></b> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
下部にあるのは[ポイントを選択]ボタンです。クリックすると、ビジネスロジックの魔法が発生します。</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-meta">@IBAction</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">selectButtonWasPressed</span><span class="hljs-params">(<span class="hljs-number">_</span> sender: <span class="hljs-keyword">Any</span>)</span></span> {
        <span class="hljs-keyword">let</span> place = <span class="hljs-type">Place</span>()<font></font>
        place.name = <span class="hljs-string">" "</span>
        place.point.latitude = <span class="hljs-string">"\(String(describing: selectedPoint!.latitude))"</span>
        place.point.longitude = <span class="hljs-string">"\(String(describing: selectedPoint!.longitude))"</span><font></font>
        place.addressText = selectedPointGeocoderedAddress<font></font>
        <font></font>
        delegate?.didSelectPoint(place)<font></font>
        navigationController?.popViewController(animated: <span class="hljs-literal">true</span>)<font></font>
    }<font></font>
</code></pre><br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">やったー！</font><font style="vertical-align: inherit;">準備段階について話し合いました！</font></font></u> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MRSGに進みます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下は反映テーブル形式のテキストである</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私の個人的な評価を</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私は知りませんでした、その時点で最も有名なの（あいまいの要素を持つ）（</font></font><u><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.openstreetmap.org</font></font></a></i></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、おかげで、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ダグロブ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）組み込みカードモジュール。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qx/sa/mv/qxsamvrveuo9d9cnrk_0cc9x73e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「タスクは単純なので、私はYandex.Mapsを使用します。彼らは美しく、機敏です...」と私は思いました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
誰もがこれを設定する方法に興味がある場合は、ミニプロジェクトを作成しますが</font><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">怠惰な場合は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-tech.yandex.ru/maps/mapkit/?from=mapsapi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、私のパスを追跡してください。始めるのは簡単です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
事実は、ドキュメントがこの形式で提示されているということです：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7s/zu/aa/7szuaaqboitjjfwfa7rib56wcfg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
左側のわずかな説明とオブジェクトの膨大なリストに注意してください。くそっと足を折る。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「おそらくテストプロジェクトが私の質問に答えてくれるでしょう。」しかたがない。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これがこの獣です。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/yandex/mapkit-ios-demo</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ささいなタスクの解決策がそこにありませんでした。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -わかりました、私は思います-私が開発者でなければ、十分な経験があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dl/-h/7t/dl-h7tjvei8fgovgu0ztbcx6eyy.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はテストプロジェクトを組み立て、ユーザーのマーカーをカスタマイズする機能を長い間見てきました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キーポイント：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オブジェクトがあります：</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-meta">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> mapView: <span class="hljs-type">YMKMapView!</span> <span class="hljs-comment">//  YMKUserLocationObjectListener - ,  </span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「すべてが論理的なようです」とあなたは言う。</font><font style="vertical-align: inherit;">しかし、違います。</font><font style="vertical-align: inherit;">代替方法：</font></font><br>
<br>
<pre><code class="swift hljs">    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">onObjectAdded</span><span class="hljs-params">(with view: YMKUserLocationView)</span></span> {}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">onObjectRemoved</span><span class="hljs-params">(with view: YMKUserLocationView)</span></span> {}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">onObjectUpdated</span><span class="hljs-params">(with view: YMKUserLocationView, event: YMKObjectEvent)</span></span> {}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
非常に難しい方法でpoint.latおよびpoint.longに到達する機会を得ます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、次のようになります。</font></font><br>
<br>
<pre><code class="swift hljs">userLocation = <span class="hljs-type">YMKPoint</span>(latitude: view.pin.geometry.latitude, longitude: view.pin.geometry.longitude)</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
座標のロードの待機時間は、このアプローチによって2〜50秒で異なります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「あなたは間違っている。集中したLocationManagerがなければならない」と私は自分に言い聞かせた。後で判明したように、実際、そのような「友達」はドキュメントにあります...しかし、彼の例はどこにありますか？！？</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サンプルプロジェクトでは、そのようなマネージャーの使用例はありません</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pw/ok/fi/pwokfiikcpwl70dbvsixdmnedxi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 。-まあ、ドキュメンテーション、あなたと私だけが残ります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -はい、問題はありません。「イノベーター」でお楽しみください</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6f/ze/hl/6fzehl2usa1mxgciyziz6h3rl1u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。UIViewControllerをプロトコルにサブスクライブします（他に何も説明する必要がないことを願っています）。</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-comment">// MARK: -</span>
<span class="hljs-comment">// Params</span>
<span class="hljs-keyword">var</span> userLocation: <span class="hljs-type">YMKPoint?</span> {
        <span class="hljs-keyword">didSet</span> {
            <span class="hljs-keyword">guard</span> userLocation != <span class="hljs-literal">nil</span> &amp;&amp; userLocation?.latitude != <span class="hljs-number">0</span> &amp;&amp; userLocation?.longitude != <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }<font></font>
            <font></font>
            <span class="hljs-keyword">if</span> isItFirstSelection {<font></font>
                isItFirstSelection = <span class="hljs-literal">false</span><font></font>
                selectedPoint = userLocation<font></font>
                <font></font>
                mapView.mapWindow.<span class="hljs-built_in">map</span>.move(<font></font>
                    with: <span class="hljs-type">YMKCameraPosition</span>.<span class="hljs-keyword">init</span>(target: userLocation!, zoom: <span class="hljs-number">16</span>, azimuth: <span class="hljs-number">0</span>, tilt: <span class="hljs-number">0</span>),<font></font>
                    animationType: <span class="hljs-type">YMKAnimation</span>(type: <span class="hljs-type">YMKAnimationType</span>.smooth, duration: <span class="hljs-number">1</span>),<font></font>
                    cameraCallback: <span class="hljs-literal">nil</span>)<font></font>
            }<font></font>
            <font></font>
            activityIndicator.stopAnimating()<font></font>
        }<font></font>
    }<font></font>
<font></font>
<span class="hljs-comment">// MARK: -</span>
<span class="hljs-comment">// Some like didLoad</span><font></font>
setupLocationManager()<font></font>
<font></font>
<span class="hljs-comment">// MARK: -</span>
<span class="hljs-comment">// Setup</span>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">setupLocationManager</span><span class="hljs-params">()</span></span> {<font></font>
        locationManager = <span class="hljs-type">YMKMapKit</span>.sharedInstance()!.createLocationManager()<font></font>
        locationManager.subscribeForLocationUpdates(withDesiredAccuracy: <span class="hljs-number">0</span>, minTime: <span class="hljs-number">10</span>, minDistance: <span class="hljs-number">0</span>, allowUseInBackground: <span class="hljs-literal">true</span>, filteringMode: .on, locationListener: <span class="hljs-keyword">self</span>)<font></font>
        <font></font>
    }<font></font>
<font></font>
<span class="hljs-comment">// MARK: -</span>
<span class="hljs-comment">// MARK: YMKLocationDelegate</span>
<span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">YandexMapSetPointViewController</span>: <span class="hljs-title">YMKLocationDelegate</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">onLocationUpdated</span><span class="hljs-params">(with location: YMKLocation)</span></span> {<font></font>
        userLocation = <span class="hljs-type">YMKPoint</span>(latitude: location.position.latitude, longitude: location.position.longitude)<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">onLocationStatusUpdated</span><span class="hljs-params">(with status: YMKLocationStatus)</span></span> {}<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして... </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vy/se/rx/vyserx968bbz28plbyag_jc-mmk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1-15秒、CARL！ 15！時にはそれは前のオプションをより速くうまくいきます！どう？</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yandex、なんて冗談？すべてを試し、そのような結果を得るために費やす時間は非常に長いのですが、一般的には悲しいことです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は思った、思った...まあ、実際には同じではありません。人にカードを持ったコントローラーを与え、それを4秒以上切り替えたときにそれを昏迷に入れてください。これはアプリケーションにとって自殺です。これが快適であると完全に確信して5秒以上待つことはできません（私を信じていない場合は、UI / UXに関するVitaliy Fridmanのレポートを聞いてください）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はもっ​​と考えました...そして次の感情はこれでした：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-8/f_/wb/-8f_wbwxosvigxvw_qu905rrpla.gif"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">誰が音を望んでいます</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-www.youtube.com/watch?v=pTZaNHZGsQo</font></font></a></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
成功の秘訣はこれでした：</font><s><font style="vertical-align: inherit;">キロを</font></s></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
取る</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CLLocationManagerとYMKLocationManagerおよび...は、それらを連携させます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zu/qt/b9/zuqtb90bcok18z_qs7pw1zxd88g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このジョイント...「作業」は次のようになります。</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-comment">// Params</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> locationManager: <span class="hljs-type">YMKLocationManager!</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> nativeLocationManager = <span class="hljs-type">CLLocationManager</span>()<font></font>
<font></font>
<span class="hljs-comment">// MARK: -</span>
<span class="hljs-comment">// Some like didLoad</span><font></font>
setupNativeLocationManager()<font></font>
<font></font>
<span class="hljs-comment">// MARK: -</span>
<span class="hljs-comment">// Setup</span>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">setupNativeLocationManager</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">if</span> <span class="hljs-type">CLLocationManager</span>.locationServicesEnabled() {<font></font>
            nativeLocationManager.delegate = <span class="hljs-keyword">self</span><font></font>
            nativeLocationManager.desiredAccuracy = kCLLocationAccuracyNearestTenMeters<font></font>
            nativeLocationManager.startUpdatingLocation()<font></font>
        }<font></font>
    }<font></font>
<font></font>
<span class="hljs-comment">// MARK: -</span>
<span class="hljs-comment">// CLLocationManagerDelegate</span>
<span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">YandexMapSetPointViewController</span>: <span class="hljs-title">CLLocationManagerDelegate</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">locationManager</span><span class="hljs-params">(<span class="hljs-number">_</span> manager: CLLocationManager, didUpdateLocations locations: [CLLocation])</span></span> {<font></font>
        userLocation = <span class="hljs-type">YMKPoint</span>(latitude: locations.last!.coordinate.latitude, longitude: locations.last!.coordinate.longitude)<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<br>
<s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...そして、ピラフは準備ができ</font></font></s> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ていますユーザーのポイントを取得する速度の結果：0秒より少し長く。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（私の意見では）些細な問題を解決するときのまさにその場合、ネイティブ部分と埋め込み部分の間の対立は次のようになりました：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lk/we/ub/lkweublnp6onabh3cdpfigc5z-m.gif"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ジオコーダー*</font></font></b><div class="spoiler_text">     .<br>
   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">tech.yandex.ru/maps/geocoder</a><br>
<br>
<pre><code class="swift hljs"><span class="hljs-comment">// Params</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> geocoderManager = <span class="hljs-type">GeocoderManager</span>.shared<font></font>
<font></font>
<span class="hljs-comment">//      .    </span>
<span class="hljs-keyword">import</span> Foundation
<span class="hljs-keyword">import</span> Alamofire
<span class="hljs-keyword">import</span> Alamofire_SwiftyJSON
<span class="hljs-keyword">import</span> SwiftyJSON
<span class="hljs-keyword">import</span> PromiseKit
<span class="hljs-keyword">import</span> UIKit<font></font>
<font></font>
<span class="hljs-comment">// MARK: -</span>
<span class="hljs-comment">// MARK: GeocoderManager</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GeocoderManager</span> </span>{
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> shared = <span class="hljs-type">GeocoderManager</span>()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">init</span>() {}<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getAddressBy</span><span class="hljs-params">(latitude: String, longitude: String, completion: @escaping <span class="hljs-params">(Bool, String?, Error?)</span></span></span>-&gt;()) {
        <span class="hljs-type">GeocoderAPI</span>().request(latitude: latitude, longitude: longitude).done { (response) <span class="hljs-keyword">in</span>
            completion(<span class="hljs-literal">true</span>, response.getAddress(), <span class="hljs-literal">nil</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"success"</span>)<font></font>
        }.<span class="hljs-keyword">catch</span> { (error) <span class="hljs-keyword">in</span>
            completion(<span class="hljs-literal">false</span>, <span class="hljs-literal">nil</span>, error)<font></font>
        }<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// </span>
<span class="hljs-keyword">import</span> Foundation
<span class="hljs-keyword">import</span> Alamofire
<span class="hljs-keyword">import</span> PromiseKit<font></font>
<font></font>
<span class="hljs-comment">// MARK: -</span>
<span class="hljs-comment">// MARK: Request</span>
<span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">GeocoderRequest</span> </span>{
    <span class="hljs-keyword">case</span> addressRequest(<span class="hljs-type">String</span>, <span class="hljs-type">String</span>)<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// MARK: -</span>
<span class="hljs-comment">// MARK: GeocoderRequest</span>
<span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">GeocoderRequest</span>: <span class="hljs-title">DefaultRequest</span> </span>{
    <span class="hljs-keyword">var</span> path: <span class="hljs-type">String</span> {
        <span class="hljs-keyword">switch</span> <span class="hljs-keyword">self</span> {
        <span class="hljs-keyword">case</span> .addressRequest:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"1.x/"</span><font></font>
        }<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">var</span> method: <span class="hljs-type">HTTPMethod</span> {
        <span class="hljs-keyword">switch</span> <span class="hljs-keyword">self</span> {
        <span class="hljs-keyword">case</span> .addressRequest:
            <span class="hljs-keyword">return</span> .<span class="hljs-keyword">get</span><font></font>
        }<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">var</span> headers: <span class="hljs-type">HTTPHeaders</span> {
        <span class="hljs-keyword">return</span> [:]<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">var</span> parameters: [<span class="hljs-type">String</span>: <span class="hljs-type">Any</span>]? {
        <span class="hljs-keyword">switch</span> <span class="hljs-keyword">self</span> {
        <span class="hljs-keyword">case</span> .addressRequest(<span class="hljs-keyword">let</span> latitude, <span class="hljs-keyword">let</span> longitude):
            <span class="hljs-keyword">return</span> [
                <span class="hljs-string">"apikey"</span>    : <span class="hljs-type">Consts</span>.<span class="hljs-type">APIKeys</span>.yandexGeocoderKey,
                <span class="hljs-string">"format"</span>    : <span class="hljs-string">"json"</span>,
                <span class="hljs-string">"results"</span>   : <span class="hljs-number">1</span>,
                <span class="hljs-string">"spn"</span>       : <span class="hljs-string">"3.552069,2.400552"</span>,
                <span class="hljs-string">"geocode"</span>   : <span class="hljs-string">"\(longitude),\(latitude)"</span><font></font>
            ]<font></font>
        }<font></font>
    }<font></font>
    <font></font>
     <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">asURLRequest</span><span class="hljs-params">()</span></span> <span class="hljs-keyword">throws</span> -&gt; <span class="hljs-type">URLRequest</span> {
        <span class="hljs-keyword">let</span> url = <span class="hljs-keyword">try</span> <span class="hljs-type">GlobalConsts</span>.<span class="hljs-type">Links</span>.geocoderBaseURL.asURL()<span class="hljs-comment">// not good, need new idea for this</span>
        <span class="hljs-keyword">var</span> urlRequest = <span class="hljs-type">URLRequest</span>(url: url.appendingPathComponent(path))<font></font>
        urlRequest.httpMethod = method.rawValue<font></font>
        urlRequest.allHTTPHeaderFields = headers<font></font>
        <span class="hljs-keyword">switch</span> method {
        <span class="hljs-keyword">case</span> .<span class="hljs-keyword">get</span>:<font></font>
            urlRequest = <span class="hljs-keyword">try</span> <span class="hljs-type">URLEncoding</span>.<span class="hljs-keyword">default</span>.encode(urlRequest, with: parameters)
        <span class="hljs-keyword">case</span> .post:<font></font>
            urlRequest = <span class="hljs-keyword">try</span> <span class="hljs-type">JSONEncoding</span>.<span class="hljs-keyword">default</span>.encode(urlRequest, with: parameters)
        <span class="hljs-keyword">case</span> .put:<font></font>
            urlRequest = <span class="hljs-keyword">try</span> <span class="hljs-type">JSONEncoding</span>.<span class="hljs-keyword">default</span>.encode(urlRequest, with: parameters)
        <span class="hljs-keyword">case</span> .patch:<font></font>
            urlRequest = <span class="hljs-keyword">try</span> <span class="hljs-type">JSONEncoding</span>.<span class="hljs-keyword">default</span>.encode(urlRequest, with: parameters)
        <span class="hljs-keyword">case</span> .delete:<font></font>
            urlRequest = <span class="hljs-keyword">try</span> <span class="hljs-type">JSONEncoding</span>.<span class="hljs-keyword">default</span>.encode(urlRequest, with: parameters)
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">break</span><font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> urlRequest<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
          : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">app.quicktype.io</a></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作業の結果は視覚的に次のようになります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/co/19/u7/co19u7hvhmnhdr8r_bh2ek_nl9k.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記の要約：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同僚、記事は、同様の問題を解決するときに、私が費やしたほどの時間を費やさずに別の方法を選択するか、すばやく進むように書かれています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は建設的な批判および/または代替の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正しい</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解決策</font><font style="vertical-align: inherit;">を見たいの</font><font style="vertical-align: inherit;">ですが。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事があなたにとって有用であることが判明した場合は、Loisの評価で修正してください。できれば、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このストーリーのオリジナルバージョンを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しい方法で確認してください</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての創造的な成功と前向きな気分！</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja479420/index.html">オープンマイク：バックエンド。ゲスト登録</a></li>
<li><a href="../ja479422/index.html">[ビデオアニメーション]有線の世界：海底ケーブルのネットワークが35年間で地球をどのように包囲してきたか</a></li>
<li><a href="../ja479426/index.html">セキュリティウィーク50：ConfluenceおよびLinuxでの中間者攻撃</a></li>
<li><a href="../ja479428/index.html">12月9日から15日までのモスクワでのデジタルイベント</a></li>
<li><a href="../ja479430/index.html">12月9〜15日のサンクトペテルブルクでのデジタルイベント</a></li>
<li><a href="../ja479438/index.html">Postgres-Tuesday＃5：「PostgreSQLとKubernetes。CI / CD。テスト自動化»</a></li>
<li><a href="../ja479442/index.html">Alexey Savvateev：社会分割のゲーム理論モデル（+ nginx調査）</a></li>
<li><a href="../ja479446/index.html">車はすでにテストを読んでいる人よりも先です。しかし、彼らは彼らが読んだものを理解していますか？</a></li>
<li><a href="../ja479450/index.html">AppCode 2019.3：より速く動作し、Swiftをよりよく理解し、Mac Catalystについて理解し、アセンブリメッセージを便利に表示します</a></li>
<li><a href="../ja479452/index.html">ドメインネームシステムの開発方法：ARPANET時代</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>