<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🗼 ⚰️ 😰 Smart Home ohne Fernbedienungen, aber mit einem Würfel 🌓 🕡 🧣</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Problem
 
 

Während der Reparatur einer neuen Wohnung kehrte ich in die Wohnung zurück, in der ich 10 Jahre nicht gelebt hatte, und beschloss, die Di...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Smart Home ohne Fernbedienungen, aber mit einem Würfel</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496856/"><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problem</font></font></h3><br>
 <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f01/d76/558/f01d76558d836eb09b9838514b61dc61.jpg"></div><br>
 <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Während der Reparatur einer neuen Wohnung kehrte ich in die Wohnung zurück, in der ich 10 Jahre nicht gelebt hatte, und beschloss, die Disziplin „Smart Home“ zu praktizieren, um eine neue Wohnung kompetent auszustatten. Die Ausstattung in dieser Wohnung ist auch nicht die intelligenteste und nicht die neueste, da sie vor ~ 10 Jahren hergestellt wurde. Vor allem in der Wohnung störte mich die Fülle an Infrarotfernbedienungen, sie gingen verloren und belasteten das Gehirn mit der Auswahl der richtigen. Bis vor kurzem wurde beschlossen, eine große Anzahl nicht verwendeter Tasten auf den Fernbedienungen zu verwenden. Und die Konsolen sind weder ästhetisch noch hygienisch, einige sind eckig, andere mit abgerundeten Kanten, die Knöpfe werden gelb, und die Überreste des Lebens der Bewohner, auf denen sich eine „Subknopf-Biozönose“ bildet, sammeln sich in ihnen an. Infolgedessen sind ein Dutzend Fernbedienungen mit unnötigen Knöpfen im ganzen Haus verteilt. Für einfache Operationen musste ich nach zwei oder drei Teilen suchen, deren Aussehen meine Augen kratzt.Ich wollte eine komfortable taktile und modische Sprachsteuerung.</font></font></p><a name="habracut"></a><br>
<h3></h3><br>
 <p>          ,         .             .     xiaomi          Xiaomi universal IR remotecontroller  Xiaomi Mi Smart Home Magic Cube,         Xiaomi smart home gateway 2</p><br>
<img src="https://habrastorage.org/getpro/habr/post_images/99d/4d4/062/99d4d4062e0b4e751d8cbd5daee9c4e7.jpg" width="300"><br>
<br>
<h3></h3><br>
 <p>    ,  ,   IR ,    — ZigBee .  ,  , .</p> <br>
 <p>      ,      ,       xiaomi,  ,              Mi Home    “”.   ,           ,   .   ,                   .   ,                  ,    ( )      Mi Home 10        5    ,    30     10 ,       ,  ,    1      ,   .   ,   ...</p><br>
 <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Problem aus China kommt nicht von alleine, außer dass die Bremsen reiben, weil es nicht mehr möglich ist, einen intelligenten Würfel an die Klangregelung zu schrauben.</font></font></p> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Würfel wird durch Gesten gesteuert: </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schütteln</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bewegen Sie sich in einem Flugzeug</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Drehen Sie um 90/180 Grad um die horizontale Achse</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um eine vertikale Achse drehen</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usw...</font></font></li>
</ul><br>
<img src="https://habrastorage.org/getpro/habr/post_images/04c/7f1/589/04c7f1589de5ab65448e3a5851900c42.png" width="500"><br>
<br>
<p>   —    ,    ,   ,             ,        ,   90     —    10 ,   45    —    5 .             ,      —       ZigBee,  -   ,     3     .</p><br>
<p>             Home Assistant,   ,   ,   Xiaomi    ,               ZigBee . Security token    IR            ,      Mi Home       .  xiaomi gateway   ,     UART RX/TX             Home Assistant.</p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Home Assistant selbst muss irgendwo gestartet werden. Synology DS718 + wurde unter dieser Aufgabe ausgeführt, die als DLNA Media Center und Torrent-Download verwendet wurde. </font><font style="vertical-align: inherit;">Dieses Gerät kann Docker-Container ausführen, und ein Container mit Home Assistant kann problemlos darin aufgewickelt werden. </font><font style="vertical-align: inherit;">Home Assistant ist cool, aber im Gegensatz zu Mi Home müssen Sie die ganze Schlauheit eines Hauses mit Stiften in Yaml schreiben. </font><font style="vertical-align: inherit;">Nachdem ich das DSL-Verständnis für Home Assistant beherrschte und mit einem anderen Programmierwerkzeug spuckte, für das keine PL-Kenntnisse erforderlich sind, gelang es mir, eine Krücke mit der gewünschten Form zuzubereiten.</font></font></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Automatisierungscode:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- id: volume_up</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  Alias: Lautstärke erhöhen</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  auslösen:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  - event_data:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      action_type: drehen</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      entity_id: binary_sensor.cube_0000000103ec74</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    event_type: xiaomi_aqara.cube_action</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    Plattform: Veranstaltung</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  Bedingung:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    Bedingung: Vorlage</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    value_template: "{{trigger.event.data.action_value&gt; 0}}"</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  Aktion:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  - service_template: "script.bbk_vol_up _ {{(trigger.event.data.action_value / 3) | int}}"</font></font></pre></blockquote><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diese Automatisierung erfasst das Rotationsereignis im Uhrzeigersinn und ruft ein Skript auf, in dessen Namen die Anzahl der Schallerhöhungssignale ersetzt wird, die der Infrarotsender senden soll. </font><font style="vertical-align: inherit;">Wie Sie wahrscheinlich erraten haben, erfordert jede Ecke der Rotation ein eigenes Skript, Copy-Paste wurde aufgerufen, um sie zu erstellen, und es gab mir 20 Skripte wie diese:</font></font></p><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bbk_vol_up_10:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  Reihenfolge:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  - Daten:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      Befehl:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      - bbk_vol_up</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      delay_secs: 0.04</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      num_repeats: 10</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    entity_id: remote.xiaomi_miio_192_168_2_62</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    service: remote.send_command</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Konfiguration des Emitters mit abgefangenen Signalen vom Lautsprecherfeld sieht folgendermaßen aus:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fernbedienung:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  - Plattform: xiaomi_miio</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    Host: 192.168.2.62</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    Token: 392cbed325e862ffff983c4575b7a6f2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    Befehle:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      bbk_power:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        Befehl: raw: nE5m0wlk0msxmEsmszmEsm0wAHKaABkAoQAcAL1MZtOQEFmM3ARMCHwCymM2m4ENgXEAioHlgy + AwoL3gvYAh4L0gGGEBYLCAL0BR4CHhU4A + wQ8</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      bbk_vol_up:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        Befehl: raw: nMwmUwlk0mk1mEsms3ADKbABlM5hLJtMAD2ALKazkAdgAymM3AYMBApjNgKTmgGLABuBD4IaAEKA1YJrgyuBDwJvgZeEx4C / geHMZsA4Yxxx</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      bbk_vol_down:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        Befehl: raw: nE5m0wlk0msxmEsmszmEsm0wAHKaABkAoQAcAL1MZtOQEFmM3ARMCHwIfAdQBFZuAQYFfAfuBCoHngveEx4C / gL + Cj4R2ANfLJqAYQUChU3</font></font></pre><br>
</blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hurra! </font><font style="vertical-align: inherit;">Der Ton steuert die Drehung des Würfels um die vertikale Achse, und das Fernsehgerät und die Lautsprecher werden eingeschaltet, indem der Würfel um 90 Grad um die horizontale Achse gedreht wird.</font></font><br>
<br>
<p> Home Assistant  ,        , Google Assistant   Home Assistant,     . GA     ,   .       ,           .        Ethernet ,        ,      IP       ,  IP     —  ,   .        custom_component  Home Assistant:</p><br>
<blockquote><pre>import logging<font></font>
from homeassistant.helpers.entity import Entity<font></font>
from pythonping import ping<font></font>
<font></font>
logger = logging.getLogger(__name__)<font></font>
<font></font>
def setup_platform(hass, config, add_entities, discovery_info=None):<font></font>
    entities = []<font></font>
    for name, ip in config['hosts'].items():<font></font>
        entities.append(IPSensor(name, ip))<font></font>
<font></font>
    add_entities(entities)<font></font>
<font></font>
class IPSensor(Entity):<font></font>
    def __init__(self, name, ip):<font></font>
        self._name = name<font></font>
        self._ip = ip<font></font>
        self._state = None<font></font>
        self._is_on = None<font></font>
<font></font>
    @property<font></font>
    def name(self):<font></font>
        return self._name<font></font>
<font></font>
    @property<font></font>
    def state(self):<font></font>
        return self._state<font></font>
<font></font>
    @property<font></font>
    def state_attributes(self):<font></font>
        return {'ip_address': self._ip}<font></font>
<font></font>
    @property<font></font>
    def device_class(self):<font></font>
        return 'connectivity'<font></font>
<font></font>
    @property<font></font>
    def is_on(self):<font></font>
        return self._is_on<font></font>
<font></font>
    def update(self):<font></font>
        result = ping(self._ip, count=1, timeout=0.1)<font></font>
        self._is_on = result.success()<font></font>
        self._state = 'on' if result.success() else ‘off'</pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verbinden Sie dann den Infrarot-Emitter mit dem Sensor wie folgt mit dem Schalter:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schalter:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  - Plattform: Vorlage</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    Schalter:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      toshiba_tv:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        value_template: "{{is_state ('binary_sensor.toshiba_tv', 'on')}}"</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        anschalten:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          service: script.toshiba_power</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        abschalten:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          service: script.toshiba_power</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und ein solcher Schalter wurde in Google Home angezeigt und über die Sprache gesteuert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS Übung mit einem Smart Home war erfolgreich, ging neue Geräte zu kaufen! </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PPS Ein ZigBee-Hub beleuchtet jetzt aus irgendeinem Grund den Flur ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es war</font></font></h4><br>
<img src="https://habrastorage.org/webt/da/tl/lf/datllfwsuxaymb2ambzwp-20faq.jpeg" width="300"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wurde</font></font></h4><br>
<img src="https://habrastorage.org/webt/co/bo/ly/cobolyyfof7zpaqji3wfgx0dkfw.jpeg" width="300"></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de496842/index.html">Ein einfaches Epidemiemodell mit grundlegenden Python-Tools</a></li>
<li><a href="../de496846/index.html">Sprachmechanik von Stapeln und Zeigern</a></li>
<li><a href="../de496848/index.html">Die Zusammenfassung interessanter Materialien für den mobilen Entwickler # 340 (vom 6. bis 12. April)</a></li>
<li><a href="../de496850/index.html">Maven Plugin für JPackage aus Java 14</a></li>
<li><a href="../de496852/index.html">Reibungslose Sortierung</a></li>
<li><a href="../de496858/index.html">FOSS News Nr. 11 - eine Überprüfung der freien und Open-Source-Software für den 6. bis 12. April 2020</a></li>
<li><a href="../de496860/index.html">Erster DI: Erster DI für Schnittstellen für Typoskriptanwendungen</a></li>
<li><a href="../de496862/index.html">Arduino Bubble Display</a></li>
<li><a href="../de496864/index.html">Audit Wallets in CryptoNote</a></li>
<li><a href="../de496868/index.html">Small Space Symphony</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>