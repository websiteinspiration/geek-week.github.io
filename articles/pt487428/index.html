<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•ñ üåÜ üßê Sob o cap√¥ do cliente de bot Yandex.Music üôèüèº ü•õ ü¶Ä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introdu√ß√£o
 Ol√° Habr! Novamente, eu estou com o segundo artigo que afeta a API Yandex.Music. O caso √© planejado e mencionado no primeiro artigo . 
 
 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Sob o cap√¥ do cliente de bot Yandex.Music</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487428/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introdu√ß√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ol√° Habr! </font><font style="vertical-align: inherit;">Novamente, eu estou com o segundo artigo que afeta a API Yandex.Music. </font><font style="vertical-align: inherit;">O caso √© planejado e mencionado no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">primeiro artigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√£os alcan√ßadas, prontas. </font><font style="vertical-align: inherit;">Hoje vou falar de momentos interessantes, na minha opini√£o, presentes na base de c√≥digo do meu bot Telegram, que se posiciona como um cliente de m√∫sica completo. </font><font style="vertical-align: inherit;">Tamb√©m tocaremos na API de reconhecimento de m√∫sica Yandex. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de prosseguir para a hist√≥ria ponto a ponto da implementa√ß√£o de uma coisa em particular, valeria a pena ter uma id√©ia sobre o bot em si e suas capacidades funcionais.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demonstra√ß√£o em v√≠deo do cliente</font></font></b><div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/YOw9hs8tFg0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na parte principal, falarei sobre o seguinte:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entre na sua conta atrav√©s do site nas </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P√°ginas do GitHub</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (por que e por que).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O formato dos dados, sua embalagem e uso nos dados dos bot√µes.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Roteamento de atualiza√ß√£o, vers√£o de dados, lan√ßamento de contexto em manipuladores.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servi√ßos:</font></font><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trilha de recarga de servi√ßo no Telegram.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O servi√ßo de "assinaturas" para receber uma faixa com o envio do status do download.</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A implementa√ß√£o de cache de consultas mais simples e elegante.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reconhecimento de uma faixa por mensagem de voz e como ela geralmente aparece no bot.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pequenas notas.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ estiver interessado em pelo menos um ponto - seja bem-vindo ao gato.</font></font><br>
<img src="https://habrastorage.org/webt/uv/4s/a3/uv4sa3pslohuzlmuzrjzteju2dk.png"><a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O bot trabalha com usu√°rios que fizeram login em sua conta, mas n√£o. </font><font style="vertical-align: inherit;">Tudo gira em torno de quatro classes principais de servi√ßo: √°lbum, artista, lista de reprodu√ß√£o e faixa. </font><font style="vertical-align: inherit;">Todos os dados da entidade s√£o suportados, h√° pagina√ß√£o com sele√ß√£o de p√°gina. </font><font style="vertical-align: inherit;">Para interagir com eles, um usu√°rio autorizado pode usar seu menu pessoal, que inclui: playlists inteligentes, a playlist ‚ÄúEu gosto‚Äù e suas pr√≥prias playlists. </font><font style="vertical-align: inherit;">Para usu√°rios n√£o autorizados, a pesquisa est√° dispon√≠vel - enviando uma consulta de pesquisa como uma mensagem regular. </font><font style="vertical-align: inherit;">Agora h√° apenas uma lista detalhada do que mais existe: recebimento de faixas e outros objetos por meio de um link direto, recebimento de letras de m√∫sicas, capacidade de gostar / n√£o gostar da faixa e do artista, visualizar faixas semelhantes, reconhecer faixas por mensagem de voz e muito mais.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte principal</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Fa√ßa o login na conta</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inicialmente, o bot n√£o estava planejado para funcionar sem autoriza√ß√£o, portanto, mesmo durante o design, foi decidido como a autoriza√ß√£o deveria ocorrer - atrav√©s de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seu site</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Os principais argumentos foram seguran√ßa e transpar√™ncia. Em nenhum caso, voc√™ n√£o quis aceitar logins e senhas de usu√°rios em mensagens limpas. E a autoriza√ß√£o do computador do usu√°rio √© elementar. Portanto, um site foi escrito para autoriza√ß√£o no </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">React</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . √â uma forma de autoriza√ß√£o com um redirecionamento de volta para o bot. Uma pe√ßa com autoriza√ß√£o e processamento de captcha foi retirada da biblioteca em </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e reescrita em </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScript</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para autoriza√ß√£o, √© usado o token OAuth recebido, que √© transferido de volta para o bot via </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link direto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O link final para o redirecionamento √© assim: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/music_yandex_bot?start={oauth_token}</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Eu queria o melhor, mas os usu√°rios n√£o confiavam. Somente todo d√©cimo usu√°rio foi autorizado (no momento em que era obrigat√≥rio). Portanto, com as seguintes atualiza√ß√µes, tive que explicar por que voc√™ deveria confiar. Todos os itens sobre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTPS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , exclusivamente sobre solicita√ß√µes do lado do cliente e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥digo-fonte aberto,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> foram publicados no site para autoriza√ß√£o e duplicados em uma mensagem de boas-vindas no bot. Melhorou. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, entre os fatores de baixa autoriza√ß√£o, a inacessibilidade de espelhos para o t.me na R√∫ssia acabou sendo um suporte para apenas usu√°rios com assinatura (mais sobre isso nas notas, par√°grafo 7).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O primeiro item foi resolvido usando o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URI</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tg: //</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) e, em uma pitada, j√° existe um link para o espelho (se o redirecionamento autom√°tico n√£o funcionou e o bot√£o n√£o ajudou), e o segundo est√° novamente no item 7.</font></font><br>
<img src="https://habrastorage.org/webt/ez/2_/0j/ez2_0japfosbu9k4bjelikl8x-i.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Formato dos dados</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para esse bot, decidi pela primeira vez usar o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NoSQL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DB - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MongoDB</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Entendido: quando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">incorporar um</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> documento, quando n√£o. Gostava de trabalhar com mongoengine. Mas eu realmente n√£o queria armazenar todos os dados do bot√£o em casa, e o cliente s√≥ tem o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do </font><font style="vertical-align: inherit;">registro no banco de dados. Eu tinha pavor da quantidade de dados, mas queria usar um servidor Mongo gratuito com um limite de 512 MB para armazenamento de dados. Criar uma bela reutiliza√ß√£o de registros se os dados coincidirem em v√°rios bot√µes e limpar os desatualizados √© muito mais dif√≠cil do que armazenar tudo nos pr√≥prios bot√µes. Depois de analisar o tamanho dos dados a serem armazenados, conclu√≠ que eles se encaixam facilmente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No come√ßo, eu apenas usei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas ele rapidamente recusou quando chegou a um limite. No Telegram, o conte√∫do dos dados do bot√£o n√£o pode ter mais que 64 bytes em </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UTF-8</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, com a solicita√ß√£o de um amigo, comecei a olhar o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pacote</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no m√≥dulo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">struct</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Assim, nasceram os tipos de consultas, o formato primitivo, a embalagem e a descompacta√ß√£o. Agora ele √© usado no bot absolutamente em todos os lugares. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O formato √© muito simples. O primeiro byte √© do tipo, o segundo √© a vers√£o. Tudo o resto s√£o dados para um tipo espec√≠fico. Os tipos s√£o armazenados como Enum, t√™m um </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que √© o primeiro byte. Al√©m do </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cada tipo tem um formato para empacotar e descompactar dados. Por exemplo: digite </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHOW_TRACK_MENU</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cujo formato tem o valor "s?", onde "s" √© o identificador exclusivo da faixa e "?" - A faixa possui texto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nas faixas usadas, digite o tipo de sequ√™ncia porque: primeiro, o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da faixa pode ser uma concatena√ß√£o de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do </font><font style="vertical-align: inherit;">√°lbum </font><font style="vertical-align: inherit;">da faixa atrav√©s dos dois pontos e, em segundo lugar, pode ser </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o UUID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Faixas com </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UUID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><font style="vertical-align: inherit;">faixas com </font><font style="vertical-align: inherit;">carregamento autom√°tico, dispon√≠veis apenas para o usu√°rio que as baixou. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como os dados nem sempre correspondem ao formato, por exemplo, o mesmo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> faixa pode ser representado simplesmente por um n√∫mero, antes de compact√°-los, deve ser convertido em um tipo para o formato. Nesse caso, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Portanto, na classe existe um m√©todo que normaliza os dados transferidos para empacotamento, para n√£o fazer isso sozinho ao passar para o construtor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As strings s√£o auto-suficientes e s√£o capazes de indicar seu comprimento ao embalar e levar esse comprimento em considera√ß√£o ao desembalar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O suporte para vers√µes mais antigas n√£o foi planejado, portanto, uma exce√ß√£o ser√° lan√ßada se as vers√µes n√£o corresponderem. </font><font style="vertical-align: inherit;">Ao processar atualiza√ß√µes, que discutirei no pr√≥ximo par√°grafo, a l√≥gica necess√°ria √© chamada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como o Telegram come exclusivamente </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UTF-8</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , os dados compactados s√£o codificados na </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base85</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Sim, estou perdendo velocidade aqui e salvando o menor tamanho sem usar o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base64</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas, considerando os pequenos dados, considero </font><font style="vertical-align: inherit;">apropriado o </font><font style="vertical-align: inherit;">uso do </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base85</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fonte. </font><font style="vertical-align: inherit;">Arquivo callback_data.py</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> struct
<span class="hljs-keyword">import</span> base64<font></font>
<font></font>
<span class="hljs-keyword">from</span> ext.query_types <span class="hljs-keyword">import</span> QueryType<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BadDataVersion</span>(<span class="hljs-params">Exception</span>):</span>
    <span class="hljs-keyword">pass</span><font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CallbackData</span>:</span>
    ACTUAL_VERSION = <span class="hljs-number">7</span>
    BASE_FORMAT = <span class="hljs-string">'&lt;BB'</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, type_: QueryType, data=None, version=None</span>):</span><font></font>
        self.type = type_<font></font>
        self.version = version <span class="hljs-keyword">or</span> CallbackData.ACTUAL_VERSION<font></font>
        self.data = data<font></font>
<font></font>
        <span class="hljs-keyword">if</span> self.data <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> isinstance(self.data, list):<font></font>
            self.data = [self.data]<font></font>
<font></font>
        <span class="hljs-keyword">if</span> self.data <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            self.data = self._normalize_data_to_format(self.data)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__repr__</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f'&lt;CallbackData&gt; Type: <span class="hljs-subst">{self.type}</span> Version: <span class="hljs-subst">{self.version}</span> Data: <span class="hljs-subst">{self.data}</span>'</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_normalize_data_to_format</span>(<span class="hljs-params">self, data, bytes_object=False</span>):</span><font></font>
        normalized_data = data.copy()<font></font>
        <span class="hljs-keyword">for</span> i, c <span class="hljs-keyword">in</span> enumerate(self.type.format):<font></font>
            cast = str<font></font>
            <span class="hljs-keyword">if</span> c.lower() <span class="hljs-keyword">in</span> <span class="hljs-string">'bhilqn'</span>:<font></font>
                cast = int<font></font>
            <span class="hljs-keyword">elif</span> c <span class="hljs-keyword">in</span> <span class="hljs-string">'efd'</span>:<font></font>
                cast = float<font></font>
            <span class="hljs-keyword">elif</span> c == <span class="hljs-string">'?'</span>:<font></font>
                cast = bool<font></font>
<font></font>
            casted = cast(data[i])<font></font>
            <span class="hljs-keyword">if</span> bytes_object <span class="hljs-keyword">and</span> cast == str:<font></font>
                casted = casted.encode(<span class="hljs-string">'utf-8'</span>)<font></font>
            normalized_data[i] = casted<font></font>
<font></font>
        <span class="hljs-keyword">return</span> normalized_data<font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode_type</span>(<span class="hljs-params">callback_data</span>):</span>
        decoded = base64.b85decode(callback_data.encode(<span class="hljs-string">'utf-8'</span>))<font></font>
        type_, version = struct.unpack(CallbackData.BASE_FORMAT, decoded[:<span class="hljs-number">2</span>])<font></font>
<font></font>
        <span class="hljs-keyword">if</span> CallbackData.ACTUAL_VERSION != version:
            <span class="hljs-keyword">raise</span> BadDataVersion()<font></font>
<font></font>
        <span class="hljs-keyword">return</span> QueryType(type_), version, decoded<font></font>
<font></font>
<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode</span>(<span class="hljs-params">cls, type_, version, decoded</span>):</span>
        start, data = <span class="hljs-number">2</span>, []<font></font>
<font></font>
        <span class="hljs-keyword">if</span> start &lt; len(decoded):<font></font>
            format_iter = iter(type_.format)<font></font>
<font></font>
            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
                <span class="hljs-keyword">if</span> start &gt;= len(decoded):
                    <span class="hljs-keyword">break</span><font></font>
<font></font>
                format_ = next(format_iter, type_.format[<span class="hljs-number">-1</span>])<font></font>
<font></font>
                decode_str = format_ <span class="hljs-keyword">in</span> <span class="hljs-string">'ps'</span>
                <span class="hljs-keyword">if</span> decode_str:
                    <span class="hljs-comment"># struct.calcsize('b') = 1</span>
                    length = list(struct.unpack(<span class="hljs-string">'b'</span>, decoded[start: start + <span class="hljs-number">1</span>]))[<span class="hljs-number">0</span>]<font></font>
                    start += <span class="hljs-number">1</span><font></font>
<font></font>
                    format_ = <span class="hljs-string">f'<span class="hljs-subst">{length}</span><span class="hljs-subst">{format_}</span>'</span><font></font>
<font></font>
                step = struct.calcsize(format_)<font></font>
<font></font>
                unpacked = list(struct.unpack(<span class="hljs-string">f'<span class="hljs-subst">{format_}</span>'</span>, decoded[start: start + step]))
                <span class="hljs-keyword">if</span> decode_str:<font></font>
                    unpacked[<span class="hljs-number">0</span>] = unpacked[<span class="hljs-number">0</span>].decode(<span class="hljs-string">'UTF-8'</span>)<font></font>
<font></font>
                data += unpacked<font></font>
                start += step<font></font>
<font></font>
        <span class="hljs-keyword">return</span> cls(type_, data <span class="hljs-keyword">if</span> data <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>, version)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode</span>(<span class="hljs-params">self</span>):</span><font></font>
        encode = struct.pack(self.BASE_FORMAT, self.type.value, self.version)<font></font>
<font></font>
        <span class="hljs-keyword">if</span> self.data <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            format_iter = iter(self.type.format)<font></font>
            normalized_data = self._normalize_data_to_format(self.data, bytes_object=<span class="hljs-literal">True</span>)<font></font>
<font></font>
            <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> normalized_data:<font></font>
                format_ = next(format_iter, self.type.format[<span class="hljs-number">-1</span>])<font></font>
<font></font>
                <span class="hljs-keyword">if</span> format_ <span class="hljs-keyword">in</span> <span class="hljs-string">'ps'</span>:
                    <span class="hljs-comment">#        .  'b'  </span>
                    <span class="hljs-comment"># -      ,    &gt; 36 </span>
                    encode += struct.pack(<span class="hljs-string">'b'</span>, len(data))<font></font>
                    encode += struct.pack(<span class="hljs-string">f'<span class="hljs-subst">{len(data)}</span><span class="hljs-subst">{format_}</span>'</span>, data)
                <span class="hljs-keyword">else</span>:<font></font>
                    encode += struct.pack(<span class="hljs-string">f'<span class="hljs-subst">{format_}</span>'</span>, data)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> base64.b85encode(encode).decode(<span class="hljs-string">'utf-8'</span>)<font></font>
<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Atualiza√ß√µes e contexto de roteamento</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O projeto usa a biblioteca </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python-telegram-bot</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para trabalhar com a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do </font><i><font style="vertical-align: inherit;">Telegram Bot</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ele j√° possui um sistema para registrar manipuladores para certos tipos de atualiza√ß√µes que chegaram, filtros para express√µes regulares, comandos e assim por diante. </font><font style="vertical-align: inherit;">Mas, dado meu pr√≥prio formato de dados e meus tipos, tive que herdar do </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TelegramHandler</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e implementar meu </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Handler</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Atualiza√ß√£o e contexto s√£o passados ‚Äã‚Äãpara cada manipulador por meio de argumentos. </font><font style="vertical-align: inherit;">Nesse caso, eu tenho meu pr√≥prio contexto e est√° em </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Handler'e</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ele est√° sendo formado e √©: recebendo e / ou adicionando um usu√°rio ao banco de dados, verificando a relev√¢ncia do token para obter acesso √† m√∫sica, inicializando o cliente Yandex.Music, dependendo do status da autoriza√ß√£o e da disponibilidade de uma assinatura. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m do meu </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Handler'a, existem</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> manipuladores mais espec√≠ficos, por exemplo, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CallbackQueryHandler</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Com ele, um manipulador √© registrado para um determinado tipo de atualiza√ß√£o (meu tipo, com um formato de dados). Para verificar se essa atualiza√ß√£o √© adequada para o manipulador atual, nem todos os dados s√£o descompactados, mas apenas os dois primeiros bytes. Nesta fase, a necessidade de iniciar um retorno de chamada √© verificada. Somente se for necess√°rio iniciar o retorno de chamada - os dados ser√£o totalmente descompactados e transferidos como </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kwargs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para o manipulador final. </font><font style="vertical-align: inherit;">Imediatamente h√° um envio de dados anal√≠ticos para o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ChatBase</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O registro ocorre sequencialmente, e a prioridade √© maior para quem ser√° registrado anteriormente (de fato, como no </font><font style="vertical-align: inherit;">roteamento do </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Django</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e em outros projetos). </font><font style="vertical-align: inherit;">Portanto, o registro de um manipulador para uma vers√£o obsoleta √© o primeiro entre os manipuladores do </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CallBackQuery</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A l√≥gica do processamento da vers√£o desatualizada √© simples - informe o usu√°rio sobre isso e envie dados atualizados, se poss√≠vel.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Servi√ßos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos os servi√ßos s√£o inicializados quando o bot √© iniciado em uma classe de controle, que √© usada universalmente em qualquer lugar do bot ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DJ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada servi√ßo possui seu pr√≥prio </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ThreadPoolExecutor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com um certo n√∫mero de trabalhadores nos quais as tarefas s√£o enviadas.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recarregando uma faixa no Telegram</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No momento, este servi√ßo n√£o foi reescrito no </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">User Bot</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para ignorar o limite do tamanho do arquivo baixado no Telegram. Como se viu, no Yandex.Music existem arquivos maiores que 50 mb - podcasts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O servi√ßo verifica o tamanho do arquivo e, em caso de excesso, lan√ßa um alerta ao usu√°rio. Gra√ßas ao sistema de armazenamento em cache descrito no par√°grafo 5, isso verifica a disponibilidade e o recebimento das letras. As faixas tamb√©m s√£o armazenadas em cache. O hash do arquivo √© armazenado no banco de dados. Se houver um, o √°udio com um cache conhecido ser√° enviado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na aus√™ncia de um arquivo no banco de dados, um link direto √© recebido do Yandex.Music. Embora, no momento, os usu√°rios n√£o tenham a capacidade de alterar as configura√ß√µes de qualidade, mas todas est√£o definidas com valores padr√£o. O arquivo √© pesquisado por taxa de bits e codec nas configura√ß√µes do usu√°rio.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O arquivo e sua capa s√£o baixados como </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tempfile.TemporaryFile ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ap√≥s o qual s√£o carregados no Telegram. </font><font style="vertical-align: inherit;">Vale a pena notar que TG nem sempre reconhece corretamente a dura√ß√£o da faixa, mas geralmente sou silencioso sobre o artista e o t√≠tulo. </font><font style="vertical-align: inherit;">Portanto, esses dados s√£o retirados do Yandex, felizmente, √© poss√≠vel transmiti-los ao carrinho. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando um arquivo de √°udio √© enviado por esse servi√ßo, o nome </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">finish_callback ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© chamado </font><font style="vertical-align: inherit;">, sinalizando o servi√ßo por assinatura sobre o final do download.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servi√ßo de assinatura para receber faixas e enviar status de download</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As faixas n√£o s√£o carregadas instantaneamente. √â poss√≠vel que v√°rios usu√°rios tenham solicitado a mesma faixa. Nesse caso, o usu√°rio que solicitou a faixa primeiro √© o iniciador e o propriet√°rio da faixa. Ao recarregar mais de um segundo, o status do download √© iniciado: ‚ÄúO usu√°rio envia uma mensagem de voz‚Äù. Outros usu√°rios que solicitaram a mesma faixa s√£o assinantes regulares. Eles, como o propriet√°rio, recebem o status do download uma vez a cada ~ 4 segundos, para que a mensagem n√£o seja interrompida (o status trava por 5 segundos). Assim que o download da faixa para o propriet√°rio for conclu√≠do, o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">finish_callback ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© chamado </font><font style="vertical-align: inherit;">no servi√ßo acima. Depois disso, todos os assinantes s√£o exclu√≠dos da lista de status e recebem a faixa baixada.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na solu√ß√£o arquitet√¥nica, o propriet√°rio da faixa tamb√©m √© assinante, mas com uma certa marca, pois as formas de envio da faixa s√£o diferentes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Cache de consulta</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como lembramos do meu √∫ltimo artigo, os pedidos para a API Yandex.Music s√£o muito pesados. A lista de faixas pode ser de 3 ou 5 mb. Al√©m disso, existem muitos pedidos. Com cada processamento de atualiza√ß√£o, pelo menos 2 solicita√ß√µes s√£o enviadas ao Yandex: para inicializar o cliente e para uma a√ß√£o espec√≠fica. Em alguns lugares, para coletar informa√ß√µes suficientes (por exemplo, para uma lista de reprodu√ß√£o), voc√™ precisa fazer uma solicita√ß√£o para uma lista de reprodu√ß√£o, para receber suas faixas, para obter informa√ß√µes da p√°gina de destino (se esta for uma lista de reprodu√ß√£o inteligente) e n√£o se esque√ßa da inicializa√ß√£o do cliente. Em geral, horror silencioso em termos do n√∫mero de solicita√ß√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu queria algo muito universal, e n√£o fizesse nenhum tipo de armazenamento para certos objetos, os mesmos clientes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como a biblioteca permite que voc√™ especifique sua pr√≥pria inst√¢ncia para execu√ß√£o de consultas, al√©m de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">solicita√ß√µes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, aproveitei isso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O ponto √© simples. A pr√≥pria classe de cache √© um singleton. Ele possui apenas dois par√¢metros: vida √∫til do cache, tamanho. Quando a solicita√ß√£o √© executada, o wrapper √© chamado. Ele √© substitu√≠do. A verifica√ß√£o do cache ocorre por hash de args e quartos congelados. O cache tem tempo para adicionar. Ao verificar a necessidade de atualizar os dados, os dados de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LimitedSizeDict s√£o obtidos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou uma solicita√ß√£o real √© feita e adicionada ao cache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alguns pedidos n√£o podem ser armazenados em cache, por exemplo, definindo um gostar / n√£o gostar. Se o usu√°rio pressionar a seguinte sequ√™ncia: gostar, n√£o gostar, gostar, ent√£o, no final, o gosto n√£o ser√° entregue. Nesses casos, ao enviar uma solicita√ß√£o, voc√™ precisa passar o argumento </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">use_cache</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com um valor igual a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">False</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Na verdade, este √© o √∫nico local em que o cache n√£o √© usado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gra√ßas a isso, fa√ßo as solicita√ß√µes mais ousadas para que elas sejam armazenadas em cache. </font><font style="vertical-align: inherit;">N√£o estou tentando dividi-lo em p√°ginas pequenas e necess√°rio apenas para a p√°gina atual. </font><font style="vertical-align: inherit;">Eu pego tudo de uma vez e, ao alternar entre as p√°ginas, tenho uma velocidade de comuta√ß√£o enorme (em compara√ß√£o com a abordagem antiga). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quanto a mim, a classe de solicita√ß√£o em cache teve um desempenho bonito e foi simplesmente integrada.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fonte</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> copy
<span class="hljs-keyword">import</span> time<font></font>
<font></font>
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Union
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> OrderedDict<font></font>
<font></font>
<span class="hljs-keyword">import</span> requests<font></font>
<font></font>
<span class="hljs-keyword">from</span> yandex_music.utils.request <span class="hljs-keyword">import</span> Request <span class="hljs-keyword">as</span> YandexMusicRequest<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LimitedSizeDict</span>(<span class="hljs-params">OrderedDict</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span>
        self.size_limit = kwargs.pop(<span class="hljs-string">"size_limit"</span>, <span class="hljs-literal">None</span>)<font></font>
        OrderedDict.__init__(self, *args, **kwargs)<font></font>
        self._check_size_limit()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__setitem__</span>(<span class="hljs-params">self, key, value</span>):</span><font></font>
        OrderedDict.__setitem__(self, key, value)<font></font>
        self._check_size_limit()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_check_size_limit</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">if</span> self.size_limit <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">while</span> len(self) &gt; self.size_limit:<font></font>
                self.popitem(last=<span class="hljs-literal">False</span>)<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CachedItem</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, response: requests.Response</span>):</span><font></font>
        self.timestamp = time.time()<font></font>
        self.response = response<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cache</span>:</span>
    __singleton: <span class="hljs-string">'Cache'</span> = <span class="hljs-literal">None</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, lifetime: Union[str, int], size: Union[str, int]</span>):</span><font></font>
        Cache.__singleton = self<font></font>
<font></font>
        self.lifetime = int(lifetime) * <span class="hljs-number">60</span><font></font>
        self.size = int(size)<font></font>
<font></font>
        self.storage: LimitedSizeDict = LimitedSizeDict(size_limit=int(size))<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span><font></font>
        hash_ = Cache.get_hash(*args, **kwargs)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> self.storage[hash_].response<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, response: requests.Response, *args, **kwargs</span>):</span><font></font>
        hash_ = Cache.get_hash(*args, **kwargs)<font></font>
        self.storage.update({hash_: CachedItem(response)})<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">need_to_fetch</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span><font></font>
        hash_ = Cache.get_hash(*args, **kwargs)<font></font>
        cached_item = self.storage.get(hash_)<font></font>
<font></font>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> cached_item:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> time.time() - cached_item.timestamp &gt; self.lifetime:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><font></font>
<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><font></font>
<font></font>
<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_instance</span>(<span class="hljs-params">cls</span>) -&gt; 'Cache':</span>
        <span class="hljs-keyword">if</span> cls.__singleton <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> cls.__singleton
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">f'<span class="hljs-subst">{cls.__name__}</span> not initialized'</span>)<font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">freeze_dict</span>(<span class="hljs-params">d: dict</span>) -&gt; Union[frozenset, tuple, dict]:</span>
        <span class="hljs-keyword">if</span> isinstance(d, dict):
            <span class="hljs-keyword">return</span> frozenset((key, Cache.freeze_dict(value)) <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> d.items())
        <span class="hljs-keyword">elif</span> isinstance(d, list):
            <span class="hljs-keyword">return</span> tuple(Cache.freeze_dict(value) <span class="hljs-keyword">for</span> value <span class="hljs-keyword">in</span> d)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> d<font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_hash</span>(<span class="hljs-params">*args, **kwargs</span>):</span>
        <span class="hljs-keyword">return</span> hash((args, Cache.freeze_dict(kwargs)))<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Request</span>(<span class="hljs-params">YandexMusicRequest</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_request_wrapper</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span>
        use_cache = kwargs.get(<span class="hljs-string">'use_cache'</span>, <span class="hljs-literal">True</span>)<font></font>
<font></font>
        <span class="hljs-keyword">if</span> <span class="hljs-string">'use_cache'</span> <span class="hljs-keyword">in</span> kwargs:<font></font>
            kwargs.pop(<span class="hljs-string">'use_cache'</span>)<font></font>
<font></font>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> use_cache:<font></font>
            response = super()._request_wrapper(*args, **copy.deepcopy(kwargs))<font></font>
        <span class="hljs-keyword">elif</span> use_cache <span class="hljs-keyword">and</span> Cache.get_instance().need_to_fetch(*args, **kwargs):<font></font>
            response = super()._request_wrapper(*args, **copy.deepcopy(kwargs))<font></font>
            Cache.get_instance().update(response, *args, **kwargs)<font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            response = Cache.get_instance().get(*args, **kwargs)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> response<font></font>
<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Rastreie o reconhecimento por mensagem de voz</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No come√ßo, n√£o se pensava em adicionar isso ao bot, mas ocorreu uma situa√ß√£o interessante. O bot tem um bate-papo (√© indicado na descri√ß√£o do bot). Depois de algum tempo, notei que as pessoas entram e enviam mensagens de voz com m√∫sica. No come√ßo, eu pensei que era um novo tipo de spam, de tal forma que algu√©m engasgava e estava brincando. Mas, quando j√° havia 10 pessoas assim e todo mundo estava fazendo a mesma coisa, meu amigo (o mesmo sugerido por </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">struct</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) sugeriu que os usu√°rios dirigissem o Yandex.Music em busca de um bot oficial para reconhecer m√∫sicas do Yandex, eles veem uma sala de bate-papo l√° e enviam mensagens de voz com toda a seriedade! Foi apenas uma suposi√ß√£o brilhante e verdadeira. Em tom de brincadeira, disse que estava na hora de fazer o reconhecimento e adicionar um bot ao chat. Por divers√£o ... Depois de um tempo, isso foi feito!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora sobre a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Recentemente, o Yandex usou cada vez mais soquetes da web. Eu conheci o uso deles no gerenciamento de um i.module e um i.station. O servi√ßo de reconhecimento de m√∫sica tamb√©m funciona nele. Joguei a solu√ß√£o m√≠nima de trabalho no meu bot, mas n√£o adicionei a implementa√ß√£o √† biblioteca. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O WS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est√° localizado no seguinte endere√ßo: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wss: //voiceservices.yandex.net/uni.ws</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Precisamos apenas de duas mensagens - autoriza√ß√£o e um pedido de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reconhecimento</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O pr√≥prio Yandex, em seu pedido oficial, envia arquivos curtos em um segundo ou tr√™s. Em resposta, voc√™ pode enviar mais dados ou o resultado - encontrado ou n√£o. Se o resultado for encontrado, o ID da faixa ser√° retornado. </font><i><font style="vertical-align: inherit;">Os</font></i><font style="vertical-align: inherit;"> arquivos </font><i><font style="vertical-align: inherit;">.Ogg</font></i><font style="vertical-align: inherit;"> s√£o </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
enviados </font><font style="vertical-align: inherit;">com</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ENCODER = SDK do SpeechKit Mobile v3.28.0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">N√£o verifiquei como ele funciona com outros codificadores, apenas o alterei no arquivo gravado pelo Telegram. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao reverter com um soquete da Web, √†s vezes a m√°gica acontecia. </font><font style="vertical-align: inherit;">√Äs vezes, n√£o conseguia encontrar a faixa, mas quando mudei o idioma na mensagem com a solicita√ß√£o de reconhecimento, consegui. </font><font style="vertical-align: inherit;">Ou, a princ√≠pio, encontrou e depois parou, embora o arquivo seja o mesmo. </font><font style="vertical-align: inherit;">Eu pensei que o idioma da faixa √© definido pelo seu </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SpeechKit</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no cliente. </font><font style="vertical-align: inherit;">N√£o tendo essa oportunidade de fazer isso sozinho, fa√ßo uma busca por for√ßa bruta.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minha implementa√ß√£o feita no joelho do reconhecimento de voz por mensagens de voz do Telegram</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> uuid<font></font>
<font></font>
<span class="hljs-keyword">import</span> lomond<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_auth_data</span>():</span>
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"event"</span>: {
            <span class="hljs-string">"header"</span>: {
                <span class="hljs-string">"messageId"</span>: str(uuid.uuid4()),
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"SynchronizeState"</span>,
                <span class="hljs-string">"namespace"</span>: <span class="hljs-string">"System"</span><font></font>
            },<font></font>
            <span class="hljs-string">"payload"</span>: {
                <span class="hljs-string">"accept_invalid_auth"</span>: <span class="hljs-literal">True</span>,
                <span class="hljs-string">"auth_token"</span>: <span class="hljs-string">"5983ba91-339e-443c-8452-390fe7d9d308"</span>,
                <span class="hljs-string">"uuid"</span>: str(uuid.uuid4()).replace(<span class="hljs-string">'-'</span>, <span class="hljs-string">''</span>),<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_asr_data</span>():</span>
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"event"</span>: {
            <span class="hljs-string">"header"</span>: {
                <span class="hljs-string">"messageId"</span>: str(uuid.uuid4()),
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"Recognize"</span>,
                <span class="hljs-string">"namespace"</span>: <span class="hljs-string">"ASR"</span>,
                <span class="hljs-string">"streamId"</span>: <span class="hljs-number">1</span><font></font>
            },<font></font>
            <span class="hljs-string">"payload"</span>: {
                <span class="hljs-string">"advancedASROptions"</span>: {
                    <span class="hljs-string">"manual_punctuation"</span>: <span class="hljs-literal">False</span>,
                    <span class="hljs-string">"partial_results"</span>: <span class="hljs-literal">False</span><font></font>
                },<font></font>
                <span class="hljs-string">"disableAntimatNormalizer"</span>: <span class="hljs-literal">False</span>,
                <span class="hljs-string">"format"</span>: <span class="hljs-string">"audio/opus"</span>,
                <span class="hljs-string">"music_request2"</span>: {
                    <span class="hljs-string">"headers"</span>: {
                        <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"audio/opus"</span><font></font>
                    }<font></font>
                },<font></font>
                <span class="hljs-string">"punctuation"</span>: <span class="hljs-literal">False</span>,
                <span class="hljs-string">"tags"</span>: <span class="hljs-string">"PASS_AUDIO;"</span>,
                <span class="hljs-string">"topic"</span>: <span class="hljs-string">"queries"</span><font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Recognition</span>:</span>
    URI = <span class="hljs-string">'wss://voiceservices.yandex.net/uni.ws'</span>
    LANGS = [<span class="hljs-string">''</span>, <span class="hljs-string">'ru-RU'</span>, <span class="hljs-string">'en-US'</span>]<font></font>
    POLL_DELAY = <span class="hljs-number">0.3</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, binary_data, status_msg</span>):</span><font></font>
        self.status_msg = status_msg<font></font>
        self.websocket = lomond.WebSocket(self.URI)<font></font>
        self.chunks = self.get_chunks_and_replace_encoder(binary_data)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_track_id</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">for</span> lang <span class="hljs-keyword">in</span> Recognition.LANGS:<font></font>
            asr_data = get_asr_data()<font></font>
            <span class="hljs-keyword">if</span> lang:<font></font>
                asr_data[<span class="hljs-string">'event'</span>][<span class="hljs-string">'payload'</span>].update({<span class="hljs-string">'lang'</span>: lang})<font></font>
                self.status_msg.edit_text(<span class="hljs-string">f'     <span class="hljs-subst">{lang}</span>...'</span>)
            <span class="hljs-keyword">else</span>:<font></font>
                self.status_msg.edit_text(<span class="hljs-string">f'      ...'</span>)<font></font>
<font></font>
            <span class="hljs-keyword">for</span> msg <span class="hljs-keyword">in</span> self.websocket.connect(poll=self.POLL_DELAY):
                <span class="hljs-keyword">if</span> msg.name == <span class="hljs-string">'ready'</span>:<font></font>
                    self.websocket.send_json(get_auth_data())<font></font>
                    self.websocket.send_json(asr_data)<font></font>
<font></font>
                    <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> self.chunks:<font></font>
                        self.websocket.send_binary(chunk)<font></font>
<font></font>
                <span class="hljs-keyword">if</span> msg.name == <span class="hljs-string">'text'</span>:<font></font>
                    response = msg.json.get(<span class="hljs-string">'directive'</span>)<font></font>
<font></font>
                    <span class="hljs-keyword">if</span> self.is_valid_response(response):<font></font>
                        self.websocket.close()<font></font>
<font></font>
                        <span class="hljs-keyword">return</span> self.parse_track_id(response)
                    <span class="hljs-keyword">elif</span> self.is_fatal_error(response):<font></font>
                        self.websocket.close()<font></font>
<font></font>
                        <span class="hljs-keyword">break</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_valid_response</span>(<span class="hljs-params">self, response</span>):</span>
        <span class="hljs-keyword">if</span> response.get(<span class="hljs-string">'header'</span>, {}).get(<span class="hljs-string">'name'</span>) == <span class="hljs-string">'MusicResult'</span> <span class="hljs-keyword">and</span> \<font></font>
                response.get(<span class="hljs-string">'payload'</span>, {}).get(<span class="hljs-string">'result'</span>) == <span class="hljs-string">'success'</span>:<font></font>
            self.status_msg.edit_text(<span class="hljs-string">f' ,  !'</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_fatal_error</span>(<span class="hljs-params">response</span>):</span>
        <span class="hljs-keyword">if</span> response.get(<span class="hljs-string">'header'</span>, {}).get(<span class="hljs-string">'name'</span>) == <span class="hljs-string">'MusicResult'</span> <span class="hljs-keyword">and</span> \<font></font>
                response.get(<span class="hljs-string">'payload'</span>, {}).get(<span class="hljs-string">'result'</span>) == <span class="hljs-string">'music'</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_track_id</span>(<span class="hljs-params">response</span>):</span>
        <span class="hljs-keyword">return</span> response[<span class="hljs-string">'payload'</span>][<span class="hljs-string">'data'</span>][<span class="hljs-string">'match'</span>][<span class="hljs-string">'id'</span>]<font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_chunks_and_replace_encoder</span>(<span class="hljs-params">binary_data</span>):</span><font></font>
        chunks = []<font></font>
<font></font>
        <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> binary_data.split(<span class="hljs-string">b'OggS'</span>)[<span class="hljs-number">1</span>:]:
            <span class="hljs-keyword">if</span> <span class="hljs-string">b'OpusTags'</span> <span class="hljs-keyword">in</span> chunk:<font></font>
                pos = chunk.index(<span class="hljs-string">b'OpusTags'</span>) + <span class="hljs-number">12</span><font></font>
                size = len(chunk)<font></font>
                chunk = chunk[:pos] + <span class="hljs-string">b'#\x00\x00\x00\x00ENCODER=SpeechKit Mobile SDK v3.28.0'</span>
                chunk += <span class="hljs-string">b"\x00"</span> * (size - len(chunk))<font></font>
<font></font>
            chunks.append(<span class="hljs-string">b'\x00\x00\x00\x01OggS'</span> + chunk)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> chunks<font></font>
<font></font>
</code></pre><br>
     ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"> </a>.<br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. notas pequenas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inicialmente, apenas usu√°rios com uma assinatura poderiam usar o bot devido ao fato de que o servi√ßo pode ser usado em um n√∫mero limitado de pa√≠ses (sem assinatura) e o servidor com o bot est√° localizado na Europa. O problema √© resolvido usando um proxy para executar solicita√ß√µes de usu√°rios sem uma assinatura. O servidor proxy est√° localizado em Moscou. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° uma escolha de p√°ginas, mas √© limitado a 100 (n√£o √© poss√≠vel adicionar mais bot√µes, restri√ß√£o de telegrama). Algumas solicita√ß√µes de p√°gina comuns t√™m muito mais p√°ginas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na pesquisa Yandex, o n√∫mero de elementos na p√°gina √© codificado. Quantas faixas, quantas listas de reprodu√ß√£o. √Äs vezes, isso nem corresponde √† quantidade de dados exibidos na frente. H√° uma altera√ß√£o de p√°gina, o n√∫mero de elementos est√° flutuando. Portanto, no bot tamb√©m salta, o que n√£o √© muito bonito. E combinar o paginador deles com o dele - algo assim. Em outros lugares onde √© poss√≠vel solicitar um certo n√∫mero de elementos por p√°gina, tudo √© perfeito. A mensagem de voz ap√≥s a implementa√ß√£o da pesquisa no bot √© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/MarshalC/416</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao encaminhar o √°udio no Telegram, o autor √© perdido e designado para quem fez o encaminhamento. Portanto, todas as faixas s√£o enviadas com a assinatura do nome de usu√°rio do bot. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mensagem de voz com tudo o que conheci ap√≥s a implementa√ß√£o do r√°dio na biblioteca - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/MarshalC/422</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(sobre a cadeia de trilhas, passando por isso enviando um monte de feedback, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">batch_id</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apesar de ser outro artigo sobre o bot do Telegram, voc√™ o leu at√© aqui, provavelmente porque estava interessado em um dos itens do corte e isso √© maravilhoso, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muito obrigado</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infelizmente, n√£o abri completamente o c√≥digo fonte do bot (porque em alguns lugares eu preciso refatorar). </font><font style="vertical-align: inherit;">Muito foi descrito neste artigo, mas alguns aspectos, por exemplo, dos teclados virtuais e sua gera√ß√£o n√£o s√£o afetados. </font><font style="vertical-align: inherit;">Na maioria das vezes, o que n√£o est√° no artigo √© apenas trabalhar com minha biblioteca, nada de interessante.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As aulas em torno das quais tudo gira, mostrei na forma em que elas est√£o agora. Eu admito que h√° erros, mas tudo funciona por um longo tempo. Em alguns lugares, gosto do meu c√≥digo, em outros, n√£o - e isso √© normal. N√£o esque√ßa que trabalhar com o WS para reconhecimento √© uma solu√ß√£o no joelho. Pronto para ler cr√≠ticas fundamentadas nos coment√°rios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Embora o bot tenha sido planejado mesmo quando comecei a escrever a biblioteca, deserdei essa ideia, mas, aparentemente, voltei (era chato). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yandex.Music Bot - um projeto que comprova a adequa√ß√£o do uso da </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biblioteca para trabalhar com a API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em projetos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muito obrigado a mam√£e, Yana, Sana'a, Gl√≥ria. </font><font style="vertical-align: inherit;">Algu√©m por revisar erros, outros por dicas, sem os quais alguns pontos deste artigo podem n√£o ter existido, e outros simplesmente por avaliar o artigo antes da publica√ß√£o. </font><font style="vertical-align: inherit;">Arthur por picci para o artigo, Lyod pelo logotipo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Agora, tenho um problema agudo com a distribui√ß√£o ap√≥s o estudo. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ estiver pronto para me ligar, diga-me para onde enviar o curr√≠culo, me entreviste, por favor. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todos os meus contatos est√£o no perfil. </font><font style="vertical-align: inherit;">O tempo est√° queimando, espero por voc√™. </font><font style="vertical-align: inherit;">Segundo a lei, s√≥ posso trabalhar na Rep√∫blica da Bielorr√∫ssia. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PPS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Este foi o segundo artigo de tr√™s, mas sem a menor id√©ia, terei tempo para fazer outro projeto sobre esse t√≥pico e se √© necess√°rio. </font><font style="vertical-align: inherit;">Vou revelar publicamente o t√≥pico dele - o cliente de plataforma cruzada Yandex.Music.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt487428/">https://habr.com/ru/post/pt487428/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt487418/index.html">O que √© o SAP?</a></li>
<li><a href="../pt487420/index.html">Sound War Z. Testing MusicDealer alto-falantes e fones de ouvido</a></li>
<li><a href="../pt487422/index.html">Responsabilidades do administrador do Salesforce: o que deve ser feito e quando</a></li>
<li><a href="../pt487424/index.html">Como escalar de 1 a 100.000 usu√°rios</a></li>
<li><a href="../pt487426/index.html">A flexibilidade determina o sucesso.</a></li>
<li><a href="../pt487430/index.html">Quais habilidades s√£o necess√°rias para criar um aplicativo iOS? Relat√≥rio Yandex</a></li>
<li><a href="../pt487432/index.html">Seguindo os passos do DevConf e CfgMgmtCamp ou o que voc√™ pode aprender indo ao orador em 2 confer√™ncias internacionais em 2 semanas</a></li>
<li><a href="../pt487438/index.html">Como criar uma empresa de TI do zero - sem experi√™ncia neste campo e habilidades de programa√ß√£o?</a></li>
<li><a href="../pt487444/index.html">‚ÄúEnquanto tomava caf√©, faturava e recebia um pagamento‚Äù - inova√ß√µes que permitem a realiza√ß√£o de neg√≥cios 24 horas por dia, 7 dias por semana</a></li>
<li><a href="../pt487446/index.html">Uma empresa pode "possuir" cores?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>