<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë£ üà∂ üêÖ Telegram + 1C + Webhooks + Apache + Sertifikat yang ditandatangani sendiri üèÅ üë©üèæ‚Äçü§ù‚Äçüë®üèΩ üí®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Banyak baris yang ditulis tentang integrasi Telegram dan 1C. Tapi tidak ada tempat saya melihat instruksi lengkap untuk menginstal dan mengkonfigurasi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Telegram + 1C + Webhooks + Apache + Sertifikat yang ditandatangani sendiri</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488374/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Banyak baris yang ditulis tentang integrasi Telegram dan 1C. </font><font style="vertical-align: inherit;">Tapi tidak ada tempat saya melihat instruksi lengkap untuk menginstal dan mengkonfigurasi webhooks. </font><font style="vertical-align: inherit;">Saya akan mencoba menulisnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk semua ini kita perlu (atau akan lebih tepat untuk mengatakan apa yang digunakan oleh saya):</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache 2.2.24</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenSSL (disertakan dengan instalasi Apache)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1C (dengan modul server web)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Domain sendiri </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bot buatan di Telegram (saya tidak akan menjelaskan pembuatannya, karena cukup sepele)</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diasumsikan bahwa semua perangkat lunak yang Anda instal.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, mari kita mulai dengan mendapatkan sertifikat. </font><font style="vertical-align: inherit;">Buka baris perintah dan jalankan kode berikut:</font></font><br>
<br>
<pre><code class="bash hljs">openssl req -newkey rsa:2048 -sha256 -nodes -keyout YOURPRIVATE.key -x509 -days 365 -out YOURPUBLIC.pem -subj <span class="hljs-string">"/C=US/ST=New York/L=Brooklyn/O=Example Brooklyn Company/CN=YOURDOMAIN.EXAMPLE"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di mana: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
YOURPRIVATE.key adalah kunci pribadi sertifikat. </font><font style="vertical-align: inherit;">Ini akan digunakan di </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
apache YOURPUBLIC.pem - kunci publik sertifikat. </font><font style="vertical-align: inherit;">Akan digunakan saat mendaftarkan webhook </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
YOURDOMAIN. CONTOH - alamat domain Anda dengan webhook. </font><font style="vertical-align: inherit;">Itu masih harus cocok dengan alamat webhook !!! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah mengeksekusi kode ini, file-file utama akan muncul di folder openssl (saya punya "C: \ Program Files \ Apache Software Foundation \ Apache2.2 \ bin"). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya menyalinnya ke folder conf Apache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari beralih ke mengkonfigurasi Apache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya telah melihat banyak cara berbeda. </font><font style="vertical-align: inherit;">Berikut ini berfungsi untuk saya: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baris berikut ditambahkan ke httpd.conf:</font></font><br>
<br>
<pre><code class="bash hljs">Listen 443 </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sehingga Apache "mendengarkan" ke port 443. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Blok &lt;IfModule ssl_module&gt; memiliki bentuk berikut:</font></font><br>
<br>
<pre><code class="apache hljs"><span class="hljs-section">&lt;IfModule ssl_module&gt;</span>
<span class="hljs-attribute">SSLMutex</span> default
<span class="hljs-attribute">SSLSessionCache</span> none
<span class="hljs-section">&lt;/IfModule&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di bagian paling akhir, baris ditambahkan di mana saya menunjukkan jalur ke sertifikat:</font></font><br>
<br>
<pre><code class="apache hljs"><span class="hljs-attribute">SSLEngine</span> <span class="hljs-literal">On</span>
<span class="hljs-attribute">SSLCertificateFile</span> conf/YOURPUBLIC.pem
<span class="hljs-attribute">SSLCertificateKeyFile</span> conf/YOURPRIVATE.key</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan batalkan komentar pada baris: </font></font><br>
<br>
<pre><code class="apache hljs"><span class="hljs-attribute"><span class="hljs-nomarkup">LoadModule</span></span> ssl_module modules/mod_ssl.so </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam konfigurasi kami membuat layanan HTTP. </font><font style="vertical-align: inherit;">Dialah yang akan menjawab telegram dan memproses bandingnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kasus saya, parameter berikut ditentukan: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nama: TGWebhuk RootURL </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
: webhook </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penggunaan kembali sesi: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jangan gunakan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Saya tidak bekerja dengan mode otomatis) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seumur Hidup: 20 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pola URL: Template apa pun dibuat dengan dua metode: GET dan POST </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/fec/3a5/73f/fec3a573f980da4642b834dba5b66f12.jpg" alt="gambar"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/e74/a19/2ef/e74a192eff11c8495c6088c7f0e8c7da.jpg" alt="gambar"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/16c/bb0/871/16cbb087152b6a436da920423b793266.jpg" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Method handler dibuat standar. </font><font style="vertical-align: inherit;">Saya akan menambahkan yang berikut ini ke POST handler, hanya untuk memeriksa koneksi:</font></font><br>
<br>
<pre><code class="1c hljs"><span class="hljs-function"><span class="hljs-keyword"></span> <span class="hljs-title">POST</span>(<span class="hljs-params"></span></span>)<font></font>
<font></font>
	(<span class="hljs-string">""</span>); <span class="hljs-comment">//chat_id</span>
	 = <span class="hljs-keyword"></span> <span class="hljs-type">HTTP</span>(<span class="hljs-number">200</span>);
	<span class="hljs-keyword"></span> ;<font></font>
	<font></font>
<span class="hljs-function"><span class="hljs-keyword"></span></span><font></font>
<font></font>
<font></font>
<span class="hljs-meta">&amp;<span class="hljs-meta-keyword"></span></span>
<span class="hljs-function"><span class="hljs-keyword"></span> <span class="hljs-title"></span>(<span class="hljs-params"></span></span>)<font></font>
	<font></font>
		 = <span class="hljs-string">" "</span>;<font></font>
		 = <span class="hljs-string">""</span>;<span class="hljs-comment">//  telegram</span>
		 = <span class="hljs-string">"api.telegram.org"</span>;<font></font>
	     = <span class="hljs-string">"bot"</span> +  + <span class="hljs-string">"/sendMessage?chat_id="</span> + <span class="hljs-built_in"></span>(<span class="hljs-built_in"></span>(, <span class="hljs-string">"=; =; =."</span>), <span class="hljs-string">"."</span>, <span class="hljs-string">""</span>) + <span class="hljs-string">"&amp;text="</span> + ;<font></font>
   		  =  <span class="hljs-keyword"></span> <span class="hljs-type">HTTP</span>(,<span class="hljs-number">443</span>,,,,,<span class="hljs-keyword"></span> <span class="hljs-type">OpenSSL</span>());
		<span class="hljs-type"></span> = <span class="hljs-keyword"></span> <span class="hljs-type">HTTP</span>();<font></font>
		 = .(<span class="hljs-type"></span>);<font></font>
	<font></font>
<span class="hljs-function"><span class="hljs-keyword"></span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetap mempublikasikan database dan melampirkan webhook. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Publikasi dilakukan seperti biasa, Anda hanya perlu menambahkan tanda centang pada publikasi layanan HTTP: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/c94/684/b21/c94684b2199e466765bafb47912798c1.jpg" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai langkah terakhir, kami akan melampirkan 1C kami ke telegram. </font><font style="vertical-align: inherit;">Untuk ini, saya menggunakan halaman html sederhana dengan kode berikut:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"https://api.telegram.org/bot&lt;&gt;/setwebhook"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">"multipart/form-data"</span>&gt;</span><font></font>
    Select Certificate to upload:<font></font>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"certificate"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"fileToUpload"</span>&gt;</span>
	URL: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"url"</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">"https://&lt;YOURWEBSITE&gt;/&lt;YOUR_PHP_URL&gt;"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Upload Certificate"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"submit"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam formulir, cukup pilih kunci publik dan masukkan path lengkap ke layanan http kami. </font><font style="vertical-align: inherit;">Saya mengingatkan Anda bahwa path lengkap ke layanan akan terlihat seperti ini: </font></font><br>
<br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YourDomain / BaseName / hs / ServiceName / v1</font></font></a><br>
</b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Tolong jangan menendang kode, beberapa hal sengaja dilakukan oleh hardcode, karena </font><font style="vertical-align: inherit;">semua ini dilakukan semata-mata untuk tujuan demonstrasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Publikasi ini ditulis karena </font><font style="vertical-align: inherit;">Saya belum menemukan satu contoh pun bekerja pada bekerja dengan webhooks di situs, kecuali untuk konstruktor bot Telegram. </font><font style="vertical-align: inherit;">Tetapi dibayar dan, mungkin, tidak semua orang membutuhkannya dalam bentuk ini.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Arsip berisi instalasi Apache 2.2.24 bersama dengan openssl (untuk beberapa alasan, saya butuh waktu lama untuk menemukannya), file html untuk mendaftarkan hook web, file konfigurasi Apache dan konfigurasi cf dengan layanan http dan contoh pengiriman pesan pengujian. </font><font style="vertical-align: inherit;">Ini opsional untuk diunduh, karena </font><font style="vertical-align: inherit;">semua konten ada di artikel.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id488360/index.html">Mitos Data Besar dan Budaya Digital</a></li>
<li><a href="../id488362/index.html">Klasifikasi multi-tag</a></li>
<li><a href="../id488366/index.html">Dan lagi tentang "Informasi zona waktu salah untuk zona waktu Rusia" [. Net bug, ID: 693286]</a></li>
<li><a href="../id488368/index.html">Apa yang saya pelajari saat mengerjakan proyek skala besar pertama saya</a></li>
<li><a href="../id488370/index.html">TDD untuk mikrokontroler. Bagian 2: Bagaimana mata-mata menyingkirkan kecanduan</a></li>
<li><a href="../id488376/index.html">Ketika prinsip "ke neraka dengan segalanya, ambil dan lakukan itu!" tidak bekerja: catatan penunda</a></li>
<li><a href="../id488378/index.html">Secara singkat tentang penamaan di JS</a></li>
<li><a href="../id488380/index.html">Awal termudah dalam STM melalui "satu tempat"</a></li>
<li><a href="../id488382/index.html">Saya menambahkan penundaan 3-25 detik ke situs yang saya kunjungi</a></li>
<li><a href="../id488386/index.html">Kasus untuk menerapkan alat analisis anomali jaringan: serangan melalui plug-in browser</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>