<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👒 ⛓️ 👨‍👩‍👧 “让我们使用Kubernetes！” 您现在有8个问题 🛍️ 🕜 💹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="如果您使用Docker，那么下一个逻辑步骤似乎是切换到Kubernetes，它是K8，对吗？好吧，假设。但是，为500名软件工程师同时开发一个应用程序而设计的解决方案与50人的解决方案完全不同。而由5个程序员组成的团队的解决方案则完全是另外一回事了。
 
 如果您在一个小型团队中工作，那么Kuber...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>“让我们使用Kubernetes！” 您现在有8个问题</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/it-grad/blog/493142/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您使用Docker，那么下一个逻辑步骤似乎是切换到Kubernetes，它是K8，对吗？</font><font style="vertical-align: inherit;">好吧，假设。</font><font style="vertical-align: inherit;">但是，为500名软件工程师同时开发一个应用程序而设计的解决方案与50人的解决方案完全不同。</font><font style="vertical-align: inherit;">而由5个程序员组成的团队的解决方案则完全是另外一回事了。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您在一个小型团队中工作，那么Kubernetes很可能不适合您。</font><font style="vertical-align: inherit;">这将给您带来很多痛苦，以换取极其微薄的收益。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们看看为什么会发生这种情况。</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个人都喜欢“运动部件”</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes的变化和变化很多：概念，子系统，流程，机器，代码...这一切都意味着很多困难。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">几辆车</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes是一个分布式系统：它具有一台控制其余工人的主机。</font><font style="vertical-align: inherit;">每台机器都在容器中执行工作。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们已经在讨论至少两个物理机或虚拟机，这仅是使其工作所必需的。</font><font style="vertical-align: inherit;">但实际上，您得到的只是一辆车。</font><font style="vertical-align: inherit;">如果要扩展（这就是狗被埋的地方！），则将需要三个，四个或多达十七个虚拟机。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非常非常多的代码</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2020年3月开始的Kubernetes代码库在Go上包含了超过580,000行代码。这只是干净的代码，不包括注释，空白行和供应商软件包。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">《 2019年安全审查》</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对代码库的描述如下：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
“ Kubernetes代码库有很大的改进空间。它庞大而复杂，包含大部分代码，几乎没有文档，并且有大量依赖关系，包括不属于Kubernetes的系统。同样在代码库中，有很多情况下可以重新实现逻辑，这些逻辑可以集中在支持库中，这将降低复杂性，简化更正并减少代码库各个区域中的文档负载。”</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
老实说，在其他许多大型项目中也可以这样说，但是如果您不希望应用程序失败，那么所有这些代码都应正确运行。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">架构，操作，配置和概念上的复杂性</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes是一个综合系统，具有许多不同的服务，系统等等。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在启动唯一的应用程序之前，您将必须提供以下经过极大简化的体系结构（原始图像来自Kubernetes文档）：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/w2/rx/h8/w2rxh88tfa7n3dmfhvyrahxjd0k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
K8s概念文档包括许多纯粹的“教育”内容，例如以下代码段：</font></font><br>
<blockquote>In Kubernetes, an EndpointSlice contains references to a set of network endpoints. The EndpointSlice controller automatically creates EndpointSlices for a Kubernetes Service when a selector is specified. These EndpointSlices will include references to any Pods that match the Service selector. EndpointSlices group network endpoints together by unique Service and Port combinations.<br>
By default, EndpointSlices managed by the EndpointSlice controller will have no more than 100 endpoints each. Below this scale, EndpointSlices should map 1:1 with Endpoints and Services and have similar performance.</blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实际上，我了解这是什么意思，但是请注意您需要学习多少个概念：EndpointSlice，Service，选择器，Pod，Endpoint。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
而且-是的，大多数时候您不会使用所有这些功能。因此，大多数时候您根本不需要Kubernetes。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是另一个随机代码段：</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，发送到ClusterIP或NodePort服务的流量可以路由到该服务的任何后端地址。</font><font style="vertical-align: inherit;">从Kubernetes 1.7开始，可以将“外部”流量路由到在接收流量的节点上运行的Pod，但是ClusterIP Services不支持此功能，并且更复杂的拓扑（如分区路由）是不可能的。</font><font style="vertical-align: inherit;">服务拓扑功能通过允许服务创建者基于源节点和目标节点的节点标签定义路由流量的策略来解决此问题。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下是安全评论对此的看法：</font></font><br>
<blockquote>Kubernetes —   ,    .   ,     Kubernetes —  ,       ,    ,     .</blockquote><br>
<h3>  </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您在Kubernetes上获得的知识越多，正常的开发过程就越困难：您需要所有这些概念（Pod，Deployment，Service等）才能使代码正常工作。因此，即使是仅通过虚拟机或嵌套的Docker容器进行测试，也需要升级成熟的K8s系统。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
而且，由于您的应用程序在本地运行变得更加困难，因此解决此问题的方法很多，从工作台环境到将本地进程代理到集群（几年前我写过</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此工具</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），再将远程进程代理到本地计算机</font><font style="vertical-align: inherit;">，使开发工作变得复杂</font><font style="vertical-align: inherit;">... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以选择任何选项，但没有一个是完美的。根本不使用Kubernetes的最简单方法。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微服务（这是一个坏主意）</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
第二个问题是，由于系统允许您运行许多服务，因此您必须编写许多服务。</font><font style="vertical-align: inherit;">馊主意。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分布式应用程序很难编写质量。</font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实际上</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，运动的部件越多，这些问题对工作的干扰就越大。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分布式应用程序很难调试。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您将需要一种全新的调试和日志记录工具类型，它仍然比单片应用程序的日志要少。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
微服务是组织中的扩展技术之一：当您有500个开发人员为一个生产性网站提供服务时，如果这允许开发团队独立工作，那么承担大规模分布式系统的成本是有意义的。</font><font style="vertical-align: inherit;">因此，每个由5人组成的团队将收到一个微服务，并假装所有其他微服务都是您不应该信任的外部服务。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您的整个团队由5个人组成，则您有20个微服务，并且不可抗力的情况不会迫使您创建分布式系统，而这会导致计算错误。</font><font style="vertical-align: inherit;">而不是像大型公司那样，每1个微服务5个人员，而是0.25个人员。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetes根本有用吗？</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缩放比例</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您需要认真的可扩展性，Kubernetes可能会派上用场。</font><font style="vertical-align: inherit;">但是，让我们看看您有什么选择：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以在云中购买虚拟机，它们将具有多达416个虚拟CPU和8 TB RAM，即完全令人赞叹的功能。</font><font style="vertical-align: inherit;">这将花费您一分钱，但操作起来非常简单。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">许多简单的Web应用程序可以使用Heroku等服务以相当容易的方式进行扩展。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然，假设可以使用的虚拟机数量也会增加：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大多数应用程序不需要显着的扩展，它们将具有足够的高质量优化。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩展大多数Web应用程序的瓶颈是数据库，而不是Web Worker</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可靠性</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
零件越多，发生错误的可能性就越大。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过提高可靠性（运行状况检查，滚动部署）来增强Kubernetes的功能，在许多情况下，它们已经可以内置或实现得更加容易。例如，nginx可以对工作进程进行运行状况检查，还可以使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docker-autoheal</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或类似的方法自动重启这些进程。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果你特别关心的停机时间，到会参观，你不应该首先想到“我怎么减少停机时间从1秒到1毫秒）进行部署时，但它应该是”我如何确保</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改数据库架构允许回滚</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如果我在某处？”</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
并且，如果您需要没有一台机器的可靠Web工作人员来作为故障点，那么有很多方法可以在没有Kubernetes的情况下实现这一点。 </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最佳实践？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实际上，自然界中不存在最佳实践。</font><font style="vertical-align: inherit;">对于每种特定情况，只有最佳实践。</font><font style="vertical-align: inherit;">因此，如果某种趋势在流行并且很流行，这并不意味着完全是您的正确选择。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在某些情况下，Kubernetes是最佳选择。</font><font style="vertical-align: inherit;">剩下的就是浪费时间。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
除非您迫切需要所有这些复杂性，否则您将有多种工具来解决问题：用于一台机器的Docker Compose，</font><font style="vertical-align: inherit;">用于编排的</font><font style="vertical-align: inherit;">Hashicorp的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nomad</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，用于扩展的Heroku和类似系统以及</font><font style="vertical-align: inherit;">用于计算管道的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shakemake之</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类的</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">工具</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编辑的后记</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作为云提供商，我们经常遇到各种各样的客户，从小型初创企业到具有复杂业务流程和相关基础架构要求的大型组织。</font><font style="vertical-align: inherit;">无论技术有多么出色，始终都有先例，其应用将导致不必要的困难。</font><font style="vertical-align: inherit;">您应始终从情况出发，仔细权衡可用选项的优缺点。</font><font style="vertical-align: inherit;">文章的作者在某种程度上加深了他的色彩，但他的信息很明确：有时候，为了做出正确的决定，值得远离趋势并公正地评估您的项目。</font><font style="vertical-align: inherit;">这将节省开发人员的力量，并且公司资源的使用将使其更合适。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN493130/index.html">Почему не стоит бояться коронавируса: мифы и почти правда о COVID-2019</a></li>
<li><a href="../zh-CN493132/index.html">围绕数据表</a></li>
<li><a href="../zh-CN493136/index.html">Unity Storage中的FAST VP：如何工作</a></li>
<li><a href="../zh-CN493138/index.html">跟我说话：语音机器人今天能做什么</a></li>
<li><a href="../zh-CN493140/index.html">Cipollino历险记：Flant隔离IT任务</a></li>
<li><a href="../zh-CN493146/index.html">您今天可以做的令人兴奋的附带项目</a></li>
<li><a href="../zh-CN493150/index.html">使用思科路由器“远程”</a></li>
<li><a href="../zh-CN493152/index.html">神经网络和过程挖掘：尝试结识朋友</a></li>
<li><a href="../zh-CN493158/index.html">Loghouse 0.3-我们期待已久的Kubernetes日志系统更新</a></li>
<li><a href="../zh-CN493160/index.html">我们如何在2019年改进hh.ru上的智能搜索：信息图表</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>