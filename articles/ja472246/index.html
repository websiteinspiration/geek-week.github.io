<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⏯️ 🐦 🍜 React + IndexDb +自動更新=ほとんどAsyncRedux 👨🏿‍🤝‍👨🏽 ✊ 🔡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="この記事では、ReactJSで作成されたプロジェクトで使用するためにIndexDB（最新のブラウザーに組み込まれているデータベース）を準備する方法を段階的に説明します。その結果、アプリケーションのReduxストアにあるかのように、IndexDBからのデータを便利に使用できます。
 
 Indexdb...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>React + IndexDb +自動更新=ほとんどAsyncRedux</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472246/"><img width="300" align="right" src="https://habrastorage.org/webt/ak/5r/t4/ak5rt4e4mavxwvxlaidpfgiie0g.jpeg"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事では、ReactJSで作成されたプロジェクトで使用するためにIndexDB（最新のブラウザーに組み込まれているデータベース）を準備する方法を段階的に説明します。</font><font style="vertical-align: inherit;">その結果、</font><font style="vertical-align: inherit;">アプリケーションの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reduxストア</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にあるかのように、IndexDBからのデータを便利に使用でき</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Indexdb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-これはドキュメント指向のDBMSであり、ブラウザ側で比較的少量（単位は数十メガバイト）の構造化データを一時的に保存するための便利なツールです。</font><font style="vertical-align: inherit;">IndexDBを使用する必要がある標準的なタスクには、クライアント側のビジネスディレクトリのデータのキャッシュ（国、都市、コードによる通貨の名前など）が含まれます。</font><font style="vertical-align: inherit;">これらをクライアント側にコピーした後、サーバーからこれらのディレクトリから更新をダウンロードできるのはたまにです（または全体-小さい）。ブラウザウィンドウを開くたびにダウンロードする必要はありません。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
非標準で非常に物議を醸すが、IndexDBを使用する実用的な方法があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべての</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビジネスオブジェクトの</font><font style="vertical-align: inherit;">データをキャッシュし</font><font style="vertical-align: inherit;">て、ブラウザー側で広範な並べ替え機能とフィルター機能を使用できるようにする</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redux Storeの代わりにIndexDBにアプリケーションのステータスを保存する</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IndexDBとRedux Storeの3つの重要な違いは、私たちにとって重要です。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexDBは、ページを離れるときにクリアされない外部ストレージです。</font><font style="vertical-align: inherit;">さらに、それは複数の開いているタブでも同じです（これにより、予期しない動作が発生する場合があります）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexDBは完全に非同期のDBMSです。</font><font style="vertical-align: inherit;">すべての操作（開く、読み取り、書き込み、検索）は非同期です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexDBは（簡単な方法で）JSONに格納できず、Reduxの洗脳技術を使用してスナップショットを作成し、デバッグを容易にし、過去に旅することができません。</font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ0：タスクリスト</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タスクリストの典型的な例。</font><font style="vertical-align: inherit;">現在の唯一のコンポーネントの状態で状態を保存するバリアント</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リストをコンポーネント状態で保存するタスクリストコンポーネントの実装</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword">import</span> React, { PureComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> Button <span class="hljs-keyword">from</span> <span class="hljs-string">'react-bootstrap/Button'</span>;
<span class="hljs-keyword">import</span> counter <span class="hljs-keyword">from</span> <span class="hljs-string">'common/counter'</span>;
<span class="hljs-keyword">import</span> Form <span class="hljs-keyword">from</span> <span class="hljs-string">'react-bootstrap/Form'</span>;
<span class="hljs-keyword">import</span> Table <span class="hljs-keyword">from</span> <span class="hljs-string">'react-bootstrap/Table'</span>;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Step0</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PureComponent</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">super</span>( ...arguments );<font></font>
<font></font>
    <span class="hljs-keyword">this</span>.state = {
      <span class="hljs-attr">newTaskText</span>: <span class="hljs-string">''</span>,
      <span class="hljs-attr">tasks</span>: [<font></font>
        { <span class="hljs-attr">id</span>: counter(), <span class="hljs-attr">text</span>: <span class="hljs-string">'Sample task'</span> },<font></font>
      ],<font></font>
    };<font></font>
<font></font>
    <span class="hljs-keyword">this</span>.handleAdd = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
      <span class="hljs-keyword">this</span>.setState( <span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> ( {
        <span class="hljs-attr">tasks</span>: [ ...state.tasks, { <span class="hljs-attr">id</span>: counter(), <span class="hljs-attr">text</span>: state.newTaskText } ],
        <span class="hljs-attr">newTaskText</span>: <span class="hljs-string">''</span>,<font></font>
      } ) );<font></font>
    };<font></font>
    <span class="hljs-keyword">this</span>.handleDeleteF = <span class="hljs-function"><span class="hljs-params">idToDelete</span> =&gt;</span> <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-keyword">this</span>.setState( <span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> ( {
      <span class="hljs-attr">tasks</span>: state.tasks.filter( <span class="hljs-function">(<span class="hljs-params"> { id } </span>) =&gt;</span> id !== idToDelete ),<font></font>
    } ) );<font></font>
    <span class="hljs-keyword">this</span>.handleNewTaskTextChange = <span class="hljs-function">(<span class="hljs-params"> { target: { value } } </span>) =&gt;</span> <span class="hljs-keyword">this</span>.setState( {
      <span class="hljs-attr">newTaskText</span>: value || <span class="hljs-string">''</span>,<font></font>
    } );<font></font>
  }<font></font>
<font></font>
  render() {<font></font>
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Table</span> <span class="hljs-attr">bordered</span> <span class="hljs-attr">hover</span> <span class="hljs-attr">striped</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>#<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Text<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">th</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
        { this.state.tasks.map( task =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{task.id}</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{task.id}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{task.text}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
            <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.handleDeleteF(</span> <span class="hljs-attr">task.id</span> )}
            <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span>
            <span class="hljs-attr">variant</span>=<span class="hljs-string">"danger"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span> ) }
        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"+1"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">td</span> /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Form.Control</span>
            <span class="hljs-attr">onChange</span>=<span class="hljs-string">{this.handleNewTaskTextChange}</span>
            <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"  "</span>
            <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>
            <span class="hljs-attr">value</span>=<span class="hljs-string">{this.state.newTaskText</span> || ''} /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
            <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.handleAdd}</span>
            <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span>
            <span class="hljs-attr">variant</span>=<span class="hljs-string">"primary"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Table</span>&gt;</span></span>;<font></font>
  }<font></font>
<font></font>
}<font></font>
</code></pre>(<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">   github</a>)</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これまでのところ、タスクを伴うすべての操作は同期しています。タスクの追加に3秒かかる場合、ブラウザは3秒間フリーズします。もちろん、私たちはすべてを記憶に残していますが、それについて考えることはできません。サーバーまたはローカルデータベースでの処理を含める場合は、非同期の美しい処理にも注意する必要があります。たとえば、ブロックは、要素を追加または削除しているときに、テーブル（または個々の要素）を処理します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今後UIの説明を繰り返さないようにするために、UIを別のTaskListコンポーネントに配置します。その唯一のタスクは、タスクリストのHTMLコードを生成します。同時に、通常のボタンをブートストラップボタンの特別なラッパーに置き換えます。これにより、このハンドラーが非同期関数であっても、ボタンハンドラーがその実行を完了するまでボタンがブロックされます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"> ,     react state</b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword">import</span> React, { PureComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> counter <span class="hljs-keyword">from</span> <span class="hljs-string">'common/counter'</span>;
<span class="hljs-keyword">import</span> TaskList <span class="hljs-keyword">from</span> <span class="hljs-string">'../common/TaskList'</span>;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Step01</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PureComponent</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">super</span>( ...arguments );
    <span class="hljs-keyword">this</span>.state = { <span class="hljs-attr">tasks</span>: [<font></font>
      { <span class="hljs-attr">id</span>: counter(), <span class="hljs-attr">text</span>: <span class="hljs-string">'Sample task'</span> },<font></font>
    ] };<font></font>
<font></font>
    <span class="hljs-keyword">this</span>.handleAdd = <span class="hljs-function"><span class="hljs-params">newTaskText</span> =&gt;</span> {
      <span class="hljs-keyword">this</span>.setState( <span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> ( {
        <span class="hljs-attr">tasks</span>: [ ...state.tasks, { <span class="hljs-attr">id</span>: counter(), <span class="hljs-attr">text</span>: newTaskText } ],<font></font>
      } ) );<font></font>
    };<font></font>
    <span class="hljs-keyword">this</span>.handleDelete = <span class="hljs-function"><span class="hljs-params">idToDelete</span> =&gt;</span> <span class="hljs-keyword">this</span>.setState( <span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> ( {
      <span class="hljs-attr">tasks</span>: state.tasks.filter( <span class="hljs-function">(<span class="hljs-params"> { id } </span>) =&gt;</span> id !== idToDelete ),<font></font>
    } ) );<font></font>
  }<font></font>
<font></font>
  render() {<font></font>
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>       <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">TaskList</span>
        <span class="hljs-attr">onAdd</span>=<span class="hljs-string">{this.handleAdd}</span>
        <span class="hljs-attr">onDelete</span>=<span class="hljs-string">{this.handleDelete}</span>
        <span class="hljs-attr">tasks</span>=<span class="hljs-string">{this.state.tasks}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>;<font></font>
  }<font></font>
<font></font>
}<font></font>
</code></pre>(<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">   github</a>)</div></div><br>
<div class="spoiler"><b class="spoiler_title"> ,        </b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword">import</span> React, { PureComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> Button <span class="hljs-keyword">from</span> <span class="hljs-string">'./AutoDisableButtonWithSpinner'</span>;
<span class="hljs-keyword">import</span> Form <span class="hljs-keyword">from</span> <span class="hljs-string">'react-bootstrap/Form'</span>;
<span class="hljs-keyword">import</span> Table <span class="hljs-keyword">from</span> <span class="hljs-string">'react-bootstrap/Table'</span>;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaskList</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PureComponent</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">super</span>( ...arguments );<font></font>
<font></font>
    <span class="hljs-keyword">this</span>.state = {
      <span class="hljs-attr">newTaskAdding</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">newTaskText</span>: <span class="hljs-string">''</span>,<font></font>
    };<font></font>
<font></font>
    <span class="hljs-keyword">this</span>.handleAdd = <span class="hljs-keyword">async</span>() =&gt; {
      <span class="hljs-keyword">this</span>.setState( { <span class="hljs-attr">newTaskAdding</span>: <span class="hljs-literal">true</span> } );
      <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">//   ,    </span>
        <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.props.onAdd( <span class="hljs-keyword">this</span>.state.newTaskText );
        <span class="hljs-keyword">this</span>.setState( { <span class="hljs-attr">newTaskText</span>: <span class="hljs-string">''</span> } );<font></font>
      } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">this</span>.setState( { <span class="hljs-attr">newTaskAdding</span>: <span class="hljs-literal">false</span> } );<font></font>
      }<font></font>
    };<font></font>
<font></font>
    <span class="hljs-keyword">this</span>.handleDeleteF = <span class="hljs-function"><span class="hljs-params">idToDelete</span> =&gt;</span>
      <span class="hljs-keyword">async</span>() =&gt; <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.props.onDelete( idToDelete );<font></font>
<font></font>
    <span class="hljs-keyword">this</span>.handleNewTaskTextChange = <span class="hljs-function">(<span class="hljs-params"> { target: { value } } </span>) =&gt;</span> <span class="hljs-keyword">this</span>.setState( {
      <span class="hljs-attr">newTaskText</span>: value || <span class="hljs-string">''</span>,<font></font>
    } );<font></font>
  }<font></font>
<font></font>
  render() {<font></font>
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Table</span> <span class="hljs-attr">bordered</span> <span class="hljs-attr">hover</span> <span class="hljs-attr">striped</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>#<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Text<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">th</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
        { this.props.tasks.map( task =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{task.id}</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{task.id}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{task.text}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
            <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.handleDeleteF(</span> <span class="hljs-attr">task.id</span> )}
            <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span>
            <span class="hljs-attr">variant</span>=<span class="hljs-string">"danger"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span> ) }
        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"+1"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">td</span> /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Form.Control</span>
            <span class="hljs-attr">disabled</span>=<span class="hljs-string">{this.state.newTaskAdding}</span>
            <span class="hljs-attr">onChange</span>=<span class="hljs-string">{this.handleNewTaskTextChange}</span>
            <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"  "</span>
            <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>
            <span class="hljs-attr">value</span>=<span class="hljs-string">{this.state.newTaskText</span> || ''} /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
            <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.handleAdd}</span>
            <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span>
            <span class="hljs-attr">variant</span>=<span class="hljs-string">"primary"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Table</span>&gt;</span></span>;<font></font>
  }<font></font>
<font></font>
}<font></font>
</code></pre>(<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">   github</a>)</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すでにサンプルコードでは、キーワードasync / awaitを確認できます。 Async / await構文を使用すると、Promiseで機能するコードの量を大幅に削減できます。 awaitキーワードを使用すると、Promiseを返す関数からの応答を、それが（then（）で結果を待つのではなく）通常の関数であるかのように待つことができます。もちろん、非同期関数は魔法のように同期関数に変わるわけではありません。たとえば、awaitを使用すると、実行スレッドが中断されます。しかし、コードはより簡潔で理解しやすくなり、awaitはループとtry / catch / finallyコンストラクトの両方で使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば</font><font style="vertical-align: inherit;">、ハンドラーだけ</font><font style="vertical-align: inherit;">でなく、キーワードを使用して</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><code> TaskList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼び出します</font></font></a><font style="vertical-align: inherit;"></font><code>this.props.onAdd</code><font style="vertical-align: inherit;"></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この場合、ハンドラーが何も返さない、または以外の値を返す通常の関数である</font></font><code>Promise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合、コンポーネントは</font><font style="vertical-align: inherit;">通常の</font></font><code>TaskList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font><code>handleAdd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">続行し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">ただし、ハンドラーが戻る</font></font><code>Promise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合（ハンドラーが非同期関数として宣言されている場合を含む）、ハンドラーは</font></font><code>TaskList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実行が終了するまで待機し、その後にのみ変数</font></font><code>newTaskAdding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">との</font><font style="vertical-align: inherit;">値をリセットします</font></font><code>newTaskText</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ1：ReactコンポーネントにIndexDBを追加する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作業を簡略化するために、最初にPromiseメソッドを実装する単純なコンポーネントを記述します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">簡単なエラー処理でデータベースを開く</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベース内のアイテムを検索する</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベースにアイテムを追加する</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1つ目は最も「重要な」もので、最大5つのイベントハンドラです。</font><font style="vertical-align: inherit;">しかし、ロケット科学はありません：</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openDatabasePromise（）-データベースを開く</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">openDatabasePromise</span>(<span class="hljs-params"> keyPath </span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>( <span class="hljs-function">(<span class="hljs-params"> resolve, reject </span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> dbOpenRequest = <span class="hljs-built_in">window</span>.indexedDB.open( DB_NAME, <span class="hljs-string">'1.0.0'</span> );<font></font>
<font></font>
    dbOpenRequest.onblocked = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
      reject( <span class="hljs-string">'    ,    , '</span> +
        <span class="hljs-string">'      .'</span> );<font></font>
    };<font></font>
<font></font>
    dbOpenRequest.onerror = <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
      <span class="hljs-built_in">console</span>.log( <span class="hljs-string">'Unable to open indexedDB '</span> + DB_NAME );
      <span class="hljs-built_in">console</span>.log( err );<font></font>
      reject( <span class="hljs-string">'   ,       .'</span> +<font></font>
       ( err.message ? <span class="hljs-string">' : '</span> + err.message : <span class="hljs-string">''</span> ) );<font></font>
    };<font></font>
<font></font>
    dbOpenRequest.onupgradeneeded = <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> db = event.target.result;
      <span class="hljs-keyword">try</span> {<font></font>
        db.deleteObjectStore( OBJECT_STORE_NAME );<font></font>
      } <span class="hljs-keyword">catch</span> ( err ) { <span class="hljs-built_in">console</span>.log( err ); }<font></font>
      db.createObjectStore( OBJECT_STORE_NAME, { keyPath } );<font></font>
    };<font></font>
<font></font>
    dbOpenRequest.onsuccess = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
      <span class="hljs-built_in">console</span>.info( <span class="hljs-string">'Successfully open indexedDB connection to '</span> + DB_NAME );<font></font>
      resolve( dbOpenRequest.result );<font></font>
    };<font></font>
<font></font>
    dbOpenRequest.onerror = reject;<font></font>
  } );<font></font>
}<font></font>
</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getAllPromise / getPromise / putPromise-PromiseのラッパーIndexDb呼び出し</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-comment">//    ObjectStore,   IDBRequest</span>
<span class="hljs-comment">//     Promise</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">wrap</span>(<span class="hljs-params"> methodName </span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">const</span> [ objectStore, ...etc ] = <span class="hljs-built_in">arguments</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>( <span class="hljs-function">(<span class="hljs-params"> resolve, reject </span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> request = objectStore[ methodName ]( ...etc );<font></font>
      request.onsuccess = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> resolve( request.result );<font></font>
      request.onerror = reject;<font></font>
    } );<font></font>
  };<font></font>
}<font></font>
<span class="hljs-keyword">const</span> deletePromise = wrap( <span class="hljs-string">'delete'</span> );
<span class="hljs-keyword">const</span> getAllPromise = wrap( <span class="hljs-string">'getAll'</span> );
<span class="hljs-keyword">const</span> getPromise = wrap( <span class="hljs-string">'get'</span> );
<span class="hljs-keyword">const</span> putPromise = wrap( <span class="hljs-string">'put'</span> );<font></font>
}<font></font>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてを1つのIndexedDbRepositoryクラスにまとめる</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexedDbRepository-IDBDatabaseのラッパー</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword">const</span> DB_NAME = <span class="hljs-string">'objectStore'</span>;
<span class="hljs-keyword">const</span> OBJECT_STORE_NAME = <span class="hljs-string">'objectStore'</span>;
<span class="hljs-comment">/* ... */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IndexedDbRepository</span> </span>{
  <span class="hljs-comment">/* ... */</span>
  <span class="hljs-keyword">constructor</span>( keyPath ) {
    <span class="hljs-keyword">this</span>.error = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.keyPath = keyPath;<font></font>
<font></font>
    <span class="hljs-comment">//     async</span>
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">this</span>.openDatabasePromise = <span class="hljs-keyword">this</span>._openDatabase();<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">async</span> _openDatabase( keyPath ) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">this</span>.dbConnection = <span class="hljs-keyword">await</span> openDatabasePromise( keyPath );<font></font>
    } <span class="hljs-keyword">catch</span> ( error ) {
      <span class="hljs-keyword">this</span>.error = error;
      <span class="hljs-keyword">throw</span> error;<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">async</span> _tx( txMode, callback ) {
    <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.openDatabasePromise; <span class="hljs-comment">// await db connection</span>
    <span class="hljs-keyword">const</span> transaction = <span class="hljs-keyword">this</span>.dbConnection.transaction( [ OBJECT_STORE_NAME ], txMode );
    <span class="hljs-keyword">const</span> objectStore = transaction.objectStore( OBJECT_STORE_NAME );
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> callback( objectStore );<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">async</span> findAll() {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._tx( <span class="hljs-string">'readonly'</span>, objectStore =&gt; getAllPromise( objectStore ) );<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">async</span> findById( key ) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._tx( <span class="hljs-string">'readonly'</span>, objectStore =&gt; getPromise( objectStore, key ) );<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">async</span> deleteById( key ) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._tx( <span class="hljs-string">'readwrite'</span>, objectStore =&gt; deletePromise( objectStore, key ) );<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">async</span> save( item ) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._tx( <span class="hljs-string">'readwrite'</span>, objectStore =&gt; putPromise( objectStore, item ) );<font></font>
  }<font></font>
}<font></font>
</code></pre>(<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">   github</a>)</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、コードからIndexDBにアクセスできます。</font></font><br>
<br>
<pre><code class="javascript hljs">    <span class="hljs-keyword">const</span> db = <span class="hljs-keyword">new</span> IndexedDbRepository( <span class="hljs-string">'id'</span> ); <span class="hljs-comment">// ,    </span>
    <span class="hljs-keyword">await</span> db.save( { <span class="hljs-attr">id</span>: <span class="hljs-number">42</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">'Task text'</span> } );
    <span class="hljs-keyword">const</span> item = <span class="hljs-keyword">await</span> db.findById( <span class="hljs-number">42</span> );
    <span class="hljs-keyword">const</span> items = <span class="hljs-keyword">await</span> db.findAll();
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この「リポジトリ」をコンポーネントに接続します。</font><font style="vertical-align: inherit;">反応のルールによれば、サーバーへの呼び出しは、componentDidMount（）メソッドで行う必要があります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> IndexedDbRepository <span class="hljs-keyword">from</span> <span class="hljs-string">'../common/IndexedDbRepository'</span>;
<span class="hljs-comment">/*...*/</span><font></font>
  componentDidMount() {<font></font>
    <span class="hljs-keyword">this</span>.repository = <span class="hljs-keyword">new</span> IndexedDbRepository( <span class="hljs-string">'id'</span> );
    <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">this</span>.repository.findAll().then( <span class="hljs-function"><span class="hljs-params">tasks</span> =&gt;</span> <span class="hljs-keyword">this</span>.setState( { tasks } ) );<font></font>
  }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
理論的には、関数</font></font><code>componentDidMount()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を非同期として宣言し、（）の代わりに非同期/待機コンストラクトを使用できます。</font><font style="vertical-align: inherit;">ただし、</font></font><code>componentDidMount()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これは「私たちの」機能ではなく、Reactによって呼び出されます。</font></font><code>Promise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代わり</font><font style="vertical-align: inherit;">にリターンしようとすると、17.xライブラリがどのように動作するか誰が知っています</font></font><code>undefined</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">か？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、コンストラクターでは、空の配列（またはテストデータを含む配列）で埋める代わりに、nullで埋めます。</font><font style="vertical-align: inherit;">レンダリングでは、データが処理されるのを待つ必要があるため、このnullを処理します。</font><font style="vertical-align: inherit;">原則として、これを別々のフラグに入れることができますが、なぜエンティティを生成するのですか？</font></font><br>
<br>
<pre><code class="javascript hljs">  <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">super</span>( ...arguments );
    <span class="hljs-keyword">this</span>.state = { <span class="hljs-attr">tasks</span>: <span class="hljs-literal">null</span> };
    <span class="hljs-comment">/* ... */</span><font></font>
  }<font></font>
  <span class="hljs-comment">/* ... */</span><font></font>
  render() {<font></font>
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.state.tasks === <span class="hljs-literal">null</span> )
      <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Spinner</span> <span class="hljs-attr">animation</span>=<span class="hljs-string">"border"</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"span"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"status"</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>  ...<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/&gt;</span></span>;
    <span class="hljs-comment">/* ... */</span><font></font>
  }<font></font>
</code></pre><br><font style="vertical-align: inherit;"></font><code>handleAdd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font><font style="vertical-align: inherit;">
ハンドラーを実装することは残っています</font></font><code>handleDelete</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="javascript hljs">  <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-comment">/* ... */</span>
    <span class="hljs-keyword">this</span>.handleAdd = <span class="hljs-keyword">async</span>( newTaskText ) =&gt; {
      <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.repository.save( { <span class="hljs-attr">id</span>: counter(), <span class="hljs-attr">text</span>: newTaskText } );
      <span class="hljs-keyword">this</span>.setState( { <span class="hljs-attr">tasks</span>: <span class="hljs-literal">null</span> } );
      <span class="hljs-keyword">this</span>.setState( { <span class="hljs-attr">tasks</span>: <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.repository.findAll() } );<font></font>
    };<font></font>
    <span class="hljs-keyword">this</span>.handleDelete = <span class="hljs-keyword">async</span>( idToDelete ) =&gt; {
      <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.repository.deleteById( idToDelete );
      <span class="hljs-keyword">this</span>.setState( { <span class="hljs-attr">tasks</span>: <span class="hljs-literal">null</span> } );
      <span class="hljs-keyword">this</span>.setState( { <span class="hljs-attr">tasks</span>: <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.repository.findAll() } );<font></font>
    };<font></font>
  }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どちらのハンドラでも、最初にリポジトリを参照してアイテムを追加または削除し、次に現在のコンポーネントの状態をクリアして、リポジトリに新しいリストを再度要求します。</font><font style="vertical-align: inherit;">setState（）の呼び出しは次々に行われるようです。</font><font style="vertical-align: inherit;">ただし、ハンドラーの最後の行のawaitキーワードは、findAll（）メソッドから取得されたPromise（）が解決された後にのみ、2番目のsetState（）呼び出しを発生させます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ2.変更を聞く</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記のコードの大きな欠陥は、まず、リポジトリが各コンポーネントに接続されていることです。第2に、1つのコンポーネントがリポジトリのコンテンツを変更した場合、ユーザーのアクションの結果として状態を再度読み取るまで、他のコンポーネントはそのことを知りません。快適ではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これに対処するために、新しいRepositoryListenerコンポーネントを導入し、2つのことを実行させます。このコンポーネントは、最初に、リポジトリ内の変更をサブスクライブできるようになります。次に、RepositoryListenerはそれを作成したコンポーネントにこれらの変更について通知します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、IndexedDbRepositoryにハンドラーを登録する機能を追加します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IndexedDbRepository</span> </span>{
  <span class="hljs-comment">/*...*/</span>
  <span class="hljs-keyword">constructor</span>( keyPath ) {
  <span class="hljs-comment">/*...*/</span>
    <span class="hljs-keyword">this</span>.listeners = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Set</span>();
    <span class="hljs-keyword">this</span>.stamp = <span class="hljs-number">0</span>;
  <span class="hljs-comment">/*...*/</span><font></font>
  }<font></font>
  <span class="hljs-comment">/*...*/</span><font></font>
  addListener( listener ) {<font></font>
    <span class="hljs-keyword">this</span>.listeners.add( listener );<font></font>
  }<font></font>
  onChange() {<font></font>
    <span class="hljs-keyword">this</span>.stamp++;
    <span class="hljs-keyword">this</span>.listeners.forEach( <span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> listener( <span class="hljs-keyword">this</span>.stamp ) );<font></font>
  }<font></font>
  removeListener( listener ) {<font></font>
    <span class="hljs-keyword">this</span>.listeners.delete( listener );<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">githubのソースコード</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ハンドラーにスタンプを渡します。ハンドラーはonChange（）を呼び出すたびに変更されます。</font><font style="vertical-align: inherit;">そして、_txメソッドを変更して、モードを伴うトランザクションでの呼び出しごとに、</font></font><code>readwrite</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドが呼び出されるようにし</font></font><code>onChange()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="javascript hljs">  <span class="hljs-keyword">async</span> _tx( txMode, callback ) {
    <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.openDatabasePromise; <span class="hljs-comment">// await db connection</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> transaction = <span class="hljs-keyword">this</span>.dbConnection.transaction( [ OBJECT_STORE_NAME ], txMode );
      <span class="hljs-keyword">const</span> objectStore = transaction.objectStore( OBJECT_STORE_NAME );
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> callback( objectStore );<font></font>
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-keyword">if</span> ( txMode === <span class="hljs-string">'readwrite'</span> )
        <span class="hljs-keyword">this</span>.onChange(); <span class="hljs-comment">// notify listeners</span><font></font>
    }<font></font>
  }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">githubソースコード</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">Promiseで</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
引き続き</font></font><code>then()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><code>catch()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">使用している場合は</font><font style="vertical-align: inherit;">、への呼び出しを複製するか</font></font><code>onChange()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、サポートするPromise（）に特別なポリフィルを使用する必要があります</font></font><code>final()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">さいわい、async / awaitを使用すると、不要なコードを使わずに簡単にこれを実行できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RepositoryListenerコンポーネント自体は、componentDidMountおよびcomponentWillUnmountメソッドでイベントリスナーを接続します。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RepositoryListenerコード</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword">import</span> IndexedDbRepository <span class="hljs-keyword">from</span> <span class="hljs-string">'./IndexedDbRepository'</span>;
<span class="hljs-keyword">import</span> { PureComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RepositoryListener</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PureComponent</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">super</span>( ...arguments );<font></font>
<font></font>
    <span class="hljs-keyword">this</span>.prevRepository = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.repositoryListener = <span class="hljs-function"><span class="hljs-params">repositoryStamp</span> =&gt;</span> <span class="hljs-keyword">this</span>.props.onChange( repositoryStamp );<font></font>
  }<font></font>
<font></font>
  componentDidMount() {<font></font>
    <span class="hljs-keyword">this</span>.subscribe();<font></font>
  }<font></font>
<font></font>
  componentDidUpdate() {<font></font>
    <span class="hljs-keyword">this</span>.subscribe();<font></font>
  }<font></font>
<font></font>
  componentWillUnmount() {<font></font>
    <span class="hljs-keyword">this</span>.unsubscribe();<font></font>
  }<font></font>
<font></font>
  subscribe() {<font></font>
    <span class="hljs-keyword">const</span> { repository } = <span class="hljs-keyword">this</span>.props;
    <span class="hljs-keyword">if</span> ( repository <span class="hljs-keyword">instanceof</span> IndexedDbRepository &amp;&amp; <span class="hljs-keyword">this</span>.prevRepository !== repository ) {
      <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.prevRepository !== <span class="hljs-literal">null</span> ) {
        <span class="hljs-keyword">this</span>.prevRepository.removeListener( <span class="hljs-keyword">this</span>.repositoryListener );<font></font>
      }<font></font>
      <span class="hljs-keyword">this</span>.prevRepository = repository;<font></font>
      repository.addListener( <span class="hljs-keyword">this</span>.repositoryListener );<font></font>
    }<font></font>
  }<font></font>
<font></font>
  unsubscribe( ) {<font></font>
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.prevRepository !== <span class="hljs-literal">null</span> ) {
      <span class="hljs-keyword">this</span>.prevRepository.removeListener( <span class="hljs-keyword">this</span>.repositoryListener );
      <span class="hljs-keyword">this</span>.prevRepository = <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
  }<font></font>
<font></font>
  render() {<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.props.children || <span class="hljs-literal">null</span>;<font></font>
  }<font></font>
}<font></font>
</code></pre>(<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">   github</a>)</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、メインコンポーネントにリポジトリ変更の処理を含め、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DRY原則に基づいて</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、対応するコードを</font></font><code>handleAdd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font><font style="vertical-align: inherit;">ハンドラーから削除します</font></font><code>handleDelete</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs">  <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">super</span>( ...arguments );
    <span class="hljs-keyword">this</span>.state = { <span class="hljs-attr">tasks</span>: <span class="hljs-literal">null</span> };<font></font>
<font></font>
    <span class="hljs-keyword">this</span>.handleAdd = <span class="hljs-keyword">async</span>( newTaskText ) =&gt; {
      <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.repository.save( { <span class="hljs-attr">id</span>: counter(), <span class="hljs-attr">text</span>: newTaskText } );<font></font>
    };<font></font>
    <span class="hljs-keyword">this</span>.handleDelete = <span class="hljs-keyword">async</span>( idToDelete ) =&gt; {
      <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.repository.deleteById( idToDelete );<font></font>
    };<font></font>
    <span class="hljs-keyword">this</span>.handleRepositoryChanged = <span class="hljs-keyword">async</span>() =&gt; {
      <span class="hljs-keyword">this</span>.setState( { <span class="hljs-attr">tasks</span>: <span class="hljs-literal">null</span> } );
      <span class="hljs-keyword">this</span>.setState( { <span class="hljs-attr">tasks</span>: <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.repository.findAll() } );<font></font>
    };<font></font>
  }<font></font>
<font></font>
  componentDidMount() {<font></font>
    <span class="hljs-keyword">this</span>.repository = <span class="hljs-keyword">new</span> IndexedDbRepository( <span class="hljs-string">'id'</span> );
    <span class="hljs-keyword">this</span>.handleRepositoryChanged(); <span class="hljs-comment">// initial load</span><font></font>
  }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">githubソースコード</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、接続されたRepositoryListenerからhandleRepositoryChangedへの呼び出しを追加します。</font></font><br>
<br>
<pre><code class="javascript hljs">  render() {
    <span class="hljs-comment">/* ... */</span>
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RepositoryListener</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{this.handleRepoChanged}</span> <span class="hljs-attr">repository</span>=<span class="hljs-string">{this.repository}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">TaskList</span>
        <span class="hljs-attr">onAdd</span>=<span class="hljs-string">{this.handleAdd}</span>
        <span class="hljs-attr">onDelete</span>=<span class="hljs-string">{this.handleDelete}</span>
        <span class="hljs-attr">tasks</span>=<span class="hljs-string">{this.state.tasks}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">RepositoryListener</span>&gt;</span></span>;<font></font>
  }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">githubソースコード</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ3.別のコンポーネントでデータのロードと更新を行う</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リポジトリからデータを受け取り、リポジトリ内のデータを変更できるコンポーネントを作成しました。</font><font style="vertical-align: inherit;">しかし、100以上のコンポーネントを持つ大規模なプロジェクトを想像すると</font><font style="vertical-align: inherit;">、リポジトリからのデータを表示する</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンポーネントは次のように強制されることがわかります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリが単一ポイントから正しく接続されていることを確認してください</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドにブートストラップデータを提供する </font></font><code>componentDidMount()</code></li>
<li><font style="vertical-align: inherit;"></font><code>RepositoryListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変更をリロードするハンドラーコールを提供</font><font style="vertical-align: inherit;">するコンポーネント</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">接続します</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重複するアクションが多すぎませんか？</font><font style="vertical-align: inherit;">そうではないようです。</font><font style="vertical-align: inherit;">そして、何かが忘れられたら？</font><font style="vertical-align: inherit;">コピーペーストで迷子になりますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リポジトリからタスクのリストを取得するためのルールを作成し、何か魔法のような方法でこれらのメソッドを実行し、データを提供し、リポジトリ内の変更を処理し、ヒープの場合はこれを接続できることを確認しておくとよいでしょう。リポジトリ。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">this</span>.doFindAllTasks = <span class="hljs-function">(<span class="hljs-params"> repo </span>) =&gt;</span> repo.findAll();
<span class="hljs-comment">/*...*/</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">DataProvider</span>
  <span class="hljs-attr">doCalc</span>=<span class="hljs-string">{</span> <span class="hljs-attr">this.doFindAllTasks</span> }&gt;</span>
{(data) =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>...   -,   data...<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>}
<span class="hljs-tag">&lt;/<span class="hljs-name">DataProvider</span>&gt;</span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコンポーネントの実装における重要な瞬間は、doFindAllTask​​s（）がPromiseであることだけです。</font><font style="vertical-align: inherit;">作業を容易にするために、Promiseの実行を待機する別のコンポーネントを作成し、計算された値で子孫を呼び出します。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PromiseComponentコード</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { PureComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PromiseComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PureComponent</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">super</span>( ...arguments );
    <span class="hljs-keyword">this</span>.state = {
      <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">value</span>: <span class="hljs-literal">null</span>,<font></font>
    };<font></font>
    <span class="hljs-keyword">this</span>.prevPromise = <span class="hljs-literal">null</span>;<font></font>
  }<font></font>
<font></font>
  componentDidMount() {<font></font>
    <span class="hljs-keyword">this</span>.subscribe();<font></font>
  }<font></font>
<font></font>
  componentDidUpdate( ) {<font></font>
    <span class="hljs-keyword">this</span>.subscribe();<font></font>
  }<font></font>
<font></font>
  componentWillUnmount() {<font></font>
    <span class="hljs-keyword">this</span>.unsubscribe();<font></font>
  }<font></font>
<font></font>
  subscribe() {<font></font>
    <span class="hljs-keyword">const</span> { cleanOnPromiseChange, promise } = <span class="hljs-keyword">this</span>.props;
    <span class="hljs-keyword">if</span> ( promise <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span> &amp;&amp; <span class="hljs-keyword">this</span>.prevPromise !== promise ) {
      <span class="hljs-keyword">if</span> ( cleanOnPromiseChange ) <span class="hljs-keyword">this</span>.setState( { <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">value</span>: <span class="hljs-literal">null</span> } );
      <span class="hljs-keyword">this</span>.prevPromise = promise;<font></font>
      promise.then( <span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.prevPromise === promise ) {
          <span class="hljs-keyword">this</span>.setState( { <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>, value } );<font></font>
        }<font></font>
      } )<font></font>
        .catch( <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
          <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.prevPromise === promise ) {
            <span class="hljs-keyword">this</span>.setState( { error, <span class="hljs-attr">value</span>: <span class="hljs-literal">null</span> } );<font></font>
          }<font></font>
        } );<font></font>
    }<font></font>
  }<font></font>
<font></font>
  unsubscribe( ) {<font></font>
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.prevPromise !== <span class="hljs-literal">null</span> ) {
      <span class="hljs-keyword">this</span>.prevPromise = <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
  }<font></font>
<font></font>
  render() {<font></font>
    <span class="hljs-keyword">const</span> { children, fallback } = <span class="hljs-keyword">this</span>.props;
    <span class="hljs-keyword">const</span> { error, value } = <span class="hljs-keyword">this</span>.state;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> ( error !== <span class="hljs-literal">null</span> ) {
      <span class="hljs-keyword">throw</span> error;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> ( value === <span class="hljs-literal">undefined</span> || value === <span class="hljs-literal">null</span> ) {
      <span class="hljs-keyword">return</span> fallback || <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> children( value );<font></font>
<font></font>
  }<font></font>
}<font></font>
</code></pre><br>
(<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">   github</a>)<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコンポーネントのロジックと内部構造は、RepositoryListenerとよく似ています。</font><font style="vertical-align: inherit;">どちらもイベントに「署名」、「聴取」、何らかの形でイベントを処理する必要があるためです。</font><font style="vertical-align: inherit;">また、聴く必要のあるイベントが変わる可能性があることも覚えておいてください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、これまでのところ非常に魔法のコンポーネントであるDataProviderは非常にシンプルに見えます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> repository <span class="hljs-keyword">from</span> <span class="hljs-string">'./RepositoryHolder'</span>;
<span class="hljs-comment">/*...*/</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PureComponent</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">super</span>( ...arguments );
    <span class="hljs-keyword">this</span>.handleRepoChanged = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-keyword">this</span>.forceUpdate();<font></font>
  }<font></font>
<font></font>
  render() {<font></font>
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RepositoryListener</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{this.handleRepoChanged}</span> <span class="hljs-attr">repository</span>=<span class="hljs-string">{repository}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">PromiseComponent</span> <span class="hljs-attr">promise</span>=<span class="hljs-string">{this.props.doCalc(</span> <span class="hljs-attr">repository</span> )}&gt;</span>
        {data =&gt; this.props.children( data )}
      <span class="hljs-tag">&lt;/<span class="hljs-name">PromiseComponent</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">RepositoryListener</span>&gt;</span></span>;<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">githubのソースコード</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、doCalcと呼ばれるリポジトリ（および現在インポートされている個別のシングルトンのRepositoryHolder）を取得しました。これにより、タスクデータをthis.props.childrenに転送できるため、タスクのリストを描画できます。</font><font style="vertical-align: inherit;">シングルントンもシンプルに見えます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> repository = <span class="hljs-keyword">new</span> IndexedDbRepository( <span class="hljs-string">'id'</span> );
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> repository;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、メインコンポーネントからのデータベース呼び出しをDataProvider呼び出しに置き換えます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> repository <span class="hljs-keyword">from</span> <span class="hljs-string">'./RepositoryHolder'</span>;
<span class="hljs-comment">/* ... */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Step3</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PureComponent</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">super</span>( ...arguments );
    <span class="hljs-keyword">this</span>.doFindAllTasks = <span class="hljs-function"><span class="hljs-params">repository</span> =&gt;</span> repository.findAll();
    <span class="hljs-comment">/* ... */</span><font></font>
  }<font></font>
<font></font>
  render() {<font></font>
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">DataProvider</span>
        <span class="hljs-attr">doCalc</span>=<span class="hljs-string">{this.doFindAllTasks}</span>
        <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Spinner</span> <span class="hljs-attr">animation</span>=<span class="hljs-string">"border"</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"span"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"status"</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>  ...<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/&gt;</span></span>}&gt;<font></font>
        { tasks =&gt; <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">TaskList</span>
          <span class="hljs-attr">onAdd</span>=<span class="hljs-string">{this.handleAdd}</span>
          <span class="hljs-attr">onDelete</span>=<span class="hljs-string">{this.handleDelete}</span>
          <span class="hljs-attr">tasks</span>=<span class="hljs-string">{tasks}</span> /&gt;</span></span> }<font></font>
      &lt;/DataProvider&gt;;<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">githubソースコード</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで止めることができます。</font><font style="vertical-align: inherit;">データを受信するためのルールについて説明し、別のコンポーネントがこのデータの実際の受信と更新を監視します。</font><font style="vertical-align: inherit;">文字通り小さなことがいくつかありました：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データリクエストごとに、コード内のどこかに（メソッドではなく</font></font><code>render()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、リポジトリにアクセスする関数を記述し、この関数をDataProviderに渡す必要があります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DataProviderの呼び出しは素晴らしく、Reactの精神に完全に基づいていますが、JSXの観点からは非常に醜いです。</font><font style="vertical-align: inherit;">複数のコンポーネントがある場合、異なるDataProviderの2つまたは3つのレベルのネストが非常に混乱します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データの受信が1つのコンポーネント（DataProvider）で行われ、それらの変更が別のコンポーネント（メインコンポーネント）で行われるのは悲しいことです。</font><font style="vertical-align: inherit;">同じメカニズムでこれを説明したいと思います。</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ4.接続（）</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すでに推測されているタイトルのタイトルで、react-reduxに精通しています。</font><font style="vertical-align: inherit;">残りの部分については、次のヒントを参考にします。パラメータを指定して子（）を呼び出す代わりに、DataProviderサービスコンポーネントが、ルールに基づいてコンポーネントのプロパティに入力すると便利です。</font><font style="vertical-align: inherit;">リポジトリで何かが変更された場合、標準のReactメカニズムでプロパティが変更されるだけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このために、高次コンポーネントを使用します。</font><font style="vertical-align: inherit;">実際、複雑なことは何もありません。コンポーネントクラスをパラメータとして取り、別のより複雑なコンポーネントを提供する関数にすぎません。</font><font style="vertical-align: inherit;">したがって、作成する関数は次のようになります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータを渡すコンポーネントクラスを引数として受け取ります</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一連のルール、リポジトリからデータを取得する方法、およびどのプロパティに配置するかを受け入れる</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その使用法は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">react-reduxのconnect（）関数に</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">似て</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">い</font></a><font style="vertical-align: inherit;">ます。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この関数の呼び出しは次のようになります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> mapRepoToProps = <span class="hljs-function"><span class="hljs-params">repository</span> =&gt;</span> ( {
  <span class="hljs-attr">tasks</span>: repository.findAll(),<font></font>
} );<font></font>
<span class="hljs-keyword">const</span> mapRepoToActions = <span class="hljs-function"><span class="hljs-params">repository</span> =&gt;</span> ( {
  <span class="hljs-attr">doAdd</span>: <span class="hljs-function">(<span class="hljs-params"> newTaskText </span>) =&gt;</span> repository.save( { <span class="hljs-attr">id</span>: counter(), <span class="hljs-attr">text</span>: newTaskText } ),
  <span class="hljs-attr">doDelete</span>: <span class="hljs-function">(<span class="hljs-params"> idToDelete </span>) =&gt;</span> repository.deleteById( idToDelete ),<font></font>
} );<font></font>
<span class="hljs-keyword">const</span> Step4Connected = connect( mapRepoToProps, mapRepoToActions )( Step4 );
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の行は、コンポーネントプロパティの名前と</font></font><code>Step4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリから読み込まれる値の</font><font style="vertical-align: inherit;">間のマッピングを指定</font><font style="vertical-align: inherit;">します。</font><font style="vertical-align: inherit;">次は、すでにアクションにマッピングしている：コンポーネント内部の場合に何が起こるか</font></font><code>Step4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、原因</font></font><code>this.props.doAdd(...)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、または</font></font><code>this.props.doDelete(...)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そして最後の行はすべてをまとめて、connect関数を呼び出します。</font><font style="vertical-align: inherit;">結果は新しいコンポーネントです（このため、この手法は高次コンポーネントと呼ばれます）。</font><font style="vertical-align: inherit;">そして、元のStep4コンポーネントではなく、ファイルのラッパーをファイルからエクスポートします。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">/*...*/</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Step4</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PureComponent</span> </span>{
<span class="hljs-comment">/*...*/</span><font></font>
}<font></font>
<span class="hljs-comment">/*...*/</span>
<span class="hljs-keyword">const</span> Step4Connected = connect( <span class="hljs-comment">/*...*/</span> )( Step4 );
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Step4Connected;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、TaskListを操作するコンポーネントは、単純なラッパーのように見えます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Step4</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PureComponent</span> </span>{<font></font>
  render() {<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.props.tasks === <span class="hljs-literal">undefined</span> || <span class="hljs-keyword">this</span>.props.tasks === <span class="hljs-literal">null</span>
        ? <span class="xml"><span class="hljs-tag">&lt;&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Spinner</span> <span class="hljs-attr">animation</span>=<span class="hljs-string">"border"</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"span"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"status"</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>  ...<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/&gt;</span></span>
        : <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">TaskList</span>
          <span class="hljs-attr">onAdd</span>=<span class="hljs-string">{this.props.doAdd}</span>
          <span class="hljs-attr">onDelete</span>=<span class="hljs-string">{this.props.doDelete}</span>
          <span class="hljs-attr">tasks</span>=<span class="hljs-string">{this.props.tasks}</span> /&gt;</span></span>;<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">githubソースコード</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以上です。</font><font style="vertical-align: inherit;">コンストラクターも、追加のハンドラーもありません。すべては、コンポーネントのプロパティのconnect（）関数によって配置されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
connect（）関数がどのように見えるかを確認するために残ります。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接続（）コード</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword">import</span> repository <span class="hljs-keyword">from</span> <span class="hljs-string">'./RepositoryHolder'</span>;
<span class="hljs-comment">/* ... */</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Connected</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PureComponent</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">super</span>( ...arguments );
    <span class="hljs-keyword">this</span>.handleRepoChanged = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-keyword">this</span>.forceUpdate();<font></font>
  }<font></font>
<font></font>
  render() {<font></font>
    <span class="hljs-keyword">const</span> { childClass, childProps, mapRepoToProps, mapRepoToActions } = <span class="hljs-keyword">this</span>.props;
    <span class="hljs-keyword">const</span> promises = mapRepoToProps( repository, childProps );
    <span class="hljs-keyword">const</span> actions = mapRepoToActions( repository, childProps );<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RepositoryListener</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{this.handleRepoChanged}</span> <span class="hljs-attr">repository</span>=<span class="hljs-string">{repository}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">PromisesComponent</span> <span class="hljs-attr">promises</span>=<span class="hljs-string">{promises}</span>&gt;</span>
        { values =&gt; React.createElement( childClass, {
          ...childProps,
          ...values,
          ...actions,
        } )}
      <span class="hljs-tag">&lt;/<span class="hljs-name">PromisesComponent</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">RepositoryListener</span>&gt;</span></span>;<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">connect</span>(<span class="hljs-params"> mapRepoToProps, mapRepoToActions </span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-params">childClass</span> =&gt;</span> <span class="hljs-function"><span class="hljs-params">props</span> =&gt;</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Connected</span>
    <span class="hljs-attr">childClass</span>=<span class="hljs-string">{childClass}</span>
    <span class="hljs-attr">childProps</span>=<span class="hljs-string">{props}</span>
    <span class="hljs-attr">mapRepoToActions</span>=<span class="hljs-string">{mapRepoToActions}</span>
    <span class="hljs-attr">mapRepoToProps</span>=<span class="hljs-string">{mapRepoToProps}</span> /&gt;</span></span>;<font></font>
}<font></font>
</code></pre>(<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">   github</a>)</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードもそれほど複雑ではないようです...ダイビングを開始すると質問が発生します。</font><font style="vertical-align: inherit;">最後から読む必要があります。</font><font style="vertical-align: inherit;">関数が定義されているのはそこです</font></font><code>connect()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">2つのパラメーターを取り、次に...を返す関数を返しますか？</font><font style="vertical-align: inherit;">あんまり。</font><font style="vertical-align: inherit;">後者の構成</font></font><code>props =&gt; &lt;Connected...</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、関数だけでなく</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reactの機能コンポーネントも</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">したがって、ConnectedStep4を仮想ツリーに埋め込むと、次のものが含まれます。</font></font><br>
<br>
<ul>
<li><i>parent</i> →    → Connect → RepositoryListener → PromisesComponent → Step4</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最大4つの中間クラスですが、それぞれがその機能を実行します。名前のないコンポーネントは、function </font></font><code>connect()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">渡されたパラメーター</font><font style="vertical-align: inherit;">、ネストされたコンポーネントのクラス、呼び出されたときにコンポーネント自体に渡されたプロパティ（props）を</font><font style="vertical-align: inherit;">取り、</font><font style="vertical-align: inherit;">それらを既にコンポーネントに渡します</font></font><code>Connect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。コンポーネント</font></font><code>Connect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、渡されたパラメーター</font></font><code>Promise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（行キーとプロミス値を持つディクショナリオブジェクト）</font><font style="vertical-align: inherit;">からセットを取得します</font><font style="vertical-align: inherit;">。</font></font><code>PromisesComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値の計算を提供し、それらをConnectコンポーネントに返します。これは、元の転送されたプロパティ（props）、計算されたプロパティ（値）、およびproperties-actions（アクション）とともに、それらをコンポーネントに</font></font><code>Step4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（呼び出しを介して</font></font><code>React.createElement(...)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">渡します</font><font style="vertical-align: inherit;">。まあ、コンポーネント</font></font><code>RepositoryListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンポーネントを更新し、リポジトリで何かが変更された場合に約束を再計算します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、コンポーネントのいずれかがIndexDbからリポジトリを使用する場合、1つの関数を接続し</font></font><code>connect()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、プロパティとリポジトリからプロパティを取得する関数の間のマッピングを決定して、追加の問題なしにそれらを使用する</font><font style="vertical-align: inherit;">だけで十分です</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ5. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ vlsergey / react-indexdb-repo</font></font></a></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、他の開発者がプロ​​ジェクトで使用できるように、これらすべてをライブラリの形式で配置します。</font><font style="vertical-align: inherit;">このステップの結果は次のとおりです。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Library </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ vlsergey / react-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> promise-結果のメモ化をサポートするPromiseComponentおよびPromisesComponentの実装（変更が興味を持たない場合のUIの「ひねり」が少なくなるように）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブラリ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ vlsergey / React-indexdb-theリポジトリ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -実装IndexedDbRepository、関数connect（）およびいくつかのユーティリティクラス</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このライブラリを使用してタスクリストを作成する例</font></font></a></li>
</ul><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論の代わりに：船外に残っているもの</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記のコードは、産業ソリューションで使用するのに十分実用的です。</font><font style="vertical-align: inherit;">しかし、それでも、制限を忘れないでください：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常にプロパティを変更すると、新しい約束が得られるとは限りません。</font><font style="vertical-align: inherit;">ここではメモ化機能を使用する必要がありますが、データベースを変更するためのフラグを検討してください。</font><font style="vertical-align: inherit;">これは、IndexedDbRepositoryからのスタンプが便利な場所です（おそらく、このコードの一部は冗長に思われたかもしれません）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1つの場所であっても、インポートによるリポジトリの接続は間違っています。</font><font style="vertical-align: inherit;">コンテキストの使用に目を向ける必要があります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">現在の実装では、1つのIndexedDBデータベースを複数のタブで開くことができることは考慮されていません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事では、機能の点で最も重要なもの、つまりこのリポジトリとサーバーの同期については説明しません。</font><font style="vertical-align: inherit;">正しい同期には別の記事が必要です。</font><font style="vertical-align: inherit;">実際、IndexDBはサーバーからの「実際の」データのキャッシュにすぎないことが多く、キャッシュの無効化は2つの最も重要なプログラミング問題の1つです。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">また、IndexDBはRedux Storageの代わりにはならないことも覚えておいてください。</font><font style="vertical-align: inherit;">非常にまれなケースでは、IndexDBを使用することで非常に優れたメリットが得られますが、これはすべての状況に対応できる特効薬または代替品ではありません。</font></font></li>
</ul><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのステップのソースコード、</font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オンラインバージョン。</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja472230/index.html">ML用チップ-新製品について話す</a></li>
<li><a href="../ja472232/index.html">「ZX-Spectrum用カラーエクステンダー」からZX-Polyへ</a></li>
<li><a href="../ja472234/index.html">暗号通貨：それはまだフリーローダーですか、それともパートナーですか？</a></li>
<li><a href="../ja472240/index.html">ゲーミフィケーションについて。それは何ですか、なぜそしてどのようにそれを行うのですか？開発者の外観</a></li>
<li><a href="../ja472242/index.html">Tokioスケジューラーを10倍高速化しました</a></li>
<li><a href="../ja472248/index.html">IT Planetプログラミングファイナルをどのように統合したか</a></li>
<li><a href="../ja472252/index.html">10月21日から28日までのモスクワでのデジタルイベント</a></li>
<li><a href="../ja472254/index.html">10月21日から28日までのサンクトペテルブルクでのデジタルイベント</a></li>
<li><a href="../ja472258/index.html">「学ぶことを学ぶ」方法-マインドフルネスを改善する</a></li>
<li><a href="../ja472262/index.html">モバイル＃318開発者向けの興味深い資料のダイジェスト（10月14〜20日）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>