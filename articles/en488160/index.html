<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçü§ù‚Äçüë©üèº üë®‚Äçüëß‚Äçüë¶ üßöüèª Windows Server 2019 vs. VMware Snapshots with quiescing: an elegant solution to the problem ‚õ±Ô∏è ü•† üë®‚Äç‚öñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, Habr! 
 
 Windows Server 2019 virtual machines with EFI emulation on VMware have a problem with Application-Aware snapshots. It looks like this...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Windows Server 2019 vs. VMware Snapshots with quiescing: an elegant solution to the problem</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataline/blog/488160/"><img src="https://habrastorage.org/webt/3i/av/zy/3iavzyx3hpauvbn5mxl9gxnmcfw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hello, Habr! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windows Server 2019 virtual machines with EFI emulation on VMware have a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">problem</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with Application-Aware snapshots. It looks like this: a snapshot is done, reaches 100%, hangs for 5 minutes, and then falls into the error Failed to quiesce the virtual machine. </font></font><br>
&nbsp;<br>
<img src="https://habrastorage.org/webt/yt/e_/0o/yte_0odof34hf7qhno97kjak_9k.png"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The investigation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> showed that the cause of this error was a conflict between the Windows Server 2019 VSS service and the VMware Snapshot Provider, which is responsible for application quiescing. This thing prepares the virtual machine for snapshots: it stops applications and write operations so that after recovery from snapshots, all data is consistent.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Microsoft has claimed and claims that Application-Aware Snapshots are perfectly supported by the OS. </font><font style="vertical-align: inherit;">Indeed, such a problem does not occur in Hyper-V. </font><font style="vertical-align: inherit;">VMware modestly </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">invited</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> its users to simply turn off quiescing (so what, that snapshot will not be consistent at the application level). </font><font style="vertical-align: inherit;">Or refuse system disks with GPT-marking and EFI emulation (in 2020!).&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Today I‚Äôll show you how to get around this problem beautifully and get consistent application-aware snapshots of Windows Server 2019 virtual machines, and at the same time I‚Äôll remind you of the Microsoft-supported way to install Windows Server on a virtual machine.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Who's guilty? </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Start over. </font><font style="vertical-align: inherit;">When creating a virtual machine on VMware ESXi in VM Options, the default emulation is BIOS emulation. </font><font style="vertical-align: inherit;">And, while there are no special requirements for security or the size of the system disk, such a scenario is quite appropriate. </font><font style="vertical-align: inherit;">But as soon as we need to configure Secure Boot or the number of vCPUs exceeds 128, we will need to create a VM with UEFI emulation. </font><font style="vertical-align: inherit;">If only because there are:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secure Boot - protection against booting from extraneous media.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encryption support (requires TPM support, but in ESXi 6.7 the same trouble).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Support for drives over 2TB (doubtful, but it happens).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Support for a large number of processors.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you install Windows on VMware VMs, as we used to do (create VMs, palm off ISO, boot with handles, next, next ...), then when GPT-partitioning the system disk, the Recovery section appears next to the EFI partition and the partition with the system. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We recall the materiel: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recovery partition</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - a protected partition on the system hard drive, which is used to restore the factory settings of the system in case of problems. When you install Windows Server on a GPT disk, Recovery writes the Windows Recovery Environment (WinRE). Computer manufacturers, as a rule, supplement this section with their custom settings and drivers tailored for a specific hardware. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stop!&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But we are not working with hardware, but with a virtual machine. </font><font style="vertical-align: inherit;">No rollbacks to any factory settings are required. </font><font style="vertical-align: inherit;">In the end, if you want to return the VM to its original state, we simply redeploy it. </font><font style="vertical-align: inherit;">Therefore, the Recovery partition on the VM does not make sense and is not particularly needed. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Recovery section is protected from modification and accidental deletion: it "does not freeze." </font><font style="vertical-align: inherit;">As a result, a conflict arises between the VSS VMware Snapshot Provider and Microsoft Windows VSS: the VMware provider is trying to snapshot all the partitions of the disk, and Windows Server does not allow it to do this. </font><font style="vertical-align: inherit;">This good news is reported to us by the logs:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yx/bt/ul/yxbtuli9vcz54hxyzay7t2qkx9a.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What to do?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is treated simply. You can install Windows on a VM using the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Convert Windows Image</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cmdlet </font><b><font style="vertical-align: inherit;">.</font></b><font style="vertical-align: inherit;"> Actually, just such an installation script is recommended and supported by Microsoft itself (this script is on the Windows Server 2016 RTM image in the directory with the Nano Server image, but this is a different and no less interesting story;)). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The script will automatically create a template with the updated sysprepped Windows Server, the necessary drivers, and even roles. This approach is interesting because the installation and configuration of the OS can be automated, since the script supports unattend.xml. In addition, this option provides freedom for engineering: from pre-launching a VM on Hyper-V with installation through Invoke-Command to creating a custom service through editing the registry.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the output, we get a thick VHD-disk, which you can </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">slip VMware</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , start the VM, put VMware Tools and convert to a template. </font><font style="vertical-align: inherit;">As a result, the VM will have GPT markup inside, suitable for running on an EFI VM and without Recovery section by design. </font><font style="vertical-align: inherit;">As a bonus: in my example, I will immediately create a paravirtual adapter to provide performance. </font><font style="vertical-align: inherit;">And most importantly - for such a virtual machine, application-aware snapshot can be done without problems. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now everything is detailed in steps.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Driver extraction</font></font></h3><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Download the image from the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repository</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mount the image.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6z/v3/oh/6zv3ohujcw5c7an7eofrkuqk4cm.png"></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Run cmd.exe and go to the root of the mounted image</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Run the installer with the keys:</font></font><br>
 <pre><code class="powershell hljs">setup64.exe /A /P &lt;  &gt;</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the second step of the wizard, we repeat the path for unpacking:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3w/f8/ie/3wf8ie5slc8wib4y1i6_wcgrmqc.png"></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The drivers are here: VMWToolsExtract \ VMware \ VMware Tools \ VMware \ Drivers</font></font></li>
</ol><br>
<h3>  Windows Server 2019</h3><br>
<ol>
<li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">.</a>         ,    .</li>
<li>:      Servicing Stack Update.   <b>How to get this update</b>    ,      MS update catalog:<br>
<br>
<img src="https://habrastorage.org/webt/bw/69/nh/bw69nhxrxwlvdok-v6ay3kq7ol4.png"></li>
<li> Windows Server 2019 Cumulative Update  Servicing Stack Update.<br>
<br>
<img src="https://habrastorage.org/webt/an/eb/kx/anebkxhmkcag8orxr-iozq2vdja.png"><br>
<br>
<img src="https://habrastorage.org/webt/lo/be/gb/lobegbi9-oaftukfaddglpygb24.png"></li>
<li>      CAB-   :<br>
<br>
<img src="https://habrastorage.org/webt/55/tx/l1/55txl18ysrdyryapcchw7z7ewx4.png"></li>
</ol><br>
<h3>  </h3> <br>
<ol>
<li> PowerShell   .</li>
<li> <br>
 <pre><code class="powershell hljs"><span class="hljs-built_in">Install-Module</span> <span class="hljs-literal">-Name</span> <span class="hljs-built_in">Convert-WindowsImage</span></code></pre></li>
<li> -  Convert-WindowsImage:<br>
 <pre><code class="powershell hljs"><span class="hljs-variable">$ConvertWindowsImageParam</span> = <span class="hljs-selector-tag">@</span>{
	<span class="hljs-comment">#    Windows Server 2019</span>
	SourcePath = <span class="hljs-string">"C:\work\en_windows_server_2019.iso"</span>
	<span class="hljs-comment">#   </span>
	VHDFormat = <span class="hljs-string">"VHD"</span>
	<span class="hljs-comment">#   </span>
	SizeBytes = <span class="hljs-number">40</span>GB
	<span class="hljs-comment">#   - GPT</span>
	DiskLayout = <span class="hljs-string">"UEFI"</span>
	BCDinVHD = <span class="hljs-string">"VirtualMachine"</span>
	<span class="hljs-comment">#   </span>
	DiskType = <span class="hljs-string">"Fixed"</span>
	<span class="hljs-comment">#  - Windows Server 2019 Standard (Desktop Expirience)</span>
	<span class="hljs-comment">&lt;#
	 :
	1 - Windows Server 2019 Standard (Core)
	2 - Windows Server 2019 Standard (Desktop Expirience)
	3 - Windows Server 2019 Datacenter (Core)
	4 - Windows Server 2019 Datacenter (Desktop Expirience)
	#&gt;</span>
	Edition = <span class="hljs-selector-tag">@</span>(<span class="hljs-string">"2"</span>)
	<span class="hljs-comment">#  Remote Desktop</span>
	RemoteDesktopEnable = <span class="hljs-variable">$True</span>
	<span class="hljs-comment">#   </span>
	Feature = <span class="hljs-selector-tag">@</span>(<span class="hljs-string">"TelnetClient"</span>,<span class="hljs-string">"WindowsServerBackup"</span>,<span class="hljs-string">"NetFx3"</span>)
	<span class="hljs-comment">#   (     CAB)</span>
	<span class="hljs-comment">#       :  SSU,  </span>
	Package = <span class="hljs-selector-tag">@</span>(<span class="hljs-string">"C:\work\Windows10.0-KB4523204-x64.cab"</span>,<span class="hljs-string">"C:\work\Windows10.0-KB4534321-x64_PSFX.cab"</span>)
	<span class="hljs-comment">#     </span>
	Driver = <span class="hljs-selector-tag">@</span>(<span class="hljs-string">"C:\work\VMWToolsExtract\VMware\VMware Tools\VMware\Drivers"</span>)<font></font>
	}</code></pre></li>
<li>  Windows Server 2019    :<br>
 <pre><code class="powershell hljs"><span class="hljs-built_in">Convert-WindowsImage</span> @ConvertWindowsImageParam</code></pre><br>
<br>
<img src="https://habrastorage.org/webt/ir/6p/xy/ir6pxyqu8i8ozn84rgujrq4gb08.png"><br>
<br>
<img src="https://habrastorage.org/webt/re/-3/fq/re-3fqylonvifkcfyehomcicvuw.png"></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installation takes up to 30 minutes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this example, the output is a fully prepared OS in the Sysprepped state, but nothing prevents us from using Unattend.xml for customization (Customization specifications are a little puzzled when you see the sysprep template and the VM does not expand). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Read more about the keys of this wonderful kmlet </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and in Get-Help of the kmlet itself. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After that, you can load the disk onto ESXi, create a VM and install VMware Tools. </font><font style="vertical-align: inherit;">And deploy virtual machines without worrying about quiescing snapshots issues.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But what if there is already a ‚Äúdefective‚Äù template?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is enough to simply delete the Recovery partition via diskpart.exe and move the EFI and system partitions for the beauty of the markup (but you can not do this). </font><font style="vertical-align: inherit;">Is it supported? </font><font style="vertical-align: inherit;">On a virtual machine - definitely!</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We start cmd.exe.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We start diskpart.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get the list of drives:</font></font><br>
 <pre><code class="powershell hljs">list disk</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Select a disk:</font></font><br>
 <pre><code class="powershell hljs"><span class="hljs-built_in">select</span> disk n</code></pre><br>
 <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">where n is the disk number.</font></font></i></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We list the sections:</font></font><br>
 <pre><code class="powershell hljs">list partition</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We look at the Recovery (n) partition number and select it:</font></font><br>
 <pre><code class="powershell hljs"><span class="hljs-built_in">select</span> partition n</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remove protection from the section:</font></font><br>
 <pre><code class="powershell hljs">gpt attributes=<span class="hljs-number">0</span>x8000000000000000</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Delete:</font></font><br>
 <pre><code class="powershell hljs">delete partition</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Profit!</font></font></li>
</ol><br>
<img src="https://habrastorage.org/webt/fk/xe/2m/fkxe2m81vbqal-ypbn7ptuzoya4.png"><br>
<br>
<img src="https://habrastorage.org/webt/r8/qk/op/r8qkopkg6yquhsbr6bsmepw6ydk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VM is ready for Quescing Snapshots!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instead of a conclusion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This approach is just one of the options for deploying Windows Server and solving the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KB60395</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> problem </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Of course, in this case we can make thin VDH and then use the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quemu-img utility to</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> convert the virtual disk to the OVF archive, which ESXi understands very well. </font><font style="vertical-align: inherit;">Such a scenario is quite appropriate, for example, in the case when the virtual disk needs to be transferred over the network. </font><font style="vertical-align: inherit;">Understanding the history of the issue and the true nature of the problem always makes it possible to find a solution suitable for a particular infrastructure. </font><font style="vertical-align: inherit;">Technical implementation is a field for interesting experiments and fantasies, which is unlimited.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en488146/index.html">[Discussion]: Are IT engineers, are IT engineers?</a></li>
<li><a href="../en488148/index.html">HighLoad ++, Mikhail Raichenko (ManyChat): almost without magic, or how easy it is to distribute terabit video stream</a></li>
<li><a href="../en488150/index.html">Antiquities: ThinkPad X200 and closed source</a></li>
<li><a href="../en488152/index.html">A prototype multiplayer game for 3 pm?</a></li>
<li><a href="../en488154/index.html">We get into the shoes of the office manager. Basic Supply Algorithms</a></li>
<li><a href="../en488162/index.html">The higher the rating, the more money and vice versa</a></li>
<li><a href="../en488164/index.html">SEC battle against Telegram</a></li>
<li><a href="../en488180/index.html">New Silence Bootloader</a></li>
<li><a href="../en488184/index.html">Powered by ZeroTier. A practical guide to building virtual networks. Part 2</a></li>
<li><a href="../en488186/index.html">My QA Engineer Path: Through Burnout to High Testing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>