<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöµüèº üíáüèø üë©‚Äçüöí Red Team Tactics: Techniques avanc√©es de surveillance des processus dans les op√©rations offensives üßëüèæ ‚õÑÔ∏è üê≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Rebonjour. A la veille du Pentest. Pratique des tests de p√©n√©tration ¬ªa traduit un autre mat√©riel int√©ressant pour vous.
 
 
 
 Dans cet article, nous...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Red Team Tactics: Techniques avanc√©es de surveillance des processus dans les op√©rations offensives</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/498544/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rebonjour. </font><font style="vertical-align: inherit;">A la veille du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pentest. </font><font style="vertical-align: inherit;">Pratique des tests de p√©n√©tration ¬ªa</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> traduit un autre mat√©riel int√©ressant pour vous.</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/av/qe/wo/avqewourhsmerqakgy0q9hqbk-e.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, nous allons comprendre les capacit√©s des utilitaires de surveillance de processus bien connus et montrer comment utiliser la technologie sous-jacente √† ces outils pour les op√©rations offensives de l'√©quipe rouge. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une bonne compr√©hension technique du syst√®me sur lequel nous nous appuyons est un crit√®re cl√© pour prendre des d√©cisions sur la prochaine √©tape de l'op√©ration. La collecte et l'analyse de donn√©es sur les processus en cours d'ex√©cution dans des syst√®mes compromis nous fournissent une mine d'informations et nous aident √† comprendre le fonctionnement de l'infrastructure informatique de l'organisation cible. De plus, les donn√©es de processus p√©riodiquement demand√©es nous aident √† r√©pondre aux changements environnementaux et √† recevoir des signaux de d√©clenchement lorsqu'une enqu√™te commence.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour pouvoir collecter des donn√©es de processus d√©taill√©es sur des points de terminaison compromis, nous avons cr√©√© une bo√Æte √† outils qui a r√©uni la puissance des utilitaires de processus avanc√©s et des cadres C2 (tels que Cobalt Strike). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les outils (et leur code source) peuvent √™tre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trouv√©s ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilitaires syst√®me internes Windows</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer, nous d√©terminerons quels utilitaires peuvent √™tre utilis√©s pour collecter des informations sur les processus informatiques sous Windows. </font><font style="vertical-align: inherit;">Nous apprenons ensuite comment ces utilitaires collectent des informations afin de pouvoir les utiliser ult√©rieurement dans les kits d'outils Red Team.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le syst√®me d'exploitation Windows est √©quip√© de nombreux utilitaires pr√™ts √† l'emploi pour l'administration du syst√®me. Bien que la plupart des outils fournis conviennent √† des fins d'administration de syst√®me de base, certains d'entre eux n'ont pas les fonctions n√©cessaires pour le d√©pannage et la surveillance avanc√©s. Par exemple, le gestionnaire de t√¢ches Windows nous donne des informations de base sur tous les processus en cours d'ex√©cution dans le syst√®me, mais que faire si nous avons besoin d'informations plus d√©taill√©es, telles que des descripteurs d'objet, des connexions r√©seau ou des modules charg√©s dans le cadre d'un processus sp√©cifique? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour collecter ces informations, il existe un outil plus avanc√©. Par exemple, les utilitaires syst√®me du package </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sysinternals</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. En tant que membre de l'√©quipe rouge avec une vaste exp√©rience en administration de r√©seaux et de syst√®mes, j'ai toujours √©t√© un grand fan de Sysinternals. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors du d√©pannage d'un syst√®me de serveur √† ex√©cution lente ou d'un ordinateur client infect√©, j'ai le plus souvent commenc√© √† d√©panner √† l'aide d'outils tels que Process Explorer ou Procmon. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Du point de vue de la criminalistique num√©rique, ces outils semblent √©galement tr√®s utiles pour effectuer une analyse dynamique de base d'√©chantillons de logiciels malveillants et rechercher des artefacts dans des syst√®mes infect√©s. Alors, pourquoi ces outils sont-ils si populaires aupr√®s des administrateurs syst√®me et des professionnels de la s√©curit√©? D√©couvrons-le, en explorant certaines informations de processus que nous pouvons obtenir en utilisant l'outil Process Explorer.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisation de Process Explorer</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La premi√®re chose que nous voyons au d√©marrage de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Process Explorer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est une liste / arborescence de tous les processus en cours d'ex√©cution du syst√®me. </font><font style="vertical-align: inherit;">Cela nous donne des informations sur les noms des processus, leurs identifiants, le contexte de l'utilisateur et le niveau d'int√©grit√© des informations de processus et de version. </font><font style="vertical-align: inherit;">Des informations suppl√©mentaires peuvent √©galement √™tre refl√©t√©es en ajustant les colonnes en cons√©quence. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9d/9s/fk/9d9sfkhmwl222wp8vlzcuhcw85y.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si nous utilisons le panneau du bas, nous serons en mesure d'afficher tous les modules charg√©s par un processus particulier, ou de passer √† l'affichage des descripteurs afin de se familiariser avec tous les objets descripteurs nomm√©s qui sont utilis√©s par le processus:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ba/ss/ei/bassei2hnk4jg_kuyl2xd3maihg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La navigation dans les modules peut √™tre utile lors de la recherche de biblioth√®ques malveillantes charg√©es dans le processus, ou pour Red Team, il s'agit d'un produit de s√©curit√© actif (par exemple, EDR) qui a impl√©ment√© un module de connexion API en mode utilisateur. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ly/f0/sn/lyf0snflh_begeau_5pjbtwhtis.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Le passage √† l'affichage des descripteurs vous permet de vous familiariser avec le type et le nom de tous les objets nomm√©s utilis√©s dans le processus. Cela peut √™tre utile pour savoir quels fichiers et cl√©s de registre sont ouverts, quels canaux nomm√©s sont utilis√©s pour la communication interprocessus. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Si vous double-cliquez sur le nom du processus, une fen√™tre contenant des informations plus d√©taill√©es appara√Ætra. Regardons quelques onglets pour en savoir plus sur les propri√©t√©s suppl√©mentaires de l'objet: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mx/cr/k-/mxcrk-tik-hny6ailuno3pksvs4.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Onglet </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Image</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">affiche des informations sur le chemin binaire, le r√©pertoire de travail et les options de ligne de commande. De plus, il affiche des informations sur le contexte utilisateur, le processus parent, le type d'image (x86 ou x64) et bien plus encore. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-i/_o/bu/-i_obubvbxw47snh32g2ysmp7yg.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 L'onglet </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Threads</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contient des informations sur l'ex√©cution des threads dans le processus. Lorsque vous s√©lectionnez un flux, puis cliquez dessus, le bouton de pile refl√©tera la pile d'appels pour ce flux particulier. Pour afficher les threads / appels lanc√©s en mode noyau, Process Explorer utilise le pilote du noyau, qui est install√© lorsque vous travaillez en mode √©lev√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Du point de vue de DFIR, les informations sur les threads sont utiles pour d√©tecter les injections en m√©moire, par exemple, lorsqu'il existe une menace de virus sans fichier. </font><font style="vertical-align: inherit;">Ainsi, les flux qui ne sont pas sauvegard√©s par des fichiers sur le disque peuvent signaler un comportement suspect. </font><font style="vertical-align: inherit;">Pour plus d'informations sur les threads et la m√©moire, je recommande fortement de pr√™ter attention √† l'outil </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Process Hacker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3w/_s/0s/3w_s0sra5w6xq4_jf56lbg7czu4.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Un autre onglet int√©ressant dans Process Explorer est l'onglet TCP / IP. </font><font style="vertical-align: inherit;">Vous y verrez toutes les connexions r√©seau associ√©es √† ce processus. </font><font style="vertical-align: inherit;">D'un point de vue d'attaque, cela peut √™tre utile pour comprendre quand une connexion est √©tablie √† partir d'un syst√®me compromis. </font><font style="vertical-align: inherit;">Une session distante PowerShell entrante ou une session RDP peut signaler qu'une enqu√™te a d√©j√† commenc√©.</font></font><br>
 <br>
 <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisation des m√©thodes discut√©es pour l'attaque</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Maintenant que nous avons appris un peu de choses int√©ressantes sur les processus et sur les informations que nous pouvons collecter √† leur sujet √† l'aide de Process Explorer, vous vous demandez peut-√™tre comment acc√©der √† ces informations √† partir de nos frameworks C2 pr√©f√©r√©s. Bien s√ªr, nous pourrions utiliser PowerShell, car cela nous donnerait la possibilit√© d'utiliser un langage de script puissant et une API Windows. Cependant, aujourd'hui PowerShell est sous la surveillance constante du service de s√©curit√©, nous essayons donc d'√©viter cette m√©thode. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cobalt Strike,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous pouvons utiliser la commande ps dans le contexte des balises. Cette commande affiche des informations de base sur le processus en fonction de tous les processus en cours d'ex√©cution dans le syst√®me. En combinaison avec un script </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@r3dQu1nn ProcessColor</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, cette m√©thode est probablement la meilleure pour obtenir des donn√©es de processus.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La sortie de la commande </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><font style="vertical-align: inherit;">utile pour trier rapidement les processus en cours d'ex√©cution, mais ils ne contiennent pas d'informations d√©taill√©es qui vous aideraient √† mieux comprendre le syst√®me. </font><font style="vertical-align: inherit;">Pour collecter des informations plus d√©taill√©es, nous avons cr√©√© nos propres utilitaires pour obtenir des informations sur les processus. </font><font style="vertical-align: inherit;">Avec leur aide, nous pouvons collecter et enrichir les informations obtenues √† partir de syst√®mes compromis.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outils PS </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Il n'est pas facile de r√©pliquer les fonctionnalit√©s et les informations fournies par un outil tel que Process Explorer. Nous devons d'abord d√©couvrir comment ces outils fonctionnent sous le capot (et en mode utilisateur), puis nous devons comprendre comment mieux refl√©ter ces informations dans la console, et non dans l'interface graphique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir analys√© le code source, il est devenu clair que de nombreux outils de bas niveau pour fournir des informations syst√®me sont largement bas√©s sur l'API </font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NtQuerySystemInformation</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> native </font><font style="vertical-align: inherit;">. Bien que l'API et ses structures associ√©es ne soient pas enti√®rement document√©es, cette API vous permet de collecter de nombreuses informations sur le syst√®me Windows. Donc, en utilisant </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NtQuerySystemInformation</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comme point de d√©part pour la collecte d'informations sur les processus en cours d'ex√©cution dans le syst√®me, nous utiliserons le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEB des</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> processus individuels pour collecter des informations d√©taill√©es sur chacun d'entre eux. </font><font style="vertical-align: inherit;">En utilisant l'API </font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NtQueryInformationProcess,</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous pouvons lire la structure </font></font><code>PROCESS_BASIC_INFORMATION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† l'aide du descripteur de processus et la trouver </font></font><code>PebBaseAddress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ensuite, nous utilisons l' </font></font><code>NtReadVirtualMemory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API pour lire la structure </font></font><code>RTL_USER_PROCESS_PARAMETERS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ce qui nous permettra de conna√Ætre les param√®tres </font></font><code>ImagePathName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et le </font></font><code>CommandLine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">processus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En utilisant ces API comme base de notre code, nous avons √©crit les outils suivants pour obtenir des informations sur les processus:</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : affiche une liste d√©taill√©e de tous les processus en cours d'ex√©cution sur le syst√®me.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psk</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : affiche les informations du noyau, y compris les pilotes charg√©s.</font></font></li>
<li><i>Psc</i>:        TCP-.</li>
<li><i>Psm</i>:          (    , ).</li>
<li><i>Psh</i>:         (,  ,  ).</li>
<li><i>Psw</i>:        .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Tous ces outils sont √©crits en C en tant que DLL r√©fl√©chissantes et peuvent √™tre int√©gr√©s de mani√®re r√©fl√©chie dans un processus g√©n√©r√© √† l'aide d'un framework C2, tel que Cobalt Strike (ou tout autre framework prenant en charge les injections de DLL r√©fl√©chissantes). </font><font style="vertical-align: inherit;">Pour Cobalt Strike, nous avons ajout√© un script d'agresseur qui peut √™tre utilis√© pour charger des outils √† l'aide du gestionnaire de scripts Cobalt Strike. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinons chaque outil sp√©cifique lanc√© dans Cobalt Strike afin de d√©montrer la fonctionnalit√© et de montrer quelles informations peuvent √™tre collect√©es en l'utilisant:</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psx</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Cet outil affiche une liste d√©taill√©e de tous les processus en cours d'ex√©cution sur le syst√®me. La sortie peut √™tre compar√©e aux informations de l'√©cran principal de Process Explorer. Psx affiche le nom du processus, son identifiant, le PID parent, l'heure de cr√©ation et les informations relatives aux fichiers binaires du processus (architecture, nom de l'entreprise, version, etc.). Comme vous pouvez le voir, il affiche √©galement des informations int√©ressantes sur le noyau actif du syst√®me, par exemple, l'adresse de base du noyau, qui est utile lors de l'utilisation du noyau (par exemple, pour calculer les d√©calages des gadgets ROP). Toutes ces informations peuvent √™tre collect√©es √† partir d'un contexte utilisateur normal (sans √©l√©vation de privil√®ges).</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ni/jt/be/nijtbefsyhpct-kkpkxpwdp4pvc.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Si nous avons suffisamment d'autorisations pour ouvrir le descripteur de processus, vous pouvez lire des informations suppl√©mentaires, telles que le contexte de l'utilisateur et le niveau d'int√©grit√© de son jeton. </font><font style="vertical-align: inherit;">L'√©num√©ration du PEB et des structures associ√©es vous permet d'obtenir des informations sur le chemin de l'image et les param√®tres de ligne de commande: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-d/hu/bm/-dhubmeevabpdhf1_-f_wpq8q9c.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 comme vous l'avez peut-√™tre remarqu√©, nous lisons et affichons les informations de version √† partir d'images de processus binaires, par exemple, le nom et la description de l'entreprise. </font><font style="vertical-align: inherit;">Connaissant le nom de l'entreprise, vous pouvez facilement r√©pertorier tous les produits de s√©curit√© actifs du syst√®me. </font><font style="vertical-align: inherit;">En utilisant cet outil, nous comparons les noms des entreprises de tous les processus actifs avec une liste de fournisseurs bien connus de produits de s√©curit√© et affichons les r√©sultats:</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/xv/c4/nf/xvc4nflmu_fzxkgjq8wuq5zkd0m.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psk</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Cet outil refl√®te des informations sur le noyau en cours d'ex√©cution, y compris tous les modules de pilotes charg√©s. </font><font style="vertical-align: inherit;">Comme l'outil Psx, il fournit √©galement un r√©sum√© de tous les modules de noyau charg√©s √† partir de produits de s√©curit√© bien connus.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oe/mr/ii/oemrii004bpzkatpi1solktzfvq.png"><br>
 <br>
 <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psc</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Cet outil utilise les m√™mes m√©thodes pour afficher des informations sur les processus actifs que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sauf qu'il n'affiche que les processus avec une connexion r√©seau active (IPv4, IPv6 TCP, RDP, ICA):</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/m9/gf/su/m9gfsulxhhfcacdvaofmpmxvdpy.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psm</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Vous pouvez utiliser cet outil pour obtenir des informations d√©taill√©es sur un processus sp√©cifique. </font><font style="vertical-align: inherit;">Il affichera une liste de tous les modules (DLL) utilis√©s par le processus et la connexion r√©seau:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yu/5x/wc/yu5xwczhban43kmlv5kjjg7o8v8.png"><br>
 <br>
 <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psh</font></font></h3><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Identique</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
 √† </font><i><font style="vertical-align: inherit;">Psm</font></i><font style="vertical-align: inherit;"> , mais au lieu de modules charg√©s, il affiche une liste de descripteurs de processus:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-q/ok/nt/-qokntyj-1pdgaetariouoyi15a.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psw</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Le dernier mais non le moins important outil </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psw</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cet outil affichera une liste des processus avec des poign√©es de fen√™tre actives, ceux qui sont ouverts sur le bureau de l'utilisateur, y compris les titres de fen√™tre. </font><font style="vertical-align: inherit;">Ceci est utile pour d√©terminer quelles interfaces d'application graphique l'utilisateur ouvre sans avoir √† prendre des captures d'√©cran du bureau:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tj/ah/zg/tjahzg3ck9ed8-9of7hvv0krrl4.png"><br>
 <br>
 <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cas d'utilisation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Vous vous demandez peut-√™tre: "Et comment tout cela nous aide-t-il dans les op√©rations offensives?" </font><font style="vertical-align: inherit;">Apr√®s avoir acc√©d√© √† un actif compromis, nous utilisons g√©n√©ralement ces informations aux fins suivantes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©tectez les outils de s√©curit√© sur un actif compromis. </font><font style="vertical-align: inherit;">Non seulement par les informations de processus, mais aussi par les modules charg√©s.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©tection de moteurs √† crochet personnalis√©s.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recherche d'opportunit√©s de man≈ìuvres (via des sessions r√©seau) et d'escalade de privil√®ges.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s le premier compromis, vous pouvez p√©riodiquement demander des informations similaires sur les processus et commencer √† cr√©er des d√©clencheurs. </font><font style="vertical-align: inherit;">Par exemple, nous entrons automatiquement ces informations dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RedELK</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vous pouvez ensuite cr√©er des alertes concernant des modifications suspectes dans les informations de processus, telles que:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lancez un outil d'audit de s√©curit√© ou installez un nouveau produit de s√©curit√© de point final.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connexions r√©seau entrantes du service de s√©curit√© via une session RDP ou PowerShell distant.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouverture d'une poign√©e par un autre processus sur l'un de nos artefacts malveillants (par exemple, un fichier utilis√© pour pr√©server la pr√©sence).</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, nous avons montr√© comment des outils tels que Sysinternals Process Explorer peuvent √™tre utilis√©s pour obtenir des informations d√©taill√©es sur les processus en cours d'ex√©cution sur le syst√®me, et comment ces informations peuvent aider les administrateurs et les professionnels de la s√©curit√© √† d√©panner et √† v√©rifier le syst√®me pour des probl√®mes de s√©curit√© ou performance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les m√™mes informations sont √©galement pertinentes et utiles pour Red Team, qui ont acc√®s √† des syst√®mes compromis pendant le fonctionnement. Il permet de mieux comprendre le syst√®me et l'infrastructure informatique de votre objectif, et la remise en question p√©riodique d'un tel syst√®me permet √† l'√©quipe rouge de r√©pondre √† d'√©ventuels changements de l'environnement (par exemple, un d√©clencheur d'enqu√™te).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons r√©pliqu√© certaines des fonctionnalit√©s fournies par des outils tels que Process Explorer, afin que nous puissions utiliser les m√™mes informations dans des op√©rations offensives. </font><font style="vertical-align: inherit;">Pour ce faire, plusieurs outils de surveillance des processus ont √©t√© cr√©√©s et peuvent √™tre utilis√©s dans le cadre du C2, par exemple Cobalt Strike. </font><font style="vertical-align: inherit;">Nous avons montr√© comment utiliser ces outils et quelles informations vous pouvez utiliser pour les collecter. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces outils sont disponibles sur notre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">page GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et sont pr√™ts √† √™tre utilis√©s dans le cadre de Cobalt Strike.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En savoir plus sur le cours.</font></font><br>
</a><br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr498534/index.html">Reconnaissance des documents et des personnes: une union au nom de la libert√© ou un pas vers une dictature num√©rique?</a></li>
<li><a href="../fr498536/index.html">Comment r√©utiliser du code avec des bundles symfony 5? Partie 2. Nous sortons le code dans le bundle</a></li>
<li><a href="../fr498538/index.html">Mon beau crapaud</a></li>
<li><a href="../fr498540/index.html">Infographies utilisant Excel et PowerPoint. Partie 2</a></li>
<li><a href="../fr498542/index.html">Cours pratique ¬´Recherche de logiciels malveillants dans IoT¬ª</a></li>
<li><a href="../fr498548/index.html">Cr√©ation de votre propre package pour Laravel Nova: OptimalImage</a></li>
<li><a href="../fr498552/index.html">Quelles erreurs font les gestionnaires sur un site distant</a></li>
<li><a href="../fr498556/index.html">Hans Peter Lun et la naissance de l'algorithme de hachage</a></li>
<li><a href="../fr498560/index.html">Composants Web dans un vrai projet</a></li>
<li><a href="../fr498562/index.html">Contrairement √† la quarantaine: comment nous avons transf√©r√© nos stages dans un format distant</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>