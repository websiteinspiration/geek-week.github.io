<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚵🏼 💇🏿 👩‍🚒 Red Team Tactics: Techniques avancées de surveillance des processus dans les opérations offensives 🧑🏾 ⛄️ 🐳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Rebonjour. A la veille du Pentest. Pratique des tests de pénétration »a traduit un autre matériel intéressant pour vous.
 
 
 
 Dans cet article, nous...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Red Team Tactics: Techniques avancées de surveillance des processus dans les opérations offensives</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/498544/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rebonjour. </font><font style="vertical-align: inherit;">A la veille du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pentest. </font><font style="vertical-align: inherit;">Pratique des tests de pénétration »a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> traduit un autre matériel intéressant pour vous.</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/av/qe/wo/avqewourhsmerqakgy0q9hqbk-e.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, nous allons comprendre les capacités des utilitaires de surveillance de processus bien connus et montrer comment utiliser la technologie sous-jacente à ces outils pour les opérations offensives de l'équipe rouge. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une bonne compréhension technique du système sur lequel nous nous appuyons est un critère clé pour prendre des décisions sur la prochaine étape de l'opération. La collecte et l'analyse de données sur les processus en cours d'exécution dans des systèmes compromis nous fournissent une mine d'informations et nous aident à comprendre le fonctionnement de l'infrastructure informatique de l'organisation cible. De plus, les données de processus périodiquement demandées nous aident à répondre aux changements environnementaux et à recevoir des signaux de déclenchement lorsqu'une enquête commence.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour pouvoir collecter des données de processus détaillées sur des points de terminaison compromis, nous avons créé une boîte à outils qui a réuni la puissance des utilitaires de processus avancés et des cadres C2 (tels que Cobalt Strike). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les outils (et leur code source) peuvent être </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trouvés ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilitaires système internes Windows</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer, nous déterminerons quels utilitaires peuvent être utilisés pour collecter des informations sur les processus informatiques sous Windows. </font><font style="vertical-align: inherit;">Nous apprenons ensuite comment ces utilitaires collectent des informations afin de pouvoir les utiliser ultérieurement dans les kits d'outils Red Team.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le système d'exploitation Windows est équipé de nombreux utilitaires prêts à l'emploi pour l'administration du système. Bien que la plupart des outils fournis conviennent à des fins d'administration de système de base, certains d'entre eux n'ont pas les fonctions nécessaires pour le dépannage et la surveillance avancés. Par exemple, le gestionnaire de tâches Windows nous donne des informations de base sur tous les processus en cours d'exécution dans le système, mais que faire si nous avons besoin d'informations plus détaillées, telles que des descripteurs d'objet, des connexions réseau ou des modules chargés dans le cadre d'un processus spécifique? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour collecter ces informations, il existe un outil plus avancé. Par exemple, les utilitaires système du package </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sysinternals</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. En tant que membre de l'équipe rouge avec une vaste expérience en administration de réseaux et de systèmes, j'ai toujours été un grand fan de Sysinternals. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors du dépannage d'un système de serveur à exécution lente ou d'un ordinateur client infecté, j'ai le plus souvent commencé à dépanner à l'aide d'outils tels que Process Explorer ou Procmon. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Du point de vue de la criminalistique numérique, ces outils semblent également très utiles pour effectuer une analyse dynamique de base d'échantillons de logiciels malveillants et rechercher des artefacts dans des systèmes infectés. Alors, pourquoi ces outils sont-ils si populaires auprès des administrateurs système et des professionnels de la sécurité? Découvrons-le, en explorant certaines informations de processus que nous pouvons obtenir en utilisant l'outil Process Explorer.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisation de Process Explorer</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La première chose que nous voyons au démarrage de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Process Explorer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est une liste / arborescence de tous les processus en cours d'exécution du système. </font><font style="vertical-align: inherit;">Cela nous donne des informations sur les noms des processus, leurs identifiants, le contexte de l'utilisateur et le niveau d'intégrité des informations de processus et de version. </font><font style="vertical-align: inherit;">Des informations supplémentaires peuvent également être reflétées en ajustant les colonnes en conséquence. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9d/9s/fk/9d9sfkhmwl222wp8vlzcuhcw85y.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si nous utilisons le panneau du bas, nous serons en mesure d'afficher tous les modules chargés par un processus particulier, ou de passer à l'affichage des descripteurs afin de se familiariser avec tous les objets descripteurs nommés qui sont utilisés par le processus:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ba/ss/ei/bassei2hnk4jg_kuyl2xd3maihg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La navigation dans les modules peut être utile lors de la recherche de bibliothèques malveillantes chargées dans le processus, ou pour Red Team, il s'agit d'un produit de sécurité actif (par exemple, EDR) qui a implémenté un module de connexion API en mode utilisateur. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ly/f0/sn/lyf0snflh_begeau_5pjbtwhtis.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Le passage à l'affichage des descripteurs vous permet de vous familiariser avec le type et le nom de tous les objets nommés utilisés dans le processus. Cela peut être utile pour savoir quels fichiers et clés de registre sont ouverts, quels canaux nommés sont utilisés pour la communication interprocessus. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Si vous double-cliquez sur le nom du processus, une fenêtre contenant des informations plus détaillées apparaîtra. Regardons quelques onglets pour en savoir plus sur les propriétés supplémentaires de l'objet: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mx/cr/k-/mxcrk-tik-hny6ailuno3pksvs4.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Onglet </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Image</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">affiche des informations sur le chemin binaire, le répertoire de travail et les options de ligne de commande. De plus, il affiche des informations sur le contexte utilisateur, le processus parent, le type d'image (x86 ou x64) et bien plus encore. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-i/_o/bu/-i_obubvbxw47snh32g2ysmp7yg.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 L'onglet </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Threads</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contient des informations sur l'exécution des threads dans le processus. Lorsque vous sélectionnez un flux, puis cliquez dessus, le bouton de pile reflétera la pile d'appels pour ce flux particulier. Pour afficher les threads / appels lancés en mode noyau, Process Explorer utilise le pilote du noyau, qui est installé lorsque vous travaillez en mode élevé.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Du point de vue de DFIR, les informations sur les threads sont utiles pour détecter les injections en mémoire, par exemple, lorsqu'il existe une menace de virus sans fichier. </font><font style="vertical-align: inherit;">Ainsi, les flux qui ne sont pas sauvegardés par des fichiers sur le disque peuvent signaler un comportement suspect. </font><font style="vertical-align: inherit;">Pour plus d'informations sur les threads et la mémoire, je recommande fortement de prêter attention à l'outil </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Process Hacker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3w/_s/0s/3w_s0sra5w6xq4_jf56lbg7czu4.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Un autre onglet intéressant dans Process Explorer est l'onglet TCP / IP. </font><font style="vertical-align: inherit;">Vous y verrez toutes les connexions réseau associées à ce processus. </font><font style="vertical-align: inherit;">D'un point de vue d'attaque, cela peut être utile pour comprendre quand une connexion est établie à partir d'un système compromis. </font><font style="vertical-align: inherit;">Une session distante PowerShell entrante ou une session RDP peut signaler qu'une enquête a déjà commencé.</font></font><br>
 <br>
 <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisation des méthodes discutées pour l'attaque</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Maintenant que nous avons appris un peu de choses intéressantes sur les processus et sur les informations que nous pouvons collecter à leur sujet à l'aide de Process Explorer, vous vous demandez peut-être comment accéder à ces informations à partir de nos frameworks C2 préférés. Bien sûr, nous pourrions utiliser PowerShell, car cela nous donnerait la possibilité d'utiliser un langage de script puissant et une API Windows. Cependant, aujourd'hui PowerShell est sous la surveillance constante du service de sécurité, nous essayons donc d'éviter cette méthode. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cobalt Strike,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous pouvons utiliser la commande ps dans le contexte des balises. Cette commande affiche des informations de base sur le processus en fonction de tous les processus en cours d'exécution dans le système. En combinaison avec un script </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@r3dQu1nn ProcessColor</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, cette méthode est probablement la meilleure pour obtenir des données de processus.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La sortie de la commande </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><font style="vertical-align: inherit;">utile pour trier rapidement les processus en cours d'exécution, mais ils ne contiennent pas d'informations détaillées qui vous aideraient à mieux comprendre le système. </font><font style="vertical-align: inherit;">Pour collecter des informations plus détaillées, nous avons créé nos propres utilitaires pour obtenir des informations sur les processus. </font><font style="vertical-align: inherit;">Avec leur aide, nous pouvons collecter et enrichir les informations obtenues à partir de systèmes compromis.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outils PS </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Il n'est pas facile de répliquer les fonctionnalités et les informations fournies par un outil tel que Process Explorer. Nous devons d'abord découvrir comment ces outils fonctionnent sous le capot (et en mode utilisateur), puis nous devons comprendre comment mieux refléter ces informations dans la console, et non dans l'interface graphique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir analysé le code source, il est devenu clair que de nombreux outils de bas niveau pour fournir des informations système sont largement basés sur l'API </font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NtQuerySystemInformation</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> native </font><font style="vertical-align: inherit;">. Bien que l'API et ses structures associées ne soient pas entièrement documentées, cette API vous permet de collecter de nombreuses informations sur le système Windows. Donc, en utilisant </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NtQuerySystemInformation</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comme point de départ pour la collecte d'informations sur les processus en cours d'exécution dans le système, nous utiliserons le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEB des</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> processus individuels pour collecter des informations détaillées sur chacun d'entre eux. </font><font style="vertical-align: inherit;">En utilisant l'API </font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NtQueryInformationProcess,</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous pouvons lire la structure </font></font><code>PROCESS_BASIC_INFORMATION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">à l'aide du descripteur de processus et la trouver </font></font><code>PebBaseAddress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ensuite, nous utilisons l' </font></font><code>NtReadVirtualMemory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API pour lire la structure </font></font><code>RTL_USER_PROCESS_PARAMETERS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ce qui nous permettra de connaître les paramètres </font></font><code>ImagePathName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et le </font></font><code>CommandLine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">processus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En utilisant ces API comme base de notre code, nous avons écrit les outils suivants pour obtenir des informations sur les processus:</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : affiche une liste détaillée de tous les processus en cours d'exécution sur le système.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psk</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : affiche les informations du noyau, y compris les pilotes chargés.</font></font></li>
<li><i>Psc</i>:        TCP-.</li>
<li><i>Psm</i>:          (    , ).</li>
<li><i>Psh</i>:         (,  ,  ).</li>
<li><i>Psw</i>:        .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Tous ces outils sont écrits en C en tant que DLL réfléchissantes et peuvent être intégrés de manière réfléchie dans un processus généré à l'aide d'un framework C2, tel que Cobalt Strike (ou tout autre framework prenant en charge les injections de DLL réfléchissantes). </font><font style="vertical-align: inherit;">Pour Cobalt Strike, nous avons ajouté un script d'agresseur qui peut être utilisé pour charger des outils à l'aide du gestionnaire de scripts Cobalt Strike. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinons chaque outil spécifique lancé dans Cobalt Strike afin de démontrer la fonctionnalité et de montrer quelles informations peuvent être collectées en l'utilisant:</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psx</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Cet outil affiche une liste détaillée de tous les processus en cours d'exécution sur le système. La sortie peut être comparée aux informations de l'écran principal de Process Explorer. Psx affiche le nom du processus, son identifiant, le PID parent, l'heure de création et les informations relatives aux fichiers binaires du processus (architecture, nom de l'entreprise, version, etc.). Comme vous pouvez le voir, il affiche également des informations intéressantes sur le noyau actif du système, par exemple, l'adresse de base du noyau, qui est utile lors de l'utilisation du noyau (par exemple, pour calculer les décalages des gadgets ROP). Toutes ces informations peuvent être collectées à partir d'un contexte utilisateur normal (sans élévation de privilèges).</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ni/jt/be/nijtbefsyhpct-kkpkxpwdp4pvc.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Si nous avons suffisamment d'autorisations pour ouvrir le descripteur de processus, vous pouvez lire des informations supplémentaires, telles que le contexte de l'utilisateur et le niveau d'intégrité de son jeton. </font><font style="vertical-align: inherit;">L'énumération du PEB et des structures associées vous permet d'obtenir des informations sur le chemin de l'image et les paramètres de ligne de commande: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-d/hu/bm/-dhubmeevabpdhf1_-f_wpq8q9c.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 comme vous l'avez peut-être remarqué, nous lisons et affichons les informations de version à partir d'images de processus binaires, par exemple, le nom et la description de l'entreprise. </font><font style="vertical-align: inherit;">Connaissant le nom de l'entreprise, vous pouvez facilement répertorier tous les produits de sécurité actifs du système. </font><font style="vertical-align: inherit;">En utilisant cet outil, nous comparons les noms des entreprises de tous les processus actifs avec une liste de fournisseurs bien connus de produits de sécurité et affichons les résultats:</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/xv/c4/nf/xvc4nflmu_fzxkgjq8wuq5zkd0m.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psk</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Cet outil reflète des informations sur le noyau en cours d'exécution, y compris tous les modules de pilotes chargés. </font><font style="vertical-align: inherit;">Comme l'outil Psx, il fournit également un résumé de tous les modules de noyau chargés à partir de produits de sécurité bien connus.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oe/mr/ii/oemrii004bpzkatpi1solktzfvq.png"><br>
 <br>
 <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psc</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Cet outil utilise les mêmes méthodes pour afficher des informations sur les processus actifs que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sauf qu'il n'affiche que les processus avec une connexion réseau active (IPv4, IPv6 TCP, RDP, ICA):</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/m9/gf/su/m9gfsulxhhfcacdvaofmpmxvdpy.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psm</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Vous pouvez utiliser cet outil pour obtenir des informations détaillées sur un processus spécifique. </font><font style="vertical-align: inherit;">Il affichera une liste de tous les modules (DLL) utilisés par le processus et la connexion réseau:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yu/5x/wc/yu5xwczhban43kmlv5kjjg7o8v8.png"><br>
 <br>
 <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psh</font></font></h3><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Identique</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
 à </font><i><font style="vertical-align: inherit;">Psm</font></i><font style="vertical-align: inherit;"> , mais au lieu de modules chargés, il affiche une liste de descripteurs de processus:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-q/ok/nt/-qokntyj-1pdgaetariouoyi15a.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psw</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Le dernier mais non le moins important outil </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psw</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cet outil affichera une liste des processus avec des poignées de fenêtre actives, ceux qui sont ouverts sur le bureau de l'utilisateur, y compris les titres de fenêtre. </font><font style="vertical-align: inherit;">Ceci est utile pour déterminer quelles interfaces d'application graphique l'utilisateur ouvre sans avoir à prendre des captures d'écran du bureau:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tj/ah/zg/tjahzg3ck9ed8-9of7hvv0krrl4.png"><br>
 <br>
 <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cas d'utilisation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Vous vous demandez peut-être: "Et comment tout cela nous aide-t-il dans les opérations offensives?" </font><font style="vertical-align: inherit;">Après avoir accédé à un actif compromis, nous utilisons généralement ces informations aux fins suivantes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Détectez les outils de sécurité sur un actif compromis. </font><font style="vertical-align: inherit;">Non seulement par les informations de processus, mais aussi par les modules chargés.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Détection de moteurs à crochet personnalisés.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recherche d'opportunités de manœuvres (via des sessions réseau) et d'escalade de privilèges.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après le premier compromis, vous pouvez périodiquement demander des informations similaires sur les processus et commencer à créer des déclencheurs. </font><font style="vertical-align: inherit;">Par exemple, nous entrons automatiquement ces informations dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RedELK</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vous pouvez ensuite créer des alertes concernant des modifications suspectes dans les informations de processus, telles que:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lancez un outil d'audit de sécurité ou installez un nouveau produit de sécurité de point final.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connexions réseau entrantes du service de sécurité via une session RDP ou PowerShell distant.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouverture d'une poignée par un autre processus sur l'un de nos artefacts malveillants (par exemple, un fichier utilisé pour préserver la présence).</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, nous avons montré comment des outils tels que Sysinternals Process Explorer peuvent être utilisés pour obtenir des informations détaillées sur les processus en cours d'exécution sur le système, et comment ces informations peuvent aider les administrateurs et les professionnels de la sécurité à dépanner et à vérifier le système pour des problèmes de sécurité ou performance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les mêmes informations sont également pertinentes et utiles pour Red Team, qui ont accès à des systèmes compromis pendant le fonctionnement. Il permet de mieux comprendre le système et l'infrastructure informatique de votre objectif, et la remise en question périodique d'un tel système permet à l'équipe rouge de répondre à d'éventuels changements de l'environnement (par exemple, un déclencheur d'enquête).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons répliqué certaines des fonctionnalités fournies par des outils tels que Process Explorer, afin que nous puissions utiliser les mêmes informations dans des opérations offensives. </font><font style="vertical-align: inherit;">Pour ce faire, plusieurs outils de surveillance des processus ont été créés et peuvent être utilisés dans le cadre du C2, par exemple Cobalt Strike. </font><font style="vertical-align: inherit;">Nous avons montré comment utiliser ces outils et quelles informations vous pouvez utiliser pour les collecter. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces outils sont disponibles sur notre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">page GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et sont prêts à être utilisés dans le cadre de Cobalt Strike.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En savoir plus sur le cours.</font></font><br>
</a><br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr498534/index.html">Reconnaissance des documents et des personnes: une union au nom de la liberté ou un pas vers une dictature numérique?</a></li>
<li><a href="../fr498536/index.html">Comment réutiliser du code avec des bundles symfony 5? Partie 2. Nous sortons le code dans le bundle</a></li>
<li><a href="../fr498538/index.html">Mon beau crapaud</a></li>
<li><a href="../fr498540/index.html">Infographies utilisant Excel et PowerPoint. Partie 2</a></li>
<li><a href="../fr498542/index.html">Cours pratique «Recherche de logiciels malveillants dans IoT»</a></li>
<li><a href="../fr498548/index.html">Création de votre propre package pour Laravel Nova: OptimalImage</a></li>
<li><a href="../fr498552/index.html">Quelles erreurs font les gestionnaires sur un site distant</a></li>
<li><a href="../fr498556/index.html">Hans Peter Lun et la naissance de l'algorithme de hachage</a></li>
<li><a href="../fr498560/index.html">Composants Web dans un vrai projet</a></li>
<li><a href="../fr498562/index.html">Contrairement à la quarantaine: comment nous avons transféré nos stages dans un format distant</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>