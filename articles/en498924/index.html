<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßöüèº üïäÔ∏è üë®üèø‚Äçüöí Why I Love IKEv2 More Than Other VPNs üëçüèø #‚É£ üéç</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Now everyone around is setting up a VPN for remote employees. It pains me to watch how people install monstrous buggy programs, configure some kind of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Why I Love IKEv2 More Than Other VPNs</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/498924/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/gg/tv/jr/ggtvjr7iq-tknhzeiv-3cdogqw0.png"></div></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now everyone around is setting up a VPN for remote employees. It pains me to watch how people install monstrous buggy programs, configure some kind of certificates, install TUN / TAP drivers and do many complex operations, while the best solution is already built into the operating system. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IKEv2 is a modern VPN protocol developed by Microsoft and Cisco. It is used by default for new VPN connections in Windows, macOS, iOS. It is faster and safer than most VPN protocols and can be easily configured on the client side in two clicks without using third-party programs.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I believe that IPsec IKEv2 is great not only for connecting servers, but also for regular VPN end-user connections. </font><font style="vertical-align: inherit;">In this post, I will try to convince you to use IPsec IKEv2 for regular home users instead of OpenVPN.</font></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IKEv2 faster</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All things being equal, IKEv2 will always be faster than OpenVPN. </font><font style="vertical-align: inherit;">This is especially noticeable on low-power systems with slow memory, such as routers or single-board computers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The fact is that IPsec works in the context of the kernel of the operating system, and OpenVPN in the context of the user (userspace), and the processing of each package switches the context between the kernel processes and the user processes. </font><font style="vertical-align: inherit;">This affects both throughput and latency. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uy/3-/46/uy3-46uxfp_8yy9hp2l314om5fq.png"><br>
<font color="999999"><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparison of delays for different VPN protocols.</font></font></sup></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The screenshot above shows the difference in delay by half between IPsec and OpenVPN. </font><font style="vertical-align: inherit;">Of course, the difference of 1ms is impossible to notice by eye, but with a load on the system, these values ‚Äã‚Äãcan vary significantly. </font><font style="vertical-align: inherit;">In addition, the real indicators strongly depend on the characteristics of a particular system, so I will not give absolute figures for comparing the two protocols. </font><font style="vertical-align: inherit;">Delays are very important when using voice and video over VPN. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
According to my subjective feelings, IKEv2 on Windows 10 works noticeably more responsive than OpenVPN. </font><font style="vertical-align: inherit;">After all, the actual use of a desktop computer is very different from synthetic tests of VPN protocols. </font><font style="vertical-align: inherit;">The load on the processor and memory is not constant, the user can run demanding programs, all this will affect the performance.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IKEv2 easier to configure</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All modern operating systems (except Android) support IPsec IKEv2 right out of the box. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No need to install any programs</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , virtual TUN / TAP drivers, etc. </font><font style="vertical-align: inherit;">All VPN management comes from the system menu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the same time, the configuration on the client can be simplified to three lines:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Domain</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - for IPsec, a domain is required, since an SSL certificate is issued for it</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">login</font></font></b></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">password</font></font></b></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You no longer need to transfer files with certificates and keys to the client, force it to import root certificates into the system storage. </font><font style="vertical-align: inherit;">A username and password are enough, and the connection will be just as secure as in OpenVPN when using certificates, because the connection uses the same x.509 certificate as for websites with HTTPS.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setup on Windows 10</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The VPN setup wizard is called up from the WiFi connection menu. </font><font style="vertical-align: inherit;">A user of any qualification can handle the setup of one window. </font><font style="vertical-align: inherit;">The created connection is activated from the menu with a list of WiFi networks. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ju/fm/cg/jufmcgkjprojhspfqnbxjacdhtw.png"><br>
<font color="999999"><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interface for configuring a new IKEv2 connection in Windows 10</font></font></sup></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MacOS setup</font></font></b>
                        <div class="spoiler_text"> macOS  IKEv2    10.11 (El Capitan).       . <br>
<br>
<img src="https://habrastorage.org/webt/f4/ad/hk/f4adhkw9swpneyfo0jn9jgro9s4.png" alt="image"><br>
<br>
  .        .<br>
<br>
<img src="https://habrastorage.org/webt/xc/ng/zq/xcngzqon0ilejqrl7hqla-8vbf4.png" alt="image"><br>
<br>
   ,    .     ¬´Server Address¬ª   IP- ,     ¬´Remote ID¬ª,       DNS-,      .<br>
<br>
<img src="https://habrastorage.org/webt/x4/c2/eq/x4c2eqk2waefy8woi_pnaa8o5uw.png" alt="image"><br>
<br>
       <b>/etc/ipsec.secrets</b><br>
<br>
<img src="https://habrastorage.org/webt/-p/gu/98/-pgu98eevkywzjzqjd7dfvq94zc.png" alt="image"><br>
</div>
                    </div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IOS setup</font></font></b>
                        <div class="spoiler_text"> iOS     ,       mobileconfig. <br>
<br>
      macOS:<br>
<br>
<b> -&gt; VPN -&gt;   VPN</b><br>
</div>
                    </div><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IKEv2 is safe</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the previous step, we found out that a login and password are enough to configure the connection. But how can the client verify that the connection is not being tapped, the data is not being replaced, and the server is really who it claims to be? For this, ordinary SSL certificates are used, which we are used to using for websites and HTTPS. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/21/rh/ka/21rhkapzsdz7of__ym8ea2fqshw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The client installs a secure SSL tunnel with the server, and a login password is already transmitted inside it. By default, on Windows and macOS, the mschapv2 algorithm is used to transmit the password. Thus, with the help of an SSL certificate, the client verifies the authenticity of the server, and the server verifies the authenticity of the client using the login / password. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An IKEv2 server can use the same certificate with a web server, for example from the popular Let's Encrypt. This greatly simplifies certificate management.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The same model is used in OpenVPN, and if desired, you can use a certificate from Lets Encrypt in it, however, in any case, the administrator will need to transfer the file to the user to configure the VPN.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configure IKEv2 server</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can deploy your IKEv2 server in a couple of minutes using automated installation scripts or using ready-made containers. </font><font style="vertical-align: inherit;">Using docker is not recommended, since its network subsystem reduces the performance of IPsec at cheap VPS rates. </font><font style="vertical-align: inherit;">You can also configure the IKEv2 server manually, there are articles on the Habr√© with </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">examples of Strongswan server settings</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will use one of the most successful auto- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">configuration</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> scripts </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">github.com/jawj/IKEv2-setup</font></a></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
This script is good because it uses certificates from Lets Encrypt and automatically generates a valid certificate.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 1: Server Selection</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To start the VPN server, we need VDS. </font><font style="vertical-align: inherit;">The simplest configuration with a single processor core will do. </font><font style="vertical-align: inherit;">The script from our example is best tested on Ubuntu 18.04, so when creating the server, select this OS image. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oy/uq/xq/oyuqxqe5ojckq6-rfdcmsbv9qps.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We are waiting for the installation of the server to finish and copy the details for the connection. </font><font style="vertical-align: inherit;">The root password will be sent to the mail, or it can be set manually through the web-interface. </font><font style="vertical-align: inherit;">Next, we enter all the commands</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uv/ot/vm/uvotvmd9a_5l7l_g3bnnqkudxhc.png"><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 2: Install Strongswan</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We are connected by the SSH client and run the installation script:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#     IKEv2 </span><font></font>
wget https://raw.githubusercontent.com/jawj/IKEv2-setup/master/setup.sh<font></font>
chmod u+x setup.sh<font></font>
./setup.sh<font></font>
....<font></font>
<span class="hljs-comment">#      IP- </span>
<span class="hljs-comment">#   sslip.io     </span>
Hostname <span class="hljs-keyword">for</span> VPN: 123-45-67-89.sslip.io
<span class="hljs-comment">#   VPN</span><font></font>
VPN username: coolguy<font></font>
<span class="hljs-comment">#  </span><font></font>
VPN password (no quotes, please):<font></font>
....<font></font>
<span class="hljs-comment">#     SSH-,    .</span>
</code></pre><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 3: Client setup</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The entered VPN user details must now be used for configuration on the client. </font><font style="vertical-align: inherit;">It is important to use exactly the domain name that you entered in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hostname for VPN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 4: Add New Users</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To add a new user to an already created server, edit the </font><b><font style="vertical-align: inherit;">/etc/ipsec.sectes</font></b><font style="vertical-align: inherit;"> file </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></b><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># nano /etc/ipsec.secrets</span>
123-45-67-89.sslip.io : RSA <span class="hljs-string">"privkey.pem"</span>
coolguy : EAP <span class="hljs-string">"C00lPassword"</span>
badguy : EAP <span class="hljs-string">"bAdP$<span class="hljs-variable">$word</span>"</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After adding the user, run the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ipsec secrets command</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> so that Strongswan re-read the config.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We reviewed the user experience of IKEv2. </font><font style="vertical-align: inherit;">Administration of such a server is not more complicated, and sometimes even easier than OpenVPN. </font><font style="vertical-align: inherit;">If you only plan to organize remote access for your employees, be sure to look towards IKEv2. </font><font style="vertical-align: inherit;">Do not force your users to install unnecessary programs if everything you need is already on their computer. </font><font style="vertical-align: inherit;">It is more convenient, safer and much more advanced.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/iq/fi/b4/iqfib45pgphfrxv--zfemt0qnmw.jpeg"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en498912/index.html">Anti-crisis section of Habr</a></li>
<li><a href="../en498914/index.html">Growing AI - Genetic Algorithms: An Introduction</a></li>
<li><a href="../en498918/index.html">Your statement is 100% correct, only misses the point</a></li>
<li><a href="../en498920/index.html">Payment systems. Armor and Shell Competition</a></li>
<li><a href="../en498922/index.html">Errors that will ruin a project of any complexity. Redmadrobot Managers Experience</a></li>
<li><a href="../en498928/index.html">Printer Languages ‚Äã‚Äãand Technologies</a></li>
<li><a href="../en498930/index.html">Why don't you have to become a team leader?</a></li>
<li><a href="../en498932/index.html">The book "Memory Management in .NET for Professionals" in the correct translation of the DotNetRu team</a></li>
<li><a href="../en498934/index.html">How to run cron more than once per minute using PHP</a></li>
<li><a href="../en498936/index.html">Cloudflare PHP API Binding</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>