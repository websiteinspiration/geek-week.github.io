<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äçüíº üè© ü§∂üèª Kaboom: an unusual sapper üßô üëèüèæ üë®üèº‚Äç‚öïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As a child, I sat at my father‚Äôs work three times a week for an hour and a half. I was allowed to go to a computer, where from entertainment there was...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Kaboom: an unusual sapper</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/cloud4y/blog/487052/"><img src="https://habrastorage.org/webt/8r/zx/fj/8rzxfjri6jhsbbuodzrjy8eauae.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As a child, I sat at my father‚Äôs work three times a week for an hour and a half. I was allowed to go to a computer, where from entertainment there was only a sapper and Paint. I was tired of drawing quickly, but the desire to open the entire field and not explode motivated me to look for new and new ways to play this game. Many years later, I accidentally stumbled upon an interesting article about a clone of a sapper, and could not pass by. I suggest that you familiarize yourself with it. This is a story about the development of Kaboom, a clone of the legendary Minesweeper game with its own zest.</font></font></i><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Minesweeper appeared quite a long time ago by the standards of a computer game. </font><font style="vertical-align: inherit;">But it seems to me that most people remember the games that were part of earlier versions of Windows. </font><font style="vertical-align: inherit;">I was never good at Minesweeper, but I played it from time to time. </font><font style="vertical-align: inherit;">Some people play </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">more seriously</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">And for those who want to cheer themselves up, I recommend watching </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minesweeper - The Movie</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Idea</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recently, I had an idea: what if you have to play Minesweeper against a wiser computer? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Typically, the location of mines is determined at the beginning of the game (but there are a few tricks here - for example, so you can‚Äôt lose the first click). But what if the location of the mines was not determined in advance and the game could choose the location of the mines after the start of the game? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That would be pretty cruel: if you click on a square that may contain a mine, it will always contain it! Thus, you must prove in advance that the square is safe.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/um/0i/hg/um0ihg9b97wzjslibzfalc5ovmy.png"><br>
<font color="#999999"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the image above, in the cells marked with a dot, there are guaranteed no mines, and cells marked with an exclamation mark are guaranteed to contain one. Question marks mean uncertainty: perhaps if you open more cells, you can calculate whether a mine is hidden there or not.</font></font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
On the other hand, there are situations when you have to guess:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ji/_r/c0/ji_rc06pslel8r2olgyyjfeqx5g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is a mine in one of the lower cells. But in which one, it is impossible to understand. You must choose one of them. But according to the condition that I just spoke of, this would mean certain death! I wanted the game to be brutal, but now it is obviously losing.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, I will slightly change the idea. You can guess, but only if there are no safe cells left. Thus, the game will be cruel, but fair.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In other words:</font></font><br>
<br>
<ul>
<li>      ,   .</li>
<li>      ,    ,   .</li>
<li>      , :<br>
<br>
<ol>
<li>     ,       ,      .</li>
<li>   ,   ,      .</li>
</ol></li>
</ul><br>
<h2>  </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How to implement such a game? I could try to calculate all possible fields, but this is unrealistic: even a small 10x10 field means 2 ^ 100 possibilities. Selecting only those that contain exactly N min does not help. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fortunately, I don‚Äôt need to worry about the whole field. We do not know anything about land mines not adjacent to tags. I am only interested in those that are on the border, the rest can be determined quite by accident. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zl/vp/qc/zlvpqcqpuapldwssoa5lhjtaff4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then I can calculate all the options for the location of mines on the border in accordance with the labels. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Backtracking</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (backtracking) - a good technique that allows you to sort through all the combinations, but also quick to retreat as soon as we determine that a branch can not calculate.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6z/0h/cf/6z0hcf6bfakj_2x3n0jyfz9bpf8.png"><br>
<font color="#999999"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The two possible locations of mines at the border are shown above. </font><font style="vertical-align: inherit;">Combining them, we will understand which cells are guaranteed to be empty or mined. </font></font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I also need to track the total number of mines. </font><font style="vertical-align: inherit;">Thus, the location really looks like ‚Äú5 min at the border, 5 min outside‚Äù. </font><font style="vertical-align: inherit;">This is important because otherwise I could have created too many mines at the border (or too few!)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, I have all the options. </font><font style="vertical-align: inherit;">What happens when a player decides to open a cage?</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Choose a random option (one that satisfies the ‚Äúcruel but fair‚Äù rules). </font><font style="vertical-align: inherit;">This will determine the location of mines on the border.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Randomly scatter those remaining outside the border.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If there is a mine in the selected cell, the game is over.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otherwise:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Define a new label for the identified cell</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reveal additional cells if it is 0</font></font></li>
<li>    ,    !       .</li>
</ol></li>
</ul><br>
<h2>  </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For small fields this is normal. </font><font style="vertical-align: inherit;">Usually there are only a few possible combinations ... wait, what is it? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/df/9n/k_/df9nk_sulyltttsf-u4pafb8fxe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oh no! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/g1/5w/nu/g15wnu_xlthcmvg94n7kjeqsg_k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Somehow, I managed to unlock 18 million possible mine locations. </font><font style="vertical-align: inherit;">My Firefox devours 12 gigabytes of memory, and opening a cell takes half a minute. </font><font style="vertical-align: inherit;">Obviously, I need a better algorithm. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Someone may notice that Minesweeper is an </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NP-complete game</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and therefore an exponentially increasing time cannot be avoided. </font><font style="vertical-align: inherit;">And in the general case, this is true - there will be positions that will take a lot of time to calculate. </font><font style="vertical-align: inherit;">But for a small area this works. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I do not need to remember all the combinations. </font><font style="vertical-align: inherit;">I do not even need to calculate all the combinations. </font><font style="vertical-align: inherit;">All that is required is a way:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">check if the cell is safe, dangerous or vague,</font></font></li>
<li>    (,   ,       ).</li>
</ul><br>
<h2> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instead of trying out the options myself, I'm going to use the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SAT solver</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . These are tools that take a formula consisting of logical variables and look for a set of values ‚Äã‚Äãthat would make the formula true. Such an imaginary, but quite valid method for our task. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A more powerful class of software is </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SMT solvers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> that work with a wider range of values ‚Äã‚Äãand formulas, such as first-order logic (quantifiers), arrays, integers, and so on. This will help at least define some equations for integers. But I need something that works in the browser. People managed to port some sophisticated tools like </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Z3Prover</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to the browser, but the WebAssembly version weighs</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17 MB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and that's too much. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I found </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MiniSat</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a small SAT solver that was compiled for Javascript by Joel Galenson. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The compiled file</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> takes only 200 kilobytes, so I use it.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CNF Formulas</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SAT solvers work with conjunctive normal formulas ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CNFs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). CNF's formula is ‚Äúan AND of ORs,‚Äù for example: </font></font><br>
<br>
<code>(a | ~ b | ~ c) &amp; (c | d ~ e) &amp; f</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
you can convert any formula of sentence logic (variables, and, or, not, implication) to CNF, so it's kind of a universal format. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How do we use it? Suppose we have a board: </font><font style="vertical-align: inherit;">
If I create variables for unknown cells (clockwise: x1, x2, x3), they will have to satisfy the following equations: </font><font style="vertical-align: inherit;">
But how to express ‚Äúthe sum of the variables is 2‚Äù in CNF? </font><font style="vertical-align: inherit;">
I found a method that, as I later learned, is called ‚Äúbinomial coding‚Äù and is the simplest coding. You should consider all possible subsets of variables. For example, for you </font><font style="vertical-align: inherit;">need the following formulas:</font></font><br>
<br>
<code>? ? 1<br>
2 ? 1</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<code>1 + 2 + 3 = 2<br>
2 + 3 = 1<br>
2 + 3 = 1 (   )</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>x1 + x2 + x3 = 2 </code><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For each subset of 2 variables, at least one is true. </font><font style="vertical-align: inherit;">This ensures that the amount is greater than 1.</font></font><br>
<code>(x1 | x2) &amp; (x1 | x3) &amp; (x2 | x3)</code></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At least one variable is false. </font><font style="vertical-align: inherit;">This ensures that the amount is less than 3.</font></font><br>
<code>(~ x1 | ~ x2 | ~ x3)</code></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For </font></font><code>x2 + x3 = 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">me I need a similar set of formulas:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At least one of the variables is correct: </font></font><code>(x2 | x3)</code></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At least one of the variables is false </font></font><code>(~ x2 | ~ x3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By combining this, I get a CNF formula with 6 points. In the standard DIMACS format: </font><font style="vertical-align: inherit;">
All position lines end with 0, and negation is marked with a minus. If I connect it to MiniSat (try it for yourself), I get: </font><font style="vertical-align: inherit;">
This means that MiniSat found a solution where x1 and x2 are true and x3 are false. Here's what the board will look like: </font><font style="vertical-align: inherit;">
The whole program is a little more complicated: this is just one solution, there is another. Therefore, to find out if x1, x2, x3 can be true (or false), you need to make more requests. I need to ask: ‚ÄúGiven the above formula, as well as x1, is this feasible? How about the above formula, as well as ~ x1 "?</font></font><br>
<br>
<code>p cnf 3 6<br>
1 2 0<br>
1 3 0<br>
2 3 0<br>
-1 -2 -3 0<br>
2 3 0<br>
-2 -3 0 </code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<code>SAT 1 2 -3</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<code>! ! 1<br>
2 . 1</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encoding means that I need to find all possible combinations (for example, all subsets of 3) of a set of variables. </font><font style="vertical-align: inherit;">However, for this equation there will only be up to 8 variables, so the formula is usually small enough so that MiniSat can quickly solve it.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Min tracking</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unfortunately, this is not a complete solution! I still need to track how many mines are left. Some combinations are impossible, because otherwise you can create more mines than allowed, and it will be impossible to win. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vj/ic/pz/vjicpzij8cclzqcvewcn3hpzgpq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In fact, the opposite case is also possible: if there are too few mines, the game will end, because there will be nothing to place. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, I need to indicate in the SAT formula that ‚Äúthe number of mines is not less than X and not more than Y‚Äù. At first I thought I could use the trick with all the combinations. Unfortunately, it does not work too well with large numbers. If there are, say, 20 cells and 10 min, then after connecting the numbers to the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">binomial coefficient,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> we find out that the number of combinations is already 6 digits!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So I found out that there are many other ways to encode the sum of variables into the SAT formula. You need to create a schema that will combine the individual variables. See, for example, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this answer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on StackExchange or </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this one</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the end, I realized the idea from an article entitled ‚ÄúEffective CNF Coding with Boolean Cardinality Constraints‚Äù, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">written by</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Olivier Baillot and Yasin Bufhad. We see a tree that recursively adds unary numbers (or sorts bits so that everyone is at the beginning):</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cg/_s/n8/cg_sn8kuz4tyzsklfiftc9pxr6i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the end of this diagram, you will get a sorted set of ‚Äúoutput‚Äù variables. To confirm that the sum is not less than X, check that the first X of the resulting variables are 1. To claim that the sum is not more than Y, check that the last N - Y of the resulting variables are 0. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is much better than using all possible combinations, however, this scheme is still irrational because it generates sentences ”® (N ^ 2). When the number of open cells is about 100, the game becomes sluggish. We can optimize the game further. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reduce Requests</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
While studying the issue, I noticed that I can reduce the number of queries to the solver. </font><font style="vertical-align: inherit;">I wanted to determine the status of all cells (that is, to check whether they are guaranteed to be dangerous, safe or not). </font><font style="vertical-align: inherit;">I did this using a simple loop. </font><font style="vertical-align: inherit;">Let's say the board is described by the formula F:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decide for </font></font><code>F &amp; ~ x1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to check if x1 can be 0</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decide for </font></font><code>F &amp; x1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to check if x1 can be 1</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decide for </font></font><code> F &amp; ~ x2 </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to check if x2 can be 0</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decide for </font></font><code>F &amp; x2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to check if x2 can be 1</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etc.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What did I notice? </font><font style="vertical-align: inherit;">If I get a solution for F &amp; ~ x1, it will also contain the values ‚Äã‚Äãof all other variables. </font><font style="vertical-align: inherit;">This already answers many other questions: if the solution contains x2 = 0, I do not need to ask if x2 can be 0, because I already know this. </font><font style="vertical-align: inherit;">This allows me to reduce the number of requests by about 2-5 times.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caching</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This does not solve the problem of the huge formula generated by the "counting" circuit. As I said, the number of sentences is in the order of N ^ 2. On a large board, the formula can be up to 10,000 assumptions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fortunately, most of the time we know the exact meaning of many cells. If the cell is guaranteed empty or guaranteed filled, the value will never change! This means that we can cache it and not include it in the SAT formula. Once we determine the state of the cell, we will no longer need to include it in the calculation again. Cells will be used as long as they are undefined. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This optimization is slightly dangerous: we no longer have a formula confirming the correctness of the entire board. If everything else works as planned, this is not a problem, but it can complicate error tracking.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Another case: playing abroad </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Are you allowed to click anywhere on the map outside the border between the open and unopened area of ‚Äã‚Äãthe field? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Initially, I thought it was the same as guessing: if there are no safe cells, you can simply click anywhere on the field. </font><font style="vertical-align: inherit;">But some find it strange that this guarantees the opening of an empty cage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, I changed the game so that a click outside the border is always punished. </font><font style="vertical-align: inherit;">With the exception of the start of the game, of course, because then the whole board is ‚Äúoutside‚Äù. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But it turns out that there is another scenario: what if all the border fields are deadly? </font><font style="vertical-align: inherit;">
You have no choice but to reveal something else. </font><font style="vertical-align: inherit;">This situation can make the game impassable from the start. </font><font style="vertical-align: inherit;">So now there is one more exception. </font><font style="vertical-align: inherit;">You are allowed to play outside the borders if:</font></font><br>
<br>
<code>3 . .<br>
. . .<br>
. . .<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The field is not open</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The mined cells may be located on the border (clicking on the outside should be safe), or</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There must be bombs in all the cells on the border (you have to click outside).</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Update</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : The change turned out to be controversial, as the restriction is somewhat artificial. </font><font style="vertical-align: inherit;">I added a switch that will allow / prohibit playing with these conditions.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It's all</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can play Kaboom </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Try turning on debugging mode: it makes the game trivial, but it shows well how it works. </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">Github</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
source code </font><font style="vertical-align: inherit;">. He is not very handsome. </font><font style="vertical-align: inherit;">
You might also be interested in a </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">similar game</font></a><font style="vertical-align: inherit;"> from Simon Tatham, creator of PuTTY. Its version has a different twist: it is always solvable without speculation. </font><font style="vertical-align: inherit;">
Play wisely! </font><b><font style="vertical-align: inherit;">What else can be useful to read on the </font></b><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">Cloud4Y</font></a></b><b><font style="vertical-align: inherit;"> blog</font></b><font style="vertical-align: inherit;"> 
‚Üí </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">How the bank ‚Äúbroke‚Äù</font></a><font style="vertical-align: inherit;"> 
‚Üí </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">Personal privacy? No, they did not hear</font></a><font style="vertical-align: inherit;"> 
‚Üí The </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">Great Theory of Snowflakes</font></a><font style="vertical-align: inherit;"> 
‚Üí </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">Diagnostics of network connections on a virtual EDGE router</font></a><font style="vertical-align: inherit;"> 
‚Üí</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a></b><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CRISPR-resistant viruses build shelters to protect genomes from DNA-penetrating enzymes.</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Subscribe to our </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegram</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> channel so you won‚Äôt miss another article! </font><font style="vertical-align: inherit;">We write no more than twice a week and only on business. </font><font style="vertical-align: inherit;">We remind you that startups can get 1 million rubles. </font><font style="vertical-align: inherit;">from Cloud4Y. </font><font style="vertical-align: inherit;">Terms and conditions for those who wish - on our website: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bit.ly/2sj6dPK</font></font></a></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en487038/index.html">Suddenly, a garbage collection system alone is not enough</a></li>
<li><a href="../en487040/index.html">Firefox Preview Nightly for Android gets support for uBlock Origin</a></li>
<li><a href="../en487042/index.html">64-core Ryzen Threadripper 3990X defeats all Intel processors in tests, including $ 20,000 Xeon</a></li>
<li><a href="../en487044/index.html">Privacy? No not heard</a></li>
<li><a href="../en487046/index.html">How to build a native library for Android</a></li>
<li><a href="../en487054/index.html">ROS: Dedicated to those stuck in Gazebo ... Platform for a robot for 28,000 rubles</a></li>
<li><a href="../en487056/index.html">Is it dangerous to keep RDP open on the Internet?</a></li>
<li><a href="../en487058/index.html">"Hadoop. ZooKeeper ‚Äùfrom the Mail.Ru Group Technostream series‚Äú Distributed Processing of Large Data in Hadoop ‚Äù</a></li>
<li><a href="../en487060/index.html">Using Google Chrome? So Google collects your data through X-client-data</a></li>
<li><a href="../en487062/index.html">CBS allowed Linux users to watch Star Trek, thanks to her for that</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>