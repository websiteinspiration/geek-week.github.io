<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé™ ‚úâÔ∏è üë®‚Äçüë®‚Äçüë¶ Linux Strace: Sejarah, Desain, dan Penggunaan üçõ üçò üë®üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam sistem operasi mirip Unix, program berkomunikasi dengan dunia luar dan sistem operasi melalui serangkaian fungsi kecil - panggilan sistem. Jadi,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Linux Strace: Sejarah, Desain, dan Penggunaan</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/493856/"><p><img src="https://habrastorage.org/webt/if/7t/n-/if7tn-gbfmclj28lr21z2y0jjtc.jpeg"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam sistem operasi mirip Unix, program berkomunikasi dengan dunia luar dan sistem operasi melalui serangkaian fungsi kecil - panggilan sistem. </font><font style="vertical-align: inherit;">Jadi, untuk keperluan debugging, berguna untuk memata-matai panggilan sistem yang dilakukan oleh proses.</font></font></p><br>
<p>  ¬´ ¬ª   Linux   <code>strace</code>,     .    ¬´¬ª     <code>strace</code>     .</p><a name="habracut"></a><br>
<h1 id="soderzhanie"></h1><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> strace   : Piglet Trace</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">:     strace</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">:     </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">:   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">:     </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">:    </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">:  </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">-:      </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">-:  </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a></li>
</ul><br>
<h1 id="proishozhdenie-vidov"> </h1><br>
<p>      OC  Unix ‚Äî   (. <em>system calls</em>, <em>syscalls</em>),         .</p><br>
<p>     Unix (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Version 6 Unix</a>, 1975 )        .     Bell Labs    (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Version 7 Unix</a>, 1979 )     ‚Äî <code>ptrace</code>.</p><br>
<p> ptrace     ,    80- (    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">System V Release 4</a>)           ‚Äî   .</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>   strace       comp.sources.sun  1992       <code>trace</code>  Sun.  ,      SunOS,   1994  <code>strace</code>    System V, Solaris    Linux.</p><br>
<p> strace   Linux       <code>ptrace</code>,   .</p><br>
<p> (  )  <code>strace</code> ‚Äî <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> </a>.            ,     , , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>.   ,      -    ¬´¬ª   "strace".</p><br>
<p>  ,    ptrace         POSIX,         Linux, FreeBSD, OpenBSD   Unix.</p><br>
<h1 id="ustroystvo-strace-v-dvuh-slovah-piglet-trace"> strace   : Piglet Trace</h1><br>
<blockquote>"You are not expected to understand this" ( ,     Version 6 Unix)</blockquote><p>        :     ,       (   ¬´¬ª,     ). ,        Unix   open-source-.</p><br>
<p>          strace .        . ,      strace ,      ‚Äî <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Piglet Trace</a> (ptr).      ,   ‚Äî    ‚Äî :</p><br>
<pre><code class="plaintext hljs">$ gcc examples/piglet-trace.c -o ptr<font></font>
$ ptr echo test &gt; /dev/null<font></font>
BRK(12) -&gt; 94744690540544<font></font>
ACCESS(21) -&gt; 18446744073709551614<font></font>
ACCESS(21) -&gt; 18446744073709551614<font></font>
unknown(257) -&gt; 3<font></font>
FSTAT(5) -&gt; 0<font></font>
MMAP(9) -&gt; 140694657216512<font></font>
CLOSE(3) -&gt; 0<font></font>
ACCESS(21) -&gt; 18446744073709551614<font></font>
unknown(257) -&gt; 3<font></font>
READ(0) -&gt; 832<font></font>
FSTAT(5) -&gt; 0<font></font>
MMAP(9) -&gt; 140694657208320<font></font>
MMAP(9) -&gt; 140694650953728<font></font>
MPROTECT(10) -&gt; 0<font></font>
MMAP(9) -&gt; 140694655045632<font></font>
MMAP(9) -&gt; 140694655070208<font></font>
CLOSE(3) -&gt; 0<font></font>
unknown(158) -&gt; 0<font></font>
MPROTECT(10) -&gt; 0<font></font>
MPROTECT(10) -&gt; 0<font></font>
MPROTECT(10) -&gt; 0<font></font>
MUNMAP(11) -&gt; 0<font></font>
BRK(12) -&gt; 94744690540544<font></font>
BRK(12) -&gt; 94744690675712<font></font>
unknown(257) -&gt; 3<font></font>
FSTAT(5) -&gt; 0<font></font>
MMAP(9) -&gt; 140694646390784<font></font>
CLOSE(3) -&gt; 0<font></font>
FSTAT(5) -&gt; 0<font></font>
IOCTL(16) -&gt; 18446744073709551591<font></font>
WRITE(1) -&gt; 5<font></font>
CLOSE(3) -&gt; 0<font></font>
CLOSE(3) -&gt; 0<font></font>
unknown(231)<font></font>
Tracee terminated</code></pre><br>
<p>Piglet Trace      Linux (. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>)      x86-64.     .</p><br>
<p>    .    Linux     ,   ,   ptrace.         ,      <code>PTRACE_TRACEME</code>, <code>PTRACE_SYSCALL</code>  <code>PTRACE_GETREGS</code>.</p><br>
<p>     Unix-: <code>fork(2)</code>   ,        <code>exec(3)</code>   .    ‚Äî  <code>ptrace(PTRACE_TRACEME)</code>  <code>exec</code>: - ,  -   :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">pid_t</span> child_pid = fork();
<span class="hljs-keyword">switch</span> (child_pid) {
<span class="hljs-keyword">case</span> <span class="hljs-number">-1</span>:<font></font>
    err(EXIT_FAILURE, <span class="hljs-string">"fork"</span>);
<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
    <span class="hljs-comment">/* Child here */</span>
    <span class="hljs-comment">/* A traced mode has to be enabled. A parent will have to wait(2) for it
     * to happen. */</span>
    ptrace(PTRACE_TRACEME, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);
    <span class="hljs-comment">/* Replace itself with a program to be run. */</span>
    execvp(argv[<span class="hljs-number">1</span>], argv + <span class="hljs-number">1</span>);<font></font>
    err(EXIT_FAILURE, <span class="hljs-string">"exec"</span>);<font></font>
}</code></pre><br>
<p>-    <code>wait(2)</code>   ,   ,      :</p><br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* Parent */</span><font></font>
<font></font>
<span class="hljs-comment">/* First we wait for the child to set the traced mode (see
 * ptrace(PTRACE_TRACEME) above) */</span>
<span class="hljs-keyword">if</span> (waitpid(child_pid, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>) == <span class="hljs-number">-1</span>)<font></font>
    err(EXIT_FAILURE, <span class="hljs-string">"traceme -&gt; waitpid"</span>);</code></pre><br>
<p>              .</p><br>
<p> <code>ptrace(PTRACE_SYSCALL)</code> ,   <code>wait</code>       ,     .      - :    ,     .</p><br>
<p>      <code>ptrace(PTRACE_GETREGS)</code>,     <code>rax</code>   (  )    ( ).</p><br>
<p>, :</p><br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* A system call tracing loop, one interation per call. */</span>
<span class="hljs-keyword">for</span> (;;) {
    <span class="hljs-comment">/* A non-portable structure defined for ptrace/GDB/strace usage mostly.
     * It allows to conveniently dump and access register state using
     * ptrace. */</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">user_regs_struct</span> <span class="hljs-title">registers</span>;</span><font></font>
<font></font>
    <span class="hljs-comment">/* Enter syscall: continue execution until the next system call
     * beginning. Stop right before syscall.
     *
     * It's possible to change the system call number, system call
     * arguments, return value or even avoid executing the system call
     * completely. */</span>
  <span class="hljs-keyword">if</span> (ptrace(PTRACE_SYSCALL, child_pid, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>) == <span class="hljs-number">-1</span>)<font></font>
      err(EXIT_FAILURE, <span class="hljs-string">"enter_syscall"</span>);
  <span class="hljs-keyword">if</span> (waitpid(child_pid, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>) == <span class="hljs-number">-1</span>)<font></font>
      err(EXIT_FAILURE, <span class="hljs-string">"enter_syscall -&gt; waitpid"</span>);<font></font>
<font></font>
  <span class="hljs-comment">/* According to the x86-64 system call convention on Linux (see man 2
   * syscall) the number identifying a syscall should be put into the rax
   * general purpose register, with the rest of the arguments residing in
   * other general purpose registers (rdi,rsi, rdx, r10, r8, r9). */</span>
  <span class="hljs-keyword">if</span> (ptrace(PTRACE_GETREGS, child_pid, <span class="hljs-literal">NULL</span>, &amp;registers) == <span class="hljs-number">-1</span>)<font></font>
      err(EXIT_FAILURE, <span class="hljs-string">"enter_syscall -&gt; getregs"</span>);<font></font>
<font></font>
  <span class="hljs-comment">/* Note how orig_rax is used here. That's because on x86-64 rax is used
   * both for executing a syscall, and returning a value from it. To
   * differentiate between the cases both rax and orig_rax are updated on
   * syscall entry/exit, and only rax is updated on exit. */</span><font></font>
  print_syscall_enter(registers.orig_rax);<font></font>
<font></font>
  <span class="hljs-comment">/* Exit syscall: execute of the syscall, and stop on system
   * call exit.
   *
   * More system call tinkering possible: change the return value, record
   * time it took to finish the system call, etc. */</span>
  <span class="hljs-keyword">if</span> (ptrace(PTRACE_SYSCALL, child_pid, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>) == <span class="hljs-number">-1</span>)<font></font>
      err(EXIT_FAILURE, <span class="hljs-string">"exit_syscall"</span>);
  <span class="hljs-keyword">if</span> (waitpid(child_pid, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>) == <span class="hljs-number">-1</span>)<font></font>
      err(EXIT_FAILURE, <span class="hljs-string">"exit_syscall -&gt; waitpid"</span>);<font></font>
<font></font>
  <span class="hljs-comment">/* Retrieve register state again as we want to inspect system call
   * return value. */</span>
  <span class="hljs-keyword">if</span> (ptrace(PTRACE_GETREGS, child_pid, <span class="hljs-literal">NULL</span>, &amp;registers) == <span class="hljs-number">-1</span>) {
      <span class="hljs-comment">/* ESRCH is returned when a child terminates using a syscall and no
       * return value is possible, e.g. as a result of exit(2). */</span>
      <span class="hljs-keyword">if</span> (errno == ESRCH) {
          <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"\nTracee terminated\n"</span>);
          <span class="hljs-keyword">break</span>;<font></font>
      }<font></font>
      err(EXIT_FAILURE, <span class="hljs-string">"exit_syscall -&gt; getregs"</span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">/* Done with this system call, let the next iteration handle the next
   * one */</span><font></font>
  print_syscall_exit(registers.rax);<font></font>
}</code></pre><br>
<p>   .   ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">DTrace</a>  Linux.</p><br>
<h1 id="azy-zapusk-programmy-pod-upravleniem-strace">:     strace</h1><br>
<p>     <code>strace</code>, ,      ‚Äî     <code>strace</code>.</p><br>
<p>        ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> </a>  <code>write</code>:</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span>
</span>{
    <span class="hljs-keyword">char</span> str[] = <span class="hljs-string">"write me to stdout\n"</span>;
    <span class="hljs-comment">/* write(2) is a simple wrapper around a syscall so it should be easy to
     * find in the syscall trace. */</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">sizeof</span>(str) != write(STDOUT_FILENO, str, <span class="hljs-keyword">sizeof</span>(str))){<font></font>
        perror(<span class="hljs-string">"write"</span>);
        <span class="hljs-keyword">return</span> EXIT_FAILURE;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> EXIT_SUCCESS;<font></font>
}<font></font>
</code></pre><br>
<p>   ,   :</p><br>
<pre><code class="plaintext hljs">$ gcc examples/write-simple.c -o write-simple<font></font>
$ ./write-simple<font></font>
write me to stdout</code></pre><br>
<p>      strace:</p><br>
<pre><code class="plaintext hljs">$ strace ./write-simple<font></font>
pexecve("./write", ["./write"], 0x7ffebd6145b0 /* 71 vars */) = 0<font></font>
brk(NULL)                               = 0x55ff5489e000<font></font>
access("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)<font></font>
access("/etc/ld.so.preload", R_OK)      = -1 ENOENT (No such file or directory)<font></font>
openat(AT_FDCWD, "/etc/ld.so.cache", O_RDONLY|O_CLOEXEC) = 3<font></font>
fstat(3, {st_mode=S_IFREG|0644, st_size=197410, ...}) = 0<font></font>
mmap(NULL, 197410, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f7a2a633000<font></font>
close(3)                                = 0<font></font>
access("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)<font></font>
openat(AT_FDCWD, "/lib/x86_64-linux-gnu/libc.so.6", O_RDONLY|O_CLOEXEC) = 3<font></font>
read(3, "\177ELF\2\1\1\3\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\260\34\2\0\0\0\0\0"..., 832) = 832<font></font>
fstat(3, {st_mode=S_IFREG|0755, st_size=2030544, ...}) = 0<font></font>
mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f7a2a631000<font></font>
mmap(NULL, 4131552, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f7a2a04c000<font></font>
mprotect(0x7f7a2a233000, 2097152, PROT_NONE) = 0<font></font>
mmap(0x7f7a2a433000, 24576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1e7000) = 0x7f7a2a433000<font></font>
mmap(0x7f7a2a439000, 15072, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x7f7a2a439000<font></font>
close(3)                                = 0<font></font>
arch_prctl(ARCH_SET_FS, 0x7f7a2a6324c0) = 0<font></font>
mprotect(0x7f7a2a433000, 16384, PROT_READ) = 0<font></font>
mprotect(0x55ff52b52000, 4096, PROT_READ) = 0<font></font>
mprotect(0x7f7a2a664000, 4096, PROT_READ) = 0<font></font>
munmap(0x7f7a2a633000, 197410)          = 0<font></font>
write(1, "write me to stdout\n\0", 20write me to stdout<font></font>
)  = 20<font></font>
exit_group(0)                           = ?</code></pre><br>
<p> ¬´¬ª    .   :      <code>strace</code>    ,    .</p><br>
<p>        strace     -o,      -.</p><br>
<p>    ¬´¬ª . ,      <code>write</code>.  <code>-e</code>   ,      .     ‚Äî , <code>trace=*</code>,         .</p><br>
<p>   <code>-o</code>  <code>-e</code>  :</p><br>
<pre><code class="plaintext hljs">$ strace -e trace=write -owrite-simple.log ./write-simple<font></font>
write me to stdout<font></font>
$ cat write-simple.log<font></font>
write(1, "write me to stdout\n\0", 20<font></font>
)  = 20<font></font>
+++ exited with 0 +++</code></pre><br>
<p>, ,   .</p><br>
<p>      ‚Äî ,      :</p><br>
<pre><code class="plaintext hljs">$ strace -e trace=\!brk,mmap,mprotect,munmap -owrite-simple.log ./write-simple<font></font>
write me to stdout<font></font>
$ cat write-simple.log<font></font>
execve("./write-simple", ["./write-simple"], 0x7ffe9972a498 /* 69 vars */) = 0<font></font>
access("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)<font></font>
access("/etc/ld.so.preload", R_OK)      = -1 ENOENT (No such file or directory)<font></font>
openat(AT_FDCWD, "/etc/ld.so.cache", O_RDONLY|O_CLOEXEC) = 3<font></font>
fstat(3, {st_mode=S_IFREG|0644, st_size=124066, ...}) = 0<font></font>
close(3)                                = 0<font></font>
access("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)<font></font>
openat(AT_FDCWD, "/lib/x86_64-linux-gnu/libc.so.6", O_RDONLY|O_CLOEXEC) = 3<font></font>
read(3, "\177ELF\2\1\1\3\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\260\34\2\0\0\0\0\0"..., 832) = 832<font></font>
fstat(3, {st_mode=S_IFREG|0755, st_size=2030544, ...}) = 0<font></font>
close(3)                                = 0<font></font>
arch_prctl(ARCH_SET_FS, 0x7f00f0be74c0) = 0<font></font>
write(1, "write me to stdout\n\0", 20)  = 20<font></font>
exit_group(0)                           = ?<font></font>
+++ exited with 0 +++</code></pre><br>
<p>         :     (. <em>shell</em>).</p><br>
<p>   glibc      <code>exit_group</code>,    <code>_exit</code>.        : ,    ,       .  ,         .</p><br>
<h1 id="azy-prisoedinenie-k-processu-na-letu">:     </h1><br>
<p>   ptrace,    <code>strace</code>,          .  ,  ,     Version 6 Unix.       : ,     .   ‚Äî      .   <code>strace</code>      .</p><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>:</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span>
</span>{<font></font>
    (<span class="hljs-keyword">void</span>) argc; (<span class="hljs-keyword">void</span>) argv;<font></font>
<font></font>
    <span class="hljs-keyword">char</span> str[] = <span class="hljs-string">"write me\n"</span>;<font></font>
<font></font>
    write(STDOUT_FILENO, str, <span class="hljs-keyword">sizeof</span>(str));<font></font>
<font></font>
    <span class="hljs-comment">/* Sleep indefinitely or until a signal arrives */</span><font></font>
    pause();<font></font>
<font></font>
    write(STDOUT_FILENO, str, <span class="hljs-keyword">sizeof</span>(str));<font></font>
<font></font>
    <span class="hljs-keyword">return</span> EXIT_SUCCESS;<font></font>
}</code></pre><br>
<p>     ,   :</p><br>
<pre><code class="plaintext hljs">$ gcc examples/write-sleep.c -o write-sleep<font></font>
$ ./write-sleep<font></font>
./write-sleep<font></font>
write me<font></font>
^C<font></font>
$</code></pre><br>
<p>     :</p><br>
<pre><code class="plaintext hljs">$ ./write-sleep &amp;<font></font>
[1] 15329<font></font>
write me<font></font>
$ strace -p 15329<font></font>
strace: Process 15329 attached<font></font>
pause(<font></font>
^Cstrace: Process 15329 detached<font></font>
 &lt;detached ...&gt;</code></pre><br>
<p>   <code>pause</code>. ,     :</p><br>
<pre><code class="plaintext hljs">$ strace -o write-sleep.log -p 15329 &amp;<font></font>
strace: Process 15329 attached<font></font>
$<font></font>
$ kill -CONT 15329<font></font>
$ cat write-sleep.log<font></font>
pause()                                 = ? ERESTARTNOHAND (To be restarted if no handler)<font></font>
--- SIGCONT {si_signo=SIGCONT, si_code=SI_USER, si_pid=14989, si_uid=1001} ---<font></font>
pause(<font></font>
$<font></font>
$ kill -TERM 15329<font></font>
$ cat write-sleep.log<font></font>
pause()                                 = ? ERESTARTNOHAND (To be restarted if no handler)<font></font>
--- SIGCONT {si_signo=SIGCONT, si_code=SI_USER, si_pid=14989, si_uid=1001} ---<font></font>
pause()                                 = ? ERESTARTNOHAND (To be restarted if no handler)<font></font>
--- SIGTERM {si_signo=SIGTERM, si_code=SI_USER, si_pid=14989, si_uid=1001} ---<font></font>
+++ killed by SIGTERM +++</code></pre><br>
<p>          <code>strace</code>.   :   pause     ,  , strace     ,    .</p><br>
<h1 id="primer-otslezhivanie-dochernih-processov">:   </h1><br>
<p>     <code>fork</code> ‚Äî   Unix.  ,  strace        ¬´¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>:</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span>
</span>{
    <span class="hljs-keyword">pid_t</span> parent_pid = getpid();
    <span class="hljs-keyword">pid_t</span> child_pid = fork();
    <span class="hljs-keyword">if</span> (child_pid == <span class="hljs-number">0</span>) {
        <span class="hljs-comment">/* A child is born! */</span><font></font>
        child_pid = getpid();<font></font>
<font></font>
        <span class="hljs-comment">/* In the end of the day printf is just a call to write(2). */</span>
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"child (self=%d)\n"</span>, child_pid);
        <span class="hljs-built_in">exit</span>(EXIT_SUCCESS);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"parent (self=%d, child=%d)\n"</span>, parent_pid, child_pid);<font></font>
<font></font>
    wait(<span class="hljs-literal">NULL</span>);<font></font>
<font></font>
    <span class="hljs-built_in">exit</span>(EXIT_SUCCESS);<font></font>
}</code></pre><br>
<p>     ,      :</p><br>
<pre><code class="plaintext hljs">$ gcc examples/fork-write.c -o fork-write<font></font>
$ ./fork-write<font></font>
parent (self=11274, child=11275)<font></font>
child (self=11275)</code></pre><br>
<p>        :</p><br>
<pre><code class="plaintext hljs">$ strace -e trace=write -ofork-write.log ./fork-write<font></font>
child (self=22049)<font></font>
parent (self=22048, child=22049)<font></font>
$ cat fork-write.log<font></font>
write(1, "parent (self=22048, child=22049)"..., 33) = 33<font></font>
--- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED, si_pid=22049, si_uid=1001, si_status=0, si_utime=0, si_stime=0} ---<font></font>
+++ exited with 0 +++</code></pre><br>
<p>      <code>-f</code>,   <code>strace</code>     -.        <code>pid</code> ,   :</p><br>
<pre><code class="plaintext hljs">$ strace -f -e trace=write -ofork-write.log ./fork-write<font></font>
parent (self=22710, child=22711)<font></font>
child (self=22711)<font></font>
$ cat fork-write.log<font></font>
22710 write(1, "parent (self=22710, child=22711)"..., 33) = 33<font></font>
22711 write(1, "child (self=22711)\n", 19) = 19<font></font>
22711 +++ exited with 0 +++<font></font>
22710 --- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED, si_pid=22711, si_uid=1001, si_status=0, si_utime=0, si_stime=0} ---<font></font>
22710 +++ exited with 0 +++</code></pre><br>
<p>         :</p><br>
<pre><code class="plaintext hljs">$ strace -f -e trace=%process -ofork-write.log ./fork-write<font></font>
parent (self=23610, child=23611)<font></font>
child (self=23611)<font></font>
$ cat fork-write.log<font></font>
23610 execve("./fork-write", ["./fork-write"], 0x7fff696ff720 /* 63 vars */) = 0<font></font>
23610 arch_prctl(ARCH_SET_FS, 0x7f3d03ba44c0) = 0<font></font>
23610 clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, child_tidptr=0x7f3d03ba4790) = 23611<font></font>
23610 wait4(-1,  &lt;unfinished ...&gt;<font></font>
23611 exit_group(0)                     = ?<font></font>
23611 +++ exited with 0 +++<font></font>
23610 &lt;... wait4 resumed&gt; NULL, 0, NULL) = 23611<font></font>
23610 --- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED, si_pid=23611, si_uid=1001, si_status=0, si_utime=0, si_stime=0} ---<font></font>
23610 exit_group(0)                     = ?<font></font>
23610 +++ exited with 0 +++</code></pre><br>
<p>,        ?</p><br>
<h1 id="primer-puti-k-faylam-vmesto-deskriptorov">:     </h1><br>
<p>  , , ,    ,    ,   .</p><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>     :</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">do_write</span><span class="hljs-params">(<span class="hljs-keyword">int</span> out_fd)</span>
</span>{
    <span class="hljs-keyword">char</span> str[] = <span class="hljs-string">"write me to a file\n"</span>;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">sizeof</span>(str) != write(out_fd, str, <span class="hljs-keyword">sizeof</span>(str))){<font></font>
        perror(<span class="hljs-string">"write"</span>);
        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span>
</span>{
    <span class="hljs-keyword">char</span> tmp_filename_template[] = <span class="hljs-string">"/tmp/output_fileXXXXXX"</span>;<font></font>
<font></font>
    <span class="hljs-keyword">int</span> out_fd = mkstemp(tmp_filename_template);
    <span class="hljs-keyword">if</span> (out_fd == <span class="hljs-number">-1</span>) {<font></font>
        perror(<span class="hljs-string">"mkstemp"</span>);
        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<font></font>
    }<font></font>
<font></font>
    do_write(out_fd);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> EXIT_SUCCESS;<font></font>
}</code></pre><br>
<p>   <code>strace</code>   -,    :</p><br>
<pre><code class="plaintext hljs">$ strace -e trace=write -o write-tmp-file.log ./write-tmp-file<font></font>
$ cat write-tmp-file.log<font></font>
write(3, "write me to a file\n\0", 20)  = 20<font></font>
+++ exited with 0 +++</code></pre><br>
<p>  <code>-y</code>     ,   :</p><br>
<pre><code class="plaintext hljs">$ strace -y -e trace=write -o write-tmp-file.log ./write-tmp-file<font></font>
$ cat write-tmp-file.log<font></font>
write(3&lt;/tmp/output_fileCf5MyW&gt;, "write me to a file\n\0", 20) = 20<font></font>
+++ exited with 0 +++</code></pre><br>
<h1 id="primer-otslezhivanie-obrascheniy-k-faylam">:    </h1><br>
<p>   :    ,    .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>     ,   :</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">do_write</span><span class="hljs-params">(<span class="hljs-keyword">int</span> out_fd)</span>
</span>{
    <span class="hljs-keyword">char</span> str[] = <span class="hljs-string">"write me to a file\n"</span>;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">sizeof</span>(str) != write(out_fd, str, <span class="hljs-keyword">sizeof</span>(str))){<font></font>
        perror(<span class="hljs-string">"write"</span>);
        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span>
</span>{
    <span class="hljs-comment">/*
     * Path will be provided by the first program argument.
     *  */</span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *path = argv[<span class="hljs-number">1</span>];<font></font>
<font></font>
    <span class="hljs-comment">/*
     * Open an existing file for writing in append mode.
     *  */</span>
    <span class="hljs-keyword">int</span> out_fd = open(path, O_APPEND | O_WRONLY);
    <span class="hljs-keyword">if</span> (out_fd == <span class="hljs-number">-1</span>) {<font></font>
        perror(<span class="hljs-string">"open"</span>);
        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<font></font>
    }<font></font>
<font></font>
    do_write(out_fd);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> EXIT_SUCCESS;<font></font>
}<font></font>
</code></pre><br>
<p>  <code>strace</code>    .  <code>-P</code>    strace      :</p><br>
<pre><code class="plaintext hljs">$ strace -y -P/tmp/test_file.log -o write-file.log ./write-file /tmp/test_file.log<font></font>
$ cat write-file.log<font></font>
openat(AT_FDCWD, "/tmp/test_file.log", O_WRONLY|O_APPEND) = 3&lt;/tmp/test_file.log&gt;<font></font>
write(3&lt;/tmp/test_file.log&gt;, "write me to a file\n\0", 20) = 20<font></font>
+++ exited with 0 +++</code></pre><br>
<h1 id="primer-mnogopotochnye-programmy">:  </h1><br>
<p> <code>strace</code>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>.          :</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">thread</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span>
</span>{<font></font>
    (<span class="hljs-keyword">void</span>) arg;<font></font>
<font></font>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Secondary thread: working\n"</span>);<font></font>
    sleep(<span class="hljs-number">1</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Secondary thread: done\n"</span>);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span>
</span>{
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Initial thread: launching a thread\n"</span>);<font></font>
<font></font>
    <span class="hljs-keyword">pthread_t</span> thr;
    <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> != pthread_create(&amp;thr, <span class="hljs-literal">NULL</span>, thread, <span class="hljs-literal">NULL</span>)) {
        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Initial thread: failed to create a thread"</span>);
        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Initial thread: joining a thread\n"</span>);
    <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> != pthread_join(thr, <span class="hljs-literal">NULL</span>)) {
        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Initial thread: failed to join a thread"</span>);
        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<font></font>
    };<font></font>
<font></font>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Initial thread: done"</span>);<font></font>
<font></font>
    <span class="hljs-built_in">exit</span>(EXIT_SUCCESS);<font></font>
}</code></pre><br>
<p>  , ,     ‚Äî  -pthread:</p><br>
<pre><code class="plaintext hljs">$ gcc examples/thread-write.c -pthread -o thread-write<font></font>
$ ./thread-write<font></font>
/thread-write<font></font>
Initial thread: launching a thread<font></font>
Initial thread: joining a thread<font></font>
Secondary thread: working<font></font>
Secondary thread: done<font></font>
Initial thread: done<font></font>
$</code></pre><br>
<p> <code>-f</code>,       ,      pid .</p><br>
<blockquote>,           POSIX Threads,   ,     Linux.          ‚Äî  ,       .</blockquote><p>         :</p><br>
<pre><code class="plaintext hljs">$ strace -f -othread-write.log ./thread-write<font></font>
$ wc -l thread-write.log<font></font>
60 thread-write.log</code></pre><br>
<p>         <code>write</code>:</p><br>
<pre><code class="plaintext hljs">$ strace -f -e trace="%process,write" -othread-write.log ./thread-write<font></font>
$ cat thread-write.log<font></font>
18211 execve("./thread-write", ["./thread-write"], 0x7ffc6b8d58f0 /* 64 vars */) = 0<font></font>
18211 arch_prctl(ARCH_SET_FS, 0x7f38ea3b7740) = 0<font></font>
18211 write(1, "Initial thread: launching a thre"..., 35) = 35<font></font>
18211 clone(child_stack=0x7f38e9ba2fb0, flags=CLONE_VM|CLONE_FS|CLONE_FILES|CLONE_SIGHAND|CLONE_THREAD|CLONE_SYSVSEM|CLONE_SETTLS|CLONE_PARENT_SETTID|CLONE_CHILD_CLEARTID, parent_tidptr=0x7f38e9ba39d0, tls=0x7f38e9ba3700, child_tidptr=0x7f38e9ba39d0) = 18212<font></font>
18211 write(1, "Initial thread: joining a thread"..., 33) = 33<font></font>
18212 write(1, "Secondary thread: working\n", 26) = 26<font></font>
18212 write(1, "Secondary thread: done\n", 23) = 23<font></font>
18212 exit(0)                           = ?<font></font>
18212 +++ exited with 0 +++<font></font>
18211 write(1, "Initial thread: done", 20) = 20<font></font>
18211 exit_group(0)                     = ?<font></font>
18211 +++ exited with 0 +++</code></pre><br>
<p>, .        ?          ?</p><br>
<h1 id="master-klass-stek-processa-v-moment-sistemnogo-vyzova">-:      </h1><br>
<p>     <code>strace</code>  ‚Äî        .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>:</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">do_write</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{
    <span class="hljs-keyword">char</span> str[] = <span class="hljs-string">"write me to stdout\n"</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">sizeof</span>(str) != write(STDOUT_FILENO, str, <span class="hljs-keyword">sizeof</span>(str))){<font></font>
        perror(<span class="hljs-string">"write"</span>);
        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span>
</span>{<font></font>
    do_write();<font></font>
    <span class="hljs-keyword">return</span> EXIT_SUCCESS;<font></font>
}</code></pre><br>
<p>,       , ,   <code>-k</code> (  ),       :</p><br>
<pre><code class="plaintext hljs">$ gcc examples/write-simple.c -o write-simple<font></font>
$ strace -k -e trace=write -o write-simple.log ./write-simple<font></font>
write me to stdout<font></font>
$ cat write-simple.log<font></font>
write(1, "write me to stdout\n\0", 20)  = 20<font></font>
 &gt; /lib/x86_64-linux-gnu/libc-2.27.so(__write+0x14) [0x110154]<font></font>
 &gt; /home/vkazanov/projects-my/strace-post/write-simple(do_write+0x50) [0x78a]<font></font>
 &gt; /home/vkazanov/projects-my/strace-post/write-simple(main+0x14) [0x7d1]<font></font>
 &gt; /lib/x86_64-linux-gnu/libc-2.27.so(__libc_start_main+0xe7) [0x21b97]<font></font>
 &gt; /home/vkazanov/projects-my/strace-post/write-simple(_start+0x2a) [0x65a]<font></font>
+++ exited with 0 +++</code></pre><br>
<h1 id="master-klass-inekciya-oshibok">-:  </h1><br>
<p>       :  .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>,      :</p><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">do_write</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *str, <span class="hljs-keyword">ssize_t</span> len)</span>
</span>{
    <span class="hljs-keyword">if</span> (len != write(STDOUT_FILENO, str, (<span class="hljs-keyword">size_t</span>)len)){<font></font>
        perror(<span class="hljs-string">"write"</span>);
        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span>
</span>{<font></font>
    (<span class="hljs-keyword">void</span>) argc; (<span class="hljs-keyword">void</span>) argv;<font></font>
<font></font>
    <span class="hljs-keyword">char</span> str1[] = <span class="hljs-string">"write me 1\n"</span>;<font></font>
    do_write(str1, <span class="hljs-keyword">sizeof</span>(str1));<font></font>
<font></font>
    <span class="hljs-keyword">char</span> str2[] = <span class="hljs-string">"write me 2\n"</span>;<font></font>
    do_write(str2, <span class="hljs-keyword">sizeof</span>(str2));<font></font>
<font></font>
    <span class="hljs-keyword">return</span> EXIT_SUCCESS;<font></font>
}</code></pre><br>
<p>   write:</p><br>
<pre><code class="plaintext hljs">$ gcc examples/write-twice.c -o write-twice<font></font>
$ ./write-twice<font></font>
write me 1<font></font>
write me 2<font></font>
$ strace -e trace=write -owrite-twice.log ./write-twice<font></font>
write me 1<font></font>
write me 2<font></font>
$ cat write-twice.log<font></font>
write(1, "write me 1\n\0", 12)          = 12<font></font>
write(1, "write me 2\n\0", 12)          = 12<font></font>
+++ exited with 0 +++</code></pre><br>
<p>    <code>inject</code>,    <code>EBADF</code>    write:</p><br>
<pre><code class="plaintext hljs">$ strace -e trace=write -e inject=write:error=EBADF -owrite-twice.log ./write-twice<font></font>
$ cat write-twice.log<font></font>
write(1, "write me 1\n\0", 12)          = -1 EBADF (Bad file descriptor) (INJECTED)<font></font>
write(3, "write: Bad file descriptor\n", 27) = -1 EBADF (Bad file descriptor) (INJECTED)<font></font>
+++ exited with 1 +++</code></pre><br>
<p>,    <strong></strong>  <code>write</code>,  ,   perror.         :</p><br>
<pre><code class="plaintext hljs">$ strace -e trace=write -e inject=write:error=EBADF:when=1 -owrite-twice.log ./write-twice<font></font>
write: Bad file descriptor<font></font>
$ cat write-twice.log<font></font>
write(1, "write me 1\n\0", 12)          = -1 EBADF (Bad file descriptor) (INJECTED)<font></font>
write(3, "write: Bad file descriptor\n", 27) = 27<font></font>
+++ exited with 1 +++</code></pre><br>
<p> :</p><br>
<pre><code class="plaintext hljs">$ strace -e trace=write -e inject=write:error=EBADF:when=2 -owrite-twice.log ./write-twice<font></font>
write me 1<font></font>
write: Bad file descriptor<font></font>
$ cat write-twice.log<font></font>
write(1, "write me 1\n\0", 12)          = 12<font></font>
write(1, "write me 2\n\0", 12)          = -1 EBADF (Bad file descriptor) (INJECTED)<font></font>
write(3, "write: Bad file descriptor\n", 27) = 27<font></font>
+++ exited with 1 +++</code></pre><br>
<p>    :</p><br>
<pre><code class="plaintext hljs">$ strace -e trace=write -e fault=write:when=1 -owrite-twice.log ./write-twice<font></font>
$ cat write-twice.log<font></font>
write(1, "write me 1\n\0", 12)          = -1 ENOSYS (Function not implemented) (INJECTED)<font></font>
write(3, "write: Function not implemented\n", 32) = 32<font></font>
+++ exited with 1 +++</code></pre><br>
<p>      ¬´¬ª    . :</p><br>
<pre><code class="plaintext hljs">$ strace -y -P/tmp/test_file.log -e inject=file:error=ENOENT -o write-file.log ./write-file /tmp/test_file.log<font></font>
open: No such file or directory<font></font>
$ cat write-file.log<font></font>
openat(AT_FDCWD, "/tmp/test_file.log", O_WRONLY|O_APPEND) = -1 ENOENT (No such file or directory) (INJECTED)<font></font>
+++ exited with 1 +++</code></pre><br>
<p>  , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>        .</p><br>
<h1 id="posleslovie"></h1><br>
<p> <code>strace</code> ‚Äî    .              . ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ltrace</a>,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SystemTap</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ftrace</a>,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">perf</a>.     <code>strace</code> ‚Äî           ,         .</p><br>
<p>,  Unix,  <code>man 1 strace</code>       !</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id493840/index.html">Ulasan: Asana, Jira, Bitrix-24, Trello, YouGile. Apa yang Anda sukai dan apa yang membuat marah?</a></li>
<li><a href="../id493844/index.html">Buku ‚ÄúDatabase. Rekayasa Keandalan</a></li>
<li><a href="../id493848/index.html">Saya ingin memulai blog, tetapi saya tidak punya tim sendiri. Bagaimana cara memilih kontraktor copywriting?</a></li>
<li><a href="../id493850/index.html">Manakah dari pengembang yang tinggal di kota yang sama yang menghasilkan lebih banyak: bekerja dari jarak jauh atau di kantor?</a></li>
<li><a href="../id493852/index.html">CloudFlare - Kanker Internet</a></li>
<li><a href="../id493858/index.html">10 buku bermanfaat tentang manajemen layanan TI</a></li>
<li><a href="../id493862/index.html">Model Sauber Alfa Romeo F1 yang diperbarui dilengkapi dengan 143 bagian yang dicetak pada printer 3D</a></li>
<li><a href="../id493864/index.html">Mempetisi ke startup dari Sequoia Capital mengenai coronavirus</a></li>
<li><a href="../id493866/index.html">Bangun aliran Anda untuk git dari awal</a></li>
<li><a href="../id493870/index.html">Biogelx dan peran bio-ink dalam bioprinting modern</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>