<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏼‍🔧 🤯 🏇 中断されたYandex.Cloud仮想マシンを使用して、大規模な問題を解決する方法 🍣 🙀 🤭</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="今日は、Yandex.Cloudの便利な機能である仮想マシンの中断についてお話ししたいと思います。これは、仮想マシンを作成してコンピューティングリソースを低価格で使用するときに選択できる特別なオプションです。割り込み可能な仮想マシンの何がそんなに特別なのですか、なぜ通常の仮想マシンよりも安いのですか...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>中断されたYandex.Cloud仮想マシンを使用して、大規模な問題を解決する方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/457538/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今日は、Yandex.Cloudの便利な機能である仮想マシンの中断についてお話ししたいと思います。これは、仮想マシンを作成してコンピューティングリソースを低価格で使用するときに選択できる特別なオプションです。割り込み可能な仮想マシンの何がそんなに特別なのですか、なぜ通常の仮想マシンよりも安いのですか、そしてどのような場合にそれらを使用するのが妥当ですか？</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ox/8d/3e/ox8d3etklg4mebfli2f7r0ofdf0.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yandex.Cloud、より正確には</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex Compute Cloud</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インフラストラクチャサービスの容量は</font><font style="vertical-align: inherit;">、ユーザーが使用する</font><font style="vertical-align: inherit;">容量</font><font style="vertical-align: inherit;">よりも著しく大きくなっています。</font><font style="vertical-align: inherit;">デフォルトでは、ユーザーは任意にスケーリングできる必要があります。</font><font style="vertical-align: inherit;">少なくともこれらの理由により、他の側面を考慮しないと、クラウドプラットフォームの使用可能なリソースは現在の需要を大幅に上回ります。</font><font style="vertical-align: inherit;">中断された仮想マシンが作成されるのは、これらの空き容量です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主な制限</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
簡単に言うと、中断された仮想マシンの性質は次のように説明できます。このサービスは、無料のコンピューティングリソースをより低価格で使用することを提供します。ただし、これらのリソースはいつでも呼び出すことができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、中断された仮想マシンは通常の仮想マシンと同様に機能しますが、いくつかの制限があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらは、サービスレベルアグリーメント（SLA）の対象ではありません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作成および実行する機能は保証されていません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いつでも強制的に停止させることができます。</font><font style="vertical-align: inherit;">停止の確率は小さいですが、ゼロではないため、時間の経過とともに変化し</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Yandex.Cloud可用性の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">異なる</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ゾーンで変化する可能性があります</font></a><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中断された仮想マシンを正常にすることはできませんが、通常の中断された仮想マシンは作成できます。</font><font style="vertical-align: inherit;">対応するフラグは一度設定され、変更されません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機械は24時間以内に確実に停止します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際には、ほとんどの場合、中断された仮想マシンは、サービス条件で提供されている24時間すべてを実行します。</font><font style="vertical-align: inherit;">通常、強制停止が発生するのは、特定のアベイラビリティーゾーンに多数の通常の仮想マシンが短期間に作成された場合のみです。深刻なニーズを持つ新しいユーザーが現れるか、現在のユーザーが大規模にスケーリングされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同時に、停止した仮想マシンを再起動できます。自動シャットダウンと手動シャットダウンの両方で、ディスク上のすべてのデータが保存されます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユースケース</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
中断された仮想マシンの制限により、論理的な問題が発生します。リソースをいつでも取り消すことができる場合にそれらを適用する方法は？</font><font style="vertical-align: inherit;">説明として、考えられる使用例をいくつか示します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バッチ処理</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バッチ処理には、大量のリソースを消費するタスクの並列実行が含まれます。これは、ファイル形式の変換、画像処理と認識、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ETL操作など</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。肝心な点は、バッチ処理では、ジョブキューと、キューからジョブを受信するワークプロセス（エグゼキューター）のセット全体があることです。中断されたマシンで実行されている個々のエグゼキューターが停止した場合、タスクは単に次のエグゼキューターに転送されます。つまり、1つまたは複数の仮想マシンを停止しても、プロセスと処理結果に大きな悪影響はありません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o9/tt/ny/o9ttnycyli2d6s7sg-c9i47rusk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データをバッチ処理するときは、何十もの仮想マシンを使用することについて話します。</font><font style="vertical-align: inherit;">断続的なマシンの使用は、非常に顕著な節約を提供します。</font><font style="vertical-align: inherit;">現在、32コアを備えた生産的な不連続仮想マシンの主な消費者の1つは、長年のYandex.CloudクライアントであるSeismotechです。</font><font style="vertical-align: inherit;">Seismotekは、ガスおよび油田の探査に必要な地震データを処理します。</font><font style="vertical-align: inherit;">地震探査には、大量の情報を扱うことが含まれます。</font><font style="vertical-align: inherit;">データはバッチ方式で処理されます。</font><font style="vertical-align: inherit;">同社は同時に、最大60台以上の割り込みマシンを使用しています。合計で最大2000個のvCPUと4000 GBのRAMです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hadoopのプロジェクト</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hadoopは、数百および数千の低コストノードのクラスターで実行される分散プログラムを開発および実行するために使用されます。</font><font style="vertical-align: inherit;">ファイルレプリケーションのメカニズムと、Hadoopが提供する障害ノードで実行されるタスクの自動再起動により、個々のマシンの障害に対する分散システムの安定性が保証されます。</font><font style="vertical-align: inherit;">そのため、Hadoopを使用すると、中断された仮想マシンにノードの少なくとも一部を簡単に展開できます。</font><font style="vertical-align: inherit;">それらが早く停止した場合、タスクは他のノードに送信されます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Webサービスのフォールトトレランス</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスターを使用することで、Webサービスの継続的な可用性を確保できます。クラスターは2つ以上のサーバーで構成されます。 Webサービスへのアプリケーションにおけるそのタスクの1つは、ピーク負荷時に安定した動作を保証することです。典型的な例：トラフィックの増加が特定の日付に関連付けられているオンラインショッピングサイトまたはスポーツサイト。店舗の場合、これは伝統的な休日や割引の期間である場合があり、スポーツ関連のサイトの場合、生放送、レビュー、写真レポートが公開されるイベントの日である場合があります。このような場合、トラフィック量は大幅に増加する可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスターは、異なるノードにトラフィックを分散することにより、訪問者の流入に対応する必要があります。</font><font style="vertical-align: inherit;">負荷が急激に増加するものの、短期的には増加する場合は、廃止された仮想マシンにサーバーを追加することでフォールトトレランスを実現できます。</font><font style="vertical-align: inherit;">このオプションは安価で、うまく機能します。</font><font style="vertical-align: inherit;">1つの条件を観察することが重要です。このようなクラスターはハイブリッドである必要があります。つまり、通常の仮想マシンを含める必要があります。</font><font style="vertical-align: inherit;">この場合、万が一中断されたマシンが停止しても、サービス障害は発生しません。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetesのプロジェクト</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetesは、多数のノードにわたるコンテナ化されたアプリケーションのデプロイ、スケーリング、管理を自動化します。</font><font style="vertical-align: inherit;">Kubernetesのビルディングブロックと呼ぶことができる主要なエンティティの1つが（ポッド）の下にあります。</font><font style="vertical-align: inherit;">ポッドは、1つのノードで1つまたは複数のコンテナーの起動を提供します。</font><font style="vertical-align: inherit;">各炉床のノードは、Kubernetesスケジューラによって選択され、割り当てられます。</font><font style="vertical-align: inherit;">ハースが実行されている別のノードに障害が発生した場合、スケジューラはそれを通常モードで動作しているノードに自動的に転送します。</font><font style="vertical-align: inherit;">このパフォーマンス管理スキームでは、中断された仮想マシンでノードの一部をホストできると想定しています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">継続的インテグレーションテスト</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
継続的な統合の実践は、プロジェクトの頻繁な組み立てとテストに基づいています。この場合、主に自動テストが使用されます。概略的には、次のようになります。仮想マシン上にテスト環境が作成され、アプリケーションの最後のビルドがアップロードされ、自動テストが実行され、テスト結果がアップロードされ、仮想マシンが削除されます。原則として、テストには数十分、場合によっては数時間かかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
従来、継続的インテグレーションの弱点は、インテグレーションプロセス自体をサポートするための多大なコストと、コンピューティングリソースに対する高い需要です。</font><font style="vertical-align: inherit;">この観点から、自動テストの時間枠を考慮すると、廃止された仮想マシンは継続的な統合に適しているとは言えません。</font><font style="vertical-align: inherit;">それらははるかに安く、テスト時に車がすぐに停止する可能性はほとんどありません。</font><font style="vertical-align: inherit;">また、車が止まっている場合でも、業務上被害は最小限に抑えられます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他のYandex.Cloudサービスと組み合わせて使用​​する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービス</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandexインスタンスグループを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用すると、中断されたVMのグループ全体のステータスを自動的に監視できます。</font><font style="vertical-align: inherit;">彼は、特定の特性を持つ仮想マシンを個別に作成し、グループ内の必要な数のマシンを維持し、中断されたインスタンスが停止した場合に再起動することができます。</font><font style="vertical-align: inherit;">強制停止が発生したか、開始から24時間経過したかは関係ありません。</font><font style="vertical-align: inherit;">重要なのは1つだけです。利用可能なリソースがある場合、再起動が発生します。</font><font style="vertical-align: inherit;">Yandexインスタンスグループを使用すると、中断された仮想マシンでの作業がより便利になりますが、特定のアベイラビリティーゾーンに空き容量があるとは限りません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">経済指標</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前述したように、割り込み可能な仮想マシンは、コンピューティングリソースの使用コストを削減できます。 Yandexの内部では、数年前に同様の機能の実装に取り​​組み始めました。コンピューティングタスクを実行可能ファイルと割り込み可能ファイルに分割するには、かなりの投資が必要でした。しかし、それは無駄ではありませんでした。最終的に、サーバーインフラストラクチャの有効利用レベルを30〜40％から70〜80％に引き上げました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/t5/co/jm/t5cojmli_xdhso9kjwoqbwciksk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ボタンをクリックするだけで、すべてのYandex.Cloudユーザーが同様の機能を利用できるようになりました。簡単な例：カーネル負荷が100％の使用済み仮想マシンの半分を割り込みフォーマットに転送すると、予算の最大35-40％を節約できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
低コストで、CPUおよびRAMリソースを利用できます。</font><font style="vertical-align: inherit;">ディスク容量とIPアドレスは通常の料金で支払われます。</font><font style="vertical-align: inherit;">これは、Cascade Lakeプラットフォームの簡単な計算結果です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2z/u2/vh/2zu2vhioohfo6zfv77cl1a3lweq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必要に応じて、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">計算</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機を使用して、さまざまなモードで仮想マシンを使用するコストを自分で比較できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
少しわかりやすくして、割り込み可能な仮想マシンを使用して、タスクの実行品質を落とさずにコンピューティングリソースのコストを削減できるいくつかの有用な例を示すことができたことを願っています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloud onHabréに関する他の出版物</font></font></h3><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分散メッセージキューサービスのアーキテクチャ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワークロードバランサーのアーキテクチャ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MPLSはどこにでもあります。</font><font style="vertical-align: inherit;">Yandex.Cloudネットワークインフラストラクチャはどうですか</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ダウンタイムなしでデータベースをスケーリングする方法。</font><font style="vertical-align: inherit;">3つのホストの例</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  .   </a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja457518/index.html">ブロックチェーンのスケーラビリティトリレンマの解決策としてのプラズマキャッシュチェーン</a></li>
<li><a href="../ja457522/index.html">メーリングリストサービスを向上させるか、既成のソリューションを使用しますか？UniSenderで5年間に学んだこと</a></li>
<li><a href="../ja457524/index.html">深度カメラ-サイレント革命（ロボットが見るとき）パート1</a></li>
<li><a href="../ja457526/index.html">バザーとしてのテクニカルメディア</a></li>
<li><a href="../ja457534/index.html">認定バージョン-私たちが選択したレーキ</a></li>
<li><a href="../ja457540/index.html">Intel Optane DC Persistent Memory、1年後</a></li>
<li><a href="../ja457542/index.html">暗号化をハッキングして保護するLUKS</a></li>
<li><a href="../ja457546/index.html">デモ日：なぜこれがすべてであり、それを行う方法UPD + Broadcast</a></li>
<li><a href="../ja457548/index.html">TMS320F28027での多相PWM信号の生成</a></li>
<li><a href="../ja457550/index.html">デジタル業界を保護する必要があるもの</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>