<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏁 〽️ 📮 Anatomie meines Heimat-Kubernetes-Clusters 😴 🖐🏾 😎</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor einem Jahr wurde mir klar, dass ich meinen eigenen Kubernetes-Cluster erstellen wollte. Ich bin ein Softwareentwickler. Normalerweise verwende ich...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Anatomie meines Heimat-Kubernetes-Clusters</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/493708/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vor einem Jahr wurde mir klar, dass ich meinen eigenen Kubernetes-Cluster erstellen wollte. Ich bin ein Softwareentwickler. Normalerweise verwende ich entweder einen lokalen Cluster mit einem Knoten oder einen Remote-Cluster mit mehreren Knoten, um meine Projekte zu testen. Wenn ich mit einem Cluster mit einem Knoten </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arbeite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">verlasse ich mich normalerweise auf </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Minikube</font></a><font style="vertical-align: inherit;"> , obwohl es andere Lösungen gibt, wie das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kind-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Projekt </font><font style="vertical-align: inherit;">, das das Vorhandensein mehrerer Knoten in einem Cluster emulieren kann. </font><font style="vertical-align: inherit;">In Minikube wird </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">möglicherweise die</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Unterstützung mehrerer Knoten </font><font style="vertical-align: inherit;">angezeigt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher möchte ich die Funktionen der beiden oben genannten Umgebungen zur Verfügung haben. Das heißt, ich hätte einen Cluster, der aus mehreren Knoten besteht, und die Arbeit mit diesen Clustern würde keine Netzwerkverzögerungen bedeuten, die für die Interaktion mit Remote-Umgebungen typisch sind. </font><font style="vertical-align: inherit;">
Es wurden bereits viele großartige Tutorials zum Erstellen von Kubernetes Multi-Node-Clustern mit </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Single-Board-Computern geschrieben</font></a><font style="vertical-align: inherit;"> . Viele dieser Handbücher verwenden den Raspberry Pi als SBC. Als ich das sah, beschloss ich, den Weg des geringsten Widerstands zu beschreiten und entschied mich auch für diesen Computer. Die Raspberry Pi-Plattform hat sich als kostengünstige und kostengünstige Lösung etabliert.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/il/ui/ts/iluits7z2ihfycqlskr35gzsstg.jpeg"></a><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist zu beachten, dass die Wahl dieser Plattform einige Kompromisse vorsieht. </font><font style="vertical-align: inherit;">Beispielsweise haben Broadcom und die Raspberry Pi Foundation keine kryptografischen ARMv8-Erweiterungen lizenziert (dies ist für die Hardwarebeschleunigung der AES-Unterstützung erforderlich). </font><font style="vertical-align: inherit;">Eine weitere umstrittene Lösung ist die Verwendung von microSD-Karten in Form eines Standardspeichermediums, von dem das Betriebssystem geladen wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der Analyse der vorhandenen Richtlinien zum Erstellen von Clustern auf Einplatinencomputern habe ich keine einzige gefunden, die eine Lösung beschreibt, die meinen Anforderungen entspricht. </font><font style="vertical-align: inherit;">Ich beginne die Geschichte über den Cluster, den ich mit ihnen erstellt habe.</font></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bedarf</font></font></font></h2><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Cluster sollte in einem separaten Gehäuse untergebracht sein, das leicht bewegt, geöffnet und gewartet werden kann und mit separaten Modulen des Systems arbeitet.</font></font></li>
<li>            ,         .         ,        ,        .   ,      .   ,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>.</li>
<li>       ,      .</li>
<li>      , ,  ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a> .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hinter diesen Anforderungen steht ein nicht offensichtliches Ziel: Ich brauchte meine vierjährige Tochter, um mit dem Cluster zu arbeiten. </font><font style="vertical-align: inherit;">Ich hoffe, dass er für sie eine Art Studienführer wird, der ihr hilft, sich mit Computern, Befehlsschalen und Terminals vertraut zu machen.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zubehör</font></font></font></h2><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detail</font></font></b></td>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelle</font></font></b></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pico 5 Raspberry PI 5S Starter Kit</font></font></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">picocluster.com</font></font></a></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Single Board Computer: 2 Raspberry Pi 4B (4 GB) 3 Raspberry Pi 3B +</font></font></td>
<td></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5 microSD-Karten 32 GB Klasse 10 / A1&nbsp;</font></font></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">raspberrypi.org</font></font></a></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ethernet-Kabel: 2 0,25 m Kat. 83 0,15 m Kat. 7, S / FTP</font></font></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1attack.de</font></font></a></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USB-Kabel PortaPow 20AWG2 USB-C3-Kabel Micro-USB-Kabel</font></font></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">portablepowersupplies.co.uk</font></font></a></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Offizieller Raspberry Pi 7 ″ Touchscreen</font></font></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">raspberrypi.org</font></font></a></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stromversorgung Dehner Elektronik STD-12090 12V / DC 9A 108W</font></font></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dehner.net</font></font></a></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12V bis 5V 15A DC-Abwärtswandler</font></font></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">droking.com</font></font></a></td>
</tr>
<tr>
<td> Heschen 12V 25A SPST 2-Pin ON/OFF</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">heschen.com</a></td>
</tr>
<tr>
<td> Noctua NF-A4x20 5V PWM</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">noctua.at</a></td>
</tr>
<tr>
<td>  , (15A, 30V)  4 ,    MOSFET PSMN011-30YLC</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ebay.com</a></td>
</tr>
<tr>
<td>2  M.2 NVMe  USB 3.0,   JMS58</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">amazon.com</a></td>
</tr>
<tr>
<td>2  Samsung SSD 970 EVO Plus M.2 PCIe NVMe 500 Go</td>
<td></td>
</tr>
<tr>
<td>2   USB 3.0 (  ,  )  6″/152mm</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">usbfirewire.com</a></td>
</tr>
<tr>
<td>2  USB 3.0- Delock, Male-Female ( 270°)</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">delock.com</a></td>
</tr>
<tr>
<td>  Adafruit  Raspberry Pi 24″/610mm</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">adafruit.com</a></td>
</tr>
<tr>
<td>  Adafruit (DSI  CSI)  Raspberry Pi&nbsp;</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">adafruit.com</a></td>
</tr>
<tr>
<td>  Wago  221</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wago.com</a></td>
</tr>
<tr>
<td>  Lapp Unitronic 300mm/1200mm 2x0.14mm²</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">lappgroup.com</a></td>
</tr>
<tr>
<td> Lemo FGG.0B.302.CLAD42  EGG.0B.302.CLL</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">lemo.com</a></td>
</tr>
<tr>
<td>     DuPont Female-Female</td>
<td></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das PicoCluster-Gehäuse ist klein und sehr einfach zu bedienen. Aus dem von mir bestellten Starter-Kit habe ich nur das Chassis einschließlich der Latches und Racks sowie den 8-Port-Gigabit-Ethernet-Switch verwendet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt verstehe ich, dass es besser wäre, wenn PicoCluster eine Version seines Kits ohne elektrische Komponenten verkaufen würde. Eine weitere Alternative zu diesem Kit war die Entwicklung eines eigenen Gehäuses. Dies würde jedoch mehr Zeit erfordern. Ich müsste Vektorzeichnungen erstellen, ich müsste die Dienste des Laserschneidens in einem Unternehmen in Anspruch nehmen, das Acrylplatten anbietet, idealerweise Platten mit einer Beschichtung, die elektrostatische Entladungen ableitet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Während der Arbeit stieß ich auf Warnungen vor </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unzureichender Spannung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und fand heraus, dass das Problem durch Micro-USB-Kabel verursacht wurde, die mit dem Gehäuse geliefert wurden. Zusätzlich zum Gehäuse gab es einen DC / DC-Abwärtswandler mit 12 V bis 5 V und 30 W, den ich durch einen leistungsstärkeren ersetzte. Ich habe dies aus Gründen getan, die ich weiter unten im Abschnitt zur Stromversorgung des Systems erläutern werde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als ich mit der Arbeit an diesem Projekt begann, hatte ich nicht vor, die 2019 veröffentlichten Raspberry Pi 4-Boards zu verwenden. Dies erklärt, dass ich noch drei Raspberry Pi 3-Karten habe, die als Arbeitsknoten fungieren. Ich habe zwei andere solche Boards gegen Raspberry Pi 4 ausgetauscht. Sie werden für Knoten verwendet, die mehr Ressourcen benötigen. Dies ist der Hauptknoten und der Arbeitsknoten, der unter anderem zum Erstellen von Datensicherungen verwendet wird.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kurz nach der Veröffentlichung des Raspberry Pi 4 brachte PicoCluster ein </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">neues Chassis auf den</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Markt, </font><font style="vertical-align: inherit;">das speziell für solche Boards entwickelt wurde. Es enthält ein leistungsstarkes Netzteil, zwei Lüfter und einen Netzschalter. Dieser Fall ist zwar größer als meiner, und die Lüfter werden sicherlich lauter sein als der Noctua NF-A4x20. Die Drehzahl dieses Lüfters kann mithilfe </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">der Pulsweitenmodulation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (PWM) </font><font style="vertical-align: inherit;">gesteuert werden </font><font style="vertical-align: inherit;">, wobei die Ergebnisse der an den Platinen durchgeführten Temperaturmessungen berücksichtigt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist zu beachten, dass sowohl der SoC Broadcom BCM2837 (Raspberry Pi 3) als auch der SoC BCM2711 (Raspberry Pi 4) über Hardware-Timer verfügen, die PWM-Signale erzeugen können. Infolgedessen ist es sehr einfach, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Steuereingangssignale auszugeben</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">von Noctua NF-A4x20 PWM erwartet, ohne den Prozessor zu überlasten. </font><font style="vertical-align: inherit;">Außerdem ist der Lüfter kaum hörbar, wenn er mit der halben Drehzahl läuft (ca. 2500 U / min). </font><font style="vertical-align: inherit;">Wie sich herausstellte, reicht dies aus, um die Systemtemperatur unter normaler Last unter 45 ° C zu halten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das neue Gehäuse verfügt über ein integriertes Netzteil. </font><font style="vertical-align: inherit;">Er ist außerdem teurer als der, den ich gewählt habe. </font><font style="vertical-align: inherit;">All diese Eigenschaften dieses Gehäuses sind der Grund, warum ich das Pico 5S-Kit wählen würde, selbst wenn ich das Gehäuse jetzt kaufen würde. </font><font style="vertical-align: inherit;">Es sollten mehr Anstrengungen unternommen werden, um daran zu denken, aber was sich am Ende herausstellte, scheint mir besser zu sein als das, was sich herausgestellt hätte, wenn ich ein anderes Gebäude gewählt hätte. </font><font style="vertical-align: inherit;">Im Allgemeinen lohnt sich die Mühe und Zeit.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versammlung</font></font></font></h2><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Frontplatte</font></font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c4c/69a/bae/c4c69abaec8489276a0ae015fcc88f93.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vorderseite</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Die Vorderseite hat eine Öffnung für den Zugriff auf microSD-Karten. Dies ist praktisch, auch wenn ich vorhabe, den Systemstart mithilfe des</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> USB-Massenspeicherstarts</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zu organisieren</font><font style="vertical-align: inherit;">. Ich habe vor, dies direkt zu tun, nachdem der Raspberry Pi 4 diesen Startmodus vollständig unterstützt. Das Loch hilft auch, die Luftzirkulation im Gehäuse zu organisieren. In diesem Fall befinden sich zwei SSD-Laufwerke direkt vor dem Lüfter, wodurch die optimale Betriebstemperatur aufrechterhalten werden kann.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Aktivitäts- und Leistungsindikatoren der Boards sind deutlich sichtbar, sodass Sie den Status des Clusters auf einen Blick beurteilen können. Die Aktivitätsanzeigen des Ethernet-Switch sind ebenfalls sichtbar.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ada/9df/3c3/ada9df3c359aa12ccfe557460738e672.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Oberseite des Gehäuses ohne Bildschirm Der</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Bildschirm kann leicht verschoben werden, um ihn näher an die Tastatur heranzuführen oder um beim Öffnen des Gehäuses Zugriff auf die Oberseite zu erhalten.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Linkes Feld</font></font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bb5/0af/849/bb50af8494c2c3a3df84832943addf92.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linkes Feld</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Auf dem linken Feld des Gehäuses befinden sich die GPIO-Anschlüsse der Karten. </font><font style="vertical-align: inherit;">Eines der Kabel verbindet das Hauptgerät mit dem Lüfter - zur Organisation der PWM-Steuerung seiner Drehzahl. </font><font style="vertical-align: inherit;">Ein weiteres Kabel verbindet den Hauptknoten mit dem Leiterplattenmodul, mit dem die Arbeitsknoten ein- und ausgeschaltet werden. </font><font style="vertical-align: inherit;">Vier Kabel verbinden jeden der Arbeitsknoten mit dem Hauptknoten. </font><font style="vertical-align: inherit;">Im ausgeschalteten Zustand werden GPIO-Pins mit einem hohen aktiven Pegel verwendet. </font><font style="vertical-align: inherit;">Auf diese Weise kann der Hauptknoten die Stromversorgung des Arbeitsknotens sicher abschalten, nachdem die am Ende seines Betriebs ausgeführte Abfolge von Aktionen abgeschlossen ist.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/157/16e/984/15716e984e6204e35758d85c63fa87db.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Modul zum Anschließen des Lüfters an den Hauptknoten</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
In der oberen linken Ecke befindet sich ein kleines Modul zum Anschließen des 4-poligen Noctua-Lüfteranschlusses an den Raspberry Pi-Hauptknoten. </font><font style="vertical-align: inherit;">Der entsprechende GPIO-Anschluss ist dank der Hardware-Unterstützung für die Erzeugung von PWM-Signalen zur Steuerung der Lüftergeschwindigkeit konfiguriert. </font><font style="vertical-align: inherit;">Die Geschwindigkeit wird basierend auf der Analyse der Temperatur der Platinen ausgewählt, deren Informationen regelmäßig mit SSH gesammelt werden. </font><font style="vertical-align: inherit;">Das Hauptgerät liest außerdem zu Überwachungszwecken die Lüftergeschwindigkeit.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Rückwand</font></font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ad/7ab/516/9ad7ab516db66c36391208b50f254db0.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rückseite</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Die Rückseite des Gehäuses verbirgt Kabel. Die Tatsache, dass alles so aussieht, kann als Folge eines listigen Ansatzes für die modulare Organisation meines Projekts angesehen werden. Es war schwer, Qualitätskabel zu finden. Besonders - kurze USB 3.0-Kabel mit gebogenen Steckern. Kabel - Dies ist die größte Gruppe beweglicher Elemente in meinem System. Sie müssen bestimmte mechanische und elektrische Eigenschaften erfüllen. Sie erwiesen sich als Hauptursache für Probleme.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich hatte die Idee, ein einzelnes Spiralkabel zu verwenden, um es durch ein DSI-Bandkabel zu ersetzen, mit dem ein Bildschirm an das System angeschlossen ist. Dann würde das Spiralkabel den Bildschirm mit dem Cluster verbinden und ihn mit Strom versorgen. Ich konnte jedoch keinen geeigneten DSI-Anschluss finden. Ich verzichtete auf dieses Unterfangen und die Tatsache, dass mich die Aussicht, 17 Drähte mit einer Größe von 0,14 mm² zu löten, nicht anzog. Ich habe einen DSI-Kabelverlängerer verwendet und ein 2-adriges Spiral-Micro-USB-Stromkabel verwendet. Dies gab mir die Möglichkeit, den Bildschirm leicht zu bewegen und auszuschalten, ohne das Gehäuse zu öffnen.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b04/a96/1a4/b04a961a4401c18d4a44864fb11ecde8.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erfolgloser Versuch, Kabel anzuordnen</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Hier ist ein erfolgloser Versuch, das System zum Organisieren der Kabeleinführung in das für USB 3.0-Erweiterungskabel vorgesehene Gehäuse zu organisieren. </font><font style="vertical-align: inherit;">Trotz unzähliger Versuche, die Kabel richtig zu verlegen, sind bei der Datenübertragung systematisch E / A-Fehler aufgetreten. </font><font style="vertical-align: inherit;">Sie wurden wahrscheinlich durch die Tatsache verursacht, dass sie beim Verlegen der Kabel zu stark gedehnt wurden, oder durch die Tatsache, dass dies die zuverlässige Verbindung der Kabel mit den Steckverbindern beeinträchtigte.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Rechtes Feld</font></font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/136/038/7ab/1360387abdbf37fa749782ec3df5b8ca.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rechtes Feld</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Auf der rechten Seite des Gehäuses sehen Sie den 8-Port-Ethernet-Switch.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System-Design</font></font></font></h2><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Essen</font></font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eed/93b/b85/eed93bb85e71ca00a19f343d39fd706c.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bei offener Frontplatte musste</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ich mich für ein Netzteil entscheiden. </font><font style="vertical-align: inherit;">Insbesondere darüber, welche Leistung in Watt unterstützt werden muss, um die Anforderungen des Clusters zu erfüllen. </font><font style="vertical-align: inherit;">Dies ist eine kleine Frage zu dem, was vorher kam - einem Huhn oder einem Ei, da keine Messungen durchgeführt werden können, bevor der Cluster mit Strom versorgt wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um eine ungefähre Schätzung der Leistung zu erhalten, habe ich mich der</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> offiziellen Dokumentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zugewandt</font><font style="vertical-align: inherit;">, die einige Informationen zur Leistung des Raspberry Pi sowie zu den Spezifikationen anderer Komponenten enthält. </font><font style="vertical-align: inherit;">Dies gab mir die folgenden ungefähren Zahlen basierend auf dem durchschnittlichen Energieverbrauch.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8fa/097/c9b/8fa097c9b1f40c9003bcf75b31d6c672.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber was geschah nach Berücksichtigung der Maximalwerte des Energieverbrauchs aus der Dokumentation.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cec/3fc/424/cec3fc4241a30a788ff793edbf27cc86.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies war viel höher als die Leistung der Netzteile, die 5 V erzeugten, da die Komponenten mit "geringem Stromverbrauch" einen Strom von 10 A benötigten. Dies schloss die Verwendung einer einzelnen 5-V-Stromversorgung aus. Gleichzeitig sind 12-V-Netzteile sehr verbreitet, die die erforderliche Leistung liefern können. Aus diesem Grund habe ich das Dehner Elektronik STD-12090 12V / DC 9A 108W-Netzteil ausgewählt und an einen </font><font style="vertical-align: inherit;">12V </font><font style="vertical-align: inherit;">/ </font><font style="vertical-align: inherit;">5V 75W </font><font style="vertical-align: inherit;">DC / DC- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wandler angeschlossen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier hatte ich eine andere Option, die darin bestand, fünf weniger leistungsstarke Konverter zu verwenden - einen für jede Raspberry Pi-Karte, aber dies würde das Clusterdesign erheblich erschweren.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c86/e1a/95f/c86e1a95febd0d64ea0ee5f9bbafe28a.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Patchplatine</font><i><font color="#999999"><font style="vertical-align: inherit;"> Eine</font></font></i><font style="vertical-align: inherit;"> 4-polige Patchplatine auf Basis des MOSFET PSMN011-30YLC befindet sich unten im Gehäuse. Es wird zum Aktivieren und Deaktivieren von Arbeitsknoten verwendet. Es ist mit 15A, 30V gekennzeichnet, sodass es auch mit der Last von vier Raspberry Pi gut zurechtkommt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe den durchschnittlichen und maximalen Stromverbrauch des Clusters gemessen. Die Messergebnisse stimmen ungefähr mit den ungefähren Berechnungen überein, die ich zuvor durchgeführt habe. Der Unterschied zwischen den erwarteten und tatsächlichen Werten kann durch die Merkmale der Systemkonfiguration und die Merkmale des Tests erklärt werden. Insbesondere habe ich Wi-Fi und Bluetooth auf meinem Raspberry Pi ausgeschaltet. Sie funktionieren auch, ohne dass ein Bild auf dem Monitor angezeigt wird. Dies könnte die Tatsache erklären, dass sich die Werte in Wirklichkeit als geringer herausstellten.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie sich herausstellte, ist das 108-W-Netzteil viel leistungsstärker als für den Cluster erforderlich. </font><font style="vertical-align: inherit;">Die Tatsache, dass ich nur ein solches Netzteil habe, bedeutet jedoch, dass ich die Fähigkeiten des Systems erweitern kann. </font><font style="vertical-align: inherit;">Ersetzen Sie beispielsweise Raspberry Pi 3 durch Raspberry Pi 4.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Datenspeicherung</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine der neuen Funktionen des Raspberry Pi 4 ist das Vorhandensein von zwei USB 3.0-Anschlüssen auf der Platine, die über eine extrem schnelle PCIe-Verbindung mit dem BCM2711 SoC verbunden sind. Dank dessen kann man hoffen, sehr hohe Datenraten zu erreichen. Ich entschied, dass ich diese USB 3.0-Anschlüsse verwendete, um SSDs mit dem M.2 NVMe an USB 3.0-Adapter anzuschließen. Es stellte sich jedoch heraus, dass es sehr schwierig war, solche Adapter zu finden. Ich schlug naiv vor, dass Adapter für mich funktionieren würden. Als Ergebnis kaufte ich den ersten derartigen Adapter ohne seine Kompatibilität mit dem Raspberry Pi 4.en Überprüfen </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mir, zum </font><font style="vertical-align: inherit;">Glück kam in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diesem</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry Pi 4 Download-Anleitung und kaufte dann den empfohlenen Shinestar M.2 NVMe auf USB 3.0 Adapter. </font><font style="vertical-align: inherit;">Es hatte fast die gleiche Größe wie das M.2 NVMe 2280 (22 mm breit und 80 mm lang), was sich hervorragend für das Pico 5S-Gehäuse eignet. </font><font style="vertical-align: inherit;">Ich habe den Adapter verwendet, um die Samsung SSD 970 EVO Plus M.2 PCIe NVMe 500 anzuschließen. Gehen Sie zum Raspberry Pi.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/92e/5a5/1e9/92e5a51e924bcfe0c77ef14278917734.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M.2 NVMe-Adapter auf USB 3.0</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nachdem ich alles installiert und konfiguriert hatte, entschied ich mich, das Laufwerk schnell zu testen und die Datenübertragungsgeschwindigkeit herauszufinden. </font><font style="vertical-align: inherit;">Dazu kopierte ich eine große Datei von der SSD auf meinen Laptop</font></font><code>scp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<code>$ scp pi@master:&lt;source&gt; &lt;destination&gt;<br>
100% 1181MB 39.0MB/s 00:30</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Ergebnis von 39 Mb / s hat mich enttäuscht. Diese Zahlen sind weit entfernt von denen, die zum vollständigen Laden des Gigabit-Ethernet-Switches erforderlich sind. Ich suchte nach einem möglichen Engpass im System und stellte fest, dass während der Dateiübertragung immer einer der Prozessorkerne zu 100% geladen ist. Nachdem ich herausgefunden hatte, dass der Prozessor der Engpass bei der Datenübertragung war, stellte ich schnell fest, dass der Raspberry Pi 4 keine AES-Hardwareunterstützung bietet, da Broadcom und die Raspberry Pi Foundation keine kryptografischen ARMv8-Erweiterungen lizenzierten. Interessanterweise ist der Prozessor der Engpass des Systems auf dem Raspberry Pi 4, während die Engpässe des Raspberry Pi 3 USB 2.0 und Netzwerkschnittstellen waren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein neuer Test </font></font><code>netcat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unter den gleichen Bedingungen ergab mit 104 Mb / s viel bessere Ergebnisse:</font></font><br>
<br>
<pre><code class="bash hljs">$ nc -l 6000 |dd bs=1m of=&lt;destination&gt; &amp; ssh pi@master <span class="hljs-string">"dd bs=1M if=&lt;source&gt; | nc -q 0 <span class="hljs-subst">$(hostname -I | awk '{print $1}')</span> 6000"</span><font></font>
[1] 71300 71301<font></font>
1181+1 records <span class="hljs-keyword">in</span><font></font>
1181+1 records out<font></font>
1238558304 bytes (1.2 GB, 1.2 GiB) copied, 11.8632 s, 104 MB/s<font></font>
0+740624 records <span class="hljs-keyword">in</span><font></font>
0+740624 records out<font></font>
1238558304 bytes transferred <span class="hljs-keyword">in</span> 14.212518 secs (87145593 bytes/sec)<font></font>
[1]&nbsp; + 71300 <span class="hljs-keyword">done</span> &nbsp; &nbsp; &nbsp; nc -l 6000 |<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;71301 <span class="hljs-keyword">done</span> &nbsp; &nbsp; &nbsp; dd bs=1m of=&lt;destination&gt;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem ich mich mit dem ersten SSD-Laufwerk befasst hatte, verband ich das zweite Laufwerk mit einer anderen Raspberry Pi 4- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Karte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ich werde dieses Laufwerk verwenden, um das erste mit etwas wie </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Restic zu sichern</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Darüber hinaus plane ich, SSDs zu verwenden, um den Start mithilfe des USB-Massenspeicher-Starts zu organisieren, unmittelbar nachdem der Raspberry Pi 4 diese Startmethode vollständig unterstützt. </font><font style="vertical-align: inherit;">Im Vergleich zum Herunterladen von microSD verspricht es eine höhere Geschwindigkeit und ein stabileres Leistungsniveau.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Software</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich bin Programmierer und dachte, es wäre für mich einfacher, mit dem Softwareteil des Clusters umzugehen als mit anderen Fragen. </font><font style="vertical-align: inherit;">Die Ergebnisse der wunderbaren Arbeit </font><font style="vertical-align: inherit;">des Rancher-Teams </font><font style="vertical-align: inherit;">an </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k3s</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> haben mir hier definitiv geholfen </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ich werde hier nicht näher auf das Einrichten eines Kubernetes-Clusters auf einem Raspberry Pi mit k3s eingehen. </font><font style="vertical-align: inherit;">Für diejenigen, die interessiert sind, kann ich empfehlen, auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diesen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Leitfaden zu </font><font style="vertical-align: inherit;">verweisen </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Hier sind die wichtigsten zu konfigurierenden Punkte, auf die ich näher eingehen möchte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aktivieren Sie zum Starten auf jedem Knoten </font></font><code>cgroups</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo sed -i <span class="hljs-string">'$ s/$/ cgroup_enable=cpuset cgroup_memory=1 cgroup_enable=memory/'</span> /boot/cmdline.txt<font></font>
$ sudo reboot<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installieren Sie dann k3s auf dem Hauptknoten:</font></font><br>
<br>
<pre><code class="bash hljs">$ curl -sfL https://get.k3s.io | sh -s - --write-kubeconfig-mode 644
<span class="hljs-comment">#   </span><font></font>
$ sudo systemctl status k3s<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt erhalten wir ein Token, das die Verbindung von Arbeitsknoten mit dem Hauptknoten autorisiert:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo cat /var/lib/rancher/k3s/server/node-token
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Weiter - Installieren Sie k3s auf jedem Arbeitsknoten:</font></font><br>
<br>
<pre><code class="bash hljs">$ curl -sfL https://get.k3s.io | K3S_URL=<span class="hljs-string">"https://&lt;MASTER_IP&gt;:6443"</span> K3S_TOKEN=<span class="hljs-string">"&lt;NODE_TOKEN&gt;"</span> sh -
<span class="hljs-comment">#   </span><font></font>
$ sudo systemctl status k3s-agent<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie die standardmäßig installierte interne Registrierung von Container-Images verwenden möchten, müssen Sie diese möglicherweise auf besondere Weise konfigurieren, damit </font></font><code>containerd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bilder </font><font style="vertical-align: inherit;">von ihr </font><font style="vertical-align: inherit;">geladen werden können:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo sh -c <span class="hljs-string">'REGISTRY=$(kubectl get svc -n kube-system registry -o jsonpath={.spec.clusterIP}); \
cat &lt;&lt;EOT &gt;&gt; /etc/rancher/k3s/registries.yaml
mirrors:
&nbsp;&nbsp;"$REGISTRY":
&nbsp;&nbsp;&nbsp;&nbsp;endpoint:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- "http://$REGISTRY"
EOT'</span><font></font>
$ sudo service k3s restart<font></font>
</code></pre><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zukunftspläne</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Material habe ich einige wichtige Themen nicht offengelegt, die einer ausreichend tiefen Analyse wert sind. </font><font style="vertical-align: inherit;">Zum Beispiel Folgendes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Software-Power-Management von Arbeitsknoten und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">automatische Cluster-Skalierung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installieren eines PWM-Lüfters und Anpassen seiner Drehzahl unter Berücksichtigung der Temperaturanzeigen des Systems.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installieren Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pi-Hole</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MetalLB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf Kubernetes </font><font style="vertical-align: inherit;">.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielleicht schreibe ich mehr darüber. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Darüber hinaus plane ich, die Arbeit am Cluster wie folgt fortzusetzen:</font></font><br>
<br>
<ul>
<li>  SSD-   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">USB mass storage boot</a>.</li>
<li>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Restic</a>.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich bin mir sicher, dass ich viel vergessen habe, als ich über meine Erfahrungen bei der Erstellung des Kubernetes-Heimclusters sprach. </font><font style="vertical-align: inherit;">Ich bin Programmierer und an eine eher heterogene Aufteilung großer Aufgaben in kleinere Fälle gewöhnt. </font><font style="vertical-align: inherit;">Die Erfahrung hat gezeigt, dass Hardware in Bezug auf Versuch und Irrtum viel weniger tolerant ist als Software. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je mehr ich herausfinde, desto größer ist im Allgemeinen die Bewunderung für mich durch moderne Hardware- und Softwaretechnologien. </font><font style="vertical-align: inherit;">Es wundert mich, wie der Einfallsreichtum einer Person elektrische Phänomene und Programmiersprachen kombinieren konnte, was sie zu einem Beispiel dafür macht, wie das Bewusstsein die Materie kontrolliert. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liebe Leser! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Haben Sie versucht, etwas Ähnliches zu tun, wie es der Autor dieses Artikels beschrieben hat?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de493696/index.html">Beschleunigung des Qemu KVM-Festplattensubsystems unter Linux</a></li>
<li><a href="../de493700/index.html">Verwenden von Malware in Azure, um Zugriff auf Microsoft 365-Mandanten zu erhalten</a></li>
<li><a href="../de493702/index.html">Massiver Übergang zur Fernarbeit: technische Probleme und Sicherheitsbedrohungen</a></li>
<li><a href="../de493704/index.html">Verwenden von TypeScript in JavaScript ohne Schreiben von TypeScript</a></li>
<li><a href="../de493706/index.html">Kennen Sie Ihren Feind: Erstellen Sie eine Node.js-Hintertür</a></li>
<li><a href="../de493712/index.html">Neue TypeScript-Funktionen für verbesserte Benutzerfreundlichkeit</a></li>
<li><a href="../de493714/index.html">Sicherheits-Spickzettel: Nodejs</a></li>
<li><a href="../de493716/index.html">Typinferenz mit TypeScript unter Verwendung des Konstrukts as const und des Schlüsselworts infer</a></li>
<li><a href="../de493718/index.html">Diskussion: Standard-UNIX-Dienstprogramme, die nur wenige verwendet haben und derzeit verwenden</a></li>
<li><a href="../de493720/index.html">Der perfekte Sturm: Wie Technologie die Food-Service-Branche verändert</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>