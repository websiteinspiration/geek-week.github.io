<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐬 🐘 🤷🏽 パート2：RocketChip：RAMの接続 💂🏼 👩🏼‍🤝‍👩🏻 🗽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="で前の部分、私たちは、アルテラ/ IntelのFPGAに基づく任意のRAMせずにマイクロコントローラを組み立てました。ただし、ボードにはSO-DIMM DDR2 1Gbがインストールされたコネクタがあり、明らかにそれを使用します。これを行うにALTMEMPHYは、RocketChip全体で使用される...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>パート2：RocketChip：RAMの接続</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456172/"><p><img src="https://habrastorage.org/webt/zk/ts/cb/zktscbjwvl5eq08j9sjb3vefdaq.png" align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前の部分、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちは、アルテラ/ IntelのFPGAに基づく任意のRAMせずにマイクロコントローラを組み立てました。</font><font style="vertical-align: inherit;">ただし、ボードにはSO-DIMM DDR2 1Gbがインストールされたコネクタがあり、明らかにそれを使用します。</font><font style="vertical-align: inherit;">これを行うに</font></font><code>ALTMEMPHY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、RocketChip全体で使用されるTileLinkメモリプロトコルで理解できるモジュール</font><font style="vertical-align: inherit;">のインターフェイス</font><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">DDR2コントローラーをラップする必要があります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">カット-触覚デバッグ、ブルートフォースプログラミング、RAKE。</font></font></p><br>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ご存知のように、コンピュータサイエンスには、キャッシュの無効化と変数の命名という2つの主要な問題があります。</font><font style="vertical-align: inherit;">KDPVでは、まれな瞬間が見られます-CSが互いに遭遇した2つの主な問題</font></font><del><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして何かをプロットする</font></font></del><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></em></p><a name="habracut"></a><br>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">免責事項：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前の記事の警告に加えて、FPGA、メモリモジュール、または電源回路への損傷を避けるために、実験を繰り返す前に最後まで記事を読むことを強くお勧めします。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今回は、Linuxをブートしない場合でも、少なくともRAMを接続したいと思っていました。RAMは、ボード上に既に1ギガバイト（または最大4ギガバイト）あります。 16バイト（メモリへの1つの要求の幅）で整列されていないアドレスを含む、GDB + OpenOCDの束を介して読み書きする能力を検討するための成功基準が提案されています。一見すると、設定を少し修正するだけで、SoCジェネレーターはそのままではRAMをサポートできません。それはそれをサポートしますが、MIGインターフェイスを介して（まあ、そしておそらく、Microsemiからの他のいくつかのインターフェイス）。 AXI4も標準インターフェイスを介してサポートしますが、私が理解しているように、取得はそれほど簡単ではありません（少なくとも、Platform Designerを習得することはできません）。</font></font></p><br>
<p><em> :</em> ,   ,    «»  AXI,  ARM.     ,       .   ,    (  « »   —   e-mail   )     ,    . , ,  ,  ,     :        ARM,        ARM, <em>    </em>.  , ,  ,     ..</p><br>
<h1 id="martyshka-i-tilelink-basnya">  TileLink ()</h1><br>
<p>   ,             <code>ddr2_64bit</code>:</p><br>
<div class="spoiler"><b class="spoiler_title"> Intel  </b><div class="spoiler_text"><pre><code class="plaintext hljs">module ddr2_64bit (<font></font>
    local_address,<font></font>
    local_write_req,<font></font>
    local_read_req,<font></font>
    local_burstbegin,<font></font>
    local_wdata,<font></font>
    local_be,<font></font>
    local_size,<font></font>
    global_reset_n,<font></font>
    pll_ref_clk,<font></font>
    soft_reset_n,<font></font>
    local_ready,<font></font>
    local_rdata,<font></font>
    local_rdata_valid,<font></font>
    local_refresh_ack,<font></font>
    local_init_done,<font></font>
    reset_phy_clk_n,<font></font>
    mem_odt,<font></font>
    mem_cs_n,<font></font>
    mem_cke,<font></font>
    mem_addr,<font></font>
    mem_ba,<font></font>
    mem_ras_n,<font></font>
    mem_cas_n,<font></font>
    mem_we_n,<font></font>
    mem_dm,<font></font>
    phy_clk,<font></font>
    aux_full_rate_clk,<font></font>
    aux_half_rate_clk,<font></font>
    reset_request_n,<font></font>
    mem_clk,<font></font>
    mem_clk_n,<font></font>
    mem_dq,<font></font>
    mem_dqs);<font></font>
<font></font>
    input   [25:0]  local_address;<font></font>
    input       local_write_req;<font></font>
    input       local_read_req;<font></font>
    input       local_burstbegin;<font></font>
    input   [127:0] local_wdata;<font></font>
    input   [15:0]  local_be;<font></font>
    input   [2:0]   local_size;<font></font>
    input       global_reset_n;<font></font>
    input       pll_ref_clk;<font></font>
    input       soft_reset_n;<font></font>
    output      local_ready;<font></font>
    output  [127:0] local_rdata;<font></font>
    output      local_rdata_valid;<font></font>
    output      local_refresh_ack;<font></font>
    output      local_init_done;<font></font>
    output      reset_phy_clk_n;<font></font>
    output  [1:0]   mem_odt;<font></font>
    output  [1:0]   mem_cs_n;<font></font>
    output  [1:0]   mem_cke;<font></font>
    output  [13:0]  mem_addr;<font></font>
    output  [1:0]   mem_ba;<font></font>
    output      mem_ras_n;<font></font>
    output      mem_cas_n;<font></font>
    output      mem_we_n;<font></font>
    output  [7:0]   mem_dm;<font></font>
    output      phy_clk;<font></font>
    output      aux_full_rate_clk;<font></font>
    output      aux_half_rate_clk;<font></font>
    output      reset_request_n;<font></font>
    inout   [1:0]   mem_clk;<font></font>
    inout   [1:0]   mem_clk_n;<font></font>
    inout   [63:0]  mem_dq;<font></font>
    inout   [7:0]   mem_dqs;<font></font>
<font></font>
  ...</code></pre></div></div><br>
<p>  : «        : ",   "».     <em>  </em>,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>.      ,    DDR2 —  .   PLL,   , <em>--</em>,   <code>local_init_done</code>,  . ,     :    <code>local_</code> —  «» ,  <code>mem_</code>     ,    ,  <code>pll_ref_clk</code>           —      ,    - reset   ,       .</p><br>
<p>          <code>ddr2_64bit</code>:</p><br>
<div class="spoiler"><b class="spoiler_title">trait MemIf</b><div class="spoiler_text"><pre><code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">MemIf</span> </span>{
  <span class="hljs-keyword">val</span> local_init_done   = <span class="hljs-type">Output</span>(<span class="hljs-type">Bool</span>())<font></font>
<font></font>
  <span class="hljs-keyword">val</span> global_reset_n    = <span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>())
  <span class="hljs-keyword">val</span> pll_ref_clk       = <span class="hljs-type">Input</span>(<span class="hljs-type">Clock</span>())
  <span class="hljs-keyword">val</span> soft_reset_n      = <span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>())<font></font>
<font></font>
  <span class="hljs-keyword">val</span> reset_phy_clk_n   = <span class="hljs-type">Output</span>(<span class="hljs-type">Clock</span>())
  <span class="hljs-keyword">val</span> mem_odt   = <span class="hljs-type">Output</span>(<span class="hljs-type">UInt</span>(<span class="hljs-number">2.</span><span class="hljs-type">W</span>))
  <span class="hljs-keyword">val</span> mem_cs_n  = <span class="hljs-type">Output</span>(<span class="hljs-type">UInt</span>(<span class="hljs-number">2.</span><span class="hljs-type">W</span>))
  <span class="hljs-keyword">val</span> mem_cke   = <span class="hljs-type">Output</span>(<span class="hljs-type">UInt</span>(<span class="hljs-number">2.</span><span class="hljs-type">W</span>))
  <span class="hljs-keyword">val</span> mem_addr  = <span class="hljs-type">Output</span>(<span class="hljs-type">UInt</span>(<span class="hljs-number">14.</span><span class="hljs-type">W</span>))
  <span class="hljs-keyword">val</span> mem_ba    = <span class="hljs-type">Output</span>(<span class="hljs-type">UInt</span>(<span class="hljs-number">2.</span><span class="hljs-type">W</span>))
  <span class="hljs-keyword">val</span> mem_ras_n = <span class="hljs-type">Output</span>(<span class="hljs-type">UInt</span>(<span class="hljs-number">1.</span><span class="hljs-type">W</span>))
  <span class="hljs-keyword">val</span> mem_cas_n = <span class="hljs-type">Output</span>(<span class="hljs-type">UInt</span>(<span class="hljs-number">1.</span><span class="hljs-type">W</span>))
  <span class="hljs-keyword">val</span> mem_we_n  = <span class="hljs-type">Output</span>(<span class="hljs-type">UInt</span>(<span class="hljs-number">1.</span><span class="hljs-type">W</span>))
  <span class="hljs-keyword">val</span> mem_dm    = <span class="hljs-type">Output</span>(<span class="hljs-type">UInt</span>(<span class="hljs-number">8.</span><span class="hljs-type">W</span>))
  <span class="hljs-keyword">val</span> phy_clk           = <span class="hljs-type">Output</span>(<span class="hljs-type">Clock</span>())
  <span class="hljs-keyword">val</span> aux_full_rate_clk = <span class="hljs-type">Output</span>(<span class="hljs-type">Clock</span>())
  <span class="hljs-keyword">val</span> aux_half_rate_clk = <span class="hljs-type">Output</span>(<span class="hljs-type">Clock</span>())
  <span class="hljs-keyword">val</span> reset_request_n = <span class="hljs-type">Output</span>(<span class="hljs-type">Bool</span>())
  <span class="hljs-keyword">val</span> mem_clk   = <span class="hljs-type">Analog</span>(<span class="hljs-number">2.</span><span class="hljs-type">W</span>)
  <span class="hljs-keyword">val</span> mem_clk_n = <span class="hljs-type">Analog</span>(<span class="hljs-number">2.</span><span class="hljs-type">W</span>)
  <span class="hljs-keyword">val</span> mem_dq    = <span class="hljs-type">Analog</span>(<span class="hljs-number">64.</span><span class="hljs-type">W</span>)
  <span class="hljs-keyword">val</span> mem_dqs   = <span class="hljs-type">Analog</span>(<span class="hljs-number">8.</span><span class="hljs-type">W</span>)<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">connectFrom</span></span>(mem_if: <span class="hljs-type">MemIf</span>): <span class="hljs-type">Unit</span> = {<font></font>
    local_init_done := mem_if.local_init_done<font></font>
<font></font>
    mem_if.global_reset_n := global_reset_n<font></font>
    mem_if.pll_ref_clk := pll_ref_clk<font></font>
    mem_if.soft_reset_n := soft_reset_n<font></font>
<font></font>
    reset_phy_clk_n := mem_if.reset_phy_clk_n<font></font>
    mem_odt &lt;&gt; mem_if.mem_odt<font></font>
    mem_cs_n &lt;&gt; mem_if.mem_cs_n<font></font>
    mem_cke &lt;&gt; mem_if.mem_cke<font></font>
    mem_addr &lt;&gt; mem_if.mem_addr<font></font>
    mem_ba &lt;&gt; mem_if.mem_ba<font></font>
    mem_ras_n &lt;&gt; mem_if.mem_ras_n<font></font>
    mem_cas_n &lt;&gt; mem_if.mem_cas_n<font></font>
    mem_we_n &lt;&gt; mem_if.mem_we_n<font></font>
    mem_dm &lt;&gt; mem_if.mem_dm<font></font>
<font></font>
    mem_clk &lt;&gt; mem_if.mem_clk<font></font>
    mem_clk_n &lt;&gt; mem_if.mem_clk_n<font></font>
    mem_dq &lt;&gt; mem_if.mem_dq<font></font>
    mem_dqs &lt;&gt; mem_if.mem_dqs<font></font>
<font></font>
    phy_clk := mem_if.phy_clk<font></font>
    aux_full_rate_clk := mem_if.aux_full_rate_clk<font></font>
    aux_half_rate_clk := mem_if.aux_half_rate_clk<font></font>
    reset_request_n := mem_if.reset_request_n<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MemIfBundle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Bundle</span> <span class="hljs-keyword">with</span> <span class="hljs-title">MemIf</span></span></code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">class dd2_64bit</b><div class="spoiler_text"><pre><code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ddr2_64bit</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BlackBox</span> </span>{
  <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> io = <span class="hljs-type">IO</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">MemIfBundle</span> {
    <span class="hljs-keyword">val</span> local_address     = <span class="hljs-type">Input</span>(<span class="hljs-type">UInt</span>(<span class="hljs-number">26.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> local_write_req   = <span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>())
    <span class="hljs-keyword">val</span> local_read_req    = <span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>())
    <span class="hljs-keyword">val</span> local_burstbegin = <span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>())
    <span class="hljs-keyword">val</span> local_wdata       = <span class="hljs-type">Input</span>(<span class="hljs-type">UInt</span>(<span class="hljs-number">128.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> local_be          = <span class="hljs-type">Input</span>(<span class="hljs-type">UInt</span>(<span class="hljs-number">16.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> local_size        = <span class="hljs-type">Input</span>(<span class="hljs-type">UInt</span>(<span class="hljs-number">3.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> local_ready       = <span class="hljs-type">Output</span>(<span class="hljs-type">Bool</span>())
    <span class="hljs-keyword">val</span> local_rdata       = <span class="hljs-type">Output</span>(<span class="hljs-type">UInt</span>(<span class="hljs-number">128.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> local_rdata_valid = <span class="hljs-type">Output</span>(<span class="hljs-type">Bool</span>())
    <span class="hljs-keyword">val</span> local_refresh_ack = <span class="hljs-type">Output</span>(<span class="hljs-type">Bool</span>())<font></font>
  })<font></font>
}</code></pre></div></div><br>
<p>     :  ,    <code>ROMGenerator</code>,  ,            ,  Chisel -   .  .      <code>MemIfBundle</code>,     .       <code>BlackBox</code>-,    ?   ,   <code>BlackBox</code>      <code>val io = IO(new Bundle { ... })</code>.     <code>MemIfBundle</code>   ,           ,        . ,   <em>-  </em>,    .</p><br>
<p>     TileLink- (   <code>rocket-chip/src/main/scala/tilelink</code>),   , <code>BootROM</code>,      :</p><br>
<pre><code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AltmemphyDDR2RAM</span>(<span class="hljs-params">implicit p: <span class="hljs-type">Parameters</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">LazyModule</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">val</span> <span class="hljs-type">MemoryPortParams</span>(<span class="hljs-type">MasterPortParams</span>(base, size, beatBytes, _, _, executable), <span class="hljs-number">1</span>) = p(<span class="hljs-type">ExtMem</span>).get<font></font>
<font></font>
  <span class="hljs-keyword">val</span> node = <span class="hljs-type">TLManagerNode</span>(<span class="hljs-type">Seq</span>(<span class="hljs-type">TLManagerPortParameters</span>(
    <span class="hljs-type">Seq</span>(<span class="hljs-type">TLManagerParameters</span>(<font></font>
      address = <span class="hljs-type">AddressSet</span>.misaligned(base, size),<font></font>
      resources = <span class="hljs-keyword">new</span> <span class="hljs-type">SimpleDevice</span>(<span class="hljs-string">"ram"</span>, <span class="hljs-type">Seq</span>(<span class="hljs-string">"sifive,altmemphy0"</span>)).reg(<span class="hljs-string">"mem"</span>),<font></font>
      regionType = <span class="hljs-type">RegionType</span>.<span class="hljs-type">UNCACHED</span>,<font></font>
      executable = executable,<font></font>
      supportsGet = <span class="hljs-type">TransferSizes</span>(<span class="hljs-number">1</span>, <span class="hljs-number">16</span>),<font></font>
      supportsPutFull = <span class="hljs-type">TransferSizes</span>(<span class="hljs-number">1</span>, <span class="hljs-number">16</span>),<font></font>
      fifoId = <span class="hljs-type">Some</span>(<span class="hljs-number">0</span>)<font></font>
    )),<font></font>
    beatBytes = <span class="hljs-number">16</span><font></font>
  )))<font></font>
<font></font>
  <span class="hljs-keyword">override</span> <span class="hljs-keyword">lazy</span> <span class="hljs-keyword">val</span> module = <span class="hljs-keyword">new</span> <span class="hljs-type">AltmemphyDDR2RAMImp</span>(<span class="hljs-keyword">this</span>)<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AltmemphyDDR2RAMImp</span>(<span class="hljs-params">_outer: <span class="hljs-type">AltmemphyDDR2RAM</span></span>)(<span class="hljs-params">implicit p: <span class="hljs-type">Parameters</span></span>)</span>
    <span class="hljs-keyword">extends</span> <span class="hljs-type">LazyModuleImp</span>(_outer) {<font></font>
<font></font>
  <span class="hljs-keyword">val</span> (in, edge) = _outer.node.in(<span class="hljs-number">0</span>)
  <span class="hljs-keyword">val</span> ddr2 = <span class="hljs-type">Module</span>(<span class="hljs-keyword">new</span> ddr2_64bit)
  <span class="hljs-keyword">val</span> mem_if = <span class="hljs-type">IO</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">MemIfBundle</span>)<font></font>
<font></font>
  <span class="hljs-comment">// TODO   </span><font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">HasAltmemphyDDR2</span> </span>{ <span class="hljs-keyword">this</span>: <span class="hljs-type">BaseSubsystem</span> =&gt;
  <span class="hljs-keyword">val</span> dtb: <span class="hljs-type">DTB</span>
  <span class="hljs-keyword">val</span> mem_ctrl = <span class="hljs-type">LazyModule</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">AltmemphyDDR2RAM</span>)<font></font>
  mem_ctrl.node := mbus.toDRAMController(<span class="hljs-type">Some</span>(<span class="hljs-string">"altmemphy-ddr2"</span>))()<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">HasAltmemphyDDR2Imp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">LazyModuleImp</span> </span>{
  <span class="hljs-keyword">val</span> outer: <span class="hljs-type">HasAltmemphyDDR2</span>
  <span class="hljs-keyword">val</span> mem_if = <span class="hljs-type">IO</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">MemIfBundle</span>)<font></font>
  mem_if &lt;&gt; outer.mem_ctrl.module.mem_if<font></font>
}</code></pre><br>
<p>   <code>ExtMem</code>     SoC    (<em>   </em>     -  « ,     case class <code>MemoryPortParameters</code> (       Scala-,  ,      ,    <code>Option[MemoryPortParams]</code>,  <code>None</code>,         <code>System.scala</code>...),  ,  case class   ,     »).    manager port TileLink- ( TileLink    ,    :  DDR   memory-mapped ,  , ,  -,        ,      manager,  client). <code>beatBytes</code>,   ,    ,         16 . <code>HasAltmemphyDDR2</code>  <code>HasAltmemphyDDR2Imp</code>       <code>System.scala</code>,  </p><br>
<pre><code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BigZeowaaConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Config</span> (<span class="hljs-params">
  new <span class="hljs-type">WithNBreakpoints</span>(2</span>) <span class="hljs-title">++</span></span>
    <span class="hljs-keyword">new</span> <span class="hljs-type">WithNExtTopInterrupts</span>(<span class="hljs-number">0</span>) ++
    <span class="hljs-keyword">new</span> <span class="hljs-type">WithExtMemSize</span>(<span class="hljs-number">1</span>l &lt;&lt; <span class="hljs-number">30</span>) ++
    <span class="hljs-keyword">new</span> <span class="hljs-type">WithNMemoryChannels</span>(<span class="hljs-number">1</span>) ++
    <span class="hljs-keyword">new</span> <span class="hljs-type">WithCacheBlockBytes</span>(<span class="hljs-number">16</span>) ++
    <span class="hljs-keyword">new</span> <span class="hljs-type">WithNBigCores</span>(<span class="hljs-number">1</span>) ++
    <span class="hljs-keyword">new</span> <span class="hljs-type">WithJtagDTM</span> ++
    <span class="hljs-keyword">new</span> <span class="hljs-type">BaseConfig</span>
)</code></pre><br>
<p>  « »  <code>AltmemphyDDR2RAMImp</code>,    (-   ~30MHz, ,     25MHz) ,        ,    .   ,   <em></em>   :      gdb     ,      <del></del>     ,          .</p><br>
<h1 id="chitaem-dokumentaciyu-na-kontroller-ddr2">    DDR2</h1><br>
<p>,         . ,    ?.. , , -   <code>local_</code>      <code>pll_ref_clk</code>,  25MHz,    <code>phy_clk</code>,      half-rate , ,   , <code>aux_half_rate_clk</code> (, - <code>aux_full_rate_clk</code>?),    ,  ,  , 166MHz.</p><br>
<p> ,     .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>   ,    :</p><br>
<pre><code class="plaintext hljs">  +-+  +-+  +-+  +-+<font></font>
--| |--| |--| |--| |---&gt;<font></font>
  +-+  +-+  +-+  +-+<font></font>
   |    |    |    |<font></font>
---+    |    |    |<font></font>
inclk   |    |    |<font></font>
        |    |    |<font></font>
--------+----+    |<font></font>
outclk            |<font></font>
                  |<font></font>
------------------+<font></font>
output enable</code></pre><br>
<p>,  ,   ,     «»    (    ),        (<code>ready</code>  <code>valid</code>),    ,   ,  -     -  .      ,      <code>ready</code>-<code>valid</code>     —          ,   <strong>  </strong>  ,  ,  ,  ,     :  Intel   <code>dcfifo</code>,        ,        .        Chisel,  ,  black box-:</p><br>
<pre><code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FIFO</span> (<span class="hljs-params">val width: <span class="hljs-type">Int</span>, lglength: <span class="hljs-type">Int</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">BlackBox</span>(<span class="hljs-params"><span class="hljs-type">Map</span>(
  "intended_device_family" -&gt; <span class="hljs-type">StringParam</span>("<span class="hljs-type">Cyclone</span> <span class="hljs-type">IV</span> <span class="hljs-type">E</span>"</span>),</span>
  <span class="hljs-string">"lpm_showahead"</span> -&gt; <span class="hljs-type">StringParam</span>(<span class="hljs-string">"OFF"</span>),
  <span class="hljs-string">"lpm_type"</span> -&gt; <span class="hljs-type">StringParam</span>(<span class="hljs-string">"dcfifo"</span>),
  <span class="hljs-string">"lpm_widthu"</span> -&gt; <span class="hljs-type">IntParam</span>(lglength),
  <span class="hljs-string">"overflow_checking"</span> -&gt; <span class="hljs-type">StringParam</span>(<span class="hljs-string">"ON"</span>),
  <span class="hljs-string">"rdsync_delaypipe"</span> -&gt; <span class="hljs-type">IntParam</span>(<span class="hljs-number">5</span>),
  <span class="hljs-string">"underflow_checking"</span> -&gt; <span class="hljs-type">StringParam</span>(<span class="hljs-string">"ON"</span>),
  <span class="hljs-string">"use_eab"</span> -&gt; <span class="hljs-type">StringParam</span>(<span class="hljs-string">"ON"</span>),
  <span class="hljs-string">"wrsync_delaypipe"</span> -&gt; <span class="hljs-type">IntParam</span>(<span class="hljs-number">5</span>),<font></font>
<font></font>
  <span class="hljs-string">"lpm_width"</span> -&gt; <span class="hljs-type">IntParam</span>(width),
  <span class="hljs-string">"lpm_numwords"</span> -&gt; <span class="hljs-type">IntParam</span>(<span class="hljs-number">1</span> &lt;&lt; lglength)<font></font>
)) {<font></font>
  <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> io = <span class="hljs-type">IO</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">Bundle</span> {
    <span class="hljs-keyword">val</span> data = <span class="hljs-type">Input</span>(<span class="hljs-type">UInt</span>(width.<span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> rdclk = <span class="hljs-type">Input</span>(<span class="hljs-type">Clock</span>())
    <span class="hljs-keyword">val</span> rdreq = <span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>())
    <span class="hljs-keyword">val</span> wrclk = <span class="hljs-type">Input</span>(<span class="hljs-type">Clock</span>())
    <span class="hljs-keyword">val</span> wrreq = <span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>())
    <span class="hljs-keyword">val</span> q = <span class="hljs-type">Output</span>(<span class="hljs-type">UInt</span>(width.<span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> rdempty = <span class="hljs-type">Output</span>(<span class="hljs-type">Bool</span>())
    <span class="hljs-keyword">val</span> wrfull = <span class="hljs-type">Output</span>(<span class="hljs-type">Bool</span>())<font></font>
  })<font></font>
<font></font>
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">desiredName</span></span>: <span class="hljs-type">String</span> = <span class="hljs-string">"dcfifo"</span>
}</code></pre><br>
<p>      :</p><br>
<pre><code class="scala hljs">
<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">FIFO</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">apply</span></span>[<span class="hljs-type">T</span> &lt;: <span class="hljs-type">Data</span>](<font></font>
                        lglength: <span class="hljs-type">Int</span>,<font></font>
                        output: <span class="hljs-type">T</span>, outclk: <span class="hljs-type">Clock</span>,<font></font>
                        input: <span class="hljs-type">T</span>, inclk: <span class="hljs-type">Clock</span>
                      ): <span class="hljs-type">FIFO</span> = {
    <span class="hljs-keyword">val</span> res = <span class="hljs-type">Module</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">FIFO</span>(width = output.widthOption.get, lglength = lglength))<font></font>
    require(input.getWidth == res.width)<font></font>
    output := res.io.q.asTypeOf(output)<font></font>
    res.io.rdclk := outclk<font></font>
    res.io.data := input.asUInt()<font></font>
    res.io.wrclk := inclk<font></font>
    res<font></font>
  }<font></font>
}</code></pre><br>
<h1 id="otladka"></h1><br>
<p>             : <code>tl_req</code> / <code>ddr_req</code>  <code>ddr_resp</code> / <code>tl_resp</code> (,    <code>tl_</code>,    TileLink, ,  <code>ddr_</code> —    ).   ,     ,     .        <code>local_read_req</code>  <code>local_write_req</code>,        .       - </p><br>
<pre><code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AltmemphyDDR2RAMImp</span>(<span class="hljs-params">_outer: <span class="hljs-type">AltmemphyDDR2RAM</span></span>)(<span class="hljs-params">implicit p: <span class="hljs-type">Parameters</span></span>)</span>
    <span class="hljs-keyword">extends</span> <span class="hljs-type">LazyModuleImp</span>(_outer) {<font></font>
<font></font>
  <span class="hljs-keyword">val</span> addrSize = log2Ceil(_outer.size / <span class="hljs-number">16</span>)<font></font>
<font></font>
  <span class="hljs-keyword">val</span> (in, edge) = _outer.node.in(<span class="hljs-number">0</span>)
  <span class="hljs-keyword">val</span> ddr2 = <span class="hljs-type">Module</span>(<span class="hljs-keyword">new</span> ddr2_64bit)<font></font>
  require(ddr2.io.local_address.getWidth == addrSize)<font></font>
  <span class="hljs-keyword">val</span> tl_clock = clock
  <span class="hljs-keyword">val</span> ddr_clock = ddr2.io.aux_full_rate_clk
  <span class="hljs-keyword">val</span> mem_if = <span class="hljs-type">IO</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">MemIfBundle</span>)<font></font>
<font></font>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DdrRequest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Bundle</span> </span>{
    <span class="hljs-keyword">val</span> size = <span class="hljs-type">UInt</span>(in.a.bits.size.widthOption.get.<span class="hljs-type">W</span>)
    <span class="hljs-keyword">val</span> source = <span class="hljs-type">UInt</span>(in.a.bits.source.widthOption.get.<span class="hljs-type">W</span>)
    <span class="hljs-keyword">val</span> address = <span class="hljs-type">UInt</span>(addrSize.<span class="hljs-type">W</span>)
    <span class="hljs-keyword">val</span> be = <span class="hljs-type">UInt</span>(<span class="hljs-number">16.</span><span class="hljs-type">W</span>)
    <span class="hljs-keyword">val</span> wdata = <span class="hljs-type">UInt</span>(<span class="hljs-number">128.</span><span class="hljs-type">W</span>)
    <span class="hljs-keyword">val</span> is_reading = <span class="hljs-type">Bool</span>()<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">val</span> tl_req = <span class="hljs-type">Wire</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">DdrRequest</span>)
  <span class="hljs-keyword">val</span> ddr_req = <span class="hljs-type">Wire</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">DdrRequest</span>)
  <span class="hljs-keyword">val</span> fifo_req = <span class="hljs-type">FIFO</span>(<span class="hljs-number">2</span>, ddr_req, ddr_clock, tl_req, clock)<font></font>
<font></font>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DdrResponce</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Bundle</span> </span>{
    <span class="hljs-keyword">val</span> is_reading = <span class="hljs-type">Bool</span>()
    <span class="hljs-keyword">val</span> size   = <span class="hljs-type">UInt</span>(in.d.bits.size.widthOption.get.<span class="hljs-type">W</span>)
    <span class="hljs-keyword">val</span> source = <span class="hljs-type">UInt</span>(in.d.bits.source.widthOption.get.<span class="hljs-type">W</span>)
    <span class="hljs-keyword">val</span> rdata = <span class="hljs-type">UInt</span>(<span class="hljs-number">128.</span><span class="hljs-type">W</span>)<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">val</span> tl_resp = <span class="hljs-type">Wire</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">DdrResponce</span>)
  <span class="hljs-keyword">val</span> ddr_resp = <span class="hljs-type">Wire</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">DdrResponce</span>)
  <span class="hljs-keyword">val</span> fifo_resp = <span class="hljs-type">FIFO</span>(<span class="hljs-number">2</span>, tl_resp, clock, ddr_resp, ddr_clock)<font></font>
<font></font>
  <span class="hljs-comment">//    TileLink</span><font></font>
<font></font>
  withClock(ddr_clock) {<font></font>
    <span class="hljs-comment">//    </span>
  }</code></pre><br>
<p>  ,       <code>withClock(ddr_clock)</code> (  ,     )    ,   :</p><br>
<pre><code class="scala hljs">  withClock (ddr_clock) {<font></font>
    ddr_resp.rdata      := <span class="hljs-number">0.</span><span class="hljs-type">U</span><font></font>
    ddr_resp.is_reading := ddr_req.is_reading<font></font>
    ddr_resp.size       := ddr_req.size<font></font>
    ddr_resp.source     := ddr_req.source<font></font>
<font></font>
    <span class="hljs-keyword">val</span> will_read = <span class="hljs-type">Wire</span>(!fifo_req.io.rdempty &amp;&amp; !fifo_resp.io.wrfull)<font></font>
    fifo_req.io.rdreq := will_read<font></font>
    fifo_resp.io.wrreq := <span class="hljs-type">RegNext</span>(will_read)<font></font>
  }</code></pre><br>
<p>    ,       ,   <code>Wire(...)</code>,    « »,  ,     ,             , <strong>     -</strong>.    ,   - ,  ,        assertion-     TileLink.      ,        —     ? Verilator     Alter- IP Cores, ModelSim Starter Edition       ,             .    ,         (       Quartus-).</p><br>
<p><em>  ,        ,   ,        .     ;)</em> ,     ,   <code>WithNBigCores(1)</code>   <code>WithNSmallCores(1)</code> —        ,  , .    :     gdb        (,     ,     <strong></strong> ),        - </p><br>
<pre><code class="plaintext hljs">../../rocket-tools/bin/riscv32-unknown-elf-gdb -q -ex "target remote :3333" -ex "x/x 0x80000000"<font></font>
../../rocket-tools/bin/riscv32-unknown-elf-gdb -q -ex "target remote :3333" -ex "set variable *0x80000000=0x1234"</code></pre><br>
<p>        .</p><br>
<h1 id="itog"></h1><br>
<p>         :</p><br>
<pre><code class="scala hljs">  withClock(ddr_clock) {
    <span class="hljs-keyword">val</span> rreq = <span class="hljs-type">RegInit</span>(<span class="hljs-literal">false</span>.<span class="hljs-type">B</span>) <span class="hljs-comment">//   (  )</span>
    <span class="hljs-keyword">val</span> wreq = <span class="hljs-type">RegInit</span>(<span class="hljs-literal">false</span>.<span class="hljs-type">B</span>) <span class="hljs-comment">//   (  )</span>
    <span class="hljs-keyword">val</span> rreq_pending = <span class="hljs-type">RegInit</span>(<span class="hljs-literal">false</span>.<span class="hljs-type">B</span>) <span class="hljs-comment">//   ( )</span><font></font>
<font></font>
    ddr2.io.local_read_req := rreq<font></font>
    ddr2.io.local_write_req := wreq<font></font>
<font></font>
    <span class="hljs-comment">// -   :)</span>
    ddr2.io.local_size := <span class="hljs-number">1.</span><span class="hljs-type">U</span>
    ddr2.io.local_burstbegin := <span class="hljs-literal">true</span>.<span class="hljs-type">B</span><font></font>
<font></font>
    <span class="hljs-comment">//    (    q FIFO)</span><font></font>
    ddr2.io.local_address := ddr_req.address<font></font>
    ddr2.io.local_be := ddr_req.be<font></font>
    ddr2.io.local_wdata := ddr_req.wdata<font></font>
<font></font>
    <span class="hljs-comment">//  ,   </span><font></font>
    ddr_resp.is_reading := ddr_req.is_reading<font></font>
    ddr_resp.size := ddr_req.size<font></font>
    ddr_resp.source := ddr_req.source<font></font>
<font></font>
    <span class="hljs-comment">//   ,   ** **</span>
    <span class="hljs-keyword">val</span> will_read_request = !fifo_req.io.rdempty &amp;&amp;<font></font>
                               !rreq &amp;&amp; !wreq &amp;&amp; !rreq_pending &amp;&amp; ddr2.io.local_ready<font></font>
    <span class="hljs-comment">// ,    </span>
    <span class="hljs-keyword">val</span> will_respond = !fifo_resp.io.wrfull &amp;&amp;<font></font>
                          (  (rreq_pending &amp;&amp; ddr2.io.local_rdata_valid) ||<font></font>
                             (wreq &amp;&amp; ddr2.io.local_ready))<font></font>
    <span class="hljs-keyword">val</span> request_is_read = <span class="hljs-type">RegNext</span>(will_read_request)<font></font>
    fifo_req.io.rdreq := will_read_request<font></font>
    fifo_resp.io.wrreq := will_respond<font></font>
<font></font>
    <span class="hljs-comment">//  ,    </span><font></font>
    when (request_is_read) {<font></font>
      rreq := ddr_req.is_reading<font></font>
      rreq_pending := ddr_req.is_reading<font></font>
      wreq := !ddr_req.is_reading<font></font>
    }<font></font>
    when (will_respond) {<font></font>
      rreq := <span class="hljs-literal">false</span>.<span class="hljs-type">B</span>
      wreq := <span class="hljs-literal">false</span>.<span class="hljs-type">B</span><font></font>
      ddr_resp.rdata := ddr2.io.local_rdata<font></font>
    }<font></font>
    <span class="hljs-comment">//    ,   </span><font></font>
    when (rreq &amp;&amp; ddr2.io.local_ready) {<font></font>
      rreq := <span class="hljs-literal">false</span>.<span class="hljs-type">B</span><font></font>
    }<font></font>
  }</code></pre><br>
<p>  -    :   ,         <em>  </em> ,   .     :</p><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdint.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">uint8_t</span> *x = (<span class="hljs-keyword">uint8_t</span> *)<span class="hljs-number">0x80000000</span>u;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">entry</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">24</span>; ++i) {<font></font>
    x[i] = i;<font></font>
  }<font></font>
}</code></pre><br>
<pre><code class="plaintext hljs">../../rocket-tools/bin/riscv64-unknown-elf-gcc test.c -S -O1</code></pre><br>
<p>      ,   16  :</p><br>
<pre><code class="plaintext hljs">    li  a5,1<font></font>
    slli    a5,a5,31<font></font>
    li  a3,129<font></font>
    slli    a3,a3,24<font></font>
.L2:<font></font>
    andi    a4,a5,0xff<font></font>
    sb  a4,0(a5)<font></font>
    addi    a5,a5,1<font></font>
    bne a5,a3,.L2</code></pre><br>
<p>     <code>bootrom/xip/leds.S</code>.          .   Makefile,    Quartus,    ,  OpenOCD+GDB … , , :</p><br>
<pre><code class="plaintext hljs">$ ../../rocket-tools/bin/riscv32-unknown-elf-gdb -q -ex "target remote :3333"<font></font>
Remote debugging using :3333<font></font>
warning: No executable has been specified and target does not support<font></font>
determining executable automatically.  Try using the "file" command.<font></font>
0x0000000000010014 in ?? ()<font></font>
(gdb) x/x 0x80000000<font></font>
0x80000000:     0x03020100<font></font>
(gdb) x/x 0x80000100<font></font>
0x80000100:     0x03020100<font></font>
(gdb) x/x 0x80000111<font></font>
0x80000111:     0x14131211<font></font>
(gdb) x/x 0x80010110<font></font>
0x80010110:     0x13121110<font></font>
(gdb) x/x 0x80010120<font></font>
0x80010120:     0x23222120</code></pre><br>
<p>  ,     (       ,   ..).</p><br>
<p>: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">AltmemphyDDR2RAM.scala</a>.</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja456160/index.html">強化学習または進化戦略？- どちらも</a></li>
<li><a href="../ja456162/index.html">Google、Tesla、Uberからの移民によって設立された会社であるAuroraは、自動車関連会社と協力し始めました</a></li>
<li><a href="../ja456164/index.html">ルーン風船は、マグニチュード8.0の地震の後、ペルーのネットワークとインターネットへの緊急接続を提供します</a></li>
<li><a href="../ja456168/index.html">何百万年も前にあなたの家はどこにありましたか？</a></li>
<li><a href="../ja456170/index.html">金融アプリケーションの作成方法：開発者を支援する5つのAPI</a></li>
<li><a href="../ja456174/index.html">ハッカソンを学生101として編成する方法。パート2</a></li>
<li><a href="../ja456178/index.html">魔法のないAndroidのテーマとスタイル。そしてSwitchCompatでそれらを調理する方法</a></li>
<li><a href="../ja456180/index.html">最初の脆弱性はどのようにして見つけましたか？</a></li>
<li><a href="../ja456184/index.html">ソフトウェア無線-それはどのように機能しますか？パート8</a></li>
<li><a href="../ja456186/index.html">CS231n：パターン認識のための畳み込みニューラルネットワーク</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>