<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåç ‚å®Ô∏è üê§ "ExtendedPromQL" - Dekodierung des Berichts von Roman Havronenko üòà üöç üçΩÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich schlage vor, dass Sie sich mit der Entschl√ºsselung des Berichts von Roman Havronenko "ExtendedPromQL" vertraut machen.
 
 


 

Kurz √ºber mich. Ic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>"ExtendedPromQL" - Dekodierung des Berichts von Roman Havronenko</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/494034/"><p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich schlage vor, dass Sie sich mit der Entschl√ºsselung des Berichts von Roman Havronenko "ExtendedPromQL" vertraut machen.</font></font></strong></p><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/lWYaiagvmfw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>
<p><img src="https://habrastorage.org/webt/ek/i2/uj/eki2uj2zonf5fkyegqdubqlvekc.png"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kurz √ºber mich. </font><font style="vertical-align: inherit;">Ich hei√üe Roman. </font><font style="vertical-align: inherit;">Ich arbeite bei CloudFlare und lebe in London. </font><font style="vertical-align: inherit;">Ich bin aber auch eine VictoriaMetrics-Schirmherrin. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und ich bin der Autor des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ClickHouse-Plugins</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> f√ºr Grafana und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ClickHouse-Proxy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - dies ist ein kleiner Proxy f√ºr ClickHouse.</font></font></p><br>
<p><img src="https://habrastorage.org/webt/mo/n4/bd/mon4bdnqnfpdcrw5xdt9yxtfp5k.png"></p><br>
<p>    ,   ¬´ ¬ª        ,         ‚Äì   .    ,         ,    .      ,    ‚Äì java  - .    ,     ,     .</p><br>
<p><img src="https://habrastorage.org/webt/4_/t7/f8/4_t7f8-avlr_mqfrxlpxrzu3xo0.png"></p><br>
<p>   .   PromQL? PromQL ‚Äì  Prometheus Query Language.  ,      Prometheus,   time series ,  .</p><br>
<p><img src="https://habrastorage.org/webt/sl/xm/xl/slxmxlenqvdk3zuwppxfws32w2s.png"></p><br>
<p>  time series ?  ,    . </p><br>
<p>:</p><br>
<ul>
<li>   . </li>
<li>    .</li>
<li>   . </li>
</ul><br>
<p><img src="https://habrastorage.org/webt/sm/cv/jt/smcvjtqzyel6bpo0nptwwjdfase.png"></p><br>
<p>     (    ,     ),        . </p><br>
<p>   .      ,     . . .       ,       15 000 .  time series . </p><br>
<p><img src="https://habrastorage.org/webt/td/ui/bg/tduibg52iq_nhdsczrdsaz6wsrg.png"></p><br>
<p>  "" ()        .      ,    .      ,     -, . .    ,   , , Jay  Silent Bob.   ,    ;         . </p><br>
<p><img src="https://habrastorage.org/webt/5y/mx/ln/5ymxlnycfahn8v-25fykmpnpmk4.png"><br>
         .     ClickHouse .      ,   ¬´Steps¬ª, . .    .   ,     ;     - -,    ,  : Jay  Silent Bob.</p><br>
<p><img src="https://habrastorage.org/webt/4z/rb/rc/4zrbrcraa0o4n11b6nqe9wcnwg4.png"></p><br>
<p>       ,    Grafana,  , -,  .</p><br>
<p><img src="https://habrastorage.org/webt/jl/vy/ar/jlvyarnffgamdbzpw-jlsvghisi.png"></p><br>
<p>     .     .  ‚Äì     .    ,    time series   ClickHouse,    Grafana. </p><br>
<p><img src="https://habrastorage.org/webt/ep/_j/sh/ep_jshq0tikq70umihqfx4h5f8w.png"></p><br>
<p>    Graph Panel.      Grafana,      ,       .</p><br>
<p><img src="https://habrastorage.org/webt/ce/xd/_p/cexd_pg4lgyoe6ewugorhtezalu.png"><br>
     ‚Äî      Grafana,     ClickHouse,   ,   .       .    .        , . .    ,    .</p><br>
<p><img src="https://habrastorage.org/webt/4d/vj/km/4dvjkme86hiyazekbuuan1mdvq0.png"></p><br>
<p>       .  ,    ?</p><br>
<p><img src="https://habrastorage.org/webt/o3/th/fp/o3thfpv96wg5r39fam8s2r1d-a0.png"></p><br>
<p>,    .</p><br>
<p><img src="https://habrastorage.org/webt/dn/62/af/dn62af7dmcccmjiiul3-_btzbcg.png"></p><br>
<p>      ,     .  , ? ,   ,    Grafana   time series,      -  ,   time series ‚Äì       - labels.</p><br>
<p><img src="https://habrastorage.org/webt/_r/zv/kc/_rzvkcgn6dgaurlq-e9ypktbrlc.png"></p><br>
<p>     .   Jay.</p><br>
<p><img src="https://habrastorage.org/webt/nq/vf/kw/nqvfkwx1ho5vtvvfm8xad0jo31s.png"></p><br>
<p>   .      .        .</p><br>
<p><img src="https://habrastorage.org/webt/ax/ws/uz/axwsuz9m8lozzdd_gpaj2cq3mqu.png"></p><br>
<p>, ,  ,      ,   Prometheus  PromQL.    .  .     .   Steps.    Jay.    ,          . </p><br>
<p><img src="https://habrastorage.org/webt/0s/nn/qo/0snnqogfhgjcmxkagwzggfsf0o4.png"></p><br>
<p>      Jay  Silent Bob.  ClickHouse     runningDifference, . .          ,    .      .</p><br>
<p><img src="https://habrastorage.org/webt/ba/__/ls/ba__ls6guurcuvg2apxapl0ceoq.png"></p><br>
<p>      , . .  1,8     Silent Bob  Jay.</p><br>
<p><img src="https://habrastorage.org/webt/f7/rk/lk/f7rklkvtw5joxj7cheqrlnikxm8.png"></p><br>
<p>  Prometheus  ,    .  ,    .</p><br>
<p><img src="https://habrastorage.org/webt/26/x2/im/26x2immhsygbsrgdvbe4mrbhmui.png"></p><br>
<p>        Grafana     ,      PromQL.   Rate Macros     .  Grafana    ¬´rate¬ª,  -         .        ,  -  ,     ,      SQL- ‚Äì   .         ,  .</p><br>
<p><img src="https://habrastorage.org/webt/iv/ss/fl/ivssflyqwhf9nr9g4li56nsyxre.png"></p><br>
<p>  ,                .     ClickHouse,      rate,    time series:  Silent Bob,   Jay,        time series.     ,   . </p><br>
<p><img src="https://habrastorage.org/webt/ez/de/_d/ezde_dum2gptsjbjct2cwe3iilw.png"></p><br>
<p>  Prometheus   sum (rate).  ClickHouse    ,   RateColumns,  ,    Prometheus.</p><br>
<p><img src="https://habrastorage.org/webt/ae/el/zp/aeelzpvytgwgqx53w-mvtvg4fh0.png"></p><br>
<p>     PromQL   ,    , , .</p><br>
<p>:</p><br>
<ul>
<li>Limited SELECT.</li>
<li> JOIN.</li>
<li>  HAVING.</li>
</ul><br>
<p>      ,   ,      -  PromQL,   SQL    ,     ,    ,     SQL.      ?      ,          .</p><br>
<p><img src="https://habrastorage.org/webt/7u/9k/jq/7u9kjqnhre3bq9gv7nvfdbj5ozy.png"></p><br>
<p>      .      . ,   ,     ,        ,   .</p><br>
<p><img src="https://habrastorage.org/webt/wm/mk/fy/wmmkfy7sxez3l9kqy8kbcxtwdjw.png"></p><br>
<p>   ‚Äì  Extending PromQL.</p><br>
<p><img src="https://habrastorage.org/webt/y7/gi/cn/y7gicneqli_dhkn-adm6wp0kseg.png"></p><br>
<p>   VictoriaMetrics.   VictoriaMetrics?  time series  ,   OpenSource,    single  cluster-.      ,         , . .     -  0,4   ,   Prometheus ‚Äì  1,2-1,4. </p><br>
<p>    Prometheus.   InfluxDB, Graphite, OpenTSDB.</p><br>
<p>   "", . .    . </p><br>
<p>      Prometheus  Grafana, . .   PromQL engine.   Grafana     Prometheus endpoint  VictoriaMetrics       ,   . </p><br>
<p>      ,   VictoriaMetrics.</p><br>
<p>    ,   .</p><br>
<p><img src="https://habrastorage.org/webt/hf/qa/wo/hfqawo-ol7yyns3_ru3sngniqzu.png"></p><br>
<p>Omit interval param ‚Äì       Grafana.         zoom-in/out  ,     <code>$__interval</code>.    Grafana      .  VictoriaMetrics   ,     .        .   .</p><br>
<p><img src="https://habrastorage.org/webt/ys/j0/e1/ysj0e1hz9uzixz18hlzrsbl8moa.png"></p><br>
<p>  ‚Äì  interval referencing.        .   , , ,   .</p><br>
<p><img src="https://habrastorage.org/webt/gj/wc/tg/gjwctgfj1lfzzyzltg9fkzwdwxc.png"></p><br>
<p>  rollup function. Rollup function    time series    time series.  min, max  avg.  ,    ,       - outliers ( )  . </p><br>
<p><img src="https://habrastorage.org/webt/ir/_u/mi/ir_umi41-5i66f_0qaihrohct6e.png"></p><br>
<p>     irate  rate,      - ,  time series    ,   .      , ,  max    avg.</p><br>
<p><img src="https://habrastorage.org/webt/4w/ee/ty/4weety7gklowpxc-uaiv4ypzyxg.png"></p><br>
<p>  default. Default ‚Äì  ,       Grafana,     time series   .   ?    -   .      ,    ,                .     ,     success  error.      ,       error.   default     .</p><br>
<p><img src="https://habrastorage.org/webt/ca/bs/su/cabssudrqxuinviag6b08ygllfs.png"></p><br>
<p>Keep_last_Value ‚Äì    ,   .  Prometheus         5 ,              .</p><br>
<p><img src="https://habrastorage.org/webt/xh/p1/vk/xhp1vkkknhw7imulfokfl4jdnqk.png"></p><br>
<p>Scrape_interval ‚Äì ,   Prometheus     ,   .    , . </p><br>
<p><img src="https://habrastorage.org/webt/qv/r_/ud/qvr_ud_7h-jx1jnkfuezncdptma.png"><br>
Label replace ‚Äì  .   ,    ,      .       5 ,      .<br>
<img src="https://habrastorage.org/webt/nv/5x/rg/nv5xrgixmrzytgd0rysk7vvqll0.png"><br>
,      ? . .       .</p><br>
<p><img src="https://habrastorage.org/webt/w9/yp/jg/w9ypjg9rkgn-a-e_1cnodrn2bcc.png"></p><br>
<p>   .   ,   extended PromQL?     Common Table Expressions.     QR- (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">https://github.com/VictoriaMetrics/VictoriaMetrics/wiki/ExtendedPromQL</a>),    ,  playground,       VictoriaMetrics      .</p><br>
<p><img src="https://habrastorage.org/webt/jg/y5/he/jgy5hezln0mwu2rp3xqi9fu_gys.png"></p><br>
<p>    ?     ‚Äì    .  ,               .  .      -  ,     ,   ,   JSON,  find replace,    .           ?  ,   ,     .</p><br>
<p><img src="https://habrastorage.org/webt/nm/qj/ba/nmqjbaqwpsfevw27cb_vekd1wc8.png"></p><br>
<p>,       Grafana   ,             .          Grafana?</p><br>
<p><img src="https://habrastorage.org/webt/ep/zh/uw/epzhuw8yfbhi3adpubqaa2y9q7s.png"></p><br>
<p>    :   commonFilter      ,      .       ,    ,   Grafana        .    .</p><br>
<p><img src="https://habrastorage.org/webt/kw/aj/6l/kwaj6lrv3en_ly9hhh2xrtzf3wk.png"></p><br>
<p>     ,    .         ,    ,      . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">https://github.com/grafana/grafana/pull/16694</a></p><br>
<p><img src="https://habrastorage.org/webt/5c/y1/lt/5cy1ltsavquwd5g8e4i-su0flrk.png"></p><br>
<p>  PromQL extended.      ,    .    ru (resource usage).      ,     .     .             . . .     ,     .    ,      ,      ,       - .</p><br>
<p><img src="https://habrastorage.org/webt/jz/ai/b-/jzaib-a71atxlrifwvr_azphzm8.png"></p><br>
<p>    - .     NodeExporter  Grafana.    ,   . . ., , ,  ,          ,   .         ?</p><br>
<p><img src="https://habrastorage.org/webt/jb/v6/md/jbv6mdppyv8l0_ztsvodfchh4iq.png"></p><br>
<p>,  ,       .      .      ,  ,          Grafana.</p><br>
<p><img src="https://habrastorage.org/webt/wt/4v/-a/wt4v-abwkorpzhyqkphqbdjqhhi.png"></p><br>
<p>  ,       ,         ru,       VictoriaMetrics.       ,     CTE.</p><br>
<p><img src="https://habrastorage.org/webt/bm/po/me/bmpomek_z-9_oa2yol1pp4w69kq.png"></p><br>
<p>  ,  ,      . , ,     Grafana  - . , ,      Grafana  ,    - .      - -.  ,  - , . .    .</p><br>
<p>,        ,       ,   SRE.     ,  ,   , ,   Grafana, . .         ,   .      100    ,  -   .</p><br>
<p> ,          Grafana,      ?          ,      .  ,   ,         ,     ,     ,         ?</p><br>
<p>      .     .     Grafana. , ,   NodeExporter,  ,    .     . </p><br>
<p><img src="https://habrastorage.org/webt/nq/6d/ma/nq6dma-mxtherrcw5uz6da4mgrc.png"></p><br>
<p>. .    .      Grafana,          JSON ,     . . . -  ,       .</p><br>
<p><img src="https://habrastorage.org/webt/uv/g5/80/uvg580w0egu0tyqliynpf7-6syi.png"></p><br>
<p>-,     ,     Grafana     .   Grafana "",    -   -  ‚Äì   .  ,      .</p><br>
<p><img src="https://habrastorage.org/webt/ed/46/1t/ed461t6tlckbtprrgwdis29tg6u.png"></p><br>
<p>  VictoriaMetrics.      .     compression,      time series  ,      PromQL,       ,    vertical scalability     Thanos.</p><br>
<p><img src="https://habrastorage.org/webt/hz/dx/iz/hzdxizdmbgw929apdc_nprroyh4.png"></p><br>
<p>:</p><br>
<p><em>       .      Grafana,        5 .      .      production.     ,      ,      ,     ,    .   .    ,    ,       Grafana?    ,    - ‚Äì       .    ,  ,      . .</em></p><br>
<p>  .   .  ‚Äì    ,    ,   ,     ,  ,    . -     ,     ,    ,      .    ‚Äì  ,             ,  ,        capacity planning    - .</p><br>
<p><em> ?</em></p><br>
<p> ? , . </p><br>
<p><em>    Grafana.</em></p><br>
<p>  Grafana? Grafana      DataSource.</p><br>
<p><em> -  .</em></p><br>
<p>,  Grafana   .    GET-, , , step.    ,     ,   ,    .     .  ,       Grafana,    .</p><br>
<p><em>  !   !    mapping   ,   Grafana     . ,   ?</em></p><br>
<p>.</p><br>
<p><em>    ,     alert  Grafana.    alert     .   ,   ,    alerts  Grafana?</em></p><br>
<p> Grafana     - -,  ‚Äì ,   .        Grafana ,    alertmanager.</p><br>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ja, ich benutze es, aber es schien einfacher zu sein, es in Grafana einzurichten, aber danke f√ºr den Rat!</font></font></em></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de493998/index.html">Wer ist DevOps und wann wird es nicht ben√∂tigt</a></li>
<li><a href="../de494000/index.html">Einf√ºhrung in die Stack-Hardware-Sicherheit (Windows 10)</a></li>
<li><a href="../de494006/index.html">Abbau der Hindernisse f√ºr die Spracherkennung</a></li>
<li><a href="../de494020/index.html">√úber 30 Parser, um Daten von jeder Site zu sammeln</a></li>
<li><a href="../de494024/index.html">Firefox f√ºhrt nur HTTPS ein</a></li>
<li><a href="../de494036/index.html">Igel im Nebel</a></li>
<li><a href="../de494038/index.html">Kolonieprojekt auf dem Mars f√ºr 1 Million Menschen</a></li>
<li><a href="../de494042/index.html">Wie CTO f√ºr einen Personalvermittler funktioniert</a></li>
<li><a href="../de494044/index.html">Strukturierung von Risiken und Entscheidungen bei Verwendung von BigData f√ºr offizielle Statistiken</a></li>
<li><a href="../de494048/index.html">Die besten Materialien f√ºr die selbst√§ndige Herstellung von medizinischen Masken</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>