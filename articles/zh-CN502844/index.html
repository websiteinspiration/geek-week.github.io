<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§›ğŸ¾ ğŸ¤²ğŸ½ ğŸ‘¨ğŸ½â€ğŸ¤â€ğŸ‘¨ğŸ» [ç¬¬2/2éƒ¨åˆ†] FFmpegå’ŒSDLæŒ‡å—æˆ–å¦‚ä½•ç¼–å†™å°‘äº1000è¡Œçš„è§†é¢‘æ’­æ”¾å™¨ ğŸ¤¾ğŸ¾ ğŸ– ğŸ§›ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ‘ä»¬å°†æ‰‹å†Œçš„å…¶ä½™è¯‘æœ¬ç¿»è¯‘æˆä¿„è¯­ï¼Œè™½ç„¶æœ‰äº›è¿‡æ—¶äº†ï¼Œä½†å¹¶æ²¡æœ‰å¤±å»æ„ä¹‰ï¼Œå› ä¸ºæœ¬æ•™ç¨‹æœ‰åŠ©äºç†è§£ä½¿ç”¨FFmpegå’ŒSDLåº“åˆ›å»ºè§†é¢‘åº”ç”¨ç¨‹åºçš„â€œå¨æˆ¿â€ã€‚
 
 å°½ç®¡æˆ‘ä»¬å°è¯•äº†ï¼Œä½†æ˜¯åœ¨å¦‚æ­¤åºå¤§çš„æ–‡æœ¬ä¸­ç¿»è¯‘çš„å›°éš¾æ˜¯ä¸å¯é¿å…çš„ã€‚æŠ¥å‘Šé”™è¯¯ï¼ˆæœ€å¥½æ˜¯åœ¨ç§äººæ¶ˆæ¯ä¸­ï¼‰-æˆ‘ä»¬åœ¨ä¸€èµ·å°†åšå¾—æ›´å¥½ã€‚
 
 ç›®å½•  ç¬¬1éƒ¨åˆ† ç¬¬2éƒ¨åˆ† ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>[ç¬¬2/2éƒ¨åˆ†] FFmpegå’ŒSDLæŒ‡å—æˆ–å¦‚ä½•ç¼–å†™å°‘äº1000è¡Œçš„è§†é¢‘æ’­æ”¾å™¨</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/edison/blog/502844/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><div style="text-align:center;"><img width="780" height="325" src="https://habrastorage.org/webt/yx/qh/nq/yxqhnqwvdlvzfw22erhmpfzpfba.png"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å°†æ‰‹å†Œçš„å…¶ä½™è¯‘æœ¬ç¿»è¯‘æˆä¿„è¯­ï¼Œè™½ç„¶æœ‰äº›è¿‡æ—¶äº†ï¼Œä½†å¹¶æ²¡æœ‰å¤±å»æ„ä¹‰ï¼Œå› ä¸ºæœ¬æ•™ç¨‹æœ‰åŠ©äºç†è§£ä½¿ç”¨FFmpegå’ŒSDLåº“åˆ›å»ºè§†é¢‘åº”ç”¨ç¨‹åºçš„â€œå¨æˆ¿â€ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°½ç®¡æˆ‘ä»¬å°è¯•äº†ï¼Œä½†æ˜¯åœ¨å¦‚æ­¤åºå¤§çš„æ–‡æœ¬</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸­ç¿»è¯‘çš„å›°éš¾æ˜¯</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸å¯é¿å…çš„</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æŠ¥å‘Šé”™è¯¯ï¼ˆæœ€å¥½æ˜¯åœ¨ç§äººæ¶ˆæ¯ä¸­ï¼‰-æˆ‘ä»¬åœ¨ä¸€èµ·å°†åšå¾—æ›´å¥½ã€‚</font></font><a name="menu"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›®å½•</font></font></h3><div class="scrollable-table"><table>
<tbody><tr>
<th align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬1éƒ¨åˆ†</font></font></th>
<th align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬2éƒ¨åˆ†</font></font></th>
</tr>
<tr>
<td align="left"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‰è¨€</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬1è¯¾ï¼šåˆ›å»ºå±å¹•æˆªå›¾</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬2è¯¾ï¼šæ˜¾ç¤º</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬3è¯¾ï¼šæ’­æ”¾å£°éŸ³</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬4è¯¾ï¼šå¤šçº¿ç¨‹</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬5è¯¾ï¼šåŒæ­¥è§†é¢‘</font></font></a><br>
</td>
<td align="left"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬6è¯¾ï¼šéŸ³é¢‘åŒæ­¥</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬7è¯¾ï¼šæœç´¢</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åè®°</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é™„å½•1.åŠŸèƒ½åˆ—è¡¨</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é™„å½•2.æ•°æ®ç»“æ„</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é“¾æ¥</font></font></a></td>
</tr>
</tbody></table></div><a name="habracut"></a><br>
<a name="audio"></a><blockquote><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="EDISONè½¯ä»¶-ç½‘ç»œå¼€å‘"><img align="left" width="153" height="75" src="https://habrastorage.org/webt/w0/zl/to/w0zltoxvysbr0yeinstkfvw1wbg.png" alt="EDISONè½¯ä»¶-ç½‘ç»œå¼€å‘"></a><br clear="right">
     EDISON.<br>
<br>
    ,      .<br>
<br>
,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  </a>,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">   Axxon Next  SureView Immix</a>.<br>
<br>
      ! ;-)</blockquote><br>
<h2> 6:   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="ç¬¬5è¯¾ï¼šè§†é¢‘åŒæ­¥">â†</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="åˆ°ç›®å½•">â‡‘</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="ç¬¬7è¯¾ï¼šæœç´¢">â†’</a></h2><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">  tutorial06.c</b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment">// tutorial05.c</span>
<span class="hljs-comment">// A pedagogical video player that really works!</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Code based on FFplay, Copyright (c) 2003 Fabrice Bellard, </span>
<span class="hljs-comment">// and a tutorial by Martin Bohme (boehme@inb.uni-luebeckREMOVETHIS.de)</span>
<span class="hljs-comment">// Tested on Gentoo, CVS version 5/01/07 compiled with GCC 4.1.1</span>
<span class="hljs-comment">// With updates from https://github.com/chelyaev/ffmpeg-tutorial</span>
<span class="hljs-comment">// Updates tested on:</span>
<span class="hljs-comment">// LAVC 54.59.100, LAVF 54.29.104, LSWS 2.1.101, SDL 1.2.15</span>
<span class="hljs-comment">// on GCC 4.7.2 in Debian February 2015</span>
<span class="hljs-comment">// Use</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// gcc -o tutorial05 tutorial05.c -lavformat -lavcodec -lswscale -lz -lm `sdl-config --cflags --libs`</span>
<span class="hljs-comment">// to build (assuming libavformat and libavcodec are correctly installed, </span>
<span class="hljs-comment">// and assuming you have sdl-config. Please refer to SDL docs for your installation.)</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Run using</span>
<span class="hljs-comment">// tutorial04 myvideofile.mpg</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// to play the video stream on your screen.</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libavcodec/avcodec.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libavformat/avformat.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libswscale/swscale.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SDL.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SDL_thread.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> __MINGW32__</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">undef</span> main <span class="hljs-comment">/* Prevents SDL from overriding main() */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;assert.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;math.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-comment">// compatibility with newer API</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> LIBAVCODEC_VERSION_INT &lt; AV_VERSION_INT(55,28,1)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> av_frame_alloc avcodec_alloc_frame</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> av_frame_free avcodec_free_frame</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SDL_AUDIO_BUFFER_SIZE 1024</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_AUDIO_FRAME_SIZE 192000</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_AUDIOQ_SIZE (5 * 16 * 1024)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_VIDEOQ_SIZE (5 * 256 * 1024)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> AV_SYNC_THRESHOLD 0.01</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> AV_NOSYNC_THRESHOLD 10.0</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SAMPLE_CORRECTION_PERCENT_MAX 10</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> AUDIO_DIFF_AVG_NB 20</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FF_REFRESH_EVENT (SDL_USEREVENT)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FF_QUIT_EVENT (SDL_USEREVENT + 1)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> VIDEO_PICTURE_QUEUE_SIZE 1</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEFAULT_AV_SYNC_TYPE AV_SYNC_VIDEO_MASTER</span><font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">PacketQueue</span> {</span><font></font>
  AVPacketList *first_pkt, *last_pkt;<font></font>
  <span class="hljs-keyword">int</span> nb_packets;
  <span class="hljs-keyword">int</span> size;<font></font>
  SDL_mutex *mutex;<font></font>
  SDL_cond *cond;<font></font>
} PacketQueue;<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">VideoPicture</span> {</span><font></font>
  SDL_Overlay *bmp;<font></font>
  <span class="hljs-keyword">int</span> width, height; <span class="hljs-comment">/* source height &amp; width */</span>
  <span class="hljs-keyword">int</span> allocated;
  <span class="hljs-keyword">double</span> pts;<font></font>
} VideoPicture;<font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">VideoState</span> {</span><font></font>
<font></font>
  AVFormatContext *pFormatCtx;<font></font>
  <span class="hljs-keyword">int</span>             videoStream, audioStream;<font></font>
<font></font>
  <span class="hljs-keyword">int</span>             av_sync_type;
  <span class="hljs-keyword">double</span>          external_clock; <span class="hljs-comment">/* external clock base */</span>
  <span class="hljs-keyword">int64_t</span>         external_clock_time;<font></font>
<font></font>
  <span class="hljs-keyword">double</span>          audio_clock;<font></font>
  AVStream        *audio_st;<font></font>
  AVCodecContext  *audio_ctx;<font></font>
  PacketQueue     audioq;<font></font>
  <span class="hljs-keyword">uint8_t</span>         audio_buf[(AVCODEC_MAX_AUDIO_FRAME_SIZE * <span class="hljs-number">3</span>) / <span class="hljs-number">2</span>];
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>    audio_buf_size;
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>    audio_buf_index;<font></font>
  AVFrame         audio_frame;<font></font>
  AVPacket        audio_pkt;<font></font>
  <span class="hljs-keyword">uint8_t</span>         *audio_pkt_data;
  <span class="hljs-keyword">int</span>             audio_pkt_size;
  <span class="hljs-keyword">int</span>             audio_hw_buf_size;
  <span class="hljs-keyword">double</span>          audio_diff_cum; <span class="hljs-comment">/* used for AV difference average computation */</span>
  <span class="hljs-keyword">double</span>          audio_diff_avg_coef;
  <span class="hljs-keyword">double</span>          audio_diff_threshold;
  <span class="hljs-keyword">int</span>             audio_diff_avg_count;
  <span class="hljs-keyword">double</span>          frame_timer;
  <span class="hljs-keyword">double</span>          frame_last_pts;
  <span class="hljs-keyword">double</span>          frame_last_delay;
  <span class="hljs-keyword">double</span>          video_clock; <span class="hljs-comment">///&lt;pts of last decoded frame / predicted pts of next decoded frame</span>
  <span class="hljs-keyword">double</span>          video_current_pts; <span class="hljs-comment">///&lt;current displayed pts (different from video_clock if frame fifos are used)</span>
  <span class="hljs-keyword">int64_t</span>         video_current_pts_time;  <span class="hljs-comment">///&lt;time (av_gettime) at which we updated video_current_pts - used to have running video pts</span><font></font>
  AVStream        *video_st;<font></font>
  AVCodecContext  *video_ctx;<font></font>
  PacketQueue     videoq;<font></font>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SwsContext</span> *<span class="hljs-title">sws_ctx</span>;</span><font></font>
<font></font>
  VideoPicture    pictq[VIDEO_PICTURE_QUEUE_SIZE];<font></font>
  <span class="hljs-keyword">int</span>             pictq_size, pictq_rindex, pictq_windex;<font></font>
  SDL_mutex       *pictq_mutex;<font></font>
  SDL_cond        *pictq_cond;<font></font>
  <font></font>
  SDL_Thread      *parse_tid;<font></font>
  SDL_Thread      *video_tid;<font></font>
<font></font>
  <span class="hljs-keyword">char</span>            filename[<span class="hljs-number">1024</span>];
  <span class="hljs-keyword">int</span>             quit;<font></font>
} VideoState;<font></font>
<font></font>
<span class="hljs-keyword">enum</span> {<font></font>
  AV_SYNC_AUDIO_MASTER,<font></font>
  AV_SYNC_VIDEO_MASTER,<font></font>
  AV_SYNC_EXTERNAL_MASTER,<font></font>
};<font></font>
<font></font>
SDL_Surface     *screen;<font></font>
SDL_mutex       *screen_mutex;<font></font>
<font></font>
<span class="hljs-comment">/* Since we only have one decoding thread, the Big Struct
   can be global in case we need it. */</span><font></font>
VideoState *global_video_state;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">packet_queue_init</span><span class="hljs-params">(PacketQueue *q)</span> </span>{
  <span class="hljs-built_in">memset</span>(q, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(PacketQueue));<font></font>
  q-&gt;mutex = SDL_CreateMutex();<font></font>
  q-&gt;cond = SDL_CreateCond();<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">packet_queue_put</span><span class="hljs-params">(PacketQueue *q, AVPacket *pkt)</span> </span>{<font></font>
<font></font>
  AVPacketList *pkt1;<font></font>
  <span class="hljs-keyword">if</span>(av_dup_packet(pkt) &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
  pkt1 = av_malloc(<span class="hljs-keyword">sizeof</span>(AVPacketList));
  <span class="hljs-keyword">if</span> (!pkt1)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  pkt1-&gt;pkt = *pkt;<font></font>
  pkt1-&gt;next = <span class="hljs-literal">NULL</span>;<font></font>
  <font></font>
  SDL_LockMutex(q-&gt;mutex);<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (!q-&gt;last_pkt)<font></font>
    q-&gt;first_pkt = pkt1;<font></font>
  <span class="hljs-keyword">else</span><font></font>
    q-&gt;last_pkt-&gt;next = pkt1;<font></font>
  q-&gt;last_pkt = pkt1;<font></font>
  q-&gt;nb_packets++;<font></font>
  q-&gt;size += pkt1-&gt;pkt.size;<font></font>
  SDL_CondSignal(q-&gt;cond);<font></font>
  <font></font>
  SDL_UnlockMutex(q-&gt;mutex);<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">packet_queue_get</span><span class="hljs-params">(PacketQueue *q, AVPacket *pkt, <span class="hljs-keyword">int</span> block)</span>
</span>{<font></font>
  AVPacketList *pkt1;<font></font>
  <span class="hljs-keyword">int</span> ret;<font></font>
<font></font>
  SDL_LockMutex(q-&gt;mutex);<font></font>
  <font></font>
  <span class="hljs-keyword">for</span>(;;) {<font></font>
    <font></font>
    <span class="hljs-keyword">if</span>(global_video_state-&gt;quit) {<font></font>
      ret = <span class="hljs-number">-1</span>;
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
<font></font>
    pkt1 = q-&gt;first_pkt;<font></font>
    <span class="hljs-keyword">if</span> (pkt1) {<font></font>
      q-&gt;first_pkt = pkt1-&gt;next;<font></font>
      <span class="hljs-keyword">if</span> (!q-&gt;first_pkt)<font></font>
	q-&gt;last_pkt = <span class="hljs-literal">NULL</span>;<font></font>
      q-&gt;nb_packets--;<font></font>
      q-&gt;size -= pkt1-&gt;pkt.size;<font></font>
      *pkt = pkt1-&gt;pkt;<font></font>
      av_free(pkt1);<font></font>
      ret = <span class="hljs-number">1</span>;
      <span class="hljs-keyword">break</span>;<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!block) {<font></font>
      ret = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">break</span>;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      SDL_CondWait(q-&gt;cond, q-&gt;mutex);<font></font>
    }<font></font>
  }<font></font>
  SDL_UnlockMutex(q-&gt;mutex);<font></font>
  <span class="hljs-keyword">return</span> ret;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">get_audio_clock</span><span class="hljs-params">(VideoState *is)</span> </span>{
  <span class="hljs-keyword">double</span> pts;
  <span class="hljs-keyword">int</span> hw_buf_size, bytes_per_sec, n;<font></font>
  <font></font>
  pts = is-&gt;audio_clock; <span class="hljs-comment">/* maintained in the audio thread */</span><font></font>
  hw_buf_size = is-&gt;audio_buf_size - is-&gt;audio_buf_index;<font></font>
  bytes_per_sec = <span class="hljs-number">0</span>;<font></font>
  n = is-&gt;audio_ctx-&gt;channels * <span class="hljs-number">2</span>;
  <span class="hljs-keyword">if</span>(is-&gt;audio_st) {<font></font>
    bytes_per_sec = is-&gt;audio_ctx-&gt;sample_rate * n;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span>(bytes_per_sec) {<font></font>
    pts -= (<span class="hljs-keyword">double</span>)hw_buf_size / bytes_per_sec;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> pts;<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">get_video_clock</span><span class="hljs-params">(VideoState *is)</span> </span>{
  <span class="hljs-keyword">double</span> delta;<font></font>
<font></font>
  delta = (av_gettime() - is-&gt;video_current_pts_time) / <span class="hljs-number">1000000.0</span>;
  <span class="hljs-keyword">return</span> is-&gt;video_current_pts + delta;<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">get_external_clock</span><span class="hljs-params">(VideoState *is)</span> </span>{
  <span class="hljs-keyword">return</span> av_gettime() / <span class="hljs-number">1000000.0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">get_master_clock</span><span class="hljs-params">(VideoState *is)</span> </span>{
  <span class="hljs-keyword">if</span>(is-&gt;av_sync_type == AV_SYNC_VIDEO_MASTER) {
    <span class="hljs-keyword">return</span> get_video_clock(is);<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(is-&gt;av_sync_type == AV_SYNC_AUDIO_MASTER) {
    <span class="hljs-keyword">return</span> get_audio_clock(is);<font></font>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> get_external_clock(is);<font></font>
  }<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-comment">/* Add or subtract samples to get a better sync, return new
   audio buffer size */</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">synchronize_audio</span><span class="hljs-params">(VideoState *is, <span class="hljs-keyword">short</span> *samples,
		      <span class="hljs-keyword">int</span> samples_size, <span class="hljs-keyword">double</span> pts)</span> </span>{
  <span class="hljs-keyword">int</span> n;
  <span class="hljs-keyword">double</span> ref_clock;<font></font>
<font></font>
  n = <span class="hljs-number">2</span> * is-&gt;audio_ctx-&gt;channels;<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>(is-&gt;av_sync_type != AV_SYNC_AUDIO_MASTER) {
    <span class="hljs-keyword">double</span> diff, avg_diff;
    <span class="hljs-keyword">int</span> wanted_size, min_size, max_size <span class="hljs-comment">/*, nb_samples */</span>;<font></font>
    <font></font>
    ref_clock = get_master_clock(is);<font></font>
    diff = get_audio_clock(is) - ref_clock;<font></font>
<font></font>
    <span class="hljs-keyword">if</span>(diff &lt; AV_NOSYNC_THRESHOLD) {
      <span class="hljs-comment">// accumulate the diffs</span><font></font>
      is-&gt;audio_diff_cum = diff + is-&gt;audio_diff_avg_coef<font></font>
	* is-&gt;audio_diff_cum;<font></font>
      <span class="hljs-keyword">if</span>(is-&gt;audio_diff_avg_count &lt; AUDIO_DIFF_AVG_NB) {<font></font>
	is-&gt;audio_diff_avg_count++;<font></font>
      } <span class="hljs-keyword">else</span> {<font></font>
	avg_diff = is-&gt;audio_diff_cum * (<span class="hljs-number">1.0</span> - is-&gt;audio_diff_avg_coef);
	<span class="hljs-keyword">if</span>(<span class="hljs-built_in">fabs</span>(avg_diff) &gt;= is-&gt;audio_diff_threshold) {<font></font>
	  wanted_size = samples_size + ((<span class="hljs-keyword">int</span>)(diff * is-&gt;audio_ctx-&gt;sample_rate) * n);<font></font>
	  min_size = samples_size * ((<span class="hljs-number">100</span> - SAMPLE_CORRECTION_PERCENT_MAX) / <span class="hljs-number">100</span>);<font></font>
	  max_size = samples_size * ((<span class="hljs-number">100</span> + SAMPLE_CORRECTION_PERCENT_MAX) / <span class="hljs-number">100</span>);
	  <span class="hljs-keyword">if</span>(wanted_size &lt; min_size) {<font></font>
	    wanted_size = min_size;<font></font>
	  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (wanted_size &gt; max_size) {<font></font>
	    wanted_size = max_size;<font></font>
	  }<font></font>
	  <span class="hljs-keyword">if</span>(wanted_size &lt; samples_size) {
	    <span class="hljs-comment">/* remove samples */</span><font></font>
	    samples_size = wanted_size;<font></font>
	  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(wanted_size &gt; samples_size) {
	    <span class="hljs-keyword">uint8_t</span> *samples_end, *q;
	    <span class="hljs-keyword">int</span> nb;<font></font>
<font></font>
	    <span class="hljs-comment">/* add samples by copying final sample*/</span><font></font>
	    nb = (samples_size - wanted_size);<font></font>
	    samples_end = (<span class="hljs-keyword">uint8_t</span> *)samples + samples_size - n;<font></font>
	    q = samples_end + n;<font></font>
	    <span class="hljs-keyword">while</span>(nb &gt; <span class="hljs-number">0</span>) {
	      <span class="hljs-built_in">memcpy</span>(q, samples_end, n);<font></font>
	      q += n;<font></font>
	      nb -= n;<font></font>
	    }<font></font>
	    samples_size = wanted_size;<font></font>
	  }<font></font>
	}<font></font>
      }<font></font>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">/* difference is TOO big; reset diff stuff */</span>
      is-&gt;audio_diff_avg_count = <span class="hljs-number">0</span>;<font></font>
      is-&gt;audio_diff_cum = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> samples_size;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">audio_decode_frame</span><span class="hljs-params">(VideoState *is, <span class="hljs-keyword">uint8_t</span> *audio_buf, <span class="hljs-keyword">int</span> buf_size, <span class="hljs-keyword">double</span> *pts_ptr)</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">int</span> len1, data_size = <span class="hljs-number">0</span>;<font></font>
  AVPacket *pkt = &amp;is-&gt;audio_pkt;<font></font>
  <span class="hljs-keyword">double</span> pts;
  <span class="hljs-keyword">int</span> n;<font></font>
<font></font>
  <span class="hljs-keyword">for</span>(;;) {
    <span class="hljs-keyword">while</span>(is-&gt;audio_pkt_size &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">int</span> got_frame = <span class="hljs-number">0</span>;<font></font>
      len1 = avcodec_decode_audio4(is-&gt;audio_ctx, &amp;is-&gt;audio_frame, &amp;got_frame, pkt);<font></font>
      <span class="hljs-keyword">if</span>(len1 &lt; <span class="hljs-number">0</span>) {
	<span class="hljs-comment">/* if error, skip frame */</span>
	is-&gt;audio_pkt_size = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">break</span>;<font></font>
      }<font></font>
      data_size = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">if</span>(got_frame) {<font></font>
	data_size = av_samples_get_buffer_size(<span class="hljs-literal">NULL</span>, <font></font>
					       is-&gt;audio_ctx-&gt;channels,<font></font>
					       is-&gt;audio_frame.nb_samples,<font></font>
					       is-&gt;audio_ctx-&gt;sample_fmt,<font></font>
					       <span class="hljs-number">1</span>);<font></font>
	assert(data_size &lt;= buf_size);<font></font>
	<span class="hljs-built_in">memcpy</span>(audio_buf, is-&gt;audio_frame.data[<span class="hljs-number">0</span>], data_size);<font></font>
      }<font></font>
      is-&gt;audio_pkt_data += len1;<font></font>
      is-&gt;audio_pkt_size -= len1;<font></font>
      <span class="hljs-keyword">if</span>(data_size &lt;= <span class="hljs-number">0</span>) {
	<span class="hljs-comment">/* No data yet, get more frames */</span>
	<span class="hljs-keyword">continue</span>;<font></font>
      }<font></font>
      pts = is-&gt;audio_clock;<font></font>
      *pts_ptr = pts;<font></font>
      n = <span class="hljs-number">2</span> * is-&gt;audio_ctx-&gt;channels;<font></font>
      is-&gt;audio_clock += (<span class="hljs-keyword">double</span>)data_size /<font></font>
	(<span class="hljs-keyword">double</span>)(n * is-&gt;audio_ctx-&gt;sample_rate);
      <span class="hljs-comment">/* We have data, return it and come back for more later */</span>
      <span class="hljs-keyword">return</span> data_size;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(pkt-&gt;data)<font></font>
      av_free_packet(pkt);<font></font>
<font></font>
    <span class="hljs-keyword">if</span>(is-&gt;quit) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
    <span class="hljs-comment">/* next packet */</span>
    <span class="hljs-keyword">if</span>(packet_queue_get(&amp;is-&gt;audioq, pkt, <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
    is-&gt;audio_pkt_data = pkt-&gt;data;<font></font>
    is-&gt;audio_pkt_size = pkt-&gt;size;<font></font>
    <span class="hljs-comment">/* if update, update the audio clock w/pts */</span>
    <span class="hljs-keyword">if</span>(pkt-&gt;pts != AV_NOPTS_VALUE) {<font></font>
      is-&gt;audio_clock = av_q2d(is-&gt;audio_st-&gt;time_base)*pkt-&gt;pts;<font></font>
    }<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">audio_callback</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *userdata, Uint8 *stream, <span class="hljs-keyword">int</span> len)</span> </span>{<font></font>
<font></font>
  VideoState *is = (VideoState *)userdata;<font></font>
  <span class="hljs-keyword">int</span> len1, audio_size;
  <span class="hljs-keyword">double</span> pts;<font></font>
<font></font>
  <span class="hljs-keyword">while</span>(len &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">if</span>(is-&gt;audio_buf_index &gt;= is-&gt;audio_buf_size) {
      <span class="hljs-comment">/* We have already sent all our data; get more */</span>
      audio_size = audio_decode_frame(is, is-&gt;audio_buf, <span class="hljs-keyword">sizeof</span>(is-&gt;audio_buf), &amp;pts);
      <span class="hljs-keyword">if</span>(audio_size &lt; <span class="hljs-number">0</span>) {
	<span class="hljs-comment">/* If error, output silence */</span>
	is-&gt;audio_buf_size = <span class="hljs-number">1024</span>;
	<span class="hljs-built_in">memset</span>(is-&gt;audio_buf, <span class="hljs-number">0</span>, is-&gt;audio_buf_size);<font></font>
      } <span class="hljs-keyword">else</span> {<font></font>
	audio_size = synchronize_audio(is, (<span class="hljs-keyword">int16_t</span> *)is-&gt;audio_buf,<font></font>
				       audio_size, pts);<font></font>
	is-&gt;audio_buf_size = audio_size;<font></font>
      }<font></font>
      is-&gt;audio_buf_index = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
    len1 = is-&gt;audio_buf_size - is-&gt;audio_buf_index;<font></font>
    <span class="hljs-keyword">if</span>(len1 &gt; len)<font></font>
      len1 = len;<font></font>
    <span class="hljs-built_in">memcpy</span>(stream, (<span class="hljs-keyword">uint8_t</span> *)is-&gt;audio_buf + is-&gt;audio_buf_index, len1);<font></font>
    len -= len1;<font></font>
    stream += len1;<font></font>
    is-&gt;audio_buf_index += len1;<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> Uint32 <span class="hljs-title">sdl_refresh_timer_cb</span><span class="hljs-params">(Uint32 interval, <span class="hljs-keyword">void</span> *opaque)</span> </span>{<font></font>
  SDL_Event event;<font></font>
  event.type = FF_REFRESH_EVENT;<font></font>
  event.user.data1 = opaque;<font></font>
  SDL_PushEvent(&amp;event);<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <span class="hljs-comment">/* 0 means stop timer */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* schedule a video refresh in 'delay' ms */</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">schedule_refresh</span><span class="hljs-params">(VideoState *is, <span class="hljs-keyword">int</span> delay)</span> </span>{<font></font>
  SDL_AddTimer(delay, sdl_refresh_timer_cb, is);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">video_display</span><span class="hljs-params">(VideoState *is)</span> </span>{<font></font>
<font></font>
  SDL_Rect rect;<font></font>
  VideoPicture *vp;<font></font>
  <span class="hljs-keyword">float</span> aspect_ratio;
  <span class="hljs-keyword">int</span> w, h, x, y;
  <span class="hljs-keyword">int</span> i;<font></font>
<font></font>
  vp = &amp;is-&gt;pictq[is-&gt;pictq_rindex];<font></font>
  <span class="hljs-keyword">if</span>(vp-&gt;bmp) {
    <span class="hljs-keyword">if</span>(is-&gt;video_ctx-&gt;sample_aspect_ratio.num == <span class="hljs-number">0</span>) {<font></font>
      aspect_ratio = <span class="hljs-number">0</span>;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      aspect_ratio = av_q2d(is-&gt;video_ctx-&gt;sample_aspect_ratio) *<font></font>
	is-&gt;video_ctx-&gt;width / is-&gt;video_ctx-&gt;height;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(aspect_ratio &lt;= <span class="hljs-number">0.0</span>) {<font></font>
      aspect_ratio = (<span class="hljs-keyword">float</span>)is-&gt;video_ctx-&gt;width /<font></font>
	(<span class="hljs-keyword">float</span>)is-&gt;video_ctx-&gt;height;<font></font>
    }<font></font>
    h = screen-&gt;h;<font></font>
    w = ((<span class="hljs-keyword">int</span>)rint(h * aspect_ratio)) &amp; <span class="hljs-number">-3</span>;
    <span class="hljs-keyword">if</span>(w &gt; screen-&gt;w) {<font></font>
      w = screen-&gt;w;<font></font>
      h = ((<span class="hljs-keyword">int</span>)rint(w / aspect_ratio)) &amp; <span class="hljs-number">-3</span>;<font></font>
    }<font></font>
    x = (screen-&gt;w - w) / <span class="hljs-number">2</span>;<font></font>
    y = (screen-&gt;h - h) / <span class="hljs-number">2</span>;<font></font>
    <font></font>
    rect.x = x;<font></font>
    rect.y = y;<font></font>
    rect.w = w;<font></font>
    rect.h = h;<font></font>
    SDL_LockMutex(screen_mutex);<font></font>
    SDL_DisplayYUVOverlay(vp-&gt;bmp, &amp;rect);<font></font>
    SDL_UnlockMutex(screen_mutex);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">video_refresh_timer</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *userdata)</span> </span>{<font></font>
<font></font>
  VideoState *is = (VideoState *)userdata;<font></font>
  VideoPicture *vp;<font></font>
  <span class="hljs-keyword">double</span> actual_delay, delay, sync_threshold, ref_clock, diff;<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>(is-&gt;video_st) {
    <span class="hljs-keyword">if</span>(is-&gt;pictq_size == <span class="hljs-number">0</span>) {<font></font>
      schedule_refresh(is, <span class="hljs-number">1</span>);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      vp = &amp;is-&gt;pictq[is-&gt;pictq_rindex];<font></font>
      <font></font>
      is-&gt;video_current_pts = vp-&gt;pts;<font></font>
      is-&gt;video_current_pts_time = av_gettime();<font></font>
      delay = vp-&gt;pts - is-&gt;frame_last_pts; <span class="hljs-comment">/* the pts from last time */</span>
      <span class="hljs-keyword">if</span>(delay &lt;= <span class="hljs-number">0</span> || delay &gt;= <span class="hljs-number">1.0</span>) {
	<span class="hljs-comment">/* if incorrect delay, use previous one */</span><font></font>
	delay = is-&gt;frame_last_delay;<font></font>
      }<font></font>
      <span class="hljs-comment">/* save for next time */</span><font></font>
      is-&gt;frame_last_delay = delay;<font></font>
      is-&gt;frame_last_pts = vp-&gt;pts;<font></font>
<font></font>
<font></font>
<font></font>
      <span class="hljs-comment">/* update delay to sync to audio if not master source */</span>
      <span class="hljs-keyword">if</span>(is-&gt;av_sync_type != AV_SYNC_VIDEO_MASTER) {<font></font>
	ref_clock = get_master_clock(is);<font></font>
	diff = vp-&gt;pts - ref_clock;<font></font>
	<font></font>
	<span class="hljs-comment">/* Skip or repeat the frame. Take delay into account
	   FFPlay still doesn't "know if this is the best guess." */</span><font></font>
	sync_threshold = (delay &gt; AV_SYNC_THRESHOLD) ? delay : AV_SYNC_THRESHOLD;<font></font>
	<span class="hljs-keyword">if</span>(<span class="hljs-built_in">fabs</span>(diff) &lt; AV_NOSYNC_THRESHOLD) {
	  <span class="hljs-keyword">if</span>(diff &lt;= -sync_threshold) {<font></font>
	    delay = <span class="hljs-number">0</span>;<font></font>
	  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(diff &gt;= sync_threshold) {<font></font>
	    delay = <span class="hljs-number">2</span> * delay;<font></font>
	  }<font></font>
	}<font></font>
      }<font></font>
      is-&gt;frame_timer += delay;<font></font>
      <span class="hljs-comment">/* computer the REAL delay */</span>
      actual_delay = is-&gt;frame_timer - (av_gettime() / <span class="hljs-number">1000000.0</span>);
      <span class="hljs-keyword">if</span>(actual_delay &lt; <span class="hljs-number">0.010</span>) {
	<span class="hljs-comment">/* Really it should skip the picture instead */</span>
	actual_delay = <span class="hljs-number">0.010</span>;<font></font>
      }<font></font>
      schedule_refresh(is, (<span class="hljs-keyword">int</span>)(actual_delay * <span class="hljs-number">1000</span> + <span class="hljs-number">0.5</span>));<font></font>
      <font></font>
      <span class="hljs-comment">/* show the picture! */</span><font></font>
      video_display(is);<font></font>
      <font></font>
      <span class="hljs-comment">/* update queue for next picture! */</span>
      <span class="hljs-keyword">if</span>(++is-&gt;pictq_rindex == VIDEO_PICTURE_QUEUE_SIZE) {<font></font>
	is-&gt;pictq_rindex = <span class="hljs-number">0</span>;<font></font>
      }<font></font>
      SDL_LockMutex(is-&gt;pictq_mutex);<font></font>
      is-&gt;pictq_size--;<font></font>
      SDL_CondSignal(is-&gt;pictq_cond);<font></font>
      SDL_UnlockMutex(is-&gt;pictq_mutex);<font></font>
    }<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    schedule_refresh(is, <span class="hljs-number">100</span>);<font></font>
  }<font></font>
}<font></font>
      <font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">alloc_picture</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *userdata)</span> </span>{<font></font>
<font></font>
  VideoState *is = (VideoState *)userdata;<font></font>
  VideoPicture *vp;<font></font>
<font></font>
  vp = &amp;is-&gt;pictq[is-&gt;pictq_windex];<font></font>
  <span class="hljs-keyword">if</span>(vp-&gt;bmp) {
    <span class="hljs-comment">// we already have one make another, bigger/smaller</span><font></font>
    SDL_FreeYUVOverlay(vp-&gt;bmp);<font></font>
  }<font></font>
  <span class="hljs-comment">// Allocate a place to put our YUV image on that screen</span><font></font>
  SDL_LockMutex(screen_mutex);<font></font>
  vp-&gt;bmp = SDL_CreateYUVOverlay(is-&gt;video_ctx-&gt;width,<font></font>
				 is-&gt;video_ctx-&gt;height,<font></font>
				 SDL_YV12_OVERLAY,<font></font>
				 screen);<font></font>
  SDL_UnlockMutex(screen_mutex);<font></font>
<font></font>
  vp-&gt;width = is-&gt;video_ctx-&gt;width;<font></font>
  vp-&gt;height = is-&gt;video_ctx-&gt;height;<font></font>
  vp-&gt;allocated = <span class="hljs-number">1</span>;<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">queue_picture</span><span class="hljs-params">(VideoState *is, AVFrame *pFrame, <span class="hljs-keyword">double</span> pts)</span> </span>{<font></font>
<font></font>
  VideoPicture *vp;<font></font>
  <span class="hljs-keyword">int</span> dst_pix_fmt;<font></font>
  AVPicture pict;<font></font>
<font></font>
  <span class="hljs-comment">/* wait until we have space for a new pic */</span><font></font>
  SDL_LockMutex(is-&gt;pictq_mutex);<font></font>
  <span class="hljs-keyword">while</span>(is-&gt;pictq_size &gt;= VIDEO_PICTURE_QUEUE_SIZE &amp;&amp;<font></font>
	!is-&gt;quit) {<font></font>
    SDL_CondWait(is-&gt;pictq_cond, is-&gt;pictq_mutex);<font></font>
  }<font></font>
  SDL_UnlockMutex(is-&gt;pictq_mutex);<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(is-&gt;quit)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
<font></font>
  <span class="hljs-comment">// windex is set to 0 initially</span><font></font>
  vp = &amp;is-&gt;pictq[is-&gt;pictq_windex];<font></font>
<font></font>
  <span class="hljs-comment">/* allocate or resize the buffer! */</span>
  <span class="hljs-keyword">if</span>(!vp-&gt;bmp ||<font></font>
     vp-&gt;width != is-&gt;video_ctx-&gt;width ||<font></font>
     vp-&gt;height != is-&gt;video_ctx-&gt;height) {<font></font>
    SDL_Event event;<font></font>
<font></font>
    vp-&gt;allocated = <span class="hljs-number">0</span>;<font></font>
    alloc_picture(is);<font></font>
    <span class="hljs-keyword">if</span>(is-&gt;quit) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">/* We have a place to put our picture on the queue */</span><font></font>
<font></font>
  <span class="hljs-keyword">if</span>(vp-&gt;bmp) {<font></font>
<font></font>
    SDL_LockYUVOverlay(vp-&gt;bmp);<font></font>
    vp-&gt;pts = pts;<font></font>
    <font></font>
    dst_pix_fmt = PIX_FMT_YUV420P;<font></font>
    <span class="hljs-comment">/* point pict at the queue */</span><font></font>
<font></font>
    pict.data[<span class="hljs-number">0</span>] = vp-&gt;bmp-&gt;pixels[<span class="hljs-number">0</span>];<font></font>
    pict.data[<span class="hljs-number">1</span>] = vp-&gt;bmp-&gt;pixels[<span class="hljs-number">2</span>];<font></font>
    pict.data[<span class="hljs-number">2</span>] = vp-&gt;bmp-&gt;pixels[<span class="hljs-number">1</span>];<font></font>
    <font></font>
    pict.linesize[<span class="hljs-number">0</span>] = vp-&gt;bmp-&gt;pitches[<span class="hljs-number">0</span>];<font></font>
    pict.linesize[<span class="hljs-number">1</span>] = vp-&gt;bmp-&gt;pitches[<span class="hljs-number">2</span>];<font></font>
    pict.linesize[<span class="hljs-number">2</span>] = vp-&gt;bmp-&gt;pitches[<span class="hljs-number">1</span>];<font></font>
    <font></font>
    <span class="hljs-comment">// Convert the image into YUV format that SDL uses</span>
    sws_scale(is-&gt;sws_ctx, (<span class="hljs-keyword">uint8_t</span> <span class="hljs-keyword">const</span> * <span class="hljs-keyword">const</span> *)pFrame-&gt;data,<font></font>
	      pFrame-&gt;linesize, <span class="hljs-number">0</span>, is-&gt;video_ctx-&gt;height,<font></font>
	      pict.data, pict.linesize);<font></font>
    <font></font>
    SDL_UnlockYUVOverlay(vp-&gt;bmp);<font></font>
    <span class="hljs-comment">/* now we inform our display thread that we have a pic ready */</span>
    <span class="hljs-keyword">if</span>(++is-&gt;pictq_windex == VIDEO_PICTURE_QUEUE_SIZE) {<font></font>
      is-&gt;pictq_windex = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
    SDL_LockMutex(is-&gt;pictq_mutex);<font></font>
    is-&gt;pictq_size++;<font></font>
    SDL_UnlockMutex(is-&gt;pictq_mutex);<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">synchronize_video</span><span class="hljs-params">(VideoState *is, AVFrame *src_frame, <span class="hljs-keyword">double</span> pts)</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">double</span> frame_delay;<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(pts != <span class="hljs-number">0</span>) {
    <span class="hljs-comment">/* if we have pts, set video clock to it */</span><font></font>
    is-&gt;video_clock = pts;<font></font>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">/* if we aren't given a pts, set it to the clock */</span><font></font>
    pts = is-&gt;video_clock;<font></font>
  }<font></font>
  <span class="hljs-comment">/* update the video clock */</span><font></font>
  frame_delay = av_q2d(is-&gt;video_ctx-&gt;time_base);<font></font>
  <span class="hljs-comment">/* if we are repeating a frame, adjust clock accordingly */</span>
  frame_delay += src_frame-&gt;repeat_pict * (frame_delay * <span class="hljs-number">0.5</span>);<font></font>
  is-&gt;video_clock += frame_delay;<font></font>
  <span class="hljs-keyword">return</span> pts;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">video_thread</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span> </span>{<font></font>
  VideoState *is = (VideoState *)arg;<font></font>
  AVPacket pkt1, *packet = &amp;pkt1;<font></font>
  <span class="hljs-keyword">int</span> frameFinished;<font></font>
  AVFrame *pFrame;<font></font>
  <span class="hljs-keyword">double</span> pts;<font></font>
<font></font>
  pFrame = av_frame_alloc();<font></font>
<font></font>
  <span class="hljs-keyword">for</span>(;;) {
    <span class="hljs-keyword">if</span>(packet_queue_get(&amp;is-&gt;videoq, packet, <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-comment">// means we quit getting packets</span>
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(packet_queue_get(&amp;is-&gt;videoq, packet, <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-comment">// means we quit getting packets</span>
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
    pts = <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-comment">// Decode video frame</span><font></font>
    avcodec_decode_video2(is-&gt;video_ctx, pFrame, &amp;frameFinished, packet);<font></font>
<font></font>
    <span class="hljs-keyword">if</span>((pts = av_frame_get_best_effort_timestamp(pFrame)) == AV_NOPTS_VALUE) {<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      pts = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
    pts *= av_q2d(is-&gt;video_st-&gt;time_base);<font></font>
<font></font>
    <span class="hljs-comment">// Did we get a video frame?</span>
    <span class="hljs-keyword">if</span>(frameFinished) {<font></font>
      pts = synchronize_video(is, pFrame, pts);<font></font>
      <span class="hljs-keyword">if</span>(queue_picture(is, pFrame, pts) &lt; <span class="hljs-number">0</span>) {
	<span class="hljs-keyword">break</span>;<font></font>
      }<font></font>
    }<font></font>
    av_free_packet(packet);<font></font>
  }<font></font>
  av_frame_free(&amp;pFrame);<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">stream_component_open</span><span class="hljs-params">(VideoState *is, <span class="hljs-keyword">int</span> stream_index)</span> </span>{<font></font>
<font></font>
  AVFormatContext *pFormatCtx = is-&gt;pFormatCtx;<font></font>
  AVCodecContext *codecCtx = <span class="hljs-literal">NULL</span>;<font></font>
  AVCodec *codec = <span class="hljs-literal">NULL</span>;<font></font>
  SDL_AudioSpec wanted_spec, spec;<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(stream_index &lt; <span class="hljs-number">0</span> || stream_index &gt;= pFormatCtx-&gt;nb_streams) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
<font></font>
  codec = avcodec_find_decoder(pFormatCtx-&gt;streams[stream_index]-&gt;codec-&gt;codec_id);<font></font>
  <span class="hljs-keyword">if</span>(!codec) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unsupported codec!\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
<font></font>
  codecCtx = avcodec_alloc_context3(codec);<font></font>
  <span class="hljs-keyword">if</span>(avcodec_copy_context(codecCtx, pFormatCtx-&gt;streams[stream_index]-&gt;codec) != <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Couldn't copy codec context"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Error copying codec context</span><font></font>
  }<font></font>
<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(codecCtx-&gt;codec_type == AVMEDIA_TYPE_AUDIO) {
    <span class="hljs-comment">// Set audio settings from codec info</span><font></font>
    wanted_spec.freq = codecCtx-&gt;sample_rate;<font></font>
    wanted_spec.format = AUDIO_S16SYS;<font></font>
    wanted_spec.channels = codecCtx-&gt;channels;<font></font>
    wanted_spec.silence = <span class="hljs-number">0</span>;<font></font>
    wanted_spec.samples = SDL_AUDIO_BUFFER_SIZE;<font></font>
    wanted_spec.callback = audio_callback;<font></font>
    wanted_spec.userdata = is;<font></font>
    <font></font>
    <span class="hljs-keyword">if</span>(SDL_OpenAudio(&amp;wanted_spec, &amp;spec) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"SDL_OpenAudio: %s\n"</span>, SDL_GetError());
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
    is-&gt;audio_hw_buf_size = spec.size;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span>(avcodec_open2(codecCtx, codec, <span class="hljs-literal">NULL</span>) &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unsupported codec!\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">switch</span>(codecCtx-&gt;codec_type) {
  <span class="hljs-keyword">case</span> AVMEDIA_TYPE_AUDIO:<font></font>
    is-&gt;audioStream = stream_index;<font></font>
    is-&gt;audio_st = pFormatCtx-&gt;streams[stream_index];<font></font>
    is-&gt;audio_ctx = codecCtx;<font></font>
    is-&gt;audio_buf_size = <span class="hljs-number">0</span>;<font></font>
    is-&gt;audio_buf_index = <span class="hljs-number">0</span>;
    <span class="hljs-built_in">memset</span>(&amp;is-&gt;audio_pkt, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(is-&gt;audio_pkt));<font></font>
    packet_queue_init(&amp;is-&gt;audioq);<font></font>
    SDL_PauseAudio(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> AVMEDIA_TYPE_VIDEO:<font></font>
    is-&gt;videoStream = stream_index;<font></font>
    is-&gt;video_st = pFormatCtx-&gt;streams[stream_index];<font></font>
    is-&gt;video_ctx = codecCtx;<font></font>
<font></font>
    is-&gt;frame_timer = (<span class="hljs-keyword">double</span>)av_gettime() / <span class="hljs-number">1000000.0</span>;<font></font>
    is-&gt;frame_last_delay = <span class="hljs-number">40e-3</span>;<font></font>
    is-&gt;video_current_pts_time = av_gettime();<font></font>
<font></font>
    packet_queue_init(&amp;is-&gt;videoq);<font></font>
    is-&gt;video_tid = SDL_CreateThread(video_thread, is);<font></font>
    is-&gt;sws_ctx = sws_getContext(is-&gt;video_ctx-&gt;width, is-&gt;video_ctx-&gt;height,<font></font>
				 is-&gt;video_ctx-&gt;pix_fmt, is-&gt;video_ctx-&gt;width,<font></font>
				 is-&gt;video_ctx-&gt;height, PIX_FMT_YUV420P,<font></font>
				 SWS_BILINEAR, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span><font></font>
				 );<font></font>
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">default</span>:
    <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">decode_thread</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span> </span>{<font></font>
<font></font>
  VideoState *is = (VideoState *)arg;<font></font>
  AVFormatContext *pFormatCtx;<font></font>
  AVPacket pkt1, *packet = &amp;pkt1;<font></font>
<font></font>
  <span class="hljs-keyword">int</span> video_index = <span class="hljs-number">-1</span>;
  <span class="hljs-keyword">int</span> audio_index = <span class="hljs-number">-1</span>;
  <span class="hljs-keyword">int</span> i;<font></font>
<font></font>
  is-&gt;videoStream=<span class="hljs-number">-1</span>;<font></font>
  is-&gt;audioStream=<span class="hljs-number">-1</span>;<font></font>
<font></font>
  global_video_state = is;<font></font>
<font></font>
  <span class="hljs-comment">// Open video file</span>
  <span class="hljs-keyword">if</span>(avformat_open_input(&amp;pFormatCtx, is-&gt;filename, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>)!=<span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Couldn't open file</span><font></font>
<font></font>
  is-&gt;pFormatCtx = pFormatCtx;<font></font>
  <font></font>
  <span class="hljs-comment">// Retrieve stream information</span>
  <span class="hljs-keyword">if</span>(avformat_find_stream_info(pFormatCtx, <span class="hljs-literal">NULL</span>)&lt;<span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Couldn't find stream information</span><font></font>
  <font></font>
  <span class="hljs-comment">// Dump information about file onto standard error</span>
  av_dump_format(pFormatCtx, <span class="hljs-number">0</span>, is-&gt;filename, <span class="hljs-number">0</span>);<font></font>
  <font></font>
  <span class="hljs-comment">// Find the first video stream</span><font></font>
<font></font>
  <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;pFormatCtx-&gt;nb_streams; i++) {
    <span class="hljs-keyword">if</span>(pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type==AVMEDIA_TYPE_VIDEO &amp;&amp;<font></font>
       video_index &lt; <span class="hljs-number">0</span>) {<font></font>
      video_index=i;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type==AVMEDIA_TYPE_AUDIO &amp;&amp;<font></font>
       audio_index &lt; <span class="hljs-number">0</span>) {<font></font>
      audio_index=i;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span>(audio_index &gt;= <span class="hljs-number">0</span>) {<font></font>
    stream_component_open(is, audio_index);<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span>(video_index &gt;= <span class="hljs-number">0</span>) {<font></font>
    stream_component_open(is, video_index);<font></font>
  }   <font></font>
<font></font>
  <span class="hljs-keyword">if</span>(is-&gt;videoStream &lt; <span class="hljs-number">0</span> || is-&gt;audioStream &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"%s: could not open codecs\n"</span>, is-&gt;filename);
    <span class="hljs-keyword">goto</span> fail;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// main decode loop</span><font></font>
<font></font>
  <span class="hljs-keyword">for</span>(;;) {
    <span class="hljs-keyword">if</span>(is-&gt;quit) {
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
    <span class="hljs-comment">// seek stuff goes here</span>
    <span class="hljs-keyword">if</span>(is-&gt;audioq.size &gt; MAX_AUDIOQ_SIZE ||<font></font>
       is-&gt;videoq.size &gt; MAX_VIDEOQ_SIZE) {<font></font>
      SDL_Delay(<span class="hljs-number">10</span>);
      <span class="hljs-keyword">continue</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(av_read_frame(is-&gt;pFormatCtx, packet) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">if</span>(is-&gt;pFormatCtx-&gt;pb-&gt;error == <span class="hljs-number">0</span>) {<font></font>
	SDL_Delay(<span class="hljs-number">100</span>); <span class="hljs-comment">/* no error; wait for user input */</span>
	<span class="hljs-keyword">continue</span>;<font></font>
      } <span class="hljs-keyword">else</span> {
	<span class="hljs-keyword">break</span>;<font></font>
      }<font></font>
    }<font></font>
    <span class="hljs-comment">// Is this a packet from the video stream?</span>
    <span class="hljs-keyword">if</span>(packet-&gt;stream_index == is-&gt;videoStream) {<font></font>
      packet_queue_put(&amp;is-&gt;videoq, packet);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(packet-&gt;stream_index == is-&gt;audioStream) {<font></font>
      packet_queue_put(&amp;is-&gt;audioq, packet);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      av_free_packet(packet);<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-comment">/* all done - wait for it */</span>
  <span class="hljs-keyword">while</span>(!is-&gt;quit) {<font></font>
    SDL_Delay(<span class="hljs-number">100</span>);<font></font>
  }<font></font>
<font></font>
 fail:<font></font>
  <span class="hljs-keyword">if</span>(<span class="hljs-number">1</span>){<font></font>
    SDL_Event event;<font></font>
    event.type = FF_QUIT_EVENT;<font></font>
    event.user.data1 = is;<font></font>
    SDL_PushEvent(&amp;event);<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span> </span>{<font></font>
<font></font>
  SDL_Event       event;<font></font>
<font></font>
  VideoState      *is;<font></font>
<font></font>
  is = av_mallocz(<span class="hljs-keyword">sizeof</span>(VideoState));<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(argc &lt; <span class="hljs-number">2</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Usage: test &lt;file&gt;\n"</span>);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<font></font>
  }<font></font>
  <span class="hljs-comment">// Register all formats and codecs</span><font></font>
  av_register_all();<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>(SDL_Init(SDL_INIT_VIDEO | SDL_INIT_AUDIO | SDL_INIT_TIMER)) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Could not initialize SDL - %s\n"</span>, SDL_GetError());
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// Make a screen to put our video</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> __DARWIN__</span>
        screen = SDL_SetVideoMode(<span class="hljs-number">640</span>, <span class="hljs-number">480</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
        screen = SDL_SetVideoMode(<span class="hljs-number">640</span>, <span class="hljs-number">480</span>, <span class="hljs-number">24</span>, <span class="hljs-number">0</span>);
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
  <span class="hljs-keyword">if</span>(!screen) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"SDL: could not set video mode - exiting\n"</span>);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<font></font>
  }<font></font>
<font></font>
  screen_mutex = SDL_CreateMutex();<font></font>
<font></font>
  av_strlcpy(is-&gt;filename, argv[<span class="hljs-number">1</span>], <span class="hljs-keyword">sizeof</span>(is-&gt;filename));<font></font>
<font></font>
  is-&gt;pictq_mutex = SDL_CreateMutex();<font></font>
  is-&gt;pictq_cond = SDL_CreateCond();<font></font>
<font></font>
  schedule_refresh(is, <span class="hljs-number">40</span>);<font></font>
<font></font>
  is-&gt;av_sync_type = DEFAULT_AV_SYNC_TYPE;<font></font>
  is-&gt;parse_tid = SDL_CreateThread(decode_thread, is);<font></font>
  <span class="hljs-keyword">if</span>(!is-&gt;parse_tid) {<font></font>
    av_free(is);<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">for</span>(;;) {<font></font>
<font></font>
    SDL_WaitEvent(&amp;event);<font></font>
    <span class="hljs-keyword">switch</span>(event.type) {
    <span class="hljs-keyword">case</span> FF_QUIT_EVENT:
    <span class="hljs-keyword">case</span> SDL_QUIT:<font></font>
      is-&gt;quit = <span class="hljs-number">1</span>;<font></font>
      SDL_Quit();<font></font>
      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> FF_REFRESH_EVENT:<font></font>
      video_refresh_timer(event.user.data1);<font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">default</span>:
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre></div>
                    </div><br>
<h3> </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå·®ä¸å¤šçš„æ’­æ”¾å™¨ç”šè‡³å¯ä»¥çœ‹ç”µå½±äº†ï¼Œç°åœ¨è®©æˆ‘ä»¬æ”¶æ”¯å¹³è¡¡ã€‚</font><font style="vertical-align: inherit;">ä¸Šæ¬¡ï¼Œæˆ‘ä»¬ç•¥å¾®è°ˆåˆ°äº†åŒæ­¥ï¼Œå³å£°éŸ³å’Œè§†é¢‘çš„åŒæ­¥ï¼Œä»¥è¿™ç§é¡ºåºè¿›è¡Œï¼Œè€Œä¸æ˜¯ç›¸åã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä½¿è¯¥å¸ƒå±€ä¸è§†é¢‘ç›¸åŒï¼šåˆ¶ä½œä¸€ä¸ªå†…éƒ¨è§†é¢‘æ—¶é’Ÿä»¥è·Ÿè¸ªè§†é¢‘æµçš„è¿œè¿‘å¹¶ä¸ä¹‹åŒæ­¥éŸ³é¢‘ã€‚</font><font style="vertical-align: inherit;">ç¨åï¼Œæˆ‘ä»¬å°†è¿›ä¸€æ­¥æ¨å¹¿â€”å°†éŸ³é¢‘å’Œè§†é¢‘ä¸å¤–éƒ¨æ—¶é’ŸåŒæ­¥ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è§†é¢‘æ—¶é’Ÿå®ç°</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæˆ‘ä»¬è¦åˆ¶ä½œä¸€ä¸ªä¸ä¸Šæ¬¡éŸ³é¢‘æ—¶é’Ÿç±»ä¼¼çš„è§†é¢‘æ—¶é’Ÿï¼šä¸€ä¸ªå†…éƒ¨å€¼ï¼Œè¯¥å€¼è¿”å›å½“å‰æ’­æ”¾è§†é¢‘çš„å½“å‰æ—¶é—´åç§»ã€‚æ‚¨å¯èƒ½ä¼šè®¤ä¸ºï¼Œè¿™å°±åƒç”¨</font><font style="vertical-align: inherit;">æ˜¾ç¤º</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åä¸€å¸§</font><font style="vertical-align: inherit;">çš„å½“å‰</font><b><font style="vertical-align: inherit;">PTS</font></b><font style="vertical-align: inherit;">æ›´æ–°è®¡æ—¶å™¨ä¸€æ ·ç®€å•</font><font style="vertical-align: inherit;">ã€‚ä½†æ˜¯ï¼Œè¯·ä¸è¦å¿˜è®°ï¼Œå¦‚æœæˆ‘ä»¬é™ä½åˆ°æ¯«ç§’çº§åˆ«ï¼Œåˆ™è§†é¢‘å¸§ä¹‹é—´çš„æ—¶é—´å¯èƒ½å¤ªé•¿ã€‚å› æ­¤ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯è·Ÿè¸ªå¦ä¸€ä¸ªå€¼ï¼Œå³æˆ‘ä»¬</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åä¸€å¸§</font><font style="vertical-align: inherit;">çš„</font><b><font style="vertical-align: inherit;">PTS</font></b><font style="vertical-align: inherit;">ä¸Šè®¾ç½®è§†é¢‘æ—¶é’Ÿçš„æ—¶é—´</font><font style="vertical-align: inherit;">ã€‚å› æ­¤ï¼Œè§†é¢‘</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ—¶é’Ÿ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„å½“å‰å€¼å°†ä¸º</font><b><font style="vertical-align: inherit;">PTS_of_last_frame</font></b><font style="vertical-align: inherit;"> +ï¼ˆ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">current_time</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">time_elapsed_since_PTS_value_was_set</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰</font><font style="vertical-align: inherit;">è¿™ä¸ªè§£å†³æ–¹æ¡ˆä¸æˆ‘ä»¬å¯¹</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_audio_clock</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰€åšçš„éå¸¸ç›¸ä¼¼</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å› æ­¤ï¼Œåœ¨æˆ‘ä»¬æˆç†Ÿçš„ç»“æ„ä¸­ï¼Œæˆ‘ä»¬å°†æ”¾ç½®</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">double video_current_pts</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int64_t video_current_pts_time</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æ—¶é’Ÿå°†åœ¨</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">video_refresh_timer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡½æ•°ä¸­æ›´æ–°</font><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">video_refresh_timer</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *userdata)</span> </span>{<font></font>
<font></font>
  <span class="hljs-comment">/* ... */</span><font></font>
<font></font>
  <span class="hljs-keyword">if</span>(is-&gt;video_st) {
    <span class="hljs-keyword">if</span>(is-&gt;pictq_size == <span class="hljs-number">0</span>) {<font></font>
      schedule_refresh(is, <span class="hljs-number">1</span>);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      vp = &amp;is-&gt;pictq[is-&gt;pictq_rindex];<font></font>
<font></font>
      is-&gt;video_current_pts = vp-&gt;pts;<font></font>
      is-&gt;video_current_pts_time = av_gettime();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸è¦å¿˜è®°åœ¨</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stream_component_openä¸­</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆå§‹åŒ–å®ƒ</font><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs">is-&gt;video_current_pts_time = av_gettime();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯æŸç§è·å–ä¿¡æ¯çš„æ–¹æ³•ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">get_video_clock</span><span class="hljs-params">(VideoState *is)</span> </span>{
  <span class="hljs-keyword">double</span> delta;<font></font>
<font></font>
  delta = (av_gettime() - is-&gt;video_current_pts_time) / <span class="hljs-number">1000000.0</span>;
  <span class="hljs-keyword">return</span> is-&gt;video_current_pts + delta;<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»æ‰‹è¡¨ä¸­æå–</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯ï¼Œä¸ºä»€ä¹ˆè¦å¼ºè¿«è‡ªå·±ä½¿ç”¨è§†é¢‘æ—¶é’Ÿå‘¢ï¼Ÿ</font><font style="vertical-align: inherit;">æ‚¨å¯ä»¥èµ°å¾—æ›´è¿œï¼Œæ›´æ”¹æˆ‘ä»¬çš„è§†é¢‘åŒæ­¥ä»£ç ï¼Œä»¥ä½¿éŸ³é¢‘å’Œè§†é¢‘ä¸ä¼šå°è¯•å½¼æ­¤åŒæ­¥ã€‚</font><font style="vertical-align: inherit;">æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬å°è¯•ä½¿ç”¨FFplayè¿™æ ·çš„å‘½ä»¤è¡Œé€‰é¡¹æ¥è¿›è¡Œæ“ä½œï¼Œé‚£å°†ä¼šæ˜¯ä¸€å›¢ç³Ÿã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œè®©æˆ‘ä»¬æŠ½è±¡ä¸€ä¸‹ï¼šæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ–°çš„åŒ…è£…å‡½æ•°</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_master_clock</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè¯¥</font><font style="vertical-align: inherit;">å‡½æ•°</font><font style="vertical-align: inherit;">æ£€æŸ¥å˜é‡</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_sync_type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œç„¶åè°ƒç”¨</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_audio_clock</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_video_clock</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ–å¯ä»¥ä½¿ç”¨å®ƒçš„ä»»ä½•å…¶ä»–æ—¶é’Ÿã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ç”šè‡³å¯ä»¥ä½¿ç”¨è®¡ç®—æœºæ—¶é’Ÿï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_external_clock</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">enum</span> {<font></font>
  AV_SYNC_AUDIO_MASTER,<font></font>
  AV_SYNC_VIDEO_MASTER,<font></font>
  AV_SYNC_EXTERNAL_MASTER,<font></font>
};<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEFAULT_AV_SYNC_TYPE AV_SYNC_VIDEO_MASTER</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">get_master_clock</span><span class="hljs-params">(VideoState *is)</span> </span>{
  <span class="hljs-keyword">if</span>(is-&gt;av_sync_type == AV_SYNC_VIDEO_MASTER) {
    <span class="hljs-keyword">return</span> get_video_clock(is);<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(is-&gt;av_sync_type == AV_SYNC_AUDIO_MASTER) {
    <span class="hljs-keyword">return</span> get_audio_clock(is);<font></font>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> get_external_clock(is);<font></font>
  }<font></font>
}<font></font>
main() {<font></font>
...<font></font>
  is-&gt;av_sync_type = DEFAULT_AV_SYNC_TYPE;<font></font>
...<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éŸ³é¢‘åŒæ­¥</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨æœ€å›°éš¾çš„éƒ¨åˆ†æ˜¯ï¼šå°†éŸ³é¢‘ä¸è§†é¢‘æ—¶é’ŸåŒæ­¥ã€‚æˆ‘ä»¬çš„ç­–ç•¥æ˜¯æµ‹é‡éŸ³é¢‘çš„ä½ç½®ï¼Œå°†å…¶ä¸è§†é¢‘æ—¶é’Ÿè¿›è¡Œæ¯”è¾ƒï¼Œç„¶åæ‰¾å‡ºéœ€è¦è°ƒæ•´çš„æ ·æœ¬æ•°é‡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ˜¯å¦éœ€è¦é€šè¿‡åˆ é™¤æ ·æœ¬æ¥åŠ å¿«é‡‡æ ·é€Ÿåº¦æˆ–é€šè¿‡æ·»åŠ æ ·æœ¬æ¥é™ä½é‡‡æ ·é€Ÿåº¦ï¼Ÿ</font><font style="vertical-align: inherit;">æ¯æ¬¡å¤„ç†è·å¾—çš„æ¯ç»„éŸ³é¢‘æ ·æœ¬æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼š</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿è¡Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">syncnize_audio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡½æ•°</font><font style="vertical-align: inherit;">ï¼Œä»¥é€‚å½“åœ°å‡å°‘æˆ–å¢åŠ è¯¥ç»„éŸ³é¢‘æ ·æœ¬ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›ä¸€ç›´ä¿æŒåŒæ­¥ï¼Œå› ä¸ºéŸ³é¢‘å¤„ç†æ¯”å¤„ç†è§†é¢‘æ•°æ®åŒ…è¦é¢‘ç¹å¾—å¤šã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†è®¾ç½®å¯¹</font><b><font style="vertical-align: inherit;">syncnize_audio</font></b><font style="vertical-align: inherit;">å‡½æ•°çš„è¿ç»­è°ƒç”¨çš„æœ€å°æ•°é‡</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æˆ‘ä»¬åšä»»ä½•äº‹æƒ…ä¹‹å‰ï¼Œå®ƒä»¬éƒ½è¢«è®¤ä¸ºæ˜¯ä¸åŒæ­¥çš„ã€‚å½“ç„¶ï¼Œä¸ä¸Šæ¬¡ä¸€æ ·ï¼Œâ€œä¸åŒæ­¥â€æ˜¯æŒ‡éŸ³é¢‘æ—¶é’Ÿå’Œè§†é¢‘æ—¶é’Ÿç›¸å·®å¤§äºåŒæ­¥é˜ˆå€¼çš„é‡ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‰€ä»¥æˆ‘ä»¬å°†ä½¿ç”¨åˆ†æ•°ç³»æ•°</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬å¾—åˆ°</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸åŒæ­¥çš„éŸ³é¢‘æ ·æœ¬é›†ã€‚æˆ‘ä»¬ä¸åŒæ­¥çš„æ ·æœ¬æ•°é‡ä¹Ÿå¯èƒ½ç›¸å·®å¾ˆå¤§ï¼Œå› æ­¤æˆ‘ä»¬å–æ¯ä¸ªæ ·æœ¬ä¸åŒæ­¥çš„å¹³å‡å€¼ã€‚ä¾‹å¦‚ï¼Œç¬¬ä¸€ä¸ªè°ƒç”¨å¯èƒ½è¡¨æ˜æˆ‘ä»¬åœ¨40æ¯«ç§’å†…æœªåŒæ­¥ï¼Œä¸‹ä¸€ä¸ª50æ¯«ç§’ï¼Œç­‰ç­‰ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸ä¼šé‡‡å–ç®€å•çš„æ–¹æ³•ï¼Œå› ä¸ºæœ€æ–°çš„ä»·å€¼è§‚æ¯”ä¹‹å‰çš„ä»·å€¼è§‚æ›´ä¸ºé‡è¦ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åˆ†æ•°ç³»æ•°</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå¹¶å°†å·®å¼‚æ€»ç»“å¦‚ä¸‹ï¼š</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diff_sum</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">new_diff</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diff_sum</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚å‡†å¤‡å¥½æ±‚</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹³å‡å·®æ—¶</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œæˆ‘ä»¬åªéœ€è®¡ç®—</font><b><font style="vertical-align: inherit;">avg_diff</font></b><font style="vertical-align: inherit;"> =</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diff_sum</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> *ï¼ˆ1- </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ</font><font style="vertical-align: inherit;">æ–¹ç¨‹å¼çœ‹èµ·æ¥åƒæ˜¯ä¸€ç§é­”æœ¯ã€‚</font><font style="vertical-align: inherit;">å¥½å§ï¼Œè¿™åŸºæœ¬ä¸Šæ˜¯ä½¿ç”¨å‡ ä½•åºåˆ—ä½œä¸ºæƒé‡çš„åŠ æƒå¹³å‡å€¼ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä¸çŸ¥é“æ˜¯å¦æœ‰è¿™ä¸ªåç§°ï¼ˆæˆ‘ä»€è‡³åœ¨Wikipediaä¸Šæ£€æŸ¥è¿‡ï¼ï¼‰ï¼Œä½†æ˜¯æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è§£é‡Š</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆæˆ–è¿™é‡Œï¼š</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">weightedmean.txt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯æˆ‘ä»¬çš„å‡½æ•°ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* Add or subtract samples to get a better sync, return new
   audio buffer size */</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">synchronize_audio</span><span class="hljs-params">(VideoState *is, <span class="hljs-keyword">short</span> *samples,
		      <span class="hljs-keyword">int</span> samples_size, <span class="hljs-keyword">double</span> pts)</span> </span>{
  <span class="hljs-keyword">int</span> n;
  <span class="hljs-keyword">double</span> ref_clock;<font></font>
  <font></font>
  n = <span class="hljs-number">2</span> * is-&gt;audio_st-&gt;codec-&gt;channels;<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>(is-&gt;av_sync_type != AV_SYNC_AUDIO_MASTER) {
    <span class="hljs-keyword">double</span> diff, avg_diff;
    <span class="hljs-keyword">int</span> wanted_size, min_size, max_size, nb_samples;<font></font>
    <font></font>
    ref_clock = get_master_clock(is);<font></font>
    diff = get_audio_clock(is) - ref_clock;<font></font>
<font></font>
    <span class="hljs-keyword">if</span>(diff &lt; AV_NOSYNC_THRESHOLD) {
      <span class="hljs-comment">// accumulate the diffs</span><font></font>
      is-&gt;audio_diff_cum = diff + is-&gt;audio_diff_avg_coef<font></font>
	* is-&gt;audio_diff_cum;<font></font>
      <span class="hljs-keyword">if</span>(is-&gt;audio_diff_avg_count &lt; AUDIO_DIFF_AVG_NB) {<font></font>
	is-&gt;audio_diff_avg_count++;<font></font>
      } <span class="hljs-keyword">else</span> {<font></font>
	avg_diff = is-&gt;audio_diff_cum * (<span class="hljs-number">1.0</span> - is-&gt;audio_diff_avg_coef);<font></font>
<font></font>
       <span class="hljs-comment">/* Shrinking/expanding buffer code.... */</span><font></font>
<font></font>
      }<font></font>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">/* difference is TOO big; reset diff stuff */</span>
      is-&gt;audio_diff_avg_count = <span class="hljs-number">0</span>;<font></font>
      is-&gt;audio_diff_cum = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> samples_size;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‰€ä»¥æˆ‘ä»¬ä¸€åˆ‡éƒ½å¾ˆå¥½ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¤§æ¦‚çŸ¥é“å¤šå°‘å£°éŸ³ä¸è§†é¢‘æˆ–æˆ‘ä»¬ç”¨ä½œæ‰‹è¡¨çš„å£°éŸ³ä¸ä¸€è‡´ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œç°åœ¨è®©æˆ‘ä»¬å°†è¿™æ®µä»£ç æ”¾åœ¨â€œå‡å°‘/æ‰©å±•ç¼“å†²åŒºä»£ç â€éƒ¨åˆ†ä¸­ï¼Œä»¥è®¡ç®—éœ€è¦æ·»åŠ æˆ–ä¸¢å¼ƒçš„æ ·æœ¬æ•°é‡ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">if</span>(<span class="hljs-built_in">fabs</span>(avg_diff) &gt;= is-&gt;audio_diff_threshold) {<font></font>
  wanted_size = samples_size + <font></font>
  ((<span class="hljs-keyword">int</span>)(diff * is-&gt;audio_st-&gt;codec-&gt;sample_rate) * n);<font></font>
  min_size = samples_size * ((<span class="hljs-number">100</span> - SAMPLE_CORRECTION_PERCENT_MAX)<font></font>
                             / <span class="hljs-number">100</span>);<font></font>
  max_size = samples_size * ((<span class="hljs-number">100</span> + SAMPLE_CORRECTION_PERCENT_MAX) <font></font>
                             / <span class="hljs-number">100</span>);
  <span class="hljs-keyword">if</span>(wanted_size &lt; min_size) {<font></font>
    wanted_size = min_size;<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (wanted_size &gt; max_size) {<font></font>
    wanted_size = max_size;<font></font>
  }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯·è®°ä½ï¼Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audio_length</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> *ï¼ˆ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sample_rate</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šé“æ•°</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * 2ï¼‰æ˜¯</font><font style="vertical-align: inherit;">éŸ³é¢‘çš„</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audio_length</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§’çš„</font><font style="vertical-align: inherit;">é‡‡æ ·æ•°</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬æƒ³è¦çš„æ ·æœ¬æ•°é‡å°†ç­‰äºæˆ‘ä»¬å·²ç»æ‹¥æœ‰çš„æ ·æœ¬æ•°é‡ï¼ŒåŠ ä¸Šæˆ–å‡å»ä¸æ’­æ”¾å£°éŸ³çš„æ—¶é—´é‡ç›¸å¯¹åº”çš„æ ·æœ¬æ•°é‡ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬è¿˜å°†å¯¹æ ¡æ­£çš„å¤§å°è®¾ç½®ä¸€ä¸ªé™åˆ¶ï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬è¿‡å¤šæ›´æ”¹ç¼“å†²åŒºï¼Œå¯¹ç”¨æˆ·æ¥è¯´å°†å¤ªçƒ¦äººäº†ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ·å“æ•°é‡æ ¡æ­£</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨æˆ‘ä»¬éœ€è¦ä¿®å¤å£°éŸ³ã€‚</font><font style="vertical-align: inherit;">æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬çš„</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">syncnize_audio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡½æ•°</font><font style="vertical-align: inherit;">è¿”å›ä¸€ä¸ªæ ·æœ¬å¤§å°ï¼Œç„¶åå‘Šè¯‰æˆ‘ä»¬è¦å‘é€åˆ°æµä¸­çš„å­—èŠ‚æ•°ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æ ·æœ¬å¤§å°è°ƒæ•´ä¸ºæ‰€éœ€å€¼å³å¯ã€‚</font><font style="vertical-align: inherit;">è¿™æ ·å¯ä»¥å‡å°æ ·æœ¬é‡ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå¦‚æœæ‚¨éœ€è¦å¢åŠ å®ƒï¼Œæˆ‘ä»¬å°±ä¸èƒ½ä»…ä»…å¢åŠ æ ·æœ¬é‡ï¼Œå› ä¸ºç¼“å†²åŒºä¸­æ²¡æœ‰æ›´å¤šæ•°æ®äº†ï¼</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»æ·»åŠ ä¸€ç‚¹ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯åˆ°åº•è¦æ·»åŠ ä»€ä¹ˆå‘¢ï¼Ÿ</font><font style="vertical-align: inherit;">å°è¯•å¤–æ¨éŸ³é¢‘æ˜¯æ„šè ¢çš„ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬åªä½¿ç”¨å·²æœ‰çš„éŸ³é¢‘ï¼Œå°†æœ€åä¸€ä¸ªæ ·æœ¬çš„å€¼æ·»åŠ åˆ°ç¼“å†²åŒºä¸­å³å¯ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">if</span>(wanted_size &lt; samples_size) {
  <span class="hljs-comment">/* remove samples */</span><font></font>
  samples_size = wanted_size;<font></font>
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(wanted_size &gt; samples_size) {
  <span class="hljs-keyword">uint8_t</span> *samples_end, *q;
  <span class="hljs-keyword">int</span> nb;<font></font>
<font></font>
  <span class="hljs-comment">/* add samples by copying final samples */</span><font></font>
  nb = (samples_size - wanted_size);<font></font>
  samples_end = (<span class="hljs-keyword">uint8_t</span> *)samples + samples_size - n;<font></font>
  q = samples_end + n;<font></font>
  <span class="hljs-keyword">while</span>(nb &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">memcpy</span>(q, samples_end, n);<font></font>
    q += n;<font></font>
    nb -= n;<font></font>
  }<font></font>
  samples_size = wanted_size;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¿”å›æ ·æœ¬å¤§å°ï¼Œå¹¶å®Œæˆæ­¤å‡½æ•°ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ç°åœ¨éœ€è¦åšçš„å°±æ˜¯ä½¿ç”¨è¿™ä¸ªï¼š</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">audio_callback</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *userdata, Uint8 *stream, <span class="hljs-keyword">int</span> len)</span> </span>{<font></font>
<font></font>
  VideoState *is = (VideoState *)userdata;<font></font>
  <span class="hljs-keyword">int</span> len1, audio_size;
  <span class="hljs-keyword">double</span> pts;<font></font>
<font></font>
  <span class="hljs-keyword">while</span>(len &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">if</span>(is-&gt;audio_buf_index &gt;= is-&gt;audio_buf_size) {
      <span class="hljs-comment">/* We have already sent all our data; get more */</span>
      audio_size = audio_decode_frame(is, is-&gt;audio_buf, <span class="hljs-keyword">sizeof</span>(is-&gt;audio_buf), &amp;pts);
      <span class="hljs-keyword">if</span>(audio_size &lt; <span class="hljs-number">0</span>) {
	<span class="hljs-comment">/* If error, output silence */</span>
	is-&gt;audio_buf_size = <span class="hljs-number">1024</span>;
	<span class="hljs-built_in">memset</span>(is-&gt;audio_buf, <span class="hljs-number">0</span>, is-&gt;audio_buf_size);<font></font>
      } <span class="hljs-keyword">else</span> {<font></font>
	audio_size = synchronize_audio(is, (<span class="hljs-keyword">int16_t</span> *)is-&gt;audio_buf,<font></font>
				       audio_size, pts);<font></font>
	is-&gt;audio_buf_size = audio_size;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬æ‰€åšçš„åªæ˜¯æ’å…¥ä¸€ä¸ª</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">syncnize_audio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è°ƒç”¨</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ï¼ˆæ­¤å¤–ï¼Œè¯·åŠ¡å¿…æ£€æŸ¥æºä»£ç ï¼Œåœ¨è¯¥æºä»£ç ä¸­æˆ‘ä»¬åˆå§‹åŒ–ä¸éœ€è¦æ‰“æ‰°çš„å˜é‡ã€‚ï¼‰</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€åï¼Œåœ¨å®Œæˆä¹‹å‰ï¼šæˆ‘ä»¬éœ€è¦æ·»åŠ â€œ ifâ€æ¡ä»¶ï¼Œä»¥ç¡®ä¿å¦‚æœå®ƒæ˜¯ä¸»æ—¶é’Ÿï¼Œåˆ™ä¸åŒæ­¥è§†é¢‘ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">if</span>(is-&gt;av_sync_type != AV_SYNC_VIDEO_MASTER) {<font></font>
  ref_clock = get_master_clock(is);<font></font>
  diff = vp-&gt;pts - ref_clock;<font></font>
<font></font>
  <span class="hljs-comment">/* Skip or repeat the frame. Take delay into account
     FFPlay still doesn't "know if this is the best guess." */</span><font></font>
  sync_threshold = (delay &gt; AV_SYNC_THRESHOLD) ? delay :<font></font>
                    AV_SYNC_THRESHOLD;<font></font>
  <span class="hljs-keyword">if</span>(<span class="hljs-built_in">fabs</span>(diff) &lt; AV_NOSYNC_THRESHOLD) {
    <span class="hljs-keyword">if</span>(diff &lt;= -sync_threshold) {<font></font>
      delay = <span class="hljs-number">0</span>;<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(diff &gt;= sync_threshold) {<font></font>
      delay = <span class="hljs-number">2</span> * delay;<font></font>
    }<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è€Œä¸”æœ‰æ•ˆï¼</font><font style="vertical-align: inherit;">ç¡®ä¿æ£€æŸ¥æºæ–‡ä»¶ä»¥åˆå§‹åŒ–æ‰€æœ‰æˆ‘ä¸æƒ³å®šä¹‰æˆ–åˆå§‹åŒ–çš„å˜é‡ã€‚</font><font style="vertical-align: inherit;">ç„¶åç¼–è¯‘ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">gcc -o tutorial06 tutorial06.c -lavutil -lavformat -lavcodec -lswscale -lz -lm \<font></font>
`sdl-config --cflags --libs`</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¹¶ä¸”é£è¡Œå°†æ˜¯æ­£å¸¸çš„ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ä¸Šä¸€è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†å€’å¸¦ã€‚</font></font><a name="seeking"></a><br>
<br>
<hr><hr><hr><hr><hr><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬7è¯¾ï¼šæœç´¢</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="ç¬¬6è¯¾ï¼šéŸ³é¢‘åŒæ­¥"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â† </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="åˆ°ç›®å½•"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â‡‘ </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="åè®°"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â†’</font></font></a></h2><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®Œæ•´åˆ—è¡¨tutorial07.c</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment">// tutorial05.c</span>
<span class="hljs-comment">// A pedagogical video player that really works!</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Code based on FFplay, Copyright (c) 2003 Fabrice Bellard, </span>
<span class="hljs-comment">// and a tutorial by Martin Bohme (boehme@inb.uni-luebeckREMOVETHIS.de)</span>
<span class="hljs-comment">// Tested on Gentoo, CVS version 5/01/07 compiled with GCC 4.1.1</span>
<span class="hljs-comment">// With updates from https://github.com/chelyaev/ffmpeg-tutorial</span>
<span class="hljs-comment">// Updates tested on:</span>
<span class="hljs-comment">// LAVC 54.59.100, LAVF 54.29.104, LSWS 2.1.101, SDL 1.2.15</span>
<span class="hljs-comment">// on GCC 4.7.2 in Debian February 2015</span>
<span class="hljs-comment">// Use</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// gcc -o tutorial05 tutorial05.c -lavformat -lavcodec -lswscale -lz -lm `sdl-config --cflags --libs`</span>
<span class="hljs-comment">// to build (assuming libavformat and libavcodec are correctly installed, </span>
<span class="hljs-comment">// and assuming you have sdl-config. Please refer to SDL docs for your installation.)</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Run using</span>
<span class="hljs-comment">// tutorial04 myvideofile.mpg</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// to play the video stream on your screen.</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libavcodec/avcodec.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libavformat/avformat.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libswscale/swscale.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SDL.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SDL_thread.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> __MINGW32__</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">undef</span> main <span class="hljs-comment">/* Prevents SDL from overriding main() */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;assert.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;math.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-comment">// compatibility with newer API</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> LIBAVCODEC_VERSION_INT &lt; AV_VERSION_INT(55,28,1)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> av_frame_alloc avcodec_alloc_frame</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> av_frame_free avcodec_free_frame</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SDL_AUDIO_BUFFER_SIZE 1024</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_AUDIO_FRAME_SIZE 192000</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_AUDIOQ_SIZE (5 * 16 * 1024)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_VIDEOQ_SIZE (5 * 256 * 1024)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> AV_SYNC_THRESHOLD 0.01</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> AV_NOSYNC_THRESHOLD 10.0</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SAMPLE_CORRECTION_PERCENT_MAX 10</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> AUDIO_DIFF_AVG_NB 20</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FF_REFRESH_EVENT (SDL_USEREVENT)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FF_QUIT_EVENT (SDL_USEREVENT + 1)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> VIDEO_PICTURE_QUEUE_SIZE 1</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEFAULT_AV_SYNC_TYPE AV_SYNC_VIDEO_MASTER</span><font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">PacketQueue</span> {</span><font></font>
  AVPacketList *first_pkt, *last_pkt;<font></font>
  <span class="hljs-keyword">int</span> nb_packets;
  <span class="hljs-keyword">int</span> size;<font></font>
  SDL_mutex *mutex;<font></font>
  SDL_cond *cond;<font></font>
} PacketQueue;<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">VideoPicture</span> {</span><font></font>
  SDL_Overlay *bmp;<font></font>
  <span class="hljs-keyword">int</span> width, height; <span class="hljs-comment">/* source height &amp; width */</span>
  <span class="hljs-keyword">int</span> allocated;
  <span class="hljs-keyword">double</span> pts;<font></font>
} VideoPicture;<font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">VideoState</span> {</span><font></font>
<font></font>
  AVFormatContext *pFormatCtx;<font></font>
  <span class="hljs-keyword">int</span>             videoStream, audioStream;<font></font>
<font></font>
  <span class="hljs-keyword">int</span>             av_sync_type;
  <span class="hljs-keyword">double</span>          external_clock; <span class="hljs-comment">/* external clock base */</span>
  <span class="hljs-keyword">int64_t</span>         external_clock_time;
  <span class="hljs-keyword">int</span>             seek_req;
  <span class="hljs-keyword">int</span>             seek_flags;
  <span class="hljs-keyword">int64_t</span>         seek_pos;<font></font>
<font></font>
  <span class="hljs-keyword">double</span>          audio_clock;<font></font>
  AVStream        *audio_st;<font></font>
  AVCodecContext  *audio_ctx;<font></font>
  PacketQueue     audioq;<font></font>
  <span class="hljs-keyword">uint8_t</span>         audio_buf[(AVCODEC_MAX_AUDIO_FRAME_SIZE * <span class="hljs-number">3</span>) / <span class="hljs-number">2</span>];
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>    audio_buf_size;
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>    audio_buf_index;<font></font>
  AVFrame         audio_frame;<font></font>
  AVPacket        audio_pkt;<font></font>
  <span class="hljs-keyword">uint8_t</span>         *audio_pkt_data;
  <span class="hljs-keyword">int</span>             audio_pkt_size;
  <span class="hljs-keyword">int</span>             audio_hw_buf_size;
  <span class="hljs-keyword">double</span>          audio_diff_cum; <span class="hljs-comment">/* used for AV difference average computation */</span>
  <span class="hljs-keyword">double</span>          audio_diff_avg_coef;
  <span class="hljs-keyword">double</span>          audio_diff_threshold;
  <span class="hljs-keyword">int</span>             audio_diff_avg_count;
  <span class="hljs-keyword">double</span>          frame_timer;
  <span class="hljs-keyword">double</span>          frame_last_pts;
  <span class="hljs-keyword">double</span>          frame_last_delay;
  <span class="hljs-keyword">double</span>          video_clock; <span class="hljs-comment">///&lt;pts of last decoded frame / predicted pts of next decoded frame</span>
  <span class="hljs-keyword">double</span>          video_current_pts; <span class="hljs-comment">///&lt;current displayed pts (different from video_clock if frame fifos are used)</span>
  <span class="hljs-keyword">int64_t</span>         video_current_pts_time;  <span class="hljs-comment">///&lt;time (av_gettime) at which we updated video_current_pts - used to have running video pts</span><font></font>
  AVStream        *video_st;<font></font>
  AVCodecContext  *video_ctx;<font></font>
  PacketQueue     videoq;<font></font>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SwsContext</span> *<span class="hljs-title">sws_ctx</span>;</span><font></font>
<font></font>
  VideoPicture    pictq[VIDEO_PICTURE_QUEUE_SIZE];<font></font>
  <span class="hljs-keyword">int</span>             pictq_size, pictq_rindex, pictq_windex;<font></font>
  SDL_mutex       *pictq_mutex;<font></font>
  SDL_cond        *pictq_cond;<font></font>
  <font></font>
  SDL_Thread      *parse_tid;<font></font>
  SDL_Thread      *video_tid;<font></font>
<font></font>
  <span class="hljs-keyword">char</span>            filename[<span class="hljs-number">1024</span>];
  <span class="hljs-keyword">int</span>             quit;<font></font>
} VideoState;<font></font>
<font></font>
<span class="hljs-keyword">enum</span> {<font></font>
  AV_SYNC_AUDIO_MASTER,<font></font>
  AV_SYNC_VIDEO_MASTER,<font></font>
  AV_SYNC_EXTERNAL_MASTER,<font></font>
};<font></font>
<font></font>
SDL_Surface     *screen;<font></font>
SDL_mutex       *screen_mutex;<font></font>
<font></font>
<span class="hljs-comment">/* Since we only have one decoding thread, the Big Struct
   can be global in case we need it. */</span><font></font>
VideoState *global_video_state;<font></font>
AVPacket flush_pkt;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">packet_queue_init</span><span class="hljs-params">(PacketQueue *q)</span> </span>{
  <span class="hljs-built_in">memset</span>(q, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(PacketQueue));<font></font>
  q-&gt;mutex = SDL_CreateMutex();<font></font>
  q-&gt;cond = SDL_CreateCond();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">packet_queue_put</span><span class="hljs-params">(PacketQueue *q, AVPacket *pkt)</span> </span>{<font></font>
<font></font>
  AVPacketList *pkt1;<font></font>
  <span class="hljs-keyword">if</span>(pkt != &amp;flush_pkt &amp;&amp; av_dup_packet(pkt) &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
  pkt1 = av_malloc(<span class="hljs-keyword">sizeof</span>(AVPacketList));
  <span class="hljs-keyword">if</span> (!pkt1)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  pkt1-&gt;pkt = *pkt;<font></font>
  pkt1-&gt;next = <span class="hljs-literal">NULL</span>;<font></font>
  <font></font>
  SDL_LockMutex(q-&gt;mutex);<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (!q-&gt;last_pkt)<font></font>
    q-&gt;first_pkt = pkt1;<font></font>
  <span class="hljs-keyword">else</span><font></font>
    q-&gt;last_pkt-&gt;next = pkt1;<font></font>
  q-&gt;last_pkt = pkt1;<font></font>
  q-&gt;nb_packets++;<font></font>
  q-&gt;size += pkt1-&gt;pkt.size;<font></font>
  SDL_CondSignal(q-&gt;cond);<font></font>
  <font></font>
  SDL_UnlockMutex(q-&gt;mutex);<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">packet_queue_get</span><span class="hljs-params">(PacketQueue *q, AVPacket *pkt, <span class="hljs-keyword">int</span> block)</span>
</span>{<font></font>
  AVPacketList *pkt1;<font></font>
  <span class="hljs-keyword">int</span> ret;<font></font>
<font></font>
  SDL_LockMutex(q-&gt;mutex);<font></font>
  <font></font>
  <span class="hljs-keyword">for</span>(;;) {<font></font>
    <font></font>
    <span class="hljs-keyword">if</span>(global_video_state-&gt;quit) {<font></font>
      ret = <span class="hljs-number">-1</span>;
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
<font></font>
    pkt1 = q-&gt;first_pkt;<font></font>
    <span class="hljs-keyword">if</span> (pkt1) {<font></font>
      q-&gt;first_pkt = pkt1-&gt;next;<font></font>
      <span class="hljs-keyword">if</span> (!q-&gt;first_pkt)<font></font>
	q-&gt;last_pkt = <span class="hljs-literal">NULL</span>;<font></font>
      q-&gt;nb_packets--;<font></font>
      q-&gt;size -= pkt1-&gt;pkt.size;<font></font>
      *pkt = pkt1-&gt;pkt;<font></font>
      av_free(pkt1);<font></font>
      ret = <span class="hljs-number">1</span>;
      <span class="hljs-keyword">break</span>;<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!block) {<font></font>
      ret = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">break</span>;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      SDL_CondWait(q-&gt;cond, q-&gt;mutex);<font></font>
    }<font></font>
  }<font></font>
  SDL_UnlockMutex(q-&gt;mutex);<font></font>
  <span class="hljs-keyword">return</span> ret;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">packet_queue_flush</span><span class="hljs-params">(PacketQueue *q)</span> </span>{<font></font>
  AVPacketList *pkt, *pkt1;<font></font>
<font></font>
  SDL_LockMutex(q-&gt;mutex);<font></font>
  <span class="hljs-keyword">for</span>(pkt = q-&gt;first_pkt; pkt != <span class="hljs-literal">NULL</span>; pkt = pkt1) {<font></font>
    pkt1 = pkt-&gt;next;<font></font>
    av_free_packet(&amp;pkt-&gt;pkt);<font></font>
    av_freep(&amp;pkt);<font></font>
  }<font></font>
  q-&gt;last_pkt = <span class="hljs-literal">NULL</span>;<font></font>
  q-&gt;first_pkt = <span class="hljs-literal">NULL</span>;<font></font>
  q-&gt;nb_packets = <span class="hljs-number">0</span>;<font></font>
  q-&gt;size = <span class="hljs-number">0</span>;<font></font>
  SDL_UnlockMutex(q-&gt;mutex);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">get_audio_clock</span><span class="hljs-params">(VideoState *is)</span> </span>{
  <span class="hljs-keyword">double</span> pts;
  <span class="hljs-keyword">int</span> hw_buf_size, bytes_per_sec, n;<font></font>
  <font></font>
  pts = is-&gt;audio_clock; <span class="hljs-comment">/* maintained in the audio thread */</span><font></font>
  hw_buf_size = is-&gt;audio_buf_size - is-&gt;audio_buf_index;<font></font>
  bytes_per_sec = <span class="hljs-number">0</span>;<font></font>
  n = is-&gt;audio_ctx-&gt;channels * <span class="hljs-number">2</span>;
  <span class="hljs-keyword">if</span>(is-&gt;audio_st) {<font></font>
    bytes_per_sec = is-&gt;audio_ctx-&gt;sample_rate * n;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span>(bytes_per_sec) {<font></font>
    pts -= (<span class="hljs-keyword">double</span>)hw_buf_size / bytes_per_sec;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> pts;<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">get_video_clock</span><span class="hljs-params">(VideoState *is)</span> </span>{
  <span class="hljs-keyword">double</span> delta;<font></font>
<font></font>
  delta = (av_gettime() - is-&gt;video_current_pts_time) / <span class="hljs-number">1000000.0</span>;
  <span class="hljs-keyword">return</span> is-&gt;video_current_pts + delta;<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">get_external_clock</span><span class="hljs-params">(VideoState *is)</span> </span>{
  <span class="hljs-keyword">return</span> av_gettime() / <span class="hljs-number">1000000.0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">get_master_clock</span><span class="hljs-params">(VideoState *is)</span> </span>{
  <span class="hljs-keyword">if</span>(is-&gt;av_sync_type == AV_SYNC_VIDEO_MASTER) {
    <span class="hljs-keyword">return</span> get_video_clock(is);<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(is-&gt;av_sync_type == AV_SYNC_AUDIO_MASTER) {
    <span class="hljs-keyword">return</span> get_audio_clock(is);<font></font>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> get_external_clock(is);<font></font>
  }<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-comment">/* Add or subtract samples to get a better sync, return new
   audio buffer size */</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">synchronize_audio</span><span class="hljs-params">(VideoState *is, <span class="hljs-keyword">short</span> *samples,
		      <span class="hljs-keyword">int</span> samples_size, <span class="hljs-keyword">double</span> pts)</span> </span>{
  <span class="hljs-keyword">int</span> n;
  <span class="hljs-keyword">double</span> ref_clock;<font></font>
<font></font>
  n = <span class="hljs-number">2</span> * is-&gt;audio_ctx-&gt;channels;<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>(is-&gt;av_sync_type != AV_SYNC_AUDIO_MASTER) {
    <span class="hljs-keyword">double</span> diff, avg_diff;
    <span class="hljs-keyword">int</span> wanted_size, min_size, max_size <span class="hljs-comment">/*, nb_samples */</span>;<font></font>
    <font></font>
    ref_clock = get_master_clock(is);<font></font>
    diff = get_audio_clock(is) - ref_clock;<font></font>
<font></font>
    <span class="hljs-keyword">if</span>(diff &lt; AV_NOSYNC_THRESHOLD) {
      <span class="hljs-comment">// accumulate the diffs</span><font></font>
      is-&gt;audio_diff_cum = diff + is-&gt;audio_diff_avg_coef<font></font>
	* is-&gt;audio_diff_cum;<font></font>
      <span class="hljs-keyword">if</span>(is-&gt;audio_diff_avg_count &lt; AUDIO_DIFF_AVG_NB) {<font></font>
	is-&gt;audio_diff_avg_count++;<font></font>
      } <span class="hljs-keyword">else</span> {<font></font>
	avg_diff = is-&gt;audio_diff_cum * (<span class="hljs-number">1.0</span> - is-&gt;audio_diff_avg_coef);
	<span class="hljs-keyword">if</span>(<span class="hljs-built_in">fabs</span>(avg_diff) &gt;= is-&gt;audio_diff_threshold) {<font></font>
	  wanted_size = samples_size + ((<span class="hljs-keyword">int</span>)(diff * is-&gt;audio_ctx-&gt;sample_rate) * n);<font></font>
	  min_size = samples_size * ((<span class="hljs-number">100</span> - SAMPLE_CORRECTION_PERCENT_MAX) / <span class="hljs-number">100</span>);<font></font>
	  max_size = samples_size * ((<span class="hljs-number">100</span> + SAMPLE_CORRECTION_PERCENT_MAX) / <span class="hljs-number">100</span>);
	  <span class="hljs-keyword">if</span>(wanted_size &lt; min_size) {<font></font>
	    wanted_size = min_size;<font></font>
	  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (wanted_size &gt; max_size) {<font></font>
	    wanted_size = max_size;<font></font>
	  }<font></font>
	  <span class="hljs-keyword">if</span>(wanted_size &lt; samples_size) {
	    <span class="hljs-comment">/* remove samples */</span><font></font>
	    samples_size = wanted_size;<font></font>
	  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(wanted_size &gt; samples_size) {
	    <span class="hljs-keyword">uint8_t</span> *samples_end, *q;
	    <span class="hljs-keyword">int</span> nb;<font></font>
<font></font>
	    <span class="hljs-comment">/* add samples by copying final sample*/</span><font></font>
	    nb = (samples_size - wanted_size);<font></font>
	    samples_end = (<span class="hljs-keyword">uint8_t</span> *)samples + samples_size - n;<font></font>
	    q = samples_end + n;<font></font>
	    <span class="hljs-keyword">while</span>(nb &gt; <span class="hljs-number">0</span>) {
	      <span class="hljs-built_in">memcpy</span>(q, samples_end, n);<font></font>
	      q += n;<font></font>
	      nb -= n;<font></font>
	    }<font></font>
	    samples_size = wanted_size;<font></font>
	  }<font></font>
	}<font></font>
      }<font></font>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">/* difference is TOO big; reset diff stuff */</span>
      is-&gt;audio_diff_avg_count = <span class="hljs-number">0</span>;<font></font>
      is-&gt;audio_diff_cum = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> samples_size;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">audio_decode_frame</span><span class="hljs-params">(VideoState *is, <span class="hljs-keyword">uint8_t</span> *audio_buf, <span class="hljs-keyword">int</span> buf_size, <span class="hljs-keyword">double</span> *pts_ptr)</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">int</span> len1, data_size = <span class="hljs-number">0</span>;<font></font>
  AVPacket *pkt = &amp;is-&gt;audio_pkt;<font></font>
  <span class="hljs-keyword">double</span> pts;
  <span class="hljs-keyword">int</span> n;<font></font>
<font></font>
  <span class="hljs-keyword">for</span>(;;) {
    <span class="hljs-keyword">while</span>(is-&gt;audio_pkt_size &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">int</span> got_frame = <span class="hljs-number">0</span>;<font></font>
      len1 = avcodec_decode_audio4(is-&gt;audio_ctx, &amp;is-&gt;audio_frame, &amp;got_frame, pkt);<font></font>
      <span class="hljs-keyword">if</span>(len1 &lt; <span class="hljs-number">0</span>) {
	<span class="hljs-comment">/* if error, skip frame */</span>
	is-&gt;audio_pkt_size = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">break</span>;<font></font>
      }<font></font>
      data_size = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">if</span>(got_frame) {<font></font>
	data_size = av_samples_get_buffer_size(<span class="hljs-literal">NULL</span>, <font></font>
					       is-&gt;audio_ctx-&gt;channels,<font></font>
					       is-&gt;audio_frame.nb_samples,<font></font>
					       is-&gt;audio_ctx-&gt;sample_fmt,<font></font>
					       <span class="hljs-number">1</span>);<font></font>
	assert(data_size &lt;= buf_size);<font></font>
	<span class="hljs-built_in">memcpy</span>(audio_buf, is-&gt;audio_frame.data[<span class="hljs-number">0</span>], data_size);<font></font>
      }<font></font>
      is-&gt;audio_pkt_data += len1;<font></font>
      is-&gt;audio_pkt_size -= len1;<font></font>
      <span class="hljs-keyword">if</span>(data_size &lt;= <span class="hljs-number">0</span>) {
	<span class="hljs-comment">/* No data yet, get more frames */</span>
	<span class="hljs-keyword">continue</span>;<font></font>
      }<font></font>
      pts = is-&gt;audio_clock;<font></font>
      *pts_ptr = pts;<font></font>
      n = <span class="hljs-number">2</span> * is-&gt;audio_ctx-&gt;channels;<font></font>
      is-&gt;audio_clock += (<span class="hljs-keyword">double</span>)data_size /<font></font>
	(<span class="hljs-keyword">double</span>)(n * is-&gt;audio_ctx-&gt;sample_rate);
      <span class="hljs-comment">/* We have data, return it and come back for more later */</span>
      <span class="hljs-keyword">return</span> data_size;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(pkt-&gt;data)<font></font>
      av_free_packet(pkt);<font></font>
<font></font>
    <span class="hljs-keyword">if</span>(is-&gt;quit) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
    <span class="hljs-comment">/* next packet */</span>
    <span class="hljs-keyword">if</span>(packet_queue_get(&amp;is-&gt;audioq, pkt, <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(pkt-&gt;data == flush_pkt.data) {<font></font>
      avcodec_flush_buffers(is-&gt;audio_ctx);<font></font>
      <span class="hljs-keyword">continue</span>;<font></font>
    }<font></font>
    is-&gt;audio_pkt_data = pkt-&gt;data;<font></font>
    is-&gt;audio_pkt_size = pkt-&gt;size;<font></font>
    <span class="hljs-comment">/* if update, update the audio clock w/pts */</span>
    <span class="hljs-keyword">if</span>(pkt-&gt;pts != AV_NOPTS_VALUE) {<font></font>
      is-&gt;audio_clock = av_q2d(is-&gt;audio_st-&gt;time_base)*pkt-&gt;pts;<font></font>
    }<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">audio_callback</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *userdata, Uint8 *stream, <span class="hljs-keyword">int</span> len)</span> </span>{<font></font>
<font></font>
  VideoState *is = (VideoState *)userdata;<font></font>
  <span class="hljs-keyword">int</span> len1, audio_size;
  <span class="hljs-keyword">double</span> pts;<font></font>
<font></font>
  <span class="hljs-keyword">while</span>(len &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">if</span>(is-&gt;audio_buf_index &gt;= is-&gt;audio_buf_size) {
      <span class="hljs-comment">/* We have already sent all our data; get more */</span>
      audio_size = audio_decode_frame(is, is-&gt;audio_buf, <span class="hljs-keyword">sizeof</span>(is-&gt;audio_buf), &amp;pts);
      <span class="hljs-keyword">if</span>(audio_size &lt; <span class="hljs-number">0</span>) {
	<span class="hljs-comment">/* If error, output silence */</span>
	is-&gt;audio_buf_size = <span class="hljs-number">1024</span>;
	<span class="hljs-built_in">memset</span>(is-&gt;audio_buf, <span class="hljs-number">0</span>, is-&gt;audio_buf_size);<font></font>
      } <span class="hljs-keyword">else</span> {<font></font>
	audio_size = synchronize_audio(is, (<span class="hljs-keyword">int16_t</span> *)is-&gt;audio_buf,<font></font>
				       audio_size, pts);<font></font>
	is-&gt;audio_buf_size = audio_size;<font></font>
      }<font></font>
      is-&gt;audio_buf_index = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
    len1 = is-&gt;audio_buf_size - is-&gt;audio_buf_index;<font></font>
    <span class="hljs-keyword">if</span>(len1 &gt; len)<font></font>
      len1 = len;<font></font>
    <span class="hljs-built_in">memcpy</span>(stream, (<span class="hljs-keyword">uint8_t</span> *)is-&gt;audio_buf + is-&gt;audio_buf_index, len1);<font></font>
    len -= len1;<font></font>
    stream += len1;<font></font>
    is-&gt;audio_buf_index += len1;<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> Uint32 <span class="hljs-title">sdl_refresh_timer_cb</span><span class="hljs-params">(Uint32 interval, <span class="hljs-keyword">void</span> *opaque)</span> </span>{<font></font>
  SDL_Event event;<font></font>
  event.type = FF_REFRESH_EVENT;<font></font>
  event.user.data1 = opaque;<font></font>
  SDL_PushEvent(&amp;event);<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <span class="hljs-comment">/* 0 means stop timer */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* schedule a video refresh in 'delay' ms */</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">schedule_refresh</span><span class="hljs-params">(VideoState *is, <span class="hljs-keyword">int</span> delay)</span> </span>{<font></font>
  SDL_AddTimer(delay, sdl_refresh_timer_cb, is);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">video_display</span><span class="hljs-params">(VideoState *is)</span> </span>{<font></font>
<font></font>
  SDL_Rect rect;<font></font>
  VideoPicture *vp;<font></font>
  <span class="hljs-keyword">float</span> aspect_ratio;
  <span class="hljs-keyword">int</span> w, h, x, y;
  <span class="hljs-keyword">int</span> i;<font></font>
<font></font>
  vp = &amp;is-&gt;pictq[is-&gt;pictq_rindex];<font></font>
  <span class="hljs-keyword">if</span>(vp-&gt;bmp) {
    <span class="hljs-keyword">if</span>(is-&gt;video_ctx-&gt;sample_aspect_ratio.num == <span class="hljs-number">0</span>) {<font></font>
      aspect_ratio = <span class="hljs-number">0</span>;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      aspect_ratio = av_q2d(is-&gt;video_ctx-&gt;sample_aspect_ratio) *<font></font>
	is-&gt;video_ctx-&gt;width / is-&gt;video_ctx-&gt;height;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(aspect_ratio &lt;= <span class="hljs-number">0.0</span>) {<font></font>
      aspect_ratio = (<span class="hljs-keyword">float</span>)is-&gt;video_ctx-&gt;width /<font></font>
	(<span class="hljs-keyword">float</span>)is-&gt;video_ctx-&gt;height;<font></font>
    }<font></font>
    h = screen-&gt;h;<font></font>
    w = ((<span class="hljs-keyword">int</span>)rint(h * aspect_ratio)) &amp; <span class="hljs-number">-3</span>;
    <span class="hljs-keyword">if</span>(w &gt; screen-&gt;w) {<font></font>
      w = screen-&gt;w;<font></font>
      h = ((<span class="hljs-keyword">int</span>)rint(w / aspect_ratio)) &amp; <span class="hljs-number">-3</span>;<font></font>
    }<font></font>
    x = (screen-&gt;w - w) / <span class="hljs-number">2</span>;<font></font>
    y = (screen-&gt;h - h) / <span class="hljs-number">2</span>;<font></font>
    <font></font>
    rect.x = x;<font></font>
    rect.y = y;<font></font>
    rect.w = w;<font></font>
    rect.h = h;<font></font>
    SDL_LockMutex(screen_mutex);<font></font>
    SDL_DisplayYUVOverlay(vp-&gt;bmp, &amp;rect);<font></font>
    SDL_UnlockMutex(screen_mutex);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">video_refresh_timer</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *userdata)</span> </span>{<font></font>
<font></font>
  VideoState *is = (VideoState *)userdata;<font></font>
  VideoPicture *vp;<font></font>
  <span class="hljs-keyword">double</span> actual_delay, delay, sync_threshold, ref_clock, diff;<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>(is-&gt;video_st) {
    <span class="hljs-keyword">if</span>(is-&gt;pictq_size == <span class="hljs-number">0</span>) {<font></font>
      schedule_refresh(is, <span class="hljs-number">1</span>);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      vp = &amp;is-&gt;pictq[is-&gt;pictq_rindex];<font></font>
      <font></font>
      is-&gt;video_current_pts = vp-&gt;pts;<font></font>
      is-&gt;video_current_pts_time = av_gettime();<font></font>
      delay = vp-&gt;pts - is-&gt;frame_last_pts; <span class="hljs-comment">/* the pts from last time */</span>
      <span class="hljs-keyword">if</span>(delay &lt;= <span class="hljs-number">0</span> || delay &gt;= <span class="hljs-number">1.0</span>) {
	<span class="hljs-comment">/* if incorrect delay, use previous one */</span><font></font>
	delay = is-&gt;frame_last_delay;<font></font>
      }<font></font>
      <span class="hljs-comment">/* save for next time */</span><font></font>
      is-&gt;frame_last_delay = delay;<font></font>
      is-&gt;frame_last_pts = vp-&gt;pts;<font></font>
<font></font>
<font></font>
<font></font>
      <span class="hljs-comment">/* update delay to sync to audio if not master source */</span>
      <span class="hljs-keyword">if</span>(is-&gt;av_sync_type != AV_SYNC_VIDEO_MASTER) {<font></font>
	ref_clock = get_master_clock(is);<font></font>
	diff = vp-&gt;pts - ref_clock;<font></font>
	<font></font>
	<span class="hljs-comment">/* Skip or repeat the frame. Take delay into account
	   FFPlay still doesn't "know if this is the best guess." */</span><font></font>
	sync_threshold = (delay &gt; AV_SYNC_THRESHOLD) ? delay : AV_SYNC_THRESHOLD;<font></font>
	<span class="hljs-keyword">if</span>(<span class="hljs-built_in">fabs</span>(diff) &lt; AV_NOSYNC_THRESHOLD) {
	  <span class="hljs-keyword">if</span>(diff &lt;= -sync_threshold) {<font></font>
	    delay = <span class="hljs-number">0</span>;<font></font>
	  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(diff &gt;= sync_threshold) {<font></font>
	    delay = <span class="hljs-number">2</span> * delay;<font></font>
	  }<font></font>
	}<font></font>
      }<font></font>
      is-&gt;frame_timer += delay;<font></font>
      <span class="hljs-comment">/* computer the REAL delay */</span>
      actual_delay = is-&gt;frame_timer - (av_gettime() / <span class="hljs-number">1000000.0</span>);
      <span class="hljs-keyword">if</span>(actual_delay &lt; <span class="hljs-number">0.010</span>) {
	<span class="hljs-comment">/* Really it should skip the picture instead */</span>
	actual_delay = <span class="hljs-number">0.010</span>;<font></font>
      }<font></font>
      schedule_refresh(is, (<span class="hljs-keyword">int</span>)(actual_delay * <span class="hljs-number">1000</span> + <span class="hljs-number">0.5</span>));<font></font>
      <font></font>
      <span class="hljs-comment">/* show the picture! */</span><font></font>
      video_display(is);<font></font>
      <font></font>
      <span class="hljs-comment">/* update queue for next picture! */</span>
      <span class="hljs-keyword">if</span>(++is-&gt;pictq_rindex == VIDEO_PICTURE_QUEUE_SIZE) {<font></font>
	is-&gt;pictq_rindex = <span class="hljs-number">0</span>;<font></font>
      }<font></font>
      SDL_LockMutex(is-&gt;pictq_mutex);<font></font>
      is-&gt;pictq_size--;<font></font>
      SDL_CondSignal(is-&gt;pictq_cond);<font></font>
      SDL_UnlockMutex(is-&gt;pictq_mutex);<font></font>
    }<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    schedule_refresh(is, <span class="hljs-number">100</span>);<font></font>
  }<font></font>
}<font></font>
      <font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">alloc_picture</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *userdata)</span> </span>{<font></font>
<font></font>
  VideoState *is = (VideoState *)userdata;<font></font>
  VideoPicture *vp;<font></font>
<font></font>
  vp = &amp;is-&gt;pictq[is-&gt;pictq_windex];<font></font>
  <span class="hljs-keyword">if</span>(vp-&gt;bmp) {
    <span class="hljs-comment">// we already have one make another, bigger/smaller</span><font></font>
    SDL_FreeYUVOverlay(vp-&gt;bmp);<font></font>
  }<font></font>
  <span class="hljs-comment">// Allocate a place to put our YUV image on that screen</span><font></font>
  SDL_LockMutex(screen_mutex);<font></font>
  vp-&gt;bmp = SDL_CreateYUVOverlay(is-&gt;video_ctx-&gt;width,<font></font>
				 is-&gt;video_ctx-&gt;height,<font></font>
				 SDL_YV12_OVERLAY,<font></font>
				 screen);<font></font>
  SDL_UnlockMutex(screen_mutex);<font></font>
<font></font>
  vp-&gt;width = is-&gt;video_ctx-&gt;width;<font></font>
  vp-&gt;height = is-&gt;video_ctx-&gt;height;<font></font>
  vp-&gt;allocated = <span class="hljs-number">1</span>;<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">queue_picture</span><span class="hljs-params">(VideoState *is, AVFrame *pFrame, <span class="hljs-keyword">double</span> pts)</span> </span>{<font></font>
<font></font>
  VideoPicture *vp;<font></font>
  <span class="hljs-keyword">int</span> dst_pix_fmt;<font></font>
  AVPicture pict;<font></font>
<font></font>
  <span class="hljs-comment">/* wait until we have space for a new pic */</span><font></font>
  SDL_LockMutex(is-&gt;pictq_mutex);<font></font>
  <span class="hljs-keyword">while</span>(is-&gt;pictq_size &gt;= VIDEO_PICTURE_QUEUE_SIZE &amp;&amp;<font></font>
	!is-&gt;quit) {<font></font>
    SDL_CondWait(is-&gt;pictq_cond, is-&gt;pictq_mutex);<font></font>
  }<font></font>
  SDL_UnlockMutex(is-&gt;pictq_mutex);<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(is-&gt;quit)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
<font></font>
  <span class="hljs-comment">// windex is set to 0 initially</span><font></font>
  vp = &amp;is-&gt;pictq[is-&gt;pictq_windex];<font></font>
<font></font>
  <span class="hljs-comment">/* allocate or resize the buffer! */</span>
  <span class="hljs-keyword">if</span>(!vp-&gt;bmp ||<font></font>
     vp-&gt;width != is-&gt;video_ctx-&gt;width ||<font></font>
     vp-&gt;height != is-&gt;video_ctx-&gt;height) {<font></font>
    SDL_Event event;<font></font>
<font></font>
    vp-&gt;allocated = <span class="hljs-number">0</span>;<font></font>
    alloc_picture(is);<font></font>
    <span class="hljs-keyword">if</span>(is-&gt;quit) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-comment">/* We have a place to put our picture on the queue */</span><font></font>
<font></font>
  <span class="hljs-keyword">if</span>(vp-&gt;bmp) {<font></font>
<font></font>
    SDL_LockYUVOverlay(vp-&gt;bmp);<font></font>
    vp-&gt;pts = pts;<font></font>
    <font></font>
    dst_pix_fmt = PIX_FMT_YUV420P;<font></font>
    <span class="hljs-comment">/* point pict at the queue */</span><font></font>
<font></font>
    pict.data[<span class="hljs-number">0</span>] = vp-&gt;bmp-&gt;pixels[<span class="hljs-number">0</span>];<font></font>
    pict.data[<span class="hljs-number">1</span>] = vp-&gt;bmp-&gt;pixels[<span class="hljs-number">2</span>];<font></font>
    pict.data[<span class="hljs-number">2</span>] = vp-&gt;bmp-&gt;pixels[<span class="hljs-number">1</span>];<font></font>
    <font></font>
    pict.linesize[<span class="hljs-number">0</span>] = vp-&gt;bmp-&gt;pitches[<span class="hljs-number">0</span>];<font></font>
    pict.linesize[<span class="hljs-number">1</span>] = vp-&gt;bmp-&gt;pitches[<span class="hljs-number">2</span>];<font></font>
    pict.linesize[<span class="hljs-number">2</span>] = vp-&gt;bmp-&gt;pitches[<span class="hljs-number">1</span>];<font></font>
    <font></font>
    <span class="hljs-comment">// Convert the image into YUV format that SDL uses</span>
    sws_scale(is-&gt;sws_ctx, (<span class="hljs-keyword">uint8_t</span> <span class="hljs-keyword">const</span> * <span class="hljs-keyword">const</span> *)pFrame-&gt;data,<font></font>
	      pFrame-&gt;linesize, <span class="hljs-number">0</span>, is-&gt;video_ctx-&gt;height,<font></font>
	      pict.data, pict.linesize);<font></font>
    <font></font>
    SDL_UnlockYUVOverlay(vp-&gt;bmp);<font></font>
    <span class="hljs-comment">/* now we inform our display thread that we have a pic ready */</span>
    <span class="hljs-keyword">if</span>(++is-&gt;pictq_windex == VIDEO_PICTURE_QUEUE_SIZE) {<font></font>
      is-&gt;pictq_windex = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
    SDL_LockMutex(is-&gt;pictq_mutex);<font></font>
    is-&gt;pictq_size++;<font></font>
    SDL_UnlockMutex(is-&gt;pictq_mutex);<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">synchronize_video</span><span class="hljs-params">(VideoState *is, AVFrame *src_frame, <span class="hljs-keyword">double</span> pts)</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">double</span> frame_delay;<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(pts != <span class="hljs-number">0</span>) {
    <span class="hljs-comment">/* if we have pts, set video clock to it */</span><font></font>
    is-&gt;video_clock = pts;<font></font>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">/* if we aren't given a pts, set it to the clock */</span><font></font>
    pts = is-&gt;video_clock;<font></font>
  }<font></font>
  <span class="hljs-comment">/* update the video clock */</span><font></font>
  frame_delay = av_q2d(is-&gt;video_ctx-&gt;time_base);<font></font>
  <span class="hljs-comment">/* if we are repeating a frame, adjust clock accordingly */</span>
  frame_delay += src_frame-&gt;repeat_pict * (frame_delay * <span class="hljs-number">0.5</span>);<font></font>
  is-&gt;video_clock += frame_delay;<font></font>
  <span class="hljs-keyword">return</span> pts;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">video_thread</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span> </span>{<font></font>
  VideoState *is = (VideoState *)arg;<font></font>
  AVPacket pkt1, *packet = &amp;pkt1;<font></font>
  <span class="hljs-keyword">int</span> frameFinished;<font></font>
  AVFrame *pFrame;<font></font>
  <span class="hljs-keyword">double</span> pts;<font></font>
<font></font>
  pFrame = av_frame_alloc();<font></font>
<font></font>
  <span class="hljs-keyword">for</span>(;;) {
    <span class="hljs-keyword">if</span>(packet_queue_get(&amp;is-&gt;videoq, packet, <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-comment">// means we quit getting packets</span>
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(packet_queue_get(&amp;is-&gt;videoq, packet, <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-comment">// means we quit getting packets</span>
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
    pts = <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-comment">// Decode video frame</span><font></font>
    avcodec_decode_video2(is-&gt;video_ctx, pFrame, &amp;frameFinished, packet);<font></font>
<font></font>
    <span class="hljs-keyword">if</span>((pts = av_frame_get_best_effort_timestamp(pFrame)) == AV_NOPTS_VALUE) {<font></font>
      pts = av_frame_get_best_effort_timestamp(pFrame);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      pts = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
    pts *= av_q2d(is-&gt;video_st-&gt;time_base);<font></font>
<font></font>
    <span class="hljs-comment">// Did we get a video frame?</span>
    <span class="hljs-keyword">if</span>(frameFinished) {<font></font>
      pts = synchronize_video(is, pFrame, pts);<font></font>
      <span class="hljs-keyword">if</span>(queue_picture(is, pFrame, pts) &lt; <span class="hljs-number">0</span>) {
	<span class="hljs-keyword">break</span>;<font></font>
      }<font></font>
    }<font></font>
    av_free_packet(packet);<font></font>
  }<font></font>
  av_frame_free(&amp;pFrame);<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">stream_component_open</span><span class="hljs-params">(VideoState *is, <span class="hljs-keyword">int</span> stream_index)</span> </span>{<font></font>
<font></font>
  AVFormatContext *pFormatCtx = is-&gt;pFormatCtx;<font></font>
  AVCodecContext *codecCtx = <span class="hljs-literal">NULL</span>;<font></font>
  AVCodec *codec = <span class="hljs-literal">NULL</span>;<font></font>
  SDL_AudioSpec wanted_spec, spec;<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(stream_index &lt; <span class="hljs-number">0</span> || stream_index &gt;= pFormatCtx-&gt;nb_streams) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
<font></font>
  codec = avcodec_find_decoder(pFormatCtx-&gt;streams[stream_index]-&gt;codec-&gt;codec_id);<font></font>
  <span class="hljs-keyword">if</span>(!codec) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unsupported codec!\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
<font></font>
  codecCtx = avcodec_alloc_context3(codec);<font></font>
  <span class="hljs-keyword">if</span>(avcodec_copy_context(codecCtx, pFormatCtx-&gt;streams[stream_index]-&gt;codec) != <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Couldn't copy codec context"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Error copying codec context</span><font></font>
  }<font></font>
<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(codecCtx-&gt;codec_type == AVMEDIA_TYPE_AUDIO) {
    <span class="hljs-comment">// Set audio settings from codec info</span><font></font>
    wanted_spec.freq = codecCtx-&gt;sample_rate;<font></font>
    wanted_spec.format = AUDIO_S16SYS;<font></font>
    wanted_spec.channels = codecCtx-&gt;channels;<font></font>
    wanted_spec.silence = <span class="hljs-number">0</span>;<font></font>
    wanted_spec.samples = SDL_AUDIO_BUFFER_SIZE;<font></font>
    wanted_spec.callback = audio_callback;<font></font>
    wanted_spec.userdata = is;<font></font>
    <font></font>
    <span class="hljs-keyword">if</span>(SDL_OpenAudio(&amp;wanted_spec, &amp;spec) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"SDL_OpenAudio: %s\n"</span>, SDL_GetError());
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
    is-&gt;audio_hw_buf_size = spec.size;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span>(avcodec_open2(codecCtx, codec, <span class="hljs-literal">NULL</span>) &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unsupported codec!\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">switch</span>(codecCtx-&gt;codec_type) {
  <span class="hljs-keyword">case</span> AVMEDIA_TYPE_AUDIO:<font></font>
    is-&gt;audioStream = stream_index;<font></font>
    is-&gt;audio_st = pFormatCtx-&gt;streams[stream_index];<font></font>
    is-&gt;audio_ctx = codecCtx;<font></font>
    is-&gt;audio_buf_size = <span class="hljs-number">0</span>;<font></font>
    is-&gt;audio_buf_index = <span class="hljs-number">0</span>;
    <span class="hljs-built_in">memset</span>(&amp;is-&gt;audio_pkt, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(is-&gt;audio_pkt));<font></font>
    packet_queue_init(&amp;is-&gt;audioq);<font></font>
    SDL_PauseAudio(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> AVMEDIA_TYPE_VIDEO:<font></font>
    is-&gt;videoStream = stream_index;<font></font>
    is-&gt;video_st = pFormatCtx-&gt;streams[stream_index];<font></font>
    is-&gt;video_ctx = codecCtx;<font></font>
<font></font>
    is-&gt;frame_timer = (<span class="hljs-keyword">double</span>)av_gettime() / <span class="hljs-number">1000000.0</span>;<font></font>
    is-&gt;frame_last_delay = <span class="hljs-number">40e-3</span>;<font></font>
    is-&gt;video_current_pts_time = av_gettime();<font></font>
<font></font>
    packet_queue_init(&amp;is-&gt;videoq);<font></font>
    is-&gt;video_tid = SDL_CreateThread(video_thread, is);<font></font>
    is-&gt;sws_ctx = sws_getContext(is-&gt;video_ctx-&gt;width, is-&gt;video_ctx-&gt;height,<font></font>
				 is-&gt;video_ctx-&gt;pix_fmt, is-&gt;video_ctx-&gt;width,<font></font>
				 is-&gt;video_ctx-&gt;height, PIX_FMT_YUV420P,<font></font>
				 SWS_BILINEAR, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span><font></font>
				 );<font></font>
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">default</span>:
    <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">decode_thread</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span> </span>{<font></font>
<font></font>
  VideoState *is = (VideoState *)arg;<font></font>
  AVFormatContext *pFormatCtx;<font></font>
  AVPacket pkt1, *packet = &amp;pkt1;<font></font>
<font></font>
  <span class="hljs-keyword">int</span> video_index = <span class="hljs-number">-1</span>;
  <span class="hljs-keyword">int</span> audio_index = <span class="hljs-number">-1</span>;
  <span class="hljs-keyword">int</span> i;<font></font>
<font></font>
  is-&gt;videoStream=<span class="hljs-number">-1</span>;<font></font>
  is-&gt;audioStream=<span class="hljs-number">-1</span>;<font></font>
<font></font>
  global_video_state = is;<font></font>
<font></font>
  <span class="hljs-comment">// Open video file</span>
  <span class="hljs-keyword">if</span>(avformat_open_input(&amp;pFormatCtx, is-&gt;filename, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>)!=<span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Couldn't open file</span><font></font>
<font></font>
  is-&gt;pFormatCtx = pFormatCtx;<font></font>
  <font></font>
  <span class="hljs-comment">// Retrieve stream information</span>
  <span class="hljs-keyword">if</span>(avformat_find_stream_info(pFormatCtx, <span class="hljs-literal">NULL</span>)&lt;<span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Couldn't find stream information</span><font></font>
  <font></font>
  <span class="hljs-comment">// Dump information about file onto standard error</span>
  av_dump_format(pFormatCtx, <span class="hljs-number">0</span>, is-&gt;filename, <span class="hljs-number">0</span>);<font></font>
  <font></font>
  <span class="hljs-comment">// Find the first video stream</span><font></font>
<font></font>
  <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;pFormatCtx-&gt;nb_streams; i++) {
    <span class="hljs-keyword">if</span>(pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type==AVMEDIA_TYPE_VIDEO &amp;&amp;<font></font>
       video_index &lt; <span class="hljs-number">0</span>) {<font></font>
      video_index=i;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type==AVMEDIA_TYPE_AUDIO &amp;&amp;<font></font>
       audio_index &lt; <span class="hljs-number">0</span>) {<font></font>
      audio_index=i;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span>(audio_index &gt;= <span class="hljs-number">0</span>) {<font></font>
    stream_component_open(is, audio_index);<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span>(video_index &gt;= <span class="hljs-number">0</span>) {<font></font>
    stream_component_open(is, video_index);<font></font>
  }   <font></font>
<font></font>
  <span class="hljs-keyword">if</span>(is-&gt;videoStream &lt; <span class="hljs-number">0</span> || is-&gt;audioStream &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"%s: could not open codecs\n"</span>, is-&gt;filename);
    <span class="hljs-keyword">goto</span> fail;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// main decode loop</span><font></font>
<font></font>
  <span class="hljs-keyword">for</span>(;;) {
    <span class="hljs-keyword">if</span>(is-&gt;quit) {
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
    <span class="hljs-comment">// seek stuff goes here</span>
    <span class="hljs-keyword">if</span>(is-&gt;seek_req) {
      <span class="hljs-keyword">int</span> stream_index= <span class="hljs-number">-1</span>;
      <span class="hljs-keyword">int64_t</span> seek_target = is-&gt;seek_pos;<font></font>
<font></font>
      <span class="hljs-keyword">if</span>     (is-&gt;videoStream &gt;= <span class="hljs-number">0</span>) stream_index = is-&gt;videoStream;
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(is-&gt;audioStream &gt;= <span class="hljs-number">0</span>) stream_index = is-&gt;audioStream;<font></font>
<font></font>
      <span class="hljs-keyword">if</span>(stream_index&gt;=<span class="hljs-number">0</span>){<font></font>
	seek_target= av_rescale_q(seek_target, AV_TIME_BASE_Q,<font></font>
				  pFormatCtx-&gt;streams[stream_index]-&gt;time_base);<font></font>
      }<font></font>
      <span class="hljs-keyword">if</span>(av_seek_frame(is-&gt;pFormatCtx, stream_index, <font></font>
		       seek_target, is-&gt;seek_flags) &lt; <span class="hljs-number">0</span>) {
	<span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"%s: error while seeking\n"</span>,<font></font>
		is-&gt;pFormatCtx-&gt;filename);<font></font>
      } <span class="hljs-keyword">else</span> {<font></font>
<font></font>
	<span class="hljs-keyword">if</span>(is-&gt;audioStream &gt;= <span class="hljs-number">0</span>) {<font></font>
	  packet_queue_flush(&amp;is-&gt;audioq);<font></font>
	  packet_queue_put(&amp;is-&gt;audioq, &amp;flush_pkt);<font></font>
	}<font></font>
	<span class="hljs-keyword">if</span>(is-&gt;videoStream &gt;= <span class="hljs-number">0</span>) {<font></font>
	  packet_queue_flush(&amp;is-&gt;videoq);<font></font>
	  packet_queue_put(&amp;is-&gt;videoq, &amp;flush_pkt);<font></font>
	}<font></font>
      }<font></font>
      is-&gt;seek_req = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span>(is-&gt;audioq.size &gt; MAX_AUDIOQ_SIZE ||<font></font>
       is-&gt;videoq.size &gt; MAX_VIDEOQ_SIZE) {<font></font>
      SDL_Delay(<span class="hljs-number">10</span>);
      <span class="hljs-keyword">continue</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(av_read_frame(is-&gt;pFormatCtx, packet) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">if</span>(is-&gt;pFormatCtx-&gt;pb-&gt;error == <span class="hljs-number">0</span>) {<font></font>
	SDL_Delay(<span class="hljs-number">100</span>); <span class="hljs-comment">/* no error; wait for user input */</span>
	<span class="hljs-keyword">continue</span>;<font></font>
      } <span class="hljs-keyword">else</span> {
	<span class="hljs-keyword">break</span>;<font></font>
      }<font></font>
    }<font></font>
    <span class="hljs-comment">// Is this a packet from the video stream?</span>
    <span class="hljs-keyword">if</span>(packet-&gt;stream_index == is-&gt;videoStream) {<font></font>
      packet_queue_put(&amp;is-&gt;videoq, packet);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(packet-&gt;stream_index == is-&gt;audioStream) {<font></font>
      packet_queue_put(&amp;is-&gt;audioq, packet);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      av_free_packet(packet);<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-comment">/* all done - wait for it */</span>
  <span class="hljs-keyword">while</span>(!is-&gt;quit) {<font></font>
    SDL_Delay(<span class="hljs-number">100</span>);<font></font>
  }<font></font>
<font></font>
 fail:<font></font>
  <span class="hljs-keyword">if</span>(<span class="hljs-number">1</span>){<font></font>
    SDL_Event event;<font></font>
    event.type = FF_QUIT_EVENT;<font></font>
    event.user.data1 = is;<font></font>
    SDL_PushEvent(&amp;event);<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">stream_seek</span><span class="hljs-params">(VideoState *is, <span class="hljs-keyword">int64_t</span> pos, <span class="hljs-keyword">int</span> rel)</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(!is-&gt;seek_req) {<font></font>
    is-&gt;seek_pos = pos;<font></font>
    is-&gt;seek_flags = rel &lt; <span class="hljs-number">0</span> ? AVSEEK_FLAG_BACKWARD : <span class="hljs-number">0</span>;<font></font>
    is-&gt;seek_req = <span class="hljs-number">1</span>;<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span> </span>{<font></font>
<font></font>
  SDL_Event       event;<font></font>
<font></font>
  VideoState      *is;<font></font>
<font></font>
  is = av_mallocz(<span class="hljs-keyword">sizeof</span>(VideoState));<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(argc &lt; <span class="hljs-number">2</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Usage: test &lt;file&gt;\n"</span>);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<font></font>
  }<font></font>
  <span class="hljs-comment">// Register all formats and codecs</span><font></font>
  av_register_all();<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>(SDL_Init(SDL_INIT_VIDEO | SDL_INIT_AUDIO | SDL_INIT_TIMER)) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Could not initialize SDL - %s\n"</span>, SDL_GetError());
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// Make a screen to put our video</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> __DARWIN__</span>
        screen = SDL_SetVideoMode(<span class="hljs-number">640</span>, <span class="hljs-number">480</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
        screen = SDL_SetVideoMode(<span class="hljs-number">640</span>, <span class="hljs-number">480</span>, <span class="hljs-number">24</span>, <span class="hljs-number">0</span>);
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
  <span class="hljs-keyword">if</span>(!screen) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"SDL: could not set video mode - exiting\n"</span>);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<font></font>
  }<font></font>
<font></font>
  screen_mutex = SDL_CreateMutex();<font></font>
<font></font>
  av_strlcpy(is-&gt;filename, argv[<span class="hljs-number">1</span>], <span class="hljs-keyword">sizeof</span>(is-&gt;filename));<font></font>
<font></font>
  is-&gt;pictq_mutex = SDL_CreateMutex();<font></font>
  is-&gt;pictq_cond = SDL_CreateCond();<font></font>
<font></font>
  schedule_refresh(is, <span class="hljs-number">40</span>);<font></font>
<font></font>
  is-&gt;av_sync_type = DEFAULT_AV_SYNC_TYPE;<font></font>
  is-&gt;parse_tid = SDL_CreateThread(decode_thread, is);<font></font>
  <span class="hljs-keyword">if</span>(!is-&gt;parse_tid) {<font></font>
    av_free(is);<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
<font></font>
  av_init_packet(&amp;flush_pkt);<font></font>
  flush_pkt.data = <span class="hljs-string">"FLUSH"</span>;<font></font>
<font></font>
  <span class="hljs-keyword">for</span>(;;) {
    <span class="hljs-keyword">double</span> incr, pos;<font></font>
    SDL_WaitEvent(&amp;event);<font></font>
    <span class="hljs-keyword">switch</span>(event.type) {
    <span class="hljs-keyword">case</span> SDL_KEYDOWN:
      <span class="hljs-keyword">switch</span>(event.key.keysym.sym) {
      <span class="hljs-keyword">case</span> SDLK_LEFT:<font></font>
	incr = <span class="hljs-number">-10.0</span>;
	<span class="hljs-keyword">goto</span> do_seek;
      <span class="hljs-keyword">case</span> SDLK_RIGHT:<font></font>
	incr = <span class="hljs-number">10.0</span>;
	<span class="hljs-keyword">goto</span> do_seek;
      <span class="hljs-keyword">case</span> SDLK_UP:<font></font>
	incr = <span class="hljs-number">60.0</span>;
	<span class="hljs-keyword">goto</span> do_seek;
      <span class="hljs-keyword">case</span> SDLK_DOWN:<font></font>
	incr = <span class="hljs-number">-60.0</span>;
	<span class="hljs-keyword">goto</span> do_seek;<font></font>
      do_seek:<font></font>
	<span class="hljs-keyword">if</span>(global_video_state) {<font></font>
	  pos = get_master_clock(global_video_state);<font></font>
	  pos += incr;<font></font>
	  stream_seek(global_video_state, (<span class="hljs-keyword">int64_t</span>)(pos * AV_TIME_BASE), incr);<font></font>
	}<font></font>
	<span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">default</span>:
	<span class="hljs-keyword">break</span>;<font></font>
      }<font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> FF_QUIT_EVENT:
    <span class="hljs-keyword">case</span> SDL_QUIT:<font></font>
      is-&gt;quit = <span class="hljs-number">1</span>;
      <span class="hljs-comment">/*
       * If the video has finished playing, then both the picture and
       * audio queues are waiting for more data.  Make them stop
       * waiting and terminate normally.
       */</span><font></font>
      SDL_CondSignal(is-&gt;audioq.cond);<font></font>
      SDL_CondSignal(is-&gt;videoq.cond);<font></font>
      SDL_Quit();<font></font>
      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> FF_REFRESH_EVENT:<font></font>
      video_refresh_timer(event.user.data1);<font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">default</span>:
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
<font></font>
}<font></font>
</code></pre></div>
                    </div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœç´¢å‘½ä»¤å¤„ç†</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæˆ‘ä»¬å°†åœ¨æ’­æ”¾å™¨ä¸­æ·»åŠ ä¸€äº›æœç´¢åŠŸèƒ½ï¼Œå› ä¸ºå½“æ‚¨æ— æ³•å€’å¸¦å½±ç‰‡æ—¶ï¼Œè¿™ç¡®å®å¾ˆçƒ¦äººã€‚å¦å¤–ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä½¿ç”¨</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_seek_frame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡½æ•°æ˜¯å¤šä¹ˆå®¹æ˜“</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å°†ä½¿é”®ç›˜ä¸Šçš„ç®­å¤´â€œå‘å·¦â€å’Œâ€œå‘å³â€å‘å‰æˆ–å‘åæ»šåŠ¨ä¸€ç‚¹ï¼Œè€Œâ€œå‘ä¸Šâ€å’Œâ€œå‘ä¸‹â€ç®­å¤´å·²ç»æ›´åŠ é‡è¦ã€‚ â€œä¸€ç‚¹â€-å°†æ˜¯10ç§’ï¼Œâ€œå¾ˆå¤šâ€-å…¨éƒ¨æ˜¯60ç§’ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®ä¸»å¾ªç¯ï¼Œä»¥ä¾¿å®ƒæ‹¦æˆªå‡»é”®äº‹ä»¶ã€‚ä½†æ˜¯äº‹å®æ˜¯ï¼Œå½“æˆ‘ä»¬å‡»é”®æ—¶ï¼Œæˆ‘ä»¬æ— æ³•</font><font style="vertical-align: inherit;">ç›´æ¥</font><font style="vertical-align: inherit;">è°ƒç”¨</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_seek_frame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚è¿™å¿…é¡»åœ¨æˆ‘ä»¬çš„ä¸»è§£ç å¾ªç¯ä¸­</font><b><font style="vertical-align: inherit;">decode_thread</font></b><font style="vertical-align: inherit;">å¾ªç¯ä¸­å®Œæˆ</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œç›¸åï¼Œæˆ‘ä»¬å°†åœ¨ä¸»ç»“æ„ä¸­æ·»åŠ ä¸€äº›å€¼ï¼Œå…¶ä¸­å°†åŒ…å«æœç´¢çš„æ–°ä½ç½®å’Œä¸€äº›æœç´¢æ ‡å¿—ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-keyword">int</span>             seek_req;
  <span class="hljs-keyword">int</span>             seek_flags;
  <span class="hljs-keyword">int64_t</span>         seek_pos;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®æ•è·æŒ‰é”®çš„ä¸»å¾ªç¯ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-keyword">for</span>(;;) {
    <span class="hljs-keyword">double</span> incr, pos;<font></font>
<font></font>
    SDL_WaitEvent(&amp;event);<font></font>
    <span class="hljs-keyword">switch</span>(event.type) {
    <span class="hljs-keyword">case</span> SDL_KEYDOWN:
      <span class="hljs-keyword">switch</span>(event.key.keysym.sym) {
      <span class="hljs-keyword">case</span> SDLK_LEFT:<font></font>
	incr = <span class="hljs-number">-10.0</span>;
	<span class="hljs-keyword">goto</span> do_seek;
      <span class="hljs-keyword">case</span> SDLK_RIGHT:<font></font>
	incr = <span class="hljs-number">10.0</span>;
	<span class="hljs-keyword">goto</span> do_seek;
      <span class="hljs-keyword">case</span> SDLK_UP:<font></font>
	incr = <span class="hljs-number">60.0</span>;
	<span class="hljs-keyword">goto</span> do_seek;
      <span class="hljs-keyword">case</span> SDLK_DOWN:<font></font>
	incr = <span class="hljs-number">-60.0</span>;
	<span class="hljs-keyword">goto</span> do_seek;<font></font>
      do_seek:<font></font>
	<span class="hljs-keyword">if</span>(global_video_state) {<font></font>
	  pos = get_master_clock(global_video_state);<font></font>
	  pos += incr;<font></font>
	  stream_seek(global_video_state, <font></font>
                      (<span class="hljs-keyword">int64_t</span>)(pos * AV_TIME_BASE), incr);<font></font>
	}<font></font>
	<span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">default</span>:
	<span class="hljs-keyword">break</span>;<font></font>
      }<font></font>
      <span class="hljs-keyword">break</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¦æ•è·æŒ‰é”®ï¼Œé¦–å…ˆæˆ‘ä»¬æŸ¥çœ‹æ˜¯å¦</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘ç”Ÿ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">äº†</font><b><font style="vertical-align: inherit;">SDL_KEYDOWN</font></b><font style="vertical-align: inherit;">äº‹ä»¶</font><font style="vertical-align: inherit;">ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨</font></font><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">event.key.keysym.sym</font></font></b></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ£€æŸ¥æ¥æ”¶åˆ°å“ªä¸ªå¯†é’¥</font><font style="vertical-align: inherit;">ã€‚ä¸€æ—¦æ‰¾å‡ºäº†æ‰€è¦å¯»æ‰¾çš„æ–¹å‘ï¼Œæˆ‘ä»¬ä¾¿ä¼šè®¡ç®—ä¸€ä¸ªæ–°æ—¶é—´ï¼Œå¹¶ä¸ºæ–°</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_master_clock</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡½æ•°çš„å€¼å¢åŠ ä¸€ä¸ªå¢é‡</font><font style="vertical-align: inherit;">ã€‚ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stream_seek</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡½æ•°</font><font style="vertical-align: inherit;">æ¥è®¾ç½®</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seek_posçš„</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å€¼</font><font style="vertical-align: inherit;">ï¼Œç­‰ç­‰ã€‚å°†æˆ‘ä»¬çš„æ–°æ—¶é—´è½¬æ¢ä¸º</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avcodec</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å†…éƒ¨æ—¶é—´æˆ³</font><b><font style="vertical-align: inherit;">å•ä½</font></b><font style="vertical-align: inherit;">ã€‚å›æƒ³ä¸€ä¸‹ï¼Œæµä¸­çš„æ—¶é—´æˆ³ä½¿ç”¨ä»¥ä¸‹å…¬å¼ä»¥å¸§è€Œä¸æ˜¯ç§’ä¸ºå•ä½è¿›è¡Œåº¦é‡ï¼š</font></font><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§’</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¸§</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">time_base</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fps</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã€‚</font></font></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é»˜è®¤æƒ…å†µä¸‹ï¼Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avcodec</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®¾ç½®ä¸ºæ¯ç§’1,000,000å¸§ï¼ˆå› æ­¤2ç§’çš„ä½ç½®å°†å…·æœ‰2,000,000çš„æ—¶é—´æˆ³ï¼‰ã€‚ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦è½¬æ¢æ­¤å€¼-ç¨åè¯·å‚è§ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯æˆ‘ä»¬çš„</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stream_seek</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡½æ•°</font><font style="vertical-align: inherit;">ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœè¿”å›ï¼Œåˆ™è®¾ç½®æ ‡å¿—ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">stream_seek</span><span class="hljs-params">(VideoState *is, <span class="hljs-keyword">int64_t</span> pos, <span class="hljs-keyword">int</span> rel)</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(!is-&gt;seek_req) {<font></font>
    is-&gt;seek_pos = pos;<font></font>
    is-&gt;seek_flags = rel &lt; <span class="hljs-number">0</span> ? AVSEEK_FLAG_BACKWARD : <span class="hljs-number">0</span>;<font></font>
    is-&gt;seek_req = <span class="hljs-number">1</span>;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç»§ç»­è¿›è¡Œæˆ‘ä»¬çš„</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è§£ç _thread</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œæˆ‘ä»¬å®é™…ä¸Šåœ¨å…¶ä¸­æ‰§è¡Œæœç´¢ã€‚åœ¨æºæ–‡ä»¶ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²å°†åŒºåŸŸæ ‡è®°ä¸ºâ€œæœç´¢æ­£åœ¨è¿›è¡Œä¸­â€ã€‚å¥½å§ï¼Œæˆ‘ä»¬ç°åœ¨è¦æŠŠå®ƒæ”¾åœ¨é‚£é‡Œã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœç´¢ä»¥</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_seek_frame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡½æ•°ä¸ºä¸­å¿ƒ</font><font style="vertical-align: inherit;">ã€‚æ­¤å‡½æ•°å°†æ ¼å¼ä¸Šä¸‹æ–‡ï¼Œæµï¼Œæ—¶é—´æˆ³å’Œæ ‡å¿—é›†ä½œä¸ºå‚æ•°ã€‚è¯¥å‡½æ•°å°†æŸ¥æ‰¾æ‚¨ç»™å®ƒçš„æ—¶é—´æˆ³ã€‚æ—¶é—´æˆ³çš„å•ä½æ˜¯</font><font style="vertical-align: inherit;">æ‚¨ä¼ é€’ç»™å‡½æ•°</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æµ</font><font style="vertical-align: inherit;">çš„</font><b><font style="vertical-align: inherit;">time_base</font></b><font style="vertical-align: inherit;">ã€‚ä½†æ˜¯ï¼Œæ‚¨ä¸éœ€è¦å°†å…¶ä¼ é€’åˆ°æµï¼ˆé€šè¿‡ä¼ é€’å€¼-1è¡¨ç¤ºï¼‰ã€‚å¦‚æœæ‰§è¡Œæ­¤æ“ä½œï¼Œåˆ™</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">time_base</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†ä½äº</font><b><font style="vertical-align: inherit;">avcodec</font></b><font style="vertical-align: inherit;">å†…éƒ¨æ—¶é—´</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å•ä½ä¸­</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ–1000000fpsã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬</font><font style="vertical-align: inherit;">åœ¨è®¾ç½®</font><b><font style="vertical-align: inherit;">seek_pos</font></b><font style="vertical-align: inherit;">æ—¶å°†</font><font style="vertical-align: inherit;">ä½ç½®ä¹˜ä»¥</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AV_TIME_BASEçš„</font></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŸå› </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯ï¼Œæœ‰æ—¶å€™ï¼Œå¦‚æœ</font><font style="vertical-align: inherit;">ä¸ºæµ</font><font style="vertical-align: inherit;">ä¼ é€’</font></font><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_seek_frame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -1</font></font></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå¯èƒ½ä¼šï¼ˆå¾ˆå°‘ï¼‰é‡åˆ°æŸäº›æ–‡ä»¶é—®é¢˜</font><font style="vertical-align: inherit;">ï¼Œå› æ­¤æˆ‘ä»¬å°†é€‰æ‹©æ–‡ä»¶ä¸­çš„ç¬¬ä¸€ä¸ªæµå¹¶å°†å…¶ä¼ é€’ç»™</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_seek_frame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚ä¸è¦å¿˜è®°ï¼Œæˆ‘ä»¬å¿…é¡»æ›´æ”¹æ—¶é—´æˆ³çš„æ¯”ä¾‹ï¼Œæ‰èƒ½ä½¿ç”¨æ–°çš„â€œåæ ‡ç³»â€ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">if</span>(is-&gt;seek_req) {
  <span class="hljs-keyword">int</span> stream_index= <span class="hljs-number">-1</span>;
  <span class="hljs-keyword">int64_t</span> seek_target = is-&gt;seek_pos;<font></font>
<font></font>
  <span class="hljs-keyword">if</span>     (is-&gt;videoStream &gt;= <span class="hljs-number">0</span>) stream_index = is-&gt;videoStream;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(is-&gt;audioStream &gt;= <span class="hljs-number">0</span>) stream_index = is-&gt;audioStream;<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(stream_index&gt;=<span class="hljs-number">0</span>){<font></font>
    seek_target= av_rescale_q(seek_target, AV_TIME_BASE_Q,<font></font>
                      pFormatCtx-&gt;streams[stream_index]-&gt;time_base);<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span>(av_seek_frame(is-&gt;pFormatCtx, stream_index, <font></font>
                    seek_target, is-&gt;seek_flags) &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"%s: error while seeking\n"</span>,<font></font>
            is-&gt;pFormatCtx-&gt;filename);<font></font>
  } <span class="hljs-keyword">else</span> {
     <span class="hljs-comment">/* handle packet queues... more later... */</span>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_rescale_q</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰æ˜¯ä¸€ä¸ªå°†æ—¶é—´æˆ³ä»ä¸€ä¸ªåŸºå‡†ç¼©æ”¾åˆ°å¦ä¸€ä¸ªåŸºå‡†çš„å‡½æ•°ã€‚å®ƒåŸºæœ¬ä¸Šè®¡ç®—</font></font><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c</font></font></b></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä½†æ˜¯æ­¤å‡½æ•°æ´¾ä¸Šç”¨åœºï¼Œå› ä¸ºæ­¤è®¡ç®—æœ‰æ—¶ä¼šå¯¼è‡´æº¢å‡ºã€‚</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AV_TIME_BASE_Q</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯ä¸€ä¸ªå°æ•°ç‰ˆæœ¬</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AV_TIME_BASE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚å®ƒä»¬æ˜¯å®Œå…¨ä¸åŒçš„ï¼š</font></font><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AV_TIME_BASE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">time_in_seconds</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avcodec_timestamp</font></font></b></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AV_TIME_BASE_Q</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avcodec_timestamp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">time_in_seconds</font></font></b></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆä½†è¯·æ³¨æ„ï¼Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AV_TIME_BASE_Q</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®é™…ä¸Šæ˜¯</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVRational</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹è±¡</font><font style="vertical-align: inherit;">ï¼Œå› æ­¤æ‚¨éœ€è¦</font><font style="vertical-align: inherit;">åœ¨</font><b><font style="vertical-align: inherit;">avcodecä¸­</font></b><font style="vertical-align: inherit;">ä½¿ç”¨ç‰¹æ®Šçš„</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">q</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡½æ•°</font><font style="vertical-align: inherit;">æ¥å¤„ç†å®ƒï¼‰ã€‚</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¼“å†²æ¶²æ¸…æ´—</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å› æ­¤ï¼Œæˆ‘ä»¬æ­£ç¡®è®¾ç½®äº†æœç´¢ï¼Œä½†å°šæœªå®Œæˆã€‚è®°ä½ï¼Œæˆ‘ä»¬æ˜¯å¦é…ç½®äº†ä¸€ä¸ªé˜Ÿåˆ—æ¥ç´¯ç§¯æ•°æ®åŒ…ï¼Ÿç°åœ¨æˆ‘ä»¬å¤„äºä¸åŒçš„æ—¶é—´æˆ³ï¼Œæˆ‘ä»¬éœ€è¦æ¸…é™¤æ­¤é˜Ÿåˆ—ï¼Œå¦åˆ™ç”µå½±ä¸­çš„æœç´¢å°†æ— æ³•è¿›è¡Œï¼æ­¤å¤–ï¼Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avcodec</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…·æœ‰è‡ªå·±çš„å†…éƒ¨ç¼“å†²åŒºï¼Œè¿˜éœ€è¦ä¸ºæ¯ä¸ªæµåˆ·æ–°è¯¥ç¼“å†²åŒºã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºæ­¤ï¼Œæ‚¨å¿…é¡»é¦–å…ˆç¼–å†™ä¸€ä¸ªæ¸…é™¤åŒ…é˜Ÿåˆ—çš„å‡½æ•°ã€‚ç„¶åï¼Œæ‚¨éœ€è¦ä»¥æŸç§æ–¹å¼æŒ‡ç¤ºéŸ³é¢‘å’Œè§†é¢‘æµæ¸…é™¤äº†</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avcodec</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å†…éƒ¨ç¼“å†²åŒº</font><font style="vertical-align: inherit;">ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨æ¸…ç†ååœ¨é˜Ÿåˆ—ä¸­æ”¾ç½®ä¸€ä¸ªç‰¹æ®Šçš„æ•°æ®åŒ…æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œå½“ä»–ä»¬ï¼ˆçº¿ç¨‹ï¼‰å‘ç°æ­¤ç‰¹æ®Šæ•°æ®åŒ…æ—¶ï¼Œä»–ä»¬å°†ç®€å•åœ°æ¸…é™¤å…¶ç¼“å†²åŒºã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬ä»é‡ç½®åŠŸèƒ½å¼€å§‹ã€‚</font><font style="vertical-align: inherit;">è¿™ç¡®å®éå¸¸ç®€å•ï¼Œæ‰€ä»¥æˆ‘åªå‘æ‚¨å±•ç¤ºä»£ç ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">packet_queue_flush</span><span class="hljs-params">(PacketQueue *q)</span> </span>{<font></font>
  AVPacketList *pkt, *pkt1;<font></font>
<font></font>
  SDL_LockMutex(q-&gt;mutex);<font></font>
  <span class="hljs-keyword">for</span>(pkt = q-&gt;first_pkt; pkt != <span class="hljs-literal">NULL</span>; pkt = pkt1) {<font></font>
    pkt1 = pkt-&gt;next;<font></font>
    av_free_packet(&amp;pkt-&gt;pkt);<font></font>
    av_freep(&amp;pkt);<font></font>
  }<font></font>
  q-&gt;last_pkt = <span class="hljs-literal">NULL</span>;<font></font>
  q-&gt;first_pkt = <span class="hljs-literal">NULL</span>;<font></font>
  q-&gt;nb_packets = <span class="hljs-number">0</span>;<font></font>
  q-&gt;size = <span class="hljs-number">0</span>;<font></font>
  SDL_UnlockMutex(q-&gt;mutex);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œé˜Ÿåˆ—å·²æ¸…é™¤ï¼Œæ·»åŠ æˆ‘ä»¬çš„â€œæ¸…ç†åŒ…â€ã€‚</font><font style="vertical-align: inherit;">ä½†é¦–å…ˆï¼Œæœ€å¥½å®šä¹‰å®ƒå¹¶åˆ›å»ºå®ƒï¼š</font></font><br>
<br>
<pre><code class="cpp hljs">AVPacket flush_pkt;<font></font>
<font></font>
main() {<font></font>
  ...<font></font>
  av_init_packet(&amp;flush_pkt);<font></font>
  flush_pkt.data = <span class="hljs-string">"FLUSH"</span>;<font></font>
  ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨å°†æ­¤åŒ…æ”¾å…¥é˜Ÿåˆ—ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs">  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">if</span>(is-&gt;audioStream &gt;= <span class="hljs-number">0</span>) {<font></font>
      packet_queue_flush(&amp;is-&gt;audioq);<font></font>
      packet_queue_put(&amp;is-&gt;audioq, &amp;flush_pkt);<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(is-&gt;videoStream &gt;= <span class="hljs-number">0</span>) {<font></font>
      packet_queue_flush(&amp;is-&gt;videoq);<font></font>
      packet_queue_put(&amp;is-&gt;videoq, &amp;flush_pkt);<font></font>
    }<font></font>
  }<font></font>
  is-&gt;seek_req = <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ï¼ˆæ­¤ä»£ç æ®µå»¶ç»­äº†ä¸Šè¿°</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code_codeçš„</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»£ç æ®µ</font><font style="vertical-align: inherit;">ã€‚ï¼‰æˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">packet_queue_putï¼Œ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥å…é‡å¤ç”¨äºæ¸…æ´—çš„ç‰¹æ®Šç¨‹åºåŒ…ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">packet_queue_put</span><span class="hljs-params">(PacketQueue *q, AVPacket *pkt)</span> </span>{<font></font>
<font></font>
  AVPacketList *pkt1;<font></font>
  <span class="hljs-keyword">if</span>(pkt != &amp;flush_pkt &amp;&amp; av_dup_packet(pkt) &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç„¶ååœ¨éŸ³é¢‘å’Œè§†é¢‘æµä¸­ï¼Œæˆ‘ä»¬åœ¨</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">packet_queue_get</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¹‹å</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç´§æ¥ç€</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†æ­¤è°ƒç”¨æ”¾å…¥</font><b><font style="vertical-align: inherit;">avcodec_flush_buffersä¸­</font></b><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs">    <span class="hljs-keyword">if</span>(packet_queue_get(&amp;is-&gt;audioq, pkt, <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(pkt-&gt;data == flush_pkt.data) {<font></font>
      avcodec_flush_buffers(is-&gt;audio_st-&gt;codec);<font></font>
      <span class="hljs-keyword">continue</span>;<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸Šé¢çš„ä»£ç æ®µä¸è§†é¢‘æµå®Œå…¨ç›¸åŒï¼Œåªæ˜¯ç”¨â€œè§†é¢‘â€ä»£æ›¿äº†â€œéŸ³é¢‘â€ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°±æ˜¯è¿™ä¸ªï¼</font><font style="vertical-align: inherit;">æˆ‘ä»¬åšåˆ°äº†ï¼</font><font style="vertical-align: inherit;">ç¼–è¯‘æ’­æ”¾å™¨ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">gcc -o tutorial07 tutorial07.c -lavutil -lavformat -lavcodec -lswscale -lz -lm \<font></font>
`sdl-config --cflags --libs`</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¹¶äº«å—ä¸åˆ°1000è¡ŒCè¯­è¨€åˆ¶ä½œçš„ç”µå½±æ’­æ”¾å™¨â€‹â€‹ï¼</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°½ç®¡å½“ç„¶å¯ä»¥æ·»åŠ æˆ–æ”¹è¿›å¾ˆâ€‹â€‹å¤šä¸œè¥¿ã€‚</font></font><a name="epilogue"></a><br>
<br>
<hr><hr><hr><hr><hr><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åè®°</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="ç¬¬7è¯¾ï¼šæœç´¢"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â† </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="åˆ°ç›®å½•"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â‡‘ </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="é™„å½•1.åŠŸèƒ½æ¸…å•"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â†’</font></font></a></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å› æ­¤ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªèƒ½å¹²çš„çƒå‘˜ï¼Œä½†æ˜¯å½“ç„¶è¿™å¹¶ä¸å°½å¦‚äººæ„ã€‚</font><font style="vertical-align: inherit;">å¯ä»¥ä¿®æ”¹æ–‡ä»¶å¹¶æ·»åŠ è®¸å¤šæœ‰ç”¨çš„ä¸œè¥¿ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¢å¯¹ç°å®ï¼Œè¿™ä¸ªçƒå‘˜å¾ˆçƒ‚ã€‚</font><font style="vertical-align: inherit;">ffplay.cæ‰€åŸºäºçš„ç‰ˆæœ¬å·²å®Œå…¨è¿‡æ—¶ï¼Œå› æ­¤ï¼Œæœ¬æ•™ç¨‹éœ€è¦è¿›è¡Œå½»åº•ä¿®è®¢ã€‚</font><font style="vertical-align: inherit;">å¦‚æœè¦ä½¿ç”¨FFmpegåº“è¿›è¡Œæ›´é‡è¦çš„é¡¹ç›®ï¼Œå¼ºçƒˆå»ºè®®æ‚¨å°†ffplay.cçš„æœ€æ–°ç‰ˆæœ¬ä½œä¸ºä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä»£ç ä¸­çš„é”™è¯¯å¤„ç†éå¸¸ç³Ÿç³•ï¼Œå¯ä»¥æ›´å¥½åœ°å®ç°ã€‚</font></font></li>
<li>      ,  ,   ,     .   ,    <b>paused</b>    ,   ,    .   ,    ,      .     <b>av_read_play</b>.   -   ,     .  ,    ,       . : ,     ffplay.c.</li>
<li> .</li>
<li> .       ,    ,      ,    ,   <b>VOB-</b>.</li>
<li> .   ,        .</li>
<li> .       .</li>
<li>  ,   ,  ,      ,   <b>YUV</b>,             <b>time_base</b>.</li>
<li> .</li>
<li>--,    ;  ffplay.c      .</li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœæ‚¨æƒ³äº†è§£æœ‰å…³FFmpegçš„æ›´å¤šä¿¡æ¯ï¼Œé‚£ä¹ˆåœ¨è¿™é‡Œæˆ‘ä»¬å·²ç»è€ƒè™‘äº†è¿œéä¸€åˆ‡ã€‚ä¸‹ä¸€æ­¥æ˜¯ç ”ç©¶å¤šåª’ä½“ç¼–ç ã€‚æœ€å¥½ä»æ–‡ä»¶</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">output_example.c</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¼€å§‹</font><font style="vertical-align: inherit;">ï¼Œæ‚¨å¯ä»¥åœ¨FFmpegå‘è¡Œç‰ˆä¸­æ‰¾åˆ°</font><font style="vertical-align: inherit;">è¯¥æ–‡ä»¶</font><font style="vertical-align: inherit;">ã€‚æˆ‘å¯ä»¥å†™å¦ä¸€æœ¬æœ‰å…³è¯¥ä¸»é¢˜çš„æ•™ç§‘ä¹¦ï¼Œä½†å®ƒä¸å¯èƒ½è¶…è¶Šæœ¬æŒ‡å—ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPDã€‚</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¾ˆä¹…ä»¥å‰ï¼Œæˆ‘æ²¡æœ‰æ›´æ–°æœ¬æ–‡ï¼Œä½†ä¸æ­¤åŒæ—¶ï¼Œä¸–ç•Œå¹¶æ²¡æœ‰åœæ»ä¸å‰ã€‚æœ¬æ•™ç¨‹ä»…éœ€è¦ç®€å•çš„APIæ›´æ–°ã€‚åŸºæœ¬æ¦‚å¿µæ–¹é¢çš„å˜åŒ–å¾ˆå°ã€‚è¿™äº›æ›´æ–°å¤§å¤šæ•°å®é™…ä¸Šç®€åŒ–äº†ä»£ç ã€‚ä½†æ˜¯ï¼Œå°½ç®¡æˆ‘éå†äº†æ‰€æœ‰ä»£ç å¹¶å¯¹å…¶è¿›è¡Œäº†æ›´æ–°ï¼Œä½†FFplayä»ç„¶ä¼˜äºè¯¥ç©å…·æ’­æ”¾å™¨ã€‚å¦ç‡åœ°è¯´ï¼Œæˆ‘ä»¬æ‰¿è®¤ï¼šåœ¨è¿™äº›è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªéå¸¸ç³Ÿç³•çš„ç”µå½±æ’­æ”¾å™¨â€‹â€‹ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨ä»Šå¤©ï¼ˆæˆ–å°†æ¥ï¼‰æƒ³è¦æ”¹è¿›æœ¬æ•™ç¨‹ï¼Œå»ºè®®æ‚¨ç†Ÿæ‚‰FFplayå¹¶æ‰¾å‡ºç¼ºå°‘çš„å†…å®¹ã€‚æˆ‘è®¤ä¸ºè¿™ä¸»è¦æ¶‰åŠè§†é¢‘è®¾å¤‡çš„ä½¿ç”¨ï¼Œä½†æ˜¯å¾ˆå¯èƒ½æˆ‘ç¼ºå°‘å…¶ä»–æ˜æ˜¾çš„ä¸œè¥¿ã€‚ä¸å½“å‰çš„FFplayè¿›è¡Œæ¯”è¾ƒä¹Ÿè®¸ä¼šå¯¼è‡´æŸäº›äº‹æƒ…çš„å½»åº•æ”¹å†™-æˆ‘è¿˜æ²¡æœ‰çœ‹è¿‡å®ƒã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯æˆ‘æ„Ÿåˆ°éå¸¸è‡ªè±ªçš„æ˜¯ï¼Œå¤šå¹´æ¥ï¼Œå³ä½¿è€ƒè™‘åˆ°äººä»¬ç»å¸¸åœ¨å…¶ä»–åœ°æ–¹æœç´¢ä»£ç çš„äº‹å®ï¼Œæˆ‘çš„å·¥ä½œä¹Ÿæœ‰æ‰€å¸®åŠ©ã€‚</font><font style="vertical-align: inherit;">æˆ‘éå¸¸æ„Ÿè°¢</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è½¦é‡Œé›…å¤«ï¼ˆChelyaevï¼‰</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä»–æ‰¿æ‹…äº†è‡ªå…«å¹´å‰ç¼–å†™æœ¬ä¸“ç€ä»¥æ¥æ›´æ¢æ‰€æœ‰è¿‡æ—¶åŠŸèƒ½çš„ä¾‹è¡Œå·¥ä½œã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘å¾ˆé«˜å…´å¸Œæœ›è¿™äº›æ•™è®­å¯¹æˆ‘ä»¬æœ‰ç”¨ï¼Œè€Œä¸”ä¸ä¼šæ¯ç‡¥ã€‚</font><font style="vertical-align: inherit;">å¦‚æœå¯¹æœ¬æŒ‡å—æœ‰ä»»ä½•å»ºè®®ï¼Œé”™è¯¯ï¼ŒæŠ•è¯‰ï¼Œæ„Ÿè°¢ç­‰ï¼Œè¯·ç»™æˆ‘å‘é€ç”µå­é‚®ä»¶è‡³dranger dog gmail dot comã€‚</font><font style="vertical-align: inherit;">æ˜¯çš„ï¼Œè®©æˆ‘ä¸ºæ‚¨çš„FFmpegé¡¹ç›®æä¾›å¸®åŠ©æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚</font><font style="vertical-align: inherit;">ç±»ä¼¼çš„å­—æ¯</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤ªå¤š</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">äº†ã€‚</font></font><a name="functions"></a><br>
<br>
<hr><hr><hr><hr><hr><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é™„å½•1.åŠŸèƒ½åˆ—è¡¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="åè®°"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â† </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="åˆ°ç›®å½•"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â‡‘ </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="é™„å½•2.æ•°æ®ç»“æ„"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â†’</font></font></a></h2><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">avformat_open_input</span><span class="hljs-params">(AVFormatContext **ptr, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> * filename, AVInputFormat *fmt, AVDictionary **options)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‰“å¼€åª’ä½“æ–‡ä»¶çš„åç§°ï¼Œå°†æ ¼å¼ä¸Šä¸‹æ–‡ä¿å­˜åœ¨</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pträ¸­</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŒ‡å®šçš„åœ°å€ä¸­</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fmt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå¦‚æœä¸ä¸ºNULLï¼Œåˆ™è®¾ç½®æ–‡ä»¶æ ¼å¼ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buf_size</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šç¼“å†²åŒºå¤§å°ï¼ˆå¯é€‰ï¼‰ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">options</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šAVDictionaryå¡«å……äº†</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVFormatContext</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œå¤šè·¯åˆ†è§£å™¨</font><font style="vertical-align: inherit;">çš„å‚æ•°</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">avformat_close_input</span><span class="hljs-params">(AVFormatContext **s)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å…³é—­åª’ä½“æ–‡ä»¶ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå®ƒä¸ä¼šå…³é—­ç¼–è§£ç å™¨ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">nt <span class="hljs-title">avio_open2</span> <span class="hljs-params">(AVIOContext **s, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *url, <span class="hljs-keyword">int</span> flags, <span class="hljs-keyword">const</span> AVIOInterruptCB *int_cb, AVDictionary **options)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆ›å»ºä¸€ä¸ªI / Oä¸Šä¸‹æ–‡ä»¥ä½¿ç”¨</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">urlä¸­</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŒ‡å®šçš„èµ„æº</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæŒ‡å‘å°†åˆ›å»º</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVIOContext</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„ä½ç½®çš„æŒ‡é’ˆ</font><font style="vertical-align: inherit;">ã€‚å¦‚æœå¤±è´¥ï¼Œåˆ™å°†æŒ‡å®šå€¼è®¾ç½®ä¸ºNULLã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">url</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šè¦è®¿é—®çš„èµ„æºçš„åç§°ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ‡å¿—</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ§åˆ¶</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">urlä¸­</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŒ‡å®šçš„èµ„æºçš„æ‰“å¼€</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int_cb</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šç”¨äºåè®®çº§åˆ«ä½¿ç”¨çš„ä¸­æ–­å›è°ƒã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">options</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå¡«å……æœ‰ç§æœ‰åè®®å‚æ•°çš„å­—å…¸ã€‚å½“å‡½æ•°è¿”å›æ—¶ï¼Œè¯¥å‚æ•°å°†è¢«é”€æ¯å¹¶æ›¿æ¢ä¸ºåŒ…å«æœªæ‰¾â€‹â€‹åˆ°é€‰é¡¹çš„å­—å…¸ã€‚å¯èƒ½ä¸ºNULLã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">av_dup_packet</span><span class="hljs-params">(AVPacket *pkt)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å½“ç„¶ï¼Œè¿™æ˜¯ä¸€ä¸ªhackï¼šå¦‚æœå°šæœªåˆ†é…æ­¤è½¯ä»¶åŒ…ï¼Œåˆ™å°†å…¶å‘å¸ƒåœ¨æ­¤å¤„ã€‚</font><font style="vertical-align: inherit;">æˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›AVERROR_NOMEMã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">av_find_stream_info</span><span class="hljs-params">(AVFormatContext *s, AVDictionary **options)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ­¤åŠŸèƒ½æœç´¢éæ˜¾è€Œæ˜“è§çš„æµä¿¡æ¯ï¼Œä¾‹å¦‚å¸§é€Ÿç‡ã€‚</font><font style="vertical-align: inherit;">å¯¹äºæ— å¤´æ–‡ä»¶æ ¼å¼ï¼ˆä¾‹å¦‚MPEGï¼‰å¾ˆæœ‰ç”¨ã€‚</font><font style="vertical-align: inherit;">å»ºè®®åœ¨æ‰“å¼€æ–‡ä»¶åè°ƒç”¨ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆåŠŸï¼Œåˆ™è¿”å›&gt; = 0ï¼Œå¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å›AVERROR_ *ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">AVFrame *<span class="hljs-title">avcodec_free_frame</span><span class="hljs-params">()</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
av_frame_freeçš„æ—§åç§°ã€‚</font><font style="vertical-align: inherit;">åœ¨lavc 55.28.1ä¸­æ›´æ”¹ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">av_frame_free</span> <span class="hljs-params">(AVFrame **frame)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é‡Šæ”¾æ¡†æ¶åŠå…¶ä¸­çš„ä»»ä½•åŠ¨æ€åˆ†é…çš„å¯¹è±¡ï¼Œä¾‹å¦‚ï¼Œextended_dataã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">av_free</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *ptr)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é‡Šæ”¾ä½¿ç”¨av_mallocï¼ˆï¼‰æˆ–av_reallocï¼ˆï¼‰åˆ†é…çš„å†…å­˜ã€‚</font><font style="vertical-align: inherit;">æ‚¨å¯ä»¥ä½¿ç”¨ptr == NULLè°ƒç”¨æ­¤å‡½æ•°ã€‚</font><font style="vertical-align: inherit;">å»ºè®®æ‚¨æ”¹ä¸ºè°ƒç”¨av_freepï¼ˆï¼‰ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">av_freep</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *ptr)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é‡Šæ”¾å†…å­˜å¹¶å°†æŒ‡é’ˆè®¾ç½®ä¸ºNULLã€‚</font><font style="vertical-align: inherit;">å†…éƒ¨ä½¿ç”¨av_freeï¼ˆï¼‰ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">av_free_packet</span><span class="hljs-params">(AVPacket *pkt)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŒ…è£…ç¨‹åºåŒ…ç ´åæ–¹æ³•ï¼ˆpkt-&gt; destructï¼‰ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int64_t</span> <span class="hljs-title">av_gettime</span><span class="hljs-params">()</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è·å–å½“å‰æ—¶é—´ï¼ˆä»¥å¾®ç§’ä¸ºå•ä½ï¼‰ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">av_init_packet</span><span class="hljs-params">(AVPacket *pkt)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆå§‹åŒ–å¯é€‰çš„è½¯ä»¶åŒ…å­—æ®µã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">av_malloc</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> size)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹é½çš„å†…å­˜åˆ†é…å­—èŠ‚å¤§å°é€‚åˆæ‰€æœ‰å†…å­˜è®¿é—®ï¼ˆåŒ…æ‹¬å‘é‡ï¼Œå¦‚æœåœ¨CPUä¸Šå¯ç”¨ï¼‰ã€‚</font><font style="vertical-align: inherit;">av_mallocï¼ˆ0ï¼‰åº”è¯¥è¿”å›ä¸€ä¸ªéé›¶çš„æŒ‡é’ˆã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">av_mallocz</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> size)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸av_mallocï¼ˆï¼‰ç›¸åŒï¼Œä½†å°†å†…å­˜åˆå§‹åŒ–ä¸ºé›¶ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">av_q2d</span><span class="hljs-params">(AVRational a)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AVRationalç¿»å€ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">av_read_frame</span><span class="hljs-params">(AVFormatContext *s, AVPacket *pkt)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿”å›ä¸‹ä¸€ä¸ªæµå¸§ã€‚ä¿¡æ¯ä½œä¸ºè½¯ä»¶åŒ…å­˜å‚¨åœ¨pktä¸­ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿”å›çš„åŒ…åœ¨ä¸‹ä¸€ä¸ªav_read_frameï¼ˆï¼‰æˆ–av_close_input_fileï¼ˆï¼‰ä¹‹å‰ä¸€ç›´æœ‰æ•ˆï¼Œå¹¶ä¸”å¿…é¡»ä½¿ç”¨av_free_packeté‡Šæ”¾å®ƒã€‚å¯¹äºè§†é¢‘åŒ…ï¼Œä»…åŒ…å«ä¸€å¸§ã€‚å¯¹äºéŸ³é¢‘ï¼Œå¦‚æœæ¯ä¸ªå¸§å…·æœ‰å·²çŸ¥çš„å›ºå®šå¤§å°ï¼ˆä¾‹å¦‚PCMæˆ–ADPCMæ•°æ®ï¼‰ï¼Œåˆ™å®ƒåŒ…å«æ•´æ•°ä¸ªå¸§ã€‚å¦‚æœéŸ³é¢‘å¸§çš„å¤§å°å¯å˜ï¼ˆä¾‹å¦‚MPEGéŸ³é¢‘ï¼‰ï¼Œåˆ™å®ƒåŒ…å«ä¸€å¸§ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pkt-&gt; ptsï¼Œpkt-&gt; dtså’Œpkt-&gt;æŒç»­æ—¶é—´å§‹ç»ˆä»¥AVStream.timebaseä¸ºå•ä½è®¾ç½®ä¸ºæ­£ç¡®çš„å€¼ï¼ˆå¹¶ä¸”å‡å®šæ ¼å¼æ— æ³•æä¾›å®ƒä»¬ï¼‰ã€‚å¦‚æœè§†é¢‘æ ¼å¼å…·æœ‰Bå¸§ï¼Œåˆ™pkt-&gt; ptså¯ä»¥ä¸ºAV_NOPTS_VALUEï¼Œå› æ­¤ï¼Œå¦‚æœä¸å¯¹æœ‰æ•ˆè½½è·è¿›è¡Œæ‹†åŒ…ï¼Œæœ€å¥½ä¾é pkt-&gt; dtsã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿”å›ç»“æœï¼š</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œåˆ™</font><b><font style="vertical-align: inherit;">è¿”å›</font></b><font style="vertical-align: inherit;"> 0ï¼›å¦‚æœæœ‰é”™è¯¯æˆ–æ–‡ä»¶æœ«å°¾ï¼Œåˆ™</font><b><font style="vertical-align: inherit;">è¿”å›</font></b><font style="vertical-align: inherit;"> &lt;0ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">av_register_all</span><span class="hljs-params">()</span></span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨åº“ä¸­æ³¨å†Œæ‰€æœ‰ç¼–è§£ç å™¨ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int64_t</span> <span class="hljs-title">av_rescale_q</span><span class="hljs-params">(<span class="hljs-keyword">int64_t</span> a, AVRational bq, AVRational cq)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿”å›</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€ä¸ª</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">av_seek_frame</span><span class="hljs-params">(AVFormatContext *s, <span class="hljs-keyword">int</span> stream_index, <span class="hljs-keyword">int64_t</span> timestamp, <span class="hljs-keyword">int</span> flags)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æ—¶é—´æˆ³ä¸Šæœç´¢å…³é”®å¸§ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stream_index</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå¦‚æœstream_indexä¸º-1ï¼Œåˆ™é€‰æ‹©é»˜è®¤æµï¼Œå¹¶ä¸”æ—¶é—´æˆ³ä¼šè‡ªåŠ¨ä»AV_TIME_BASEå•ä½è½¬æ¢ä¸ºç‰¹å®šäºæµçš„time_baseã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">timestamp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šä»¥AVStream.time_baseä¸ºå•ä½æµ‹é‡çš„æ—¶é—´æˆ³ï¼Œå¦‚æœæœªæŒ‡å®šæµï¼Œåˆ™ä»¥AV_TIME_BASEä¸ºå•ä½æµ‹é‡ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flags</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šè®¾ç½®æœ‰å…³æ–¹å‘å’Œæœç´¢æ¨¡å¼çš„å‚æ•°ï¼š</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AVSEEK_FLAG_ANYï¼šåœ¨ä»»ä½•å¸§ä¸­æœç´¢ï¼Œè€Œä¸ä»…ä»…æ˜¯å…³é”®å¸§ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AVSEEK_FLAG_BACKWARDï¼šæ²¿ç›¸åæ–¹å‘æœç´¢ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AVSEEK_FLAG_BYTEï¼šåŸºäºå­—èŠ‚çš„ä½ç½®æœç´¢ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">AVFrame *<span class="hljs-title">avcodec_alloc_frame</span><span class="hljs-params">()</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
av_frame_allocçš„æ—§åç§°ã€‚</font><font style="vertical-align: inherit;">åœ¨lavc 55.28.1ä¸­æ›´æ”¹ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">AVFrame *<span class="hljs-title">av_frame_alloc</span><span class="hljs-params">()</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€‰æ‹©ä¸€ä¸ªAVFrameå¹¶å°†å…¶åˆå§‹åŒ–ã€‚</font><font style="vertical-align: inherit;">å¯ä»¥ä½¿ç”¨av_frame_freeï¼ˆï¼‰é‡Šæ”¾ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">avcodec_decode_audio4</span><span class="hljs-params">(AVCodecContext *avctx, AVFrame *frame, <span class="hljs-keyword">int</span> *got_frame_ptr, <span class="hljs-keyword">const</span> AVPacket *avpkt)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°†éŸ³é¢‘å¸§ä»avpktè§£ç åˆ°å¸§ã€‚ avcodec_decode_audio4ï¼ˆï¼‰å‡½æ•°ä»AVPacketè§£ç éŸ³é¢‘æ–‡ä»¶ã€‚å¯¹äºå…¶è§£ç ï¼Œä½¿ç”¨éŸ³é¢‘ç¼–è§£ç å™¨ï¼Œè¯¥éŸ³é¢‘ç¼–è§£ç å™¨ä½¿ç”¨avcodec_open2ï¼ˆï¼‰ä¸avctxå…³è”ã€‚æ‰€å¾—çš„è§£ç å¸§å­˜å‚¨åœ¨æŒ‡å®šçš„AVFrameä¸­ã€‚å¦‚æœå¸§å·²è§£å‹ç¼©ï¼Œåˆ™ä¼šå°†got_frame_ptrè®¾ç½®ä¸º1ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è­¦å‘Šï¼š</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¾“å…¥ç¼“å†²åŒºavpkt-&gt;æ•°æ®å¿…é¡»æ¯”å®é™…è¯»å–çš„å­—èŠ‚å¤§FF_INPUT_BUFFER_PADDING_SIZEï¼Œå› ä¸ºæŸäº›ä¼˜åŒ–çš„ä½æµè¯»å–å™¨ä¸€æ¬¡è¯»å–32æˆ–64ä½ï¼Œå¹¶ä¸”æœ€å¤šå¯ä»¥è¯»å–ç»“æŸã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avctx</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šç¼–è§£ç å™¨ä¸Šä¸‹æ–‡ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">frame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šç›®æ ‡å¸§ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">got_frame_ptr</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼štarget intï¼Œå¦‚æœæ‹†åŒ…æ¡†æ¶åˆ™å°†è®¾ç½®æ­¤å‚æ•°ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç—…æ¯’åº“</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šåŒ…å«éŸ³é¢‘çš„AVPacketã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿”å›ç»“æœï¼š</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœè¿”å›é”™è¯¯ï¼Œåˆ™è¿”å›è´Ÿå€¼ï¼›å¦åˆ™ï¼Œè¿”å›ä»è¾“å…¥AVPacketä½¿ç”¨çš„å­—èŠ‚æ•°ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">avcodec_decode_video2</span><span class="hljs-params">(AVCodecContext *avctx, AVFrame *picture, <span class="hljs-keyword">int</span> *frameFinished, <span class="hljs-keyword">const</span> AVPacket *avpkt)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°†è§†é¢‘å¸§ä»bufè§£ç ä¸ºå›¾åƒã€‚ avcodec_decode_video2ï¼ˆï¼‰å‡½æ•°ä»å¤§å°ä¸ºbuf_sizeçš„è¾“å…¥ç¼“å†²åŒºè§£ç è§†é¢‘å¸§ã€‚å¯¹äºå…¶è§£ç ï¼Œä½¿ç”¨è§†é¢‘ç¼–è§£ç å™¨ï¼Œè¯¥è§†é¢‘ç¼–è§£ç å™¨ä½¿ç”¨avcodec_open2ï¼ˆï¼‰ä¸avctxå…³è”ã€‚æ‰€å¾—çš„è§£ç å¸§ä¿å­˜åœ¨å›¾ç‰‡ä¸­ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è­¦å‘Šï¼š</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€‚ç”¨äºavcodec_decode_audio4çš„å¯¹é½ç¤ºä¾‹å’Œç¼“å†²åŒºé—®é¢˜ä¹Ÿé€‚ç”¨äºæ­¤å‡½æ•°ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avctx</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šç¼–è§£ç å™¨ä¸Šä¸‹æ–‡ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å›¾ç‰‡</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå°†ä¿å­˜è§£ç è§†é¢‘çš„AVFrameã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">frameFinished</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå¦‚æœæ²¡æœ‰æ¡†æ¶å¯ä»¥è§£åŒ…ï¼Œåˆ™ä¸ºé›¶ï¼Œå¦åˆ™ä¸ç­‰äºé›¶ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avpkt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šåŒ…å«è¾“å…¥ç¼“å†²åŒºçš„è¾“å…¥AVPacketã€‚</font><font style="vertical-align: inherit;">æ‚¨å¯ä»¥ä½¿ç”¨av_init_packetï¼ˆï¼‰åˆ›å»ºè¿™æ ·çš„ç¨‹åºåŒ…ï¼Œç„¶åï¼Œåœ¨å…·æœ‰æŒ‡å®šçš„æ•°æ®å’Œå¤§å°çš„æƒ…å†µä¸‹ï¼ŒæŸäº›è§£ç å™¨å¯èƒ½è¿˜éœ€è¦å…¶ä»–å­—æ®µï¼Œä¾‹å¦‚æ ‡å¿—å’ŒAV_PKT_FLAG_KEYã€‚</font><font style="vertical-align: inherit;">æ‰€æœ‰è§£ç å™¨å‡è®¾è®¡ä¸ºä½¿ç”¨å°½å¯èƒ½å°‘çš„å­—æ®µã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿”å›ç»“æœï¼š</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é”™è¯¯æ—¶ï¼Œå°†è¿”å›è´Ÿå€¼ï¼Œå¦åˆ™å°†ä½¿ç”¨å­—èŠ‚æ•°ï¼›å¦‚æœæ— æ³•è§£å‹ç¼©ä»»ä½•å¸§ï¼Œåˆ™ä½¿ç”¨é›¶ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int64_t</span> <span class="hljs-title">av_frame_get_best_effort_timestamp</span> <span class="hljs-params">(<span class="hljs-keyword">const</span> AVFrame *frame)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸€ç§ä»AVFrameå¯¹è±¡è·å–best_effort_timestampçš„ç®€å•è®¿é—®æ–¹æ³•ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">AVCodec *<span class="hljs-title">avcodec_find_decoder</span><span class="hljs-params">(<span class="hljs-keyword">enum</span> CodecID id)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœç´¢å¸¦æœ‰CodecIDçš„è§£ç å™¨ã€‚</font><font style="vertical-align: inherit;">é”™è¯¯è¿”å›NULLã€‚</font><font style="vertical-align: inherit;">åœ¨ä½¿ç”¨codecCtx-&gt; codec_idä»AVFormatContextä¸­çš„æµä¸­è·å–æ‰€éœ€çš„AVCodecContextä¹‹åï¼Œåº”è°ƒç”¨å®ƒã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">avcodec_flush_buffers</span><span class="hljs-params">(AVCodecContetx *avctx)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¼“å†²æ¶²å†²æ´—ã€‚</font><font style="vertical-align: inherit;">åœ¨æœç´¢æˆ–åˆ‡æ¢åˆ°å¦ä¸€ä¸ªæµæ—¶è°ƒç”¨ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">AVCodecContext * <span class="hljs-title">avcodec_alloc_context3</span> <span class="hljs-params">(<span class="hljs-keyword">const</span> AVCodec *codec)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆ†é…AVCodecContextå¹¶å°†å…¶å­—æ®µè®¾ç½®ä¸ºé»˜è®¤å€¼ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">avcodec_copy_context</span> <span class="hljs-params">(AVCodecContext *dest, <span class="hljs-keyword">const</span> AVCodecContext *src)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°†æºAVCodecContextçš„è®¾ç½®å¤åˆ¶åˆ°ç›®æ ‡AVCodecContextã€‚</font><font style="vertical-align: inherit;">ç›®çš„ç¼–è§£ç å™¨çš„ç»“æœä¸Šä¸‹æ–‡å°†è¢«å…³é—­ï¼Œå³ </font><font style="vertical-align: inherit;">æ‚¨å¿…é¡»å…ˆè°ƒç”¨avcodec_open2ï¼ˆï¼‰ï¼Œç„¶åæ‰èƒ½ä½¿ç”¨æ­¤AVCodecContextè§£ç /ç¼–ç è§†é¢‘/éŸ³é¢‘æ•°æ®ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dest</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå¿…é¡»ä½¿ç”¨avcodec_alloc_context3ï¼ˆNULLï¼‰åˆå§‹åŒ–ï¼Œå¦åˆ™å°†ä¸ä¼šåˆå§‹åŒ–ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">avcodec_open2</span><span class="hljs-params">(AVCodecContext *avctx, AVCodec *codec, AVDictionary **options)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆå§‹åŒ–avctxä»¥ä½¿ç”¨codecä¸­æŒ‡å®šçš„</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¼–è§£ç å™¨</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">åº”åœ¨avcodec_find_decoderä¹‹åä½¿ç”¨ã€‚</font><font style="vertical-align: inherit;">æˆåŠŸè¿”å›é›¶ï¼Œé”™è¯¯è¿”å›è´Ÿå€¼ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">avpicture_fill</span><span class="hljs-params">(AVPicture *picture, <span class="hljs-keyword">uint8_t</span> *ptr, <span class="hljs-keyword">int</span> pix_fmt, <span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½¿ç”¨</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ptr</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> buffer </font><font style="vertical-align: inherit;">ï¼Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pix_fmt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> format </font><font style="vertical-align: inherit;">ä»¥åŠæŒ‡å®šçš„å®½åº¦å’Œé«˜åº¦</font><font style="vertical-align: inherit;">è®¾ç½®å›¾ç‰‡æ‰€æŒ‡å‘çš„ç»“æ„</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¿”å›å›¾åƒæ•°æ®çš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">avpicture_get_size</span><span class="hljs-params">(<span class="hljs-keyword">int</span> pix_fmt, <span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®¡ç®—ç»™å®šå®½åº¦ï¼Œé«˜åº¦å’Œå›¾åƒæ ¼å¼çš„å›¾åƒéœ€è¦å¤šå°‘å­—èŠ‚ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">struct SwsContext* <span class="hljs-title">sws_getContext</span><span class="hljs-params">(<span class="hljs-keyword">int</span> srcW, <span class="hljs-keyword">int</span> srcH, <span class="hljs-keyword">int</span> srcFormat, <span class="hljs-keyword">int</span> dstW, <span class="hljs-keyword">int</span> dstH, <span class="hljs-keyword">int</span> dstFormat, <span class="hljs-keyword">int</span> flags, SwsFilter *srcFilter, SwsFilter *dstFilter, <span class="hljs-keyword">double</span> *param)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿”å›åœ¨sws_scaleä¸­ä½¿ç”¨çš„SwsContextã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">srcW</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">srcH</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">srcFormat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ‰€éœ€åƒç´ çš„å®½åº¦ï¼Œé«˜åº¦å’Œæ ¼å¼ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dstW</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dstH</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dstFormat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæœ€ç»ˆåƒç´ çš„å®½åº¦ï¼Œé«˜åº¦å’Œæ ¼å¼ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flags</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šè¦ä½¿ç”¨çš„ç¼©æ”¾æ–¹æ³•ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯ä»¥ä½¿ç”¨ä»¥ä¸‹é€‰é¡¹ï¼šSWS_FAST_BILINEARï¼ŒSWS_BILINEARï¼ŒSWS_BICUBICï¼ŒSWS_Xï¼ŒSWS_POINTï¼ŒSWS_AREAï¼ŒSWS_BICUBLINï¼ŒSWS_GAUSSï¼ŒSWS_SINCï¼ŒSWS_LANCZOSï¼ŒSWS_SPLINEã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å…¶ä»–æ ‡å¿—åŒ…æ‹¬CPUåŠŸèƒ½æ ‡å¿—ï¼šSWS_CPU_CAPS_MMXï¼ŒSWS_CPU_CAPS_MMX2ï¼ŒSWS_CPU_CAPS_3DNOWï¼ŒSWS_CPU_CAPS_ALTIVECã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å…¶ä»–æ ‡å¿—åŒ…æ‹¬ï¼ˆå½“å‰å°šæœªå®Œå…¨å®ç°ï¼‰SWS_FULL_CHR_H_INTï¼ŒSWS_FULL_CHR_H_INPå’ŒSWS_DIRECT_BGRã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€åï¼Œè¿˜æœ‰SWS_ACCURATE_RNDï¼Œå¯¹äºåˆå­¦è€…æ¥è¯´å¯èƒ½æ˜¯æœ€æœ‰ç”¨çš„SWS_PRINT_INFOã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä¸çŸ¥é“ä»–ä»¬å¤§å¤šæ•°äººåšä»€ä¹ˆã€‚ä¹Ÿè®¸å†™ä¿¡ç»™æˆ‘ï¼Ÿ</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">srcFilter</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dstFilter</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæºå’Œç›®æ ‡çš„SwsFilterã€‚ SwsFilterå¯ç”¨é¢œè‰²/äº®åº¦è¿‡æ»¤ã€‚é»˜è®¤å€¼ä¸ºNULLã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">param</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šåº”è¯¥æ˜¯æŒ‡å‘å¸¦æœ‰ç³»æ•°çš„int [2]ç¼“å†²åŒºçš„æŒ‡é’ˆã€‚æ²¡æœ‰è®°å½•ã€‚å®ƒä¼¼ä¹ç”¨äºç•¥å¾®ä¿®æ”¹æ ‡å‡†ç¼©æ”¾ç®—æ³•ã€‚é»˜è®¤å€¼ä¸ºNULLã€‚ä»…é€‚ç”¨äºä¸“å®¶ï¼</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sws_scale</span><span class="hljs-params">(SwsContext *c, <span class="hljs-keyword">uint8_t</span> *src, <span class="hljs-keyword">int</span> srcStride[], <span class="hljs-keyword">int</span> srcSliceY, <span class="hljs-keyword">int</span> srcSliceH, <span class="hljs-keyword">uint8_t</span> dst[], <span class="hljs-keyword">int</span> dstStride[]
sws_scale(sws_ctx, pFrame-&gt;data, pFrame-&gt;linesize, <span class="hljs-number">0</span>, is-&gt;video_st-&gt;codec-&gt;height, pict.data, pict.linesize);</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ¹æ®</font><b><font style="vertical-align: inherit;">SwsContext * cä¸­çš„</font></b><font style="vertical-align: inherit;">è®¾ç½®</font><font style="vertical-align: inherit;">
ç¼©æ”¾</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">srcä¸­çš„</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ•°æ®</font><font style="vertical-align: inherit;">ã€‚</font><b><font style="vertical-align: inherit;">srcStride</font></b><font style="vertical-align: inherit;">å’Œ</font><b><font style="vertical-align: inherit;">dstStride</font></b><font style="vertical-align: inherit;">æ˜¯æºè¡Œå’Œç›®æ ‡è¡Œçš„å¤§å°ã€‚</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">SDL_TimerID <span class="hljs-title">SDL_AddTimer</span><span class="hljs-params">(Uint32 interval, SDL_NewTimerCallback callback, <span class="hljs-keyword">void</span> *param)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ·»åŠ ä¸€ä¸ªåœ¨æŒ‡å®šçš„æ¯«ç§’æ•°åè¿è¡Œçš„å›è°ƒå‡½æ•°ã€‚å›è°ƒå‡½æ•°é€šè¿‡SDL_AddTimerè°ƒç”¨ä¼ é€’å½“å‰è®¡æ—¶å™¨é—´éš”å’Œç”¨æˆ·æä¾›çš„å‚æ•°ï¼Œå¹¶è¿”å›ä¸‹ä¸€ä¸ªè®¡æ—¶å™¨é—´éš”ã€‚ ï¼ˆå¦‚æœå›è°ƒçš„è¿”å›å€¼ä¸ä¼ é€’çš„å€¼åŒ¹é…ï¼Œåˆ™è®¡æ—¶å™¨ç»§ç»­ä»¥ç›¸åŒçš„é€Ÿåº¦å·¥ä½œã€‚ï¼‰å¦‚æœå›è°ƒçš„è¿”å›å€¼ä¸º0ï¼Œåˆ™å–æ¶ˆè®¡æ—¶å™¨ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å–æ¶ˆå½“å‰è®¡æ—¶å™¨çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨è®¡æ—¶å™¨æ ‡è¯†ç¬¦ï¼ˆä»SDL_AddTimerè¿”å›ï¼‰è°ƒç”¨SDL_RemoveTimerã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®¡æ—¶å™¨å›è°ƒå‡½æ•°å¯èƒ½åœ¨ä¸ä¸»ç¨‹åºä¸åŒçš„çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œå› æ­¤ä¸åº”ä»è‡ªèº«è°ƒç”¨ä»»ä½•å‡½æ•°ã€‚ä½†æ˜¯ï¼Œæ‚¨å§‹ç»ˆå¯ä»¥è°ƒç”¨SDL_PushEventã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®¡æ—¶å™¨çš„è¯¦ç»†ç¨‹åº¦å–å†³äºå¹³å°ï¼Œä½†æ˜¯æ‚¨åº”è¯¥æœŸæœ›å®ƒè‡³å°‘ä¸º10 msï¼Œå› ä¸ºè¿™æ˜¯æœ€å¸¸è§çš„å€¼ã€‚</font><font style="vertical-align: inherit;">è¿™æ„å‘³ç€ï¼Œå¦‚æœæ‚¨è¯·æ±‚ä¸€ä¸ª16 msçš„è®¡æ—¶å™¨ï¼Œåˆ™åœ¨å¸è½½çš„ç³»ç»Ÿä¸Šï¼Œå›è°ƒå°†åœ¨å¤§çº¦20 msåå¼€å§‹ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ‚¨éœ€è¦è®¾ç½®ä¸€ä¸ªæ ‡å¿—ï¼Œä»¥æ¯ç§’30å¸§çš„é€Ÿåº¦ï¼ˆæ¯33æ¯«ç§’ï¼‰å‘ä¿¡å·é€šçŸ¥æ›´æ–°å¸§ï¼Œåˆ™å¯ä»¥å°†è®¡æ—¶å™¨è®¾ç½®ä¸º30æ¯«ç§’ï¼ˆè¯·å‚è§ä¸‹é¢çš„ç¤ºä¾‹ï¼‰ã€‚</font><font style="vertical-align: inherit;">å¦‚æœä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™éœ€è¦å°†SDL_INIT_TIMERä¼ é€’ç»™SDL_Initã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿”å›æ·»åŠ çš„è®¡æ—¶å™¨çš„æ ‡è¯†ç¬¦å€¼ï¼Œå¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å›NULLã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å›è°ƒæ ¼å¼ï¼š</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-function">Uint32 <span class="hljs-title">callback</span> <span class="hljs-params">( Uint32, <span class="hljs-keyword">void</span> * param)</span></span></code></pre><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">SDL_CondSignal</span><span class="hljs-params">(SDL_cond *cond)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é‡æ–°å¯åŠ¨ç­‰å¾…</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cond</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¡ä»¶å˜é‡çš„çº¿ç¨‹ä¹‹ä¸€</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆåŠŸè¿”å›0ï¼Œé”™è¯¯è¿”å›-1ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">SDL_CondWait</span><span class="hljs-params">(SDL_cond *cond, SDL_mutex *mut)</span></span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è§£é”æä¾›çš„äº’æ–¥é”ï¼Œç„¶åç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨condæ¡ä»¶å˜é‡çš„SDL_CondSignalæˆ–SDL_CondBroadcastï¼Œç„¶åé‡æ–°é”å®šè¯¥äº’æ–¥é”ã€‚</font><font style="vertical-align: inherit;">è¿›å…¥æ­¤åŠŸèƒ½ä¹‹å‰ï¼Œå¿…é¡»é”å®šäº’æ–¥é”ã€‚</font><font style="vertical-align: inherit;">æ¥æ”¶åˆ°ä¿¡å·æ—¶è¿”å›0ï¼Œå¦åˆ™è¿”å›-1ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">SDL_cond *<span class="hljs-title">SDL_CreateCond</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆ›å»ºä¸€ä¸ªæ¡ä»¶å˜é‡ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">SDL_Thread *<span class="hljs-title">SDL_CreateThread</span><span class="hljs-params">(<span class="hljs-keyword">int</span> (*fn)(<span class="hljs-keyword">void</span> *), <span class="hljs-keyword">void</span> *data)</span></span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_CreateThreadåˆ›å»ºä¸€ä¸ªæ–°çš„æ‰§è¡Œçº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹å…±äº«å…¶çˆ¶ä»£ï¼Œä¿¡å·å¤„ç†ç¨‹åºï¼Œæ–‡ä»¶æè¿°ç¬¦ç­‰çš„æ•´ä¸ªå…¨å±€å†…å­˜ã€‚</font><font style="vertical-align: inherit;">ç„¶åå®ƒè¿è¡Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fn</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡½æ•°</font><font style="vertical-align: inherit;">ï¼Œå¹¶å‘å…¶ä¼ é€’ç©ºæŒ‡é’ˆæ•°æ®ã€‚</font><font style="vertical-align: inherit;">å½“fnè¿”å›å€¼æ—¶ï¼Œçº¿ç¨‹ç»ˆæ­¢ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SDL_Delay</span> <span class="hljs-params">(Uint32 )</span></span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç­‰å¾…æŒ‡å®šçš„æ¯«ç§’æ•°ã€‚ SDL_Delayå°†è‡³å°‘ç­‰å¾…æŒ‡å®šçš„æ—¶é—´ï¼Œä½†ç”±äºæ“ä½œç³»ç»Ÿè®¡åˆ’ï¼Œå¯èƒ½ä¼šæ›´é•¿ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨æ„ï¼š</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœŸæœ›å»¶è¿Ÿç²’åº¦è‡³å°‘ä¸º10 msã€‚ä¸€äº›å¹³å°çš„åº¦é‡æ ‡å‡†è¾ƒçŸ­ï¼Œä½†è¿™æ˜¯æœ€å¸¸è§çš„é€‰æ‹©ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">SDL_Overlay *<span class="hljs-title">SDL_CreateYUVOverlay</span><span class="hljs-params">(<span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height, Uint32 format, SDL_Surface *display)</span></span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_CreateYUVOverlayä¸ºæä¾›çš„æ˜¾ç¤ºåˆ›å»ºå…·æœ‰æŒ‡å®šå®½åº¦ï¼Œé«˜åº¦å’Œæ ¼å¼çš„YUVè¦†ç›–ï¼ˆæœ‰å…³å¯ç”¨æ ¼å¼çš„åˆ—è¡¨ï¼Œè¯·å‚è§SDL_Overlayæ•°æ®ç»“æ„ï¼‰ã€‚</font><font style="vertical-align: inherit;">è¿”å›SDL_Overlayã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">display</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®é™…ä¸Šåº”è¯¥æ˜¯ä»SDL_SetVideoModeæ´¾ç”Ÿçš„è¡¨é¢ï¼Œå¦åˆ™é»˜è®¤æƒ…å†µä¸‹æ­¤åŠŸèƒ½å°†èµ·ä½œç”¨ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ¯è¯­â€œè¦†ç›–â€æ˜¯ä¸æ­£ç¡®çš„ï¼Œå› ä¸ºå¦‚æœè¦†ç›–ä¸æ˜¯åœ¨ç¡¬ä»¶ä¸­åˆ›å»ºçš„ï¼Œåˆ™å½“æ˜¾ç¤ºè¦†ç›–æ—¶ï¼Œè¦†ç›–æ˜¾ç¤ºåŒºåŸŸä¸‹æ–¹çš„æ˜¾ç¤ºè¡¨é¢çš„å†…å®¹å°†è¢«è¦†ç›–ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">SDL_LockYUVOverlay</span><span class="hljs-params">(SDL_Overlay *overlay)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_LockYUVOverlayé˜»æ­¢è¦†ç›–ä»¥ç›´æ¥è®¿é—®åƒç´ æ•°æ®ã€‚</font><font style="vertical-align: inherit;">æˆåŠŸè¿”å›0ï¼Œé”™è¯¯è¿”å›-1ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SDL_UnlockYUVOverlay</span><span class="hljs-params">(SDL_Overlay *overlay)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è§£é”å…ˆå‰é”å®šçš„å åŠ å±‚ã€‚</font><font style="vertical-align: inherit;">å åŠ å±‚å¿…é¡»å…ˆè§£é”ï¼Œç„¶åæ‰èƒ½æ˜¾ç¤ºã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">SDL_DisplayYUVOverlay</span><span class="hljs-params">(SDL_Overlay *overlay, SDL_Rect *dstrect)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°†å åŠ å±‚æ”¾ç½®åœ¨åˆ›å»ºæ—¶æŒ‡å®šçš„è¡¨é¢ä¸Šã€‚</font><font style="vertical-align: inherit;">dstrect SDL_Rectç»“æ„å®šä¹‰äº†ç›®çš„åœ°çš„ä½ç½®å’Œå¤§å°ã€‚</font><font style="vertical-align: inherit;">å¦‚æœdstrectæˆ–å¤šæˆ–å°‘æ˜¯å åŠ å±‚ï¼Œåˆ™å åŠ å±‚å°†è¢«ç¼©æ”¾ï¼Œè¿™å·²é’ˆå¯¹2å€ç¼©æ”¾è¿›è¡Œäº†ä¼˜åŒ–ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆåŠŸï¼Œåˆ™è¿”å›0ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SDL_FreeYUVOverlay</span><span class="hljs-params">(SDL_Overlay *overlay)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é‡Šæ”¾ç”±SDL_CreateYUVOverlayåˆ›å»ºçš„å åŠ å±‚ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">SDL_Init</span><span class="hljs-params">(Uint32 flags)</span></span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆå§‹åŒ–SDLã€‚åº”è¯¥åœ¨æ‰€æœ‰å…¶ä»–SDLå‡½æ•°ä¹‹å‰è°ƒç”¨æ­¤å‡½æ•°ã€‚</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flags</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‚æ•°</font><font style="vertical-align: inherit;">æŒ‡å®šè¦åˆå§‹åŒ–SDLçš„å“ªäº›éƒ¨åˆ†ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_INIT_TIMER-åˆå§‹åŒ–è®¡æ—¶å™¨å­ç³»ç»Ÿã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_INIT_AUDIO-åˆå§‹åŒ–éŸ³é¢‘å­ç³»ç»Ÿã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_INIT_VIDEO-åˆå§‹åŒ–è§†é¢‘å­ç³»ç»Ÿã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_INIT_CDROM-åˆå§‹åŒ–CD-ROMå­ç³»ç»Ÿã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_INIT_JOYSTICK-åˆå§‹åŒ–æ“çºµæ†å­ç³»ç»Ÿã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_INIT_EVERYTHING-åˆå§‹åŒ–ä»¥ä¸Šæ‰€æœ‰å†…å®¹ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_INIT_NOPARACHUTE-ä¸å…è®¸SDLæ•è·è‡´å‘½é”™è¯¯ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_INIT_EVENTTHREAD-åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­å¯åŠ¨äº‹ä»¶ç®¡ç†å™¨ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é”™è¯¯æ—¶è¿”å›-1ï¼ŒæˆåŠŸæ—¶è¿”å›0ã€‚</font><font style="vertical-align: inherit;">æ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨SDL_GetErrorè·å¾—æ‰©å±•çš„é”™è¯¯æ¶ˆæ¯ã€‚</font><font style="vertical-align: inherit;">é”™è¯¯çš„å…¸å‹åŸå› æ˜¯ä½¿ç”¨ç‰¹å®šçš„æ˜¾ç¤ºå™¨è€Œæ²¡æœ‰ç›¸åº”çš„å­ç³»ç»Ÿæ”¯æŒï¼Œä¾‹å¦‚ï¼Œåœ¨ä¸è®¾å¤‡ä¸€èµ·ä½¿ç”¨å¸§ç¼“å†²åŒºæ—¶ç¼ºå°‘é¼ æ ‡é©±åŠ¨ç¨‹åºã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥åœ¨ä¸ä½¿ç”¨é¼ æ ‡çš„æƒ…å†µä¸‹ç¼–è¯‘SDLï¼Œæˆ–è€…åœ¨å¯åŠ¨åº”ç”¨ç¨‹åºä¹‹å‰è®¾ç½®ç¯å¢ƒå˜é‡â€œ SDL_NOMOUSE = 1â€ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">SDL_mutex *<span class="hljs-title">SDL_CreateMutex</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆ›å»ºä¸€ä¸ªæ–°çš„æœªé”å®šäº’æ–¥é”ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">SDL_LockMutex</span><span class="hljs-params">(SDL_mutex *mutex)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_LockMutexæ˜¯SDL_mutexPçš„åˆ«åã€‚</font><font style="vertical-align: inherit;">å®ƒä¼šé˜»æ­¢ä»¥å‰ä½¿ç”¨SDL_CreateMutexåˆ›å»ºçš„äº’æ–¥é”ã€‚</font><font style="vertical-align: inherit;">å¦‚æœäº’æ–¥é”å·²ç»è¢«å¦ä¸€ä¸ªçº¿ç¨‹é˜»æ­¢ï¼Œåˆ™SDL_mutexPä¸ä¼šè¿”å›å€¼ï¼Œç›´åˆ°è¢«å®ƒé˜»æ­¢çš„çº¿ç¨‹å°†å…¶è§£é”ï¼ˆä½¿ç”¨SDL_mutexVï¼‰ã€‚</font><font style="vertical-align: inherit;">å½“å†æ¬¡è°ƒç”¨äº’æ–¥é”æ—¶ï¼Œå¿…é¡»å¤šæ¬¡è°ƒç”¨SDL_mutexVï¼ˆåˆåSDL_UnlockMutexï¼‰ï¼Œæ‰èƒ½ä½¿äº’æ–¥é”è¿”å›è§£é”çŠ¶æ€ã€‚</font><font style="vertical-align: inherit;">æˆåŠŸè¿”å›0ï¼Œé”™è¯¯è¿”å›-1ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">SDL_UnlockMutex</span><span class="hljs-params">(SDL_Mutex *mutex)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
äº’æ–¥é”è§£é”ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">SDL_OpenAudio</span><span class="hljs-params">(SDL_AudioSpec *desired, SDL_AudioSpec *obtained)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ­¤å‡½æ•°ä½¿ç”¨æ‰€éœ€çš„å‚æ•°æ‰“å¼€éŸ³é¢‘å•å…ƒï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™è¿”å›0ï¼Œå°†å®é™…çš„ç¡¬ä»¶å‚æ•°æ”¾ç½®åœ¨æœ€ç»ˆæŒ‡å‘çš„ç»“æ„ä¸­ã€‚å¦‚æœæ¥æ”¶åˆ°NULLå€¼ï¼Œåˆ™å°†ç¡®ä¿ä¼ é€’ç»™å›è°ƒå‡½æ•°çš„éŸ³é¢‘æ•°æ®å…·æœ‰æ‰€éœ€çš„æ ¼å¼ï¼Œå¹¶ä¸”åœ¨å¿…è¦æ—¶å°†è‡ªåŠ¨è½¬æ¢ä¸ºç¡¬ä»¶éŸ³é¢‘æ ¼å¼ã€‚å¦‚æœæ— æ³•æ‰“å¼€éŸ³é¢‘è®¾å¤‡æˆ–æ— æ³•é…ç½®éŸ³é¢‘æµï¼Œåˆ™æ­¤å‡½æ•°è¿”å›-1ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¦æ‰“å¼€éŸ³é¢‘è®¾å¤‡ï¼Œæ‚¨éœ€è¦åˆ›å»ºæ‰€éœ€çš„SDL_AudioSpecã€‚ç„¶åï¼Œæ‚¨éœ€è¦ç”¨æ‰€éœ€çš„éŸ³é¢‘è§„èŒƒå¡«å……æ­¤ç»“æ„ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰€éœ€-&gt;é¢‘ç‡</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ‰€éœ€çš„å£°éŸ³é¢‘ç‡ï¼Œä»¥æ¯ç§’é‡‡æ ·æ•°ä¸ºå•ä½ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰€éœ€-&gt;æ ¼å¼</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ‰€éœ€çš„éŸ³é¢‘æ ¼å¼ï¼ˆè¯·å‚é˜…SDL_AudioSpecï¼‰ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰€éœ€é¢‘é“</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå¿…éœ€çš„å£°é“ï¼ˆ1ä¸ªå•å£°é“ï¼Œ2ä¸ªç«‹ä½“å£°ï¼Œ4ä¸ªç¯ç»•å£°ï¼Œ6ä¸ªå…·æœ‰å±…ä¸­å’ŒLFEçš„ç¯ç»•å£°ï¼‰ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰€éœ€-&gt;æ ·æœ¬</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font><b><font style="vertical-align: inherit;">æ ·æœ¬ä¸­</font></b><font style="vertical-align: inherit;">æ‰€éœ€çš„éŸ³é¢‘ç¼“å†²åŒºå¤§å°ã€‚è¯¥æ•°å­—å¿…é¡»æ˜¯2çš„å¹‚ï¼Œå¹¶ä¸”å¯ä»¥ç”±éŸ³é¢‘é©±åŠ¨ç¨‹åºè°ƒæ•´ä¸ºæ›´é€‚åˆç¡¬ä»¶çš„å€¼ã€‚æœ€ä½³å€¼çš„èŒƒå›´ä¸º512åˆ°8192ï¼ˆå«ï¼‰ï¼Œå…·ä½“å–å†³äºåº”ç”¨ç¨‹åºå’Œå¤„ç†å™¨é€Ÿåº¦ã€‚è¾ƒå°çš„å€¼ä¼šå¯¼è‡´æ›´å¿«çš„å“åº”æ—¶é—´ï¼Œä½†æ˜¯å¦‚æœåº”ç”¨ç¨‹åºæ‰§è¡Œç¹é‡çš„å¤„ç†å¹¶ä¸”æ— æ³•åŠæ—¶å¡«å……éŸ³é¢‘ç¼“å†²åŒºï¼Œåˆ™å¯èƒ½å¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚ç«‹ä½“å£°æ ·æœ¬ç”±LRé¡ºåºçš„å·¦å³å£°é“ç»„æˆã€‚è¯·æ³¨æ„ï¼Œä½¿ç”¨ä»¥ä¸‹å…¬å¼ï¼Œé‡‡æ ·æ•°ä¸æ—¶é—´ç›´æ¥ç›¸å…³ï¼š</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ms</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> =ï¼ˆ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ·å“</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * 1000ï¼‰/ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¢‘ç‡</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">required-&gt; callback</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå¿…é¡»è®¾ç½®ä¸ºåœ¨éŸ³é¢‘å•å…ƒå‡†å¤‡å¥½æ¥æ”¶å…¶ä»–æ•°æ®æ—¶å°†è°ƒç”¨çš„å‡½æ•°ã€‚å‘é€æŒ‡å‘éŸ³é¢‘ç¼“å†²åŒºçš„æŒ‡é’ˆå’ŒéŸ³é¢‘ç¼“å†²åŒºçš„å­—èŠ‚é•¿åº¦ã€‚è¯¥å‡½æ•°é€šå¸¸åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå› æ­¤æœ‰å¿…è¦é€šè¿‡åœ¨ä»£ç ä¸­è°ƒç”¨SDL_LockAudioå’ŒSDL_UnlockAudioæ¥ä¿æŠ¤å…¶è®¿é—®çš„æ•°æ®ç»“æ„ã€‚å›è°ƒåŸå‹ä¸º</font></font><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voidå›è°ƒ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">userdata</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uint8</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stream</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int len</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰</font></font></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">userdata-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å­˜å‚¨åœ¨ç”¨æˆ·æ•°æ®å­—æ®µSDL_AudioSpecä¸­çš„æŒ‡é’ˆã€‚</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æµ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯æŒ‡å‘è¦å¡«å……ä¿¡æ¯çš„éŸ³é¢‘ç¼“å†²åŒºçš„æŒ‡é’ˆï¼Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">len</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯éŸ³é¢‘ç¼“å†²åŒºçš„é•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">required-&gt; userdata</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ­¤æŒ‡é’ˆä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™å›è°ƒå‡½æ•°ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_OpenAudioä»ä¼ é€’ç»™å‡½æ•°çš„æ‰€éœ€SDL_AudioSpecç»“æ„ä¸­è¯»å–è¿™äº›å­—æ®µï¼Œå¹¶å°è¯•æŸ¥æ‰¾ä¸æ‚¨çš„éœ€æ±‚ç›¸åŒ¹é…çš„éŸ³é¢‘é…ç½®ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œå¦‚æœç»“æœå‚æ•°ä¸ºNULLï¼Œåˆ™åœ¨æ’­æ”¾æœŸé—´SDLä»æ‰€éœ€çš„å£°éŸ³è®¾ç½®è½¬æ¢ä¸ºè®¾å¤‡è®¾ç½®ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœè¿”å›NULLï¼Œåˆ™å¿…éœ€çš„SDL_AudioSpecæ˜¯æ‚¨çš„å·¥ä½œè§„èŒƒï¼Œå¦åˆ™ç”Ÿæˆçš„SDL_AudioSpecæˆä¸ºå·¥ä½œè§„èŒƒï¼Œå¯ä»¥åˆ é™¤æ‰€éœ€çš„è§„èŒƒã€‚åœ¨æ„å»ºSDL_AudioCVTæ—¶ï¼Œä½¿ç”¨å·¥ä½œè§„èŒƒä¸­çš„æ•°æ®å°†ä¸‹è½½çš„æ•°æ®è½¬æ¢ä¸ºè®¾å¤‡æ ¼å¼ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_OpenAudioè®¡ç®—æ‰€éœ€è§„èŒƒå’Œæœ€ç»ˆè§„èŒƒçš„å¤§å°å’Œé™é»˜å­—æ®µã€‚ sizeå­—æ®µä»¥å­—èŠ‚ä¸ºå•ä½å­˜å‚¨éŸ³é¢‘ç¼“å†²åŒºçš„æ€»å¤§å°ï¼Œè€Œsilentå­˜å‚¨ç”¨äºè¡¨ç¤ºéŸ³é¢‘ç¼“å†²åŒºä¸­çš„é™éŸ³çš„å€¼</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å£°éŸ³è®¾å¤‡æ‰“å¼€æ—¶ä¼šå¼€å§‹æ’­æ”¾é™éŸ³ï¼Œåº”åœ¨å‡†å¤‡å¥½è°ƒç”¨éŸ³é¢‘å›è°ƒå‡½æ•°æ—¶é€šè¿‡è°ƒç”¨SDL_PauseAudioï¼ˆ0ï¼‰å°†å…¶æ‰“å¼€ä»¥è¿›è¡Œæ’­æ”¾ã€‚</font><font style="vertical-align: inherit;">ç”±äºéŸ³é¢‘é©±åŠ¨ç¨‹åºå¯ä»¥æ›´æ”¹è¯·æ±‚çš„éŸ³é¢‘ç¼“å†²åŒºå¤§å°ï¼Œå› æ­¤åœ¨æ‰“å¼€éŸ³é¢‘è®¾å¤‡åå¿…é¡»é€‰æ‹©ä»»ä½•æœ¬åœ°æ··éŸ³å™¨ç¼“å†²åŒºã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SDL_PauseAudio</span><span class="hljs-params">(<span class="hljs-keyword">int</span> pause_on)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ­¤åŠŸèƒ½æš‚åœå¹¶åœæ­¢éŸ³é¢‘å›è°ƒå¤„ç†ã€‚</font><font style="vertical-align: inherit;">æ‰“å¼€éŸ³é¢‘è®¾å¤‡åï¼Œå¿…é¡»ä»¥pause_on = 0è°ƒç”¨å®ƒæ‰èƒ½å¼€å§‹æ’­æ”¾å£°éŸ³ã€‚</font><font style="vertical-align: inherit;">è¿™æ ·ï¼Œæ‚¨å¯ä»¥åœ¨æ‰“å¼€éŸ³é¢‘å•å…ƒåå®‰å…¨åœ°åˆå§‹åŒ–å›è°ƒå‡½æ•°çš„æ•°æ®ã€‚</font><font style="vertical-align: inherit;">æš‚åœæœŸé—´ï¼Œé™éŸ³ä¼šè®°å½•åœ¨éŸ³é¢‘è®¾å¤‡ä¸Šã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">SDL_PushEvent</span><span class="hljs-params">(SDL_Event *event)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸€ä¸ªäº‹ä»¶é˜Ÿåˆ—ï¼Œå®é™…ä¸Šç”¨ä½œåŒå‘é€šä¿¡é€šé“ã€‚</font><font style="vertical-align: inherit;">ä¸ä»…å¯ä»¥ä»é˜Ÿåˆ—ä¸­è¯»å–äº‹ä»¶ï¼Œè€Œä¸”ç”¨æˆ·è¿˜å¯ä»¥å°†è‡ªå·±çš„äº‹ä»¶æ”¾å…¥é˜Ÿåˆ—ä¸­ã€‚</font><font style="vertical-align: inherit;">äº‹ä»¶æ˜¯æŒ‡å‘æ‚¨è¦æ’é˜Ÿçš„äº‹ä»¶çš„ç»“æ„çš„æŒ‡é’ˆã€‚</font><font style="vertical-align: inherit;">è¯¥äº‹ä»¶è¢«å¤åˆ¶åˆ°é˜Ÿåˆ—ï¼Œå¹¶ä¸”è°ƒç”¨è€…å¯ä»¥ç®¡ç†è¿”å›SDL_PushEventä¹‹åæŒ‡å‘çš„å†…å­˜ã€‚</font><font style="vertical-align: inherit;">è¯¥å‡½æ•°æ˜¯é¢å‘çº¿ç¨‹çš„ï¼Œå¯ä»¥ä»å…¶ä»–çº¿ç¨‹å®‰å…¨åœ°è°ƒç”¨ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆåŠŸï¼Œåˆ™è¿”å›0ï¼›å¦‚æœæ— æ³•è°ƒåº¦äº‹ä»¶ï¼Œåˆ™è¿”å›-1ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">SDL_WaitEvent</span><span class="hljs-params">(SDL_Event *event)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ— é™æœŸç­‰å¾…ä¸‹ä¸€ä¸ªå¯ç”¨äº‹ä»¶ï¼Œå¦‚æœåœ¨ç­‰å¾…äº‹ä»¶æ—¶å‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å›0ï¼Œå¦åˆ™è¿”å›1ã€‚</font><font style="vertical-align: inherit;">å¦‚æœäº‹ä»¶ä¸ä¸ºNULLï¼Œåˆ™å°†ä¸‹ä¸€ä¸ªäº‹ä»¶ä»é˜Ÿåˆ—ä¸­åˆ é™¤å¹¶å­˜å‚¨åœ¨æ­¤åŒºåŸŸä¸­ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SDL_Quit</span><span class="hljs-params">()</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¦ç”¨æ‰€æœ‰SDLå­ç³»ç»Ÿå¹¶é‡Šæ”¾åˆ†é…ç»™å®ƒçš„èµ„æºã€‚é€€å‡ºå‰åº”å§‹ç»ˆè°ƒç”¨å®ƒã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">SDL_Surface *<span class="hljs-title">SDL_SetVideoMode</span><span class="hljs-params">(<span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height, <span class="hljs-keyword">int</span> bitsperpixel, Uint32 flags)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å…·æœ‰æŒ‡å®šçš„å®½åº¦ï¼Œé«˜åº¦å’Œåƒç´ ä½çš„è§†é¢‘æ¨¡å¼è®¾ç½®ã€‚ä»SDL 1.2.10å¼€å§‹ï¼Œå¦‚æœwidthå’Œheightä¸º0ï¼Œå®ƒå°†ä½¿ç”¨å½“å‰è§†é¢‘æ¨¡å¼ï¼ˆå¦‚æœæœªè®¾ç½®è¯¥æ¨¡å¼ï¼Œåˆ™ä½¿ç”¨æ¡Œé¢æ¨¡å¼ï¼‰çš„å®½åº¦å’Œé«˜åº¦ã€‚å¦‚æœ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bitsperpixel</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸º0ï¼Œåˆ™å°†å…¶è§†ä¸ºæ¯ä¸ªåƒç´ çš„å½“å‰æ˜¾ç¤ºä½ã€‚</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flags</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‚æ•°</font><font style="vertical-align: inherit;">ä¸SDL_Surfaceç»“æ„çš„flagså­—æ®µç›¸åŒã€‚æˆ–ä»¥ä¸‹å€¼çš„ç»„åˆï¼š</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_SWSURFACE-åœ¨ç³»ç»Ÿå†…å­˜ä¸­åˆ›å»ºè§†é¢‘ç•Œé¢ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_HWSURFACE-åœ¨è§†é¢‘å†…å­˜ä¸­åˆ›å»ºè§†é¢‘è¡¨é¢ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_ASYNCBLIT-å¯ç”¨å¯¹æ˜¾ç¤ºè¡¨é¢çš„å¼‚æ­¥æ›´æ–°ã€‚è¿™é€šå¸¸ä¼šå‡æ…¢å•å¤„ç†å™¨è®¡ç®—æœºä¸Šçš„å·¥ä½œï¼Œä½†å¯ä»¥æé«˜SMPç³»ç»Ÿä¸­çš„é€Ÿåº¦ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_ANYFORMAT-é€šå¸¸ï¼Œå¦‚æœå…·æœ‰è¦æ±‚çš„æ¯åƒç´ ä½æ•°ï¼ˆbpp-æ¯åƒç´ ä½æ•°ï¼‰çš„è§†é¢‘è¡¨é¢ä¸å¯ç”¨ï¼Œåˆ™SDLå°†æ¨¡æ‹Ÿå¸¦æœ‰é˜´å½±è¡¨é¢çš„è§†é¢‘ã€‚ä¼ é€’SDL_ANYFORMATå¯ä»¥é˜²æ­¢è¿™ç§æƒ…å†µï¼Œå¹¶å¼ºåˆ¶SDLä½¿ç”¨è§†é¢‘çš„è¡¨é¢ï¼Œè€Œä¸è€ƒè™‘å…¶æ·±åº¦ï¼ˆä»¥åƒç´ ä¸ºå•ä½ï¼‰ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_HWPALETTE-æä¾›å¯¹è°ƒè‰²æ¿çš„SDLç‹¬å è®¿é—®ã€‚æ²¡æœ‰æ­¤æ ‡å¿—ï¼Œæ‚¨å°†æ— æ³•å§‹ç»ˆä½¿ç”¨SDL_SetColorsæˆ–SDL_SetPaletteè·å¾—æ‰€éœ€çš„é¢œè‰²ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_DOUBLEBUF-å¯ç”¨ç¡¬ä»¶åŒé‡ç¼“å†²ï¼›ä»…å¯¹SDL_HWSURFACEæœ‰æ•ˆã€‚è°ƒç”¨SDL_Flipå°†åè½¬ç¼“å†²åŒºå¹¶åˆ·æ–°å±å¹•ã€‚æ‰€æœ‰ç»˜å›¾å°†åœ¨å½“å‰æœªæ˜¾ç¤ºçš„è¡¨é¢ä¸Šè¿›è¡Œã€‚å¦‚æœæ— æ³•å¯ç”¨åŒç¼“å†²ï¼Œåˆ™SDL_Flipå°†ä»…å…¨å±æ‰§è¡ŒSDL_UpdateRectã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_FULLSCREEN SDL-å°è¯•ä½¿ç”¨å…¨å±æ¨¡å¼ã€‚å¦‚æœç”±äºæŸç§åŸå› æ— æ³•æ›´æ”¹ç¡¬ä»¶åˆ†è¾¨ç‡ï¼Œåˆ™å°†ä½¿ç”¨ä¸‹ä¸€ä¸ªæ›´é«˜çš„åˆ†è¾¨ç‡ï¼Œå¹¶ä¸”æ˜¾ç¤ºçª—å£å°†ä»¥é»‘è‰²èƒŒæ™¯ä¸ºä¸­å¿ƒã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_OPENGL-åˆ›å»ºOpenGLæ¸²æŸ“ä¸Šä¸‹æ–‡ã€‚å‡å®šå·²é¢„å…ˆè®¾ç½®å…·æœ‰SDL_GL_SetAttributeçš„OpenGLè§†é¢‘å±æ€§ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_OPENGLBLIT-å¦‚ä¸Šæ‰€è¿°ï¼Œåˆ›å»ºOpenGLæ¸²æŸ“ä¸Šä¸‹æ–‡ï¼Œä½†å…è®¸æ­£å¸¸çš„blittingæ“ä½œã€‚å±å¹•è¡¨é¢ï¼ˆ2Dï¼‰å¯ä»¥å…·æœ‰Alphaé€šé“ï¼Œåº”ä½¿ç”¨SDL_UpdateRectsæ›´æ–°å±å¹•è¡¨é¢çš„å˜åŒ–ã€‚æ³¨æ„ã€‚è¯¥é€‰é¡¹ä»…å‡ºäºå…¼å®¹æ€§ç›®çš„è€Œä¿å­˜ï¼Œåœ¨ä»¥åçš„ç‰ˆæœ¬ä¸­å°†è¢«åˆ é™¤ã€‚ä¸å»ºè®®åœ¨æ–°ä»£ç ä¸­ä½¿ç”¨ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_RESIZABL-åˆ›å»ºå¯è°ƒæ•´å¤§å°çš„çª—å£ã€‚å½“ç”¨æˆ·æ›´æ”¹çª—å£å¤§å°æ—¶ï¼Œå°†å¼•å‘SDL_VIDEORESIZEäº‹ä»¶ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨æ–°å¤§å°å†æ¬¡è°ƒç”¨SDL_SetVideoModeã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_NOFRAMEå¦‚æœå¯èƒ½ï¼ŒSDL_NOFRAMEå¼ºåˆ¶SDLåˆ›å»ºä¸€ä¸ªæ²¡æœ‰æ ‡é¢˜æˆ–å¸¦è¾¹æ¡†çš„çª—å£ã€‚æ­¤æ ‡å¿—è‡ªåŠ¨è®¾ç½®ä¸ºå…¨å±æ¨¡å¼ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ³¨æ„ã€‚æ— è®ºæ»¡è¶³å“ªäº›SDL_SetVideoModeæ ‡å¿—ï¼Œéƒ½å°†åœ¨è¿”å›çš„è¡¨é¢çš„flagså…ƒç´ ä¸­è¿›è¡Œè®¾ç½®ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ³¨æ„ã€‚ä½åƒç´ 24ä½¿ç”¨æ¯ä¸ªåƒç´ 3ä¸ªå­—èŠ‚çš„å‹ç¼©è¡¨ç¤ºã€‚å¯¹äºæ¯”è¾ƒå¸¸è§çš„æ¯åƒç´ 4å­—èŠ‚æ¨¡å¼ï¼Œè¯·ä½¿ç”¨32ä½åƒç´ ï¼Œå¥‡æ€ªçš„æ˜¯ï¼Œ15å’Œ16éƒ½å°†è¦æ±‚æ¯åƒç´ 2å­—èŠ‚æ¨¡å¼ï¼Œä½†æ˜¯åƒç´ æ ¼å¼ä¸åŒã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ³¨æ„ã€‚å¦‚æœæ‚¨è®¡åˆ’æ‰§è¡Œå•ç‹¬çš„åƒç´ æ“ä½œæˆ–ä½¿ç”¨Alphaé€šé“æ‹–åŠ¨è¡¨é¢ï¼Œå¹¶ä¸”éœ€è¦è¾ƒé«˜çš„å¸§é€Ÿç‡ï¼Œè¯·ä½¿ç”¨SDL_SWSURFACEã€‚å½“æ‚¨ä½¿ç”¨ç¡¬ä»¶è¡¨é¢ï¼ˆSDL_HWSURFACEï¼‰æ—¶ï¼ŒSDLåœ¨æ‚¨é”å®šè¡¨é¢æ—¶å°†å…¶ä»è§†é¢‘å†…å­˜å¤åˆ¶åˆ°ç³»ç»Ÿå†…å­˜ï¼Œåä¹‹äº¦ç„¶ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½æ˜¾ç€ä¸‹é™ã€‚ ï¼ˆè¯·è®°ä½ï¼Œæ‚¨å¯ä»¥æŸ¥è¯¢ç¡¬ä»¶è¡¨é¢ï¼Œä½†ä»ç„¶å¯ä»¥è·å¾—è½¯ä»¶è¡¨é¢ã€‚è®¸å¤šå¹³å°ä»…åœ¨ä½¿ç”¨SDL_FULLSCREENæ—¶æ‰å¯ä»¥æä¾›ç¡¬ä»¶è¡¨é¢ã€‚ï¼‰SDL_HWSURFACEæœ€é€‚åˆå½“æ‚¨è¦ç»˜åˆ¶çš„è¡¨é¢ä¹Ÿå¯ä»¥å­˜å‚¨åœ¨è§†é¢‘å†…å­˜ä¸­æ—¶ä½¿ç”¨ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ³¨æ„ã€‚</font><font style="vertical-align: inherit;">å¦‚æœè¦åœ¨åˆ›å»ºçª—å£è¡¨é¢æ—¶æ§åˆ¶å±å¹•ä¸Šçš„ä½ç½®ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡â€œ SDL_VIDEO_CENTERED = centerâ€æˆ–â€œ SDL_VIDEO_WINDOW_POS = xï¼Œyâ€æ¥å®ç°ã€‚</font><font style="vertical-align: inherit;">æ‚¨å¯ä»¥é€šè¿‡SDL_putenvå®‰è£…å®ƒä»¬ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿”å›å€¼ï¼š</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¸§ç¼“å†²åŒºè¡¨é¢æˆ–å¤±è´¥æ—¶ä¸ºNULLã€‚</font><font style="vertical-align: inherit;">è¿”å›çš„è¡¨é¢ç”±SDL_Quité‡Šæ”¾ï¼Œå¹¶ä¸”è°ƒç”¨è€…ä¸å¾—é‡Šæ”¾ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ³¨æ„ã€‚</font><font style="vertical-align: inherit;">è¯¥è§„åˆ™åŒ…æ‹¬å¯¹SDL_SetVideoModeçš„è¿ç»­è°ƒç”¨ï¼ˆå³è°ƒæ•´å¤§å°ï¼‰-ç°æœ‰è¡¨é¢å°†è‡ªåŠ¨é‡Šæ”¾ã€‚</font></font><a name="data"></a><br>
<br>
<hr><hr><hr><hr><hr><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é™„å½•2ä¸­çš„æ•°æ®ç»“æ„</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="é™„å½•1.åŠŸèƒ½æ¸…å•"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â† </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="åˆ°ç›®å½•"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â‡‘ </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="å‚è€ƒæ–‡çŒ®"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â†’äº¤é€š</font></font></a></h2><br>
<br>
<pre><code class="cpp hljs">AVCodecContext</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æµä¸­æ¥è‡ªAVStream-&gt;ç¼–è§£ç å™¨çš„æœ‰å…³ç¼–è§£ç å™¨çš„æ‰€æœ‰ä¿¡æ¯ã€‚ä¸€äº›é‡è¦çš„å±æ€§ï¼š</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVRational </font></font></b> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">time_base</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ¯ç§’çš„å¸§æ•°</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
int </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sample_rate</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ¯ç§’çš„é‡‡æ ·æ•°</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
int </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šé“</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font><b><font style="vertical-align: inherit;">é€šé“</font></b><font style="vertical-align: inherit;">æ•°åœ¨</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=http://web.archive.org/web/20090410064257/"><font style="vertical-align: inherit;">æ­¤å¤„</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
æŸ¥çœ‹å®Œæ•´åˆ—è¡¨ï¼ˆéå¸¸ä»¤äººå°è±¡æ·±åˆ»ï¼‰</font><font style="vertical-align: inherit;">ï¼ˆ</font><i><font style="vertical-align: inherit;">ç½‘ç»œæ¡£æ¡ˆï¼Œå› ä¸ºåŸå§‹é“¾æ¥å·²ç»ä¸å­˜åœ¨</font></i><font style="vertical-align: inherit;">ï¼‰ã€‚è®¸å¤šå‚æ•°ä¸»è¦ç”¨äºç¼–ç ï¼Œè€Œä¸ç”¨äºè§£ç ã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=http://web.archive.org/web/20090410064257/"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs">AVFormatContext</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ•°æ®å­—æ®µï¼š</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¸¸é‡</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVClass</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_class </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVInputFormat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iformat </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVOutputFormat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oformat </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ— æ•ˆ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">priv_data</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ByteIOContext </font></font></b> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šç”¨äºä½çº§åˆ«æ–‡ä»¶æ“ä½œã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unsigned int nb_streams</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ–‡ä»¶ä¸­çš„çº¿ç¨‹æ•°ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVStream *æµ[MAX_STREAMS]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ¯ä¸ªæµçš„æ•°æ®éƒ½å­˜å‚¨åœ¨æ­¤å¤„ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">charæ–‡ä»¶å[1024]ï¼š</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½†æ˜¯å¦‚æœæ²¡æœ‰å®ƒï¼Œè¯¥æ€ä¹ˆåŠï¼ˆåœ¨åŸå§‹æ–‡ä»¶ä¸­</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-duh</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ–‡ä»¶ä¿¡æ¯ï¼š</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
int64_t </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ—¶é—´æˆ³</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å­—ç¬¦</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ‡é¢˜</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [512]ï¼š</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å­—ç¬¦</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½œè€…</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [512]ï¼š</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å­—ç¬¦</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰ˆæƒ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [512]ï¼š</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å­—ç¬¦</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨é‡Š</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [512]ï¼š</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å­—ç¬¦</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸“è¾‘</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [512]ï¼š</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ•´æ•°</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹´ä»½</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ•´æ•°</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è½¨é“</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å­—ç¬¦</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é£æ ¼</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [32]ï¼š</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ•´æ•°</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ctx_flags</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯èƒ½çš„å€¼æ˜¯AVFMT_NOFILEï¼ŒAVFMT_NEEDNUMBERï¼ŒAVFMT_SHOW_IDSï¼ŒAVFMT_RAWPICTUREï¼Œ AVFMT_GLOBALHEADERï¼ŒAVFMT_NOTIMESTAMPSï¼ŒAVFMT_GENERIC_INDEX </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVPacketList</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">packet_buffer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šä»…å½“æ•°æ®åŒ…å·²ç»ç¼“å†²ä½†å°šæœªè§£ç æ—¶æ‰éœ€è¦æ­¤ç¼“å†²åŒºï¼Œä¾‹å¦‚ï¼Œä»¥åœ¨mpegæµä¸­æ¥æ”¶ç¼–è§£ç å™¨å‚æ•°ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
int64_t</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">start_time</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šè§£ç æ—¶ï¼šç»„ä»¶çš„ç¬¬ä¸€å¸§çš„ä½ç½®ï¼Œä»¥ç§’ä¸ºå•ä½ï¼ŒAV_TIME_BASEã€‚æ°¸è¿œä¸è¦ç›´æ¥è®¾ç½®æ­¤å€¼ï¼šå®ƒæ˜¯ä»AVStreamçš„å€¼æ¨æ–­å‡ºæ¥çš„ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int64_tæŒç»­æ—¶é—´ï¼šè§£ç </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæµçš„æŒç»­æ—¶é—´ï¼Œä»¥AV_TIME_BASEçš„åˆ†æ•°è¡¨ç¤ºã€‚æ°¸è¿œä¸è¦ç›´æ¥è®¾ç½®æ­¤å€¼ï¼šå®ƒæ˜¯ä»AVStreamçš„å€¼æ¨æ–­å‡ºæ¥çš„ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int64_t file_size</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ–‡ä»¶æ€»å¤§å°ï¼Œå¦‚æœæœªçŸ¥ï¼Œåˆ™ä¸º0ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int bit_rate</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šè§£ç ï¼šæµçš„æ€»æ¯”ç‰¹ç‡ï¼Œä»¥bit / sä¸ºå•ä½ï¼Œå¦‚æœä¸å¯ç”¨ï¼Œåˆ™ä¸º0ã€‚å¦‚æœfile_sizeå’Œffmpegä¸­å·²çŸ¥çš„æŒç»­æ—¶é—´å¯ä»¥è‡ªåŠ¨è®¡ç®—ï¼Œåˆ™æ°¸è¿œä¸è¦ç›´æ¥è®¾ç½®å®ƒã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVStream * cur_st </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const uint8_t * cur_ptr </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int cur_len </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVPacket cur_pkt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int64_t data_offset</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int index_built</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šç¬¬ä¸€ä¸ªæ•°æ®åŒ…çš„åç§»é‡ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int mux_rate</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int packet_size</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inté¢„åŠ è½½</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int max_delay</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int loop_output</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ”¯æŒçš„æ ¼å¼çš„è¾“å‡ºå¾ªç¯æ•°ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intæ ‡å¿—</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int loop_input</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ— ç¬¦å·int probesize</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šè§£ç ï¼šæ ·æœ¬æ•°æ®å¤§å°ï¼›ä¸ç”¨äºç¼–ç ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int max_analyze_duration</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå¿…é¡»ä»¥av_find_stream_infoï¼ˆï¼‰åˆ†æè¾“å…¥æ•°æ®çš„æœ€å¤§æŒç»­æ—¶é—´ï¼Œä»¥AV_TIME_BASEä¸ºå•ä½</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const uint8_t * key</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int keylen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs">AVIOContext</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I / Oä¸Šä¸‹æ–‡ç”¨äºè®¿é—®èµ„æºã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const AVClass * av_class</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šç§æœ‰è®¾ç½®çš„ç±»ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unsigned char * buffer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font><b><font style="vertical-align: inherit;">ç¼“å†²åŒºçš„</font></b><font style="vertical-align: inherit;">å¼€å§‹ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int buffer_size</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæœ€å¤§ç¼“å†²åŒºå¤§å°ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unsigned char * buf_ptr</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šç¼“å†²åŒºä¸­çš„å½“å‰ä½ç½®ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unsigned char * buf_end</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šä¾‹å¦‚ï¼Œå¦‚æœè¯»å–å‡½æ•°è¿”å›çš„æ•°æ®å°‘äºè¯·æ±‚çš„æ•°æ®ï¼Œåˆ™æ•°æ®å¯èƒ½å°äºbuffer + buffer_sizeã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void * opaque</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šä¼ é€’ç»™è¯»å–/å†™å…¥/æœç´¢/ ...çš„ç§æœ‰æŒ‡é’ˆ</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intï¼ˆ* read_packetï¼‰ï¼ˆvoid *ä¸é€æ˜ï¼Œuint8_t * bufï¼Œint buf_sizeï¼‰</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intï¼ˆ* </font></font></b><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">write_packet </font></b><b><font style="vertical-align: inherit;">ï¼‰ï¼ˆvoid *ä¸é€æ˜ï¼Œuint8_t * bufï¼Œint buf_size ï¼‰</font></b><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int64_tï¼ˆ*å¯»é“ï¼‰ï¼ˆæ— æ•ˆ*ä¸é€æ˜ï¼Œint64_tåç§»é‡ï¼Œint whenceï¼‰</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int64_t pos</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå½“å‰ç¼“å†²åŒºæ–‡ä»¶ä¸­çš„ä½ç½®ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int must_flush</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå¦‚æœä¸‹ä¸€æ¬¡æœç´¢åº”é‡ç½®ï¼Œ</font><b><font style="vertical-align: inherit;">åˆ™ä¸º</font></b><font style="vertical-align: inherit;"> trueã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int eof_reached</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå¦‚æœåˆ°è¾¾æ–‡ä»¶æœ«å°¾ï¼Œ</font><b><font style="vertical-align: inherit;">åˆ™ä¸º</font></b><font style="vertical-align: inherit;"> trueã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int write_flag</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå¦‚æœå¯ä»¥å†™å…¥</font><b><font style="vertical-align: inherit;">åˆ™ä¸º</font></b><font style="vertical-align: inherit;"> trueã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int max_packet_size</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ— ç¬¦å·é•¿æ ¡éªŒå’Œ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ— ç¬¦å·å­—ç¬¦* checksum_ptr</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ— ç¬¦å·é•¿ï¼ˆ* update_checksumï¼‰ï¼ˆæ— ç¬¦å·é•¿æ ¡éªŒå’Œï¼Œconst uint8_t * bufï¼Œæ— ç¬¦å·intå¤§å°ï¼‰</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inté”™è¯¯</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šåŒ…å«é”™è¯¯ä»£ç ï¼›å¦‚æœæœªå‘ç”Ÿé”™è¯¯ï¼Œåˆ™ä¸º0ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intï¼ˆ* read_pauseï¼‰ï¼ˆæ— æ•ˆ*ä¸é€æ˜ï¼Œintæš‚åœï¼‰</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šä¾‹å¦‚ï¼Œæš‚åœæˆ–æ¢å¤ç½‘ç»œæµåè®®çš„å›æ”¾ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int64_tï¼ˆ* read_seekï¼‰ï¼ˆæ— æ•ˆ*ä¸é€æ˜ï¼Œint stream_indexï¼Œint64_tæ—¶é—´æˆ³ï¼Œintæ ‡å¿—ï¼‰</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šä½¿ç”¨æŒ‡å®šçš„stream_indexç´¢å¼•åœ¨æµä¸­æœç´¢æŒ‡å®šçš„æ—¶é—´æˆ³ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int seekable</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå½“æ— æ³•æœç´¢æµæ—¶ï¼ŒAVIO_SEEKABLE_æˆ–0æ ‡å¿—çš„ç»„åˆã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int64_t maxsize</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šç”¨äºé™åˆ¶é€‰æ‹©çš„æœ€å¤§æ–‡ä»¶å¤§å°ã€‚æ­¤å­—æ®µæ˜¯libavformatçš„å†…éƒ¨å­—æ®µï¼Œç¦æ­¢ä»å¤–éƒ¨å¯¹å…¶è¿›è¡Œè®¿é—®ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int direct</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šavio_readå’Œavio_writeåº”è¯¥åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ç›´æ¥æ‰§è¡Œï¼Œå¹¶ä¸”ä¸è¦é€šè¿‡ç¼“å†²åŒºï¼Œå¹¶ä¸”avio_seekå°†å§‹ç»ˆç›´æ¥è°ƒç”¨ä¸»æœç´¢å‡½æ•°ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int64_t bytes_read</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå­—èŠ‚è¯»å–ç»Ÿè®¡ä¿¡æ¯æ­¤å­—æ®µåœ¨libavformatå†…éƒ¨ï¼Œå¹¶ä¸”æ‹’ç»å¤–éƒ¨è®¿é—®ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int seek_count</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæœç´¢ç»Ÿè®¡ä¿¡æ¯ã€‚</font><font style="vertical-align: inherit;">æ­¤å­—æ®µæ˜¯libavformatçš„å†…éƒ¨å­—æ®µï¼Œç¦æ­¢ä»å¤–éƒ¨å¯¹å…¶è¿›è¡Œè®¿é—®ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int writeout_count</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå†™å…¥ç»Ÿè®¡ä¿¡æ¯ã€‚</font><font style="vertical-align: inherit;">æ­¤å­—æ®µæ˜¯libavformatçš„å†…éƒ¨å­—æ®µï¼Œç¦æ­¢ä»å¤–éƒ¨å¯¹å…¶è¿›è¡Œè®¿é—®ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int orig_buffer_size</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ£€æŸ¥å¹¶æä¾›è¿”å›å€¼ä»¥é‡ç½®ç¼“å†²åŒºå¤§å°ååœ¨å†…éƒ¨ä½¿ç”¨çš„åŸå§‹ç¼“å†²åŒºå¤§å°ã€‚</font><font style="vertical-align: inherit;">æ­¤å­—æ®µæ˜¯libavformatçš„å†…éƒ¨å­—æ®µï¼Œç¦æ­¢ä»å¤–éƒ¨å¯¹å…¶è¿›è¡Œè®¿é—®ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs">AVDictionary</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”¨äºå°†å‚æ•°ä¼ é€’ç»™ffmpegã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int count</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVDictionaryEntry * elems</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs">AVDictionaryEntry</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”¨äºå°†å­—å…¸æ¡ç›®å­˜å‚¨åœ¨AVDictionaryä¸­ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char * ket</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *å€¼</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs">AVFrame</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ­¤ç»“æ„å–å†³äºç¼–è§£ç å™¨çš„ç±»å‹ï¼Œå› æ­¤æ˜¯åŠ¨æ€ç¡®å®šçš„ã€‚ä½†æ˜¯ï¼Œæ­¤ç»“æ„æœ‰ä¸€äº›å…±åŒçš„å±æ€§å’Œæ–¹æ³•ï¼š</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uint8_t * data [4]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int linesize [4]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šä¿¡æ¯æ­¥å¹…ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uint8_t * base [4]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int key_frame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int pict_type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int64_t pts</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šè¿™äº›ä¸æ˜¯æ‚¨åœ¨è§£ç æ—¶æœŸæœ›çš„ptsã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int coded_picture_number</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int display_picture_number</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intè´¨é‡</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intå¹´é¾„</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intå‚è€ƒ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int8_t * qscale_table</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int qstride</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uint8_t * mbskip_table</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int16_tï¼ˆ* motion_val [2]ï¼‰[2]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uint32_t * mb_type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uint8_t motion_subsample_log2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void *ä¸é€æ˜</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šç”¨æˆ·æ•°æ®</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uint64_té”™è¯¯[4]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intç±»å‹</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int repeat_pict</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæŒ‡ç¤ºæ‚¨é‡å¤æŒ‡å®šæ¬¡æ•°çš„å›¾åƒã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INT qscale_type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INT interlaced_frame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INTçš„top_field_first</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVPanScan * pan_scan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INT palette_has_changed</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INT buffer_hints</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çŸ­* dct_coeff</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸­int8_t * ref_index [2] </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs">AVPacket</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å­˜å‚¨åŸå§‹æ•°æ®åŒ…æ•°æ®çš„ç»“æ„ã€‚æ­¤æ•°æ®å¿…é¡»ä¼ è¾“åˆ°avcodec_decode_audio2æˆ–avcodec_decode_videoæ‰èƒ½æ¥æ”¶å¸§ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int64_t pts</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šä»¥time_baseä¸ºå•ä½çš„æ¼”ç¤ºæ—¶é—´æˆ³è®°ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int64_t dts</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šè§£å‹ç¼©çš„æ—¶é—´æˆ³è®°ï¼Œä»¥time_baseä¸ºå•ä½ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uint8_t * data</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šåŸå§‹æ•°æ®ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int size</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ•°æ®å¤§å°ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int stream_index</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šåŸºäºAVFormatContextä¸­çš„æ•°é‡ï¼ŒAVPacketæ¥è‡ªçš„æµã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intæ ‡å¿—</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå¦‚æœæ•°æ®åŒ…æ˜¯å…³é”®å¸§ï¼Œåˆ™è®¾ç½®PKT_FLAG_KEYã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int duration</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ¼”ç¤ºçš„</font><b><font style="vertical-align: inherit;">æŒç»­</font></b><font style="vertical-align: inherit;">æ—¶é—´ï¼Œä»¥time_baseä¸ºå•ä½ï¼ˆå¦‚æœä¸å¯ç”¨ï¼Œåˆ™ä¸º0ï¼‰</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voidï¼ˆ* destructï¼‰ï¼ˆstruct AVPacket *ï¼‰</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ­¤åŒ…çš„èµ„æºé‡Šæ”¾åŠŸèƒ½ï¼ˆé»˜è®¤æƒ…å†µä¸‹ä¸ºav_destruct_packetï¼‰ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void * priv</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int64_t pos</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæµä¸­çš„å­—èŠ‚ä½ç½®ï¼Œå¦‚æœæœªçŸ¥ï¼Œåˆ™ä¸º-1ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs">AVPacketList</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è½¯ä»¶åŒ…çš„ç®€å•é“¾æ¥åˆ—è¡¨ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVPacket pkt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVPacketList *ä¸‹ä¸€ä¸ª</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs">AVPicture</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ­¤ç»“æ„ä¸å‰ä¸¤ä¸ªAVFrameæ•°æ®å…ƒç´ å®Œå…¨ç›¸åŒï¼Œå› æ­¤ç»å¸¸å°†å…¶ä¸¢å¼ƒã€‚</font><font style="vertical-align: inherit;">å¸¸ç”¨äºSWSåŠŸèƒ½ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uint8_t *æ•°æ®[4]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intè¡Œå¤§å°[4]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå­—ç¬¦ä¸²ä¸­çš„å­—èŠ‚æ•°ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs">AVRational</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¡¨ç¤ºæœ‰ç†æ•°çš„ç®€å•ç»“æ„ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int num</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šåˆ†å­ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int den</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šåˆ†æ¯ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs">AVStream</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æµçš„ç»“æ„ã€‚æ‚¨å¯èƒ½æœ€å¸¸åœ¨ç¼–è§£ç å™¨ä¸­ä½¿ç”¨æ­¤ä¿¡æ¯ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intç´¢å¼•</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int id</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVCodecContext *ç¼–è§£ç å™¨</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVRational r_frame_rate</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void * </font></font></b><font style="vertical-align: inherit;"></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">priv_data</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font><b><font style="vertical-align: inherit;">int64_t codec_info_duration</font></b><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int codec_info_nb_frames</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVFrac pts</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVRational time_base</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int pts_wrap_bits</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int stream_copy</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font><font style="vertical-align: inherit;">å¯ä»¥</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸¢å¼ƒ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å¤šè·¯åˆ†è§£ä¸­ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æµ®è´¨é‡</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„int64_t START_TIME</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„int64_tæŒç»­æ—¶é—´</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å­—ç¬¦è¯­è¨€[4] </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INT need_paâ€‹â€‹rsing</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š1 - &gt;éœ€è¦å®Œå…¨è§£æï¼Œ2 -ä»…&gt;è§£ææŠ¥å¤´ï¼Œè€Œæ— éœ€é‡æ–°åŒ…è£…</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVCodecParserContext *è§£æå™¨</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„int64_t cur_dts</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INT last_IP_duration</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„int64_t last_IP_pts</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVIndexEntry * index_entries</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INT nb_index_entries</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€ä¸ªunsigned int index_entries_allocated_size</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int64_t nb_frames</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ­¤æµä¸­çš„å¸§æ•°ï¼ˆå¦‚æœå·²çŸ¥ï¼‰æˆ–0 </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int64_t pts_buffer [MAX_REORDER_DELAY +1]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs">ByteIOContext</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸€ç§å­˜å‚¨æœ‰å…³ç”µå½±æ–‡ä»¶çš„ä½çº§ä¿¡æ¯çš„ç»“æ„ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unsigned char *ç¼“å†²åŒº</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int buffer_size</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unsigned char * buf_ptr</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unsigned char * buf_end</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void *ä¸é€æ˜</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intï¼ˆ* read_packetï¼‰ï¼ˆvoid *ä¸é€æ˜ï¼Œuint8_t * bufï¼Œint buf_sizeï¼‰</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intï¼ˆ* </font></font></b><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">write_packet </font></b><b><font style="vertical-align: inherit;">ï¼‰ï¼ˆvoid *ä¸é€æ˜ï¼Œ uint8_t * bufï¼Œint buf_sizeï¼‰</font></b><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">offset_tï¼ˆ* </font></font></b><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">æœå¯»ï¼‰</font></b><b><font style="vertical-align: inherit;">ï¼ˆvoid *ä¸é€æ˜ï¼Œoffset_t offsetï¼Œint whenceï¼‰</font></b><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">offset_t pos</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int must_flush</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int eof_reached</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int write_flag</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int is_streamed</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int max_packet_size</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unsigned longæ ¡éªŒå’Œ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unsigned char * checksum_ptr</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unsigned longï¼ˆ* update_checksumï¼‰ï¼ˆunsigned longæ ¡éªŒå’Œï¼š</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
const uint8_t * bufï¼Œunsigned int sizeï¼‰</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int error</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šåŒ…å«é”™è¯¯ä»£ç ï¼›å¦‚æœæœªå‘ç”Ÿé”™è¯¯ï¼Œåˆ™ä¸º0ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs">SDL_AudioSpec</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”¨äºæè¿°æŸäº›éŸ³é¢‘æ•°æ®çš„æ ¼å¼ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">freq</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ¯ç§’æ ·æœ¬ä¸­çš„å£°éŸ³é¢‘ç‡ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ¼å¼</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šéŸ³é¢‘æ•°æ®æ ¼å¼ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å£°é“</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font><b><font style="vertical-align: inherit;">å£°é“</font></b><font style="vertical-align: inherit;">æ•°ï¼š1-å•å£°é“ï¼Œ2-ç«‹ä½“å£°ï¼Œ4ä¸ªç¯ç»•å£°ï¼Œ6ä¸ªå…·æœ‰å±…ä¸­å’ŒLFEç¯ç»•</font><font style="vertical-align: inherit;">å£°çš„</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ— å£°</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå£°éŸ³ç¼“å†²å™¨çš„</font><b><font style="vertical-align: inherit;">æ— å£°</font></b><font style="vertical-align: inherit;">å€¼ï¼ˆè®¡ç®—å¾—å‡ºï¼‰ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ·æœ¬</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font><b><font style="vertical-align: inherit;">æ ·æœ¬ä¸­</font></b><font style="vertical-align: inherit;">éŸ³é¢‘ç¼“å†²åŒºçš„å¤§å°ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">size</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šéŸ³é¢‘ç¼“å†²åŒºçš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼ˆå·²è®¡ç®—ï¼‰ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">callbackï¼ˆ..ï¼‰</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå›è°ƒå‡½æ•°ï¼Œç”¨äºå¡«å……éŸ³é¢‘ç¼“å†²åŒºã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">userdata</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæŒ‡å‘ä¼ é€’ç»™å›è°ƒå‡½æ•°çš„ç”¨æˆ·æ•°æ®çš„æŒ‡é’ˆã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»¥ä¸‹æ ¼å¼å€¼</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ‰æ•ˆ</font><font style="vertical-align: inherit;">ï¼š</font><font style="vertical-align: inherit;">AUDIO_U8-8ä½æ— ç¬¦å·æ ·æœ¬ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AUDIO_S8-å¸¦ç¬¦å·çš„8ä½æ ·æœ¬ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AUDIO_U16æˆ–AUDIO_U16LSB-å¹¶éæ‰€æœ‰ç¡¬ä»¶éƒ½æ”¯æŒï¼ˆæ— ç¬¦å·16ä½ä½å­—èŠ‚é¡ºåºï¼‰ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AUDIO_S16æˆ–AUDIO_S16LS-å¹¶éæ‰€æœ‰ç¡¬ä»¶éƒ½æ”¯æŒï¼ˆæ—§ä½é¡ºåºä¸º16ä½ï¼‰</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AUDIO_U16MSB-å¹¶éæ‰€æœ‰ç¡¬ä»¶éƒ½æ”¯æŒï¼ˆæ— ç¬¦å·16ä½big-endianï¼‰ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AUDIO_S16MS-å¹¶éæ‰€æœ‰ç¡¬ä»¶éƒ½æ”¯æŒï¼ˆ16ä½é«˜å­—èŠ‚é¡ºåºï¼‰ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AUDIO_U16SYSï¼šAUDIO_U16LSBæˆ–AUDIO_U16MSB-å–å†³äºç¡¬ä»¶å¤„ç†å™¨ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AUDIO_S16SYSï¼šAUDIO_S16LSBæˆ–AUDIO_S16MSB-å–å†³äºç¡¬ä»¶å¤„ç†å™¨ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs">SDL_Event</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
äº‹ä»¶çš„åŸºæœ¬ç»“æ„ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šäº‹ä»¶ç±»å‹ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">active</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ¿€æ´»äº‹ä»¶ï¼ˆè¯·å‚è§SDL_ActiveEventï¼‰ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">key</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šé”®ç›˜äº‹ä»¶ï¼ˆè¯·å‚è§SDL_KeyboardEventï¼‰ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">motion</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šé¼ æ ‡ç§»åŠ¨äº‹ä»¶ï¼ˆè¯·å‚è§SDL_MouseMotionEventï¼‰ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">button</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šé¼ æ ‡å•å‡»äº‹ä»¶ï¼ˆè¯·å‚è§SDL_MouseButtonEventï¼‰ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jaxis</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ¸¸æˆæ†è½´ç§»åŠ¨äº‹ä»¶ï¼ˆè¯·å‚è§SDL_JoyAxisEventï¼‰ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jball</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ“çºµæ†è½¨è¿¹çƒè¿åŠ¨äº‹ä»¶ï¼ˆè¯·å‚è§SDL_JoyBallEventï¼‰ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jhat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ“çºµæ†æ ‡å¤´ç§»åŠ¨äº‹ä»¶ï¼ˆè¯·å‚è§SDL_JoyHatEventï¼‰ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jbutton</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæŒ‰ä¸‹æ“çºµæ†æŒ‰é’®çš„äº‹ä»¶ï¼ˆè¯·å‚è§SDL_JoyButtonEventï¼‰ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è°ƒæ•´å¤§å°</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šåº”ç”¨ç¨‹åºçª—å£è°ƒæ•´å¤§å°äº‹ä»¶ï¼ˆè¯·å‚è§SDL_ResizeEventï¼‰ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æš´éœ²</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šåº”ç”¨ç¨‹åºçª—å£æ‰“å¼€äº‹ä»¶ï¼ˆè¯·å‚è§SDL_ExposeEventï¼‰ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šåº”ç”¨ç¨‹åºé€€å‡ºè¯·æ±‚äº‹ä»¶ï¼ˆè¯·å‚è§SDL_QuitEventï¼‰ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šç”¨æˆ·äº‹ä»¶ï¼ˆè¯·å‚è§SDL_UserEventï¼‰ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">syswm</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæœªå®šä¹‰çš„çª—å£ç®¡ç†å™¨äº‹ä»¶ï¼ˆè¯·å‚è§SDL_SysWMEventï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯äº‹ä»¶çš„ç±»å‹ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§SDLæ–‡æ¡£</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã€‚SDL_ACTIVEEVENT SDL_ActiveEvent </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_KEYDOWN / UP SDL_KeyboardEvent </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_MOUSEMOTION SDL_MouseMotionEvent </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_MOUSEBUTTONDOWN / UP </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_MouseButtonEvent SDL_JOYAXISMOTION </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_JoyAxisEvent SDL_JOYBALLMOTION</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_JoyHatEvent SDL_JOYHATMOTION </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_JOYBUTTONDOWN / UP SDL_JoyButtonEvent </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_VIDEORESIZE SDL_ResizeEvent </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_VIDEOEXPOSE SDL_ExposeEvent </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_Quit SDL_QuitEvent </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_USEREVENT SDL_UserEvent </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_SYSWMEMENT SDL</font></font><br>
<br>
<pre><code class="cpp hljs">SDL_Overlay</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
YUVå åŠ å±‚ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ¼å¼</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå åŠ æ ¼å¼ï¼ˆè¯·å‚è§ä¸‹æ–‡ï¼‰ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wï¼Œh</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šè¦†ç›–å±‚çš„å®½åº¦/é«˜åº¦ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">planes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šè¦è¦†ç›–çš„è®¡åˆ’æ•°ã€‚é€šå¸¸ä¸º1æˆ–3ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é—´è·</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šä¸€ç»„ç¼©è¿›ï¼Œæ¯ä¸ªè®¡åˆ’ä¸€ä¸ªã€‚ç¼©è¿›æ˜¯å­—ç¬¦ä¸²çš„é•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pixel</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ¯ä¸ªè®¡åˆ’çš„æ•°æ®æŒ‡é’ˆæ•°ç»„ã€‚ä½¿ç”¨è¿™äº›æŒ‡é’ˆä¹‹å‰ï¼Œå¿…é¡»é”å®šè¦†ç›–å›¾ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hw_overlay</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå¦‚æœè¦†ç›–æ˜¯ç¡¬ä»¶åŠ é€Ÿçš„ï¼Œåˆ™è®¾ç½®ä¸º1ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs">SDL_Rect</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
çŸ©å½¢åŒºåŸŸã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sint16 xï¼Œy</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šçŸ©å½¢å·¦ä¸Šè§’çš„ä½ç½®ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uint16 wï¼Œh</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šçŸ©å½¢çš„å®½åº¦å’Œé«˜åº¦ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_Rectå®šä¹‰åƒç´ çš„çŸ©å½¢åŒºåŸŸã€‚ SDL_BlitSurfaceä½¿ç”¨å®ƒæ¥è¯†åˆ«æ–‘ç‚¹å’Œå…¶ä»–ä¸€äº›è§†é¢‘åŠŸèƒ½çš„åŒºåŸŸã€‚</font></font><br>
<br>
<pre><code class="cpp hljs">SDL_Surface</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¤–ä¾§ï¼ˆè¡¨é¢ï¼‰çš„å›¾å½¢ç»“æ„ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uint32æ ‡å¿—</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå¤–éƒ¨å­˜å‚¨å™¨çš„æ ‡å¿—ã€‚ä»…ç”¨äºé˜…è¯»ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_PixelFormat *æ ¼å¼</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šåªè¯»ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int wï¼Œh</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå®½åº¦å’Œé«˜åº¦ã€‚ä»…ç”¨äºé˜…è¯»ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uint16éŸ³é«˜</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ­¥è¿›ã€‚ä»…ç”¨äºé˜…è¯»ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*åƒç´ </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæŒ‡å‘å®é™…åƒç´ æ•°æ®çš„æŒ‡é’ˆã€‚ä»…ç”¨äºå½•åˆ¶ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_Rect clip_rect</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå‰ªè¾‘çš„çŸ©å½¢å¤–éƒ¨ã€‚ä»…ç”¨äºé˜…è¯»ã€‚</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int refcount</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šç”¨äºåˆ†é…å†…å­˜ã€‚ä¸»è¦ç”¨äºé˜…è¯»ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ­¤ç»“æ„è¿˜åŒ…å«æ­¤å¤„æœªæ˜¾ç¤ºçš„ç§æœ‰å­—æ®µã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_Surfaceè¡¨ç¤ºå¯ä»¥ç»˜åˆ¶çš„â€œå›¾å½¢â€å†…å­˜åŒºåŸŸã€‚ä½¿ç”¨SDL_SetVideoModeå’ŒSDL_GetVideoSurfaceå°†è§†é¢‘ç¼“å†²åŒºå¸§ä½œä¸ºSDL_Surfaceè¿”å›ã€‚å­—æ®µwå’Œhæ˜¯ä»£è¡¨åƒç´ çš„è¡¨é¢å®½åº¦å’Œé«˜åº¦çš„å€¼ã€‚åƒç´ å­—æ®µæ˜¯æŒ‡å‘å®é™…åƒç´ æ•°æ®çš„æŒ‡é’ˆã€‚æ³¨æ„ï¼šåœ¨è®¿é—®æ­¤å­—æ®µä¹‹å‰ï¼Œå¿…é¡»é”å®šè¡¨é¢ï¼ˆé€šè¿‡SDL_LockSurfaceï¼‰ã€‚ clip_rectå­—æ®µæ˜¯SDL_SetClipRectè®¾ç½®çš„è£å‰ªçŸ©å½¢ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ ‡å¿—å­—æ®µæ”¯æŒä»¥ä¸‹ORå€¼ï¼š</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_SWSURFACE-å¤–éƒ¨å­˜å‚¨åœ¨ç³»ç»Ÿå†…å­˜ä¸­ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_HWSURFACE-å¤–éƒ¨å­˜å‚¨åœ¨è§†é¢‘å­˜å‚¨å™¨ä¸­ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_ASYNCBLIT-å¦‚æœå¯èƒ½ï¼Œå¤–éƒ¨ä½¿ç”¨å¼‚æ­¥çœ©å…‰ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_ANYFORMAT-å…è®¸ä»»ä½•åƒç´ æ ¼å¼ï¼ˆæ˜¾ç¤ºè¡¨é¢ï¼‰ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_HWPALETTE-è¡¨é¢å…·æœ‰ä¸“ç”¨çš„è°ƒè‰²æ¿ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_DOUBLEBUF-åŒç¼“å†²è¡¨é¢ï¼ˆæ˜¾ç¤ºè¡¨é¢ï¼‰ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_FULLSCREEN-å…¨å±è¡¨é¢ï¼ˆæ˜¾ç¤ºè¡¨é¢ï¼‰ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_OPENGL-è¡¨é¢å…·æœ‰OpenGLä¸Šä¸‹æ–‡ï¼ˆæ˜¾ç¤ºè¡¨é¢ï¼‰ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_OPENGLBLIT-æ›²é¢æ”¯æŒå¯¹OpenGLè¿›è¡Œç€è‰²å¤„ç†ï¼ˆæ˜¾ç¤ºæ›²é¢ï¼‰ã€‚æ³¨æ„ã€‚æ­¤é€‰é¡¹ä»…ç”¨äºå…¼å®¹æ€§ï¼Œä¸å»ºè®®ç”¨äºæ–°ä»£ç ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_RESIZABLE-å¯ä»¥è°ƒæ•´è¡¨é¢ï¼ˆæ˜¾ç¤ºè¡¨é¢ï¼‰çš„å¤§å°ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_HWACCEL-è¡¨é¢é’åŒ–ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_SRCCOLORKEY-è‚¤æµ…ä½¿ç”¨é¢œè‰²æ¶‚æŠ¹ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_RLEACCEL-ä½¿ç”¨RLEå¯ä»¥åŠ é€Ÿé¢œè‰²æ¨¡ç³Šã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_SRCALPHA-Surface Blythä½¿ç”¨Alphaæ··åˆã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SDL_PREALLOC-è¡¨é¢ä½¿ç”¨é¢„åˆ†é…çš„å†…å­˜ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs">SDL_Thread</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥ç»“æ„æ˜¯ç³»ç»Ÿç‹¬ç«‹çš„ï¼Œæ‚¨å¯èƒ½ä¸éœ€è¦ä½¿ç”¨å®ƒã€‚</font><font style="vertical-align: inherit;">æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§æºä»£ç ä¸­çš„src / thread / sdl_thread_c.hã€‚</font></font><br>
<br>
<pre><code class="cpp hljs">SDL_cond</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥ç»“æ„æ˜¯ç³»ç»Ÿç‹¬ç«‹çš„ï¼Œæ‚¨å¯èƒ½ä¸éœ€è¦ä½¿ç”¨å®ƒã€‚</font><font style="vertical-align: inherit;">æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§æºä»£ç ä¸­çš„src / thread / &lt;system&gt; /SDL_syscond.cã€‚</font></font><br>
<br>
<pre><code class="cpp hljs">SDL_mutex</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥ç»“æ„æ˜¯ç³»ç»Ÿç‹¬ç«‹çš„ï¼Œæ‚¨å¯èƒ½ä¸éœ€è¦ä½¿ç”¨å®ƒã€‚</font><font style="vertical-align: inherit;">æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§æºä»£ç ä¸­çš„src / thread / &lt;system&gt; /SDL_sysmutex.cã€‚</font></font><a name="links"></a><br>
<br>
<hr><hr><hr><hr><hr><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é“¾æ¥</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="é™„å½•2.æ•°æ®ç»“æ„"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â† </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="åˆ°ç›®å½•"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â‡‘</font></font></a></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img width="122" height="30" src="https://habrastorage.org/webt/ts/cs/ro/tscsrofdmymu7o1rbml2evolway.png"></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FFmpegå’ŒSDLæ•™ç¨‹æˆ–å¦‚ä½•ç¼–å†™å°‘äº1000è¡Œçš„è§†é¢‘æ’­æ”¾å™¨</font></font></a><br>
<br>
<img width="30" height="30" src="https://habrastorage.org/webt/3y/wq/mh/3ywqmhuo7fv68jggkc416kbzuw4.png"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FFmpeg</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">FFmpegä¸»é¡µ</font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">SDLä¸»é¡µ</font></a></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img width="122" height="30" src="https://habrastorage.org/webt/z0/e1/6o/z0e16ozcekig9i8jdthljdqpgga.png"></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img width="60" height="30" src="https://habrastorage.org/webt/js/4n/23/js4n231ba7glkow_nud5i3dsveq.png"> </a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><br>
<br>
<hr><hr><hr><hr><hr><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img align="right" width="420" height="125" src="https://habrastorage.org/webt/co/i3/m0/coi3m0tliby9r5uxtiydjoeaqkm.png"></a><br clear="left">
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦è¯·å‚é˜…EDISONå…¬å¸çš„åšå®¢ï¼š</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FFmpeg libavæ‰‹å†Œ</font></font></b></a><br></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN502834/index.html">å¦‚ä½•åœ¨å…­ä¸ªæœˆç”šè‡³æ›´å¿«çš„æ—¶é—´å†…æˆä¸ºä¸€åDevOpså·¥ç¨‹å¸ˆã€‚ç¬¬5éƒ¨åˆ†ã€‚éƒ¨ç½²</a></li>
<li><a href="../zh-CN502836/index.html">Unityç¼–è¾‘å™¨å†é™©è®°ï¼šåºåˆ—åŒ–çš„Matryoshka</a></li>
<li><a href="../zh-CN502838/index.html">ITå’Œæ•°å­—èŒä¸šä¹‹é—´çš„åŒºåˆ«æ˜¯ï¼šæ•°å­—åŒ–è½¬å‹å’Œä¸“å®¶æ„è§</a></li>
<li><a href="../zh-CN502840/index.html">é—ªäº®çš„3D EinScan Pro 2X Plus 3Dæ‰«æä»ªè¯„è®º</a></li>
<li><a href="../zh-CN502842/index.html">å¦‚ä½•ä¿æŠ¤ç”¨æˆ·ç”Ÿç‰©ç‰¹å¾æ•°æ®å…å—çŠ¯ç½ªä½¿ç”¨</a></li>
<li><a href="../zh-CN502846/index.html">æ‰å…‹ä¼¯æ ¼å¼€è®¾äº†å•†åº—ã€‚Instagramå’ŒFacebooké€æ¸æˆä¸ºå•†åº—ã€‚</a></li>
<li><a href="../zh-CN502852/index.html">äººä»¬ä¸ºä»€ä¹ˆæŠ—æ‹’å˜é©ï¼Œå¦‚ä½•å¸®åŠ©ä»–ä»¬é‡å»º</a></li>
<li><a href="../zh-CN502854/index.html">ä¸ºä»€ä¹ˆERPå®æ–½å¤±è´¥ï¼Ÿ</a></li>
<li><a href="../zh-CN502860/index.html">5æœˆ20æ—¥è¿è¾“ï¼šèˆªç©ºä¸šè¿…é€Ÿæ¢å¤å¯è§</a></li>
<li><a href="../zh-CN502862/index.html">LabVIEW NXG-å‰é¢æ¿åŸºç¡€çŸ¥è¯†-æ§ä»¶å’ŒæŒ‡ç¤ºå™¨</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>