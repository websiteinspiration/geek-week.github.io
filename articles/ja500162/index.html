<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧑🏼‍🤝‍🧑🏼 💧 😱 素晴らしいPythonスポーツデータ処理チュートリアル 🧓🏿 🤴🏻 🔝</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="私の自由時間の最後の数年はトライアスロンをやっています。このスポーツは世界の多くの国で、特​​にアメリカ、オーストラリア、ヨーロッパで非常に人気があります。現在ロシアとCIS諸国で急速に人気を得ています。それは専門家ではなくアマチュアを巻き込むことについてです。プールで泳いだり、午前中にサイクリング...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>素晴らしいPythonスポーツデータ処理チュートリアル</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500162/"><img src="https://habrastorage.org/webt/wd/xv/ft/wdxvftc1pifrlchwt7ddj8dxtos.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の自由時間の最後の数年はトライアスロンをやっています。このスポーツは世界の多くの国で、特​​にアメリカ、オーストラリア、ヨーロッパで非常に人気があります。現在ロシアとCIS諸国で急速に人気を得ています。それは専門家ではなくアマチュアを巻き込むことについてです。プールで泳いだり、午前中にサイクリングやジョギングをしたりするのとは異なり、トライアスロンは、プロでなくても、競技に参加したり、体系的な準備をしたりします。きっとあなたの友達の中にすでに少なくとも一人の「鉄人」または一人になることを計画している人がいます。巨大さ、さまざまな距離と条件、3つのスポーツが1つに-これらすべてが大量のデータを形成する可能性があります。毎年、世界で数百のトライアスロン競技が行われ、数十万人が参加します。コンテストはいくつかの主催者によって開催されます。もちろん、それぞれが独自に結果を公開しています。しかし、ロシアおよび一部のCIS諸国の選手の場合、チームは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tristats.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はすべての結果を1 </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">か所に</font></a><font style="vertical-align: inherit;">収集します-同じ名前のWebサイト上。これは、あなたとあなたの友人とライバルの両方、あるいはあなたのアイドルでさえ、結果を検索することを非常に便利にします。しかし、私にとっては、プログラムで多数の結果を分析する機会も与えられました。 trilifeで公開された結果：をお</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">読みください</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、この種の私の最初のプロジェクトでした。なぜなら、私は最近、原理的にデータ分析を始め、</font><i><font style="vertical-align: inherit;">Python</font></i><font style="vertical-align: inherit;">を使用したからです。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">したがって、この作業の技術的な実装についてお話ししたいと思います。特に、その過程で、さまざまなニュアンスが表面化し、特別なアプローチが必要になる場合があるからです。</font><font style="vertical-align: inherit;">解体、解析、型と形式のキャスト、不完全なデータの復元、代表的なサンプルの生成、視覚化、ベクトル化、さらには並列計算についても行われます。</font></font><br>
<a name="habracut"></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ボリュームが大きくなることがわかったので、すべてを5つの部分に分割し、情報を取り出して、休憩後にどこから始めればよいかを思い出せるようにしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
先に進む前に、研究の結果を含む私の記事を最初に読むことをお勧めします。これは、基本的にその作成のためのキッチンについて説明しているためです。</font><font style="vertical-align: inherit;">10-15分かかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
読んだ？</font><font style="vertical-align: inherit;">じゃあ行こう！</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート1.スクレイピングと解析</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
指定：ウェブサイト</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tristats.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。私たちが興味を持っているテーブルには2つのタイプがあります。これは実際にはすべての人種の要約表と各人種の結果のプロトコルです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vp/m5/do/vpm5dopzyltw9iwcwdddcff2osw.png"><br>
<br>
<img src="https://habrastorage.org/webt/yf/ez/ve/yfezve61_ds1wsaiguh5tjpwd2m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最大のタスクは、このデータをプログラムで取得し、保存してさらに処理することでした。たまたまそのとき私はWebテクノロジーに不慣れだったので、すぐにこれを行う方法を知りませんでした。私は知っていることからそれに応じて始めました-ページコードを見てください。これは、マウスの右ボタンまたは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F12</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キーを使用して実行できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/43/wc/ex/43wcexjx3j9qfvjla_dubcsjgl0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
：Chromeのメニューには、2つのオプションが含ま</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビューページのコード</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビューのコードを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。最も明白な部門ではありません。当然、結果は異なります。</font><i><font style="vertical-align: inherit;">コード</font></i><font style="vertical-align: inherit;">を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示するもの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F12</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と同じ</font><font style="vertical-align: inherit;">です。ブラウザに表示されるもの</font><font style="vertical-align: inherit;">を直接テキストベースの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">htmlで</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表現したものは、要素単位です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vv/ow/wb/vvowwbmi5fdawtjbocfjo5zztm4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ページコード</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><i><font style="vertical-align: inherit;">表示すると、ページ</font></i><font style="vertical-align: inherit;">のソースコードが表示されます。また</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">html</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ですが、そこにはデータがありません。アンロードするJSスクリプトの名前のみです。はい。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o4/k7/d5/o4k7d5k8zuu66hp43vegbix9hoc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、Pythonを使用して各ページのコードを個別のテキストファイルとして保存する方法を理解する必要があります。私はこれを試します：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> requests<font></font>
<font></font>
r = requests.get(url=<span class="hljs-string">'http://tristats.ru/'</span>)<font></font>
print(r.content)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、私は...ソースコードを取得します。しかし、私はその実行の結果が必要です。勉強して、調べて、尋ねてみたところ、ブラウザのアクションを自動化するためのツール（たとえば、</font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selenium）が</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要であることに気付きました</font><font style="vertical-align: inherit;">。私はそれを置きます。また</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">Google Chrome</font></i><font style="vertical-align: inherit;">と</font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">連携する</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ための</font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ChromeDriver</font></a></i><font style="vertical-align: inherit;">。それから私はそれを次のように使用しました：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver
<span class="hljs-keyword">from</span> selenium.webdriver.chrome.service <span class="hljs-keyword">import</span> Service<font></font>
<font></font>
service = Service(<span class="hljs-string">r'C:\ChromeDriver\chromedriver.exe'</span>)<font></font>
service.start()<font></font>
driver = webdriver.Remote(service.service_url)<font></font>
driver.get(<span class="hljs-string">'http://www.tristats.ru/'</span>)<font></font>
print(driver.page_source)<font></font>
driver.quit()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードは、ブラウザウィンドウを起動し、指定されたURLのページを開きます。その結果、</font><font style="vertical-align: inherit;">目的のデータを含む</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTML</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードが既に</font><font style="vertical-align: inherit;">取得され</font><font style="vertical-align: inherit;">ています。しかし、障害が1つあります。結果はわずか100エントリで、レースの総数はほぼ2000です。実際には、最初は最初の100エントリのみがブラウザに表示され、ページの一番下までスクロールした場合にのみ、次の100エントリがロードされます。したがって、プログラムでスクロールを実装する必要があります。これを行うには、次のコマンドを使用します。</font></font><br>
<br>
<pre><code class="python hljs">driver.execute_script(<span class="hljs-string">"window.scrollTo(0, document.body.scrollHeight);"</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、スクロールするたびに、ロードされたページのコードが変更されたかどうかをチェックします。</font><font style="vertical-align: inherit;">変更されていない場合は、信頼性を数回チェックします（例：10）。その後、ページ全体がロードされ、停止できます。</font><font style="vertical-align: inherit;">スクロールの合間に、タイムアウトを1秒に設定して、ページをロードする時間を確保します。</font><font style="vertical-align: inherit;">（彼女に時間がない場合でも、予備があります-さらに9秒）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
完全なコードは次のようになります。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver
<span class="hljs-keyword">from</span> selenium.webdriver.chrome.service <span class="hljs-keyword">import</span> Service
<span class="hljs-keyword">import</span> time<font></font>
<font></font>
service = Service(<span class="hljs-string">r'C:\ChromeDriver\chromedriver.exe'</span>)<font></font>
service.start()<font></font>
driver = webdriver.Remote(service.service_url)<font></font>
driver.get(<span class="hljs-string">'http://www.tristats.ru/'</span>)<font></font>
prev_html = <span class="hljs-string">''</span>
scroll_attempt = <span class="hljs-number">0</span><font></font>
<font></font>
<span class="hljs-keyword">while</span> scroll_attempt &lt; <span class="hljs-number">10</span>:<font></font>
    driver.execute_script(<span class="hljs-string">"window.scrollTo(0, document.body.scrollHeight);"</span>)<font></font>
    time.sleep(<span class="hljs-number">1</span>)<font></font>
<font></font>
    <span class="hljs-keyword">if</span> prev_html == driver.page_source:<font></font>
        scroll_attempt += <span class="hljs-number">1</span>
    <span class="hljs-keyword">else</span>:<font></font>
        prev_html = driver.page_source<font></font>
        scroll_attempt = <span class="hljs-number">0</span> <font></font>
<font></font>
<span class="hljs-keyword">with</span> open(<span class="hljs-string">r'D:\tri\summary.txt'</span>, <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> f:<font></font>
    f.write(prev_html)<font></font>
<font></font>
driver.quit()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、</font><font style="vertical-align: inherit;">すべての人種の要約表を</font><font style="vertical-align: inherit;">含む</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">html</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルがあります。</font><font style="vertical-align: inherit;">解析する必要があります。</font><font style="vertical-align: inherit;">これを行うには、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lxml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブラリーを使用します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> lxml <span class="hljs-keyword">import</span> html
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、テーブルのすべての行を見つけます。</font><font style="vertical-align: inherit;">文字列の符号を判別するに</font><font style="vertical-align: inherit;">は、テキストエディターで</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">html</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルを確認します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/b2/j6/_8/b2j6_8isg6smzxbgkojrppfwif4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「tr ng-repeat = 'r in racesData' class = 'ng-scope'」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">や、どのタグにも見つからなくなったフラグメントなどが考えられます。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">with</span> open(<span class="hljs-string">r'D:\tri\summary.txt'</span>, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:<font></font>
    sum_html = f.read()<font></font>
<font></font>
tree = html.fromstring(sum_html)<font></font>
rows = tree.findall(<span class="hljs-string">".//*[@ng-repeat='r in racesData']"</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pandasデータフレーム</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を開始し</font><font style="vertical-align: inherit;">、テーブルの各行の各要素がこのデータフレームに書き込まれます。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
<font></font>
rs = pd.DataFrame(columns=[<span class="hljs-string">'date'</span>,<span class="hljs-string">'name'</span>,<span class="hljs-string">'link'</span>,<span class="hljs-string">'males'</span>,<span class="hljs-string">'females'</span>,<span class="hljs-string">'rus'</span>,<span class="hljs-string">'total'</span>], index=range(len(rows))) <span class="hljs-comment">#rs – races summary</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特定の各要素が非表示になっている場所を特定するに</font><font style="vertical-align: inherit;">は、同じテキストエディターで</font><i><font style="vertical-align: inherit;">行</font></i><font style="vertical-align: inherit;">の要素の1つの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTML</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コード</font><font style="vertical-align: inherit;">を確認する必要があり</font><font style="vertical-align: inherit;">ます。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">ng-repeat</span>=<span class="hljs-string">"r in racesData"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ng-scope"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ng-binding"</span>&gt;</span>2015-04-26<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/Images/flags/24/USA.png"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flag"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/rus/result/ironman/texas/half/2015"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_self"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ng-binding"</span>&gt;</span>Ironman Texas 70.3 2015<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/rus/result/ironman/texas/half/2015?sex=F"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_self"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ng-binding"</span>&gt;</span>605<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fas fa-venus fa-lg"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"color:Pink"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><font></font>
      /<font></font>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/rus/result/ironman/texas/half/2015?sex=M"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_self"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ng-binding"</span>&gt;</span>1539<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fas fa-mars fa-lg"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"color:LightBlue"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ng-binding"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/Images/flags/24/rus.png"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flag"</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- ngIf: r.CountryCount == 0 --&gt;</span>
      <span class="hljs-comment">&lt;!-- ngIf: r.CountryCount &gt; 0 --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">ng-if</span>=<span class="hljs-string">"r.CountryCount &gt; 0"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/rus/result/ironman/texas/half/2015?country=rus"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_self"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ng-binding ng-scope"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- end ngIf: r.CountryCount &gt; 0 --&gt;</span><font></font>
      / 2144<font></font>
  <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで子供のためのナビゲーションをハードコードする最も簡単な方法は、それらの多くが存在しないことです。 </font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(rows)):<font></font>
    rs.loc[i,<span class="hljs-string">'date'</span>] = rows[i].getchildren()[<span class="hljs-number">0</span>].text.strip()<font></font>
    rs.loc[i,<span class="hljs-string">'name'</span>] = rows[i].getchildren()[<span class="hljs-number">1</span>].getchildren()[<span class="hljs-number">1</span>].text.strip()<font></font>
    rs.loc[i,<span class="hljs-string">'link'</span>] = rows[i].getchildren()[<span class="hljs-number">1</span>].getchildren()[<span class="hljs-number">1</span>].attrib[<span class="hljs-string">'href'</span>].strip()<font></font>
    rs.loc[i,<span class="hljs-string">'males'</span>] = rows[i].getchildren()[<span class="hljs-number">2</span>].getchildren()[<span class="hljs-number">2</span>].text.strip()<font></font>
    rs.loc[i,<span class="hljs-string">'females'</span>] = rows[i].getchildren()[<span class="hljs-number">2</span>].getchildren()[<span class="hljs-number">0</span>].text.strip()<font></font>
    rs.loc[i,<span class="hljs-string">'rus'</span>] = rows[i].getchildren()[<span class="hljs-number">3</span>].getchildren()[<span class="hljs-number">3</span>].text.strip()<font></font>
    rs.loc[i,<span class="hljs-string">'total'</span>] = rows[i].getchildren()[<span class="hljs-number">3</span>].text_content().split(<span class="hljs-string">'/'</span>)[<span class="hljs-number">1</span>].strip()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果は次のとおり</font><font style="vertical-align: inherit;">
です。このデータフレームをファイルに保存します。</font><font style="vertical-align: inherit;">私は</font><i><font style="vertical-align: inherit;">pickle</font></i><font style="vertical-align: inherit;">を使用します</font><font style="vertical-align: inherit;">が、それは</font><i><font style="vertical-align: inherit;">csv</font></i><font style="vertical-align: inherit;">または他の何か</font><font style="vertical-align: inherit;">かもしれ</font><font style="vertical-align: inherit;">ません。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>date</th>
<th>event</th>
<th>link</th>
<th>males</th>
<th>females</th>
<th>rus</th>
<th>total</th>
</tr>
<tr>
<td>0</td>
<td>2020-07-02</td>
<td>Ironman Dubai Duathlon 70.3 2020</td>
<td>/rus/result/ironman/dubai-duathlon/half/2020</td>
<td>835</td>
<td>215</td>
<td>65</td>
<td>1050</td>
</tr>
<tr>
<td>1</td>
<td>2020-02-07</td>
<td>Ironman Dubai 70.3 2020</td>
<td>/rus/result/ironman/dubai/half/2020</td>
<td>638</td>
<td>132</td>
<td>55</td>
<td>770</td>
</tr>
<tr>
<td>2</td>
<td>2020-01-29</td>
<td>Israman Half 2020</td>
<td>/rus/result/israman/israman/half/2020</td>
<td>670</td>
<td>126</td>
<td>4</td>
<td>796</td>
</tr>
<tr>
<td>3</td>
<td>2019-12-08</td>
<td>Ironman Indian Wells La Quinta 70.3 2019</td>
<td>/rus/result/ironman/indian-wells-la-quinta/hal...</td>
<td>1590</td>
<td>593</td>
<td>6</td>
<td>2183</td>
</tr>
<tr>
<td>4</td>
<td>2019-12-07</td>
<td>Ironman Taupo 70.3 2019</td>
<td>/rus/result/ironman/taupo/half/2019</td>
<td>767</td>
<td>420</td>
<td>3</td>
<td>1187</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<td>1917</td>
<td>1994-07-02</td>
<td>ITU European Championship Eichstatt Olympic 1994</td>
<td>/rus/result/itu/european-championship-eichstat...</td>
<td>61</td>
<td>0</td>
<td>2</td>
<td>61</td>
</tr>
<tr>
<td>1918</td>
<td>1993-09-04</td>
<td>Challenge Almere-Amsterdam Long 1993</td>
<td>/rus/result/challenge/almere-amsterdam/full/1993</td>
<td>795</td>
<td>32</td>
<td>1</td>
<td>827</td>
</tr>
<tr>
<td>1919</td>
<td>1993-07-04</td>
<td>ITU European Cup Echternach Olympic 1993</td>
<td>/rus/result/itu/european-cup-echternach/olympi...</td>
<td>60</td>
<td>0</td>
<td>2</td>
<td>60</td>
</tr>
<tr>
<td>1920</td>
<td>1992-09-12</td>
<td>ITU World Championship Huntsville Olympic 1992</td>
<td>/rus/result/itu/world-championship-huntsville/...</td>
<td>317</td>
<td>0</td>
<td>3</td>
<td>317</td>
</tr>
<tr>
<td>1921</td>
<td>1990-09-15</td>
<td>ITU World Championship Orlando Olympic 1990</td>
<td>/rus/result/itu/world-championship-orlando/oly...</td>
<td>286</td>
<td>0</td>
<td>5</td>
<td>28</td>
</tr>
</tbody></table></div></code><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> pickle <span class="hljs-keyword">as</span> pkl<font></font>
<font></font>
<span class="hljs-keyword">with</span> open(<span class="hljs-string">r'D:\tri\summary.pkl'</span>, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> f:<font></font>
    pkl.dump(df,f)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この段階では、すべてのデータは文字列型です。</font><font style="vertical-align: inherit;">後で変換します。</font><font style="vertical-align: inherit;">現在必要な最も重要なものはリンクです。</font><font style="vertical-align: inherit;">すべての種族のプロトコルをこするためにそれらを使用します。</font><font style="vertical-align: inherit;">ピボットテーブルでどのように行われたかというイメージと肖像画で作成しました。</font><font style="vertical-align: inherit;">それぞれのすべてのレースのサイクルで、参照によってページを開き、スクロールしてページコードを取得します。</font><font style="vertical-align: inherit;">概要表には、レースの参加者の総数に関する情報があります- </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">合計</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、スクロールを続ける必要がある時点までを理解するために使用します。これを行うために、各ページを直接スクレイピングするプロセスで、テーブル内のレコード数を決定し、それを合計の期待値と比較します。それが等しくなるとすぐに、最後までスクロールして、次のレースに進むことができます。また、タイムアウトを60秒に設定しました。この間に食べたので、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">合計</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">はなりません</font><font style="vertical-align: inherit;">、次のレースに行きます。ページコードはファイルに保存されます。すべてのレースのファイルを1つのフォルダーに保存し、レースの名前、つまり</font><font style="vertical-align: inherit;">ピボットテーブルの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イベント</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列の値によってファイルに名前を付け</font><font style="vertical-align: inherit;">ます。名前の競合を回避するには、ピボットテーブルですべての人種に異なる名前を付ける必要があります。これをチェックして：</font></font><br>
<br>
<pre><code class="python hljs">df[df.duplicated(subset = <span class="hljs-string">'event'</span>, keep=<span class="hljs-literal">False</span>)]
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>date</th>
<th>event</th>
<th>link</th>
<th>males</th>
<th>females</th>
<th>rus</th>
<th>total</th>
</tr>
<tr>
<td>450</td>
<td>2018-07-15</td>
<td>A1  Sprint 2018</td>
<td>/rus/result/a1/cc/sprint/2018-07-15</td>
<td>43</td>
<td>15</td>
<td>47</td>
<td>58</td>
</tr>
<tr>
<td>483</td>
<td>2018-06-23</td>
<td>A1  Sprint 2018</td>
<td>/rus/result/a1/cc/sprint/2018-06-23</td>
<td>61</td>
<td>15</td>
<td>76</td>
<td>76</td>
</tr>
<tr>
<td>670</td>
<td>2017-07-30</td>
<td>3Grom  Olympic 2017</td>
<td>/rus/result/3grom//olympic/2017-07-30</td>
<td>249</td>
<td>44</td>
<td>293</td>
<td>293</td>
</tr>
<tr>
<td>752</td>
<td>2017-06-11</td>
<td>3Grom  Olympic 2017</td>
<td>/rus/result/3grom//olympic/2017-06-11</td>
<td>251</td>
<td>28</td>
<td>279</td>
<td>279</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さて、概要表には繰り返しがあり、さらに、日付と参加者の数（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">男性、女性、ロシア、合計</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）があり、リンクは異なります。</font><font style="vertical-align: inherit;">これらのプロトコルを確認する必要があります。プロトコルはいくつかあるので、手動で行うことができます。</font><font style="vertical-align: inherit;">すべての名前が一意になったため、大規模なマイニングサイクルを開始します。</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/a8/v7/n8/a8v7n8qoxbzobftxcm0knnvks6m.png"><br>
<br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>date</th>
<th>event</th>
<th>link</th>
<th>males</th>
<th>females</th>
<th>rus</th>
<th>total</th>
</tr>
<tr>
<td>450</td>
<td>2018-07-15</td>
<td>A1  Sprint <u>7</u> 2018</td>
<td>/rus/result/a1/cc/sprint/2018-07-15</td>
<td>43</td>
<td>15</td>
<td>47</td>
<td>58</td>
</tr>
<tr>
<td>483</td>
<td>2018-06-23</td>
<td>A1  Sprint <u>6</u> 2018</td>
<td>/rus/result/a1/cc/sprint/2018-06-23</td>
<td>61</td>
<td>15</td>
<td>76</td>
<td>76</td>
</tr>
<tr>
<td>670</td>
<td>2017-07-30</td>
<td>3Grom  Olympic <u>7</u> 2017</td>
<td>/rus/result/3grom//olympic/2017-07-30</td>
<td>249</td>
<td>44</td>
<td>293</td>
<td>293</td>
</tr>
<tr>
<td>752</td>
<td>2017-06-11</td>
<td>3Grom  Olympic <u>6</u> 2017</td>
<td>/rus/result/3grom//olympic/2017-06-11</td>
<td>251</td>
<td>28</td>
<td>279</td>
<td>27</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">service.start()<font></font>
driver = webdriver.Remote(service.service_url)<font></font>
timeout = <span class="hljs-number">60</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> index, row <span class="hljs-keyword">in</span> df.iterrows():
    <span class="hljs-keyword">try</span>:<font></font>
        driver.get(<span class="hljs-string">'http://www.tristats.ru'</span> + row[<span class="hljs-string">'link'</span>])     <font></font>
        start = time.time()<font></font>
<font></font>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<font></font>
            driver.execute_script(<span class="hljs-string">"window.scrollTo(0, document.body.scrollHeight);"</span>)<font></font>
            time.sleep(<span class="hljs-number">1</span>)<font></font>
            race_html = driver.page_source<font></font>
            tree = html.fromstring(race_html)<font></font>
            race_rows = tree.findall(<span class="hljs-string">".//*[@ng-repeat='r in resultsData']"</span>)<font></font>
<font></font>
            <span class="hljs-keyword">if</span> len(race_rows) == int(row[<span class="hljs-string">'total'</span>]):
                <span class="hljs-keyword">break</span>
            <span class="hljs-keyword">if</span> time.time() - start &gt; timeout:<font></font>
                print(<span class="hljs-string">'timeout'</span>)
                <span class="hljs-keyword">break</span><font></font>
<font></font>
        <span class="hljs-keyword">with</span> open(os.path.join(<span class="hljs-string">r'D:\tri\races'</span>, row[<span class="hljs-string">'event'</span>] +  <span class="hljs-string">'.txt'</span>), <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> f:<font></font>
            f.write(race_html)<font></font>
<font></font>
    <span class="hljs-keyword">except</span>:<font></font>
        traceback.print_exc()<font></font>
<font></font>
    time.sleep(<span class="hljs-number">1</span>)<font></font>
    <font></font>
driver.quit()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは長いプロセスです。</font><font style="vertical-align: inherit;">しかし、すべてが設定され、この重いメカニズムが回転し始め、データファイルを次々に追加していくと、心地よい興奮が感じられます。</font><font style="vertical-align: inherit;">1分あたり約3つのプロトコルのみが非常にゆっくりとロードされます。</font><font style="vertical-align: inherit;">一晩スピンするために去った。</font><font style="vertical-align: inherit;">約10時間かかりました。</font><font style="vertical-align: inherit;">朝までに、ほとんどのプロトコルがアップロードされました。</font><font style="vertical-align: inherit;">通常、ネットワークで作業しているときに発生するため、いくつかは失敗します。</font><font style="vertical-align: inherit;">2回目の試行ですばやく再開しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/un/wi/el/unwielrqjzt6u6otf8sbwwjbq8q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、合計容量がほぼ3 GBの1,922個のファイルがあります。涼しい！しかし、ほぼ300のレースの処理はタイムアウトで終了しました。何か問題でもありますか？選択的に確認すると、実際にピボットテーブルの合計値と、確認したレースプロトコルのエントリ数が一致しない場合があります。この矛盾の理由が明確でないため、これは悲しいことです。これは、全員が終了するわけではないという事実、またはデータベースの何らかのバグが原因です。一般的に、データの欠陥の最初の信号。いずれの場合も、エントリ数が100または0のエントリをチェックします。これらは最も疑わしい候補です。それらの8つがありました。厳重な管理下で再度ダウンロードしてください。ちなみに、そのうちの2つには実際には100のエントリがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、私たちはすべてのデータを持っています。</font><font style="vertical-align: inherit;">解析に移ります。</font><font style="vertical-align: inherit;">繰り返しますが、サイクルでは、各レースを実行し、ファイルを読み取り、内容を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pandas DataFrameに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保存します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これらのデータフレームを</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dict</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">結合</font><font style="vertical-align: inherit;">します。ここでは、レースの名前がキーになります。つまり</font><font style="vertical-align: inherit;">、ピボットテーブルの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イベント</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値</font><font style="vertical-align: inherit;">または</font><font style="vertical-align: inherit;">レースページの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">html</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードを含む</font><font style="vertical-align: inherit;">ファイルの名前が</font><font style="vertical-align: inherit;">一致します。</font></font><br>
<br>
<pre><code class="python hljs">rd = {} <span class="hljs-comment">#rd – race details</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> rs[<span class="hljs-string">'event'</span>]:<font></font>
    place = []<font></font>
    ... sex = [], name=..., country, group, place_in_group, swim, t1, bike, t2, run<font></font>
    result = []<font></font>
<font></font>
    <span class="hljs-keyword">with</span> open(os.path.join(<span class="hljs-string">r'D:\tri\races'</span>, e + <span class="hljs-string">'.txt'</span>), <span class="hljs-string">'r'</span>)<font></font>
        race_html = f.read()<font></font>
<font></font>
    tree = html.fromstring(race_html)<font></font>
    rows = tree.findall(<span class="hljs-string">".//*[@ng-repeat='r in resultsData']"</span>)<font></font>
<font></font>
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(len(rows)):<font></font>
        row = rows[j]<font></font>
        parts = row.text_content().split(<span class="hljs-string">'\n'</span>)<font></font>
        parts = [r.strip() <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> parts <span class="hljs-keyword">if</span> r.strip() != <span class="hljs-string">''</span>]<font></font>
        place.append(parts[<span class="hljs-number">0</span>])<font></font>
<font></font>
        <span class="hljs-keyword">if</span> len([a <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> row.findall(<span class="hljs-string">'.//i'</span>)]) &gt; <span class="hljs-number">0</span>:<font></font>
            sex.append([a <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> row.findall(<span class="hljs-string">'.//i'</span>)][<span class="hljs-number">0</span>].attrib[<span class="hljs-string">'ng-if'</span>][<span class="hljs-number">10</span>:<span class="hljs-number">-1</span>])
        <span class="hljs-keyword">else</span>:<font></font>
            sex.append(<span class="hljs-string">''</span>)<font></font>
<font></font>
        name.append(parts[<span class="hljs-number">1</span>])<font></font>
<font></font>
        <span class="hljs-keyword">if</span> len(parts) &gt; <span class="hljs-number">10</span>:<font></font>
            country.append(parts[<span class="hljs-number">2</span>].strip())         <font></font>
            k=<span class="hljs-number">0</span>
        <span class="hljs-keyword">else</span>:<font></font>
            country.append(<span class="hljs-string">''</span>)<font></font>
            k=<span class="hljs-number">1</span><font></font>
<font></font>
        group.append(parts[<span class="hljs-number">3</span>-k])<font></font>
        ... place_in_group.append(...), swim.append ..., t1, bike, t2, run<font></font>
        result.append(parts[<span class="hljs-number">10</span>-k])<font></font>
<font></font>
    race = pd.DataFrame()<font></font>
    race[<span class="hljs-string">'place'</span>] = place<font></font>
    ... race[<span class="hljs-string">'sex'</span>] = sex, race[<span class="hljs-string">'name'</span>] = ..., <span class="hljs-string">'country'</span>, <span class="hljs-string">'group'</span>, <span class="hljs-string">'place_in_group'</span>, <span class="hljs-string">'swim'</span>, <span class="hljs-string">' t1'</span>, <span class="hljs-string">'bike'</span>, <span class="hljs-string">'t2'</span>, <span class="hljs-string">'run'</span>
    race[<span class="hljs-string">'result'</span>] = result<font></font>
<font></font>
    rd[e] = race<font></font>
<font></font>
<span class="hljs-keyword">with</span> open(<span class="hljs-string">r'D:\tri\details.pkl'</span>, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> f:<font></font>
    pkl.dump(rd,f)<font></font>
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th>country</th>
<th>group</th>
<th>place in group</th>
<th>swim</th>
<th>t1</th>
<th>bike</th>
<th>t2</th>
<th>run</th>
<th>result</th>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>M</td>
<td>Reed, Tim</td>
<td>AUS</td>
<td>MPRO</td>
<td>1</td>
<td>24:34</td>
<td>1:07</td>
<td>2:13:46</td>
<td>1:49</td>
<td>1:23:17</td>
<td>4:04:33</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>M</td>
<td>Van Berkel, Tim</td>
<td>AUS</td>
<td>MPRO</td>
<td>2</td>
<td>24:34</td>
<td>1:05</td>
<td>2:13:47</td>
<td>1:53</td>
<td>1:27:17</td>
<td>4:08:36</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>M</td>
<td>Baldwin, Nicholas</td>
<td>SEY</td>
<td>MPRO</td>
<td>3</td>
<td>26:31</td>
<td>0:59</td>
<td>2:14:06</td>
<td>1:54</td>
<td>1:25:36</td>
<td>4:09:06</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>M</td>
<td>Polizzi, Alexander</td>
<td>AUS</td>
<td>MPRO</td>
<td>4</td>
<td>23:21</td>
<td>1:12</td>
<td>2:14:53</td>
<td>1:54</td>
<td>1:31:16</td>
<td>4:12:36</td>
</tr>
<tr>
<td>4</td>
<td>5</td>
<td>M</td>
<td>Chang, Chia-Hao</td>
<td>TWN</td>
<td>M18-24</td>
<td>1</td>
<td>25:18</td>
<td>1:34</td>
<td>2:23:38</td>
<td>2:13</td>
<td>1:29:01</td>
<td>4:21:44</td>
</tr>
<tr>
<td>5</td>
<td>6</td>
<td>M</td>
<td>Rondy, Guillaume</td>
<td>FRA</td>
<td>M35-39</td>
<td>1</td>
<td>27:51</td>
<td>1:26</td>
<td>2:21:53</td>
<td>2:29</td>
<td>1:35:19</td>
<td>4:28:58</td>
</tr>
<tr>
<td>6</td>
<td>7</td>
<td>F</td>
<td>Steffen, Caroline</td>
<td>SUI</td>
<td>FPRO</td>
<td>1</td>
<td>26:52</td>
<td>1:01</td>
<td>2:24:54</td>
<td>2:10</td>
<td>1:34:17</td>
<td>4:29:14</td>
</tr>
<tr>
<td>7</td>
<td>8</td>
<td>M</td>
<td>Betten, Sam</td>
<td>AUS</td>
<td>MPRO</td>
<td>5</td>
<td>23:30</td>
<td>1:26</td>
<td>2:18:24</td>
<td>1:57</td>
<td>1:45:07</td>
<td>4:30:24</td>
</tr>
<tr>
<td>8</td>
<td>9</td>
<td>M</td>
<td>Gallot, Simon</td>
<td>FRA</td>
<td>M30-34</td>
<td>1</td>
<td>27:50</td>
<td>1:33</td>
<td>2:20:15</td>
<td>2:13</td>
<td>1:45:22</td>
<td>4:37:13</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<td>524</td>
<td>525</td>
<td>M</td>
<td>Santos, Alfredo</td>
<td>PHI</td>
<td>M65-69</td>
<td>2</td>
<td>50:42</td>
<td>4:23</td>
<td>3:52:10</td>
<td>10:32</td>
<td>3:36:11</td>
<td>8:33:58</td>
</tr>
<tr>
<td>525</td>
<td>526</td>
<td>F</td>
<td>Escober, Eula</td>
<td>PHI</td>
<td>F18-24</td>
<td>5</td>
<td>47:07</td>
<td>3:50</td>
<td>4:43:44</td>
<td>3:41</td>
<td>2:59:45</td>
<td>8:38:07</td>
</tr>
<tr>
<td>526</td>
<td>527</td>
<td>M</td>
<td>Belen, Virgilio Jr.</td>
<td>PHI</td>
<td>M45-49</td>
<td>76</td>
<td>47:05</td>
<td>5:49</td>
<td>3:48:18</td>
<td>11:21</td>
<td>3:46:06</td>
<td>8:38:39</td>
</tr>
<tr>
<td>527</td>
<td>528</td>
<td>M</td>
<td>Kunimoto, Kilhak</td>
<td>GUM</td>
<td>M70-74</td>
<td>2</td>
<td>40:32</td>
<td>2:50</td>
<td>3:53:37</td>
<td>6:45</td>
<td>4:01:36</td>
<td>8:45:20</td>
</tr>
<tr>
<td>528</td>
<td>529</td>
<td>M</td>
<td>Sumicad, Siegfred</td>
<td>PHI</td>
<td>M50-54</td>
<td>54</td>
<td>59:10</td>
<td>4:38</td>
<td>4:11:55</td>
<td>6:35</td>
<td>3:23:45</td>
<td>8:46:03</td>
</tr>
<tr>
<td>529</td>
<td>530</td>
<td>M</td>
<td>Gomez, Paul</td>
<td>PHI</td>
<td>M45-49</td>
<td>77</td>
<td>50:02</td>
<td>6:29</td>
<td>4:07:58</td>
<td>7:24</td>
<td>3:41:41</td>
<td>8:53:34</td>
</tr>
<tr>
<td>530</td>
<td>531</td>
<td>M</td>
<td>Ramos, John Raymund</td>
<td>PHI</td>
<td>M25-29</td>
<td>26</td>
<td>43:44</td>
<td>3:04</td>
<td>4:21:13</td>
<td>5:56</td>
<td>3:45:10</td>
<td>8:59:07</td>
</tr>
<tr>
<td>531</td>
<td>532</td>
<td>F</td>
<td>De Guzman, Clouie Anne</td>
<td>PHI</td>
<td>F30-34</td>
<td>9</td>
<td>52:29</td>
<td>3:16</td>
<td>4:03:02</td>
<td>7:01</td>
<td>3:56:39</td>
<td>9:02:27</td>
</tr>
<tr>
<td>532</td>
<td>533</td>
<td>F</td>
<td>Samson, Maria Dolores</td>
<td>PHI</td>
<td>F45-49</td>
<td>17</td>
<td>48:56</td>
<td>4:21</td>
<td>4:16:34</td>
<td>6:26</td>
<td>3:47:06</td>
<td>9:03:23</td>
</tr>
<tr>
<td>533</td>
<td>534</td>
<td>M</td>
<td>Salazar, Richard</td>
<td>PHI</td>
<td>M40-44</td>
<td>107</td>
<td>42:19</td>
<td>4:02</td>
<td>4:30:36</td>
<td>6:39</td>
<td>3:39:51</td>
<td>9:03:27</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参加者の結果の表に加えて、</font><font style="vertical-align: inherit;">各レースの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">html</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルには、コンテストの日付、名前、場所も含まれています。</font><font style="vertical-align: inherit;">日付と名前は既にピボットテーブルにありますが、場所がありません。</font><font style="vertical-align: inherit;">この情報を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">html</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル</font><font style="vertical-align: inherit;">から読み取り</font><font style="vertical-align: inherit;">、ピボットテーブルの新しい列に追加します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> index, row <span class="hljs-keyword">in</span> rs.iterrows():<font></font>
    e = row[<span class="hljs-string">'event'</span>]       
    <span class="hljs-keyword">with</span> open(os.path.join(<span class="hljs-string">r'D:\tri\races'</span>, e + <span class="hljs-string">'.txt'</span>), <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:<font></font>
        race_html = f.read()<font></font>
<font></font>
    tree = html.fromstring(race_html)<font></font>
    header_elem = [tb <span class="hljs-keyword">for</span> tb <span class="hljs-keyword">in</span> tree.findall(<span class="hljs-string">'.//tbody'</span>) <span class="hljs-keyword">if</span> tb.getchildren()[<span class="hljs-number">0</span>].getchildren()[<span class="hljs-number">0</span>].text == <span class="hljs-string">''</span>][<span class="hljs-number">0</span>]<font></font>
    location = header_elem.getchildren()[<span class="hljs-number">1</span>].getchildren()[<span class="hljs-number">1</span>].text.strip()<font></font>
    rs.loc[index, <span class="hljs-string">'loc'</span>] = location
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>event</th>
<th>date</th>
<th><u>loc</u></th>
<th>male</th>
<th>female</th>
<th>rus</th>
<th>total</th>
<th>link</th>
</tr>
<tr>
<td>0</td>
<td>Ironman Dubai Duathlon 70.3 2020</td>
<td>2020-07-02</td>
<td><u>Dubai, United Arab Emirates</u></td>
<td>835</td>
<td>215</td>
<td>65</td>
<td>1050</td>
<td>...</td>
</tr>
<tr>
<td>1</td>
<td>Ironman Dubai 70.3 2020</td>
<td>2020-02-07</td>
<td><u>Dubai, United Arab Emirates</u></td>
<td>638</td>
<td>132</td>
<td>55</td>
<td>770</td>
<td>...</td>
</tr>
<tr>
<td>2</td>
<td>Israman Half 2020</td>
<td>2020-01-29</td>
<td><u>Israel, Eilat</u></td>
<td>670</td>
<td>126</td>
<td>4</td>
<td>796</td>
<td>...</td>
</tr>
<tr>
<td>3</td>
<td>Ironman Indian Wells La Quinta 70.3 2019</td>
<td>2019-12-08</td>
<td><u>Indian Wells/La Quinta, California, USA</u></td>
<td>1590</td>
<td>593</td>
<td>6</td>
<td>2183</td>
<td>...</td>
</tr>
<tr>
<td>4</td>
<td>Ironman Taupo 70.3 2019</td>
<td>2019-12-07</td>
<td><u>New Zealand</u></td>
<td>767</td>
<td>420</td>
<td>3</td>
<td>1187</td>
<td>...</td>
</tr>
<tr>
<td>5</td>
<td>Ironman Bahrain 70.3 2019</td>
<td>2019-12-07</td>
<td><u>Manama, Bahrain</u></td>
<td>858</td>
<td>214</td>
<td>38</td>
<td>1072</td>
<td>...</td>
</tr>
<tr>
<td>6</td>
<td>Ironman Western Australia 2019</td>
<td>2019-12-01</td>
<td><u>Busselton, Western Australia</u></td>
<td>940</td>
<td>229</td>
<td>1</td>
<td>1169</td>
<td>...</td>
</tr>
<tr>
<td>7</td>
<td>Ironman Mar del Plata 2019</td>
<td>2019-12-01</td>
<td><u>Mar del Plata, Argentina</u></td>
<td>506</td>
<td>66</td>
<td>3</td>
<td>572</td>
<td>...</td>
</tr>
<tr>
<td>8</td>
<td>Ironman Cozumel 2019</td>
<td>2019-11-24</td>
<td><u>Cozumel, Mexico</u></td>
<td>1158</td>
<td>395</td>
<td>12</td>
<td>1553</td>
<td>...</td>
</tr>
<tr>
<td>9</td>
<td>Ironman Arizona 2019</td>
<td>2019-11-24</td>
<td><u>Tempe, Arizona, USA</u></td>
<td>1697</td>
<td>633</td>
<td>3</td>
<td>2330</td>
<td>...</td>
</tr>
<tr>
<td>10</td>
<td>Ironman Xiamen 70.3 2019</td>
<td>2019-11-10</td>
<td><u>Xiamen, China</u></td>
<td>897</td>
<td>170</td>
<td>14</td>
<td>1067</td>
<td>...</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セーブ。</font><font style="vertical-align: inherit;">新しいファイルに。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">with</span> open(<span class="hljs-string">r'D:\tri\summary1.pkl'</span>, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> f:<font></font>
    pkl.dump(df,f)<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート2.タイプのキャストとフォーマット</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、すべてのデータをダウンロードして、データフレームに配置しました。</font><font style="vertical-align: inherit;">ただし、すべての値は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">型</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">これは、日付、結果、場所、およびその他すべてのパラメータに適用されます。</font><font style="vertical-align: inherit;">すべてのパラメーターを適切なタイプに変換する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ピボットテーブルから始めましょう。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>event</th>
<th>date</th>
<th><u>loc</u></th>
<th>male</th>
<th>female</th>
<th>rus</th>
<th>total</th>
<th>link</th>
</tr>
<tr>
<td>0</td>
<td>Ironman Dubai Duathlon 70.3 2020</td>
<td>2020-07-02</td>
<td><u>Dubai, United Arab Emirates</u></td>
<td>835</td>
<td>215</td>
<td>65</td>
<td>1050</td>
<td>...</td>
</tr>
<tr>
<td>1</td>
<td>Ironman Dubai 70.3 2020</td>
<td>2020-02-07</td>
<td><u>Dubai, United Arab Emirates</u></td>
<td>638</td>
<td>132</td>
<td>55</td>
<td>770</td>
<td>...</td>
</tr>
<tr>
<td>2</td>
<td>Israman Half 2020</td>
<td>2020-01-29</td>
<td><u>Israel, Eilat</u></td>
<td>670</td>
<td>126</td>
<td>4</td>
<td>796</td>
<td>...</td>
</tr>
<tr>
<td>3</td>
<td>Ironman Indian Wells La Quinta 70.3 2019</td>
<td>2019-12-08</td>
<td><u>Indian Wells/La Quinta, California, USA</u></td>
<td>1590</td>
<td>593</td>
<td>6</td>
<td>2183</td>
<td>...</td>
</tr>
<tr>
<td>4</td>
<td>Ironman Taupo 70.3 2019</td>
<td>2019-12-07</td>
<td><u>New Zealand</u></td>
<td>767</td>
<td>420</td>
<td>3</td>
<td>1187</td>
<td>...</td>
</tr>
<tr>
<td>5</td>
<td>Ironman Bahrain 70.3 2019</td>
<td>2019-12-07</td>
<td><u>Manama, Bahrain</u></td>
<td>858</td>
<td>214</td>
<td>38</td>
<td>1072</td>
<td>...</td>
</tr>
<tr>
<td>6</td>
<td>Ironman Western Australia 2019</td>
<td>2019-12-01</td>
<td><u>Busselton, Western Australia</u></td>
<td>940</td>
<td>229</td>
<td>1</td>
<td>1169</td>
<td>...</td>
</tr>
<tr>
<td>7</td>
<td>Ironman Mar del Plata 2019</td>
<td>2019-12-01</td>
<td><u>Mar del Plata, Argentina</u></td>
<td>506</td>
<td>66</td>
<td>3</td>
<td>572</td>
<td>...</td>
</tr>
<tr>
<td>8</td>
<td>Ironman Cozumel 2019</td>
<td>2019-11-24</td>
<td><u>Cozumel, Mexico</u></td>
<td>1158</td>
<td>395</td>
<td>12</td>
<td>1553</td>
<td>...</td>
</tr>
<tr>
<td>9</td>
<td>Ironman Arizona 2019</td>
<td>2019-11-24</td>
<td><u>Tempe, Arizona, USA</u></td>
<td>1697</td>
<td>633</td>
<td>3</td>
<td>2330</td>
<td>...</td>
</tr>
<tr>
<td>10</td>
<td>Ironman Xiamen 70.3 2019</td>
<td>2019-11-10</td>
<td><u>Xiamen, China</u></td>
<td>897</td>
<td>170</td>
<td>14</td>
<td>1067</td>
<td>...</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
<td><u>...</u></td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
</tbody></table></div></code><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日時</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">event</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はそのままになります。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日付</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">への変換</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パンダは、日時</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、次のように：</font></font><br>
<br>
<pre><code class="python hljs">rs[<span class="hljs-string">'date'</span>] = pd.to_datetime(rs[<span class="hljs-string">'date'</span>])
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残りは整数型にキャストされます：</font></font><br>
<br>
<pre><code class="python hljs">cols = [<span class="hljs-string">'males'</span>, <span class="hljs-string">'females'</span>, <span class="hljs-string">'rus'</span>, <span class="hljs-string">'total'</span>]<font></font>
rs[cols] = rs[cols].astype(int)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてがスムーズに進み、エラーは発生しませんでした。</font><font style="vertical-align: inherit;">だからすべてがOKです-保存：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">with</span> open(<span class="hljs-string">r'D:\tri\summary2.pkl'</span>, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> f:<font></font>
    pkl.dump(rs, f)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在、データフレームをレースしています。</font><font style="vertical-align: inherit;">すべてのレースは一度に処理するのではなく、一度に処理する方が便利で高速なので</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">concat</font></i><font style="vertical-align: inherit;">メソッドを使用して、</font><font style="vertical-align: inherit;">1つの大きな</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データフレーム</font><font style="vertical-align: inherit;">（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのレコードの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">略</font><font style="vertical-align: inherit;">）に</font><font style="vertical-align: inherit;">収集します</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">ar = pd.concat(rd) 
</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は1,416,365エントリが含まれています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、プレイスとプレイスイングル​​ープを整数値に変換します。</font></font><br>
<br>
<pre><code class="python hljs">ar[[<span class="hljs-string">'place'</span>, <span class="hljs-string">'place in group'</span>]] = ar[[<span class="hljs-string">'place'</span>, <span class="hljs-string">'place in group'</span>]].astype(int))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、一時的な値で列を処理します。</font><font style="vertical-align: inherit;">それらを</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pandas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から</font><i><font style="vertical-align: inherit;">Timedelta</font></i><font style="vertical-align: inherit;">型に</font><i><font style="vertical-align: inherit;">キャスト</font></i><font style="vertical-align: inherit;">し</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ただし、変換を成功させるには、データを適切に準備する必要があります。</font><font style="vertical-align: inherit;">1時間未満の一部の値は、ヒントを指定せずに進むことがわかります。</font><font style="vertical-align: inherit;">追加する必要があります。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th>country</th>
<th>group</th>
<th>place in group</th>
<th><u>swim</u></th>
<th><u>t1</u></th>
<th>bike</th>
<th><u>t2</u></th>
<th>run</th>
<th>result</th>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>M</td>
<td>Dejan Patrcevic</td>
<td>CRO</td>
<td>M40-44</td>
<td>1</td>
<td><u>29:03</u></td>
<td><u>2:50</u></td>
<td>2:09:17</td>
<td><u>1:37</u></td>
<td>1:22:06</td>
<td>4:04:51</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>M</td>
<td>Lukas Krpec</td>
<td>CZE</td>
<td>M35-39</td>
<td>1</td>
<td><u>29:00</u></td>
<td><u>2:40</u></td>
<td>2:07:01</td>
<td><u>1:48</u></td>
<td>1:25:48</td>
<td>4:06:15</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>M</td>
<td>Marin Koceic</td>
<td>CRO</td>
<td>M40-44</td>
<td>2</td>
<td><u>27:34</u></td>
<td><u>2:09</u></td>
<td>2:12:13</td>
<td><u>1:30</u></td>
<td>1:27:19</td>
<td>4:10:44</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> [<span class="hljs-string">'swim'</span>, <span class="hljs-string">'t1'</span>, <span class="hljs-string">'bike'</span>, <span class="hljs-string">'t2'</span>, <span class="hljs-string">'run'</span>, <span class="hljs-string">'result'</span>]:<font></font>
    strlen = ar[col].str.len()<font></font>
    ar.loc[strlen==<span class="hljs-number">5</span>, col] = <span class="hljs-string">'0:'</span> + ar.loc[strlen==<span class="hljs-number">5</span>, col]<font></font>
    ar.loc[strlen==<span class="hljs-number">4</span>, col] = <span class="hljs-string">'0:0'</span> + ar.loc[strlen==<span class="hljs-number">4</span>, col]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、残りの文字列は次のようになります：</font><i><font style="vertical-align: inherit;">Timedeltaに</font></i><font style="vertical-align: inherit;">変換し</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">：</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th>country</th>
<th>group</th>
<th>place in group</th>
<th><u>swim</u></th>
<th><u>t1</u></th>
<th>bike</th>
<th><u>t2</u></th>
<th>run</th>
<th>result</th>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>M</td>
<td>Dejan Patrcevic</td>
<td>CRO</td>
<td>M40-44</td>
<td>1</td>
<td><u>0:29:03</u></td>
<td><u>0:02:50</u></td>
<td>2:09:17</td>
<td><u>0:01:37</u></td>
<td>1:22:06</td>
<td>4:04:51</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>M</td>
<td>Lukas Krpec</td>
<td>CZE</td>
<td>M35-39</td>
<td>1</td>
<td><u>0:29:00</u></td>
<td><u>0:02:40</u></td>
<td>2:07:01</td>
<td><u>0:01:48</u></td>
<td>1:25:48</td>
<td>4:06:15</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>M</td>
<td>Marin Koceic</td>
<td>CRO</td>
<td>M40-44</td>
<td>2</td>
<td><u>0:27:34</u></td>
<td><u>0:02:09</u></td>
<td>2:12:13</td>
<td><u>0:01:30</u></td>
<td>1:27:19</td>
<td>4:10:44</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> [<span class="hljs-string">'swim'</span>, <span class="hljs-string">'t1'</span>, <span class="hljs-string">'bike'</span>, <span class="hljs-string">'t2'</span>, <span class="hljs-string">'run'</span>, <span class="hljs-string">'result'</span>]:<font></font>
    ar[col] = pd.to_timedelta(ar[col])<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">床</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
進め。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性別の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値しかない</font><font style="vertical-align: inherit;">ことを確認し</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'sex'</span>].unique() 
</code></pre><br>
<code><b>Out:</b> ['M', 'F', '']<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、まだ空の文字列が残っています。つまり、性別は指定されていません。</font><font style="vertical-align: inherit;">そのようなケースの数を見てみましょう：</font></font><br>
<br>
<pre><code class="python hljs">len(ar[ar[<span class="hljs-string">'sex'</span>] == <span class="hljs-string">''</span>]) 
</code></pre><br>
<code><b>Out:</b> 2538<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それほど良いことではありません。</font><font style="vertical-align: inherit;">将来的には、この値をさらに削減するよう努めます。</font><font style="vertical-align: inherit;">その間、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セックスの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">は線の形の</font><font style="vertical-align: inherit;">ままにしておきます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">結果を保存してから、より深刻でリスクのある変換に移ります。</font><font style="vertical-align: inherit;">ファイル間の連続性を維持するために、結合されたデータフレーム</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を変換してデータフレーム</font><font style="vertical-align: inherit;">の辞書</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rdに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">戻します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> event <span class="hljs-keyword">in</span> ar.index.get_level_values(<span class="hljs-number">0</span>).unique():<font></font>
    rd[event] = ar.loc[event]<font></font>
<font></font>
<span class="hljs-keyword">with</span> open(<span class="hljs-string">r'D:\tri\details1.pkl'</span>, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> f:<font></font>
    pkl.dump(rd,f)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、一部の列のタイプの変換により、ピボットテーブルのファイルサイズは367 KBから295 KBに、レーシングプロトコルのファイルサイズは251 MBから168 MBに減少しました。 </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国コード</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでは国を見てみましょう。</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'country'</span>].unique()
</code></pre><br>
<code><b>Out:</b> ['CRO', 'CZE', 'SLO', 'SRB', 'BUL', 'SVK', 'SWE', 'BIH', 'POL', 'MK', 'ROU', 'GRE', 'FRA', 'HUN', 'NOR', 'AUT', 'MNE', 'GBR', 'RUS', 'UAE', 'USA', 'GER', 'URU', 'CRC', 'ITA', 'DEN', 'TUR', 'SUI', 'MEX', 'BLR', 'EST', 'NED', 'AUS', 'BGI', 'BEL', 'ESP', 'POR', 'UKR', 'CAN', 'IRL', 'JPN', 'HKG', 'JEY', 'SGP', 'BRA', 'QAT', 'LUX', 'RSA', 'NZL', 'LAT', 'PHI', 'KSA', 'SEY', 'MAS', 'OMA', 'ARG', 'ECU', 'THA', 'JOR', 'BRN', 'CIV', 'FIN', 'IRN', 'BER', 'LBA', 'KUW', 'LTU', 'SRI', 'HON', 'INA', 'LBN', 'PAN', 'EGY', 'MLT', 'WAL', 'ISL', 'CYP', 'DOM', 'IND', 'VIE', 'MRI', 'AZE', 'MLD', 'LIE', 'VEN', 'ALG', 'SYR', 'MAR', 'KZK', 'PER', 'COL', 'IRQ', 'PAK', 'CZK', 'KAZ', 'CHN', 'NEP', 'ISR', 'MKD', 'FRO', 'BAN', 'ARU', 'CPV', 'ALB', 'BIZ', 'TPE', 'KGZ', 'BNN', 'CUB', 'SNG', 'VTN', 'THI', 'PRG', 'KOR', 'RE', 'TW', 'VN', 'MOL', 'FRE', 'AND', 'MDV', 'GUA', 'MON', 'ARM', 'F.I.TRI.', 'BAHREIN', 'SUECIA', 'REPUBLICA CHECA', 'BRASIL', 'CHI', 'MDA', 'TUN', 'NDL', 'Danish(Dane)', 'Welsh', 'Austrian', 'Unknown', 'AFG', 'Argentinean', 'Pitcairn', 'South African', 'Greenland', 'ESTADOS UNIDOS', 'LUXEMBURGO', 'SUDAFRICA', 'NUEVA ZELANDA', 'RUMANIA', 'PM', 'BAH', 'LTV', 'ESA', 'LAB', 'GIB', 'GUT', 'SAR', 'ita', 'aut', 'ger', 'esp', 'gbr', 'hun', 'den', 'usa', 'sui', 'slo', 'cze', 'svk', 'fra', 'fin', 'isr', 'irn', 'irl', 'bel', 'ned', 'sco', 'pol', 'SMR', 'mex', 'STEEL T BG', 'KINO MANA', 'IVB', 'TCH', 'SCO', 'KEN', 'BAS', 'ZIM', 'Joe', 'PUR', 'SWZ', 'Mark', 'WLS', 'MYA', 'BOT', 'REU', 'NAM', 'NCL', 'BOL', 'GGY', 'ISV', 'TWN', 'GUM', 'FIJ', 'COK', 'NGR', 'IRI', 'GAB', 'ANT', 'GEO', 'COG', 'sue', 'SUD', 'BAR', 'CAY', 'BO', 'VE', 'AX', 'MD', 'PAR', 'UM', 'SEN', 'NIG', 'RWA', 'YEM', 'PLE', 'GHA', 'ITU', 'UZB', 'MGL', 'MAC', 'DMA', 'TAH', 'TTO', 'AHO', 'JAM', 'SKN', 'GRN', 'PRK', 'NFK', 'SOL', 'Sandy', 'SAM', 'PNG', 'SGS', 'Suchy, Jorg', 'SOG', 'GEQ', 'BVT', 'DJI', 'CHA', 'ANG', 'YUG', 'IOT', 'HAI', 'SJM', 'CUW', 'BHU', 'ERI', 'FLK', 'HMD', 'GUF', 'ESH', 'sandy', 'UMI', 'selsmark, 'Alise', 'Eddie', '31/3, Colin', 'CC', '', '', '', '', '', ' ', '', '', '', '-', '', 'GRL', 'UGA', 'VAT', 'ETH', 'ASA', 'PYF', 'ATA', 'ALA', 'MTQ', 'ZZ', 'CXR', 'AIA', 'TJK', 'GUY', 'KR', 'PF', 'BN', 'MO', 'LA', 'CAM', 'NCA', 'ZAM', 'MAD', 'TOG', 'VIR', 'ATF', 'VAN', 'SLE', 'GLP', 'SCG', 'LAO', 'IMN', 'BUR', 'IR', 'SY', 'CMR', 'GBS', 'SUR', 'MOZ', 'BLM', 'MSR', 'CAF', 'BEN', 'COD', 'CCK', 'TUV', 'TGA', 'GI', 'XKX', 'NRU', 'NC', 'LBR', 'TAN', 'VIN', 'SSD', 'GP', 'PS', 'IM', 'JE', '', 'MLI', 'FSM', 'LCA', 'GMB', 'MHL', 'NH', 'FL', 'CT', 'UT', 'AQ', 'Korea', 'Taiwan', 'NewCaledonia', 'Czech Republic', 'PLW', 'BRU', 'RUN', 'NIU', 'KIR', 'SOM', 'TKM', 'SPM', 'BDI', 'COM', 'TCA', 'SHN', 'DO2', 'DCF', 'PCN', 'MNP', 'MYT', 'SXM', 'MAF', 'GUI', 'AN', 'Slovak republic', 'Channel Islands', 'Reunion', 'Wales', 'Scotland', 'ica', 'WLF', 'D', 'F', 'I', 'B', 'L', 'E', 'A', 'S', 'N', 'H', 'R', 'NU', 'BES', 'Bavaria', 'TLS', 'J', 'TKL', 'Tirol"', 'P', '?????', 'EU', 'ES-IB', 'ES-CT', '', 'SOO', 'LZE', '', '', '', '', '', '']<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
412個の一意の値。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
基本的に、国は大文字の3桁の文字コードで示されます。</font><font style="vertical-align: inherit;">しかし、明らかに、常にではありません。</font><font style="vertical-align: inherit;">実際、国際規格</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ISO 3166があり</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、存在しない国も含めて、すべての国に対応する3桁および2桁のコードが規定されています。</font><font style="vertical-align: inherit;">以下のため</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のpython、</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この標準の実装の1つはで見つけることができ</font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pycountryの</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージ</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">仕組みは次のとおりです。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> pycountry <span class="hljs-keyword">as</span> pyco<font></font>
<font></font>
pyco.countries.get(alpha_3 = <span class="hljs-string">'RUS'</span>)
</code></pre><br>
<code><b>Out:</b> Country(alpha_2='RU', alpha_3='RUS', name='Russian Federation', numeric='643')<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、大文字につながるすべての3桁のコードをチェックし、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">countries.get（...）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">historical_countries.get（...）で</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">応答を</font><i><font style="vertical-align: inherit;">返し</font></i><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs">valid_a3 = [c <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> ar[<span class="hljs-string">'country'</span>].unique() <span class="hljs-keyword">if</span> pyco.countries.get(alpha_3 = c.upper()) != <span class="hljs-literal">None</span> <span class="hljs-keyword">or</span> pyco.historic_countries.get(alpha_3 = c.upper()) != <span class="hljs-literal">None</span>])
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
412件中190件、つまり半分以下でした。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残りの222（リストを</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tofixで表す</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）の場合</font><i><font style="vertical-align: inherit;">、</font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修正</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マッチング辞書を</font><i><font style="vertical-align: inherit;">作成し</font></i><i><font style="vertical-align: inherit;">ます。</font></i><font style="vertical-align: inherit;">キーは元の名前で、値はISO規格に基づく3桁のコードです。</font></font><br>
<br>
<pre><code class="python hljs">tofix = list(set(ar[<span class="hljs-string">'country'</span>].unique()) - set(valid_a3))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大文字につながるpycountry.countries.get（alpha_2 = ...）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">2桁のコードを確認し</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> icc <span class="hljs-keyword">in</span> tofix: <span class="hljs-comment">#icc -invalid country code</span>
    <span class="hljs-keyword">if</span> pyco.countries.get(alpha_2 = icc.upper()) != <span class="hljs-literal">None</span>:<font></font>
        fix[icc] = pyco.countries.get(alpha_2 = icc.upper()).alpha_3<font></font>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">if</span> pyco.historic_countries.get(alpha_2 = icc.upper()) != <span class="hljs-literal">None</span>:<font></font>
            fix[icc] = pyco.historic_countries.get(alpha_2 = icc.upper()).alpha_3<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pycountry.countries.get（name = ...）、pycountry.countries.get（common_name = ...）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フルネームを取得</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し、</font><i><font style="vertical-align: inherit;">str.title（）の</font></i><font style="vertical-align: inherit;">形式に導きます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> icc <span class="hljs-keyword">in</span> tofix:
    <span class="hljs-keyword">if</span> pyco.countries.get(common_name = icc.title()) != <span class="hljs-literal">None</span>:<font></font>
        fix[icc] = pyco.countries.get(common_name = icc.title()).alpha_3<font></font>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">if</span> pyco.countries.get(name = icc.title()) != <span class="hljs-literal">None</span>:<font></font>
            fix[icc] = pyco.countries.get(name = icc.title()).alpha_3<font></font>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">if</span> pyco.historic_countries.get(name = icc.title()) != <span class="hljs-literal">None</span>:<font></font>
                fix[icc] = pyco.historic_countries.get(name = icc.title()).alpha_3<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、私たちは認識されない値の数を190に減らします。それでもかなり多く：</font><font style="vertical-align: inherit;">
それらの中にまだ多くの3桁のコードがあることに気づくかもしれませんが、これはISOではありません。</font><font style="vertical-align: inherit;">それで？</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">オリンピックという</font></a><font style="vertical-align: inherit;">別の基準があることがわかりました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">残念ながら、その実装はpycountryに含まれていないため、他の方法を探す必要があります。</font><font style="vertical-align: inherit;">ソリューションは</font><font style="vertical-align: inherit;">、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">datahub.ioの</font></a><i><font style="vertical-align: inherit;">csv</font></i><font style="vertical-align: inherit;">ファイルの</font><font style="vertical-align: inherit;">形式で見つかりました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このファイルの内容を置き</font><i><font style="vertical-align: inherit;">パンダのデータフレーム</font></i><font style="vertical-align: inherit;">と呼ばれる</font><i><font style="vertical-align: inherit;">CDF</font></i><font style="vertical-align: inherit;">。</font><i><font style="vertical-align: inherit;">ioc-国際</font></i><font style="vertical-align: inherit;">オリンピック委員会（IOC）</font></font><br>
<code>['URU', '', 'PAR', 'SUECIA', 'KUW', 'South African', '', 'Austrian', 'ISV', 'H', 'SCO', 'ES-CT', ', 'GUI', 'BOT', 'SEY', 'BIZ', 'LAB', 'PUR', ' ', 'Scotland', '', '', 'TCH', 'TGA', 'UT', 'BAH', 'GEQ', 'NEP', 'TAH', 'ica', 'FRE', 'E', 'TOG', 'MYA', '', 'Danish (Dane)', 'SAM', 'TPE', 'MON', 'ger', 'Unknown', 'sui', 'R', 'SUI', 'A', 'GRN', 'KZK', 'Wales', '', 'GBS', 'ESA', 'Bavaria', 'Czech Republic', '31/3, Colin', 'SOL', 'SKN', '', 'MGL', 'XKX', 'WLS', 'MOL', 'FIJ', 'CAY', 'ES-IB', 'BER', 'PLE', 'MRI', 'B', 'KSA', '', '', 'LAT', 'GRE', 'ARU', '', 'THI', 'NGR', 'MAD', 'SOG', 'MLD', '?????', 'AHO', 'sco', 'UAE', 'RUMANIA', 'CRO', 'RSA', 'NUEVA ZELANDA', 'KINO MANA', 'PHI', 'sue', 'Tirol"', 'IRI', 'POR', 'CZK', 'SAR', 'D', 'BRASIL', 'DCF', 'HAI', 'ned', 'N', 'BAHREIN', 'VTN', 'EU', 'CAM', 'Mark', 'BUL', 'Welsh', 'VIN', 'HON', 'ESTADOS UNIDOS', 'I', 'GUA', 'OMA', 'CRC', 'PRG', 'NIG', 'BHU', 'Joe', 'GER', 'RUN', 'ALG', '', 'Channel Islands', 'Reunion', 'REPUBLICA CHECA', 'slo', 'ANG', 'NewCaledonia', 'GUT', 'VIE', 'ASA', 'BAR', 'SRI', 'L', '', 'J', 'BAS', 'LUXEMBURGO', 'S', 'CHI', 'SNG', 'BNN', 'den', 'F.I.TRI.', 'STEEL T BG', 'NCA', 'Slovak republic', 'MAS', 'LZE', '-', 'F', 'BRU', '', 'LBA', 'NDL', 'DEN', 'IVB', 'BAN', 'Sandy', 'ZAM', 'sandy', 'Korea', 'SOO', 'BGI', '', 'LTV', 'selsmark, Alise', 'TAN', 'NED', '', 'Suchy, Jorg', 'SLO', 'SUDAFRICA', 'ZIM', 'Eddie', 'INA', '', 'SUD', 'VAN', 'FL', 'P', 'ITU', 'ZZ', 'Argentinean', 'CHA', 'DO2', 'WAL']<br>
</code><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>official name</th>
<th>short name</th>
<th>iso2</th>
<th><u>iso3</u></th>
<th><u>ioc</u></th>
</tr>
<tr>
<td>0</td>
<td>NaN</td>
<td>Taiwan</td>
<td>TW</td>
<td><u>TWN</u></td>
<td><u>TPE</u></td>
</tr>
<tr>
<td>1</td>
<td>Afghanistan</td>
<td>Afghanistan</td>
<td>AF</td>
<td><u>AFG</u></td>
<td><u>AFG</u></td>
</tr>
<tr>
<td>2</td>
<td>Albania</td>
<td>Albania</td>
<td>AL</td>
<td><u>ALB</u></td>
<td><u>ALB</u></td>
</tr>
<tr>
<td>3</td>
<td>Algeria</td>
<td>Algeria</td>
<td>DZ</td>
<td><u>DZA</u></td>
<td><u>ALG</u></td>
</tr>
<tr>
<td>4</td>
<td>American Samoa</td>
<td>American Samoa</td>
<td>AS</td>
<td><u>ASM</u></td>
<td><u>ASA</u></td>
</tr>
<tr>
<td>5</td>
<td>Andorra</td>
<td>Andorra</td>
<td>AD</td>
<td><u>AND</u></td>
<td><u>AND</u></td>
</tr>
<tr>
<td>6</td>
<td>Angola</td>
<td>Angola</td>
<td>AO</td>
<td><u>AGO</u></td>
<td><u>ANG</u></td>
</tr>
<tr>
<td>7</td>
<td>Anguilla</td>
<td>Anguilla</td>
<td>AI</td>
<td><u>AIA</u></td>
<td><u>AIA</u></td>
</tr>
<tr>
<td>8</td>
<td>Antarctica</td>
<td>Antarctica</td>
<td>AQ</td>
<td><u>ATA</u></td>
<td><u>NaN</u></td>
</tr>
<tr>
<td>9</td>
<td>Antigua and Barbuda</td>
<td>Antigua &amp; Barbuda</td>
<td>AG</td>
<td><u>ATG</u></td>
<td><u>ANT</u></td>
</tr>
<tr>
<td>10</td>
<td>Argentina</td>
<td>Argentina</td>
<td>AR</td>
<td><u>ARG</u></td>
<td><u>ARG</u></td>
</tr>
</tbody></table></div></code><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">len(([x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> tofix <span class="hljs-keyword">if</span> x.upper() <span class="hljs-keyword">in</span> list(cdf[<span class="hljs-string">'ioc'</span>])]))
</code></pre><br>
<code><b>Out:</b> 82<br>
</code><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tofix</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
からの3桁のコードの中で</font><i><font style="vertical-align: inherit;">、</font></i><font style="vertical-align: inherit;"> 82の対応する</font><i><font style="vertical-align: inherit;">IOCが</font></i><font style="vertical-align: inherit;">見つかりました。</font><font style="vertical-align: inherit;">それらを一致する辞書に追加します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> icc <span class="hljs-keyword">in</span> tofix:
    <span class="hljs-keyword">if</span> icc.upper() <span class="hljs-keyword">in</span> list(cdf[<span class="hljs-string">'ioc'</span>]):<font></font>
        ind = cdf[cdf[<span class="hljs-string">'ioc'</span>] == icc.upper()].index[<span class="hljs-number">0</span>]<font></font>
        fix[icc] = cdf.loc[ind, <span class="hljs-string">'iso3'</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
未加工の値が108個残っています。</font><font style="vertical-align: inherit;">手動で終了し、場合によってはGoogleに支援を求めます。</font><font style="vertical-align: inherit;">
しかし、手動制御でも問題を完全に解決することはできません。</font><font style="vertical-align: inherit;">すでに解釈することは不可能である49の値が残っています。</font><font style="vertical-align: inherit;">これらの値のほとんどは、おそらく単なるデータエラーです。</font></font><br>
<code>{'BGI': 'BRB', 'WAL': 'GBR', 'MLD': 'MDA', 'KZK': 'KAZ', 'CZK': 'CZE', 'BNN': 'BEN', 'SNG': 'SGP', 'VTN': 'VNM', 'THI': 'THA', 'PRG': 'PRT', 'MOL': 'MDA', 'FRE': 'FRA', 'F.I.TRI.': 'ITA', 'BAHREIN': 'BHR', 'SUECIA': 'SWE', 'REPUBLICA CHECA': 'CZE', 'BRASIL': 'BRA', 'NDL': 'NLD', 'Danish (Dane)': 'DNK', 'Welsh': 'GBR', 'Austrian': 'AUT', 'Argentinean': 'ARG', 'South African': 'ZAF', 'ESTADOS UNIDOS': 'USA', 'LUXEMBURGO': 'LUX', 'SUDAFRICA': 'ZAF', 'NUEVA ZELANDA': 'NZL', 'RUMANIA': 'ROU', 'sco': 'GBR', 'SCO': 'GBR', 'WLS': 'GBR', '': 'IND', '': 'IRL', '': 'ARM', '': 'BGR', '': 'SRB', ' ': 'BLR', '': 'GBR', '': 'FRA', '': 'HND', '-': 'CRI', '': 'AZE', 'Korea': 'KOR', 'NewCaledonia': 'FRA', 'Czech Republic': 'CZE', 'Slovak republic': 'SVK', 'Channel Islands': 'FRA', 'Reunion': 'FRA', 'Wales': 'GBR', 'Scotland': 'GBR', 'Bavaria': 'DEU', 'Tirol"': 'AUT', '': 'KGZ', '': 'BLR', '': 'BLR', '': 'BLR', '': 'RUS', '': 'BLR', '': 'RUS'}<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">unfixed = [x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> tofix <span class="hljs-keyword">if</span> x <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> fix.keys()]
</code></pre><br>
<code><b>Out:</b> ['', 'H', 'ES-CT', 'LAB', 'TCH', 'UT', 'TAH', 'ica', 'E', 'Unknown', 'R', 'A', '31/3, Colin', 'XKX', 'ES-IB','B','SOG','?????','KINO MANA','sue','SAR','D', 'DCF', 'N', 'EU', 'Mark', 'I', 'Joe', 'RUN', 'GUT', 'L', 'J', 'BAS', 'S', 'STEEL T BG', 'LZE', 'F', 'Sandy', 'DO2', 'sandy', 'SOO', 'LTV', 'selsmark, Alise', 'Suchy, Jorg' 'Eddie', 'FL', 'P', 'ITU', 'ZZ']<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのキーは、一致する辞書で空の文字列になります。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> cc <span class="hljs-keyword">in</span> unfixed:<font></font>
    fix[cc] = <span class="hljs-string">''</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、一致する辞書コードに、有効であるが小文字で書かれたコードを追加します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> cc <span class="hljs-keyword">in</span> valid_a3:
    <span class="hljs-keyword">if</span> cc.upper() != cc:<font></font>
        fix[cc] = cc.upper()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、見つかった置換を適用します。</font><font style="vertical-align: inherit;">さらに比較するために初期データを保存するには、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">country</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">country rawに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コピーします</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次に、作成した一致する辞書を使用して、</font><font style="vertical-align: inherit;">ISOに対応しない</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列の</font><font style="vertical-align: inherit;">値</font><font style="vertical-align: inherit;">を修正し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> cc <span class="hljs-keyword">in</span> fix:<font></font>
    ind = ar[ar[<span class="hljs-string">'country'</span>] == cc].index<font></font>
    ar.loc[ind,<span class="hljs-string">'country'</span>] = fix[cc]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、もちろん、ベクトル化なしでは実行できません。テーブルには、約150万行があります。</font><font style="vertical-align: inherit;">しかし、辞書によると、私たちはサイクルを行っていますが、それ以外はどうですか？</font><font style="vertical-align: inherit;">変更されたレコードの数を確認します。</font></font><br>
<br>
<pre><code class="python hljs">len(ar[ar[<span class="hljs-string">'country'</span>] != ar[<span class="hljs-string">'country raw'</span>]])
</code></pre><br>
<code><b>Out:</b> 315955<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、全体の20％以上です。 </font></font><br>
<br>
<pre><code class="python hljs">ar[ar[<span class="hljs-string">'country'</span>] != ar[<span class="hljs-string">'country raw'</span>]].sample(<span class="hljs-number">10</span>)
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th><u>country</u></th>
<th>group</th>
<th>place in group</th>
<th>...</th>
<th><u>country raw</u></th>
</tr>
<tr>
<td>285</td>
<td>286</td>
<td>M</td>
<td>Albaek, Mads Orla</td>
<td><u>DNK</u></td>
<td>M30-34</td>
<td>63</td>
<td>...</td>
<td><u>DEN</u></td>
</tr>
<tr>
<td>1288</td>
<td>1289</td>
<td>M</td>
<td>Benthien, Andreas</td>
<td><u>DEU</u></td>
<td>M40-44</td>
<td>198</td>
<td>...</td>
<td><u>GER</u></td>
</tr>
<tr>
<td>490</td>
<td>491</td>
<td>M</td>
<td>Lontok, Joselito</td>
<td><u>PHL</u></td>
<td>M50-54</td>
<td>18</td>
<td>...</td>
<td><u>PHI</u></td>
</tr>
<tr>
<td>145</td>
<td>146</td>
<td>M</td>
<td>Mathiasen, Keld</td>
<td><u>DNK</u></td>
<td>M45-49</td>
<td>16</td>
<td>...</td>
<td><u>DEN</u></td>
</tr>
<tr>
<td>445</td>
<td>446</td>
<td>M</td>
<td>Palm, Francois</td>
<td><u>ZAF</u></td>
<td>M25-29</td>
<td>48</td>
<td>...</td>
<td><u>RSA</u></td>
</tr>
<tr>
<td>152</td>
<td>153</td>
<td>M</td>
<td>Muller, Johannes</td>
<td><u>DEU</u></td>
<td>M35-39</td>
<td>19</td>
<td>...</td>
<td><u>GER</u></td>
</tr>
<tr>
<td>764</td>
<td>765</td>
<td>F</td>
<td>Woscher Sylvia</td>
<td><u>DEU</u></td>
<td>F55-59</td>
<td>8</td>
<td>...</td>
<td><u>GER</u></td>
</tr>
<tr>
<td>2182</td>
<td>2183</td>
<td>M</td>
<td>Kojellis, Holger</td>
<td><u>DEU</u></td>
<td>M40-44</td>
<td>258</td>
<td>...</td>
<td><u>GER</u></td>
</tr>
<tr>
<td>1293</td>
<td>1294</td>
<td>M</td>
<td>Zweer, Waldemar</td>
<td><u>DEU</u></td>
<td>M25-29</td>
<td>117</td>
<td>...</td>
<td><u>GER</u></td>
</tr>
<tr>
<td>747</td>
<td>748</td>
<td>M</td>
<td>Petersen, Mathias</td>
<td><u>DNK</u></td>
<td>M25-29</td>
<td>79</td>
<td>...</td>
<td><u>DE</u></td>
</tr>
</tbody></table></div></code><br>
<pre><code class="python hljs">len(ar[ar[<span class="hljs-string">'country'</span>] == <span class="hljs-string">''</span>])
</code></pre><br>
<code><b>Out:</b> 3221<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、フォーマットされていない国がある、またはない国のレコード数です。</font><font style="vertical-align: inherit;">ユニークな国の数は412から250に減少しました。ここにあります：</font><font style="vertical-align: inherit;">
偏差はありません。</font><font style="vertical-align: inherit;">以前に行ったように、結合されたデータフレームをデータフレームのディクショナリに変換して戻した後</font><i><font style="vertical-align: inherit;">、</font></i><font style="vertical-align: inherit;">結果を新しい</font><i><font style="vertical-align: inherit;">details2.pkl</font></i><font style="vertical-align: inherit;">ファイルに保存します</font><font style="vertical-align: inherit;">。</font></font><br>
<code>['', 'ABW', 'AFG', 'AGO', 'AIA', 'ALA', 'ALB', 'AND', 'ANT', 'ARE', 'ARG', 'ARM', 'ASM', 'ATA', 'ATF', 'AUS', 'AUT', 'AZE', 'BDI', 'BEL', 'BEN', 'BES', 'BGD', 'BGR', 'BHR', 'BHS', 'BIH', 'BLM', 'BLR', 'BLZ', 'BMU', 'BOL', 'BRA', 'BRB', 'BRN', 'BTN', 'BUR', 'BVT', 'BWA', 'CAF', 'CAN', 'CCK', 'CHE', 'CHL', 'CHN', 'CIV', 'CMR', 'COD', 'COG', 'COK', 'COL', 'COM', 'CPV', 'CRI', 'CTE', 'CUB', 'CUW', 'CXR', 'CYM', 'CYP', 'CZE', 'DEU', 'DJI', 'DMA', 'DNK', 'DOM', 'DZA', 'ECU', 'EGY', 'ERI', 'ESH', 'ESP', 'EST', 'ETH', 'FIN', 'FJI', 'FLK', 'FRA', 'FRO', 'FSM', 'GAB', 'GBR', 'GEO', 'GGY', 'GHA', 'GIB', 'GIN', 'GLP', 'GMB', 'GNB', 'GNQ', 'GRC', 'GRD', 'GRL', 'GTM', 'GUF', 'GUM', 'GUY', 'HKG', 'HMD', 'HND', 'HRV', 'HTI', 'HUN', 'IDN', 'IMN', 'IND', 'IOT', 'IRL', 'IRN', 'IRQ', 'ISL', 'ISR', 'ITA', 'JAM', 'JEY', 'JOR', 'JPN', 'KAZ', 'KEN', 'KGZ', 'KHM', 'KIR', 'KNA', 'KOR', 'KWT', 'LAO', 'LBN', 'LBR', 'LBY', 'LCA', 'LIE', 'LKA', 'LTU', 'LUX', 'LVA', 'MAC', 'MAF', 'MAR', 'MCO', 'MDA', 'MDG', 'MDV', 'MEX', 'MHL', 'MKD', 'MLI', 'MLT', 'MMR', 'MNE', 'MNG', 'MNP', 'MOZ', 'MSR', 'MTQ', 'MUS', 'MYS', 'MYT', 'NAM', 'NCL', 'NER', 'NFK', 'NGA', 'NHB', 'NIC', 'NIU', 'NLD', 'NOR', 'NPL', 'NRU', 'NZL', 'OMN', 'PAK', 'PAN', 'PCN', 'PER', 'PHL', 'PLW', 'PNG', 'POL', 'PRI', 'PRK', 'PRT', 'PRY', 'PSE', 'PYF', 'QAT', 'REU', 'ROU', 'RUS', 'RWA', 'SAU', 'SCG', 'SDN', 'SEN', 'SGP', 'SGS', 'SHN', 'SJM', 'SLB', 'SLE', 'SLV', 'SMR', 'SOM', 'SPM', 'SRB', 'SSD', 'SUR', 'SVK', 'SVN', 'SWE', 'SWZ', 'SXM', 'SYC', 'SYR', 'TCA', 'TCD', 'TGO', 'THA', 'TJK', 'TKL', 'TKM', 'TLS', 'TON', 'TTO', 'TUN', 'TUR', 'TUV', 'TWN', 'TZA', 'UGA', 'UKR', 'UMI', 'URY', 'USA', 'UZB', 'VAT', 'VCT', 'VEN', 'VGB', 'VIR', 'VNM', 'VUT', 'WLF', 'WSM', 'YEM', 'YUG', 'ZAF', 'ZMB', 'ZWE']<br>
</code><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ロケーション</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、国についての言及がピボットテーブルの列</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">locに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もあることを思い出してください</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">また、標準的な外観にする必要があります。これは少し異なる話です。ISOコードもオリンピックコードも表示されません。すべてがかなり自由な形式で記述されています。住所の市区町村、国、およびその他のコンポーネントは、コンマでランダムな順序でリストされています。最初のどこかで、最後のどこかで。 pycountryはここでは役に立ちません。そして、多くの記録があります-1922年のレースでは、525のユニークな場所（元の形式で）。</font><font style="vertical-align: inherit;">
しかし、ここで適切なツールが見つかりました。これは</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">geopy</font></a><font style="vertical-align: inherit;">、つまり</font><i><font style="vertical-align: inherit;">geolocator Nominatim</font></i><font style="vertical-align: inherit;">です。それはこのように動作します：</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>event</th>
<th>date</th>
<th><u>loc</u></th>
<th>males</th>
<th>females</th>
<th>rus</th>
<th>total</th>
<th>link</th>
</tr>
<tr>
<td>0</td>
<td>Ironman Dubai Duathlon 70.3 2020</td>
<td>2020-07-02</td>
<td><u>Dubai, United Arab Emirates</u></td>
<td>835</td>
<td>215</td>
<td>65</td>
<td>1050</td>
<td>…</td>
</tr>
<tr>
<td>1</td>
<td>Ironman Dubai 70.3 2020</td>
<td>2020-02-07</td>
<td><u>Dubai, United Arab Emirates</u></td>
<td>638</td>
<td>132</td>
<td>55</td>
<td>770</td>
<td>…</td>
</tr>
<tr>
<td>2</td>
<td>Israman Half 2020</td>
<td>2020-01-29</td>
<td><u>Israel, Eilat</u></td>
<td>670</td>
<td>126</td>
<td>4</td>
<td>796</td>
<td>…</td>
</tr>
<tr>
<td>3</td>
<td>Ironman Indian Wells La Quinta 70.3 2019</td>
<td>2019-12-08</td>
<td><u>Indian Wells/La Quinta, California, USA</u></td>
<td>1590</td>
<td>593</td>
<td>6</td>
<td>2183</td>
<td>…</td>
</tr>
<tr>
<td>4</td>
<td>Ironman Taupo 70.3 2019</td>
<td>2019-12-07</td>
<td><u>New Zealand</u></td>
<td>767</td>
<td>420</td>
<td>3</td>
<td>1187</td>
<td>…</td>
</tr>
<tr>
<td>5</td>
<td>Ironman Bahrain 70.3 2019</td>
<td>2019-12-07</td>
<td><u>Manama, Bahrain</u></td>
<td>858</td>
<td>214</td>
<td>38</td>
<td>1072</td>
<td>…</td>
</tr>
<tr>
<td>6</td>
<td>Ironman Western Australia 2019</td>
<td>2019-12-01</td>
<td><u>Busselton, Western Australia</u></td>
<td>940</td>
<td>229</td>
<td>1</td>
<td>1169</td>
<td>…</td>
</tr>
<tr>
<td>7</td>
<td>Ironman Mar del Plata 2019</td>
<td>2019-12-01</td>
<td><u>Mar del Plata, Argentina</u></td>
<td>506</td>
<td>66</td>
<td>3</td>
<td>572</td>
<td>…</td>
</tr>
<tr>
<td>8</td>
<td>Ironman Cozumel 2019</td>
<td>2019-11-24</td>
<td><u>Cozumel, Mexico</u></td>
<td>1158</td>
<td>395</td>
<td>12</td>
<td>1553</td>
<td>…</td>
</tr>
<tr>
<td>9</td>
<td>Ironman Arizona 2019</td>
<td>2019-11-24</td>
<td><u>Tempe, Arizona, USA</u></td>
<td>1697</td>
<td>633</td>
<td>3</td>
<td>2330</td>
<td>…</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> geopy.geocoders <span class="hljs-keyword">import</span> Nominatim<font></font>
<font></font>
geolocator = Nominatim(user_agent=<span class="hljs-string">'triathlon results researcher'</span>)<font></font>
geolocator.geocode(<span class="hljs-string">' , , '</span>, language=<span class="hljs-string">'en'</span>)
</code></pre><br>
<code><b>Out:</b> Location( ,  –  ,  , Altaysky District, Altai Krai, Siberian Federal District, Russia, (51.78897945, 85.73956296106752, 0.0))<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リクエストに応じて、ランダムな形式で、構造化された回答-住所と座標を提供します。ここでのように言語を設定した場合-英語、それから何ができるか-翻訳されます。まず、ISOコードに後で変換するために国の標準名が必要です。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アドレス</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティの最後の場所になり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">geolocatorは</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">毎回サーバーにリクエストを送信する</font><font style="vertical-align: inherit;">ため</font><font style="vertical-align: inherit;">、このプロセスは高速ではなく、500レコードに対して500分かかります。また、答えが出ないこともある。この場合、2番目の要求が役立つことがあります。私の最初の応答では、130のリクエストがありませんでした。それらのほとんどは2回の再試行で処理されました。ただし、34回の名前は、さらに再試行しても処理されませんでした。どうぞ：</font></font><br>
<code>['Tongyeong, Korea, Korea, South', 'Constanta, Mamaia, Romania, Romania', 'Weihai, China, China', '. ,  .', 'Odaiba Marin Park, Tokyo, Japan, Japan', 'Sweden, Smaland, Kalmar', 'Cholpon-Ata city, Resort Center "Kapriz", Kyrgyzstan', 'Luxembourg, Region Moselle, Moselle', 'Chita Peninsula, Japan', 'Kraichgau Region, Germany', 'Jintang, Chengdu, Sichuan Province, China, China', 'Madrid, Spain, Spain', 'North American Pro Championship, St. George, Utah, USA', 'Milan Idroscalo Linate, Italy', 'Dexing, Jiangxi Province, China, China', 'Mooloolaba, Australia, Australia', 'Nathan Benderson Park (NBP), 5851 Nathan Benderson Circle, Sarasota, FL 34235., United States', 'Strathclyde Country Park, North Lanarkshire, Glasgow, Great Britain', 'Quijing, China', 'United States of America , Hawaii, Kohala Coast', 'Buffalo City, East London, South Africa', 'Spain, Vall de Cardener', ', .    ', 'Asian TriClub Championship, Hefei, China', 'Taizhou, Jiangsu Province, China, China', ', ,  «»', 'Buffalo, Gallagher Beach, Furhmann Blvd, United States', 'North American Pro Championship | St. George, Utah, USA', 'Weihai, Shandong, China, China', 'Tarzo - Revine Lago, Italy', 'Lausanee, Switzerland', 'Queenstown, New Zealand, New Zealand', 'Makuhari, Japan, Japan', 'Szombathlely, Hungary']<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くの国で国についての二重の言及があり、これが実際に干渉していることがわかります。</font><font style="vertical-align: inherit;">一般に、私はこれらの残りの名前を手動で処理する必要があり、すべての標準アドレスが取得されました。</font><font style="vertical-align: inherit;">さらに、これらの住所から国を選択し、ピボットテーブルの新しい列にこの国を書きました。</font><font style="vertical-align: inherit;">私が言ったように、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">geopy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">での作業</font><font style="vertical-align: inherit;">は高速で</font><i><font style="vertical-align: inherit;">は</font></i><font style="vertical-align: inherit;">ないため、位置座標（緯度と経度）をすぐに保存することにしました。</font><font style="vertical-align: inherit;">これらは後でマップ上で視覚化するのに役立ちます。</font><font style="vertical-align: inherit;">その後、</font><i><font style="vertical-align: inherit;">pyco.countries.get（name = '...'）</font></i><font style="vertical-align: inherit;">を使用して、</font><i><font style="vertical-align: inherit;">Alpha_3</font></i><font style="vertical-align: inherit;">は名前で国を検索し、3桁のコードを割り当てました。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>event</th>
<th>date</th>
<th>loc</th>
<th><u>country</u></th>
<th><u>latitude</u></th>
<th><u>longitude</u></th>
<th>...</th>
</tr>
<tr>
<td>0</td>
<td>Ironman Dubai Duathlon 70.3 2020</td>
<td>2020-07-02</td>
<td>Dubai, United Arab Emirates</td>
<td><u>United Arab Emirates</u></td>
<td><u>25.0657</u></td>
<td><u>55.1713</u></td>
<td>...</td>
</tr>
<tr>
<td>1</td>
<td>Ironman Dubai 70.3 2020</td>
<td>2020-02-07</td>
<td>Dubai, United Arab Emirates</td>
<td><u>United Arab Emirates</u></td>
<td><u>25.0657</u></td>
<td><u>55.1713</u></td>
<td>...</td>
</tr>
<tr>
<td>2</td>
<td>Israman Half 2020</td>
<td>2020-01-29</td>
<td>Israel, Eilat</td>
<td><u>Israel</u></td>
<td><u>29.5569</u></td>
<td><u>34.9498</u></td>
<td>...</td>
</tr>
<tr>
<td>3</td>
<td>Ironman Indian Wells La Quinta 70.3 2019</td>
<td>2019-12-08</td>
<td>Indian Wells/La Quinta, California, USA</td>
<td><u>United States of America</u></td>
<td><u>33.7238</u></td>
<td><u>-116.305</u></td>
<td>...</td>
</tr>
<tr>
<td>4</td>
<td>Ironman Taupo 70.3 2019</td>
<td>2019-12-07</td>
<td>New Zealand</td>
<td><u>New Zealand</u></td>
<td><u>-41.5001</u></td>
<td><u>172.834</u></td>
<td>...</td>
</tr>
<tr>
<td>5</td>
<td>Ironman Bahrain 70.3 2019</td>
<td>2019-12-07</td>
<td>Manama, Bahrain</td>
<td><u>Bahrain</u></td>
<td><u>26.2235</u></td>
<td><u>50.5822</u></td>
<td>...</td>
</tr>
<tr>
<td>6</td>
<td>Ironman Western Australia 2019</td>
<td>2019-12-01</td>
<td>Busselton, Western Australia</td>
<td><u>Australia</u></td>
<td><u>-33.6445</u></td>
<td><u>115.349</u></td>
<td>...</td>
</tr>
<tr>
<td>7</td>
<td>Ironman Mar del Plata 2019</td>
<td>2019-12-01</td>
<td>Mar del Plata, Argentina</td>
<td><u>Argentina</u></td>
<td><u>-37.9977</u></td>
<td><u>-57.5483</u></td>
<td>...</td>
</tr>
<tr>
<td>8</td>
<td>Ironman Cozumel 2019</td>
<td>2019-11-24</td>
<td>Cozumel, Mexico</td>
<td><u>Mexico</u></td>
<td><u>20.4318</u></td>
<td><u>-86.9203</u></td>
<td>...</td>
</tr>
<tr>
<td>9</td>
<td>Ironman Arizona 2019</td>
<td>2019-11-24</td>
<td>Tempe, Arizona, USA</td>
<td><u>United States of America</u></td>
<td><u>33.4255</u></td>
<td><u>-111.94</u></td>
<td>...</td>
</tr>
<tr>
<td>10</td>
<td>Ironman Xiamen 70.3 2019</td>
<td>2019-11-10</td>
<td>Xiamen, China</td>
<td><u>China</u></td>
<td><u>24.4758</u></td>
<td><u>118.075</u></td>
<td>...</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>event</th>
<th>date</th>
<th>loc</th>
<th><u>country</u></th>
<th>latitude</th>
<th>longitude</th>
<th>...</th>
</tr>
<tr>
<td>0</td>
<td>Ironman Dubai Duathlon 70.3 2020</td>
<td>2020-07-02</td>
<td>Dubai, United Arab Emirates</td>
<td><u>ARE</u></td>
<td>25.0657</td>
<td>55.1713</td>
<td>...</td>
</tr>
<tr>
<td>1</td>
<td>Ironman Dubai 70.3 2020</td>
<td>2020-02-07</td>
<td>Dubai, United Arab Emirates</td>
<td><u>ARE</u></td>
<td>25.0657</td>
<td>55.1713</td>
<td>...</td>
</tr>
<tr>
<td>2</td>
<td>Israman Half 2020</td>
<td>2020-01-29</td>
<td>Israel, Eilat</td>
<td><u>ISR</u></td>
<td>29.5569</td>
<td>34.9498</td>
<td>...</td>
</tr>
<tr>
<td>3</td>
<td>Ironman Indian Wells La Quinta 70.3 2019</td>
<td>2019-12-08</td>
<td>Indian Wells/La Quinta, California, USA</td>
<td><u>USA</u></td>
<td>33.7238</td>
<td>-116.305</td>
<td>...</td>
</tr>
<tr>
<td>4</td>
<td>Ironman Taupo 70.3 2019</td>
<td>2019-12-07</td>
<td>New Zealand</td>
<td><u>NZL</u></td>
<td>-41.5001</td>
<td>172.834</td>
<td>...</td>
</tr>
<tr>
<td>5</td>
<td>Ironman Bahrain 70.3 2019</td>
<td>2019-12-07</td>
<td>Manama, Bahrain</td>
<td><u>BHR</u></td>
<td>26.2235</td>
<td>50.5822</td>
<td>...</td>
</tr>
<tr>
<td>6</td>
<td>Ironman Western Australia 2019</td>
<td>2019-12-01</td>
<td>Busselton, Western Australia</td>
<td><u>AUS</u></td>
<td>-33.6445</td>
<td>115.349</td>
<td>...</td>
</tr>
<tr>
<td>7</td>
<td>Ironman Mar del Plata 2019</td>
<td>2019-12-01</td>
<td>Mar del Plata, Argentina</td>
<td><u>ARG</u></td>
<td>-37.9977</td>
<td>-57.5483</td>
<td>...</td>
</tr>
<tr>
<td>8</td>
<td>Ironman Cozumel 2019</td>
<td>2019-11-24</td>
<td>Cozumel, Mexico</td>
<td><u>MEX</u></td>
<td>20.4318</td>
<td>-86.9203</td>
<td>...</td>
</tr>
<tr>
<td>9</td>
<td>Ironman Arizona 2019</td>
<td>2019-11-24</td>
<td>Tempe, Arizona, USA</td>
<td><u>USA</u></td>
<td>33.4255</td>
<td>-111.94</td>
<td>...</td>
</tr>
<tr>
<td>10</td>
<td>Ironman Xiamen 70.3 2019</td>
<td>2019-11-10</td>
<td>Xiamen, China</td>
<td><u>CHN</u></td>
<td>24.4758</td>
<td>118.075</td>
<td>...</td>
</tr>
</tbody></table></div></code><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">距離</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ピボットテーブルで実行する必要があるもう1つの重要なアクションは、各レースの距離を決定することです。これは、将来の速度計算に役立ちます。トライアスロンでは、スプリント、オリンピック、セミアイアン、アイアンの4つの主要な距離があります。レースの名前には通常、距離の表示があることがわかります。これらは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スプリント</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オリンピック</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ハーフ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フル</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ワード</font><font style="vertical-align: inherit;">です。さらに、主催者ごとに独自の距離の指定があります。たとえば、アイアンマンの半分は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">70.3-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">距離のマイル数で、オリンピック</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-5150</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はキロメートル数（51.5）で指定され、アイアンは</font><i><font style="vertical-align: inherit;">フル</font></i><font style="vertical-align: inherit;">として指定できます。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または、一般的に、説明の欠如-たとえば、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ironman Arizona 2019</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">アイアンマン-彼は鉄です！</font><font style="vertical-align: inherit;">チャレンジでは、鉄の距離は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Long</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">として指定され</font><font style="vertical-align: inherit;">、半</font><font style="vertical-align: inherit;">鉄の距離は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Middle</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">として</font><font style="vertical-align: inherit;">指定さ</font><font style="vertical-align: inherit;">れ</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">私たちのロシアのIronStarは</font><font style="vertical-align: inherit;">、キロメートル</font><font style="vertical-align: inherit;">単位で完全に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">226</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、半分として</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">113を</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">意味</font><font style="vertical-align: inherit;">しますが、通常は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Full</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Half</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">という単語</font><font style="vertical-align: inherit;">も存在します。</font><font style="vertical-align: inherit;">この知識をすべて適用し、名前に含まれるキーワードに従ってすべてのレースにマークを付けます。</font></font><br>
<br>
<pre><code class="python hljs">sprints = rs.loc[[i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> rs.index <span class="hljs-keyword">if</span> <span class="hljs-string">'sprint'</span> <span class="hljs-keyword">in</span> rs.loc[i, <span class="hljs-string">'event'</span>].lower()]]<font></font>
olympics1 = rs.loc[[i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> rs.index <span class="hljs-keyword">if</span> <span class="hljs-string">'olympic'</span> <span class="hljs-keyword">in</span> rs.loc[i, <span class="hljs-string">'event'</span>].lower()]]<font></font>
olympics2 = rs.loc[[i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> rs.index <span class="hljs-keyword">if</span> <span class="hljs-string">'5150'</span> <span class="hljs-keyword">in</span> rs.loc[i, <span class="hljs-string">'event'</span>].lower()]]<font></font>
olympics = pd.concat([olympics1, olympics2])<font></font>
<span class="hljs-comment">#…   </span><font></font>
<font></font>
rsd = pd.concat([sprints, olympics, halfs, fulls]) <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
で</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSD</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一部は、二つの基準の下に落ちたので、それは、レースの合計数より3以上であること、1つの925レコードを判明しました。</font><font style="vertical-align: inherit;">それらを見てみましょう：</font></font><br>
<br>
<pre><code class="python hljs">rsd[rsd.duplicated(keep=<span class="hljs-literal">False</span>)][<span class="hljs-string">'event'</span>].sort_index()
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th><u>event</u></th>
<th>date</th>
<th>loc</th>
<th>country</th>
<th>latitude</th>
<th>longitude</th>
<th>...</th>
</tr>
<tr>
<td>38</td>
<td><u>Temiradam 113 Half 2019</u></td>
<td>2019-09-22</td>
<td>, </td>
<td>KAZ</td>
<td>43.6521</td>
<td>51.158</td>
<td>...</td>
</tr>
<tr>
<td>38</td>
<td><u>Temiradam 113 Half 2019</u></td>
<td>2019-09-22</td>
<td>, </td>
<td>KAZ</td>
<td>43.6521</td>
<td>51.158</td>
<td>...</td>
</tr>
<tr>
<td>65</td>
<td><u>Triway Olympic Sprint 2019</u></td>
<td>2019-09-08</td>
<td>, --</td>
<td>RUS</td>
<td>47.2214</td>
<td>39.7114</td>
<td>...</td>
</tr>
<tr>
<td>65</td>
<td><u>Triway Olympic Sprint 2019</u></td>
<td>2019-09-08</td>
<td>, --</td>
<td>RUS</td>
<td>47.2214</td>
<td>39.7114</td>
<td>...</td>
</tr>
<tr>
<td>82</td>
<td><u>Ironman Dun Laoghaire Full Swim 70.3 2019</u></td>
<td>2019-08-25</td>
<td>Ireland, Dun Laoghaire</td>
<td>IRL</td>
<td>53.2923</td>
<td>-6.13601</td>
<td>...</td>
</tr>
<tr>
<td>82</td>
<td><u>Ironman Dun Laoghaire Full Swim 70.3 2019</u></td>
<td>2019-08-25</td>
<td>Ireland, Dun Laoghaire</td>
<td>IRL</td>
<td>53.2923</td>
<td>-6.13601</td>
<td>...</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">確かにそうです。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temiradam 113 Half 2019</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">という名前の最初のペアで</font><font style="vertical-align: inherit;">は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Half</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">113</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の両方について言及されてい</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">しかし、これは矛盾ではなく、どちらも半分として識別されました。</font><font style="vertical-align: inherit;">次は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トライウェイオリンピックスプリント2019</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">ここで本当に混乱する可能性があります- </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オリンピック</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スプリントがあり</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">レースの結果を含むプロトコルを見れば、それを理解することができます。</font><font style="vertical-align: inherit;">最高の時間は1:09です。</font><font style="vertical-align: inherit;">これはスプリントです。</font><font style="vertical-align: inherit;">オリンピックリストからこのエントリを削除します。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th>country</th>
<th>group</th>
<th>place in group</th>
<th>swim</th>
<th>t1</th>
<th>bike</th>
<th>t2</th>
<th>run</th>
<th><u>result</u></th>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>M</td>
<td> </td>
<td>RUS</td>
<td>M</td>
<td>1</td>
<td>00:12:21</td>
<td>00:00:31</td>
<td>00:34:13</td>
<td>00:00:25</td>
<td>00:21:49</td>
<td><u>01:09:19</u></td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>M</td>
<td> </td>
<td>RUS</td>
<td>M</td>
<td>2</td>
<td>00:12:21</td>
<td>00:00:28</td>
<td>00:34:15</td>
<td>00:00:26</td>
<td>00:23:07</td>
<td><u>01:10:38</u></td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>M</td>
<td> </td>
<td>RUS</td>
<td>M</td>
<td>3</td>
<td>00:14:20</td>
<td>00:00:37</td>
<td>00:35:48</td>
<td>00:00:34</td>
<td>00:22:16</td>
<td><u>01:13:35</u></td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">olympics.drop(<span class="hljs-number">65</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
交差する</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アイアンマンダンレアリーフルスイム70.3 2019に</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も同じことをし</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">これは半分の典型です。</font><i><font style="vertical-align: inherit;">fulls</font></i><font style="vertical-align: inherit;">からインデックス85のレコードを削除します</font><font style="vertical-align: inherit;">。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th>country</th>
<th>group</th>
<th>place in group</th>
<th>swim</th>
<th>t1</th>
<th>bike</th>
<th>t2</th>
<th>run</th>
<th><u>result</u></th>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>M</td>
<td>Brownlee, Alistair</td>
<td>GBR</td>
<td>MPRO</td>
<td>1</td>
<td>00:23:19</td>
<td>00:02:18</td>
<td>02:21:19</td>
<td>00:01:55</td>
<td>01:11:42</td>
<td><u>04:00:33</u></td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>M</td>
<td>Smales, Elliot</td>
<td>GBR</td>
<td>MPRO</td>
<td>2</td>
<td>00:24:47</td>
<td>00:02:09</td>
<td>02:29:26</td>
<td>00:01:48</td>
<td>01:12:47</td>
<td><u>04:10:57</u></td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>M</td>
<td>Bowden, Adam</td>
<td>GBR</td>
<td>MPRO</td>
<td>3</td>
<td>00:23:24</td>
<td>00:02:18</td>
<td>02:32:09</td>
<td>00:02:06</td>
<td>01:13:49</td>
<td><u>04:13:46</u></td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">fulls.drop(<span class="hljs-number">85</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、メインデータフレームに距離情報を書き留め、何が起こったかを確認します。</font></font><br>
<br>
<pre><code class="python hljs">rs[<span class="hljs-string">'dist'</span>] = <span class="hljs-string">''</span><font></font>
<font></font>
rs.loc[sprints.index,<span class="hljs-string">'dist'</span>] = <span class="hljs-string">'sprint'</span>
rs.loc[olympics.index,<span class="hljs-string">'dist'</span>] = <span class="hljs-string">'olympic'</span>
rs.loc[halfs.index,<span class="hljs-string">'dist'</span>] = <span class="hljs-string">'half'</span>
rs.loc[fulls.index,<span class="hljs-string">'dist'</span>] = <span class="hljs-string">'full'</span><font></font>
<font></font>
rs.sample(<span class="hljs-number">10</span>)
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>event</th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th>country</th>
<th><u>group</u></th>
<th>place in group</th>
<th>...</th>
<th>country raw</th>
<th><u>group raw</u></th>
</tr>
<tr>
<td>...</td>
<td>566</td>
<td>M</td>
<td>Vladimir Kozar</td>
<td>SVK</td>
<td><u>M40-44</u></td>
<td>8</td>
<td>...</td>
<td>SVK</td>
<td><u>MOpen 40-44</u></td>
</tr>
<tr>
<td>...</td>
<td>8</td>
<td>M</td>
<td>HANNES COOL</td>
<td>BEL</td>
<td><u>MPRO</u></td>
<td>11</td>
<td>...</td>
<td>BEL</td>
<td><u>MPRO M</u></td>
</tr>
<tr>
<td>...</td>
<td>445</td>
<td>F</td>
<td>Ileana Sodani</td>
<td>USA</td>
<td><u>F45-49</u></td>
<td>4</td>
<td>...</td>
<td>USA</td>
<td><u>F45-49 F</u></td>
</tr>
<tr>
<td>...</td>
<td>227</td>
<td>F</td>
<td>JARLINSKA Bozena</td>
<td>POL</td>
<td><u>F45-49</u></td>
<td>2</td>
<td>...</td>
<td>POL</td>
<td><u>FK45-49</u></td>
</tr>
<tr>
<td>...</td>
<td>440</td>
<td>F</td>
<td>Celine Orrigoni</td>
<td>FRA</td>
<td><u>F40-44</u></td>
<td>6</td>
<td>...</td>
<td>FRA</td>
<td><u>F40-44 F</u></td>
</tr>
<tr>
<td>...</td>
<td>325</td>
<td>M</td>
<td>Vladimir Eckert</td>
<td>SVK</td>
<td><u>M40-44</u></td>
<td>6</td>
<td>...</td>
<td>SVK</td>
<td><u>MOpen 40-44</u></td>
</tr>
<tr>
<td>...</td>
<td>139</td>
<td>F</td>
<td>ATRASZKIEWICZ Magda</td>
<td>POL</td>
<td><u>F40-44</u></td>
<td>2</td>
<td>...</td>
<td>POL</td>
<td><u>FK40-44</u></td>
</tr>
<tr>
<td>...</td>
<td>18</td>
<td>M</td>
<td>Marijn de Jonge</td>
<td>NLD</td>
<td><u>MPRO</u></td>
<td>18</td>
<td>...</td>
<td>NED</td>
<td><u>Mpro</u></td>
</tr>
<tr>
<td>...</td>
<td>574</td>
<td>M</td>
<td>Luca Andalo</td>
<td>ITA</td>
<td><u>M40-44</u></td>
<td>9</td>
<td>...</td>
<td>ITA</td>
<td><u>MOpen 40-44</u></td>
</tr>
<tr>
<td>...</td>
<td>67</td>
<td>M</td>
<td>URBANKIEWICZ Aleksandra</td>
<td>POL</td>
<td><u>M35-39</u></td>
<td>1</td>
<td>...</td>
<td>POL</td>
<td><u>MK35-39</u></td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カバーされていないエントリがないことを確認します。</font></font><br>
<br>
<pre><code class="python hljs">len(rs[rs[<span class="hljs-string">'dist'</span>] == <span class="hljs-string">''</span>])
</code></pre><br>
<code><b>Out:</b> 0<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、問題のある、あいまいなものをチェックしてください：</font></font><br>
<br>
<pre><code class="python hljs">rs.loc[[<span class="hljs-number">38</span>,<span class="hljs-number">65</span>,<span class="hljs-number">82</span>],[<span class="hljs-string">'event'</span>,<span class="hljs-string">'dist'</span>]]
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>event</th>
<th><u>dist</u></th>
</tr>
<tr>
<td>38</td>
<td>Temiradam 113 Half 2019</td>
<td><u>half</u></td>
</tr>
<tr>
<td>65</td>
<td>Triway Olympic Sprint 2019</td>
<td><u>sprint</u></td>
</tr>
<tr>
<td>82</td>
<td>Ironman Dun Laoghaire Full Swim 70.3 2019</td>
<td><u>half</u></td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべて順調。</font><font style="vertical-align: inherit;">新しいファイルに保存：</font></font><br>
<br>
<pre><code class="python hljs">pkl.dump(rs, open(<span class="hljs-string">r'D:\tri\summary5.pkl'</span>, <span class="hljs-string">'wb'</span>))
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">年齢グループ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
レーシングプロトコルに戻ります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
参加者の性別、国、結果をすでに分析し、標準的な形にしています。</font><font style="vertical-align: inherit;">しかし、さらに2つの列が残っています。グループと、実際には名前自体です。</font><font style="vertical-align: inherit;">グループから始めましょう。</font><font style="vertical-align: inherit;">トライアスロンでは、参加者を年齢層で分けるのが通例です。</font><font style="vertical-align: inherit;">専門家のグループも際立っています。</font><font style="vertical-align: inherit;">実際、オフセットはそのような各グループに個別にあります-各グループの最初の3つの場所が授与されます。</font><font style="vertical-align: inherit;">グループでは、たとえば、Konuでの選手権の資格が選択されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのレコードを組み合わせて、一般的にどのグループが存在するかを確認します。</font></font><br>
<br>
<pre><code class="python hljs">rd = pkl.load(open(<span class="hljs-string">r'D:\tri\details2.pkl'</span>, <span class="hljs-string">'rb'</span>))<font></font>
ar = pd.concat(rd)<font></font>
ar[<span class="hljs-string">'group'</span>].unique()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
非常に多くのグループ-581 </font><font style="vertical-align: inherit;">
があることがわかりました</font><font style="vertical-align: inherit;">。ランダムに選択された100は次のようになります。</font><font style="vertical-align: inherit;">どれが最も数が多いか見てみましょう。</font></font><br>
<code>['MSenior', 'FAmat.', 'M20', 'M65-59', 'F25-29', 'F18-22', 'M75-59', 'MPro', 'F24', 'MCORP M', 'F21-30', 'MSenior 4', 'M40-50', 'FAWAD', 'M16-29', 'MK40-49', 'F65-70', 'F65-70', 'M12-15', 'MK18-29', 'M50up', 'FSEMIFINAL 2 PRO', 'F16', 'MWhite', 'MOpen 25-29', 'F', 'MPT TRI-2', 'M16-24', 'FQUALIFIER 1 PRO', 'F15-17', 'FSEMIFINAL 2 JUNIOR', 'FOpen 60-64', 'M75-80', 'F60-69', 'FJUNIOR A', 'F17-18', 'FAWAD BLIND', 'M75-79', 'M18-29', 'MJUN19-23', 'M60-up', 'M70', 'MPTS5', 'F35-40', "M'S PT1", 'M50-54', 'F65-69', 'F17-20', 'MP4', 'M16-29', 'F18up', 'MJU', 'MPT4', 'MPT TRI-3', 'MU24-39', 'MK35-39', 'F18-20', "M'S", 'F50-55', 'M75-80', 'MXTRI', 'F40-45', 'MJUNIOR B', 'F15', 'F18-19', 'M20-29', 'MAWAD PC4', 'M30-37', 'F21-30', 'Mpro', 'MSEMIFINAL 1 JUNIOR', 'M25-34', 'MAmat.', 'FAWAD PC5', 'FA', 'F50-60', 'FSenior 1', 'M80-84', 'FK45-49', 'F75-79', 'M&lt;23', 'MPTS3', 'M70-75', 'M50-60', 'FQUALIFIER 3 PRO', 'M9', 'F31-40', 'MJUN16-19', 'F18-19', 'M PARA', 'F35-44', 'MParaathlete', 'F18-34', 'FA', 'FAWAD PC2', 'FAll Ages', 'M PARA', 'F31-40', 'MM85', 'M25-39']<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'group'</span>].value_counts()[:<span class="hljs-number">30</span>]
</code></pre><br>
<code><b>Out:</b><br>
M40-44 199157<br>
M35-39 183738<br>
M45-49 166796<br>
M30-34 154732<br>
M50-54 107307<br>
M25-29 88980<br>
M55-59 50659<br>
F40-44 48036<br>
F35-39 47414<br>
F30-34 45838<br>
F45-49 39618<br>
MPRO 38445<br>
F25-29 31718<br>
F50-54 26253<br>
M18-24 24534<br>
FPRO 23810<br>
M60-64 20773<br>
M 12799<br>
F55-59 12470<br>
M65-69 8039<br>
F18-24 7772<br>
MJUNIOR 6605<br>
F60-64 5067<br>
M20-24 4580<br>
FJUNIOR 4105<br>
M30-39 3964<br>
M40-49 3319<br>
F 3306<br>
M70-74 3072<br>
F20-24 2522<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらは、男性用と女性用の5年間のグループ、および専門グループ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MPRO</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FPROであることがわかり</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、標準は次のようになります。</font></font><br>
<br>
<pre><code class="python hljs">ag = [<span class="hljs-string">'MPRO'</span>, <span class="hljs-string">'M18-24'</span>, <span class="hljs-string">'M25-29'</span>, <span class="hljs-string">'M30-34'</span>, <span class="hljs-string">'M35-39'</span>, <span class="hljs-string">'M40-44'</span>, <span class="hljs-string">'M45-49'</span>, <span class="hljs-string">'M50-54'</span>, <span class="hljs-string">'M55-59'</span>, <span class="hljs-string">'M60-64'</span>,  <span class="hljs-string">'M65-69'</span>, <span class="hljs-string">'M70-74'</span>, <span class="hljs-string">'M75-79'</span>, <span class="hljs-string">'M80-84'</span>, <span class="hljs-string">'M85-90'</span>, <span class="hljs-string">'FPRO'</span>, <span class="hljs-string">'F18-24'</span>, <span class="hljs-string">'F25-29'</span>, <span class="hljs-string">'F30-34'</span>, <span class="hljs-string">'F35-39'</span>, <span class="hljs-string">'F40-44'</span>,   <span class="hljs-string">'F45-49'</span>, <span class="hljs-string">'F50-54'</span>, <span class="hljs-string">'F55-59'</span>, <span class="hljs-string">'F60-64'</span>, <span class="hljs-string">'F65-69'</span>, <span class="hljs-string">'F70-74'</span>, <span class="hljs-string">'F75-79'</span>, <span class="hljs-string">'F80-84'</span>, <span class="hljs-string">'F85-90'</span>]
<span class="hljs-comment">#ag – age group</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このセットは、すべてのフィニッシャーのほぼ95％をカバーしています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、すべてのグループをこの基準にすることはできません。</font><font style="vertical-align: inherit;">しかし、私たちはそれらに似ているものを探し、少なくとも一部を与えます。</font><font style="vertical-align: inherit;">まず、大文字にし、スペースを削除します。</font><font style="vertical-align: inherit;">これが起こったことです：</font><font style="vertical-align: inherit;">
それらを標準のものに変換します。</font></font><br>
<code>['F25-29F', 'F30-34F', 'F30-34-34', 'F35-39F', 'F40-44F', 'F45-49F', 'F50-54F', 'F55-59F', 'FAG:FPRO', 'FK30-34', 'FK35-39', 'FK40-44', 'FK45-49', 'FOPEN50-54', 'FOPEN60-64', 'MAG:MPRO', 'MK30-34', 'MK30-39', 'MK35-39', 'MK40-44', 'MK40-49', 'MK50-59', 'M40-44', 'MM85-89', 'MOPEN25-29', 'MOPEN30-34', 'MOPEN35-39', 'MOPEN40-44', 'MOPEN45-49', 'MOPEN50-54', 'MOPEN70-74', 'MPRO:', 'MPROM', 'M0-44"']<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">fix = { <span class="hljs-string">'F25-29F'</span>: <span class="hljs-string">'F25-29'</span>, <span class="hljs-string">'F30-34F'</span> : <span class="hljs-string">'F30-34'</span>, <span class="hljs-string">'F30-34-34'</span>: <span class="hljs-string">'F30-34'</span>, <span class="hljs-string">'F35-39F'</span>: <span class="hljs-string">'F35-39'</span>, <span class="hljs-string">'F40-44F'</span>: <span class="hljs-string">'F40-44'</span>, <span class="hljs-string">'F45-49F'</span>: <span class="hljs-string">'F45-49'</span>, <span class="hljs-string">'F50-54F'</span>: <span class="hljs-string">'F50-54'</span>, <span class="hljs-string">'F55-59F'</span>: <span class="hljs-string">'F55-59'</span>, <span class="hljs-string">'FAG:FPRO'</span>: <span class="hljs-string">'FPRO'</span>, <span class="hljs-string">'FK30-34'</span>: <span class="hljs-string">'F30-34'</span>,      <span class="hljs-string">'FK35-39'</span>: <span class="hljs-string">'F35-39'</span>, <span class="hljs-string">'FK40-44'</span>: <span class="hljs-string">'F40-44'</span>, <span class="hljs-string">'FK45-49'</span>: <span class="hljs-string">'F45-49'</span>, <span class="hljs-string">'FOPEN50-54'</span>: <span class="hljs-string">'F50-54'</span>, <span class="hljs-string">'FOPEN60-64'</span>: <span class="hljs-string">'F60-64'</span>, <span class="hljs-string">'MAG:MPRO'</span>: <span class="hljs-string">'MPRO'</span>, <span class="hljs-string">'MK30-34'</span>: <span class="hljs-string">'M30-34'</span>, <span class="hljs-string">'MK30-39'</span>: <span class="hljs-string">'M30-39'</span>, <span class="hljs-string">'MK35-39'</span>: <span class="hljs-string">'M35-39'</span>, <span class="hljs-string">'MK40-44'</span>: <span class="hljs-string">'M40-44'</span>, <span class="hljs-string">'MK40-49'</span>: <span class="hljs-string">'M40-49'</span>, <span class="hljs-string">'MK50-59'</span>: <span class="hljs-string">'M50-59'</span>, <span class="hljs-string">'M40-44'</span>: <span class="hljs-string">'M40-44'</span>, <span class="hljs-string">'MM85-89'</span>: <span class="hljs-string">'M85-89'</span>, <span class="hljs-string">'MOPEN25-29'</span>: <span class="hljs-string">'M25-29'</span>, <span class="hljs-string">'MOPEN30-34'</span>: <span class="hljs-string">'M30-34'</span>, <span class="hljs-string">'MOPEN35-39'</span>: <span class="hljs-string">'M35-39'</span>, <span class="hljs-string">'MOPEN40-44'</span>: <span class="hljs-string">'M40-44'</span>, <span class="hljs-string">'MOPEN45-49'</span>: <span class="hljs-string">'M45-49'</span>, <span class="hljs-string">'MOPEN50-54'</span>: <span class="hljs-string">'M50-54'</span>, <span class="hljs-string">'MOPEN70-74'</span>: <span class="hljs-string">'M70- 74'</span>, <span class="hljs-string">'MPRO:'</span> :<span class="hljs-string">'MPRO'</span>, <span class="hljs-string">'MPROM'</span>: <span class="hljs-string">'MPRO'</span>, <span class="hljs-string">'M0-44"'</span> : <span class="hljs-string">'M40-44'</span>}
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、メインデータフレーム</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">変換を適用します</font><font style="vertical-align: inherit;">が、最初に元の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グループ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値</font><font style="vertical-align: inherit;">を新しい</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グループのraw</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列に</font><font style="vertical-align: inherit;">保存し</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'group raw'</span>] = ar[<span class="hljs-string">'group'</span>]
</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グループ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
列に</font><font style="vertical-align: inherit;">は、基準に準拠する値のみを残します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今私たちは私たちの努力に感謝することができます：</font></font><br>
<br>
<pre><code class="python hljs">len(ar[(ar[<span class="hljs-string">'group'</span>] != ar[<span class="hljs-string">'group raw'</span>])&amp;(ar[<span class="hljs-string">'group'</span>]!=<span class="hljs-string">''</span>)])
</code></pre><br>
<code><b>Out:</b> 273<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
150万のレベルでほんの少し。</font><font style="vertical-align: inherit;">しかし、試すまではわかりません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
選択した10は次のようになり</font><font style="vertical-align: inherit;">ます。新しいバージョンのデータフレームを</font><i><font style="vertical-align: inherit;">rd</font></i><font style="vertical-align: inherit;">辞書に変換してから保存します</font><font style="vertical-align: inherit;">。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>event</th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th>country</th>
<th><u>group</u></th>
<th>place in group</th>
<th>...</th>
<th>country raw</th>
<th><u>group raw</u></th>
</tr>
<tr>
<td>...</td>
<td>566</td>
<td>M</td>
<td>Vladimir Kozar</td>
<td>SVK</td>
<td><u>M40-44</u></td>
<td>8</td>
<td>...</td>
<td>SVK</td>
<td><u>MOpen 40-44</u></td>
</tr>
<tr>
<td>...</td>
<td>8</td>
<td>M</td>
<td>HANNES COOL</td>
<td>BEL</td>
<td><u>MPRO</u></td>
<td>11</td>
<td>...</td>
<td>BEL</td>
<td><u>MPRO M</u></td>
</tr>
<tr>
<td>...</td>
<td>445</td>
<td>F</td>
<td>Ileana Sodani</td>
<td>USA</td>
<td><u>F45-49</u></td>
<td>4</td>
<td>...</td>
<td>USA</td>
<td><u>F45-49 F</u></td>
</tr>
<tr>
<td>...</td>
<td>227</td>
<td>F</td>
<td>JARLINSKA Bozena</td>
<td>POL</td>
<td><u>F45-49</u></td>
<td>2</td>
<td>...</td>
<td>POL</td>
<td><u>FK45-49</u></td>
</tr>
<tr>
<td>...</td>
<td>440</td>
<td>F</td>
<td>Celine Orrigoni</td>
<td>FRA</td>
<td><u>F40-44</u></td>
<td>6</td>
<td>...</td>
<td>FRA</td>
<td><u>F40-44 F</u></td>
</tr>
<tr>
<td>...</td>
<td>325</td>
<td>M</td>
<td>Vladimir Eckert</td>
<td>SVK</td>
<td><u>M40-44</u></td>
<td>6</td>
<td>...</td>
<td>SVK</td>
<td><u>MOpen 40-44</u></td>
</tr>
<tr>
<td>...</td>
<td>139</td>
<td>F</td>
<td>ATRASZKIEWICZ Magda</td>
<td>POL</td>
<td><u>F40-44</u></td>
<td>2</td>
<td>...</td>
<td>POL</td>
<td><u>FK40-44</u></td>
</tr>
<tr>
<td>...</td>
<td>18</td>
<td>M</td>
<td>Marijn de Jonge</td>
<td>NLD</td>
<td><u>MPRO</u></td>
<td>18</td>
<td>...</td>
<td>NED</td>
<td><u>Mpro</u></td>
</tr>
<tr>
<td>...</td>
<td>574</td>
<td>M</td>
<td>Luca Andalo</td>
<td>ITA</td>
<td><u>M40-44</u></td>
<td>9</td>
<td>...</td>
<td>ITA</td>
<td><u>MOpen 40-44</u></td>
</tr>
<tr>
<td>...</td>
<td>67</td>
<td>M</td>
<td>URBANKIEWICZ Aleksandra</td>
<td>POL</td>
<td><u>M35-39</u></td>
<td>1</td>
<td>...</td>
<td>POL</td>
<td><u>MK35-39</u></td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">pkl.dump(rd, open(<span class="hljs-string">r'D:\tri\details3.pkl'</span>, <span class="hljs-string">'wb'</span>))</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名前</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、名前を管理します。</font><font style="vertical-align: inherit;">さまざまな人種から100の名前を選択して見てみましょう。</font></font><br>
<br>
<pre><code class="python hljs">list(ar[<span class="hljs-string">'name'</span>].sample(<span class="hljs-number">100</span>))
</code></pre><br>
<code><b>Out: </b>['Case, Christine', 'Van der westhuizen, Wouter', 'Grace, Scott', 'Sader, Markus', 'Schuller, Gunnar', 'Juul-Andersen, Jeppe', 'Nelson, Matthew', '  ', 'Westman, Pehr', 'Becker, Christoph', 'Bolton, Jarrad', 'Coto, Ricardo', 'Davies, Luke', 'Daniltchev, Alexandre', 'Escobar Labastida, Emmanuelle', 'Idzikowski, Jacek', 'Fairaislova Iveta', 'Fisher, Kulani', 'Didenko, Viktor', 'Osborne, Jane', 'Kadralinov, Zhalgas', 'Perkins, Chad', 'Caddell, Martha', 'Lynaire PARISH', 'Busing, Lynn', 'Nikitin, Evgeny', 'ANSON MONZON, ROBERTO', 'Kaub, Bernd', 'Bank, Morten', 'Kennedy, Ian', 'Kahl, Stephen', 'Vossough, Andreas', 'Gale, Karen', 'Mullally, Kristin', 'Alex FRASER', 'Dierkes, Manuela', 'Gillett, David', 'Green, Erica', 'Cunnew, Elliott', 'Sukk, Gaspar', 'Markina Veronika', 'Thomas KVARICS', 'Wu, Lewen', 'Van Enk, W.J.J', 'Escobar, Rosario', 'Healey, Pat', 'Scheef, Heike', 'Ancheta, Marlon', 'Heck, Andreas', 'Vargas Iii, Raul', 'Seferoglou, Maria', 'chris GUZMAN', 'Casey, Timothy', 'Olshanikov Konstantin', 'Rasmus Nerrand', 'Lehmann Bence', 'Amacker, Kirby', 'Parks, Chris', 'Tom, Troy', 'Karlsson, Ulf', 'Halfkann, Dorothee', 'Szabo, Gergely', 'Antipov Mikhail', 'Von Alvensleben, Alvo', 'Gruber, Peter', 'Leblanc, Jean-Philippe', 'Bouchard, Jean-Francois', 'Marchiotto MASSIMO', 'Green, Molly', 'Alder, Christoph', 'Morris, Huw', 'Deceur, Marc', 'Queenan, Derek', 'Krause, Carolin', 'Cockings, Antony', 'Ziehmer Chris', 'Stiene, John', 'Chmet Daniela', 'Chris RIORDAN', 'Wintle, Mel', ' ', 'GASPARINI CHRISTIAN', 'Westbrook, Christohper', 'Martens, Wim', 'Papson, Chris', 'Burdess, Shaun', 'Proctor, Shane', 'Cruzinha, Pedro', 'Hamard, Jacques', 'Petersen, Brett', 'Sahyoun, Sebastien', "O'Connell, Keith", 'Symoshenko, Zhan', 'Luternauer, Jan', 'Coronado, Basil', 'Smith, Alex', 'Dittberner, Felix', 'N?sman, Henrik', 'King, Malisa', 'PUHLMANN Andre']<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それは複雑です。エントリにはさまざまなオプションがあります。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">姓、名、名、姓、名、姓、名</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などです。つまり、別の順序、別のレジスタ、区切り記号がある場所-コンマです。キリル文字が行く多くのプロトコルもあります。また、統一性はなく</font><i><font style="vertical-align: inherit;">、「姓名」、「名姓」、「名ミドルネーム姓」、「姓名ミドルネーム」の</font></i><font style="vertical-align: inherit;">形式を見つけることができます</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。実際には、ミドルネームはラテン語のスペルにも含まれています。そしてここで、ところで、もう1つの問題が発生します-文字変換。また、ミドルネームがない場合でも、レコードは2語に限定されない場合があります。たとえば、ヒスパニック系の場合、名前と姓は通常、3語または4語で構成されます。オランダ語にはヴァンという接頭辞が付き、中国人と韓国人にも通常3語の複合名があります。一般に、このリバス全体を何らかの形で解明し、最大限に標準化する必要があります。原則として、1つのレース内では、名前の形式は誰にとっても同じですが、ここでも、処理できないエラーがあります。まず、既存の値を新しい列</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名rawに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格納します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'name raw'</span>] = ar[<span class="hljs-string">'name'</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロトコルの大部分はラテン語で書かれているため、最初に文字変換を行います。</font><font style="vertical-align: inherit;">参加者の名前に含めることができる文字を見てみましょう。</font></font><br>
<br>
<pre><code class="python hljs">set( <span class="hljs-string">''</span>.join(ar[<span class="hljs-string">'name'</span>].unique()))
</code></pre><br>
<code><b>Out: </b>[' ', '!', '"', '#', '&amp;', "'", '(', ')', '*', '+', ',', '-', '.', '/', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', ':', ';', '&gt;', '?', '@', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', '[', '\\', ']', '^', '_', '`', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', '|', '\x7f', '\xa0', '¤', '¦', '§', '', '«', '\xad', '', '°', '±', 'µ', '¶', '·', '»', '', 'І', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', 'є', 'і', 'ў', '–', '—', '‘', '’', '‚', '“', '”', '„', '†', '‡', '…', '‰', '›', '']<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何があるの！</font><font style="vertical-align: inherit;">実際の文字とスペースに加えて、さまざまな異様な文字がまだたくさんあります。</font><font style="vertical-align: inherit;">これらのうち、ピリオド「。」、ハイフン「-」およびアポストロフィ「 '」は有効であると見なすことができます。つまり、誤って存在することはありません。</font><font style="vertical-align: inherit;">さらに、多くのドイツ語とノルウェー語の名前と姓に疑問符「？」があることに気づきました。</font><font style="vertical-align: inherit;">彼らは明らかに、拡張ラテンアルファベットの文字を置き換えています-「？」、「A」、「o」、「u」、? </font><font style="vertical-align: inherit;">例は次のとおりです：</font><font style="vertical-align: inherit;">
非常に頻繁に発生しますが、カンマは単なる区切り文字であり、特定のレースで採用されているため、許容できないカテゴリにも分類されます。</font><font style="vertical-align: inherit;">数字も名前に使用しないでください。</font></font><br>
<code>Pierre-Alexandre Petit, Jean-louis Lafontaine, Faris Al-Sultan, Jean-Francois Evrard, Paul O'Mahony, Aidan O'Farrell, John O'Neill, Nick D'Alton, Ward D'Hulster, Hans P.J. Cami, Luis E. Benavides, Maximo Jr. Rueda, Prof. Dr. Tim-Nicolas Korf, Dr. Boris Scharlowsk, Eberhard Gro?mann, Magdalena Wei?, Gro?er Axel, Meyer-Szary Krystian, Morten Halkj?r, RASMUSSEN S?ren Balle<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">bs = [s <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> symbols <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (s.isalpha() <span class="hljs-keyword">or</span> s <span class="hljs-keyword">in</span> <span class="hljs-string">" . - ' ? ,"</span>)] <span class="hljs-comment">#bs – bad symbols</span><font></font>
<font></font>
bs<font></font>
</code></pre><br>
<code><b>Out: </b>['!', '"', '#', '&amp;', '(', ')', '*', '+', '/', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', ':', ';', '&gt;', '@', '[', '\\', ']', '^', '_', '`', '|', '\x7f', '\xa0', '¤', '¦', '§', '', '«', '\xad', '', '°', '±', '¶', '·', '»', '–', '—', '‘', '’', '‚', '“', '”', '„', '†', '‡', '…', '‰', '›', '']<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの文字をすべて一時的に削除して、存在するエントリの数を調べます。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> bs:<font></font>
    ar[<span class="hljs-string">'name'</span>] = ar[<span class="hljs-string">'name'</span>].str.replace(s, <span class="hljs-string">''</span>)<font></font>
<font></font>
corr = ar[ar[<span class="hljs-string">'name'</span>] != ar[<span class="hljs-string">'name raw'</span>]]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのようなレコードは2,184あります。つまり、総数の0.15％にすぎません-非常に少ないです。</font><font style="vertical-align: inherit;">それらの100を見てみましょう：</font></font><br>
<br>
<pre><code class="python hljs">list(corr[<span class="hljs-string">'name raw'</span>].sample(<span class="hljs-number">100</span>))
</code></pre><br>
<code><b>Out:</b> ['Scha¶ffl, Ga?nter', 'Howard, Brian &amp;', 'Chapiewski, Guilherme (Gc)', 'Derkach 1svd_mail_ru', 'Parker H1 Lauren', 'Leal le?n, Yaneri', 'TencA, David', 'Cortas La?pez, Alejandro', 'Strid, Bja¶rn', '(Crutchfield) Horan, Katie', 'Vigneron, Jean-Michel.Vigneron@gmail.Com', '\xa0', 'Telahr, J†rgen', 'St”rmer, Melanie', 'Nagai B1 Keiji', 'Rinc?n, Mariano', 'Arkalaki, Angela (Evangelia)', 'Barbaro B1 Bonin Anna G:Charlotte', 'Ra?esch, Ja¶rg', "CAVAZZI NICCOLO\\'", 'D„nzel, Thomas', 'Ziska, Steffen (Gerhard)', 'Kobilica B1 Alen', 'Mittelholcz, Bala', 'Jimanez Aguilar, Juan Antonio', 'Achenza H1 Giovanni', 'Reppe H2 Christiane', 'Filipovic B2 Lazar', 'Machuca Ka?hnel, Ruban Alejandro', 'Gellert (Silberprinz), Christian', 'Smith (Guide), Matt', 'Lenatz H1 Benjamin', 'Da¶llinger, Christian', 'Mc Carthy B1 Patrick Donnacha G:Bryan', 'Fa¶llmer, Chris', 'Warner (Rivera), Lisa', 'Wang, Ruijia (Ray)', 'Mc Carthy B1 Donnacha', 'Jones, Nige (Paddy)', 'Sch”ler, Christoph', '\xa0', 'Holthaus, Adelhard (Allard)', 'Mi;Arro, Ana', 'Dr: Koch Stefan', '\xa0', '\xa0', 'Ziska, Steffen (Gerhard)', 'Albarraca\xadn Gonza?lez, Juan Francisco', 'Ha¶fling, Imke', 'Johnston, Eddie (Edwin)', 'Mulcahy, Bob (James)', 'Gottschalk, Bj”rn', '\xa0', 'Gretsch H2 Kendall', 'Scorse, Christopher (Chris)', 'Kiel‚basa, Pawel', 'Kalan, Magnus', 'Roderick "eric" SIMBULAN', 'Russell;, Mark', 'ROPES AND GRAY TEAM 3', 'Andrade, H?¦CTOR DANIEL', 'Landmann H2 Joshua', 'Reyes Rodra\xadguez, Aithami', 'Ziska, Steffen (Gerhard)', 'Ziska, Steffen (Gerhard)', 'Heuza, Pierre', 'Snyder B1 Riley Brad G:Colin', 'Feldmann, Ja¶rg', 'Beveridge H1 Nic', 'FAGES`, perrine', 'Frank", Dieter', 'Saarema¤el, Indrek', 'Betancort Morales, Arida–y', 'Ridderberg, Marie_Louise', '\xa0', 'Ka¶nig, Johannes', 'W Van(der Klugt', 'Ziska, Steffen (Gerhard)', 'Johnson, Nick26', 'Heinz JOHNER03', 'Ga¶rg, Andra', 'Maruo B2 Atsuko', 'Moral Pedrero H1 Eva Maria', '\xa0', 'MATUS SANTIAGO Osc1r', 'Stenbrink, Bja¶rn', 'Wangkhan, Sm1.Thaworn', 'Pullerits, Ta¶nu', 'Clausner, 8588294149', 'Castro Miranda, Josa Ignacio', 'La¶fgren, Pontuz', 'Brown, Jann ( Janine )', 'Ziska, Steffen (Gerhard)', 'Koay, Sa¶ren', 'Ba¶hm, Heiko', 'Oleksiuk B2 Vita', 'G Van(de Grift', 'Scha¶neborn, Guido', 'Mandez, A?lvaro', 'Garca\xada Fla?rez, Daniel']<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、多くの調査の結果、すべてのアルファベット文字、スペース、ハイフン、アポストロフィ、疑問符をコンマ、ピリオド、 '\ xa0'記号に置き換え、その他のすべての文字を空の文字列に置き換えることが決定されました。つまり、削除するだけです。</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'name'</span>] = ar[<span class="hljs-string">'name raw'</span>]<font></font>
<font></font>
<span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> symbols:
    <span class="hljs-keyword">if</span> s.isalpha() <span class="hljs-keyword">or</span> s <span class="hljs-keyword">in</span> <span class="hljs-string">" - ? '"</span>:        
        <span class="hljs-keyword">continue</span>        
    <span class="hljs-keyword">if</span> s <span class="hljs-keyword">in</span> <span class="hljs-string">".,\xa0"</span>:<font></font>
        ar[<span class="hljs-string">'name'</span>] = ar[<span class="hljs-string">'name'</span>].str.replace(s, <span class="hljs-string">' '</span>)       
    <span class="hljs-keyword">else</span>:<font></font>
        ar[<span class="hljs-string">'name'</span>] = ar[<span class="hljs-string">'name'</span>].str.replace(s, <span class="hljs-string">''</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、余分なスペースを取り除きます：</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'name'</span>] = ar[<span class="hljs-string">'name'</span>].str.split().str.join(<span class="hljs-string">' '</span>)<font></font>
ar[<span class="hljs-string">'name'</span>] = ar[<span class="hljs-string">'name'</span>].str.strip() <span class="hljs-comment">#   </span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何が起きたのか見てみましょう：</font></font><br>
<br>
<pre><code class="python hljs">ar.loc[corr.index].sample(<span class="hljs-number">10</span>)
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th><u>name</u></th>
<th>country</th>
<th>...</th>
<th><u>name raw</u></th>
</tr>
<tr>
<td>63</td>
<td>64</td>
<td>M</td>
<td><u>Curzillat B MARANO Annouck GJulie</u></td>
<td>FRA</td>
<td>...</td>
<td><u>Curzillat B1 MARANO Annouck G:Julie</u></td>
</tr>
<tr>
<td>425</td>
<td>426</td>
<td>M</td>
<td><u>Naranjo Quintero Cndido</u></td>
<td>ESP</td>
<td>...</td>
<td><u>Naranjo Quintero, C‡ndido</u></td>
</tr>
<tr>
<td>1347</td>
<td>1348</td>
<td>F</td>
<td><u>Chang Margaret Peggy</u></td>
<td>USA</td>
<td>...</td>
<td><u>Chang, Margaret (Peggy)</u></td>
</tr>
<tr>
<td>790</td>
<td>791</td>
<td>M</td>
<td><u>Gonzalez Ruben</u></td>
<td>PRI</td>
<td>...</td>
<td><u>Gonzalez`, Ruben</u></td>
</tr>
<tr>
<td>1562</td>
<td>1563</td>
<td>M</td>
<td><u>Garcia Hernandez Elias</u></td>
<td>MEX</td>
<td>...</td>
<td><u>Garcia Hernandez/, Elias</u></td>
</tr>
<tr>
<td>50</td>
<td>51</td>
<td>M</td>
<td><u>Reppe H Christiane</u></td>
<td>DEU</td>
<td>...</td>
<td><u>Reppe H2 Christiane</u></td>
</tr>
<tr>
<td>528</td>
<td>529</td>
<td>M</td>
<td><u>Ho Shihken</u></td>
<td>TWN</td>
<td>...</td>
<td><u>Ho, Shih—ken</u></td>
</tr>
<tr>
<td>819</td>
<td>820</td>
<td>M</td>
<td><u>Elmously A R Abdelrahman</u></td>
<td>EGY</td>
<td>...</td>
<td><u>Elmously, A.R. (Abdelrahman)</u></td>
</tr>
<tr>
<td>249</td>
<td>250</td>
<td>F</td>
<td><u>boyer Isabelle</u></td>
<td>THA</td>
<td>...</td>
<td><u>`boyer, Isabelle</u></td>
</tr>
<tr>
<td>744</td>
<td>745</td>
<td>M</td>
<td><u>Garcaa Morales Pedro Luciano</u></td>
<td>ESP</td>
<td>...</td>
<td><u>Garca¬a Morales, Pedro Luciano</u></td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">また、完全に疑問符で構成される名前があることも指摘されました。</font></font><br>
<br>
<pre><code class="python hljs">qmon = ar[(ar[<span class="hljs-string">'name'</span>].str.replace(<span class="hljs-string">'?'</span>, <span class="hljs-string">''</span>).str.strip() == <span class="hljs-string">''</span>)&amp;(ar[<span class="hljs-string">'name'</span>]!=<span class="hljs-string">''</span>)] <span class="hljs-comment">#qmon – question mark only names</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのうちの3,429があり、それは次のように見えます：</font><font style="vertical-align: inherit;">名前を同じ標準にするための私たちの目標は、同じ名前を同じように見えるようにすることですが、異なる方法で異なっています。</font><font style="vertical-align: inherit;">疑問符のみで構成される名前の場合、文字数のみが異なりますが、同じ番号の名前が実際に同じであるという完全な信頼は得られません。</font><font style="vertical-align: inherit;">したがって、これらはすべて空の文字列に置き換えられ、今後は考慮されません。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th><u>name</u></th>
<th>country</th>
<th>group</th>
<th>place in group</th>
<th>...</th>
<th>country raw</th>
<th>group raw</th>
<th><u>name raw</u></th>
</tr>
<tr>
<td>818</td>
<td>819</td>
<td>M</td>
<td><u>???? ???</u></td>
<td>JPN</td>
<td>M45-49</td>
<td>177</td>
<td>...</td>
<td>JPN</td>
<td>M45-49</td>
<td><u>????, ???</u></td>
</tr>
<tr>
<td>1101</td>
<td>1102</td>
<td>M</td>
<td><u>?? ??</u></td>
<td>JPN</td>
<td>M50-54</td>
<td>159</td>
<td>...</td>
<td>JPN</td>
<td>M50-54</td>
<td><u>??, ??</u></td>
</tr>
<tr>
<td>162</td>
<td>163</td>
<td>M</td>
<td><u>? ??</u></td>
<td>CHN</td>
<td>M30-34</td>
<td>22</td>
<td>...</td>
<td>CHN</td>
<td>M30-34</td>
<td><u>?, ??</u></td>
</tr>
<tr>
<td>1271</td>
<td>1272</td>
<td>F</td>
<td><u>???? ????</u></td>
<td>JPN</td>
<td>F50-54</td>
<td>15</td>
<td>...</td>
<td>JPN</td>
<td>F50-54</td>
<td><u>????, ????</u></td>
</tr>
<tr>
<td>552</td>
<td>553</td>
<td>M</td>
<td><u>??? ??</u></td>
<td>JPN</td>
<td>M25-29</td>
<td>30</td>
<td>...</td>
<td>JPN</td>
<td>M25-29</td>
<td><u>???, ??</u></td>
</tr>
<tr>
<td>423</td>
<td>424</td>
<td>M</td>
<td><u>??? ????</u></td>
<td>JPN</td>
<td>M55-59</td>
<td>24</td>
<td>...</td>
<td>JPN</td>
<td>M55-59</td>
<td><u>???, ????</u></td>
</tr>
<tr>
<td>936</td>
<td>937</td>
<td>F</td>
<td><u>?? ??</u></td>
<td>JPN</td>
<td>F50-54</td>
<td>7</td>
<td>...</td>
<td>JPN</td>
<td>F50-54</td>
<td><u>??, ??</u></td>
</tr>
<tr>
<td>244</td>
<td>245</td>
<td>M</td>
<td><u>? ??</u></td>
<td>KOR</td>
<td>M50-54</td>
<td>30</td>
<td>...</td>
<td>KOR</td>
<td>M50-54</td>
<td><u>?, ??</u></td>
</tr>
<tr>
<td>627</td>
<td>628</td>
<td>M</td>
<td><u>? ?</u></td>
<td>CHN</td>
<td>M40-44</td>
<td>94</td>
<td>...</td>
<td>CHN</td>
<td>M40-44</td>
<td><u>?, ?</u></td>
</tr>
<tr>
<td>194</td>
<td>195</td>
<td>M</td>
<td><u>?????? ?????</u></td>
<td>RUS</td>
<td></td>
<td>188</td>
<td>...</td>
<td>RUS</td>
<td>M</td>
<td><u>?????? ?????</u></td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">ar.loc[qmon.index, <span class="hljs-string">'name'</span>] = <span class="hljs-string">''</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
名前が空の文字列であるエントリの総数は3,454です。それほど多くない-私たちは生き残ります。</font><font style="vertical-align: inherit;">不要な文字を削除したので、文字変換に進むことができます。</font><font style="vertical-align: inherit;">これを行うには、最初にすべてを小文字にして、二重の作業を行わないようにします。</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'name'</span>] = ar[<span class="hljs-string">'name'</span>].str.lower()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、辞書を作成します。</font></font><br>
<br>
<pre><code class="python hljs">trans = {<span class="hljs-string">''</span>:<span class="hljs-string">'a'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'b'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'v'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'g'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'d'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'e'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'e'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'zh'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'z'</span>,  <span class="hljs-string">''</span>:<span class="hljs-string">'i'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'y'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'k'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'l'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'m'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'n'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'o'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'p'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'r'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'s'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'t'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'u'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'f'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'kh'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'ts'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'ch'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'sh'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'shch'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">''</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'y'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">''</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'e'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'yu'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'ya'</span>, <span class="hljs-string">'є'</span>:<span class="hljs-string">'e'</span>, <span class="hljs-string">'і'</span>: <span class="hljs-string">'i'</span>,<span class="hljs-string">'ў'</span>:<span class="hljs-string">'w'</span>,<span class="hljs-string">'µ'</span>:<span class="hljs-string">'m'</span>}
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また</font><font style="vertical-align: inherit;">、ベラルーシ語とウクライナ語で使用さ</font><font style="vertical-align: inherit;">れるいわゆる「拡張キリル文字</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文字</font><i><font style="vertical-align: inherit;">「є」、「i」、「ў」</font></i><font style="vertical-align: inherit;">、およびギリシャ文字</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「µ」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も含まれ</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">変換を適用します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> trans:<font></font>
    ar[<span class="hljs-string">'name'</span>] = ar[<span class="hljs-string">'name'</span>].str.replace(s, trans[s])
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、作業用の小文字から、すべてをおなじみの形式に変換します。この場合、姓と名は大文字で始まります。</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'name'</span>] = ar[<span class="hljs-string">'name'</span>].str.title()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何が起きたのか見てみましょう。</font></font><br>
<br>
<pre><code class="python hljs">ar[ar[<span class="hljs-string">'name raw'</span>].str.lower().str[<span class="hljs-number">0</span>].isin(trans.keys())].sample(<span class="hljs-number">10</span>)
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th><u>name</u></th>
<th>...</th>
<th>country raw</th>
<th>name raw</th>
</tr>
<tr>
<td>99</td>
<td>100</td>
<td>M</td>
<td><u>Nikolay Golovkin</u></td>
<td>...</td>
<td>RUS</td>
<td> </td>
</tr>
<tr>
<td>95</td>
<td>96</td>
<td>M</td>
<td><u>Maksim Vasilevich Chubakov</u></td>
<td>...</td>
<td>RUS</td>
<td>  </td>
</tr>
<tr>
<td>325</td>
<td>326</td>
<td>F</td>
<td><u>Ganieva Aygul</u></td>
<td>...</td>
<td>RUS</td>
<td> </td>
</tr>
<tr>
<td>661</td>
<td>662</td>
<td>M</td>
<td><u>Maksut Nizamutdinov</u></td>
<td>...</td>
<td>RUS</td>
<td> </td>
</tr>
<tr>
<td>356</td>
<td>357</td>
<td>F</td>
<td><u>Kolobanova Svetlana</u></td>
<td>...</td>
<td>RUS</td>
<td> </td>
</tr>
<tr>
<td>117</td>
<td>118</td>
<td>M</td>
<td><u>Guskov Vladislav</u></td>
<td>...</td>
<td>RUS</td>
<td> </td>
</tr>
<tr>
<td>351</td>
<td>352</td>
<td>M</td>
<td><u>Kolesnikov Dmitriy</u></td>
<td>...</td>
<td>RUS</td>
<td> </td>
</tr>
<tr>
<td>92</td>
<td>93</td>
<td>M</td>
<td><u>Kuznetsov Oleg</u></td>
<td>...</td>
<td>RUS</td>
<td> </td>
</tr>
<tr>
<td>50</td>
<td>51</td>
<td>M</td>
<td><u>Khoraykin Maksim</u></td>
<td>...</td>
<td>RUS</td>
<td> </td>
</tr>
<tr>
<td>6</td>
<td>7</td>
<td>M</td>
<td><u>Brylev Aleksey</u></td>
<td>...</td>
<td>RUS</td>
<td> </td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最後に、一意の文字を確認します。</font></font><br>
<br>
<pre><code class="python hljs">set( <span class="hljs-string">''</span>.join(ar[<span class="hljs-string">'name'</span>].unique()))
</code></pre><br>
<code><b>Out:</b> [' ', "'", '-', '?', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J','K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z']<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが正しいです。</font><font style="vertical-align: inherit;">その結果、修正はレコードの1,253,882、つまり89％に影響を与え、一意の名前の数は660,207から599,186に、つまり6万1,000またはほぼ10％減少しました。</font><font style="vertical-align: inherit;">うわー！</font><font style="vertical-align: inherit;">arレコードの和集合を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロトコルディクショナリに変換した後、新しいファイルに保存します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs">pkl.dump(rd, open(<span class="hljs-string">r'D:\tri\details4.pkl'</span>, <span class="hljs-string">'wb'</span>))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、順序を復元する必要があります。つまり、すべてのレコードは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ようになります</font><i><font style="vertical-align: inherit;">-First Name Last Name</font></i><font style="vertical-align: inherit;">または</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Last Name First Name</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。どちらを決定するか。確かに、名前と姓に加えて、一部のプロトコルにはミドルネームも含まれています。そして、同じ人が異なるプロトコルで異なる方法で書かれている可能性があります-ミドルネームのある場所とない場所。これは彼の識別を妨害するので、ミドルネームを削除してみてください。男性の愛称は通常</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「hiv」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">終わり</font><font style="vertical-align: inherit;">、女性の場合は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「vna」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。しかし、例外があります。例</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-Ilyich、Ilyinichna、Nikitich、Nikitichna</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。確かに、そのような例外はほとんどありません。すでに述べたように、1つのプロトコル内の名前の形式は永続的なものと見なすことができます。したがって、愛国主義を取り除くには、それらが存在する人種を見つける必要があります。これを行うに</font><font style="vertical-align: inherit;">は、列</font><i><font style="vertical-align: inherit;">名</font></i><font style="vertical-align: inherit;">で</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「vich」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「vna」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のフラグメントの総数を見つけます。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして、それらを各プロトコルのエントリの総数と比較します。これらの数値が近い場合はミドルネームが存在し、そうでない場合はそうではありません。厳密な一致を探すのは不合理です。たとえば、ミドルネームが記録されるレースでも、外国人は参加でき、彼なしで記録されます。また、参加者がミドルネームを忘れたか、または示したくなかったということも起こります。一方、「vich」で終わる姓もあり、それらの多くはベラルーシやその他の国でスラブ語族の言語を使用しています。また、音訳をしました。文字変換の前にこの分析を行うことは可能でしたが、ミドルネームが存在するプロトコルを見逃す可能性がありますが、最初はすでにラテン語です。だからすべてが大丈夫です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、</font><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">のフラグメント</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「vich」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「vna」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の数があるすべてのプロトコルを探し</font><font style="vertical-align: inherit;">ます。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名前は</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、プロトコルのエントリの総数の50％を超えています。</font></font><br>
<br>
<pre><code class="python hljs">wp = {} <span class="hljs-comment">#wp – with patronymic </span><font></font>
<font></font>
<span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> rd:<font></font>
    nvich = (<span class="hljs-string">''</span>.join(rd[e][<span class="hljs-string">'name'</span>])).count(<span class="hljs-string">'vich'</span>) <font></font>
    nvna = (<span class="hljs-string">''</span>.join(rd[e][<span class="hljs-string">'name'</span>])).count(<span class="hljs-string">'vna'</span>)
    <span class="hljs-keyword">if</span> nvich + nvna &gt; <span class="hljs-number">0.5</span>*len(rd[e]):<font></font>
        wp[e] = rd[e]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
29のプロトコルがあります。そのうちの1つは次のとおりです。</font><font style="vertical-align: inherit;">興味深いのは、50％ではなく20％、またはその逆で70％をとっても、結果が変わらない場合、同じ29になるということです。それで、正しい選択をしました。</font><font style="vertical-align: inherit;">したがって、20％未満-姓の影響、70％を超える-ミドルネームのない個々のレコードの影響。</font><font style="vertical-align: inherit;">ピボットテーブルの助けを借りて国を調べたところ、そのうち25人がロシアに、4人がアブハジアにいることがわかりました。</font><font style="vertical-align: inherit;">
次へ。</font><font style="vertical-align: inherit;">レコードは、（おそらく）姓、名、ミドルネームの3つのコンポーネントを持つレコードのみを処理します。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th>country</th>
<th>...</th>
<th>name raw</th>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>M</td>
<td>Yaroslav <u>Stanislavovich</u> Pavlishchev</td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>M</td>
<td>Vladimir <u>Vasilevich</u> Perezhigin</td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>M</td>
<td>Vladislav <u>Evgenevich</u> Litvinchuk</td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>M</td>
<td>Sergey <u>Gennadevich</u> Gavrilenko</td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>4</td>
<td>5</td>
<td>M</td>
<td>Ivan <u>Markovich</u> Markin</td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>5</td>
<td>6</td>
<td>M</td>
<td>Nikolay <u>Evgenevich</u> Sokolov</td>
<td>RUS</td>
<td>...</td>
<td>Nikolay Evgenevich Sokolov</td>
</tr>
<tr>
<td>6</td>
<td>7</td>
<td>M</td>
<td>Aram <u>Pavlovich</u> Kukhtiev</td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>7</td>
<td>8</td>
<td>M</td>
<td>Andrey <u>Anatolevich</u> Andreev</td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>8</td>
<td>9</td>
<td>M</td>
<td>Denis <u>Valerevich</u> Bulgakov</td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>9</td>
<td>10</td>
<td>M</td>
<td>Aleksandr <u>Ivanovich</u> Kuts</td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">sum_n3w = <span class="hljs-number">0</span> <span class="hljs-comment"># sum name of 3 words</span>
sum_nnot3w = <span class="hljs-number">0</span> <span class="hljs-comment"># sum name not of 3 words</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> wp: <font></font>
    sum_n3w += len([n <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> wp[e][<span class="hljs-string">'name'</span>] <span class="hljs-keyword">if</span> len(n.split()) == <span class="hljs-number">3</span>])<font></font>
    sum_nnot3w += len(wp[e]) - n3w<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのような記録の大半は86％です。</font><font style="vertical-align: inherit;">これで、3つのコンポーネントが列</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name0、name1、name2に</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分割されます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> wp:<font></font>
    ind3 = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> rd[e].index <span class="hljs-keyword">if</span> len(rd[e].loc[i,<span class="hljs-string">'name'</span>].split()) == <span class="hljs-number">3</span>]<font></font>
    rd[e][<span class="hljs-string">'name0'</span>] = <span class="hljs-string">''</span>
    rd[e][<span class="hljs-string">'name1'</span>] = <span class="hljs-string">''</span>
    rd[e][<span class="hljs-string">'name2'</span>] = <span class="hljs-string">''</span>
    rd[e].loc[ind3, <span class="hljs-string">'name0'</span>] = rd[e].loc[ind3,<span class="hljs-string">'name'</span>].str.split().str[<span class="hljs-number">0</span>]<font></font>
    rd[e].loc[ind3, <span class="hljs-string">'name1'</span>] = rd[e].loc[ind3,<span class="hljs-string">'name'</span>].str.split().str[<span class="hljs-number">1</span>]<font></font>
    rd[e].loc[ind3, <span class="hljs-string">'name2'</span>] = rd[e].loc[ind3,<span class="hljs-string">'name'</span>].str.split().str[<span class="hljs-number">2</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロトコルの1つは次のとおりです。</font><font style="vertical-align: inherit;">ここでは、特に、2つのコンポーネントの記録が処理されていないことは明らかです。</font><font style="vertical-align: inherit;">ここで、プロトコルごとに、どの列にミドルネームがあるかを判別する必要があります。</font><font style="vertical-align: inherit;">最初は存在できないため、</font><i><font style="vertical-align: inherit;">name1、name2の</font></i><font style="vertical-align: inherit;"> 2つの</font><i><font style="vertical-align: inherit;">オプション</font></i><font style="vertical-align: inherit;">しかあり</font><font style="vertical-align: inherit;">ません。</font><font style="vertical-align: inherit;">決定したら、それなしですでに新しい名前を収集します。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>name</th>
<th><u>name0</u></th>
<th><u>name1</u></th>
<th><u>name2</u></th>
<th>...</th>
<th>name raw</th>
</tr>
<tr>
<td>0</td>
<td>Lekomtsev Denis Nikolaevich</td>
<td><u>Lekomtsev</u></td>
<td><u>Denis</u></td>
<td><u>Nikolaevich</u></td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>1</td>
<td>Ivanov Andrey Aleksandrovich</td>
<td><u>Ivanov</u></td>
<td><u>Andrey</u></td>
<td><u>Aleksandrovich</u></td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>2</td>
<td>Ivanov Evgeniy Vasilevich</td>
<td><u>Ivanov</u></td>
<td><u>Evgeniy</u></td>
<td><u>Vasilevich</u></td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>3</td>
<td>Setepov Vladislav</td>
<td></td>
<td></td>
<td></td>
<td>...</td>
<td> </td>
</tr>
<tr>
<td>4</td>
<td>Mishanin Sergey Yurevich</td>
<td><u>Mishanin</u></td>
<td><u>Sergey</u></td>
<td><u>Yurevich</u></td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>5</td>
<td>Baranov Andrey Aleksandrovich</td>
<td><u>Baranov</u></td>
<td><u>Andrey</u></td>
<td><u>Aleksandrovich</u></td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>6</td>
<td>Nakaryakov Dmitriy Valerevich</td>
<td><u>Nakaryakov</u></td>
<td><u>Dmitriy</u></td>
<td><u>Valerevich</u></td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>7</td>
<td>Tretyakov Dmitriy Valentinovich</td>
<td><u>Tretyakov</u></td>
<td><u>Dmitriy</u></td>
<td><u>Valentinovich</u></td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>8</td>
<td>Kuznetsov Stanislav Vladimirovich</td>
<td><u>Kuznetsov</u></td>
<td><u>Stanislav</u></td>
<td><u>Vladimirovich</u></td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>9</td>
<td>Dubrovin Maksim Sergeevich</td>
<td><u>Dubrovin</u></td>
<td><u>Maksim</u></td>
<td><u>Sergeevich</u></td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>10</td>
<td>Karpov Anatoliy Sergeevich</td>
<td><u>Karpov</u></td>
<td><u>Anatoliy</u></td>
<td><u>Sergeevich</u></td>
<td>...</td>
<td>  </td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> wp:    <font></font>
    n1=(<span class="hljs-string">''</span>.join(rd[e][<span class="hljs-string">'name1'</span>])).count(<span class="hljs-string">'vich'</span>)+(<span class="hljs-string">''</span>.join(rd[e][<span class="hljs-string">'name1'</span>])).count(<span class="hljs-string">'vna'</span>)<font></font>
    n2=(<span class="hljs-string">''</span>.join(rd[e][<span class="hljs-string">'name2'</span>])).count(<span class="hljs-string">'vich'</span>)+(<span class="hljs-string">''</span>.join(rd[e][<span class="hljs-string">'name2'</span>])).count(<span class="hljs-string">'vna'</span>)<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (n1 &gt; n2):<font></font>
        rd[e][<span class="hljs-string">'new name'</span>] = rd[e][<span class="hljs-string">'name0'</span>] + <span class="hljs-string">' '</span> + rd[e][<span class="hljs-string">'name2'</span>]
    <span class="hljs-keyword">else</span>:<font></font>
        rd[e][<span class="hljs-string">'new name'</span>] = rd[e][<span class="hljs-string">'name0'</span>] + <span class="hljs-string">' '</span> + rd[e][<span class="hljs-string">'name1'</span>]
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>name</th>
<th>name0</th>
<th>name1</th>
<th>name2</th>
<th><u>new name</u></th>
<th>name raw</th>
</tr>
<tr>
<td>0</td>
<td>Gorik Pavel Vladimirovich</td>
<td>Gorik</td>
<td>Pavel</td>
<td>Vladimirovich</td>
<td><u>Gorik Pavel</u></td>
<td>  </td>
</tr>
<tr>
<td>1</td>
<td>Korobov Oleg Anatolevich</td>
<td>Korobov</td>
<td>Oleg</td>
<td>Anatolevich</td>
<td><u>Korobov Oleg</u></td>
<td>  </td>
</tr>
<tr>
<td>2</td>
<td>Pavlishchev Yaroslav Stanislavovich</td>
<td>Pavlishchev</td>
<td>Yaroslav</td>
<td>Stanislavovich</td>
<td><u>Pavlishchev Yaroslav</u></td>
<td>  </td>
</tr>
<tr>
<td>3</td>
<td>Fedorov Nikolay Nikolaevich</td>
<td>Fedorov</td>
<td>Nikolay</td>
<td>Nikolaevich</td>
<td><u>Fedorov Nikolay</u></td>
<td>  </td>
</tr>
<tr>
<td>4</td>
<td>Medvedev Andrey Aleksandrovich</td>
<td>Medvedev</td>
<td>Andrey</td>
<td>Aleksandrovich</td>
<td><u>Medvedev Andrey</u></td>
<td>  </td>
</tr>
<tr>
<td>5</td>
<td>Popov Sergey Eduardovich</td>
<td>Popov</td>
<td>Sergey</td>
<td>Eduardovich</td>
<td><u>Popov Sergey</u></td>
<td>  </td>
</tr>
<tr>
<td>6</td>
<td>Dumchev Andrey Viktorovich</td>
<td>Dumchev</td>
<td>Andrey</td>
<td>Viktorovich</td>
<td><u>Dumchev Andrey</u></td>
<td>  </td>
</tr>
<tr>
<td>7</td>
<td>Trusov Mikhail Vladimirovich</td>
<td>Trusov</td>
<td>Mikhail</td>
<td>Vladimirovich</td>
<td><u>Trusov Mikhail</u></td>
<td>  </td>
</tr>
<tr>
<td>8</td>
<td>Demichev Yuriy Anatolevich</td>
<td>Demichev</td>
<td>Yuriy</td>
<td>Anatolevich</td>
<td><u>Demichev Yuriy</u></td>
<td>  </td>
</tr>
<tr>
<td>9</td>
<td>Pushkin Boris Sergeevich</td>
<td>Pushkin</td>
<td>Boris</td>
<td>Sergeevich</td>
<td><u>Pushkin Boris</u></td>
<td>  </td>
</tr>
<tr>
<td>10</td>
<td>Lando Aleksandr Borisovich</td>
<td>Lando</td>
<td>Aleksandr</td>
<td>Borisovich</td>
<td><u>Lando Aleksandr</u></td>
<td>  </td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次に、新しい名前をメイン列の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名前</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（空でない場所</font><font style="vertical-align: inherit;">）に慎重に割り当て</font><font style="vertical-align: inherit;">、補助列を削除します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> wp:<font></font>
    ind = rd[e][rd[e][<span class="hljs-string">'new name'</span>].str.strip() != <span class="hljs-string">''</span>].index<font></font>
    rd[e].loc[ind, <span class="hljs-string">'name'</span>] = rd[e].loc[ind, <span class="hljs-string">'new name'</span>]<font></font>
    rd[e] = rd[e].drop(columns = [<span class="hljs-string">'name0'</span>,<span class="hljs-string">'name1'</span>,<span class="hljs-string">'name2'</span>,<span class="hljs-string">'new name'</span>])
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th><u>name</u></th>
<th>country</th>
<th>...</th>
<th>name raw</th>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>M</td>
<td><u>Yaroslav Pavlishchev</u></td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>M</td>
<td><u>Vladimir Perezhigin</u></td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>M</td>
<td><u>Vladislav Litvinchuk</u></td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>M</td>
<td><u>Sergey Gavrilenko</u></td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>4</td>
<td>5</td>
<td>M</td>
<td><u>Ivan Markin</u></td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>5</td>
<td>6</td>
<td>M</td>
<td><u>Nikolay Sokolov</u></td>
<td>RUS</td>
<td>...</td>
<td>Nikolay Evgenevich Sokolov</td>
</tr>
<tr>
<td>6</td>
<td>7</td>
<td>M</td>
<td><u>Aram Kukhtiev</u></td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>7</td>
<td>8</td>
<td>M</td>
<td><u>Andrey Andreev</u></td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>8</td>
<td>9</td>
<td>M</td>
<td><u>Denis Bulgakov</u></td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>9</td>
<td>10</td>
<td>M</td>
<td><u>Aleksandr Kuts</u></td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>10</td>
<td>11</td>
<td>M</td>
<td><u>Aleksandr Lando</u></td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以上です。</font><font style="vertical-align: inherit;">2,035エントリを編集しました。</font><font style="vertical-align: inherit;">悪くない。</font><font style="vertical-align: inherit;">保存しました。</font></font><br>
<br>
<pre><code class="python hljs">pkl.dump(rd, open(<span class="hljs-string">r'D:\tri\details5.pkl'</span>, <span class="hljs-string">'wb'</span>))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、名前を同じ順序にする必要があります。</font><font style="vertical-align: inherit;">つまり、すべてのプロトコルで、すべてのプロトコルで、名前の後に姓が続く、またはその逆である必要があります。これもすべてのプロトコルで、姓、名の順になります。</font><font style="vertical-align: inherit;">どれに依存するか、今すぐ確認します。</font><font style="vertical-align: inherit;">ミドルネームを削除した後でも、フルネームは2語以上で構成できるため、状況は少し複雑になります。</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'nwin'</span>] = ar[<span class="hljs-string">'name'</span>].str.count(<span class="hljs-string">' '</span>) + <span class="hljs-number">1</span> <span class="hljs-comment"># nwin – number of words in name</span>
ar.loc[ar[<span class="hljs-string">'name'</span>] == <span class="hljs-string">''</span>,<span class="hljs-string">'nwin'</span>] = <span class="hljs-number">0</span>
<span class="hljs-number">100</span>*ar[<span class="hljs-string">'nwin'</span>].value_counts()/len(ar)
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
名前の単語数レコードの数レコードの共有（％）</font><font style="vertical-align: inherit;">もちろん、大多数（91％）は2つの単語（名前と姓）です。</font><font style="vertical-align: inherit;">しかし、3語と4語のエントリも非常に多くなります。</font><font style="vertical-align: inherit;">そのような記録の国籍を見てみましょう：</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>   </th>
<th> </th>
<th>  (%)</th>
</tr>
<tr>
<td>2</td>
<td>1285270</td>
<td>90.74426</td>
</tr>
<tr>
<td>3</td>
<td>102220</td>
<td>7.217066</td>
</tr>
<tr>
<td>4</td>
<td>22420</td>
<td>1.582925</td>
</tr>
<tr>
<td>0</td>
<td>3454</td>
<td>0.243864</td>
</tr>
<tr>
<td>5</td>
<td>2385</td>
<td>0.168389</td>
</tr>
<tr>
<td>6</td>
<td>469</td>
<td>0.033113</td>
</tr>
<tr>
<td>1</td>
<td>80</td>
<td>0.005648</td>
</tr>
<tr>
<td>7</td>
<td>57</td>
<td>0.004024</td>
</tr>
<tr>
<td>8</td>
<td>5</td>
<td>0.000353</td>
</tr>
<tr>
<td>10</td>
<td>4</td>
<td>0.000282</td>
</tr>
<tr>
<td>9</td>
<td>1</td>
<td>0.000071</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">ar[ar[<span class="hljs-string">'nwin'</span>] &gt;= <span class="hljs-number">3</span>][<span class="hljs-string">'country'</span>].value_counts()[:<span class="hljs-number">12</span>]
</code></pre><br>
<code><b>Out: </b><br>
ESP 28435<br>
MEX 10561<br>
USA 7608<br>
DNK 7178<br>
BRA 6321<br>
NLD 5748<br>
DEU 4310<br>
PHL 3941<br>
ZAF 3862<br>
ITA 3691<br>
BEL 3596<br>
FRA 3323<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まあ、最初はスペイン、2番目はスペイン、メキシコ、ヒスパニック系の国、そしてアメリカで、歴史的に多くのヒスパニック系民族がいます。ブラジルとフィリピンもスペイン語（およびポルトガル語）の名前です。デンマーク、オランダ、ドイツ、南アフリカ、イタリア、ベルギー、フランスも別の問題です。姓に接頭辞が付けられることもあるので、2つ以上の単語があります。ただし、これらすべての場合で、通常、名前自体は1つの単語で構成され、姓は2、3で構成されます。もちろん、このルールには例外がありますが、今後は処理しません。最初に、各プロトコルについて、どのような順序があるかを決定する必要があります。名前と姓、またはその逆です。どうやってするの？次のアイデアが思い浮かびました。まず、姓の種類は通常、名前の種類よりもはるかに多いです。 1つのプロトコルのフレームワーク内でもそうである必要があります。第二に、名前の長さは、通常、姓の長さよりも短くなります（非複合姓の場合でも）。これらの基準を組み合わせて、予備注文を決定します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
氏名の最初と最後の単語を選択します。</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'new name'</span>] = ar[<span class="hljs-string">'name'</span>]<font></font>
ind = ar[ar[<span class="hljs-string">'nwin'</span>] &lt; <span class="hljs-number">2</span>].index<font></font>
ar.loc[ind, <span class="hljs-string">'new name'</span>] = <span class="hljs-string">'. .'</span> <span class="hljs-comment">#  ,   str.split()   </span>
ar[<span class="hljs-string">'wfin'</span>] = ar[<span class="hljs-string">'new name'</span>].str.split().str[<span class="hljs-number">0</span>] <span class="hljs-comment">#fwin  – first word in name</span>
ar[<span class="hljs-string">'lwin'</span>] = ar[<span class="hljs-string">'new name'</span>].str.split().str[<span class="hljs-number">-1</span>]<span class="hljs-comment">#lfin – last word in name</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいデータ列</font><i><font style="vertical-align: inherit;">nwin、ns0、ns</font></i><font style="vertical-align: inherit;">が各レースのデータフレームに入る</font><font style="vertical-align: inherit;">ように</font><font style="vertical-align: inherit;">
、結合された</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データフレーム</font><font style="vertical-align: inherit;">を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">辞書に</font><font style="vertical-align: inherit;">変換し</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次に、</font><font style="vertical-align: inherit;">私たちの基準に従って、</font><i><font style="vertical-align: inherit;">「</font></i><font style="vertical-align: inherit;"> First </font><i><font style="vertical-align: inherit;">Name Last Name」の</font></i><font style="vertical-align: inherit;">順序のプロトコルの数と逆の順序のプロトコルの数を決定します。</font><font style="vertical-align: inherit;">フルネームが2つの単語で構成されるエントリのみを考慮します。</font><font style="vertical-align: inherit;">同時に、名前（名）を新しい列に保存します。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">name_surname = {}<font></font>
surname_name = {}<font></font>
<font></font>
<span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> rd:<font></font>
    d = rd[e][rd[e][<span class="hljs-string">'nwin'</span>] == <span class="hljs-number">2</span>]<font></font>
<font></font>
    <span class="hljs-keyword">if</span> len(d[<span class="hljs-string">'fwin'</span>].unique()) &lt; len(d[<span class="hljs-string">'lwin'</span>].unique()) <span class="hljs-keyword">and</span> len(<span class="hljs-string">''</span>.join(d[<span class="hljs-string">'fwin'</span>])) &lt; len(<span class="hljs-string">''</span>.join(d[<span class="hljs-string">'lwin'</span>])):<font></font>
        name_surname[e] = d<font></font>
        rd[e][<span class="hljs-string">'first name'</span>] = rd[e][<span class="hljs-string">'fwin'</span>]<font></font>
<font></font>
    <span class="hljs-keyword">if</span> len(d[<span class="hljs-string">'fwin'</span>].unique()) &gt; len(d[<span class="hljs-string">'lwin'</span>].unique()) <span class="hljs-keyword">and</span> len(<span class="hljs-string">''</span>.join(d[<span class="hljs-string">'fwin'</span>])) &gt; len(<span class="hljs-string">''</span>.join(d[<span class="hljs-string">'lwin'</span>])):<font></font>
        surname_name[e] = d<font></font>
        rd[e][<span class="hljs-string">'first name'</span>] = rd[e][<span class="hljs-string">'lwin'</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のことが判明しました：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">姓名</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -244プロトコル、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">姓名</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -1,508プロトコル。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、私たちはより一般的な形式に導きます。</font><font style="vertical-align: inherit;">2つの基準が同時に満たされていることを確認し、厳密な不平等がある場合でも、合計は合計金額よりも少ないことがわかりました。</font><font style="vertical-align: inherit;">基準の1つだけが満たされている、または可能であるプロトコルがありますが、平等が発生することはほとんどありません。</font><font style="vertical-align: inherit;">しかし、フォーマットが定義されているので、これは完全に重要ではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、十分に高い精度で次数を決定したと仮定し、100％正確ではないことを忘れないで、この情報を使用します。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初の名前の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列から最も人気のある名前を見つけます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs">vc = ar[<span class="hljs-string">'first name'</span>].value_counts()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
百回以上会った人たちを見てください。</font></font><br>
<br>
<pre><code class="python hljs">pfn=vc[vc&gt;<span class="hljs-number">100</span>] <span class="hljs-comment">#pfn – popular first names</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1,673がありました。最初の100は、人気の高い順に並べられてい</font><font style="vertical-align: inherit;">
ます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次に、このリストを使用して、すべてのプロトコルを調べて、名前の最初の単語または最後の一致する場所が多い場所を比較します。 2語の名前のみを考慮します。最後の単語との一致がさらにある場合、順序は正しいです。最初の単語と一致する場合は、逆になります。さらに、ここではすでに自信があるので、この知識を使用できます。次のプロトコルの名前のリストを、各パスでの一般的な名前の初期リストに追加します。ランダムエラーを回避するために、最初のリストから名前の出現頻度でプロトコルを事前にソートし、一致がほとんどなく、サイクルの終わり近くに処理されるプロトコルのより広範なリストを準備します。</font></font><br>
<code>['Michael', 'David', 'Thomas', 'John', 'Daniel', 'Mark', 'Peter', 'Paul', 'Christian', 'Robert', 'Martin', 'James', 'Andrew', 'Chris', 'Richard', 'Andreas', 'Matthew', 'Brian', 'Patrick', 'Scott', 'Kevin', 'Stefan', 'Jason', 'Eric', 'Christopher', 'Alexander', 'Simon', 'Mike', 'Tim', 'Frank', 'Stephen', 'Steve', 'Andrea', 'Jonathan', 'Markus', 'Marco', 'Adam', 'Ryan', 'Jan', 'Tom', 'Marc', 'Carlos', 'Jennifer', 'Matt', 'Steven', 'Jeff', 'Sergey', 'William', 'Aleksandr', 'Sarah', 'Alex', 'Jose', 'Andrey', 'Benjamin', 'Sebastian', 'Ian', 'Anthony', 'Ben', 'Oliver', 'Antonio', 'Ivan', 'Sean', 'Manuel', 'Matthias', 'Nicolas', 'Dan', 'Craig', 'Dmitriy', 'Laura', 'Luis', 'Lisa', 'Kim', 'Anna', 'Nick', 'Rob', 'Maria', 'Greg', 'Aleksey', 'Javier', 'Michelle', 'Andre', 'Mario', 'Joseph', 'Christoph', 'Justin', 'Jim', 'Gary', 'Erik', 'Andy', 'Joe', 'Alberto', 'Roberto', 'Jens', 'Tobias', 'Lee', 'Nicholas', 'Dave', 'Tony', 'Olivier', 'Philippe']<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">sbpn = pd.DataFrame(columns = [<span class="hljs-string">'event'</span>, <span class="hljs-string">'num pop names'</span>], index=range(len(rd))) <span class="hljs-comment"># sbpn - sorted by popular names</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(rd)):<font></font>
    e = list(rd.keys())[i]<font></font>
    sbpn.loc[i, <span class="hljs-string">'event'</span>] = e<font></font>
    sbpn.loc[i, <span class="hljs-string">'num pop names'</span>] = len(set(pfn).intersection(rd[e][<span class="hljs-string">'first name'</span>]))<font></font>
<font></font>
sbnp=sbnp.sort_values(by = <span class="hljs-string">'num pop names'</span>,ascending=<span class="hljs-literal">False</span>)<font></font>
sbnp = sbnp.reset_index(drop=<span class="hljs-literal">True</span>) 
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>event</th>
<th>num pop names</th>
</tr>
<tr>
<td>0</td>
<td>Ironman World Championship 70.3 2016</td>
<td>811</td>
</tr>
<tr>
<td>1</td>
<td>Ironman World Championship 2019</td>
<td>781</td>
</tr>
<tr>
<td>2</td>
<td>Ironman World Championship 70.3 2015</td>
<td>778</td>
</tr>
<tr>
<td>3</td>
<td>Ironman Mallorca 70.3 2014</td>
<td>776</td>
</tr>
<tr>
<td>4</td>
<td>Ironman World Championship 2018</td>
<td>766</td>
</tr>
<tr>
<td>5</td>
<td>Challenge Roth Long 2019</td>
<td>759</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<td>1917</td>
<td>Challenge Gran Canaria Olympic 2019</td>
<td>0</td>
</tr>
<tr>
<td>1918</td>
<td>Challenge Gran Canaria Middle 2017</td>
<td>0</td>
</tr>
<tr>
<td>1919</td>
<td>Challenge Forte Village-Sardinia Sprint 2017</td>
<td>0</td>
</tr>
<tr>
<td>1920</td>
<td>ITU European Cup Kuopio Sprint 2007</td>
<td>0</td>
</tr>
<tr>
<td>1921</td>
<td>ITU World Cup Madeira Olympic 2002</td>
<td>0</td>
</tr>
</tbody></table></div></code><br>
<br>
<pre><code class="python hljs">tofix = []<font></font>
<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(rd)):<font></font>
    e = sbpn.loc[i, <span class="hljs-string">'event'</span>]<font></font>
<font></font>
    <span class="hljs-keyword">if</span> len(set(list(rd[e][<span class="hljs-string">'fwin'</span>])).intersection(pfn)) &gt; len(set(list(rd[e][<span class="hljs-string">'lwin'</span>])).intersection(pfn)):<font></font>
        tofix.append(e)<font></font>
        pfn = list(set(pfn + list(rd[e][<span class="hljs-string">'fwin'</span>])))
    <span class="hljs-keyword">else</span>:<font></font>
        pfn = list(set(pfn + list(rd[e][<span class="hljs-string">'lwin'</span>])))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロトコルは235個ありました。つまり、最初の近似で起こったこととほぼ同じです（244）。確かに、私はそれぞれの最初の3つのレコードを選択して調べ、すべてが正しいことを確認しました。また、ソートの第一段階は、クラスから36個の偽のエントリを与えていることを確認</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名姓</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とクラスから2偽の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名前の名前</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。私はそれぞれの最初の3つのレコードを確認しました。実際、2番目のステージは完全に機能しました。現在、実際には、間違った順序が見つかったプロトコルを修正する必要があります。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> tofix:<font></font>
    ind = rd[e][rd[e][<span class="hljs-string">'nwin'</span>] &gt; <span class="hljs-number">1</span>].index<font></font>
    rd[e].loc[ind,<span class="hljs-string">'name'</span>] = rd[e].loc[ind,<span class="hljs-string">'name'</span>].str.split(n=<span class="hljs-number">1</span>).str[<span class="hljs-number">1</span>] + <span class="hljs-string">' '</span> +                   rd[e].loc[ind,<span class="hljs-string">'name'</span>].str.split(n=<span class="hljs-number">1</span>).str[<span class="hljs-number">0</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この分割では、パラメーター</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用してピースの数を制限しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ロジックは次のとおりです。名前は1つの単語で、フルネームの最初の単語です。</font><font style="vertical-align: inherit;">それ以外はすべて姓です（複数の単語で構成される場合があります）。</font><font style="vertical-align: inherit;">それらを交換するだけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、不要な列を削除して保存します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> rd:<font></font>
    rd[e] = rd[e].drop(columns = [<span class="hljs-string">'new name'</span>, <span class="hljs-string">'first name'</span>, <span class="hljs-string">'fwin'</span>,<span class="hljs-string">'lwin'</span>, <span class="hljs-string">'nwin'</span>])<font></font>
<font></font>
pkl.dump(rd, open(<span class="hljs-string">r'D:\tri\details6.pkl'</span>, <span class="hljs-string">'wb'</span>))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果を確認してください。</font><font style="vertical-align: inherit;">ランダムなダースの固定レコード：</font><font style="vertical-align: inherit;">合計10万8千個のレコードが修正されました。</font><font style="vertical-align: inherit;">一意のフルネームの数は598から547千に減少しました。</font><font style="vertical-align: inherit;">いいね！</font><font style="vertical-align: inherit;">フォーマットが完了しました。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th><u>name</u></th>
<th>country</th>
<th>group</th>
<th>...</th>
<th><u>name raw</u></th>
</tr>
<tr>
<td>188</td>
<td>189</td>
<td>M</td>
<td><u>Azhel Dmitriy</u></td>
<td>BLR</td>
<td></td>
<td>...</td>
<td><u> </u></td>
</tr>
<tr>
<td>96</td>
<td>97</td>
<td>M</td>
<td><u>Bostina Cristian</u></td>
<td>ROU</td>
<td></td>
<td>...</td>
<td><u>Cristian Bostina</u></td>
</tr>
<tr>
<td>1757</td>
<td>1758</td>
<td>M</td>
<td><u>Lowe Jonathan</u></td>
<td>AUS</td>
<td>M30-34</td>
<td>...</td>
<td><u>Jonathan LOWE</u></td>
</tr>
<tr>
<td>599</td>
<td>600</td>
<td>M</td>
<td><u>Baerwald Manuel</u></td>
<td>DEU</td>
<td></td>
<td>...</td>
<td><u>Manuel BAERWALD</u></td>
</tr>
<tr>
<td>657</td>
<td>658</td>
<td>M</td>
<td><u>Krumdieck Ralf</u></td>
<td>DEU</td>
<td></td>
<td>...</td>
<td><u>Ralf KRUMDIECK</u></td>
</tr>
<tr>
<td>354</td>
<td>355</td>
<td>F</td>
<td><u>Knapp Samantha</u></td>
<td>USA</td>
<td>F30-34</td>
<td>...</td>
<td><u>Samantha Knapp</u></td>
</tr>
<tr>
<td>375</td>
<td>376</td>
<td>M</td>
<td><u>Rintalaulaja Mika</u></td>
<td>FIN</td>
<td>M40-44</td>
<td>...</td>
<td><u>Mika Rintalaulaja</u></td>
</tr>
<tr>
<td>1304</td>
<td>1305</td>
<td>M</td>
<td><u>Dee Jim</u></td>
<td>USA</td>
<td>M50-54</td>
<td>...</td>
<td><u>Jim DEE</u></td>
</tr>
<tr>
<td>178</td>
<td>179</td>
<td>M</td>
<td><u>Halibert Greg</u></td>
<td>FRA</td>
<td></td>
<td>...</td>
<td><u>GREG HALIBERT</u></td>
</tr>
<tr>
<td>2740</td>
<td>2741</td>
<td>F</td>
<td><u>Comia Marissa</u></td>
<td>USA</td>
<td>F45-49</td>
<td>...</td>
<td><u>Marissa COMIA</u></td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート3.不完全なデータの回復</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、欠落しているデータの回復に進みます。</font><font style="vertical-align: inherit;">そして、そのようなものがあります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
国から始めましょう。</font><font style="vertical-align: inherit;">国が示されていないすべてのレコードを検索します。</font></font><br>
<br>
<pre><code class="python hljs">arnc = ar[ar[<span class="hljs-string">'country'</span>] == <span class="hljs-string">''</span>] <span class="hljs-comment">#arnc – all records with no country</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのうちの3,221個あります。ここに10個のランダムなものがあります：</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>event</th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th><u>country</u></th>
<th>group</th>
<th>...</th>
<th>country raw</th>
</tr>
<tr>
<td>...</td>
<td>1633</td>
<td>M</td>
<td>Guerrero Pla Angel</td>
<td></td>
<td>M30-34</td>
<td>...</td>
<td>E</td>
</tr>
<tr>
<td>...</td>
<td>258</td>
<td>M</td>
<td>Bellm Mathias</td>
<td></td>
<td>M35-39</td>
<td>...</td>
<td>D</td>
</tr>
<tr>
<td>...</td>
<td>655</td>
<td>M</td>
<td>Moratto Alessio</td>
<td></td>
<td>M40-44</td>
<td>...</td>
<td>I</td>
</tr>
<tr>
<td>...</td>
<td>1317</td>
<td>M</td>
<td>Solari Jean-Jacques</td>
<td></td>
<td>M50-54</td>
<td>...</td>
<td>TAH</td>
</tr>
<tr>
<td>...</td>
<td>1311</td>
<td>F</td>
<td>Duranel Isabelle</td>
<td></td>
<td>F40-44</td>
<td>...</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>1012</td>
<td>M</td>
<td>Endler Maximilian</td>
<td></td>
<td>M40-44</td>
<td>...</td>
<td>D</td>
</tr>
<tr>
<td>...</td>
<td>284</td>
<td>M</td>
<td>Schreiner Jorg</td>
<td></td>
<td>M40-44</td>
<td>...</td>
<td>D</td>
</tr>
<tr>
<td>...</td>
<td>14</td>
<td>M</td>
<td>Butturini Jacopo</td>
<td></td>
<td></td>
<td>...</td>
<td>ITU</td>
</tr>
<tr>
<td>...</td>
<td>204</td>
<td>M</td>
<td>Lindner Thomas</td>
<td></td>
<td>M40-44</td>
<td>...</td>
<td>D</td>
</tr>
<tr>
<td>...</td>
<td>1168</td>
<td>M</td>
<td>Gramke Peter</td>
<td></td>
<td>M45-49</td>
<td>...</td>
<td>D</td>
</tr>
</tbody></table></div></code><br>
<br>
<pre><code class="python hljs">nnc = arnc[<span class="hljs-string">'name'</span>].unique() <span class="hljs-comment">#nnc - names with no country</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
国のないレコード間の一意の名前の数は3 051です。この数を減らすことができるかどうか見てみましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
事実、トライアスロンでは、人々はめったに1つのレースに限定されず、通常、年に数回、定期的に定期的に競技に参加し、常にトレーニングを行っています。</font><font style="vertical-align: inherit;">したがって、データ内の多くの名前の場合、おそらく複数のレコードがあります。</font><font style="vertical-align: inherit;">国に関する情報を復元するには、国が示されているレコードの中から同じ名前のレコードを見つけてください。</font></font><br>
<br>
<pre><code class="python hljs">arwc = ar[ar[<span class="hljs-string">'country'</span>] != <span class="hljs-string">''</span>] <span class="hljs-comment">#arwc – all records with country</span>
nwc = arwc[<span class="hljs-string">'name'</span>].unique() <span class="hljs-comment">#nwc – names with country</span>
tofix = set(nnc).intersection(nwc)</code></pre><br>
<code><b>Out:</b> ['Kleber-Schad Ute Cathrin', 'Sellner Peter', 'Pfeiffer Christian', 'Scholl Thomas', 'Petersohn Sandra', 'Marchand Kurt', 'Janneck Britta', 'Angheben Riccardo', 'Thiele Yvonne', 'Kie?Wetter Martin', 'Schymik Gerhard', 'Clark Donald', 'Berod Brigitte', 'Theile Markus', 'Giuliattini Burbui Margherita', 'Wehrum Alexander', 'Kenny Oisin', 'Schwieger Peter', 'Grosse Bianca', 'Schafter Carsten', 'Breck Dirk', 'Mautes Christoph', 'Herrmann Andreas', 'Gilbert Kai', 'Steger Peter', 'Jirouskova Jana', 'Jehrke Michael', 'Valentine David', 'Reis Michael', 'Wanka Michael', 'Schomburg Jonas', 'Giehl Caprice', 'Zinser Carsten', 'Schumann Marcus', 'Magoni Livio', 'Lauden Yann', 'Mayer Dieter', 'Krisa Stefan', 'Haberecht Bernd', 'Schneider Achim', 'Gibanel Curto Antonio', 'Miranda Antonio', 'Juarez Pedro', 'Prelle Gerrit', 'Wuste Kay', 'Bullock Graeme', 'Hahner Martin', 'Kahl Maik', 'Schubnell Frank', 'Hastenteufel Marco', …]<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのうち2,236個、つまりほぼ4分の3でした。</font><font style="vertical-align: inherit;">ここで、このリストの名前ごとに、それが存在するレコードによって国を決定する必要があります。</font><font style="vertical-align: inherit;">しかし、同じ名前が複数のレコードや異なる国で見つかることがあります。</font><font style="vertical-align: inherit;">これは、同名の人、または引っ越した人のどちらかです。</font><font style="vertical-align: inherit;">したがって、最初にすべてが一意であるものを処理します。</font></font><br>
<br>
<pre><code class="python hljs">fix = {}<font></font>
<font></font>
<span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> tofix:<font></font>
    nr = arwc[arwc[<span class="hljs-string">'name'</span>] == n] <font></font>
	<font></font>
    <span class="hljs-keyword">if</span> len(nr[<span class="hljs-string">'country'</span>].unique()) == <span class="hljs-number">1</span>:<font></font>
        fix[n] = nr[<span class="hljs-string">'country'</span>].iloc[<span class="hljs-number">0</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ループで作られています。</font><font style="vertical-align: inherit;">しかし、率直に言って、それは長い間（約3分間）うまくいきます。</font><font style="vertical-align: inherit;">1桁以上のエントリがある場合は、おそらくベクトルの実装を考え出す必要があります。</font><font style="vertical-align: inherit;">2,013のエントリ、つまりポテンシャルの90％がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さまざまな国のさまざまなレコードに表示される名前は、最も頻繁に出現する国を使用します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> n <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> fix:<font></font>
    nr = arwc[arwc[<span class="hljs-string">'name'</span>] == n]<font></font>
    vc = nr[<span class="hljs-string">'country'</span>].value_counts()    <font></font>
	<font></font>
    <span class="hljs-keyword">if</span> vc[<span class="hljs-number">0</span>] &gt; vc[<span class="hljs-number">1</span>]:<font></font>
        fix[n] = vc.index[<span class="hljs-number">0</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、2,208の名前、またはすべての潜在的な名前の99％で一致が見つかりました。</font><font style="vertical-align: inherit;">
以下の対応を適用します。</font></font><br>
<code>{'Kleber-Schad Ute Cathrin': 'DEU', 'Sellner Peter': 'AUT', 'Pfeiffer Christian': 'AUT', 'Scholl Thomas': 'DEU', 'Petersohn Sandra': 'DEU', 'Marchand Kurt': 'BEL', 'Janneck Britta': 'DEU', 'Angheben Riccardo': 'ITA', 'Thiele Yvonne': 'DEU', 'Kie?Wetter Martin': 'DEU', 'Clark Donald': 'GBR', 'Berod Brigitte': 'FRA', 'Theile Markus': 'DEU', 'Giuliattini Burbui Margherita': 'ITA', 'Wehrum Alexander': 'DEU', 'Kenny Oisin': 'IRL', 'Schwieger Peter': 'DEU', 'Schafter Carsten': 'DEU', 'Breck Dirk': 'DEU', 'Mautes Christoph': 'DEU', 'Herrmann Andreas': 'DEU', 'Gilbert Kai': 'DEU', 'Steger Peter': 'AUT', 'Jirouskova Jana': 'CZE', 'Jehrke Michael': 'DEU', 'Wanka Michael': 'DEU', 'Giehl Caprice': 'DEU', 'Zinser Carsten': 'DEU', 'Schumann Marcus': 'DEU', 'Magoni Livio': 'ITA', 'Lauden Yann': 'FRA', 'Mayer Dieter': 'DEU', 'Krisa Stefan': 'DEU', 'Haberecht Bernd': 'DEU', 'Schneider Achim': 'DEU', 'Gibanel Curto Antonio': 'ESP', 'Juarez Pedro': 'ESP', 'Prelle Gerrit': 'DEU', 'Wuste Kay': 'DEU', 'Bullock Graeme': 'GBR', 'Hahner Martin': 'DEU', 'Kahl Maik': 'DEU', 'Schubnell Frank': 'DEU', 'Hastenteufel Marco': 'DEU', 'Tedde Roberto': 'ITA', 'Minervini Domenico': 'ITA', 'Respondek Markus': 'DEU', 'Kramer Arne': 'DEU', 'Schreck Alex': 'DEU', 'Bichler Matthias': 'DEU', …}<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> fix:<font></font>
    ind = arnc[arnc[<span class="hljs-string">'name'</span>] == n].index<font></font>
    ar.loc[ind, <span class="hljs-string">'country'</span>] = fix[n]</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>event</th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th><u>country</u></th>
<th>group</th>
<th>...</th>
<th>country raw</th>
</tr>
<tr>
<td>...</td>
<td>1633</td>
<td>M</td>
<td>Guerrero Pla Angel</td>
<td><u>ESP</u></td>
<td>M30-34</td>
<td>...</td>
<td>E</td>
</tr>
<tr>
<td>...</td>
<td>258</td>
<td>M</td>
<td>Bellm Mathias</td>
<td><u>DEU</u></td>
<td>M35-39</td>
<td>...</td>
<td>D</td>
</tr>
<tr>
<td>...</td>
<td>655</td>
<td>M</td>
<td>Moratto Alessio</td>
<td><u>ITA</u></td>
<td>M40-44</td>
<td>...</td>
<td>I</td>
</tr>
<tr>
<td>...</td>
<td>1317</td>
<td>M</td>
<td>Solari Jean-Jacques</td>
<td><u>PYF</u></td>
<td>M50-54</td>
<td>...</td>
<td>TAH</td>
</tr>
<tr>
<td>...</td>
<td>1311</td>
<td>F</td>
<td>Duranel Isabelle</td>
<td><u>FRA</u></td>
<td>F40-44</td>
<td>...</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>1012</td>
<td>M</td>
<td>Endler Maximilian</td>
<td><u>DEU</u></td>
<td>M40-44</td>
<td>...</td>
<td>D</td>
</tr>
<tr>
<td>...</td>
<td>284</td>
<td>M</td>
<td>Schreiner Jorg</td>
<td><u>DEU</u></td>
<td>M40-44</td>
<td>...</td>
<td>D</td>
</tr>
<tr>
<td>...</td>
<td>14</td>
<td>M</td>
<td>Butturini Jacopo</td>
<td><u>HRV</u></td>
<td></td>
<td>...</td>
<td>ITU</td>
</tr>
<tr>
<td>...</td>
<td>204</td>
<td>M</td>
<td>Lindner Thomas</td>
<td><u>DEU</u></td>
<td>M40-44</td>
<td>...</td>
<td>D</td>
</tr>
<tr>
<td>...</td>
<td>1168</td>
<td>M</td>
<td>Gramke Peter</td>
<td><u>DEU</u></td>
<td>M45-49</td>
<td>...</td>
<td>D</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修正後、国のないレコードの数は909、つまり3倍以上に減少しました。</font><font style="vertical-align: inherit;">150万人を背景にして、総数2,208人はそれほど多くありませんが、それでも素晴らしいです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、通常どおり、結合されたデータフレーム</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arを</font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">辞書に変換して</font><font style="vertical-align: inherit;">保存します。</font></font><br>
<br>
<pre><code class="python hljs">pkl.dump(rd, open(<span class="hljs-string">r'D:\tri\details7.pkl'</span>, <span class="hljs-string">'wb'</span>))
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">床</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
国の場合と同様に、参加者の性別が記載されていない記録があります。 </font></font><br>
<br>
<pre><code class="python hljs">ar[ar[<span class="hljs-string">'sex'</span>] == <span class="hljs-string">''</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのうちの2,538個ですが、比較的少ないですが、再び少なくするように努めます。</font><font style="vertical-align: inherit;">元の値を新しい列に保存します。</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'sex raw'</span>] =ar[<span class="hljs-string">'sex'</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
他のプロトコルから名前で情報を取得した国とは異なり、ここではすべてが少し複雑です。</font><font style="vertical-align: inherit;">実際のところ、データはエラーでいっぱいで、両方の性別のマークが付いた多くの名前（合計2 101）が見つかります。</font></font><br>
<br>
<pre><code class="python hljs">arws = ar[(ar[<span class="hljs-string">'sex'</span>] != <span class="hljs-string">''</span>)&amp;(ar[<span class="hljs-string">'name'</span>] != <span class="hljs-string">''</span>)] <span class="hljs-comment">#arws – all records with sex</span>
snds = arws[arws.duplicated(subset=<span class="hljs-string">'name'</span>,keep=<span class="hljs-literal">False</span>)]<span class="hljs-comment">#snds–single name different sex</span>
snds = snds.drop_duplicates(subset=[<span class="hljs-string">'name'</span>,<span class="hljs-string">'sex'</span>], keep = <span class="hljs-string">'first'</span>)<font></font>
snds = snds.sort_values(by=<span class="hljs-string">'name'</span>)<font></font>
snds = snds[snds.duplicated(subset = <span class="hljs-string">'name'</span>, keep=<span class="hljs-literal">False</span>)]<font></font>
<font></font>
snds</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>event</th>
<th>place</th>
<th><u>sex</u></th>
<th><u>name</u></th>
<th>country</th>
<th><u>group</u></th>
<th>...</th>
<th>country raw</th>
<th>group raw</th>
<th>sex raw</th>
</tr>
<tr>
<td>...</td>
<td>428</td>
<td><u>F</u></td>
<td><u>Aagaard Ida</u></td>
<td>NOR</td>
<td><u>F40-44</u></td>
<td>...</td>
<td>NOR</td>
<td>F40-44</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>718</td>
<td><u>M</u></td>
<td><u>Aagaard Ida</u></td>
<td>NOR</td>
<td><u>M40-44</u></td>
<td>...</td>
<td>NOR</td>
<td>M40-44</td>
<td>M</td>
</tr>
<tr>
<td></td>
<td>740</td>
<td><u>M</u></td>
<td><u>Aarekol Tove Aase</u></td>
<td>NOR</td>
<td><u>M50-54</u></td>
<td>...</td>
<td>NOR</td>
<td>M50-54</td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>520</td>
<td><u>F</u></td>
<td><u>Aarekol Tove Aase</u></td>
<td>NOR</td>
<td><u>F50-54</u></td>
<td>...</td>
<td>NOR</td>
<td>F50-54</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>665</td>
<td><u>F</u></td>
<td><u>Aaroy Torunn</u></td>
<td>NOR</td>
<td><u>F40-44</u></td>
<td>...</td>
<td>NOR</td>
<td>F40-44</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>1591</td>
<td><u>M</u></td>
<td><u>Aaroy Torunn</u></td>
<td>NOR</td>
<td><u>M40-44</u></td>
<td>...</td>
<td>NOR</td>
<td>M40-44</td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>70</td>
<td><u>M</u></td>
<td><u>Aberg Cobo Dolores</u></td>
<td>ARG</td>
<td><u>FPRO</u></td>
<td>...</td>
<td>ARG</td>
<td>FPRO</td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>1258</td>
<td><u>F</u></td>
<td><u>Aberg Cobo Dolores</u></td>
<td>ARG</td>
<td><u>F30-34</u></td>
<td>...</td>
<td>ARG</td>
<td>F30-34</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>1909</td>
<td><u>F</u></td>
<td><u>Aboulfaida Zineb</u></td>
<td>MAR</td>
<td><u>F35-39</u></td>
<td>...</td>
<td>MAR</td>
<td>F35-39</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>340</td>
<td><u>M</u></td>
<td><u>Aboulfaida Zineb</u></td>
<td>MAR</td>
<td><u>M35-39</u></td>
<td>...</td>
<td>MAR</td>
<td>M35-39</td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>63</td>
<td><u>F</u></td>
<td><u>Abram Felicity</u></td>
<td>AUS</td>
<td><u>FPRO</u></td>
<td>...</td>
<td>AUS</td>
<td>FPRO</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>38</td>
<td><u>M</u></td>
<td><u>Abram Felicity</u></td>
<td>AUS</td>
<td><u>FJUNIOR</u></td>
<td>...</td>
<td>AUS</td>
<td>FJUNIOR</td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>134</td>
<td><u>M</u></td>
<td><u>Abramowski Jannicke</u></td>
<td>DEU</td>
<td><u>FPRO</u></td>
<td>...</td>
<td>GER</td>
<td>FPRO</td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>323</td>
<td><u>F</u></td>
<td><u>Abramowski Jannicke</u></td>
<td>DEU</td>
<td><u>F25-29</u></td>
<td>...</td>
<td>GER</td>
<td>F25-29</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>21</td>
<td><u>M</u></td>
<td><u>Abrosimova Anastasia</u></td>
<td>RUS</td>
<td><u>FPRO</u></td>
<td>...</td>
<td>RUS</td>
<td>FPRO</td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>177</td>
<td><u>F</u></td>
<td><u>Abrosimova Anastasia</u></td>
<td>RUS</td>
<td><u>FPRO</u></td>
<td>...</td>
<td>RUS</td>
<td>FPRO</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>188</td>
<td><u>M</u></td>
<td><u>Abysova Irina</u></td>
<td>RUS</td>
<td><u>FPRO</u></td>
<td>...</td>
<td>RUS</td>
<td>FPRO</td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>60</td>
<td><u>F</u></td>
<td><u>Abysova Irina</u></td>
<td>RUS</td>
<td><u>FPRO</u></td>
<td>...</td>
<td>RUS</td>
<td>FPRO</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>312</td>
<td><u>M</u></td>
<td><u>Acaron Fabiola</u></td>
<td>PRI</td>
<td><u>FJUNIOR</u></td>
<td>...</td>
<td>PUR</td>
<td>FJUNIOR</td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>294</td>
<td><u>F</u></td>
<td><u>Acaron Fabiola</u></td>
<td>PRI</td>
<td><u>F45-49</u></td>
<td>...</td>
<td>PUR</td>
<td>F45-49</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>1500</td>
<td><u>M</u></td>
<td><u>Achampong Benjamin</u></td>
<td>GBR</td>
<td><u>M35-39</u></td>
<td>...</td>
<td>GBR</td>
<td>M35-39</td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>749</td>
<td><u>F</u></td>
<td><u>Achampong Benjamin</u></td>
<td>GBR</td>
<td><u>M35-39</u></td>
<td>...</td>
<td>GBR</td>
<td>M35-39</td>
<td>F</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はい、原則として、ユニセックス（または両性具有）の名前、つまり男の子と女の子の両方に名前を付けるために使用される名前があります。そして、アジアのアスリートにとって、名前で性別を特定することは一般に困難です-たぶん私は十分な知識を持っていません。しかし、イリーナまたはアナスタシアの名前が男性に属しているとは信じられず、ベンジャミンは女性と呼ばれていました。これに加えて、ある時点で、すべての参加者が1つの性別でマークされるプロトコルが多数あることがわかりました。</font></font><br>
<br>
<pre><code class="python hljs">rss = [rd[e] <span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> rd <span class="hljs-keyword">if</span> len(rd[e][rd[e][<span class="hljs-string">'sex'</span>] != <span class="hljs-string">''</span>][<span class="hljs-string">'sex'</span>].unique()) == <span class="hljs-number">1</span>] <span class="hljs-comment">#rss – races with single sex</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
633ありますが、これはかなり可能であるように思われます。しかし、実際には、これらのプロトコルのほとんどすべてに両性の年齢グループが含まれています（男性の年齢グループは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">始まり</font><font style="vertical-align: inherit;">、女性</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-Fで</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">始まります</font><font style="vertical-align: inherit;">）。例：</font><font style="vertical-align: inherit;">年齢層の名前は、</font><font style="vertical-align: inherit;">男性の場合は</font><i><font style="vertical-align: inherit;">M</font></i><font style="vertical-align: inherit;">、女性の場合は</font><i><font style="vertical-align: inherit;">F</font></i><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">始まると想定されてい</font><font style="vertical-align: inherit;">ます。前の2つの例では、</font><i><font style="vertical-align: inherit;">性別</font></i><font style="vertical-align: inherit;">列のエラーにもかかわらず</font></font><br>
<br>
<code>'ITU World Cup Tiszaujvaros Olympic 2002'<br>
<div class="scrollable-table"><table>
<tbody><tr>
<th>place</th>
<th><u>sex</u></th>
<th>name</th>
<th>country</th>
<th>group</th>
<th>...</th>
<th>country raw</th>
<th><u>group raw</u></th>
<th>name raw</th>
</tr>
<tr>
<td>76</td>
<td><u>M</u></td>
<td>Dederko Ewa</td>
<td>POL</td>
<td>FPRO</td>
<td>...</td>
<td>POL</td>
<td><u>FPRO</u></td>
<td>Dederko Ewa</td>
</tr>
<tr>
<td>84</td>
<td><u>M</u></td>
<td>Chenevier Giunia</td>
<td>ITA</td>
<td>FPRO</td>
<td>...</td>
<td>ITA</td>
<td><u>FPRO</u></td>
<td>Chenevier Giunia</td>
</tr>
<tr>
<td>36</td>
<td><u>M</u></td>
<td>O'Grady Graham</td>
<td>NZL</td>
<td>MPRO</td>
<td>...</td>
<td>NZL</td>
<td><u>MPRO</u></td>
<td>O'Grady Graham</td>
</tr>
<tr>
<td>23</td>
<td><u>M</u></td>
<td>Danek Michal</td>
<td>CZE</td>
<td>MPRO</td>
<td>...</td>
<td>CZE</td>
<td><u>MPRO</u></td>
<td>Danek Michal</td>
</tr>
<tr>
<td>74</td>
<td><u>M</u></td>
<td>Peon Carole</td>
<td>FRA</td>
<td>FPRO</td>
<td>...</td>
<td>FRA</td>
<td><u>FPRO</u></td>
<td>Peon Carole</td>
</tr>
<tr>
<td>48</td>
<td><u>M</u></td>
<td>Hechenblaickner Daniel</td>
<td>AUT</td>
<td>MPRO</td>
<td>...</td>
<td>AUT</td>
<td><u>MPRO</u></td>
<td>Hechenblaickner Daniel</td>
</tr>
<tr>
<td>70</td>
<td><u>M</u></td>
<td>Blatchford Liz</td>
<td>GBR</td>
<td>FPRO</td>
<td>...</td>
<td>GBR</td>
<td><u>FPRO</u></td>
<td>Blatchford Liz</td>
</tr>
<tr>
<td>1</td>
<td><u>M</u></td>
<td>Walton Craig</td>
<td>AUS</td>
<td>MPRO</td>
<td>...</td>
<td>AUS</td>
<td><u>MPRO</u></td>
<td>Walton Craig</td>
</tr>
<tr>
<td>20</td>
<td><u>M</u></td>
<td>Hobor Peter</td>
<td>HUN</td>
<td>MPRO</td>
<td>...</td>
<td>HUN</td>
<td><u>MPRO</u></td>
<td>Hobor Peter</td>
</tr>
<tr>
<td>56</td>
<td><u>M</u></td>
<td>Kaldau Szabolcs</td>
<td>HUN</td>
<td>MPRO</td>
<td>...</td>
<td>HUN</td>
<td><u>MPRO</u></td>
<td>Kaldau Szabolcs</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、グループの名前はまだメンバーの性別を正しく説明しているように見えました。</font><font style="vertical-align: inherit;">いくつかのサンプル例に基づいて、グループが正しく示され、性別が誤って示される可能性があると仮定します。</font><font style="vertical-align: inherit;">グループ名の最初の文字が性別と一致しないすべてのエントリを検索します。</font><font style="vertical-align: inherit;">標準化中に多くのレコードがグループなしで残されたので</font><font style="vertical-align: inherit;">、グループ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グループraw</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の最初の名前を使用し</font><font style="vertical-align: inherit;">ますが、今は最初の文字だけが必要なので、標準は重要ではありません。</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'grflc'</span>] = ar[<span class="hljs-string">'group raw'</span>].str.upper().str[<span class="hljs-number">0</span>] <span class="hljs-comment">#grflc – group raw first letter capital</span>
grncs = ar[(ar[<span class="hljs-string">'grflc'</span>].isin([<span class="hljs-string">'M'</span>,<span class="hljs-string">'F'</span>]))&amp;(ar[<span class="hljs-string">'sex'</span>]!=ar[<span class="hljs-string">'grflc'</span>])] <span class="hljs-comment">#grncs – group raw not consistent with sex</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのような記録は26 161個あります。</font><font style="vertical-align: inherit;">さて、年齢層の名前に従って性別を修正しましょう：</font></font><br>
<br>
<pre><code class="python hljs">ar.loc[grncs.index, <span class="hljs-string">'sex'</span>] = grncs[<span class="hljs-string">'grflc'</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果を見てみましょう</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">性別なしで残っている記録はいくつありますか？</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>event</th>
<th>place</th>
<th><u>sex</u></th>
<th>name</th>
<th>country</th>
<th>group</th>
<th>...</th>
<th>country raw</th>
<th><u>group raw</u></th>
<th><u>sex raw</u></th>
<th>grflc</th>
</tr>
<tr>
<td>...</td>
<td>59</td>
<td><u>F</u></td>
<td>Ueda Ai</td>
<td>JPN</td>
<td>FPRO</td>
<td>...</td>
<td>JPN</td>
<td><u>FPRO</u></td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>50</td>
<td><u>F</u></td>
<td>Zemanova Lenka</td>
<td>CZE</td>
<td>FPRO</td>
<td>...</td>
<td>CZE</td>
<td><u>FPRO</u></td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>83</td>
<td><u>F</u></td>
<td>Spearing Kyleigh</td>
<td>USA</td>
<td>FPRO</td>
<td>...</td>
<td>USA</td>
<td><u>FPRO</u></td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>63</td>
<td><u>F</u></td>
<td>Abysova Irina</td>
<td>RUS</td>
<td>FPRO</td>
<td>...</td>
<td>RUS</td>
<td><u>FPRO</u></td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>57</td>
<td><u>F</u></td>
<td>Knapp Anja</td>
<td>DEU</td>
<td>FPRO</td>
<td>...</td>
<td>GER</td>
<td><u>FPRO</u></td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>68</td>
<td><u>M</u></td>
<td>Matthews Andrew</td>
<td>GBR</td>
<td>M30-34</td>
<td>...</td>
<td>GBR</td>
<td><u>M30-34</u></td>
<td><u>F</u></td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>46</td>
<td><u>F</u></td>
<td>Rappaport Summer</td>
<td>USA</td>
<td>FPRO</td>
<td>...</td>
<td>USA</td>
<td><u>FPRO</u></td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>60</td>
<td><u>F</u></td>
<td>Reid Aileen</td>
<td>IRL</td>
<td>FPRO</td>
<td>...</td>
<td>IRL</td>
<td><u>FPRO</u></td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>142</td>
<td><u>F</u></td>
<td>Mcdowall Edwina</td>
<td>GBR</td>
<td>F45-49</td>
<td>...</td>
<td>GBR</td>
<td><u>F45-49</u></td>
<td></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>141</td>
<td><u>M</u></td>
<td>O'Bray Luke</td>
<td>GBR</td>
<td>M30-34</td>
<td>...</td>
<td>GBR</td>
<td><u>M30-34</u></td>
<td></td>
<td>M</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">ar[(ar[<span class="hljs-string">'sex'</span>] == <span class="hljs-string">''</span>)&amp;(ar[<span class="hljs-string">'name'</span>] != <span class="hljs-string">''</span>)]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まさに1つです。</font><font style="vertical-align: inherit;">
まあ、グループは実際には示されていませんが、明らかに、これは女性です。エミリーは女性の名前であり、この参加者（または彼女の同名）は1年前に終了し、そのプロトコルでは性別とグループが示されています。</font><font style="vertical-align: inherit;">
ここで手動で復元して*先に進みます。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>event</th>
<th>place</th>
<th><u>sex</u></th>
<th>name</th>
<th>country</th>
<th>group</th>
<th>...</th>
<th>country raw</th>
<th><u>group raw</u></th>
<th><u>sex raw</u></th>
<th>grflc</th>
</tr>
<tr>
<td>London Triathlon Olympic 2019</td>
<td>672</td>
<td></td>
<td>Stather Emily</td>
<td>GBR</td>
<td></td>
<td>...</td>
<td>GBR</td>
<td><u>unknown</u></td>
<td></td>
<td>U</td>
</tr>
</tbody></table></div></code><br><font style="vertical-align: inherit;"></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>event</th>
<th>place</th>
<th><u>sex</u></th>
<th>name</th>
<th>country</th>
<th><u>group</u></th>
<th>...</th>
<th>country raw</th>
<th>group raw</th>
<th><u>sex raw</u></th>
<th>grflc</th>
</tr>
<tr>
<td>Ironman Staffordshire 70.3 2018</td>
<td>1859</td>
<td><u>F</u></td>
<td>Stather Emily</td>
<td>GBR</td>
<td><u>F40-44</u></td>
<td>...</td>
<td>GBR</td>
<td>F40-44</td>
<td><u>F</u></td>
<td>F</td>
</tr>
</tbody></table></div></code><br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">ar.loc[arns.index, <span class="hljs-string">'sex'</span>] = <span class="hljs-string">'F'</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、すべてのレコードが性別で記録されました。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*一般的に、これはもちろん間違っています-繰り返し実行で、名前変換などの前にチェーン内の何かが変更されると、性別のない複数のレコードが存在する可能性があり、すべてが女性であるとは限らず、エラーが発生します。したがって、国を復元し、なんらかの方法でテストするなど、他のプロトコルで同じ名前と性別の参加者を検索するための重いロジックを挿入するか、不必要に複雑にならないように、このロジックにレコードが1つしか見つからないことを確認するチェックを追加する必要があります。そして名前はそのようであり、そうでなければラップトップ全体を停止する例外をスローします、あなたは計画からの逸脱に気づいて介入することができます。</font></font></i><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> len(arns) == <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> arns[<span class="hljs-string">'name'</span>].iloc[<span class="hljs-number">0</span>] == <span class="hljs-string">'Stather Emily'</span>:<font></font>
    ar.loc[arns.index, <span class="hljs-string">'sex'</span>] = <span class="hljs-string">'F'</span>
<span class="hljs-keyword">else</span>:
    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">'Different scenario!'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは落ち着くことができるようです。</font><font style="vertical-align: inherit;">しかし、実際には、修正はグループが正しく示されているという前提に基づいています。</font><font style="vertical-align: inherit;">そして確かにそうです。</font><font style="vertical-align: inherit;">ほとんどいつも。</font><font style="vertical-align: inherit;">ほぼ。</font><font style="vertical-align: inherit;">それでも、いくつかの不整合が誤って認識されたので、次に、それらすべてを、適切に、または可能な限り特定してみましょう。</font><font style="vertical-align: inherit;">すでに述べたように、最初の例では、男性と女性の名前についての独自の考えに基づいて、性別が名前に対応していないというのがまさに事実でした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
男性と女性のレコードですべての名前を検索します。</font><font style="vertical-align: inherit;">ここでは、名前は完全な名前ではなく名前として理解されます。つまり、姓がない場合、英語で</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれ</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'fn'</span>] = ar[<span class="hljs-string">'name'</span>].str.split().str[<span class="hljs-number">-1</span>] <span class="hljs-comment">#fn – first name</span>
mfn = list(ar[ar[<span class="hljs-string">'sex'</span>] == <span class="hljs-string">'M'</span>][<span class="hljs-string">'fn'</span>].unique()) <span class="hljs-comment">#mfn – male first names</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
合計32,508人の男性の名前がリストされています。</font><font style="vertical-align: inherit;">最も人気のある50は次のとおりです。</font></font><br>
<code>['Michael', 'David', 'Thomas', 'John', 'Daniel', 'Mark', 'Peter', 'Paul', 'Christian', 'Robert', 'Martin', 'James', 'Andrew', 'Chris', 'Richard', 'Andreas', 'Matthew', 'Brian', 'Kevin', 'Patrick', 'Scott', 'Stefan', 'Jason', 'Eric', 'Alexander', 'Christopher', 'Simon', 'Mike', 'Tim', 'Frank', 'Stephen', 'Steve', 'Jonathan', 'Marco', 'Markus', 'Adam', 'Ryan', 'Tom', 'Jan', 'Marc', 'Carlos', 'Matt', 'Steven', 'Jeff', 'Sergey', 'William', 'Aleksandr', 'Andrey', 'Benjamin', 'Jose']<br>
</code><br>
<br>
<pre><code class="python hljs">ffn = list(ar[ar[<span class="hljs-string">'sex'</span>] == <span class="hljs-string">'F'</span>][<span class="hljs-string">'fn'</span>].unique()) <span class="hljs-comment">#ffn – female first names</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
女性が少ない-14 423.最も人気がある：</font><font style="vertical-align: inherit;">
良い、それは論理的に見えるようです。</font><font style="vertical-align: inherit;">交差点があるかどうか見てみましょう。</font></font><br>
<code>['Jennifer', 'Sarah', 'Laura', 'Lisa', 'Anna', 'Michelle', 'Maria', 'Andrea', 'Nicole', 'Jessica', 'Julie', 'Elizabeth', 'Stephanie', 'Karen', 'Christine', 'Amy', 'Rebecca', 'Susan', 'Rachel', 'Anne', 'Heather', 'Kelly', 'Barbara', 'Claudia', 'Amanda', 'Sandra', 'Julia', 'Lauren', 'Melissa', 'Emma', 'Sara', 'Katie', 'Melanie', 'Kim', 'Caroline', 'Erin', 'Kate', 'Linda', 'Mary', 'Alexandra', 'Christina', 'Emily', 'Angela', 'Catherine', 'Claire', 'Elena', 'Patricia', 'Charlotte', 'Megan', 'Daniela']<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">mffn = set(mfn).intersection(ffn) <span class="hljs-comment">#mffn – male-female first names</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有る。</font><font style="vertical-align: inherit;">そして、2,811あります。もっと詳しく見てみましょう。</font><font style="vertical-align: inherit;">まず、これらの名前を持つレコードの数を調べます。</font></font><br>
<br>
<pre><code class="python hljs">armfn = ar[ar[<span class="hljs-string">'fn'</span>].isin(mffn)] <span class="hljs-comment">#armfn – all records with male-female names</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
725 562あります。半分です！</font><font style="vertical-align: inherit;">すごい！</font><font style="vertical-align: inherit;">一意の名前は37,000近くありますが、レコードの半分には合計2,800があります。これらの名前が何であるかを見てみましょう。これらは最も人気があります。</font><font style="vertical-align: inherit;">これを行うには、これらの名前がインデックスになる新しいデータフレームを作成します。</font></font><br>
<br>
<pre><code class="python hljs">df = pd.DataFrame(armfn[<span class="hljs-string">'fn'</span>].value_counts())<font></font>
df = df.rename(columns={<span class="hljs-string">'fn'</span>:<span class="hljs-string">'total'</span>})
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それぞれについて、男性と女性のレコード数を計算します。</font></font><br>
<br>
<pre><code class="python hljs">df[<span class="hljs-string">'M'</span>] = armfn[armfn[<span class="hljs-string">'sex'</span>] == <span class="hljs-string">'M'</span>][<span class="hljs-string">'fn'</span>].value_counts()<font></font>
df[<span class="hljs-string">'F'</span>] = armfn[armfn[<span class="hljs-string">'sex'</span>] == <span class="hljs-string">'F'</span>][<span class="hljs-string">'fn'</span>].value_counts()
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>total</th>
<th>M</th>
<th>F</th>
</tr>
<tr>
<td>Michael</td>
<td>20648</td>
<td>20638</td>
<td>10</td>
</tr>
<tr>
<td>David</td>
<td>18493</td>
<td>18485</td>
<td>8</td>
</tr>
<tr>
<td>Thomas</td>
<td>12746</td>
<td>12740</td>
<td>6</td>
</tr>
<tr>
<td>John</td>
<td>11634</td>
<td>11632</td>
<td>2</td>
</tr>
<tr>
<td>Daniel</td>
<td>11045</td>
<td>11041</td>
<td>4</td>
</tr>
<tr>
<td>Mark</td>
<td>10968</td>
<td>10965</td>
<td>3</td>
</tr>
<tr>
<td>Peter</td>
<td>10692</td>
<td>10691</td>
<td>1</td>
</tr>
<tr>
<td>Paul</td>
<td>9616</td>
<td>9614</td>
<td>2</td>
</tr>
<tr>
<td>Christian</td>
<td>8863</td>
<td>8859</td>
<td>4</td>
</tr>
<tr>
<td>Robert</td>
<td>8666</td>
<td>8664</td>
<td>2</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">だから...それは疑わしいようです。</font><font style="vertical-align: inherit;">私の知る限り、これらの名前はすべて男性的です。</font><font style="vertical-align: inherit;">しかし、それらのそれぞれにいくつかの少量の女性の記録があります。</font><font style="vertical-align: inherit;">これらはおそらくデータエラーです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
女性の名前を見てみましょう。</font></font><br>
<br>
<pre><code class="python hljs">df.sort_values(by = <span class="hljs-string">'F'</span>, ascending=<span class="hljs-literal">False</span>)
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>total</th>
<th>M</th>
<th>F</th>
</tr>
<tr>
<td>Jennifer</td>
<td>3652</td>
<td>3</td>
<td>3649</td>
</tr>
<tr>
<td>Sarah</td>
<td>3288</td>
<td>4</td>
<td>3284</td>
</tr>
<tr>
<td>Laura</td>
<td>2636</td>
<td>3</td>
<td>2633</td>
</tr>
<tr>
<td>Lisa</td>
<td>2618</td>
<td>2</td>
<td>2616</td>
</tr>
<tr>
<td>Anna</td>
<td>2563</td>
<td>10</td>
<td>2553</td>
</tr>
<tr>
<td>Michelle</td>
<td>2373</td>
<td>1</td>
<td>2372</td>
</tr>
<tr>
<td>Maria</td>
<td>2555</td>
<td>386</td>
<td>2169</td>
</tr>
<tr>
<td>Andrea</td>
<td>4323</td>
<td>2235</td>
<td>2088</td>
</tr>
<tr>
<td>Nicole</td>
<td>2025</td>
<td>6</td>
<td>2019</td>
</tr>
<tr>
<td>Julie</td>
<td>1938</td>
<td>2</td>
<td>1936</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同じ。ほぼ。目立つ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アンドレア</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">少し未満確かに両性具有の名前で、そして</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マリア</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、何らかの理由を。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、世界中のさまざまな国の人々のデータを調査していることを忘れないでください。異なる文化では、同じ名前をまったく異なる方法で使用できます。ここに例があります。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カレン</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は私たちのリストで最も人気のある女性の名前の1つですが、一方で</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カレン</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">という名前があり</font><font style="vertical-align: inherit;">、同じ方法で翻訳されますが、男性専用です。幸いなことに、このすべての世界の知恵が保持するパッケージがあります。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性別推定器</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれてい</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それはこのように動作します：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> gender_guesser.detector <span class="hljs-keyword">as</span> gg<font></font>
<font></font>
d = gg.Detector()<font></font>
d.get_gender(<span class="hljs-string">u'Oleg'</span>)</code></pre><br>
<code><b>Out:</b> 'male'<br>
</code><br>
<br>
<pre><code class="python hljs">d.get_gender(<span class="hljs-string">u'Evgeniya'</span>)
</code></pre><br>
<code><b>Out:</b> 'female'<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべて大丈夫です。</font><font style="vertical-align: inherit;">しかし、あなたが</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アンドレア</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の名前をチェックする</font><font style="vertical-align: inherit;">と、彼はまた</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">女性</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を与えます</font><font style="vertical-align: inherit;">、それは完全に真実ではありません。</font><font style="vertical-align: inherit;">確かに、道はあります。</font><font style="vertical-align: inherit;">検出器の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名前</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティを見ると、</font><font style="vertical-align: inherit;">すべてのあいまいさがそこに見えます。</font></font><br>
<br>
<pre><code class="python hljs">d.names[<span class="hljs-string">'Andrea'</span>]
</code></pre><br>
<code><b>Out: </b>{'female': ' 4 4 3 4788 64 579 34 1 7 ',<br>
 'mostly_female': '5 6 7 ',<br>
 'male': ' 7 '}<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_gender</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は最も可能性の高いオプションを提供するだけですが、実際にはもっと複雑になる可能性があります。</font><font style="vertical-align: inherit;">他の名前を確認してください：</font></font><br>
<br>
<pre><code class="python hljs">d.names[<span class="hljs-string">'Maria'</span>]
</code></pre><br>
<code><b>Out:</b> {'female': '686 6 A 85986 A BA 3B98A75457 6 ',<br>
 'mostly_female': ' BBC A 678A9 '}<br>
</code><br>
<br>
<pre><code class="python hljs">d.names[<span class="hljs-string">'Oleg'</span>]
</code></pre><br>
<code><b>Out:</b> {'male': ' 6 2 99894737 3 '}<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり</font><font style="vertical-align: inherit;">、各名前</font><font style="vertical-align: inherit;">の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名前</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のリストは、</font><font style="vertical-align: inherit;">1つ以上のキーと値のペアに対応します。キー-性別：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">男性、女性、主に男性、大部分の女性</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、および</font><i><font style="vertical-align: inherit;">アンディ</font></i><font style="vertical-align: inherit;">、値-対応する国の値のリスト：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,2,3 ... .. 9ABC</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">国は次のとおりです。</font></font><br>
<br>
<pre><code class="python hljs">d.COUNTRIES</code></pre><br>
<code><b>Out:</b> ['great_britain', 'ireland', 'usa', 'italy', 'malta', 'portugal', 'spain', 'france', 'belgium', 'luxembourg', 'the_netherlands', 'east_frisia', 'germany', 'austria', 'swiss', 'iceland', 'denmark', 'norway', 'sweden', 'finland', 'estonia', 'latvia', 'lithuania', 'poland', 'czech_republic', 'slovakia', 'hungary', 'romania', 'bulgaria', 'bosniaand', 'croatia', 'kosovo', 'macedonia', 'montenegro', 'serbia', 'slovenia', 'albania', 'greece', 'russia', 'belarus', 'moldova', 'ukraine', 'armenia', 'azerbaijan', 'georgia', 'the_stans', 'turkey', 'arabia', 'israel', 'china', 'india', 'japan', 'korea', 'vietnam', 'other_countries']<br>
</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
英数字の意味やリストに含まれていないことの具体的な意味を完全には理解していませんでした。</font><font style="vertical-align: inherit;">しかし、明確な解釈ができる名前のみを使用するように制限することにしたため、これは重要ではありませんでした。</font><font style="vertical-align: inherit;">つまり、キーと値のペアが1つだけあり、キーは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">male</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">femaleの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いずれか</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">データフレームの名前ごとに、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性別推定の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解釈を記述し</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs">df[<span class="hljs-string">'sex from gg'</span>] = <span class="hljs-string">''</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> df.index:
    <span class="hljs-keyword">if</span> n <span class="hljs-keyword">in</span> list(d.names.keys()):<font></font>
        options = list(d.names[n].keys())<font></font>
        <span class="hljs-keyword">if</span> len(options) == <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> options[<span class="hljs-number">0</span>] == <span class="hljs-string">'male'</span>:<font></font>
            df.loc[n, <span class="hljs-string">'sex from gg'</span>] = <span class="hljs-string">'M'</span>
        <span class="hljs-keyword">if</span> len(options) == <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> options[<span class="hljs-number">0</span>] == <span class="hljs-string">'female'</span>:<font></font>
            df.loc[n, <span class="hljs-string">'sex from gg'</span>] = <span class="hljs-string">'F'</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1,150の名前が判明しました。</font><font style="vertical-align: inherit;">上記で既に説明した最も人気のあるものを以下に示します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このロジックをすべてのレコードに適用します。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>total</th>
<th>M</th>
<th>F</th>
<th>sex from gg</th>
</tr>
<tr>
<td>Michael</td>
<td>20648</td>
<td>20638</td>
<td>10</td>
<td>M</td>
</tr>
<tr>
<td>David</td>
<td>18493</td>
<td>18485</td>
<td>8</td>
<td>M</td>
</tr>
<tr>
<td>Thomas</td>
<td>12746</td>
<td>12740</td>
<td>6</td>
<td>M</td>
</tr>
<tr>
<td>John</td>
<td>11634</td>
<td>11632</td>
<td>2</td>
<td>M</td>
</tr>
<tr>
<td>Daniel</td>
<td>11045</td>
<td>11041</td>
<td>4</td>
<td>M</td>
</tr>
<tr>
<td>Mark</td>
<td>10968</td>
<td>10965</td>
<td>3</td>
<td>M</td>
</tr>
<tr>
<td>Peter</td>
<td>10692</td>
<td>10691</td>
<td>1</td>
<td>M</td>
</tr>
<tr>
<td>Paul</td>
<td>9616</td>
<td>9614</td>
<td>2</td>
<td>M</td>
</tr>
<tr>
<td>Christian</td>
<td>8863</td>
<td>8859</td>
<td>4</td>
<td></td>
</tr>
<tr>
<td>Robert</td>
<td>8666</td>
<td>8664</td>
<td>2</td>
<td>M</td>
</tr>
</tbody></table></div></code><br>
 <code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>total</th>
<th>M</th>
<th>F</th>
<th>sex from gg</th>
</tr>
<tr>
<td>Jennifer</td>
<td>3652</td>
<td>3</td>
<td>3649</td>
<td>F</td>
</tr>
<tr>
<td>Sarah</td>
<td>3288</td>
<td>4</td>
<td>3284</td>
<td>F</td>
</tr>
<tr>
<td>Laura</td>
<td>2636</td>
<td>3</td>
<td>2633</td>
<td>F</td>
</tr>
<tr>
<td>Lisa</td>
<td>2618</td>
<td>2</td>
<td>2616</td>
<td>F</td>
</tr>
<tr>
<td>Anna</td>
<td>2563</td>
<td>10</td>
<td>2553</td>
<td>F</td>
</tr>
<tr>
<td>Michelle</td>
<td>2373</td>
<td>1</td>
<td>2372</td>
<td>F</td>
</tr>
<tr>
<td>Maria</td>
<td>2555</td>
<td>386</td>
<td>2169</td>
<td></td>
</tr>
<tr>
<td>Andrea</td>
<td>4323</td>
<td>2235</td>
<td>2088</td>
<td></td>
</tr>
<tr>
<td>Nicole</td>
<td>2025</td>
<td>6</td>
<td>2019</td>
<td>F</td>
</tr>
<tr>
<td>Julie</td>
<td>1938</td>
<td>2</td>
<td>1936</td>
<td></td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">all_names = ar[<span class="hljs-string">'fn'</span>].unique()<font></font>
<font></font>
male_names = []<font></font>
female_names = []<font></font>
<font></font>
<span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> all_names:
    <span class="hljs-keyword">if</span> n <span class="hljs-keyword">in</span> list(d.names.keys()):<font></font>
        options = list(d.names[n].keys())<font></font>
        <span class="hljs-keyword">if</span> len(options) == <span class="hljs-number">1</span>:
            <span class="hljs-keyword">if</span> options[<span class="hljs-number">0</span>] == <span class="hljs-string">'male'</span>:<font></font>
                male_names.append(n)<font></font>
            <span class="hljs-keyword">if</span> options[<span class="hljs-number">0</span>] == <span class="hljs-string">'female'</span>:<font></font>
                female_names.append(n)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7 091人の男性の名前と5 054人の女性が見つかりました。</font><font style="vertical-align: inherit;">変換を適用します。</font></font><br>
<br>
<pre><code class="python hljs">tofixm = ar[ar[<span class="hljs-string">'fn'</span>].isin(male_names)]<font></font>
ar.loc[tofixm.index, <span class="hljs-string">'sex'</span>] = <span class="hljs-string">'M'</span>
tofixf = ar[ar[<span class="hljs-string">'fn'</span>].isin(female_names)]<font></font>
ar.loc[tofixf.index, <span class="hljs-string">'sex'</span>] = <span class="hljs-string">'F'</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果を見てみましょう：</font></font><br>
<br>
<pre><code class="python hljs">ar[ar[<span class="hljs-string">'sex'</span>]!=ar[<span class="hljs-string">'sex raw'</span>]]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
30,352エントリが修正されました（グループ名による修正と合わせて）。</font><font style="vertical-align: inherit;">いつものように、ランダムな10個：</font><font style="vertical-align: inherit;">性別を正しく特定できたので、標準グループも並べます。</font><font style="vertical-align: inherit;">それらが一致しない場所を見てみましょう：</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>event</th>
<th>place</th>
<th><u>sex</u></th>
<th>name</th>
<th>country</th>
<th>group</th>
<th>...</th>
<th>country raw</th>
<th>group raw</th>
<th><u>sex raw</u></th>
<th>grflc</th>
</tr>
<tr>
<td>...</td>
<td>37</td>
<td><u>F</u></td>
<td>Pilz Christiane</td>
<td>DEU</td>
<td>FPRO</td>
<td>...</td>
<td>GER</td>
<td>FPRO</td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>92</td>
<td><u>F</u></td>
<td>Brault Sarah-Anne</td>
<td>CAN</td>
<td>FPRO</td>
<td>...</td>
<td>CAN</td>
<td>FPRO</td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>96</td>
<td><u>F</u></td>
<td>Murphy Susanna</td>
<td>IRL</td>
<td>FPRO</td>
<td>...</td>
<td>IRL</td>
<td>FPRO</td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>105</td>
<td><u>F</u></td>
<td>Spoelder Romy</td>
<td>NLD</td>
<td></td>
<td>...</td>
<td>NED</td>
<td>FJUNIOR</td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>424</td>
<td><u>M</u></td>
<td>Watson Tom</td>
<td>GBR</td>
<td>M40-44</td>
<td>...</td>
<td>GBR</td>
<td>M40-44</td>
<td><u>F</u></td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>81</td>
<td><u>F</u></td>
<td>Morel Charlotte</td>
<td>FRA</td>
<td></td>
<td>...</td>
<td>FRA</td>
<td>FJUNIOR</td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>65</td>
<td><u>F</u></td>
<td>Selekhova Olga</td>
<td>RUS</td>
<td></td>
<td>...</td>
<td>RUS</td>
<td>FU23</td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>166</td>
<td><u>F</u></td>
<td>Keat Rebekah</td>
<td>AUS</td>
<td></td>
<td>...</td>
<td>AUS</td>
<td>FJUNIOR</td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>119</td>
<td><u>F</u></td>
<td>Eim Nina</td>
<td>DEU</td>
<td></td>
<td>...</td>
<td>GER</td>
<td>FQUAL…</td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>73</td>
<td><u>F</u></td>
<td>Sukhoruchenkova Evgenia</td>
<td>RUS</td>
<td>FPRO</td>
<td>...</td>
<td>RUS</td>
<td>FPRO</td>
<td><u>M</u></td>
<td>F</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'gfl'</span>] = ar[<span class="hljs-string">'group'</span>].str[<span class="hljs-number">0</span>]<font></font>
gncws = ar[(ar[<span class="hljs-string">'sex'</span>] != ar[<span class="hljs-string">'gfl'</span>]) &amp; (ar[<span class="hljs-string">'group'</span>]!=<span class="hljs-string">''</span>)]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4,248エントリ。</font><font style="vertical-align: inherit;">最初の文字を置き換えます：</font></font><br>
<br>
<pre><code class="python hljs">ar.loc[gncws.index, <span class="hljs-string">'group'</span>] = ar.loc[gncws.index, <span class="hljs-string">'sex'</span>] + ar.loc[gncws.index, <span class="hljs-string">'group'</span>].str[<span class="hljs-number">1</span>:].index, <span class="hljs-string">'sex'</span>]
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>event</th>
<th>place</th>
<th><u>sex</u></th>
<th>name</th>
<th>country</th>
<th><u>group</u></th>
<th>...</th>
<th>country raw</th>
<th><u>group raw</u></th>
<th>sex raw</th>
</tr>
<tr>
<td>...</td>
<td>803</td>
<td><u>F</u></td>
<td>Kenney Joelle</td>
<td>USA</td>
<td><u>F35-39</u></td>
<td>...</td>
<td>USA</td>
<td><u>M35-39</u></td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>1432</td>
<td><u>M</u></td>
<td>Holmberg Henriette Gorm</td>
<td>DNK</td>
<td><u>M45-49</u></td>
<td>...</td>
<td>DEN</td>
<td><u>F45-49</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>503</td>
<td><u>M</u></td>
<td>Tai Oy Leen</td>
<td>MYS</td>
<td><u>M40-44</u></td>
<td>...</td>
<td>MAS</td>
<td><u>F40-44</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>236</td>
<td><u>F</u></td>
<td>Dissanayake Aruna</td>
<td>LKA</td>
<td><u>F25-29</u></td>
<td>...</td>
<td>SRI</td>
<td><u>M25-29</u></td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>1349</td>
<td><u>F</u></td>
<td>Delos Reyes Joshua Rafaelle</td>
<td>PHL</td>
<td><u>F18-24</u></td>
<td>...</td>
<td>PHI</td>
<td><u>M18-24</u></td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>543</td>
<td><u>F</u></td>
<td>Vandekendelaere Janique</td>
<td>BEL</td>
<td><u>F50-54</u></td>
<td>...</td>
<td>BEL</td>
<td><u>M50-54</u></td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>1029</td>
<td><u>M</u></td>
<td>Provost Shaun</td>
<td>USA</td>
<td><u>M25-29</u></td>
<td>...</td>
<td>USA</td>
<td><u>F25-29</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>303</td>
<td><u>F</u></td>
<td>Torrens Vadell Macia</td>
<td>ESP</td>
<td><u>F30-34</u></td>
<td>...</td>
<td>ESP</td>
<td><u>M30-34</u></td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>1338</td>
<td><u>F</u></td>
<td>Suarez Renan</td>
<td>BOL</td>
<td><u>F35-39</u></td>
<td>...</td>
<td>BOL</td>
<td><u>M35-39</u></td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>502</td>
<td><u>F</u></td>
<td>Everlo Linda</td>
<td>NLD</td>
<td><u>F30-34</u></td>
<td>...</td>
<td>NED</td>
<td><u>M30-34</u></td>
<td>M</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">おそらく、どこかで訂正が正しくなかったことが判明しましたが、誰もが彼らが害よりも良いことをしたと早く思っています。</font><font style="vertical-align: inherit;">統計の場合、これは重要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それはセックスの回復でそれです。</font><font style="vertical-align: inherit;">作業列を削除し、辞書に翻訳して保存します。</font></font><br>
<br>
<pre><code class="python hljs">pkl.dump(rd, open(<span class="hljs-string">r'D:\tri\details8.pkl'</span>, <span class="hljs-string">'wb'</span>))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不完全なデータの回復により、これですべてです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会報の更新</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
男性と女性の数などの更新されたデータで要約表を更新することは残っています。 </font></font><br>
<br>
<pre><code class="python hljs">rs[<span class="hljs-string">'total raw'</span>] = rs[<span class="hljs-string">'total'</span>]<font></font>
rs[<span class="hljs-string">'males raw'</span>] = rs[<span class="hljs-string">'males'</span>]<font></font>
rs[<span class="hljs-string">'females raw'</span>] = rs[<span class="hljs-string">'females'</span>]<font></font>
rs[<span class="hljs-string">'rus raw'</span>] = rs[<span class="hljs-string">'rus'</span>]<font></font>
<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> rs.index:<font></font>
    e = rs.loc[i,<span class="hljs-string">'event'</span>]<font></font>
    rs.loc[i,<span class="hljs-string">'total'</span>] = len(rd[e])<font></font>
    rs.loc[i,<span class="hljs-string">'males'</span>] = len(rd[e][rd[e][<span class="hljs-string">'sex'</span>] == <span class="hljs-string">'M'</span>])<font></font>
    rs.loc[i,<span class="hljs-string">'females'</span>] = len(rd[e][rd[e][<span class="hljs-string">'sex'</span>] == <span class="hljs-string">'F'</span>])<font></font>
    rs.loc[i,<span class="hljs-string">'rus'</span>] = len(rd[e][rd[e][<span class="hljs-string">'country'</span>] == <span class="hljs-string">'RUS'</span>])<font></font>
<font></font>
len(rs[rs[<span class="hljs-string">'total'</span>] != rs[<span class="hljs-string">'total raw'</span>]])</code></pre><br>
<code><b>Out:</b> 288<br>
</code><br>
<br>
<pre><code class="python hljs">len(rs[rs[<span class="hljs-string">'males'</span>] != rs[<span class="hljs-string">'males raw'</span>]])
</code></pre><br>
<code><b>Out:</b>962<br>
</code><br>
<br>
<pre><code class="python hljs">len(rs[rs[<span class="hljs-string">'females'</span>] != rs[<span class="hljs-string">'females raw'</span>]])
</code></pre><br>
<code><b>Out:</b> 836<br>
</code><br>
<br>
<pre><code class="python hljs">len(rs[rs[<span class="hljs-string">'rus'</span>] != rs[<span class="hljs-string">'rus raw'</span>]])
</code></pre><br>
<code><b>Out:</b> 8<br>
</code><br>
<br>
<pre><code class="python hljs">pkl.dump(rs, open(<span class="hljs-string">r'D:\tri\summary6.pkl'</span>, <span class="hljs-string">'wb'</span>))
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート4.サンプリング</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今トライアスロンは非常に人気があります。</font><font style="vertical-align: inherit;">シーズン中は、アマチュアを中心に多くのアスリートが参加するオープンな大会が数多くあります。</font><font style="vertical-align: inherit;">しかし、常にそうであるとは限りませんでした。</font><font style="vertical-align: inherit;">1990年以降のデータには記録があります。</font><font style="vertical-align: inherit;">tristats.ruをスクロールすると、近年のレースははるかに多く、最初のレースは非常に少ないことがわかりました。</font><font style="vertical-align: inherit;">しかし、これでデータが準備できたので、もっと詳しく見ることができます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10年間</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
毎年のレースと完走者の数を数えます：</font></font><br>
<br>
<pre><code class="python hljs">rs[<span class="hljs-string">'year'</span>] = pd.DatetimeIndex(rs[<span class="hljs-string">'date'</span>]).year<font></font>
years = range(rs[<span class="hljs-string">'year'</span>].min(),rs[<span class="hljs-string">'year'</span>].max())<font></font>
rsy = pd.DataFrame(columns = [<span class="hljs-string">'races'</span>, <span class="hljs-string">'finishers'</span>, <span class="hljs-string">'rus'</span>, <span class="hljs-string">'RUS'</span>], index = years) <span class="hljs-comment">#rsy – races summary by year</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> rsy.index:<font></font>
    rsy.loc[y,<span class="hljs-string">'races'</span>] = len(rs[rs[<span class="hljs-string">'year'</span>] == y])<font></font>
    rsy.loc[y,<span class="hljs-string">'finishers'</span>] = sum(rs[rs[<span class="hljs-string">'year'</span>] == y][<span class="hljs-string">'total'</span>])<font></font>
    rsy.loc[y,<span class="hljs-string">'rus'</span>] =  sum(rs[rs[<span class="hljs-string">'year'</span>] == y][<span class="hljs-string">'rus'</span>])<font></font>
    rsy.loc[y,<span class="hljs-string">'RUS'</span>] = len(rs[(rs[<span class="hljs-string">'year'</span>] == y)&amp;(rs[<span class="hljs-string">'country'</span>] == <span class="hljs-string">'RUS'</span>)])
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>year</th>
<th>races</th>
<th>finishers</th>
<th>rus</th>
<th>RUS</th>
</tr>
<tr>
<td>1990</td>
<td>1</td>
<td>286</td>
<td>5</td>
<td>0</td>
</tr>
<tr>
<td>1991</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>1992</td>
<td>1</td>
<td>317</td>
<td>3</td>
<td>0</td>
</tr>
<tr>
<td>1993</td>
<td>2</td>
<td>887</td>
<td>3</td>
<td>0</td>
</tr>
<tr>
<td>1994</td>
<td>2</td>
<td>128</td>
<td>3</td>
<td>0</td>
</tr>
<tr>
<td>1995</td>
<td>3</td>
<td>731</td>
<td>7</td>
<td>0</td>
</tr>
<tr>
<td>1996</td>
<td>3</td>
<td>776</td>
<td>6</td>
<td>0</td>
</tr>
<tr>
<td>1997</td>
<td>3</td>
<td>403</td>
<td>11</td>
<td>0</td>
</tr>
<tr>
<td>1998</td>
<td>4</td>
<td>583</td>
<td>21</td>
<td>0</td>
</tr>
<tr>
<td>1999</td>
<td>10</td>
<td>1106</td>
<td>26</td>
<td>0</td>
</tr>
<tr>
<td>2000</td>
<td>10</td>
<td>1231</td>
<td>29</td>
<td>0</td>
</tr>
<tr>
<td>2001</td>
<td>11</td>
<td>1992</td>
<td>32</td>
<td>0</td>
</tr>
<tr>
<td>2002</td>
<td>21</td>
<td>2249</td>
<td>100</td>
<td>0</td>
</tr>
<tr>
<td>2003</td>
<td>30</td>
<td>3152</td>
<td>158</td>
<td>0</td>
</tr>
<tr>
<td>2004</td>
<td>19</td>
<td>5488</td>
<td>128</td>
<td>1</td>
</tr>
<tr>
<td>2005</td>
<td>16</td>
<td>3024</td>
<td>244</td>
<td>1</td>
</tr>
<tr>
<td>2006</td>
<td>29</td>
<td>6210</td>
<td>369</td>
<td>1</td>
</tr>
<tr>
<td>2007</td>
<td>44</td>
<td>12153</td>
<td>444</td>
<td>1</td>
</tr>
<tr>
<td>2008</td>
<td>43</td>
<td>13830</td>
<td>369</td>
<td>1</td>
</tr>
<tr>
<td>2009</td>
<td>49</td>
<td>27047</td>
<td>478</td>
<td>1</td>
</tr>
<tr>
<td>2010</td>
<td>47</td>
<td>26528</td>
<td>366</td>
<td>1</td>
</tr>
<tr>
<td>2011</td>
<td>77</td>
<td>45412</td>
<td>848</td>
<td>5</td>
</tr>
<tr>
<td>2012</td>
<td>96</td>
<td>75590</td>
<td>1055</td>
<td>4</td>
</tr>
<tr>
<td>2013</td>
<td>98</td>
<td>86617</td>
<td>2165</td>
<td>9</td>
</tr>
<tr>
<td>2014</td>
<td>135</td>
<td>138018</td>
<td>3188</td>
<td>11</td>
</tr>
<tr>
<td>2015</td>
<td>164</td>
<td>172375</td>
<td>4846</td>
<td>15</td>
</tr>
<tr>
<td>2016</td>
<td>192</td>
<td>178630</td>
<td>7541</td>
<td>27</td>
</tr>
<tr>
<td>2017</td>
<td>238</td>
<td>185473</td>
<td>8825</td>
<td>42</td>
</tr>
<tr>
<td>2018</td>
<td>278</td>
<td>203031</td>
<td>10954</td>
<td>54</td>
</tr>
<tr>
<td>2019</td>
<td>293</td>
<td>220901</td>
<td>13354</td>
<td>59</td>
</tr>
</tbody></table></div></code><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RUS-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ロシアでのレース。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rus-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ロシアのフィニッシャー。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チャートでは次のようになります。</font></font><br>
<img src="https://habrastorage.org/webt/nx/yg/4s/nxyg4syvd0x-0f16nxl1ucvhyma.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
期間の初めと終わりのレースと参加者の数は単純に通約できないことがわかります。総レース数の大幅な増加は2011年に始まり、ロシアでのスタート数も増加しています。さらに、2009年には参加者数の増加が見られます。これは、参加者の間の関心の高まり、つまり需要の増加を示し、その後2年後に供給、つまり開始数が増加したことを示している可能性があります。ただし、データが完全ではなく、場合によっては多くのレースが欠落している可能性があることを忘れないでください。このデータを収集するプロジェクトが2010年に始まったという事実も含めて、この瞬間のグラフの大きな飛躍を説明することもできます。そのため、さらに分析するために、過去10年間を採用することにしました。これはかなり長い期間です数年間のトレンドを追跡するために、90年代と2000年代初頭の主にプロの競技会に到達するのに十分短い間。</font></font><br>
<br>
<pre><code class="python hljs">rs = rs[(rs[<span class="hljs-string">'year'</span>]&gt;=<span class="hljs-number">2010</span>)&amp;(rs[<span class="hljs-string">'year'</span>]&lt;= <span class="hljs-number">2019</span>)]
</code></pre><br>
<img src="https://habrastorage.org/webt/ck/p4/qf/ckp4qfjucrjhl7kvu-0fyv_ilbc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、決まった時期には84％のレースと94％のフィニッシャーが転落した。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">素人スタート</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、選択されたスタートの参加者の大多数はアマチュアアスリートであるため、彼らから良い統計を得ることができます。正直なところ、私自身がそうしたスタートに参加していたので、これは私にとって主な関心事でしたが、レベルでは、オリンピックのチャンピオンとはかけ離れています。ただし、選択された期間にプロのコンテストも開催されたのは明らかです。アマチュアとプロのレースの指標を混同しないようにするために、後者を考慮から外すことが決定されました。それらを識別する方法は？スピードで。それらを計算します。データ準備の最初の段階の1つで、各レースでの距離のタイプ（スプリント、オリンピック、ハーフ、アイアン）をすでに決定しました。それらのそれぞれについて、ステージの走行距離は明確に定義されています-水泳、サイクリング、ランニング。これは、スプリントが0.75 + 20 + 5、オリンピックが1.5 + 40 + 10、ハーフが1.9 + 90 + 21.1、および3です。鉄の場合は8 + 180 + 42.2。もちろん、実際には、どのタイプでも、実数は条件付きでレースごとに最大1％変動する可能性がありますが、これに関する情報はないため、すべてが正確であると想定しています。</font></font><br>
<br>
<pre><code class="python hljs">rs[<span class="hljs-string">'km'</span>] = <span class="hljs-string">''</span><font></font>
<font></font>
rs.loc[rs[<span class="hljs-string">'dist'</span>] == <span class="hljs-string">'sprint'</span>, <span class="hljs-string">'km'</span>] = <span class="hljs-number">0.75</span>+<span class="hljs-number">20</span>+<span class="hljs-number">5</span>
rs.loc[rs[<span class="hljs-string">'dist'</span>] == <span class="hljs-string">'olympic'</span>, <span class="hljs-string">'km'</span>] = <span class="hljs-number">1.5</span>+<span class="hljs-number">40</span>+<span class="hljs-number">10</span>
rs.loc[rs[<span class="hljs-string">'dist'</span>] == <span class="hljs-string">'half'</span>, <span class="hljs-string">'km'</span>] = <span class="hljs-number">1.9</span>+<span class="hljs-number">90</span>+<span class="hljs-number">21.1</span>
rs.loc[rs[<span class="hljs-string">'dist'</span>] == <span class="hljs-string">'full'</span>, <span class="hljs-string">'km'</span>] = <span class="hljs-number">3.8</span>+<span class="hljs-number">180</span>+<span class="hljs-number">42.2</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各レースの平均速度と最大速度を計算します。</font><font style="vertical-align: inherit;">ここでの最大値は、優勝した選手の平均速度を指します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> index, row <span class="hljs-keyword">in</span> rs.iterrows():<font></font>
    e = row[<span class="hljs-string">'event'</span>]<font></font>
    rd[e][<span class="hljs-string">'th'</span>] = pd.TimedeltaIndex(rd[e][<span class="hljs-string">'result'</span>]).seconds/<span class="hljs-number">3600</span>
    rd[e][<span class="hljs-string">'v'</span>] = rs.loc[i, <span class="hljs-string">'km'</span>] / rd[e][<span class="hljs-string">'th'</span>]<font></font>
<font></font>
<span class="hljs-keyword">for</span> index, row <span class="hljs-keyword">in</span> rs.iterrows():<font></font>
    e = row[<span class="hljs-string">'event'</span>]<font></font>
    rs.loc[index,<span class="hljs-string">'vmax'</span>] = rd[e][<span class="hljs-string">'v'</span>].max()<font></font>
    rs.loc[index,<span class="hljs-string">'vavg'</span>] = rd[e][<span class="hljs-string">'v'</span>].mean()
</code></pre><br>
<img src="https://habrastorage.org/webt/81/6k/pe/816kpel94nzs-hsp9dphfdhtq3g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まあ、速度の大部分は約15 km / hから30 km / hの間にヒープに集まっていることがわかりますが、完全に「宇宙」の値がいくつかあります。</font><font style="vertical-align: inherit;">平均速度で並べ替えて、その数を確認します。</font></font><br>
<br>
<pre><code class="python hljs">rs = rs.sort_values(by=<span class="hljs-string">'vavg'</span>)
</code></pre><br>
<img src="https://habrastorage.org/webt/aa/wi/ws/aawiwsx0kcmhzyq3y3ezcm_fy0o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでスケールを変更し、より正確に範囲を推定できます。平均速度は約17 km / hから27 km / hで、最大は-18 km / hから32 km / hです。さらに、平均速度が非常に低く、非常に高い「テール」があります。低速はおそらく</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ノースマンの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ような極端な競争に対応し</font><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">高速</font><font style="vertical-align: inherit;">はスプリントの代わりにスーパースプリントがあった、または単に誤ったデータがあったキャンセルされた水泳の場合である可能性があります。もう1つの重要な点は</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">X</font></i><font style="vertical-align: inherit;">軸に沿った</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1200</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">領域の滑らかなステップです。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、およびその後の平均速度のより高い値。</font><font style="vertical-align: inherit;">ここでは、平均速度と最大速度の差がグラフの最初の3分の2に比べて大幅に小さいことがわかります。</font><font style="vertical-align: inherit;">どうやら、これはプロのコンテストです。</font><font style="vertical-align: inherit;">それらをより明確に区別するために、平均に対する最大速度の比率を計算します。</font><font style="vertical-align: inherit;">ランダムな人がいないすべての参加者が非常に高いレベルの体力を持っているプロの競技会では、この比率は最小限でなければなりません。</font></font><br>
<br>
<pre><code class="python hljs">rs[<span class="hljs-string">'vmdbva'</span>] = rs[<span class="hljs-string">'vmax'</span>]/rs[<span class="hljs-string">'vavg'</span>] <span class="hljs-comment">#vmdbva - v max divided by v avg</span>
rs = rs.sort_values(by=<span class="hljs-string">'vmdbva'</span>)
</code></pre><br>
<img src="https://habrastorage.org/webt/li/cv/pr/licvprwpcx3zlws5pjufo0dxhcm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このグラフでは、第1四半期が非常にはっきりと表れています。平均速度に対する最大速度の比率は小さく、平均速度が高く、参加者数は少ないです。</font><font style="vertical-align: inherit;">これはプロ大会です。</font><font style="vertical-align: inherit;">緑の曲線のステップは、1.2あたりです。</font><font style="vertical-align: inherit;">サンプルには、比率値が1.2より大きいレコードのみを残します。</font></font><br>
<br>
<pre><code class="python hljs">rs = rs[rs[<span class="hljs-string">'vmdbva'</span>] &gt; <span class="hljs-number">1.2</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、非定型の低速および高速のレコードも削除します。</font><font style="vertical-align: inherit;">では</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どのような距離ごとトライアスロン「の世界記録は、」ありますか？</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2019年に異なる距離を通過した記録的な時間を公開しました </font><font style="vertical-align: inherit;">それらを中速で数えると、最速でも33 km / hを超えることができないことがわかります。</font><font style="vertical-align: inherit;">したがって、平均速度が高く無効なプロトコルを考慮し、それらを考慮から除外します。</font></font><br>
<br>
<pre><code class="python hljs">rs = rs[(rs[<span class="hljs-string">'vavg'</span>] &gt; <span class="hljs-number">17</span>)&amp;(rs[<span class="hljs-string">'vmax'</span>] &lt; <span class="hljs-number">33</span>)]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残りは次のとおりです</font></font><br>
<img src="https://habrastorage.org/webt/t1/dk/_p/t1dk_pixaznwxlfsunkxpx5yfum.png"><br>
<img src="https://habrastorage.org/webt/qk/9u/4a/qk9u4anxmpnwehsdhckfn64ucvw.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。すべてが非常に均一に見え、問題は発生しません。</font><font style="vertical-align: inherit;">このすべての選択の結果、1922プロトコルのうち777、つまり40％が失われました。</font><font style="vertical-align: inherit;">同時に、フィニッシャーの総数はそれほど減少せず、わずか13％でした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、残り1,145レース、1,231,772フィニッシャーです。</font><font style="vertical-align: inherit;">このサンプルは、私の分析と視覚化の材料になりました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート5.分析と視覚化</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この作業では、適切な分析と視覚化が最も単純な部分でした。</font><font style="vertical-align: inherit;">氷山の一角、その水中部分はデータの準備だけでした。</font><font style="vertical-align: inherit;">実際、分析は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pandas Series</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">での</font><font style="vertical-align: inherit;">単純な算術演算</font><font style="vertical-align: inherit;">、平均の計算、フィルタリングでした-これはすべて、基本的な</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pandas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ツールによって実行され</font><font style="vertical-align: inherit;">、上記のコードには例がたくさんあります。</font><font style="vertical-align: inherit;">次に、視覚化は主に最も</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">標準的なmatplotlib</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して行われました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">使用された</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロット、バー、パイ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ただし、場所によっては、日付やピクトグラムの場合、軸のシグネチャをいじる必要がありましたが、これは、ここでの詳細な説明を引き出すものではありません。</font><font style="vertical-align: inherit;">話し合う価値があるのは、地理データの表示だけです。</font><font style="vertical-align: inherit;">少なくともそうではない</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matplotlib</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地理データ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各レースについて、会場に関する情報があります。</font><font style="vertical-align: inherit;">最初に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">geopy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して</font><font style="vertical-align: inherit;">、各場所の座標を計算しました。</font><font style="vertical-align: inherit;">同じ場所で毎年多くのレースが開催されます。</font><i><font style="vertical-align: inherit;">Python</font></i><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">
ジオデータをレンダリングするための非常に便利なツール</font><font style="vertical-align: inherit;">は</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;">folium</font></i></a><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">仕組みは次のとおりです。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>event</th>
<th>date</th>
<th>country</th>
<th><u>latitude</u></th>
<th><u>longitude</u></th>
<th>loc</th>
<th>…</th>
</tr>
<tr>
<td>0</td>
<td>Ironman Indian Wells La Quinta 70.3 2019</td>
<td>2019-12-08</td>
<td>USA</td>
<td><u>33.7238</u></td>
<td><u>-116.305</u></td>
<td>Indian Wells/La Quinta, California, USA</td>
<td>…</td>
</tr>
<tr>
<td>1</td>
<td>Ironman Taupo 70.3 2019</td>
<td>2019-12-07</td>
<td>NZL</td>
<td><u>-41.5001</u></td>
<td><u>172.834</u></td>
<td>New Zealand</td>
<td>…</td>
</tr>
<tr>
<td>2</td>
<td>Ironman Western Australia 2019</td>
<td>2019-12-01</td>
<td>AUS</td>
<td><u>-33.6445</u></td>
<td><u>115.349</u></td>
<td>Busselton, Western Australia</td>
<td>…</td>
</tr>
<tr>
<td>3</td>
<td>Ironman Mar del Plata 2019</td>
<td>2019-12-01</td>
<td>ARG</td>
<td><u>-37.9977</u></td>
<td><u>-57.5483</u></td>
<td>Mar del Plata, Argentina</td>
<td>…</td>
</tr>
<tr>
<td>4</td>
<td>Ironman Cozumel 2019</td>
<td>2019-11-24</td>
<td>MEX</td>
<td><u>20.4318</u></td>
<td><u>-86.9203</u></td>
<td>Cozumel, Mexico</td>
<td>…</td>
</tr>
<tr>
<td>5</td>
<td>Ironman Arizona 2019</td>
<td>2019-11-24</td>
<td>USA</td>
<td><u>33.4255</u></td>
<td><u>-111.94</u></td>
<td>Tempe, Arizona, USA</td>
<td>…</td>
</tr>
<tr>
<td>6</td>
<td>Ironman Xiamen 70.3 2019</td>
<td>2019-11-10</td>
<td>CHN</td>
<td><u>24.4758</u></td>
<td><u>118.075</u></td>
<td>Xiamen, China</td>
<td>…</td>
</tr>
<tr>
<td>7</td>
<td>Ironman Turkey 70.3 2019</td>
<td>2019-11-03</td>
<td>TUR</td>
<td><u>36.8633</u></td>
<td><u>31.0578</u></td>
<td>Belek, Antalya, Turkey</td>
<td>…</td>
</tr>
<tr>
<td>8</td>
<td>Ironman Florida 2019</td>
<td>2019-11-02</td>
<td>USA</td>
<td><u>30.1766</u></td>
<td><u>-85.8055</u></td>
<td>Panama City Beach, Florida, USA</td>
<td>…</td>
</tr>
<tr>
<td>9</td>
<td>Ironman Marrakech 70.3 2019</td>
<td>2019-10-27</td>
<td>MAR</td>
<td><u>31.6258</u></td>
<td><u>-7.98916</u></td>
<td>Marrakech, Morocco</td>
<td>…</td>
</tr>
<tr>
<td>10</td>
<td>Ironman Waco 70.3 2019</td>
<td>2019-10-27</td>
<td>USA</td>
<td><u>31.5493</u></td>
<td><u>-97.1467</u></td>
<td>Waco, Texas, USA</td>
<td>…</td>
</tr>
</tbody></table></div></code><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;"></font></i></a><font style="vertical-align: inherit;"></font><br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> folium<font></font>
<font></font>
m = folium.Map() <font></font>
folium.Marker([<span class="hljs-string">'55.7522200'</span>, <span class="hljs-string">'37.6155600'</span>], popup=<span class="hljs-string">''</span>).add_to(m)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、Jupiterラップトップでインタラクティブマップを取得します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jc/hp/fs/jchpfspvaahnnbvwtgwx2wqkppu.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今、私たちのデータに。</font><font style="vertical-align: inherit;">最初に、座標の組み合わせから新しい列を開始します。</font></font><br>
<br>
<pre><code class="python hljs">rs[<span class="hljs-string">'coords'</span>] = rs[<span class="hljs-string">'latitude'</span>].astype(str) + <span class="hljs-string">', '</span> + rs[<span class="hljs-string">'longitude'</span>].astype(str)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユニークな座標</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COORDSは</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 291であり、ユニークな場所の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LOCは</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、同時にそれらは同じ点に対応しているいくつかの名前は、わずかに異なっていることを意味し、324です。</font><font style="vertical-align: inherit;">怖くないので</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コーディネイトで個性</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を考えていきます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">各場所で（一意の座標で）経過したイベントの数を計算します。</font></font><br>
<br>
<pre><code class="python hljs">vc = rs[<span class="hljs-string">'coords'</span>].value_counts()<font></font>
<font></font>
vc</code></pre><br>
<code><b>Out:</b><br>
43.7009358, 7.2683912 22<br>
43.5854823, 39.723109 20<br>
29.03970805, -13.636291 16<br>
47.3723941, 8.5423328 16<br>
59.3110918, 24.420907 15<br>
51.0834196, 10.4234469 15<br>
54.7585694, 38.8818137 14<br>
20.4317585, -86.9202745 13<br>
52.3727598, 4.8936041 12<br>
41.6132925, 2.6576102 12<br>
... ...<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、マップを作成し、円の形でマーカーを追加します。円の半径は、その場所で開催されるイベントの数によって異なります。</font><font style="vertical-align: inherit;">マーカーに場所名の付いたマーカーを追加します。</font></font><br>
<br>
<pre><code class="python hljs">m = folium.Map(location=[<span class="hljs-number">25</span>,<span class="hljs-number">10</span>], zoom_start=<span class="hljs-number">2</span>)<font></font>
<font></font>
<span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> rs[<span class="hljs-string">'coords'</span>].unique():<font></font>
    row = [r[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> rs.iterrows() <span class="hljs-keyword">if</span> r[<span class="hljs-number">1</span>][<span class="hljs-string">'coords'</span>] == c][<span class="hljs-number">0</span>]    <font></font>
    folium.Circle([row[<span class="hljs-string">'latitude'</span>], row[<span class="hljs-string">'longitude'</span>]], <font></font>
					popup=(row[<span class="hljs-string">'location'</span>]+<span class="hljs-string">'\n('</span>+str(vc[c])+<span class="hljs-string">' races)'</span>), <font></font>
					radius = <span class="hljs-number">10000</span>*int(vc[c]), <font></font>
					color=<span class="hljs-string">'darkorange'</span>, <font></font>
					fill=<span class="hljs-literal">True</span>, <font></font>
					stroke=<span class="hljs-literal">True</span>, <font></font>
					weight=<span class="hljs-number">1</span>).add_to(m)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
できました。</font><font style="vertical-align: inherit;">あなたは結果を見ることができます：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ch/d4/gj/chd4gj0qbyjrzyjikpmslgesw0i.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参加者の進捗状況</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、ガイドに加えて、さらに別のスケジュールでの作業も簡単ではありませんでした。参加者の最新の進捗グラフです。ここにそれがあります：それを</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/rf/ca/jq/rfcajquw4qluhsw9wuhicbgk7rm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分析しましょう、同時に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matplotlib</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用する例として、レンダリング用のコードを与えます</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="python hljs">fig = plt.figure()<font></font>
fig.set_size_inches(<span class="hljs-number">10</span>, <span class="hljs-number">6</span>)<font></font>
<font></font>
ax = fig.add_axes([<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>])<font></font>
<font></font>
b = ax.bar(exp,numrecs, color = <span class="hljs-string">'navajowhite'</span>)<font></font>
<font></font>
ax1 = ax.twinx()<font></font>
<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(exp_samp)):<font></font>
    ax1.plot(exp_samp[i], vproc_samp[i], <span class="hljs-string">'.'</span>)<font></font>
	<font></font>
p, = ax1.plot(exp, vpm, <span class="hljs-string">'o-'</span>,markersize=<span class="hljs-number">8</span>, linewidth=<span class="hljs-number">2</span>, color=<span class="hljs-string">'C0'</span>)<font></font>
<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(exp)):
    <span class="hljs-keyword">if</span> i &lt; len(exp)<span class="hljs-number">-1</span> <span class="hljs-keyword">and</span> (vpm[i] &lt; vpm[i+<span class="hljs-number">1</span>]):<font></font>
        ax1.text(x = exp[i]+<span class="hljs-number">0.1</span>, y = vpm[i]<span class="hljs-number">-0.2</span>, s = <span class="hljs-string">'{0:3.1f}%'</span>.format(vpm[i]),size=<span class="hljs-number">12</span>)
    <span class="hljs-keyword">else</span>:<font></font>
        ax1.text(x = exp[i]+<span class="hljs-number">0.1</span>, y = vpm[i]+<span class="hljs-number">0.1</span>, s = <span class="hljs-string">'{0:3.1f}%'</span>.format(vpm[i]),size=<span class="hljs-number">12</span>)<font></font>
<font></font>
ax.legend((b,p), (<span class="hljs-string">' '</span>, <span class="hljs-string">''</span>),loc=<span class="hljs-string">'center right'</span>)<font></font>
ax.set_xlabel(<span class="hljs-string">'   '</span>)<font></font>
ax.set_ylabel(<span class="hljs-string">''</span>)<font></font>
ax1.set_ylabel(<span class="hljs-string">'%     '</span>)<font></font>
ax.set_xticks(np.arange(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>, step=<span class="hljs-number">1</span>))<font></font>
ax.set_yticks(np.arange(<span class="hljs-number">0</span>, <span class="hljs-number">230000</span>, step=<span class="hljs-number">25000</span>))<font></font>
ax1.set_ylim(<span class="hljs-number">97.5</span>,<span class="hljs-number">103.5</span>)<font></font>
ax.yaxis.set_label_position(<span class="hljs-string">"right"</span>)<font></font>
ax.yaxis.tick_right()<font></font>
ax1.yaxis.set_label_position(<span class="hljs-string">"left"</span>)<font></font>
ax1.yaxis.tick_left()      <font></font>
<font></font>
plt.show()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、彼のためにデータがどのように計算されたかについて説明します。</font><font style="vertical-align: inherit;">最初に、少なくとも2つのレースで、異なる暦年に終了し、同時にプロではない参加者の名前を選択する必要がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、各プロトコル</font><font style="vertical-align: inherit;">について、レースという日付を示す</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">date</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">という新しい列に入力します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この日付から1年も必要</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">列を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">年にし</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">レースでの平均速度に対する各アスリートの速度を分析するので、新しい列</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vproc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でこの速度を計算します</font><font style="vertical-align: inherit;">-平均のパーセンテージとしての速度。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> index, row <span class="hljs-keyword">in</span> rs.iterrows():<font></font>
    e = row[<span class="hljs-string">'event'</span>]<font></font>
    rd[e][<span class="hljs-string">'date'</span>] = row[<span class="hljs-string">'date'</span>]<font></font>
    rd[e][<span class="hljs-string">'year'</span>] = row[<span class="hljs-string">'year'</span>]<font></font>
    rd[e][<span class="hljs-string">'vproc'</span>] = <span class="hljs-number">100</span> * rd[e][<span class="hljs-string">'v'</span>] / rd[e][<span class="hljs-string">'v'</span>].mean()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロトコルは</font><font style="vertical-align: inherit;">
次の</font><font style="vertical-align: inherit;">ようになります。</font><font style="vertical-align: inherit;">次に、すべてのプロトコルを1つのデータフレームに結合します。</font></font><br>
<code>'   Sprint 2019'</code><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th>country</th>
<th>...</th>
<th>th</th>
<th>v</th>
<th><u>date</u></th>
<th><u>year</u></th>
<th><u>vproc</u></th>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>M</td>
<td>Shalev Aleksey</td>
<td>RUS</td>
<td>...</td>
<td>1.161944</td>
<td>22.161128</td>
<td><u>2019-09-14</u></td>
<td><u>2019</u></td>
<td><u>130.666668</u></td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>M</td>
<td>Nikolaev Artem</td>
<td>RUS</td>
<td>...</td>
<td>1.228611</td>
<td>20.958625</td>
<td><u>2019-09-14</u></td>
<td><u>2019</u></td>
<td><u>123.576458</u></td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>M</td>
<td>Kuchierskiy Aleksandr</td>
<td>RUS</td>
<td>...</td>
<td>1.255556</td>
<td>20.508850</td>
<td><u>2019-09-14</u></td>
<td><u>2019</u></td>
<td><u>120.924485</u></td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>F</td>
<td>Korchagina Mariya</td>
<td>RUS</td>
<td>...</td>
<td>1.297222</td>
<td>19.850107</td>
<td><u>2019-09-14</u></td>
<td><u>2019</u></td>
<td><u>117.040401</u></td>
</tr>
<tr>
<td>4</td>
<td>5</td>
<td>M</td>
<td>Solodov Ivan</td>
<td>RUS</td>
<td>...</td>
<td>1.298056</td>
<td>19.837364</td>
<td><u>2019-09-14</u></td>
<td><u>2019</u></td>
<td><u>116.965263</u></td>
</tr>
<tr>
<td>5</td>
<td>6</td>
<td>M</td>
<td>Bukin Sergey</td>
<td>RUS</td>
<td>...</td>
<td>1.300278</td>
<td>19.803461</td>
<td><u>2019-09-14</u></td>
<td><u>2019</u></td>
<td><u>116.765365</u></td>
</tr>
<tr>
<td>6</td>
<td>7</td>
<td>M</td>
<td>Lavrentev Dmitriy</td>
<td>RUS</td>
<td>...</td>
<td>1.300278</td>
<td>19.803461</td>
<td><u>2019-09-14</u></td>
<td><u>2019</u></td>
<td><u>116.765365</u></td>
</tr>
<tr>
<td>7</td>
<td>8</td>
<td>M</td>
<td>Dolgov Petr</td>
<td>RUS</td>
<td>...</td>
<td>1.321667</td>
<td>19.482976</td>
<td><u>2019-09-14</u></td>
<td><u>2019</u></td>
<td><u>114.875719</u></td>
</tr>
<tr>
<td>8</td>
<td>9</td>
<td>M</td>
<td>Bezruchenko Mikhailn</td>
<td>RUS</td>
<td>...</td>
<td>1.345000</td>
<td>19.144981</td>
<td><u>2019-09-14</u></td>
<td><u>2019</u></td>
<td><u>112.882832</u></td>
</tr>
<tr>
<td>9</td>
<td>10</td>
<td>M</td>
<td>Ryazantsev Dmitriy</td>
<td>RUS</td>
<td>...</td>
<td>1.359444</td>
<td>18.941561</td>
<td><u>2019-09-14</u></td>
<td><u>2019</u></td>
<td><u>111.683423</u></td>
</tr>
<tr>
<td>10</td>
<td>11</td>
<td>M</td>
<td>Ibragimov Ramil</td>
<td>RUS</td>
<td>...</td>
<td>1.376389</td>
<td>18.708375</td>
<td><u>2019-09-14</u></td>
<td><u>2019</u></td>
<td><u>110.308511</u></td>
</tr>
</tbody></table></div></code><br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">ar = pd.concat(rd)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
参加者ごとに、各暦年に1つのエントリのみを残します。</font></font><br>
<br>
<pre><code class="python hljs">ar1 = ar.drop_duplicates(subset = [<span class="hljs-string">'name'</span>,<span class="hljs-string">'year'</span>], keep=<span class="hljs-string">'first'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、これらのエントリのすべての一意の名前から、少なくとも2回出現するものを見つけます。</font></font><br>
<br>
<pre><code class="python hljs">nvc = ar1[<span class="hljs-string">'name'</span>].value_counts()<font></font>
names = list(nvc[nvc &gt; <span class="hljs-number">1</span>].index)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
219,890人います。このリストからプロアスリートの名前を削除してみましょう。</font></font><br>
<br>
<pre><code class="python hljs">pro_names = ar[ar[<span class="hljs-string">'group'</span>].isin([<span class="hljs-string">'MPRO'</span>,<span class="hljs-string">'FPRO'</span>])][<span class="hljs-string">'name'</span>].unique()<font></font>
names = list(set(names) - set(pro_names))<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2010年以前にパフォーマンスを始めたアスリートの名前も。</font><font style="vertical-align: inherit;">これを行うには、過去10年間にサンプリングする前に保存されたデータをアップロードします。</font><font style="vertical-align: inherit;">それらを</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rsa</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（すべてのレースの要約）および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rda</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（すべてのレースの詳細）</font><font style="vertical-align: inherit;">オブジェクトに入れます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs">rdo = {} <font></font>
<font></font>
<span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> rda:    
    <span class="hljs-keyword">if</span> rsa[rsa[<span class="hljs-string">'event'</span>] == e][<span class="hljs-string">'year'</span>].iloc[<span class="hljs-number">0</span>] &lt; <span class="hljs-number">2010</span>:<font></font>
        rdo[e] = rda[e]<font></font>
<font></font>
aro = pd.concat(rdo)<font></font>
old_names = aro[<span class="hljs-string">'name'</span>].unique()<font></font>
names = list(set(names) - set(old_names))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして最後に、同じ日に複数回出現する名前を見つけます。</font><font style="vertical-align: inherit;">したがって、サンプル内の完全な同名の存在を最小限に抑えます。</font></font><br>
<br>
<pre><code class="python hljs">namesakes = ar[ar.duplicated(subset = [<span class="hljs-string">'name'</span>,<span class="hljs-string">'date'</span>], keep = <span class="hljs-literal">False</span>)][<span class="hljs-string">'name'</span>].unique()<font></font>
names = list(set(names) - set(namesakes))<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、198,075個の名前が残っています。</font><font style="vertical-align: inherit;">データセット全体から、見つかった名前のレコードのみを選択します。</font></font><br>
<br>
<pre><code class="python hljs">ars = ar[ar[<span class="hljs-string">'name'</span>].isin(names)] <span class="hljs-comment">#ars – all recrds selected</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、各レコードについて、それがアスリートのキャリアのどの年に対応するか（1年目、2年目、3年目、または10年目）を判別する必要があります。</font><font style="vertical-align: inherit;">すべての名前でループを作成して計算します。</font></font><br>
<br>
<pre><code class="python hljs">ars[<span class="hljs-string">'exp'</span>] = <span class="hljs-string">''</span> <span class="hljs-comment">#exp – experience, counted in years of racing, starts from 1.</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> names:    <font></font>
    ind = ars[ars[<span class="hljs-string">'name'</span>] == n].index <font></font>
    yos = ars.loc[ind, <span class="hljs-string">'year'</span>].min() <span class="hljs-comment">#yos – year of start</span>
    ars.loc[ind, <span class="hljs-string">'exp'</span>] = ars.loc[ind, <span class="hljs-string">'year'</span>] - yos + <span class="hljs-number">1</span> 
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが何が起こったかの例です：</font><font style="vertical-align: inherit;">
どうやら、同名はまだ残っていました。</font><font style="vertical-align: inherit;">これは予想されますが、私たちはすべてを平均化するので恐ろしいことではなく、それほど多くあるべきではありません。</font><font style="vertical-align: inherit;">次に、グラフの配列を作成します。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>event</th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th>country</th>
<th>group</th>
<th>…</th>
<th>th</th>
<th>v</th>
<th>date</th>
<th><u>year</u></th>
<th>vproc</th>
<th><u>exp</u></th>
</tr>
<tr>
<td>…</td>
<td>633</td>
<td>M</td>
<td>Golovin Sergey</td>
<td>RUS</td>
<td>M40-44</td>
<td>…</td>
<td>5.356111</td>
<td>21.097397</td>
<td>2014-08-31</td>
<td><u>2014</u></td>
<td>106.036879</td>
<td><u>1</u></td>
</tr>
<tr>
<td>…</td>
<td>302</td>
<td>M</td>
<td>Golovin Sergey</td>
<td>RUS</td>
<td>M40-44</td>
<td>…</td>
<td>11.236389</td>
<td>20.113223</td>
<td>2015-08-30</td>
<td><u>2015</u></td>
<td>108.231254</td>
<td><u>2</u></td>
</tr>
<tr>
<td>…</td>
<td>522</td>
<td>M</td>
<td>Golovin Sergey</td>
<td>RUS</td>
<td>M40-44</td>
<td>…</td>
<td>10.402778</td>
<td>21.724967</td>
<td>2016-07-17</td>
<td><u>2016</u></td>
<td>111.265107</td>
<td><u>3</u></td>
</tr>
<tr>
<td>…</td>
<td>25</td>
<td>M</td>
<td>Golovin Sergey</td>
<td>RUS</td>
<td>M40-44</td>
<td>…</td>
<td>10.910833</td>
<td>20.713358</td>
<td>2017-09-23</td>
<td><u>2017</u></td>
<td>112.953644</td>
<td><u>4</u></td>
</tr>
<tr>
<td>…</td>
<td>23</td>
<td>M</td>
<td>Golovin Sergey</td>
<td>RUS</td>
<td>M40-44</td>
<td>…</td>
<td>4.700000</td>
<td>24.042553</td>
<td>2017-06-03</td>
<td><u>2017</u></td>
<td>120.565211</td>
<td><u>4</u></td>
</tr>
<tr>
<td>…</td>
<td>42</td>
<td>M</td>
<td>Golovin Sergey</td>
<td>RUS</td>
<td>M40-44</td>
<td>…</td>
<td>4.599167</td>
<td>24.569668</td>
<td>2018-06-17</td>
<td><u>2018</u></td>
<td>124.579862</td>
<td><u>5</u></td>
</tr>
<tr>
<td>…</td>
<td>90</td>
<td>M</td>
<td>Golovin Sergey</td>
<td>NOR</td>
<td></td>
<td>…</td>
<td>14.069167</td>
<td>16.063496</td>
<td>2018-08-04</td>
<td><u>2018</u></td>
<td>100.001834</td>
<td><u>5</u></td>
</tr>
<tr>
<td>…</td>
<td>86</td>
<td>M</td>
<td>Golovin Sergey</td>
<td>RUS</td>
<td>M45-49</td>
<td>…</td>
<td>9.820556</td>
<td>23.012955</td>
<td>2019-08-03</td>
<td><u>2019</u></td>
<td>118.375766</td>
<td><u>6</u></td>
</tr>
</tbody></table></div></code><br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">exp = [] <font></font>
vpm = [] <span class="hljs-comment">#vpm – v proc mean</span>
numrecs = [] <span class="hljs-comment">#number of records</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(ars[<span class="hljs-string">'exp'</span>].min(), ars[<span class="hljs-string">'exp'</span>].max() + <span class="hljs-number">1</span>): <font></font>
    exp.append(x)<font></font>
    vpm.append(ars[ars[<span class="hljs-string">'exp'</span>] == x][<span class="hljs-string">'vproc'</span>].mean())<font></font>
    numrecs.append(len(ars[ars[<span class="hljs-string">'exp'</span>] == x]))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで完了です</font></font><br>
<br>
<img src="https://habrastorage.org/webt/c4/_p/u6/c4_pu61ixkiscputxq1qhfm84eg.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。特定の結果に対応するポイントで装飾するために、1000個のランダムな名前を選択し、それらの結果を含む配列を作成します。</font></font><br>
<br>
<pre><code class="python hljs">names_samp = random.sample(names,<span class="hljs-number">1000</span>)<font></font>
ars_samp = ars[ars[<span class="hljs-string">'name'</span>].isin(names_samp)]<font></font>
<font></font>
ars_samp = ars_samp.reset_index(drop = <span class="hljs-literal">True</span>)<font></font>
exp_samp = []<font></font>
vproc_samp = []<font></font>
<font></font>
<span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> names_samp:<font></font>
    nr = ars_samp[ars_samp[<span class="hljs-string">'name'</span>] == n]<font></font>
    nr = nr.sort_values(<span class="hljs-string">'exp'</span>)<font></font>
    exp_samp.append(list(nr[<span class="hljs-string">'exp'</span>]))<font></font>
    vproc_samp.append(list(nr[<span class="hljs-string">'vproc'</span>]))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ループを追加して、このランダムサンプルからグラフを作成します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(exp_samp)):<font></font>
    ax1.plot(exp_samp[i], vproc_samp[i], <span class="hljs-string">'.'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これですべての準備が整いました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uj/0h/ee/uj0hee9v0tujesawdjz41fmfp0u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、それは難しくありません。しかし、1つの問題があります。計算するには</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">経験</font><font style="vertical-align: inherit;">サイクルでは、ほとんど20万あるすべての名前は、8時間かかります。小さなサンプルでアルゴリズムをデバッグし、夜の計算を実行する必要がありました。原則として、これは一度だけ行うことができますが、何らかのエラーを発見したり、何かを変更したりして、再度それを数える必要がある場合は、負担がかかり始めます。そのため、夕方にレポートを発行しようとしたときに、再びすべてを再計算する必要があることがわかりました。朝まで待つことは私の計画の一部ではありませんでした、そして私は計算をより速くする方法を探し始めました。並列化することを決定しました。</font><i><font style="vertical-align: inherit;">マルチプロセッシングで</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
これを行う方法がどこかで見つかりました</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">Windowsで作業するには、各並列タスクのメインロジックを個別の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">workers.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル</font><font style="vertical-align: inherit;">に配置する必要がありました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> pickle <span class="hljs-keyword">as</span> pkl<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">worker</span>(<span class="hljs-params">args</span>):</span>
    names = args[<span class="hljs-number">0</span>]<font></font>
    ars=args[<span class="hljs-number">1</span>]<font></font>
    num=args[<span class="hljs-number">2</span>]<font></font>
    ars = ars.sort_values(by=<span class="hljs-string">'name'</span>)<font></font>
    ars = ars.reset_index(drop=<span class="hljs-literal">True</span>)  <font></font>
<font></font>
    <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> names:   <font></font>
        ind = ars[ars[<span class="hljs-string">'name'</span>] == n].index <font></font>
        yos = ars.loc[ind, <span class="hljs-string">'year'</span>].min()<font></font>
        ars.loc[ind, <span class="hljs-string">'exp'</span>] = ars.loc[ind, <span class="hljs-string">'year'</span>] - yos + <span class="hljs-number">1</span>                      <font></font>
<font></font>
    <span class="hljs-keyword">with</span> open(<span class="hljs-string">r'D:\tri\par\prog'</span> + str(num) + <span class="hljs-string">'.pkl'</span>, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> f:<font></font>
        pkl.dump(ars,f)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
手順は名の部分に転送される</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名前</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部datafreymaの、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AR</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のみこれらの名前で、及び並列タスクのシリアル番号- </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NUM</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">計算はデータフレームに書き込まれ、最後にデータフレームがファイルに書き込まれます。</font><font style="vertical-align: inherit;">この</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">worker</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を呼び出すラップトップでは</font><font style="vertical-align: inherit;">、それに応じて引数を準備します。</font></font><br>
<br>
<pre><code class="python hljs">num_proc = <span class="hljs-number">8</span> <span class="hljs-comment">#number of processors</span><font></font>
args = []<font></font>
<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(num_proc):<font></font>
    step = int(len(names_samp)/num_proc) + <span class="hljs-number">1</span>
    names_i = names_samp[i*step:min((i+<span class="hljs-number">1</span>)*step, len(names_samp))]<font></font>
    ars_i = ars[ars[<span class="hljs-string">'name'</span>].isin(names_i)]<font></font>
    args.append([names_i, ars_i, i])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
並列計算を開始します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Pool
<span class="hljs-keyword">import</span> workers<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ ==  <span class="hljs-string">'__main__'</span>:     <font></font>
    p=Pool(processes = num_proc)<font></font>
    p.map(workers.worker,args)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして最後に、ファイルから結果を読み取り、断片をデータフレーム全体に戻します。</font></font><br>
<br>
<pre><code class="python hljs">ars=pd.DataFrame(columns = ars.columns)<font></font>
<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(num_proc):
    <span class="hljs-keyword">with</span> open(<span class="hljs-string">r'D:\tri\par\prog'</span>+str(i)+<span class="hljs-string">'.pkl'</span>, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> f:    <font></font>
        arsi = pkl.load(f)<font></font>
        print(len(arsi))<font></font>
        ars = pd.concat([ars, arsi])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、40倍の加速度を得ることができ、8時間ではなく11分で計算を完了し、その日のレポートを公開することができました。同時に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">並列化する方法を学びました</font><font style="vertical-align: inherit;">が、重宝すると思います。ここでは、各タスクが小さなデータフレームを使用するという事実により、加速がコア数の8倍以上であることがわかりました。これにより、検索が高速になります。原則として、逐次計算はこの方法で高速化できますが、問題は、どのように推測するかです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、落ち着くことができず、出版後も、</font><i><font style="vertical-align: inherit;">パンダシリーズデータ</font></i><font style="vertical-align: inherit;">フレームの列全体に対する操作であるベクトル化を使用した計算方法を常に考えていました。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このような計算は、スーパークラスターであっても、並列化されたサイクルよりも桁違いに高速です。</font><font style="vertical-align: inherit;">そして思いついた。</font><font style="vertical-align: inherit;">それぞれの名前がキャリアの始まりの年を見つけるためには、逆にそれが必要であることがわかります-毎年、それで始まった参加者を見つけることです。</font><font style="vertical-align: inherit;">これを行うには、最初にサンプルから最初の年のすべての名前を特定する必要があります。これは2010です。したがって、これらの名前を持つすべてのレコードを今年を使用して処理します。</font><font style="vertical-align: inherit;">次に、次の年</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-2011を使用します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ここでも、今年のエントリを持つすべての名前を検索しますが、それらから未処理の名前、つまり2010年に満たされず、2011年にそれらを使用して処理された名前のみを取得します。</font><font style="vertical-align: inherit;">残りの年も同様です。</font><font style="vertical-align: inherit;">同じサイクルですが、20万回ではなく、合計9回です。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> range(ars[<span class="hljs-string">'year'</span>].min(),ars[<span class="hljs-string">'year'</span>].max()):<font></font>
    arsynp = ars[(ars[<span class="hljs-string">'exp'</span>] == <span class="hljs-string">''</span>) &amp; (ars[<span class="hljs-string">'year'</span>] == y)] <span class="hljs-comment">#arsynp - all records selected for year not processed</span>
    namesy = arsynp[<span class="hljs-string">'name'</span>].unique()<font></font>
    ind = ars[ars[<span class="hljs-string">'name'</span>].isin(namesy)].index<font></font>
    ars.loc[ind, <span class="hljs-string">'exp'</span>] = ars.loc[ind,<span class="hljs-string">'year'</span>] - y + <span class="hljs-number">1</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このサイクルは数秒で完了します。</font><font style="vertical-align: inherit;">そして、コードははるかに簡潔であることがわかりました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、ようやく、多くの作業が完了しました。私にとって、これは実際、その種の最初のプロジェクトでした。私がそれを取ったとき、主な目標はpythonとそのライブラリを使用して練習することでした。このタスクは完了しました。そして、結果自体はかなり印象的でした。完了時に私はどのような結論を導きましたか？</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まず、</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データが不完全です。これはおそらく、ほとんどすべての分析タスクに当てはまります。それらが完全に構造化されていて、多くの場合異なって発生する場合でも、特性の計算と傾向の検索を開始する前にそれらをいじくり回す準備をする必要があります-エラー、異常値、標準からの逸脱などを見つけます</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どのタスクにも解決策があります。これはスローガンに似ていますが、多くの場合そうです。このソリューションはそれほど明白ではなく、データ自体にあるのではなく、いわばボックスの外側にあるだけです。例として-上記の参加者の名前の処理、またはWebサイトのスクレイピング。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第三に、</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドメインの知識が重要です。これにより、データをより適切に準備し、明らかに無効または非標準のデータを削除し、解釈エラーを回避し、データにない情報（このプロジェクトの距離など）を使用し、愚かで誤った結論を避けながら、コミュニティで受け入れられた形式で結果を提示することができます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4番目：</font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">Pythonで</font></i><font style="vertical-align: inherit;">作業するには</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">豊富なツールセットがあります。時々それは何かについて考える価値があるように思われます、あなたは検索を始めます-それはすでに存在しています。これは素晴らしいです！この貢献、特にここで役立つツールについて、作成者に感謝します。</font><font style="vertical-align: inherit;">スクレイピングの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セレン</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ISO標準に従って国コードを決定する</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pycountry</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、オリンピックコードの</font><i><font style="vertical-align: inherit;">国コード（datahub）</font></i><font style="vertical-align: inherit;">、住所の座標を決定する</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">geopy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">folium</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -ジオデータの視覚化、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性別推測</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -名前の分析、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マルチプロセッシング</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -並列計算、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matplotlib</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">numpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、そしてもちろん</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パンダ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -それなしではどこにも行くことができません</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ベクトル化が私たちのすべてです。組み込みの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パンダ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ツールを使用できることは非常に重要</font><font style="vertical-align: inherit;">です。非常に効果的です。ほとんどの場合、レコード数が数万から測定される場合、このスキルは単に必要になると思います。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6番目：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データの処理は悪い考えです。手作業による介入を最小限に抑える必要があります。まず、スケーリングが行われません。つまり、データ量が数倍に増加すると、手動処理の時間が増加して許容できない値になり、次に、再現性が低下します。何かを忘れて、どこかで間違いを犯します。すべてがプログラマティックであり、ソフトウェアソリューションの一般的な標準から外れた場合でも、データの一部を犠牲にしても問題はありません。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7番目：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードは正常に動作している必要があります。それはもっと明白かもしれないようです！実際、このコードの結果を公開することを目的とした独自のコードについては、すべてがそれほど厳密ではありません。私はJupiter Notebooksで作業していましたが、この環境では、統合ソフトウェア製品を作成する必要はありません。行単位で区分的に起動するように構成されています。これには、開発、デバッグ、実行を同時に行うことができるという利点があります。しかし、多くの場合、</font><i><font style="vertical-align: inherit;">def</font></i><font style="vertical-align: inherit;">を複製したりラップしたりするのではなく、いくつかの行を編集して新しい結果をすばやく取得したいという誘惑があります。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。もちろん、そのような誘惑は避けるべきです。少なくとも1つの分析作業で何度も立ち上げが行われ、最初の時間を投資することで将来的に確実に成果が上がるため、少なくとも「自分用」であっても、良いコードを目指して努力する必要があります。また、ラップトップでも、重要なパラメーターのチェックと例外のスローという形でテストを追加できます。これは非常に便利です。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">より頻繁に保存します。各ステップで、ファイルの新しいバージョンを保存しました。合計すると、約10であることがわかりました。これは、エラーが検出されたときに、どの段階で発生したかをすばやく判断するのに役立つため、便利です。さらに、ソースデータを</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未加工と</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マークされた列に保存しました。</font><font style="vertical-align: inherit;">これにより、結果をすばやく確認して不一致を確認できます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第九：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">時間の投資と結果を測定する必要があります。一部の場所では、データの復元に非常に長い時間がかかりました。これは、全体の数分の1に相当します。実際、これは意味をなさず、単に捨てるだけで十分でした。そして、それが自動トレーニングではなく商用プロジェクトであるなら、そうします。これにより、結果をより速く取得できます。パレートの原理がここで機能します-結果の80％が時間の20％で達成されます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして最後のもの：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そのようなプロジェクトに取り組むことは、視野を大きく広げます。</font><font style="vertical-align: inherit;">喜んで、あなたは何か新しいことを学びます-例えば、ピトケアン諸島のような奇妙な国の名前-スイスのISOコードはCHEであるというラテン語の "Confoederatio Helvetica"から、スペインの名前は、実際にはトライアスロン自体について-レコード、その所有者、レースの場所、イベントの履歴など。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく十分です。</font><font style="vertical-align: inherit;">それで全部です。</font><font style="vertical-align: inherit;">最後まで読んでくださった皆さん、ありがとうございました！</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja500150/index.html">ROSとニューラルグリッド乞食ロボット</a></li>
<li><a href="../ja500152/index.html">1CでPOSターミナルとFR IKKM-Touchを統合する方法：エンタープライズ</a></li>
<li><a href="../ja500154/index.html">機密の機械学習。PySyftライブラリ</a></li>
<li><a href="../ja500158/index.html">SwiftUIとReduxの相互作用</a></li>
<li><a href="../ja500160/index.html">視覚的要素</a></li>
<li><a href="../ja500164/index.html">家庭教師：職業費用</a></li>
<li><a href="../ja500170/index.html">ネットワークシミュレータチュートリアルns-3。第6章</a></li>
<li><a href="../ja500178/index.html">Andrew Unの本、機械学習への情熱、38章と39章の翻訳</a></li>
<li><a href="../ja500184/index.html">David O'Brien（Xirus）：メトリクス！指標！指標！パート2</a></li>
<li><a href="../ja500186/index.html">HackTheBox。OpenAdminのウォークスルー。OpenNetAdminのRCEおよびnanoのGTFOBins</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>