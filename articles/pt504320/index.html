<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📖 👉🏻 🖕🏾 Validação de código de linha única ou Nethermind usando o PVS-Studio C # para Linux 👐🏻 ♍️ 👲🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este artigo é dedicado ao lançamento do teste beta do PVS-Studio C # para Linux, bem como do plug-in para Rider. Por um motivo tão maravilhoso, usando...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Validação de código de linha única ou Nethermind usando o PVS-Studio C # para Linux</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/504320/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b64/5fc/72d/b645fc72ddcded21612bdc5e9fac2c78.png" alt="Imagem 1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este artigo é dedicado ao lançamento do teste beta do PVS-Studio C # para Linux, bem como do plug-in para Rider. </font><font style="vertical-align: inherit;">Por um motivo tão maravilhoso, usando essas ferramentas, verificamos o código-fonte do produto Nethermind e, neste artigo, veremos erros interessantes e às vezes engraçados.</font></font><br>
<a name="habracut"></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nethermind</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é um cliente rápido para o .NET Core Ethereum para Linux, Windows, MacOs. </font><font style="vertical-align: inherit;">Pode ser usado em projetos ao configurar redes privadas Ethereum ou dApps. </font><font style="vertical-align: inherit;">Nethermind é um software </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">livre</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> localizado no GitHub. </font><font style="vertical-align: inherit;">O projeto foi fundado em 2017 e está em constante evolução.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introdução</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você gosta de trabalho manual? Por exemplo, como encontrar erros no código do programa. Concordo, é bastante entediante ler e analisar o site que você escreveu ou o projeto inteiro em busca de algum bug complicado. Bem, se o projeto for pequeno, digamos 5.000 linhas, mas se seu tamanho já excedeu cem mil ou um milhão de linhas? Além disso, foi escrito por diferentes programadores e, às vezes, não de forma muito digerível. O que fazer neste caso? Você realmente precisa dormir em algum lugar, em algum lugar subestimado e 100% do seu tempo para perceber todas essas intermináveis ​​linhas para entender onde está esse erro desagradável? Duvido que você gostaria de fazer isso. Então, o que fazer, talvez haja meios modernos para automatizar isso de alguma forma?</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/34f/9eb/338/34f9eb3387d61eb4ebfa67f0dbccbef7.png" alt="Figura 3"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E então uma ferramenta como um analisador de código estático entra em jogo. </font><font style="vertical-align: inherit;">O analisador estático é uma ferramenta para detectar defeitos no código fonte dos programas. </font><font style="vertical-align: inherit;">A vantagem desta ferramenta sobre a verificação manual é a seguinte:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quase não gasta seu tempo procurando a localização do erro (pelo menos é definitivamente mais rápido do que procurar a falha de copiar e colar com seus olhos);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">não se cansa, ao contrário de uma pessoa que, após algum tempo de busca, precisa descansar;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conhece muitos padrões de erro dos quais uma pessoa pode nem estar ciente; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utiliza tecnologias como: análise de fluxo de dados, execução simbólica, correspondência de padrões e outras;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permite que você analise regularmente e a qualquer momento;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etc.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, o uso de um analisador de código estático não substitui ou cancela as revisões de código. </font><font style="vertical-align: inherit;">Mas as revisões de código estão se tornando mais produtivas e úteis. </font><font style="vertical-align: inherit;">Você pode se concentrar em encontrar erros de alto nível, na transferência de conhecimento, em vez de se cansar de ler o código em busca de erros de digitação. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você ficou interessado em ler mais sobre isso, sugiro o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seguinte artigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , bem como um artigo sobre as </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tecnologias</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usadas no PVS-Studio.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio C # para Linux / macOS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No momento, estamos portando nosso analisador de C # para o .NET Core e também estamos desenvolvendo ativamente um plug-in para o IDE Rider. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você estiver interessado, pode se inscrever para um teste beta preenchendo o formulário </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nesta página</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">As instruções de instalação serão enviadas para o seu e-mail (não se preocupe, é muito simples), além de uma licença para usar o analisador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
É assim que o Rider se parece com o plug-in PVS-Studio:</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/rp/p6/f_/rpp6f_9oohudg2ov2jt-hdu0yg0.png" alt="Quadro 4"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um pouco de indignação</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quero dizer que em alguns lugares foi muito difícil ler o código fonte do Nethermind, porque nele linhas de 300 a 500 caracteres são bastante normais. </font><font style="vertical-align: inherit;">Sim, é todo o código sem formatar em 1 linha. </font><font style="vertical-align: inherit;">E essas linhas, por exemplo, contêm vários operadores ternários e operadores lógicos, e não há nada lá. </font><font style="vertical-align: inherit;">Em geral, prazer a partir da última temporada do jogo dos tronos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vou explicar um pouco para entender o escopo. </font><font style="vertical-align: inherit;">Eu tenho um monitor UltraWide com um comprimento de cerca de 82 centímetros. </font><font style="vertical-align: inherit;">Se você abrir o IDE em tela cheia, ele terá cerca de 340 caracteres. </font><font style="vertical-align: inherit;">Ou seja, as falas das quais estou falando nem se encaixam. </font><font style="vertical-align: inherit;">Se você quiser ver como fica, deixei links para arquivos no GitHub: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo 1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogBlockAuthorNicely</span>(<span class="hljs-params">Block block, ISyncPeer syncPeer</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">string</span> authorString = (block.Author == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : <span class="hljs-string">"sealed by "</span> +<font></font>
(KnownAddresses.GoerliValidators.ContainsKey(block.Author) ?<font></font>
KnownAddresses.GoerliValidators[block.Author] : block.Author?.ToString())) ??<font></font>
(block.Beneficiary == <span class="hljs-literal">null</span> ? <span class="hljs-keyword">string</span>.Empty : <span class="hljs-string">"mined by "</span> +<font></font>
(KnownAddresses.KnownMiners.ContainsKey(block.Beneficiary) ?<font></font>
KnownAddresses.KnownMiners[block.Beneficiary] : block.Beneficiary?.ToString()));<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (_logger.IsInfo) _logger.Info(<span class="hljs-string">$"Discovered a new block
<span class="hljs-subst">{<span class="hljs-keyword">string</span>.Empty.PadLeft(<span class="hljs-number">9</span> - block.Number.ToString().Length, <span class="hljs-string">'
'</span>)}</span><span class="hljs-subst">{block.ToString(Block.Format.HashNumberAndTx)}</span> <span class="hljs-subst">{authorString}</span>, sent by
<span class="hljs-subst">{syncPeer:s}</span>"</span>);<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
→ </font><b><font style="vertical-align: inherit;">Exemplo 2 do </font></b></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link do arquivo</font></font></a><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">BuildTransitions</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    releaseSpec.IsEip1283Enabled = (_chainSpec.Parameters.Eip1283Transition ??<font></font>
<span class="hljs-keyword">long</span>.MaxValue) &lt;= releaseStartBlock &amp;&amp;<font></font>
((_chainSpec.Parameters.Eip1283DisableTransition ?? <span class="hljs-keyword">long</span>.MaxValue) <font></font>
&gt; releaseStartBlock || (_chainSpec.Parameters.Eip1283ReenableTransition ??<font></font>
<span class="hljs-keyword">long</span>.MaxValue) &lt;= releaseStartBlock);           <font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
→ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link para o arquivo</font></font></a><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> 
<span class="hljs-title">Will_not_reject_block_with_bad_total_diff_but_will_reset_diff_to_null</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    _syncServer = <span class="hljs-keyword">new</span> SyncServer(<span class="hljs-keyword">new</span> StateDb(), <span class="hljs-keyword">new</span> StateDb(), localBlockTree,<font></font>
NullReceiptStorage.Instance, <span class="hljs-keyword">new</span> BlockValidator(Always.Valid, <span class="hljs-keyword">new</span><font></font>
HeaderValidator(localBlockTree, Always.Valid, MainnetSpecProvider.Instance,<font></font>
LimboLogs.Instance), Always.Valid, MainnetSpecProvider.Instance, <font></font>
LimboLogs.Instance), Always.Valid, _peerPool, StaticSelector.Full, <font></font>
<span class="hljs-keyword">new</span> SyncConfig(), LimboLogs.Instance);<font></font>
    ...     <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
→ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link para o arquivo</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Agora, imagine que ocorra um erro nessa seção, será agradável procurá-lo? </font><font style="vertical-align: inherit;">Tenho certeza de que não, e todo mundo entende que é impossível escrever assim. </font><font style="vertical-align: inherit;">E, a propósito, há um lugar semelhante com um erro neste projeto.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resultados da validação</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Condições que não gostam de 0</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Condição 1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> ReceiptsMessage <span class="hljs-title">Deserialize</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] bytes</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (bytes.Length == <span class="hljs-number">0</span> &amp;&amp; bytes[<span class="hljs-number">0</span>] == Rlp.OfEmptySequence[<span class="hljs-number">0</span>])
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ReceiptsMessage(<span class="hljs-literal">null</span>);<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warning: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3106</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Possivelmente, o índice está fora do limite. </font><font style="vertical-align: inherit;">O índice '0' está apontando além do limite de 'bytes'. </font><font style="vertical-align: inherit;">Nethermind.Network ReceiptsMessageSerializer.cs 50 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para observar um erro, considere o caso quando o número de elementos na matriz for 0. Em seguida, a condição </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bytes.Length == 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> será verdadeira e uma </font><i><font style="vertical-align: inherit;">indexOutOfRangeException do tipo 0</font></i><font style="vertical-align: inherit;"> será </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lançada</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ao acessar o elemento da matriz </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eles queriam sair desse método imediatamente se a matriz estiver vazia ou o elemento 0 for igual a um determinado valor, mas parece que eles acidentalmente misturaram "||" </font><font style="vertical-align: inherit;">com "&amp;&amp;". </font><font style="vertical-align: inherit;">Proponho corrigir esse problema da seguinte maneira:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> ReceiptsMessage <span class="hljs-title">Deserialize</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] bytes</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (bytes.Length == <span class="hljs-number">0</span> || bytes[<span class="hljs-number">0</span>] == Rlp.OfEmptySequence[<span class="hljs-number">0</span>])
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ReceiptsMessage(<span class="hljs-literal">null</span>);<font></font>
    ...<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Condição 2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DiscoverAll</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    Type? GetStepType(Type[] typesInGroup)<font></font>
    {<font></font>
        Type? GetStepTypeRecursive(Type? contextType)<font></font>
        {<font></font>
            ...<font></font>
        }<font></font>
        ...<font></font>
        <span class="hljs-keyword">return</span> typesInGroup.Length == <span class="hljs-number">0</span> ? typesInGroup[<span class="hljs-number">0</span>] :<font></font>
               GetStepTypeRecursive(_context.GetType());<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warning: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3106</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Possivelmente, o índice está fora do limite. </font><font style="vertical-align: inherit;">O índice '0' está apontando além do limite 'typesInGroup'. </font><font style="vertical-align: inherit;">Nethermind.Runner EthereumStepsManager.cs 70 Ocorre </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
uma situação semelhante à descrita acima. </font><font style="vertical-align: inherit;">Se o número de elementos em </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typesInGroup</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for igual a 0, ao acessar o elemento 0, uma exceção do tipo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexOutOfRangeException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> será </font><i><font style="vertical-align: inherit;">lançada</font></i><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Somente neste caso eu não entendo o que o desenvolvedor queria. </font><font style="vertical-align: inherit;">Provavelmente, em vez de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typesInGroup [0],</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> você precisa escrever </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erro ou otimização inacabada?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DeleteBlocks</span>(<span class="hljs-params">Keccak deletePointer</span>)</span><font></font>
{<font></font>
   ...<font></font>
   <span class="hljs-keyword">if</span> (currentLevel.BlockInfos.Length == <span class="hljs-number">1</span>)<font></font>
   {<font></font>
      shouldRemoveLevel = <span class="hljs-literal">true</span>;<font></font>
   }<font></font>
   <span class="hljs-keyword">else</span><font></font>
   {<font></font>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; currentLevel.BlockInfos.Length; i++)<font></font>
      {<font></font>
         <span class="hljs-keyword">if</span> (currentLevel.BlockInfos[<span class="hljs-number">0</span>].BlockHash == currentHash) <span class="hljs-comment">// &lt;=</span><font></font>
         {<font></font>
            currentLevel.BlockInfos = currentLevel.BlockInfos<font></font>
                                      .Where(bi =&gt; bi.BlockHash != currentHash)<font></font>
                                      .ToArray();<font></font>
            <span class="hljs-keyword">break</span>;<font></font>
         }<font></font>
      }<font></font>
   }<font></font>
   ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warning: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3102</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Acesso suspeito ao elemento do objeto 'currentLevel.BlockInfos' por um índice constante dentro de um loop. Nethermind.Blockchain BlockTree.cs 895 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À primeira vista, o erro é óbvio - o loop visa </font><font style="vertical-align: inherit;">iterar sobre os </font><font style="vertical-align: inherit;">elementos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentLevel.BlockInfos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas ao acessar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentLevel.BlockInfos [i], eles</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escreveram </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentLevel.BlockInfos [0]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Fixamos 0 em </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ie</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a missão está concluída. Mas não se apresse, vamos descobrir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, </font><i><font style="vertical-align: inherit;">acessamos </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Length</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BlockHash do</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> elemento nulo. Se for igual a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentHash</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><i><font style="vertical-align: inherit;">removeremos</font></i><font style="vertical-align: inherit;"> de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentLevel.BlockInfos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> todos os elementos que não são iguais</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentHash</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , escreva para ele e saia do loop. </font><font style="vertical-align: inherit;">Acontece que o ciclo é supérfluo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu acho que anteriormente havia um algoritmo que eles decidiram alterar / otimizar usando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">linq</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas algo deu errado. </font><font style="vertical-align: inherit;">Agora, no caso em que a condição é falsa, obtemos iterações sem sentido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A propósito, se o desenvolvedor que escreveu isso usasse o modo de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">análise incremental</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ele imediatamente percebeu que algo estaria errado e teria consertado tudo rapidamente. </font><font style="vertical-align: inherit;">No momento, eu reescreveria o código assim:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DeleteBlocks</span>(<span class="hljs-params">Keccak deletePointer</span>)</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (currentLevel.BlockInfos.Length == <span class="hljs-number">1</span>)<font></font>
    {<font></font>
        shouldRemoveLevel = <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        currentLevel.BlockInfos = currentLevel.BlockInfos<font></font>
                                  .Where(bi =&gt; bi.BlockHash != currentHash)<font></font>
                                  .ToArray();<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desreferenciando referência nula</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dereferencing 1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Sign</span>(<span class="hljs-params">Transaction tx, <span class="hljs-keyword">int</span> chainId</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsDebug)<font></font>
        _logger?.Debug(<span class="hljs-string">$"Signing transaction: <span class="hljs-subst">{tx.Value}</span> to <span class="hljs-subst">{tx.To}</span>"</span>);<font></font>
    IBasicWallet.Sign(<span class="hljs-keyword">this</span>, tx, chainId);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aviso do PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O objeto '_logger' foi usado antes de ser verificado com valor nulo. Verifique as linhas: 118, 118. Nethermind.Wallet DevKeyStoreWallet.cs 118 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erro na sequência errada. Primeiro, há um recurso para </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_logger.IsDebug</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e somente depois disso é </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_logger verificado</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Portanto, no caso em que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_logger</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , obtemos uma exceção do tipo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desreferenciação 2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">BuildNodeInfo</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    _nodeInfo = <span class="hljs-keyword">new</span> NodeInfo();<font></font>
    _nodeInfo.Name = ClientVersion.Description;<font></font>
    _nodeInfo.Enode = _enode.Info;                           <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">byte</span>[] publicKeyBytes = _enode?.PublicKey?.Bytes;        <span class="hljs-comment">// &lt;=</span>
    _nodeInfo.Id = (publicKeyBytes == <span class="hljs-literal">null</span> ? Keccak.Zero :<font></font>
                   Keccak.Compute(publicKeyBytes)).ToString(<span class="hljs-literal">false</span>);<font></font>
    _nodeInfo.Ip = _enode?.HostIp?.ToString();<font></font>
    _nodeInfo.ListenAddress = <span class="hljs-string">$"<span class="hljs-subst">{_enode.HostIp}</span>:<span class="hljs-subst">{_enode.Port}</span>"</span>;<font></font>
    _nodeInfo.Ports.Discovery = _networkConfig.DiscoveryPort;<font></font>
    _nodeInfo.Ports.Listener = _networkConfig.P2PPort;<font></font>
    UpdateEthProtocolInfo();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warning: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O objeto '_enode' foi usado antes de ser verificado em relação a nulo. </font><font style="vertical-align: inherit;">Verifique as linhas: 55, 56. Nethermind.JsonRpc AdminModule.cs 55 O </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
erro é completamente o mesmo que o descrito acima, só que desta vez o culpado é </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_enode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quero acrescentar que, se você esqueceu de verificar se é nulo, lembre-se disso somente quando o programa travar. </font><font style="vertical-align: inherit;">O analisador lembrará você disso e tudo ficará bem.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nosso Copy-Paste favorito</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caso 1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Equals</span>(<span class="hljs-params"><span class="hljs-keyword">ref</span> UInt256 a, <span class="hljs-keyword">ref</span> UInt256 b</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">return</span> a.s0 == b.s0 &amp;&amp; a.s1 == b.s1 &amp;&amp; a.s2 == b.s2 &amp;&amp; a.s2 == b.s2;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warning: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3001</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Existem </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">subexpressões</font></a><font style="vertical-align: inherit;"> idênticas 'a.s2 == b.s2' à esquerda e à direita do operador '&amp;&amp;'. </font><font style="vertical-align: inherit;">Nethermind.Dirichlet.Numerics UInt256.cs 1154 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui a mesma condição é verificada 2 vezes:</font></font><br>
<br>
<pre><code class="cs hljs">a.s2 == b.s2</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma vez que os parâmetros </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> têm um campo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s3</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , presumo que ao copiar nós simplesmente esqueceu de mudança </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s3</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acontece que os parâmetros serão iguais com mais frequência do que o esperado pelo autor do código. Ao mesmo tempo, alguns desenvolvedores pensam que não fazem isso e começam a procurar um erro em um lugar completamente diferente, gastando muita energia e nervosismo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A propósito, erros nas funções de comparação são geralmente um clássico. Aparentemente, os programadores, considerando tais funções simples, se relacionam com a sua escrita de maneira muito casual e desatenta. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prova</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Sabendo disso, agora tenha cuidado :)! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caso 2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;ApiResponse&gt; 
<span class="hljs-title">PublishBlockAsync</span>(<span class="hljs-params">SignedBeaconBlock signedBlock,
                  CancellationToken cancellationToken</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">bool</span> acceptedLocally = <span class="hljs-literal">false</span>;<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (acceptedLocally)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ApiResponse(StatusCode.Success);<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ApiResponse(StatusCode.Success);<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warning: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3004</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">instrução</font></a><font style="vertical-align: inherit;"> 'then' é equivalente à instrução 'else'. Nethermind.BeaconNode BeaconNodeFacade.cs 177 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para qualquer valor do </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acceptedLocally</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> variável, o </font><font style="vertical-align: inherit;">método retorna a mesma. É difícil dizer se é um erro ou não. Suponha que um programador copiou uma linha e esqueceu de alterar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StatusCode.Success</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para outra coisa, então isso é um erro real. Além disso, o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StatusCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> possui </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InternalError</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidRequest</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Mas a refatoração de código é provavelmente a culpa e não se preocupam com o </font><i><font style="vertical-align: inherit;">acceptedLocally</font></i><font style="vertical-align: inherit;"> valor de qualquer maneira</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nesse caso, a condição se torna o lugar que faz você se sentar e pensar se é um erro ou não. </font><font style="vertical-align: inherit;">Portanto, em qualquer caso, este caso é extremamente desagradável. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caso 3</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">TearDown</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> testResult <span class="hljs-keyword">in</span> _results)<font></font>
    {<font></font>
         <span class="hljs-keyword">string</span> message = <span class="hljs-string">$"<span class="hljs-subst">{testResult.Order}</span>. <span class="hljs-subst">{testResult.Name}</span> has "</span> 
               + <span class="hljs-string">$"<span class="hljs-subst">{(testResult.Passed ? <span class="hljs-string">"passed [+]"</span> : <span class="hljs-string">"failed [-]"</span>)}</span>"</span>;
         <span class="hljs-keyword">if</span> (testResult.Passed)<font></font>
         {<font></font>
               TestContext.WriteLine(message);<font></font>
         }<font></font>
         <span class="hljs-keyword">else</span><font></font>
         {<font></font>
               TestContext.WriteLine(message);<font></font>
         }<font></font>
     }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warning: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3004</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">instrução</font></a><font style="vertical-align: inherit;"> 'then' é equivalente à instrução 'else'. </font><font style="vertical-align: inherit;">Nethermind.Overseer.Test TestBuilder.cs 46 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E novamente, não nos importamos com a verificação, porque no final obtemos a mesma coisa. </font><font style="vertical-align: inherit;">E, novamente, sentamos e sofremos, pensando, mas o que o desenvolvedor queria escrever aqui. </font><font style="vertical-align: inherit;">Um desperdício de tempo que poderia ter sido evitado usando análise estática e corrigindo imediatamente esse código ambíguo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caso 4</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Setup</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_decoderBuffer.ReadableBytes &gt; <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"decoder buffer"</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (_decoderBuffer.ReadableBytes &gt; <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"decoder buffer"</span>);<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warning: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3021</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Existem duas instruções 'if' com expressões condicionais idênticas. A primeira instrução 'if' contém retorno de método. Isso significa que a segunda declaração 'if' não faz sentido; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
basta pressionar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ctrl + V</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> novamente </font><font style="vertical-align: inherit;">. Removemos o excesso de verificação e está tudo bem. Tenho certeza de que, se alguma outra condição fosse importante aqui, todos escreveriam em uma </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> através do operador lógico I. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caso 5</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogBlockAuthorNicely</span>(<span class="hljs-params">Block block, ISyncPeer syncPeer</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
        {<font></font>
            ...<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warning: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3030</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Verificação recorrente. </font><font style="vertical-align: inherit;">A condição '_logger.IsInfo' já foi verificada na linha 242. Da </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mesma maneira que no quarto caso, uma verificação extra é executada. </font><font style="vertical-align: inherit;">No entanto, a diferença é que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_logger</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> não possui apenas uma propriedade, mas também, por exemplo, ' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bool IsError {get; </font><font style="vertical-align: inherit;">}</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '. </font><font style="vertical-align: inherit;">Portanto, o código provavelmente deve ficar assim:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogBlockAuthorNicely</span>(<span class="hljs-params">Block block, ISyncPeer syncPeer</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (!_logger.IsError) <span class="hljs-comment">// &lt;=</span><font></font>
        {<font></font>
            ...<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bem, ou toda a falha na refatoração do código e apenas uma verificação não é mais necessária. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caso 6</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (missingParamsCount != <span class="hljs-number">0</span>)<font></font>
{<font></font>
    <span class="hljs-keyword">bool</span> incorrectParametersCount = missingParamsCount != <span class="hljs-number">0</span>; <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">if</span> (missingParamsCount &gt; <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
PVS-Studio: </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">A</font></a><font style="vertical-align: inherit;"> expressão V3022 'missingParamsCount! = 0' sempre é verdadeira. </font><font style="vertical-align: inherit;">Nethermind.JsonRpc JsonRpcService.cs 127 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verifique a condição (missingParamsCount! = 0) e, se for verdadeira, calculamos novamente e atribuímos o resultado a uma variável. </font><font style="vertical-align: inherit;">Concorde que esta é uma maneira bastante original de escrever verdade.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cheque confuso</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-keyword">long</span>&gt; 
<span class="hljs-title">DownloadHeaders</span>(<span class="hljs-params">PeerInfo bestPeer, 
                BlocksRequest blocksRequest, 
                CancellationToken cancellation</span>)</span><font></font>
{<font></font>
  ...<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; headers.Length; i++)<font></font>
  {<font></font>
    ...<font></font>
    BlockHeader currentHeader = headers[i];<font></font>
    ...<font></font>
    <span class="hljs-keyword">bool</span> isValid = i &gt; <span class="hljs-number">1</span> ? <font></font>
        _blockValidator.ValidateHeader(currentHeader, headers[i - <span class="hljs-number">1</span>], <span class="hljs-literal">false</span>):<font></font>
        _blockValidator.ValidateHeader(currentHeader, <span class="hljs-literal">false</span>);<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (HandleAddResult(bestPeer, <font></font>
                        currentHeader, <font></font>
                        i == <span class="hljs-number">0</span>,                              <span class="hljs-comment">// &lt;=</span><font></font>
                        _blockTree.Insert(currentHeader))) <font></font>
    {<font></font>
       headersSynced++;<font></font>
    }<font></font>
<font></font>
    ...<font></font>
  }<font></font>
  ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
PVS-Studio: </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">A</font></a><font style="vertical-align: inherit;"> expressão </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">V3022</font></a><font style="vertical-align: inherit;"> 'i == 0' é sempre falsa. </font><font style="vertical-align: inherit;">Nethermind.Synchronization BlockDownloader.cs 192 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos começar em ordem. </font><font style="vertical-align: inherit;">Ao inicializar, a variável </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> recebe o valor 1. Em seguida, a variável é incrementada apenas, portanto, o valor sempre será passado para a função </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos dar uma olhada no </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HandleAddResult</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">HandleAddResult</span>(<span class="hljs-params">PeerInfo peerInfo, 
                             BlockHeader block,
                             <span class="hljs-keyword">bool</span> isFirstInBatch, 
                             AddBlockResult addResult</span>)</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (isFirstInBatch)<font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui estamos interessados ​​em </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isFirstInBatch</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A julgar pelo nome desse parâmetro, é responsável por saber se algo é o primeiro na parte. </font><font style="vertical-align: inherit;">Hum, primeiro. </font><font style="vertical-align: inherit;">Vamos olhar novamente acima e ver que existem 2 chamadas usando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs">BlockHeader currentHeader = headers[i];<font></font>
_blockValidator.ValidateHeader(currentHeader, headers[i - <span class="hljs-number">1</span>], <span class="hljs-literal">false</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Não se esqueça que a contagem regressiva, neste caso, passa de 1. Acontece que temos 2 opções: ou a “primeira” significa um elemento no índice 1 ou no índice 0. Mas, em qualquer caso, isso </font><font style="vertical-align: inherit;">será igual a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I.</font></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Acontece que a chamada de função deve ficar assim:</font></font><br>
<br>
<pre><code class="cs hljs">HandleAddResult(bestPeer, currentHeader, <font></font>
                i == <span class="hljs-number">1</span>, _blockTree.Insert(currentHeader))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou assim:</font></font><br>
<br>
<pre><code class="cs hljs">HandleAddResult(bestPeer, currentHeader, <font></font>
                i - <span class="hljs-number">1</span> == <span class="hljs-number">0</span>, _blockTree.Insert(currentHeader))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, novamente, se um desenvolvedor usasse constantemente um analisador estático, ele escreveria esse código e veria um aviso, o corrigiria rapidamente e gozaria a vida. </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma prioridade ??</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Situação 1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> MemorySize<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">int</span> unaligned = (Keccak == <span class="hljs-literal">null</span> ? MemorySizes.RefSize : <font></font>
        MemorySizes.RefSize + Keccak.MemorySize) <font></font>
        + (MemorySizes.RefSize + FullRlp?.Length <font></font>
                                 ?? MemorySizes.ArrayOverhead)   <span class="hljs-comment">// &lt;=</span><font></font>
        + (MemorySizes.RefSize + _rlpStream?.MemorySize <font></font>
                                 ?? MemorySizes.RefSize)         <span class="hljs-comment">// &lt;=</span><font></font>
        + MemorySizes.RefSize + (MemorySizes.ArrayOverhead + _data?.Length <font></font>
        * MemorySizes.RefSize ?? MemorySizes.ArrayOverhead) <font></font>
        + MemorySizes.SmallObjectOverhead + (Key?.MemorySize ?? <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> MemorySizes.Align(unaligned);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avisos do PVS-Studio: </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123 Talvez o '??' </font><font style="vertical-align: inherit;">O operador trabalha de uma maneira diferente da esperada. </font><font style="vertical-align: inherit;">Sua prioridade é menor que a prioridade de outros operadores na parte esquerda. </font><font style="vertical-align: inherit;">Nethermind.Trie TrieNode.cs 43</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123 Talvez o '??' </font><font style="vertical-align: inherit;">O operador trabalha de uma maneira diferente da esperada. </font><font style="vertical-align: inherit;">Sua prioridade é menor que a prioridade de outros operadores na parte esquerda. </font><font style="vertical-align: inherit;">Nethermind.Trie TrieNode.cs 44</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O analisador aconselha que você verifique como usamos os operadores "??" e, para entender qual é o problema, proponho considerar a seguinte situação. </font><font style="vertical-align: inherit;">Nós olhamos para esta linha aqui:</font></font><br>
<br>
<pre><code class="cs hljs">(MemorySizes.RefSize + FullRlp?.Length ?? MemorySizes.ArrayOverhead)</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.RefSize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.ArrayOverhead</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> são constantes:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MemorySizes</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> RefSize = <span class="hljs-number">8</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> ArrayOverhead = <span class="hljs-number">20</span>;<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, para maior clareza, proponho reescrever a string, substituindo seus valores:</font></font><br>
<br>
<pre><code class="cs hljs">(<span class="hljs-number">8</span> + FullRlp?.Length ?? <span class="hljs-number">20</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, suponha que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FullRlp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> seja </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Então </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(8 + nulo)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> será nulo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Em seguida, obtemos a expressão ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null ?? 20</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), que retornará 20. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acontece que, desde que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FullRlp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> seja </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o valor de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.ArrayOverhead</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sempre será retornado, </font><font style="vertical-align: inherit;">independentemente do que estiver armazenado em </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.RefSize.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O fragmento na linha abaixo é semelhante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas a questão é: o desenvolvedor queria esse comportamento? Vejamos a seguinte linha:</font></font><br>
<br>
<pre><code class="cs hljs">MemorySizes.RefSize + (MemorySizes.ArrayOverhead <font></font>
    + _data?.Length * MemorySizes.RefSize ?? MemorySizes.ArrayOverhead) </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, como nas seções consideradas acima, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.RefSize é</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adicionado à expressão, mas </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
observe que após o primeiro operador "+", há um colchete. </font><font style="vertical-align: inherit;">Acontece que </font><font style="vertical-align: inherit;">devemos adicionar alguma expressão </font><font style="vertical-align: inherit;">ao </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.RefSize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e, se for </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , adicionaremos outra. </font><font style="vertical-align: inherit;">Portanto, o código deve ficar assim:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> MemorySize<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">int</span> unaligned = (Keccak == <span class="hljs-literal">null</span> ? MemorySizes.RefSize : <font></font>
       MemorySizes.RefSize + Keccak.MemorySize) <font></font>
       + (MemorySizes.RefSize + (FullRlp?.Length <font></font>
                                 ?? MemorySizes.ArrayOverhead))    <span class="hljs-comment">// &lt;=</span><font></font>
       + (MemorySizes.RefSize + (_rlpStream?.MemorySize <font></font>
                                 ?? MemorySizes.RefSize))          <span class="hljs-comment">// &lt;=</span><font></font>
       + MemorySizes.RefSize + (MemorySizes.ArrayOverhead + _data?.Length <font></font>
       * MemorySizes.RefSize ?? MemorySizes.ArrayOverhead) <font></font>
       + MemorySizes.SmallObjectOverhead + (Key?.MemorySize ?? <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> MemorySizes.Align(unaligned);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Novamente, isso é apenas uma suposição, no entanto, se o desenvolvedor quiser um comportamento diferente, você deve indicar explicitamente isso:</font></font><br>
<br>
<pre><code class="cs hljs">((MemorySizes.RefSize + FullRlp?.Length) ?? MemorySizes.ArrayOverhead)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E então, quem lê esse código não precisa se aprofundar por muito tempo no que está acontecendo aqui e no que o programador queria. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Situação 2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task&lt;JsonRpcResponse&gt; 
<span class="hljs-title">ExecuteAsync</span>(<span class="hljs-params">JsonRpcRequest request, 
             <span class="hljs-keyword">string</span> methodName,
             (MethodInfo Info, <span class="hljs-keyword">bool</span> ReadOnly</span>) method)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> expectedParameters = method.Info.GetParameters();
    <span class="hljs-keyword">var</span> providedParameters = request.Params;<font></font>
    ...<font></font>
    <span class="hljs-keyword">int</span> missingParamsCount = expectedParameters.Length <font></font>
            - (providedParameters?.Length ?? <span class="hljs-number">0</span>) <font></font>
            + providedParameters?.Count(<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace) ?? <span class="hljs-number">0</span>; <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">if</span> (missingParamsCount != <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aviso do PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Talvez o '??' </font><font style="vertical-align: inherit;">O operador trabalha de uma maneira diferente da esperada. </font><font style="vertical-align: inherit;">Sua prioridade é menor que a prioridade de outros operadores na parte esquerda. </font><font style="vertical-align: inherit;">Nethermind.JsonRpc JsonRpcService.cs 123 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E novamente, a prioridade da operação é "??", portanto, como na última vez, consideramos a situação. </font><font style="vertical-align: inherit;">Nós olhamos para esta linha aqui:</font></font><br>
<br>
<pre><code class="cs hljs">expectedParameters.Length <font></font>
            - (providedParameters?.Length ?? <span class="hljs-number">0</span>) <font></font>
            + providedParameters?.Count(<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace) ?? <span class="hljs-number">0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suponha que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fornecidoParameters</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> seja </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , para maior clareza, substitua imediatamente tudo relacionado a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fornecidoParameters</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> por </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font><font style="vertical-align: inherit;">substitua um valor aleatório em </font><font style="vertical-align: inherit;">vez </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">depectedParameters.Length</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-number">100</span> - (<span class="hljs-literal">null</span> ?? <span class="hljs-number">0</span>) + <span class="hljs-literal">null</span> ?? <span class="hljs-number">0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora é perceptível imediatamente que há duas verificações semelhantes, apenas em um caso há colchetes e no outro, em lá. Vamos executar este exemplo. Primeiro, obtemos que ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null ?? 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) retornará 0, subtraia 0 de 100 e obterá 100:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-number">100</span> + <span class="hljs-literal">null</span> ?? <span class="hljs-number">0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, em vez de executar primeiro " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null ?? 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " e finalmente obter ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100 + 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), ficamos completamente diferentes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro ele será executado ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100 + nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) e obteremos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Em seguida, verifica ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null ?? 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), o que leva ao fato de que o valor da variável missingParamsCount será 0. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como a próxima condição é que o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">missingParamsCount</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> seja </font><i><font style="vertical-align: inherit;">igual a</font></i><font style="vertical-align: inherit;"> zero, podemos assumir que esse é o comportamento que o desenvolvedor procurou. E eu digo: por que não colocar parênteses e expressar meus pensamentos explicitamente? Em geral, é possível que essa verificação tenha sido causada por um mal-entendido do motivo pelo qual 0 às vezes é retornado, e isso não passa de uma muleta.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, novamente, estamos perdendo tempo, embora não tenhamos feito isso; use o modo de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">análise incremental</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ao escrever código </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusão</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Concluindo, espero poder transmitir a você que o analisador estático é seu amigo, e não um superintendente do mal que está apenas esperando que você cometa um erro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deve-se também observar que, se você usar o analisador uma vez ou raramente, certamente encontrará erros e alguns deles serão rapidamente corrigidos, mas também haverá outros em que você precisará esmagar a cabeça. </font><font style="vertical-align: inherit;">Portanto, você precisa usar um analisador estático constantemente. </font><font style="vertical-align: inherit;">Em seguida, você encontrará muitos outros erros e os corrigirá no momento em que o código do programa for gravado e você entenderá exatamente o que está tentando fazer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A verdade simples é que todos cometem erros e isso é normal. </font><font style="vertical-align: inherit;">Todos aprendemos com os erros, mas apenas daqueles que foram capazes de perceber e entender. </font><font style="vertical-align: inherit;">Portanto, use ferramentas modernas para procurar esses mesmos erros, por exemplo - PVS-Studio. </font><font style="vertical-align: inherit;">Obrigado pela atenção.</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a></p><div style="text-align:center;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/eb2/f9c/3bb/eb2f9c3bb5f32f39239298d36431961c.png"></a></div><p></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você deseja compartilhar este artigo com um público que fala inglês, use o link para a tradução: Nikolay Mironov. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Código de linha única ou verificação do Nethermind usando o PVS-Studio C # para Linux</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt504296/index.html">Gerando ramificações aleatórias em Python</a></li>
<li><a href="../pt504306/index.html">Como é feito o hardware russo para armazenamento Aerodisk Vostok na Elbrus</a></li>
<li><a href="../pt504310/index.html">Dicotomia de dados: repensando a relação com dados e serviços</a></li>
<li><a href="../pt504312/index.html">Registro unificado de programas russos e GPL. Meus cinco centavos</a></li>
<li><a href="../pt504314/index.html">Implementação de comandos docker pull e docker push sem cliente docker via solicitações HTTP</a></li>
<li><a href="../pt504326/index.html">Evgeny Dikiy: “Localmente, a Antártica tem sido menos suja, mas a poluição global é muito visível aqui”</a></li>
<li><a href="../pt504328/index.html">Aulas de votação eletrônica na Duma da cidade de Moscou 2019</a></li>
<li><a href="../pt504334/index.html">Насколько хорошо вы знаете JavaScript?</a></li>
<li><a href="../pt504344/index.html">Autenticação - CONFIGURAÇÃO PERSONALIZADA / AWS Amplify + React Native</a></li>
<li><a href="../pt504348/index.html">Monowheel: o que acontece durante o treinamento e como acelerar esse processo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>