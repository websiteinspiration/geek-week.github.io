<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛌 💆🏻 🍑 あなたはすべてに答えます！開発者の目を通して消費者主導の契約 📃 🌮 👨‍🏭</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="この記事では、コンシューマー主導の契約が解決する問題について説明し、Node.jsとSpring Bootを使用したPactの例を使用してそれを適用する方法を示します。そして、このアプローチの限界について話しましょう。
 
 
 問題
 製品をテストする場合、特別に選択した環境でシステムのさまざまな...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>あなたはすべてに答えます！開発者の目を通して消費者主導の契約</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/452960/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事では、コンシューマー主導の契約が解決する問題について説明し、Node.jsとSpring Bootを使用したPactの例を使用してそれを適用する方法を示します。</font><font style="vertical-align: inherit;">そして、このアプローチの限界について話しましょう。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gu/vg/za/guvgzadja02vflw5bi8mgh_wbbo.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
製品をテストする場合、特別に選択した環境でシステムのさまざまなコンポーネントの統合をチェックするシナリオテストがよく使用されます。</font><font style="vertical-align: inherit;">ライブサービスでのこのようなテストは、最も信頼できる結果をもたらします（戦闘時のテストは含まれません）。</font><font style="vertical-align: inherit;">しかし、同時に、それらは最も高価なものの1つです。</font></font><br>
<a name="habracut"></a><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多くの場合、統合環境はフォールトトレラントであるべきではないと誤って信じられています。</font><font style="vertical-align: inherit;">SLA、そのような環境の保証はめったに発言されませんが、それが利用できない場合、チームはリリースを遅らせるか、最高のものを期待してテストなしで戦闘に参加する必要があります。</font><font style="vertical-align: inherit;">誰もが</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">希望は戦略ではない</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ことを知っていますが</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">また、新しいインフラストラクチャテクノロジは、統合環境での作業を複雑にするだけです。</font></font></li>
<li><b>  —    </b>.      , .        ?            ? </li>
<li><b>  </b>.    - ,      .   ,       ,     !  false negative , flaky-     <code>@Ignored</code>.        .   release candidate   —   . -      .     .</li>
<li><b>    </b>.    ,    .</li>
<li>  ,     ,         .       .          .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
統合環境での安定したテストには、QA、開発者、さらには運用者からの真剣な投資が必要です。彼らが</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テストピラミッドの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最上部にいるのも不思議ではありません</font><font style="vertical-align: inherit;">。このようなテストは便利ですが、リソースエコノミーではすべてをチェックすることはできません。それらの価値の主な情報源は環境です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じピラミッドの下には、分離チェックを使用して、小さなサポートの頭痛と自信を交換する他のテストがあります。粒度が小さいほど、テストの規模が小さいほど、外部環境への依存度は低くなります。ピラミッドの最下部にはユニットテストがあります。個々の関数、クラスをテストします。ビジネスセマンティクスでは、特定の実装の構築ほどではありません。これらのテストは迅速なフィードバックを提供します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、ピラミッドを降りたらすぐに、環境を何かで置き換えなければなりません。スタブは、サービス全体として、およびプログラミング言語の個々のエンティティとして表示されます。コンポーネントを個別にテストできるのはプラグの助けです。ただし、チェックの有効性も低下します。スタブが正しいデータを返していることを確認するにはどうすればよいですか？その品質を保証する方法は？</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソリューションは、</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さまざまなシナリオとシステムコンポーネントの考えられる状態を説明する</font><b><font style="vertical-align: inherit;">包括的なドキュメントに</font></b><font style="vertical-align: inherit;">する</font><b><font style="vertical-align: inherit;">ことができ</font></b><font style="vertical-align: inherit;">ます。しかし、どのような処方も依然として解釈の自由を残しています。したがって、優れたドキュメントは、チームが問題の領域を理解するにつれて常に改善されている生きた成果物です。それでは、どのようにしてドキュメントスタブのコンプライアンスを確保しますか</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くのプロジェクトでは、テストアーティファクトを開発したのと同じ人によってスタブが作成されている状況を観察できます。たとえば、モバイルアプリケーションの開発者は、自身のテスト用のスタブを作成します。その結果、プログラマーは独自の方法でドキュメントを理解でき（これは完全に正常です）、予期しない動作でスタブを作成し、それに応じてコードを記述し（グリーンテストを使用）、実際の統合中にエラーが発生します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、ドキュメントは通常下流に移動します-クライアントはサービスの仕様を使用します（この場合、別のサービスがサービスのクライアントになることができます）。それは</font><font style="vertical-align: inherit;">、消費者がデータを</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どのように</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用するか、どのデータが必要か、そのデータに対してどのような仮定をするかを</font><font style="vertical-align: inherit;">表すものではありません</font><font style="vertical-align: inherit;">。この無知の結果は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ハイラム</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">法則です</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ek/bh/ho/ekbhhofe0ox95w50drdg8tybsbi.png" width="300"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hyrum WrightはGoogle内で長い間公開ツールを開発しており、最小の変更がライブラリの暗黙的な（文書化されていない）機能を使用した顧客にどのように影響を与えるかを観察しました。</font><font style="vertical-align: inherit;">このような隠された接続は、APIの進化を複雑にします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの問題は、消費者主導の契約を使用してある程度解決できます。</font><font style="vertical-align: inherit;">他のアプローチやツールと同様に、適用範囲とコストにも幅があります。これらについても検討します。</font><font style="vertical-align: inherit;">このアプローチの実装は、プロジェクトを試すのに十分な成熟度に達しています。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CDCとは何ですか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3つの重要な要素：</font></font><br>
<br>
<ul>
<li><b></b>.     DSL,   .      API    :    ,      .</li>
<li><b> </b>.     ,     .</li>
<li><b>  API</b>.     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、契約は実行可能です。</font><font style="vertical-align: inherit;">また、このアプローチの主な特徴は、API動作の要件</font><font style="vertical-align: inherit;">がクライアントからサーバーへと</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上流</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">向かうこと</font><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
契約は</font><font style="vertical-align: inherit;">、消費者にとって</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本当に</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重要な</font><font style="vertical-align: inherit;">行動に焦点を当てています</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">APIに関する仮定を明示的にします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CDCの主なタスクは、その開発者とそのクライアントの開発者によるAPI動作の理解をまとめることです。</font><font style="vertical-align: inherit;">このアプローチはBDDとうまく組み合わされており</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、3人のアミーゴの会議で</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、契約のブランクをスケッチできます。</font><font style="vertical-align: inherit;">最終的に、この契約はコミュニケーションの改善にも役立ちます。</font><font style="vertical-align: inherit;">問題領域に関する共通の理解を共有し、チーム内およびチーム間でソリューションを実装します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">協定</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CDCを、その実装の1つであるPactの例として使用することを検討してください。</font><font style="vertical-align: inherit;">会議参加者用のWebアプリケーションを作成するとします。</font><font style="vertical-align: inherit;">次の反復では、チームはプレゼンテーションスケジュールを作成します。これまでのところ、投票やメモなどのストーリーはなく、レポートグリッドの出力のみです。</font><font style="vertical-align: inherit;">例のソースコードは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちら</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><s><font style="vertical-align: inherit;">3</font></s><font style="vertical-align: inherit;">つの4つのアミーゴの</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ミーティングで</font><font style="vertical-align: inherit;">、製品、テスター、バックエンド、モバイルアプリケーションの開発者が出会います。</font><font style="vertical-align: inherit;">彼らは言った</font></font><s><font style="vertical-align: inherit;"></font></s><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テキスト付きのリストがUIに表示されます：レポートタイトル+発言者+日付と時刻。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これを行うには、以下の例のように、バックエンドがデータを返す必要があります。</font></font></li>
</ul><br>
<pre><code class="json hljs">{
   <span class="hljs-attr">"talks"</span>:[<font></font>
      {<font></font>
         <span class="hljs-attr">"title"</span>:<span class="hljs-string">"      "</span>,
         <span class="hljs-attr">"speakers"</span>:[<font></font>
            {<font></font>
               <span class="hljs-attr">"name"</span>:<span class="hljs-string">" "</span><font></font>
            }<font></font>
         ],<font></font>
         <span class="hljs-attr">"time"</span>:<span class="hljs-string">"2019-05-27T12:00:00+03:00"</span><font></font>
      }<font></font>
   ]<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、フロントエンド開発者はクライアントコード（フロントエンドのバックエンド）を記述します。</font><font style="vertical-align: inherit;">彼はプロジェクトに協定契約ライブラリをインストールします：</font></font><br>
<br>
<pre><code class="bash hljs">yarn add --dev @pact-foundation/pact</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、テストを書き始めます。</font><font style="vertical-align: inherit;">ローカルスタブサーバーを構成し、レポートスケジュールでサービスをシミュレートします。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> provider = <span class="hljs-keyword">new</span> Pact({
  <span class="hljs-comment">//     </span>
  <span class="hljs-attr">consumer</span>: <span class="hljs-string">"schedule-consumer"</span>,
  <span class="hljs-attr">provider</span>: <span class="hljs-string">"schedule-producer"</span>,<font></font>
<font></font>
  <span class="hljs-comment">// ,    </span>
  <span class="hljs-attr">port</span>: pactServerPort,<font></font>
<font></font>
  <span class="hljs-comment">//  pact    </span>
  <span class="hljs-attr">log</span>: path.resolve(process.cwd(), <span class="hljs-string">"logs"</span>, <span class="hljs-string">"pact.log"</span>),<font></font>
<font></font>
  <span class="hljs-comment">// ,    </span>
  <span class="hljs-attr">dir</span>: path.resolve(process.cwd(), <span class="hljs-string">"pacts"</span>),<font></font>
<font></font>
  <span class="hljs-attr">logLevel</span>: <span class="hljs-string">"WARN"</span>,<font></font>
<font></font>
  <span class="hljs-comment">//  DSL </span>
  <span class="hljs-attr">spec</span>: <span class="hljs-number">2</span>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コントラクトは、サービスと対話するクライアントのシナリオを記述するJSONファイルです。</font><font style="vertical-align: inherit;">ただし、コード内のスタブの設定から形成されるため、手動で記述する必要はありません。</font><font style="vertical-align: inherit;">テスト前の開発者は、次の動作について説明します。</font></font><br>
<br>
<pre><code class="javascript hljs">provider.setup().then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span><font></font>
  provider<font></font>
    .addInteraction({<font></font>
      <span class="hljs-attr">uponReceiving</span>: <span class="hljs-string">"a request for schedule"</span>,
      <span class="hljs-attr">withRequest</span>: {
        <span class="hljs-attr">method</span>: <span class="hljs-string">"GET"</span>,
        <span class="hljs-attr">path</span>: <span class="hljs-string">"/schedule"</span><font></font>
      },<font></font>
      <span class="hljs-attr">willRespondWith</span>: {
        <span class="hljs-attr">status</span>: <span class="hljs-number">200</span>,
        <span class="hljs-attr">headers</span>: {
          <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json;charset=UTF-8"</span><font></font>
        },<font></font>
        <span class="hljs-attr">body</span>: {
          <span class="hljs-attr">talks</span>: [<font></font>
            {<font></font>
              <span class="hljs-attr">title</span>: <span class="hljs-string">"      "</span>,
              <span class="hljs-attr">speakers</span>: [<font></font>
                {<font></font>
                  <span class="hljs-attr">name</span>: <span class="hljs-string">" "</span><font></font>
                }<font></font>
              ],<font></font>
              <span class="hljs-attr">time</span>: <span class="hljs-string">"2019-05-27T12:00:00+03:00"</span><font></font>
            }<font></font>
          ]<font></font>
        }<font></font>
      }<font></font>
    })<font></font>
    .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> done())<font></font>
);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、例では特定の予期されるサービスリクエストを指定しましたが、pact-jsは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一致を判別するためのいくつかのメソッド</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もサポートし</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ています</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、プログラマは、このスタブを使用するコードのその部分のテストを記述します。</font><font style="vertical-align: inherit;">次の例では、簡単にするために直接呼び出します。</font></font><br>
<br>
<pre><code class="javascript hljs">it(<span class="hljs-string">"fetches schedule"</span>, done =&gt; {<font></font>
  fetch(<span class="hljs-string">`http://localhost:<span class="hljs-subst">${pactServerPort}</span>/schedule`</span>)<font></font>
    .then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.json())<font></font>
    .then(<span class="hljs-function"><span class="hljs-params">json</span> =&gt;</span> expect(json).toStrictEqual({
      <span class="hljs-attr">talks</span>: [<font></font>
        {<font></font>
          <span class="hljs-attr">title</span>: <span class="hljs-string">"      "</span>,
          <span class="hljs-attr">speakers</span>: [<font></font>
            {<font></font>
              <span class="hljs-attr">name</span>: <span class="hljs-string">" "</span><font></font>
            }<font></font>
          ],<font></font>
          <span class="hljs-attr">time</span>: <span class="hljs-string">"2019-05-27T12:00:00+03:00"</span><font></font>
        }<font></font>
      ]<font></font>
    }))<font></font>
    .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> done());<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際のプロジェクトでは、これは個別の応答解釈関数の迅速な単体テスト、またはサービスから受信したデータを表示するための低速のUIテストのいずれかです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストの実行中に、pactは、スタブがテストで指定された要求を受信したことを確認します。</font><font style="vertical-align: inherit;">不一致は、pact.logファイルで差分として確認できます。</font></font><br>
<br>
<pre><code class="plaintext hljs">E, [2019-05-21T01:01:55.810194 #78394] ERROR -- : Diff with interaction: "a request for schedule"<font></font>
Diff<font></font>
--------------------------------------<font></font>
Key: - is expected <font></font>
     + is actual <font></font>
Matching keys and values are not shown<font></font>
<font></font>
 {<font></font>
   "headers": {<font></font>
-    "Accept": "application/json"<font></font>
+    "Accept": "*/*"<font></font>
   }<font></font>
 }<font></font>
<font></font>
Description of differences<font></font>
--------------------------------------<font></font>
* Expected "application/json" but got "*/*" at $.headers.Accept</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストが成功すると、コントラクトがJSON形式で生成されます。</font><font style="vertical-align: inherit;">APIの予想される動作を説明します。</font></font><br>
<br>
<pre><code class="json hljs">{
  <span class="hljs-attr">"consumer"</span>: {
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"schedule-consumer"</span><font></font>
  },<font></font>
  <span class="hljs-attr">"provider"</span>: {
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"schedule-producer"</span><font></font>
  },<font></font>
  <span class="hljs-attr">"interactions"</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">"description"</span>: <span class="hljs-string">"a request for schedule"</span>,
      <span class="hljs-attr">"request"</span>: {
        <span class="hljs-attr">"method"</span>: <span class="hljs-string">"GET"</span>,
        <span class="hljs-attr">"path"</span>: <span class="hljs-string">"/schedule"</span>,
        <span class="hljs-attr">"headers"</span>: {
          <span class="hljs-attr">"Accept"</span>: <span class="hljs-string">"application/json"</span><font></font>
        }<font></font>
      },<font></font>
      <span class="hljs-attr">"response"</span>: {
        <span class="hljs-attr">"status"</span>: <span class="hljs-number">200</span>,
        <span class="hljs-attr">"headers"</span>: {
          <span class="hljs-attr">"Content-Type"</span>: <span class="hljs-string">"application/json;charset=UTF-8"</span><font></font>
        },<font></font>
        <span class="hljs-attr">"body"</span>: {
         <span class="hljs-attr">"talks"</span>:[<font></font>
            {<font></font>
               <span class="hljs-attr">"title"</span>:<span class="hljs-string">"      "</span>,
               <span class="hljs-attr">"speakers"</span>:[<font></font>
                  {<font></font>
                     <span class="hljs-attr">"name"</span>:<span class="hljs-string">" "</span><font></font>
                  }<font></font>
               ],<font></font>
               <span class="hljs-attr">"time"</span>:<span class="hljs-string">"2019-05-27T12:00:00+03:00"</span><font></font>
            }<font></font>
         ]<font></font>
       }}}<font></font>
  ],<font></font>
  <span class="hljs-attr">"metadata"</span>: {
    <span class="hljs-attr">"pactSpecification"</span>: {
      <span class="hljs-attr">"version"</span>: <span class="hljs-string">"2.0.0"</span><font></font>
    }<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼はこの契約をバックエンド開発者に与えます。 APIがSpring Boot上にあるとしましょう。 Pactには、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MockMVC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と連携できる</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">pact-jvm-provider-spring</font></a><font style="vertical-align: inherit;">ライブラリ</font><font style="vertical-align: inherit;">があります。ただし、SpringエコシステムにCDCを実装するSpring Cloudコントラクトについて見ていきます。独自の契約形式を使用しますが、他の形式のコンバーターを接続するための拡張ポイントもあります。そのネイティブのコントラクト形式は、JVM、Ruby、JS、Go、Pythonなどのライブラリを備えたPactとは異なり、Spring Cloudコントラクト自体によってのみサポートされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例では、バックエンド開発者がGradleを使用してサービスを構築するとします。次の依存関係を接続します。</font></font><br>
<br>
<pre><code class="plaintext hljs">buildscript {<font></font>
	// ...<font></font>
<font></font>
	dependencies {<font></font>
		classpath "org.springframework.cloud:spring-cloud-contract-pact:2.1.1.RELEASE"<font></font>
	}<font></font>
}<font></font>
<font></font>
plugins {<font></font>
	id "org.springframework.cloud.contract" version "2.1.1.RELEASE"<font></font>
       // ...<font></font>
}<font></font>
<font></font>
// ...<font></font>
<font></font>
dependencies {<font></font>
    // ...<font></font>
    testImplementation 'org.springframework.cloud:spring-cloud-starter-contract-verifier'<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、frotenderから受け取ったPact契約をディレクトリに入れ</font></font><code>src/test/resources/contracts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それから、デフォルトで、spring-cloud-contractプラグインは契約を差し引きます。</font><font style="vertical-align: inherit;">アセンブリ中に、generateContractTests gradleタスクが実行され、build / generated-test-sourcesディレクトリに次のテストが生成されます。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ContractVerifierTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ContractsBaseTest</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">validate_aggregator_client_aggregator_service</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{
        <span class="hljs-comment">// given:</span><font></font>
        MockMvcRequestSpecification request = given()<font></font>
            .header(<span class="hljs-string">"Accept"</span>, <span class="hljs-string">"application/json"</span>);<font></font>
<font></font>
        <span class="hljs-comment">// when:</span><font></font>
        ResponseOptions response = given().spec(request)<font></font>
            .get(<span class="hljs-string">"/scheduler"</span>);<font></font>
<font></font>
        <span class="hljs-comment">// then:</span>
        assertThat(response.statusCode()).isEqualTo(<span class="hljs-number">200</span>);<font></font>
        assertThat(response.header(<span class="hljs-string">"Content-Type"</span>)).isEqualTo(<span class="hljs-string">"application/json;charset=UTF-8"</span>);
        <span class="hljs-comment">// and:</span><font></font>
        DocumentContext parsedJson = JsonPath.parse(response.getBody().asString());<font></font>
        assertThatJson(parsedJson).array(<span class="hljs-string">"['talks']"</span>).array(<span class="hljs-string">"['speakers']"</span>).contains(<span class="hljs-string">"['name']"</span>).isEqualTo( <span class="hljs-comment">/*...*/</span> );<font></font>
        assertThatJson(parsedJson).array(<span class="hljs-string">"['talks']"</span>).contains(<span class="hljs-string">"['time']"</span>).isEqualTo( <span class="hljs-comment">/*...*/</span> );<font></font>
        assertThatJson(parsedJson).array(<span class="hljs-string">"['talks']"</span>).contains(<span class="hljs-string">"['title']"</span>).isEqualTo( <span class="hljs-comment">/*...*/</span> );<font></font>
    }<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このテストを開始すると、エラーが表示されます。 </font></font><br>
<br>
<pre><code class="plaintext hljs">java.lang.IllegalStateException: You haven't configured a MockMVC instance. You can do this statically</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストにはさまざまなツールを使用できるため、どのプラグインを構成したかをプラグインに通知する必要があります。</font><font style="vertical-align: inherit;">これは基本クラスを介して行われ、基本クラスはコントラクトから生成されたテストを継承します。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ContractsBaseTest</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> ScheduleController scheduleController = <span class="hljs-keyword">new</span> ScheduleController();<font></font>
<font></font>
<font></font>
    <span class="hljs-meta">@Before</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{<font></font>
        RestAssuredMockMvc.standaloneSetup(scheduleController);<font></font>
    }<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
生成中にこの基本クラスを使用するには、spring-cloud-contract gradleプラグインを構成する必要があります。</font></font><br>
<br>
<pre><code class="plaintext hljs">contracts {<font></font>
	baseClassForTests = 'ru.example.schedule.ContractsBaseTest'<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、次のテストが生成されました。</font></font><br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ContractVerifierTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ContractsBaseTest</span> </span>{
	<span class="hljs-meta">@Test</span>
	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">validate_aggregator_client_aggregator_service</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{
		<span class="hljs-comment">// ...</span><font></font>
	}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストは正常に開始されますが、検証エラーで失敗します-開発者はまだサービスの実装を記述していません。</font><font style="vertical-align: inherit;">しかし、今では彼は契約に基づいてそれを行うことができます。</font><font style="vertical-align: inherit;">彼はクライアントの要求を処理し、期待される応答を返すことができることを確認できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービス開発者は、契約を通じて彼が何をする必要があるか、どのような振る舞いを実装するかを知っています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pactは、開発プロセスのより深い部分に統合できます。</font><font style="vertical-align: inherit;">このようなコントラクトを集約し、バージョン管理を維持し、依存関係グラフを表示するPactブローカーを展開できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dq/pd/v0/dqpdv0c4qk89kboewjxrafys1iq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しく生成された契約をブローカーにアップロードすることは、クライアントを構築するときのステップCIで行うことができます。</font><font style="vertical-align: inherit;">サーバーコードで、URLによるコントラクトの動的読み込みを示します。</font><font style="vertical-align: inherit;">Spring Cloud Contractもこれをサポートしています。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CDCの適用性</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
消費者主導の契約にはどのような制限がありますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプローチ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font><b><font style="vertical-align: inherit;">するには、</font></b><font style="vertical-align: inherit;"> pactなどの</font><b><font style="vertical-align: inherit;">追加ツールで支払う必要があります</font></b><font style="vertical-align: inherit;">。コントラクト自体は追加のアーティファクトであり、注意深く保守し、それに意識的にエンジニアリング手法を適用する必要がある別の抽象化です。</font><font style="vertical-align: inherit;">スタブはとにかくスタブのままなので、</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e2eテスト</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><b><font style="vertical-align: inherit;">置き換わるものではありません。</font></b><font style="vertical-align: inherit;">実際のシステムコンポーネントのモデルであり、少しだけかもしれませんが、実際には対応していません。それらを介して、複雑なシナリオを検証することはできません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、</font><b><font style="vertical-align: inherit;">CDCはAPI機能テストの代わりに</font></b><font style="vertical-align: inherit;">は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なりません。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。それらは、Plain Old Unit Testsよりもサポートにコストがかかります。 Pact開発者は、次のヒューリスティックを使用することをお勧めします。契約を削除しても、クライアントがエラーや誤解を引き起こさない場合は、不要です。たとえば、クライアントが同じ方法で処理する場合は、コントラクトを通じてすべてのAPIエラーコードを完全に記述する必要はありません。言い換えると、契約はサービス</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にとってクライアントにとって重要なものだけを</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">説明</font><strong><font style="vertical-align: inherit;">します</font></strong><font style="vertical-align: inherit;">。これ以上ではありませんが、それ以下ではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コントラクトが多すぎると、APIの進化も複雑になります。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加の各契約は、赤のテストの機会です。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">各フェイルテストが、サポートのコストを上回る有用なセマンティックロードを運ぶように、CDCを設計する必要があります。</font><font style="vertical-align: inherit;">たとえば、契約が特定のテキストフィールドの最小の長さを固定していて、消費者に無関心である場合（彼は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toleran Readerの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手法を使用し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">）、この最小値を変更するたびに契約とその周囲の神経が破られます。</font><font style="vertical-align: inherit;">このようなチェックは、API自体のレベルに転送され、制限のソースに応じて実装される必要があります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CDCは、統合動作を明示的に記述することにより、製品の品質を向上させます。</font><font style="vertical-align: inherit;">これは、顧客とサービス開発者が共通の理解を深めるのに役立ち、コードを介して話すことができます。</font><font style="vertical-align: inherit;">しかし、これはツールの追加、チームメンバーの新しい抽象化と追加のアクションの導入という犠牲を払って行われます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同時に、CDCツールとフレームワークは活発に開発されており、プロジェクトでのテストの成熟度にすでに達しています。</font><font style="vertical-align: inherit;">テスト:)</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5月</font><font style="vertical-align: inherit;">27〜28 </font><font style="vertical-align: inherit;">日の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QualityConf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カンファレンス</font><font style="vertical-align: inherit;">では、Andrei Markelov </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が製品の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テスト手法について</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">話し</font></a><font style="vertical-align: inherit;">、Arthur Khineltsevが</font><font style="vertical-align: inherit;">負荷</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高いフロントエンドを</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">監視する</font></a><font style="vertical-align: inherit;">ことについて話し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
質の高いチャットを是非！</font></font></blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja452946/index.html">Lou GreenawのWindows 95 / NTプログラミング哲学を再読する</a></li>
<li><a href="../ja452952/index.html">JetBrainsがサンクトペテルブルクでオープン</a></li>
<li><a href="../ja452954/index.html">ビルド時間、ネットワーク速度、ルーティング：メッシュネットワークを改善した方法とニューラルネットワークについて少し</a></li>
<li><a href="../ja452956/index.html">IstioおよびLinkerdのCPU消費のベンチマーク</a></li>
<li><a href="../ja452958/index.html">JMAP-電子メールを交換するときにIMAPに代わるオープンプロトコル</a></li>
<li><a href="../ja452962/index.html">データセンターでの事故の主な原因は、コンピュータと椅子の間の敷設です</a></li>
<li><a href="../ja452964/index.html">リーマン仮説の手頃な説明</a></li>
<li><a href="../ja452966/index.html">マインドフルネスの神話：瞑想の「ニューロセントリック」な見方</a></li>
<li><a href="../ja452974/index.html">非同期プログラミング（フルコース）</a></li>
<li><a href="../ja452978/index.html">ok.tech：データの説明</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>