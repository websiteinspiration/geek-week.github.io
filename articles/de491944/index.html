<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¨ ğŸ‘¨ğŸ½â€ğŸ¤ ğŸ‘©ğŸ»â€ğŸ¤ So kombinieren Sie zwei Plattformen zu einer und beleidigen Benutzer nicht. Yandex.Kew Entwicklererfahrung ğŸ“® ğŸ‘©ğŸ»â€âš•ï¸ ğŸ‘¨ğŸ½â€ğŸ­</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Im vergangenen Jahr ist TheQuestion zu Yandex gekommen. Zu dieser Zeit gab es bereits einen Ã¤hnlichen Dienst an Fragen und Antworten - Yandex.Znatoki....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>So kombinieren Sie zwei Plattformen zu einer und beleidigen Benutzer nicht. Yandex.Kew Entwicklererfahrung</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/491944/"><img src="https://habrastorage.org/webt/je/qm/jf/jeqmjfqycb2lqolmutp76tgjrem.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im vergangenen Jahr ist TheQuestion zu Yandex gekommen. Zu dieser Zeit gab es bereits einen Ã¤hnlichen Dienst an Fragen und Antworten - Yandex.Znatoki. Die Kenner hatten ein groÃŸes Publikum und viele interessante Fragen, aber es gab nicht genÃ¼gend Experten, die diese Fragen qualitativ hochwertig beantworten konnten. TheQuestion hatte im Gegenteil eine starke Expertengemeinschaft, aber es fehlten interessante Fragen. Der logische Schritt bestand darin, die beiden Dienste zu kombinieren, um das Beste aus jedem von ihnen herauszuholen. Aber wie geht das, wenn jeder Dienst seine eigene technologische Basis, seinen eigenen Inhalt und seine eigenen Benutzer hat?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heute werde ich darÃ¼ber sprechen, wie unser Team dieses Problem aus technologischer Sicht gelÃ¶st hat. Sie erfahren, welche KombinationsmÃ¶glichkeiten wir in Betracht gezogen und welche am Ende gewÃ¤hlt haben. Ich erzÃ¤hle Ihnen von der "Swap-API", der Datenbankmigration, dem Pooling von Profilen und dem Backend-Testen. Und doch - Ã¼ber die Nacht des Umzugs ohne das Recht, einen Fehler zu machen. Sie werden sehen, dass wir uns nicht langweilen mussten.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Aufgabe, zwei Dienste zu einem zusammenzufÃ¼hren, ist nicht neu, macht dies jedoch nicht einfacher. Die Geschichte kennt viele erfolgreiche (und nicht so erfolgreiche) Beispiele fÃ¼r Integration, aber leider gibt es keine â€Silberkugelâ€œ und eine klare Anweisung â€Mach das und alles wird klappenâ€œ. Alles hÃ¤ngt sehr stark von den Besonderheiten der zu kombinierenden Dienste und dem gewÃ¼nschten Ergebnis ab. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In unserem Fall war das Ziel Folgendes: Der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gesamte Inhalt, der jemals auf jeder der Websites geschrieben wurde, war in einem einheitlichen Dienst verfÃ¼gbar, und seine Autoren konnten ihn verwalten.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Wie kombinieren Sie also die beiden Q &amp; A-Services, die so Ã¤hnlich, aber im Wesentlichen so unterschiedlich zu sein scheinen? Das Ãœbertragen von Inhalten und Benutzern von einem Dienst zu einem anderen ist dem Umzug von einer alten in eine neue Wohnung sehr Ã¤hnlich.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nur in unserem Fall kann der Benutzer gleichzeitig in zwei Wohnungen leben (Kenner und TheQuestion), und Sie mÃ¼ssen ihn vorsichtig in die dritte transportieren. Sie mÃ¼ssen alle MÃ¶bel, Pflanzen, eine Katze und sogar Tapeten in eine neue Wohnung bringen (dh Fragen, Antworten, Kommentare, Likes) und ihn dann zum Umzug einladen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie macht man das? Mehrere Optionen fallen sofort ein. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option 1. Sehr schlecht.</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nehmen wir einfach einen der Dienste, Ã¼bertragen den gesamten Inhalt auf einen anderen (obwohl dies nicht mehr einfach ist) und schlieÃŸen den ursprÃ¼nglichen Dienst.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Option ist aus Sicht des Benutzers des ersten Dienstes sehr schlecht. Wir haben gerade sein altes Haus abgerissen und ihn gezwungen, in ein neues umzuziehen. Jeder wird diese Einstellung nicht mÃ¶gen und anstatt sich zu bewegen, kann er einfach in den Sonnenuntergang gehen. FÃ¼r uns ist der Hauptwert die Benutzergemeinschaft, daher hatten wir nicht vor, jemanden zu beleidigen. Und mutig zu anderen Optionen gewechselt. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option 2. Schlecht</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Lassen Sie uns keinen der Dienste Ã¤ndern, sondern einen neuen, integrierten Dienst starten und regelmÃ¤ÃŸig Inhalte von den beiden anderen hinzufÃ¼gen (z. B. einmal am Tag).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Fall scheinen wir den Benutzer nicht schlechter zu machen, aber wir machen es auch nicht besser. Seine alte Wohnung bleibt unverÃ¤ndert, aber es macht keinen Sinn, in eine neue zu ziehen. Alle Nachbarn wohnen auch in einem alten Haus, eine soeben gekaufte Blume wird erst nach einem Tag in eine neue Wohnung gebracht. Solch ein einheitlicher Dienst hat keine Chance, ein neues Zuhause zu werden. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option 3. Gut, aber schwierig.</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Lassen Sie uns keinen der Dienste schlieÃŸen. Wir werden sofort Inhalte und Profile des integrierten Dienstes duplizieren und die Mitarbeiter werden sich im Laufe der Zeit bewegen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alle Nachbarn des Benutzers (und sogar die Katze) leben gleichzeitig im alten und im neuen Haus. Eine Blume, die Sie gerade gekauft haben, erscheint sofort in einer neuen Wohnung. Genau das, was benÃ¶tigt wird! Diese Option ist aus Sicht des Benutzers am bequemsten. Deshalb haben wir es gewÃ¤hlt.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bewegen Sie sich</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was wir letztendlich getan haben, kann in mehreren SÃ¤tzen beschrieben werden. </font><font style="vertical-align: inherit;">Wir haben das gesamte TheQuestion-API-Backend basierend auf dem Connoisseurs-Backend vollstÃ¤ndig wiederholt und so ein einziges Backend erhalten, das mit zwei (und sogar drei) Sites gleichzeitig arbeiten kann. </font><font style="vertical-align: inherit;">Gleichzeitig blieb das TheQuestion-Frontend nahezu unverÃ¤ndert, was bedeutet, dass sich die Site aus Sicht der Benutzer praktisch nicht geÃ¤ndert hat. </font><font style="vertical-align: inherit;">Dieses Projekt hat den internen Namen "Swap API" erhalten. </font><font style="vertical-align: inherit;">Aber das Wichtigste zuerst.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was wir am Eingang hatten: zwei vÃ¶llig unabhÃ¤ngige Standorte. </font><font style="vertical-align: inherit;">Kenner leben in den inneren Wolken von Yandex. </font><font style="vertical-align: inherit;">Das Connoisseurs-Backend ist in Python geschrieben. </font><font style="vertical-align: inherit;">TheQuestion befindet sich in den Clouds von Microsoft Azure. Das Backend von TheQuestion ist in Go geschrieben. </font><font style="vertical-align: inherit;">Dienste haben ein vÃ¶llig anderes Datenspeicherungsschema in den Datenbanken. </font><font style="vertical-align: inherit;">DarÃ¼ber hinaus verfÃ¼gt TheQuestion Ã¼ber zwei mobile Anwendungen (fÃ¼r Android und iOS), die ebenfalls unterstÃ¼tzt werden mussten. </font><font style="vertical-align: inherit;">Im Allgemeinen will der Feind einen solchen Zoo nicht vereinen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wh/i0/8z/whi08z8r9v_7vhg13ana4ku_nvu.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stufe 0. Fahren Sie in die Yandex-Wolke</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Genau genommen ist dieser Schritt fÃ¼r die â€Plugin-APIâ€œ nicht erforderlich, vereinfacht jedoch die nÃ¤chsten Schritte erheblich. </font><font style="vertical-align: inherit;">Zu diesem Zeitpunkt haben wir externe Lager und Einrichtungen vollstÃ¤ndig aufgegeben. </font><font style="vertical-align: inherit;">TheQuestion begann mit der Verwendung von Yandex-DNS-Servern. </font><font style="vertical-align: inherit;">Die Rentme-Dienste wurden nach Yandex.Cloud verlegt. </font><font style="vertical-align: inherit;">Die Datenbank wurde in Yandex Managed Databases Ã¼bertragen. </font><font style="vertical-align: inherit;">WÃ¤hrend des Umzugs konnten wir auch mehrere Fehler in TheQuestion finden und beheben, z. B. nicht geschlossene Verbindungen zu Redis im Code 2015. </font><font style="vertical-align: inherit;">Als Bonus erhielten wir zusÃ¤tzliche Leistung fÃ¼r TheQuestion.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stufe 1. Datenmigration</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UnabhÃ¤ngig davon, welche Option Sie Services kombinieren mÃ¶chten, mÃ¼ssten wir die Daten in jedem Fall kombinieren. FÃ¼r eine einzelne Datenbank haben wir uns fÃ¼r PostgreSQL entschieden - dieses DBMS wurde bereits sowohl in Experts als auch in TheQuestion verwendet. Um das Projekt nicht zu komplizieren, wurde keine dritte Basis fÃ¼r den integrierten Dienst erstellt, sondern lediglich die Znatokov-Datenbank verwendet, um alle TheQuestion-Daten zu akzeptieren. Dies war die erste groÃŸe technologische Herausforderung.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jeder Eintrag in jeder Tabelle aus der TheQuestion-Datenbank musste konvertiert und in die Expertenbasis gestellt werden. Dann - korreliere jede Spalte von der einen zur anderen Basis. Viele Felder mussten nicht trivial von einem Format in ein anderes konvertiert werden. Eine separate groÃŸe Unteraufgabe war die Konvertierung des Textspeicherformats (das tatsÃ¤chliche Format des Frage- oder Antwortspeichers) von QML (TheQuestion) in Markdown (Experten).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben einen regelmÃ¤ÃŸigen (mehrmals tÃ¤glichen) Prozess zum Ãœbertragen neuer Daten von einer Datenbank in eine andere eingerichtet, aber gleichzeitig sichergestellt, dass die Daten von TheQuestion bis zum Abschluss der nÃ¤chsten Stufe nirgendwo angezeigt wurden. </font><font style="vertical-align: inherit;">Denn "mehrmals am Tag" wird keineswegs "sofort" versprochen, und die Daten kÃ¶nnten sich in einem inkonsistenten Zustand mit denselben Daten in TheQuestion befinden, was die Benutzer irrefÃ¼hren wÃ¼rde. </font><font style="vertical-align: inherit;">Warum haben wir mit der Datenmigration begonnen, wenn das Backend noch nicht fertig war? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstens haben wir auf diese Weise den Prozess stabilisiert. </font><font style="vertical-align: inherit;">Zweitens haben sie die Menge neuer Daten reduziert, die in Zukunft Ã¼bertragen werden mÃ¼ssen, und dies ist wichtig, da alle importierten Inhalte durch das Markup fÃ¼r QualitÃ¤t, unangemessenen Inhalt, Spam und Betrug gesteuert werden mussten.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gc/jp/ld/gcjpldkw8v-mv2fg_umevbosowo.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stufe 2. "API austauschen"</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also haben wir das erste der Probleme gelÃ¶st - wir haben gelernt, Inhalte aus der TheQuestion-Datenbank zu Ã¼bernehmen und sie sogar anzuzeigen, wenn Sie dies wÃ¼nschen. Jetzt war es notwendig, diesen Inhalt sofort und nicht mehrmals am Tag in die integrierte Datenbank zu bringen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dazu musste das gesamte TheQuestion-Backend mit der erforderlichen Logik neu geschrieben werden. Der Name des Projekts, "Swap API", spiegelt genau genommen das Wesentliche nicht vollstÃ¤ndig wider. Es wÃ¤re richtiger, es "Swap-Backend" zu nennen. Tatsache ist, dass neben der direkten Implementierung aller fÃ¼r das Funktionieren des TheQuestion-Frontends erforderlichen â€Stifteâ€œ weitere MÃ¶glichkeiten realisiert werden mussten. Wir standen vor mehreren groÃŸen Aufgaben. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Genehmigung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex verfÃ¼gt Ã¼ber ein zentrales Benutzerautorisierungssystem - Yandex.Passport. Und Kenner haben natÃ¼rlich den Pass benutzt. Um sich anzumelden, mÃ¼ssen Sie ein Konto bei Yandex haben. Das war das Problem. Nicht alle TheQuestion-Benutzer haben sich Ã¼ber Yandex auf der Website angemeldet (obwohl es eine solche MÃ¶glichkeit gab). Viele Benutzer hatten Ã¼berhaupt kein Yandex-Login und gingen Ã¼ber soziale Netzwerke (VKontakte, Facebook ...). NatÃ¼rlich mussten wir diese FunktionalitÃ¤t beim Umzug beibehalten. Aus diesem Grund haben wir die Berechtigung "Nicht-Pass" implementiert. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seitensuche.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TheQuestion hat eine Suche nach Fragen, Antworten, Benutzern und Themen implementiert. FÃ¼r die Suche wurde eine Sphinx-LÃ¶sung eines Drittanbieters verwendet. Wenn es sich um einen einzelnen Dienst handelt, sollte die Suche natÃ¼rlich dieselbe sein, dh, sie kann nicht auf zwei Systemen gleichzeitig funktionieren. Daher wurde Sphinx zugunsten einer internen Suchmaschine aufgegeben, die die erforderliche FunktionalitÃ¤t und Indizierung aller TheQuestion-Inhalte unterstÃ¼tzt. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versand von Seiten in Zen und Turbo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Zum Zeitpunkt des Beitritts verwendete TheQuestion bereits Yandex-Technologien. Turbo-Seiten wurden unterstÃ¼tzt, interessante Inhalte fielen in den Zen-Feed. All dies musste auch in der "Ersatz-API" unterstÃ¼tzt werden. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benachrichtigungen im Dienst und in den Anwendungen, Mailinglisten.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alles, was mit der Benachrichtigung von Benutzern zu tun hat: Abonnements, Newsletter mit interessanten Inhalten, Push-over-Likes und Kommentare, vieles mehr. All dies musste sorgfÃ¤ltig Ã¼bertragen und nicht vergessen werden. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Site Administration System</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dieser Absatz bezieht sich auf alles, was mit der internen Verwaltung des Dienstes zusammenhÃ¤ngt: Moderation, Analyse usw. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einheitliches Benutzerbewertungssystem.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diese Aufgabe war eher nicht technisch, sondern logisch. Formal ist es nicht erforderlich, ein einheitliches Bewertungssystem fÃ¼r eine â€Swap-APIâ€œ zu entwickeln, aber dieses System wird weiterhin fÃ¼r den zukÃ¼nftigen integrierten Service benÃ¶tigt. Auf beiden Websites wurden Benutzer nach QuantitÃ¤t und QualitÃ¤t der erstellten Inhalte bewertet. Die Details der Bewertung wurden nicht bekannt gegeben, aber je Ã¶fter und besser Sie die Fragen beantworten, desto hÃ¶her ist Ihre Bewertung. Die BewertungsgrundsÃ¤tze waren fÃ¼r beide Dienste gleich, aber die Formel selbst und die Faktoren waren sehr unterschiedlich. Es war nicht nur notwendig, die Benutzer von Znatokov und TheQuestion korrekt und ehrlich miteinander zu vergleichen, sondern auch zu lernen, eine einzige Bewertung fÃ¼r diejenigen Experten zu berÃ¼cksichtigen, die gleichzeitig Ã¼ber zwei Dienste geschrieben haben. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und schreiben Sie alle APIs neu.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ob es Ihnen gefiel oder nicht, diese Aufgabe war die wichtigste und schwierigste. Viele Prozesse in den Diensten waren Ã¤hnlich, deshalb haben wir sie den Kennern abgenommen und nicht von Grund auf neu geschrieben. Es gab aber auch viele neue Dinge, zum Beispiel gerade Linien von Benutzern oder EntwÃ¼rfe von Antworten. Infolgedessen haben wir mehr als 100 "Stifte" in der "Swap-API" neu geschrieben und mehr als 50 REST-Ressourcen implementiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem wir alle oben beschriebenen Funktionen implementiert hatten, war es mÃ¶glich, mit dem Umzug zu beginnen. Aber bevor wir einen Trick gemacht haben.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist klar, dass die â€Swap-APIâ€œ vor dem Wechsel und der EinfÃ¼hrung in der Produktion sehr gut getestet werden musste. ZunÃ¤chst musste es funktionsfÃ¤hig getestet werden, dh die Leistung der gesamten Site auf der neuen API direkt Ã¼berprÃ¼ft werden. Zweitens ist es stressig. Wir wollten 100% sicher sein, dass unser Design nicht unter Last â€liegtâ€œ. NatÃ¼rlich haben wir regelmÃ¤ÃŸig â€Lastfeuerungenâ€œ durchgefÃ¼hrt, was gezeigt hat, dass wir ein gutes Leistungsangebot haben. In Bezug auf die Serviceleistung ist es jedoch immer besser, auf Nummer sicher zu gehen. Alle, selbst die besten synthetischen Belastungstests unterscheiden sich irgendwie von der Produktionslast. Aus diesem Grund haben wir uns vor dem Wechsel der API entschlossen, die Produktionslast auf unserem Stand zu fÃ¼llen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zu diesem Zweck haben wir im TheQuestion-Frontend die Duplizierung aller GET-Anforderungen (dh Datenanforderungen, keine Ã„nderungen) gleichzeitig in zwei APIs implementiert: die "alte API" TheQuestion, die zu diesem Zeitpunkt die Haupt-API war, und die sekundÃ¤re "Swap-API". </font><font style="vertical-align: inherit;">Gleichzeitig wartete das Frontend nicht auf eine geringfÃ¼gige API-Antwort und verarbeitete keine Fehler, aber wir konnten das Backend an echten Benutzern testen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xh/xk/bu/xhxkbuuaimvplykay5--cdqbl30.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stufe 3. Und dann erinnerten wir uns an Anwendungen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nein, natÃ¼rlich haben wir uns die ganze Zeit an sie erinnert, aber wir hatten ein Problem. Diejenigen, die mit mobilen Anwendungen gearbeitet haben, wissen, dass der Aufwand mit ihnen viel grÃ¶ÃŸer ist als mit der Website. Dies ist vor allem auf die Verbreitung neuer Versionen zurÃ¼ckzufÃ¼hren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstens mÃ¼ssen Sie mit externen Diensten des App Store und von Google Play zusammenarbeiten und warten, bis die neuen Versionen die ÃœberprÃ¼fung bestanden haben (und manchmal kann die ÃœberprÃ¼fung eine betrÃ¤chtliche Zeit in Anspruch nehmen). Zweitens bedeutet dies nicht, dass Benutzer ein Update vornehmen, selbst wenn Ihre Anwendung den Test bereits bestanden hat und im Store angezeigt wurde.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Fall des Frontends der Site steuern die Entwickler selbst, wann eine neue Version verÃ¶ffentlicht wird, und sie wissen mit Sicherheit, dass danach alle Benutzer eine aktualisierte Version der Site erhalten. Bei AntrÃ¤gen gibt es keine solche Garantie. Um eine solche Garantie zu erhalten, verwenden sie hÃ¤ufig eine â€erzwungene Aktualisierungâ€œ der Anwendung. Nur wenige Leute lieben diese Methode, und natÃ¼rlich mÃ¼ssen Sie, wenn mÃ¶glich, immer die AbwÃ¤rtskompatibilitÃ¤t zwischen der Anwendung und dem Backend aufrechterhalten. Daher haben wir den Weg eingeschlagen, Ã„nderungen genau auf der Backend-Seite mit minimalen Ã„nderungen am Frontend in Anwendungen vorzunehmen. Aber wie so oft ist der Plan mit einer harten RealitÃ¤t konfrontiert.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Einige Ã„nderungen waren auf der Front-End-Seite viel einfacher durchzufÃ¼hren als auf der Back-End-Seite. Bei der Entwicklung einer â€Plug-in-APIâ€œ wurde das Front-End daher geringfÃ¼gig geÃ¤ndert. Insbesondere in der alten TheQuestion-Datenbank wurden numerische 64-Bit-IDs verwendet. Die Connoisseurs-Datenbank und dementsprechend die kombinierte Datenbank und die neue API fÃ¼r TheQuestion verwendeten String-128-Bit-IDs. Im Allgemeinen ist dieser Unterschied fÃ¼r ein in Node.js geschriebenes Frontend nicht signifikant. Bei stark typisierten Anwendungen erwies sich dies jedoch als fatal. Wir haben die AbwÃ¤rtskompatibilitÃ¤t verloren und Ã¤ltere Anwendungen konnten nicht mit der "Plugin-API" arbeiten.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Irgendwann gab es sogar ein Projekt namens "Plugin-API fÃ¼r Plugin-API", dessen Kern darin bestand, eine kleine Ebene zwischen dem neuen Backend und Anwendungen zu schreiben, die alle Daten in das alte Format konvertieren wÃ¼rden. Wir haben diese Idee jedoch schnell aufgegeben. Diese Schicht wÃ¼rde sich als sehr starre â€KrÃ¼ckeâ€œ herausstellen, was uns in Zukunft definitiv viele Probleme bringen wÃ¼rde. Beispielsweise kÃ¶nnen Sie 128-Bit-IDs nicht einfach in 64-Bit-IDs umwandeln. Ich mÃ¼sste mit Informationsverlust und folglich mÃ¶glichen Kollisionen nach ID Ã¼bersetzen oder eine Zwischentabelle mit der Entsprechung alter und neuer IDs (fÃ¼r alle Elemente der Datenbank) fÃ¼hren. Sowohl das als auch eine andere - nicht die beste architektonische LÃ¶sung.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neben der ID gab es eine Reihe weiterer Ã„nderungen, die auch auf der Front-End- und Anwendungsseite viel einfacher zu unterstÃ¼tzen waren. </font><font style="vertical-align: inherit;">Aus diesem Grund haben wir beschlossen, Ã„nderungen in Anwendungen zu implementieren und das erzwungene Update weiterhin zu verwenden. </font><font style="vertical-align: inherit;">In kurzer Zeit haben wir neue Versionen von Anwendungen entwickelt, die mit der â€Swap-APIâ€œ kompatibel sind, da es im Front-End nicht so viele Ã„nderungen gab und diese nicht sehr schwerwiegend waren. </font><font style="vertical-align: inherit;">Wird an den App Store und an Google Play gesendet, erfolgreich moderiert und beginnt zu warten.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stufe X. Lass uns gehen!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der gesamte Code ist also geschrieben. </font><font style="vertical-align: inherit;">Der Stand mit der "Ersatz-API" wird getestet und gebrannt. </font><font style="vertical-align: inherit;">Neue Versionen der Anwendung wurden in GeschÃ¤ften getestet und kÃ¶nnen verÃ¶ffentlicht werden. </font><font style="vertical-align: inherit;">Jetzt musste alles in die Produktion eingefÃ¼hrt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aufgrund der Tatsache, dass das Kopieren neuer Daten aus der alten Datenbank in die neue asynchron erfolgt und einige Zeit in Anspruch nimmt, kÃ¶nnen Sie das Backend (und die darunter liegende Datenbank) auf einer Arbeitswebsite nicht wechseln. </font><font style="vertical-align: inherit;">Dies kann zum Verlust oder zur Inkonsistenz von Benutzerdaten fÃ¼hren. </font><font style="vertical-align: inherit;">Aus diesem Grund haben wir ein Datum ausgewÃ¤hlt, die Benutzer gewarnt und eine Platte mit dem Titel â€Technische Arbeiten in Arbeitâ€œ vorbereitet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und dann kam die Stunde oder besser gesagt die Nacht X. Der Roll-out-Plan sah folgendermaÃŸen aus:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auf der Website TheQuestion hÃ¤ngen wir einen Stub "Work is in progress" auf. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir Ã¼bertragen Anwendungen in den Readonly-Modus. </font><font style="vertical-align: inherit;">Benutzer kÃ¶nnen Inhalte aus der alten Datenbank lesen, aber keine neue erstellen.</font></font></li>
<li>  TheQuestion   Readonly.    :           .   ,  ,      . </li>
<li>        .            ,     .</li>
<li>       .</li>
<li> ,      ,    API.</li>
<li> API  .  â€”     ,    API   .</li>
<li>,   ,   . </li>
<li>  Â« Â»,        API.</li>
<li>    .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, das sieht nicht so beÃ¤ngstigend aus. In Wirklichkeit lief alles ganz reibungslos. Von den Ãœberraschungen, die wir erlebten, war es vielleicht nur zu lang, die Anwendung im App Store zu verÃ¶ffentlichen (die Anwendung wurde im Voraus geprÃ¼ft, es ging nur darum, im Store zu erscheinen). Am Ende dauerte es mehrere Stunden, weshalb sich die gesamte Operation etwas verzÃ¶gerte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DarÃ¼ber hinaus gab es beim Wechsel ein SchlÃ¼sselmerkmal, das alles um ein Vielfaches komplizierte und die Verantwortung erhÃ¶hte. Tatsache ist, dass der Schaltvorgang nicht rÃ¼ckgÃ¤ngig gemacht werden konnte.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obwohl der Prozess des Kopierens und Konvertierens von Daten aus der alten TheQuestion-Datenbank in die neue, integrierte Datenbank fÃ¼r uns eingerichtet und debuggt wurde, gab es keinen umgekehrten Kopierprozess (von der neuen Datenbank in die alte). Dies bedeutet, dass alle neu erstellten Fragen, Antworten, Kommentare und Likes nicht mehr einfach in die alte TheQuestion-Datenbank gelangen kÃ¶nnen, sobald wir die Site Ã¼ber die â€Swap-APIâ€œ Ã¶ffnen und den Benutzerverkehr starten. Wenn beispielsweise nach dem Ã–ffnen etwas schief geht und eine einzelne Datenbank die Last nicht bewÃ¤ltigen kann, kann nicht alles schnell zurÃ¼ckgesetzt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TatsÃ¤chlich Ã¼bertreibe ich natÃ¼rlich. In jedem Fall wÃ¼rden wir keine Benutzerdaten verlieren. Wir hatten einen Plan B und eine MÃ¶glichkeit, Daten manuell aus einer neuen Datenbank in eine alte zu sichern. Aber es wÃ¼rde noch einige Zeit dauern, und der Rollback wÃ¤re fÃ¼r Benutzer nicht ganz schmerzlos verlaufen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GlÃ¼cklicherweise funktionierte Plan A und nichts musste zurÃ¼ckgesetzt werden.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mj/wy/7g/mjwy7gbw8fyxtqvt0fp0cetrn_4.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Letzte Stufe</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also wurde das Backend geÃ¤ndert, die Datenbank wurde kombiniert, die mobilen Anwendungen wurden nicht vergessen. </font><font style="vertical-align: inherit;">FÃ¼r Benutzer hat sich nichts geÃ¤ndert, da die Yandex.Ku-Site, die Daten von beiden Sites kombinieren sollte, zu diesem Zeitpunkt noch nicht gestartet wurde. </font><font style="vertical-align: inherit;">Und fÃ¼r den Start mussten wir noch ein Problem lÃ¶sen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ganz am Anfang schrieb ich, dass wir nicht nur Fragen und Antworten von zwei Diensten in einem neuen, sondern auch von Benutzern kombinieren mÃ¼ssen. </font><font style="vertical-align: inherit;">Benutzer sollten in der Lage sein, ihre Inhalte nicht nur auf Kew zu sehen, sondern auch auf Kew zu verwalten. </font><font style="vertical-align: inherit;">Technisch gesehen ist es nicht schwierig, Daten zu kombinieren und Verwaltungsrechte zu Ã¼bertragen. </font><font style="vertical-align: inherit;">Es ist viel schwieriger sicherzustellen, dass die Rechte auf denjenigen Ã¼bertragen werden, auf den sie Ã¼bertragen werden sollen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim Umzug von Znatokov nach Kew ist alles einfach: In beiden FÃ¤llen wird dasselbe Yandex-Konto verwendet. </font><font style="vertical-align: inherit;">TheQuestion hat jedoch ein eigenes Konto, das bei Kew nicht autorisiert werden kann. </font><font style="vertical-align: inherit;">Zum GlÃ¼ck haben wir vorher darÃ¼ber nachgedacht. </font><font style="vertical-align: inherit;">Lange vor den oben beschriebenen Aktionen haben wir TheQuestion-Benutzern ermÃ¶glicht, ihre Yandex-Profile zu verknÃ¼pfen. </font><font style="vertical-align: inherit;">Zum Zeitpunkt der physischen Konsolidierung der Dienste hatten dies mehr als 90% der aktiven Benutzer getan. </font><font style="vertical-align: inherit;">Dadurch konnten wir problemlos mit der Migration von Inhalten und Benutzern beginnen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gesamt</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als wir umgezogen sind, wollten wir jeden Benutzer retten, deshalb haben wir uns bewusst fÃ¼r die zeitaufwÃ¤ndigste und riskanteste Option entschieden, Plattformen zu kombinieren. </font><font style="vertical-align: inherit;">Wir haben eine einheitliche technologische Basis geschaffen und gelernt, wie Inhalte und Profile sofort transportiert werden kÃ¶nnen. </font><font style="vertical-align: inherit;">Anstelle einer unerwarteten SchlieÃŸung und eines erzwungenen Umzugs behielten sie die FunktionalitÃ¤t der alten Dienste bei, starteten einen neuen und erlÃ¤uterten dessen Vorteile. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dq/1o/e9/dq1oe9ihp4u8tknser_ew3oxx2c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex.Kew</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> letztes Jahr </font><font style="vertical-align: inherit;">gestartet </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Jetzt sind mehr als 80% der aktiven Autoren von TheQuestion und Znatokov freiwillig in ein neues Zuhause gezogen.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de491926/index.html">PlattformÃ¼bergreifende Entwicklung mobiler Anwendungen im Jahr 2020</a></li>
<li><a href="../de491934/index.html">Psychologische Profile von Aktieninvestoren: wie es funktioniert</a></li>
<li><a href="../de491936/index.html">Wie sich Bakterien von Eisen ernÃ¤hren und hochwertige Pigmente aus kÃ¼nstlichen Deponien entfernen</a></li>
<li><a href="../de491938/index.html">5 Game Designer Tools, die Ihrem Spiel helfen</a></li>
<li><a href="../de491942/index.html">Wie wir item2vec verwenden, um Ã¤hnliche Produkte zu empfehlen</a></li>
<li><a href="../de491946/index.html">Gesetze der Programmierung</a></li>
<li><a href="../de491948/index.html">Design-Token kÃ¶nnen mehr: Sie kÃ¶nnen eine einzige Informationsquelle Ã¼ber UI-Komponenten erstellen</a></li>
<li><a href="../de491956/index.html">Rust 1.42.0 Release: Slice-Vorlagen und bequemere Panikmeldungen</a></li>
<li><a href="../de491958/index.html">Handbuch zur Komprimierung von Skelettanimationen</a></li>
<li><a href="../de491960/index.html">Ã„ra, in der es schwer ist, sich zu verlaufen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>