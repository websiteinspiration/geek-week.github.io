<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤙 🔍 💇🏼 Mikhail Salosin. Golang Meetup. Verwenden von Go im Backend der Watch + -Anwendung ☝️ 🚴🏼 🙏🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mikhail Salosin (im Folgenden - MS): - Hallo allerseits! Ich heiße Michael. Ich arbeite als Backend-Entwickler bei MC2 Software und werde über die Ver...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Mikhail Salosin. Golang Meetup. Verwenden von Go im Backend der Watch + -Anwendung</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/490750/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Salosin (im Folgenden - MS):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Hallo allerseits! </font><font style="vertical-align: inherit;">Ich heiße Michael. </font><font style="vertical-align: inherit;">Ich arbeite als Backend-Entwickler bei MC2 Software und werde über die Verwendung von Go im Backend der mobilen Watch + -Anwendung sprechen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tf/pc/yj/tfpcyjrufa8t1o-_ilgh2iqqb1w.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Präsentiert jemand gerne Hockey? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/td/g7/l_/tdg7l_zyrrg7vw1shoc3fdxywda.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann ist diese App genau das Richtige für Sie. </font><font style="vertical-align: inherit;">Es ist für Android und iOS gedacht und wird verwendet, um Sendungen verschiedener Sportereignisse online und in Aufzeichnungen anzusehen. </font><font style="vertical-align: inherit;">Außerdem enthält die Anwendung verschiedene Statistiken, Textsendungen, Tabellen für Konferenzen, Turniere und andere Informationen, die für Fans nützlich sind. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ps/cn/fa/pscnfash29d-yqq6ldluvigihoq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auch in der Anwendung gibt es so etwas wie Videomomente, dh Sie können die akuten Momente von Spielen (Tore, Kämpfe, Schießereien usw.) sehen. </font><font style="vertical-align: inherit;">Wenn Sie nicht die gesamte Sendung sehen möchten, können Sie nur die interessantesten sehen.</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was wurde in der Entwicklung verwendet?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Hauptteil wurde in Go geschrieben. Die API, mit der die mobilen Clients kommunizierten, wurde in Go geschrieben. Außerdem wurde auf Go ein Dienst zum Senden von Push-Benachrichtigungen an Mobilgeräte geschrieben. Wir mussten auch unser eigenes ORM schreiben, über das wir vielleicht eines Tages sprechen werden. Nun, einige kleine Dienste sind auf Go geschrieben: Größenänderung und Hochladen von Bildern für die Redakteure ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben Postgres (PostgreSQL) als Datenbank verwendet. Die Schnittstelle für Editoren wurde in Ruby on Rails mit dem ActiveAdmin-Juwel geschrieben. Der Import von Statistiken vom Statistikanbieter ist ebenfalls auf Ruby geschrieben.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für System-API-Tests haben wir Python unittest (Python) verwendet. </font><font style="vertical-align: inherit;">Memcached wird verwendet, um API-Zahlungsanforderungen zu drosseln, Chef, um die Konfiguration zu steuern, Zabbix, um interne Systemstatistiken zu sammeln und zu überwachen. </font><font style="vertical-align: inherit;">Graylog2 - Zum Sammeln von Protokollen ist Slate eine API-Dokumentation für Clients.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n5/v_/tc/n5v_tcwffefrpa-fxomv5jc_moc.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protokollauswahl</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das erste Problem, auf das wir gestoßen sind: Wir mussten ein Protokoll für die Interaktion des Backends mit mobilen Clients auswählen, basierend auf den folgenden Punkten ...</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die wichtigste Anforderung: Daten zu Kunden müssen in Echtzeit aktualisiert werden. </font><font style="vertical-align: inherit;">Das heißt, jeder, der gerade die Sendung sieht, sollte fast sofort Updates erhalten.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Einfachheit halber haben wir akzeptiert, dass Daten, die mit Clients synchronisiert sind, nicht gelöscht, sondern mithilfe spezieller Flags ausgeblendet werden.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alle Arten von seltenen Anfragen (wie Statistiken, Aufstellungen, Teamstatistiken) werden von normalen GET-Anfragen empfangen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Außerdem sollte das System gleichzeitig 100.000 Benutzern ruhig standhalten.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Basierend darauf hatten wir zwei Protokolloptionen:</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Websockets. </font><font style="vertical-align: inherit;">Wir brauchten jedoch keine Kanäle vom Client zum Server. </font><font style="vertical-align: inherit;">Wir mussten nur Updates vom Server an den Client senden, daher ist ein Web-Socket eine redundante Option.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Server-Sent Events (SSE) waren genau richtig! </font><font style="vertical-align: inherit;">Es ist ganz einfach und erfüllt im Grunde alles, was wir brauchen.</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vom Server gesendete Ereignisse</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein paar Worte darüber, wie dieses Ding </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
funktioniert </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">Es funktioniert über der http-Verbindung. </font><font style="vertical-align: inherit;">Der Client sendet eine Anfrage, der Server antwortet mit Content-Type: text / event-stream und schließt die Verbindung zum Client nicht, sondern schreibt weiterhin Daten in die Verbindung: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0s/qp/5j/0sqp5jdkevts9970rrbpwa0bm9i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daten können in einem mit den Clients vereinbarten Format gesendet werden. </font><font style="vertical-align: inherit;">In unserem Fall haben wir in dieser Form gesendet: Im Ereignisfeld wurde der Name der geänderten Struktur (Person, Spieler) gesendet und im Datenfeld - JSON mit neuen, geänderten Feldern für den Spieler. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun dazu, wie die Interaktion selbst funktioniert.</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zunächst ermittelt der Client, wann die letzte Synchronisierung mit dem Dienst durchgeführt wurde: Er überprüft seine lokale Datenbank und ermittelt das Datum der letzten von ihm aufgezeichneten Änderung.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Er sendet eine Anfrage mit diesem Datum.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Als Antwort senden wir ihm alle Aktualisierungen, die an diesem Datum aufgetreten sind.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Danach stellt er eine Verbindung zum Live-Kanal her und schließt erst, wenn er diese Updates benötigt:</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/_v/t9/t1/_vt9t1r7nq_--sskm6vc_-0qydw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir senden ihm eine Liste mit Änderungen: Wenn jemand ein Tor erzielt hat - wir ändern die Punktzahl des Spiels, wurden verletzt -, wird dies ebenfalls in Echtzeit gesendet. </font><font style="vertical-align: inherit;">Somit erhalten Kunden im Ereignisstrom des Spiels sofort relevante Daten. </font><font style="vertical-align: inherit;">Damit der Client versteht, dass der Server nicht gestorben ist, dass ihm nichts passiert ist, senden wir regelmäßig alle 15 Sekunden einen Zeitstempel, damit er weiß, dass alles in Ordnung ist und keine erneute Verbindung erforderlich ist.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie wird die Live-Verbindung bedient?</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zunächst erstellen wir einen Kanal, in den Updates mit einem Puffer gelangen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Danach abonnieren wir diesen Kanal, um Updates zu erhalten.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stellen Sie den richtigen Header ein, damit der Client weiß, dass alles in Ordnung ist.</font></font></li>
<li>  ping.    timestamp .</li>
<li>         ,     .       timestamp,  ,       .</li>
</ul><br>
<img src="https://habrastorage.org/webt/rf/hl/s9/rfhls98e0zi4dogfbjpptkb-feg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das erste Problem, auf das wir gestoßen sind, war das folgende: Für jede Verbindung, die mit dem Client geöffnet wurde, haben wir einen Timer erstellt, der alle 15 Sekunden aktiviert wurde. Es stellte sich heraus, dass wir 6.000 Verbindungen mit einem Computer (mit einem API-Server) hatten. 6 Tausend Timer wurden erstellt. </font><font style="vertical-align: inherit;">Dies führte dazu, dass die Maschine nicht die notwendige Last hielt. </font><font style="vertical-align: inherit;">Das Problem war für uns nicht so offensichtlich, aber sie haben uns ein wenig geholfen, und wir haben es beseitigt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infolgedessen kommt jetzt ein Ping von demselben Kanal, von dem das Update stammt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dementsprechend gibt es nur einen Timer, der alle 15 Sekunden einmal tickt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier sind einige Hilfsfunktionen: Senden des Headers, des Pings und der Struktur selbst. </font><font style="vertical-align: inherit;">Das heißt, der Name der Tabelle (Person, Spiel, Saison) und die Informationen zu diesem Datensatz werden hier übertragen:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qu/g2/rh/qug2rhecowmxbnqmqz7zk5p-_7g.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mechanismus zum Senden von Updates</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun ein wenig darüber, woher die Änderungen kommen. </font><font style="vertical-align: inherit;">Wir haben mehrere Leute, Redakteure, die die Sendung in Echtzeit sehen. </font><font style="vertical-align: inherit;">Sie erstellen alle Ereignisse: Jemand wurde entfernt, jemand wurde verletzt, eine Art Ersatz ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit Hilfe von CMS gelangen die Daten in die Datenbank. </font><font style="vertical-align: inherit;">Danach benachrichtigt die Datenbank, die den Listen / Notify-Mechanismus verwendet, die API-Server darüber. </font><font style="vertical-align: inherit;">API-Server senden diese Informationen bereits an Clients. </font><font style="vertical-align: inherit;">Daher sind nur wenige Server mit der Datenbank verbunden, und die Datenbank wird nicht besonders belastet, da der Client in keiner Weise direkt mit der Datenbank interagiert:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/az/wp/ei/azwpei0ysoe2uspec2ybfe9mdag.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQL: Hören / Benachrichtigen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit dem Listen / Notify-Mechanismus in Postgres können Sie Abonnenten über Ereignisse informieren, bei denen sich ein Ereignis geändert hat. In der Datenbank wurde eine Art Datensatz erstellt. Dazu haben wir einen einfachen Auslöser und eine einfache Funktion geschrieben: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hj/i_/ms/hji_msz1f-kwrtijbes4flcctr0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim Einfügen oder Ändern eines Datensatzes rufen wir die Benachrichtigungsfunktion auf dem Kanal data_updates auf, übertragen den Tabellennamen und die Kennung des Datensatzes, der dort geändert oder eingefügt wurde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für alle Tabellen, die mit dem Client synchronisiert werden sollen, definieren wir einen Trigger, der nach dem Ändern / Aktualisieren des Datensatzes die auf der Folie unten angegebene Funktion aufruft. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie abonniert die API diese Änderungen? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Fanout-Mechanismus wird erstellt - er sendet Nachrichten an den Client. Er sammelt alle Kundenkanäle und sendet Updates, die er über diese Kanäle erhalten hat:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kx/op/vl/kxopvlizual_4yyz48t79flo8w8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier überprüft die Standard-pq-Bibliothek, die eine Verbindung zur Datenbank herstellt und angibt, dass sie den Kanal abhören möchte (data_updates), dass die Verbindung offen ist und alles in Ordnung ist. </font><font style="vertical-align: inherit;">Ich lasse die Fehlerprüfung aus, um Platz zu sparen (überprüfen Sie nicht die Belastung). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als nächstes setzen wir den Ticker asynchron, der alle 15 Sekunden einen Ping sendet, und beginnen, den von uns abonnierten Kanal anzuhören. </font><font style="vertical-align: inherit;">Wenn wir einen Ping haben, veröffentlichen wir diesen Ping. </font><font style="vertical-align: inherit;">Wenn wir einen Datensatz erhalten haben, veröffentlichen wir diesen Datensatz für alle Abonnenten dieses Fanouts.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie funktioniert Fan-Out?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf Russisch bedeutet dies „Splitter“. Wir haben ein Objekt, das Abonnenten registriert, die Updates erhalten möchten. Sobald ein Update für dieses Objekt eintrifft, wird dieses Update an alle Abonnenten weitergegeben. Einfach genug: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/je/tw/76/jetw76q3dzqifpq22yo9dc3j4ha.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie es auf Go implementiert wird: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nz/gl/o8/nzglo8wnz5iwzrtjfc39zlqqxa8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt eine Struktur, die mit Mutexen synchronisiert wird. Es verfügt über ein Feld, in dem der Status der Fanout-Verbindung zur Datenbank gespeichert wird, dh im Moment, in dem Aktualisierungen abgehört und empfangen werden, sowie eine Liste aller verfügbaren Kanäle - Map, deren Schlüssel der Kanal und die Struktur in Form von Werten ist (tatsächlich) in keiner Weise verwendet).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit zwei Methoden - Verbunden und Verbunden - können Sie Fanout mitteilen, dass eine Verbindung zur Basis besteht und die Verbindung zur Basis getrennt ist. Im zweiten Fall müssen Sie alle Clients trennen und ihnen mitteilen, dass sie nichts mehr hören können und dass sie sich wieder verbinden, da die Verbindung zu ihnen geschlossen wurde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt auch eine Subscribe-Methode, mit der Listenern ein Kanal </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i1/hu/rh/i1hurht2d0x5mmdikeem_gpmm3i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
hinzugefügt wird </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">Es gibt eine Unsubscribe-Methode, mit der ein Kanal von Listenern entfernt wird, wenn der Client die Verbindung trennt, sowie eine Publish-Methode, mit der Sie eine Nachricht an alle Abonnenten senden können. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frage:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Was wird über diesen Kanal übertragen? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Es wird ein Modell übertragen, das sich geändert hat oder pingt (im Wesentlichen nur eine Zahl, eine Ganzzahl). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Sie können alles senden, jede Struktur veröffentlichen, es wird einfach zu JSON und das wars. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wir erhalten eine Benachrichtigung von Postgres - sie enthält den Tabellennamen und die Kennung. </font><font style="vertical-align: inherit;">Durch den Namen der Tabelle, die wir erhalten, und den Bezeichner erhalten wir den Datensatz, den wir benötigen, und diese Struktur wird bereits zur Veröffentlichung gesendet.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infrastruktur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie sieht es in Bezug auf die Infrastruktur aus? Wir haben 7 Eisenserver: Einer davon ist vollständig der Basis gewidmet, die restlichen sechs drehen sich auf virtuellen Computern. Es gibt 6 Kopien der API: Jede virtuelle Maschine mit der API wird auf einem separaten Eisenserver ausgeführt - dies dient der Zuverlässigkeit. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hu/2_/4e/hu2_4eyv8ko_you4ygxuowle6m4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben zwei Frontends, auf denen Keepalived installiert ist, um die Zugänglichkeit zu verbessern, sodass in diesem Fall ein Frontend das andere ersetzen kann. Weitere zwei Kopien des CMS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt auch einen Importeur von Statistiken. Es gibt einen DB-Slave, von dem regelmäßig Sicherungen durchgeführt werden. Es gibt Pigeon Pusher - eine Anwendung, die Pushies an Kunden sowie Infrastruktur-Dinge sendet: Zabbix, Graylog2 und Chef.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tatsächlich ist diese Infrastruktur redundant, da 100.000 mit weniger Servern bedient werden können. </font><font style="vertical-align: inherit;">Aber es gab Eisen - wir haben es benutzt (uns wurde gesagt, dass es möglich ist - warum nicht).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vorteile von Go</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem wir an dieser Anwendung gearbeitet hatten, wurden solche offensichtlichen Vorteile von Go aufgedeckt.</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coole http Bibliothek. </font><font style="vertical-align: inherit;">Mit ihm können Sie bereits eine Menge erstellen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Außerdem die Kanäle, mit denen wir den Mechanismus zum Senden von Benachrichtigungen an Kunden sehr einfach implementieren konnten.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mit dem wunderbaren Race-Detektor konnten wir mehrere kritische Fehler (Staging-Infrastruktur) beseitigen. </font><font style="vertical-align: inherit;">Alles, was beim Staging funktioniert, wird ausgeführt und mit dem Race-Schlüssel kompiliert. </font><font style="vertical-align: inherit;">und dementsprechend können wir sehen, welche potenziellen Probleme wir mit der Staging-Infrastruktur haben.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minimalismus und Einfachheit der Sprache.</font></font></li>
</ul><br>
<br>
<img src="https://habrastorage.org/webt/eb/lc/mo/eblcmow1odoou6z22y2rady3n6k.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir suchen Entwickler! </font><font style="vertical-align: inherit;">Wenn jemand will - bitte.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Frage des Publikums (im Folgenden - B): - Mir scheint, Sie haben einen wichtigen Punkt in Bezug auf das Fan-out übersehen. Ich verstehe richtig, dass Sie blockiert werden, wenn Sie eine Antwort an einen Client senden, wenn der Client nicht lesen möchte. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Nein, wir blockieren nicht. Erstens haben wir alles hinter nginx, das heißt, es gibt keine Probleme mit langsamen Clients. Zweitens hat der Client einen Kanal mit einem Puffer - tatsächlich können wir dort bis zu hundert Aktualisierungen vornehmen ... Wenn wir nicht in den Kanal schreiben können, wird er gelöscht. Wenn wir sehen, dass der Kanal blockiert ist, schließen wir ihn einfach und fertig - der Client stellt die Verbindung wieder her, wenn ein Problem auftritt. Daher tritt hier grundsätzlich keine Blockierung auf. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Könnten Sie sofort einen Datensatz an Listen / Notify senden, keine Kennungstabelle? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Listen / Notify hat ein Limit von 8.000 Bytes pro Preload, das gesendet wird. Im Prinzip wäre es möglich zu senden, wenn wir mit einer kleinen Datenmenge zu tun hätten, aber es scheint mir, dass der Weg [wie wir] einfach zuverlässiger ist. Einschränkungen sind in Postgres selbst. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Erhalten Kunden Updates zu Spielen, an denen sie nicht interessiert sind? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Im Allgemeinen ja. In der Regel gibt es 2-3 Übereinstimmungen parallel und dann ziemlich selten. Wenn der Kunde etwas sieht, beobachtet er normalerweise das laufende Spiel. Dann gibt es auf dem Client eine lokale Datenbank, in der sich alle diese Updates summieren, und selbst ohne Internetverbindung kann der Client alle früheren Übereinstimmungen anzeigen, für die er Updates hat. Tatsächlich synchronisieren wir unsere Datenbank auf dem Server mit der lokalen Datenbank des Clients, damit sie offline arbeiten kann. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Warum hast du dein ORM gemacht? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexey (einer der Entwickler von "Watch +"):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Zu dieser Zeit (es war vor einem Jahr) war ORM weniger als jetzt, wenn es ziemlich viele von ihnen gibt. Von den meisten vorhandenen ORMs mag ich am wenigsten, dass die meisten von ihnen an leeren Schnittstellen arbeiten. Das heißt, die Methoden, die in diesen ORMs bereit sind, alles zu übernehmen: Struktur, Strukturzeiger, Zahl, etwas, das überhaupt nicht relevant ist ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unser ORM generiert Strukturen basierend auf dem Datenmodell. Selbst. Und deshalb sind alle Methoden konkret, verwenden keine Reflexion usw. Sie akzeptieren Strukturen und erwarten, dass sie die kommenden Strukturen verwenden. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wie viele Personen haben teilgenommen? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - In der Anfangsphase nahmen zwei Personen teil. Irgendwann im Juni haben wir angefangen, im August war der Hauptteil fertig (erste Version). Im September gab es eine Veröffentlichung. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BEIM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Wenn Sie SSE beschreiben, verwenden Sie kein Timeout. Warum so? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Um ehrlich zu sein, ist SSE immer noch ein HTML5-Protokoll: Der SSE-Standard ist so konzipiert, dass er mit Browsern kommuniziert, so wie ich es verstehe. Es verfügt über zusätzliche Funktionen, mit denen Browser die Verbindung wiederherstellen können (usw.), die wir jedoch nicht benötigen, da wir Clients hatten, die eine Logik zum Verbinden und Empfangen von Informationen implementieren konnten. Wir haben eher nicht SSE gemacht, sondern etwas Ähnliches wie SSE. Dies ist nicht das Protokoll selbst. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gab keine Notwendigkeit. Soweit ich weiß, haben Clients den Verbindungsmechanismus von Grund auf neu implementiert. Es war ihnen im Prinzip egal. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Welche zusätzlichen Dienstprogramme haben Sie verwendet? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Am aktivsten haben wir Govet und Golint verwendet, damit der Stil vereinheitlicht wurde, sowie Gofmt. Sie haben nichts anderes benutzt. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Womit haben Sie debuggt? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Im Großen und Ganzen wurde das Debuggen mithilfe von Tests durchgeführt. Kein Debugger, GOP haben wir nicht benutzt. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Können Sie die Folie zurückgeben, auf der die Veröffentlichungsfunktion implementiert ist? Einbuchstaben-Variablennamen stören Sie nicht? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Nein. Sie haben einen ziemlich "engen" Umfang. Sie werden nirgendwo anders verwendet (außer hier) (mit Ausnahme der Innenseiten dieser Klasse), und es ist sehr kompakt - es dauert nur 7 Zeilen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Irgendwie ist es immer noch nicht intuitiv ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Nein, nein, das ist ein echter Code! Es geht nicht um Stil. Es ist nur eine so nützliche, sehr kleine Klasse - es gibt nur 3 Felder innerhalb der Klasse ... </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yx/vb/a8/yxvba8lbupf_3aw2halepbbmlce.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Im Großen und Ganzen ändern sich alle Daten, die mit Kunden synchronisiert werden (saisonale Spiele, Spieler), nicht. Grob gesagt, wenn wir eine andere Sportart betreiben wollen, bei der das Spiel geändert werden muss, werden wir einfach alles in der neuen Version des Kunden berücksichtigen und die alten Versionen des Kunden werden gesperrt. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Gibt es Pakete von Drittanbietern für das Abhängigkeitsmanagement? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wir haben go dep verwendet. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Das Thema des Berichts </font><b><font style="vertical-align: inherit;">enthielt</font></b><font style="vertical-align: inherit;"> etwas zu dem Video, aber nichts zu dem Video im Bericht. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Nein, ich habe nichts zum Thema des Videos. Es heißt "Look +" - dies ist der Name der Anwendung. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BEIM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Sie sagten, dass Sie zu Kunden streamen? .. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wir haben kein Video gestreamt. </font><font style="vertical-align: inherit;">Dies wurde komplett von Megaphone gemacht. </font><font style="vertical-align: inherit;">Ja, ich habe nicht gesagt, dass die Anwendung Megaphon ist. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Go - um alle Daten zu senden - nach Punktzahl, nach Spielereignissen, Statistiken ... Go - dies ist das gesamte Backend für die Anwendung. </font><font style="vertical-align: inherit;">Der Kunde muss irgendwo herausfinden, welchen Link er für den Spieler verwenden soll, damit der Benutzer das Spiel sehen kann. </font><font style="vertical-align: inherit;">Wir haben Links zu Videos und Streams, die vorbereitet werden.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/Kq0cWRBd1MU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein bisschen Werbung :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielen Dank für Ihren Aufenthalt bei uns. Gefällt dir unser Artikel? Möchten Sie weitere interessante Materialien sehen? Unterstützen Sie uns, indem Sie eine Bestellung </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">aufgeben</font></a><font style="vertical-align: inherit;"> oder Ihren Freunden </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloud-basiertes VPS für Entwickler ab 4,99 US-Dollar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> empfehlen </font><font style="vertical-align: inherit;">, ein </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einzigartiges Analogon von Einstiegsservern, das von uns für Sie erfunden wurde: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die ganze Wahrheit über VPS (KVM) E5-2697 v3 (6 Kerne) 10 GB DDR4 480 GB SSD 1 Gbit / s ab 19 $ oder wie teilt man den Server?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Optionen sind mit RAID1 und RAID10, bis zu 24 Kernen und bis zu 40 GB DDR4 verfügbar). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2-mal günstiger im Equinix Tier IV-Rechenzentrum in Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nur wir haben </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2,6 GHz 14C 64 GB DDR4 4 x 960 GB SSD 1 Gbit / s 100 TV von 199 US-Dollar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in den Niederlanden!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2,2 GHz 6C 128 GB DDR3 2x960 GB SSD 1 Gbit / s 100 TB - ab 99 US-Dollar! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lesen Sie mehr über</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> den Aufbau eines Infrastrukturgebäudes. </font><font style="vertical-align: inherit;">Klasse C mit Dell R730xd E5-2650 v4-Servern für 9.000 Euro für einen Cent?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de490738/index.html">Lisk-Substitutionsprinzip</a></li>
<li><a href="../de490740/index.html">Das Defektieren von *** s ist nicht nur eine Randomisierung</a></li>
<li><a href="../de490742/index.html">Eine neue Ära in der Robotik hat begonnen</a></li>
<li><a href="../de490746/index.html">Bewertung in Yandex.Taxi: Ein kurzer Beitrag zu einem ernsten Thema</a></li>
<li><a href="../de490748/index.html">Die Aufgabe für den Entwickler oder wie wir Handscanner ohne Anbieter gescannt haben</a></li>
<li><a href="../de490754/index.html">Visual Studio Code Code Editor. Die ausführlichste Anleitung zum Einrichten und Installieren von Plugins für Anfänger</a></li>
<li><a href="../de490756/index.html">Stellen Sie Jenkins als Code bereit</a></li>
<li><a href="../de490758/index.html">Mathematiker haben das universelle Gesetz der Turbulenzen bewiesen</a></li>
<li><a href="../de490760/index.html">Ray Casting Visuelle Suche (RCVS). Einfacher und schneller Algorithmus zum Auffinden von 3D-Modellen mit ähnlicher Geometrie</a></li>
<li><a href="../de490762/index.html">Wie prognostiziere ich den Flugpreis?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>