<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💇🏿 💎 🌈 Como Sports.ru escreveu seu editor WYSIWYG 🔴 ✝️ 📦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Em meados de 2018, o Sports.ru pensou em mudar para um novo editor de texto WYSIWYG para postagens de usuários. Desde junho de 2019, o editor está no ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Como Sports.ru escreveu seu editor WYSIWYG</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sports_ru/blog/492228/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em meados de 2018, o Sports.ru pensou em mudar para um novo </font></font><abbr title="O que você vê é o que você recebe"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">editor de</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> texto </font><abbr title="What You See Is What You Get"><font style="vertical-align: inherit;">WYSIWYG</font></abbr><font style="vertical-align: inherit;"> para postagens de usuários. </font><font style="vertical-align: inherit;">Desde junho de 2019, o editor está no modo beta. </font><font style="vertical-align: inherit;">Durante esse período, resolvemos muitos problemas associados ao design da arquitetura de todo o serviço e à implementação do próprio editor no navegador baseado na biblioteca </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProseMirror</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , e decidimos compartilhar nossa experiência.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wc/2p/ag/wc2pagubhgtlo-bvev4wjyfmrsk.png"><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Índice</font></font></h1><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Introdução </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1. </font><font style="vertical-align: inherit;">Por que você precisou do WYSIWYG </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2. </font><font style="vertical-align: inherit;">Descrição da tarefa que os desenvolvedores enfrentaram </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Como escolher a ferramenta </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. O que aconteceu </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1. </font><font style="vertical-align: inherit;">Arquitetura de serviço </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2. </font><font style="vertical-align: inherit;">Quais são os desafios </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Resultados dos testes beta</font></font></a><br>
<br>
<a name="Intro"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Introdução</font></font></h2><br>
<a name="Why"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1 </font><font style="vertical-align: inherit;">Por que você precisava do WYSIWYG</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sports.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é uma mídia sobre esportes com uma audiência de 20 milhões de usuários por mês. Nossas principais diferenças em relação à mídia clássica são a comunidade e o </font></font><abbr title="Conteúdo gerado por usuários"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UGC</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . O conteúdo do usuário - classificações, comentários, chats, postagens - não apenas complementa o valor editorial, mas também cria uma plataforma para que os usuários interajam. Todo mês, nossos usuários escrevem quase 10 mil posts. Os melhores são enviados para a página principal do site, juntamente com os editoriais, enviados para aplicativos móveis, redes sociais. O conteúdo do usuário é responsável por cerca de 40% de todas as leituras nas páginas do Sports.ru. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Queremos ser a plataforma mais conveniente para autores de esportes, para ajudar a criar conteúdo e entregá-lo a um público interessado. 10 anos usamos o editor </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TinyMCE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- e, no final, ficou desatualizado, deixou de atender tanto à equipe quanto aos usuários que estavam acostumados aos editores modernos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ff/ub/ig/ffubigpbednsp8phz7btg-icbm8.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. </font><font style="vertical-align: inherit;">1. A interface do antigo editor baseado no TinyMCE</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dos autores dos blogs recebidos regularmente sobre as seguintes reclamações:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escrevi por um longo tempo, fechei acidentalmente a guia e tudo se foi;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">escrever textos longos é muito inconveniente;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">É irritante que, para inserir cada imagem, você deve primeiro enviá-la para a hospedagem de imagens.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A equipe também teve suas próprias reclamações:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no TinyMCE, você não pode fazer upload de imagens diretamente de um arquivo, você só pode anexar links a imagens e, devido ao fato de os usuários não conseguirem fazer upload de imagens em nosso armazenamento, se os links morrerem, não poderíamos fazer nada a respeito;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as possibilidades de editar e formatar o texto não são balanceadas. </font><font style="vertical-align: inherit;">Por um lado, não havia estilos suficientes, por exemplo, para cabeçalhos internos no texto. </font><font style="vertical-align: inherit;">Por outro lado, foi possível usar as ferramentas disponíveis em qualquer combinação. </font><font style="vertical-align: inherit;">Como resultado, as postagens não pareciam uniformes (no Sports.ru, começaram os trabalhos de implementação do sistema de design e as postagens dos usuários devem estar de acordo com ele);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o conteúdo é criado e armazenado em HTML, por isso é difícil gerenciar estilos em postagens em diferentes clientes e apenas fazer alterações no layout das postagens.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A seguir, é apresentada uma história sobre como resolvemos o problema de criar um novo editor no front-end. </font><font style="vertical-align: inherit;">É verdade que também haverá algo sobre o produto, o design e as partes de back-end, porque sem isso será difícil entender por que uma decisão específica foi tomada no front-end.</font></font><br>
<br>
<a name="Task"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2 </font><font style="vertical-align: inherit;">Descrição da tarefa enfrentada pelos desenvolvedores</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em resumo, a tese da qual nos baseamos inicialmente: blogar no Sports.ru é uma dor. </font><font style="vertical-align: inherit;">Em princípio, seria possível não criar um novo editor, mas simplesmente adicionar salvamento automático e a capacidade de fazer upload de fotos para seu próprio armazenamento - e a maioria das reclamações de usuários e funcionários desapareceria. </font><font style="vertical-align: inherit;">Mas eu ainda queria não oferecer suporte à ferramenta em tecnologias antigas, mas criar um novo editor moderno que possamos facilmente desenvolver e dimensionar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Além da interface inconveniente, um dos principais problemas técnicos do editor antigo era que o conteúdo da postagem era salvo imediatamente como uma string HTML, e as alterações na aparência da publicação exigiam a intervenção de desenvolvedores de back-end ou eram implementadas em tempo de execução no cliente (por exemplo, a colocação de blocos de anúncios no corpo do post). Nossa tarefa, entre outras coisas, era separar os dados de sua apresentação e, consequentemente, deixar o layout e a interface no código do cliente e trabalhar com os dados no código do servidor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como modelo, adotamos o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medium</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , às vezes espionando idéias do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Doc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Além de resolver os problemas já identificados, decidimos adicionar vários novos recursos que tornariam o uso do editor mais confortável:</font></font><br>
<br>
<ul>
<li>  WYSIWYG, .. what you see is what you get (. « ,   »,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>),           ,     .     ,      ;</li>
<li>  (      ,       ,      ,   ,    ; ,           )     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao mesmo tempo, o próprio editor não deveria estar vinculado aos recursos do Sports.ru, porque o Sports.ru, embora o projeto principal em nossa empresa, ainda não seja o único. A empresa também está desenvolvendo a mídia esportiva internacional </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tribuna</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , uma rede social para entusiastas de apostas Betting </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Insider</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , e lançou recentemente seu próprio estúdio de produção envolvido em projetos de publicidade. Desenvolver um editor on-line é caro o suficiente para não querer reutilizar esse código em outro site com diferentes tipos de letra e estilos, com seu próprio conjunto de ferramentas para edição e formatação.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Temos muito conteúdo de texto e, antes de começar a trabalhar na criação de um novo editor de postagem, pensamos em como esse conteúdo deveria ser armazenado. O TinyMCE não nos deu uma escolha e o conteúdo teve que ser armazenado apenas em HTML, que, como mencionado acima, não se adequava à equipe. Como resultado, criamos nosso próprio formato para armazenar dados de texto que atendem aos nossos requisitos e chamamos de corpo estruturado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Corpo estruturado é uma matriz de objetos que reflete a estrutura do conteúdo. Nesse caso, o conteúdo é dividido em elementos que são blocos independentes, por exemplo, parágrafo, lista, imagem. Um elemento armazena informações sobre que tipo e quais propriedades ele possui. Por exemplo, o bloco de legendas descreve o título no texto, deve conter os campos de texto e nível. Assim, o texto contém o texto deste cabeçalho e o nível contém o nível (de 1 a 4). Um corpo estruturado, consistindo em um cabeçalho de segundo nível, pode ter, por exemplo, o seguinte:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> structuredBody = [<font></font>
    {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="hljs-attr">type</span>: <span class="hljs-string">'subtitle'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="hljs-attr">value</span>: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    <span class="hljs-attr">text</span>: <span class="hljs-string">'    '</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="hljs-attr">level</span>: <span class="hljs-number">2</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  },<font></font>
    },<font></font>
];<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A transição para o corpo estruturado nos permitiu iniciar o processo de separação da lógica de negócios, dados e sua apresentação. Por fim, queremos que o servidor e os clientes troquem apenas dados. E como e por que exibir esses dados para o usuário final, cada cliente determinará independentemente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O conteúdo no formato formatd body é armazenado em JSON e, para validar seu conteúdo, criamos um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esquema JSON</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> chamado esquema de corpo estruturado. Este diagrama descreve todos os elementos válidos e suas propriedades. Assim, podemos ter certeza de que sempre que um corpo estruturado for necessário, um conjunto de chaves e valores será usado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Além disso, ele permite que equipes diferentes usem os mesmos serviços para processar o conteúdo nesse formato. Por exemplo, um serviço para gerar HTML a partir de um corpo estruturado para exibir conteúdo ou um editor para criar conteúdo. Isso reduz significativamente o custo de desenvolvimento e suporte de todo o núcleo de serviços relacionados à criação e exibição de conteúdo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supunha-se que o novo editor deveria aceitar conteúdo de entrada e saída exclusivamente no formato de corpo estruturado. E aqui era necessário levar em conta o ponto sutil: como anteriormente as postagens foram salvas imediatamente em HTML, essa string HTML do banco de dados foi transmitida ao cliente para exibição (a seguir, por cliente, queremos dizer apenas o navegador, a menos que especificado de outra forma). Agora queremos armazenar o conteúdo de todas as postagens no corpo estruturado, mas os clientes podem processar apenas HTML. Portanto, juntamente com a tarefa de mudar para um novo editor, a tarefa de implementar uma nova maneira de os clientes exibirem postagens para leitura diretamente do corpo estruturado está acontecendo simultaneamente. Decidimos que é melhor comer um elefante aos poucos, então primeiro você precisa abandonar completamente o TinyMCE e só então assumir a lógica de exibir postagens para leitura. Além disso,nem todas as postagens antigas conseguiram traduzir o conteúdo para um novo formato, o que significa que essas postagens sempre serão armazenadas apenas em HTML e é necessário que elas também mantenham a capacidade de ler.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Total: parte das postagens (todas as novas e antigas que foram transferidas com sucesso para o novo formato) serão armazenadas em dois formatos - HTML e corpo estruturado - até que a nova lógica de exibição da leitura seja implementada e o restante (a maioria das antigas e muito muito antigas) posts) permanecerá apenas em HTML.</font></font><br>
<br>
<a name="How"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Como escolher uma ferramenta</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tivemos que perceber a capacidade de editar e criar uma postagem no cliente, levando em consideração os recursos e limitações acima. Como sempre, você pode escolher uma solução pronta ou criar a sua própria. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para começar, examinamos o que são as bibliotecas prontas para a criação de editores WYSIWYG e se elas são adequadas para nós. Optamos por </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Slate</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Draft.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProseMirror</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Além de armazenar conteúdo em uma estrutura de dados, o momento crítico para nós também foi a capacidade de trabalhar com o Vue ou JS puro, porque já começamos a mover o site para uma nova pilha tecnológica usando o Vue + Vuex. Além disso, eu gostaria de expandir os recursos da biblioteca concluída com a ajuda de novos módulos (de terceiros ou auto-gravados), se necessário.</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aba. </font><font style="vertical-align: inherit;">1. Comparação das bibliotecas revisadas pelos parâmetros mais importantes do Sports.ru</font></font></i><br>
<img src="https://habrastorage.org/webt/fw/hf/xa/fwhfxa6ozwkyfdpdj8t6j5lcbuy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Como você pode ver na tabela, o ProseMirror atendeu totalmente aos nossos requisitos, por isso não consideramos mais a idéia de escrever nossa própria biblioteca para editar o conteúdo do texto, mas começamos a estudá-la com mais detalhes. </font><font style="vertical-align: inherit;">Ainda existe um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quill</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bastante popular </font><font style="vertical-align: inherit;">, que não entrou em nossa comparação apenas porque honestamente o esquecemos na fase de seleção de uma ferramenta. </font><font style="vertical-align: inherit;">De acordo com nossos principais requisitos, ele também passa, mas aconteceu. </font><font style="vertical-align: inherit;">Já falamos sobre o que é o ProseMirror e como trabalhar com ele em outro </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<a name="What"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. O que aconteceu</font></font></h2><br>
<a name="Architecture"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1 </font><font style="vertical-align: inherit;">Arquitetura de Serviço</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O próprio editor de conteúdo no cliente está longe de tudo. </font><font style="vertical-align: inherit;">Você precisa colocar o editor em um projeto existente, exibi-lo em algum lugar da página da web e também considerar a interação com o back-end, resolver o problema de oferecer suporte simultâneo a dois editores (não era possível abandonar imediatamente o antigo) e armazenar o conteúdo em dois formatos (HTML e estruturado). corpo). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todas essas tarefas podem ser divididas nas relacionadas ao frontend, backend e sua integração. </font><font style="vertical-align: inherit;">Estamos preocupados principalmente com problemas de front-end e integração, embora também mencionemos alguns aspectos importantes das tarefas de back-end. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os serviços de front-end para o editor podem ser divididos em vários níveis:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">página da web para criar e editar uma postagem;</font></font></li>
<li>Vue-app,    .  ,  ,   Vue,         -, , , ,       ..,    ,         ,      ;</li>
<li>WYSIWYG-   ProseMirror,      Vue.      ,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>;</li>
<li>SB2HTML –    HTML  structured body,    .    , structured body –       ,    .      ,   ,     ,      .    Sports.ru     HTML  structured body,  -     HTML  .       HTML    Node.Js,        JS-   .<br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O processo de salvar a postagem é mostrado na Fig. </font><font style="vertical-align: inherit;">2. O conteúdo da postagem no formato do corpo estruturado e seus metadados são transferidos para o back-end. </font><font style="vertical-align: inherit;">O back-end envia conteúdo para o serviço SB2HTML, recebe HTML pronto na resposta, coloca tudo isso no banco de dados e informa ao cliente que a postagem foi salva com sucesso ou relata um erro. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/of/fp/j8/offpj883_eq2swjl-ogb6jxprks.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. </font><font style="vertical-align: inherit;">2. Esquema para salvar uma postagem ao criar ou editar em um editor WYSIWYG</font></font></i><br>
<br>
<a name="Difficulties"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2 </font><font style="vertical-align: inherit;">Que dificuldades você enfrentou?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Houve muitas dificuldades, surgiram constantemente e frequentemente nos momentos mais inesperados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como já dissemos, o editor de conteúdo está localizado dentro do formulário, o que permite inserir dados adicionais necessários para criar uma postagem, como título, anotação etc. Para anotação, deve ser possível baixar imagens de um arquivo e através de um link da Internet. Mas para o conteúdo também queremos carregar imagens de um arquivo e por referência, além disso, de acordo com as mesmas regras. E aqui estamos diante de um dilema: por um lado, o conteúdo da postagem é editado a partir do formulário externo e editado usando as ferramentas ProseMirror, mas, por outro lado, quero observar o princípio </font></font><abbr title="Não se repita"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DRY</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e não duplique o mesmo código. Resolvemos isso da seguinte maneira: descrevemos o carregamento de imagens como um conjunto de métodos em um objeto no nível do formulário Vue e passamos esse objeto como um dos parâmetros para o construtor do editor WYSIWYG.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As entidades que descrevem o conteúdo - Nó e Fragmento - são definidas no modelo ProseMirror. No entanto, apenas índices são usados ​​para uma transação para determinar o intervalo de caracteres aos quais essa transação é aplicada (os índices são contados desde o início do documento e desde o início do nó pai). A indexação de caracteres é um dos conceitos centrais do ProseMirror, mas ao editar e formatar o texto, é muito mais conveniente pensar em entidades do modelo ProseMirror. Como resultado, para um trabalho confortável com o conteúdo, escrevemos nossos auxiliares para simplificar a interação com um documento para transações. Após o início do nosso trabalho, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apareceu a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> biblioteca de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">dicas</font></a><font style="vertical-align: inherit;"> , que é um conjunto de ajudantes semelhantes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O próximo problema foi que, na fase de criação do esquema, percebemos que já possuímos um formato interno aprovado para armazenar conteúdo - um corpo estruturado que atende às nossas necessidades, e o ProseMirror armazena o conteúdo em seu próprio formato em uma história. Mudar para o formato ProseMirror foi difícil e impraticável. Nos encontramos em uma situação em que dados em um formato chegam ao cliente por meio da API e outro precisa ser exibido. Uma situação semelhante surge quando é necessário salvar o conteúdo modificado ou criado. Para isso, implementamos um conversor que converte formatos para frente e para trás. Eles escreveram um teste simples para ele, que pega o conteúdo de uma postagem no formato de corpo estruturado, converte-o no formato ProseMirror, depois volta e já compara a versão original com a recebida. Acabou de forma rápida e fácil.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais tarde, à medida que o esquema de documentos mudou e, em regra, se tornou mais complicado, ficou claro que a menor alteração poderia levar a erros no editor, e esse teste parece dar uma cobertura muito ruim. Como resultado, tive que escrever testes em quase todas as combinações de nós e marcas em dois pequenos métodos de conversão. Agora, sem esses testes, é impossível determinar se a próxima mudança no circuito quebrará algo ou não.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O próximo problema está novamente relacionado à necessidade de compatibilidade com versões anteriores de novas e antigas tecnologias. Nosso editor WYSIWYG é implementado apenas em navegadores (desktop e, em breve, mobile). Assim, para editar o conteúdo no cliente é fornecido em JSON no formato corpo estruturado, no entanto, a leitura de postagens em navegadores é realizada apenas a partir de HTML. Ao mesmo tempo, a maioria dos aplicativos móveis já mudou para a exibição de postagens de usuários diretamente do corpo estruturado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para aplicativos móveis, era necessário prever o caso em que o cliente não pode processar algum elemento do corpo estruturado. Por exemplo, se um novo elemento for adicionado ao corpo estruturado, cuja exibição será implementada apenas em uma versão mais recente do aplicativo. Como nem todos os usuários atualizam seus aplicativos ao mesmo tempo, era necessário fornecer um plano “B” para versões mais antigas: em vez de criar HTML a partir do corpo estruturado, insira um fragmento HTML pronto para o elemento desejado. A presença de fragmentos HTML para cada elemento não foi fornecida no esquema do corpo estruturado, porque a própria idéia dessa estrutura era recusar-se a armazenar dados em HTML. Mas, no final, chegamos à conclusão de que precisamos de dois esquemas de corpos estruturados - um para exibição e outro para edição. As diferenças entre os esquemas sãoque o corpo estruturado para edição contém apenas o conteúdo do artigo e, para exibição, adicionamos alguns elementos adicionais. Em particular, um fragmento HTML para cada elemento é criado quando uma postagem é salva no serviço SB2HTML e é adicionada apenas ao corpo estruturado para exibir a postagem. Além disso, o corpo estruturado também exibe espaço publicitário no conteúdo para exibição.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando abrimos o conteúdo para edição em um navegador, basicamente não conseguimos encontrar um elemento desconhecido, porque todas as postagens são criadas e exibidas da mesma maneira. Mas eles decidiram prever esse caso também para o futuro. Para fazer isso, adicionamos um elemento stub padrão ao esquema ProseMirror. Nomeamos esse elemento como não suportadoBlock. O esboço aparece no lugar de um item não suportado. Nós o estilizamos como um retângulo cinza com texto informando que este elemento não é suportado e não pode ser editado. Quando uma postagem é salva, esse elemento permanece inalterado no corpo estruturado. O usuário pode alterar sua localização em relação a outros elementos, mas o conteúdo interno de um elemento desconhecido não pode ser alterado ou editado. No entanto, o usuário pode excluir esse elemento e, é claro,não será salvo no documento final.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos os problemas descritos estavam relacionados às dificuldades de implementar o próprio editor WYSIWYG. Porém, embora existisse no modo beta, não pudemos abandonar o editor antigo no TinyMCE e fomos forçados a oferecer suporte a ambos os editores, fornecendo compatibilidade com versões anteriores. Por exemplo, você pode criar uma postagem no editor WYSIWYG, salvar e editá-la no TinyMCE, salvar, abri-la novamente no WYSIWYG e assim por diante. Como resultado, ao abrir no WYSIWYG, vimos o mesmo conteúdo do salvamento anterior no TinyMCE. Para implementar a compatibilidade com versões anteriores, era necessário enviar o conteúdo HTML para o TinyMCE, que já aprendemos a criar a partir do corpo estruturado e salvar no banco de dados enquanto salvava a postagem. E ao salvar uma postagem através do TinyMCE, o conteúdo criado no servidor é executado através do serviço HTML2SB,Como resultado, podemos salvar HTML fresco e corpo estruturado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HTML2SB é o oposto do que SB2HTML faz, ou seja, converte conteúdo de HTML em corpo estruturado. </font><font style="vertical-align: inherit;">Cronologicamente, esse serviço apareceu mais cedo do que qualquer outra coisa, porque antes da criação do editor WYSIWYG, a única maneira de obter conteúdo da postagem no formato de corpo estruturado era a análise direta do HTML. </font><font style="vertical-align: inherit;">O HTML2SB fazia parte da infraestrutura de back-end em torno do editor de postagem, mas depois de abandonar o TinyMCE, ele não era mais necessário.</font></font><br>
<br>
<a name="Results"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Resultados beta</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, o editor WYSIWYG está disponível para todos os usuários na versão beta e em breve se tornará o principal editor de postagens do Sports.ru. </font><font style="vertical-align: inherit;">Já recebemos uma ferramenta para criar e editar postagens que atendem à maioria dos nossos requisitos:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a interface do editor tornou-se clara, concisa e moderna, escrever posts longos ficou muito mais fácil;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora você pode baixar imagens de um arquivo e por um link que é imediatamente colocado em nosso armazenamento;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adicionou a opção de incorporar incorporações das principais redes sociais e sites de hospedagem de vídeo;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estilos de formatação de texto limpos;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">os aplicativos para dispositivos móveis já mudaram para exibir postagens do corpo estruturado e podem definir seus próprios estilos de conteúdo.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, o editor ainda não está totalmente depurado, periodicamente detectamos novos bugs. </font><font style="vertical-align: inherit;">As seguintes atualizações estão chegando:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">salvamento automático;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versão WYSIWYG para usuários com direitos estendidos (administradores, editores em tempo integral);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">criar e editar postagens de navegadores móveis;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mensagens sobre edição paralela de um documento por vários usuários;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dicas e integração;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">widgets estatísticos para equipes esportivas, partidas e escalações.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No momento da redação deste artigo, mais de 13.000 postagens já foram publicadas na versão beta do editor, que representa cerca de 20% do número total de textos de usuários no Sports.ru no período de junho de 2019 a fevereiro de 2020, inclusive. O compartilhamento de postagens criadas e publicadas por meio do novo editor está crescendo constantemente. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ad/2i/4b/ad2i4b4dubgv9--l-vl7ghh6cnw.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 3. A proporção de postagens de usuários criadas e publicadas no novo editor</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que o crescimento orgânico na participação de posts de usuários criados e publicados por meio do novo editor é um sinal de satisfação dos usuários com a atualização, o que também é confirmado pelo feedback no anúncio de seu lançamento em testes beta (alguns deles são mostrados na Figura 4). </font><font style="vertical-align: inherit;">Portanto, nos próximos meses, planejamos transferir completamente a criação de postagens para o novo editor, de modo a focar apenas em seu suporte e desenvolvimento.&nbsp;</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A propósito, que funcionalidade você adicionaria ao nosso editor WYSIWYG? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/k-/bm/nz/k-bmnzzgoh5wi-nvq516-pca8uk.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. </font><font style="vertical-align: inherit;">4. Comentários do usuário em um post com o anúncio da atualização do editor WYSIWYG&nbsp;</font></font></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt492216/index.html">Salvando valores em um aplicativo .Net no Build</a></li>
<li><a href="../pt492218/index.html">Regras de design de ícone para lembrar</a></li>
<li><a href="../pt492220/index.html">5 segredos pouco conhecidos dos pandas</a></li>
<li><a href="../pt492222/index.html">Artigo: CTFZone Quals 2019: Chicken</a></li>
<li><a href="../pt492226/index.html">Comparação de preços em Kubernetes gerenciados (2020)</a></li>
<li><a href="../pt492232/index.html">Como as Smartcalls se tornaram o Voximplant Kit - recursos de rebranding e killer</a></li>
<li><a href="../pt492234/index.html">Pesquisa: por que as pessoas estão prontas para receber menos em projetos sociais</a></li>
<li><a href="../pt492242/index.html">M5Stack e seus contatos</a></li>
<li><a href="../pt492244/index.html">Remoção durante o período de coronavírus: "prisão" domiciliar ou tempo de oportunidade?</a></li>
<li><a href="../pt492246/index.html">Coronavírus: possíveis implicações para a sociedade, economia e medicina</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>