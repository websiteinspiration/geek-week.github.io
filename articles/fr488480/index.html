<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñïüèº üë®üèº üöæ Une lampe intelligente pour les "riches" avec leurs mains "paresseuses", c'est "simple" et pratique üî™ üçï üôà</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="introduction
 Il a fait un √©clairage ¬´moderne¬ª dans la cuisine pour un √©vier, une cuisini√®re et une table de d√©coupe sur la base d'une bande LED contr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Une lampe intelligente pour les "riches" avec leurs mains "paresseuses", c'est "simple" et pratique</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488480/"><img src="https://habrastorage.org/webt/os/hi/gl/oshiglmjknpmabuu6ivivauqzdw.jpeg"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">introduction</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il a fait un √©clairage ¬´moderne¬ª dans la cuisine pour un √©vier, une cuisini√®re et une table de d√©coupe sur la base d'une bande LED contr√¥l√©e par Arduino (que l'on appelle la lampe 1). </font><font style="vertical-align: inherit;">Cette conception a fonctionn√© pendant 2 ans, jusqu'√† ce que la partie puissance des "cerveaux" se soit d√©t√©rior√©e. </font><font style="vertical-align: inherit;">C'est une excellente occasion de r√©inventer la roue de la ¬´poubelle improvis√©e¬ª (lampe 2). </font><font style="vertical-align: inherit;">Certes, cette fois, la ¬´poubelle¬ª sera ch√®re et compatible avec la maison intelligente Z-wave. </font><font style="vertical-align: inherit;">Ce qui suit est une histoire sur le remplacement d'arduino par ZUNo (un module compatible arduino pour cr√©er un p√©riph√©rique Z-wave) avec une sauvegarde maximale du code et une explication des changements n√©cessaires.</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que s'est-il pass√© avant que j'y apparaisse</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il √©tait une fois, pour laver la vaisselle ou faire cuire des aliments, il fallait allumer la lampe au dessus de l'√©vier. </font><font style="vertical-align: inherit;">C'√©tait une lampe de table refaite. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'aimais pas appuyer sur le petit interrupteur avec les mains mouill√©es car il commutait 220 volts sur la lampe √† incandescence. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tl/yz/dq/tlyzdqgfcsedxxsswsqlekygins.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, la lumi√®re de la lampe tombait principalement sur l'√©vier, mais je voulais mieux √©clairer la table de cuisson et la cuisini√®re. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objectifs:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Rendre la lumi√®re marche / arr√™t dans la cuisine sans contact;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √âclairer uniform√©ment l'√©vier, la table de cuisson et la cuisini√®re;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √âconomisez de l'√©nergie en rempla√ßant les ampoules √† incandescence par des LED.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il a assembl√© la lampe 1. Elle se composait d'un bo√Ætier en aluminium de 2 m√®tres avec un diffuseur pour ruban RVB et une unit√© de contr√¥le. Une bo√Æte et un diffuseur ont √©t√© achet√©s pr√™ts √† l'emploi au magasin, il y avait une bande et l'unit√© de contr√¥le √©tait depuis longtemps dans le coin et attendait dans les coulisses. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le bo√Ætier √©tait industriel (√©tanche √† la poussi√®re, √©tanche). Comme la bande est de 12 volts, l'unit√© d'alimentation de 220 V √† 12 V est situ√©e dans l'unit√©, la carte d'isolement galvanique pour contr√¥ler la bande bas√©e sur TLP250 (optocoupleur) a √©galement contr√¥l√© tout cet arduino dans un design compact.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 J'ai obtenu l'isolement galvanique de l'ancien projet. Une fois, j'ai fait un r√©tro-√©clairage pour un minibar dans ma table de nuit. Lorsque la porte a √©t√© ouverte, le pav√© tactile a enregistr√© un changement de capacit√© et allum√© une lumi√®re scintillante doucement. Autrement dit, le conseil d'administration √©tait bien adapt√© pour le projet actuel, il ne restait plus qu'√† couper tout ce qui n'√©tait pas n√©cessaire. Il y avait un convertisseur lin√©aire de 5 volts sur la carte, il √©tait aliment√© par ZUNo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il √©tait pr√©vu d'allumer la lampe avec un plateau √† main pour le t√©l√©m√®tre √† ultrasons. Il l'a mont√© dans le couvercle, et toutes les autres pi√®ces sont entr√©es dans la bo√Æte. Le tout ¬´de mani√®re fiable¬ª fix√© avec un adh√©sif thermofusible. Au moment des tests, j'ai cr√©√© un bouton √† proximit√© pour alimenter l'unit√© de commande √† partir d'un interrupteur d'√©clairage pour une installation externe.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/r2/dn/tj/r2dntjzjoijyn-g7vk4vdkg-d5y.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Allumer les lumi√®res est devenu plus pratique et plus s√ªr. </font><font style="vertical-align: inherit;">Il √©tait attach√© √† l'envers au bas de l'armoire de cuisine et il √©tait plus difficile d'obtenir de l'eau des mains mouill√©es de l'int√©rieur.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusions de l'unit√© de contr√¥le pr√©c√©dente</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'√©clairage de la zone de travail de la cuisine est devenu plus uniforme et plus agr√©able, en raison du rendu des couleurs non naturel de ma bande LED, la couleur de certains produits a chang√©. </font><font style="vertical-align: inherit;">Par exemple: les carottes semblaient beaucoup plus app√©tissantes en raison de leur couleur plus vive. </font><font style="vertical-align: inherit;">Mais cela n'a pas beaucoup interf√©r√©, et j'esp√®re que cela n'a pas fait beaucoup de mal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec l'activation / la d√©sactivation sans contact, tout s'est av√©r√© pire. </font><font style="vertical-align: inherit;">√áa a march√©. </font><font style="vertical-align: inherit;">Mais apr√®s 5 minutes √† l'arr√™t, des flashs ont commenc√© sur la bande LED. </font><font style="vertical-align: inherit;">Je n'ai pas remodel√© le circuit sur les optocoupleurs et tout laiss√© tel quel. </font><font style="vertical-align: inherit;">Seulement pour allumer et √©teindre a commenc√© √† utiliser le nouveau commutateur. </font><font style="vertical-align: inherit;">Tout le monde a aim√© son emplacement et sa forme.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus de deux ans d'utilisation, les graisses et autres compos√©s s√©cr√©t√©s lors de la cuisson se sont accumul√©s sur le corps et √† l'int√©rieur. </font><font style="vertical-align: inherit;">Cette plaque a p√©n√©tr√© partiellement dans le bo√Ætier √† travers les trous pour l'entr√©e des fils. </font><font style="vertical-align: inherit;">Mais en raison de la surface brillante du corps, cette substance se condense en une masse g√©latineuse. </font><font style="vertical-align: inherit;">C'est agr√©able au toucher, inodore et ... (je ne l'ai pas go√ªt√©). </font><font style="vertical-align: inherit;">J'ai pris quelques photos de l'endroit sous la forme d'un germe de dragon. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jz/fr/ys/jzfrystsmthfk7fy5j_o70kkcfm.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/ot/br/mg/otbrmglxan7uooc1a1e4n88z9iq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur les murs, cette substance se transforme en un terrible raid, qui n'est pas seulement blanchi.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'est devenu</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir fouill√© dans des bacs, j'ai trouv√© un module d'extension inachev√© pour ZUNo. </font><font style="vertical-align: inherit;">ZUNo est une carte de type Arduino pour concevoir votre propre appareil compatible avec la maison intelligente Z-Wave. </font><font style="vertical-align: inherit;">Il est programm√© √† partir de l'environnement de l'arduino.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sp√©cifications du fabricant:</font></font></b><div class="spoiler_text"><ul>
<li>28 kB Flash memory for your sketches</li>
<li>2 kB RAM available</li>
<li>Z-Wave RF transmitter at 9.6/40/100 kbps</li>
<li>26 GPIO (overlaps with special hardware controllers)</li>
<li>4 ADC</li>
<li>5 PWM</li>
<li>2 UART</li>
<li>1 USB (serial port)</li>
<li>16 kB EEPROM</li>
<li>1 SPI (master or slave)</li>
<li>4 IR controllers, 1 IR learn capability</li>
<li>1 TRIAC/ZEROX to control dimmer</li>
<li>3 Interrupts</li>
<li>1 Timer 4 MHz</li>
<li>I2C (software)</li>
<li>1-Wire (software)</li>
<li>8x6 Keypad Scanner (software)</li>
<li>2 service LED, 1 service button</li>
<li>1 user test LED</li>
</ul><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le module d'extension fait de ZUNo une carte de d√©bogage √† part enti√®re, qui, apr√®s le d√©bogage du prototype, peut √™tre utilis√©e comme un appareil complet. </font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelques informations du fabricant:</font></font></b><div class="spoiler_text"><ul>
<li>One 0-10 V analog output ‚Äî control industrial dimmers</li>
<li>Up to four PWM or switch outputs (up to 5 A per channel) ‚Äî control contactors, switches, halogen bulbs or LED strips</li>
<li>Up to eight digital 0/3 V inputs or outputs ‚Äî connect various low voltage digital senors and actors</li>
<li>Up to four digital 0/3, 0/5 or 0/12 V digital or analog inputs ‚Äî connect industrial 10 V sensors or any Arduino-compatible sensor</li>
<li>RS485 or UART ‚Äî for industial meters</li>
<li>OneWire ‚Äî for DS18B20 or other sensors</li>
</ul><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour mon projet, j'ai besoin de 3 transistors puissants pour passer de 12 volts √† une bande LED et d'un convertisseur de 12 volts √† 5 volts pour alimenter ZUNo. </font><font style="vertical-align: inherit;">Le reste de la p√©riph√©rie du module d'extension n'est ni soud√© ni test√©. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4j/kr/tt/4jkrtt63ocqqrkugav0nrtfvtn8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cette partie du circuit, il n'y a pas assez de diode pour l'alimentation, pour la protection contre "l'inversion de polarit√©", et des r√©sistances aux grilles des transistors √† effet de champ de puissance devaient √™tre connect√©es √† la grille, et non devant la r√©sistance de limitation. </font><font style="vertical-align: inherit;">J'√©crirai plus √† ce sujet dans les conclusions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce module d'extension est fourni dans un bo√Ætier de Gainta. </font><font style="vertical-align: inherit;">Mon unit√© de contr√¥le pr√©c√©dente √©tait √©galement dans le cas de cette soci√©t√©, mais d'une taille diff√©rente. </font><font style="vertical-align: inherit;">Malheureusement, les fixations sur le module ne correspondaient pas √† l'ancien bo√Ætier, et je ne voulais pas en percer un nouveau, j'ai quitt√© l'ancien bo√Ætier. </font><font style="vertical-align: inherit;">Le panneau a √©t√© "plant√©" sur un adh√©sif thermofusible.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wm/ls/ah/wmlsahydh07_hxmpqaryl1atchs.jpeg"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un peu sur la programmation Arduino et ZUNo</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les appareils Z-wave doivent avoir un certain nombre de classes. Les cours d√©crivent les fonctions des appareils et les interfaces d'interaction. Par exemple, ma lampe contr√¥le une bande LED compos√©e de trois couleurs (rouge, vert, bleu). Ces fonctions sont ex√©cut√©es par la classe Switch multi-niveaux. Si nous l'ajoutons √† l'esquisse, nous pouvons modifier √† distance la luminosit√© de l'une des couleurs. Pour contr√¥ler trois couleurs, vous devez cr√©er trois instances de cette classe. Je n'en parlerai pas plus en d√©tail et en d√©tail. Parce que la manipulation de classe de routine est cach√©e pour les utilisateurs de ZUNo par la notion de ¬´canal¬ª. Par exemple, j'ai besoin de trois classes de Switch multi-niveaux, donc dans le code devrait appara√Ætre 3 canaux de Switch multi-niveaux et plusieurs fonctions de rappel pour le contr√¥le radio. Comment faire √ßa? Vous devez √©galement ajouter la classe de base Switch,pour allumer et √©teindre la lampe sur simple pression d'un bouton (√† partir de l'interface du contr√¥leur r√©seau), et ne pas configurer 3 canaux √† chaque fois.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous devez vous rendre sur le site Web des d√©veloppeurs, o√π sont pr√©sent√©s des exemples de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">z-uno.z-wave.me/Reference/ZUNO_SWITCH_MULTILEVEL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Chaque classe prise en charge par ZUNo a une description et un exemple. </font><font style="vertical-align: inherit;">Ensuite, copiez et collez les fonctions propos√©es dans votre croquis. </font><font style="vertical-align: inherit;">Maintenant, dans l'esquisse, il y a trois canaux de commutation √† plusieurs niveaux et 6 fonctions de rappel pour r√©pondre aux commandes de la radio. </font><font style="vertical-align: inherit;">Je ne suis pas tr√®s sophistiqu√© dans les classes Z-Wave, donc mon pr√©c√©dent p√©riph√©rique de bande LED fonctionnait avec cet ensemble de classes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les cha√Ænes ont √©t√© d√©clar√©es comme ceci:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cap de spoiler</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs">ZUNO_SETUP_CHANNELS(<font></font>
      ZUNO_SWITCH_MULTILEVEL(getRed, setRed),<font></font>
      ZUNO_SWITCH_MULTILEVEL(getGreen, setGreen),<font></font>
      ZUNO_SWITCH_MULTILEVEL(getBlue, setBlue),<font></font>
      ZUNO_SWITCH_BINARY(switch_getter, switch_setter)<font></font>
);</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela a conduit √† la g√©n√©ration des widgets suivants dans le contr√¥leur apr√®s l'ajout au r√©seau: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/to/-y/if/to-yif5eaf9xkuxdk4t2oxp6ph4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ajuster la couleur, il √©tait n√©cessaire d'ouvrir et de configurer chaque couleur dans le menu du contr√¥leur s√©par√©ment. </font><font style="vertical-align: inherit;">Ce n'est pas pratique et lent. </font><font style="vertical-align: inherit;">Cependant, j'ai eu de la chance. </font><font style="vertical-align: inherit;">Il s'est av√©r√© que je ne suis pas seul. </font><font style="vertical-align: inherit;">Ils ont pens√© √† nous et ont cr√©√© la cha√Æne </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">z-uno.z-wave.me/Reference/ZUNO_SWITCH_COLOR</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Maintenant, il n'y a qu'un canal et deux fonctions de rappel dans l'esquisse. </font><font style="vertical-align: inherit;">Dans le menu du contr√¥leur, le r√©glage des couleurs est effectu√© s√©par√©ment pour chaque couleur, ainsi que simultan√©ment, en s√©lectionnant dans la palette.</font></font><br>
<br>
<pre><code class="cpp hljs">ZUNO_SETUP_CHANNELS(ZUNO_SWITCH_COLOR(SWITCH_COLOR_FLAGS_RED|SWITCH_COLOR_FLAGS_GREEN|SWITCH_COLOR_FLAGS_BLUE, getterFunction, setterFunction));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et dans le menu du contr√¥leur, cela ressemble √† ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/m3/zn/qk/m3znqkbwue228cttqmqmhggvwxu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonction suivante r√©pond aux demandes par radio. </font><font style="vertical-align: inherit;">Une demande de lecture de l'√©tat de l'un des canaux de couleur peut survenir.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">BYTE <span class="hljs-title">getterFunction</span><span class="hljs-params">(BYTE component)</span> </span>{
  <span class="hljs-keyword">switch</span>(component)<font></font>
  {<font></font>
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_RED:
      <span class="hljs-keyword">return</span> pwmR;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_GREEN:
      <span class="hljs-keyword">return</span> pwmG;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_BLUE:
      <span class="hljs-keyword">return</span> pwmB;
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et c'est une fonction pour d√©finir les couleurs √† partir de l'interface du contr√¥leur.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setterFunction</span><span class="hljs-params">(BYTE component, BYTE newValue)</span> 
</span>{
  <span class="hljs-keyword">switch</span>(component)<font></font>
  {<font></font>
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_RED:<font></font>
      pwmR = newValue;<font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_GREEN:<font></font>
      pwmG = newValue;<font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_BLUE:<font></font>
      pwmB = newValue;<font></font>
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  radio_action = <span class="hljs-number">1</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout le code que vous devez ajouter pour transformer une esquisse Arduino en une esquisse pour ZUNo.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s l'assemblage et l'installation, toutes les t√¢ches d√©clar√©es ont √©t√© achev√©es. </font><font style="vertical-align: inherit;">Cependant, l'habitude d'allumer la lumi√®re avec l'interrupteur est rest√©e (cela s'est av√©r√© tr√®s pratique). </font><font style="vertical-align: inherit;">L'option d'inclusion sans contact fonctionne √©galement. </font><font style="vertical-align: inherit;">Parmi les lacunes, je tiens √† noter le scintillement de la lampe LED pendant une seconde apr√®s avoir aliment√© l'unit√© de contr√¥le. </font><font style="vertical-align: inherit;">Cela est d√ª √† la longue initialisation des p√©riph√©riques ZUNo. </font><font style="vertical-align: inherit;">√Ä ce stade, les jambes sont impr√©visibles. </font><font style="vertical-align: inherit;">Je pense que la r√©sistance de pull-up sur la grille du transistor corrigera la situation si vous la mettez apr√®s la r√©sistance de limitation. </font><font style="vertical-align: inherit;">Si le code d'initialisation ajuste les jambes √† la sortie et modifie d√©lib√©r√©ment les niveaux logiques, vous pouvez exp√©rimenter avec le filtre RC, qui ne passera pas de courtes impulsions. </font><font style="vertical-align: inherit;">Je ne l'ai pas encore fait, et peut-√™tre que je ne le ferai jamais!</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©sultats</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ZUNo et son module d'extension simplifient grandement la ¬´cr√©ativit√© technique √† domicile¬ª. Cependant, je consid√®re que ces produits sont tr√®s chers et si je travaillais ailleurs et que l'√©quipement Z-Wave ne tra√Ænait pas, je ferais tout sur ESP8266. Pendant le d√©veloppement, j'ai appris une nouvelle ¬´norme¬ª pour marquer les fils de l'alimentation.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sx/c4/4h/sxc44hipyu2ml_agdxtaqthtvrs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant non seulement la terre est marqu√©e d'une bande noire, mais comme dans mon cas le fil "positif". Pour le module d'extension, cela s'est av√©r√© important. Le convertisseur 5 volts LM2594 est tomb√© en panne (le prix en Chip and Dip est d'environ 200 roubles). J'esp√®re que dans la prochaine version du module d'extension il y aura une diode de protection contre ¬´l'inversion de polarit√©¬ª. Et je vais v√©rifier la polarit√© des fils d'alimentation. Un autre inconv√©nient est associ√© au corps. Le bo√Ætier a l'air bien, mais je n'ai pas pu connecter les fils sans pince aux borniers. J'esp√®re qu'il y aura une version avec d'autres borniers (pour connecter les fils par le haut ou en biais). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'aime pas stocker de photos sur les services cloud et je fais souvent des sauvegardes. Par cons√©quent, la plupart des photographies associ√©es au processus de conception et √† la lampe 1 sont irr√©m√©diablement corrompues.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zz/wz/ov/zzwzovgton7f2yxvy-2bd4zhucu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout ce qui reste du processus d'assemblage et de d√©bogage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et cela ressemble au r√©tro√©clairage mis en service, si vous vous penchez un peu. </font><font style="vertical-align: inherit;">Si vous vous redressez, la bo√Æte et le commutateur ne sont pas visibles.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ya/qj/hn/yaqjhnpkhd7ge2ohejbp9ywkqpq.jpeg"> <br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esquisse pour ZUNo. </font><font style="vertical-align: inherit;">J'attache, seulement pour confirmer que tout est √©l√©mentaire</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"EEPROM.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"EEPR.h"</span></span><font></font>
<font></font>
<span class="hljs-keyword">int</span> readPin = <span class="hljs-number">9</span>;
<span class="hljs-keyword">int</span> triggerPin = <span class="hljs-number">10</span>;<font></font>
byte controlState = <span class="hljs-number">0</span>;<font></font>
word lastValue;<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> REDPIN   PWM1     <span class="hljs-comment">// pin connection R </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> GREENPIN PWM2     <span class="hljs-comment">// pin connection G</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> BLUEPIN  PWM3     <span class="hljs-comment">// pin connection B</span></span><font></font>
<font></font>
ZUNO_SETUP_CHANNELS(ZUNO_SWITCH_COLOR(SWITCH_COLOR_FLAGS_RED|SWITCH_COLOR_FLAGS_GREEN|SWITCH_COLOR_FLAGS_BLUE, getterFunction, setterFunction));<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ON 1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> OFF 0</span>
<span class="hljs-keyword">uint8_t</span> switch_=OFF;<font></font>
<font></font>
<span class="hljs-keyword">uint8_t</span> pwmR=<span class="hljs-number">0</span>;
<span class="hljs-keyword">uint8_t</span> pwmG=<span class="hljs-number">0</span>;
<span class="hljs-keyword">uint8_t</span> pwmB=<span class="hljs-number">0</span>;
<span class="hljs-keyword">uint8_t</span> b_pwmR=<span class="hljs-number">0</span>;
<span class="hljs-keyword">uint8_t</span> b_pwmG=<span class="hljs-number">0</span>;
<span class="hljs-keyword">uint8_t</span> b_pwmB=<span class="hljs-number">0</span>;<font></font>
<font></font>
<span class="hljs-keyword">enum</span><font></font>
{<font></font>
  DEF_R = <span class="hljs-number">255</span>,<font></font>
  DEF_G = <span class="hljs-number">255</span>,<font></font>
  DEF_B = <span class="hljs-number">255</span><font></font>
};<font></font>
<span class="hljs-keyword">uint8_t</span> radio_action = <span class="hljs-number">0</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> 
</span>{ <font></font>
  init_EEPROM();<font></font>
  Serial.begin();<font></font>
  pinMode(readPin, INPUT);<font></font>
  pinMode(triggerPin, OUTPUT);<font></font>
  digitalWrite(triggerPin, LOW);<font></font>
  pinMode(REDPIN, OUTPUT);<font></font>
  pinMode(GREENPIN, OUTPUT);<font></font>
  pinMode(BLUEPIN, OUTPUT);<font></font>
  analogWrite(REDPIN, pwmR &amp; <span class="hljs-number">0xff</span>);<font></font>
  analogWrite(GREENPIN, pwmG &amp; <span class="hljs-number">0xff</span>);<font></font>
  analogWrite(BLUEPIN, pwmB &amp; <span class="hljs-number">0xff</span>);<font></font>
  <font></font>
} <font></font>
<span class="hljs-keyword">int</span> act=<span class="hljs-number">1</span>;
<span class="hljs-keyword">int</span> actf = <span class="hljs-number">0</span>;
<span class="hljs-keyword">int</span> cnt=<span class="hljs-number">57</span>; <font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">int</span> tmp;
  <span class="hljs-comment">// trigger measurement</span><font></font>
  digitalWrite(triggerPin, LOW);<font></font>
  delayMicroseconds(<span class="hljs-number">10</span>);<font></font>
  digitalWrite(triggerPin, HIGH);<font></font>
  delayMicroseconds(<span class="hljs-number">10</span>);<font></font>
  digitalWrite(triggerPin, LOW);<font></font>
  <span class="hljs-comment">// read pulse width</span>
  tmp = pulseIn(readPin, HIGH, <span class="hljs-number">100000</span>);<font></font>
  lastValue = tmp / <span class="hljs-number">58</span>;<font></font>
  Serial.print(<span class="hljs-string">" cm= "</span>);<font></font>
  Serial.println(lastValue);<font></font>
  <span class="hljs-keyword">if</span> (lastValue &lt; <span class="hljs-number">30</span>)<font></font>
  {<font></font>
    cnt++;<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    cnt--;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (cnt &gt; <span class="hljs-number">55</span>)<font></font>
  { <font></font>
    act=<span class="hljs-number">1</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (cnt &gt; <span class="hljs-number">60</span>)<font></font>
    cnt= <span class="hljs-number">60</span>;
  <span class="hljs-keyword">if</span> (cnt &lt; <span class="hljs-number">50</span>)<font></font>
  {<font></font>
    act=<span class="hljs-number">0</span>;<font></font>
    actf=<span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (cnt &lt; <span class="hljs-number">45</span> )<font></font>
    cnt = <span class="hljs-number">45</span>;<font></font>
  <font></font>
  <span class="hljs-keyword">if</span> ((act == <span class="hljs-number">1</span>) &amp;&amp; (actf == <span class="hljs-number">0</span>))<font></font>
  {  <font></font>
    actf = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">if</span> (switch_ == OFF)<font></font>
    {<font></font>
      switch_=ON;<font></font>
      b_pwmG = pwmG;<font></font>
      b_pwmB = pwmB;<font></font>
      b_pwmR = pwmR;<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
      switch_=OFF;<font></font>
      b_pwmR=<span class="hljs-number">0</span>;<font></font>
      b_pwmG=<span class="hljs-number">0</span>;<font></font>
      b_pwmB=<span class="hljs-number">0</span>;<font></font>
    }<font></font>
    analogWrite(REDPIN, b_pwmR &amp; <span class="hljs-number">0xff</span>);<font></font>
    analogWrite(GREENPIN, b_pwmG &amp; <span class="hljs-number">0xff</span>);<font></font>
    analogWrite(BLUEPIN, b_pwmB &amp; <span class="hljs-number">0xff</span>); <font></font>
  } <font></font>
  <font></font>
  Serial.print(<span class="hljs-string">"cnt = "</span>);    <font></font>
  Serial.print(cnt);  <font></font>
  Serial.print(<span class="hljs-string">" || "</span>);    <font></font>
  Serial.print(pwmR);  <font></font>
  Serial.print(<span class="hljs-string">" "</span>);      <font></font>
  Serial.print(pwmG);  <font></font>
  Serial.print(<span class="hljs-string">" "</span>);<font></font>
  Serial.print(pwmB);  <font></font>
  Serial.print(<span class="hljs-string">" "</span>);<font></font>
  Serial.println(<span class="hljs-string">""</span>);
 <span class="hljs-comment">// delay(10);</span><font></font>
<font></font>
 <span class="hljs-keyword">if</span>(radio_action)<font></font>
 {<font></font>
    radio_action = <span class="hljs-number">0</span>;<font></font>
    eepr_save_col();<font></font>
    analogWrite(REDPIN, pwmR &amp; <span class="hljs-number">0xff</span>);<font></font>
    analogWrite(GREENPIN, pwmG &amp; <span class="hljs-number">0xff</span>);<font></font>
    analogWrite(BLUEPIN, pwmB &amp; <span class="hljs-number">0xff</span>);<font></font>
 }<font></font>
}<font></font>
<font></font>
<span class="hljs-function">BYTE <span class="hljs-title">getterFunction</span><span class="hljs-params">(BYTE component)</span> </span>{
  <span class="hljs-keyword">switch</span>(component)<font></font>
  {<font></font>
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_RED:
      <span class="hljs-keyword">return</span> pwmR;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_GREEN:
      <span class="hljs-keyword">return</span> pwmG;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_BLUE:
      <span class="hljs-keyword">return</span> pwmB;
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setterFunction</span><span class="hljs-params">(BYTE component, BYTE newValue)</span> 
</span>{
  <span class="hljs-keyword">switch</span>(component)<font></font>
  {<font></font>
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_RED:<font></font>
      pwmR = newValue;<font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_GREEN:<font></font>
      pwmG = newValue;<font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_BLUE:<font></font>
      pwmB = newValue;<font></font>
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  radio_action = <span class="hljs-number">1</span>;<font></font>
}<font></font>
</code></pre><br>
</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr488470/index.html">Kim Dotcom: Caught, la personne la plus recherch√©e en ligne. Partie 4</a></li>
<li><a href="../fr488472/index.html">Week-end de lecture: 10 documents sur les gadgets audio - des autoradios sovi√©tiques aux prises antibruit</a></li>
<li><a href="../fr488474/index.html">A propos de la couleur, du son et de ¬´l'exploration des foules¬ª en tant que beaut√©</a></li>
<li><a href="../fr488476/index.html">Bobine de tube Tesla</a></li>
<li><a href="../fr488478/index.html">Transf√©rer toutes les bases de donn√©es MS SQL Server sur une autre machine</a></li>
<li><a href="../fr488482/index.html">Combien co√ªte Appium pour le peuple</a></li>
<li><a href="../fr488484/index.html">Lancement SQL - √âv√©nement Microsoft SQL Server 2019</a></li>
<li><a href="../fr488488/index.html">Pour OpenBSD. Un peu de plaisir</a></li>
<li><a href="../fr488490/index.html">Likbez sur les respirateurs. Le respirateur aide-t-il √† l'infection par le virus? Aper√ßu de 11 respirateurs</a></li>
<li><a href="../fr488498/index.html">Laboratoires de l'Universit√© ITMO: √©clairage LED, opto√©lectronique micro-ondes et t√©l√©communications optiques</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>