<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🖕🏼 👨🏼 🚾 Une lampe intelligente pour les "riches" avec leurs mains "paresseuses", c'est "simple" et pratique 🔪 🍕 🙈</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="introduction
 Il a fait un éclairage «moderne» dans la cuisine pour un évier, une cuisinière et une table de découpe sur la base d'une bande LED contr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Une lampe intelligente pour les "riches" avec leurs mains "paresseuses", c'est "simple" et pratique</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488480/"><img src="https://habrastorage.org/webt/os/hi/gl/oshiglmjknpmabuu6ivivauqzdw.jpeg"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">introduction</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il a fait un éclairage «moderne» dans la cuisine pour un évier, une cuisinière et une table de découpe sur la base d'une bande LED contrôlée par Arduino (que l'on appelle la lampe 1). </font><font style="vertical-align: inherit;">Cette conception a fonctionné pendant 2 ans, jusqu'à ce que la partie puissance des "cerveaux" se soit détériorée. </font><font style="vertical-align: inherit;">C'est une excellente occasion de réinventer la roue de la «poubelle improvisée» (lampe 2). </font><font style="vertical-align: inherit;">Certes, cette fois, la «poubelle» sera chère et compatible avec la maison intelligente Z-wave. </font><font style="vertical-align: inherit;">Ce qui suit est une histoire sur le remplacement d'arduino par ZUNo (un module compatible arduino pour créer un périphérique Z-wave) avec une sauvegarde maximale du code et une explication des changements nécessaires.</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que s'est-il passé avant que j'y apparaisse</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il était une fois, pour laver la vaisselle ou faire cuire des aliments, il fallait allumer la lampe au dessus de l'évier. </font><font style="vertical-align: inherit;">C'était une lampe de table refaite. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'aimais pas appuyer sur le petit interrupteur avec les mains mouillées car il commutait 220 volts sur la lampe à incandescence. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tl/yz/dq/tlyzdqgfcsedxxsswsqlekygins.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, la lumière de la lampe tombait principalement sur l'évier, mais je voulais mieux éclairer la table de cuisson et la cuisinière. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objectifs:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Rendre la lumière marche / arrêt dans la cuisine sans contact;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Éclairer uniformément l'évier, la table de cuisson et la cuisinière;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Économisez de l'énergie en remplaçant les ampoules à incandescence par des LED.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il a assemblé la lampe 1. Elle se composait d'un boîtier en aluminium de 2 mètres avec un diffuseur pour ruban RVB et une unité de contrôle. Une boîte et un diffuseur ont été achetés prêts à l'emploi au magasin, il y avait une bande et l'unité de contrôle était depuis longtemps dans le coin et attendait dans les coulisses. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le boîtier était industriel (étanche à la poussière, étanche). Comme la bande est de 12 volts, l'unité d'alimentation de 220 V à 12 V est située dans l'unité, la carte d'isolement galvanique pour contrôler la bande basée sur TLP250 (optocoupleur) a également contrôlé tout cet arduino dans un design compact.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 J'ai obtenu l'isolement galvanique de l'ancien projet. Une fois, j'ai fait un rétro-éclairage pour un minibar dans ma table de nuit. Lorsque la porte a été ouverte, le pavé tactile a enregistré un changement de capacité et allumé une lumière scintillante doucement. Autrement dit, le conseil d'administration était bien adapté pour le projet actuel, il ne restait plus qu'à couper tout ce qui n'était pas nécessaire. Il y avait un convertisseur linéaire de 5 volts sur la carte, il était alimenté par ZUNo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il était prévu d'allumer la lampe avec un plateau à main pour le télémètre à ultrasons. Il l'a monté dans le couvercle, et toutes les autres pièces sont entrées dans la boîte. Le tout «de manière fiable» fixé avec un adhésif thermofusible. Au moment des tests, j'ai créé un bouton à proximité pour alimenter l'unité de commande à partir d'un interrupteur d'éclairage pour une installation externe.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/r2/dn/tj/r2dntjzjoijyn-g7vk4vdkg-d5y.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Allumer les lumières est devenu plus pratique et plus sûr. </font><font style="vertical-align: inherit;">Il était attaché à l'envers au bas de l'armoire de cuisine et il était plus difficile d'obtenir de l'eau des mains mouillées de l'intérieur.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusions de l'unité de contrôle précédente</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'éclairage de la zone de travail de la cuisine est devenu plus uniforme et plus agréable, en raison du rendu des couleurs non naturel de ma bande LED, la couleur de certains produits a changé. </font><font style="vertical-align: inherit;">Par exemple: les carottes semblaient beaucoup plus appétissantes en raison de leur couleur plus vive. </font><font style="vertical-align: inherit;">Mais cela n'a pas beaucoup interféré, et j'espère que cela n'a pas fait beaucoup de mal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec l'activation / la désactivation sans contact, tout s'est avéré pire. </font><font style="vertical-align: inherit;">Ça a marché. </font><font style="vertical-align: inherit;">Mais après 5 minutes à l'arrêt, des flashs ont commencé sur la bande LED. </font><font style="vertical-align: inherit;">Je n'ai pas remodelé le circuit sur les optocoupleurs et tout laissé tel quel. </font><font style="vertical-align: inherit;">Seulement pour allumer et éteindre a commencé à utiliser le nouveau commutateur. </font><font style="vertical-align: inherit;">Tout le monde a aimé son emplacement et sa forme.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus de deux ans d'utilisation, les graisses et autres composés sécrétés lors de la cuisson se sont accumulés sur le corps et à l'intérieur. </font><font style="vertical-align: inherit;">Cette plaque a pénétré partiellement dans le boîtier à travers les trous pour l'entrée des fils. </font><font style="vertical-align: inherit;">Mais en raison de la surface brillante du corps, cette substance se condense en une masse gélatineuse. </font><font style="vertical-align: inherit;">C'est agréable au toucher, inodore et ... (je ne l'ai pas goûté). </font><font style="vertical-align: inherit;">J'ai pris quelques photos de l'endroit sous la forme d'un germe de dragon. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jz/fr/ys/jzfrystsmthfk7fy5j_o70kkcfm.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/ot/br/mg/otbrmglxan7uooc1a1e4n88z9iq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur les murs, cette substance se transforme en un terrible raid, qui n'est pas seulement blanchi.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'est devenu</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir fouillé dans des bacs, j'ai trouvé un module d'extension inachevé pour ZUNo. </font><font style="vertical-align: inherit;">ZUNo est une carte de type Arduino pour concevoir votre propre appareil compatible avec la maison intelligente Z-Wave. </font><font style="vertical-align: inherit;">Il est programmé à partir de l'environnement de l'arduino.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spécifications du fabricant:</font></font></b><div class="spoiler_text"><ul>
<li>28 kB Flash memory for your sketches</li>
<li>2 kB RAM available</li>
<li>Z-Wave RF transmitter at 9.6/40/100 kbps</li>
<li>26 GPIO (overlaps with special hardware controllers)</li>
<li>4 ADC</li>
<li>5 PWM</li>
<li>2 UART</li>
<li>1 USB (serial port)</li>
<li>16 kB EEPROM</li>
<li>1 SPI (master or slave)</li>
<li>4 IR controllers, 1 IR learn capability</li>
<li>1 TRIAC/ZEROX to control dimmer</li>
<li>3 Interrupts</li>
<li>1 Timer 4 MHz</li>
<li>I2C (software)</li>
<li>1-Wire (software)</li>
<li>8x6 Keypad Scanner (software)</li>
<li>2 service LED, 1 service button</li>
<li>1 user test LED</li>
</ul><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le module d'extension fait de ZUNo une carte de débogage à part entière, qui, après le débogage du prototype, peut être utilisée comme un appareil complet. </font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelques informations du fabricant:</font></font></b><div class="spoiler_text"><ul>
<li>One 0-10 V analog output — control industrial dimmers</li>
<li>Up to four PWM or switch outputs (up to 5 A per channel) — control contactors, switches, halogen bulbs or LED strips</li>
<li>Up to eight digital 0/3 V inputs or outputs — connect various low voltage digital senors and actors</li>
<li>Up to four digital 0/3, 0/5 or 0/12 V digital or analog inputs — connect industrial 10 V sensors or any Arduino-compatible sensor</li>
<li>RS485 or UART — for industial meters</li>
<li>OneWire — for DS18B20 or other sensors</li>
</ul><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour mon projet, j'ai besoin de 3 transistors puissants pour passer de 12 volts à une bande LED et d'un convertisseur de 12 volts à 5 volts pour alimenter ZUNo. </font><font style="vertical-align: inherit;">Le reste de la périphérie du module d'extension n'est ni soudé ni testé. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4j/kr/tt/4jkrtt63ocqqrkugav0nrtfvtn8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cette partie du circuit, il n'y a pas assez de diode pour l'alimentation, pour la protection contre "l'inversion de polarité", et des résistances aux grilles des transistors à effet de champ de puissance devaient être connectées à la grille, et non devant la résistance de limitation. </font><font style="vertical-align: inherit;">J'écrirai plus à ce sujet dans les conclusions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce module d'extension est fourni dans un boîtier de Gainta. </font><font style="vertical-align: inherit;">Mon unité de contrôle précédente était également dans le cas de cette société, mais d'une taille différente. </font><font style="vertical-align: inherit;">Malheureusement, les fixations sur le module ne correspondaient pas à l'ancien boîtier, et je ne voulais pas en percer un nouveau, j'ai quitté l'ancien boîtier. </font><font style="vertical-align: inherit;">Le panneau a été "planté" sur un adhésif thermofusible.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wm/ls/ah/wmlsahydh07_hxmpqaryl1atchs.jpeg"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un peu sur la programmation Arduino et ZUNo</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les appareils Z-wave doivent avoir un certain nombre de classes. Les cours décrivent les fonctions des appareils et les interfaces d'interaction. Par exemple, ma lampe contrôle une bande LED composée de trois couleurs (rouge, vert, bleu). Ces fonctions sont exécutées par la classe Switch multi-niveaux. Si nous l'ajoutons à l'esquisse, nous pouvons modifier à distance la luminosité de l'une des couleurs. Pour contrôler trois couleurs, vous devez créer trois instances de cette classe. Je n'en parlerai pas plus en détail et en détail. Parce que la manipulation de classe de routine est cachée pour les utilisateurs de ZUNo par la notion de «canal». Par exemple, j'ai besoin de trois classes de Switch multi-niveaux, donc dans le code devrait apparaître 3 canaux de Switch multi-niveaux et plusieurs fonctions de rappel pour le contrôle radio. Comment faire ça? Vous devez également ajouter la classe de base Switch,pour allumer et éteindre la lampe sur simple pression d'un bouton (à partir de l'interface du contrôleur réseau), et ne pas configurer 3 canaux à chaque fois.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous devez vous rendre sur le site Web des développeurs, où sont présentés des exemples de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">z-uno.z-wave.me/Reference/ZUNO_SWITCH_MULTILEVEL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Chaque classe prise en charge par ZUNo a une description et un exemple. </font><font style="vertical-align: inherit;">Ensuite, copiez et collez les fonctions proposées dans votre croquis. </font><font style="vertical-align: inherit;">Maintenant, dans l'esquisse, il y a trois canaux de commutation à plusieurs niveaux et 6 fonctions de rappel pour répondre aux commandes de la radio. </font><font style="vertical-align: inherit;">Je ne suis pas très sophistiqué dans les classes Z-Wave, donc mon précédent périphérique de bande LED fonctionnait avec cet ensemble de classes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les chaînes ont été déclarées comme ceci:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cap de spoiler</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs">ZUNO_SETUP_CHANNELS(<font></font>
      ZUNO_SWITCH_MULTILEVEL(getRed, setRed),<font></font>
      ZUNO_SWITCH_MULTILEVEL(getGreen, setGreen),<font></font>
      ZUNO_SWITCH_MULTILEVEL(getBlue, setBlue),<font></font>
      ZUNO_SWITCH_BINARY(switch_getter, switch_setter)<font></font>
);</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela a conduit à la génération des widgets suivants dans le contrôleur après l'ajout au réseau: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/to/-y/if/to-yif5eaf9xkuxdk4t2oxp6ph4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ajuster la couleur, il était nécessaire d'ouvrir et de configurer chaque couleur dans le menu du contrôleur séparément. </font><font style="vertical-align: inherit;">Ce n'est pas pratique et lent. </font><font style="vertical-align: inherit;">Cependant, j'ai eu de la chance. </font><font style="vertical-align: inherit;">Il s'est avéré que je ne suis pas seul. </font><font style="vertical-align: inherit;">Ils ont pensé à nous et ont créé la chaîne </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">z-uno.z-wave.me/Reference/ZUNO_SWITCH_COLOR</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Maintenant, il n'y a qu'un canal et deux fonctions de rappel dans l'esquisse. </font><font style="vertical-align: inherit;">Dans le menu du contrôleur, le réglage des couleurs est effectué séparément pour chaque couleur, ainsi que simultanément, en sélectionnant dans la palette.</font></font><br>
<br>
<pre><code class="cpp hljs">ZUNO_SETUP_CHANNELS(ZUNO_SWITCH_COLOR(SWITCH_COLOR_FLAGS_RED|SWITCH_COLOR_FLAGS_GREEN|SWITCH_COLOR_FLAGS_BLUE, getterFunction, setterFunction));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et dans le menu du contrôleur, cela ressemble à ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/m3/zn/qk/m3znqkbwue228cttqmqmhggvwxu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonction suivante répond aux demandes par radio. </font><font style="vertical-align: inherit;">Une demande de lecture de l'état de l'un des canaux de couleur peut survenir.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">BYTE <span class="hljs-title">getterFunction</span><span class="hljs-params">(BYTE component)</span> </span>{
  <span class="hljs-keyword">switch</span>(component)<font></font>
  {<font></font>
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_RED:
      <span class="hljs-keyword">return</span> pwmR;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_GREEN:
      <span class="hljs-keyword">return</span> pwmG;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_BLUE:
      <span class="hljs-keyword">return</span> pwmB;
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et c'est une fonction pour définir les couleurs à partir de l'interface du contrôleur.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setterFunction</span><span class="hljs-params">(BYTE component, BYTE newValue)</span> 
</span>{
  <span class="hljs-keyword">switch</span>(component)<font></font>
  {<font></font>
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_RED:<font></font>
      pwmR = newValue;<font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_GREEN:<font></font>
      pwmG = newValue;<font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_BLUE:<font></font>
      pwmB = newValue;<font></font>
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  radio_action = <span class="hljs-number">1</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout le code que vous devez ajouter pour transformer une esquisse Arduino en une esquisse pour ZUNo.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après l'assemblage et l'installation, toutes les tâches déclarées ont été achevées. </font><font style="vertical-align: inherit;">Cependant, l'habitude d'allumer la lumière avec l'interrupteur est restée (cela s'est avéré très pratique). </font><font style="vertical-align: inherit;">L'option d'inclusion sans contact fonctionne également. </font><font style="vertical-align: inherit;">Parmi les lacunes, je tiens à noter le scintillement de la lampe LED pendant une seconde après avoir alimenté l'unité de contrôle. </font><font style="vertical-align: inherit;">Cela est dû à la longue initialisation des périphériques ZUNo. </font><font style="vertical-align: inherit;">À ce stade, les jambes sont imprévisibles. </font><font style="vertical-align: inherit;">Je pense que la résistance de pull-up sur la grille du transistor corrigera la situation si vous la mettez après la résistance de limitation. </font><font style="vertical-align: inherit;">Si le code d'initialisation ajuste les jambes à la sortie et modifie délibérément les niveaux logiques, vous pouvez expérimenter avec le filtre RC, qui ne passera pas de courtes impulsions. </font><font style="vertical-align: inherit;">Je ne l'ai pas encore fait, et peut-être que je ne le ferai jamais!</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">résultats</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ZUNo et son module d'extension simplifient grandement la «créativité technique à domicile». Cependant, je considère que ces produits sont très chers et si je travaillais ailleurs et que l'équipement Z-Wave ne traînait pas, je ferais tout sur ESP8266. Pendant le développement, j'ai appris une nouvelle «norme» pour marquer les fils de l'alimentation.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sx/c4/4h/sxc44hipyu2ml_agdxtaqthtvrs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant non seulement la terre est marquée d'une bande noire, mais comme dans mon cas le fil "positif". Pour le module d'extension, cela s'est avéré important. Le convertisseur 5 volts LM2594 est tombé en panne (le prix en Chip and Dip est d'environ 200 roubles). J'espère que dans la prochaine version du module d'extension il y aura une diode de protection contre «l'inversion de polarité». Et je vais vérifier la polarité des fils d'alimentation. Un autre inconvénient est associé au corps. Le boîtier a l'air bien, mais je n'ai pas pu connecter les fils sans pince aux borniers. J'espère qu'il y aura une version avec d'autres borniers (pour connecter les fils par le haut ou en biais). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'aime pas stocker de photos sur les services cloud et je fais souvent des sauvegardes. Par conséquent, la plupart des photographies associées au processus de conception et à la lampe 1 sont irrémédiablement corrompues.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zz/wz/ov/zzwzovgton7f2yxvy-2bd4zhucu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout ce qui reste du processus d'assemblage et de débogage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et cela ressemble au rétroéclairage mis en service, si vous vous penchez un peu. </font><font style="vertical-align: inherit;">Si vous vous redressez, la boîte et le commutateur ne sont pas visibles.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ya/qj/hn/yaqjhnpkhd7ge2ohejbp9ywkqpq.jpeg"> <br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esquisse pour ZUNo. </font><font style="vertical-align: inherit;">J'attache, seulement pour confirmer que tout est élémentaire</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"EEPROM.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"EEPR.h"</span></span><font></font>
<font></font>
<span class="hljs-keyword">int</span> readPin = <span class="hljs-number">9</span>;
<span class="hljs-keyword">int</span> triggerPin = <span class="hljs-number">10</span>;<font></font>
byte controlState = <span class="hljs-number">0</span>;<font></font>
word lastValue;<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> REDPIN   PWM1     <span class="hljs-comment">// pin connection R </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> GREENPIN PWM2     <span class="hljs-comment">// pin connection G</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> BLUEPIN  PWM3     <span class="hljs-comment">// pin connection B</span></span><font></font>
<font></font>
ZUNO_SETUP_CHANNELS(ZUNO_SWITCH_COLOR(SWITCH_COLOR_FLAGS_RED|SWITCH_COLOR_FLAGS_GREEN|SWITCH_COLOR_FLAGS_BLUE, getterFunction, setterFunction));<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ON 1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> OFF 0</span>
<span class="hljs-keyword">uint8_t</span> switch_=OFF;<font></font>
<font></font>
<span class="hljs-keyword">uint8_t</span> pwmR=<span class="hljs-number">0</span>;
<span class="hljs-keyword">uint8_t</span> pwmG=<span class="hljs-number">0</span>;
<span class="hljs-keyword">uint8_t</span> pwmB=<span class="hljs-number">0</span>;
<span class="hljs-keyword">uint8_t</span> b_pwmR=<span class="hljs-number">0</span>;
<span class="hljs-keyword">uint8_t</span> b_pwmG=<span class="hljs-number">0</span>;
<span class="hljs-keyword">uint8_t</span> b_pwmB=<span class="hljs-number">0</span>;<font></font>
<font></font>
<span class="hljs-keyword">enum</span><font></font>
{<font></font>
  DEF_R = <span class="hljs-number">255</span>,<font></font>
  DEF_G = <span class="hljs-number">255</span>,<font></font>
  DEF_B = <span class="hljs-number">255</span><font></font>
};<font></font>
<span class="hljs-keyword">uint8_t</span> radio_action = <span class="hljs-number">0</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> 
</span>{ <font></font>
  init_EEPROM();<font></font>
  Serial.begin();<font></font>
  pinMode(readPin, INPUT);<font></font>
  pinMode(triggerPin, OUTPUT);<font></font>
  digitalWrite(triggerPin, LOW);<font></font>
  pinMode(REDPIN, OUTPUT);<font></font>
  pinMode(GREENPIN, OUTPUT);<font></font>
  pinMode(BLUEPIN, OUTPUT);<font></font>
  analogWrite(REDPIN, pwmR &amp; <span class="hljs-number">0xff</span>);<font></font>
  analogWrite(GREENPIN, pwmG &amp; <span class="hljs-number">0xff</span>);<font></font>
  analogWrite(BLUEPIN, pwmB &amp; <span class="hljs-number">0xff</span>);<font></font>
  <font></font>
} <font></font>
<span class="hljs-keyword">int</span> act=<span class="hljs-number">1</span>;
<span class="hljs-keyword">int</span> actf = <span class="hljs-number">0</span>;
<span class="hljs-keyword">int</span> cnt=<span class="hljs-number">57</span>; <font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">int</span> tmp;
  <span class="hljs-comment">// trigger measurement</span><font></font>
  digitalWrite(triggerPin, LOW);<font></font>
  delayMicroseconds(<span class="hljs-number">10</span>);<font></font>
  digitalWrite(triggerPin, HIGH);<font></font>
  delayMicroseconds(<span class="hljs-number">10</span>);<font></font>
  digitalWrite(triggerPin, LOW);<font></font>
  <span class="hljs-comment">// read pulse width</span>
  tmp = pulseIn(readPin, HIGH, <span class="hljs-number">100000</span>);<font></font>
  lastValue = tmp / <span class="hljs-number">58</span>;<font></font>
  Serial.print(<span class="hljs-string">" cm= "</span>);<font></font>
  Serial.println(lastValue);<font></font>
  <span class="hljs-keyword">if</span> (lastValue &lt; <span class="hljs-number">30</span>)<font></font>
  {<font></font>
    cnt++;<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    cnt--;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (cnt &gt; <span class="hljs-number">55</span>)<font></font>
  { <font></font>
    act=<span class="hljs-number">1</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (cnt &gt; <span class="hljs-number">60</span>)<font></font>
    cnt= <span class="hljs-number">60</span>;
  <span class="hljs-keyword">if</span> (cnt &lt; <span class="hljs-number">50</span>)<font></font>
  {<font></font>
    act=<span class="hljs-number">0</span>;<font></font>
    actf=<span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (cnt &lt; <span class="hljs-number">45</span> )<font></font>
    cnt = <span class="hljs-number">45</span>;<font></font>
  <font></font>
  <span class="hljs-keyword">if</span> ((act == <span class="hljs-number">1</span>) &amp;&amp; (actf == <span class="hljs-number">0</span>))<font></font>
  {  <font></font>
    actf = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">if</span> (switch_ == OFF)<font></font>
    {<font></font>
      switch_=ON;<font></font>
      b_pwmG = pwmG;<font></font>
      b_pwmB = pwmB;<font></font>
      b_pwmR = pwmR;<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
      switch_=OFF;<font></font>
      b_pwmR=<span class="hljs-number">0</span>;<font></font>
      b_pwmG=<span class="hljs-number">0</span>;<font></font>
      b_pwmB=<span class="hljs-number">0</span>;<font></font>
    }<font></font>
    analogWrite(REDPIN, b_pwmR &amp; <span class="hljs-number">0xff</span>);<font></font>
    analogWrite(GREENPIN, b_pwmG &amp; <span class="hljs-number">0xff</span>);<font></font>
    analogWrite(BLUEPIN, b_pwmB &amp; <span class="hljs-number">0xff</span>); <font></font>
  } <font></font>
  <font></font>
  Serial.print(<span class="hljs-string">"cnt = "</span>);    <font></font>
  Serial.print(cnt);  <font></font>
  Serial.print(<span class="hljs-string">" || "</span>);    <font></font>
  Serial.print(pwmR);  <font></font>
  Serial.print(<span class="hljs-string">" "</span>);      <font></font>
  Serial.print(pwmG);  <font></font>
  Serial.print(<span class="hljs-string">" "</span>);<font></font>
  Serial.print(pwmB);  <font></font>
  Serial.print(<span class="hljs-string">" "</span>);<font></font>
  Serial.println(<span class="hljs-string">""</span>);
 <span class="hljs-comment">// delay(10);</span><font></font>
<font></font>
 <span class="hljs-keyword">if</span>(radio_action)<font></font>
 {<font></font>
    radio_action = <span class="hljs-number">0</span>;<font></font>
    eepr_save_col();<font></font>
    analogWrite(REDPIN, pwmR &amp; <span class="hljs-number">0xff</span>);<font></font>
    analogWrite(GREENPIN, pwmG &amp; <span class="hljs-number">0xff</span>);<font></font>
    analogWrite(BLUEPIN, pwmB &amp; <span class="hljs-number">0xff</span>);<font></font>
 }<font></font>
}<font></font>
<font></font>
<span class="hljs-function">BYTE <span class="hljs-title">getterFunction</span><span class="hljs-params">(BYTE component)</span> </span>{
  <span class="hljs-keyword">switch</span>(component)<font></font>
  {<font></font>
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_RED:
      <span class="hljs-keyword">return</span> pwmR;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_GREEN:
      <span class="hljs-keyword">return</span> pwmG;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_BLUE:
      <span class="hljs-keyword">return</span> pwmB;
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setterFunction</span><span class="hljs-params">(BYTE component, BYTE newValue)</span> 
</span>{
  <span class="hljs-keyword">switch</span>(component)<font></font>
  {<font></font>
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_RED:<font></font>
      pwmR = newValue;<font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_GREEN:<font></font>
      pwmG = newValue;<font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> SWITCH_COLOR_COMPONENT_BLUE:<font></font>
      pwmB = newValue;<font></font>
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  radio_action = <span class="hljs-number">1</span>;<font></font>
}<font></font>
</code></pre><br>
</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr488470/index.html">Kim Dotcom: Caught, la personne la plus recherchée en ligne. Partie 4</a></li>
<li><a href="../fr488472/index.html">Week-end de lecture: 10 documents sur les gadgets audio - des autoradios soviétiques aux prises antibruit</a></li>
<li><a href="../fr488474/index.html">A propos de la couleur, du son et de «l'exploration des foules» en tant que beauté</a></li>
<li><a href="../fr488476/index.html">Bobine de tube Tesla</a></li>
<li><a href="../fr488478/index.html">Transférer toutes les bases de données MS SQL Server sur une autre machine</a></li>
<li><a href="../fr488482/index.html">Combien coûte Appium pour le peuple</a></li>
<li><a href="../fr488484/index.html">Lancement SQL - Événement Microsoft SQL Server 2019</a></li>
<li><a href="../fr488488/index.html">Pour OpenBSD. Un peu de plaisir</a></li>
<li><a href="../fr488490/index.html">Likbez sur les respirateurs. Le respirateur aide-t-il à l'infection par le virus? Aperçu de 11 respirateurs</a></li>
<li><a href="../fr488498/index.html">Laboratoires de l'Université ITMO: éclairage LED, optoélectronique micro-ondes et télécommunications optiques</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>