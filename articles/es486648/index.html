<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚Äç‚úàÔ∏è üíë ‚òÇÔ∏è AWS Lambda en acci√≥n en Java 11. Ir sin servidor a producci√≥n üàöÔ∏è ü§∏üèº üòæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este art√≠culo es una gu√≠a sobre c√≥mo comenzar a usar AWS Lambda de manera r√°pida y sin problemas con un simple ejemplo. Adecuado tanto para un desarro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>AWS Lambda en acci√≥n en Java 11. Ir sin servidor a producci√≥n</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dins/blog/486648/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este art√≠culo es una gu√≠a sobre c√≥mo comenzar a usar AWS Lambda de manera r√°pida y sin problemas con un simple ejemplo. </font><font style="vertical-align: inherit;">Adecuado tanto para un desarrollador que no trabaj√≥ con Lambda en absoluto, y que conoc√≠a a Cloud para evaluar otra visi√≥n para desarrollar aplicaciones sin servidor.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bd/y8/lu/bdy8luzeox9qq09msokx8yzoba4.jpeg" alt="imagen"><br>
<a name="habracut"></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introducci√≥n</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hola a todos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mi nombre es Alexander Gruzdev, soy jefe de equipo de Java en DINS. Durante m√°s de dos a√±os, he estado trabajando estrechamente con la infraestructura de AWS y tengo experiencia tanto en la escritura de aplicaciones para AWS como en la implementaci√≥n de estas mismas aplicaciones. En mi trabajo tuve que usar ElasticBeanstalk, ECS, Fargate, EKS y, por supuesto, AWS Lambda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada uno de estos servicios es bueno a su manera y, en el marco de este art√≠culo, no instar√© a usar solo AWS Lambda como reemplazo de todas las dem√°s opciones. Solo quiero mostrar lo f√°cil que es comenzar a usar Lambda, y en qu√© casos obtendr√° los beneficios de usarlo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos, desde desarrolladores hasta gerentes, quieren un proceso claro para entregar cambios a los clientes. </font><font style="vertical-align: inherit;">Cuanto m√°s transparente sea este camino y se requiera menos esfuerzo, m√°s rentable. </font><font style="vertical-align: inherit;">Con mayor frecuencia, los desarrolladores y evaluadores no quieren saber d√≥nde se implementar√° la aplicaci√≥n, qu√© pieza de hardware elegir, en qu√© regi√≥n desea colocar r√©plicas, etc. </font><font style="vertical-align: inherit;">En el siguiente diagrama, puede ver la clase de servicios "aaS" (como un servicio) donde AWS Lambda representa la categor√≠a FaaS.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z8/nj/wl/z8njwlqjrgatljwptthtqe9ealu.png" alt="imagen"><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FaaS en pocas palabras</font></font></b>
                        <div class="spoiler_text">FaaS ,            .     ,  , CRUD   C, R, U, D     Create   Read.      ,   ‚Äî  .<br>
</div>
                    </div><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Idea</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para demostrar cu√°l es el desarrollo de una soluci√≥n sin servidor, decid√≠ tomar un ejemplo bastante banal. </font><font style="vertical-align: inherit;">Creo que ha visto el formulario de comentarios de contacto en muchos sitios, donde puede dejar su correo o tel√©fono y hacer una pregunta para recibir una respuesta m√°s tarde. </font><font style="vertical-align: inherit;">La pantalla a continuaci√≥n, el formulario no es super, pero el tema de este art√≠culo no es el dise√±o material. </font></font><br>
<img src="https://habrastorage.org/webt/gv/5g/iv/gv5givju7glj8vftkb1cdhupdiw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al completar este formulario, un cliente potencial estar√° esperando una llamada o carta suya. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desde el lado t√©cnico necesitas:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">guardar datos del formulario en la base de datos;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enviar una carta a un agente que responder√° la pregunta;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quiz√°s escriba otro servicio donde el agente marcar√° el trabajo realizado sobre la base de la misma base de datos (no incluida en el alcance del art√≠culo).</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La implementaci√≥n de la idea est√° disponible en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arquitectura</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo primero que viene a la mente durante la implementaci√≥n es lo que necesitamos:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√°quina debajo de la espalda, frente, im√°genes, etc.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coche con base</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√°quina con servicio de correo electr√≥nico.</font></font></li>
</ul><br>
<br>
<img src="https://habrastorage.org/webt/9a/7h/83/9a7h83iyieeicpht4-bcwy8l-ja.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La parte posterior y la base, en el buen sentido, necesitan ser replicadas, pero supongamos que hacemos esto para nuestra mini-tienda y la carga en este formulario es m√≠nima. </font><font style="vertical-align: inherit;">Por lo tanto, todas estas m√°quinas pueden combinarse en una y desplegarse en un solo conjunto. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero como estamos considerando Serverless, construyamos la arquitectura completamente en componentes sin servidor. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No importa cu√°n prometedor pueda parecer Serverless, todos entendemos que los servidores todav√≠a est√°n aqu√≠, simplemente desaparecieron de su campo de visi√≥n. </font><font style="vertical-align: inherit;">Y ahora ese trabajo en la nube que podr√≠a hacer las tareas que podr√≠a hacer por su cuenta. </font><font style="vertical-align: inherit;">Pero intentemos usar solo componentes sin servidor: </font></font><br>
<img src="https://habrastorage.org/webt/mf/iw/6i/mfiw6if-6nlss4pl-brkgxenxuc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
el diagrama muestra una separaci√≥n muy clara de la funcionalidad de cada componente.</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS Lambda es el componente principal que contiene c√≥digo / l√≥gica,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S3 es responsable de almacenar recursos est√°ticos y scripts JS,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CloudFront: para mecanismos de almacenamiento en cach√© y soporte multirregional,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SES - servicio de correo electr√≥nico,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DynamoDB: la base para almacenar datos del formulario (de qui√©n, qu√© pregunta, d√≥nde enviar la respuesta),</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API de puerta de enlace: API HTTP para nuestra lambda,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Route53: necesario si desea agregar un hermoso nombre de dominio.</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No todos estos componentes se utilizar√°n en nuestra pr√≥xima gu√≠a, solo para no estirar el art√≠culo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Route53 y CloudFront son componentes bastante simples sobre los que puede leer por separado. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unos peque√±os spoilers que nos dar√°n tal soluci√≥n:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nos estamos alejando del soporte de m√°quinas EC2, sin depuraci√≥n a trav√©s de ssh,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuraci√≥n sencilla: configure la limitaci√≥n / almacenamiento en cach√© / accesos con un clic,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Admite pol√≠ticas de acceso: restringe los derechos y da acceso,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Registro / monitoreo fuera de la caja,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pague solo por los recursos / solicitudes utilizados.</font></font></li>
</ul><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manifestaci√≥n</font></font></h1><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formaci√≥n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para comenzar a desarrollar nuestra soluci√≥n Serverless, debe cumplir con los siguientes requisitos:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuenta activa de AWS</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aws-cli</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sam-cli</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jdk 11</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gradle</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de instalar todas las herramientas anteriores, debe configurar su aws-cli para el acceso remoto a AWS. </font><font style="vertical-align: inherit;">Sigue las </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instrucciones</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Esto requerir√° crear un nuevo usuario y descargar su clave de acceso y clave secreta.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Asamblea de proyecto</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Crear un proyecto a partir de una plantilla</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abra el directorio para el proyecto futuro y desde all√≠ inicie SAM CLI. </font><font style="vertical-align: inherit;">Siga las instrucciones: </font></font><br>
<img src="https://habrastorage.org/webt/kn/gu/7f/kngu7fr3q_h_7t7bq-ygr7baccs.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: Dependiendo de la versi√≥n de SAM-CLI, los comandos pueden ser ligeramente diferentes, pero todos siguen siendo intuitivos. </font><font style="vertical-align: inherit;">Simplemente elija los m√°s similares a los que se usaron anteriormente. </font><font style="vertical-align: inherit;">Tambi√©n puede elegir una herramienta de compilaci√≥n diferente si Gradle no es adecuado para usted. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El proyecto "¬°Hola Mundo!" </font><font style="vertical-align: inherit;">Listo. </font><font style="vertical-align: inherit;">Ahora puede trabajar en el nombre del proyecto y los paquetes, las dependencias y el c√≥digo fuente.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Tratemos con las adicciones.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregue las siguientes dependencias a build.gradle:</font></font><br>
<pre><code class="javascript hljs">dependencies {
    <span class="hljs-comment">// AWS</span>
    implementation group: <span class="hljs-string">'com.amazonaws.serverless'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-serverless-java-container-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.4'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-lambda-java-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.2.0'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-java-sdk-ses'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.11.670'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-java-sdk-dynamodb'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.11.670'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-lambda-java-log4j2'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.1.0'</span><font></font>
<font></font>
    <span class="hljs-comment">// Utils</span>
    implementation group: <span class="hljs-string">'com.fasterxml.jackson.core'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'jackson-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.10.0'</span>
    implementation group: <span class="hljs-string">'commons-io'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'commons-io'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.6'</span><font></font>
<font></font>
    <span class="hljs-comment">// Test</span>
    testImplementation group: <span class="hljs-string">'org.mockito'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'mockito-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'3.1.0'</span>
    testImplementation group: <span class="hljs-string">'org.powermock'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'powermock-api-mockito2'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.0.4'</span>
    testImplementation group: <span class="hljs-string">'org.powermock'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'powermock-module-junit4'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.0.4'</span>
    testImplementation group: <span class="hljs-string">'junit'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'junit'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'4.12'</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los principales son el SDK de AWS. </font><font style="vertical-align: inherit;">Le permitir√°n trabajar con servicios espec√≠ficos, como SES, DynamoDB, etc.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Escribimos una lambda</font></font></h3><br>
<ul>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cambiamos la solicitud de plantilla y las clases de respuesta de RequestHandler a AwsProxyRequest y ContactUsProxyResponse.</font></font></b>
                        <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RequestHandler</span>&lt;<span class="hljs-title">AwsProxyRequest</span>, <span class="hljs-title">ContactUsProxyResponse</span>&gt;
...
<span class="hljs-title">public</span> <span class="hljs-title">ContactUsProxyResponse</span> <span class="hljs-title">handleRequest</span>(<span class="hljs-title">AwsProxyRequest</span> <span class="hljs-title">request</span>, <span class="hljs-title">Context</span> <span class="hljs-title">context</span>) </span></code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">  AwsClientFactory   AWS SDK-.</b>
                        <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-comment">/**
 * Just an util class for an eager initialization of sdk clients.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AwsClientFactory</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOG = LogManager.getLogger(AwsClientFactory.class);<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AmazonSimpleEmailService sesClient;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DynamoDB dynamoDB;<font></font>
<font></font>
    /**<font></font>
     * AWS regions should be env variables <span class="hljs-keyword">if</span> you want to generalize the solution.<font></font>
     */<font></font>
    AwsClientFactory() {<font></font>
        LOG.debug("AWS clients factory initialization.");<font></font>
        sesClient = AmazonSimpleEmailServiceClient.builder().withRegion(Regions.EU_WEST_1).build();<font></font>
        AmazonDynamoDB dynamoDBClient = AmazonDynamoDBClientBuilder.standard().withRegion(Regions.EU_WEST_1).build();<font></font>
        dynamoDB = <span class="hljs-keyword">new</span> DynamoDB(dynamoDBClient);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function">DynamoDB <span class="hljs-title">getDynamoDB</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> dynamoDB;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function">AmazonSimpleEmailService <span class="hljs-title">getSesClient</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> sesClient;<font></font>
    }<font></font>
<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    ObjectMapper   .</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ObjectMapper OBJECT_MAPPER = <span class="hljs-keyword">new</span> ObjectMapper();
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> AwsClientFactory AWS_CLIENT_FACTORY = <span class="hljs-keyword">new</span> AwsClientFactory();
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">         .</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
 <span class="hljs-function"><span class="hljs-keyword">private</span> SendEmailResult <span class="hljs-title">sendEmail</span><span class="hljs-params">(ContactUsRequest contactUsRequest)</span> </span>{<font></font>
        String emailTemplate = getEmailTemplate();<font></font>
        String email = fillTemplate(emailTemplate, contactUsRequest);<font></font>
<font></font>
        SendEmailRequest sendEmailRequest =<font></font>
                <span class="hljs-keyword">new</span> SendEmailRequest(<font></font>
                        System.getenv(<span class="hljs-string">"SENDER_EMAIL"</span>),
                        <span class="hljs-keyword">new</span> Destination(List.of(System.getenv(<span class="hljs-string">"RECIPIENT_EMAIL"</span>))),
                        <span class="hljs-keyword">new</span> Message()<font></font>
                                .withSubject(<font></font>
                                        <span class="hljs-keyword">new</span> Content()<font></font>
                                                .withCharset(UTF_8.name())<font></font>
                                                .withData(contactUsRequest.getSubject()))<font></font>
                                .withBody(<span class="hljs-keyword">new</span> Body()<font></font>
                                        .withHtml(<span class="hljs-keyword">new</span> Content()<font></font>
                                                .withCharset(UTF_8.name())<font></font>
                                                .withData(email))));<font></font>
        LOG.info(<span class="hljs-string">"Email template is ready"</span>);
        <span class="hljs-keyword">return</span> AWS_CLIENT_FACTORY.getSesClient().sendEmail(sendEmailRequest);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">fillTemplate</span><span class="hljs-params">(String emailTemplate, ContactUsRequest contactUsRequest)</span> </span>{
        <span class="hljs-keyword">return</span> String.format(<font></font>
                emailTemplate,<font></font>
                contactUsRequest.getUsername(),<font></font>
                contactUsRequest.getEmail(),<font></font>
                contactUsRequest.getPhone(),<font></font>
                contactUsRequest.getQuestion());<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getEmailTemplate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> IOUtils.toString(<font></font>
                    Objects.requireNonNull(<span class="hljs-keyword">this</span>.getClass().getClassLoader()<font></font>
                                               .getResourceAsStream(<span class="hljs-string">"email_template.html"</span>)),<font></font>
                    UTF_8);<font></font>
        } <span class="hljs-keyword">catch</span> (IOException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"Loading an email template failed."</span>, e);<font></font>
        }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addEmailDetailsToDb</span><span class="hljs-params">(ContactUsRequest contactUsRequest, SendEmailResult sendEmailResult)</span> </span>{<font></font>
        AWS_CLIENT_FACTORY.getDynamoDB().getTable(<span class="hljs-string">"ContactUsTable"</span>)<font></font>
                          .putItem(<span class="hljs-keyword">new</span> Item()<font></font>
                                  .withPrimaryKey(<span class="hljs-string">"Id"</span>, sendEmailResult.getMessageId())<font></font>
                                  .withString(<span class="hljs-string">"Subject"</span>, contactUsRequest.getSubject())<font></font>
                                  .withString(<span class="hljs-string">"Username"</span>, contactUsRequest.getUsername())<font></font>
                                  .withString(<span class="hljs-string">"Phone"</span>, contactUsRequest.getPhone())<font></font>
                                  .withString(<span class="hljs-string">"Email"</span>, contactUsRequest.getEmail())<font></font>
                                  .withString(<span class="hljs-string">"Question"</span>, contactUsRequest.getQuestion()));<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">         .</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-function"><span class="hljs-keyword">private</span> ContactUsProxyResponse <span class="hljs-title">buildResponse</span><span class="hljs-params">(<span class="hljs-keyword">int</span> statusCode, String body)</span> </span>{<font></font>
        ContactUsProxyResponse awsProxyResponse =<font></font>
                <span class="hljs-keyword">new</span> ContactUsProxyResponse();<font></font>
        awsProxyResponse.setStatusCode(statusCode);<font></font>
        awsProxyResponse.setBody(getBodyAsString(body));<font></font>
        awsProxyResponse.addHeader(CONTENT_TYPE, ContentType.APPLICATION_JSON.toString());<font></font>
        awsProxyResponse.addHeader(<span class="hljs-string">"Access-Control-Allow-Origin"</span>, <span class="hljs-string">"*"</span>);
        <span class="hljs-keyword">return</span> awsProxyResponse;<font></font>
}<font></font>
<font></font>
 <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getBodyAsString</span><span class="hljs-params">(String body)</span> </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> OBJECT_MAPPER.writeValueAsString(<span class="hljs-keyword">new</span> ContactUsResponseBody(body));<font></font>
        } <span class="hljs-keyword">catch</span> (JsonProcessingException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"Writing ContactUsResponseBody as string failed."</span>, e);<font></font>
        }<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    .      ¬´// WARMING UP¬ª.</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-keyword">if</span> (Optional.ofNullable(request.getMultiValueHeaders()).map(headers -&gt; headers.containsKey(<span class="hljs-string">"X-WARM-UP"</span>)).orElse(FALSE)) {<font></font>
            LOG.info(<span class="hljs-string">"Lambda was warmed up"</span>);
            <span class="hljs-keyword">return</span> buildResponse(<span class="hljs-number">201</span>, <span class="hljs-string">"Lambda was warmed up. V1"</span>);<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">         handleRequest()</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> ContactUsProxyResponse <span class="hljs-title">handleRequest</span><span class="hljs-params">(AwsProxyRequest request, Context context)</span> </span>{<font></font>
        LOG.info(<span class="hljs-string">"Request was received"</span>);<font></font>
        LOG.debug(getAsPrettyString(request));<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (Optional.ofNullable(request.getMultiValueHeaders()).map(headers -&gt; headers.containsKey(<span class="hljs-string">"X-WARM-UP"</span>)).orElse(FALSE)) {<font></font>
            LOG.info(<span class="hljs-string">"Lambda was warmed up"</span>);
            <span class="hljs-keyword">return</span> buildResponse(<span class="hljs-number">201</span>, <span class="hljs-string">"Lambda was warmed up. V1"</span>);<font></font>
        }<font></font>
<font></font>
        ContactUsRequest contactUsRequest = getContactUsRequest(request);<font></font>
<font></font>
        SendEmailResult sendEmailResult = sendEmail(contactUsRequest);<font></font>
        LOG.info(<span class="hljs-string">"Email was sent"</span>);<font></font>
<font></font>
        addEmailDetailsToDb(contactUsRequest, sendEmailResult);<font></font>
        LOG.info(<span class="hljs-string">"DB is updated"</span>);<font></font>
<font></font>
        <span class="hljs-keyword">return</span> buildResponse(<span class="hljs-number">200</span>,<font></font>
                String.format(<span class="hljs-string">"Message %s has been sent successfully."</span>, sendEmailResult.getMessageId()));<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La l√≥gica b√°sica es bastante simple, por lo que no creo que valga la pena describirla en detalle. Hay varios puntos a los que vale la pena prestarles atenci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El primero es el registro. Uno de los argumentos del m√©todo Context lambda contiene mucha informaci√≥n auxiliar, as√≠ como un registrador. Por lo tanto, no puede crear un registrador separado, sino utilizar el contexto lambda proporcionado. Para hacer esto, es suficiente llamar antes de usar:</font></font><br>
<blockquote><code>LambdaLogger logger = context.getLogger(); </code></blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El segundo punto es el calentamiento. Dado que crear un entorno ejecutable para un lambda es lento, iniciar la JVM, cargar el classpath y ejecutar el c√≥digo lleva algo de tiempo. La primera llamada puede tardar varios segundos, lo que no es bueno si escribe diferentes API s√≠ncronas. Para tales casos, usted mismo puede decirle a AWS que necesita mantener varias instancias lambda en alerta. Pero esto requiere que alguien llame a una lambda. Si hacemos esto con la versi√≥n b√°sica del c√≥digo, de hecho, enviaremos una carta y escribiremos algunos datos inexactos en la base de datos.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para evitar esto, podemos agregar alg√∫n tipo de procesamiento de solicitud para distinguir la solicitud real de la solicitud de calentamiento. Por ejemplo, podemos agregar un encabezado especial a la solicitud. En nuestro caso, el encabezado "X-WARM-UP" se usar√° con cualquier valor, para comprender que esta es una solicitud de calentamiento y que solo necesitamos devolver alg√∫n tipo de respuesta sin ejecutar la l√≥gica empresarial.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo √∫ltimo que me gustar√≠a llamar la atenci√≥n es el uso de variables est√°ticas. </font><font style="vertical-align: inherit;">Esto no hace que la instancia lambda con estado en nuestro caso, simplemente permite reutilizar objetos existentes e inicializados. </font><font style="vertical-align: inherit;">Si los objetos que desea inicializar cambian est√°ticamente durante la ejecuci√≥n del c√≥digo, intente pensar nuevamente si esto interferir√° con la operaci√≥n de llamadas posteriores a la lambda. </font><font style="vertical-align: inherit;">Adem√°s, si estos objetos usan variables de entorno durante la inicializaci√≥n, no debe hacerlos est√°ticos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Escribimos pruebas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El c√≥digo Lambda puede estar cubierto por los mismos tipos de pruebas que usa en la mayor√≠a de los casos. </font><font style="vertical-align: inherit;">Pero para evitar que el art√≠culo crezca a√∫n m√°s, cubrir√© las pruebas de aplicaciones sin servidor en el pr√≥ximo art√≠culo sobre pruebas de AWS Lambda y desarrollo local. </font><font style="vertical-align: inherit;">Aunque las pruebas unitarias ya est√°n disponibles en el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repositorio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Escribimos una plantilla de recursos SAM</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de que escribimos y probamos nuestro lambda localmente, necesitamos escribir una plantilla SAM para implementar todos estos recursos en AWS.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un poco sobre SAM</font></font></b>
                        <div class="spoiler_text">Serverless Application Model ‚Äì     serverless .  ,      CloudFormation DSL,     ‚Äì   Lambda, Gateway, DynamoDB  . . <br>
SAM, CloudFormation, Terraform ‚Äì   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">IaC-</a>. SAM     Serverless-,   Terraform        . <br>
 Terraform   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">    DINS</a>.<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En realidad, veamos qu√© recursos necesitamos declarar en la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plantilla SAM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS :: Serverless :: Function</font></font></b></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Las </font><i><b><font style="vertical-align: inherit;">funciones</font></b></i><font style="vertical-align: inherit;"> principales ya est√°n completas para nosotros si utilizamos SAM init para crear el proyecto. </font><font style="vertical-align: inherit;">Pero as√≠ es como se ven en mi ejemplo:</font></font><br>
<pre><code class="plaintext hljs">CodeUri: contact-us-function<font></font>
Handler: com.gralll.sam.App::handleRequest<font></font>
Runtime: java8<font></font>
MemorySize: 256<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ creo que todo est√° lo suficientemente claro. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CodeUri</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es el directorio con nuestro </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">controlador</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lambda </font><font style="vertical-align: inherit;">: la ruta completa al m√©todo </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Runtime</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , en lo que est√° escrito </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lambda </font><i><font style="vertical-align: inherit;">MemorySize</font></i><font style="vertical-align: inherit;"> , habla por s√≠ mismo </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hablando de memoria</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : hasta 3 GB de RAM est√°n disponibles en el lambda, que corresponde a un recurso de 2 CPU. Es decir, no puede ajustar la CPU por separado, solo aumenta / disminuye la cantidad de memoria.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
El siguiente bloque es necesario para seleccionar el m√©todo de implementaci√≥n.</font></font><br>
<pre><code class="plaintext hljs">AutoPublishAlias: live<font></font>
DeploymentPreference:<font></font>
  Type: Canary10Percent10Minutes<font></font>
</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoPublishAlias</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : le permite </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">agregar un alias</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a cada nueva versi√≥n implementada </font><font style="vertical-align: inherit;">. Esto es necesario para implementar el despliegue canario. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Canary10Percent10Minutes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : un tipo de implementaci√≥n que le permitir√° mantener simult√°neamente dos versiones de lambda: la antigua y la nueva, pero solo redirigir√° el 10% del tr√°fico a la nueva. Si en diez minutos no hay problemas, el resto del tr√°fico tambi√©n se redirigir√° a la nueva versi√≥n. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede leer m√°s sobre el uso de funciones avanzadas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en la p√°gina SAM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n est√°n las variables de entorno que se utilizar√°n a partir del c√≥digo. Despu√©s de eso, otro bloque para lambda:</font></font><br>
<pre><code class="plaintext hljs">Events:<font></font>
  ContactUs:<font></font>
    Type: Api<font></font>
    Properties:<font></font>
      Path: /contact<font></font>
      Method: post<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En √©l, debemos describir los desencadenantes para llamar a una lambda. En nuestro caso, estas ser√°n </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">solicitudes de API Gateway</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta es una forma bastante simplificada de describir la API, pero es suficiente para que la API de Gateway reci√©n creada redirija todas las </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">solicitudes POST / contacto</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a nuestra lambda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, necesitamos describir los aspectos de seguridad. Fuera de la caja, el lambda creado no tendr√° acceso a la base de datos o al servicio de correo electr√≥nico. Por lo tanto, debemos prescribir expl√≠citamente lo que se permitir√°. Hay </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">varias formas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de dar acceso dentro de AWS. Utilizaremos pol√≠ticas basadas en recursos:</font></font><br>
<pre><code class="plaintext hljs">Policies:<font></font>
  - AWSLambdaExecute<font></font>
  - Version: '2012-10-17'<font></font>
    Statement:<font></font>
      - Effect: Allow<font></font>
        Action:<font></font>
          - ses:SendEmail<font></font>
          - ses:SendRawEmail<font></font>
        Resource: 'arn:aws:ses:eu-west-1:548476639829:identity/aleksandrgruzdev11@gmail.com'<font></font>
      - Effect: Allow<font></font>
        Action:<font></font>
          - dynamodb:List*<font></font>
        Resource: '*'<font></font>
      - Effect: Allow<font></font>
        Action:<font></font>
          - dynamodb:Get*<font></font>
          - dynamodb:PutItem<font></font>
          - dynamodb:DescribeTable<font></font>
        Resource: 'arn:aws:dynamodb:*:*:table/ContactUsTable'<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenga en cuenta que para la tabla de la base de datos especificamos un nombre espec√≠fico, por lo tanto, necesitaremos crear una tabla con el mismo nombre. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cuanto a SES: ves mi direcci√≥n de correo electr√≥nico. En su caso, debe ser su propia direcci√≥n confirmada. C√≥mo hacer esto, mira </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Justo despu√©s de eso, puede encontrar el ARN de identidad de este recurso haciendo clic en la direcci√≥n creada y reemplazarla con el correo electr√≥nico en el ejemplo anterior. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como que descubrieron la lambda. Ahora pasemos a la base de datos. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS :: Serverless :: SimpleTable</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Para nuestras tareas, crearemos solo una tabla </font><b><i><font style="vertical-align: inherit;">ContactUsTable</font></i></b><font style="vertical-align: inherit;"> :</font></font><br>
<pre><code class="plaintext hljs">ContactUsTable:<font></font>
  Type: AWS::Serverless::SimpleTable<font></font>
  Properties:<font></font>
    PrimaryKey:<font></font>
      Name: Id<font></font>
      Type: String<font></font>
    TableName: ContactUsTable<font></font>
    ProvisionedThroughput:<font></font>
      ReadCapacityUnits: 2<font></font>
      WriteCapacityUnits: 2<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De los campos obligatorios, solo Id, y tambi√©n indican ReadCapacityUnits y WriteCapacityUnits. </font><font style="vertical-align: inherit;">No nos detendremos en detalle sobre qu√© valores elegir, ya que este tambi√©n es un tema bastante extenso. </font><font style="vertical-align: inherit;">Puedes leerlo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Para una aplicaci√≥n de prueba, tambi√©n son suficientes peque√±os valores del orden de 1-2. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Globals</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Los par√°metros generales se pueden extraer en este bloque si, por ejemplo, declara varios recursos de tipo Function o API.</font></font><br>
<pre><code class="plaintext hljs">Globals:<font></font>
  Function:<font></font>
    Timeout: 15<font></font>
  Api:<font></font>
    Cors:<font></font>
      AllowOrigin: "'*'"<font></font>
      AllowHeaders: "'Content-Type,X-WARM-UP,X-Amz-Date,Authorization,X-Api-Key'"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo us√© para establecer un tiempo de espera para la funci√≥n y algunas configuraciones de Cors para llamar a la API de Gateway m√°s tarde desde mi p√°gina est√°tica con el formulario ContactUs. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Salidas</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Este bloque le permite definir din√°micamente algunas variables en el contexto global de AWS CloudFormation.</font></font><br>
<pre><code class="plaintext hljs">Outputs:<font></font>
  ContactUsApi:<font></font>
    Description: "API Gateway endpoint URL for Prod stage for ContactUs function"<font></font>
    Value: !Sub "https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/contact/"<font></font>
  ContactUsFunction:<font></font>
    Description: "ContactUs Lambda Function ARN"<font></font>
    Value: !GetAtt ContactUsFunction.Arn<font></font>
  ContactUsFunctionIamRole:<font></font>
    Description: "Implicit IAM Role created for ContactUs function"<font></font>
    Value: !GetAtt ContactUsFunctionRole.Arn<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por ejemplo, declaramos una variable ContactUsApi, que se establecer√° en un valor, como la direcci√≥n p√∫blica de nuestro punto final API creado. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como estamos usando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ {ServerlessRestApi}</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , AWS insertar√° el identificador √∫nico de nuestra nueva API de Gateway en la cadena. Como resultado, cualquier aplicaci√≥n que tenga acceso a CloudFormation podr√° obtener esta direcci√≥n, por lo que no puede codificar la URL de sus servicios. Bueno, otra ventaja es que es muy conveniente ver la lista de resultados, algo de metainformaci√≥n sobre su pila. </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">Aqu√≠</font></a></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
puede encontrar una lista completa de funciones y qu√© par√°metros puede usar </font><font style="vertical-align: inherit;">. </font><b><i><font style="vertical-align: inherit;">Par√°metros</font></i></b><font style="vertical-align: inherit;"> 
Adem√°s de todo lo anterior, puede agregar un bloque de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">Par√°metros</font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<b><i><font style="vertical-align: inherit;"></font></i></b><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Estas opciones ayudar√°n a que la plantilla sea m√°s vers√°til. </font><font style="vertical-align: inherit;">En cualquier otro bloque de la plantilla, puede hacer referencias a estos par√°metros, por lo tanto, no codificar algunos valores. </font><font style="vertical-align: inherit;">Por ejemplo, en mi plantilla pueden ser correos electr√≥nicos, SES ARN, cantidad de memoria, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esa es toda la plantilla. </font><font style="vertical-align: inherit;">Nadie proh√≠be agregar un par de recursos m√°s cerca, por ejemplo, un dep√≥sito S3, cualquier otro recurso de CloudFormation o un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recurso personalizado</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en general </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Procedemos al despliegue</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para armar nuestro proyecto, usaremos no Gradle, sino SAM.</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Montaje</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">F:\aws\projects\contact-us-sam-app&gt;sam build<font></font>
Building resource <span class="hljs-string">'ContactUsFunction'</span><font></font>
Running JavaGradleWorkflow:GradleBuild<font></font>
Running JavaGradleWorkflow:CopyArtifacts<font></font>
<font></font>
Build Succeeded<font></font>
<font></font>
Built Artifacts  : .aws-sam\build<font></font>
Built Template   : .aws-sam\build\template.yaml<font></font>
<font></font>
Commands you can use next<font></font>
=========================<font></font>
[*] Invoke Function: sam <span class="hljs-built_in">local</span> invoke<font></font>
[*] Deploy: sam deploy ‚Äìguided<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La ejecuci√≥n del </font><font style="vertical-align: inherit;">comando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sam build</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> desde la ra√≠z del proyecto recopilar√° autom√°ticamente </font><font style="vertical-align: inherit;">todos los archivos necesarios </font><font style="vertical-align: inherit;">en la </font><font style="vertical-align: inherit;">carpeta </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.aws-sam</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : clases, dependencias, plantilla SAM. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, debe crear un dep√≥sito S3, donde SAM posteriormente carga todos los artefactos recopilados. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto se puede hacer a trav√©s de la consola de AWS basada en navegador o con el comando</font></font><br>
<blockquote><code>aws s3 mb s3://bucket-name</code></blockquote><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: todos los dep√≥sitos se crean en un contexto global, y se analiza entre todas las cuentas. </font><font style="vertical-align: inherit;">Por lo tanto, no puede crear un dep√≥sito si alguien ya lo ha creado en su cuenta. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando el cubo est√© listo, ejecute el comando:</font></font><br>
<blockquote><code>sam package --output-template-file packaged.yaml --s3-bucket &lt;YOUR_BACKET&gt;</code></blockquote><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resultado del paquete</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">F:\aws\projects\contact-us-sam-app&gt;sam package --output-template-file packaged.yaml --s3-bucket contact-us-sam-app<font></font>
Uploading to ea0c122c06a50d9676fbf9000a80a3bf  9212768 / 9212768.0  (100.00%)<font></font>
<font></font>
Successfully packaged artifacts and wrote output template to file packaged.yaml.<font></font>
Execute the following <span class="hljs-built_in">command</span> to deploy the packaged template<font></font>
sam deploy --template-file F:\aws\projects\contact-us-sam-app\packaged.yaml --stack-name &lt;YOUR STACK NAME&gt;<font></font>
</code></pre></div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apunt√© el bucket de nuestra aplicaci√≥n contact-us-sam y SAM carg√≥ todos los recursos en la ubicaci√≥n especificada. </font><font style="vertical-align: inherit;">A continuaci√≥n, SAM ya le dice un comando para crear una pila con recursos y, por lo tanto, incorporar su decisi√≥n. </font><font style="vertical-align: inherit;">Ejecutamos el comando, habiendo finalizado un poco:</font></font><br>
<blockquote><code>sam deploy --template-file packaged.yaml --region eu-west-1 --capabilities CAPABILITY_IAM --stack-name contact-us-sam-app </code></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver, agregu√© </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--capabilities CAPABILITY_IAM</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Esto permitir√° que CloudFormation cree recursos de IAM. </font><font style="vertical-align: inherit;">De lo contrario, recibir√° un error InsufficientCapabilities al crear. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El siguiente es el registro del trabajo de este comando (se puede hacer clic en la imagen). </font><font style="vertical-align: inherit;">Detalles como el estado de cada recurso y los valores de las salidas solo estuvieron disponibles en una de las √∫ltimas versiones de SAM CLI.</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/nv/7p/4z/nv7p4zreqati1wd8c8vy3ubuzcm.png"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. Verifique el estado de CloudFormation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Podemos esperar a que se complete la implementaci√≥n en la consola hasta que aparezca un mensaje que indique que la pila se ha implementado (el comando de implementaci√≥n registra en el p√°rrafo anterior):</font></font><br>
<blockquote><code>Successfully created/updated stack - contact-us-sam-app in eu-west-1</code></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero en nuestro caso, ver√° este mensaje solo despu√©s de diez minutos debido al modo de implementaci√≥n canario. Por lo tanto, es m√°s f√°cil abrir una consola del navegador y ver la pila all√≠. </font></font><br>
<img src="https://habrastorage.org/webt/97/ki/k8/97kik8apukwxsvqwyvsd_wtmaqo.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de un tiempo, el estado cambiar√° a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE_COMPLETE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lo que significar√° una finalizaci√≥n exitosa. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la pesta√±a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eventos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">puede ver el estado de todos los recursos. Si su pila falla, aqu√≠ es donde puede encontrar mensajes de error detallados. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por ejemplo, esto: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPDATE_FAILED</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : si configura incorrectamente la API de Gateway en la plantilla.</font></font><br>
<img src="https://habrastorage.org/webt/ce/mh/aq/cemhaqtl6uvdmlvnr0bsvrbokok.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la pesta√±a Recursos, puede encontrar todos los recursos creados. </font><font style="vertical-align: inherit;">No se sorprenda de su cantidad. </font><font style="vertical-align: inherit;">Aunque solo declaramos una funci√≥n y una tabla de base de datos en la plantilla SAM, CloudFormation cre√≥ muchos otros recursos para nosotros. </font><font style="vertical-align: inherit;">Si observa su tipo, puede comprender a qu√© servicio pertenecen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para Api Gateway, se cre√≥ impl√≠citamente:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerlessRestApi</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerlessRestApiDeployment</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerlessRestApiProdStage</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n para lambda se crearon varios objetos adicionales. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora abra </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Salidas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y encuentre la URL de nuestra API. </font><font style="vertical-align: inherit;">C√≥pielo, ser√° √∫til pronto.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8. Formulario de contacto HTML</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como recordar√°n, decid√≠ hacer un formulario de ContactUs, y ahora necesitamos ponerlo a disposici√≥n de alguna manera no solo en la m√°quina local. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuraci√≥n</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En cuanto al formulario en s√≠, por ejemplo, decid√≠ tomar el formulario HTML m√°s simple y agregu√© llamadas de API de Gateway a trav√©s de ajax. </font></font><br>
<img src="https://habrastorage.org/webt/ps/e-/4h/pse-4hta3mojfuamij0dhj3bmyg.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s del formulario en s√≠, agregu√© un par de botones para depurar y simplificar el relleno: </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Establecer predeterminado</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : sustituye, como se esperaba, los par√°metros predeterminados especificados dentro de HTML.</font></font><br>
<pre><code class="javascript hljs">$(<span class="hljs-string">"#url-input"</span>).val(<span class="hljs-string">"https://4ykskscuq0.execute-api.eu-west-1.amazonaws.com/Prod/contact"</span>);<font></font>
$(<span class="hljs-string">"#name-input"</span>).val(<span class="hljs-string">"Mike"</span>);<font></font>
$(<span class="hljs-string">"#email-input"</span>).val(<span class="hljs-string">"Mike@somemail.com"</span>);<font></font>
$(<span class="hljs-string">"#phone-input"</span>).val(<span class="hljs-string">"+79999999999"</span>);<font></font>
$(<span class="hljs-string">"#description-input"</span>).val(<span class="hljs-string">"How much does it cost?"</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si tiene la intenci√≥n de utilizar esta funcionalidad, cambie la entrada de URL a la ruta de acceso a su API de puerta de enlace, que copi√≥ de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Salidas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hospedaje</font></font></b><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crea un nuevo cubo S3.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cargamos el archivo HTML en el dep√≥sito eligiendo la opci√≥n para hacer p√∫blico el archivo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entramos en el cubo donde cargamos el archivo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vaya a Propiedades, luego active el alojamiento de sitios web est√°ticos y vea su nuevo Endpoint disponible p√∫blicamente.</font></font></li>
</ul><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9. Control de salud</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solicitud est√°ndar</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ahora puede seguir el enlace a su formulario, hacer clic en Establecer predeterminado y Enviar. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De esta forma, realizar√° una solicitud que pasar√° por la API de Gateway a AWS Lambda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si configur√≥ todo correctamente despu√©s de un tiempo, recibir√° un mensaje como:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Correcto: el mensaje 0102016f28b06243-ae897a1e-b805-406b-9987-019f21547682-000000 se ha enviado correctamente.</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto significa que el mensaje se entreg√≥ correctamente. Verifique el buz√≥n que especific√≥ en la plantilla SAM. Si no ha cambiado la plantilla, la carta tendr√° este formato: </font></font><br>
<img src="https://habrastorage.org/webt/0z/wy/sv/0zwysv5ytv3uzn9fb9az7bsa6lg.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tambi√©n puede abrir DynamoDB y asegurarse de que haya aparecido una nueva entrada. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caracter√≠sticas de un arranque en fr√≠o</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Creo que not√≥ que el mensaje sobre el env√≠o exitoso lleg√≥ despu√©s de un tiempo bastante largo. Esto se debe al hecho de que el servicio AWS Lambda, despu√©s de recibir una solicitud de procesamiento, comenz√≥ a generar la instancia de su aplicaci√≥n Java, y esto incluye levantar el contenedor con el sistema operativo y JRE, cargar el classpath, inicializar todas las variables, y solo despu√©s de eso es el inicio de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">handleRequest ( )</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Esto se llama un arranque en fr√≠o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intente completar y enviar el formulario nuevamente. Esta vez la respuesta lleg√≥ casi al instante, ¬øverdad? Si han transcurrido m√°s de 20-30 minutos entre la primera y la segunda solicitud, el resultado puede variar. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øCu√°l es la raz√≥n para esto? Y con el hecho de que los cach√©s AWS Lambda ya usaban contenedores con lambdas para su reutilizaci√≥n. Esto reduce el tiempo de inicializaci√≥n de todo el contexto para iniciar el m√©todo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No existe una correlaci√≥n clara sobre cu√°nto tiempo se almacenan en cach√© las lambdas, seg√∫n lo que sea, pero algunas personas descubrieron experimentalmente que esto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">depende directamente del valor elegido de RAM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Es decir, una lambda con 128 MB de memoria estar√° disponible durante m√°s tiempo que con 3 GB. Quiz√°s haya otros par√°metros, por ejemplo, la carga promedio en la regi√≥n en la que se ejecutan sus lambdas, pero esto es inexacto. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, experimente y planifique el tiempo de almacenamiento en cach√© si utiliza solicitudes sincr√≥nicas. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calentamiento</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Como opci√≥n adicional, puede usar el calentamiento lambda. En el c√≥digo, agregu√© una verificaci√≥n de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">encabezado X-WAMP-UP</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Si hay uno, el lambda simplemente devuelve una respuesta sin ejecutar ninguna l√≥gica de negocios, pero el contenedor estar√° listo para llamadas posteriores. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede llamar a su lambda usted mismo, por ejemplo, mediante el temporizador de corona, usando CloudWatch. Esto ayudar√° si no desea que sus clientes se unan a Cold Start.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el formulario HTML, puede encontrar el bot√≥n de modo WarmUp, que agrega este encabezado especial a la solicitud. </font><font style="vertical-align: inherit;">Puede verificar que no se env√≠e ni una carta ni se escriba a la base de datos, pero llega la respuesta del lambda y la llamada posterior a la solicitud real no tomar√° mucho tiempo.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resumiendo</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante el art√≠culo, pasamos por todas las etapas principales desde el dise√±o de la aplicaci√≥n hasta su lanzamiento en la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">llamada producci√≥n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Espero que las personas que ya han escuchado acerca de Serverless y AWS Lambda, pero que no ten√≠an experiencia pr√°ctica, puedan usar esta gu√≠a y sentir que esto ofrece ventajas significativas en la velocidad de implementaci√≥n de algunas soluciones de software y no solo eso. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beneficios</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Para m√≠, he identificado las ventajas m√°s valiosas:</font></font><br>
<ul>
<li>     Free Tier      ,     ,       .</li>
<li>           1-2 .        /.</li>
<li>  ,          ,         .</li>
<li>  Serverless      .   ,  ‚Äî  .   SAM          AWS. AWS    ,         ,   .</li>
<li>      Lambda ,     .</li>
<li>   Serverless    , , .          ELK/Promethes/Grafana      .</li>
<li>   ,             API.          API Key,   IAM ,                      .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bueno, probablemente lo m√°s b√°sico es sin servidor. </font><font style="vertical-align: inherit;">No es necesario pensar en qu√© instancia EC2 debe pagar, c√≥mo configurar el acceso a ella, c√≥mo configurar alertas en caso de un bloqueo de la aplicaci√≥n, configurar el autoescalado, etc.</font></font></li>
</ul><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desventajas</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Desafortunadamente, esto no significa que ahora puede tomar esta soluci√≥n y usarla como parte de un sistema empresarial en lugar de sus microservicios favoritos en el cubo. </font><font style="vertical-align: inherit;">Muy a menudo, debe profundizar para determinar una soluci√≥n m√°s adecuada en un caso particular. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y tambi√©n tengo comentarios a los que debes prestar atenci√≥n al elegir Lambda:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicio fresco. </font><font style="vertical-align: inherit;">Especialmente significativo cuando se utilizan consultas sincr√≥nicas y lenguajes como Java o C #. </font><font style="vertical-align: inherit;">El problema se resuelve moderadamente calentando, pero es mejor pensar de antemano en tal soluci√≥n y comparar el costo y los posibles beneficios.</font></font></li>
<li>    .       3GB  ,    2   ,    ,     - Fargate,       ,     .</li>
<li>          API,       ,           .</li>
<li>    /   1-2     Serverless,                .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si ya tiene la infraestructura para desarrollar microservicios y CI / CD en Coober, nuevamente ser√° problem√°tico argumentar (especialmente para los gerentes) la necesidad de soportar otro proceso de CI / CD.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bueno, donde sin pruebas. </font><font style="vertical-align: inherit;">Y probar el rendimiento de la lambda es bastante dif√≠cil, porque sigue siendo diferente de las pruebas de rendimiento habituales, y deben tenerse en cuenta muchos factores.</font></font></li>
</ul><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uso</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En general, el uso de AWS Lambda y otros servicios sin servidor encaja muy bien con los principios de desarrollo as√≠ncrono y basado en eventos. </font><font style="vertical-align: inherit;">Y es mediante el uso del procesamiento asincr√≥nico que se pueden lograr resultados √≥ptimos tanto en t√©rminos de rendimiento como de costo. </font><font style="vertical-align: inherit;">Aqu√≠ hay una lista de soluciones en las que las soluciones Serveress desempe√±ar√°n un papel importante:</font></font><br>
<img src="https://habrastorage.org/webt/i6/ov/y6/i6ovy6ha2pszsiui5jvyewbf-dk.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PD</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que el art√≠culo result√≥ ser bastante extenso y no quiero inflarlo a√∫n m√°s, lo m√°s probable es que prepare una continuaci√≥n en la que muestre c√≥mo llevar a cabo el desarrollo de manera m√°s eficiente utilizando todas las caracter√≠sticas de la consola AWS, el marco SAM e incluso IntelljIDEA. </font><font style="vertical-align: inherit;">Bueno, como omit√≠ la parte de prueba, intentar√© describir este aspecto del desarrollo con m√°s detalle. </font><font style="vertical-align: inherit;">Adem√°s, si tiene alg√∫n deseo de agregar al siguiente art√≠culo o preguntas, no dude en escribir en los comentarios o en mensajes privados. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agregado: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS Lambda en acci√≥n. </font><font style="vertical-align: inherit;">Parte 2</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Algunos enlaces importantes y √∫tiles del art√≠culo:</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proyecto GitHub</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descargar AWS-CLI</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descargar SAM-CLI</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuraci√≥n de AWS-CLI</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infraestructura como c√≥digo</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Experiencia usando Terraform</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descripci√≥n de los recursos de SAM</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alias ‚Äã‚Äãde funciones Lambda de AWS</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despliegue avanzado de lambda</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuraci√≥n de recursos de la API de SAM</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">AWS IAM   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">       SES</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> Read/Write capacity  DynamoDB </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SAM/CloudFormation  </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> Parameters   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  CloudFormation </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">      </a></li>
</ul></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es486648/">https://habr.com/ru/post/es486648/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es486634/index.html">Actualizaciones de MSVC Backend en Visual Studio 2019 versi√≥n 16.3 y 16.4</a></li>
<li><a href="../es486638/index.html">Blazor WebAssembly 3.2.0 Preview 1 ya est√° disponible</a></li>
<li><a href="../es486640/index.html">El resumen de materiales interesantes para el desarrollador m√≥vil # 331 (27 de enero - 2 de febrero)</a></li>
<li><a href="../es486644/index.html">Antena de bricolaje en 5 minutos</a></li>
<li><a href="../es486646/index.html">Al√©jate de jQuery a Svelte, sin dolor</a></li>
<li><a href="../es486650/index.html">Memoria din√°mica en sistemas duros en tiempo real</a></li>
<li><a href="../es486652/index.html">"Cr√≠tica de la raz√≥n pura" para los programadores</a></li>
<li><a href="../es486654/index.html">Sensor de movimiento y conexi√≥n de registro de alarma y video en Home Assistant en Raspberry pi</a></li>
<li><a href="../es486656/index.html">C√≥mo agregar nuevos personajes a Unicode: la experiencia del laico</a></li>
<li><a href="../es486658/index.html">Complemento Moxy Strategy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>