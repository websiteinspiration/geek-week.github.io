<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ– ğŸ˜ ğŸ˜Ÿ Consulã‚’ä½¿ç”¨ã—ã¦Nomadã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’æ§‹æˆã—ã€Gitlabã¨çµ±åˆã™ã‚‹ ğŸ‘©ğŸ¿ ğŸ‘©â€ğŸ­ ğŸ”µ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å‰æ›¸ã
 
 æœ€è¿‘ã€Kubernetesã®äººæ°—ãŒæ€¥é€Ÿã«é«˜ã¾ã£ã¦ã„ã¾ã™-è‡ªå®…ã§å®Ÿè£…ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒå¢—ãˆã¦ã„ã¾ã™ã€‚ç§ã¯Nomadã®ã‚ˆã†ãªã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã«è§¦ã‚ŒãŸã‹ã£ãŸã§ã™ã€‚ã“ã‚Œã¯ã€Vaultã‚„Consulãªã©ã€HashiCorpã®ä»–ã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã™ã§ã«ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«æœ€é©ã§ã‚ã‚Šã€ãƒ—ãƒ­ã‚¸...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Consulã‚’ä½¿ç”¨ã—ã¦Nomadã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’æ§‹æˆã—ã€Gitlabã¨çµ±åˆã™ã‚‹</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453322/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‰æ›¸ã</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€è¿‘ã€Kubernetesã®äººæ°—ãŒæ€¥é€Ÿã«é«˜ã¾ã£ã¦ã„ã¾ã™-è‡ªå®…ã§å®Ÿè£…ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒå¢—ãˆã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ç§ã¯Nomadã®ã‚ˆã†ãªã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã«è§¦ã‚ŒãŸã‹ã£ãŸã§ã™ã€‚ã“ã‚Œã¯ã€Vaultã‚„Consulãªã©ã€HashiCorpã®ä»–ã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã™ã§ã«ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«æœ€é©ã§ã‚ã‚Šã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè‡ªä½“ã¯ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã®ç‚¹ã§è¤‡é›‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">ã“ã®è¨˜äº‹ã§ã¯ã€Nomadã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€2ã¤ã®ãƒãƒ¼ãƒ‰ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¸ã®çµåˆã€ãŠã‚ˆã³Nomadã¨Gitlabã®çµ±åˆã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bu/yn/4v/buyn4vqshurhgc9kavloja-fzsm.png"><br>
<br>
<a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ†ã‚¹ãƒˆã‚¹ã‚¿ãƒ³ãƒ‰</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ†ã‚¹ãƒˆãƒ™ãƒ³ãƒã«ã¤ã„ã¦å°‘ã—èª¬æ˜ã—ã¾ã™ã€‚3ã¤ã®ä»®æƒ³ã‚µãƒ¼ãƒãƒ¼ãŒã€2ã¤ã®CPUã€4ã¤ã®RAMã€50 Gb SSDã®ç‰¹æ€§ã§ä½¿ç”¨ã•ã‚Œã€å…±é€šã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«çµ±åˆã•ã‚Œã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãã‚Œã‚‰ã®åå‰ã¨IPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼š</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nomad-livelinux-01</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š172.30.0.5</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nomad-livelinux-02</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š172.30.0.10</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consul-livelinux-01</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š172.30.0.15</font></font></li>
</ol><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒãƒãƒ‰é ˜äº‹ã®è¨­ç½®ã€‚</font><font style="vertical-align: inherit;">ãƒãƒãƒ‰ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ä½œæˆ</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŸºæœ¬çš„ãªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«é€²ã¿ã¾ã—ã‚‡ã†ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ç°¡å˜ã§ã™ãŒã€è¨˜äº‹ã®å®Œå…¨æ€§ã®ãŸã‚ã«èª¬æ˜ã—ã¾ã™ã€‚å®Ÿéš›ã«ã¯ã€å¿…è¦ã«å¿œã˜ã¦ã™ã°ã‚„ãã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã€ä¸‹æ›¸ãã¨ãƒ¡ãƒ¢ã‹ã‚‰ä½œæˆã•ã‚Œã¾ã—ãŸã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®æ®µéšã§ã¯å°†æ¥ã®æ§‹é€ ã‚’ç†è§£ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã‚ã‚‹ãŸã‚ã€æ¼”ç¿’ã‚’å§‹ã‚ã‚‹å‰ã«ã€ç†è«–çš„ãªéƒ¨åˆ†ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2ã¤ã®éŠç‰§ãƒãƒ¼ãƒ‰ãŒã‚ã‚Šã€ãã‚Œã‚‰ã‚’ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ãƒãƒ¼ã‚¸ã—ãŸã„ã®ã§ã™ãŒã€å°†æ¥çš„ã«ã¯ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã‚‚å¿…è¦ã«ãªã‚Šã¾ã™-ã“ã‚Œã«ã¯ConsulãŒå¿…è¦ã§ã™ã€‚ã“ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€æ–°ã—ã„ãƒãƒ¼ãƒ‰ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã¨è¿½åŠ ã¯éå¸¸ã«å˜ç´”ãªã‚¿ã‚¹ã‚¯ã«ãªã‚Šã¾ã™ã€‚ä½œæˆã•ã‚ŒãŸNomadãƒãƒ¼ãƒ‰ã¯Consulã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«æ¥ç¶šã—ã€æ¬¡ã«æ—¢å­˜ã®Nomadã‚¯ãƒ©ã‚¹ã‚¿ã«æ¥ç¶šã—ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€æœ€åˆã«Consulã‚µãƒ¼ãƒãƒ¼ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€Webãƒ‘ãƒãƒ«ã®åŸºæœ¬çš„ãªhttpèªè¨¼ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯èªè¨¼ãªã—ã§å¤–éƒ¨ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ï¼‰ã¨ã€Nomadã‚µãƒ¼ãƒãƒ¼ä¸Šã®Consulã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè‡ªä½“ã‚’æ§‹æˆã—ã¾ã™ã€‚ãã®å¾Œã€Nomadã‚’èµ·å‹•ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HashiCorpãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯éå¸¸ã«ç°¡å˜ã§ã™ã€‚å®Ÿéš›ã«ã¯ã€ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’binãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã€ãƒ„ãƒ¼ãƒ«ã®æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ§‹æˆã—ã¦ã€ã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã ã‘ã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«Consulã‚’ãƒ­ãƒ¼ãƒ‰ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«è§£å‡ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">root@consul-livelinux-01:~<span class="hljs-comment"># wget https://releases.hashicorp.com/consul/1.5.0/consul_1.5.0_linux_amd64.zip</span>
root@consul-livelinux-01:~<span class="hljs-comment"># unzip consul_1.5.0_linux_amd64.zip</span>
root@consul-livelinux-01:~<span class="hljs-comment"># mv consul /usr/local/bin/</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œã§ã€ã•ã‚‰ã«æ§‹æˆã™ã‚‹ãŸã‚ã®æ—¢è£½ã®ãƒã‚¤ãƒŠãƒªé ˜äº‹ãƒ•ã‚¡ã‚¤ãƒ«ãŒã§ãã¾ã—ãŸã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consulã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€keygenã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ä¸€æ„ã®ã‚­ãƒ¼ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">root@consul-livelinux-01:~<span class="hljs-comment"># consul keygen</span>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consulã®è¨­å®šã«é€²ã¿ã€æ¬¡ã®æ§‹é€ ã§/etc/consul.d/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">/etc/consul.d/<font></font>
â”œâ”€â”€ bootstrap<font></font>
â”‚   â””â”€â”€ config.json</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯config.jsonè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒå«ã¾ã‚Œã¾ã™-ãã®ä¸­ã«Consulè¨­å®šã‚’è¨­å®šã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãã®å†…å®¹ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs">{
<span class="hljs-string">"bootstrap"</span>: <span class="hljs-literal">true</span>,
<span class="hljs-string">"server"</span>: <span class="hljs-literal">true</span>,
<span class="hljs-string">"datacenter"</span>: <span class="hljs-string">"dc1"</span>,
<span class="hljs-string">"data_dir"</span>: <span class="hljs-string">"/var/consul"</span>,
<span class="hljs-string">"encrypt"</span>: <span class="hljs-string">"your-key"</span>,
<span class="hljs-string">"log_level"</span>: <span class="hljs-string">"INFO"</span>,
<span class="hljs-string">"enable_syslog"</span>: <span class="hljs-literal">true</span>,
<span class="hljs-string">"start_join"</span>: [<span class="hljs-string">"172.30.0.15"</span>]<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸»ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã¨ãã®æ„å‘³ã‚’å€‹åˆ¥ã«èª¿ã¹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</font></font><br>
<br>
<ul>
<li><b>bootstrap</b>: true.         . ,         .</li>
<li><b>server</b>: true.   . Consul             ,  Nomadâ€™a  .</li>
<li><b>datacenter</b>: dc1.      .       ,   .</li>
<li><b>encrypt</b>: your-key. ,            .     consul keygen.</li>
<li><b>start_join</b>.       IP ,     .       .</li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®æ™‚ç‚¹ã§ã€ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’ä½¿ç”¨ã—ã¦é ˜äº‹ã‚’é–‹å§‹ã§ãã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">root@consul-livelinux-01:~<span class="hljs-comment"># /usr/local/bin/consul agent -config-dir /etc/consul.d/bootstrap -ui</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œã¯ä»Šã™ãã«ãƒ‡ãƒãƒƒã‚°ã™ã‚‹ãŸã‚ã®è‰¯ã„æ–¹æ³•ã§ã™ãŒã€ç¶™ç¶šçš„ã«ã“ã®æ–¹æ³•ã‚’ä½¿ç”¨ã—ã¦ã‚‚ã€æ˜ã‚‰ã‹ãªç†ç”±ã§æ©Ÿèƒ½ã—ã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">systemdã‚’ä½¿ç”¨ã—ã¦Consulã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">root@consul-livelinux-01:~<span class="hljs-comment"># nano /etc/systemd/system/consul.service</span>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
consul.serviceãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ï¼š </font></font><br>
<br>
<pre><code class="bash hljs">[Unit]<font></font>
Description=Consul Startup process<font></font>
After=network.target<font></font>
 <font></font>
[Service]<font></font>
Type=simple<font></font>
ExecStart=/bin/bash -c <span class="hljs-string">'/usr/local/bin/consul agent -config-dir /etc/consul.d/bootstrap -ui'</span> <font></font>
TimeoutStartSec=0<font></font>
 <font></font>
[Install]<font></font>
WantedBy=default.target</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
systemctlã‚’ä½¿ç”¨ã—ã¦Consulã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">root@consul-livelinux-01:~<span class="hljs-comment"># systemctl start consul</span>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚µãƒ¼ãƒ“ã‚¹ã‚’é–‹å§‹ã—ã€consul membersã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã‚µãƒ¼ãƒãƒ¼ã‚’ç¢ºèªã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">root@consul-livelinux:/etc/consul.d<span class="hljs-comment"># consul members</span>
consul-livelinux    172.30.0.15:8301  alive   server  1.5.0  2         dc1  &lt;all&gt;</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼šNginxã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ãƒ—ãƒ­ã‚­ã‚·ã®è¨­å®šã€httpèªè¨¼ã€‚</font><font style="vertical-align: inherit;">ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’ä½¿ç”¨ã—ã¦nginxã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª/ etc / nginx / sites-enabledã«æ¬¡ã®å†…å®¹ã§æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«consul.confã‚’ä½œæˆã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="nginx hljs"><span class="hljs-attribute">upstream</span> consul-auth {
    <span class="hljs-attribute">server</span> localhost:<span class="hljs-number">8500</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-section">server</span> {<font></font>
<font></font>
    <span class="hljs-attribute">server_name</span> consul.doman.name;<font></font>
    <font></font>
    <span class="hljs-attribute">location</span> / {
      <span class="hljs-attribute">proxy_pass</span> http://consul-auth;
      <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;
      <span class="hljs-attribute">auth_basic_user_file</span> /etc/nginx/.htpasswd;
      <span class="hljs-attribute">auth_basic</span> <span class="hljs-string">"Password-protected Area"</span>;<font></font>
    }<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
.htpasswdãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã‚’å¿˜ã‚Œãªã„ã§ãã ã•ã„ã€‚</font><font style="vertical-align: inherit;">ã“ã®ã‚¢ã‚¤ãƒ†ãƒ ã¯ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’çŸ¥ã£ã¦ã„ã‚‹èª°ã‚‚ãŒWebãƒ‘ãƒãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«å¿…è¦ã§ã™ã€‚</font><font style="vertical-align: inherit;">ãŸã ã—ã€Gitlabã‚’æ§‹æˆã™ã‚‹ã¨ãã¯ã€ã“ã‚Œã‚’æ”¾æ£„ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã†ã—ãªã„ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’Nomadã«ãƒ‡ãƒ—ãƒ­ã‚¤ã§ããªããªã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ç§ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€Gitlabã¨Nomadã®ä¸¡æ–¹ãŒç°è‰²ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã«ã‚ã‚‹ã ã‘ãªã®ã§ã€ãã®ã‚ˆã†ãªå•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»–ã®2å°ã®ã‚µãƒ¼ãƒãƒ¼ã§ã€æ¬¡ã®æ‰‹é †ã«å¾“ã£ã¦Consulã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã§æ‰‹é †ã‚’ç¹°ã‚Šè¿”ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">root@nomad-livelinux-01:~<span class="hljs-comment"># wget https://releases.hashicorp.com/consul/1.5.0/consul_1.5.0_linux_amd64.zip</span>
root@nomad-livelinux-01:~<span class="hljs-comment"># unzip consul_1.5.0_linux_amd64.zip</span>
root@nomad-livelinux-01:~<span class="hljs-comment"># mv consul /usr/local/bin/</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»¥å‰ã®ã‚µãƒ¼ãƒãƒ¼ã¨åŒæ§˜ã«ã€æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«/etc/consul.dã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ¬¡ã®æ§‹é€ ã§ä½œæˆã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">/etc/consul.d/<font></font>
â”œâ”€â”€ client<font></font>
â”‚   â””â”€â”€ config.json</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
config.jsonãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs">{
    <span class="hljs-string">"datacenter"</span>: <span class="hljs-string">"dc1"</span>,
    <span class="hljs-string">"data_dir"</span>: <span class="hljs-string">"/opt/consul"</span>,
    <span class="hljs-string">"log_level"</span>: <span class="hljs-string">"DEBUG"</span>,
    <span class="hljs-string">"node_name"</span>: <span class="hljs-string">"nomad-livelinux-01"</span>,
    <span class="hljs-string">"server"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-string">"encrypt"</span>: <span class="hljs-string">"your-private-key"</span>,
    <span class="hljs-string">"domain"</span>: <span class="hljs-string">"livelinux"</span>,
    <span class="hljs-string">"addresses"</span>: {
      <span class="hljs-string">"dns"</span>: <span class="hljs-string">"127.0.0.1"</span>,
      <span class="hljs-string">"https"</span>: <span class="hljs-string">"0.0.0.0"</span>,
      <span class="hljs-string">"grpc"</span>: <span class="hljs-string">"127.0.0.1"</span>,
      <span class="hljs-string">"http"</span>: <span class="hljs-string">"127.0.0.1"</span><font></font>
    },<font></font>
    <span class="hljs-string">"bind_addr"</span>: <span class="hljs-string">"172.30.0.5"</span>, #   
    <span class="hljs-string">"start_join"</span>: [<span class="hljs-string">"172.30.0.15"</span>], #    
    <span class="hljs-string">"ports"</span>: {
      <span class="hljs-string">"dns"</span>: <span class="hljs-number">53</span><font></font>
     }<font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¤‰æ›´ã‚’ä¿å­˜ã—ã€ã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãã®å†…å®¹ã®æ§‹æˆã«é€²ã¿ã¾ã™ï¼š</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
/etc/systemd/system/consul.serviceï¼š</font></font><br>
<br>
<pre><code class="bash hljs">[Unit]<font></font>
Description=<span class="hljs-string">"HashiCorp Consul - A service mesh solution"</span><font></font>
Documentation=https://www.consul.io/<font></font>
Requires=network-online.target<font></font>
After=network-online.target<font></font>
<font></font>
[Service]<font></font>
User=root<font></font>
Group=root<font></font>
ExecStart=/usr/<span class="hljs-built_in">local</span>/bin/consul agent -config-dir=/etc/consul.d/client<font></font>
ExecReload=/usr/<span class="hljs-built_in">local</span>/bin/consul reload<font></font>
KillMode=process<font></font>
Restart=on-failure<font></font>
<font></font>
[Install]<font></font>
WantedBy=multi-user.target</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚µãƒ¼ãƒãƒ¼ã§é ˜äº‹ã‚’å§‹ã‚ã¾ã™ã€‚ã“ã‚Œã§ã€é–‹å§‹å¾Œã€æ§‹æˆã•ã‚ŒãŸã‚µãƒ¼ãƒ“ã‚¹ãŒnsulãƒ¡ãƒ³ãƒãƒ¼ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯ã€å½¼ãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã—ã¦ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«æ­£å¸¸ã«æ¥ç¶šã—ãŸã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚ 2å°ç›®ã®ã‚µãƒ¼ãƒãƒ¼ã§ã‚‚åŒã˜æ‰‹é †ã‚’ç¹°ã‚Šè¿”ã—ã¾ã™ã€‚ãã®å¾Œã€Nomadã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨æ§‹æˆã‚’é–‹å§‹ã§ãã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nomadã®ã‚ˆã‚Šè©³ç´°ãªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚å¾“æ¥ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã«ã¯ã€ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨ã‚½ãƒ¼ã‚¹ã‹ã‚‰ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã®2ã¤ãŒã‚ã‚Šã¾ã™ã€‚æœ€åˆã®æ–¹æ³•ã‚’é¸ã³ã¾ã™ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯éå¸¸ã«é€Ÿãé–‹ç™ºã•ã‚Œã¦ãŠã‚Šã€æ–°ã—ã„ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒé »ç¹ã«å‡ºã¦ãã¾ã™ã€‚ãŠãã‚‰ãã€ã“ã®è¨˜äº‹ãŒå®Œäº†ã™ã‚‹ã¾ã§ã«æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚ã—ãŸãŒã£ã¦ã€èª­ã‚€å‰ã«ã€ç¾æ™‚ç‚¹ã§ã®Nomadã®ç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèªã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">root@nomad-livelinux-01:~<span class="hljs-comment"># wget https://releases.hashicorp.com/nomad/0.9.1/nomad_0.9.1_linux_amd64.zip</span>
root@nomad-livelinux-01:~<span class="hljs-comment"># unzip nomad_0.9.1_linux_amd64.zip</span>
root@nomad-livelinux-01:~<span class="hljs-comment"># mv nomad /usr/local/bin/</span>
root@nomad-livelinux-01:~<span class="hljs-comment"># nomad -autocomplete-install</span>
root@nomad-livelinux-01:~<span class="hljs-comment"># complete -C /usr/local/bin/nomad nomad</span>
root@nomad-livelinux-01:~<span class="hljs-comment"># mkdir /etc/nomad.d</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è§£å‡ã™ã‚‹ã¨ã€é‡é‡ãŒ65 MBã®Nomadãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¾ã™ã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’/ usr / local / binã«ç§»å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nomadã®ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€ãã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¾ã™ï¼ˆãŠãã‚‰ãæœ€åˆã¯å­˜åœ¨ã—ã¾ã›ã‚“ï¼‰ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">root@nomad-livelinux-01:~<span class="hljs-comment"># mkdir --parents /opt/nomad</span>
root@nomad-livelinux-01:~<span class="hljs-comment"># nano /etc/systemd/system/nomad.service</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã“ã«æ¬¡ã®è¡Œã‚’æŒ¿å…¥ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">[Unit]<font></font>
Description=Nomad<font></font>
Documentation=https://nomadproject.io/docs/<font></font>
Wants=network-online.target<font></font>
After=network-online.target<font></font>
<font></font>
[Service]<font></font>
ExecReload=/bin/<span class="hljs-built_in">kill</span> -HUP <span class="hljs-variable">$MAINPID</span>
ExecStart=/usr/<span class="hljs-built_in">local</span>/bin/nomad agent -config /etc/nomad.d<font></font>
KillMode=process<font></font>
KillSignal=SIGINT<font></font>
LimitNOFILE=infinity<font></font>
LimitNPROC=infinity<font></font>
Restart=on-failure<font></font>
RestartSec=2<font></font>
StartLimitBurst=3<font></font>
StartLimitIntervalSec=10<font></font>
TasksMax=infinity<font></font>
<font></font>
[Install]<font></font>
WantedBy=multi-user.target</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãŸã ã—ã€nomadã‚’å®Ÿè¡Œã™ã‚‹ã®ã¯æ€¥ã„ã§ã„ã¾ã›ã‚“ã€‚æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã¯ã¾ã ä½œæˆã—ã¦ã„ã¾ã›ã‚“ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">root@nomad-livelinux-01:~<span class="hljs-comment"># mkdir --parents /etc/nomad.d</span>
root@nomad-livelinux-01:~<span class="hljs-comment"># chmod 700 /etc/nomad.d</span>
root@nomad-livelinux-01:~<span class="hljs-comment"># nano /etc/nomad.d/nomad.hcl</span>
root@nomad-livelinux-01:~<span class="hljs-comment"># nano /etc/nomad.d/server.hcl</span>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€çµ‚çš„ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">/etc/nomad.d/<font></font>
â”œâ”€â”€ nomad.hcl<font></font>
â””â”€â”€ server.hcl</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
nomad.hclãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€æ¬¡ã®æ§‹æˆãŒå«ã¾ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">datacenter = <span class="hljs-string">"dc1"</span>
data_dir = <span class="hljs-string">"/opt/nomad"</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
server.hclãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">server {<font></font>
  enabled = <span class="hljs-literal">true</span><font></font>
  bootstrap_expect = 1<font></font>
}<font></font>
<font></font>
consul {<font></font>
  address             = <span class="hljs-string">"127.0.0.1:8500"</span>
  server_service_name = <span class="hljs-string">"nomad"</span>
  client_service_name = <span class="hljs-string">"nomad-client"</span>
  auto_advertise      = <span class="hljs-literal">true</span>
  server_auto_join    = <span class="hljs-literal">true</span>
  client_auto_join    = <span class="hljs-literal">true</span><font></font>
}<font></font>
<font></font>
bind_addr = <span class="hljs-string">"127.0.0.1"</span> <font></font>
<font></font>
advertise {<font></font>
  http = <span class="hljs-string">"172.30.0.5"</span><font></font>
}<font></font>
<font></font>
client {<font></font>
  enabled = <span class="hljs-literal">true</span>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2ç•ªç›®ã®ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã‚’å¿˜ã‚Œãªã„ã§ãã ã•ã„-ãã“ã§ã€httpãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã®å€¤ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®æ®µéšã®æœ€å¾Œã¯ã€httpèªè¨¼ã‚’ãƒ—ãƒ­ã‚­ã‚·ãŠã‚ˆã³è¨­å®šã™ã‚‹ãŸã‚ã®Nginxã®æ§‹æˆã§ã™ã€‚</font><font style="vertical-align: inherit;">nomad.confãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">upstream nomad-auth {<font></font>
        server 172.30.0.5:4646;<font></font>
}<font></font>
<font></font>
server {<font></font>
<font></font>
        server_name nomad.domain.name;<font></font>
        <font></font>
        location / {<font></font>
	        proxy_pass http://nomad-auth;<font></font>
	        proxy_set_header Host <span class="hljs-variable">$host</span>;<font></font>
	        auth_basic_user_file /etc/nginx/.htpasswd;<font></font>
		   auth_basic <span class="hljs-string">"Password-protected Area"</span>;<font></font>
        }<font></font>
        <font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œã§ã€å¤–éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çµŒç”±ã§Webãƒ‘ãƒãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">æ¥ç¶šã—ã¦ã‚µãƒ¼ãƒãƒ¼ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã¾ã™ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/en/uq/ck/enuqck8krqstsbt8b6uwbytoy0e.png"><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”»åƒ1.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nomadã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å†…ã®ã‚µãƒ¼ãƒãƒ¼ã®ãƒªã‚¹ãƒˆ</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸¡æ–¹ã®ã‚µãƒ¼ãƒãƒ¼ãŒãƒ‘ãƒãƒ«ã«æ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã€nomad node statusã‚³ãƒãƒ³ãƒ‰ã®å‡ºåŠ›ã«åŒã˜ã‚‚ã®ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/c1/gv/82/c1gv82tjvwtw0onqxqv3huchv1w.png"><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”»åƒ2.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nomad node statusã‚³ãƒãƒ³ãƒ‰ã®å‡ºåŠ›</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consulã¯ä½•ã‚’ã—ã¾ã™ã‹ï¼Ÿ</font><font style="vertical-align: inherit;">è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</font><font style="vertical-align: inherit;">Consulã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«ã®ãƒãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã¾ã™ã€‚</font></font><br>
<img src="https://habrastorage.org/webt/m5/6w/tj/m56wtjjgkos9ed5e_jy9lidmutg.png"><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”»åƒ3.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Consulã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å†…ã®ãƒãƒ¼ãƒ‰</font><b><font style="vertical-align: inherit;">ã®</font></b><font style="vertical-align: inherit;">ãƒªã‚¹ãƒˆ</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œ</font><font style="vertical-align: inherit;">ã§ã€Consul </font><font style="vertical-align: inherit;">ã¨é€£æºã—ã¦å‹•ä½œã™ã‚‹æº–å‚™ã•ã‚ŒãŸNomadãŒã§ãã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">æœ€å¾Œã®æ®µéšã§ã¯ã€æœ€ã‚‚èˆˆå‘³æ·±ã„ã‚‚ã®ã‹ã‚‰å§‹ã‚ã¾ã™ã€‚Gitlabã‹ã‚‰Nomadã¸ã®Dockerã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã®é…ä¿¡ã‚’æ§‹æˆã—ã€ãã®ä»–ã®ç‰¹å¾´çš„ãªæ©Ÿèƒ½ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gitlabãƒ©ãƒ³ãƒŠãƒ¼ã®ä½œæˆ</font></font><br>
</h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’Nomadã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã«ã€Nomadãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†…éƒ¨ã«æŒã¤åˆ¥ã®ãƒ©ãƒ³ãƒŠãƒ¼ã‚’ä½¿ç”¨ã—ã¾ã™ï¼ˆã¡ãªã¿ã«ã€ã“ã“ã§ã€Hashicorpã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚‚ã†1ã¤ã®æ©Ÿèƒ½ã«æ³¨ç›®ã§ãã¾ã™-å€‹åˆ¥ã«å”¯ä¸€ã®ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ï¼‰ã€‚</font><font style="vertical-align: inherit;">ãã‚Œã‚’ãƒ©ãƒ³ãƒŠãƒ¼ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">å½¼ã®ãŸã‚ã«ã€æ¬¡ã®å†…å®¹ã§æœ€ã‚‚å˜ç´”ãªDockerfileã‚’ä½œæˆã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
FROM alpine:3.9<font></font>
RUN apk add --update --no-cache libc6-compat gettext<font></font>
COPY nomad /usr/<span class="hljs-built_in">local</span>/bin/nomad
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŒã˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã€.gitlab-ci.ymlã‚’ä½œæˆã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">variables:<font></font>
  DOCKER_IMAGE: nomad/nomad-deploy<font></font>
  DOCKER_REGISTRY: registry.domain.name<font></font>
 <font></font>
<font></font>
stages:<font></font>
  - build<font></font>
<font></font>
build:<font></font>
  stage: build<font></font>
  image: <span class="hljs-variable">${DOCKER_REGISTRY}</span>/nomad/alpine:3<font></font>
  script:<font></font>
    - tag=<span class="hljs-variable">${DOCKER_REGISTRY}</span>/<span class="hljs-variable">${DOCKER_IMAGE}</span>:latest<font></font>
    - docker build --pull -t <span class="hljs-variable">${tag}</span> -f Dockerfile .<font></font>
    - docker push <span class="hljs-variable">${tag}</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã®çµæœã€Gitlabãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«Nomadãƒ©ãƒ³ãƒŠãƒ¼ã®ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªã‚¤ãƒ¡ãƒ¼ã‚¸ãŒä½œæˆã•ã‚Œã¾ã™ã€‚ã“ã‚Œã§ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒªãƒã‚¸ãƒˆãƒªã«ç›´æ¥ç§»å‹•ã—ã¦ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ä½œæˆã—ã€Nomadã‚¸ãƒ§ãƒ–Nomadã‚’æ§‹æˆã§ãã¾ã™ã€‚ </font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</font></font><br>
</h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nomadç”¨ã®ã‚¸ãƒ§ãƒ–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ã€‚</font><font style="vertical-align: inherit;">ã“ã®è¨˜äº‹ã®ç§ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯éå¸¸ã«åŸå§‹çš„ãªã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚1ã¤ã®ã‚¿ã‚¹ã‚¯ã§æ§‹æˆã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">.gitlab-ciã®å†…å®¹ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">variables:<font></font>
  NOMAD_ADDR: http://nomad.address.service:4646<font></font>
  DOCKER_REGISTRY: registry.domain.name<font></font>
  DOCKER_IMAGE: example/project<font></font>
<font></font>
stages:<font></font>
  - build<font></font>
  - deploy<font></font>
<font></font>
build:<font></font>
  stage: build<font></font>
  image: <span class="hljs-variable">${DOCKER_REGISTRY}</span>/nomad-runner/alpine:3<font></font>
  script:<font></font>
    - tag=<span class="hljs-variable">${DOCKER_REGISTRY}</span>/<span class="hljs-variable">${DOCKER_IMAGE}</span>:<span class="hljs-variable">${CI_COMMIT_SHORT_SHA}</span>
    - docker build --pull -t <span class="hljs-variable">${tag}</span> -f Dockerfile .<font></font>
    - docker push <span class="hljs-variable">${tag}</span><font></font>
<font></font>
<font></font>
deploy:<font></font>
  stage: deploy<font></font>
  image: registry.example.com/nomad/nomad-runner:latest<font></font>
  script:<font></font>
    - envsubst <span class="hljs-string">'${CI_COMMIT_SHORT_SHA}'</span> &lt; project.nomad &gt; job.nomad<font></font>
    - cat job.nomad<font></font>
    - nomad validate job.nomad<font></font>
    - nomad plan job.nomad || <span class="hljs-keyword">if</span> [ $? -eq 255 ]; <span class="hljs-keyword">then</span> <span class="hljs-built_in">exit</span> 255; <span class="hljs-keyword">else</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">"success"</span>; <span class="hljs-keyword">fi</span><font></font>
    - nomad run job.nomad<font></font>
  environment:<font></font>
    name: production<font></font>
  allow_failure: <span class="hljs-literal">false</span>
  when: manual</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã“ã§ã¯ã€ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã¯æ‰‹å‹•ãƒ¢ãƒ¼ãƒ‰ã§è¡Œã‚ã‚Œã¾ã™ãŒã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å†…å®¹ã‚’å¤‰æ›´ã™ã‚‹ã‚ˆã†ã«æ§‹æˆã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯2ã¤ã®æ®µéšã§æ§‹æˆã•ã‚Œã¾ã™ã€‚ã‚¤ãƒ¡ãƒ¼ã‚¸ã®çµ„ã¿ç«‹ã¦ã‹ã‚‰ã€éŠç‰§æ°‘ã¸ã®å±•é–‹ã¾ã§ã§ã™ã€‚</font><font style="vertical-align: inherit;">æœ€åˆã®æ®µéšã§ã¯ã€Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’åé›†ã—ã¦ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«ãƒ—ãƒƒã‚·ãƒ¥ã—ã€2ç•ªç›®ã®æ®µéšã§ã¯ã€Nomadã§ã‚¸ãƒ§ãƒ–ã‚’èµ·å‹•ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">job <span class="hljs-string">"monitoring-status"</span> {<font></font>
    datacenters = [<span class="hljs-string">"dc1"</span>]<font></font>
    migrate {<font></font>
        max_parallel = 3<font></font>
        health_check = <span class="hljs-string">"checks"</span>
        min_healthy_time = <span class="hljs-string">"15s"</span>
        healthy_deadline = <span class="hljs-string">"5m"</span><font></font>
    }<font></font>
<font></font>
    group <span class="hljs-string">"zhadan.ltd"</span> {<font></font>
        count = 1<font></font>
        update {<font></font>
            max_parallel      = 1<font></font>
            min_healthy_time  = <span class="hljs-string">"30s"</span>
            healthy_deadline  = <span class="hljs-string">"5m"</span>
            progress_deadline = <span class="hljs-string">"10m"</span>
            auto_revert       = <span class="hljs-literal">true</span><font></font>
        }<font></font>
        task <span class="hljs-string">"service-monitoring"</span> {<font></font>
            driver = <span class="hljs-string">"docker"</span><font></font>
<font></font>
            config {<font></font>
                image = <span class="hljs-string">"registry.domain.name/example/project:<span class="hljs-variable">${CI_COMMIT_SHORT_SHA}</span>"</span>
                force_pull = <span class="hljs-literal">true</span><font></font>
                auth {<font></font>
                    username = <span class="hljs-string">"gitlab_user"</span>
                    password = <span class="hljs-string">"gitlab_password"</span><font></font>
                }<font></font>
                port_map {<font></font>
                    http = 8000<font></font>
                }<font></font>
            }<font></font>
            resources {<font></font>
                network {<font></font>
                    port <span class="hljs-string">"http"</span> {}<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç§ãŒãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚’æŒã£ã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ—ãƒ¼ãƒ«ã‚’æˆåŠŸã•ã›ã‚‹ã«ã¯ã€ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®å ´åˆã®æœ€è‰¯ã®è§£æ±ºç­–ã¯ã€Nomadã¨ã®ãã®å¾Œã®çµ±åˆã§Vaultã«ãƒ­ã‚°ã‚¤ãƒ³ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹ã“ã¨ã§ã™ã€‚</font><font style="vertical-align: inherit;">Nomadã¯Vaultã‚’ãƒã‚¤ãƒ†ã‚£ãƒ–ã§ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãŸã ã—ã€æœ€åˆã«ã€Vaultè‡ªä½“ã«Nomadã«å¿…è¦ãªãƒãƒªã‚·ãƒ¼ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># Download the policy and token role</span><font></font>
$ curl https://nomadproject.io/data/vault/nomad-server-policy.hcl -O -s -L<font></font>
$ curl https://nomadproject.io/data/vault/nomad-cluster-role.json -O -s -L<font></font>
<font></font>
<span class="hljs-comment"># Write the policy to Vault</span><font></font>
$ vault policy write nomad-server nomad-server-policy.hcl<font></font>
<font></font>
<span class="hljs-comment"># Create the token role with Vault</span>
$ vault write /auth/token/roles/nomad-cluster @nomad-cluster-role.json</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¿…è¦ãªãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆã—ãŸã‚‰ã€job.nomadãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¿ã‚¹ã‚¯ãƒ–ãƒ­ãƒƒã‚¯ã«Vaultã¨ã®çµ±åˆã‚’è¿½åŠ ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">vault {<font></font>
  enabled = <span class="hljs-literal">true</span>
  address = <span class="hljs-string">"https://vault.domain.name:8200"</span>
  token = <span class="hljs-string">"token"</span>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç§ã¯ãƒˆãƒ¼ã‚¯ãƒ³ã«ã‚ˆã‚‹æ‰¿èªã‚’ä½¿ç”¨ã—ã¦ã€ã“ã“ã«ç›´æ¥æ›¸ãè¾¼ã¿ã¾ã™ã€‚éŠç‰§æ°‘ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã¨ãã«ã€ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å¤‰æ•°ã¨ã—ã¦æŒ‡å®šã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚‚ã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">$ VAULT_TOKEN=&lt;token&gt; nomad agent -config /path/to/config
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œã§ã€Vaultã§ã‚­ãƒ¼ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">æ“ä½œã®åŸç†ã¯ç°¡å˜ã§ã™ï¼šå¤‰æ•°ã®å€¤ã‚’æ ¼ç´ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Nomadã‚¸ãƒ§ãƒ–ã§ä½œæˆã—ã¾ã™ã€ä¾‹ãˆã°ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">template {<font></font>
                data = &lt;&lt;EOH<font></font>
{{with secret <span class="hljs-string">"secrets/pipeline-keys"</span>}}<font></font>
REGISTRY_LOGIN=<span class="hljs-string">"{{ .Data.REGISTRY_LOGIN }}"</span>
REGISTRY_PASSWORD=<span class="hljs-string">"{{ .Data.REGISTRY_LOGIN }}{{ end }}"</span><font></font>
<font></font>
EOH<font></font>
    destination = <span class="hljs-string">"secrets/service-name.env"</span>
    env = <span class="hljs-literal">true</span>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®ã‚ˆã†ãªå˜ç´”ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ä½¿ç”¨ã—ã¦ã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚’Nomadã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«é…ä¿¡ã™ã‚‹ã‚ˆã†ã«æ§‹æˆã—ã€å°†æ¥çš„ã«ãã‚Œã‚’å‡¦ç†ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ç§ã¯ã‚ã‚‹ç¨‹åº¦ã€Nomadã«å…±æ„Ÿã—ã¾ã™ã€‚KubernetesãŒè¿½åŠ ã®å•é¡Œã‚’å¼•ãèµ·ã“ã—ã€ãã®å¯èƒ½æ€§ã‚’æœ€å¾Œã¾ã§èªè­˜ã§ããªã„å°è¦æ¨¡ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«é©ã—ã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã•ã‚‰ã«ã€Nomadã¯åˆå¿ƒè€…ã«æœ€é©ã§ã™ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨è¨­å®šãŒç°¡å˜ã§ã™ã€‚</font><font style="vertical-align: inherit;">ãŸã ã—ã€ä¸€éƒ¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ãƒ†ã‚¹ãƒˆã™ã‚‹ã¨ã€ä»¥å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®å•é¡ŒãŒç™ºç”Ÿã—ã¾ã™ã€‚åŸºæœ¬çš„ãªæ©Ÿèƒ½ãŒå¤šããªã„ã‹ã€æ­£ã—ãæ©Ÿèƒ½ã—ã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">ãã‚Œã§ã‚‚ã€Nomadã¯ä»Šå¾Œã‚‚é–‹ç™ºã‚’ç¶šã‘ã€å°†æ¥çš„ã«ã¯å¿…è¦ãªæ©Ÿèƒ½ã‚’ã™ã¹ã¦ç²å¾—ã—ã¦ã„ãã¨æ€ã„ã¾ã™ã€‚</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ilya Andreevã«ã‚ˆã‚‹æŠ•ç¨¿ã€Alexei Zhadanã«ã‚ˆã‚‹ç·¨é›†ãŠã‚ˆã³Live Linuxãƒãƒ¼ãƒ </font></font><br>
</i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja453310/index.html">RxJSãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã§ãƒ‡ãƒ¼ã‚¿ã‚’äº¤æ›ã™ã‚‹</a></li>
<li><a href="../ja453312/index.html">XMLãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãPDFãƒ“ã‚¸ãƒã‚¹ãƒ¡ãƒ¼ãƒ«ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</a></li>
<li><a href="../ja453314/index.html">DIY Black Mirror-ãƒãƒ£ãƒƒãƒˆã®å±¥æ­´ã«åŸºã¥ã„ã¦ãƒœãƒƒãƒˆã‚’æ•™ãˆã‚‹</a></li>
<li><a href="../ja453316/index.html">ã‚¤ã‚®ãƒªã‚¹ã®ARMãƒãƒƒãƒ—ãƒ¡ãƒ¼ã‚«ãƒ¼ã€Huaweiã¨ã®ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¸­æ­¢</a></li>
<li><a href="../ja453318/index.html">ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã®å®Ÿè£…ã«ãŠã‘ã‚‹5ã¤ã®ã‚¨ãƒ©ãƒ¼</a></li>
<li><a href="../ja453324/index.html">æ•´æµå™¨ã¨ã—ã¦ã®ãƒ€ã‚¤ã‚ªãƒ¼ãƒ‰</a></li>
<li><a href="../ja453326/index.html">ITã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ç®¡ç†ã‚’è‡ªå‹•åŒ–ã™ã‚‹æ–¹æ³•-3ã¤ã®ãƒˆãƒ¬ãƒ³ãƒ‰ã«ã¤ã„ã¦è©±ã—åˆã†</a></li>
<li><a href="../ja453328/index.html">ãƒªãƒ¢ãƒ¼ãƒˆã‚µã‚¤ãƒˆã§10å¹´</a></li>
<li><a href="../ja453330/index.html">RAMã«éšœå®³ãŒç™ºç”Ÿã—ãŸå ´åˆã®å¯¾å‡¦æ–¹æ³•ã€‚æ—¢å¾€æ­´ã¨æ²»ç™‚æ³•</a></li>
<li><a href="../ja453332/index.html">ãƒãƒ¼ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ã‚’ç¯€ç´„ã™ã‚‹å¥‡å¦™ãªæ–¹æ³•ã«ã¤ã„ã¦</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>