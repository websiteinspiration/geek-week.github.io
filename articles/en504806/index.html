<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìÅ ‚èèÔ∏è ü§¥üèø We analyze the masterpieces of painting with the help of classic ML üë©üèº‚Äç‚öïÔ∏è ü•ê üè∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello everyone! One friend of mine studies as an artist and regularly talks about this or that masterpiece, about unique compositional techniques, abo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>We analyze the masterpieces of painting with the help of classic ML</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/504806/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello everyone! </font><font style="vertical-align: inherit;">One friend of mine studies as an artist and regularly talks about this or that masterpiece, about unique compositional techniques, about color perception, about the evolution of painting and brilliant artists. </font><font style="vertical-align: inherit;">Against the background of this constant impact, I decided to check whether my engineering knowledge and skills are suitable for analyzing the world cultural heritage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Armed with a makeshift parser under cover of night, I burst into the online gallery and brought out almost 50 thousand paintings from there. </font><font style="vertical-align: inherit;">Let's see what is interesting to do with this, using only classic ML tools (caution, traffic).</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Naive transformation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As many of us remember from computer science lessons, an image is represented as an array of bytes that are responsible for the color of each individual pixel. </font><font style="vertical-align: inherit;">As a rule, an RGB scheme is used, in which the color is divided into three components (red / green / blue), which, when summed with a black background, give the original color that is perceived by a person. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since now for us all the masterpieces have temporarily become only arrays of numbers on the disk, we will try to characterize these arrays by constructing histograms of the distribution of intensity frequencies for each channel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will use numpy for calculations, and visualize using matplotlib.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Source</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">#      </span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_image_by_index</span>(<span class="hljs-params">i</span>):</span><font></font>
    image_path = paintings_links.iloc[i].img_path<font></font>
    img = cv2.imdecode(np.fromfile(str(Path.cwd()/image_path), np.uint8), cv2.IMREAD_UNCHANGED)<font></font>
    <span class="hljs-keyword">return</span> img    
<span class="hljs-comment">#    </span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_hist_data_by_index</span>(<span class="hljs-params">img_index</span>):</span>
    bin_div = <span class="hljs-number">5</span> <font></font>
    img = load_image_by_index(img_index)<font></font>
    b, bins=  np.histogram(img[:,:,<span class="hljs-number">0</span>], bins=<span class="hljs-number">255</span>//bin_div, range=(<span class="hljs-number">0</span>,<span class="hljs-number">255</span>), density=<span class="hljs-literal">True</span>)<font></font>
    g = np.histogram(img[:,:,<span class="hljs-number">1</span>], bins=<span class="hljs-number">255</span>//bin_div, range=(<span class="hljs-number">0</span>,<span class="hljs-number">255</span>), density=<span class="hljs-literal">True</span>)[<span class="hljs-number">0</span>]<font></font>
    r = np.histogram(img[:,:,<span class="hljs-number">2</span>], bins=<span class="hljs-number">255</span>//bin_div, range=(<span class="hljs-number">0</span>,<span class="hljs-number">255</span>), density=<span class="hljs-literal">True</span>)[<span class="hljs-number">0</span>]
    <span class="hljs-keyword">return</span> bins, r, g, b
<span class="hljs-comment">#       </span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_image_with_hist_by_index</span>(<span class="hljs-params">img_index, height=<span class="hljs-number">6</span></span>):</span><font></font>
    bins, r, g, b = get_hist_data_by_index(img_index)<font></font>
    img = load_image_by_index(img_index)<font></font>
    fig = plt.figure(constrained_layout=<span class="hljs-literal">True</span>)<font></font>
<font></font>
    <span class="hljs-keyword">if</span> img.shape[<span class="hljs-number">0</span>] &lt; img.shape[<span class="hljs-number">1</span>]:<font></font>
        width_ratios = [<span class="hljs-number">3</span>,<span class="hljs-number">1</span>]
    <span class="hljs-keyword">else</span>:<font></font>
        width_ratios = [<span class="hljs-number">1</span>,<span class="hljs-number">1</span>]<font></font>
        <font></font>
    gs = GridSpec(<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, figure=fig, <font></font>
                  width_ratios = [<span class="hljs-number">3</span>,<span class="hljs-number">1</span>]<font></font>
                 )<font></font>
    ax_img = fig.add_subplot(gs[:,<span class="hljs-number">0</span>])<font></font>
<font></font>
    ax_r = fig.add_subplot(gs[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>])<font></font>
    ax_g = fig.add_subplot(gs[<span class="hljs-number">1</span>, <span class="hljs-number">1</span>], sharey=ax_r)<font></font>
    ax_b = fig.add_subplot(gs[<span class="hljs-number">2</span>, <span class="hljs-number">1</span>], sharey=ax_r)<font></font>
<font></font>
    ax_img.imshow(cv2.cvtColor(img, cv2.COLOR_BGR2RGB),aspect = <span class="hljs-string">'equal'</span>)<font></font>
    ax_img.axis(<span class="hljs-string">'off'</span>)<font></font>
    <font></font>
    ax_r.bar(bins[:<span class="hljs-number">-1</span>], r, width = <span class="hljs-number">5</span>, color=<span class="hljs-string">'red'</span>,alpha=<span class="hljs-number">0.7</span>)<font></font>
    ax_g.bar(bins[:<span class="hljs-number">-1</span>], g, width = <span class="hljs-number">5</span>, color=<span class="hljs-string">'green'</span>,alpha=<span class="hljs-number">0.7</span>)<font></font>
    ax_b.bar(bins[:<span class="hljs-number">-1</span>], b, width = <span class="hljs-number">5</span>, color=<span class="hljs-string">'blue'</span>,alpha=<span class="hljs-number">0.7</span>)<font></font>
<font></font>
    ax_r.axes.get_xaxis().set_ticks([])<font></font>
    ax_r.axes.get_yaxis().set_ticks([])<font></font>
    ax_g.axes.get_xaxis().set_ticks([])<font></font>
    ax_g.axes.get_yaxis().set_ticks([])<font></font>
    ax_b.axes.get_xaxis().set_ticks([])<font></font>
    ax_b.axes.get_yaxis().set_ticks([])<font></font>
    fig.suptitle(<span class="hljs-string">"{} - {}"</span>.format(paintings_links.iloc[img_index].artist_name, <font></font>
                                 paintings_links.iloc[img_index].picture_name),ha= <span class="hljs-string">"left"</span>)<font></font>
    <font></font>
    fig.set_figheight(height)<font></font>
    plt.axis(<span class="hljs-string">'tight'</span>)
    <span class="hljs-keyword">if</span> img.shape[<span class="hljs-number">0</span>] &lt; img.shape[<span class="hljs-number">1</span>]:<font></font>
        fig.set_figwidth(img.shape[<span class="hljs-number">1</span>] *height / img.shape[<span class="hljs-number">0</span>] *<span class="hljs-number">1.25</span>)
    <span class="hljs-keyword">else</span>:<font></font>
        fig.set_figwidth(img.shape[<span class="hljs-number">1</span>] *height / img.shape[<span class="hljs-number">0</span>] *<span class="hljs-number">1.5</span>)<font></font>
    plt.show()<font></font>
</code></pre><br>
</div>
                    </div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Examples of works:</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/yj/ac/bc/yjacbc51wte7lh07zahocnlozzi.png"><br>
<br>
<img src="https://habrastorage.org/webt/wp/yy/qp/wpyyqpcp92rc4bx1bpn-x5kmpyg.png"><br>
<br>
<img src="https://habrastorage.org/webt/a3/yi/ha/a3yihacuqjnukieinyqixfwjfbi.png"><br>
<br>
<img src="https://habrastorage.org/webt/pr/j2/xq/prj2xqxmdnulpfcsysnslhlrbyi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Having carefully looked at the histograms of different pictures, we can notice that their form is very specific and varies greatly from work to work. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this regard, we make the assumption that the histogram is a kind of cast of the picture, which allows it to be characterized to some extent.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First model</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We collect all the histograms into one large dataset and try to look for some ‚Äúanomalies‚Äù in it. </font><font style="vertical-align: inherit;">Fast, convenient and generally my favorite algorithm for such purposes is one class svm. </font><font style="vertical-align: inherit;">We will use its implementation from the sklearn library</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Source</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">#       ,       </span><font></font>
res = []<font></font>
error = []<font></font>
<span class="hljs-keyword">for</span> img_index <span class="hljs-keyword">in</span> tqdm(range(paintings_links.shape[<span class="hljs-number">0</span>])):
    <span class="hljs-keyword">try</span>:<font></font>
        bins, r, g, b = get_hist_data_by_index(img_index)<font></font>
        res.append(np.hstack([r,g,b]))<font></font>
    <span class="hljs-keyword">except</span>:<font></font>
        res.append(np.zeros(<span class="hljs-number">153</span>,))<font></font>
        error.append(img_index)<font></font>
        <font></font>
np_res = np.vstack(res)<font></font>
<span class="hljs-comment">#    </span>
pd.DataFrame(np_res).to_pickle(<span class="hljs-string">"histograms.pkl"</span>)<font></font>
histograms = pd.read_pickle(<span class="hljs-string">"histograms.pkl"</span>)
<span class="hljs-comment">#  .         .   10    </span>
one_class_svm = OneClassSVM(nu=<span class="hljs-number">10</span> / histograms.shape[<span class="hljs-number">0</span>], gamma=<span class="hljs-string">'auto'</span>)<font></font>
one_class_svm.fit(histograms[~histograms.index.isin(bad_images)])<font></font>
<span class="hljs-comment">#  </span><font></font>
svm_outliers = one_class_svm.predict(histograms)<font></font>
svm_outliers = np.array([<span class="hljs-number">1</span> <span class="hljs-keyword">if</span> label == <span class="hljs-number">-1</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> svm_outliers])
<span class="hljs-comment">#   </span>
uncommon_images = paintings_links[(svm_outliers ==<span class="hljs-number">1</span>) &amp; (~histograms.index.isin(bad_images))].index.values
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> uncommon_images:<font></font>
    plot_image_with_hist_by_index(i,<span class="hljs-number">4</span>)
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's see what anomalous we find in the bins of our gallery. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Work done in pencil: </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/im/ep/qu/imepquuzdn8ke0ew51sn6hn2ivc.png"><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Work in very dark colors: </font></font></b><br>
<img src="https://habrastorage.org/webt/lo/7d/a8/lo7da8nynv4qhglimt4bzweldry.png"><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lady in red: </font></font></b><br>
<img src="https://habrastorage.org/webt/rh/8s/jf/rh8sjfwuwvy7drjkvy3fdqycwkw.png"><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Something sketchy: </font></font></b><br>
<img src="https://habrastorage.org/webt/ep/eg/rw/epegrw0xehln4thu0fpqiwamxiu.png"><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Very dark portrait:</font></font></b><br>
<img src="https://habrastorage.org/webt/ny/-9/vj/ny-9vjxin4gszzsfb4paptnbjqm.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Search for similar jobs</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, our model finds something unusual, far from everything else. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But can we make a tool that will help find work similar in color? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now each picture is characterized by a vector of 153 values ‚Äã‚Äã(because when building the histogram, it hit 5 intensity units per bin, total 255/5 = 51 frequencies for each channel).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We can determine the ‚Äúdegree of similarity‚Äù by calculating the distances between the vectors of interest to us. </font><font style="vertical-align: inherit;">The Euclidean distance familiar from school here will pay a lot of attention to the length of the vector components, and we would like to pay more attention to the sets of shades that make up the picture. </font><font style="vertical-align: inherit;">Here we will find the cosine measure of distance widely used, for example, in text analysis problems. </font><font style="vertical-align: inherit;">Let's try to apply it for this task. </font><font style="vertical-align: inherit;">We take the implementation from the scipy library.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Source</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">#  ,        </span>
<span class="hljs-keyword">from</span> scipy <span class="hljs-keyword">import</span> spatial
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">find_closest</span>(<span class="hljs-params">target_id,n=<span class="hljs-number">5</span></span>):</span><font></font>
    distance_vector = np.apply_along_axis(spatial.distance.cosine,<font></font>
                        arr=histograms,<font></font>
                       axis=<span class="hljs-number">1</span>,<font></font>
                       v=histograms.values[target_id])<font></font>
    <span class="hljs-keyword">return</span> np.argsort(distance_vector)[:n]
</code></pre><br>
</div>
                    </div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's see what looks like Aivazovsky‚Äôs ‚ÄúNinth Wave‚Äù. </font></font></b><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Original: </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/td/fu/ch/tdfuchnecvcct86pylvewtdjge4.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Similar works: </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/29/vx/qf/29vxqf1kta5ltjx6s5-hjrypjai.png"><br>
<img src="https://habrastorage.org/webt/sz/df/yq/szdfyqii6l1u5xcdt9euoa_ox5e.png"><br>
<img src="https://habrastorage.org/webt/-n/ep/i8/-nepi8un8if2kireirtuebrrcqo.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What looks like Van Gogh's ‚ÄúFlowering Almonds‚Äù. </font></font></b><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Original: </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/az/uo/bt/azuobt-fygm4g4rebyllquelwei.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Similar works: </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/k-/ja/du/k-jaduimeo1mqfxizf2kjwrricy.png"><br>
<img src="https://habrastorage.org/webt/lr/oy/-g/lroy-g1ndcd2amrspvepvnpp1ui.png"><br>
<img src="https://habrastorage.org/webt/7k/eh/90/7keh90lya9xuhwjvksb1gaamzhw.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And what looks like an anomalous lady found earlier in red? </font></font></b><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Original: </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/rh/8s/jf/rh8sjfwuwvy7drjkvy3fdqycwkw.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Similar works:</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/o3/qd/qd/o3qdqddzr51pshyhebapl7qjk7w.png"><br>
<img src="https://habrastorage.org/webt/m2/5b/iq/m25biqtph5egli7uhnpreu8m8bk.png"><br>
<img src="https://habrastorage.org/webt/cc/rk/fl/ccrkfluoskwpjq-gs1mk9atx1w0.png"><br>
<img src="https://habrastorage.org/webt/we/nr/hz/wenrhzhwffmjh2qql4pmcpynvk4.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Color spaces</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Until that moment, we worked in the RGB color space. It is very convenient for understanding, but far from ideal for our tasks. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Look, for example, on the brink of the RGB color cube </font></font><br>
<br>
<img src="https://habrastorage.org/webt/or/q2/3s/orq23sn8jnhe9kkhnwnudwbeug0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With the naked eye you can see that there are large areas on the faces where our eyes do not see changes, and relatively small areas where our color perception changes very sharply. This non-linear perception prevents the machine from evaluating colors the way a person would. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fortunately, there are many color spaces, probably some will fit our tasks. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will choose our favorite color space by comparing its usefulness in solving a human problem. Let's, for example, calculate the artist by the contents of the canvas!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Take all the available color spaces from the opencv library, train xgboost on each, and see the metrics on the deferred selection.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Source</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># ,        </span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_hist_data_by_index_and_colorspace</span>(<span class="hljs-params">bgr_img, colorspace</span>):</span>
    bin_div = <span class="hljs-number">5</span><font></font>
    img_cvt = cv2.cvtColor(bgr_img, getattr(cv2, colorspace))<font></font>
    c1, bins =  np.histogram(img_cvt[:,:,<span class="hljs-number">0</span>], bins=<span class="hljs-number">255</span>//bin_div, range=(<span class="hljs-number">0</span>,<span class="hljs-number">255</span>), density=<span class="hljs-literal">True</span>)<font></font>
    c2 = np.histogram(img_cvt[:,:,<span class="hljs-number">1</span>], bins=<span class="hljs-number">255</span>//bin_div, range=(<span class="hljs-number">0</span>,<span class="hljs-number">255</span>), density=<span class="hljs-literal">True</span>)[<span class="hljs-number">0</span>]<font></font>
    c3 = np.histogram(img_cvt[:,:,<span class="hljs-number">2</span>], bins=<span class="hljs-number">255</span>//bin_div, range=(<span class="hljs-number">0</span>,<span class="hljs-number">255</span>), density=<span class="hljs-literal">True</span>)[<span class="hljs-number">0</span>]
    <span class="hljs-keyword">return</span> bins, c1, c2, c3
<span class="hljs-comment">#        </span><font></font>
all_res = {}<font></font>
all_errors = {}<font></font>
<span class="hljs-keyword">for</span> colorspace <span class="hljs-keyword">in</span> list_of_color_spaces:<font></font>
    all_res[colorspace] =[]<font></font>
    all_errors[colorspace] =[]<font></font>
<span class="hljs-keyword">for</span> img_index <span class="hljs-keyword">in</span> tqdm(range(paintings_links.shape[<span class="hljs-number">0</span>]) ):<font></font>
    <font></font>
    <span class="hljs-keyword">for</span> colorspace <span class="hljs-keyword">in</span> list_of_color_spaces:
        <span class="hljs-keyword">try</span>:<font></font>
            bgr_img = load_image_by_index(img_index)<font></font>
            bins, c1, c2, c3 = get_hist_data_by_index_and_colorspace(bgr_img, colorspace)<font></font>
            all_res[colorspace].append(np.hstack([c1, c2, c3]))<font></font>
        <span class="hljs-keyword">except</span>:<font></font>
            all_res[colorspace].append(np.zeros(<span class="hljs-number">153</span>,))<font></font>
            all_errors[colorspace].append(img_index)<font></font>
all_res_np = {}<font></font>
<span class="hljs-keyword">for</span> colorspace <span class="hljs-keyword">in</span> list_of_color_spaces:  <font></font>
    all_res_np[colorspace] = np.vstack(all_res[colorspace])<font></font>
res = []<font></font>
<span class="hljs-comment">#        </span>
<span class="hljs-keyword">for</span> colorspace <span class="hljs-keyword">in</span> tqdm(list_of_color_spaces):<font></font>
    temp_df = pd.DataFrame(all_res_np.get(colorspace))<font></font>
    temp_x_train =   temp_df[temp_df.index.isin(X_train.index.values)]<font></font>
    temp_x_test =   temp_df[temp_df.index.isin(X_test.index.values)]<font></font>
<font></font>
    xgb=XGBClassifier()<font></font>
    xgb.fit(temp_x_train, y_train)<font></font>
    current_res = classification_report(y_test, xgb.predict(temp_x_test), labels=<span class="hljs-literal">None</span>, target_names=<span class="hljs-literal">None</span>, output_dict=<span class="hljs-literal">True</span>).get(<span class="hljs-string">"macro avg"</span>)<font></font>
    current_res[<span class="hljs-string">"colorspace"</span>] = colorspace<font></font>
    res.append(current_res)<font></font>
pd.DataFrame(res).sort_values(by=<span class="hljs-string">"f1-score"</span>)
</code></pre><br>
</div>
                    </div><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">precision</font></font></b></th>
<th><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recall</font></font></b></th>
<th><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f1-score</font></font></b></th>
<th><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">colorspace</font></font></b></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.001329</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.003663</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.001059</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COLOR_BGR2YUV</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.003229</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.004689</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.001849</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COLOR_BGR2RGB</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.003026</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.004131</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.001868</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COLOR_BGR2HSV</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.002909</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.004578</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.001934</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COLOR_BGR2XYZ</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.003545</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.004434</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.001941</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COLOR_BGR2HLS</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.003922</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.004784</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.002098</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COLOR_BGR2LAB</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.005118</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.004836</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.002434</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COLOR_BGR2LUV</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A tangible increase in quality was given by the use of the LUV color space. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The creators of this scale tried to make the perception of color changes along the axis of the scale as uniform as possible. </font><font style="vertical-align: inherit;">Thanks to this, the perceived color change and its mathematical evaluation will be as close as possible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is how a slice of a given color space looks like when fixing one of the axes:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/62/_a/xy/62_axyknj2mifko-ust0y7sppf0.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's look at the model</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After the previous step, we still have a model that can predict something. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's see whose work we learn most accurately.</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">precision</font></font></b></th>
<th><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recall</font></font></b></th>
<th><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f1-score</font></font></b></th>
<th><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artist</font></font></b></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.042553</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.019417</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.026667</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ilya Efimovich Repin</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.055556</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.020000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.029412</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">William Merrit Chase</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.071429</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.022222</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.033898</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonnard pierre</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.035461</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.035211</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.035336</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jill elvgren</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.100000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.021739</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.035714</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jean Auguste Dominic Ingres</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.022814</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.224066</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.041411</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pierre Auguste Renoir</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.100000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.028571</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.044444</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Albert Bierstadt</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.250000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.032258</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.057143</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hans Zatska</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.030396</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.518797</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.057428</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Claude Oscar Monet</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.250000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.037037</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.064516</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Girotto walter</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metrics themselves are far from ideal, but you need to remember that the color scheme is a small fraction of the information about the work. </font><font style="vertical-align: inherit;">The artist uses many expressive means. </font><font style="vertical-align: inherit;">The fact that we found in this data a certain ‚Äúhandwriting‚Äù of the artist is already a victory. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will choose one of the artists for a deeper analysis. </font><font style="vertical-align: inherit;">Let it be Claude Oscar Monet (I will make my wife nice, she likes the impressionists). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's take his work, ask the model to tell us the author and calculate the frequencies</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Predicted author</font></font></b></th>
<th><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Number of predictions</font></font></b></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Claude Oscar Monet</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">186</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pierre Auguste Renoir</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">171</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vincent Van Gogh</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">25</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peter Paul Rubens</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nineteen</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gustave Dore</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Many people tend to confuse Monet and Manet, and our model prefers to confuse him with Renoir and Van Gogh. Let's see what, according to the model, is similar to Van Gogh. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/u2/ft/la/u2ftlay3hv5v0quac6zbacyvgjc.png"><br>
<img src="https://habrastorage.org/webt/t-/fz/0h/t-fz0hh74hxcopgjzpbyvi69b3c.png"><br>
<img src="https://habrastorage.org/webt/sx/zq/y7/sxzqy7ofzv-gem6a2s2akx1d2j4.png"><br>
<img src="https://habrastorage.org/webt/gz/c3/p1/gzc3p1g2gycyqmnnqdo6uyjga2a.png"><br>
<img src="https://habrastorage.org/webt/wi/s8/ql/wis8ql7ko3batjx-n6e6jcfhvic.png"><br>
<img src="https://habrastorage.org/webt/k9/pw/dy/k9pwdynhkux1h0mma8jvu2iaxpg.png"><br>
<img src="https://habrastorage.org/webt/mm/qy/qk/mmqyqkpc-54ki_kqcg8gcvleqaw.png"><br>
<img src="https://habrastorage.org/webt/_w/yp/t9/_wypt9veh0hed6vnnbkpb4ltswg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And now we‚Äôll use our search function for similar works and find Van Gogh‚Äôs paintings similar to the above-mentioned works (this time we will measure distances in the LUV space). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Original: </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/2_/mx/0q/2_mx0q2-ue0e7hetq9bdcgxdwl4.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Similar work: </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/hd/fj/yk/hdfjykmlx07stpuy48x_4rsr6mg.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Original: </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/fm/4p/e3/fm4pe3g6bugjsa2neslxe4rrhye.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Similar works: </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/jl/j0/2u/jlj02uoglr1zhbe3dwhnpqmay2i.png"><br>
<img src="https://habrastorage.org/webt/v9/bo/vp/v9bovpvyl32t8cyl4zwszu59ali.png"><br>
<img src="https://habrastorage.org/webt/1w/km/dn/1wkmdn6vlpbbm30he8ogrmwgfn0.png"><br>
<img src="https://habrastorage.org/webt/ih/93/hu/ih93huxi9z6rg2l3hcla3npqucw.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Original: </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/4g/ub/qy/4gubqydk1tjocx0zotewdjhfphq.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Similar works:</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/h9/bt/nr/h9btnr9g4lsrbfsn5xfgaf7ogxm.png"><br>
<img src="https://habrastorage.org/webt/zz/vc/mv/zzvcmv1cg8cnq3zzycuin33yo5m.png"><br>
<img src="https://habrastorage.org/webt/fe/o7/mh/feo7mhenbz3x-ws_s22r2diwaai.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Satisfied with myself, I showed the results to a friend and found out that the histogram approach is actually quite rude, since it does not analyze the distribution of the color itself, but of its components separately. </font><font style="vertical-align: inherit;">In addition, it is not so much the frequency of the colors that are important as their composition. </font><font style="vertical-align: inherit;">It turned out that contemporary artists have proven approaches to the choice of color schemes. </font><font style="vertical-align: inherit;">So I found out about Johannes Itten and his color wheel.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Itten's color wheel</font></font></h2><br>
<img src="https://habrastorage.org/webt/na/pp/n0/nappn0jkkajcnv1aau52ore1j9y.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Johannes Itten is an artist, art theorist and teacher, author of famous books on form and color. </font><font style="vertical-align: inherit;">The color wheel is one of the most well-known tools that helps to combine colors so as to please the eye. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We illustrate the most popular color selection methods:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/y1/p8/dj/y1p8djuogkryt2cwcixurj5msni.png"><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Complementary colors - located on opposite parts of the circle</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adjacent colors - adjacent to the circle</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Classical Triad - Colors at the Tops of an Equilateral Triangle</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contrast Triad - Colors at the Tops of an Isosceles Triangle</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rectangle Rule - Colors at the vertices of the rectangle</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rule of the square - colors on the tops of the square</font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We analyze as artists</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's try to put into practice the acquired knowledge. </font><font style="vertical-align: inherit;">To get started, we get an array of colors lying on the color wheel, recognizing them from the picture. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r8/cj/t1/r8cjt1cwf_shz1x2mu7ygzulcba.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we can compare in pairs each pixel of our paintings with an array of Itten circle colors. </font><font style="vertical-align: inherit;">We replace the original pixel with the nearest one in the color wheel and calculate the frequency of the colors in the resulting image</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Source</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">#          </span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_composition_analysis</span>(<span class="hljs-params">image_index</span>):</span><font></font>
    img = load_image_by_index(image_index)<font></font>
    luv_img = cv2.cvtColor(load_image_by_index(image_index), cv2.COLOR_BGR2LUV)<font></font>
    closest_colors = np.argmin(euclidean_distances(luv_img.reshape(<span class="hljs-number">-1</span>,<span class="hljs-number">3</span>),wheel_colors_luv),axis=<span class="hljs-number">1</span>)<font></font>
    wheel_colors2[closest_colors].reshape(luv_img.shape)<font></font>
    color_areas_img = wheel_colors2[closest_colors].reshape(img.shape)<font></font>
<font></font>
    v, c = get_image_colors(image_index)<font></font>
    <span class="hljs-comment">#         </span>
    c_int = (c*img.shape[<span class="hljs-number">1</span>]).astype(int)<font></font>
    c_int_delta = img.shape[<span class="hljs-number">1</span>] - sum(c_int)<font></font>
    c_int[np.argmax(c_int)] = c_int[np.argmax(c_int)] + c_int_delta<font></font>
<font></font>
    _ = []<font></font>
<font></font>
    <span class="hljs-keyword">for</span> i, vi <span class="hljs-keyword">in</span> enumerate(v):<font></font>
        bar_width = c_int[i]<font></font>
        _.append(np.tile(wheel_colors2[vi], (<span class="hljs-number">150</span>,bar_width,<span class="hljs-number">1</span>)))<font></font>
    color_bar_img = np.hstack(_)<font></font>
    final_image = np.hstack([<font></font>
                                np.vstack([img,<font></font>
                                           np.tile(np.array([<span class="hljs-number">254</span>,<span class="hljs-number">254</span>,<span class="hljs-number">254</span>]),(<span class="hljs-number">160</span>,img.shape[<span class="hljs-number">1</span>],<span class="hljs-number">1</span>))]),<font></font>
<font></font>
                                np.tile(np.array([<span class="hljs-number">254</span>,<span class="hljs-number">254</span>,<span class="hljs-number">254</span>]),(img.shape[<span class="hljs-number">0</span>]+<span class="hljs-number">160</span>,<span class="hljs-number">10</span>,<span class="hljs-number">1</span>)),<font></font>
                                np.vstack([color_areas_img,<font></font>
                                           np.tile(np.array([<span class="hljs-number">254</span>,<span class="hljs-number">254</span>,<span class="hljs-number">254</span>]),(<span class="hljs-number">10</span>,img.shape[<span class="hljs-number">1</span>],<span class="hljs-number">1</span>)),<font></font>
                                           color_bar_img])<font></font>
                            ])<font></font>
    h = <span class="hljs-number">12</span>
    w = h / final_image.shape[<span class="hljs-number">1</span>] * final_image.shape[<span class="hljs-number">0</span>]<font></font>
    fig = plt.figure(figsize=(h,w))<font></font>
    plt.imshow(cv2.cvtColor(final_image.astype(np.uint8), cv2.COLOR_BGR2RGB),interpolation=<span class="hljs-string">'nearest'</span>, aspect=<span class="hljs-string">'auto'</span>)<font></font>
    plt.title(<span class="hljs-string">"{} - {}"</span>.format(paintings_links.iloc[image_index].artist_name, <font></font>
                             paintings_links.iloc[image_index].picture_name),ha= <span class="hljs-string">"center"</span>)<font></font>
    plt.axis(<span class="hljs-string">'off'</span>);
</code></pre><br>
</div>
                    </div><br>
<img src="https://habrastorage.org/webt/fp/2p/ma/fp2pmaailir_ye0jt1clgagjtvm.png"><br>
<br>
<img src="https://habrastorage.org/webt/c1/4l/ar/c14lar4pb5c0kfksw_7lxvmnmpk.png"><br>
<br>
<img src="https://habrastorage.org/webt/e5/j1/hu/e5j1huw7dyq6pyoou9nqjzkoss4.png"><br>
<br>
<img src="https://habrastorage.org/webt/db/7f/v0/db7fv0-8gzyuipjaqvberc1mr0s.png"><br>
<br>
<img src="https://habrastorage.org/webt/jj/3q/ui/jj3quitp7yk5grj6xrktbb4ic7q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Have you noticed how ‚ÄúYoung Arlesian‚Äù has changed little after our transformation? Perhaps it‚Äôs worth measuring not only the frequencies of new colors, but also statistics on conversion errors - this can help us in the analysis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But this is not enough for the present analysis. Let's look for harmonious combinations in a circle? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All complementary pairs: </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/lo/9q/t4/lo9qt47hkn0-ghxlp1zqhqyzee4.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All classical triads: </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/h-/al/sb/h-alsbdg3ieqzjtbrhal_n8oun0.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And all squares:</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/mv/xm/7v/mvxm7v3-gdy8yv-nqab2zgvhycm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
We will look for these combinations in our paintings, find the most significant (in frequency) and </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
see what happens. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To start the pair: </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/na/xj/hz/naxjhz31yyujq1zwbvkhzhoqfsk.png"><br>
<br>
<img src="https://habrastorage.org/webt/f4/-r/kg/f4-rkgkuzsvl_zgu9kmzb3ouccq.png"><br>
<br>
<img src="https://habrastorage.org/webt/fe/89/z3/fe89z35byjb4wrvemxqyfs9wdby.png"><br>
<br>
<img src="https://habrastorage.org/webt/ao/1h/te/ao1htez9nac4krnoxh0czm4xv_y.png"><br>
<br>
<img src="https://habrastorage.org/webt/cn/bp/-h/cnbp-h85tasbu2-_tpqmf2tbmle.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Then the triads: </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/qb/ei/vj/qbeivjrfg4ychewj5m4a2ooazsc.png"><br>
<br>
<img src="https://habrastorage.org/webt/kn/mb/np/knmbnpnuqujjzo3xp-utw5b7n8w.png"><br>
<br>
<img src="https://habrastorage.org/webt/fw/ak/g9/fwakg96zbki7kyynnh0fcphxyug.png"><br>
<br>
<img src="https://habrastorage.org/webt/s6/ol/n7/s6oln7t05tlrf3ad3xm7m0zyw84.png"><br>
<br>
<img src="https://habrastorage.org/webt/i-/9n/or/i-9norvbf3gp8i4jyhqrkklks10.png"><br>
<br>
<img src="https://habrastorage.org/webt/q5/nt/8b/q5nt8by4_qtewnooas-lqfzarfc.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And, finally, the squares:</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/10/_y/0c/10_y0cwv4uw4-bua9bbsy3kmnfa.png"><br>
<br>
<img src="https://habrastorage.org/webt/sz/rc/3q/szrc3qvqb8d4vaewweorjotm2ds.png"><br>
<br>
<img src="https://habrastorage.org/webt/0h/vh/0x/0hvh0xpslvtkkva_xk_1xwb9zqc.png"><br>
<br>
<img src="https://habrastorage.org/webt/uj/4l/_d/uj4l_d5fwzhgnrd_zjcqy4raxmu.png"><br>
<br>
<img src="https://habrastorage.org/webt/bv/q9/ls/bvq9lsyij7yfgg36aul1sg1srdc.png"><br>
<br>
<img src="https://habrastorage.org/webt/m2/rw/yq/m2rwyqruadciqfaf6su5jeji78i.png"><br>
<br>
<img src="https://habrastorage.org/webt/s_/pv/gk/s_pvgkbr9-jp2zp-egznee0ndpc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Not bad by eye, but will the new metrics help determine the author of the work?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will train the model using only Itten's color frequencies, error characteristics and harmonious combinations found. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This time, the list of the most ‚Äúpredictable‚Äù artists has changed a bit, which means that a different approach to analysis allowed us to extract some more information from the contents of the picture.</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">precision</font></font></b></th>
<th><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recall</font></font></b></th>
<th><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f1-score</font></font></b></th>
<th><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artist</font></font></b></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.043478</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.012195</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.019048</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Martin, Henri-Jean-Guillaume</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.032680</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.029070</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.030769</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Camille Pissarro</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.166667</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.019608</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.035088</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jean-Leon Jerome</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.076923</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.027778</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.040816</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Turner, Joseph Mallord William</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.133333</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.024390</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.041237</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Poortvliet, Rien</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.100000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.026316</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.041667</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Max Klinger</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.026725</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.228216</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.047847</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pierre Auguste Renoir</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.200000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.028571</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.050000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Brasilier, Andre</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.028745</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.639098</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.055016</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Claude Oscar Monet</font></font></td>
</tr>
</tbody></table></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Works of art are unique. </font><font style="vertical-align: inherit;">Artists use many compositional techniques that make us admire their work again and again. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The color scheme is an important, but far from the only component in the analysis of artists' works. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Many real art critics will laugh at the naivety of the analysis, but still I was satisfied with the work done. </font><font style="vertical-align: inherit;">There are several more ideas that have not yet reached the hands of:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apply clustering algorithms to the analysis of artists' color schemes. </font><font style="vertical-align: inherit;">Surely we could highlight interesting groups there, distinguish between various trends in painting</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apply clustering algorithms to individual paintings. </font><font style="vertical-align: inherit;">Search for ‚Äúplots‚Äù that can be identified by color scheme. </font><font style="vertical-align: inherit;">For example, in different clusters get landscapes, portraits and still lifes</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Search not only pairs, triples and squares, but also other combinations from Itten's circle</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Move from frequency analysis to color spot analysis by grouping pixels by location</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Find works in which authorship is in doubt and see who the model will vote for</font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This article was originally a graduation project for a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">machine learning course</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but several people recommended turning it into material for Habr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I hope you were interested. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All the code used in the work is available on </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en504792/index.html">Duty boarding house. How NSPK saved its duty room from a coronavirus</a></li>
<li><a href="../en504796/index.html">Udalenka is cool. Maybe stay forever?</a></li>
<li><a href="../en504798/index.html">Artificial Intelligence Watch Complaints</a></li>
<li><a href="../en504800/index.html">dracut + systemd + LUKS + usbflash = auto unlock</a></li>
<li><a href="../en504804/index.html">Something that integrates chicken leg and iPhone 11</a></li>
<li><a href="../en504808/index.html">Hammock Driven Development - Rich Hickey (with Russian translation)</a></li>
<li><a href="../en504812/index.html">Instacart Human Delivery Price</a></li>
<li><a href="../en504818/index.html">I released a word processor formatting the hard drive after every 1024th save</a></li>
<li><a href="../en504822/index.html">What is the difference between ‚Äúapproved by the FDA‚Äù and ‚Äúapproved by the FDA‚Äù</a></li>
<li><a href="../en504828/index.html">JUG Ru Group # 4 Online Stream Week</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>