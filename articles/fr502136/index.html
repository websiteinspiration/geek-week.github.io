<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòÑ üè¥Û†ÅßÛ†Å¢Û†Å∑Û†Å¨Û†Å≥Û†Åø ‚úãüèø Compression des donn√©es dans Apache Ignite. Exp√©rience Sberbank üßùüèø üöù üë®üèæ‚Äçüç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lorsque vous travaillez avec de gros volumes de donn√©es, le probl√®me d'espace disque insuffisant peut parfois devenir aigu. Une fa√ßon de r√©soudre ce p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Compression des donn√©es dans Apache Ignite. Exp√©rience Sberbank</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sberbank/blog/502136/"><img src="https://habrastorage.org/webt/cl/nj/sz/clnjsz90dmzkkj3wr4vuusu_-nu.png" align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque vous travaillez avec de gros volumes de donn√©es, le probl√®me d'espace disque insuffisant peut parfois devenir aigu. </font><font style="vertical-align: inherit;">Une fa√ßon de r√©soudre ce probl√®me est la compression, gr√¢ce √† laquelle, sur le m√™me √©quipement, vous pouvez vous permettre d'augmenter les volumes de stockage. </font><font style="vertical-align: inherit;">Dans cet article, nous verrons comment fonctionne la compression de donn√©es dans Apache Ignite. </font><font style="vertical-align: inherit;">Cet article d√©crit uniquement les m√©thodes de compression de disque impl√©ment√©es dans le produit. </font><font style="vertical-align: inherit;">Les autres m√©thodes de compression de donn√©es (sur le r√©seau, en m√©moire), impl√©ment√©es ou non, resteront hors de port√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, lorsque le mode de persistance est activ√©, √† la suite de la modification des donn√©es dans les caches, Ignite commence √† √©crire sur le disque:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenu du cache</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âcrire le journal √† l'avance (ci-apr√®s d√©nomm√© WAL)</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un m√©canisme appel√© compactage WAL existe depuis longtemps pour compresser les WAL. </font><font style="vertical-align: inherit;">Apache Ignite 2.8, r√©cemment publi√©, a introduit deux autres m√©canismes de compression des donn√©es sur le disque: la compression de page de disque pour compresser le contenu des caches et la compression de capture d'√©cran de page WAL pour compresser certains enregistrements WAL. </font><font style="vertical-align: inherit;">Plus d'informations sur ces trois m√©canismes ci-dessous.</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compression de page de disque</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment √ßa fonctionne</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer, nous nous attarderons tr√®s bri√®vement sur la fa√ßon dont Ignite stocke les donn√©es. Pour le stockage, la m√©moire de page est utilis√©e. La taille de la page est d√©finie au d√©but du n≈ìud et ne peut pas √™tre modifi√©e ult√©rieurement, la taille de la page doit √©galement √™tre une puissance de deux et un multiple de la taille du bloc du syst√®me de fichiers. Les pages sont charg√©es dans la RAM √† partir du disque selon les besoins, la taille des donn√©es sur le disque peut d√©passer la quantit√© de RAM allou√©e. S'il n'y a pas assez d'espace dans la RAM pour charger les pages du disque, les anciennes pages inutilis√©es seront forc√©es de quitter la RAM.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les donn√©es sont stock√©es sur disque sous la forme suivante: un fichier s√©par√© est cr√©√© pour chaque partition de chaque groupe de cache, dans ce fichier, dans l'ordre croissant de l'index, les pages vont les unes apr√®s les autres. L'identifiant de page compl√®te contient l'identifiant du groupe de cache, le num√©ro de partition et l'index de page dans le fichier. Ainsi, gr√¢ce √† l'identifiant de page complet, nous pouvons identifier de mani√®re unique le fichier et le d√©calage dans le fichier pour chaque page. Vous pouvez en savoir plus sur la m√©moire des pages dans un article sur le wiki Apache Ignite: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ignite Persistent Store - sous le capot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le m√©canisme de compression des pages du disque, comme son nom l'indique, fonctionne au niveau de la page. </font><font style="vertical-align: inherit;">Lorsque ce m√©canisme est activ√©, le travail avec les donn√©es en RAM est effectu√© tel quel, sans aucune compression, mais au moment de l'enregistrement des pages de la RAM sur le disque, elles sont compress√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais pour compresser chaque page individuellement n'est pas une solution au probl√®me, vous devez en quelque sorte r√©duire la taille des fichiers de donn√©es r√©sultants. </font><font style="vertical-align: inherit;">Si la taille de la page cesse d'√™tre fix√©e, nous ne pouvons plus √©crire les pages dans un fichier un par un, car cela peut entra√Æner un certain nombre de probl√®mes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous ne pouvons pas utiliser l'index de page pour calculer le d√©calage auquel il se trouve dans le fichier.</font></font></li>
<li> ,    ,          .    ,     .    ,         .</li>
<li>           ,      ,        ,      .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin de ne pas r√©soudre ces probl√®mes √† son propre niveau, la compression de page de disque dans Apache Ignite utilise un m√©canisme de syst√®me de fichiers appel√© fichiers clairsem√©s. Un fichier clairsem√© est un fichier dans lequel certaines r√©gions remplies de z√©ros peuvent √™tre marqu√©es comme des trous. Dans ce cas, les blocs du syst√®me de fichiers pour stocker ces trous ne seront pas allou√©s, ce qui permettra d'√©conomiser de l'espace disque.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est logique que pour lib√©rer le bloc du syst√®me de fichiers, la taille du trou doit √™tre sup√©rieure ou √©gale au bloc du syst√®me de fichiers, ce qui impose une restriction suppl√©mentaire sur la taille de la page d'Apache Ignite: pour que la compression donne au moins un certain effet, la taille de la page doit √™tre strictement sup√©rieure √† la taille du bloc du syst√®me de fichiers . Si la taille de la page est √©gale √† la taille du bloc, nous ne pourrons jamais lib√©rer un seul bloc, car pour lib√©rer un seul bloc, nous avons besoin d'une page compress√©e pour occuper 0 octets. Si la taille de la page est √©gale √† la taille de 2 ou 4 blocs, nous pouvons d√©j√† lib√©rer au moins un bloc si notre page est compress√©e √† au moins 50% ou 75%, respectivement.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, la description finale du m√©canisme: Lors de l'√©criture d'une page sur le disque, une tentative est faite pour compresser la page. Si la taille de la page compress√©e permet de lib√©rer un ou plusieurs blocs du syst√®me de fichiers, la page est √©crite sous forme compress√©e, un ¬´trou¬ª est perfor√© √† la place des blocs lib√©r√©s (un appel syst√®me </font></font><code>fallocate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec l'indicateur ¬´trou de perforation¬ª est effectu√©). Si la taille de la page compress√©e ne permet pas de lib√©rer des blocs, la page est enregistr√©e telle quelle, sous forme non compress√©e. Tous les d√©calages de page sont pris en compte ainsi que sans compression, en multipliant l'index de page par la taille de la page. Aucune auto-relocalisation des pages n'est requise. Les d√©calages de page, ainsi que sans compression, tombent sur les limites des blocs du syst√®me de fichiers.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-l/0f/3x/-l0f3xzxozvrxefbiauxdivslv0.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'impl√©mentation actuelle, Ignite ne peut fonctionner qu'avec des fichiers √©pars sous Linux OS, de sorte que la compression de page de disque ne peut √™tre activ√©e que lorsque Ignite est utilis√© sur ce syst√®me d'exploitation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algorithmes de compression pouvant √™tre utilis√©s pour la compression de page de disque: ZSTD, LZ4, Snappy. </font><font style="vertical-align: inherit;">De plus, il existe un mode de fonctionnement (SKIP_GARBAGE), dans lequel seule une place inutilis√©e dans la page est supprim√©e sans appliquer de compression aux donn√©es restantes, ce qui permet de r√©duire la charge sur le CPU par rapport aux algorithmes r√©pertori√©s ci-dessus.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Impact sur les performances </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malheureusement, je n'ai pas r√©ellement mesur√© les performances sur des stands r√©els, car nous ne pr√©voyons pas d'utiliser ce m√©canisme en production, mais th√©oriquement, nous pouvons sp√©culer o√π nous perdrons et o√π nous gagnerons. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ce faire, nous devons nous rappeler comment lire et √©crire des pages lors de leur acc√®s:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsqu'une op√©ration de lecture est effectu√©e, elle est d'abord recherch√©e dans la RAM, si la recherche √©choue, la page est charg√©e dans la RAM √† partir du disque avec le m√™me flux qui lit.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque vous effectuez une op√©ration d'√©criture, la page en RAM est marqu√©e comme sale, tandis que l'enregistrement physique de la page sur le disque imm√©diatement dans le flux en cours d'enregistrement ne se produit pas. </font><font style="vertical-align: inherit;">Toutes les pages sales sont enregistr√©es sur le disque plus tard dans le processus de point de contr√¥le dans des flux s√©par√©s.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, l'effet sur les op√©rations de lecture:</font></font><br>
<br>
<ul>
<li> (disk IO),        .</li>
<li> (CPU),           sparse .       IO       sparse  (    sparse  ,  ,  ).</li>
<li> (CPU),     .</li>
<li>    .</li>
<li>    (    ):</li>
<li> (disk IO),        .</li>
<li> (CPU,  disk IO),     sparse .</li>
<li> (CPU),     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelle √©chelle l'emportera? </font><font style="vertical-align: inherit;">Tout d√©pend beaucoup de l'environnement, mais je suis port√© √† croire que la compression des pages du disque est plus susceptible de d√©grader les performances sur la plupart des syst√®mes. </font><font style="vertical-align: inherit;">De plus, les tests sur d'autres SGBD utilisant une approche similaire avec des fichiers clairsem√©s montrent une baisse des performances lorsque la compression est activ√©e.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment activer et configurer</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme mentionn√© ci-dessus, la version minimale d'Apache Ignite qui prend en charge la compression de page de disque: 2.8 et ne prend en charge que le syst√®me d'exploitation Linux. </font><font style="vertical-align: inherit;">La mise en marche et le r√©glage s'effectuent comme suit:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le chemin d'acc√®s aux classes doit avoir un module d'allumage-compression. </font><font style="vertical-align: inherit;">Par d√©faut, il se trouve dans la distribution Apache Ignite dans le r√©pertoire libs / optional et n'est pas inclus dans le chemin d'acc√®s aux classes. </font><font style="vertical-align: inherit;">Vous pouvez simplement d√©placer le r√©pertoire d'un niveau vers les biblioth√®ques, puis lorsqu'il est lanc√© via ignite.sh, il sera automatiquement activ√©.</font></font></li>
<li>Persistence    (  <code>DataRegionConfiguration.setPersistenceEnabled(true))</code>.</li>
<li>         (    <code>DataStorageConfiguration.setPageSize()</code> ).</li>
<li>  ,            ()   ( <code>CacheConfiguration.setDiskPageCompression() , CacheConfiguration.setDiskPageCompressionLevel()</code>).</li>
</ul><br>
<h3>WAL compaction</h3><br>
<h4>  </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qu'est-ce que le WAL et pourquoi est-il n√©cessaire? Tr√®s bri√®vement: il s'agit d'un journal dans lequel tous les √©v√©nements qui changent √† la suite du r√©f√©rentiel de pages tombent. Il est recherch√© principalement pour la possibilit√© de r√©cup√©ration en cas de chute. Avant de transf√©rer le contr√¥le √† un utilisateur, toute op√©ration doit d'abord √©crire l'√©v√©nement dans le WAL, afin qu'en cas de chute, il puisse lire le journal et restaurer toutes les op√©rations pour lesquelles l'utilisateur a re√ßu une r√©ponse r√©ussie, m√™me si ces op√©rations n'ont pas eu le temps de se refl√©ter dans le stockage de page sur le disque (ci-dessus d√©j√† il a √©t√© d√©crit que l'√©criture proprement dite dans le stockage de page est effectu√©e dans un processus appel√© ¬´point de contr√¥le¬ª avec un certain retard dans des threads s√©par√©s).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les entr√©es dans le WAL sont divis√©es en logiques et physiques. Les logiques sont des cl√©s et des valeurs elles-m√™mes. Physique - refl√®te les changements de page dans le magasin de pages. Si les enregistrements logiques peuvent √™tre utiles dans certains autres cas, les enregistrements physiques ne sont n√©cessaires que pour la r√©cup√©ration en cas de chute et les enregistrements ne sont n√©cessaires qu'√† partir du dernier point de contr√¥le r√©ussi. Ici, nous n'entrerons pas dans les d√©tails et n'expliquerons pas pourquoi cela fonctionne de cette mani√®re, mais toute personne int√©ress√©e peut se r√©f√©rer √† l'article d√©j√† mentionn√© sur le wiki Apache Ignite: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ignite Persistent Store - sous le capot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un enregistrement logique repr√©sente souvent plusieurs enregistrements physiques. C'est-√†-dire, par exemple, qu'une seule op√©ration de mise en cache affecte plusieurs pages en m√©moire de page (une page avec les donn√©es elles-m√™mes, des pages avec des index, des pages avec des listes libres). Sur certains tests synth√©tiques, il s'est av√©r√© que les enregistrements physiques occupaient jusqu'√† 90% du fichier WAL. De plus, ils ont besoin d'un temps tr√®s court (par d√©faut, l'intervalle entre les points de contr√¥le est de 3 minutes). Il serait logique de se d√©barrasser de ces donn√©es apr√®s avoir perdu leur pertinence. C'est exactement ce que le m√©canisme de compactage WAL effectue, supprime les enregistrements physiques et compresse les enregistrements logiques restants avec zip, tandis que la taille du fichier diminue de mani√®re tr√®s significative (parfois des dizaines de fois).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Physiquement, un WAL se compose de plusieurs segments (par d√©faut 10) de taille fixe (par d√©faut 64 Mo), qui sont √©cras√©s dans un cercle. </font><font style="vertical-align: inherit;">D√®s que le segment en cours est rempli, le segment suivant est affect√© au segment en cours et le segment rempli est copi√© dans l'archive dans un flux distinct. </font><font style="vertical-align: inherit;">Le compactage WAL fonctionne d√©j√† avec les segments d'archive. </font><font style="vertical-align: inherit;">De plus, dans un flux distinct, il surveille l'ex√©cution du point de contr√¥le et d√©marre la compression par segments d'archive, pour lesquels les enregistrements physiques ne sont plus n√©cessaires.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zk/95/jo/zk95jo7dnthiox2sv0ezywhrj2a.png"><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Impact sur les performances</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtant donn√© que le compactage WAL fonctionne comme un thread s√©par√©, il ne devrait pas y avoir d'influence directe sur les op√©rations effectu√©es. </font><font style="vertical-align: inherit;">Mais cela donne toujours une charge d'arri√®re-plan suppl√©mentaire sur le processeur (compression) et le disque (lecture de chaque segment WAL de l'archive et √©criture des segments compress√©s), donc si le syst√®me fonctionne √† la limite, cela entra√Ænera √©galement une d√©gradation des performances.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment activer et configurer</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez activer le compactage WAL √† l'aide de la propri√©t√© </font></font><code>WalCompactionEnabled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font><code>DataStorageConfiguration (DataStorageConfiguration.setWalCompactionEnabled(true)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">En outre, √† l'aide de la m√©thode DataStorageConfiguration.setWalCompactionLevel (), vous pouvez d√©finir le taux de compression si vous n'√™tes pas satisfait de la valeur par d√©faut (BEST_SPEED).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compression d'instantan√©s de page WAL</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment √ßa fonctionne</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons d√©j√† d√©couvert que dans WAL, les entr√©es sont divis√©es en logique et physique. Pour chaque changement de chaque page dans la m√©moire de page, un enregistrement WAL physique est g√©n√©r√©. Les enregistrements physiques, √† leur tour, sont √©galement divis√©s en 2 sous-esp√®ces: l'enregistrement d'instantan√© de page et l'enregistrement delta. Chaque fois que nous changeons quelque chose sur une page et le transf√©rons d'un √©tat propre √† un √©tat sale, une copie compl√®te de cette page est enregistr√©e dans le WAL (enregistrement d'instantan√© de page). M√™me si nous n'avons modifi√© qu'un octet dans le WAL, un enregistrement avec une taille l√©g√®rement sup√©rieure √† la taille de la page sera sauvegard√©. Si nous changeons quelque chose sur une page d√©j√† sale, alors un enregistrement delta est form√© dans le WAL, qui refl√®te uniquement les changements par rapport √† l'√©tat pr√©c√©dent de la page, mais pas la page enti√®re. √âtant donn√© que la r√©initialisation de l'√©tat des pages de sale √† propre est effectu√©e pendant le processus de point de contr√¥le,imm√©diatement apr√®s le d√©but du point de contr√¥le, presque tous les enregistrements physiques ne seront constitu√©s que d'instantan√©s de pages (puisque toutes les pages imm√©diatement apr√®s le d√©but du point de contr√¥le sont vides), puis √† l'approche du prochain point de contr√¥le, la proportion d'enregistrement delta commence √† augmenter et est r√©initialis√©e √† nouveau au d√©but du prochain point de contr√¥le. Les mesures de certains tests synth√©tiques ont montr√© que la part des instantan√©s de pages dans le volume total des enregistrements physiques atteint 90%.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'id√©e derri√®re la compression des instantan√©s de page WAL est de compresser les instantan√©s de page √† l'aide d'un outil de compression de page standard (voir compression de page de disque). Dans le m√™me temps, dans WAL, les enregistrements sont enregistr√©s s√©quentiellement en mode ajout uniquement et il n'est pas n√©cessaire de lier les enregistrements aux limites des blocs du syst√®me de fichiers.Par cons√©quent, contrairement au m√©canisme de compression de page de disque, nous n'avons absolument pas besoin de fichiers clairsem√©s, ce m√©canisme ne fonctionnera donc pas uniquement sur le syst√®me d'exploitation. Linux De plus, peu nous importe combien nous avons pu compresser la page. M√™me si nous avons lib√©r√© 1 octet, c'est d√©j√† un r√©sultat positif et nous pouvons enregistrer des donn√©es compress√©es dans le WAL, contrairement √† la compression de page de disque, o√π nous enregistrons une page compress√©e uniquement si plus d'un bloc de syst√®me de fichiers est lib√©r√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les pages sont des donn√©es bien compressibles, leur part dans le volume total WAL est tr√®s √©lev√©e, donc sans changer le format du fichier WAL, nous pouvons obtenir une r√©duction significative de sa taille. </font><font style="vertical-align: inherit;">La compression des enregistrements logiques, entre autres, n√©cessiterait un changement de format et une perte de compatibilit√©, par exemple, pour les consommateurs externes susceptibles d'√™tre int√©ress√©s par les enregistrements logiques, sans r√©duire consid√©rablement la taille du fichier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En ce qui concerne la compression de page de disque pour la compression d'instantan√©s de page WAL, les algorithmes de compression ZSTD, LZ4, Snappy, ainsi que le mode SKIP_GARBAGE peuvent √™tre utilis√©s.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Impact sur les performances</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'est pas difficile de remarquer que l'inclusion directe de la compression d'instantan√©s de page WAL affecte uniquement les flux qui √©crivent des donn√©es dans la m√©moire de la page, c'est-√†-dire les flux qui modifient les donn√©es dans les caches. La lecture des enregistrements physiques WAL n'a lieu qu'une seule fois, au moment de relever le n≈ìud apr√®s la chute (et uniquement en cas de chute au point de contr√¥le). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela affecte les flux de donn√©es comme suit: nous obtenons un effet n√©gatif (CPU) en raison de la n√©cessit√© de compresser la page √† chaque fois avant d'√©crire sur le disque et un effet positif (disque IO) en r√©duisant la quantit√© de donn√©es en cours d'√©criture. En cons√©quence, tout est simple ici, si les performances du syst√®me d√©pendent du CPU, nous obtenons une petite d√©gradation, si dans les E / S disque, nous obtenons une augmentation.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Indirectement, la r√©duction de la taille des WAL affecte √©galement (positivement) les flux qui d√©posent des segments WAL dans l'archive et les flux de compactage WAL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De vrais tests de performances dans notre environnement sur des donn√©es synth√©tiques ont montr√© une l√©g√®re augmentation (d√©bit augment√© de 10% -15%, latence diminu√©e de 10% -15%).</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment activer et configurer</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La version minimale d'Apache Ignite est 2.8. </font><font style="vertical-align: inherit;">La mise en marche et le r√©glage s'effectuent comme suit:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le chemin d'acc√®s aux classes doit avoir un module d'allumage-compression. </font><font style="vertical-align: inherit;">Par d√©faut, il se trouve dans la distribution Apache Ignite dans le r√©pertoire libs / optional et n'est pas inclus dans le chemin d'acc√®s aux classes. </font><font style="vertical-align: inherit;">Vous pouvez simplement d√©placer le r√©pertoire d'un niveau vers les biblioth√®ques, puis lorsqu'il est lanc√© via ignite.sh, il sera automatiquement activ√©.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La persistance doit √™tre activ√©e (activ√©e via </font></font><code>DataRegionConfiguration.setPersistenceEnabled(true)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font></li>
<li>        <code>DataStorageConfiguration.setWalPageCompression()</code>,     ( DISABLED).</li>
<li>        <code>DataStorageConfiguration.setWalPageCompression()</code>,         javadoc  .</li>
</ul><br>
<h3></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les m√©canismes de compression des donn√©es discut√©s dans Apache Ignite peuvent √™tre utilis√©s ind√©pendamment les uns des autres, mais toute combinaison d'entre eux est √©galement valide. </font><font style="vertical-align: inherit;">La compr√©hension des principes de leur travail d√©terminera comment ils s'int√®grent √† vos t√¢ches dans votre environnement et ce que vous devrez sacrifier lors de leur utilisation. </font><font style="vertical-align: inherit;">La compression de page du disque est con√ßue pour compresser le stockage principal et peut fournir une compression moyenne. </font><font style="vertical-align: inherit;">La compression d'instantan√©s de page WAL donnera un degr√© moyen de compression des fichiers d√©j√† WAL, alors qu'elle est m√™me susceptible d'am√©liorer les performances. </font><font style="vertical-align: inherit;">Le compactage WAL n'affectera pas positivement les performances, mais r√©duira la taille des fichiers WAL en supprimant les enregistrements physiques.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr502122/index.html">Thanos - Prom√©th√©e √©volutif</a></li>
<li><a href="../fr502124/index.html">R√©sultats 2019 du capital-risque pour l'Ukraine</a></li>
<li><a href="../fr502126/index.html">Comment am√©liorer votre CV de programmeur anglais</a></li>
<li><a href="../fr502132/index.html">Comment transf√©rer un conteneur OpenVZ 6 vers un serveur KVM sans maux de t√™te</a></li>
<li><a href="../fr502134/index.html">Assez pour avoir peur de belles d√©cisions subjectives dans le code - vous n'√™tes pas des robots</a></li>
<li><a href="../fr502146/index.html">Table ronde en ligne "Je veux jouer"</a></li>
<li><a href="../fr502148/index.html">Utilisation de composants tiers dans le stockage en utilisant Qsan comme exemple</a></li>
<li><a href="../fr502150/index.html">Faire √©voluer un r√©seau √† haute charge avec Nutanix: fonctionnalit√©s et d√©fis avec un bo√Ætier personnel</a></li>
<li><a href="../fr502154/index.html">R√©daction efficace des autotests - tests sous-cutan√©s</a></li>
<li><a href="../fr502156/index.html">Affaire Rambler c. NGINX: Table ronde sur les risques criminels li√©s √† la num√©risation 16 mai</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>