<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>❗️ ☝🏿 🙏🏽 Accélérer le frontend. Quand beaucoup de demandes de serveur sont bonnes 🤚🏻 👨‍👧‍👦 👩🏻‍🌾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article décrit certaines méthodes pour accélérer le chargement des applications frontales afin d'implémenter une interface utilisateur rapide et r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Accélérer le frontend. Quand beaucoup de demandes de serveur sont bonnes</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/490210/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cet article décrit certaines méthodes pour accélérer le chargement des applications frontales afin d'implémenter une interface utilisateur rapide et réactive. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous discuterons de l'architecture générale du frontend, comment précharger les ressources nécessaires et augmenter la probabilité qu'elles soient dans le cache. </font><font style="vertical-align: inherit;">Nous verrons un peu comment donner des ressources depuis le backend et quand il est possible de se limiter à des pages statiques au lieu d'une application cliente interactive. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le processus de téléchargement est divisé en trois étapes. </font><font style="vertical-align: inherit;">Pour chaque étape, nous formulons des stratégies générales pour augmenter la productivité:</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rendu initial</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : combien de temps faut-il à l'utilisateur pour voir au moins quelque chose</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Réduisez les demandes de blocage du rendu</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Évitez les chaînes séquentielles</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Réutiliser les connexions au serveur</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travailleurs de service pour le rendu instantané</font></font></li>
</ul></li>
<li><b> </b>:   ,     <br>
<ul>
<li>    .    .    <br>
</li>
<li>,        <br>
</li>
<li>       <br>
</li>
<li>     <br>
</li>
<li>    </li>
</ul></li>
<li><b> </b>:        <br>
<ul>
<li>    ,   <br>
</li>
<li>      </li>
</ul></li>
</ol><a name="habracut"></a><br>
<h1> </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jusqu'au rendu initial, l'utilisateur ne voit rien à l'écran. De quoi avons-nous besoin pour ce rendu? Au minimum, téléchargez un document HTML et, dans la plupart des cas, des ressources supplémentaires, telles que des fichiers CSS et JavaScript. Une fois qu'ils sont disponibles, le navigateur peut commencer une sorte de rendu. </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">Les</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
graphiques </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebPageTest</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sont fournis tout au long de cet article </font><font style="vertical-align: inherit;">. La séquence de requêtes pour votre site ressemblera probablement à ceci. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/36a/970/f6e/36a970f6e3069679776958e6e0ef10d8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le document HTML charge un tas de fichiers supplémentaires et la page est rendue après leur téléchargement. Veuillez noter que les fichiers CSS sont chargés en parallèle les uns aux autres, donc chaque demande supplémentaire n'ajoute pas de retard significatif. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Remarque: dans la capture d'écran, gov.uk est un exemple où </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">HTTP / 2 est</font></a><font style="vertical-align: inherit;"> maintenant </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">activé</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">afin que le domaine de ressources puisse réutiliser une connexion existante. </font><font style="vertical-align: inherit;">Voir ci-dessous pour les connexions au serveur.)</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Réduisez les demandes de blocage du rendu</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les feuilles de style et (par défaut) les scripts bloquent le rendu de tout contenu en dessous. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe plusieurs options pour résoudre ce problème:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Déplacez les balises de script au bas du corps </font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Téléchargez des scripts en mode asynchrone en utilisant </font></font><code>async</code><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si JS ou CSS doivent être chargés séquentiellement, il est préférable de les incorporer avec de petits extraits</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Évitez les conversations avec des requêtes séquentielles qui bloquent le rendu</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le retard dans le rendu du site n'est pas nécessairement associé à un grand nombre de requêtes qui bloquent le rendu. </font><font style="vertical-align: inherit;">Plus important est la taille de chaque ressource, ainsi que l'heure de début de son téléchargement. </font><font style="vertical-align: inherit;">Autrement dit, le moment où le navigateur se rend soudain compte que cette ressource doit être téléchargée. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si le navigateur détecte la nécessité de télécharger le fichier uniquement après avoir terminé une autre demande, il existe une chaîne de demandes. </font><font style="vertical-align: inherit;">Il peut se former pour diverses raisons:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Règles </font></font><code>@import</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSS</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Polices Web référencées par le fichier CSS</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Balises JavaScript ou script téléchargeables</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetez un œil à cet exemple: l' </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/ebe/a1b/e44/ebea1be44487e800d63034b7fb2e9b79.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
un des fichiers CSS de ce site charge la police Google via la règle </font></font><code>@import</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cela signifie que le navigateur doit exécuter à tour de rôle les requêtes suivantes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Document HTML</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Applications CSS</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSS pour les polices Google</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fichier Google Font Woff (non illustré dans le diagramme)</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour résoudre ce problème, déplacez d'abord la demande CSS Google Fonts de la balise </font></font><code>@import</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vers le lien dans le document HTML. </font><font style="vertical-align: inherit;">Nous raccourcissons donc la chaîne d'un maillon. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour accélérer encore plus les choses, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intégrez Google Fonts CSS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> directement dans votre fichier HTML ou CSS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Gardez à l'esprit que la réponse CSS du serveur Google Fonts dépend de la ligne d'agent utilisateur. Si vous faites une demande à l'aide d'IE8, le CSS fera référence au fichier EOT, le navigateur IE11 recevra le fichier woff et les navigateurs modernes recevront le fichier woff2. Si vous acceptez que les anciens navigateurs seront limités aux polices système, vous pouvez simplement copier et coller le contenu du fichier CSS pour vous-même).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Même après le début du rendu, il est peu probable que l'utilisateur puisse interagir avec la page, car la police doit être chargée pour afficher le texte. </font><font style="vertical-align: inherit;">Il s'agit d'un retard de réseau supplémentaire que j'aimerais éviter. </font><font style="vertical-align: inherit;">Le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">paramètre swap</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est utile ici </font><font style="vertical-align: inherit;">, il vous permet de l'utiliser </font></font><code>font-display</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec Google Fonts et de stocker des polices localement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parfois, la chaîne de requête ne peut pas être résolue. </font><font style="vertical-align: inherit;">Dans de tels cas, vous pouvez envisager </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la balise de précharge ou de préconnexion</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Par exemple, le site Web de l'exemple ci-dessus peut se connecter </font></font><code>fonts.googleapis.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avant l'arrivée de la demande CSS réelle.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Réutilisation des connexions serveur pour accélérer les demandes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour établir une nouvelle connexion au serveur, nécessite généralement trois échanges de paquets entre le navigateur et le serveur:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recherche DNS</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Établir une connexion TCP</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Établir une connexion SSL</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois la connexion établie, au moins un autre échange de paquets est requis pour envoyer une demande et recevoir une réponse. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le tableau ci - </font><font style="vertical-align: inherit;">dessous montre que nous initions une connexion avec quatre serveurs différents: </font></font><code>hostgator.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>optimizely.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>googletagmanager.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>googelapis.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les demandes de serveur suivantes peuvent réutiliser une connexion existante</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Le téléchargement </font></font><code>base.css</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soit </font></font><code>index1.css</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arrive plus vite parce qu'ils sont situés sur le même serveur </font></font><code>hostgator.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec lequel une connexion a déjà été établie.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/78d/f76/03c/78df7603c84c54788fbec82a7d0622c7.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Réduisez la taille des fichiers et utilisez CDN</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous contrôlez deux facteurs qui affectent le temps d'exécution de la requête: la taille des fichiers de ressources et l'emplacement des serveurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Envoyez le moins de données possible à l'utilisateur et assurez-vous qu'elles sont compressées (par exemple, en utilisant brotli ou gzip). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les réseaux de distribution de contenu (CDN) ont des serveurs partout dans le monde. </font><font style="vertical-align: inherit;">Au lieu de se connecter à un serveur central, un utilisateur peut se connecter à un serveur CDN plus proche. </font><font style="vertical-align: inherit;">Ainsi, l'échange de paquets sera beaucoup plus rapide. </font><font style="vertical-align: inherit;">Ceci est particulièrement adapté aux ressources statiques telles que CSS, JavaScript et les images, car elles sont faciles à distribuer via CDN.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Éliminez la latence du réseau avec les employés de service</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les techniciens de maintenance vous permettent d'intercepter les demandes avant de les envoyer au réseau. </font><font style="vertical-align: inherit;">Cela signifie que la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">réponse vient presque instantanément</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/c0c/5b2/7bd/c0c5b27bd4df5e42b3b8e57b2dfb02f2.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, cela ne fonctionne que si vous n'avez vraiment pas besoin de recevoir de données du réseau. </font><font style="vertical-align: inherit;">La réponse doit déjà être mise en cache, donc l'avantage n'apparaîtra qu'à partir du deuxième téléchargement d'application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'agent de service ci-dessous met en cache le code HTML et CSS nécessaire pour rendre la page. </font><font style="vertical-align: inherit;">Lorsque l'application se charge à nouveau, elle essaie d'émettre elle-même les ressources mises en cache - et accède au réseau uniquement si elles ne sont pas disponibles.</font></font><br>
<br>
<pre><code class="javascript hljs">self.addEventListener(<span class="hljs-string">"install"</span>, <span class="hljs-keyword">async</span> e =&gt; {<font></font>
 caches.open(<span class="hljs-string">"v1"</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cache</span>) </span>{
   <span class="hljs-keyword">return</span> cache.addAll([<span class="hljs-string">"/app"</span>, <span class="hljs-string">"/app.css"</span>]);<font></font>
 });<font></font>
});<font></font>
<font></font>
self.addEventListener(<span class="hljs-string">"fetch"</span>, event =&gt; {<font></font>
 event.respondWith(<font></font>
   caches.match(event.request).then(<span class="hljs-function"><span class="hljs-params">cachedResponse</span> =&gt;</span> {
     <span class="hljs-keyword">return</span> cachedResponse || fetch(event.request);<font></font>
   })<font></font>
 );<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ce guide,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> expliqué en détail sur l'utilisation des services pour précharger et mettre en cache les ressources.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Téléchargez l'application</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, l'utilisateur voit quelque chose à l'écran. </font><font style="vertical-align: inherit;">Quelles autres étapes sont nécessaires pour qu'il utilise l'application?</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Télécharger le code d'application (JS et CSS)</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Téléchargez les données requises pour la page</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Téléchargez des données et des images supplémentaires</font></font></li>
</ol><br>
<img src="https://habrastorage.org/getpro/habr/post_images/175/e7f/810/175e7f810d7e33f9647203ad609b402f.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veuillez noter que non seulement le téléchargement de données à partir du réseau peut retarder le rendu. </font><font style="vertical-align: inherit;">Une fois votre code chargé, le navigateur doit l'analyser, le compiler et l'exécuter.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Téléchargez uniquement le code nécessaire et maximisez le nombre de hits dans le cache</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
«Casser un package» signifie télécharger uniquement le code nécessaire pour la page en cours, pas l'application entière. </font><font style="vertical-align: inherit;">Cela signifie également que des parties du package peuvent être mises en cache, même si d'autres parties ont changé et doivent être rechargées. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En règle générale, le code est divisé en plusieurs parties:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code pour une page spécifique (spécifique à la page)</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code d'application commun</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modules tiers qui changent rarement (idéal pour la mise en cache!)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Webpack peut automatiquement effectuer cette optimisation, casser le code et réduire le poids total de la charge. </font><font style="vertical-align: inherit;">Le code est divisé en morceaux à l'aide de l'objet </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">optimisation.splitChunks</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Séparez le runtime (runtime) dans un fichier séparé: de cette façon, vous pouvez bénéficier d'une mise en cache à long terme. </font><font style="vertical-align: inherit;">Ivan Akulov a écrit un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">guide détaillé sur la décomposition d'un package en fichiers séparés et la mise en cache dans Webpack</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'est pas possible d'allouer automatiquement du code pour une page spécifique. </font><font style="vertical-align: inherit;">Vous devez identifier manuellement les pièces pouvant être téléchargées séparément. </font><font style="vertical-align: inherit;">Il s'agit souvent d'un chemin ou d'un ensemble de pages spécifique. </font><font style="vertical-align: inherit;">Utilisez </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des importations dynamiques</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour charger paresseusement ce code.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La division du package global en parties augmentera le nombre de demandes de téléchargement de votre application. Mais ce n'est pas un gros problème si les requêtes sont exécutées en parallèle, surtout si le site est chargé en utilisant le protocole HTTP / 2. Vous pouvez le voir pour les trois premières requêtes dans le diagramme suivant: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/995/816/714/9958167144c54dc634d1b7daa03077e3.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, deux requêtes consécutives sont également visibles dans le diagramme. Ces fragments sont nécessaires uniquement pour cette page particulière et ils sont chargés dynamiquement </font></font><code>import()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez essayer de résoudre le problème en insérant une précharge de balise de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">précharge</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/955/2cf/efc/9552cfefcbb751b50e378a0834320b73.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais nous constatons que le temps total de chargement des pages a augmenté. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le préchargement des ressources est parfois contre-productif car il retarde le chargement de fichiers plus importants. Lis</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Article d'Andy Davis sur le préchargement des polices</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et comment cette procédure bloque le début du rendu de page.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chargement de données pour une page</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Votre application devrait probablement afficher des données. </font><font style="vertical-align: inherit;">Voici quelques conseils que vous pouvez utiliser pour télécharger ces données tôt sans délais de rendu inutiles.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N'attendez pas le téléchargement complet du package avant de commencer le téléchargement des données</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un cas particulier d'une chaîne de requêtes séquentielles: vous téléchargez l'intégralité du package d'application, puis ce code demande les données nécessaires pour la page. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a deux façons d'éviter cela:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Incorporer des données dans un document HTML</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exécutez une demande de données à l'aide du script intégré dans le document</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'incorporation des données dans HTML garantit que l'application n'attend pas son chargement. Cela réduit également la complexité du système, car vous n'avez pas besoin de gérer l'état de démarrage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, ce n'est pas une bonne idée si une telle technique retarde le rendu initial. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce cas, ainsi que si vous soumettez un document HTML mis en cache via un technicien de service, vous pouvez utiliser le script intégré pour télécharger ces données comme alternative. Vous pouvez le rendre disponible en tant qu'objet global, voici une promesse:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">window</span>.userDataPromise = fetch(<span class="hljs-string">"/me"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si les données sont prêtes et dans une telle situation, l'application peut immédiatement démarrer le rendu ou attendre qu'elle soit prête. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous utilisez les deux méthodes, vous devez savoir à l'avance quelles données la page va charger avant que l'application ne commence le rendu. </font><font style="vertical-align: inherit;">Cela est généralement évident pour les données liées à l'utilisateur (nom d'utilisateur, notifications, etc.), mais plus difficile avec un contenu spécifique à une page particulière. </font><font style="vertical-align: inherit;">Il est peut-être judicieux de mettre en évidence les pages les plus importantes et d'écrire votre propre logique pour elles.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ne bloquez pas le rendu en attendant des données non pertinentes</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parfois, pour générer des données, vous devez exécuter une logique complexe lente sur le backend. </font><font style="vertical-align: inherit;">Dans de tels cas, vous pouvez d'abord essayer de télécharger une version plus simple des données, si cela suffit pour rendre l'application fonctionnelle et interactive. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, un outil d'analyse peut d'abord télécharger une liste de tous les graphiques avant de charger des données. </font><font style="vertical-align: inherit;">Cela permet à l'utilisateur de rechercher immédiatement le diagramme qui l'intéresse, et aide également à distribuer les requêtes backend à différents serveurs.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/996/ab6/613/996ab66136976b0b22d95e7778fb4664.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Évitez les requêtes de données consécutives</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela peut contredire le paragraphe précédent selon lequel il est préférable de publier des données non essentielles dans une demande distincte. </font><font style="vertical-align: inherit;">Par conséquent, il convient de clarifier: éviter les chaînes avec des demandes de données séquentielles, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si chaque demande terminée ne conduit pas au fait que l'utilisateur dispose de plus d'informations</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au lieu de demander d'abord quel utilisateur est connecté, puis de demander une liste de ses groupes, renvoyez immédiatement la liste des groupes avec les informations sur l'utilisateur dans la première requête. </font><font style="vertical-align: inherit;">Vous pouvez utiliser </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GraphQL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour cela </font><font style="vertical-align: inherit;">, mais le point de terminaison </font></font><code>user?includeTeams=true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonctionne également très bien.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rendu côté serveur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le rendu côté serveur signifie le pré-rendu de l'application, donc un code HTML pleine page est renvoyé à la demande du client. Le client voit la page complètement restituée, sans attendre le chargement de code ou de données supplémentaires! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Étant donné que le serveur envoie au client uniquement du code HTML statique, l'application n'est pas interactive à ce stade. Vous devez télécharger l'application elle-même, démarrer la logique de rendu, puis connecter les écouteurs d'événements nécessaires au DOM. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilisez le rendu côté serveur si la visualisation de contenu non interactif est précieuse en soi. Il est également agréable de mettre en cache le HTML rendu sur le serveur et de le renvoyer immédiatement à tous les utilisateurs sans délai. Par exemple, le rendu côté serveur est idéal lorsque vous utilisez React pour afficher des articles de blog. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cet article de Mikhail Yanashek</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> décrit comment combiner les travailleurs de service et le rendu côté serveur.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page suivante</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À un moment donné, l'utilisateur s'apprête à appuyer sur un bouton et à passer à la page suivante. </font><font style="vertical-align: inherit;">À partir du moment où vous ouvrez la page de démarrage, vous contrôlez ce qui se passe dans le navigateur, vous pouvez donc vous préparer à la prochaine interaction.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Préchargement des ressources</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous préchargez le code nécessaire pour la page suivante, le délai disparaît lorsque l'utilisateur démarre la navigation. </font><font style="vertical-align: inherit;">Utilisez des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">balises de prélecture</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><code>webpackPrefetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour l'importation dynamique:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span>(
    <span class="hljs-comment">/* webpackPrefetch: true, webpackChunkName: "todo-list" */</span> <span class="hljs-string">"./TodoList"</span>
)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considérez le type de charge que vous placez sur l'utilisateur en termes de trafic et de bande passante, surtout s'il est connecté via une connexion mobile. </font><font style="vertical-align: inherit;">Si une personne a téléchargé la version mobile du site et que le mode de stockage des données est actif, il est raisonnable de précharger de manière moins agressive. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Réfléchissez stratégiquement aux parties de l'application dont l'utilisateur aura besoin auparavant.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Réutilisation de données déjà téléchargées</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mettez les données en cache localement dans votre application et utilisez-les pour éviter de futures demandes. </font><font style="vertical-align: inherit;">Si l'utilisateur passe de la liste de ses groupes à la page «Modifier le groupe», vous pouvez effectuer la transition instantanément, en réutilisant les données précédemment téléchargées sur le groupe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veuillez noter que cela ne fonctionnera pas si l'objet est souvent modifié par d'autres utilisateurs et que les données téléchargées peuvent devenir obsolètes. </font><font style="vertical-align: inherit;">Dans ces cas, il existe une option pour afficher d'abord les données en lecture seule existantes tout en exécutant simultanément une demande de données mises à jour.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet article répertorie un certain nombre de facteurs qui peuvent ralentir votre page à différentes étapes du processus de chargement. Des outils tels que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chrome DevTools</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebPageTest</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lighthouse</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous aideront à déterminer lesquels de ces facteurs affectent votre application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la pratique, l'optimisation va rarement immédiatement dans toutes les directions. Nous devons découvrir ce qui a le plus d'impact sur les utilisateurs et nous concentrer sur cela.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant que j'écrivais l'article, j'ai réalisé une chose importante: j'avais une croyance bien ancrée que de nombreuses demandes de serveur individuelles étaient mauvaises pour les performances. </font><font style="vertical-align: inherit;">C'était le cas dans le passé, lorsque chaque demande nécessitait une connexion distincte, et les navigateurs n'autorisaient que quelques connexions par domaine. </font><font style="vertical-align: inherit;">Mais avec HTTP / 2 et les navigateurs modernes, ce n'est plus le cas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe de bons arguments en faveur de la division de l'application en plusieurs parties (avec multiplication des requêtes). </font><font style="vertical-align: inherit;">Cela vous permet de télécharger uniquement les ressources nécessaires et il est préférable d'utiliser le cache, car seuls les fichiers modifiés devront être rechargés.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr490196/index.html">[Flipper Zero] refusez le Raspberry Pi, faites notre propre planche à partir de zéro. Trouver la bonne puce WiFi</a></li>
<li><a href="../fr490198/index.html">Faites confiance mais vérifiez! Zone de démonstration avec projecteurs Epson pour home cinéma dans la salle de démonstration Pult.ru</a></li>
<li><a href="../fr490202/index.html">Comptage de requêtes: test de base des performances Django</a></li>
<li><a href="../fr490204/index.html">Le condensé des événements pour les recruteurs RH et IT en mars 2020</a></li>
<li><a href="../fr490208/index.html">Section backend sur DUMP2020: badinage, ventilateur, échec</a></li>
<li><a href="../fr490222/index.html">Bibliothèque standard du jour de la mort</a></li>
<li><a href="../fr490224/index.html">Furtivité à la mode</a></li>
<li><a href="../fr490226/index.html">Blending et Unity Terrain: comment se débarrasser des intersections et arrêter de se faire mal aux yeux</a></li>
<li><a href="../fr490242/index.html">Service de localisation GSM des modules SIM800x et son travail avec l'API Yandex.Locator</a></li>
<li><a href="../fr490244/index.html">Optimisation de code Python avec ctypes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>