<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧑🏾‍🤝‍🧑🏾 🗣️ 🐸 Las mejores preguntas de entrevista de dificultad media de SQL 🆚 👩🏻‍⚕️ 👈🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El primer 70% del curso de SQL parece bastante sencillo. Las dificultades comienzan en el 30% restante.
 
 De 2015 a 2019, pasé por cuatro entrevistas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Las mejores preguntas de entrevista de dificultad media de SQL</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dcmiran/blog/500360/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El primer 70% del curso de SQL parece bastante sencillo. Las dificultades comienzan en el 30% restante.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
De 2015 a 2019, pasé por cuatro entrevistas para los puestos de analista de datos y especialista en análisis de datos en más de una docena de empresas. Después de otra entrevista fallida en 2017, cuando me confundí acerca de las preguntas complejas de SQL, comencé a compilar un libro de tareas con preguntas SQL de complejidad media y alta para prepararme mejor para las entrevistas. Esta guía ha sido útil en la última ronda de entrevistas en 2019. Durante el año pasado, compartí esta guía con un par de amigos, y gracias al tiempo libre adicional debido a una pandemia, la pulí y compilé este documento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay muchos excelentes tutoriales SQL para principiantes. Mis favoritos son</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cursos interactivos SQL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Select Star SQL de </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">Codecademy</font></a><font style="vertical-align: inherit;"> por Zi Chung Kao. </font><font style="vertical-align: inherit;">Pero en realidad, el primer 70% del curso de SQL es bastante simple, y las verdaderas dificultades comienzan en el 30% restante, que no están cubiertas en las guías para principiantes. </font><font style="vertical-align: inherit;">Entonces, en las entrevistas para analistas de datos y especialistas en análisis de datos en compañías de tecnología, a menudo se hacen preguntas sobre este 30%. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sorprendentemente, no encontré una fuente exhaustiva sobre estos temas de dificultad media, así que compilé esta guía.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es útil para entrevistas, pero al mismo tiempo aumentará su efectividad en sus trabajos actuales y futuros. </font><font style="vertical-align: inherit;">Personalmente, creo que algunas de las plantillas SQL mencionadas también son útiles para los sistemas ETL que ejecutan herramientas de informes y funciones de análisis de datos para identificar tendencias.</font></font><br>
<br>
<blockquote><h1><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido</font></font></a></h1><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">     </a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">        SQL</a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  </a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">№ 1.     </a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">№ 2.   </a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">№ 3.     ( )</a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> 1</a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> 2</a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> 3</a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">№ 4.  </a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">№ 5.  </a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">№ 6.   </a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">   </a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">№ 1.     </a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">№ 2.        ( )</a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> 1</a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> 2</a></li>
</ul></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">     </a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">№ 1. </a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">№ 2.   ( )</a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> 1</a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> 2</a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">№ 3.  </a></li>
</ul></li>
</ul></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Debe comprender que durante las entrevistas con analistas de datos y analistas de datos, hacen preguntas no solo sobre SQL. Otros temas comunes incluyen la discusión de proyectos pasados, pruebas A / B, desarrollo métrico y problemas analíticos abiertos. Hace unos tres años, Quora publicó </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consejos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre entrevistas para un puesto de analista de productos en Facebook. Allí, este tema se discute con más detalle. Sin embargo, si mejorar su conocimiento de SQL lo ayudará en su entrevista, entonces esta guía bien vale la pena. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el futuro, puedo transferir el código de esta guía a un sitio como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Select Star SQL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para facilitar la escritura de sentencias SQL y ver el resultado de la ejecución del código en tiempo real. </font><font style="vertical-align: inherit;">Como opción, agregue preguntas como problemas a la plataforma para prepararse para </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">las</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> entrevistas de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">LeetCode</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mientras tanto, solo quería publicar este documento para que las personas puedan familiarizarse con esta información.</font></font><br>
<br>
<a name="1"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suposiciones hechas y cómo usar el manual</font></font></h1><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suposiciones sobre el conocimiento del lenguaje SQL:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se supone que tiene conocimiento práctico de SQL. </font><font style="vertical-align: inherit;">Probablemente lo use a menudo en el trabajo, pero quiere perfeccionar sus habilidades en temas como las autoasociaciones y las funciones de ventana. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cómo usar este manual:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dado que a menudo se usa un tablero o un bloc de notas virtual en la entrevista (sin compilar el código), recomiendo tomar un lápiz y papel y escribir soluciones para cada problema, y ​​después de completarlo, compare sus notas con las respuestas. </font><font style="vertical-align: inherit;">¡O calcule sus respuestas con un amigo que actuará como entrevistador!</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los errores menores de sintaxis no importan mucho durante una entrevista con una pizarra o un bloc de notas. </font><font style="vertical-align: inherit;">Pero pueden distraer al entrevistador, así que idealmente trate de reducir su número para concentrar toda la atención en la lógica.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las respuestas dadas no son necesariamente la única forma de resolver cada problema. </font><font style="vertical-align: inherit;">¡No dude en escribir comentarios con soluciones adicionales que puede agregar a esta guía!</font></font></li>
</ul><br>
<a name="2"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consejos para resolver tareas complejas en entrevistas SQL</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, consejos estándar para todas las entrevistas de programación ...</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escuche atentamente la descripción del problema, repita la esencia del problema al entrevistador.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formule un caso límite para demostrar que realmente comprende el problema (es decir, una línea que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no se</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> incluirá en la consulta SQL final que va a escribir)</font></font><br>
</li>
<li>(    )     ,     —     :     ,             <br>
<ul>
<li>,      ,     </li>
</ul></li>
<li>  SQL,   ,     .      ,      .</li>
</ol><br>
<a name="3"></a><h1>   </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algunos de los problemas enumerados aquí están adaptados de las antiguas entradas de blog de Periscope (en su mayoría escritas por </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sean Cook</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> alrededor de 2014, aunque su autoría parece haber sido eliminada de los materiales después de que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SiSense se fusionó con Periscope</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), así como de las discusiones sobre StackOverflow. </font><font style="vertical-align: inherit;">Si es necesario, las fuentes se marcan al comienzo de cada pregunta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Select Star SQL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> también hay una buena </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selección de acertijos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , temas complementarios de este documento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenga en cuenta que estas preguntas no son copias literales de las preguntas de mis propias entrevistas, y no se utilizaron en las empresas en las que trabajé o trabajo.</font></font><br>
<br>
<a name="4"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tareas de autoasociación</font></font></h1><br>
<a name="5"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 1. Porcentaje de cambio mes a mes</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto: a</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menudo </font><b><font style="vertical-align: inherit;">es</font></b><font style="vertical-align: inherit;"> útil saber cómo cambia una métrica clave, por ejemplo, la audiencia mensual de usuarios activos, de mes a mes. </font><font style="vertical-align: inherit;">Digamos que tenemos una tabla </font></font><code>logins</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de esta forma:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El | </font><font style="vertical-align: inherit;">user_id | </font><font style="vertical-align: inherit;">fecha |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| --------- | ------------ |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">2018-07-01 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">234 </font><font style="vertical-align: inherit;">2018-07-02 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">2018-07-02 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">2018-07-02 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">... | </font><font style="vertical-align: inherit;">... |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">234 </font><font style="vertical-align: inherit;">2018-10-04 |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objetivo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : encontrar el cambio porcentual mensual en la audiencia mensual de usuarios activos (MAU). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solución: </font></font></b><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Esta solución, como los otros bloques de código en este documento, contiene comentarios sobre elementos de sintaxis SQL que pueden diferir entre las diferentes variantes SQL y otras notas)</font></font></i> <br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> mau <span class="hljs-keyword">AS</span> <font></font>
(<font></font>
  <span class="hljs-keyword">SELECT</span> 
   <span class="hljs-comment">/* 
    *       
    *  , .&nbsp;.   ,    . 
    *    ,   
    *
    *  Postgres  DATE_TRUNC(),   
    *      SQL   
    * . https://www.postgresql.org/docs/9.0/functions-datetime.html#FUNCTIONS-DATETIME-TRUNC
    */</span> 
    DATE_TRUNC(<span class="hljs-string">'month'</span>, <span class="hljs-built_in">date</span>) month_timestamp,
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> user_id) mau
  <span class="hljs-keyword">FROM</span> <font></font>
    logins <font></font>
  <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
    DATE_TRUNC(<span class="hljs-string">'month'</span>, <span class="hljs-built_in">date</span>)<font></font>
  )<font></font>
 <font></font>
 <span class="hljs-keyword">SELECT</span> 
    <span class="hljs-comment">/*
    *    SELECT      . 
    * 
    *        ,   
    *    ,   , 
    *        ..
    */</span> <font></font>
    a.month_timestamp previous_month, <font></font>
    a.mau previous_mau, <font></font>
    b.month_timestamp current_month, <font></font>
    b.mau current_mau, <font></font>
    <span class="hljs-keyword">ROUND</span>(<span class="hljs-number">100.0</span>*(b.mau - a.mau)/a.mau,<span class="hljs-number">2</span>) <span class="hljs-keyword">AS</span> percent_change 
 <span class="hljs-keyword">FROM</span><font></font>
    mau a <font></font>
 <span class="hljs-keyword">JOIN</span> 
    <span class="hljs-comment">/*
    *   `ON b.month_timestamp = a.month_timestamp + interval '1 month'` 
    */</span>
    mau b <span class="hljs-keyword">ON</span> a.month_timestamp = b.month_timestamp - <span class="hljs-built_in">interval</span> <span class="hljs-string">'1 month'</span> </code></pre><br>
<a name="6"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 2. Estructura del árbol de marcado</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> suponga que tiene una tabla </font></font><code>tree</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">con dos columnas: la primera indica los nodos y la segunda los nodos principales.</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nodo principal</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
12</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3 5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4 3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5 NULL </font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La tarea:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escribir SQL de tal manera que designemos cada nodo como interno (raíz), raíz (raíz) o nodo final / hoja (hoja), de modo que para los valores anteriores obtenga lo siguiente:</font></font><br>
<br>
<pre><code class="sql hljs">node    label  <font></font>
1       Leaf<font></font>
2       Inner<font></font>
3       Inner<font></font>
4       Leaf<font></font>
5       Root</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Nota: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aquí</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se puede encontrar más información sobre la terminología de la estructura de datos en forma de árbol </font><font style="vertical-align: inherit;">. Sin embargo, ¡no es necesario resolver este problema!) </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solución: </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gracias:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> esta es una solución más generalizada propuesta por Fabian Hoffman el 2 de mayo de 2020. </font><font style="vertical-align: inherit;">Gracias, Fabian</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> join_table <span class="hljs-keyword">AS</span><font></font>
(<font></font>
    <span class="hljs-keyword">SELECT</span> <font></font>
        cur.node, <font></font>
        cur.parent, <font></font>
        <span class="hljs-keyword">COUNT</span>(next.node) <span class="hljs-keyword">AS</span> num_children
    <span class="hljs-keyword">FROM</span> <font></font>
        tree cur<font></font>
    <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> 
        tree <span class="hljs-keyword">next</span> <span class="hljs-keyword">ON</span> (next.parent = cur.node)
    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <font></font>
        cur.node, <font></font>
        cur.parent<font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">SELECT</span><font></font>
    node,<font></font>
    <span class="hljs-keyword">CASE</span>
        <span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">parent</span> <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">"Root"</span>
        <span class="hljs-keyword">WHEN</span> num_children = <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">"Leaf"</span>
        <span class="hljs-keyword">ELSE</span> <span class="hljs-string">"Inner"</span>
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> label
<span class="hljs-keyword">FROM</span> 
    join_table </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solución alternativa, sin conexiones explícitas: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reconocimiento:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> William Chardgin el 2 de mayo de 2020 llamó la atención sobre la necesidad de la condición de </font></font><code>WHERE parent IS NOT NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que esta solución regrese </font></font><code>Leaf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en </font><font style="vertical-align: inherit;">su </font><font style="vertical-align: inherit;">lugar </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Gracias William!</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <font></font>
    node,<font></font>
    <span class="hljs-keyword">CASE</span> 
        <span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">parent</span> <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'Root'</span>
        <span class="hljs-keyword">WHEN</span> node <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> 
            (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">parent</span> <span class="hljs-keyword">FROM</span> tree <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">parent</span> <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">THEN</span> <span class="hljs-string">'Leaf'</span>
        <span class="hljs-keyword">WHEN</span> node <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">parent</span> <span class="hljs-keyword">FROM</span> tree) <span class="hljs-keyword">AND</span> <span class="hljs-keyword">parent</span> <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'Inner'</span>
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> label 
 <span class="hljs-keyword">from</span> 
    tree</code></pre><br>
<a name="7"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 3. Retención de usuarios por mes (varias partes)</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reconocimiento:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> esta tarea fue adaptada del artículo del blog de SiSense, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Uso de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> autoasociaciones </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">para calcular la retención, el</font></a><font style="vertical-align: inherit;"> flujo de salida y la reactivación </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">"</font></a><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<a name="8"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 1</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> supongamos que tenemos estadísticas sobre la autorización del usuario en un sitio en la tabla </font></font><code>logins</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El | </font><font style="vertical-align: inherit;">user_id | </font><font style="vertical-align: inherit;">fecha |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| --------- | ------------ |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">2018-07-01 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">234 </font><font style="vertical-align: inherit;">2018-07-02 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">2018-07-02 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">2018-07-02 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">... | </font><font style="vertical-align: inherit;">... |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">234 </font><font style="vertical-align: inherit;">2018-10-04 |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarea:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escriba una solicitud que reciba el número de usuarios retenidos por mes. </font><font style="vertical-align: inherit;">En nuestro caso, este parámetro se define como el número de usuarios que iniciaron sesión en el sistema en este y el mes anterior. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisión:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> 
    DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) month_timestamp, 
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> a.user_id) retained_users 
 <span class="hljs-keyword">FROM</span> <font></font>
    logins a <font></font>
 <span class="hljs-keyword">JOIN</span> 
    logins b <span class="hljs-keyword">ON</span> a.user_id = b.user_id 
        <span class="hljs-keyword">AND</span> DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) = DATE_TRUNC(<span class="hljs-string">'month'</span>, b.date) + 
                                             <span class="hljs-built_in">interval</span> <span class="hljs-string">'1 month'</span>
 <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
    date_trunc(<span class="hljs-string">'month'</span>, a.date)</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reconocimiento:</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Tom Moertel señaló que la duplicación previa de user_id antes de la autounión hace que la solución sea más eficiente, y sugirió el siguiente código. </font><font style="vertical-align: inherit;">Gracias tom! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solución alternativa:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> DistinctMonthlyUsers <span class="hljs-keyword">AS</span> (
  <span class="hljs-comment">/*
  *     ** , 
  *  
  */</span>
    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span>
      DATE_TRUNC(<span class="hljs-string">'MONTH'</span>, a.date) <span class="hljs-keyword">AS</span> month_timestamp,<font></font>
      user_id<font></font>
    <span class="hljs-keyword">FROM</span> logins<font></font>
  )<font></font>
<font></font>
<span class="hljs-keyword">SELECT</span><font></font>
  CurrentMonth.month_timestamp month_timestamp,<font></font>
  <span class="hljs-keyword">COUNT</span>(PriorMonth.user_id) <span class="hljs-keyword">AS</span> retained_user_count
<span class="hljs-keyword">FROM</span> 
    DistinctMonthlyUsers <span class="hljs-keyword">AS</span> CurrentMonth
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> 
    DistinctMonthlyUsers <span class="hljs-keyword">AS</span> PriorMonth
  <span class="hljs-keyword">ON</span>
    CurrentMonth.month_timestamp = PriorMonth.month_timestamp + <span class="hljs-built_in">INTERVAL</span> <span class="hljs-string">'1 MONTH'</span>
    <span class="hljs-keyword">AND</span> 
    CurrentMonth.user_id = PriorMonth.user_id</code></pre><br>
<a name="9"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 2</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarea:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ahora tomamos la tarea anterior de calcular el número de usuarios retenidos por mes, y lo volteamos. </font><font style="vertical-align: inherit;">Escribiremos una solicitud para contar los usuarios que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> han </font><font style="vertical-align: inherit;">regresado al sitio este mes. </font><font style="vertical-align: inherit;">Es decir, usuarios "perdidos". </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisión:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> 
    DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) month_timestamp, 
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> b.user_id) churned_users 
<span class="hljs-keyword">FROM</span> <font></font>
    logins a <font></font>
<span class="hljs-keyword">FULL</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> 
    logins b <span class="hljs-keyword">ON</span> a.user_id = b.user_id 
        <span class="hljs-keyword">AND</span> DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) = DATE_TRUNC(<span class="hljs-string">'month'</span>, b.date) + 
                                         <span class="hljs-built_in">interval</span> <span class="hljs-string">'1 month'</span>
<span class="hljs-keyword">WHERE</span> 
    a.user_id <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> 
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
    DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenga en cuenta que este problema también se puede resolver con </font></font><code>LEFT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o </font></font><code>RIGHT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<a name="10"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 3</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: esta es</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> probablemente una tarea más difícil de lo que se le ofrecerá en una entrevista real. </font><font style="vertical-align: inherit;">Piénselo más como un rompecabezas, o puede saltarse y pasar a la siguiente tarea. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : entonces hicimos un buen trabajo en dos problemas anteriores. </font><font style="vertical-align: inherit;">Según los términos de la nueva tarea, ahora tenemos una tabla de usuarios perdidos </font></font><code>user_churns</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Si el usuario estuvo activo en el último mes, pero luego no estuvo activo en este, se ingresa en la tabla de este mes. </font><font style="vertical-align: inherit;">Así es como se ve </font></font><code>user_churns</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El | </font><font style="vertical-align: inherit;">user_id | </font><font style="vertical-align: inherit;">mes_fecha |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| --------- | ------------ |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">2018-05-01 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">234 </font><font style="vertical-align: inherit;">2018-05-01 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">2018-05-01 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">12 | </font><font style="vertical-align: inherit;">2018-05-01 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">... | </font><font style="vertical-align: inherit;">... |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">234 </font><font style="vertical-align: inherit;">2018-10-01 |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarea</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : ahora desea realizar un análisis de cohorte, es decir, un análisis de la totalidad de usuarios activos que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se han reactivado en el pasado</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Crea una tabla con estos usuarios. </font><font style="vertical-align: inherit;">Puede usar tablas </font></font><code>user_churns</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font><font style="vertical-align: inherit;">crear una cohorte </font></font><code>logins</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En Postgres, se puede acceder a la marca de tiempo actual a través de </font></font><code>current_timestamp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisión:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> user_login_data <span class="hljs-keyword">AS</span> <font></font>
(<font></font>
    <span class="hljs-keyword">SELECT</span> 
        DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) month_timestamp,<font></font>
        a.user_id,<font></font>
        <span class="hljs-comment">/* 
        *   ,    SQL,   , 
        *      SELECT   HAVING.
        *       .  
        */</span> 
        <span class="hljs-keyword">MAX</span>(b.month_date) <span class="hljs-keyword">as</span> most_recent_churn, 
        <span class="hljs-keyword">MAX</span>(DATE_TRUNC(<span class="hljs-string">'month'</span>, c.date)) <span class="hljs-keyword">as</span> most_recent_active 
     <span class="hljs-keyword">FROM</span> <font></font>
        logins a<font></font>
     <span class="hljs-keyword">JOIN</span> <font></font>
        user_churns b <font></font>
            <span class="hljs-keyword">ON</span> a.user_id = b.user_id <span class="hljs-keyword">AND</span> DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) &gt; b.month_date 
     <span class="hljs-keyword">JOIN</span><font></font>
        logins c <font></font>
            <span class="hljs-keyword">ON</span> a.user_id = c.user_id 
            <span class="hljs-keyword">AND</span> 
            DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) &gt; DATE_TRUNC(<span class="hljs-string">'month'</span>, c.date)
     <span class="hljs-keyword">WHERE</span> 
        DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) = DATE_TRUNC(<span class="hljs-string">'month'</span>, <span class="hljs-keyword">current_timestamp</span>)
     <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
        DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date),<font></font>
        a.user_id<font></font>
     <span class="hljs-keyword">HAVING</span> 
        most_recent_churn &gt; most_recent_active</code></pre><br>
<a name="11"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 4. Total creciente</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reconocimiento:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Esta tarea fue adaptada del artículo del blog de SiSense </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Cash Flow Modeling in SQL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> supongamos que tenemos una tabla </font></font><code>transactions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de esta forma:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El | </font><font style="vertical-align: inherit;">fecha | </font><font style="vertical-align: inherit;">flujo de caja |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ------------ | ----------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">2018-01-01 | </font><font style="vertical-align: inherit;">-1000 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">2018-01-02 | </font><font style="vertical-align: inherit;">-100 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">2018-01-03 | </font><font style="vertical-align: inherit;">50</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">... | </font><font style="vertical-align: inherit;">... |</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¿Dónde </font></font><code>cash_flow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">están los ingresos menos los costos de cada día? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objetivo:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escribir una solicitud para obtener un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">total</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> acumulado de flujo de caja todos los días de tal manera que al final obtenga una tabla de esta forma:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El | </font><font style="vertical-align: inherit;">fecha | </font><font style="vertical-align: inherit;">cumulative_cf |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ------------ | --------------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">2018-01-01 | </font><font style="vertical-align: inherit;">-1000 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">2018-01-02 | </font><font style="vertical-align: inherit;">-1100 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">2018-01-03 | </font><font style="vertical-align: inherit;">-1050 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">... | </font><font style="vertical-align: inherit;">... |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisión:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> 
    a.date <span class="hljs-built_in">date</span>, 
    <span class="hljs-keyword">SUM</span>(b.cash_flow) <span class="hljs-keyword">as</span> cumulative_cf 
<span class="hljs-keyword">FROM</span><font></font>
    transactions a<font></font>
<span class="hljs-keyword">JOIN</span> b <font></font>
    transactions b <span class="hljs-keyword">ON</span> a.date &gt;= b.date 
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <font></font>
    a.date <font></font>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 
    <span class="hljs-built_in">date</span> <span class="hljs-keyword">ASC</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una solución alternativa que utiliza una función de ventana (¡más eficiente!):</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> 
    <span class="hljs-built_in">date</span>, 
    <span class="hljs-keyword">SUM</span>(cash_flow) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">ASC</span>) <span class="hljs-keyword">as</span> cumulative_cf 
<span class="hljs-keyword">FROM</span><font></font>
    transactions <font></font>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 
    <span class="hljs-built_in">date</span> <span class="hljs-keyword">ASC</span></code></pre><br>
<a name="12"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 5. Media móvil</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reconocimiento:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> esta tarea está adaptada del artículo del blog de SiSense </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Medias Móviles en MySQL y SQL Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: el</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> promedio móvil se puede calcular de varias maneras. </font><font style="vertical-align: inherit;">Aquí usamos el promedio anterior. </font><font style="vertical-align: inherit;">Por lo tanto, la métrica para el séptimo día del mes será el promedio de los seis días anteriores y él mismo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : supongamos que tenemos una tabla </font></font><code>signups</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de esta forma:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El | </font><font style="vertical-align: inherit;">fecha | </font><font style="vertical-align: inherit;">inscripciones |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ------------ | ---------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">2018-01-01 | </font><font style="vertical-align: inherit;">10 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">2018-01-02 | </font><font style="vertical-align: inherit;">20 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">2018-01-03 | </font><font style="vertical-align: inherit;">50</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">... | </font><font style="vertical-align: inherit;">... |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">2018-10-01 | </font><font style="vertical-align: inherit;">35</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarea</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : escriba una solicitud para obtener un promedio móvil de 7 días de registros diarios. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisión:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <font></font>
  a.date, <font></font>
  <span class="hljs-keyword">AVG</span>(b.sign_ups) average_sign_ups 
<span class="hljs-keyword">FROM</span> <font></font>
  signups a <font></font>
<span class="hljs-keyword">JOIN</span> 
  signups b <span class="hljs-keyword">ON</span> a.date &lt;= b.date + <span class="hljs-built_in">interval</span> <span class="hljs-string">'6 days'</span> <span class="hljs-keyword">AND</span> a.date &gt;= b.date
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
  a.date</code></pre><br>
<a name="13"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 6. Varias condiciones de conexión.</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reconocimiento:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> esta tarea está adaptada del artículo del blog de SiSense, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Analizando su correo electrónico usando SQL"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> supongamos que nuestra tabla </font></font><code>emails</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contiene correos electrónicos enviados desde la dirección </font></font><code>zach@g.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y recibidos en ella:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El | </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">sujeto | </font><font style="vertical-align: inherit;">de | </font><font style="vertical-align: inherit;">a | </font><font style="vertical-align: inherit;">marca de tiempo |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ---- | ---------- | -------------- | -------------- | --- ------------------ |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">Yosemite | </font><font style="vertical-align: inherit;">zach@g.com | </font><font style="vertical-align: inherit;">thomas@g.com | </font><font style="vertical-align: inherit;">2018-01-02 12:45:03 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">Big Sur | </font><font style="vertical-align: inherit;">sarah@g.com | </font><font style="vertical-align: inherit;">thomas@g.com | </font><font style="vertical-align: inherit;">2018-01-02 16:30:01 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">Yosemite | </font><font style="vertical-align: inherit;">thomas@g.com | </font><font style="vertical-align: inherit;">zach@g.com | </font><font style="vertical-align: inherit;">2018-01-02 16:35:04 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">Corriendo | </font><font style="vertical-align: inherit;">jill@g.com | </font><font style="vertical-align: inherit;">zach@g.com | </font><font style="vertical-align: inherit;">2018-01-03 08:12:45 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">5 | </font><font style="vertical-align: inherit;">Yosemite | </font><font style="vertical-align: inherit;">zach@g.com | </font><font style="vertical-align: inherit;">thomas@g.com | </font><font style="vertical-align: inherit;">2018-01-03 14:02:01 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">6 | </font><font style="vertical-align: inherit;">Yosemite | </font><font style="vertical-align: inherit;">thomas@g.com | </font><font style="vertical-align: inherit;">zach@g.com | </font><font style="vertical-align: inherit;">2018-01-03 15:01:05 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">.. | </font><font style="vertical-align: inherit;">.. | </font><font style="vertical-align: inherit;">.. | </font><font style="vertical-align: inherit;">.. | </font><font style="vertical-align: inherit;">.. |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarea:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escriba una solicitud para obtener el tiempo de respuesta para cada carta ( </font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) enviada a </font></font><code>zach@g.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">No incluya cartas a otras direcciones. </font><font style="vertical-align: inherit;">Supongamos que cada hilo tiene un tema único. </font><font style="vertical-align: inherit;">Tenga en cuenta que el hilo puede tener varias cartas de ida y vuelta entre </font></font><code>zach@g.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y otros destinatarios. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisión:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <font></font>
    a.id, <font></font>
    <span class="hljs-keyword">MIN</span>(b.timestamp) - a.timestamp <span class="hljs-keyword">as</span> time_to_respond 
<span class="hljs-keyword">FROM</span> <font></font>
    emails a <font></font>
<span class="hljs-keyword">JOIN</span><font></font>
    emails b <font></font>
        <span class="hljs-keyword">ON</span> <font></font>
            b.subject = a.subject <font></font>
        <span class="hljs-keyword">AND</span> <font></font>
            a.to = b.from<font></font>
        <span class="hljs-keyword">AND</span> <font></font>
            a.from = b.to <font></font>
        <span class="hljs-keyword">AND</span> <font></font>
            a.timestamp &lt; b.timestamp <font></font>
 <span class="hljs-keyword">WHERE</span> 
    a.to = <span class="hljs-string">'zach@g.com'</span> 
 <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
    a.id </code></pre><br>
<a name="14"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tareas para funciones de ventana</font></font></h1><br>
<a name="15"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 1. Encuentra el identificador con el valor máximo</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> supongamos que tenemos una tabla </font></font><code>salaries</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">con datos sobre departamentos y salarios de empleados en el siguiente formato:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  depname | </font><font style="vertical-align: inherit;">empno | </font><font style="vertical-align: inherit;">salario |     </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
----------- + ------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desarrollar | </font><font style="vertical-align: inherit;">11 | </font><font style="vertical-align: inherit;">5200 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desarrollar | </font><font style="vertical-align: inherit;">7 | </font><font style="vertical-align: inherit;">4200 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desarrollar | </font><font style="vertical-align: inherit;">9 | </font><font style="vertical-align: inherit;">4500 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desarrollar | </font><font style="vertical-align: inherit;">8 | </font><font style="vertical-align: inherit;">6000 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desarrollar | </font><font style="vertical-align: inherit;">10 | </font><font style="vertical-align: inherit;">5200 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 personal | </font><font style="vertical-align: inherit;">5 | </font><font style="vertical-align: inherit;">3500 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 personal | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3900 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ventas | </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">4800 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ventas | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">5000 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ventas | </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">4800 |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarea</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : escriba una solicitud para obtener </font></font><code>empno</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el salario más alto. </font><font style="vertical-align: inherit;">¡Asegúrese de que su solución maneje casos de salarios iguales! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisión:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> max_salary <span class="hljs-keyword">AS</span> (
    <span class="hljs-keyword">SELECT</span> 
        <span class="hljs-keyword">MAX</span>(salary) max_salary
    <span class="hljs-keyword">FROM</span> <font></font>
        salaries<font></font>
    )<font></font>
<span class="hljs-keyword">SELECT</span> <font></font>
    s.empno<font></font>
<span class="hljs-keyword">FROM</span> <font></font>
    salaries s<font></font>
<span class="hljs-keyword">JOIN</span> 
    max_salary ms <span class="hljs-keyword">ON</span> s.salary = ms.max_salary</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solución alternativa usando </font></font><code>RANK()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> sal_rank <span class="hljs-keyword">AS</span> 
  (<span class="hljs-keyword">SELECT</span> <font></font>
    empno, <font></font>
    <span class="hljs-keyword">RANK</span>() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>) rnk
  <span class="hljs-keyword">FROM</span> <font></font>
    salaries)<font></font>
<span class="hljs-keyword">SELECT</span> <font></font>
  empno<font></font>
<span class="hljs-keyword">FROM</span><font></font>
  sal_rank<font></font>
<span class="hljs-keyword">WHERE</span> 
  rnk = <span class="hljs-number">1</span>;</code></pre><br>
<a name="16"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 2. Valor promedio y clasificación con una función de ventana (varias partes)</font></font></h2><br>
<a name="17"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 1</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : supongamos que tenemos una tabla </font></font><code>salaries</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en este formato:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  depname | </font><font style="vertical-align: inherit;">empno | </font><font style="vertical-align: inherit;">salario |     </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
----------- + ------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desarrollar | </font><font style="vertical-align: inherit;">11 | </font><font style="vertical-align: inherit;">5200 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desarrollar | </font><font style="vertical-align: inherit;">7 | </font><font style="vertical-align: inherit;">4200 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desarrollar | </font><font style="vertical-align: inherit;">9 | </font><font style="vertical-align: inherit;">4500 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desarrollar | </font><font style="vertical-align: inherit;">8 | </font><font style="vertical-align: inherit;">6000 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desarrollar | </font><font style="vertical-align: inherit;">10 | </font><font style="vertical-align: inherit;">5200 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 personal | </font><font style="vertical-align: inherit;">5 | </font><font style="vertical-align: inherit;">3500 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 personal | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3900 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ventas | </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">4800 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ventas | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">5000 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ventas | </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">4800 |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarea:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escriba una consulta que devuelva la misma tabla, pero con una nueva columna que muestre el salario promedio del departamento. </font><font style="vertical-align: inherit;">Esperaríamos una tabla como esta:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  depname | </font><font style="vertical-align: inherit;">empno | </font><font style="vertical-align: inherit;">salario | </font><font style="vertical-align: inherit;">avg_salary |     </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
----------- + ------- + -------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desarrollar | </font><font style="vertical-align: inherit;">11 | </font><font style="vertical-align: inherit;">5200 | </font><font style="vertical-align: inherit;">5020 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desarrollar | </font><font style="vertical-align: inherit;">7 | </font><font style="vertical-align: inherit;">4200 | </font><font style="vertical-align: inherit;">5020 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desarrollar | </font><font style="vertical-align: inherit;">9 | </font><font style="vertical-align: inherit;">4500 | </font><font style="vertical-align: inherit;">5020 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desarrollar | </font><font style="vertical-align: inherit;">8 | </font><font style="vertical-align: inherit;">6000 | </font><font style="vertical-align: inherit;">5020 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desarrollar | </font><font style="vertical-align: inherit;">10 | </font><font style="vertical-align: inherit;">5200 | </font><font style="vertical-align: inherit;">5020 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 personal | </font><font style="vertical-align: inherit;">5 | </font><font style="vertical-align: inherit;">3500 | </font><font style="vertical-align: inherit;">3700 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 personal | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3900 | </font><font style="vertical-align: inherit;">3700 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ventas | </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">4800 | </font><font style="vertical-align: inherit;">4867 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ventas | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">5000 | </font><font style="vertical-align: inherit;">4867 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ventas | </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">4800 | </font><font style="vertical-align: inherit;">4867 |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisión:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <font></font>
    *, <font></font>
    <span class="hljs-comment">/*
    * AVG() is a Postgres command, but other SQL flavors like BigQuery use 
    * AVERAGE()
    */</span> 
    <span class="hljs-keyword">ROUND</span>(<span class="hljs-keyword">AVG</span>(salary),<span class="hljs-number">0</span>) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> depname) avg_salary
<span class="hljs-keyword">FROM</span>
    salaries</code></pre><br>
<a name="18"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 2</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarea:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escriba una consulta que agregue una columna con la posición de cada empleado en la hoja de tiempo en función de su salario en su departamento, donde el empleado con el salario más alto obtiene la posición 1. Esperaríamos una tabla de esta forma:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  depname | </font><font style="vertical-align: inherit;">empno | </font><font style="vertical-align: inherit;">salario | </font><font style="vertical-align: inherit;">Salario_rank |     </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
----------- + ------- + -------- + ------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desarrollar | </font><font style="vertical-align: inherit;">11 | </font><font style="vertical-align: inherit;">5200 | </font><font style="vertical-align: inherit;">2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desarrollar | </font><font style="vertical-align: inherit;">7 | </font><font style="vertical-align: inherit;">4200 | </font><font style="vertical-align: inherit;">5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desarrollar | </font><font style="vertical-align: inherit;">9 | </font><font style="vertical-align: inherit;">4500 | </font><font style="vertical-align: inherit;">4 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desarrollar | </font><font style="vertical-align: inherit;">8 | </font><font style="vertical-align: inherit;">6000 | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desarrollar | </font><font style="vertical-align: inherit;">10 | </font><font style="vertical-align: inherit;">5200 | </font><font style="vertical-align: inherit;">2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 personal | </font><font style="vertical-align: inherit;">5 | </font><font style="vertical-align: inherit;">3500 | </font><font style="vertical-align: inherit;">2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 personal | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3900 | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ventas | </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">4800 | </font><font style="vertical-align: inherit;">2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ventas | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">5000 | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ventas | </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">4800 | </font><font style="vertical-align: inherit;">2 |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisión:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <font></font>
    *, <font></font>
    <span class="hljs-keyword">RANK</span>() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> depname <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>) salary_rank
 <span class="hljs-keyword">FROM</span>  
    salaries </code></pre><br>
<a name="19"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otras tareas de dificultad media y alta.</font></font></h1><br>
<a name="20"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 1. Histogramas</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Digamos que tenemos una tabla </font></font><code>sessions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">donde cada fila representa una sesión de transmisión de video con una duración en segundos:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El | </font><font style="vertical-align: inherit;">session_id | </font><font style="vertical-align: inherit;">longitud_segundos |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ------------ | ---------------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">23 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">453</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">27</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">.. | </font><font style="vertical-align: inherit;">.. |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarea:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escriba una consulta para calcular el número de sesiones que caen en intervalos de cinco segundos, es decir, para el fragmento anterior, el resultado será algo como esto:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El | </font><font style="vertical-align: inherit;">cubo | </font><font style="vertical-align: inherit;">contar |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| --------- | ------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">20-25 | </font><font style="vertical-align: inherit;">2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">450-455 | </font><font style="vertical-align: inherit;">1 |</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El puntaje máximo cuenta para las etiquetas de línea adecuadas ("5-10", etc.) </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solución:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> bin_label <span class="hljs-keyword">AS</span> 
(<span class="hljs-keyword">SELECT</span> <font></font>
    session_id, <font></font>
    <span class="hljs-keyword">FLOOR</span>(length_seconds/<span class="hljs-number">5</span>) <span class="hljs-keyword">as</span> bin_label 
 <span class="hljs-keyword">FROM</span><font></font>
    sessions <font></font>
 )<font></font>
 <span class="hljs-keyword">SELECT</span> 
    CONCATENTATE(<span class="hljs-keyword">STR</span>(bin_label*<span class="hljs-number">5</span>), <span class="hljs-string">'-'</span>, <span class="hljs-keyword">STR</span>(bin_label*<span class="hljs-number">5</span>+<span class="hljs-number">5</span>)) <span class="hljs-keyword">bucket</span>, 
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> session_id) <span class="hljs-keyword">count</span> 
 <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <font></font>
    bin_label<font></font>
 <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 
    bin_label <span class="hljs-keyword">ASC</span> </code></pre><br>
<a name="21"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 2. Conexión cruzada (varias partes)</font></font></h2><br>
<a name="22"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 1</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> supongamos que tenemos una tabla </font></font><code>state_streams</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">donde el nombre del estado y el número total de horas de transmisión desde el alojamiento de video se indican en cada línea:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El | </font><font style="vertical-align: inherit;">estado | </font><font style="vertical-align: inherit;">corrientes_total |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ------- | --------------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">NC | </font><font style="vertical-align: inherit;">34569 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">SC | </font><font style="vertical-align: inherit;">33999 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">CA | </font><font style="vertical-align: inherit;">98324 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">MA | </font><font style="vertical-align: inherit;">19345 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">.. | </font><font style="vertical-align: inherit;">.. |</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(De hecho, las tablas agregadas de este tipo generalmente tienen una columna de fecha, pero la excluiremos para esta tarea) </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarea:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escriba una consulta para obtener pares de estados con un número total de hilos dentro de mil entre sí. </font><font style="vertical-align: inherit;">Para el fragmento anterior, nos gustaría ver algo como:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El | </font><font style="vertical-align: inherit;">estado_a | </font><font style="vertical-align: inherit;">estado_b |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| --------- | --------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">NC | </font><font style="vertical-align: inherit;">SC |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">SC | </font><font style="vertical-align: inherit;">NC |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisión:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span>
    a.state <span class="hljs-keyword">as</span> state_a, <font></font>
    b.state <span class="hljs-keyword">as</span> state_b 
 <span class="hljs-keyword">FROM</span>   <font></font>
    state_streams a<font></font>
 <span class="hljs-keyword">CROSS</span> <span class="hljs-keyword">JOIN</span> <font></font>
    state_streams b <font></font>
 <span class="hljs-keyword">WHERE</span> 
    <span class="hljs-keyword">ABS</span>(a.total_streams - b.total_streams) &lt; <span class="hljs-number">1000</span>
    <span class="hljs-keyword">AND</span> 
    a.state &lt;&gt; b.state </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para información, las combinaciones cruzadas también se pueden escribir sin especificar explícitamente las combinaciones:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span>
    a.state <span class="hljs-keyword">as</span> state_a, <font></font>
    b.state <span class="hljs-keyword">as</span> state_b 
 <span class="hljs-keyword">FROM</span>   <font></font>
    state_streams a, state_streams b <font></font>
 <span class="hljs-keyword">WHERE</span> 
    <span class="hljs-keyword">ABS</span>(a.total_streams - b.total_streams) &lt; <span class="hljs-number">1000</span>
    <span class="hljs-keyword">AND</span> 
    a.state &lt;&gt; b.state </code></pre><br>
<a name="23"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 2</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> esta es una pregunta adicional en lugar de una plantilla SQL realmente importante. </font><font style="vertical-align: inherit;">¡Puedes saltarte! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarea:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¿cómo puedo modificar SQL de una solución anterior para eliminar duplicados? </font><font style="vertical-align: inherit;">Por ejemplo, el ejemplo de la misma mesa, al vapor </font></font><code>NC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>SC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">solo hubo una vez, no dos. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisión:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span>
    a.state <span class="hljs-keyword">as</span> state_a, <font></font>
    b.state <span class="hljs-keyword">as</span> state_b 
 <span class="hljs-keyword">FROM</span>   <font></font>
    state_streams a, state_streams b <font></font>
 <span class="hljs-keyword">WHERE</span> 
    <span class="hljs-keyword">ABS</span>(a.total_streams - b.total_streams) &lt; <span class="hljs-number">1000</span>
    <span class="hljs-keyword">AND</span> 
    a.state &gt; b.state </code></pre><br>
<a name="24"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 3. Cálculos avanzados</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reconocimiento:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> esta tarea se adaptó de una </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">discusión</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre una pregunta que hice en StackOverflow (mi apodo es zthomas.nc). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: esta es</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> probablemente una tarea más difícil de lo que se le ofrecerá en una entrevista real. </font><font style="vertical-align: inherit;">Piénselo más como un rompecabezas, ¡o puede omitirlo! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> supongamos que tenemos una tabla de </font></font><code>table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">este tipo, donde </font></font><code>user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diferentes valores de una clase pueden corresponder </font><font style="vertical-align: inherit;">al mismo usuario </font></font><code>class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El | </font><font style="vertical-align: inherit;">usuario | </font><font style="vertical-align: inherit;">clase |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ------ | ------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">a |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">b |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">b |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">b |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">a |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problema:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> suponga que solo hay dos valores posibles para una clase. </font><font style="vertical-align: inherit;">Escriba una consulta para calcular el número de usuarios en cada clase. </font><font style="vertical-align: inherit;">En este caso, los usuarios con ambas etiquetas </font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deben referirse a la clase </font></font><code>b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para nuestra muestra, obtenemos el siguiente resultado:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El | </font><font style="vertical-align: inherit;">clase | </font><font style="vertical-align: inherit;">contar |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ------- | ------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">a | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El | </font><font style="vertical-align: inherit;">b | </font><font style="vertical-align: inherit;">2 |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisión:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> usr_b_sum <span class="hljs-keyword">AS</span> <font></font>
(<font></font>
    <span class="hljs-keyword">SELECT</span> 
        <span class="hljs-keyword">user</span>, 
        <span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">class</span> = <span class="hljs-string">'b'</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>) num_b
    <span class="hljs-keyword">FROM</span> 
        <span class="hljs-keyword">table</span>
    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
        <span class="hljs-keyword">user</span><font></font>
), <font></font>
<font></font>
usr_class_label <span class="hljs-keyword">AS</span> <font></font>
(<font></font>
    <span class="hljs-keyword">SELECT</span> 
        <span class="hljs-keyword">user</span>, 
        <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> num_b &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'b'</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-string">'a'</span> <span class="hljs-keyword">END</span> <span class="hljs-keyword">class</span> 
    <span class="hljs-keyword">FROM</span> <font></font>
        usr_b_sum<font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">SELECT</span> 
    <span class="hljs-keyword">class</span>, 
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> <span class="hljs-keyword">user</span>) <span class="hljs-keyword">count</span> 
<span class="hljs-keyword">FROM</span><font></font>
    usr_class_label<font></font>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
    <span class="hljs-keyword">class</span> 
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 
    <span class="hljs-keyword">class</span> <span class="hljs-keyword">ASC</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una solución alternativa utiliza instrucciones </font></font><code>SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en los operadores </font></font><code>SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>UNION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> 
    <span class="hljs-string">"a"</span> <span class="hljs-keyword">class</span>,
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> user_id) - <font></font>
        (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> user_id) <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">class</span> = <span class="hljs-string">'b'</span>) <span class="hljs-keyword">count</span> 
<span class="hljs-keyword">UNION</span>
<span class="hljs-keyword">SELECT</span> 
    <span class="hljs-string">"b"</span> <span class="hljs-keyword">class</span>,<font></font>
    (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> user_id) <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">class</span> = <span class="hljs-string">'b'</span>) <span class="hljs-keyword">count</span> </code></pre></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es500346/index.html">Problemas con DNS en Kubernetes. Post-mortem público</a></li>
<li><a href="../es500348/index.html">La pandemia de COVID-19 a través de los ojos de un matemático, o por qué el clásico modelo SEIRD no funciona</a></li>
<li><a href="../es500352/index.html">¿Cómo obtener una pasantía en Facebook y obtener una oferta en Londres? Haga una pregunta a un ingeniero de Facebook</a></li>
<li><a href="../es500354/index.html">Una nueva forma de rastrear datos en Google Tag Manager: etiquetado del lado del servidor</a></li>
<li><a href="../es500356/index.html">Transferencia directa de archivos entre dispositivos a través de WebRTC</a></li>
<li><a href="../es500364/index.html">Expandir el portal de aprendizaje escolar en Moodle y BigBlueButton</a></li>
<li><a href="../es500368/index.html">Generando secuencias aleatorias predecibles: un enfoque diferente para la permutación</a></li>
<li><a href="../es500370/index.html">10 podcasts útiles en inglés para programadores a los que vale la pena suscribirse en 2020</a></li>
<li><a href="../es500378/index.html">Búsqueda efectiva de información en el trabajo</a></li>
<li><a href="../es500380/index.html">Procesamiento de datos personales de forma remota: riesgos y posibles consecuencias</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>