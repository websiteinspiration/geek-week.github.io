<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòâ üö∫ üÄÑÔ∏è Inexpressivelmente atraente: como criamos um haniot que n√£o pode ser exposto üé≠ ü§∑üèø üë®üèæ‚Äç‚öïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=", - - ‚Äî , ¬´ ¬ª . , : , . , , , . , , ¬´Caught in the Act: Running a Realistic Factory Honeypot to Capture Real Threats¬ª. ‚Äî . 
 
  : -
 A principal taref...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Inexpressivelmente atraente: como criamos um haniot que n√£o pode ser exposto</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/trendmicro/blog/490406/"><img src="https://habrastorage.org/webt/qi/wa/e3/qiwae34tux4xxeobnrua7xsjo48.png" alt="imagem"><br>
<i> , -       - ‚Äî ,  ¬´  ¬ª        .    ,      :   ,        .     ,    ,        ,    .  ,   ,      ¬´<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Caught in the Act: Running a Realistic Factory Honeypot to Capture Real Threats</a>¬ª.     ‚Äî   . </i><br>
<a name="habracut"></a><br>
<h3> : -</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A principal tarefa na cria√ß√£o da nossa super armadilha foi impedir que f√¥ssemos expostos por hackers que demonstrassem interesse nela. </font><font style="vertical-align: inherit;">Para isso, tive que fazer muito trabalho:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crie uma lenda realista sobre a empresa, incluindo o nome e a foto dos funcion√°rios, n√∫meros de telefone e e-mails.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inventar e implementar um modelo de infraestrutura industrial que corresponda √† lenda da nossa empresa. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decida quais servi√ßos de rede estar√£o dispon√≠veis fora, mas n√£o se envolva na abertura de portas vulner√°veis, para que n√£o pare√ßa uma armadilha para galeir√µes. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organize a apar√™ncia de vazamento de informa√ß√µes sobre o sistema vulner√°vel e divulgue essas informa√ß√µes entre os poss√≠veis invasores.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementar vigil√¢ncia discreta de hackers na infraestrutura de armadilhas. </font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E agora, as primeiras coisas primeiro.</font></font><br>
<br>
<h3><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criando uma legenda</font></font></b></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os cibercriminosos j√° est√£o acostumados ao fato de encontrar muitas manipula√ß√µes; portanto, a parte mais avan√ßada deles realiza um estudo aprofundado de cada sistema vulner√°vel para garantir que isso n√£o seja uma armadilha. Pela mesma raz√£o, nos esfor√ßamos para alcan√ßar n√£o apenas o realismo do hanipot em termos de design e aspectos t√©cnicos, mas tamb√©m para criar a apar√™ncia de uma empresa real. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Colocando-nos no lugar de um hipot√©tico kulhaker, desenvolvemos um algoritmo de verifica√ß√£o que distinguiria um sistema real de uma armadilha. Isso incluiu a pesquisa de endere√ßos IP da empresa em sistemas de reputa√ß√£o, a pesquisa reversa do hist√≥rico de endere√ßos IP, a pesquisa de nomes e palavras-chave relacionados √† empresa, bem como suas contrapartes e muitas outras coisas. Como resultado, a lenda acabou sendo bastante convincente e atraente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decidimos posicionar a f√°brica de armadilhas como uma pequena boutique de prototipagem industrial, trabalhando para grandes clientes an√¥nimos do segmento militar e de avia√ß√£o. Isso eliminou as dificuldades legais associadas ao uso de uma marca existente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, tivemos que ter uma vis√£o, miss√£o e nome da organiza√ß√£o. Decidimos que nossa empresa seria uma startup com um pequeno n√∫mero de funcion√°rios, cada um dos quais fundador. Isso agregou credibilidade √† lenda da especializa√ß√£o de nossos neg√≥cios, o que lhe permite trabalhar com projetos delicados para clientes grandes e importantes. Quer√≠amos que nossa empresa parecesse fraca em termos de seguran√ßa cibern√©tica, mas ao mesmo tempo era √≥bvio que est√°vamos trabalhando com ativos importantes nos sistemas de destino.</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/6d/hw/gu/6dhwguxausaawidgg95iywb01-m.png" alt="imagem"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Captura de tela do site MeTech Hanipot. Fonte: Trend Micro.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Escolhemos a palavra MeTech como o nome da empresa. O site foi criado com base em um modelo gratuito. As imagens foram tiradas de bancos de fotos, usando as mais impopulares e refinadas para torn√°-las menos reconhec√≠veis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como quer√≠amos que a empresa parecesse real, tivemos que adicionar funcion√°rios com habilidades profissionais correspondentes ao perfil do neg√≥cio. Criamos nomes e personalidades para eles e, em seguida, tentamos selecionar imagens de bancos de fotos de acordo com sua etnia. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/sp/vo/7s/spvo7snoj5ph5lxm5an3uhh4vxo.png" alt="imagem"><br>
<i><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Captura de tela do site MeTech Hanipot. Fonte: Trend Micro</font></font></i></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para n√£o nos revelar, procur√°vamos fotos de grupo de boa qualidade, nas quais pod√≠amos escolher os rostos de que precis√°vamos. </font><font style="vertical-align: inherit;">No entanto, abandonamos essa op√ß√£o, pois um potencial cracker poderia tirar proveito da pesquisa reversa de imagens e descobrir que nossos "funcion√°rios" vivem apenas em bancos de fotos. </font><font style="vertical-align: inherit;">No final, aproveitamos as fotografias de pessoas inexistentes criadas usando redes neurais. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os perfis de funcion√°rios publicados no site continham informa√ß√µes importantes sobre suas habilidades t√©cnicas, mas evitamos as instru√ß√µes de institui√ß√µes e cidades educacionais espec√≠ficas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para criar caixas de correio, usamos o servidor do provedor de hospedagem e alugamos v√°rios n√∫meros de telefone nos EUA e os combinamos em uma central telef√¥nica virtual com um menu de voz e uma secret√°ria eletr√¥nica.</font></font><br>
<br>
<h3><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infraestrutura Hanipot</font></font></b></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para evitar ser exposto, decidimos usar uma combina√ß√£o de equipamentos industriais reais, computadores f√≠sicos e m√°quinas virtuais seguras. </font><font style="vertical-align: inherit;">Olhando para o futuro, dizemos que verificamos o resultado de nossos esfor√ßos usando o mecanismo de busca Shodan, e ele mostrou que o hanipot parece um sistema industrial real. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/wf/k_/_4/wfk__4gu5azv2hwi4vwtw2d_ajw.png" alt="imagem"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O resultado da digitaliza√ß√£o de um hanipot usando Shodan. </font><font style="vertical-align: inherit;">Fonte: Trend Micro.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Utilizamos quatro PLCs como hardware para nossa armadilha:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Siemens S7-1200,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dois AllenBradley MicroLogix 1100,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Omron CP1L.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esses PLCs foram selecionados por sua popularidade no mercado global de sistemas de controle. </font><font style="vertical-align: inherit;">E cada um desses controladores usa seu pr√≥prio protocolo, o que nos permite verificar quais PLCs atacar√£o com mais frequ√™ncia e se interessar√£o a algu√©m em princ√≠pio. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/zv/tx/hs/zvtxhskzoo7llc8cbeurbmx7tt0.png" alt="imagem"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O equipamento da nossa armadilha de "f√°brica". </font><font style="vertical-align: inherit;">Fonte: Trend Micro</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
N√£o colocamos apenas peda√ßos de ferro e os conectamos √† Internet. </font><font style="vertical-align: inherit;">Programamos cada controlador para executar tarefas, entre as quais</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mistura</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">controle de queimador e correia transportadora,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">paletiza√ß√£o usando um bra√ßo rob√≥tico.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E para tornar o processo de produ√ß√£o realista, programamos a l√≥gica para alterar aleatoriamente os par√¢metros de feedback, simular a partida e a parada dos motores, ligando e desligando o queimador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nossa f√°brica tinha tr√™s computadores virtuais e um f√≠sico. As m√°quinas virtuais foram usadas para controlar a planta, o rob√¥ de paletiza√ß√£o e como local de trabalho automatizado do engenheiro de software PLC. O computador f√≠sico funcionou como um servidor de arquivos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m de monitorar ataques no PLC, quer√≠amos monitorar o status dos programas baixados para nossos dispositivos. Para isso, criamos uma interface que nos permitiu determinar rapidamente como os estados de nossos atuadores e instala√ß√µes virtuais foram modificados. J√° no est√°gio de planejamento, descobrimos que √© muito mais f√°cil implement√°-lo com a ajuda de um programa de controle do que atrav√©s da programa√ß√£o direta da l√≥gica do controlador. Abrimos o acesso √† interface de gerenciamento de dispositivos do nosso hanipot via VNC sem senha.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os rob√¥s industriais s√£o um componente-chave da moderna fabrica√ß√£o inteligente. Nesse sentido, decidimos adicionar um rob√¥ e AWP para control√°-lo no equipamento de nossa armadilha de f√°brica. Para tornar a "f√°brica" ‚Äã‚Äãmais realista, instalamos software real no controle AWP, que os engenheiros usam para programar graficamente a l√≥gica do rob√¥. Bem, como os rob√¥s industriais geralmente est√£o localizados em uma rede interna isolada, decidimos deixar o acesso VNC desprotegido apenas ao gerenciamento da esta√ß√£o de trabalho. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/z9/p1/ku/z9p1kujj4-pokliqn7lmacs0oes.png" alt="imagem"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ambiente RobotStudio com um modelo 3D do nosso rob√¥. Fonte: Trend Micro</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em uma m√°quina virtual com uma esta√ß√£o de trabalho de controle de rob√¥, instalamos o ambiente de programa√ß√£o RobotStudio da ABB Robotics. </font><font style="vertical-align: inherit;">Depois de configurar o RobotStudio, abrimos nele um arquivo de simula√ß√£o com o nosso rob√¥, para que sua imagem 3D fosse vis√≠vel na tela. </font><font style="vertical-align: inherit;">Como resultado, Shodan e outros mecanismos de pesquisa, tendo descoberto um servidor VNC desprotegido, receber√£o essa imagem da tela e a mostrar√£o para aqueles que procuram rob√¥s industriais com acesso aberto ao controle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O significado dessa aten√ß√£o aos detalhes era criar um objetivo atraente e mais realista para os atacantes que, depois de descobri-lo, voltariam a ele de novo e de novo.</font></font><br>
<br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Engenheiro AWP</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para programar a l√≥gica do PLC, adicionamos um computador de engenharia √† infraestrutura. </font><font style="vertical-align: inherit;">Foi instalado um software industrial para programa√ß√£o de PLC:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portal TIA para Siemens,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MicroLogix para controlador Allen-Bradley,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CX-One para Omron.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decidimos que a esta√ß√£o de trabalho de engenharia n√£o estaria acess√≠vel fora da rede. </font><font style="vertical-align: inherit;">Em vez disso, definimos a mesma senha para a conta de administrador e nas esta√ß√µes de trabalho do controle do rob√¥ e nas esta√ß√µes de trabalho da f√°brica acess√≠veis pela Internet. </font><font style="vertical-align: inherit;">Essa configura√ß√£o √© bastante comum em muitas empresas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infelizmente, apesar de todos os nossos esfor√ßos, nenhum invasor chegou ao AWP do engenheiro.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servidor de arquivos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Precis√°vamos disso como um engodo para invasores e como meio de fazer backup de nosso pr√≥prio "trabalho" em uma f√°brica de armadilhas. Isso nos permitiu compartilhar arquivos com nosso haniot usando dispositivos USB, sem deixar vest√≠gios na armadilha da rede. Como sistema operacional do servidor de arquivos, instalamos o Windows 7 Pro, no qual tornamos uma pasta compartilhada acess√≠vel para leitura e grava√ß√£o para qualquer pessoa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inicialmente, n√£o fizemos nenhuma hierarquia de pastas e documentos no servidor de arquivos. No entanto, verificou-se que os invasores estavam estudando ativamente essa pasta, ent√£o decidimos preench√™-la com v√°rios arquivos. Para fazer isso, escrevemos um script python que criou um arquivo de tamanho aleat√≥rio com uma das extens√µes especificadas, formando um nome com base no dicion√°rio. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/55/ra/ok/55raoklawy-fcys1bf5eevbeaii.png" alt="imagem"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um script para gerar nomes de arquivos atraentes. Fonte: Trend Micro</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s executar o script, obtivemos o resultado desejado na forma de uma pasta cheia de arquivos com nomes muito interessantes. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/ll/fw/8i/llfw8i9bqf7zhbz6fffj3nrg99i.png" alt="imagem"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O resultado do script. </font><font style="vertical-align: inherit;">Fonte: Trend Micro</font></font></i><br>
<br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ambiente de monitoramento</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tendo investido tanto esfor√ßo na cria√ß√£o de uma empresa realista, simplesmente n√£o nos pod√≠amos dar ao luxo de nos injetar no ambiente para monitorar nossos ‚Äúvisitantes‚Äù. Tivemos que obter todos os dados em tempo real para que os invasores n√£o percebessem que estavam sendo observados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Implementamos isso usando quatro adaptadores USB-Ethernet, quatro acopladores SharkTap Ethernet, Raspberry Pi 3 e uma grande unidade externa. O esquema de nossa rede era assim: </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/j5/94/g8/j594g8h2lljwitq06azjhb62ots.png" alt="imagem"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esquema de uma rede hanipot com equipamento de monitoramento. Fonte: Trend Micro</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Organizamos tr√™s torneiras SharkTap para monitorar todo o tr√°fego externo para PLCs acess√≠veis apenas a partir da rede interna. O quarto SharkTap rastreou o tr√°fego de convidados da m√°quina virtual vulner√°vel.</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/pg/c9/gp/pgc9gpcpjeuykehtqxytnv7y5ru.png" alt="imagem"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acoplador SharkTap Ethernet e roteador Sierra Wireless AirLink RV50. </font><font style="vertical-align: inherit;">Fonte: Trend Micro</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Raspberry Pi realizou captura di√°ria de tr√°fego. </font><font style="vertical-align: inherit;">Estabelecemos uma conex√£o com a Internet usando o roteador celular Sierra Wireless AirLink RV50, geralmente usado em empresas industriais. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infelizmente, este roteador n√£o permitiu o bloqueio seletivo de ataques que n√£o atendiam aos nossos planos, portanto adicionamos √† rede o firewall Cisco ASA 5505 de modo transparente √† rede para executar o bloqueio com um impacto m√≠nimo na rede.</font></font><br>
<br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An√°lise de tr√°fego</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tshark e tcpdump s√£o apropriados para resolver rapidamente os problemas atuais, mas, no nosso caso, seus recursos n√£o eram suficientes, pois t√≠nhamos muitos gigabytes de tr√°fego, que foram analisados ‚Äã‚Äãpor v√°rias pessoas. </font><font style="vertical-align: inherit;">Utilizamos o analisador de c√≥digo aberto Moloch desenvolvido pela AOL. </font><font style="vertical-align: inherit;">Em termos de funcionalidade, √© compar√°vel ao Wireshark, mas possui mais recursos para colabora√ß√£o, descri√ß√£o e marca√ß√£o de pacotes, exporta√ß√£o e outras tarefas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como n√£o queremos processar os dados coletados nos computadores hanipot, os dumps de PCAP foram exportados diariamente para o reposit√≥rio da AWS, de onde j√° os importamos para a m√°quina com Moloch.</font></font><br>
<br>
<h3><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grava√ß√£o de tela </font></font></b></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para documentar as a√ß√µes dos crackers em nosso hanipot, escrevemos um script que tirava capturas de tela da m√°quina virtual em um determinado intervalo e, comparando com a captura de tela anterior, determinava se algo estava acontecendo l√° ou n√£o. </font><font style="vertical-align: inherit;">Quando a atividade foi detectada, o script incluiu uma grava√ß√£o de tela. </font><font style="vertical-align: inherit;">Essa abordagem provou ser a mais eficaz. </font><font style="vertical-align: inherit;">Tamb√©m tentamos analisar o tr√°fego VNC do dump PCAP para entender quais mudan√ßas ocorreram no sistema, mas, no final, a grava√ß√£o da tela que implementamos acabou sendo mais simples e visual.</font></font><br>
<br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monitorando sess√µes VNC</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para isso, usamos o Chaosreader e o VNCLogger. </font><font style="vertical-align: inherit;">Ambos os utilit√°rios extraem pressionamentos de tecla do dump PCAP, mas o VNCLogger manipula teclas como Backspace, Enter, Ctrl mais corretamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O VNCLogger tem duas desvantagens. </font><font style="vertical-align: inherit;">Primeiro: ele s√≥ pode extrair chaves ‚Äúouvindo‚Äù o tr√°fego na interface, ent√£o tivemos que simular uma sess√£o VNC para ela usando tcpreplay. </font><font style="vertical-align: inherit;">A segunda desvantagem do VNCLogger √© comum no Chaosreader: ambos n√£o mostram o conte√∫do da √°rea de transfer√™ncia. </font><font style="vertical-align: inherit;">Para fazer isso, eu tive que usar o Wireshark.</font></font><br>
<br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atrair hackers</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Criamos um hanipot para ser atacado. </font><font style="vertical-align: inherit;">Para conseguir isso, organizamos um vazamento de informa√ß√µes projetado para atrair a aten√ß√£o de poss√≠veis crackers. </font><font style="vertical-align: inherit;">As seguintes portas foram abertas no hanipot: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/s5/ck/ma/s5ckmab2jeiqlxn58v51ywkyqe0.png" alt="imagem"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A porta RDP teve que ser fechada logo ap√≥s o in√≠cio do trabalho, porque devido √† enorme quantidade de tr√°fego de varredura em nossa rede, houve problemas de desempenho. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os terminais VNC trabalharam primeiro no modo "somente visualiza√ß√£o" sem uma senha e, em seguida, "por engano" os mudamos para o modo de acesso total. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para atrair os atacantes, postamos duas postagens com informa√ß√µes vazadas sobre o sistema industrial dispon√≠vel no PasteBin. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/4g/qf/lk/4gqflk8fpyjhxqhbxwtscepi_nm.png" alt="imagem"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma das postagens publicadas no PasteBin para atrair ataques. </font><font style="vertical-align: inherit;">Fonte: Trend Micro</font></font></i><br>
<br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ataques</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os Hanipot viveram on-line por cerca de sete meses. O primeiro ataque ocorreu um m√™s ap√≥s o lan√ßamento do Hanipot online. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scanners</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Havia muito tr√°fego de scanners de empresas conhecidas - ip-ip, Rapid, Shadow Server, Shodan, ZoomEye e outros. Havia tantos deles que tivemos que excluir seus endere√ßos IP da an√°lise: 610 de 9452 ou 6,45% de todos os endere√ßos IP exclusivos pertenciam a scanners completamente leg√≠timos. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fraudadores</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Um dos maiores riscos que tivemos de enfrentar foi o uso de nosso sistema para fins criminosos: comprar smartphones por meio de uma conta do assinante, dinheiro fora milhas a√©reas com cart√µes de presente e outros tipos de fraude </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mineiros</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dos primeiros visitantes do nosso sistema acabou sendo um mineiro. Ele enviou o software de minera√ß√£o Monero para ele. Ele n√£o teria conseguido ganhar muito em nosso sistema espec√≠fico devido √† baixa produtividade. No entanto, se combinarmos os esfor√ßos de v√°rias dezenas ou mesmo centenas desses sistemas, pode resultar muito bem. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extorsionistas</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante a opera√ß√£o do hanipot, encontramos duas vezes v√≠rus de ransomware reais. No primeiro caso, foi Crysis. Seus operadores efetuaram logon no sistema atrav√©s do VNC, mas instalaram o TeamViewer e j√° executaram outras a√ß√µes com ele. Depois de esperar por uma mensagem de ransomware exigindo um resgate de US $ 10.000 no BTC, entramos em correspond√™ncia com os criminosos, pedindo que eles descriptografassem um dos arquivos para n√≥s. Eles atenderam √† solicita√ß√£o e repetiram a demanda de resgate. Conseguimos negociar at√© 6 mil d√≥lares, ap√≥s o que simplesmente recarregamos o sistema em uma m√°quina virtual, porque obtivemos todas as informa√ß√µes necess√°rias. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo ransomware foi o Phobos. O hacker que o instalou por uma hora examinou o sistema de arquivos do hanipot e examinou a rede e ainda instalou o ransomware.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O terceiro ataque de ransomware acabou sendo falso. </font><font style="vertical-align: inherit;">Um "hacker" desconhecido baixou o arquivo haha.bat para o nosso sistema, ap√≥s o qual assistimos por algum tempo como ele estava tentando faz√™-lo funcionar. </font><font style="vertical-align: inherit;">Uma tentativa foi renomear haha.bat para haha.rnsmwr. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/53/nj/r1/53njr1nbgvuvbdsuo4aythx-n7e.png" alt="imagem"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Hacker" aumenta a nocividade do arquivo bat, alterando sua extens√£o para .rnsmwr. </font><font style="vertical-align: inherit;">Fonte: Trend Micro</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Quando o arquivo em lote finalmente come√ßou a ser executado, o hacker o editou, aumentando o resgate de US $ 200 para US $ 750. </font><font style="vertical-align: inherit;">Depois disso, ele "criptografou" todos os arquivos, deixou uma mensagem de ransomware na √°rea de trabalho e desapareceu, alterando as senhas em nosso VNC. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de alguns dias, o hacker voltou e, para se lembrar, lan√ßou um arquivo em lotes, que abriu muitas janelas com um site porn√¥. </font><font style="vertical-align: inherit;">Aparentemente, dessa maneira, ele tentou chamar a aten√ß√£o para sua demanda.</font></font><br>
<br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sum√°rio</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante o estudo, descobriu-se que, assim que as informa√ß√µes sobre a vulnerabilidade foram publicadas, o hanipot atraiu a aten√ß√£o e a atividade cresceu dia a dia. Para que a armadilha atra√≠sse a aten√ß√£o, tivemos que cometer muitas viola√ß√µes de seguran√ßa de nossa empresa fict√≠cia. Infelizmente, essa situa√ß√£o est√° longe de ser rara entre muitas empresas reais que n√£o possuem pessoal de TI e seguran√ßa da informa√ß√£o em tempo integral. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No caso geral, as organiza√ß√µes devem usar o princ√≠pio do menor privil√©gio, enquanto implementamos exatamente o oposto para atrair invasores. E quanto mais assistimos aos ataques, mais sofisticados eles se tornaram em compara√ß√£o aos m√©todos de teste de penetra√ß√£o padr√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E o mais importante: todos esses ataques falhariam se medidas de seguran√ßa adequadas fossem implementadas ao configurar a rede. </font><font style="vertical-align: inherit;">As organiza√ß√µes devem garantir que seus equipamentos e componentes de infraestrutura industrial n√£o sejam acess√≠veis pela Internet, como fizemos especificamente em nossa armadilha. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Embora n√£o tenhamos registrado um √∫nico ataque na esta√ß√£o de trabalho do engenheiro, apesar de usar a mesma senha de administrador local em todos os computadores, devemos evitar essa pr√°tica para minimizar a possibilidade de invasores. </font><font style="vertical-align: inherit;">De fato, a falta de seguran√ßa serve como um convite adicional para atacar sistemas industriais que h√° muito interessam os criminosos cibern√©ticos.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt490392/index.html">Catchain: Algoritmo de consenso em TON Blockchain</a></li>
<li><a href="../pt490394/index.html">Comodoro Amiga 500+: ningu√©m fique ofendido</a></li>
<li><a href="../pt490398/index.html">Hogwarts vermelha. Oficiais, ou Por que um historiador √© como um detetive</a></li>
<li><a href="../pt490400/index.html">Usando a biblioteca OpenCV para reconhecer arcos el√≠pticos em se√ß√µes 2D de nuvens de pontos 3D</a></li>
<li><a href="../pt490404/index.html">Por que e como o 5G mudar√° tudo: tecnologia, implementa√ß√£o em fases e base de elementos para equipamentos de assinantes</a></li>
<li><a href="../pt490408/index.html">FreeBSD: –≥–æ—Ä–∞–∑–¥–æ –ª—É—á—à–µ GNU/Linux</a></li>
<li><a href="../pt490410/index.html">Neur√¥nios vivos e artificiais conectados via Internet</a></li>
<li><a href="../pt490416/index.html">V√≠deo da Palestra do Clube de Ci√™ncia da Computa√ß√£o</a></li>
<li><a href="../pt490418/index.html">Millennials e gera√ß√£o Alpha VS ensino superior</a></li>
<li><a href="../pt490420/index.html">Lifehacks para desenvolvedores de um recrutador</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>