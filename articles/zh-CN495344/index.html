<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ”“ â„¹ï¸ â™“ï¸ ç»Ÿä¸€å®ƒï¼šLamodaå¦‚ä½•ä½¿å…¶GoæœåŠ¡ä¿æŒä¸€è‡´ ğŸŒ âœŒğŸ¾ ğŸ™ˆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å°½ç®¡æˆ‘ä»¬è®¤ä¸ºå¾®æœåŠ¡æ¶æ„ä¸æ˜¯ä¸‡èƒ½è¯ï¼Œä½†æˆ‘ä»¬ä»åœ¨å¹¿æ³›ä½¿ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œå¤§çº¦ä¸¤å¹´å‰ï¼Œæˆ‘ä»¬å¼€å§‹è½¬å‘Goè¯­è¨€ã€‚å®ƒç›¸å¯¹ç®€å•ï¼Œæˆ‘è®¤ä¸ºéå¸¸é€‚åˆåˆ›å»ºç®€å•ï¼Œå°å‹å’Œå¿«é€Ÿçš„å¾®æœåŠ¡ã€‚è¿™ç§ç®€å•æ€§æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼šæ­£å› ä¸ºå¦‚æ­¤ï¼Œæœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥è§£å†³ç›¸åŒçš„é—®é¢˜ã€‚
 

çœ‹èµ·æ¥ï¼Œå»æ•°æ®åº“çš„ä¸€ä¸ªå¾®æœåŠ¡ä¸å»é‚»è¿‘æ•°æ®åº“çš„å¦ä¸€ä¸ªå¾®æœåŠ¡æœ‰å¤šå°‘ä¸åŒï¼Ÿä¾‹å¦‚ï¼Œ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ç»Ÿä¸€å®ƒï¼šLamodaå¦‚ä½•ä½¿å…¶GoæœåŠ¡ä¿æŒä¸€è‡´</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lamoda/blog/495344/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°½ç®¡æˆ‘ä»¬è®¤ä¸ºå¾®æœåŠ¡æ¶æ„ä¸æ˜¯ä¸‡èƒ½è¯ï¼Œä½†æˆ‘ä»¬ä»åœ¨å¹¿æ³›ä½¿ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œå¤§çº¦ä¸¤å¹´å‰ï¼Œæˆ‘ä»¬å¼€å§‹è½¬å‘Goè¯­è¨€ã€‚</font><font style="vertical-align: inherit;">å®ƒç›¸å¯¹ç®€å•ï¼Œæˆ‘è®¤ä¸ºéå¸¸é€‚åˆåˆ›å»ºç®€å•ï¼Œå°å‹å’Œå¿«é€Ÿçš„å¾®æœåŠ¡ã€‚</font><font style="vertical-align: inherit;">è¿™ç§ç®€å•æ€§æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼šæ­£å› ä¸ºå¦‚æ­¤ï¼Œæœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥è§£å†³ç›¸åŒçš„é—®é¢˜ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çœ‹èµ·æ¥ï¼Œå»æ•°æ®åº“çš„ä¸€ä¸ªå¾®æœåŠ¡ä¸å»é‚»è¿‘æ•°æ®åº“çš„å¦ä¸€ä¸ªå¾®æœåŠ¡æœ‰å¤šå°‘ä¸åŒï¼Ÿ</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œä¸€ä¸ªå›¢é˜Ÿä½¿ç”¨Go 1.9ï¼Œglideï¼Œæ ‡å‡†æ•°æ®åº“/ sqlå’Œä¸€ä¸ªé¡¹ç›®ç»“æ„ï¼Œè€Œå¦ä¸€å›¢é˜Ÿåˆ™ä½¿ç”¨Go 1.13ï¼Œæ¨¡å—ï¼Œsqlxï¼Œå½“ç„¶ä¹Ÿä½¿ç”¨å¦ä¸€é¡¹ç›®ç»“æ„ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“å…¬å¸ä¸­çš„ä¸€é¡¹å¾®æœåŠ¡ä¸å¦ä¸€é¡¹å¾®æœåŠ¡ä¸åŒï¼Œè€Œåˆä¸ç¬¬ä¸‰é¡¹å¾®æœåŠ¡ä¸åŒæ—¶ï¼Œè¿™ä¼šå‡æ…¢å¼€å‘é€Ÿåº¦ã€‚</font><font style="vertical-align: inherit;">ç¼“æ…¢çš„å¼€å‘æ˜¯</font><font style="vertical-align: inherit;">ä¼˜åŒ–</font><font style="vertical-align: inherit;">çš„</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŸå¤±</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å«Alexey Partilovï¼Œæ˜¯Lamodaç½‘ç«™å¼€å‘å›¢é˜Ÿçš„æŠ€æœ¯ä¸»ç®¡ã€‚</font><font style="vertical-align: inherit;">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†æè¿°æˆ‘ä»¬å¦‚ä½•å¤„ç†Goä¸Šçº¦40ç§å¾®æœåŠ¡çš„å¯å˜æ€§ã€‚</font><font style="vertical-align: inherit;">å¯¹äºä»…åŠ å…¥Goè€Œåˆä¸çŸ¥é“åœ¨ä½•å¤„å¯åŠ¨æ¯”helloworldæ›´å¤æ‚çš„é¡¹ç›®çš„å¼€å‘äººå‘˜ï¼Œæœ¬æ–‡å°†éå¸¸æœ‰ç”¨ã€‚</font></font></p><br>
<p><img src="https://habrastorage.org/webt/ab/rl/nw/abrlnwefv_ym93hmomlfzhhslrc.png" alt="å›¾ç‰‡"></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åˆï¼ŒLamodaä½¿ç”¨PHPæ¥å¤„ç†å•ä¸ªç›’è£…æ•´ä½“ã€‚</font><font style="vertical-align: inherit;">ç„¶åéƒ¨åˆ†åŠŸèƒ½å¼€å§‹ç§»è‡³æ–°çš„Pythonå’ŒPHPæœåŠ¡ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨PHPä¸­æ‹¥æœ‰åºå¤§è€Œå¤æ‚çš„ä¸šåŠ¡é€»è¾‘ã€‚</font><font style="vertical-align: inherit;">è¿™äº›åº”ç”¨ç¨‹åºç”¨äºæˆ‘ä»¬çš„è¿è¥æ´»åŠ¨çš„è‡ªåŠ¨åŒ–ï¼šäº¤ä»˜ï¼Œç…§ç›¸é¦†ï¼Œä¼šå‘˜æœåŠ¡ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬è¿˜ç”¨Javaç¼–å†™äº†ä¸€ä¸ªæ•´ä½“ï¼Œå¯è‡ªåŠ¨æ‰§è¡Œä»“åº“ä¸­çš„è®¸å¤šå¤æ‚æµç¨‹ã€‚</font></font></p><br>
<p>       ,       ,         . </p><br>
<p> e-commerce          Python     Golang. ,      UI    Python+Django.</p><br>
<p>       ,        .      . </p><br>
<p>    ,           .  backend-   ,     ,    ,      ,    .</p><br>
<p>              .</p><br>
<h1>0. Spec first</h1><br>
<p>      ,  : <i>          ,      OpenAPI.</i></p><br>
<p>    :</p><br>
<ul>
<li>Backend-,   ,     -     .        .</li>
<li>Frontend-    backend,     .     mock     backend       .</li>
<li>     boilerplate- c  ,     . ,   ,    ,    .</li>
</ul><br>
<p>     OpenAPI-    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> go-swagger </a>(    gogi).      opensource,    ,            .</p><br>
<blockquote>  ,          .  ,      ,    ,      . <br>
</blockquote><p>     ,    docker-.   ,           .      docker.        Makefile: </p><br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><pre><code class="plaintext hljs">.PHONY: generate<font></font>
generate:<font></font>
    #    <font></font>
    rm -rf internal/generated/*<font></font>
    docker run -it \<font></font>
    #     <font></font>
    -v $(PWD)/internal/generated:$(DOCKER_SOURCE_DIR)/internal/generated \<font></font>
    #    OpenAPI <font></font>
    -v $(PWD)/specs:$(DOCKER_SOURCE_DIR)/specs \<font></font>
    #    gogi<font></font>
    -v $(PWD)/gogi.yaml:$(DOCKER_SOURCE_DIR)/gogi.yaml \<font></font>
    #  workdir<font></font>
    -w="$(DOCKER_SOURCE_DIR)" \<font></font>
    gotools.docker.lamoda.ru/gogi:v1.3.2 generate</code></pre></div></div><br>
<h1>1.  </h1><br>
<p>          .        ,  ,    .          ,    -.    â€” ,      :</p><br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><pre><code class="plaintext hljs">/<font></font>
â”œâ”€â”€ cmd<font></font>
â”œâ”€â”€ deployments<font></font>
â”œâ”€â”€ internal<font></font>
â”œâ”€â”€ migrations<font></font>
â”œâ”€â”€ specs<font></font>
â”œâ”€â”€ tests<font></font>
â”œâ”€â”€ go.mod<font></font>
â”œâ”€â”€ go.sum<font></font>
â”œâ”€â”€ Dockerfile<font></font>
â”œâ”€â”€ main.go<font></font>
...</code></pre></div></div><br>
<p>                .</p><br>
<p>    ,       (    Postgres),     production-, Kafka     API.    ?  .          .</p><br>
<p>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">cookiecutter.</a>             .            .      ,     .</p><br>
<h1>2. Go modules</h1><br>
<p>   1.11   Go         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">go modules</a>.   1.14    production-ready.       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">glide</a>,          go modules, , ,    Go-. Go modules        $GOPATH/pkg/mod        GOPATH. </p><br>
<p>     Go       (build, get, test). , build          .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>.</p><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  golang</a>     ,     ,        .        ,   .</p><br>
<p><b> 1.  go modules</b>.       Go   1.13,    $GOPATH,     go mod</p><br>
<pre><code class="bash hljs">go env -w GOMODULE111=<span class="hljs-string">"on"</span></code></pre><br>
<p><b>2.  RSA-   .</b>       RSA- c ,   ,      ssh-agent.         .</p><br>
<pre><code class="bash hljs">ssh-add &lt;  RSA &gt;</code></pre><br>
<p><b>3.    Go proxy. </b>   Go 1.13,       - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">proxy.golang.org</a>,      .    ,       .</p><br>
<pre><code class="bash hljs">go env -w GOPRIVATE=&lt;  &gt;</code></pre><br>
<p><b>4.  go.mod-.</b>       go.mod    .         (, <i>glide</i>),   mod-     lock-.      go.mod â€” ,     .</p><br>
<pre><code class="bash hljs">go mod init &lt;  &gt;</code></pre><br>
<p>        ,   , , <i>github.com/spf13/cobra</i>.</p><br>
<p><b>5.  .</b>       .     ,  , ,  .     ,    .</p><br>
<pre><code class="bash hljs">go <span class="hljs-built_in">test</span> ./...</code></pre><br>
<h1>3.  Docker-</h1><br>
<p> Lamoda         Kubernetes-,    Docker-   .  ,   Go-    Docker- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">golang.</a>       c       Docker-.       Docker-     ,   .</p><br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><pre><code class="plaintext hljs">ARG version<font></font>
FROM golang:$version<font></font>
<font></font>
ENV GOOS linux<font></font>
ENV GOARCH amd64<font></font>
ENV CGO_ENABLED 0<font></font>
ENV GO111MODULE on<font></font>
<font></font>
#      <font></font>
RUN go get github.com/axw/gocov/gocov &amp;&amp; \<font></font>
   go get github.com/AlekSi/gocov-xml@d2f6da892a0d5e0b587526abf51349ad654ade51 &amp;&amp; \<font></font>
   go get golang.org/x/tools/cmd/goimports &amp;&amp; \<font></font>
   curl -sfL https://install.goreleaser.com/github.com/golangci/golangci-lint.sh | sh -s v1.23.7 &amp;&amp; \<font></font>
   go get -u github.com/jstemmer/go-junit-report@af01ea7f8024089b458d804d5cdf190f962a9a0c &amp;&amp; \<font></font>
   rm -rf /go/pkg/mod/<font></font>
<font></font>
#            <font></font>
COPY ./ssh/id_rsa /root/.ssh/id_rsa<font></font>
COPY ./ssh/id_rsa.pub /root/.ssh/id_rsa.pub<font></font>
# Copy Lamoda Root certificate needed to go to the corporate sites without<font></font>
# SSL warning<font></font>
COPY ./certs/LamodaCA.crt /usr/local/share/ca-certificates/LamodaCA.crt<font></font>
<font></font>
RUN echo "StrictHostKeyChecking no" &gt; /root/.ssh/config &amp;&amp; \<font></font>
   chmod 600 /root/.ssh/id_rsa &amp;&amp; \<font></font>
   chmod 600 /root/.ssh/id_rsa.pub &amp;&amp; \<font></font>
   chmod 755 /root/.ssh &amp;&amp; \<font></font>
   update-ca-certificates &amp;&amp; \<font></font>
   #   insteadOf.       Bitbucket  .<font></font>
   git config --global url.ssh://git@stash.lamoda.ru:7999.insteadOf https://stash.lamoda.ru/scm<font></font>
<font></font>
CMD ["/bin/sh"]</code></pre></div></div><br>
<p>   golang-     .      golang    production-.   ,       (    )        :   debian  alpine,  go,  .      Docker-    ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Docker multistage</a>. </p><br>
<p>, Docker multistage â€”     Docker,        ,         ,      ,    .. </p><br>
<p>      : </p><br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><pre><code class="plaintext hljs">FROM gotools.docker.lamoda.ru/base-mod:1.14.0 as build<font></font>
<font></font>
ENV GOOS linux<font></font>
ENV GOARCH amd64<font></font>
ENV CGO_ENABLED 0<font></font>
ENV GO111MODULE on<font></font>
<font></font>
WORKDIR /go/src/stash.lamoda.ru/ecom/discounts.endpoint<font></font>
#     <font></font>
COPY go.mod .<font></font>
COPY go.sum .<font></font>
<font></font>
#  go-. -    Docker          go.mod  go.sum.<font></font>
RUN go mod download<font></font>
COPY . .<font></font>
<font></font>
RUN make build<font></font>
<font></font>
#   docker        ca-certificates.crt<font></font>
FROM scratch<font></font>
COPY --from=build /go/src/stash.lamoda.ru/ecom/discounts.endpoint/discounts /bin/discounts<font></font>
COPY --from=build /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/ca-certificates.crt<font></font>
ENTRYPOINT ["/bin/discounts"]</code></pre></div></div><br>
<h1>4.  </h1><br>
<p>       ,  , Postgres.    ,      . ,        DBA,   .         .    ,        .     SQL-       DBA  DevOps    production . </p><br>
<p>    -  Jira,           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">migrate</a>.       ,      . ,  , migrate    Docker- â€”        . </p><br>
<p>     â€”   migrations     <i>&lt;â„– &gt;_&lt;&gt;.[up|down].sql</i></p><br>
<pre><code class="plaintext hljs">migrations<font></font>
â”œâ”€â”€ 00001_init.down.sql<font></font>
â”œâ”€â”€ 00001_init.up.sql<font></font>
â”œâ”€â”€ 00002_create_ui_users_table.down.sql<font></font>
â”œâ”€â”€ 00002_create_ui_users_table.up.sql<font></font>
...</code></pre><br>
<p><i>up</i> â€”  , ..  ,<br>
<i>down </i>â€”  , ..  . </p><br>
<p>      SQL-,   .</p><br>
<p>  Â«Â»:</p><br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">SEQUENCE</span> ui_users_id_seq <span class="hljs-keyword">INCREMENT</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span> <span class="hljs-keyword">MINVALUE</span> <span class="hljs-number">1</span> <span class="hljs-keyword">START</span> <span class="hljs-number">1</span>;<font></font>
<font></font>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> ui_users (
  <span class="hljs-keyword">id</span> <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<font></font>
  username <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">180</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<font></font>
  username_canonical <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">180</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<font></font>
  email <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">180</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<font></font>
  email_canonical <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">180</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<font></font>
  enabled <span class="hljs-built_in">BOOLEAN</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-keyword">salt</span> <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">255</span>),
  <span class="hljs-keyword">password</span> <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<font></font>
  last_login <span class="hljs-built_in">TIMESTAMP</span>(<span class="hljs-number">0</span>) <span class="hljs-keyword">WITHOUT</span> <span class="hljs-built_in">TIME</span> ZONE <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,<font></font>
  confirmation_token <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">180</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,<font></font>
  password_requested_at <span class="hljs-built_in">TIMESTAMP</span>(<span class="hljs-number">0</span>) <span class="hljs-keyword">WITHOUT</span> <span class="hljs-built_in">TIME</span> ZONE <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-keyword">roles</span> <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<font></font>
  PRIMARY <span class="hljs-keyword">KEY</span>(<span class="hljs-keyword">id</span>)<font></font>
);<font></font>
<span class="hljs-keyword">COMMIT</span>;</code></pre></div></div><br>
<p>  Â«Â»:</p><br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">SEQUENCE</span> public.ui_users_id_seq;<font></font>
<font></font>
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> ui_users;
<span class="hljs-keyword">COMMIT</span>;</code></pre></div></div><br>
<p>  ,       :</p><br>
<pre><code class="bash hljs">migrate -database <span class="hljs-variable">${DB_DSN}</span> -path db/migrations up</code></pre><br>
<p>     :</p><br>
<pre><code class="bash hljs">migrate create -ext sql -dir migrations -seq create_table_foo</code></pre><br>
<p>     , , .         :      .  ,   ,     .     migrate  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>.</p><br>
<h1>5.  development-</h1><br>
<p> Lamoda  ,    ,      .   /          ,     . ,    Postgres      .        Postgres     .       /   development ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Docker Compose</a>.</p><br>
<p>Compose       development  . ,            :</p><br>
<ol>
<li>   Postgres,</li>
<li> migrate,       Postgres,</li>
<li>  dev- .</li>
</ol><br>
<p>    . ,        .    ,     ,     . </p><br>
<p>  Docker-compose     :</p><br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><pre><code class="plaintext hljs">version: "3.7"<font></font>
services:<font></font>
  #   dev- <font></font>
  gift-certificates-dev:<font></font>
    container_name: gift-certificates-dev<font></font>
    #       ,    pull  docker-<font></font>
    build:<font></font>
      context: ../<font></font>
      #    Dockerfile  multistage,       <font></font>
      #  .          ,<font></font>
      #             <font></font>
      #    go run.<font></font>
      target: build<font></font>
    #     environment  .<font></font>
    env_file:<font></font>
      - local.env<font></font>
    #   <font></font>
    depends_on:<font></font>
      - gift-certificates-db<font></font>
    #       .     <font></font>
    #   go run<font></font>
    volumes:<font></font>
      - "..:/app/"<font></font>
    working_dir: "/app"<font></font>
    #    <font></font>
    command: "go run main.go"<font></font>
    depends_on:<font></font>
      - gift-certificates-db<font></font>
  #    Postgres<font></font>
  gift-certificates-db:<font></font>
    container_name: gift-certificates-db<font></font>
    image: postgres:11.4<font></font>
    #      <font></font>
    #      env_file,    default.env<font></font>
    #   ,       <font></font>
    environment:<font></font>
      - POSTGRES_DB=gift_certificates<font></font>
      - POSTGRES_USER=gift_certificates<font></font>
      - POSTGRES_PASSWORD=gift_certificates<font></font>
      - POSTGRES_PORT=5432<font></font>
    #     docker <font></font>
    #  , ,          docker <font></font>
    ports:<font></font>
      - 6543:5432<font></font>
  #     <font></font>
  gift-certificates-migrate:<font></font>
    container_name: gift-certificates-migrate<font></font>
    image: "migrate/migrate:v4.4.0"<font></font>
    depends_on:<font></font>
      - gift-certificates-db<font></font>
    volumes:<font></font>
      - "../migrations:/migrations"<font></font>
    command: ["-path", "/migrations/", "-database", "$SERVICE_DB_DSN", "up"]</code></pre></div></div><br>
<p>   Docker-compose  Makefile     :</p><br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><pre><code class="plaintext hljs">#   <font></font>
#          <font></font>
.PHONY: test<font></font>
test: dev-migrate<font></font>
    go test -cover -coverprofile=coverage.out ./...<font></font>
    go tool cover -html=coverage.out -o coverage.html<font></font>
<font></font>
#   dev <font></font>
.PHONY: dev-server<font></font>
dev-server:<font></font>
    docker-compose -f deployments/docker-compose.yaml up -d gift-certificates-dev<font></font>
<font></font>
#       <font></font>
.PHONY: dev-migrate<font></font>
dev-migrate:<font></font>
    docker-compose -f deployments/docker-compose.yaml run --rm --service-ports gift-certificates-migrate<font></font>
<font></font>
#   dev <font></font>
.PHONY: dev-down<font></font>
dev-down:<font></font>
    docker-compose -f deployments/docker-compose.yaml down</code></pre></div></div><br>
<h1>6. </h1><br>
<p>  Go   gofmt,      ,       : goimports, go-critic, gocyclo  ..     ,    IDE  CI     .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">golangci-lint,</a>        Go .     ,            -. </p><br>
<p>     ,      Â«Â».       ,     ,      Â«Â» ,       .</p><br>
<p>  :</p><br>
<pre><code class="bash hljs">curl -sfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh| sh -s -- -b $(go env GOPATH)/bin v1.23.7</code></pre><br>
<p>  :</p><br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><pre><code class="plaintext hljs">run:<font></font>
  tests: false<font></font>
  #         <font></font>
  skip-dirs:<font></font>
    - generated<font></font>
  skip-files:<font></font>
    - ".*easyjson\\.go$"<font></font>
output:<font></font>
  print-issued-lines: false<font></font>
<font></font>
issues:<font></font>
  #      <font></font>
  new-from-rev: 7cdb5ce7d7ebb62a256cebf5460356c296dceb3d<font></font>
  exclude-rules:<font></font>
    - path: internal/common/writer.go<font></font>
      linters:<font></font>
        - structcheck<font></font>
      #       <font></font>
      text: "`size` is unused"</code></pre></div></div><br>
<p>:</p><br>
<pre><code class="bash hljs">golangci-lint run ./...</code></pre><br>
<p>    <i>golangci-lint</i>    pre-commit,    .</p><br>
<h1>7. Pre-commit hookâ€™</h1><br>
<p>   Pull Request      : ,   / ,    .       bash-     git pre-commit .       ,      -.    :            . </p><br>
<p>    python  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">pre-commit</a>:</p><br>
<ul>
<li>  :</li>
</ul><br>
<pre><code class="bash hljs">pip install pre-commit</code></pre><br>
<p>   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>.</p><br>
<ul>
<li> -.     go:</li>
</ul><br>
<pre><code class="plaintext hljs">repos:<font></font>
- repo: https://github.com/golangci/golangci-lint<font></font>
  rev: v1.23.7<font></font>
  hooks:<font></font>
  - id: golangci-lint</code></pre><br>
<ul>
<li>     git pre-commit hook':</li>
</ul><br>
<pre><code class="bash hljs">pre-commit install</code></pre><br>
<p>  golangci-lint           .    hook' .  all-files      ,       staging'e:</p><br>
<pre><code class="bash hljs">pre-commit run --all-files</code></pre><br>
<p>   hook'       test runner'.       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://pre-commit.com</a></p><br>
<h1>8.  </h1><br>
<p>Gonkey â€”    ,   Lamoda.  ,      .   ,   Gonkey,            habr.ru <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">â€œGonkey â€”   â€. </a></p><br>
<p>Gonkey :</p><br>
<ul>
<li>  HTTP-  ,     ,</li>
<li>    ,      (   YAML-),</li>
<li>       (  ,   Gonkey   ),</li>
<li>       Allure-.</li>
</ul><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHub.</a></p><br>
<h1>9.   </h1><br>
<p>         ,  Â«Â» .    :  ,    ,   ,      . </p><br>
<p>,         Confluence   .    ,      Â« Â».          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> cookiecutter.</a></p><br>
<p> , cookiecutter â€”  python-,   jinja-       .        jinja-   . </p><br>
<p>           :</p><br>
<pre><code class="bash hljs">cookiecutter https://stash.lamoda.ru/gotools/cookiecutter-go</code></pre><br>
<p>   , ,  ,    ..           .    cookiecutter   ,       .</p><br>
<h1></h1><br>
<p> Lamoda    .       .        ,    ,      .</p><br>
<p>        â€”  .      ,     (       ),     (        ). </p><br>
<p>,   ,     ,    <del></del>   ,     . </p><br>
<p>  ,   /  ,      ,       .</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN495332/index.html">å››é‡å¥9ï¼šå¿«æ¿| æ‰“å­—ç¨¿</a></li>
<li><a href="../zh-CN495336/index.html">ä¸å’Œè°ä¸ä»…æ˜¯ä¼ä¸šçš„ä½¿è€…ï¼Œ</a></li>
<li><a href="../zh-CN495338/index.html">åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯åŠ¨å®¹å™¨å’ŒKubernetesçš„æœ€ä½³å®è·µå’ŒæŒ‡å—</a></li>
<li><a href="../zh-CN495340/index.html">å¦‚ä½•æ›´æ”¹é¤å…ç®¡ç†å‘˜çš„å·¥ä½œä»¥ä½¿å…¶åœ¨ITæ–¹é¢è¡¨ç°å‡ºè‰²</a></li>
<li><a href="../zh-CN495342/index.html">äº¤æ˜“ä¸­é“¶è¡Œå¡çš„ç»“ç®—-åœ¨Google Data Studioä¸­åˆ›å»ºä¸€ä¸ªå¼€æ”¾çš„æ•°æ®é›†å’Œä¿¡æ¯å›¾</a></li>
<li><a href="../zh-CN495346/index.html">ä»é”™è¯¯åˆ°è¡ŒåŠ¨è­¦æŠ¥</a></li>
<li><a href="../zh-CN499818/index.html">ä¹Œå…¹åˆ«å…‹ç”µæŠ¥è¥é”€</a></li>
<li><a href="../zh-CN499820/index.html">ä¸ºä»€ä¹ˆæˆ‘ä»¬é€‰æ‹©Kotlinä½œä¸ºæˆ‘ä»¬çš„ç›®æ ‡è¯­è¨€ä¹‹ä¸€ã€‚ç¬¬2éƒ¨åˆ†ï¼šKotlinå¤šå¹³å°</a></li>
<li><a href="../zh-CN499822/index.html">æ— çº¿æ¥å…¥ç‚¹ä¸è·¯ç”±å™¨ï¼šæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li>
<li><a href="../zh-CN499824/index.html">2020å¹´5æœˆäººåŠ›èµ„æºå’ŒITæ‹›è˜äººå‘˜çš„äº‹ä»¶æ‘˜è¦</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>