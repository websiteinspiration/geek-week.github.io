<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏻 🤵🏾 ⏳ MIROはオープンな屋内ロボットプラットフォームです。パート5-ソフトウェアコンポーネント：ARDUINO（AVR）、「内部」に登る 🃏 🖕🏿 ⤴️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="今回は、MIROロボットの移動を担当するARDUINO（AVR）の主要なライブラリメソッドの実装についてもう少し詳しく見ていきましょう。この部分は、最も単純なエンコーダを備えたモーターを備えたARDUINOでロボットの直線速度と角速度を制御する方法を疑問に思ったすべての人にとって興味深いでしょう。
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>MIROはオープンな屋内ロボットプラットフォームです。パート5-ソフトウェアコンポーネント：ARDUINO（AVR）、「内部」に登る</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/477118/"><img src="https://habrastorage.org/webt/m-/j7/gm/m-j7gmvwywlwzlopp5x-27y_jta.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今回は、MIROロボットの移動を担当するARDUINO（AVR）の主要なライブラリメソッドの実装についてもう少し詳しく見ていきましょう。</font><font style="vertical-align: inherit;">この部分は、最も単純なエンコーダを備えたモーターを備えたARDUINOでロボットの直線速度と角速度を制御する方法を疑問に思ったすべての人にとって興味深いでしょう。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
目次：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オドメトリを使用した運転を担当する方法は、いかに、何を、そしてなぜ説明するという点で、依然として苦痛です。ロボットの動きの制御について最初に知っておくべきことは、ロボットのコレクターモーターが追加の調整なしに同じ速度で回転することは決してないという単純で明白な事実です。異なるクラッチ、ドライバーチャンネルの異なる出力特性、わずかに異なる電気モーターとギアボックス内の潤滑。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
理解して知っておくべき2つ目の事実は、十分に大きなギア比であっても、エンジンに慣性があることです。それら。モーター端子から電圧を取り除くと、ホイールは、負荷がなくても、さらに数度動きます。この追加の回転の大きさは、ホイールへの負荷力、応力を緩和する前の回転速度、およびギアボックス内の潤滑剤の種類と量などの同じ目に見えない要因に依存します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの事実は、走行距離計センサー（MIROの場合は、各ホイールのデジタルエンコーダー）を装備したシャーシの動きに関連する一連のメソッドの実装を決定します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4番目の部分でわかったように、</font><b><font style="vertical-align: inherit;">Chassis</font></b><font style="vertical-align: inherit;">クラスはプログラミングモデルに存在します。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、個々のシャーシエンジンの回転制御を実装します。強調したいのは、シャーシやトロリーの動きではなく、トロリーのエンジンの制御です。トロリーの直接制御は、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Robot</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス</font><font style="vertical-align: inherit;">と</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Miro</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスに実装されています</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上から始めましょう。以下は、</font><font style="vertical-align: inherit;">指定された線形</font><b><font style="vertical-align: inherit;">速度</font></b><font style="vertical-align: inherit;">（</font><b><font style="vertical-align: inherit;">lin_speed</font></b><font style="vertical-align: inherit;">、m / s）と角速度（</font><b><font style="vertical-align: inherit;">ang_speed</font></b><font style="vertical-align: inherit;">、deg / s）で</font><font style="vertical-align: inherit;">ロボットの特定の距離（</font><b><font style="vertical-align: inherit;">dist</font></b><font style="vertical-align: inherit;">、メートル）</font><font style="vertical-align: inherit;">の動きを実装</font><font style="vertical-align: inherit;">する</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Miro</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスのメソッドです</font><font style="vertical-align: inherit;">。</font><b><font style="vertical-align: inherit;">en_break</font></b><font style="vertical-align: inherit;">パラメーターには</font><font style="vertical-align: inherit;">まだ注意を払っていません。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Miro::moveDist</span><span class="hljs-params">(<span class="hljs-keyword">float</span> lin_speed, <span class="hljs-keyword">float</span> ang_speed, <span class="hljs-keyword">float</span> dist, <span class="hljs-keyword">bool</span> en_break)</span>
</span>{
	<span class="hljs-keyword">float</span> _wheelSetAngSpeed[WHEEL_COUNT];<font></font>
	_wheelSetAngSpeed[LEFT] = MIRO_PI2ANG * (lin_speed - (ROBOT_DIAMETER * ang_speed / (<span class="hljs-number">2</span> * MIRO_PI2ANG))) / WHEEL_RADIUS;<font></font>
	_wheelSetAngSpeed[RIGHT] = MIRO_PI2ANG * (lin_speed + (ROBOT_DIAMETER * ang_speed / (<span class="hljs-number">2</span> * MIRO_PI2ANG))) / WHEEL_RADIUS;<font></font>
<font></font>
	<span class="hljs-keyword">float</span> _wheelSetAng[WHEEL_COUNT];<font></font>
	_wheelSetAng[RIGHT] = _wheelSetAngSpeed[RIGHT] * dist / lin_speed;<font></font>
	_wheelSetAng[LEFT] = _wheelSetAngSpeed[LEFT] * dist / lin_speed;<font></font>
<font></font>
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>-&gt;chassis.wheelRotateAng(_wheelSetAngSpeed, _wheelSetAng, en_break);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この方法では、左エンジンと右エンジンの必要な角速度が最初に計算されます。かなり明白な公式によると、これは推測する問題ではありません。この方法の線速度はメートル/秒で、角速度は度/秒（ラジアンではない）で指定されていることを覚えておく必要があります。したがって、定数</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MIRO_PI2ANG = 57.29 = 180 / pi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を事前に計算し</font><b><font style="vertical-align: inherit;">ます。 ROBOT_DIAMETER-</font></b><font style="vertical-align: inherit;">ロボットの左右の車輪間の距離（メートル単位）、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHEEL_RADIUS-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">車輪の半径（メートル単位）。このような場合のすべての数値定数はdefs.hファイルに含まれており、ロボットとシャーシのカスタムパラメータはconfig.hファイルに含まれています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、ロボットが距離</font><b><font style="vertical-align: inherit;">distを</font></b><font style="vertical-align: inherit;">移動するように各ホイールを回転させる角度を計算します</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（メートル単位でも）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、この段階で、ロボットシャーシの各ホイールを回転させるために必要な速度と角度がわかります。次に、</font><b><font style="vertical-align: inherit;">chassis</font></b><font style="vertical-align: inherit;">オブジェクト</font><font style="vertical-align: inherit;">の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wheelRotateAng（）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">呼び出されます。</font><b><font style="vertical-align: inherit;">wheelRotateAng</font></b><font style="vertical-align: inherit;"> 
メソッド</font><b><font style="vertical-align: inherit;">（float * speed、float * ang、bool en_break）</font></b><font style="vertical-align: inherit;">を使用して、</font><b><font style="vertical-align: inherit;">速度[]</font></b><font style="vertical-align: inherit;">配列</font><font style="vertical-align: inherit;">（m / s）で</font><font style="vertical-align: inherit;">指定された角速度で、ロボットホイールを</font><b><font style="vertical-align: inherit;">ang []</font></b><font style="vertical-align: inherit;">配列</font><font style="vertical-align: inherit;">（度）で</font><font style="vertical-align: inherit;">指定された角度</font><font style="vertical-align: inherit;">だけ回転させ</font><font style="vertical-align: inherit;">ます。最後のパラメーター</font><b><font style="vertical-align: inherit;">en_break</font></b></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（すでに以前に私たちが会った）は、ホイールに短期の逆電圧を加えることにより、ホイールのハードストップの要件を設定します。これは、ロボットの慣性を抑制し、モーターから制御電圧を除去した後にロボットが必要な距離を超えて移動するのを防ぐために必要です。完全に満足のために、当然のことながら、ある</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wheelRotateAngRad（）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">と同様、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wheelRotateAng（）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がパラメータとしてラジアン毎秒で回転角度と角速度の値とラジアンをとるという違いです。</font><b><font style="vertical-align: inherit;">wheelRotateAng（）</font></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
メソッドのアルゴリズムは</font><font style="vertical-align: inherit;">以下の通りです。</font><font style="vertical-align: inherit;">
1.まず、</font><b><font style="vertical-align: inherit;">速度[]</font></b><font style="vertical-align: inherit;">と</font><b><font style="vertical-align: inherit;">ang []</font></b><font style="vertical-align: inherit;">の値の対応を確認します</font><b><font style="vertical-align: inherit;">。</font></b></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いくつかの境界条件。明らかに、シャーシには車輪の最大回転角速度と最小回転速度（離れる最小速度）の両方に物理的な制限があります。また、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ang []の</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">角度は、エンコーダーの精度によって決定される最小固定回転角度より小さくすることはできません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2.次に、各ホイールの回転方向が計算されます。明らかに製品記号</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ang [i] * speed [i]を使用し</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. </font><font style="vertical-align: inherit;">各ホイール</font><font style="vertical-align: inherit;">の「回転距離」</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dw [i]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">計算されます</font><font style="vertical-align: inherit;">—指定された</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ang [i]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">だけ回転させる必要のあるエンコーダーサンプルの数</font><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この値は、式</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dw [i] = ang [i] * WHEEL_SEGMENTS / 360</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">によって決定されます</font><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHEEL_SEGMENTS-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エンコーダーホイールセグメントの数（全回転）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.モータードライバーの電圧値が記録されます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エンジンの電圧について</font></font></b><div class="spoiler_text">* <i>     ,   ,   ,    ,      .   MIRO       .  float getVoltage();        VOLTAGE_DIVIDER.   : 5.       VOLTAGE_DIVIDER  2,     (PIN_VBAT)      (1S) .       ,     -    , ,   ,       –   .          .</i><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5.各ホイールのキャリブレーションテーブルに従って、PWM信号の初期値が決定されます。これにより、必要な速度</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">速度[i]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でのホイールの回転が保証され</font><font style="vertical-align: inherit;">ます。どのようなキャリブレーションテーブルとそれがどこから来たのか-さらに分析します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6.回転数と回転方向の計算値に従って、エンジンの回転が開始されます。クラス実装のテキストでは、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_wheel_rotate_sync（）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プライベートメソッドがこれを担当します</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはさらに深く行きます。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_wheel_rotate_sync（）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">は、次のアルゴリズムに従って機能し</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます。1.無限ループでは</font><font style="vertical-align: inherit;">、各ホイールの</font><font style="vertical-align: inherit;">回転距離</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dw [i]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のエンコーダー応答のカウンターを達成するためのチェックが行われ</font><font style="vertical-align: inherit;">ます。カウンター</font><b><font style="vertical-align: inherit;">Dwの</font></b><font style="vertical-align: inherit;">いずれかを達成した場合</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[i]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、すべてのホイールが停止してサイクルを終了し、その後、関数を終了します（ステップ5）。これは、次の理由で行われます。回転角度の測定の離散性のため、</font><font style="vertical-align: inherit;">1つの車輪</font><font style="vertical-align: inherit;">の計算された距離</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dw [i]が</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非整数値を小さい側に丸め</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2番目の車輪の</font><b><font style="vertical-align: inherit;">Dw [j]を</font></b><font style="vertical-align: inherit;">大きい</font><font style="vertical-align: inherit;">側に丸めることによって得られる</font><font style="vertical-align: inherit;">場合は非常に一般的な状況</font><font style="vertical-align: inherit;">です。これは、ホイールの1つを停止した後、2番目のホイールが回転し続けるという事実につながります。差動ドライブを備えたシャーシ（および他の多くのシャーシ）の場合、これにより、タスクの最後にロボットが計画外に「回転」します。したがって、シャーシ全体の空間的な動きを整理する場合は、すべてのエンジンを一度に停止する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. </font><b><font style="vertical-align: inherit;">Dwの</font></b><font style="vertical-align: inherit;">場合</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[i]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到達しない場合は、エンコーダーの次の操作の事実がループでチェックされます（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_syncloop [w]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数</font><font style="vertical-align: inherit;">、エンコーダーの割り込みから更新され、この無限ループでリセットされます）。次の交差が発生すると、プログラムは各ホイールの現在の角速度のモジュール（deg / s）を、明白な式を使用して計算します：</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W [i] =（360 * tau [i]）/ WHEEL_SEGMENTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで：</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tau [i]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、エンコーダーの最後の2つのトリガー。平均化フィルターの「深さ」は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MEAN_DEPTH</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">によって決定され</font><font style="vertical-align: inherit;">、デフォルトは8です</font><b><font style="vertical-align: inherit;">。3</font></b><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
計算されたホイール速度に基づいて、絶対誤差は設定された速度と実際の角速度の差として計算されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.計算された誤差に基づいて、モーターごとに制御動作（PWM信号値）が修正されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dw [i]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に達した後</font><font style="vertical-align: inherit;">、アクティブな</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en_breakの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合</font><font style="vertical-align: inherit;">、逆短期電圧がモーターに印加されます。この効果の持続時間は、キャリブレーションテーブル（下記参照）から決定され、通常は15〜40 msです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6.エンジンからのストレスが完全に解放され、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_wheel_rotate_sync（）が</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">終了し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すでに特定のキャリブレーションテーブルについて2回説明しました。したがって、ライブラリには、ロボットメモリのEEPROMに格納され、3つの関連する値のレコードを含む特別な値のテーブルがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1.モーター端子の電圧。これは、PWM信号の値を実際の電圧に変換することによって計算されます。このため、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wheelRotateAng（）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドのステップ4で</font><font style="vertical-align: inherit;">、エンジンドライバーの実際の電圧が記録されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2.与えられた電圧に対応する車輪の無負荷回転角速度。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.この角速度に対応するハードストップ信号の持続時間。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デフォルトでは、キャリブレーションテーブルのサイズは10レコードです（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">config.h</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルの</font><font style="vertical-align: inherit;">定数</font><b><font style="vertical-align: inherit;">WHEEL_TABLE_SIZE</font></b><font style="vertical-align: inherit;">によって決定され</font><font style="vertical-align: inherit;">ます）-値「10のトリプル-電圧-角速度-停止信号の持続時間」</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このテーブルの2と3のエントリから値を決定するために、特別なメソッドが使用され</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます-wheelCalibrate（バイトホイール）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
少し調べてみましょう。この方法は、一連のアクションを実装して、エンジン/ホイールのキャリブレーションテーブルの欠損値を特定し、摩擦の最小角速度とホイールの最大角速度を見つけます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キャリブレーションを実行するには、ロボットをスタンドに取り付け、キャリブレーション中のすべてのホイールの回転を無負荷で実行します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1.最初に、最低始動速度を決定する必要があります。これは非常に簡単です。サイクルでは、制御PWMは0から始まり、1の増分でエンジンに供給されます。各ステップで、プログラムは一定の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHEEL_TIME_MAX</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（通常の</font><b><font style="vertical-align: inherit;">遅延（）</font></b><font style="vertical-align: inherit;">によって決定される）しばらく待機します</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）待機時間が経過した後、（エンコーダーカウンターの値を変更することによって）開始が完了したかどうかを確認します。引き離しが完了すると、ホイールの回転の角速度が計算されます。確実性を高めるために、この開始速度に対応するPWMの値に10の値が追加されます。これにより、「モーターの電圧」と「角速度」の最初の値のペアが得られます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2.開始速度が見つかると、キャリブレーションテーブルを均一に満たすようにPWMステップが計算されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.サイクルでは、新しいPWM値ごとに、ホイールが2回転し、角速度は</font><b><font style="vertical-align: inherit;">_wheel_rotate_sync（）</font></b><font style="vertical-align: inherit;">メソッドと同様のアルゴリズムに従って測定されます。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。同じサイクルで、逐次比較によっても、ハードストップ信号の継続時間の最適値が測定されます。最初は、明らかに重要な値が使用されます。そして、「ターンストップ」モードでテストされます。最適なものとして、設定された「旋回距離」を超えない停止信号継続時間の最大値が選択されます。換言すれば、一方ではエンジンに供給されると慣性が抑制され、他方では短期間の後退はない（同じエンコーダによって固定される）信号継続時間のそのような値。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.キャリブレーションが完了すると、キャリブレーションされたモーターへの制御電圧の印加が停止し、このホイールのキャリブレーションテーブルがEEPROMに記録されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はあらゆる種類の簡単な実装を省略し、本質を述べようとしました。あなたは、ことに気づくかもしれ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wheelRotateAng（）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wheelRotateAngRad（）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドは、</font><font style="vertical-align: inherit;">機能をブロックしています。これは、動きの正確さとユーザースケッチへのかなり単純な統合の代償です。固定されたタイミングで小さなタスクマネージャーを作成することは可能ですが、これにはユーザーが割り当てられた時間割り当てに厳密に機能を組み込む必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、非ブロッキングアプリケーションの場合、APIには</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wheelRotate（float * speed）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数があります</font><font style="vertical-align: inherit;">。パラメータのリストからわかるように、設定された速度でホイールを回転させるだけです。そして、回転速度は</font><font style="vertical-align: inherit;">、同じ名前のメソッドで呼び出されるロボットシャーシ</font><font style="vertical-align: inherit;">の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sync（）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドで調整され</font><font style="vertical-align: inherit;">ます。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスMiroのオブジェクトの</font><b><font style="vertical-align: inherit;">Sync（）</font></b><font style="vertical-align: inherit;">。また、ユーザーのスケッチの構造の要件に従って、このメソッド</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ARDUINOスケッチの</font><font style="vertical-align: inherit;">メイン</font><b><font style="vertical-align: inherit;">ループ（）ループの</font></b><font style="vertical-align: inherit;">反復ごとに呼び出す必要があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ステップ4では、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_wheel_rotate_sync（）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドの説明</font><font style="vertical-align: inherit;">で、エンジンの「制御修正」について説明しました。どう思いましたか？）これはPIDコントローラーです）。さて、より正確にはPDコントローラー。ご存知のように（実際は-常にではありません）、レギュレーターの係数を決定する最良の方法は選択です）。 config.h構成ファイルには1つの定義があります。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEBUG_WHEEL_PID</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コメントを</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外す</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と、Miroクラス</font><font style="vertical-align: inherit;">の</font><b><font style="vertical-align: inherit;">moveDist（）</font></b><font style="vertical-align: inherit;">メソッドを呼び出す</font><font style="vertical-align: inherit;">と、ロボットホイールの1つ（左）の角速度を制御する際の相対誤差の次の反転グラフがロボットコンソールに表示されます。</font><font style="vertical-align: inherit;">
何も思い出させません）？ダウンは時間であり（各バーは制御サイクルのステップです）、エラー値は右側に保存されます（符号は保持されます）。これは、PDコントローラーの係数が異なる、同じスケールの2組のグラフです。 「ハンプ」はオーバーシュートの「波」にすぎません。水平バーの数値は、相対的なエラーです（符号は保持されます）。レギュレーターの簡単な視覚化により、係数を手動で調整できます。時間の経過とともに、私は自動セットアップを行いたいと思っていますが、今のところは。</font><font style="vertical-align: inherit;">
ここにそのようなアドクがあります:-)</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/_v/4i/hr/_v4ihrxfnzpq-fvnofq_3kjkcz0.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、例を見てみましょう。</font><font style="vertical-align: inherit;">API_Miro_moveDistライブラリから直接：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Miro.h&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> miro;<font></font>
<font></font>
byte PWM_pins[<span class="hljs-number">2</span>] = { <span class="hljs-number">5</span>, <span class="hljs-number">6</span> };<font></font>
byte DIR_pins[<span class="hljs-number">2</span>] = { <span class="hljs-number">4</span>, <span class="hljs-number">7</span> };<font></font>
byte ENCODER_pins[<span class="hljs-number">2</span>] = { <span class="hljs-number">2</span>, <span class="hljs-number">3</span> };
<span class="hljs-function">Miro <span class="hljs-title">robot</span><span class="hljs-params">(PWM_pins, DIR_pins, ENCODER_pins)</span></span>;
<span class="hljs-keyword">int</span> laps = <span class="hljs-number">0</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{<font></font>
	Serial.begin(<span class="hljs-number">115200</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++)<font></font>
	{<font></font>
		robot.moveDist(robot.getOptLinSpeed(), <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>);<font></font>
		delay(<span class="hljs-number">500</span>);<font></font>
		robot.rotateAng(<span class="hljs-number">0.5</span>*robot.getOptAngSpeed(), <span class="hljs-number">-90</span>, <span class="hljs-literal">true</span>);<font></font>
		delay(<span class="hljs-number">500</span>);<font></font>
	}<font></font>
	Serial.print(<span class="hljs-string">"Laps: "</span>);<font></font>
	Serial.println(laps);<font></font>
	laps++;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムのテキストから、すべてが明確でなければなりません。</font><font style="vertical-align: inherit;">それがどのように機能するか-ビデオで。</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/Bd96kgY2YsY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タイルのサイズ600〜600 mm、タイル間のギャップは5 mm。</font><font style="vertical-align: inherit;">理論的には、ロボットは一辺が1メートルの正方形の周りを移動する必要があります。</font><font style="vertical-align: inherit;">もちろん、その軌跡は「浮き上がる」。</font><font style="vertical-align: inherit;">しかし、公平に言えば、私がテストに残したバージョンのロボットには、ゆっくりと運転するのが難しいかなりの回転エンジンがあるということは価値があります。</font><font style="vertical-align: inherit;">しかし、高速でスリップする場所はあり、慣性は簡単ではありません。</font><font style="vertical-align: inherit;">ギア比が高いエンジン（たとえば、MIROロボットでさえ、テスト中に手元になかった）は、いくらか良い動作をするはずです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
理解できない瞬間がある場合-明確にし、話し合い、改善できることを嬉しく思います。</font><font style="vertical-align: inherit;">フィードバックは一般的に興味深いものです。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja477096/index.html">5Gは私たちの健康に害を及ぼしますか？</a></li>
<li><a href="../ja477098/index.html">USB-Cハブを介して60 Hzで4K解像度のビデオ伝送を処理します</a></li>
<li><a href="../ja477100/index.html">Microsoft Dynamics 365テクニカルマラソン</a></li>
<li><a href="../ja477110/index.html">面白い計画</a></li>
<li><a href="../ja477114/index.html">MSHインタープリターの実装</a></li>
<li><a href="../ja477120/index.html">Windows用の連続血糖モニタリングソフトウェア</a></li>
<li><a href="../ja477122/index.html">会社の頭脳。パート3</a></li>
<li><a href="../ja477124/index.html">檻の中のビットコイン？</a></li>
<li><a href="../ja477126/index.html">5分で管理できます。フロントエンド-react-admin、バックエンド-Flask-RESTful</a></li>
<li><a href="../ja477128/index.html">週末のハブラ刑事</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>